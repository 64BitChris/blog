<!DOCTYPE html>
<html âš¡ lang="en">
  <head>
    <meta charset="utf-8">
    <title>Rultor + Travis</title>
    <link rel="canonical" href="http://www.yegor256.com/2014/07/31/travis-and-rultor.html" />
    <meta name="viewport" content="width=device-width,minimum-scale=1,initial-scale=1">
    <script type='application/ld+json'>
      {
        "@context": "http://schema.org",
        "@type": "BlogPosting",
        "mainEntityOfPage":{
          "@type": "WebPage",
          "@id": "http://www.yegor256.com/2014/07/31/travis-and-rultor.html"
        },
        "headline": "Rultor + Travis",
        "image": {
          "@type": "ImageObject",
          "url": "http://img.teamed.io/face-1400x1400.jpg",
          "height": 1400,
          "width": 1400
        },
        "datePublished": "2014-07-31",
        "dateModified": "2014-07-31",
        "author": {
          "@type": "Person",
          "name": "Yegor Bugayenko"
        },
        "publisher": {
          "@type": "Organization",
          "name": "yegor256.com",
          "logo": {
            "@type": "ImageObject",
            "url": "http://img.teamed.io/face-512x512.jpg",
            "width": 512,
            "height": 512
          }
        },
        "description": "Rultor is a virtual team assistant that,
in tandem with Travis, optimizes your routine merging,
releasing and deploying operations
",
        "keywords": ["continuous integration", "docker continuous integration", "continuous delivery", "docker continuous delivery", "java continuous integration", "hosted continuous integration"]
      }
    </script>
    <style amp-boilerplate>body{-webkit-animation:-amp-start 8s steps(1,end) 0s 1 normal both;-moz-animation:-amp-start 8s steps(1,end) 0s 1 normal both;-ms-animation:-amp-start 8s steps(1,end) 0s 1 normal both;animation:-amp-start 8s steps(1,end) 0s 1 normal both}@-webkit-keyframes -amp-start{from{visibility:hidden}to{visibility:visible}}@-moz-keyframes -amp-start{from{visibility:hidden}to{visibility:visible}}@-ms-keyframes -amp-start{from{visibility:hidden}to{visibility:visible}}@-o-keyframes -amp-start{from{visibility:hidden}to{visibility:visible}}@keyframes -amp-start{from{visibility:hidden}to{visibility:visible}}</style><noscript><style amp-boilerplate>body{-webkit-animation:none;-moz-animation:none;-ms-animation:none;animation:none}</style></noscript>
    <style amp-custom="amp-custom">
      body { padding: 2em; }
      article { width: 600px; max-width: 100%; margin-left: auto; margin-right: auto; }
    </style>
    <script async src="https://cdn.ampproject.org/v0.js"></script>
  </head>
  <body>
    <article>
      <h1>Rultor + Travis</h1>
      



<p><a href="http://www.rultor.com">Rultor</a> is a coding team assistant.
<a href="http://travis-ci.org">Travis</a> is a hosted
<a href="/2014/10/08/continuous-integration-is-dead.html">continuous integration</a> system.
In this article I&#39;ll show how our open source projects are
using them in tandem to achieve seamless continuous delivery.</p>

<p>I&#39;ll show a few practical scenarios.</p>

<!--more-->

<h2 id="scenario-1-merge-pull-request">Scenario #1: Merge Pull Request</h2>

<p><a href="https://github.com/jcabi/jcabi-mysql-maven-plugin">jcabi-mysql-maven-plugin</a>
is a Maven plugin for <a href="/2014/05/21/mysql-maven-plugin.html">MySQL integration testing</a>.
<a href="https://github.com/ChristianRedl">@ChristianRedl</a> submitted pull request
<a href="https://github.com/jcabi/jcabi-mysql-maven-plugin/pull/35">#35</a> with a new feature.
I reviewed the request and asked Rultor to merge it into <code>master</code>:</p>



<p>As you can see, an actual merge operation was made by Rultor.
I gave him access to the project by adding his GitHub account to
the list of project collaborators.</p>

<p>Before giving a &quot;go ahead&quot; to Rultor I checked the status
of the pre-build reported by Travis:</p>



<p>Travis found a new commit in the pull request and immediately
(without any interaction from my side) triggered a build in that branch.
The build didn&#39;t fail, that&#39;s why Travis gave me a green sign.
I looked at that sign and at the code. Since all problems in the code
were corrected by the pull request author and Travis didn&#39;t complain
&mdash; I gave a &quot;go&quot; to Rultor.</p>

<h2 id="scenario-2-continuous-integration">Scenario #2: Continuous Integration</h2>

<p>Even though the previous step <a href="/2014/07/21/read-only-master-branch.html">guarantees</a>
that <code>master</code> branch is always clean and stable, we&#39;re using Travis to
continuously integrate it. Every commit made to <code>master</code> triggers
a new build in Travis. The result of the build changes the status
of the project in Travis: either &quot;failing&quot; or &quot;passing&quot;.</p>

<p><a href="http://aspects.jcabi.com">jcabi-aspects</a> is a collection of
<a href="/2014/06/01/aop-aspectj-java-method-logging.html">AOP AspectJ aspects</a>.
We configured Travis to build it continuously. This is the badge it produces (the left one):</p>



<p>Again, let me stress that even through
<a href="/2014/07/21/read-only-master-branch.html">read-only master</a>
is a strong protection against broken builds, it doesn&#39;t guarantee that
at any moment master is stable. For example, sometimes unit tests
fail sporadically due to changes in calendar, in environment, in dependencies,
in network connection qualities, etc.</p>

<p>Well, ideally, unit tests should either fail or pass because they
are environment independent. However, in reality, unit tests are far
from being ideal.</p>

<p>That&#39;s why a combination of <a href="/2014/07/21/read-only-master-branch.html">read-only master</a>
with Rultor and
<a href="/2014/10/08/continuous-integration-is-dead.html">continuous integration</a>
with Travis gives us higher stability.</p>

<h2 id="scenario-3-release-to-rubygems">Scenario #3: Release to RubyGems</h2>

<p><a href="https://github.com/yegor256/jekyll-github-deploy">jekyll-github-deploy</a>
is a Ruby gem that <a href="/2014/06/24/jekyll-github-deploy.html">automates deployment of Jekyll sites to GitHub Pages</a>.
<a href="https://github.com/leucos">@leucos</a> submitted a pull request
<a href="https://github.com/yegor256/jekyll-github-deploy/pull/4">#4</a>
with a new feature. The request was merged successfully into <code>master</code> branch.</p>

<p>Then, Rultor was instructed by myself that <code>master</code> branch should be
released to RubyGems and a new version to set is 1.5:</p>



<p>Rultor executed a simple script, <a href="http://doc.rultor.com/basics.html#release">pre-configured</a> in its
<a href="https://github.com/yegor256/jekyll-github-deploy/blob/master/.rultor.yml"><code>.rultor.yml</code></a>:</p>

<figure class="highlight"><pre><code class="language-yaml" data-lang="yaml"><span class="l-Scalar-Plain">release</span><span class="p-Indicator">:</span>
  <span class="l-Scalar-Plain">script</span><span class="p-Indicator">:</span> <span class="p-Indicator">|</span>
    <span class="no">./test.sh</span>
    <span class="no">rm -rf *.gem</span>
    <span class="no">sed -i &quot;s/2.0-SNAPSHOT/${tag}/g&quot; jgd.gemspec</span>
    <span class="no">gem build jgd.gemspec</span>
    <span class="no">chmod 0600 ../rubygems.yml</span>
    <span class="no">gem push *.gem --config-file ../rubygems.yml</span></code></pre></figure>

<p>The script is parameterized, as you see. There is one parameter that
is passed by Rultor into the script: <code>${tag}</code>. This parameter was
provided by myself in the GitHub issue, when I submitted a command to Rultor.</p>

<p>The script tests that the gem works (integration testing) and
clean up afterwords:</p>

<figure class="highlight"><pre><code class="language-bash" data-lang="bash"><span class="nv">$ </span>./test.sh
<span class="nv">$ </span>rm -rf *.gem</code></pre></figure>

<p>Then, it changes the version of itself in <code>jgd.gemspec</code> to
the one provided in the <code>${tag}</code> (it is an environment variable),
and builds a new <code>.gem</code>:</p>

<figure class="highlight"><pre><code class="language-bash" data-lang="bash"><span class="nv">$ </span>sed -i <span class="s2">&quot;s/2.0-SNAPSHOT/${tag}/g&quot;</span> jgd.gemspec
<span class="nv">$ </span>gem build jgd.gemspec</code></pre></figure>

<p>Finally, it pushes a newly built <code>.gem</code> to
<a href="/2014/08/26/publish-to-rubygems.html">RubyGems</a>,
using login credentials from <code>../rubygems.yml</code>. This file is created by
Rultor right before starting the script (this mechanism is discussed below):</p>

<figure class="highlight"><pre><code class="language-bash" data-lang="bash"><span class="nv">$ </span>chmod <span class="m">0600</span> ../rubygems.yml
<span class="nv">$ </span>gem push *.gem --config-file ../rubygems.yml</code></pre></figure>

<p>If everything works fine and RubyGems confirms successful deployment,
Rultor reports to GitHub. This is exactly what happened in
<a href="https://github.com/yegor256/jekyll-github-deploy/pull/4">pull request #4</a>.</p>

<h2 id="scenario-4-deploy-to-cloudbees">Scenario #4: Deploy to CloudBees</h2>

<p><a href="http://www.s3auth.com">s3auth.com</a> is a
<a href="/2014/04/21/s3-http-basic-auth.html">Basic HTTP authentication gateway for Amazon S3 Buckets</a>.
It is a Java web app.
In its pull request <a href="https://github.com/yegor256/s3auth/pull/195">#195</a>, a resource
leakage problem was fixed by <a href="https://github.com/carlosmiranda">@carlosmiranda</a>
and the pull request was merged by Rultor.</p>

<p>Then, <a href="https://github.com/davvd">@davvd</a> instructed Rultor to deploy
<code>master</code> branch to production environment. Rultor created
<a href="/2014/07/29/docker-in-rultor.html">a new Docker container</a>
and ran <code>mvn clean deploy</code> in it.</p>

<p>Maven deployed the application to <a href="http://www.cloudbees.com">CloudBees</a>:</p>



<p>The overall procedure took 21 minutes, as you see the in the report generated by Rultor.</p>

<p>There is one important trick worth mentioning. Deployment to
production always means using secure credentials, like login, password, SSH keys, etc.</p>

<p>In this particular example, <a href="https://wiki.cloudbees.com/bin/view/RUN/MavenGuide">Maven CloudBees  Plugin</a>
needed API key, secret and web application name. These three parameters are kept secure
and can&#39;t be revealed in an &quot;<a href="/2015/12/22/why-dont-you-contribute-to-open-source.html">open source</a>&quot; way.</p>

<p>So, there is <a href="http://doc.rultor.com/reference.html#assets">a mechanism</a>
that configures Rultor accordingly through its
<a href="https://github.com/yegor256/s3auth/blob/master/.rultor.yml"><code>.rultor.yml</code></a>
file (pay attention to the first few lines):</p>

<figure class="highlight"><pre><code class="language-yaml" data-lang="yaml"><span class="l-Scalar-Plain">assets</span><span class="p-Indicator">:</span>
  <span class="l-Scalar-Plain">settings.xml</span><span class="p-Indicator">:</span> <span class="s">&quot;yegor256/home#assets/s3auth/settings.xml&quot;</span>
  <span class="l-Scalar-Plain">pubring.gpg</span><span class="p-Indicator">:</span> <span class="s">&quot;yegor256/home#assets/pubring.gpg&quot;</span>
  <span class="l-Scalar-Plain">secring.gpg</span><span class="p-Indicator">:</span> <span class="s">&quot;yegor256/home#assets/secring.gpg&quot;</span></code></pre></figure>

<p>These YAML entries inform Rultor that it has to get <code>assets/s3auth/settings.xml</code>
file from <code>yegor256/home</code> private (!) GitHub repository and put it into
the working directory of Docker container, right before starting the Maven build.</p>

<p>This <code>settings.xml</code> file contains that secret data CloudBees
plugin needs in order to deploy the application.</p>

<p><a href="/2014/08/25/deploy-to-cloudbees.html">How to Deploy to CloudBees, in One Click</a>
explains this process even better.</p>

<h2 id="you-can-do-the-same">You Can Do The Same</h2>

<p>Both Rultor and Travis are free hosted products, provided your
projects are open source and hosted at GitHub.</p>

<p>Other good examples of Rultor+Travis usage can be seen in these GitHub issues:
<a href="https://github.com/jcabi/jcabi-http/issues/47">jcabi/jcabi-http#47</a>,
<a href="https://github.com/jcabi/jcabi-http/pull/48">jcabi/jcabi-http#48</a></p>

<p>PS. You can do something similar with AppVeyor, for Windows platform:
<a href="/2015/03/29/rultor-with-appveyor.html">How AppVeyor Helps Me to Validate Pull Requests Before Rultor Merges Them</a></p>

    </article>
  </body>
</html>
