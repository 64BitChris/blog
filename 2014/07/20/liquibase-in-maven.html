<!DOCTYPE html><html xmlns="http://www.w3.org/1999/xhtml" lang="en-US"><head><meta charset="utf-8"/><meta name="description" content="Liquibase is a convenient tool for database migration management. Here, I explain how to use it with Maven projects."/><meta name="keywords" content="liquibase integration testing java, liquibase java mysql, liquibase java postgresql, liquibase java test, liquibase maven example, liquibase maven integration test, liquibase maven mysql, liquibase maven plugin, liquibase maven postgresql, liquibase maven repository, liquibase maven test, liquibase maven tutorial, maven linux liquibase, maven liquibase java test, mysql maven liquibase, postgresql maven"/><meta name="viewport" content="width=device-width, initial-scale=1.0"/><meta property="twitter:account_id" content="4503599630178231"/><link rel="icon" type="image/png" href="http://img.yegor256.com/icon-128x128.png"><link rel="shortcut icon" href="//img.yegor256.com/icon-128x128.png"/><link rel="alternate" type="application/rss+xml" title="RSS" href="http://www.yegor256.com/rss.xml"/><link rel="author" href="//plus.google.com/u/0/114792568016408327418?rel=author"/><link rel="stylesheet" href="/css/layout.css?d8951bc"/><link rel="canonical" href="http://www.yegor256.com/2014/07/20/liquibase-in-maven.html"/> <script src="/js/search.min.js?d8951bc"></script><script src="/js/all.js?d8951bc"></script><title>Liquibase with Maven</title></head><body><div class="wrapper"> <header class="header"><div> <a href="/about-me.html"> <img src="//img.yegor256.com/yegor-bugayenko.jpg" class="photo" alt="photo"/> </a></div> <nav role="navigation"><ul class="menu"><li><a href="/" title="home page"><i class="ico ico-home"></i></a></li><li><a href="http://www.twitter.com/yegor256" title="follow me in Twitter"><i class="ico ico-tweet"></i></a></li><li><a href="/rss" title="RSS feed"><i class="ico ico-rss"></i></a></li><li><a href="https://github.com/yegor256" title="my Github profile"><i class="ico ico-x-github"></i></a></li><li><a href="http://stackoverflow.com/users/187141/yegor256" title="my StackOverflow profile"><i class="ico ico-x-stackoverflow"></i></a></li><li><a href="https://www.facebook.com/yegor.bugayenko" title="follow me in Facebook"><i class="ico ico-x-facebook"></i></a></li><li><a href="https://plus.google.com/+YegorBugayenko/posts" title="follow me in Google+"><i class="ico ico-x-google"></i></a></li><li><a href="https://www.linkedin.com/in/yegor256" title="my LinkedIn profile"><i class="ico ico-x-linkedin"></i></a></li><li><a href="mailto:yegor@teamed.io" title="yegor@teamed.io"><i class="ico ico-email"></i></a></li></ul> </nav><div id="search"> <input id="search-query" class="field field-text" name="q" placeholder="Search" autocomplete="off"/><div id="search-results" style="display:none"><div class="entries"></div></div></div> <script id="search-results-template" type="text/mustache">
          {{#entries}}
            <div>
              <a href="{{url}}">{{title}}</a>
            </div>
          {{/entries}}
        </script></header></div> <section itemscope itemtype="http://schema.org/BlogPosting"><div class="wrapper"> <header><h1 itemprop="name">Liquibase with Maven</h1> </header><p> <time itemprop="datePublished" datetime="2014-07-20T00:00:00+00:00"> 20 July 2014 </time></p><div class="buttons"> <nav class="share" role="navigation"> <a href="http://www.facebook.com/sharer/sharer.php?u=http://www.yegor256.com/2014/07/20/liquibase-in-maven.html" title="Share on Facebook" class="button"> <i class="ico ico-facebook"></i> </a> <a href="https://twitter.com/share?url=http://www.yegor256.com/2014/07/20/liquibase-in-maven.html&amp;text=Liquibase+with+Maven" title="Share on Twitter" class="button"> <i class="ico ico-twitter"></i> </a> <a href="https://plus.google.com/share?url=http://www.yegor256.com/2014/07/20/liquibase-in-maven.html" title="Share on Google+" class="button"> <i class="ico ico-google"></i> </a> <a href="https://www.linkedin.com/cws/share?url=http://www.yegor256.com/2014/07/20/liquibase-in-maven.html" title="Share on LinkedIn" class="button"> <i class="ico ico-linkedin"></i> </a> </nav></div> <main role="main"> <article role="article" itemprop="articleBody"><p><a href="http://www.liquibase.org">Liquibase</a> is a migration management tool for relational databases. It versionalizes schema and data changes in a database; similar to the way Git or SVN works for source code. Thanks to their <a href="http://www.liquibase.org/documentation/maven/">Maven plugin</a>, Liquibase can be used as a part of a build automation scenario.</p><h2 id="maven-plugin">Maven Plugin</h2><p>Let's assume you're using MySQL (PostgreSQL or any other database configuration will be very similar.)</p><p>Add <code>liquibase-maven-plugin</code> to your <a href="http://maven.apache.org/pom.html"><code>pom.xml</code></a> (get its latest version in <a href="http://search.maven.org/">Maven Central</a>):</p><div class="highlight"><pre><code class="language-xml" data-lang="xml"><span class="nt">&lt;project&gt;</span>
  [...]
  <span class="nt">&lt;build&gt;</span>
    [...]
    <span class="nt">&lt;plugins&gt;</span>
      <span class="nt">&lt;plugin&gt;</span>
        <span class="nt">&lt;groupId&gt;</span>org.liquibase<span class="nt">&lt;/groupId&gt;</span>
        <span class="nt">&lt;artifactId&gt;</span>liquibase-maven-plugin<span class="nt">&lt;/artifactId&gt;</span>
        <span class="nt">&lt;configuration&gt;</span>
          <span class="nt">&lt;changeLogFile&gt;</span>${basedir}/src/main/liquibase/master.xml<span class="nt">&lt;/changeLogFile&gt;</span>
          <span class="nt">&lt;driver&gt;</span>com.mysql.jdbc.Driver<span class="nt">&lt;/driver&gt;</span>
          <span class="nt">&lt;url&gt;</span>jdbc:mysql://${mysql.host}:${mysql.port}/${mysql.db}<span class="nt">&lt;/url&gt;</span>
          <span class="nt">&lt;username&gt;</span>${mysql.login}<span class="nt">&lt;/username&gt;</span>
          <span class="nt">&lt;password&gt;</span>${mysql.password}<span class="nt">&lt;/password&gt;</span>
        <span class="nt">&lt;/configuration&gt;</span>
      <span class="nt">&lt;/plugin&gt;</span>
    <span class="nt">&lt;/plugins&gt;</span>
  <span class="nt">&lt;/build&gt;</span>
<span class="nt">&lt;/project&gt;</span></code></pre></div><p>To check that it works, run <code>mvn liquibase:help</code>.</p><p>I would recommend you keep database credentials in <a href="http://maven.apache.org/settings.html"><code>settings.xml</code></a> and in their respective profiles. For example:</p><div class="highlight"><pre><code class="language-xml" data-lang="xml"><span class="nt">&lt;settings&gt;</span>
  <span class="nt">&lt;profiles&gt;</span>
    <span class="nt">&lt;profile&gt;</span>
      <span class="nt">&lt;id&gt;</span>production<span class="nt">&lt;/id&gt;</span>
      <span class="nt">&lt;properties&gt;</span>
        <span class="nt">&lt;mysql.host&gt;</span>db.example.com<span class="nt">&lt;/mysql.host&gt;</span>
        <span class="nt">&lt;mysql.port&gt;</span>3306<span class="nt">&lt;/mysql.port&gt;</span>
        <span class="nt">&lt;mysql.db&gt;</span>example<span class="nt">&lt;/mysql.db&gt;</span>
      <span class="nt">&lt;/properties&gt;</span>
    <span class="nt">&lt;/profile&gt;</span>
    <span class="nt">&lt;profile&gt;</span>
      <span class="nt">&lt;id&gt;</span>test<span class="nt">&lt;/id&gt;</span>
      <span class="nt">&lt;properties&gt;</span>
        <span class="nt">&lt;mysql.host&gt;</span>test-db.example.com<span class="nt">&lt;/mysql.host&gt;</span>
        <span class="nt">&lt;mysql.port&gt;</span>3306<span class="nt">&lt;/mysql.port&gt;</span>
        <span class="nt">&lt;mysql.db&gt;</span>example-db<span class="nt">&lt;/mysql.db&gt;</span>
      <span class="nt">&lt;/properties&gt;</span>
    <span class="nt">&lt;/profile&gt;</span>
  <span class="nt">&lt;/profiles&gt;</span>
<span class="nt">&lt;/settings&gt;</span></code></pre></div><p>When you run Maven, don't forget to turn on one of the profiles. For example: <code>mvn -Pproduction</code>.</p><h2 id="initial-schema">Initial Schema</h2><p>I assume you already have a database with a schema (tables, triggers, views, etc.) and some data. You should "reverse engineer" it and create an initial schema file for Liquibase. In other words, we should inform Liquibase where we are at the moment, so that it starts to apply changes from this point.</p><p>Maven plugin doesn't support it, so you will have to run Liquibase directly. But, it's not that difficult. First, run <code>mvn liquibase:help</code> in order to download all artifacts. Then, replace placeholders with your actual credentials:</p><div class="highlight"><pre><code class="language-bash" data-lang="bash"><span class="nv">$ </span>java -jar ~/.m2/repository/org/liquibase/liquibase-core/3.1.1/liquibase-core-3.1.1.jar <span class="se">\</span>
  --driver<span class="o">=</span>com.mysql.jdbc.Driver <span class="se">\</span>
  --url<span class="o">=</span>jdbc:mysql://db.example.com:3306/example <span class="se">\</span>
  --username<span class="o">=</span>example --password<span class="o">=</span>example <span class="se">\</span>
  generateChangeLog &gt; src/main/liquibase/000-initial-schema.xml</code></pre></div><p>Liquibase will analyze your current database schema and copy its own schema into <code>src/main/liquibase/000-initial-schema.xml</code>.</p><h2 id="master-changeset">Master Changeset</h2><p>Now, create XML master changeset and save it to <code>src/main/liquibase/master.xml</code>:</p><div class="highlight"><pre><code class="language-xml" data-lang="xml"><span class="nt">&lt;databaseChangeLog</span>
  <span class="na">xmlns=</span><span class="s">"http://www.liquibase.org/xml/ns/dbchangelog"</span>
  <span class="na">xmlns:xsi=</span><span class="s">"http://www.w3.org/2001/XMLSchema-instance"</span>
  <span class="na">xsi:schemaLocation=</span><span class="s">"http://www.liquibase.org/xml/ns/dbchangelog http://www.liquibase.org/xml/ns/dbchangelog/dbchangelog-2.0.xsd"</span><span class="nt">&gt;</span>
  <span class="nt">&lt;includeAll</span> <span class="na">path=</span><span class="s">"src/main/liquibase"</span> <span class="nt">/&gt;</span>
<span class="nt">&lt;/databaseChangeLog&gt;</span></code></pre></div><p>It is an entry point for Liquibase. It starts from this file and loads all other changesets available in <code>src/main/liquibase</code>. They should be either <code>.xml</code> or <code>.sql</code>. I recommend that you use XML mostly because it is easier to maintain and works faster.</p><h2 id="incremental-changesets">Incremental Changesets</h2><p>Let's create a simple changeset, which adds a new column to an existing table:</p><div class="highlight"><pre><code class="language-xml" data-lang="xml"><span class="nt">&lt;databaseChangeLog</span> <span class="na">xmlns=</span><span class="s">'http://www.liquibase.org/xml/ns/dbchangelog'</span>
  <span class="na">xmlns:xsi=</span><span class="s">'http://www.w3.org/2001/XMLSchema-instance'</span>
  <span class="na">xsi:schemaLocation=</span><span class="s">'http://www.liquibase.org/xml/ns/dbchangelog http://www.liquibase.org/xml/ns/dbchangelog/dbchangelog-2.0.xsd'</span><span class="nt">&gt;</span>
  <span class="nt">&lt;changeSet</span> <span class="na">id=</span><span class="s">"002"</span> <span class="na">author=</span><span class="s">"Yegor"</span><span class="nt">&gt;</span>
    <span class="nt">&lt;sql&gt;</span>
      ALTER TABLE user ADD COLUMN address VARCHAR(1024);
    <span class="nt">&lt;/sql&gt;</span>
  <span class="nt">&lt;/changeSet&gt;</span>
<span class="nt">&lt;/databaseChangeLog&gt;</span></code></pre></div><p>We save this file we in <code>src/main/liquibase/002-add-user-address.xml</code>. In big projects, you can name your files by the names of the tickets they are produced in. For example, <code>045-3432.xml</code>, which means changeset number 45 coming from ticket #3432.</p><p>The important thing is to have this numeric prefix in front of file names, in order to sort them correctly. We want changes to be applied in their correct chronological order.</p><p>That's it. We're ready to run <code>mvn liquibase:update -Pproduction</code> and our production database will be updated — a new column will be added to the <code>user</code> table.</p><p>Also, see how <a href="/2014/05/21/mysql-maven-plugin.html">MySQL Maven Plugin</a> can help you to automate integration testing of database-connected classes.</p></article> </main><h2>Related Posts</h2><p>You may also find these posts interesting:</p><ul><li><a href="/2014/05/21/mysql-maven-plugin.html">MySQL Maven Plugin</a></li><li><a href="/2014/06/21/casperjs-with-maven.html">CasperJS Tests in Maven Build</a></li><li><a href="/2014/05/01/dynamodb-local-maven-plugin.html">DynamoDB Local Maven Plugin</a></li><li><a href="/2014/08/03/cacheable-java-annotation.html">Cache Java Method Results</a></li><li><a href="/2014/07/03/how-to-read-manifest-mf.html">How to Read MANIFEST.MF Files</a></li></ul></div><div class="disqus" role="complementary"><div id="disqus_thread"></div> <noscript> Please enable JavaScript to view the <a href="http://disqus.com/?ref_noscript">comments powered by Disqus.</a> </noscript> <a href="http://disqus.com" class="dsq-brlink"> comments powered by <span class="logo-disqus">Disqus</span> </a></div><div class="wrapper"> <footer class="footer"><p> © <span itemprop="author">Yegor Bugayenko</span>, 2014</p> </footer></div></section></body></html>