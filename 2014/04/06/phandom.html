<!DOCTYPE html><html xmlns="http://www.w3.org/1999/xhtml" lang="en-US"><head><meta charset="utf-8"/><meta name="description" content="I created Phandom Java library for generating DOM through Phantomjs, this article explains the rationale and the basic use case"/><meta name="keywords" content="DOM with phantomjs, github phantomjs, java, phandom, phantomjs, phantomjs unit tests"/><meta name="viewport" content="width=device-width, initial-scale=1.0"/><meta property="twitter:account_id" content="4503599630178231"/><link rel="search" type="application/opensearchdescription+xml" href="opensearch.xml" title="yegor256"/><link rel="shortcut icon" href="/favicon.ico?9fab46c"/><link rel="alternate" type="application/rss+xml" title="RSS for yegor256.com" href="http://www.yegor256.com/rss.xml"/><link rel="author" href="http://plus.google.com/u/0/114792568016408327418?rel=author"/><link rel="stylesheet" href="/css/layout.css?9fab46c"/><link rel="stylesheet" href="//img.teamed.io/yegor256/icons.css?9fab46c"/><link rel="canonical" href="http://www.yegor256.com/2014/04/06/phandom.html"/><title>PhantomJS as an HTML Validator - Yegor Bugayenko</title></head><body><div class="wrapper"> <header class="header"><div> <a href="/about-me.html"> <img src="/images/yegor-bugayenko.png" class="photo" alt="photo"/> </a></div> <nav role="navigation"><ul class="menu social notranslate"><li><a href="http://www.twitter.com/yegor256" title="follow me in Twitter"><i class="icon icon-twitter notranslate" aria-hidden="true"></i></a></li><li><a href="/rss" title="RSS feed"><i class="icon icon-rss notranslate" aria-hidden="true"></i></a></li><li><a href="https://github.com/yegor256" title="my Github profile"><i class="icon icon-github notranslate" aria-hidden="true"></i></a></li><li><a href="http://stackoverflow.com/users/187141/yegor256" title="my StackOverflow profile"><i class="icon icon-stackoverflow notranslate" aria-hidden="true"></i></a></li><li><a href="https://www.facebook.com/yegor.bugayenko" title="follow me in Facebook"><i class="icon icon-facebook notranslate" aria-hidden="true"></i></a></li><li><a href="https://plus.google.com/+YegorBugayenko/posts" title="follow me in Google+"><i class="icon icon-googleplus notranslate" aria-hidden="true"></i></a></li><li><a href="https://www.linkedin.com/in/yegor256" title="my LinkedIn profile"><i class="icon icon-linkedin notranslate" aria-hidden="true"></i></a></li><li><a href="http://www.youtube.com/user/yegor256a" title="my Youtube video channel"><i class="icon icon-youtube notranslate" aria-hidden="true"></i></a></li><li><a href="mailto:yegor@teamed.io" title="yegor@teamed.io"><i class="icon icon-mail notranslate" aria-hidden="true"></i></a></li></ul><ul class="menu"><li> <a href="/best.html" title="best articles to read">12 best articles</a> · <a href="/contents.html" title="blog contents">all 107</a> · <a href="/" title="home page">home page</a></li></ul> </nav><div id="search"> <input id="search-query" class="field field-text" name="q" placeholder="Search" autocomplete="off"/><div id="search-results" style="display:none"><div class="entries"></div></div></div><div style="color:#b82f2f;text-align:left;margin:2em 0;width:75%"> <img src="/images/2015/04/webinar.jpg" style="width:64px;height:64px;float:left;margin-right:1em" alt="webinar logo"/> Hey, don't miss my <a href="https://plus.google.com/events/c5mesunno48ol40p5101sufnfm0"><strong>first webinar</strong></a> on the 8th of April, at 11am PST; it will take one hour and we'll talk about <a href="https://plus.google.com/events/c5mesunno48ol40p5101sufnfm0">"Objects vs. Static Methods"</a>.</div> <script id="search-results-template" type="text/mustache">
          {{#entries}}
            <div>
              <a href="{{url}}">{{title}}</a>
            </div>
          {{/entries}}
        </script></header></div> <section itemscope itemtype="http://schema.org/BlogPosting"><div class="wrapper"> <header><p class="printable"> <code>http://www.yegor256.com/2014/04/06/phandom.html</code></p><h1 itemprop="name">PhantomJS as an HTML Validator</h1><ul class="subline"><li> <time itemprop="datePublished" datetime="2014-04-06T00:00:00+00:00"> 6 April 2014 </time></li><li><a href='https://github.com/yegor256/blog/commits/master/_posts/2014/apr/2014-04-06-phandom.md'>modified</a> on <time itemprop='dateModified' datetime='2014-11-07T19:22:56+0000'>7 November 2014</time></li><li class="printable">Yegor Bugayenko</li><li class="unprintable"> <i class="icon icon-comments"></i> <a href="http://www.yegor256.com/2014/04/06/phandom.html#disqus_thread">comments</a></li></ul><p class="unprintable"><a href='/tag/phandom.html' class='tag notranslate'>phandom</a> <a href='/tag/phantomjs.html' class='tag notranslate'>phantomjs</a> <a href='/tag/testing.html' class='tag notranslate'>testing</a></p><div class="buttons notranslate desktop-only"> <nav class="share" role="navigation"> <a href="http://www.facebook.com/sharer/sharer.php?u=http://www.yegor256.com/2014/04/06/phandom.html" title="Share on Facebook" class="button"> <span class="count count-facebook">0</span> <i class="icon icon-facebook notranslate" aria-hidden="true"></i> </a> <a href="https://twitter.com/share?url=http://www.yegor256.com/2014/04/06/phandom.html&amp;text=PhantomJS+as+an+HTML+Validator" title="Share on Twitter" class="button"> <span class="count count-twitter">0</span> <i class="icon icon-twitter notranslate" aria-hidden="true"></i> </a> <a href="https://plus.google.com/share?url=http://www.yegor256.com/2014/04/06/phandom.html" title="Share on Google+" class="button"> <span class="count count-googleplus">0</span> <i class="icon icon-googleplus notranslate" aria-hidden="true"></i> </a> <a href="https://www.linkedin.com/cws/share?url=http://www.yegor256.com/2014/04/06/phandom.html" title="Share on LinkedIn" class="button"> <span class="count count-linkedin">0</span> <i class="icon icon-linkedin notranslate" aria-hidden="true"></i> </a> <a href="http://www.stumbleupon.com/submit?url=http://www.yegor256.com/2014/04/06/phandom.html&amp;title=PhantomJS+as+an+HTML+Validator" title="Share on StumbleUpon" class="button"> <span class="count count-stumbleupon">0</span> <i class="icon icon-stumbleupon notranslate" aria-hidden="true"></i> </a> <a href="http://reddit.com/submit?url=http://www.yegor256.com/2014/04/06/phandom.html%3F2014-14&amp;title=PhantomJS+as+an+HTML+Validator" title="Share on Reddit" class="button"> <span class="count count-reddit">0</span> <i class="icon icon-reddit notranslate" aria-hidden="true"></i> </a> <a href="http://news.ycombinator.com/submitlink?u=http://www.yegor256.com/2014/04/06/phandom.html%3F2014-14&amp;t=PhantomJS+as+an+HTML+Validator" title="Share on Hacker News" class="button"> <i class="icon icon-hackernews notranslate" aria-hidden="true"></i> </a> </nav></div> </header> <main role="main"> <article class="main" role="article" itemprop="articleBody"> <figure class='badge'><a href='http://www.phandom.org'><img src='http://img.phandom.org/logo-256x256.png' style='width:64px' alt='badge'/></a></figure><p>I created <a href="http://www.phandom.org">phandom.org</a> a few months ago, but yesterday finally found the time to make some needed changes to it. So, now is a good time to explain how I'm using Phandom in some of my unit tests.</p><p>Before I get started, though, I should say a few words about <a href="http://phantomjs.org/">phantomjs</a>, which is a JavaScript interface for WebKit. WebKit, on the other hand, is a web browser without a user interface. WebKit is a C++ library that enables manipulation of HTML content, through DOM calls. For example, this is a simple JavaScript located code in <code>example.js</code>:</p><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><code class="language-javascript" data-lang="javascript">1
2
3
4
5
6
7
8</code></pre></div></td><td class="code"><div class="highlight"><pre><span class="kd">var</span> <span class="nx">page</span> <span class="o">=</span> <span class="nx">require</span><span class="p">(</span><span class="s1">'webpage'</span><span class="p">).</span><span class="nx">create</span><span class="p">();</span>
<span class="nx">page</span><span class="p">.</span><span class="nx">open</span><span class="p">(</span>
  <span class="s1">'http://google.com'</span><span class="p">,</span>
  <span class="kd">function</span><span class="p">()</span> <span class="p">{</span>
    <span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="s1">'loaded!'</span><span class="p">);</span>
    <span class="nx">phantom</span><span class="p">.</span><span class="nx">exit</span><span class="p">(</span><span class="mi">0</span><span class="p">);</span>
  <span class="p">}</span>
<span class="p">);</span></pre></div></td></tr></table><p>We run phantomjs from the command line with the following code:</p><div class="highlight"><pre><code class="language-bash" data-lang="bash"><span class="nv">$ </span>phantomjs example.js</code></pre></div><p>Phantomjs creates a <code>page</code> object (provided by <a href="https://github.com/ariya/phantomjs/wiki/API-Reference-WebPage">webpage</a> module inside phantomjs), and then asks it to <code>open()</code> a Web page. The object communicates with WebKit and converts this call into DOM instructions. After which, the page loads. The phantomjs engine then terminates on line 6.</p><p>WebKit renders a web page with all neccessary components such as CSS, JavaScript, ActionScript, etc, just as any standard Web browser would.</p><p>So far so good, and this is the traditional way of using phantomjs. Now, on to giving you an idea of how <a href="http://www.phandom.org">Phandom</a> (which stands for "PhantomJS DOM") works inside Java unit tests:</p><p>To test this, let's give <code>phantomjs</code> an HTML page and ask him to render it. When the page is ready, we'll ask phantomjs to show us how this HTML looks in WebKit. If we see the elements we need and desire, — we're good to go. Let's use the following example:</p><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><code class="language-java" data-lang="java"> 1
 2
 3
 4
 5
 6
 7
 8
 9
10
11
12
13
14
15
16
17</code></pre></div></td><td class="code"><div class="highlight"><pre><span class="kn">import</span> <span class="nn">com.rexsl.test.XhtmlMatchers</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">org.hamcrest.MatcherAssert</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">org.phandom.Phandom</span><span class="o">;</span>
<span class="kd">public</span> <span class="kd">class</span> <span class="nc">DocumentTest</span> <span class="o">{</span>
  <span class="nd">@Test</span>
  <span class="kd">public</span> <span class="kt">void</span> <span class="nf">rendersValidHtml</span><span class="o">()</span> <span class="o">{</span>
    <span class="n">Document</span> <span class="n">doc</span> <span class="o">=</span> <span class="k">new</span> <span class="nf">Document</span><span class="o">();</span>
    <span class="c1">// This is the method we're testing. It is supposed</span>
    <span class="c1">// to return a valid HTML without broken JavaScript</span>
    <span class="c1">// and with all required HTML elements.</span>
    <span class="n">String</span> <span class="n">html</span> <span class="o">=</span> <span class="n">doc</span><span class="o">.</span><span class="na">html</span><span class="o">();</span>
    <span class="n">MatcherAssert</span><span class="o">.</span><span class="na">assertThat</span><span class="o">(</span>
      <span class="n">XhtmlMatchers</span><span class="o">.</span><span class="na">xhtml</span><span class="o">(</span><span class="k">new</span> <span class="nf">Phandom</span><span class="o">(</span><span class="n">html</span><span class="o">).</span><span class="na">dom</span><span class="o">()),</span>
      <span class="n">XhtmlMatchers</span><span class="o">.</span><span class="na">hasXPath</span><span class="o">(</span><span class="s">"//p[.='Hello, world!']"</span><span class="o">)</span>
    <span class="o">);</span>
  <span class="o">}</span>
<span class="o">}</span></pre></div></td></tr></table><p>When we use the above code, here is what happens. First, we get HTML <code>html</code> as a <code>String</code> from <code>doc</code> object, and then pass it to <a href="http://www.phandom.org/apidocs-0.2.1/org/phandom/Phandom.html"><code>Phandom</code></a> as an argument. Then, on line 13, we call the <code>Phandom.dom()</code> method to get an instance of the class <code>org.w3c.dom.Document</code>.</p><p>If our HTML contains any broken JavaScript code, method <code>dom()</code> produces a runtime exception and the unit test faila. If HTML is clean and WebKit is able to render it without problems, the test passes.</p><p>I'm using this mechanism in a few different projects,and it works quite well. Therefore, I highly recommend it.</p><p>Of course, you shouldn't forget that you must have phantomjs installed on your build machine. In order to avoid unit test failures when phantomjs is not available or present, I've created the following supplementary method:</p><div class="highlight"><pre><code class="language-java" data-lang="java"><span class="kd">public</span> <span class="kd">class</span> <span class="nc">DocumentTest</span> <span class="o">{</span>
  <span class="nd">@Test</span>
  <span class="kd">public</span> <span class="kt">void</span> <span class="nf">rendersValidHtml</span><span class="o">()</span> <span class="o">{</span>
    <span class="n">Assume</span><span class="o">.</span><span class="na">assumeTrue</span><span class="o">(</span><span class="n">Phandom</span><span class="o">.</span><span class="na">installed</span><span class="o">());</span>
    <span class="c1">// the rest of the unit test method body...</span>
  <span class="o">}</span>
<span class="o">}</span></code></pre></div><p>Enjoy and feel free to report any bugs or problems you encounter to: <a href="https://github.com/yegor256/phandom/issues">Github issues</a> :)</p></article> </main><div class="unprintable"><h2>Related Posts</h2><p>You may also find these posts interesting:</p><ul><li><a href="/2014/06/21/casperjs-with-maven.html">CasperJS Tests in Maven Build</a></li><li><a href="/2014/09/23/built-in-fake-objects.html">Built-in Fake Objects</a></li><li><a href="/2014/08/22/art-of-software-testing.html">The Art of Software Testing by Glenford Myers</a></li><li><a href="/2014/04/28/xml-xpath-hamcrest-matchers.html">XML/XPath Matchers for Hamcrest</a></li><li><a href="/2014/04/13/bugs-are-welcome.html">Bugs Are Welcome</a></li></ul></div></div><div class="disqus" role="complementary"><div id="disqus_thread"></div> <a href="http://disqus.com" class="dsq-brlink"> comments powered by <span class="logo-disqus">Disqus</span> </a></div><div class="wrapper"> <footer class="footer"><p> © <span itemprop="author">Yegor Bugayenko</span>, 2014</p> </footer></div></section><script src="http://code.jquery.com/jquery-2.1.0.min.js"></script><script src="/js/ext/search.min.js?9fab46c"></script><script src="/js/global.js?9fab46c" async defer></script><script src="/js/post.js?9fab46c" async defer></script></body></html>