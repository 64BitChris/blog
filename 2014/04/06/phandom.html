<!DOCTYPE html><html><head><link rel="icon" type="image/gif" href="http://img.yegor256.com/icon-64x64.png"><link rel="shortcut icon" href="http://img.yegor256.com/icon-64x64.png"/><link rel="alternate" type="application/rss+xml" title="RSS" href="http://www.yegor256.com/rss.xml"/><link rel="author" href="https://plus.google.com/u/0/114792568016408327418?rel=author"/><link href="http://netdna.bootstrapcdn.com/font-awesome/4.0.3/css/font-awesome.css" rel="stylesheet"><meta charset="utf-8"/><meta name="description" content="I created Phandom Java library for generating DOM through Phantomjs"/><meta name="keywords" content="phantomjs, DOM with phantomjs, phandom, github phantomjs, phantomjs unit tests, java"/><meta name="viewport" content="width=device-width"/><link rel="stylesheet" href="/css/layout.css?a7aaaa3"/><title>Phantomjs as an HTML Validator</title></head><body><div class="wrapper"> <section class="content"> <nav class="top"> <a class="item" href="/">home</a> <a class="item" href="/about-me.html">about me</a> <a class="item" href="http://feeds.feedburner.com/yegor256"><i class="fa fa-rss"></i></a> <a class="item" href="http://feedburner.google.com/fb/a/mailverify?uri=yegor256&amp;loc=en_US">subscribe</a><div class="gcse"> <script>!function(){var t="012237142075217162703:vly1vck9bom",e=document.createElement("script");e.type="text/javascript",e.async=!0,e.src=("https:"==document.location.protocol?"https:":"http:")+"//www.google.com/cse/cse.js?cx="+t;var c=document.getElementsByTagName("script")[0];c.parentNode.insertBefore(e,c)}()</script><gcse:search></gcse:search></div> </nav> <header><h1>Phantomjs as an HTML Validator</h1> </header> <section><p> <time itemprop="dateCreated" datetime="2014-04-06T00:00:00+00:00"> 6 April 2014 </time></p> <nav class="share"> <a target="_blank" onclick="return !window.open(this.href, 'Facebook', 'width=640,height=300')" href="http://www.facebook.com/sharer/sharer.php?u=http://www.yegor256.com/2014/04/06/phandom.html"><i class="fa fa-facebook-square"></i></a> <a target="_blank" onclick="return !window.open(this.href, 'Twitter', 'width=640,height=300')" href="https://twitter.com/share?url=http://www.yegor256.com/2014/04/06/phandom.html&amp;text=Phantomjs+as+an+HTML+Validator"><i class="fa fa-twitter-square"></i></a> <a target="_blank" onclick="return !window.open(this.href, 'Google+', 'width=640,height=300')" href="https://plus.google.com/share?url=http://www.yegor256.com/2014/04/06/phandom.html"><i class="fa fa-google-plus-square"></i></a> <a class="share" target="_blank" onclick="return !window.open(this.href, 'LinkenIn', 'width=640,height=300')" href="https://www.linkedin.com/cws/share?url=http://www.yegor256.com/2014/04/06/phandom.html"><i class="fa fa-linkedin-square"></i></a> </nav> <main> <article role="article" itemtype="http://schema.org/BlogPosting"> <figure class='badge'><img src='http://img.phandom.org/logo.png' style='width:64px' alt='badge'/></figure><p>I created <a href="http://www.phandom.org">phandom.org</a> a few months ago, but yesterday finally found the time to make some needed changes to it. So, now is a good time to explain how I'm using Phandom in some of my unit tests.</p><p>Before I get started, though, I should say a few words about <a href="http://phantomjs.org/">phantomjs</a>, which is a JavaScript interface for WebKit. WebKit, on the other hand, is a web browser without a user interface. WebKit is a C++ library that enables manipulation of HTML content, through DOM calls. For example, this is a simple JavaScript located code in <code>example.js</code>:</p><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><code class="javascript">1
2
3
4
5
6
7
8</code></pre></div></td><td class="code"><div class="highlight"><pre><span class="kd">var</span> <span class="nx">page</span> <span class="o">=</span> <span class="nx">require</span><span class="p">(</span><span class="s1">'webpage'</span><span class="p">).</span><span class="nx">create</span><span class="p">();</span>
<span class="nx">page</span><span class="p">.</span><span class="nx">open</span><span class="p">(</span>
  <span class="s1">'http://google.com'</span><span class="p">,</span>
  <span class="kd">function</span><span class="p">()</span> <span class="p">{</span>
    <span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="s1">'loaded!'</span><span class="p">);</span>
    <span class="nx">phantom</span><span class="p">.</span><span class="nx">exit</span><span class="p">(</span><span class="mi">0</span><span class="p">);</span>
  <span class="p">}</span>
<span class="p">);</span></pre></div></td></tr></table><p>We run phantomjs from the command line with the following code:</p><div class="highlight"><pre><code class="bash"><span class="nv">$ </span>phantomjs example.js
</code></pre></div><p>Phantomjs creates a <code>page</code> object (provided by <a href="https://github.com/ariya/phantomjs/wiki/API-Reference-WebPage">webpage</a> module inside phantomjs), and then asks it to <code>open()</code> a Web page. The object communicates with WebKit and converts this call into DOM instructions. After which, the page loads. The phantomjs engine then terminates on line 6.</p><p>WebKit renders a web page with all neccessary components such as CSS, JavaScript, ActionScript, etc, just as any standard Web browser would.</p><p>So far so good, and this is the traditional way of using phantomjs. Now, on to giving you an idea of how <a href="http://www.phandom.org">Phandom</a> (which stands for "PhantomJS DOM") works inside Java unit tests:</p><p>To test this, let's give <code>phantomjs</code> an HTML page and ask him to render it. When the page is ready, we'll ask phantomjs to show us how this HTML looks in WebKit. If we see the elements we need and desire, â€” we're good to go. Let's use the following example:</p><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><code class="java"> 1
 2
 3
 4
 5
 6
 7
 8
 9
10
11
12
13
14
15
16
17</code></pre></div></td><td class="code"><div class="highlight"><pre><span class="kn">import</span> <span class="nn">com.rexsl.test.XhtmlMatchers</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">org.hamcrest.MatcherAssert</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">org.phandom.Phandom</span><span class="o">;</span>
<span class="kd">public</span> <span class="kd">final</span> <span class="kd">class</span> <span class="nc">DocumentTest</span> <span class="o">{</span>
  <span class="nd">@Test</span>
  <span class="kd">public</span> <span class="kt">void</span> <span class="nf">rendersValidHtml</span><span class="o">()</span> <span class="o">{</span>
    <span class="kd">final</span> <span class="n">Document</span> <span class="n">doc</span> <span class="o">=</span> <span class="k">new</span> <span class="n">Document</span><span class="o">();</span>
    <span class="c1">// This is the method we're testing. It is supposed</span>
    <span class="c1">// to return a valid HTML without broken JavaScript</span>
    <span class="c1">// and with all required HTML elements.</span>
    <span class="kd">final</span> <span class="n">String</span> <span class="n">html</span> <span class="o">=</span> <span class="n">doc</span><span class="o">.</span><span class="na">html</span><span class="o">();</span>
    <span class="n">MatcherAssert</span><span class="o">.</span><span class="na">assertThat</span><span class="o">(</span>
      <span class="n">XhtmlMatchers</span><span class="o">.</span><span class="na">xhtml</span><span class="o">(</span><span class="k">new</span> <span class="n">Phandom</span><span class="o">(</span><span class="n">html</span><span class="o">).</span><span class="na">dom</span><span class="o">()),</span>
      <span class="n">XhtmlMatchers</span><span class="o">.</span><span class="na">hasXPath</span><span class="o">(</span><span class="s">"//p[.='Hello, world!']"</span><span class="o">)</span>
    <span class="o">);</span>
  <span class="o">}</span>
<span class="o">}</span></pre></div></td></tr></table><p>When we use the above code, here is what happens. First, we get HTML <code>html</code> as a <code>String</code> from <code>doc</code> object, and then pass it to <a href="http://www.phandom.org/apidocs-0.2.1/org/phandom/Phandom.html"><code>Phandom</code></a> as an argument. Then, on line 13, we call the <code>Phandom.dom()</code> method to get an instance of the class <code>org.w3c.dom.Document</code>.</p><p>If our HTML contains any broken JavaScript code, method <code>dom()</code> produces a runtime exception and the unit test faila. If HTML is clean and WebKit is able to render it without problems, the test passes.</p><p>I'm using this mechanism in a few different projects,and it works quite well. Therefore, I highly recommend it.</p><p>Of course, you shouldn't forget that you must have phantomjs installed on your build machine. In order to avoid unit test failures when phantomjs is not available or present, I've created the following supplementary method:</p><div class="highlight"><pre><code class="java"><span class="kd">public</span> <span class="kd">final</span> <span class="kd">class</span> <span class="nc">DocumentTest</span> <span class="o">{</span>
  <span class="nd">@Test</span>
  <span class="kd">public</span> <span class="kt">void</span> <span class="nf">rendersValidHtml</span><span class="o">()</span> <span class="o">{</span>
    <span class="n">Assume</span><span class="o">.</span><span class="na">assumeTrue</span><span class="o">(</span><span class="n">Phandom</span><span class="o">.</span><span class="na">installed</span><span class="o">());</span>
    <span class="c1">// the rest of the unit test method body...</span>
  <span class="o">}</span>
<span class="o">}</span>
</code></pre></div><p>Enjoy and feel free to report any bugs or problems you encounter to: <a href="https://github.com/yegor256/phandom/issues">Github issues</a> :)</p></article> </main><div id="disqus_thread"></div> <script>var disqus_shortname="yegor256";!function(){var e=document.createElement("script");e.type="text/javascript",e.async=!0,e.src="//"+disqus_shortname+".disqus.com/embed.js",(document.getElementsByTagName("head")[0]||document.getElementsByTagName("body")[0]).appendChild(e)}()</script><noscript>Please enable JavaScript to view the <a href="http://disqus.com/?ref_noscript">comments powered by Disqus.</a></noscript> <a href="http://disqus.com" class="dsq-brlink">comments powered by <span class="logo-disqus">Disqus</span></a> </section></section></div> <script>var _gaq=_gaq||[];_gaq.push(["_setAccount","UA-1963507-32"]),_gaq.push(["_trackPageview"]),function(){var t=document.createElement("script");t.type="text/javascript",t.async=!0,t.src=("https:"==document.location.protocol?"https://ssl":"http://www")+".google-analytics.com/ga.js";var e=document.getElementsByTagName("script")[0];e.parentNode.insertBefore(t,e)}()</script><script>var disqus_shortname="yegor256";!function(){var e=document.createElement("script");e.async=!0,e.type="text/javascript",e.src="//"+disqus_shortname+".disqus.com/count.js",(document.getElementsByTagName("HEAD")[0]||document.getElementsByTagName("BODY")[0]).appendChild(e)}()</script></body></html>