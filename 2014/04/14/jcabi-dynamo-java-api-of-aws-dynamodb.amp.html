<!DOCTYPE html>
<html âš¡ lang="en">
  <head>
    <meta charset="utf-8">
    <title>Object-Oriented DynamoDB API</title>
    <link rel="canonical" href="http://www.yegor256.com/2014/04/14/jcabi-dynamo-java-api-of-aws-dynamodb.html" />
    <meta name="viewport" content="width=device-width,minimum-scale=1,initial-scale=1">
    <script type='application/ld+json'>
      {
        "@context": "http://schema.org",
        "@type": "BlogPosting",
        "mainEntityOfPage":{
          "@type": "WebPage",
          "@id": "http://www.yegor256.com/2014/04/14/jcabi-dynamo-java-api-of-aws-dynamodb.html"
        },
        "headline": "Object-Oriented DynamoDB API",
        "image": {
          "@type": "ImageObject",
          "url": "http://img.teamed.io/face-1400x1400.jpg",
          "height": 1400,
          "width": 1400
        },
        "datePublished": "2014-04-14",
        "dateModified": "2014-04-14",
        "author": {
          "@type": "Person",
          "name": "Yegor Bugayenko"
        },
        "publisher": {
          "@type": "Organization",
          "name": "yegor256.com",
          "logo": {
            "@type": "ImageObject",
            "url": "http://img.teamed.io/face-512x512.jpg",
            "width": 512,
            "height": 512
          }
        },
        "description": "I created jcabi-dynamo a few months ago to make AWS SDK more object oriented;
the article explains why jcabi-dynamo is better than bare Amazon SDK
",
        "keywords": ["dynamodb", "dynamodb java", "java dynamodb example", "java dynamodb query", "java dynamodb client", "java dynamodb query example"]
      }
    </script>
    <style amp-boilerplate>body{-webkit-animation:-amp-start 8s steps(1,end) 0s 1 normal both;-moz-animation:-amp-start 8s steps(1,end) 0s 1 normal both;-ms-animation:-amp-start 8s steps(1,end) 0s 1 normal both;animation:-amp-start 8s steps(1,end) 0s 1 normal both}@-webkit-keyframes -amp-start{from{visibility:hidden}to{visibility:visible}}@-moz-keyframes -amp-start{from{visibility:hidden}to{visibility:visible}}@-ms-keyframes -amp-start{from{visibility:hidden}to{visibility:visible}}@-o-keyframes -amp-start{from{visibility:hidden}to{visibility:visible}}@keyframes -amp-start{from{visibility:hidden}to{visibility:visible}}</style><noscript><style amp-boilerplate>body{-webkit-animation:none;-moz-animation:none;-ms-animation:none;animation:none}</style></noscript>
    <style amp-custom="amp-custom">
      body { padding: 2em; }
      article { width: 600px; max-width: 100%; margin-left: auto; margin-right: auto; }
    </style>
    <script async src="https://cdn.ampproject.org/v0.js"></script>
  </head>
  <body>
    <article>
      <h1>Object-Oriented DynamoDB API</h1>
      

<p>I&#39;m a big fan of cloud computing in general and of
<a href="http://aws.amazon.com/">Amazon Web Services</a> in particular. I honestly believe that in a
few years big providers will host all, or almost all, computing and storage
resources. When this is the case, we won&#39;t have to worry too much anymore about
downtime, backups and system administrators.
<a href="http://aws.amazon.com/dynamodb/">DynamoDB</a> is one of the steps towards this
future.</p>

<blockquote class="twitter-tweet" lang="en"><p>This looks cool - jcabi-dynamo - a <a href="https://twitter.com/search?q=%23Java&amp;src=hash">#Java</a> Object layer atop the <a href="https://twitter.com/search?q=%23DynamoDB&amp;src=hash">#DynamoDB</a> SDK - <a href="http://t.co/khRFR2joKX">http://t.co/khRFR2joKX</a> <a href="https://twitter.com/search?q=%23aws&amp;src=hash">#aws</a></p>&mdash; Jeff Barr (@jeffbarr) <a href="https://twitter.com/jeffbarr/statuses/380813867971915777">September 19, 2013</a></blockquote>

<script async='' src="http://platform.twitter.com/widgets.js" charset="utf-8"></script>

<!--more-->

<p>DynamoDB is a <a href="http://en.wikipedia.org/wiki/NoSQL">NoSQL</a> database accessible
through <a href="http://en.wikipedia.org/wiki/Representational_state_transfer">RESTful</a>
JSON API. Its design is relatively simple. There are tables, which basically
are collections of data structures, or in AWS terminology, &quot;items.&quot;</p>

<p>Every item has a mandatory &quot;hash,&quot; an optional &quot;range&quot; and a number of other
optional attributes. For instance, take the example table <code>depts</code>:</p>

<figure class="highlight"><pre><code class="language-text" data-lang="text">+------+--------+---------------------------+
| dept | worker | Attributes                |
+------+--------+---------------------------+
| 205  | Jeff   | job=&quot;manager&quot;, sex=&quot;male&quot; |
| 205  | Bob    | age=43, city=&quot;Chicago&quot;    |
| 398  | Alice  | age=27, job=&quot;architect&quot;   |
+------+--------+---------------------------+</code></pre></figure>

<p>For Java, Amazon provides an
<a href="https://aws.amazon.com/documentation/sdkforjava/">SDK</a>, which mirrors all
RESTful calls to Java methods. The SDK works fine, but is designed in a pure
<a href="http://en.wikipedia.org/wiki/Procedural_programming">procedural</a> style.</p>

<p>Let&#39;s say we want to add a new item to the table above. RESTful call
<a href="http://docs.aws.amazon.com/amazondynamodb/latest/APIReference/API_PutItem.html"><code>putItem</code></a>
looks like (in essence):</p>

<figure class="highlight"><pre><code class="language-text" data-lang="text">putItem:
  tableName: depts
  item:
    dept: 435
    worker: &quot;William&quot;
    job: &quot;programmer&quot;</code></pre></figure>

<p>This is what the Amazon server needs to know in order to create a new item in
the table. This is how you&#39;re supposed to make this call through the AWS Java
SDK:</p>

<figure class="highlight"><pre><code class="language-java" data-lang="java"><span class="n">PutItemRequest</span> <span class="n">request</span> <span class="o">=</span> <span class="k">new</span> <span class="nf">PutItemRequest</span><span class="o">();</span>
<span class="n">request</span><span class="o">.</span><span class="na">setTableName</span><span class="o">(</span><span class="s">&quot;depts&quot;</span><span class="o">);</span>
<span class="n">Map</span><span class="o">&lt;</span><span class="n">String</span><span class="o">,</span> <span class="n">AttributeValue</span><span class="o">&gt;</span> <span class="n">attributes</span> <span class="o">=</span> <span class="k">new</span> <span class="n">HashMap</span><span class="o">&lt;&gt;();</span>
<span class="n">attributes</span><span class="o">.</span><span class="na">put</span><span class="o">(</span><span class="s">&quot;dept&quot;</span><span class="o">,</span> <span class="k">new</span> <span class="nf">AttributeValue</span><span class="o">(</span><span class="mi">435</span><span class="o">));</span>
<span class="n">attributes</span><span class="o">.</span><span class="na">put</span><span class="o">(</span><span class="s">&quot;worker&quot;</span><span class="o">,</span> <span class="k">new</span> <span class="nf">AttributeValue</span><span class="o">(</span><span class="s">&quot;William&quot;</span><span class="o">));</span>
<span class="n">attributes</span><span class="o">.</span><span class="na">put</span><span class="o">(</span><span class="s">&quot;job&quot;</span><span class="o">,</span> <span class="k">new</span> <span class="nf">AttributeValue</span><span class="o">(</span><span class="err">&quot;</span><span class="n">programmer</span><span class="o">));</span>
<span class="n">request</span><span class="o">.</span><span class="na">setItem</span><span class="o">(</span><span class="n">attributes</span><span class="o">);</span>
<span class="n">AmazonDynamoDB</span> <span class="n">aws</span> <span class="o">=</span> <span class="c1">// instantiate it with credentials</span>
<span class="k">try</span> <span class="o">{</span>
  <span class="n">aws</span><span class="o">.</span><span class="na">putItem</span><span class="o">(</span><span class="n">request</span><span class="o">);</span>
<span class="o">}</span> <span class="k">finally</span> <span class="o">{</span>
  <span class="n">aws</span><span class="o">.</span><span class="na">shutdown</span><span class="o">();</span>
<span class="o">}</span></code></pre></figure>

<p>The above script works fine, but there is one major drawback &mdash; it is not
object oriented. It is a perfect example of an imperative <a href="http://en.wikipedia.org/wiki/Procedural_programming">procedural
programming</a>.</p>

<p>To allow you to compare, let me show what I&#39;ve done with
<a href="http://dynamo.jcabi.com">jcabi-dynamo</a>. Here is my code, which does exactly the
same thing, but in an
<a href="http://en.wikipedia.org/wiki/Object-oriented_programming">object-oriented</a> way:</p>

<figure class="highlight"><pre><code class="language-java" data-lang="java"><span class="n">Region</span> <span class="n">region</span> <span class="o">=</span> <span class="c1">// instantiate it with credentials</span>
<span class="n">Table</span> <span class="n">table</span> <span class="o">=</span> <span class="n">region</span><span class="o">.</span><span class="na">table</span><span class="o">(</span><span class="s">&quot;depts&quot;</span><span class="o">);</span>
<span class="n">Item</span> <span class="n">item</span> <span class="o">=</span> <span class="n">table</span><span class="o">.</span><span class="na">put</span><span class="o">(</span>
  <span class="k">new</span> <span class="nf">Attributes</span><span class="o">()</span>
    <span class="o">.</span><span class="na">with</span><span class="o">(</span><span class="s">&quot;dept&quot;</span><span class="o">,</span> <span class="mi">435</span><span class="o">)</span>
    <span class="o">.</span><span class="na">with</span><span class="o">(</span><span class="s">&quot;worker&quot;</span><span class="o">,</span> <span class="s">&quot;William&quot;</span><span class="o">)</span>
    <span class="o">.</span><span class="na">with</span><span class="o">(</span><span class="s">&quot;job&quot;</span><span class="o">,</span> <span class="s">&quot;programmer&quot;</span><span class="o">)</span>
<span class="o">);</span></code></pre></figure>

<p>My code is not only shorter, but it also employs encapsulation and separates
responsibilities of classes.
<a href="http://dynamo.jcabi.com/apidocs-0.10/com/jcabi/dynamo/Table.html"><code>Table</code></a>
class (actually it is an interface internally implemented by a class)
encapsulates information about the table, while
<a href="http://dynamo.jcabi.com/apidocs-0.10/com/jcabi/dynamo/Item.html"><code>Item</code></a>
encapsulates item details.</p>

<p>We can pass an <code>item</code> as an argument to another method and all DynamoDB related
implementation details will be hidden from it. For example, somewhere later in
the code:</p>

<figure class="highlight"><pre><code class="language-java" data-lang="java"><span class="kt">void</span> <span class="nf">sayHello</span><span class="o">(</span><span class="n">Item</span> <span class="n">item</span><span class="o">)</span> <span class="o">{</span>
  <span class="n">System</span><span class="o">.</span><span class="na">out</span><span class="o">.</span><span class="na">println</span><span class="o">(</span><span class="s">&quot;Hello, &quot;</span> <span class="o">+</span> <span class="n">item</span><span class="o">.</span><span class="na">get</span><span class="o">(</span><span class="s">&quot;worker&quot;</span><span class="o">));</span>
<span class="o">}</span></code></pre></figure>

<p>In this script, we don&#39;t know anything about DynamoDB or how to deal with its
RESTful API. We interact solely with an instance of
<a href="http://dynamo.jcabi.com/apidocs-0.10/com/jcabi/dynamo/Item.html"><code>Item</code></a> class.</p>

<p>By the way, all public entities in <a href="http://dynamo.jcabi.com">jcabi-dynamo</a> are
Java interfaces. Thanks to that, you can test and mock the library completely
(but I would recommend to use
<a href="/2014/05/01/dynamodb-local-maven-plugin.html">DynamoDB Local</a>
and create integration tests).</p>

<p>Let&#39;s consider a more complex example, which would take a page of code if we
were to use a bare AWS SDK. Let&#39;s say that we want to remove all workers from
our table who work as architects:</p>

<figure class="highlight"><pre><code class="language-java" data-lang="java"><span class="n">Region</span> <span class="n">region</span> <span class="o">=</span> <span class="c1">// instantiate it with credentials</span>
<span class="n">Iterator</span><span class="o">&lt;</span><span class="n">Item</span><span class="o">&gt;</span> <span class="n">workers</span> <span class="o">=</span> <span class="n">region</span><span class="o">.</span><span class="na">table</span><span class="o">(</span><span class="s">&quot;depts&quot;</span><span class="o">).</span><span class="na">frame</span><span class="o">()</span>
  <span class="o">.</span><span class="na">where</span><span class="o">(</span><span class="s">&quot;job&quot;</span><span class="o">,</span> <span class="n">Condition</span><span class="o">.</span><span class="na">equalTo</span><span class="o">(</span><span class="s">&quot;architect&quot;</span><span class="o">));</span>
<span class="k">while</span> <span class="o">(</span><span class="n">workers</span><span class="o">.</span><span class="na">hasNext</span><span class="o">())</span> <span class="o">{</span>
  <span class="n">workers</span><span class="o">.</span><span class="na">remove</span><span class="o">();</span>
<span class="o">}</span></code></pre></figure>

<p><a href="http://dynamo.jcabi.com">jcabi-dynamo</a> has saved a lot of code lines in a few
of my projects. You can see it in action at
<a href="https://github.com/rultor/rultor/tree/rultor-0.2/rultor-users/src/main/java/com/rultor/users">rultor-users</a>.</p>

<p>The library ships as a JAR dependency in <a href="http://repo1.maven.org/maven2/com/jcabi/jcabi-dynamo">Maven
Central</a>
(get its latest versions from <a href="http://search.maven.org/">Maven Central</a>):</p>

<figure class="highlight"><pre><code class="language-xml" data-lang="xml"><span class="nt">&lt;dependency&gt;</span>
  <span class="nt">&lt;groupId&gt;</span>com.jcabi<span class="nt">&lt;/groupId&gt;</span>
  <span class="nt">&lt;artifactId&gt;</span>jcabi-dynamo<span class="nt">&lt;/artifactId&gt;</span>
<span class="nt">&lt;/dependency&gt;</span></code></pre></figure>

    </article>
  </body>
</html>
