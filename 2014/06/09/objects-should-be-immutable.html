<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="en-US" xml:lang="en-US"
  itemscope="" itemtype="http://schema.org/WebPage">
  <head>
    <base href="http://www.yegor256.com/2014/06/09/objects-should-be-immutable.html"/>
    <meta charset="utf-8"/>
    <meta itemprop="name" content="Objects Should Be Immutable" />
    <meta itemprop="author" content="Yegor Bugayenko" />
    <meta itemprop="breadcrumb" content="http://www.yegor256.com" />
    <meta itemprop="keywords" content="immutability in java, immutable class java, immutable java design pattern, java immutable object, java immutable object advantage, java immutable value object, java mutable immutable object" />
    <meta itemprop="description" content="The article gives arguments about why classes/objects in object-oriented programming have to be immutable, i.e. never modify their encapsulated state" />
    <meta name="description" content="The article gives arguments about why classes/objects in object-oriented programming have to be immutable, i.e. never modify their encapsulated state" />
    <meta name="keywords" content="immutability in java, immutable class java, immutable java design pattern, java immutable object, java immutable object advantage, java immutable value object, java mutable immutable object" />
    <meta name="viewport" content="width=device-width,minimum-scale=1,initial-scale=1"/>
    <meta name="twitter:creator" content="@yegor256"/>
    <meta property="twitter:account_id" content="4503599630178231" />
    <meta property="og:url" content="http://www.yegor256.com/2014/06/09/objects-should-be-immutable.html"/>
    
    <meta property="og:site_name" content="yegor256"/>
    <meta property="og:title" content="Objects Should Be Immutable"/>
    <meta property="og:description" content="The article gives arguments about why classes/objects in object-oriented programming have to be immutable, i.e. never modify their encapsulated state"/>
    <meta property="og:type" content="article" />
    <meta property="og:locale" content="en_US" />
    <meta property="fb:admins" content="10203747823006002"/>
    <meta name="twitter:site" content="@yegor256"/>
    <meta name="twitter:creator" content="@yegor256"/>
    <meta name="twitter:url" content="http://www.yegor256.com/2014/06/09/objects-should-be-immutable.html"/>
    <meta property="article:author" content="https://www.facebook.com/yegor256"/>
    <meta name="p:domain_verify" content="61f09f0ef5db665328827225a3fc11bd"/>
    <link rel="search" type="application/opensearchdescription+xml" href="opensearch.xml" title="yegor256" />
    <link rel="shortcut icon" href="/favicon.ico?465f564"/>
    <link rel="apple-touch-icon" href="/favicon.ico?465f564"/>
    <link rel="alternate" type="application/rss+xml" title="RSS for yegor256.com" href="http://www.yegor256.com/rss.xml"/>
    <link rel="author" href="http://plus.google.com/u/0/114792568016408327418?rel=author" />
    <link rel="publisher" href="http://plus.google.com/u/0/114792568016408327418" />
    <link rel="stylesheet" href="/css/layout.css?465f564"/>
    <link rel="stylesheet" href="/css/icons.css?465f564"/>
    <link rel="canonical" href="http://www.yegor256.com/2014/06/09/objects-should-be-immutable.html" />
    <title>Objects Should Be Immutable - Yegor Bugayenko
      </title>
    <script src="http://code.jquery.com/jquery-2.1.0.min.js"></script>
    <script src="/js/global.js?465f564"></script>
  </head>
  <body>
    <div class="wrapper">
      <aside class="header-toggle unprintable" id="header-toggle" title="show head menu"
        onclick="$('#header').show();$('#header-toggle').hide();">&#9776;</aside>
      <header class="header" id="header">
        <div class="face">
          <a href="/about-me.html" class="sub"><span>subscribe</span></a>
          <a href="/about-me.html">
            <img src="/images/yegor-bugayenko-192x192.png" class="photo"
              alt="photo of Yegor Bugayenko"/>
          </a>
          <a href="/about-me.html" class="hire"><span>hire me</span></a>
        </div>
        <nav>
          <ul class="menu social notranslate">
            <li><a href="http://www.twitter.com/yegor256" title="follow me in Twitter"><i class="icon icon-twitter notranslate" aria-hidden="true"></i></a></li>
            <li><a href="/rss" title="RSS feed"><i class="icon icon-rss notranslate" aria-hidden="true"></i></a></li>
            <li><a href="https://github.com/yegor256" title="my GitHub profile"><i class="icon icon-github notranslate" aria-hidden="true"></i></a></li>
            <li><a href="http://stackoverflow.com/users/187141/yegor256" title="my StackOverflow profile"><i class="icon icon-stackoverflow notranslate" aria-hidden="true"></i></a></li>
            <li><a href="https://www.facebook.com/yegor256" title="follow me in Facebook"><i class="icon icon-facebook notranslate" aria-hidden="true"></i></a></li>
            <li><a href="https://plus.google.com/+YegorBugayenko/posts" title="follow me in Google+"><i class="icon icon-googleplus notranslate" aria-hidden="true"></i></a></li>
            <li><a href="https://www.linkedin.com/in/yegor256" title="my LinkedIn profile"><i class="icon icon-linkedin notranslate" aria-hidden="true"></i></a></li>
            <li><a href="https://www.youtube.com/channel/UCr9qCdqXLm2SU0BIs6d_68Q" title="my Youtube video channel"><i class="icon icon-youtube notranslate" aria-hidden="true"></i></a></li>
            <li><a href="https://www.pinterest.com/yegor256/" title="my Pinterest boards"><i class="icon icon-pinterest notranslate" aria-hidden="true"></i></a></li>
            <li><a href="mailto:yegor@teamed.io" title="yegor@teamed.io"><i class="icon icon-mail notranslate" aria-hidden="true"></i></a></li>
          </ul>
          <ul class="menu">
            <li><a href="/" title="home page">home</a></li>
            <li><a href="/best.html" title="best articles to read">12&nbsp;best</a></li>
            <li><a href="/contents.html" title="blog contents">all&nbsp;170</a></li>
            <li><a href="/webinars.html" title="webinars">webinars</a></li>
            <li><a href="/talks.html" title="talks">talks</a></li>
            <li><a href="/books.html" title="books">books</a></li>
            <li><a href="/award.html" title="software quality award">award</a></li>
          </ul>
        </nav>
        <div id="search">
          <form method="get" action="https://www.google.com/search" style="position:relative">
            <input name="sitesearch" value="yegor256.com" type="hidden"/>
            <input id="search-query" class="field field-text"
              onfocus="$('#google').css('display', 'inline-block');"
              name="q" placeholder="Search" autocomplete="off"/>
            <span class="desktop-only">
              <input type="image" src="/images/google-search-icon.png" id="google" title="search via Google"
                style="width:3em;height:3em;display:none;position:absolute;margin-left:1em;" alt="search via Google"/>
            </span>
          </form>
          <div id="search-results" style="display: none;">
            <div class="entries"></div>
          </div>
        </div>
        
        <script id="search-results-template" type="text/mustache">
          {{#entries}}
            <div>
              <a href="{{url}}">{{title}}</a>
            </div>
          {{/entries}}
        </script>
        
        <div class="hot">
          <a href="http://goo.gl/5Yfx1i">
            <img src="/images/books/elegant-objects/cover.png"
              alt="Elegant Objects"
              style="width:100px;float:right;margin-left:1em;"/>
          </a>
          <ul>
            <li>
              <strong>Elegant Objects</strong>, my book about
              object-oriented programming, is published! Buy it
              <a href="http://goo.gl/5Yfx1i">on Amazon</a>
              and give me your feedback, please.
            </li>
            <!--
            <li>
              Meet me in Seattle, on Mar 12, at
              <a href="http://casitconf.org/casitconf16/talks/">CascadiaIT</a>,
              I'll be speaking about chat bots
            </li>
            -->
            <li>
              Meet me in Washington DC, on Mar 31, at
              <a href="http://www.sedcconference.org/">SEDC</a>,
              I'll be speaking about XDSD and meeting-free work
            </li>
            <li>
              <a href="https://plus.google.com/events/cn2nne1qnm8t475bt461igccrg4">Webinar #13</a>
              will be about the role of a Software Architect;
              join us on Apr 6, at 11am PST
            </li>
          </ul>
        </div>
      </header>
    </div>
    <section itemscope="" itemtype="http://schema.org/BlogPosting">

  <div class="wrapper">
    <header>
      <p class="printable">
        <img src="https://api.qrserver.com/v1/create-qr-code/?data=http://www.yegor256.com/2014/06/09/objects-should-be-immutable.html&amp;format=svg"
          style="width:125px;height:125px;" alt="QR code"/>
      </p>
      <p class="printable">
        <code>http://www.yegor256.com/2014/06/09/objects-should-be-immutable.html</code>
      </p>
      <h1 itemprop="name">Objects Should Be Immutable</h1>
      
        <aside class='book'><a href='http://goo.gl/5Yfx1i'><img src='/images/books/elegant-objects/cover.png' class='book-cover'/></a>Read more about this subject in <a href='http://goo.gl/5Yfx1i'>Section&nbsp;2.6</a> of this book<a href='http://goo.gl/5Yfx1i'><img src='/images/books/amazon-buy-button.png' class='amazon-button'/></a></aside>
      
      <ul class="subline">
        <li>
          <time itemprop="datePublished" datetime="2014-06-09T00:00:00+00:00">
            9 June 2014
          </time>
        </li>
        
        <li class='unprintable desktop-only'><a href='https://github.com/yegor256/blog/commits/master/_posts/2014/jun/2014-06-09-objects-should-be-immutable.md'>modified</a>          on <time itemprop='dateModified' datetime='2016-03-17T19:43:10+0000'>17 March 2016</time></li>
        <li class="printable">Yegor Bugayenko</li>
        <li class="unprintable">
          <i class="icon icon-comments"></i>
          <a href="http://www.yegor256.com/2014/06/09/objects-should-be-immutable.html#disqus_thread">comments</a>
        </li>
      </ul>
      <p class="unprintable"><a href='/tag/oop.html' class='tag notranslate'><img src='/images/books/elegant-objects/cactus.svg' alt='OOP'/>oop</a></p>
      <div class="buttons notranslate desktop-only">
        <nav class="share" role="navigation">
          <a href="http://www.facebook.com/sharer/sharer.php?u=http://www.yegor256.com/2014/06/09/objects-should-be-immutable.html"
            title="Share on Facebook" class="button">
            <span class="count count-facebook">0</span>
            <i class="icon icon-facebook notranslate" aria-hidden="true"></i>
          </a>
          <a href="https://twitter.com/share?url=http://www.yegor256.com/2014/06/09/objects-should-be-immutable.html&amp;text=Objects+Should+Be+Immutable"
            title="Share on Twitter" class="button">
            <span class="count count-twitter">0</span>
            <i class="icon icon-twitter notranslate" aria-hidden="true"></i>
          </a>
          <a href="https://plus.google.com/share?url=http://www.yegor256.com/2014/06/09/objects-should-be-immutable.html"
            title="Share on Google+" class="button">
            <span class="count count-googleplus">0</span>
            <i class="icon icon-googleplus notranslate" aria-hidden="true"></i>
          </a>
          <a href="https://www.linkedin.com/cws/share?url=http://www.yegor256.com/2014/06/09/objects-should-be-immutable.html"
            title="Share on LinkedIn" class="button">
            <span class="count count-linkedin">0</span>
            <i class="icon icon-linkedin notranslate" aria-hidden="true"></i>
          </a>
          <a href="http://www.stumbleupon.com/submit?url=http://www.yegor256.com/2014/06/09/objects-should-be-immutable.html&amp;title=Objects+Should+Be+Immutable"
            title="Share on StumbleUpon" class="button">
            <span class="count count-stumbleupon">0</span>
            <i class="icon icon-stumbleupon notranslate" aria-hidden="true"></i>
          </a>
          <a href="http://reddit.com/submit?url=http://www.yegor256.com/2014/06/09/objects-should-be-immutable.html%3F2014-23&amp;title=Objects+Should+Be+Immutable"
            title="Share on Reddit" class="button">
            <span class="count count-reddit">0</span>
            <i class="icon icon-reddit notranslate" aria-hidden="true"></i>
          </a>
          <a href="http://news.ycombinator.com/submitlink?u=http://www.yegor256.com/2014/06/09/objects-should-be-immutable.html%3F2014-23&amp;t=Objects+Should+Be+Immutable"
            title="Share on Hacker News" class="button">
            <i class="icon icon-hackernews notranslate" aria-hidden="true"></i>
          </a>
        </nav>
      </div>
    </header>
    <main>
      <article class="main" itemprop="articleBody">
        <p>In object-oriented programming, an object is
<a href="http://en.wikipedia.org/wiki/Immutable_object">immutable</a> if its state can&#39;t be
modified after it is created.</p>

<p>In Java, a good example of an
immutable object is <a href="http://docs.oracle.com/javase/7/docs/api/java/lang/String.html"><code>String</code></a>.
Once created, we can&#39;t modify its state. We can request that it creates
new strings, but its own state will never change.</p>

<p>However, there are not so many immutable classes in JDK. Take,
for example, class <a href="http://docs.oracle.com/javase/7/docs/api/java/util/Date.html"><code>Date</code></a>.
It is possible to modify its state using <code>setTime()</code>.</p>

<p>I don&#39;t know why the JDK designers decided to make these two
very similar classes differently. However, I believe that the design
of a mutable <code>Date</code> has many flaws, while the immutable <code>String</code>
is much more in the spirit of the object-oriented paradigm.</p>

<p>Moreover, I think that <strong>all classes should be immutable in
a perfect object-oriented world</strong>. Unfortunately, sometimes,
it is technically not possible due to limitations in JVM.
Nevertheless, we should always aim for the best.</p>

<p>This is an incomplete list of arguments in favor of immutability:</p>

<ul>
<li>immutable objects are simpler to construct, test, and use</li>
<li>truly immutable objects are always thread-safe</li>
<li>they help to avoid <a href="/2015/12/08/temporal-coupling-between-method-calls.html">temporal coupling</a></li>
<li>their usage is side-effect free (no defensive copies)</li>
<li>identity mutability problem is avoided</li>
<li>they always have failure atomicity</li>
<li>they are much easier to cache</li>
<li>they prevent NULL references, <a href="/2014/05/13/why-null-is-bad.html">which are bad</a></li>
</ul>

<p>Let&#39;s discuss the most important arguments one by one.</p>

<!--more-->

<h2 id="thread-safety">Thread Safety</h2>

<p>The first and the most obvious argument is that immutable objects
are thread-safe. This means that multiple threads can access the same
object at the same time, without clashing with another thread.</p>

<p>If no object methods can modify its state, no matter how many
of them and how often are being called parallel &mdash; they
will work in their own memory space in stack.</p>

<figure class='badge'><a href='http://www.amazon.com/gp/product/0321349601/ref=as_li_tl?ie=UTF8&amp;camp=1789&amp;creative=390957&amp;creativeASIN=0321349601&amp;linkCode=as2&amp;tag=yegor256com-20&amp;linkId=PHMGYYT46MJV2JLO'><img src='http://cf.jare.io/?u=http%3A%2F%2Fwww.yegor256.com%2Fimages%2F2014%2F12%2Fjava-concurrency-in-practice.png' style='width:100px;' alt='badge'/></a></figure>

<p>Goetz et al. explained the advantages of immutable objects
in more details in their very famous book
<a href="http://www.amazon.com/gp/product/0321349601/ref=as_li_tl?ie=UTF8&amp;camp=1789&amp;creative=9325&amp;creativeASIN=0321349601&amp;linkCode=as2&amp;tag=yegor256com-20&amp;linkId=OHVW5XBUDRTKVT46">Java Concurrency in Practice</a>
(highly recommended).</p>

<h2 id="avoiding-temporal-coupling">Avoiding Temporal Coupling</h2>

<p>Here is an example of temporal coupling (the code makes
two consecutive HTTP POST requests, where the second one contains HTTP body):</p>

<figure class="highlight"><pre><code class="language-java" data-lang="java"><span class="n">Request</span> <span class="n">request</span> <span class="o">=</span> <span class="k">new</span> <span class="nf">Request</span><span class="o">(</span><span class="s">&quot;http://example.com&quot;</span><span class="o">);</span>
<span class="n">request</span><span class="o">.</span><span class="na">method</span><span class="o">(</span><span class="s">&quot;POST&quot;</span><span class="o">);</span>
<span class="n">String</span> <span class="n">first</span> <span class="o">=</span> <span class="n">request</span><span class="o">.</span><span class="na">fetch</span><span class="o">();</span>
<span class="n">request</span><span class="o">.</span><span class="na">body</span><span class="o">(</span><span class="s">&quot;text=hello&quot;</span><span class="o">);</span>
<span class="n">String</span> <span class="n">second</span> <span class="o">=</span> <span class="n">request</span><span class="o">.</span><span class="na">fetch</span><span class="o">();</span></code></pre></figure>

<p>This code works. However, you must remember that the first
request should be configured before the second one may happen.
If we decide to remove the first request from the script, we will
remove the second and the third line, and won&#39;t get any errors
from the compiler:</p>

<figure class="highlight"><pre><code class="language-java" data-lang="java"><span class="n">Request</span> <span class="n">request</span> <span class="o">=</span> <span class="k">new</span> <span class="nf">Request</span><span class="o">(</span><span class="s">&quot;http://example.com&quot;</span><span class="o">);</span>
<span class="c1">// request.method(&quot;POST&quot;);</span>
<span class="c1">// String first = request.fetch();</span>
<span class="n">request</span><span class="o">.</span><span class="na">body</span><span class="o">(</span><span class="s">&quot;text=hello&quot;</span><span class="o">);</span>
<span class="n">String</span> <span class="n">second</span> <span class="o">=</span> <span class="n">request</span><span class="o">.</span><span class="na">fetch</span><span class="o">();</span></code></pre></figure>

<p>Now, the script is broken although it compiled without errors. This is
what <a href="/2015/12/08/temporal-coupling-between-method-calls.html">temporal coupling</a>
is about &mdash; there is always some hidden
information in the code that a programmer has to remember. In this example,
we have to remember that the configuration for the first request
is also used for the second one.</p>

<p>We have to remember that the second request should always stay
together and be executed after the first one.</p>

<p>If <code>Request</code> class were immutable, the first snippet wouldn&#39;t
work in the first place, and would have been rewritten like:</p>

<figure class="highlight"><pre><code class="language-java" data-lang="java"><span class="kd">final</span> <span class="n">Request</span> <span class="n">request</span> <span class="o">=</span> <span class="k">new</span> <span class="nf">Request</span><span class="o">(</span><span class="s">&quot;&quot;</span><span class="o">);</span>
<span class="n">String</span> <span class="n">first</span> <span class="o">=</span> <span class="n">request</span><span class="o">.</span><span class="na">method</span><span class="o">(</span><span class="s">&quot;POST&quot;</span><span class="o">).</span><span class="na">fetch</span><span class="o">();</span>
<span class="n">String</span> <span class="n">second</span> <span class="o">=</span> <span class="n">request</span><span class="o">.</span><span class="na">method</span><span class="o">(</span><span class="s">&quot;POST&quot;</span><span class="o">).</span><span class="na">body</span><span class="o">(</span><span class="s">&quot;text=hello&quot;</span><span class="o">).</span><span class="na">fetch</span><span class="o">();</span></code></pre></figure>

<p>Now, these two requests are not coupled. We can safely remove
the first one, and the second one will still work correctly.
You may point out that there is a code duplication. Yes, we
should get rid of it and re-write the code:</p>

<figure class="highlight"><pre><code class="language-java" data-lang="java"><span class="kd">final</span> <span class="n">Request</span> <span class="n">request</span> <span class="o">=</span> <span class="k">new</span> <span class="nf">Request</span><span class="o">(</span><span class="s">&quot;&quot;</span><span class="o">);</span>
<span class="kd">final</span> <span class="n">Request</span> <span class="n">post</span> <span class="o">=</span> <span class="n">request</span><span class="o">.</span><span class="na">method</span><span class="o">(</span><span class="s">&quot;POST&quot;</span><span class="o">);</span>
<span class="n">String</span> <span class="n">first</span> <span class="o">=</span> <span class="n">post</span><span class="o">.</span><span class="na">fetch</span><span class="o">();</span>
<span class="n">String</span> <span class="n">second</span> <span class="o">=</span> <span class="n">post</span><span class="o">.</span><span class="na">body</span><span class="o">(</span><span class="s">&quot;text=hello&quot;</span><span class="o">).</span><span class="na">fetch</span><span class="o">();</span></code></pre></figure>

<p>See, refactoring didn&#39;t break anything and we still don&#39;t have
temporal coupling. The first request can be removed safely
from the code without affecting the second one.</p>

<p>I hope this example demonstrates that the code manipulating
immutable objects is more readable and maintainable,
because it doesn&#39;t have
<a href="/2015/12/08/temporal-coupling-between-method-calls.html">temporal coupling</a>.</p>

<h2 id="avoiding-side-effects">Avoiding Side Effects</h2>

<p>Let&#39;s try to use our <code>Request</code> class in a new method (now it is mutable):</p>

<figure class="highlight"><pre><code class="language-java" data-lang="java"><span class="kd">public</span> <span class="n">String</span> <span class="nf">post</span><span class="o">(</span><span class="n">Request</span> <span class="n">request</span><span class="o">)</span> <span class="o">{</span>
  <span class="n">request</span><span class="o">.</span><span class="na">method</span><span class="o">(</span><span class="s">&quot;POST&quot;</span><span class="o">);</span>
  <span class="k">return</span> <span class="n">request</span><span class="o">.</span><span class="na">fetch</span><span class="o">();</span>
<span class="o">}</span></code></pre></figure>

<p>Let&#39;s try to make two requests &mdash; the first
with GET method and the second with POST:</p>

<figure class="highlight"><pre><code class="language-java" data-lang="java"><span class="n">Request</span> <span class="n">request</span> <span class="o">=</span> <span class="k">new</span> <span class="nf">Request</span><span class="o">(</span><span class="s">&quot;http://example.com&quot;</span><span class="o">);</span>
<span class="n">request</span><span class="o">.</span><span class="na">method</span><span class="o">(</span><span class="s">&quot;GET&quot;</span><span class="o">);</span>
<span class="n">String</span> <span class="n">first</span> <span class="o">=</span> <span class="k">this</span><span class="o">.</span><span class="na">post</span><span class="o">(</span><span class="n">request</span><span class="o">);</span>
<span class="n">String</span> <span class="n">second</span> <span class="o">=</span> <span class="n">request</span><span class="o">.</span><span class="na">fetch</span><span class="o">();</span></code></pre></figure>

<p>Method <code>post()</code> has a &quot;side effect&quot; &mdash; it makes changes
to the mutable object <code>request</code>. These changes are not really
expected in this case. We expect it to make a POST request and
return its body. We don&#39;t want to read its documentation just
to find out that behind the scene it also modifies
the request we&#39;re passing to it as an argument.</p>

<p>Needless to say, such side effects lead to bugs and
maintainability issues. It would be much better
to work with an immutable <code>Request</code>:</p>

<figure class="highlight"><pre><code class="language-java" data-lang="java"><span class="kd">public</span> <span class="n">String</span> <span class="nf">post</span><span class="o">(</span><span class="n">Request</span> <span class="n">request</span><span class="o">)</span> <span class="o">{</span>
  <span class="k">return</span> <span class="n">request</span><span class="o">.</span><span class="na">method</span><span class="o">(</span><span class="s">&quot;POST&quot;</span><span class="o">).</span><span class="na">fetch</span><span class="o">();</span>
<span class="o">}</span></code></pre></figure>

<p>In this case, we may not have any side effects.
Nobody can modify our <code>request</code> object, no matter where
it is used and how deep through the call stack it is passed by method calls:</p>

<figure class="highlight"><pre><code class="language-java" data-lang="java"><span class="n">Request</span> <span class="n">request</span> <span class="o">=</span> <span class="k">new</span> <span class="nf">Request</span><span class="o">(</span><span class="s">&quot;http://example.com&quot;</span><span class="o">).</span><span class="na">method</span><span class="o">(</span><span class="s">&quot;GET&quot;</span><span class="o">);</span>
<span class="n">String</span> <span class="n">first</span> <span class="o">=</span> <span class="k">this</span><span class="o">.</span><span class="na">post</span><span class="o">(</span><span class="n">request</span><span class="o">);</span>
<span class="n">String</span> <span class="n">second</span> <span class="o">=</span> <span class="n">request</span><span class="o">.</span><span class="na">fetch</span><span class="o">();</span></code></pre></figure>

<p>This code is perfectly safe and side effect free.</p>

<h2 id="avoiding-identity-mutability">Avoiding Identity Mutability</h2>

<p>Very often, we want objects to be identical if their internal
states are the same. <a href="http://docs.oracle.com/javase/7/docs/api/java/util/Date.html"><code>Date</code></a>
class is a good example:</p>

<figure class="highlight"><pre><code class="language-java" data-lang="java"><span class="n">Date</span> <span class="n">first</span> <span class="o">=</span> <span class="k">new</span> <span class="nf">Date</span><span class="o">(</span><span class="mi">1L</span><span class="o">);</span>
<span class="n">Date</span> <span class="n">second</span> <span class="o">=</span> <span class="k">new</span> <span class="nf">Date</span><span class="o">(</span><span class="mi">1L</span><span class="o">);</span>
<span class="k">assert</span> <span class="n">first</span><span class="o">.</span><span class="na">equals</span><span class="o">(</span><span class="n">second</span><span class="o">);</span> <span class="c1">// true</span></code></pre></figure>

<p>There are two different objects; however, they are equal
to each other because their encapsulated states are the same.
This is made possible through their custom overloaded
implementation of <code>equals()</code> and <code>hashCode()</code> methods.</p>

<p>The consequence of this convenient approach being used
with mutable objects is that every time we modify
object&#39;s state it changes its identity:</p>

<figure class="highlight"><pre><code class="language-java" data-lang="java"><span class="n">Date</span> <span class="n">first</span> <span class="o">=</span> <span class="k">new</span> <span class="nf">Date</span><span class="o">(</span><span class="mi">1L</span><span class="o">);</span>
<span class="n">Date</span> <span class="n">second</span> <span class="o">=</span> <span class="k">new</span> <span class="nf">Date</span><span class="o">(</span><span class="mi">1L</span><span class="o">);</span>
<span class="n">first</span><span class="o">.</span><span class="na">setTime</span><span class="o">(</span><span class="mi">2L</span><span class="o">);</span>
<span class="k">assert</span> <span class="n">first</span><span class="o">.</span><span class="na">equals</span><span class="o">(</span><span class="n">second</span><span class="o">);</span> <span class="c1">// false</span></code></pre></figure>

<p>This may look natural, until you start using your
mutable objects as keys in maps:</p>

<figure class="highlight"><pre><code class="language-java" data-lang="java"><span class="n">Map</span><span class="o">&lt;</span><span class="n">Date</span><span class="o">,</span> <span class="n">String</span><span class="o">&gt;</span> <span class="n">map</span> <span class="o">=</span> <span class="k">new</span> <span class="n">HashMap</span><span class="o">&lt;&gt;();</span>
<span class="n">Date</span> <span class="n">date</span> <span class="o">=</span> <span class="k">new</span> <span class="nf">Date</span><span class="o">();</span>
<span class="n">map</span><span class="o">.</span><span class="na">put</span><span class="o">(</span><span class="n">date</span><span class="o">,</span> <span class="s">&quot;hello, world!&quot;</span><span class="o">);</span>
<span class="n">date</span><span class="o">.</span><span class="na">setTime</span><span class="o">(</span><span class="mi">12345L</span><span class="o">);</span>
<span class="k">assert</span> <span class="n">map</span><span class="o">.</span><span class="na">containsKey</span><span class="o">(</span><span class="n">date</span><span class="o">);</span> <span class="c1">// false</span></code></pre></figure>

<p>When modifying the state of <code>date</code> object, we&#39;re not expecting
it to change its identity. We&#39;re not expecting to lose an entry
in the map just because the state of its key is changed. However,
this is exactly what is happening in the example above.</p>

<p>When we add an object to the map, its <code>hashCode()</code> returns one value.
This value is used by <a href="http://docs.oracle.com/javase/7/docs/api/java/util/HashMap.html"><code>HashMap</code></a>
to place the entry into the internal hash table.
When we call <code>containsKey()</code> hash code of the object is
different (because it is based on its internal state) and
<code>HashMap</code> can&#39;t find it in the internal hash table.</p>

<p>It is a very annoying and difficult to debug
side effects of mutable objects. Immutable objects avoid it completely.</p>

<h2 id="failure-atomicity">Failure Atomicity</h2>

<p>Here is a simple example:</p>

<figure class="highlight"><pre><code class="language-java" data-lang="java"><span class="kd">public</span> <span class="kd">class</span> <span class="nc">Stack</span> <span class="o">{</span>
  <span class="kd">private</span> <span class="kt">int</span> <span class="n">size</span><span class="o">;</span>
  <span class="kd">private</span> <span class="n">String</span><span class="o">[]</span> <span class="n">items</span><span class="o">;</span>
  <span class="kd">public</span> <span class="kt">void</span> <span class="nf">push</span><span class="o">(</span><span class="n">String</span> <span class="n">item</span><span class="o">)</span> <span class="o">{</span>
    <span class="n">size</span><span class="o">++;</span>
    <span class="k">if</span> <span class="o">(</span><span class="n">size</span> <span class="o">&gt;</span> <span class="n">items</span><span class="o">.</span><span class="na">length</span><span class="o">)</span> <span class="o">{</span>
      <span class="k">throw</span> <span class="k">new</span> <span class="nf">RuntimeException</span><span class="o">(</span><span class="s">&quot;stack overflow&quot;</span><span class="o">);</span>
    <span class="o">}</span>
    <span class="n">items</span><span class="o">[</span><span class="n">size</span><span class="o">]</span> <span class="o">=</span> <span class="n">item</span><span class="o">;</span>
  <span class="o">}</span>
<span class="o">}</span></code></pre></figure>

<p>It is obvious that an object of class <code>Stack</code> will be left
in a broken state if it
<a href="/2015/12/01/rethrow-exceptions.html">throws</a>
a runtime exception on overflow.
Its <code>size</code> property will be incremented, while <code>items</code> won&#39;t get a new element.</p>

<p>Immutability prevents this problem. An object will never be
left in a broken state because its state is modified only in
its constructor. The constructor will either fail, rejecting
object instantiation, or succeed, making a valid solid object,
which never changes its encapsulated state.</p>

<figure class='badge'><a href='http://www.amazon.com/gp/product/0321356683/ref=as_li_tl?ie=UTF8&amp;camp=1789&amp;creative=9325&amp;creativeASIN=0321356683&amp;linkCode=as2&amp;tag=yegor256com-20&amp;linkId=CSSI3POG6ZJ3BJ6T'><img src='http://cf.jare.io/?u=http%3A%2F%2Fwww.yegor256.com%2Fimages%2F2014%2F06%2Feffective-java-second-edition.png' style='width:100px;' alt='badge'/></a></figure>

<p>For more on this subject, read
<a href="http://www.amazon.com/gp/product/0321356683/ref=as_li_tl?ie=UTF8&amp;camp=1789&amp;creative=9325&amp;creativeASIN=0321356683&amp;linkCode=as2&amp;tag=yegor256com-20&amp;linkId=CSSI3POG6ZJ3BJ6T">Effective Java, 2nd Edition</a>
by Joshua Bloch.</p>

<h2 id="arguments-against-immutability">Arguments Against Immutability</h2>

<p>There are a number of arguments against immutability.</p>

<ol>
<li><p>&ldquo;Immutability is not for enterprise systems&rdquo;.
Very often, I hear people say that immutability is a
fancy feature, while absolutely impractical in real
enterprise systems. As a counter-argument, I can only show
some examples of real-life applications that contain only immutable Java objects:
<a href="http://http.jcabi.com">jcabi-http</a>,
<a href="/2014/04/24/java-xml-parsing-and-traversing.html">jcabi-xml</a>,
<a href="/2014/05/14/object-oriented-github-java-sdk.html">jcabi-github</a>,
<a href="/2014/05/26/amazon-s3-java-oop-adapter.html">jcabi-s3</a>,
<a href="/2014/04/14/jcabi-dynamo-java-api-of-aws-dynamodb.html">jcabi-dynamo</a>,
<a href="/2014/04/29/w3c-java-validators.html">jcabi-w3c</a>,
<a href="/2014/08/18/fluent-jdbc-decorator.html">jcabi-jdbc</a>,
<a href="http://simpledb.jcabi.com">jcabi-simpledb</a>,
<a href="/2014/09/02/java-ssh-client.html">jcabi-ssh</a>.
The above are all Java libraries that work solely with immutable
classes/objects. <a href="https://github.com/netbout/netbout">netbout.com</a>
and <a href="/2014/12/04/synchronization-between-nodes.html">stateful.co</a> are
web applications that work solely with immutable objects.</p></li>
<li><p>&ldquo;It&#39;s cheaper to update an existing object than create a new one&rdquo;.
Oracle <a href="http://docs.oracle.com/javase/tutorial/essential/concurrency/immutable.html">thinks</a>
that &ldquo;The impact of object creation is often overestimated and can
be offset by some of the efficiency associated with immutable objects.
These include decreased overhead due to garbage collection, and the
elimination of code needed to protect mutable objects from corruption.&rdquo; I agree.</p></li>
</ol>

<p>If you have some other arguments, please post them below and I&#39;ll try to comment.</p>

<p>P.S. Check <a href="http://www.takes.org">takes.org</a>,
a Java web framework that consists entirely of immutable objects.</p>

      </article>
    </main>
    
  <div class="unprintable">
    <h2>Related Posts</h2>
    <p>You may also find these posts interesting:</p>
    <ul>
      
        <li>
          <a href="/2016/02/03/design-patterns-and-anti-patterns.html" data-score="13.648662329885504">Design Patterns and Anti-Patterns, Love and Hate</a>
        </li>
      
        <li>
          <a href="/2015/04/16/award.html" data-score="6.897782429926475">Software Quality Award, 2015</a>
        </li>
      
        <li>
          <a href="/2015/04/22/favorite-software-books.html" data-score="1.7739540160949638">My Favorite Software Books</a>
        </li>
      
        <li>
          <a href="/2015/05/18/cookie-based-authentication.html" data-score="1.6743336996086158">How Cookie-Based Authentication Works in the Takes Framework</a>
        </li>
      
        <li>
          <a href="/2015/03/22/takes-java-web-framework.html" data-score="1.3774663332338555">Java Web App Architecture In Takes Framework</a>
        </li>
      
    </ul>
  </div>


    <div class="teamed-banner">
      <a href="http://www.teamed.io">
        <img src="/images/teamed-banner.jpg" alt="teamed banner"/>
      </a>
    </div>
  </div>

  <div class="disqus" role="complementary">
    <div id="disqus_thread" class="disqus-thread"></div>
    <a href="http://disqus.com" class="dsq-brlink">
      comments powered by
      <span class="logo-disqus">Disqus</span>
    </a>
  </div>

  <div class="wrapper">
    <footer class="footer">
      <p>
        &copy;
        <span itemprop="author">Yegor Bugayenko</span>,
        2014-2016
      </p>
    </footer>
  </div>

</section>

<script src="/js/post.js?465f564"></script>
<script src="//a.disquscdn.com/embed.js?465f564"></script>

    <script>
      (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
      (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
      m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
      })(window,document,'script','//www.google-analytics.com/analytics.js','ga');
      ga('create', 'UA-1963507-32', 'auto');
      ga('send', 'pageview');
    </script>
  </body>
</html>
