<!DOCTYPE html>
<html âš¡ lang="en">
  <head>
    <meta charset="utf-8">
    <title></title>
    <link rel="canonical" href="http://www.yegor256.com" />
    <meta name="viewport" content="width=device-width,minimum-scale=1,initial-scale=1">
    <style amp-boilerplate>body{-webkit-animation:-amp-start 8s steps(1,end) 0s 1 normal both;-moz-animation:-amp-start 8s steps(1,end) 0s 1 normal both;-ms-animation:-amp-start 8s steps(1,end) 0s 1 normal both;animation:-amp-start 8s steps(1,end) 0s 1 normal both}@-webkit-keyframes -amp-start{from{visibility:hidden}to{visibility:visible}}@-moz-keyframes -amp-start{from{visibility:hidden}to{visibility:visible}}@-ms-keyframes -amp-start{from{visibility:hidden}to{visibility:visible}}@-o-keyframes -amp-start{from{visibility:hidden}to{visibility:visible}}@keyframes -amp-start{from{visibility:hidden}to{visibility:visible}}</style><noscript><style amp-boilerplate>body{-webkit-animation:none;-moz-animation:none;-ms-animation:none;animation:none}</style></noscript>
    <script async src="https://cdn.ampproject.org/v0.js"></script>
  </head>
  <body>
    <h1></h1>
    <p>I needed to create a custom syntax highlighting
for <a href="http://www.requs.org">requs.org</a>
on which I&#39;m using Jekyll for site rendering.</p>

<p>This is how my code blocks look in markdown pages:</p>

<figure class="highlight"><pre><code class="language-text" data-lang="text">{ % highlight requs %}
User is a &quot;human being&quot;.
{ % endhighlight %}</code></pre></figure>

<p>I created a custom <a href="http://pygments.org/docs/lexerdevelopment/">Pygments lexer</a>:</p>

<!--more-->

<figure class="highlight"><pre><code class="language-python" data-lang="python"><span class="kn">from</span> <span class="nn">pygments.lexer</span> <span class="kn">import</span> <span class="n">RegexLexer</span>
<span class="kn">from</span> <span class="nn">pygments.token</span> <span class="kn">import</span> <span class="n">Punctuation</span><span class="p">,</span> <span class="n">Text</span><span class="p">,</span> <span class="n">Keyword</span><span class="p">,</span> <span class="n">Name</span><span class="p">,</span> <span class="n">String</span>
<span class="kn">from</span> <span class="nn">pygments.util</span> <span class="kn">import</span> <span class="n">shebang_matches</span>
<span class="k">class</span> <span class="nc">RequsLexer</span><span class="p">(</span><span class="n">RegexLexer</span><span class="p">):</span>
  <span class="n">name</span> <span class="o">=</span> <span class="s">&#39;requs&#39;</span>
  <span class="n">aliases</span> <span class="o">=</span> <span class="p">[</span><span class="s">&#39;requs&#39;</span><span class="p">]</span>
  <span class="n">tokens</span> <span class="o">=</span> <span class="p">{</span>
    <span class="s">&#39;root&#39;</span><span class="p">:</span> <span class="p">[</span>
      <span class="p">(</span><span class="s">r&#39;&quot;[^&quot;]+&quot;&#39;</span><span class="p">,</span> <span class="n">String</span><span class="p">),</span>
      <span class="p">(</span><span class="s">r&#39;&quot;&quot;&quot;.+&quot;&quot;&quot;&#39;</span><span class="p">,</span> <span class="n">Text</span><span class="p">),</span>
      <span class="p">(</span><span class="s">r&#39;\b(needs|includes|requires|when|fail|is|a|the)\s*\b&#39;</span><span class="p">,</span> <span class="n">Keyword</span><span class="p">),</span>
      <span class="p">(</span><span class="s">r&#39;([A-Z][a-z]+)+&#39;</span><span class="p">,</span> <span class="n">Name</span><span class="p">),</span>
      <span class="p">(</span><span class="s">r&#39;[,;:]&#39;</span><span class="p">,</span> <span class="n">Punctuation</span><span class="p">),</span>
    <span class="p">],</span>
  <span class="p">}</span>
  <span class="k">def</span> <span class="nf">analyse_text</span><span class="p">(</span><span class="n">text</span><span class="p">):</span>
    <span class="k">return</span> <span class="n">shebang_matches</span><span class="p">(</span><span class="n">text</span><span class="p">,</span> <span class="s">r&#39;requs&#39;</span><span class="p">)</span></code></pre></figure>

<p>Then, I packaged it for <a href="https://pypi.python.org/pypi/setuptools"><code>easy_install</code></a>
and installed locally:</p>

<figure class="highlight"><pre><code class="language-bash" data-lang="bash"><span class="nv">$ </span>easy_install src/requs_pygment
Processing requs_pygment
Running setup.py -q bdist_egg --dist-dir ...
zip_safe flag not <span class="nb">set</span><span class="p">;</span> analyzing archive contents...
Adding requs-pygment 0.1 to easy-install.pth file
Installed /Library/Python/2.7/site-packages/requs_pygment-0.1-py2.7.egg
Processing dependencies <span class="k">for</span> requs-pygment<span class="o">==</span>0.1
Finished processing dependencies <span class="k">for</span> requs-pygment<span class="o">==</span>0.1</code></pre></figure>

<p>It&#39;s done. Now I run <code>jekyll build</code> and my syntax
is highlighted according to the custom rules I specified in the lexer.</p>

  </body>
</html>
