<!DOCTYPE html>
<html âš¡ lang="en">
  <head>
    <meta charset="utf-8">
    <title>Simple Java SSH Client</title>
    <!-- <link rel="canonical" href="http://www.yegor256.com/_posts/2014/sep/2014-09-02-java-ssh-client" /> -->
    <meta name="viewport" content="width=device-width,minimum-scale=1,initial-scale=1">
    <script type='application/ld+json'>
      {
        "@context": "http://schema.org",
        "@type": "BlogPosting",
        "mainEntityOfPage":{
          "@type": "WebPage",
          "@id": "_posts/2014/sep/2014-09-02-java-ssh-client.md"
        },
        "headline": "Simple Java SSH Client",
        "image": {
          "@type": "ImageObject",
          "url": "http://img.teamed.io/face-1400x1400.jpg",
          "height": 1400,
          "width": 1400
        },
        "datePublished": "2014-09-02",
        "dateModified": "2014-09-02",
        "author": {
          "@type": "Person",
          "name": "Yegor Bugayenko"
        },
        "publisher": {
          "@type": "Person",
          "name": "Yegor Bugayenko",
          "logo": {
            "@type": "ImageObject",
            "url": "http://img.teamed.io/face-1400x1400.jpg",
            "width": 1400,
            "height": 1400
          }
        },
        "description": "jcabi-ssh is a simple Java SSH client that
wraps jsch library and makes its usage more
object-oriented and convenient
",
        "keywords": ["java ssh", "java ssh client", "ssh library for java", "openssh for java", "ssh libraries for java", "open source ssh for java", "ssh tunneling for java"]
      }
    </script>
    <style amp-boilerplate>body{-webkit-animation:-amp-start 8s steps(1,end) 0s 1 normal both;-moz-animation:-amp-start 8s steps(1,end) 0s 1 normal both;-ms-animation:-amp-start 8s steps(1,end) 0s 1 normal both;animation:-amp-start 8s steps(1,end) 0s 1 normal both}@-webkit-keyframes -amp-start{from{visibility:hidden}to{visibility:visible}}@-moz-keyframes -amp-start{from{visibility:hidden}to{visibility:visible}}@-ms-keyframes -amp-start{from{visibility:hidden}to{visibility:visible}}@-o-keyframes -amp-start{from{visibility:hidden}to{visibility:visible}}@keyframes -amp-start{from{visibility:hidden}to{visibility:visible}}</style><noscript><style amp-boilerplate>body{-webkit-animation:none;-moz-animation:none;-ms-animation:none;animation:none}</style></noscript>
    <script async src="https://cdn.ampproject.org/v0.js"></script>
  </head>
  <body>
    <h1>Simple Java SSH Client</h1>
    <p>An execution of a shell command via SSH can be done in
Java, in just a few lines, using <a href="http://ssh.jcabi.com">jcabi-ssh</a>:</p>

<figure class="highlight"><pre><code class="language-java" data-lang="java"><span class="n">String</span> <span class="n">hello</span> <span class="o">=</span> <span class="k">new</span> <span class="n">Shell</span><span class="o">.</span><span class="na">Plain</span><span class="o">(</span>
  <span class="k">new</span> <span class="nf">SSH</span><span class="o">(</span>
    <span class="s">&quot;ssh.example.com&quot;</span><span class="o">,</span> <span class="mi">22</span><span class="o">,</span>
    <span class="s">&quot;yegor&quot;</span><span class="o">,</span> <span class="s">&quot;-----BEGIN RSA PRIVATE KEY-----...&quot;</span>
  <span class="o">)</span>
<span class="o">).</span><span class="na">exec</span><span class="o">(</span><span class="s">&quot;echo &#39;Hello, world!&#39;&quot;</span><span class="o">);</span></code></pre></figure>

<p><a href="http://ssh.jcabi.com">jcabi-ssh</a> is
a convenient wrapper of <a href="http://www.jcraft.com/jsch/">JSch</a>,
a well-known pure Java implementation of SSH2.</p>

<!--more-->

<p>Here is a more complex scenario, where I upload a file via SSH
and then read back its grepped content:</p>

<figure class="highlight"><pre><code class="language-xml" data-lang="xml">Shell shell = new SSH(
  &quot;ssh.example.com&quot;, 22,
  &quot;yegor&quot;, &quot;-----BEGIN RSA PRIVATE KEY-----...&quot;
);
File file = new File(&quot;/tmp/data.txt&quot;);
new Shell.Safe(shell).exec(
  &quot;cat &gt; d.txt <span class="err">&amp;&amp;</span> grep &#39;some text&#39; d.txt&quot;,
  new FileInputStream(file),
  Logger.stream(Level.INFO, this),
  Logger.stream(Level.WARNING, this)
);</code></pre></figure>

<p>Class <code>SSH</code>, which implements interface <code>Shell</code>, has only one method, <code>exec</code>.
This method accepts four arguments:</p>

<figure class="highlight"><pre><code class="language-xml" data-lang="xml">interface Shell {
  int exec(
    String cmd, InputStream stdin,
    OutputStream stdout, OutputStream stderr
  );
}</code></pre></figure>

<p>I think it&#39;s obvious what these arguments are about.</p>

<p>There are also a few convenient decorators that make it easier to operate with
simple commands.</p>

<h2 id="shell-safe">Shell.Safe</h2>

<p><code>Shell.Safe</code> decorates an instance of <code>Shell</code> and
<a href="/2015/12/01/rethrow-exceptions.html">throws</a> an exception
if the <code>exec</code> exit code is not equal to zero. This may be very useful when
you want to make sure that your command executed successfully, but don&#39;t
want to duplicate <code>if/throw</code> in many places of your code.</p>

<figure class="highlight"><pre><code class="language-xml" data-lang="xml">Shell ssh = new Shell.Safe(
  new SSH(
    &quot;ssh.example.com&quot;, 22,
    &quot;yegor&quot;, &quot;-----BEGIN RSA PRIVATE KEY-----...&quot;
  )
);</code></pre></figure>

<h2 id="shell-verbose">Shell.Verbose</h2>

<p><code>Shell.Verbose</code> decorates an instance of <code>Shell</code> and copies
<code>stdout</code> and <code>stderr</code> to the slf4j logging facility (using
<a href="http://log.jcabi.com">jcabi-log</a>). Of course, you can combine
decorators, for example:</p>

<figure class="highlight"><pre><code class="language-xml" data-lang="xml">Shell ssh = new Shell.Verbose(
  new Shell.Safe(
    new SSH(
      &quot;ssh.example.com&quot;, 22,
      &quot;yegor&quot;, &quot;-----BEGIN RSA PRIVATE KEY-----...&quot;
    )
  )
);</code></pre></figure>

<h2 id="shell-plain">Shell.Plain</h2>

<p><code>Shell.Plain</code> is a wrapper of <code>Shell</code> that introduces a new <code>exec</code> method
with only one argument, a command to execute. It also doesn&#39;t return an
exit code, but <code>stdout</code> instead. This should be very convenient when you want
to execute a simple command and just get its output
(I&#39;m combining it with <code>Shell.Safe</code> for safety):</p>



<h2 id="download">Download</h2>

<p>You need a single dependency
<a href="http://repo1.maven.org/maven2/com/jcabi/jcabi-ssh"><code>jcabi-ssh.jar</code></a>
in your Maven project
(get its latest version in <a href="http://search.maven.org/">Maven Central</a>):</p>

<figure class="highlight"><pre><code class="language-xml" data-lang="xml"><span class="nt">&lt;dependency&gt;</span>
  <span class="nt">&lt;groupId&gt;</span>com.jcabi<span class="nt">&lt;/groupId&gt;</span>
  <span class="nt">&lt;artifactId&gt;</span>jcabi-ssh<span class="nt">&lt;/artifactId&gt;</span>
<span class="nt">&lt;/dependency&gt;</span></code></pre></figure>

<p>The project is in <a href="https://github.com/jcabi/jcabi-ssh">GitHub</a>.
If you have any problems, just submit an issue. I&#39;ll try to help.</p>

  </body>
</html>
