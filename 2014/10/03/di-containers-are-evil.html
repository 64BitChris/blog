<!DOCTYPE html><html xmlns="http://www.w3.org/1999/xhtml" lang="en-US" xml:lang="en-US" itemscope="" itemtype="http://schema.org/WebPage"><head><base href="/"/><meta charset="utf-8"/><meta itemprop="name" content="Dependency Injection Containers are Code Polluters"/><meta itemprop="author" content="Yegor Bugayenko"/><meta itemprop="breadcrumb" content="http://www.yegor256.com"/><meta itemprop="keywords" content="constructor injection, dependency injection, dependency injection framework, dependency injection is evil, downsides of dependency injection, drawbacks of dependency injection, field injection, setter injection"/><meta itemprop="description" content="While dependency injection is a natural object-oriented mechanism, DI frameworks turn it into an anti-pattern."/><meta name="description" content="While dependency injection is a natural object-oriented mechanism, DI frameworks turn it into an anti-pattern."/><meta name="keywords" content="constructor injection, dependency injection, dependency injection framework, dependency injection is evil, downsides of dependency injection, drawbacks of dependency injection, field injection, setter injection"/><meta name="viewport" content="width=device-width, initial-scale=1.0"/><meta name="twitter:creator" content="@yegor256"/><meta property="twitter:account_id" content="4503599630178231"/><meta property="og:url" content="http://www.yegor256.com/2014/10/03/di-containers-are-evil.html"/><meta property="og:site_name" content="yegor256"/><meta property="og:title" content="Dependency Injection Containers are Code Polluters"/><meta property="og:description" content="While dependency injection is a natural object-oriented mechanism, DI frameworks turn it into an anti-pattern."/><meta property="og:type" content="article"/><meta property="og:locale" content="en_US"/><meta property="fb:admins" content="10203747823006002"/><meta name="twitter:site" content="@yegor256"/><meta name="twitter:creator" content="@yegor256"/><meta name="twitter:url" content="http://www.yegor256.com/2014/10/03/di-containers-are-evil.html"/><meta property="article:author" content="https://www.facebook.com/yegor.bugayenko"/><meta name="p:domain_verify" content="61f09f0ef5db665328827225a3fc11bd"/><link rel="search" type="application/opensearchdescription+xml" href="opensearch.xml" title="yegor256"/><link rel="shortcut icon" href="/favicon.ico?55dd10e"/><link rel="apple-touch-icon" href="/favicon.ico?55dd10e"/><link rel="alternate" type="application/rss+xml" title="RSS for yegor256.com" href="http://www.yegor256.com/rss.xml"/><link rel="author" href="http://plus.google.com/u/0/114792568016408327418?rel=author"/><link rel="publisher" href="http://plus.google.com/u/0/114792568016408327418"/><link rel="stylesheet" href="/css/layout.css?55dd10e"/><link rel="canonical" href="http://www.yegor256.com/2014/10/03/di-containers-are-evil.html"/><title>Dependency Injection Containers are Code Polluters - Yegor Bugayenko</title></head><body><div class="wrapper"> <header class="header"><div class="face"> <a href="/about-me.html"> <img src="/images/yegor-bugayenko-192x192.png" class="photo" alt="photo of Yegor Bugayenko"/> </a> <a href="/about-me.html"><span>hire me!</span></a></div> <nav><ul class="menu social notranslate"><li><a href="http://www.twitter.com/yegor256" title="follow me in Twitter"><i class="icon icon-twitter notranslate" aria-hidden="true"></i></a></li><li><a href="/rss" title="RSS feed"><i class="icon icon-rss notranslate" aria-hidden="true"></i></a></li><li><a href="https://github.com/yegor256" title="my GitHub profile"><i class="icon icon-github notranslate" aria-hidden="true"></i></a></li><li><a href="http://stackoverflow.com/users/187141/yegor256" title="my StackOverflow profile"><i class="icon icon-stackoverflow notranslate" aria-hidden="true"></i></a></li><li><a href="https://www.facebook.com/yegor.bugayenko" title="follow me in Facebook"><i class="icon icon-facebook notranslate" aria-hidden="true"></i></a></li><li><a href="https://plus.google.com/+YegorBugayenko/posts" title="follow me in Google+"><i class="icon icon-googleplus notranslate" aria-hidden="true"></i></a></li><li><a href="https://www.linkedin.com/in/yegor256" title="my LinkedIn profile"><i class="icon icon-linkedin notranslate" aria-hidden="true"></i></a></li><li><a href="http://www.youtube.com/user/technoparkcorp" title="my Youtube video channel"><i class="icon icon-youtube notranslate" aria-hidden="true"></i></a></li><li><a href="https://www.pinterest.com/yegor256/" title="my Pinterest boards"><i class="icon icon-pinterest notranslate" aria-hidden="true"></i></a></li><li><a href="mailto:yegor@teamed.io" title="yegor@teamed.io"><i class="icon icon-mail notranslate" aria-hidden="true"></i></a></li></ul><ul class="menu"><li> <a href="/" title="home page">home</a> · <a href="/best.html" title="best articles to read">12 best</a> · <a href="/contents.html" title="blog contents">all 151</a> · <a href="/webinars.html" title="webinars">webinars</a> · <a href="/talks.html" title="talks">talks</a> · <a href="/award.html" title="software quality award">award</a></li></ul> </nav><div id="search"><form action="https://www.google.com/search" style="position:relative"> <input name="sitesearch" value="yegor256.com" type="hidden"/> <input id="search-query" class="field field-text" onfocusin="$('#google').css('display', 'inline-block');" name="q" placeholder="Search" autocomplete="off"/> <input type="image" src="/images/google-search-icon.png" id="google" title="search via Google" style="width:3em;height:3em;display:none;position:absolute;margin-left:1em"/></form><div id="search-results" style="display:none"><div class="entries"></div></div></div> <script id="search-results-template" type="text/mustache">
          {{#entries}}
            <div>
              <a href="{{url}}">{{title}}</a>
            </div>
          {{/entries}}
        </script></header><div class="hot"><ul><li> Meet me in Berlin, Nov 19-20, for a workshop about motivation in distributed teams, at <strong><a href="http://distributed-agile-teams.org/workshops/">DATFlock2015</a></strong>. Two <a href="/talks.html">more talks</a> in November, in Kyiv and Warsaw...</li><li> <a href="https://plus.google.com/u/0/events/c6pfo5ku07kd5a92dgrmj5b1o6g">Webinar #9</a> will explain why Dependency Injection containers are a bad idea in OOP, don't miss it on December 1, at 11am PST</li></ul></div></div> <section itemscope="" itemtype="http://schema.org/BlogPosting"><div class="wrapper"> <header><p class="printable"> <code>http://www.yegor256.com/2014/10/03/di-containers-are-evil.html</code></p><h1 itemprop="name">Dependency Injection Containers are Code Polluters</h1><ul class="subline"><li> <time itemprop="datePublished" datetime="2014-10-03T00:00:00+00:00"> 3 October 2014 </time></li><li class='unprintable'><a href='https://github.com/yegor256/blog/commits/master/_posts/2014/oct/2014-10-03-di-containers-are-evil.md'>modified</a> on <time itemprop='dateModified' datetime='2015-11-06T01:45:37+0000'>6 November 2015</time></li><li class="printable">Yegor Bugayenko</li><li class="unprintable"> <i class="icon icon-comments"></i> <a href="http://www.yegor256.com/2014/10/03/di-containers-are-evil.html#disqus_thread">comments</a></li></ul><p class="unprintable"><a href='/tag/oop.html' class='tag notranslate'>oop</a> <a href='/tag/anti-pattern.html' class='tag notranslate'>anti-pattern</a></p><div class="buttons notranslate desktop-only"> <nav class="share" role="navigation"> <a href="http://www.facebook.com/sharer/sharer.php?u=http://www.yegor256.com/2014/10/03/di-containers-are-evil.html" title="Share on Facebook" class="button"> <span class="count count-facebook">0</span> <i class="icon icon-facebook notranslate" aria-hidden="true"></i> </a> <a href="https://twitter.com/share?url=http://www.yegor256.com/2014/10/03/di-containers-are-evil.html&amp;text=Dependency+Injection+Containers+are+Code+Polluters" title="Share on Twitter" class="button"> <span class="count count-twitter">0</span> <i class="icon icon-twitter notranslate" aria-hidden="true"></i> </a> <a href="https://plus.google.com/share?url=http://www.yegor256.com/2014/10/03/di-containers-are-evil.html" title="Share on Google+" class="button"> <span class="count count-googleplus">0</span> <i class="icon icon-googleplus notranslate" aria-hidden="true"></i> </a> <a href="https://www.linkedin.com/cws/share?url=http://www.yegor256.com/2014/10/03/di-containers-are-evil.html" title="Share on LinkedIn" class="button"> <span class="count count-linkedin">0</span> <i class="icon icon-linkedin notranslate" aria-hidden="true"></i> </a> <a href="http://www.stumbleupon.com/submit?url=http://www.yegor256.com/2014/10/03/di-containers-are-evil.html&amp;title=Dependency+Injection+Containers+are+Code+Polluters" title="Share on StumbleUpon" class="button"> <span class="count count-stumbleupon">0</span> <i class="icon icon-stumbleupon notranslate" aria-hidden="true"></i> </a> <a href="http://reddit.com/submit?url=http://www.yegor256.com/2014/10/03/di-containers-are-evil.html%3F2014-39&amp;title=Dependency+Injection+Containers+are+Code+Polluters" title="Share on Reddit" class="button"> <span class="count count-reddit">0</span> <i class="icon icon-reddit notranslate" aria-hidden="true"></i> </a> <a href="http://news.ycombinator.com/submitlink?u=http://www.yegor256.com/2014/10/03/di-containers-are-evil.html%3F2014-39&amp;t=Dependency+Injection+Containers+are+Code+Polluters" title="Share on Hacker News" class="button"> <i class="icon icon-hackernews notranslate" aria-hidden="true"></i> </a> </nav></div> </header> <main> <article class="main" itemprop="articleBody"><p>While <a href="http://martinfowler.com/articles/injection.html">dependency injection</a> (aka, "DI") is a natural technique of composing objects in OOP (known long before the term was <a href="http://www.martinfowler.com/articles/injection.html">introduced by Martin Fowler</a>), <a href="http://www.spring.io">Spring IoC</a>, <a href="https://code.google.com/p/google-guice/">Google Guice</a>, <a href="http://docs.oracle.com/javaee/6/tutorial/doc/giwhl.html">Java EE6 CDI</a>, <a href="http://square.github.io/dagger/">Dagger</a> and other <a href="https://en.wikipedia.org/wiki/Dependency_injection">DI frameworks</a> turn it into an anti-pattern.</p><p>I'm not going to discuss obvious arguments against "setter injections" (like in <a href="http://www.springbyexample.org/examples/intro-to-ioc-basic-setter-injection.html">Spring IoC</a>) and "field injections" (like in <a href="http://picocontainer.codehaus.org/annotated-field-injection.html">PicoContainer</a>). These mechanisms simply violate basic principles of object-oriented programming and encourage us to create incomplete, mutable objects, that get stuffed with data during the course of application execution. Remember: ideal objects <a href="/2014/06/09/objects-should-be-immutable.html">must be immutable</a> and <a href="/2014/09/16/getters-and-setters-are-evil.html">may not contain setters</a>.</p><p>Instead, let's talk about "constructor injection" (like in <a href="https://github.com/google/guice/wiki/Injections#constructor-injection">Google Guice</a>) and its use with <strong>dependency injection containers</strong>. I'll try to show why I consider these containers a redundancy, at least.</p><h2 id="what-is-dependency-injection?">What is Dependency Injection?</h2><p>This is what dependency injection is (not really different from a plain old object composition):</p><div class="highlight"><pre><code class="language-java" data-lang="java"><span class="kd">public</span> <span class="kd">class</span> <span class="nc">Budget</span> <span class="o">{</span>
  <span class="kd">private</span> <span class="kd">final</span> <span class="n">DB</span> <span class="n">db</span><span class="o">;</span>
  <span class="kd">public</span> <span class="nf">Budget</span><span class="o">(</span><span class="n">DB</span> <span class="n">data</span><span class="o">)</span> <span class="o">{</span>
    <span class="k">this</span><span class="o">.</span><span class="na">db</span> <span class="o">=</span> <span class="n">data</span><span class="o">;</span>
  <span class="o">}</span>
  <span class="kd">public</span> <span class="kt">long</span> <span class="nf">total</span><span class="o">()</span> <span class="o">{</span>
    <span class="k">return</span> <span class="k">this</span><span class="o">.</span><span class="na">db</span><span class="o">.</span><span class="na">cell</span><span class="o">(</span>
      <span class="s">"SELECT SUM(cost) FROM ledger"</span>
    <span class="o">);</span>
  <span class="o">}</span>
<span class="o">}</span></code></pre></div><p>The object <code>data</code> is called a "dependency".</p><p>A <code>Budget</code> doesn't know what kind of database it is working with. All it needs from the database is its ability to fetch a cell, using an arbitrary SQL query, via method <code>cell()</code>. We can instantiate a <code>Budget</code> with a PostgreSQL implementation of the <code>DB</code> interface, for example:</p><div class="highlight"><pre><code class="language-java" data-lang="java"><span class="kd">public</span> <span class="kd">class</span> <span class="nc">App</span> <span class="o">{</span>
  <span class="kd">public</span> <span class="kd">static</span> <span class="kt">void</span> <span class="nf">main</span><span class="o">(</span><span class="n">String</span><span class="o">...</span> <span class="n">args</span><span class="o">)</span> <span class="o">{</span>
    <span class="n">Budget</span> <span class="n">budget</span> <span class="o">=</span> <span class="k">new</span> <span class="nf">Budget</span><span class="o">(</span>
      <span class="k">new</span> <span class="nf">Postgres</span><span class="o">(</span><span class="s">"jdbc:postgresql:5740/main"</span><span class="o">)</span>
    <span class="o">);</span>
    <span class="n">System</span><span class="o">.</span><span class="na">out</span><span class="o">.</span><span class="na">println</span><span class="o">(</span><span class="s">"Total is: "</span> <span class="o">+</span> <span class="n">budget</span><span class="o">.</span><span class="na">total</span><span class="o">());</span>
  <span class="o">}</span>
<span class="o">}</span></code></pre></div><p>In other words, we're "injecting" a dependency into a new object <code>budget</code>.</p><p>An alternative to this "dependency injection" approach would be to let <code>Budget</code> decide what database it wants to work with:</p><div class="highlight"><pre><code class="language-java" data-lang="java"><span class="kd">public</span> <span class="kd">class</span> <span class="nc">Budget</span> <span class="o">{</span>
  <span class="kd">private</span> <span class="kd">final</span> <span class="n">DB</span> <span class="n">db</span> <span class="o">=</span> <span class="k">new</span> <span class="nf">Postgres</span><span class="o">(</span><span class="s">"jdbc:postgresql:5740/main"</span><span class="o">);</span>
  <span class="c1">// class methods</span>
<span class="o">}</span></code></pre></div><p>This is very dirty and leads to 1) code duplication, 2) inability to reuse, and 3) inability to test, etc. No need to discuss why. It's obvious.</p><p>Thus, dependency injection via a constructor is an amazing technique. Well, not even a technique, really. More like a feature of Java and all other object-oriented languages. It's expected that almost any object will want to encapsulate some knowledge (aka, a "state"). That's what constructors are for.</p><h2 id="what-is-a-di-container?">What is a DI Container?</h2><p>So far so good, but here comes the dark side — a dependency injection container. Here is how it works (let's use Google Guice as an example):</p><div class="highlight"><pre><code class="language-java" data-lang="java"><span class="kn">import</span> <span class="nn">javax.inject.Inject</span><span class="o">;</span>
<span class="kd">public</span> <span class="kd">class</span> <span class="nc">Budget</span> <span class="o">{</span>
  <span class="kd">private</span> <span class="kd">final</span> <span class="n">DB</span> <span class="n">db</span><span class="o">;</span>
  <span class="nd">@Inject</span>
  <span class="kd">public</span> <span class="nf">Budget</span><span class="o">(</span><span class="n">DB</span> <span class="n">data</span><span class="o">)</span> <span class="o">{</span>
    <span class="k">this</span><span class="o">.</span><span class="na">db</span> <span class="o">=</span> <span class="n">data</span><span class="o">;</span>
  <span class="o">}</span>
  <span class="c1">// same methods as above</span>
<span class="o">}</span></code></pre></div><p>Pay attention: the constructor is annotated with <a href="http://docs.oracle.com/javaee/6/api/javax/inject/Inject.html"><code>@Inject</code></a>.</p><p>Then, we're supposed to configure a container somewhere, when the application starts:</p><div class="highlight"><pre><code class="language-java" data-lang="java"><span class="n">Injector</span> <span class="n">injector</span> <span class="o">=</span> <span class="n">Guice</span><span class="o">.</span><span class="na">createInjector</span><span class="o">(</span>
  <span class="k">new</span> <span class="nf">AbstractModule</span><span class="o">()</span> <span class="o">{</span>
    <span class="nd">@Override</span>
    <span class="kd">public</span> <span class="kt">void</span> <span class="nf">configure</span><span class="o">()</span> <span class="o">{</span>
      <span class="k">this</span><span class="o">.</span><span class="na">bind</span><span class="o">(</span><span class="n">DB</span><span class="o">.</span><span class="na">class</span><span class="o">).</span><span class="na">toInstance</span><span class="o">(</span>
        <span class="k">new</span> <span class="nf">Postgres</span><span class="o">(</span><span class="s">"jdbc:postgresql:5740/main"</span><span class="o">)</span>
      <span class="o">);</span>
    <span class="o">}</span>
  <span class="o">}</span>
<span class="o">);</span></code></pre></div><p>Some frameworks even allow us to configure the injector in an XML file.</p><p>From now on, we are not allowed to instantiate <code>Budget</code> through the <code>new</code> operator, like we did before. Instead, we should use the injector we just created:</p><div class="highlight"><pre><code class="language-java" data-lang="java"><span class="kd">public</span> <span class="kd">class</span> <span class="nc">App</span> <span class="o">{</span>
  <span class="kd">public</span> <span class="kd">static</span> <span class="kt">void</span> <span class="nf">main</span><span class="o">(</span><span class="n">String</span><span class="o">...</span> <span class="n">args</span><span class="o">)</span> <span class="o">{</span>
    <span class="n">Injection</span> <span class="n">injector</span> <span class="o">=</span> <span class="c1">// as we just did in the previous snippet</span>
    <span class="n">Budget</span> <span class="n">budget</span> <span class="o">=</span> <span class="n">injector</span><span class="o">.</span><span class="na">getInstance</span><span class="o">(</span><span class="n">Budget</span><span class="o">.</span><span class="na">class</span><span class="o">);</span>
    <span class="n">System</span><span class="o">.</span><span class="na">out</span><span class="o">.</span><span class="na">println</span><span class="o">(</span><span class="s">"Total is: "</span> <span class="o">+</span> <span class="n">budget</span><span class="o">.</span><span class="na">total</span><span class="o">());</span>
  <span class="o">}</span>
<span class="o">}</span></code></pre></div><p>The injection automatically finds out that in order to instantiate a <code>Budget</code> it has to provide an argument for its constructor. It will use an instance of class <code>Postgres</code>, which we instantiated in the injector.</p><p>This is the right and recommended way to use Guice. There are a few even darker patterns, though, which are possible but not recommended. For example, you can make your injector a singleton and use it right inside the <code>Budget</code> class. These mechanisms are considered wrong even by DI container makers, however, so let's ignore them and focus on the recommended scenario.</p><h2 id="what-is-this-for?">What Is This For?</h2><p>Let me reiterate and summarize the scenarios of <strong>incorrect usage</strong> of dependency injection containers:</p><ul><li><p>Field injection</p></li><li><p>Setter injection</p></li><li><p>Passing injector as a dependency</p></li><li><p>Making injector a global singleton</p></li></ul><p>If we put all of them aside, all we have left is the constructor injection explained above. And how does that help us? Why do we need it? Why can't we use plain old <code>new</code> in the main class of the application?</p><p>The container we created simply adds more lines to the code base, or even more files, if we use XML. And it doesn't add anything, except an additional complexity. We should always remember this if we have the question: "What database is used as an argument of a Budget?"</p><h2 id="the-right-way">The Right Way</h2><p>Now, let me show you a real life example of using <code>new</code> to construct an application. This is how we create a "thinking engine" in <a href="http://www.rultor.com">rultor.com</a> (full class is in <a href="https://github.com/yegor256/rultor/blob/1.34/src/main/java/com/rultor/agents/Agents.java"><code>Agents.java</code></a>):</p><p><script src="https://gist.github.com/c76c06baee1f74e3100e.js?file=Agents.java"></script></p><p>Impressive? This is a true object composition. I believe this is how a proper object-oriented application should be instantiated.</p><p>And DI containers? In my opinion, they just add unnecessary noise.</p></article> </main><div class="unprintable"><h2>Related Posts</h2><p>You may also find these posts interesting:</p><ul><li><a href="/2014/09/16/getters-and-setters-are-evil.html">Getters/Setters. Evil. Period.</a></li><li><a href="/2014/09/10/anti-patterns-in-oop.html">Anti-Patterns in OOP</a></li><li><a href="/2014/06/19/avoid-string-concatenation.html">Avoid String Concatenation</a></li><li><a href="/2014/06/09/objects-should-be-immutable.html">Objects Should Be Immutable</a></li><li><a href="/2014/05/13/why-null-is-bad.html">Why NULL is Bad?</a></li></ul></div><div class="teamed-banner"> <a href="http://www.teamed.io"><img src="/images/teamed-banner.jpg" alt="teamed banner"/></a></div></div><div class="disqus" role="complementary"><div id="disqus_thread"></div> <a href="http://disqus.com" class="dsq-brlink"> comments powered by <span class="logo-disqus">Disqus</span> </a></div><div class="wrapper"> <footer class="footer"><p> © <span itemprop="author">Yegor Bugayenko</span>, 2014-2015</p> </footer></div></section><script src="http://code.jquery.com/jquery-2.1.0.min.js"></script><script src="/js/ext/search.min.js?55dd10e"></script><script src="/js/global.js?55dd10e"></script><script src="/js/post.js?55dd10e"></script><script>!function(e,a,t,n,c,o,s){e.GoogleAnalyticsObject=c,e[c]=e[c]||function(){(e[c].q=e[c].q||[]).push(arguments)},e[c].l=1*new Date,o=a.createElement(t),s=a.getElementsByTagName(t)[0],o.async=1,o.src=n,s.parentNode.insertBefore(o,s)}(window,document,"script","//www.google-analytics.com/analytics.js","ga"),ga("create","UA-1963507-32","auto"),ga("send","pageview")</script></body></html>