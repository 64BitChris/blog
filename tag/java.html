<!DOCTYPE html> <html xmlns="http://www.w3.org/1999/xhtml" lang="en-US" xml:lang="en-US" itemscope="" itemtype="http://schema.org/WebSite"> <head> <meta charset="utf-8"/> <meta name="description" content="java: more about java in this collection of recently published articles... the list is updated every few weeks." /> <meta name="keywords" content="" /> <meta name="viewport" content="width=device-width,minimum-scale=1,initial-scale=1"/> <meta name="google-site-verification" content="JEj_gQr2CPe2QKGw8XdMz0R7VboQIUbX3FlM-lwTq-8" /> <meta name="author" content="Yegor Bugayenko"> <meta name="og:site_name" content="Yegor Bugayenko"/> <meta name="og:type" content="article" /> <meta name="og:locale" content="en_US" /> <meta name="twitter:account_id" content="4503599630178231" /> <meta name="twitter:creator" content="@yegor256"/> <meta name="twitter:site" content="@yegor256"/> <meta name="twitter:title" property="og:title" content="java"/> <meta name="twitter:description" property="og:description" content="java: more about java in this collection of recently published articles... the list is updated every few weeks."/> <meta name="twitter:url" property="og:url" content="https://www.yegor256.com/tag/java"/> <meta name="telegram:channel" content="AAAAAEJFMRzsRTRxM3ec6A"/> <link rel="search" type="application/opensearchdescription+xml" href="/opensearch.xml" title="yegor256" /> <link rel="shortcut icon" href="/favicon.ico?4e047f6f42b"/> <link rel="apple-touch-icon" href="/favicon.ico?4e047f6f42b"/> <link rel="alternate" type="application/rss+xml" title="RSS for yegor256.com" href="https://www.yegor256.com/rss.xml"/> <link rel="stylesheet" href="/css/layout.css?4e047f6f42b"/> <link rel="stylesheet" href="/css/icons.css?4e047f6f42b"/> <link rel="canonical" href="https://www.yegor256.com/tag/java" /> <link rel="amphtml" href="https://www.yegor256.com/tag/java" /> <title>java </title> </head> <body><div class="wrapper"> <aside class="header-toggle unprintable" id="header-toggle" title="Show the menu" onclick="$('#header').show();$('#header-toggle').hide();">&#9776;</aside> <header class="header" id="header"><div class="face"> <a href="/about-me.html#form" class="sub" title="Click to subscribe to my monthly newsletter"><span>Subscribe</span></a> <a href="/about-me.html" style="position:relative;"> <img src="/images/face-256x256.jpg" class="photo" alt="Yegor Bugayenko"/> </a></div><nav><ul class="menu social notranslate"> <li><a href="https://twitter.com/intent/follow?screen_name=yegor256" rel="nofollow" title="Follow me on Twitter"><i class="icon icon-twitter notranslate" aria-hidden="true"></i></a></li> <li><a href="/rss.xml" rel="nofollow" title="Subscribe to my RSS feed"><i class="icon icon-rss notranslate" aria-hidden="true"></i></a></li> <li><a itemprop="sameAs" href="https://github.com/yegor256" rel="nofollow" title="My GitHub profile"><i class="icon icon-github notranslate" aria-hidden="true"></i></a></li> <li><a itemprop="sameAs" href="http://stackoverflow.com/users/187141/yegor256" rel="nofollow" title="My StackOverflow profile"><i class="icon icon-stackoverflow notranslate" aria-hidden="true"></i></a></li> <li><a itemprop="sameAs" href="https://www.facebook.com/yegor256" rel="nofollow" title="Follow me on Facebook"><i class="icon icon-facebook notranslate" aria-hidden="true"></i></a></li> <li><a itemprop="sameAs" href="https://instagram.com/yegor256" rel="nofollow" title="Follow me on Instagram"><i class="icon icon-instagram notranslate" aria-hidden="true"></i></a></li> <li><a itemprop="sameAs" href="https://www.linkedin.com/in/yegor256" rel="nofollow" title="My LinkedIn profile"><i class="icon icon-linkedin notranslate" aria-hidden="true"></i></a></li> <li><a itemprop="sameAs" href="https://www.youtube.com/c/yegor256?sub_confirmation=1" rel="nofollow" title="My Youtube video channel"><i class="icon icon-youtube notranslate" aria-hidden="true"></i></a></li> <li><a itemprop="sameAs" href="https://www.pinterest.com/yegor256/" rel="nofollow" title="My Pinterest boards"><i class="icon icon-pinterest notranslate" aria-hidden="true"></i></a></li> <li><a itemprop="sameAs" href="https://angel.co/yegor256" rel="nofollow" title="My AngelList profile"><i class="icon icon-angellist notranslate" aria-hidden="true"></i></a></li> <li><a href="https://soundcloud.com/yegor256" rel="nofollow" title="My podcast"><i class="icon icon-podcast notranslate" aria-hidden="true"></i></a></li> <li><a href="https://itunes.apple.com/us/podcast/yegor256-podcast/id1150826721" rel="nofollow" title="My iTunes podcast"><i class="icon icon-itunes notranslate" aria-hidden="true"></i></a></li> <li><a href="https://t.me/joinchat/AAAAAEJFMRzsRTRxM3ec6A" rel="nofollow" title="My Telegram public channel"><i class="icon icon-telegram notranslate" aria-hidden="true"></i></a></li> <li><a href="mailto:blog@yegor256.com" rel="nofollow" title="Email me any time"><i class="icon icon-mail notranslate" aria-hidden="true"></i></a></li></ul><ul class="menu"> <li><a href="/" title="Home page">Home</a></li> <li ><a href="/best.html" title="Best articles to read">12&#160;Best</a></li> <li ><a href="/contents.html" title="The contents of the entire blog">All&#160;288</a></li> <li ><a href="/webinars.html" title="My webinars">Webinars</a></li> <li ><a href="/talks.html" title="Future and past conference talks">Talks</a></li> <li ><a href="/books.html" title="The books I wrote">Books</a></li> <li ><a href="/papers.html" title="My academic papers and patents">Papers</a></li> <li ><a href="/pets.html" title="My loved pet projects">Pets</a></li> <li ><a href="/award.html" title="Software quality award">Award</a></li> <li ><a href="/testimonials.html" title="What some people say about me">Testimonials</a></li> <li ><a href="/shift-m.html" title="Audio podcast about project management">Shift-M</a></li> <li ><a href="/paintings.html" title="My paintings for sale">Paintings</a></li> <li><a href="http://ru.yegor256.com/" title="Немного на русском языке">По-русски</a></li></ul></nav><div class="search"> <form method="get" action="https://www.google.com/search" itemprop="potentialAction" itemscope="" itemtype="http://schema.org/SearchAction"> <meta itemprop="target" content="https://www.google.com/search?q={q}"/> <input name="sitesearch" value="yegor256.com" type="hidden"/> <input itemprop="query-input" type="text" id="search-query" class="field field-text" required="required" onfocus="$('.google').css('visibility', 'visible');" name="q" placeholder="Search..." autocomplete="off"/> <input type="image" src="/images/google-search-icon.svg" class="google" title="Search via Google" alt="Search via Google"/> </form></div><div class="hot"><ul> <li> <a href="/code-ahead.html">Code Ahead</a> was published on Amazon just a few days ago! It is my new book, a novel about programmers. It explains in details the majority of ideas that stand behind <a href="https://www.zerocracy.com">Zerocracy</a> and <a href="https://www.xdsd.org">XDSD</a>. </li> <li> At <a href="/webinars.html">Webinar #37</a> we will discuss naming problem in OOP, for objects, methods and attributes; join us on <b>September 12</b>, at 11am PST. </li></ul></div></header></div><section itemscope="" itemtype="http://schema.org/BlogPosting"><div class="wrapper"> <header itemprop="name"><h1>77 Posts About Java&trade;</h1><p> <img alt="Java logo" src="/images/java-icon.svg" style="height:150px;float:right;margin-left:1em"/></p></header> <article itemprop="articleBody"> <!DOCTYPE html> <html xmlns="http://www.w3.org/1999/xhtml" lang="en-US" xml:lang="en-US" itemscope="" itemtype="http://schema.org/WebSite"> <head> <meta charset="utf-8"/> <meta name="description" content="Giving good names to methods in object-oriented programming is a tough job, which can be done right if you follow this simple principle. " /> <meta name="keywords" content="good name for a method, java method name, method name in oop, method naming, method naming best practices" /> <meta name="viewport" content="width=device-width,minimum-scale=1,initial-scale=1"/> <meta name="google-site-verification" content="JEj_gQr2CPe2QKGw8XdMz0R7VboQIUbX3FlM-lwTq-8" /> <meta name="author" content="Yegor Bugayenko"> <meta name="article:published_time" content="2018-08-22 00:00:00 +0000"> <meta name="og:site_name" content="Yegor Bugayenko"/> <meta name="og:type" content="article" /> <meta name="og:locale" content="en_US" /> <meta name="twitter:account_id" content="4503599630178231" /> <meta name="twitter:creator" content="@yegor256"/> <meta name="twitter:site" content="@yegor256"/> <meta name="twitter:title" property="og:title" content="Builders and Manipulators"/> <meta name="twitter:description" property="og:description" content="Giving good names to methods in object-oriented programming is a tough job, which can be done right if you follow this simple principle. "/> <meta name="twitter:url" property="og:url" content="https://www.yegor256.com/2018/08/22/builders-and-manipulators.html"/> <meta name="telegram:channel" content="AAAAAEJFMRzsRTRxM3ec6A"/> <link rel="search" type="application/opensearchdescription+xml" href="/opensearch.xml" title="yegor256" /> <link rel="shortcut icon" href="/favicon.ico?4e047f6f42b"/> <link rel="apple-touch-icon" href="/favicon.ico?4e047f6f42b"/> <link rel="alternate" type="application/rss+xml" title="RSS for yegor256.com" href="https://www.yegor256.com/rss.xml"/> <link rel="stylesheet" href="/css/layout.css?4e047f6f42b"/> <link rel="stylesheet" href="/css/icons.css?4e047f6f42b"/> <link rel="canonical" href="https://www.yegor256.com/2018/08/22/builders-and-manipulators.html" /> <link rel="amphtml" href="https://www.yegor256.com/2018/08/22/builders-and-manipulators.amp.html" /> <title>Builders and Manipulators </title> <meta name='og:image' content='https://www.yegor256.com/images/2018/08/the-night-of.jpg'/><meta name='twitter:image' content='https://www.yegor256.com/images/2018/08/the-night-of.jpg'/><meta name='og:image:width' content='1600'/> <meta name='twitter:image:width' content='1600'/><meta name='og:image:height' content='898'/> <meta name='twitter:image:height' content='898'/><meta name='twitter:card' content='summary_large_image'/><meta name='twitter:image:alt' content='The Night Of (2016) by Richard Price et al.'/> </head> <body><div class="wrapper"> <aside class="header-toggle unprintable" id="header-toggle" title="Show the menu" onclick="$('#header').show();$('#header-toggle').hide();">&#9776;</aside> <header class="header" id="header"><div class="face"> <a href="/about-me.html#form" class="sub" title="Click to subscribe to my monthly newsletter"><span>Subscribe</span></a> <a href="/about-me.html" style="position:relative;"> <img src="/images/face-256x256.jpg" class="photo" alt="Yegor Bugayenko"/> </a></div><nav><ul class="menu social notranslate"> <li><a href="https://twitter.com/intent/follow?screen_name=yegor256" rel="nofollow" title="Follow me on Twitter"><i class="icon icon-twitter notranslate" aria-hidden="true"></i></a></li> <li><a href="/rss.xml" rel="nofollow" title="Subscribe to my RSS feed"><i class="icon icon-rss notranslate" aria-hidden="true"></i></a></li> <li><a itemprop="sameAs" href="https://github.com/yegor256" rel="nofollow" title="My GitHub profile"><i class="icon icon-github notranslate" aria-hidden="true"></i></a></li> <li><a itemprop="sameAs" href="http://stackoverflow.com/users/187141/yegor256" rel="nofollow" title="My StackOverflow profile"><i class="icon icon-stackoverflow notranslate" aria-hidden="true"></i></a></li> <li><a itemprop="sameAs" href="https://www.facebook.com/yegor256" rel="nofollow" title="Follow me on Facebook"><i class="icon icon-facebook notranslate" aria-hidden="true"></i></a></li> <li><a itemprop="sameAs" href="https://instagram.com/yegor256" rel="nofollow" title="Follow me on Instagram"><i class="icon icon-instagram notranslate" aria-hidden="true"></i></a></li> <li><a itemprop="sameAs" href="https://www.linkedin.com/in/yegor256" rel="nofollow" title="My LinkedIn profile"><i class="icon icon-linkedin notranslate" aria-hidden="true"></i></a></li> <li><a itemprop="sameAs" href="https://www.youtube.com/c/yegor256?sub_confirmation=1" rel="nofollow" title="My Youtube video channel"><i class="icon icon-youtube notranslate" aria-hidden="true"></i></a></li> <li><a itemprop="sameAs" href="https://www.pinterest.com/yegor256/" rel="nofollow" title="My Pinterest boards"><i class="icon icon-pinterest notranslate" aria-hidden="true"></i></a></li> <li><a itemprop="sameAs" href="https://angel.co/yegor256" rel="nofollow" title="My AngelList profile"><i class="icon icon-angellist notranslate" aria-hidden="true"></i></a></li> <li><a href="https://soundcloud.com/yegor256" rel="nofollow" title="My podcast"><i class="icon icon-podcast notranslate" aria-hidden="true"></i></a></li> <li><a href="https://itunes.apple.com/us/podcast/yegor256-podcast/id1150826721" rel="nofollow" title="My iTunes podcast"><i class="icon icon-itunes notranslate" aria-hidden="true"></i></a></li> <li><a href="https://t.me/joinchat/AAAAAEJFMRzsRTRxM3ec6A" rel="nofollow" title="My Telegram public channel"><i class="icon icon-telegram notranslate" aria-hidden="true"></i></a></li> <li><a href="mailto:blog@yegor256.com" rel="nofollow" title="Email me any time"><i class="icon icon-mail notranslate" aria-hidden="true"></i></a></li></ul><ul class="menu"> <li><a href="/" title="Home page">Home</a></li> <li ><a href="/best.html" title="Best articles to read">12&#160;Best</a></li> <li ><a href="/contents.html" title="The contents of the entire blog">All&#160;288</a></li> <li ><a href="/webinars.html" title="My webinars">Webinars</a></li> <li ><a href="/talks.html" title="Future and past conference talks">Talks</a></li> <li ><a href="/books.html" title="The books I wrote">Books</a></li> <li ><a href="/papers.html" title="My academic papers and patents">Papers</a></li> <li ><a href="/pets.html" title="My loved pet projects">Pets</a></li> <li ><a href="/award.html" title="Software quality award">Award</a></li> <li ><a href="/testimonials.html" title="What some people say about me">Testimonials</a></li> <li ><a href="/shift-m.html" title="Audio podcast about project management">Shift-M</a></li> <li ><a href="/paintings.html" title="My paintings for sale">Paintings</a></li> <li><a href="http://ru.yegor256.com/" title="Немного на русском языке">По-русски</a></li></ul></nav><div class="search"> <form method="get" action="https://www.google.com/search" itemprop="potentialAction" itemscope="" itemtype="http://schema.org/SearchAction"> <meta itemprop="target" content="https://www.google.com/search?q={q}"/> <input name="sitesearch" value="yegor256.com" type="hidden"/> <input itemprop="query-input" type="text" id="search-query" class="field field-text" required="required" onfocus="$('.google').css('visibility', 'visible');" name="q" placeholder="Search..." autocomplete="off"/> <input type="image" src="/images/google-search-icon.svg" class="google" title="Search via Google" alt="Search via Google"/> </form></div><div class="hot"><ul> <li> <a href="/code-ahead.html">Code Ahead</a> was published on Amazon just a few days ago! It is my new book, a novel about programmers. It explains in details the majority of ideas that stand behind <a href="https://www.zerocracy.com">Zerocracy</a> and <a href="https://www.xdsd.org">XDSD</a>. </li> <li> At <a href="/webinars.html">Webinar #37</a> we will discuss naming problem in OOP, for objects, methods and attributes; join us on <b>September 12</b>, at 11am PST. </li></ul></div></header></div><section itemscope="" itemtype="http://schema.org/BlogPosting"><div class="wrapper"> <header><p class="printable"> <img src="https://api.qrserver.com/v1/create-qr-code/?data=https://www.yegor256.com/2018/08/22/builders-and-manipulators.html&amp;format=svg" style="width:125px;height:125px;" alt="QR code"/></p><p class="printable"> <code itemprop="url">https://www.yegor256.com/2018/08/22/builders-and-manipulators.html</code></p><h1 itemprop="name headline mainEntityOfPage">Builders and Manipulators</h1><aside class='book'><a href='http://amzn.to/2qFt4Tn'><img src='/images/books/elegant-objects/cover.png' class='book-cover' alt='book cover'/></a>Read more about this subject in <a href='http://amzn.to/2qFt4Tn'>Section&nbsp;2.4</a><br/> of my book<a href='http://amzn.to/2qFt4Tn'><img src='/images/books/amazon-buy-button.png' class='amazon-button' alt='Click to buy'/></a></aside><ul class="subline"> <li> <time itemprop="datePublished" datetime="2018-08-22T00:00:00+00:00"> 22 August 2018 </time> </li> <li class="desktop-only" itemprop="locationCreated">Palo Alto, CA</li> <li class="printable" itemscope="" itemprop="author" itemtype="http://schema.org/Person"> <span itemprop="name">Yegor Bugayenko</span> </li> <li class="unprintable"> <i class="icon icon-comments"></i> <a href="http://www.yegor256.com/2018/08/22/builders-and-manipulators.html#disqus_thread" itemprop="discussionUrl">comments</a> </li></ul><figure class='jb_picture'><img itemprop='image' alt='The Night Of (2016) by Richard Price et al.' src='/images/2018/08/the-night-of.jpg' longdesc='#e86c0384'/><figcaption id='e86c0384'>The Night Of (2016) by Richard Price et al.</figcaption></figure><p>First, I have to say that this idea is very similar to the one suggested by <a href="https://en.wikipedia.org/wiki/Bertrand_Meyer">Bertrand Meyer</a> in his book <a href="https://amzn.to/2MWEuJP">Object Oriented Software Construction</a>, where he proposes we divide an object&#39;s methods into two sharply separated categories: queries and commands.</p><p>The idea behind this principle is rather philosophical. Let&#39;s start with builders, which are supposed to create or find an object and then return it. Suppose I have a store of books and I ask it to give me a book by name:</p><figure class="highlight"><pre><code class="language-java" data-lang="java"><span></span><span class="kd">interface</span> <span class="nc">Bookshelf</span> <span class="o">{</span>
  <span class="n">Book</span> <span class="nf">find</span><span class="o">(</span><span class="n">String</span> <span class="n">title</span><span class="o">);</span>
<span class="o">}</span></code></pre></figure><p>It&#39;s obviously a &quot;builder&quot; (or a &quot;query&quot; in Meyer&#39;s terms). I ask for a book and it&#39;s given to me. The problem, though, is with the name of the method. It&#39;s called &quot;find,&quot; which implies that I know how the book will be dealt with. It will be found.</p><p>However, this is not how we should treat our objects. We must not tell them how to do the job we want them to do. Instead, we must let <em>them</em> decide whether the book will be found, constructed, or maybe taken from a memory cache. When we query, we have to say what result we are looking for and let the object make the decision about the way this result is going to be built. A much more appropriate name for this method would be <code>book()</code>:</p><figure class="highlight"><pre><code class="language-java" data-lang="java"><span></span><span class="kd">interface</span> <span class="nc">Bookshelf</span> <span class="o">{</span>
  <span class="n">Book</span> <span class="nf">book</span><span class="o">(</span><span class="n">String</span> <span class="n">title</span><span class="o">);</span>
<span class="o">}</span></code></pre></figure><p>The rule of thumb is: a builder is always a noun. If the method returns something, it has to be a noun. Preferably its name should explain what the method returns. If it&#39;s a book, name it <code>book()</code>. If it&#39;s a file, call the method <code>file()</code>, etc. Here are a few good builder examples:</p><figure class="highlight"><pre><code class="language-java" data-lang="java"><span></span><span class="kd">interface</span> <span class="nc">Foo</span> <span class="o">{</span>
  <span class="kt">float</span> <span class="nf">speed</span><span class="o">(</span><span class="n">Actor</span> <span class="n">actor</span><span class="o">);</span>
  <span class="n">Money</span> <span class="nf">salary</span><span class="o">(</span><span class="n">User</span> <span class="n">user</span><span class="o">);</span>
  <span class="n">File</span> <span class="nf">database</span><span class="o">();</span>
  <span class="n">Date</span> <span class="nf">deadline</span><span class="o">(</span><span class="n">Project</span> <span class="n">project</span><span class="o">,</span> <span class="n">User</span> <span class="n">user</span><span class="o">);</span>
<span class="o">}</span></code></pre></figure><p>Here, on the contrary, are a few examples of badly named builders:</p><figure class="highlight"><pre><code class="language-java" data-lang="java"><span></span><span class="kd">interface</span> <span class="nc">Foo</span> <span class="o">{</span>
  <span class="kt">float</span> <span class="nf">calculateSpeed</span><span class="o">(</span><span class="n">Actor</span> <span class="n">actor</span><span class="o">);</span>
  <span class="n">Money</span> <span class="nf">getSalary</span><span class="o">(</span><span class="n">User</span> <span class="n">user</span><span class="o">);</span>
  <span class="n">File</span> <span class="nf">openDatabase</span><span class="o">();</span>
  <span class="n">Date</span> <span class="nf">readDeadline</span><span class="o">(</span><span class="n">Project</span> <span class="n">project</span><span class="o">,</span> <span class="n">User</span> <span class="n">user</span><span class="o">);</span>
<span class="o">}</span></code></pre></figure><p>There is no place for a verb in a builder&#39;s name!</p><p>It&#39;s not only about the name, by the way. A builder, since its name doesn&#39;t contain a verb, should not do any modifications to the encapsulated entities. It may only create or find something and return it. Just like a <a href="https://en.wikipedia.org/wiki/Pure_function">pure function</a>, it must not have any side-effects.</p><p>Next, there are &quot;manipulators&quot; (or &quot;commands&quot; in Meyer&#39;s terms). They do some work for us, modifying the entities, which the object encapsulates. They are the opposite to builders, because they actually make changes to the world abstracted by the object. For example, we ask the <code>Bookshelf</code> to add a new book to itself:</p><figure class="highlight"><pre><code class="language-java" data-lang="java"><span></span><span class="kd">interface</span> <span class="nc">Bookshelf</span> <span class="o">{</span>
  <span class="kt">void</span> <span class="nf">add</span><span class="o">(</span><span class="n">Book</span> <span class="n">book</span><span class="o">);</span>
<span class="o">}</span></code></pre></figure><p>The method adds the book to the storage. How exactly the storage will be modified, we don&#39;t know. But we know that since the name of the method is a verb, there will be modifications.</p><p>Also, manipulators must not return anything. It&#39;s always <code>void</code> that we see as the type of their response. This is needed mostly in order to separate the imperative part of the code from the declarative part. We either receive objects or tell them what to do. We must not mix those activities in one method.</p><p>The purpose of these rules is to make the code simpler. If you follow them, and all your builders only return objects and your manipulators only modify the world, the entire design will become easier to understand. Methods will be smaller and their names shorter.</p><p>Of course, very often you will have a hard time finding those names. From time to time you will want to return something from a manipulator or make your builder make some changes, say to the cache. Try to resist this temptation and stay with the principle: a method is either a builder or a manipulator, nothing in the middle. The examples above are rather primitive, the code in real life is much more complicated. But that&#39;s what the principle is going to help us with---making the code simpler.</p><p>I&#39;m also aware of the <a href="http://steve-yegge.blogspot.com/2006/03/execution-in-kingdom-of-nouns.html">noun/verb</a> principle, which suggests always naming classes as nouns and their methods as verbs. I believe it&#39;s a wrong idea, since it doesn&#39;t differentiate builders from manipulators and encourages us to always think in terms of imperative instructions. I believe that OOP must be much more about declarative composition of objects, even if we have to sometimes get them from other objects instead of instantiating them via constructors. That&#39;s why we do need builders in most situations and we also have to see an obvious difference between them and the other methods, manipulators.</p><p>You can find a more detailed discussion of this problem in <a href="http://goo.gl/W2WVMk">Elegant Objects</a>, Volume 1, Section 2.4.</p><blockquote class="twitter-tweet" data-lang="en"><p lang="en" dir="ltr">How would you name a method of a class Document that reads and returns its content? <a href="https://twitter.com/hashtag/elegantobjects?src=hash&amp;ref_src=twsrc%5Etfw">#elegantobjects</a></p>&mdash; Yegor Bugayenko (@yegor256) <a href="https://twitter.com/yegor256/status/1033605343274840064?ref_src=twsrc%5Etfw">August 26, 2018</a></blockquote> <script async src="https://platform.twitter.com/widgets.js" charset="utf-8"></script></p>--> <nav class="buttons notranslate desktop-only"> <a href="http://www.facebook.com/sharer/sharer.php?u=https://www.yegor256.com/2018/08/22/builders-and-manipulators.html" title="Share on Facebook" class="button" rel="nofollow"> <span class="count count-facebook">0</span> <i class="icon icon-facebook notranslate" aria-hidden="true"></i> </a> <a href="https://twitter.com/share?url=https://www.yegor256.com/2018/08/22/builders-and-manipulators.html&amp;text=Builders+and+Manipulators" title="Share on Twitter" class="button" rel="nofollow"> <span class="count count-twitter">0</span> <i class="icon icon-twitter notranslate" aria-hidden="true"></i> </a> <a href="https://plus.google.com/share?url=https://www.yegor256.com/2018/08/22/builders-and-manipulators.html" title="Share on Google+" class="button" rel="nofollow"> <span class="count count-googleplus">0</span> <i class="icon icon-googleplus notranslate" aria-hidden="true"></i> </a> <a href="https://www.linkedin.com/cws/share?url=https://www.yegor256.com/2018/08/22/builders-and-manipulators.html" title="Share on LinkedIn" class="button" rel="nofollow"> <span class="count count-linkedin">0</span> <i class="icon icon-linkedin notranslate" aria-hidden="true"></i> </a> <a href="http://reddit.com/submit?url=https://www.yegor256.com/2018/08/22/builders-and-manipulators.html%3F2018-33&amp;title=Builders+and+Manipulators" title="Share on Reddit" class="button" rel="nofollow"> <span class="count count-reddit">0</span> <i class="icon icon-reddit notranslate" aria-hidden="true"></i> </a> <a href="http://news.ycombinator.com/submitlink?u=https://www.yegor256.com/2018/08/22/builders-and-manipulators.html%3F2018-33&amp;t=Builders+and+Manipulators" title="Share on Hacker News" class="button" rel="nofollow"> <span class="count count-hackernews">0</span> <i class="icon icon-hackernews notranslate" aria-hidden="true"></i> </a> </nav> </header> <article class="main" itemprop="articleBody"><div ><p>Here is a simple principle for naming methods in OOP, which I&#39;m trying to follow in my code: it&#39;s a <em>verb</em> if it <em>manipulates</em>, it&#39;s a <em>noun</em> if it <em>builds</em>. That&#39;s it. Nothing in between. Methods like <code>saveFile()</code> or <code>getTitle()</code> don&#39;t fit and must be renamed and refactored. Moreover, methods that &quot;manipulate&quot; must always return <code>void</code>, for example <code>print()</code> or <code>save()</code>. Let me explain.</p><figure class='jb_picture'><img itemprop='image' alt='The Night Of (2016) by Richard Price et al.' src='/images/2018/08/the-night-of.jpg' longdesc='#e86c0384'/><figcaption id='e86c0384'>The Night Of (2016) by Richard Price et al.</figcaption></figure><p>First, I have to say that this idea is very similar to the one suggested by <a href="https://en.wikipedia.org/wiki/Bertrand_Meyer">Bertrand Meyer</a> in his book <a href="https://amzn.to/2MWEuJP">Object Oriented Software Construction</a>, where he proposes we divide an object&#39;s methods into two sharply separated categories: queries and commands.</p><p>The idea behind this principle is rather philosophical. Let&#39;s start with builders, which are supposed to create or find an object and then return it. Suppose I have a store of books and I ask it to give me a book by name:</p><figure class="highlight"><pre><code class="language-java" data-lang="java"><span></span><span class="kd">interface</span> <span class="nc">Bookshelf</span> <span class="o">{</span>
  <span class="n">Book</span> <span class="nf">find</span><span class="o">(</span><span class="n">String</span> <span class="n">title</span><span class="o">);</span>
<span class="o">}</span></code></pre></figure><p>It&#39;s obviously a &quot;builder&quot; (or a &quot;query&quot; in Meyer&#39;s terms). I ask for a book and it&#39;s given to me. The problem, though, is with the name of the method. It&#39;s called &quot;find,&quot; which implies that I know how the book will be dealt with. It will be found.</p><p>However, this is not how we should treat our objects. We must not tell them how to do the job we want them to do. Instead, we must let <em>them</em> decide whether the book will be found, constructed, or maybe taken from a memory cache. When we query, we have to say what result we are looking for and let the object make the decision about the way this result is going to be built. A much more appropriate name for this method would be <code>book()</code>:</p><figure class="highlight"><pre><code class="language-java" data-lang="java"><span></span><span class="kd">interface</span> <span class="nc">Bookshelf</span> <span class="o">{</span>
  <span class="n">Book</span> <span class="nf">book</span><span class="o">(</span><span class="n">String</span> <span class="n">title</span><span class="o">);</span>
<span class="o">}</span></code></pre></figure><p>The rule of thumb is: a builder is always a noun. If the method returns something, it has to be a noun. Preferably its name should explain what the method returns. If it&#39;s a book, name it <code>book()</code>. If it&#39;s a file, call the method <code>file()</code>, etc. Here are a few good builder examples:</p><figure class="highlight"><pre><code class="language-java" data-lang="java"><span></span><span class="kd">interface</span> <span class="nc">Foo</span> <span class="o">{</span>
  <span class="kt">float</span> <span class="nf">speed</span><span class="o">(</span><span class="n">Actor</span> <span class="n">actor</span><span class="o">);</span>
  <span class="n">Money</span> <span class="nf">salary</span><span class="o">(</span><span class="n">User</span> <span class="n">user</span><span class="o">);</span>
  <span class="n">File</span> <span class="nf">database</span><span class="o">();</span>
  <span class="n">Date</span> <span class="nf">deadline</span><span class="o">(</span><span class="n">Project</span> <span class="n">project</span><span class="o">,</span> <span class="n">User</span> <span class="n">user</span><span class="o">);</span>
<span class="o">}</span></code></pre></figure><p>Here, on the contrary, are a few examples of badly named builders:</p><figure class="highlight"><pre><code class="language-java" data-lang="java"><span></span><span class="kd">interface</span> <span class="nc">Foo</span> <span class="o">{</span>
  <span class="kt">float</span> <span class="nf">calculateSpeed</span><span class="o">(</span><span class="n">Actor</span> <span class="n">actor</span><span class="o">);</span>
  <span class="n">Money</span> <span class="nf">getSalary</span><span class="o">(</span><span class="n">User</span> <span class="n">user</span><span class="o">);</span>
  <span class="n">File</span> <span class="nf">openDatabase</span><span class="o">();</span>
  <span class="n">Date</span> <span class="nf">readDeadline</span><span class="o">(</span><span class="n">Project</span> <span class="n">project</span><span class="o">,</span> <span class="n">User</span> <span class="n">user</span><span class="o">);</span>
<span class="o">}</span></code></pre></figure><p>There is no place for a verb in a builder&#39;s name!</p><p>It&#39;s not only about the name, by the way. A builder, since its name doesn&#39;t contain a verb, should not do any modifications to the encapsulated entities. It may only create or find something and return it. Just like a <a href="https://en.wikipedia.org/wiki/Pure_function">pure function</a>, it must not have any side-effects.</p><p>Next, there are &quot;manipulators&quot; (or &quot;commands&quot; in Meyer&#39;s terms). They do some work for us, modifying the entities, which the object encapsulates. They are the opposite to builders, because they actually make changes to the world abstracted by the object. For example, we ask the <code>Bookshelf</code> to add a new book to itself:</p><figure class="highlight"><pre><code class="language-java" data-lang="java"><span></span><span class="kd">interface</span> <span class="nc">Bookshelf</span> <span class="o">{</span>
  <span class="kt">void</span> <span class="nf">add</span><span class="o">(</span><span class="n">Book</span> <span class="n">book</span><span class="o">);</span>
<span class="o">}</span></code></pre></figure><p>The method adds the book to the storage. How exactly the storage will be modified, we don&#39;t know. But we know that since the name of the method is a verb, there will be modifications.</p><p>Also, manipulators must not return anything. It&#39;s always <code>void</code> that we see as the type of their response. This is needed mostly in order to separate the imperative part of the code from the declarative part. We either receive objects or tell them what to do. We must not mix those activities in one method.</p><p>The purpose of these rules is to make the code simpler. If you follow them, and all your builders only return objects and your manipulators only modify the world, the entire design will become easier to understand. Methods will be smaller and their names shorter.</p><p>Of course, very often you will have a hard time finding those names. From time to time you will want to return something from a manipulator or make your builder make some changes, say to the cache. Try to resist this temptation and stay with the principle: a method is either a builder or a manipulator, nothing in the middle. The examples above are rather primitive, the code in real life is much more complicated. But that&#39;s what the principle is going to help us with---making the code simpler.</p><p>I&#39;m also aware of the <a href="http://steve-yegge.blogspot.com/2006/03/execution-in-kingdom-of-nouns.html">noun/verb</a> principle, which suggests always naming classes as nouns and their methods as verbs. I believe it&#39;s a wrong idea, since it doesn&#39;t differentiate builders from manipulators and encourages us to always think in terms of imperative instructions. I believe that OOP must be much more about declarative composition of objects, even if we have to sometimes get them from other objects instead of instantiating them via constructors. That&#39;s why we do need builders in most situations and we also have to see an obvious difference between them and the other methods, manipulators.</p><p>You can find a more detailed discussion of this problem in <a href="http://goo.gl/W2WVMk">Elegant Objects</a>, Volume 1, Section 2.4.</p><blockquote class="twitter-tweet" data-lang="en"><p lang="en" dir="ltr">How would you name a method of a class Document that reads and returns its content? <a href="https://twitter.com/hashtag/elegantobjects?src=hash&amp;ref_src=twsrc%5Etfw">#elegantobjects</a></p>&mdash; Yegor Bugayenko (@yegor256) <a href="https://twitter.com/yegor256/status/1033605343274840064?ref_src=twsrc%5Etfw">August 26, 2018</a></blockquote> <script async src="https://platform.twitter.com/widgets.js" charset="utf-8"></script></div></article></div><div class="wrapper"> <related-posts /></div><div class="disqus" role="complementary"><p class="disqus_hint"> Please, use <a href="https://help.disqus.com/commenting/what-html-tags-are-allowed-within-comments">syntax highlighting</a> in your comments, to make them more readable.</p><div id="disqus_thread" class="disqus-thread"> <a>&nbsp;</a></div><script> var disqus_config = function () { this.page.url = document.location.href.split('?')[0].split('#')[0].replace('https://', 'http://'); this.page.identifier = this.page.url; }; (function() { var d = document, s = d.createElement('script'); s.src = '//yegor256.disqus.com/embed.js'; s.setAttribute('data-timestamp', +new Date()); (d.head || d.body).appendChild(s); })(); </script> <noscript><div><p class="red"> JavaScript is disabled in your browser, that's why you can't see comments under this post.</p></div></noscript></div><div class="wrapper"> <footer class="footer"><p> &copy; <span itemscope="" itemprop="copyrightHolder" itemtype="http://schema.org/Person"> <span itemprop="name">Yegor Bugayenko</span> </span> 2014&ndash;<span itemprop="copyrightYear">2018</span></p></footer></div></section><div class="wrapper unprintable" style="text-align:center;margin-top:2em;"> <a href="http://www.sixnines.io/h/3ba1652f"> <img src="//www.sixnines.io/b/3ba1652f?style=flat" alt="sixnines availability badge"/> </a></div><script src="//code.jquery.com/jquery-1.9.0.min.js"></script> <script src="/js/all.js?4e047f6f42b"></script> <script>var disqus_shortname = 'yegor256';</script> <script id="dsq-count-scr" src="//yegor256.disqus.com/count.js" async="async"></script> <script> (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){ (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o), m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m) })(window,document,'script','//www.google-analytics.com/analytics.js','ga'); ga('create', 'UA-1963507-32', 'auto'); ga('send', 'pageview'); </script> <script> Cd=document;Cr="&"+Math.random();Cp="&s=1"; Cd.cookie="b=b";if(Cd.cookie)Cp+="&c=1"; Cp+="&t="+(new Date()).getTimezoneOffset(); if(self!=top)Cp+="&f=1"; </script> <script> if(navigator.javaEnabled())Cp+="&j=1"; </script> <script> if(typeof(screen)!='undefined')Cp+="&w="+screen.width+"&h="+ screen.height+"&d="+(screen.colorDepth?screen.colorDepth:screen.pixelDepth); </script> <script> Cd.write("<img src='//c.hit.ua/hit?i=95870&g=0&x=2"+Cp+Cr+ "&r="+escape(Cd.referrer)+"&u="+escape(window.location.href)+ "' border='0' wi"+"dth='1' he"+"ight='1'/>"); </script> <script type="application/ld+json"> { "@context": "http://schema.org", "@type": "Person", "name": "Yegor Bugayenko", "url": "http://www.yegor256.com", "sameAs": [ "https://www.facebook.com/yegor256", "https://instagram.com/yegor256", "https://www.linkedin.com/in/yegor256", "https://twitter.com/yegor256", "https://github.com/yegor256", "https://www.pinterest.com/yegor256/" ] } </script> </body> </html> <!DOCTYPE html> <html xmlns="http://www.w3.org/1999/xhtml" lang="en-US" xml:lang="en-US" itemscope="" itemtype="http://schema.org/WebSite"> <head> <meta charset="utf-8"/> <meta name="description" content="Thread-safety is a very important and critical quality of some Java objects; here is how it can be tested with the help of Cactoos RunInThreads class. " /> <meta name="keywords" content="how to test thread safety, test thread safety, thread conflicts, thread safety, thread safety bugs" /> <meta name="viewport" content="width=device-width,minimum-scale=1,initial-scale=1"/> <meta name="google-site-verification" content="JEj_gQr2CPe2QKGw8XdMz0R7VboQIUbX3FlM-lwTq-8" /> <meta name="author" content="Yegor Bugayenko"> <meta name="article:published_time" content="2018-03-27 00:00:00 +0000"> <meta name="og:site_name" content="Yegor Bugayenko"/> <meta name="og:type" content="article" /> <meta name="og:locale" content="en_US" /> <meta name="twitter:account_id" content="4503599630178231" /> <meta name="twitter:creator" content="@yegor256"/> <meta name="twitter:site" content="@yegor256"/> <meta name="twitter:title" property="og:title" content="How I Test My Java Classes for Thread-Safety"/> <meta name="twitter:description" property="og:description" content="Thread-safety is a very important and critical quality of some Java objects; here is how it can be tested with the help of Cactoos RunInThreads class. "/> <meta name="twitter:url" property="og:url" content="https://www.yegor256.com/2018/03/27/how-to-test-thread-safety.html"/> <meta name="telegram:channel" content="AAAAAEJFMRzsRTRxM3ec6A"/> <link rel="search" type="application/opensearchdescription+xml" href="/opensearch.xml" title="yegor256" /> <link rel="shortcut icon" href="/favicon.ico?4e047f6f42b"/> <link rel="apple-touch-icon" href="/favicon.ico?4e047f6f42b"/> <link rel="alternate" type="application/rss+xml" title="RSS for yegor256.com" href="https://www.yegor256.com/rss.xml"/> <link rel="stylesheet" href="/css/layout.css?4e047f6f42b"/> <link rel="stylesheet" href="/css/icons.css?4e047f6f42b"/> <link rel="canonical" href="https://www.yegor256.com/2018/03/27/how-to-test-thread-safety.html" /> <link rel="amphtml" href="https://www.yegor256.com/2018/03/27/how-to-test-thread-safety.amp.html" /> <title>How I Test My Java Classes for Thread-Safety </title> <meta name='og:image' content='https://www.yegor256.com/images/2018/03/scent-of-a-woman.jpg'/><meta name='twitter:image' content='https://www.yegor256.com/images/2018/03/scent-of-a-woman.jpg'/><meta name='og:image:width' content='1330'/> <meta name='twitter:image:width' content='1330'/><meta name='og:image:height' content='748'/> <meta name='twitter:image:height' content='748'/><meta name='twitter:card' content='summary_large_image'/><meta name='twitter:image:alt' content='Scent of a Woman (1992) by Martin Brest'/> </head> <body><div class="wrapper"> <aside class="header-toggle unprintable" id="header-toggle" title="Show the menu" onclick="$('#header').show();$('#header-toggle').hide();">&#9776;</aside> <header class="header" id="header"><div class="face"> <a href="/about-me.html#form" class="sub" title="Click to subscribe to my monthly newsletter"><span>Subscribe</span></a> <a href="/about-me.html" style="position:relative;"> <img src="/images/face-256x256.jpg" class="photo" alt="Yegor Bugayenko"/> </a></div><nav><ul class="menu social notranslate"> <li><a href="https://twitter.com/intent/follow?screen_name=yegor256" rel="nofollow" title="Follow me on Twitter"><i class="icon icon-twitter notranslate" aria-hidden="true"></i></a></li> <li><a href="/rss.xml" rel="nofollow" title="Subscribe to my RSS feed"><i class="icon icon-rss notranslate" aria-hidden="true"></i></a></li> <li><a itemprop="sameAs" href="https://github.com/yegor256" rel="nofollow" title="My GitHub profile"><i class="icon icon-github notranslate" aria-hidden="true"></i></a></li> <li><a itemprop="sameAs" href="http://stackoverflow.com/users/187141/yegor256" rel="nofollow" title="My StackOverflow profile"><i class="icon icon-stackoverflow notranslate" aria-hidden="true"></i></a></li> <li><a itemprop="sameAs" href="https://www.facebook.com/yegor256" rel="nofollow" title="Follow me on Facebook"><i class="icon icon-facebook notranslate" aria-hidden="true"></i></a></li> <li><a itemprop="sameAs" href="https://instagram.com/yegor256" rel="nofollow" title="Follow me on Instagram"><i class="icon icon-instagram notranslate" aria-hidden="true"></i></a></li> <li><a itemprop="sameAs" href="https://www.linkedin.com/in/yegor256" rel="nofollow" title="My LinkedIn profile"><i class="icon icon-linkedin notranslate" aria-hidden="true"></i></a></li> <li><a itemprop="sameAs" href="https://www.youtube.com/c/yegor256?sub_confirmation=1" rel="nofollow" title="My Youtube video channel"><i class="icon icon-youtube notranslate" aria-hidden="true"></i></a></li> <li><a itemprop="sameAs" href="https://www.pinterest.com/yegor256/" rel="nofollow" title="My Pinterest boards"><i class="icon icon-pinterest notranslate" aria-hidden="true"></i></a></li> <li><a itemprop="sameAs" href="https://angel.co/yegor256" rel="nofollow" title="My AngelList profile"><i class="icon icon-angellist notranslate" aria-hidden="true"></i></a></li> <li><a href="https://soundcloud.com/yegor256" rel="nofollow" title="My podcast"><i class="icon icon-podcast notranslate" aria-hidden="true"></i></a></li> <li><a href="https://itunes.apple.com/us/podcast/yegor256-podcast/id1150826721" rel="nofollow" title="My iTunes podcast"><i class="icon icon-itunes notranslate" aria-hidden="true"></i></a></li> <li><a href="https://t.me/joinchat/AAAAAEJFMRzsRTRxM3ec6A" rel="nofollow" title="My Telegram public channel"><i class="icon icon-telegram notranslate" aria-hidden="true"></i></a></li> <li><a href="mailto:blog@yegor256.com" rel="nofollow" title="Email me any time"><i class="icon icon-mail notranslate" aria-hidden="true"></i></a></li></ul><ul class="menu"> <li><a href="/" title="Home page">Home</a></li> <li ><a href="/best.html" title="Best articles to read">12&#160;Best</a></li> <li ><a href="/contents.html" title="The contents of the entire blog">All&#160;288</a></li> <li ><a href="/webinars.html" title="My webinars">Webinars</a></li> <li ><a href="/talks.html" title="Future and past conference talks">Talks</a></li> <li ><a href="/books.html" title="The books I wrote">Books</a></li> <li ><a href="/papers.html" title="My academic papers and patents">Papers</a></li> <li ><a href="/pets.html" title="My loved pet projects">Pets</a></li> <li ><a href="/award.html" title="Software quality award">Award</a></li> <li ><a href="/testimonials.html" title="What some people say about me">Testimonials</a></li> <li ><a href="/shift-m.html" title="Audio podcast about project management">Shift-M</a></li> <li ><a href="/paintings.html" title="My paintings for sale">Paintings</a></li> <li><a href="http://ru.yegor256.com/" title="Немного на русском языке">По-русски</a></li></ul></nav><div class="search"> <form method="get" action="https://www.google.com/search" itemprop="potentialAction" itemscope="" itemtype="http://schema.org/SearchAction"> <meta itemprop="target" content="https://www.google.com/search?q={q}"/> <input name="sitesearch" value="yegor256.com" type="hidden"/> <input itemprop="query-input" type="text" id="search-query" class="field field-text" required="required" onfocus="$('.google').css('visibility', 'visible');" name="q" placeholder="Search..." autocomplete="off"/> <input type="image" src="/images/google-search-icon.svg" class="google" title="Search via Google" alt="Search via Google"/> </form></div><div class="hot"><ul> <li> <a href="/code-ahead.html">Code Ahead</a> was published on Amazon just a few days ago! It is my new book, a novel about programmers. It explains in details the majority of ideas that stand behind <a href="https://www.zerocracy.com">Zerocracy</a> and <a href="https://www.xdsd.org">XDSD</a>. </li> <li> At <a href="/webinars.html">Webinar #37</a> we will discuss naming problem in OOP, for objects, methods and attributes; join us on <b>September 12</b>, at 11am PST. </li></ul></div></header></div><section itemscope="" itemtype="http://schema.org/BlogPosting"><div class="wrapper"> <header><p class="printable"> <img src="https://api.qrserver.com/v1/create-qr-code/?data=https://www.yegor256.com/2018/03/27/how-to-test-thread-safety.html&amp;format=svg" style="width:125px;height:125px;" alt="QR code"/></p><p class="printable"> <code itemprop="url">https://www.yegor256.com/2018/03/27/how-to-test-thread-safety.html</code></p><h1 itemprop="name headline mainEntityOfPage">How I Test My Java Classes for Thread-Safety</h1><ul class="subline"> <li> <time itemprop="datePublished" datetime="2018-03-27T00:00:00+00:00"> 27 March 2018 </time> </li> <li class="desktop-only" itemprop="locationCreated">Moscow, Russia</li> <li class="printable" itemscope="" itemprop="author" itemtype="http://schema.org/Person"> <span itemprop="name">Yegor Bugayenko</span> </li> <li class="unprintable"> <i class="icon icon-comments"></i> <a href="http://www.yegor256.com/2018/03/27/how-to-test-thread-safety.html#disqus_thread" itemprop="discussionUrl">comments</a> </li></ul><figure class='jb_picture'><img itemprop='image' alt='Scent of a Woman (1992) by Martin Brest' src='/images/2018/03/scent-of-a-woman.jpg' longdesc='#e9a2355c'/><figcaption id='e9a2355c'>Scent of a Woman (1992) by Martin Brest</figcaption></figure><p>Let us say there is a simple in-memory bookshelf:</p><figure class="highlight"><pre><code class="language-java" data-lang="java"><span></span><span class="kd">class</span> <span class="nc">Books</span> <span class="o">{</span>
  <span class="kd">final</span> <span class="n">Map</span><span class="o">&lt;</span><span class="n">Integer</span><span class="o">,</span> <span class="n">String</span><span class="o">&gt;</span> <span class="n">map</span> <span class="o">=</span>
    <span class="k">new</span> <span class="n">ConcurrentHashMap</span><span class="o">&lt;&gt;();</span>
  <span class="kt">int</span> <span class="nf">add</span><span class="o">(</span><span class="n">String</span> <span class="n">title</span><span class="o">)</span> <span class="o">{</span>
    <span class="kd">final</span> <span class="n">Integer</span> <span class="n">next</span> <span class="o">=</span> <span class="k">this</span><span class="o">.</span><span class="na">map</span><span class="o">.</span><span class="na">size</span><span class="o">()</span> <span class="o">+</span> <span class="mi">1</span><span class="o">;</span>
    <span class="k">this</span><span class="o">.</span><span class="na">map</span><span class="o">.</span><span class="na">put</span><span class="o">(</span><span class="n">next</span><span class="o">,</span> <span class="n">title</span><span class="o">);</span>
    <span class="k">return</span> <span class="n">next</span><span class="o">;</span>
  <span class="o">}</span>
  <span class="n">String</span> <span class="nf">title</span><span class="o">(</span><span class="kt">int</span> <span class="n">id</span><span class="o">)</span> <span class="o">{</span>
    <span class="k">return</span> <span class="k">this</span><span class="o">.</span><span class="na">map</span><span class="o">.</span><span class="na">get</span><span class="o">(</span><span class="n">id</span><span class="o">);</span>
  <span class="o">}</span>
<span class="o">}</span></code></pre></figure><p>First, we put a book there and the bookshelf returns its ID. Then we can read the title of the book by its ID:</p><figure class="highlight"><pre><code class="language-java" data-lang="java"><span></span><span class="n">Books</span> <span class="n">books</span> <span class="o">=</span> <span class="k">new</span> <span class="n">Books</span><span class="o">();</span>
<span class="n">String</span> <span class="n">title</span> <span class="o">=</span> <span class="s">&quot;Elegant Objects&quot;</span><span class="o">;</span>
<span class="kt">int</span> <span class="n">id</span> <span class="o">=</span> <span class="n">books</span><span class="o">.</span><span class="na">add</span><span class="o">(</span><span class="n">title</span><span class="o">);</span>
<span class="k">assert</span> <span class="n">books</span><span class="o">.</span><span class="na">title</span><span class="o">(</span><span class="n">id</span><span class="o">).</span><span class="na">equals</span><span class="o">(</span><span class="n">title</span><span class="o">);</span></code></pre></figure><p>The class seems to be thread-safe, since we are using the thread-safe <a href="https://docs.oracle.com/javase/8/docs/api/java/util/concurrent/ConcurrentHashMap.html"><code>ConcurrentHashMap</code></a> instead of a more primitive and non-thread-safe <a href="https://docs.oracle.com/javase/8/docs/api/java/util/HashMap.html"><code>HashMap</code></a>, right? Let&#39;s try to test it:</p><figure class="highlight"><pre><code class="language-java" data-lang="java"><span></span><span class="kd">class</span> <span class="nc">BooksTest</span> <span class="o">{</span>
  <span class="nd">@Test</span>
  <span class="kd">public</span> <span class="kt">void</span> <span class="nf">addsAndRetrieves</span><span class="o">()</span> <span class="o">{</span>
    <span class="n">Books</span> <span class="n">books</span> <span class="o">=</span> <span class="k">new</span> <span class="n">Books</span><span class="o">();</span>
    <span class="n">String</span> <span class="n">title</span> <span class="o">=</span> <span class="s">&quot;Elegant Objects&quot;</span><span class="o">;</span>
    <span class="kt">int</span> <span class="n">id</span> <span class="o">=</span> <span class="n">books</span><span class="o">.</span><span class="na">add</span><span class="o">(</span><span class="n">title</span><span class="o">);</span>
    <span class="k">assert</span> <span class="n">books</span><span class="o">.</span><span class="na">title</span><span class="o">(</span><span class="n">id</span><span class="o">).</span><span class="na">equals</span><span class="o">(</span><span class="n">title</span><span class="o">);</span>
  <span class="o">}</span>
<span class="o">}</span></code></pre></figure><p>The test passes, but it&#39;s just a one-thread test. Let&#39;s try to do the same manipulation from a few parallel threads (I&#39;m using <a href="https://github.com/hamcrest/JavaHamcrest">Hamcrest</a>):</p><figure class="highlight"><pre><code class="language-java" data-lang="java"><span></span><span class="kd">class</span> <span class="nc">BooksTest</span> <span class="o">{</span>
  <span class="nd">@Test</span>
  <span class="kd">public</span> <span class="kt">void</span> <span class="nf">addsAndRetrieves</span><span class="o">()</span> <span class="o">{</span>
    <span class="n">Books</span> <span class="n">books</span> <span class="o">=</span> <span class="k">new</span> <span class="n">Books</span><span class="o">();</span>
    <span class="kt">int</span> <span class="n">threads</span> <span class="o">=</span> <span class="mi">10</span><span class="o">;</span>
    <span class="n">ExecutorService</span> <span class="n">service</span> <span class="o">=</span>
      <span class="n">Executors</span><span class="o">.</span><span class="na">newFixedThreadPool</span><span class="o">(</span><span class="n">threads</span><span class="o">);</span>
    <span class="n">Collection</span><span class="o">&lt;</span><span class="n">Future</span><span class="o">&lt;</span><span class="n">Integer</span><span class="o">&gt;&gt;</span> <span class="n">futures</span> <span class="o">=</span>
      <span class="k">new</span> <span class="n">ArrayList</span><span class="o">&lt;&gt;(</span><span class="n">threads</span><span class="o">);</span>
    <span class="k">for</span> <span class="o">(</span><span class="kt">int</span> <span class="n">t</span> <span class="o">=</span> <span class="mi">0</span><span class="o">;</span> <span class="n">t</span> <span class="o">&lt;</span> <span class="n">threads</span><span class="o">;</span> <span class="o">++</span><span class="n">t</span><span class="o">)</span> <span class="o">{</span>
      <span class="kd">final</span> <span class="n">String</span> <span class="n">title</span> <span class="o">=</span> <span class="n">String</span><span class="o">.</span><span class="na">format</span><span class="o">(</span><span class="s">&quot;Book #%d&quot;</span><span class="o">,</span> <span class="n">t</span><span class="o">);</span>
      <span class="n">futures</span><span class="o">.</span><span class="na">add</span><span class="o">(</span><span class="n">service</span><span class="o">.</span><span class="na">submit</span><span class="o">(()</span> <span class="o">-&gt;</span> <span class="n">books</span><span class="o">.</span><span class="na">add</span><span class="o">(</span><span class="n">title</span><span class="o">)));</span>
    <span class="o">}</span>
    <span class="n">Set</span><span class="o">&lt;</span><span class="n">Integer</span><span class="o">&gt;</span> <span class="n">ids</span> <span class="o">=</span> <span class="k">new</span> <span class="n">HashSet</span><span class="o">&lt;&gt;();</span>
    <span class="k">for</span> <span class="o">(</span><span class="n">Future</span><span class="o">&lt;</span><span class="n">Integer</span><span class="o">&gt;</span> <span class="n">f</span> <span class="o">:</span> <span class="n">futures</span><span class="o">)</span> <span class="o">{</span>
      <span class="n">ids</span><span class="o">.</span><span class="na">add</span><span class="o">(</span><span class="n">f</span><span class="o">.</span><span class="na">get</span><span class="o">());</span>
    <span class="o">}</span>
    <span class="n">assertThat</span><span class="o">(</span><span class="n">ids</span><span class="o">.</span><span class="na">size</span><span class="o">(),</span> <span class="n">equalTo</span><span class="o">(</span><span class="n">threads</span><span class="o">));</span>
  <span class="o">}</span>
<span class="o">}</span></code></pre></figure><p>First, I create a pool of threads via <a href="https://docs.oracle.com/javase/7/docs/api/java/util/concurrent/Executors.html"><code>Executors</code></a>. Then I submit ten objects of type <a href="https://docs.oracle.com/javase/7/docs/api/java/util/concurrent/Callable.html"><code>Callable</code></a> via <code>submit()</code>. Each of them will add a new unique book to the bookshelf. All of them will be executed, in some unpredictable order, by some of those ten threads from the pool.</p><aside class='youtube'> <a href='https://www.youtube.com/watch?v=rC17YwowURQ'><div class='box'> <img src='https://i.ytimg.com/vi/rC17YwowURQ/mqdefault.jpg' alt='YouTube video #rC17YwowURQ'/><div class='play'><i class='icon icon-play'></i></div></div></a><div>Synchronized Decorators for Thread-Safety (Webinar #32); 7 February 2018.</div></aside><p>Then I fetch the results of their executors through the list of objects of type <a href="https://docs.oracle.com/javase/7/docs/api/java/util/concurrent/Future.html"><code>Future</code></a>. Finally, I calculate the amount of unique book IDs created. If the number is 10, there were no conflicts. I&#39;m using the <a href="https://docs.oracle.com/javase/7/docs/api/java/util/Set.html"><code>Set</code></a> collection in order to make sure the list of IDs contains only unique elements.</p><p>The test passes on my laptop. However, it&#39;s not strong enough. The problem here is that it&#39;s not really testing the <code>Books</code> from multiple parallel threads. The time that passes between our calls to <code>submit()</code> is large enough to finish the execution of <code>books.add()</code>. That&#39;s why in reality only one thread will run at the same time. We can check that by modifying the code a bit:</p><figure class="highlight"><pre><code class="language-java" data-lang="java"><span></span><span class="n">AtomicBoolean</span> <span class="n">running</span> <span class="o">=</span> <span class="k">new</span> <span class="n">AtomicBoolean</span><span class="o">();</span>
<span class="n">AtomicInteger</span> <span class="n">overlaps</span> <span class="o">=</span> <span class="k">new</span> <span class="n">AtomicInteger</span><span class="o">();</span>
<span class="n">Collection</span><span class="o">&lt;</span><span class="n">Future</span><span class="o">&lt;</span><span class="n">Integer</span><span class="o">&gt;&gt;</span> <span class="n">futures</span> <span class="o">=</span>
  <span class="k">new</span> <span class="n">ArrayList</span><span class="o">&lt;&gt;(</span><span class="n">threads</span><span class="o">);</span>
<span class="k">for</span> <span class="o">(</span><span class="kt">int</span> <span class="n">t</span> <span class="o">=</span> <span class="mi">0</span><span class="o">;</span> <span class="n">t</span> <span class="o">&lt;</span> <span class="n">threads</span><span class="o">;</span> <span class="o">++</span><span class="n">t</span><span class="o">)</span> <span class="o">{</span>
  <span class="kd">final</span> <span class="n">String</span> <span class="n">title</span> <span class="o">=</span> <span class="n">String</span><span class="o">.</span><span class="na">format</span><span class="o">(</span><span class="s">&quot;Book #%d&quot;</span><span class="o">,</span> <span class="n">t</span><span class="o">);</span>
  <span class="n">futures</span><span class="o">.</span><span class="na">add</span><span class="o">(</span>
    <span class="n">service</span><span class="o">.</span><span class="na">submit</span><span class="o">(</span>
      <span class="o">()</span> <span class="o">-&gt;</span> <span class="o">{</span>
        <span class="k">if</span> <span class="o">(</span><span class="n">running</span><span class="o">.</span><span class="na">get</span><span class="o">())</span> <span class="o">{</span>
          <span class="n">overlaps</span><span class="o">.</span><span class="na">incrementAndGet</span><span class="o">();</span>
        <span class="o">}</span>
        <span class="n">running</span><span class="o">.</span><span class="na">set</span><span class="o">(</span><span class="kc">true</span><span class="o">);</span>
        <span class="kt">int</span> <span class="n">id</span> <span class="o">=</span> <span class="n">books</span><span class="o">.</span><span class="na">add</span><span class="o">(</span><span class="n">title</span><span class="o">);</span>
        <span class="n">running</span><span class="o">.</span><span class="na">set</span><span class="o">(</span><span class="kc">false</span><span class="o">);</span>
        <span class="k">return</span> <span class="n">id</span><span class="o">;</span>
      <span class="o">}</span>
    <span class="o">)</span>
  <span class="o">);</span>
<span class="o">}</span>
<span class="n">assertThat</span><span class="o">(</span><span class="n">overlaps</span><span class="o">.</span><span class="na">get</span><span class="o">(),</span> <span class="n">greaterThan</span><span class="o">(</span><span class="mi">0</span><span class="o">));</span></code></pre></figure><p>With this code I&#39;m trying to see how often threads overlap each other and do something in parallel. This never happens and <code>overlaps</code> is equal to zero. Thus our test is not really testing anything yet. It just adds ten books to the bookshelf one by one. If I increase the amount of threads to 1000, they start to overlap sometimes. But we want them to overlap even when there&#39;s a small number of them. To solve that we need to use <a href="https://docs.oracle.com/javase/7/docs/api/java/util/concurrent/CountDownLatch.html"><code>CountDownLatch</code></a>:</p><figure class="highlight"><pre><code class="language-java" data-lang="java"><span></span><span class="n">CountDownLatch</span> <span class="n">latch</span> <span class="o">=</span> <span class="k">new</span> <span class="n">CountDownLatch</span><span class="o">(</span><span class="mi">1</span><span class="o">);</span>
<span class="n">AtomicBoolean</span> <span class="n">running</span> <span class="o">=</span> <span class="k">new</span> <span class="n">AtomicBoolean</span><span class="o">();</span>
<span class="n">AtomicInteger</span> <span class="n">overlaps</span> <span class="o">=</span> <span class="k">new</span> <span class="n">AtomicInteger</span><span class="o">();</span>
<span class="n">Collection</span><span class="o">&lt;</span><span class="n">Future</span><span class="o">&lt;</span><span class="n">Integer</span><span class="o">&gt;&gt;</span> <span class="n">futures</span> <span class="o">=</span>
  <span class="k">new</span> <span class="n">ArrayList</span><span class="o">&lt;&gt;(</span><span class="n">threads</span><span class="o">);</span>
<span class="k">for</span> <span class="o">(</span><span class="kt">int</span> <span class="n">t</span> <span class="o">=</span> <span class="mi">0</span><span class="o">;</span> <span class="n">t</span> <span class="o">&lt;</span> <span class="n">threads</span><span class="o">;</span> <span class="o">++</span><span class="n">t</span><span class="o">)</span> <span class="o">{</span>
  <span class="kd">final</span> <span class="n">String</span> <span class="n">title</span> <span class="o">=</span> <span class="n">String</span><span class="o">.</span><span class="na">format</span><span class="o">(</span><span class="s">&quot;Book #%d&quot;</span><span class="o">,</span> <span class="n">t</span><span class="o">);</span>
  <span class="n">futures</span><span class="o">.</span><span class="na">add</span><span class="o">(</span>
    <span class="n">service</span><span class="o">.</span><span class="na">submit</span><span class="o">(</span>
      <span class="o">()</span> <span class="o">-&gt;</span> <span class="o">{</span>
        <span class="n">latch</span><span class="o">.</span><span class="na">await</span><span class="o">();</span>
        <span class="k">if</span> <span class="o">(</span><span class="n">running</span><span class="o">.</span><span class="na">get</span><span class="o">())</span> <span class="o">{</span>
          <span class="n">overlaps</span><span class="o">.</span><span class="na">incrementAndGet</span><span class="o">();</span>
        <span class="o">}</span>
        <span class="n">running</span><span class="o">.</span><span class="na">set</span><span class="o">(</span><span class="kc">true</span><span class="o">);</span>
        <span class="kt">int</span> <span class="n">id</span> <span class="o">=</span> <span class="n">books</span><span class="o">.</span><span class="na">add</span><span class="o">(</span><span class="n">title</span><span class="o">);</span>
        <span class="n">running</span><span class="o">.</span><span class="na">set</span><span class="o">(</span><span class="kc">false</span><span class="o">);</span>
        <span class="k">return</span> <span class="n">id</span><span class="o">;</span>
      <span class="o">}</span>
    <span class="o">)</span>
  <span class="o">);</span>
<span class="o">}</span>
<span class="n">latch</span><span class="o">.</span><span class="na">countDown</span><span class="o">();</span>
<span class="n">Set</span><span class="o">&lt;</span><span class="n">Integer</span><span class="o">&gt;</span> <span class="n">ids</span> <span class="o">=</span> <span class="k">new</span> <span class="n">HashSet</span><span class="o">&lt;&gt;();</span>
<span class="k">for</span> <span class="o">(</span><span class="n">Future</span><span class="o">&lt;</span><span class="n">Integer</span><span class="o">&gt;</span> <span class="n">f</span> <span class="o">:</span> <span class="n">futures</span><span class="o">)</span> <span class="o">{</span>
  <span class="n">ids</span><span class="o">.</span><span class="na">add</span><span class="o">(</span><span class="n">f</span><span class="o">.</span><span class="na">get</span><span class="o">());</span>
<span class="o">}</span>
<span class="n">assertThat</span><span class="o">(</span><span class="n">overlaps</span><span class="o">.</span><span class="na">get</span><span class="o">(),</span> <span class="n">greaterThan</span><span class="o">(</span><span class="mi">0</span><span class="o">));</span></code></pre></figure><p>Now each thread, before touching the books, waits for the permission given by <code>latch</code>. When we submit them all via <code>submit()</code> they stay on hold and wait. Then we release the latch with <code>countDown()</code> and they all start to go, simultaneously. Now, on my laptop, <code>overlaps</code> is equal to 3-5 even when <code>threads</code> is 10.</p><p>And that last <code>assertThat()</code> crashes now! I&#39;m not getting 10 book IDs, as I was before. It&#39;s 7-9, but never 10. The class, apparently, is not thread-safe!</p><p>But before we fix the class, let&#39;s make our test simpler. Let&#39;s use <a href="http://static.javadoc.io/org.cactoos/cactoos/0.29/org/cactoos/matchers/RunsInThreads.html"><code>RunInThreads</code></a> from <a href="http://www.cactoos.org">Cactoos</a>, which does exactly the same as we&#39;ve done above, but under the hood:</p><figure class="highlight"><pre><code class="language-java" data-lang="java"><span></span><span class="kd">class</span> <span class="nc">BooksTest</span> <span class="o">{</span>
  <span class="nd">@Test</span>
  <span class="kd">public</span> <span class="kt">void</span> <span class="nf">addsAndRetrieves</span><span class="o">()</span> <span class="o">{</span>
    <span class="n">Books</span> <span class="n">books</span> <span class="o">=</span> <span class="k">new</span> <span class="n">Books</span><span class="o">();</span>
    <span class="n">MatcherAssert</span><span class="o">.</span><span class="na">assertThat</span><span class="o">(</span>
      <span class="n">t</span> <span class="o">-&gt;</span> <span class="o">{</span>
        <span class="n">String</span> <span class="n">title</span> <span class="o">=</span> <span class="n">String</span><span class="o">.</span><span class="na">format</span><span class="o">(</span>
          <span class="s">&quot;Book #%d&quot;</span><span class="o">,</span> <span class="n">t</span><span class="o">.</span><span class="na">getAndIncrement</span><span class="o">()</span>
        <span class="o">);</span>
        <span class="kt">int</span> <span class="n">id</span> <span class="o">=</span> <span class="n">books</span><span class="o">.</span><span class="na">add</span><span class="o">(</span><span class="n">title</span><span class="o">);</span>
        <span class="k">return</span> <span class="n">books</span><span class="o">.</span><span class="na">title</span><span class="o">(</span><span class="n">id</span><span class="o">).</span><span class="na">equals</span><span class="o">(</span><span class="n">title</span><span class="o">);</span>
      <span class="o">},</span>
      <span class="k">new</span> <span class="n">RunsInThreads</span><span class="o">&lt;&gt;(</span><span class="k">new</span> <span class="n">AtomicInteger</span><span class="o">(),</span> <span class="mi">10</span><span class="o">)</span>
    <span class="o">);</span>
  <span class="o">}</span>
<span class="o">}</span></code></pre></figure> <figure class='badge'><a href='http://amzn.to/2c7sVS1'><img src='https://www.yegor256.com/images/2014/12/java-concurrency-in-practice.png' style='width:100px;max-width:100%;' alt='badge'/></a></figure><p>The first argument of <code>assertThat()</code> is an instance of <a href="http://static.javadoc.io/org.cactoos/cactoos/0.29/org/cactoos/Func.html"><code>Func</code></a> (a functional interface), accepting an <a href="https://docs.oracle.com/javase/8/docs/api/java/util/concurrent/atomic/AtomicInteger.html"><code>AtomicInteger</code></a> (the first argument of <code>RunsInThreads</code>) and returning <code>Boolean</code>. This function will be executed on 10 parallel thread, using the same latch-based approach as demonstrated above.</p><p>This <code>RunInThreads</code> seems to be compact and convenient, I&#39;m using it in a few projects already.</p><p>By the way, in order to make <code>Books</code> thread-safe we just need to add <code>synchronized</code> to its method <code>add()</code>. Or maybe you can suggest a better solution?</p><p>P.S. I learned all this from <a href="http://amzn.to/2c7sVS1">Java Concurrency in Practice</a> by Goetz et al.</p><blockquote class="twitter-tweet" data-lang="en"><p lang="en" dir="ltr">Do you create unit tests to prove that your classes are thread-safe?</p>&mdash; Yegor Bugayenko (@yegor256) <a href="https://twitter.com/yegor256/status/1028678871187640329?ref_src=twsrc%5Etfw">August 12, 2018</a></blockquote> <script async src="https://platform.twitter.com/widgets.js" charset="utf-8"></script></p>--> <nav class="buttons notranslate desktop-only"> <a href="http://www.facebook.com/sharer/sharer.php?u=https://www.yegor256.com/2018/03/27/how-to-test-thread-safety.html" title="Share on Facebook" class="button" rel="nofollow"> <span class="count count-facebook">0</span> <i class="icon icon-facebook notranslate" aria-hidden="true"></i> </a> <a href="https://twitter.com/share?url=https://www.yegor256.com/2018/03/27/how-to-test-thread-safety.html&amp;text=How+I+Test+My+Java+Classes+for+Thread-Safety" title="Share on Twitter" class="button" rel="nofollow"> <span class="count count-twitter">0</span> <i class="icon icon-twitter notranslate" aria-hidden="true"></i> </a> <a href="https://plus.google.com/share?url=https://www.yegor256.com/2018/03/27/how-to-test-thread-safety.html" title="Share on Google+" class="button" rel="nofollow"> <span class="count count-googleplus">0</span> <i class="icon icon-googleplus notranslate" aria-hidden="true"></i> </a> <a href="https://www.linkedin.com/cws/share?url=https://www.yegor256.com/2018/03/27/how-to-test-thread-safety.html" title="Share on LinkedIn" class="button" rel="nofollow"> <span class="count count-linkedin">0</span> <i class="icon icon-linkedin notranslate" aria-hidden="true"></i> </a> <a href="http://reddit.com/submit?url=https://www.yegor256.com/2018/03/27/how-to-test-thread-safety.html%3F2018-12&amp;title=How+I+Test+My+Java+Classes+for+Thread-Safety" title="Share on Reddit" class="button" rel="nofollow"> <span class="count count-reddit">0</span> <i class="icon icon-reddit notranslate" aria-hidden="true"></i> </a> <a href="http://news.ycombinator.com/submitlink?u=https://www.yegor256.com/2018/03/27/how-to-test-thread-safety.html%3F2018-12&amp;t=How+I+Test+My+Java+Classes+for+Thread-Safety" title="Share on Hacker News" class="button" rel="nofollow"> <span class="count count-hackernews">0</span> <i class="icon icon-hackernews notranslate" aria-hidden="true"></i> </a> </nav> </header> <article class="main" itemprop="articleBody"><div ><p>I touched on this problem in <a href="https://www.youtube.com/watch?v=rC17YwowURQ">one of my recent webinars</a>, now it&#39;s time to explain it in writing. Thread-safety is an important quality of classes in languages/platforms like Java, where we frequently share objects between threads. The issues caused by lack of thread-safety are very difficult to debug, since they are sporadic and almost impossible to reproduce on purpose. How do you test your objects to make sure they are thread-safe? Here is how I&#39;m doing it.</p><figure class='jb_picture'><img itemprop='image' alt='Scent of a Woman (1992) by Martin Brest' src='/images/2018/03/scent-of-a-woman.jpg' longdesc='#e9a2355c'/><figcaption id='e9a2355c'>Scent of a Woman (1992) by Martin Brest</figcaption></figure><p>Let us say there is a simple in-memory bookshelf:</p><figure class="highlight"><pre><code class="language-java" data-lang="java"><span></span><span class="kd">class</span> <span class="nc">Books</span> <span class="o">{</span>
  <span class="kd">final</span> <span class="n">Map</span><span class="o">&lt;</span><span class="n">Integer</span><span class="o">,</span> <span class="n">String</span><span class="o">&gt;</span> <span class="n">map</span> <span class="o">=</span>
    <span class="k">new</span> <span class="n">ConcurrentHashMap</span><span class="o">&lt;&gt;();</span>
  <span class="kt">int</span> <span class="nf">add</span><span class="o">(</span><span class="n">String</span> <span class="n">title</span><span class="o">)</span> <span class="o">{</span>
    <span class="kd">final</span> <span class="n">Integer</span> <span class="n">next</span> <span class="o">=</span> <span class="k">this</span><span class="o">.</span><span class="na">map</span><span class="o">.</span><span class="na">size</span><span class="o">()</span> <span class="o">+</span> <span class="mi">1</span><span class="o">;</span>
    <span class="k">this</span><span class="o">.</span><span class="na">map</span><span class="o">.</span><span class="na">put</span><span class="o">(</span><span class="n">next</span><span class="o">,</span> <span class="n">title</span><span class="o">);</span>
    <span class="k">return</span> <span class="n">next</span><span class="o">;</span>
  <span class="o">}</span>
  <span class="n">String</span> <span class="nf">title</span><span class="o">(</span><span class="kt">int</span> <span class="n">id</span><span class="o">)</span> <span class="o">{</span>
    <span class="k">return</span> <span class="k">this</span><span class="o">.</span><span class="na">map</span><span class="o">.</span><span class="na">get</span><span class="o">(</span><span class="n">id</span><span class="o">);</span>
  <span class="o">}</span>
<span class="o">}</span></code></pre></figure><p>First, we put a book there and the bookshelf returns its ID. Then we can read the title of the book by its ID:</p><figure class="highlight"><pre><code class="language-java" data-lang="java"><span></span><span class="n">Books</span> <span class="n">books</span> <span class="o">=</span> <span class="k">new</span> <span class="n">Books</span><span class="o">();</span>
<span class="n">String</span> <span class="n">title</span> <span class="o">=</span> <span class="s">&quot;Elegant Objects&quot;</span><span class="o">;</span>
<span class="kt">int</span> <span class="n">id</span> <span class="o">=</span> <span class="n">books</span><span class="o">.</span><span class="na">add</span><span class="o">(</span><span class="n">title</span><span class="o">);</span>
<span class="k">assert</span> <span class="n">books</span><span class="o">.</span><span class="na">title</span><span class="o">(</span><span class="n">id</span><span class="o">).</span><span class="na">equals</span><span class="o">(</span><span class="n">title</span><span class="o">);</span></code></pre></figure><p>The class seems to be thread-safe, since we are using the thread-safe <a href="https://docs.oracle.com/javase/8/docs/api/java/util/concurrent/ConcurrentHashMap.html"><code>ConcurrentHashMap</code></a> instead of a more primitive and non-thread-safe <a href="https://docs.oracle.com/javase/8/docs/api/java/util/HashMap.html"><code>HashMap</code></a>, right? Let&#39;s try to test it:</p><figure class="highlight"><pre><code class="language-java" data-lang="java"><span></span><span class="kd">class</span> <span class="nc">BooksTest</span> <span class="o">{</span>
  <span class="nd">@Test</span>
  <span class="kd">public</span> <span class="kt">void</span> <span class="nf">addsAndRetrieves</span><span class="o">()</span> <span class="o">{</span>
    <span class="n">Books</span> <span class="n">books</span> <span class="o">=</span> <span class="k">new</span> <span class="n">Books</span><span class="o">();</span>
    <span class="n">String</span> <span class="n">title</span> <span class="o">=</span> <span class="s">&quot;Elegant Objects&quot;</span><span class="o">;</span>
    <span class="kt">int</span> <span class="n">id</span> <span class="o">=</span> <span class="n">books</span><span class="o">.</span><span class="na">add</span><span class="o">(</span><span class="n">title</span><span class="o">);</span>
    <span class="k">assert</span> <span class="n">books</span><span class="o">.</span><span class="na">title</span><span class="o">(</span><span class="n">id</span><span class="o">).</span><span class="na">equals</span><span class="o">(</span><span class="n">title</span><span class="o">);</span>
  <span class="o">}</span>
<span class="o">}</span></code></pre></figure><p>The test passes, but it&#39;s just a one-thread test. Let&#39;s try to do the same manipulation from a few parallel threads (I&#39;m using <a href="https://github.com/hamcrest/JavaHamcrest">Hamcrest</a>):</p><figure class="highlight"><pre><code class="language-java" data-lang="java"><span></span><span class="kd">class</span> <span class="nc">BooksTest</span> <span class="o">{</span>
  <span class="nd">@Test</span>
  <span class="kd">public</span> <span class="kt">void</span> <span class="nf">addsAndRetrieves</span><span class="o">()</span> <span class="o">{</span>
    <span class="n">Books</span> <span class="n">books</span> <span class="o">=</span> <span class="k">new</span> <span class="n">Books</span><span class="o">();</span>
    <span class="kt">int</span> <span class="n">threads</span> <span class="o">=</span> <span class="mi">10</span><span class="o">;</span>
    <span class="n">ExecutorService</span> <span class="n">service</span> <span class="o">=</span>
      <span class="n">Executors</span><span class="o">.</span><span class="na">newFixedThreadPool</span><span class="o">(</span><span class="n">threads</span><span class="o">);</span>
    <span class="n">Collection</span><span class="o">&lt;</span><span class="n">Future</span><span class="o">&lt;</span><span class="n">Integer</span><span class="o">&gt;&gt;</span> <span class="n">futures</span> <span class="o">=</span>
      <span class="k">new</span> <span class="n">ArrayList</span><span class="o">&lt;&gt;(</span><span class="n">threads</span><span class="o">);</span>
    <span class="k">for</span> <span class="o">(</span><span class="kt">int</span> <span class="n">t</span> <span class="o">=</span> <span class="mi">0</span><span class="o">;</span> <span class="n">t</span> <span class="o">&lt;</span> <span class="n">threads</span><span class="o">;</span> <span class="o">++</span><span class="n">t</span><span class="o">)</span> <span class="o">{</span>
      <span class="kd">final</span> <span class="n">String</span> <span class="n">title</span> <span class="o">=</span> <span class="n">String</span><span class="o">.</span><span class="na">format</span><span class="o">(</span><span class="s">&quot;Book #%d&quot;</span><span class="o">,</span> <span class="n">t</span><span class="o">);</span>
      <span class="n">futures</span><span class="o">.</span><span class="na">add</span><span class="o">(</span><span class="n">service</span><span class="o">.</span><span class="na">submit</span><span class="o">(()</span> <span class="o">-&gt;</span> <span class="n">books</span><span class="o">.</span><span class="na">add</span><span class="o">(</span><span class="n">title</span><span class="o">)));</span>
    <span class="o">}</span>
    <span class="n">Set</span><span class="o">&lt;</span><span class="n">Integer</span><span class="o">&gt;</span> <span class="n">ids</span> <span class="o">=</span> <span class="k">new</span> <span class="n">HashSet</span><span class="o">&lt;&gt;();</span>
    <span class="k">for</span> <span class="o">(</span><span class="n">Future</span><span class="o">&lt;</span><span class="n">Integer</span><span class="o">&gt;</span> <span class="n">f</span> <span class="o">:</span> <span class="n">futures</span><span class="o">)</span> <span class="o">{</span>
      <span class="n">ids</span><span class="o">.</span><span class="na">add</span><span class="o">(</span><span class="n">f</span><span class="o">.</span><span class="na">get</span><span class="o">());</span>
    <span class="o">}</span>
    <span class="n">assertThat</span><span class="o">(</span><span class="n">ids</span><span class="o">.</span><span class="na">size</span><span class="o">(),</span> <span class="n">equalTo</span><span class="o">(</span><span class="n">threads</span><span class="o">));</span>
  <span class="o">}</span>
<span class="o">}</span></code></pre></figure><p>First, I create a pool of threads via <a href="https://docs.oracle.com/javase/7/docs/api/java/util/concurrent/Executors.html"><code>Executors</code></a>. Then I submit ten objects of type <a href="https://docs.oracle.com/javase/7/docs/api/java/util/concurrent/Callable.html"><code>Callable</code></a> via <code>submit()</code>. Each of them will add a new unique book to the bookshelf. All of them will be executed, in some unpredictable order, by some of those ten threads from the pool.</p><aside class='youtube'> <a href='https://www.youtube.com/watch?v=rC17YwowURQ'><div class='box'> <img src='https://i.ytimg.com/vi/rC17YwowURQ/mqdefault.jpg' alt='YouTube video #rC17YwowURQ'/><div class='play'><i class='icon icon-play'></i></div></div></a><div>Synchronized Decorators for Thread-Safety (Webinar #32); 7 February 2018.</div></aside><p>Then I fetch the results of their executors through the list of objects of type <a href="https://docs.oracle.com/javase/7/docs/api/java/util/concurrent/Future.html"><code>Future</code></a>. Finally, I calculate the amount of unique book IDs created. If the number is 10, there were no conflicts. I&#39;m using the <a href="https://docs.oracle.com/javase/7/docs/api/java/util/Set.html"><code>Set</code></a> collection in order to make sure the list of IDs contains only unique elements.</p><p>The test passes on my laptop. However, it&#39;s not strong enough. The problem here is that it&#39;s not really testing the <code>Books</code> from multiple parallel threads. The time that passes between our calls to <code>submit()</code> is large enough to finish the execution of <code>books.add()</code>. That&#39;s why in reality only one thread will run at the same time. We can check that by modifying the code a bit:</p><figure class="highlight"><pre><code class="language-java" data-lang="java"><span></span><span class="n">AtomicBoolean</span> <span class="n">running</span> <span class="o">=</span> <span class="k">new</span> <span class="n">AtomicBoolean</span><span class="o">();</span>
<span class="n">AtomicInteger</span> <span class="n">overlaps</span> <span class="o">=</span> <span class="k">new</span> <span class="n">AtomicInteger</span><span class="o">();</span>
<span class="n">Collection</span><span class="o">&lt;</span><span class="n">Future</span><span class="o">&lt;</span><span class="n">Integer</span><span class="o">&gt;&gt;</span> <span class="n">futures</span> <span class="o">=</span>
  <span class="k">new</span> <span class="n">ArrayList</span><span class="o">&lt;&gt;(</span><span class="n">threads</span><span class="o">);</span>
<span class="k">for</span> <span class="o">(</span><span class="kt">int</span> <span class="n">t</span> <span class="o">=</span> <span class="mi">0</span><span class="o">;</span> <span class="n">t</span> <span class="o">&lt;</span> <span class="n">threads</span><span class="o">;</span> <span class="o">++</span><span class="n">t</span><span class="o">)</span> <span class="o">{</span>
  <span class="kd">final</span> <span class="n">String</span> <span class="n">title</span> <span class="o">=</span> <span class="n">String</span><span class="o">.</span><span class="na">format</span><span class="o">(</span><span class="s">&quot;Book #%d&quot;</span><span class="o">,</span> <span class="n">t</span><span class="o">);</span>
  <span class="n">futures</span><span class="o">.</span><span class="na">add</span><span class="o">(</span>
    <span class="n">service</span><span class="o">.</span><span class="na">submit</span><span class="o">(</span>
      <span class="o">()</span> <span class="o">-&gt;</span> <span class="o">{</span>
        <span class="k">if</span> <span class="o">(</span><span class="n">running</span><span class="o">.</span><span class="na">get</span><span class="o">())</span> <span class="o">{</span>
          <span class="n">overlaps</span><span class="o">.</span><span class="na">incrementAndGet</span><span class="o">();</span>
        <span class="o">}</span>
        <span class="n">running</span><span class="o">.</span><span class="na">set</span><span class="o">(</span><span class="kc">true</span><span class="o">);</span>
        <span class="kt">int</span> <span class="n">id</span> <span class="o">=</span> <span class="n">books</span><span class="o">.</span><span class="na">add</span><span class="o">(</span><span class="n">title</span><span class="o">);</span>
        <span class="n">running</span><span class="o">.</span><span class="na">set</span><span class="o">(</span><span class="kc">false</span><span class="o">);</span>
        <span class="k">return</span> <span class="n">id</span><span class="o">;</span>
      <span class="o">}</span>
    <span class="o">)</span>
  <span class="o">);</span>
<span class="o">}</span>
<span class="n">assertThat</span><span class="o">(</span><span class="n">overlaps</span><span class="o">.</span><span class="na">get</span><span class="o">(),</span> <span class="n">greaterThan</span><span class="o">(</span><span class="mi">0</span><span class="o">));</span></code></pre></figure><p>With this code I&#39;m trying to see how often threads overlap each other and do something in parallel. This never happens and <code>overlaps</code> is equal to zero. Thus our test is not really testing anything yet. It just adds ten books to the bookshelf one by one. If I increase the amount of threads to 1000, they start to overlap sometimes. But we want them to overlap even when there&#39;s a small number of them. To solve that we need to use <a href="https://docs.oracle.com/javase/7/docs/api/java/util/concurrent/CountDownLatch.html"><code>CountDownLatch</code></a>:</p><figure class="highlight"><pre><code class="language-java" data-lang="java"><span></span><span class="n">CountDownLatch</span> <span class="n">latch</span> <span class="o">=</span> <span class="k">new</span> <span class="n">CountDownLatch</span><span class="o">(</span><span class="mi">1</span><span class="o">);</span>
<span class="n">AtomicBoolean</span> <span class="n">running</span> <span class="o">=</span> <span class="k">new</span> <span class="n">AtomicBoolean</span><span class="o">();</span>
<span class="n">AtomicInteger</span> <span class="n">overlaps</span> <span class="o">=</span> <span class="k">new</span> <span class="n">AtomicInteger</span><span class="o">();</span>
<span class="n">Collection</span><span class="o">&lt;</span><span class="n">Future</span><span class="o">&lt;</span><span class="n">Integer</span><span class="o">&gt;&gt;</span> <span class="n">futures</span> <span class="o">=</span>
  <span class="k">new</span> <span class="n">ArrayList</span><span class="o">&lt;&gt;(</span><span class="n">threads</span><span class="o">);</span>
<span class="k">for</span> <span class="o">(</span><span class="kt">int</span> <span class="n">t</span> <span class="o">=</span> <span class="mi">0</span><span class="o">;</span> <span class="n">t</span> <span class="o">&lt;</span> <span class="n">threads</span><span class="o">;</span> <span class="o">++</span><span class="n">t</span><span class="o">)</span> <span class="o">{</span>
  <span class="kd">final</span> <span class="n">String</span> <span class="n">title</span> <span class="o">=</span> <span class="n">String</span><span class="o">.</span><span class="na">format</span><span class="o">(</span><span class="s">&quot;Book #%d&quot;</span><span class="o">,</span> <span class="n">t</span><span class="o">);</span>
  <span class="n">futures</span><span class="o">.</span><span class="na">add</span><span class="o">(</span>
    <span class="n">service</span><span class="o">.</span><span class="na">submit</span><span class="o">(</span>
      <span class="o">()</span> <span class="o">-&gt;</span> <span class="o">{</span>
        <span class="n">latch</span><span class="o">.</span><span class="na">await</span><span class="o">();</span>
        <span class="k">if</span> <span class="o">(</span><span class="n">running</span><span class="o">.</span><span class="na">get</span><span class="o">())</span> <span class="o">{</span>
          <span class="n">overlaps</span><span class="o">.</span><span class="na">incrementAndGet</span><span class="o">();</span>
        <span class="o">}</span>
        <span class="n">running</span><span class="o">.</span><span class="na">set</span><span class="o">(</span><span class="kc">true</span><span class="o">);</span>
        <span class="kt">int</span> <span class="n">id</span> <span class="o">=</span> <span class="n">books</span><span class="o">.</span><span class="na">add</span><span class="o">(</span><span class="n">title</span><span class="o">);</span>
        <span class="n">running</span><span class="o">.</span><span class="na">set</span><span class="o">(</span><span class="kc">false</span><span class="o">);</span>
        <span class="k">return</span> <span class="n">id</span><span class="o">;</span>
      <span class="o">}</span>
    <span class="o">)</span>
  <span class="o">);</span>
<span class="o">}</span>
<span class="n">latch</span><span class="o">.</span><span class="na">countDown</span><span class="o">();</span>
<span class="n">Set</span><span class="o">&lt;</span><span class="n">Integer</span><span class="o">&gt;</span> <span class="n">ids</span> <span class="o">=</span> <span class="k">new</span> <span class="n">HashSet</span><span class="o">&lt;&gt;();</span>
<span class="k">for</span> <span class="o">(</span><span class="n">Future</span><span class="o">&lt;</span><span class="n">Integer</span><span class="o">&gt;</span> <span class="n">f</span> <span class="o">:</span> <span class="n">futures</span><span class="o">)</span> <span class="o">{</span>
  <span class="n">ids</span><span class="o">.</span><span class="na">add</span><span class="o">(</span><span class="n">f</span><span class="o">.</span><span class="na">get</span><span class="o">());</span>
<span class="o">}</span>
<span class="n">assertThat</span><span class="o">(</span><span class="n">overlaps</span><span class="o">.</span><span class="na">get</span><span class="o">(),</span> <span class="n">greaterThan</span><span class="o">(</span><span class="mi">0</span><span class="o">));</span></code></pre></figure><p>Now each thread, before touching the books, waits for the permission given by <code>latch</code>. When we submit them all via <code>submit()</code> they stay on hold and wait. Then we release the latch with <code>countDown()</code> and they all start to go, simultaneously. Now, on my laptop, <code>overlaps</code> is equal to 3-5 even when <code>threads</code> is 10.</p><p>And that last <code>assertThat()</code> crashes now! I&#39;m not getting 10 book IDs, as I was before. It&#39;s 7-9, but never 10. The class, apparently, is not thread-safe!</p><p>But before we fix the class, let&#39;s make our test simpler. Let&#39;s use <a href="http://static.javadoc.io/org.cactoos/cactoos/0.29/org/cactoos/matchers/RunsInThreads.html"><code>RunInThreads</code></a> from <a href="http://www.cactoos.org">Cactoos</a>, which does exactly the same as we&#39;ve done above, but under the hood:</p><figure class="highlight"><pre><code class="language-java" data-lang="java"><span></span><span class="kd">class</span> <span class="nc">BooksTest</span> <span class="o">{</span>
  <span class="nd">@Test</span>
  <span class="kd">public</span> <span class="kt">void</span> <span class="nf">addsAndRetrieves</span><span class="o">()</span> <span class="o">{</span>
    <span class="n">Books</span> <span class="n">books</span> <span class="o">=</span> <span class="k">new</span> <span class="n">Books</span><span class="o">();</span>
    <span class="n">MatcherAssert</span><span class="o">.</span><span class="na">assertThat</span><span class="o">(</span>
      <span class="n">t</span> <span class="o">-&gt;</span> <span class="o">{</span>
        <span class="n">String</span> <span class="n">title</span> <span class="o">=</span> <span class="n">String</span><span class="o">.</span><span class="na">format</span><span class="o">(</span>
          <span class="s">&quot;Book #%d&quot;</span><span class="o">,</span> <span class="n">t</span><span class="o">.</span><span class="na">getAndIncrement</span><span class="o">()</span>
        <span class="o">);</span>
        <span class="kt">int</span> <span class="n">id</span> <span class="o">=</span> <span class="n">books</span><span class="o">.</span><span class="na">add</span><span class="o">(</span><span class="n">title</span><span class="o">);</span>
        <span class="k">return</span> <span class="n">books</span><span class="o">.</span><span class="na">title</span><span class="o">(</span><span class="n">id</span><span class="o">).</span><span class="na">equals</span><span class="o">(</span><span class="n">title</span><span class="o">);</span>
      <span class="o">},</span>
      <span class="k">new</span> <span class="n">RunsInThreads</span><span class="o">&lt;&gt;(</span><span class="k">new</span> <span class="n">AtomicInteger</span><span class="o">(),</span> <span class="mi">10</span><span class="o">)</span>
    <span class="o">);</span>
  <span class="o">}</span>
<span class="o">}</span></code></pre></figure> <figure class='badge'><a href='http://amzn.to/2c7sVS1'><img src='https://www.yegor256.com/images/2014/12/java-concurrency-in-practice.png' style='width:100px;max-width:100%;' alt='badge'/></a></figure><p>The first argument of <code>assertThat()</code> is an instance of <a href="http://static.javadoc.io/org.cactoos/cactoos/0.29/org/cactoos/Func.html"><code>Func</code></a> (a functional interface), accepting an <a href="https://docs.oracle.com/javase/8/docs/api/java/util/concurrent/atomic/AtomicInteger.html"><code>AtomicInteger</code></a> (the first argument of <code>RunsInThreads</code>) and returning <code>Boolean</code>. This function will be executed on 10 parallel thread, using the same latch-based approach as demonstrated above.</p><p>This <code>RunInThreads</code> seems to be compact and convenient, I&#39;m using it in a few projects already.</p><p>By the way, in order to make <code>Books</code> thread-safe we just need to add <code>synchronized</code> to its method <code>add()</code>. Or maybe you can suggest a better solution?</p><p>P.S. I learned all this from <a href="http://amzn.to/2c7sVS1">Java Concurrency in Practice</a> by Goetz et al.</p><blockquote class="twitter-tweet" data-lang="en"><p lang="en" dir="ltr">Do you create unit tests to prove that your classes are thread-safe?</p>&mdash; Yegor Bugayenko (@yegor256) <a href="https://twitter.com/yegor256/status/1028678871187640329?ref_src=twsrc%5Etfw">August 12, 2018</a></blockquote> <script async src="https://platform.twitter.com/widgets.js" charset="utf-8"></script></div></article></div><div class="wrapper"> <related-posts /></div><div class="disqus" role="complementary"><p class="disqus_hint"> Please, use <a href="https://help.disqus.com/commenting/what-html-tags-are-allowed-within-comments">syntax highlighting</a> in your comments, to make them more readable.</p><div id="disqus_thread" class="disqus-thread"> <a>&nbsp;</a></div><script> var disqus_config = function () { this.page.url = document.location.href.split('?')[0].split('#')[0].replace('https://', 'http://'); this.page.identifier = this.page.url; }; (function() { var d = document, s = d.createElement('script'); s.src = '//yegor256.disqus.com/embed.js'; s.setAttribute('data-timestamp', +new Date()); (d.head || d.body).appendChild(s); })(); </script> <noscript><div><p class="red"> JavaScript is disabled in your browser, that's why you can't see comments under this post.</p></div></noscript></div><div class="wrapper"> <footer class="footer"><p> &copy; <span itemscope="" itemprop="copyrightHolder" itemtype="http://schema.org/Person"> <span itemprop="name">Yegor Bugayenko</span> </span> 2014&ndash;<span itemprop="copyrightYear">2018</span></p></footer></div></section><div class="wrapper unprintable" style="text-align:center;margin-top:2em;"> <a href="http://www.sixnines.io/h/3ba1652f"> <img src="//www.sixnines.io/b/3ba1652f?style=flat" alt="sixnines availability badge"/> </a></div><script src="//code.jquery.com/jquery-1.9.0.min.js"></script> <script src="/js/all.js?4e047f6f42b"></script> <script>var disqus_shortname = 'yegor256';</script> <script id="dsq-count-scr" src="//yegor256.disqus.com/count.js" async="async"></script> <script> (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){ (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o), m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m) })(window,document,'script','//www.google-analytics.com/analytics.js','ga'); ga('create', 'UA-1963507-32', 'auto'); ga('send', 'pageview'); </script> <script> Cd=document;Cr="&"+Math.random();Cp="&s=1"; Cd.cookie="b=b";if(Cd.cookie)Cp+="&c=1"; Cp+="&t="+(new Date()).getTimezoneOffset(); if(self!=top)Cp+="&f=1"; </script> <script> if(navigator.javaEnabled())Cp+="&j=1"; </script> <script> if(typeof(screen)!='undefined')Cp+="&w="+screen.width+"&h="+ screen.height+"&d="+(screen.colorDepth?screen.colorDepth:screen.pixelDepth); </script> <script> Cd.write("<img src='//c.hit.ua/hit?i=95870&g=0&x=2"+Cp+Cr+ "&r="+escape(Cd.referrer)+"&u="+escape(window.location.href)+ "' border='0' wi"+"dth='1' he"+"ight='1'/>"); </script> <script type="application/ld+json"> { "@context": "http://schema.org", "@type": "Person", "name": "Yegor Bugayenko", "url": "http://www.yegor256.com", "sameAs": [ "https://www.facebook.com/yegor256", "https://instagram.com/yegor256", "https://www.linkedin.com/in/yegor256", "https://twitter.com/yegor256", "https://github.com/yegor256", "https://www.pinterest.com/yegor256/" ] } </script> </body> </html> <!DOCTYPE html> <html xmlns="http://www.w3.org/1999/xhtml" lang="en-US" xml:lang="en-US" itemscope="" itemtype="http://schema.org/WebSite"> <head> <meta charset="utf-8"/> <meta name="description" content="Fluent interface is a very popular and convenient design pattern, which, however, makes objects larger and less maintainable. " /> <meta name="keywords" content="fluent interface, fluent interface is evil, fluent interface java, fluent interfaces are evil, oop fluent interface" /> <meta name="viewport" content="width=device-width,minimum-scale=1,initial-scale=1"/> <meta name="google-site-verification" content="JEj_gQr2CPe2QKGw8XdMz0R7VboQIUbX3FlM-lwTq-8" /> <meta name="author" content="Yegor Bugayenko"> <meta name="article:published_time" content="2018-03-13 00:00:00 +0000"> <meta name="og:site_name" content="Yegor Bugayenko"/> <meta name="og:type" content="article" /> <meta name="og:locale" content="en_US" /> <meta name="twitter:account_id" content="4503599630178231" /> <meta name="twitter:creator" content="@yegor256"/> <meta name="twitter:site" content="@yegor256"/> <meta name="twitter:title" property="og:title" content="Fluent Interfaces Are Bad for Maintainability"/> <meta name="twitter:description" property="og:description" content="Fluent interface is a very popular and convenient design pattern, which, however, makes objects larger and less maintainable. "/> <meta name="twitter:url" property="og:url" content="https://www.yegor256.com/2018/03/13/fluent-interfaces.html"/> <meta name="telegram:channel" content="AAAAAEJFMRzsRTRxM3ec6A"/> <link rel="search" type="application/opensearchdescription+xml" href="/opensearch.xml" title="yegor256" /> <link rel="shortcut icon" href="/favicon.ico?4e047f6f42b"/> <link rel="apple-touch-icon" href="/favicon.ico?4e047f6f42b"/> <link rel="alternate" type="application/rss+xml" title="RSS for yegor256.com" href="https://www.yegor256.com/rss.xml"/> <link rel="stylesheet" href="/css/layout.css?4e047f6f42b"/> <link rel="stylesheet" href="/css/icons.css?4e047f6f42b"/> <link rel="canonical" href="https://www.yegor256.com/2018/03/13/fluent-interfaces.html" /> <link rel="amphtml" href="https://www.yegor256.com/2018/03/13/fluent-interfaces.amp.html" /> <title>Fluent Interfaces Are Bad for Maintainability </title> <meta name='og:image' content='https://www.yegor256.com/images/2018/03/donnie-brasco.jpg'/><meta name='twitter:image' content='https://www.yegor256.com/images/2018/03/donnie-brasco.jpg'/><meta name='og:image:width' content='1280'/> <meta name='twitter:image:width' content='1280'/><meta name='og:image:height' content='720'/> <meta name='twitter:image:height' content='720'/><meta name='twitter:card' content='summary_large_image'/><meta name='twitter:image:alt' content='Donnie Brasco (1997) by Mike Newell'/> </head> <body><div class="wrapper"> <aside class="header-toggle unprintable" id="header-toggle" title="Show the menu" onclick="$('#header').show();$('#header-toggle').hide();">&#9776;</aside> <header class="header" id="header"><div class="face"> <a href="/about-me.html#form" class="sub" title="Click to subscribe to my monthly newsletter"><span>Subscribe</span></a> <a href="/about-me.html" style="position:relative;"> <img src="/images/face-256x256.jpg" class="photo" alt="Yegor Bugayenko"/> </a></div><nav><ul class="menu social notranslate"> <li><a href="https://twitter.com/intent/follow?screen_name=yegor256" rel="nofollow" title="Follow me on Twitter"><i class="icon icon-twitter notranslate" aria-hidden="true"></i></a></li> <li><a href="/rss.xml" rel="nofollow" title="Subscribe to my RSS feed"><i class="icon icon-rss notranslate" aria-hidden="true"></i></a></li> <li><a itemprop="sameAs" href="https://github.com/yegor256" rel="nofollow" title="My GitHub profile"><i class="icon icon-github notranslate" aria-hidden="true"></i></a></li> <li><a itemprop="sameAs" href="http://stackoverflow.com/users/187141/yegor256" rel="nofollow" title="My StackOverflow profile"><i class="icon icon-stackoverflow notranslate" aria-hidden="true"></i></a></li> <li><a itemprop="sameAs" href="https://www.facebook.com/yegor256" rel="nofollow" title="Follow me on Facebook"><i class="icon icon-facebook notranslate" aria-hidden="true"></i></a></li> <li><a itemprop="sameAs" href="https://instagram.com/yegor256" rel="nofollow" title="Follow me on Instagram"><i class="icon icon-instagram notranslate" aria-hidden="true"></i></a></li> <li><a itemprop="sameAs" href="https://www.linkedin.com/in/yegor256" rel="nofollow" title="My LinkedIn profile"><i class="icon icon-linkedin notranslate" aria-hidden="true"></i></a></li> <li><a itemprop="sameAs" href="https://www.youtube.com/c/yegor256?sub_confirmation=1" rel="nofollow" title="My Youtube video channel"><i class="icon icon-youtube notranslate" aria-hidden="true"></i></a></li> <li><a itemprop="sameAs" href="https://www.pinterest.com/yegor256/" rel="nofollow" title="My Pinterest boards"><i class="icon icon-pinterest notranslate" aria-hidden="true"></i></a></li> <li><a itemprop="sameAs" href="https://angel.co/yegor256" rel="nofollow" title="My AngelList profile"><i class="icon icon-angellist notranslate" aria-hidden="true"></i></a></li> <li><a href="https://soundcloud.com/yegor256" rel="nofollow" title="My podcast"><i class="icon icon-podcast notranslate" aria-hidden="true"></i></a></li> <li><a href="https://itunes.apple.com/us/podcast/yegor256-podcast/id1150826721" rel="nofollow" title="My iTunes podcast"><i class="icon icon-itunes notranslate" aria-hidden="true"></i></a></li> <li><a href="https://t.me/joinchat/AAAAAEJFMRzsRTRxM3ec6A" rel="nofollow" title="My Telegram public channel"><i class="icon icon-telegram notranslate" aria-hidden="true"></i></a></li> <li><a href="mailto:blog@yegor256.com" rel="nofollow" title="Email me any time"><i class="icon icon-mail notranslate" aria-hidden="true"></i></a></li></ul><ul class="menu"> <li><a href="/" title="Home page">Home</a></li> <li ><a href="/best.html" title="Best articles to read">12&#160;Best</a></li> <li ><a href="/contents.html" title="The contents of the entire blog">All&#160;288</a></li> <li ><a href="/webinars.html" title="My webinars">Webinars</a></li> <li ><a href="/talks.html" title="Future and past conference talks">Talks</a></li> <li ><a href="/books.html" title="The books I wrote">Books</a></li> <li ><a href="/papers.html" title="My academic papers and patents">Papers</a></li> <li ><a href="/pets.html" title="My loved pet projects">Pets</a></li> <li ><a href="/award.html" title="Software quality award">Award</a></li> <li ><a href="/testimonials.html" title="What some people say about me">Testimonials</a></li> <li ><a href="/shift-m.html" title="Audio podcast about project management">Shift-M</a></li> <li ><a href="/paintings.html" title="My paintings for sale">Paintings</a></li> <li><a href="http://ru.yegor256.com/" title="Немного на русском языке">По-русски</a></li></ul></nav><div class="search"> <form method="get" action="https://www.google.com/search" itemprop="potentialAction" itemscope="" itemtype="http://schema.org/SearchAction"> <meta itemprop="target" content="https://www.google.com/search?q={q}"/> <input name="sitesearch" value="yegor256.com" type="hidden"/> <input itemprop="query-input" type="text" id="search-query" class="field field-text" required="required" onfocus="$('.google').css('visibility', 'visible');" name="q" placeholder="Search..." autocomplete="off"/> <input type="image" src="/images/google-search-icon.svg" class="google" title="Search via Google" alt="Search via Google"/> </form></div><div class="hot"><ul> <li> <a href="/code-ahead.html">Code Ahead</a> was published on Amazon just a few days ago! It is my new book, a novel about programmers. It explains in details the majority of ideas that stand behind <a href="https://www.zerocracy.com">Zerocracy</a> and <a href="https://www.xdsd.org">XDSD</a>. </li> <li> At <a href="/webinars.html">Webinar #37</a> we will discuss naming problem in OOP, for objects, methods and attributes; join us on <b>September 12</b>, at 11am PST. </li></ul></div></header></div><section itemscope="" itemtype="http://schema.org/BlogPosting"><div class="wrapper"> <header><p class="printable"> <img src="https://api.qrserver.com/v1/create-qr-code/?data=https://www.yegor256.com/2018/03/13/fluent-interfaces.html&amp;format=svg" style="width:125px;height:125px;" alt="QR code"/></p><p class="printable"> <code itemprop="url">https://www.yegor256.com/2018/03/13/fluent-interfaces.html</code></p><h1 itemprop="name headline mainEntityOfPage">Fluent Interfaces Are Bad for Maintainability</h1><ul class="subline"> <li> <time itemprop="datePublished" datetime="2018-03-13T00:00:00+00:00"> 13 March 2018 </time> </li> <li class="desktop-only" itemprop="locationCreated">Moscow, Russia</li> <li class="printable" itemscope="" itemprop="author" itemtype="http://schema.org/Person"> <span itemprop="name">Yegor Bugayenko</span> </li> <li class="unprintable"> <i class="icon icon-comments"></i> <a href="http://www.yegor256.com/2018/03/13/fluent-interfaces.html#disqus_thread" itemprop="discussionUrl">comments</a> </li></ul><ul class="subline"> <li>Discussed at:</li> <li><a href="https://news.ycombinator.com/item?id=16619171">hackernews</a></li></ul><figure class='jb_picture'><img itemprop='image' alt='Donnie Brasco (1997) by Mike Newell' src='/images/2018/03/donnie-brasco.jpg' longdesc='#bda17a6d'/><figcaption id='bda17a6d'>Donnie Brasco (1997) by Mike Newell</figcaption></figure><p>Let&#39;s take my own library <a href="http://http.jcabi.com/">jcabi-http</a>, which I created a few years ago, when I thought that fluent interfaces were a good thing. Here is how you use the library to make an HTTP request and validate its output:</p><figure class="highlight"><pre><code class="language-java" data-lang="java"><span></span><span class="n">String</span> <span class="n">html</span> <span class="o">=</span> <span class="k">new</span> <span class="n">JdkRequest</span><span class="o">(</span><span class="s">&quot;https://www.google.com&quot;</span><span class="o">)</span>
  <span class="o">.</span><span class="na">method</span><span class="o">(</span><span class="s">&quot;GET&quot;</span><span class="o">)</span>
  <span class="o">.</span><span class="na">fetch</span><span class="o">()</span>
  <span class="o">.</span><span class="na">as</span><span class="o">(</span><span class="n">RestResponse</span><span class="o">.</span><span class="na">class</span><span class="o">)</span>
  <span class="o">.</span><span class="na">assertStatus</span><span class="o">(</span><span class="mi">200</span><span class="o">)</span>
  <span class="o">.</span><span class="na">body</span><span class="o">();</span></code></pre></figure><p>This convenient <a href="https://en.wikipedia.org/wiki/Method_chaining">method chaining</a> makes the code short and obvious, right? Yes, it does, on the surface. But the <em>internal</em> design of the library&#39;s classes, including <a href="http://static.javadoc.io/com.jcabi/jcabi-http/1.17.2/com/jcabi/http/request/JdkRequest.html"><code>JdkRequest</code></a>, which is the one you see, is very far from being elegant. The biggest problem is that they are rather big and it&#39;s <del>difficult</del> impossible to extend them without making them even bigger.</p><aside class='youtube'> <a href='https://www.youtube.com/watch?v=REj8pJesMVI'><div class='box'> <img src='https://i.ytimg.com/vi/REj8pJesMVI/mqdefault.jpg' alt='YouTube video #REj8pJesMVI'/><div class='play'><i class='icon icon-play'></i></div></div></a><div>The Alternative to Fluent Interfaces in Java (webinar #33); 4 April 2018.</div></aside><p>For example, right now <a href="http://static.javadoc.io/com.jcabi/jcabi-http/1.17.2/com/jcabi/http/request/JdkRequest.html"><code>JdkRequest</code></a> has the methods <a href="http://static.javadoc.io/com.jcabi/jcabi-http/1.17.2/com/jcabi/http/Request.html#method%28java.lang.String%29"><code>method()</code></a>, <a href="http://static.javadoc.io/com.jcabi/jcabi-http/1.17.2/com/jcabi/http/Request.html#fetch%28%29"><code>fetch()</code></a>, and a few others. What happens when new functionality is required? The only way to add to it would be to make the class bigger, by adding new methods, which is how we jeopardize its maintainability. <a href="https://github.com/jcabi/jcabi-http/pull/142/files">Here</a>, for example, we added <a href="http://static.javadoc.io/com.jcabi/jcabi-http/1.17.2/com/jcabi/http/Request.html#multipartBody%28%29"><code>multipartBody()</code></a> and <a href="https://github.com/jcabi/jcabi-http/pull/99/files">here</a> we added <a href="http://static.javadoc.io/com.jcabi/jcabi-http/1.17.2/com/jcabi/http/Request.html#timeout%28int,%20int%29">timeout()</a>.</p><p>I always feel scared when I get a new feature request in jcabi-http. I understand that it most probably means adding new methods to <a href="http://static.javadoc.io/com.jcabi/jcabi-http/1.17.2/com/jcabi/http/Request.html"><code>Request</code></a>, <a href="http://static.javadoc.io/com.jcabi/jcabi-http/1.17.2/com/jcabi/http/Response.html"><code>Response</code></a>, and other already bloated interfaces and classes.</p><p>I actually tried to do something in the library in order to solve this problem but it wasn&#39;t easy. Look at this <a href="http://static.javadoc.io/com.jcabi/jcabi-http/1.17.2/com/jcabi/http/Response.html#as%28java.lang.Class%29"><code>.as(RestResponse.class)</code></a> method call. What it does is decorate a <code>Response</code> with <a href="http://static.javadoc.io/com.jcabi/jcabi-http/1.17.2/com/jcabi/http/response/RestResponse.html"><code>RestResponse</code></a>, in order to make it method-richer. I just didn&#39;t want to make <a href="http://static.javadoc.io/com.jcabi/jcabi-http/1.17.2/com/jcabi/http/Response.html"><code>Response</code></a> contain 50+ methods, like many other libraries do. Here is what it does (this is pseudo-code):</p><figure class="highlight"><pre><code class="language-text" data-lang="text"><span></span>class Response {
  RestResponse as() {
    return new RestResponse(this);
  }
  // Seven methods
}
class RestResponse implements Response {
  private final Response origin;
  // Original seven methods from Response
  // Additional 14 methods
}</code></pre></figure><p>As you see, instead of adding all possible methods to <code>Response</code> I placed them in supplementary decorators <a href="http://static.javadoc.io/com.jcabi/jcabi-http/1.17.2/com/jcabi/http/response/RestResponse.html"><code>RestResponse</code></a>, <a href="http://static.javadoc.io/com.jcabi/jcabi-http/1.17.2/com/jcabi/http/response/JsonResponse.html"><code>JsonResponse</code></a>, <a href="http://static.javadoc.io/com.jcabi/jcabi-http/1.17.2/com/jcabi/http/response/JsonResponse.html"><code>XmlResponse</code></a>, and <a href="http://static.javadoc.io/com.jcabi/jcabi-http/1.17.2/com/jcabi/http/response/package-frame.html">others</a>. It helps, but in order to write these decorators with the central object of type <code>Response</code> we have to use that &quot;ugly&quot; method <a href="http://static.javadoc.io/com.jcabi/jcabi-http/1.17.2/com/jcabi/http/Response.html#as%28java.lang.Class%29"><code>as()</code></a>, which depends heavily on Reflection and <a href="/2015/04/02/class-casting-is-anti-pattern.html">type casting</a>.</p><aside class='quote'>Fluent interfaces mean large classes or some ugly workarounds.</aside><p>In other words, fluent interfaces mean large classes or some ugly workarounds. I mentioned this problem earlier, when I <a href="/2017/10/10/streams-vs-decorators.html">wrote</a> about <a href="http://www.oracle.com/technetwork/articles/java/ma14-java-se-8-streams-2177646.html">Streams API</a> and the interface <a href="https://docs.oracle.com/javase/8/docs/api/java/util/stream/Stream.html">Stream</a>, which is perfectly fluent. There are 43 methods!</p><p>That is the biggest problem with fluent interfaces---they <em>force</em> objects to be huge.</p><p>Fluent interfaces are perfect for their users, since all methods are in one place and the amount of classes is very small. It is easy to use them, especially with <a href="https://www.jetbrains.com/help/idea/auto-completing-code.html">code auto-completion</a> in most IDEs. They also make client code more readable, since &quot;fluent&quot; constructs look similar to plain English (aka <a href="https://en.wikipedia.org/wiki/Domain-specific_language">DSL</a>).</p><p>That is all true! However, the damage they cause to object design is the price, which is too high.</p><p>What is the alternative?</p><p>I would recommend you use decorators and <a href="/2016/04/26/why-inputstream-design-is-wrong.html">smart objects</a> instead. Here is how I would design jcabi-http, if I could do it now:</p><figure class="highlight"><pre><code class="language-java" data-lang="java"><span></span><span class="n">String</span> <span class="n">html</span> <span class="o">=</span> <span class="k">new</span> <span class="n">BodyOfResponse</span><span class="o">(</span>
  <span class="k">new</span> <span class="n">ResponseAssertStatus</span><span class="o">(</span>
    <span class="k">new</span> <span class="n">RequestWithMethod</span><span class="o">(</span>
      <span class="k">new</span> <span class="n">JdkRequest</span><span class="o">(</span><span class="s">&quot;https://www.google.com&quot;</span><span class="o">),</span>
      <span class="s">&quot;GET&quot;</span>
    <span class="o">),</span>
    <span class="mi">200</span>
  <span class="o">)</span>
<span class="o">).</span><span class="na">toString</span><span class="o">();</span></code></pre></figure><p>This is the same code as in the first snippet above, but it is much more object-oriented. The obvious problem with this code, of course, is that the IDE won&#39;t be able to auto-complete almost anything. Also, we will have to remember many of the names of the classes. And the construct looks rather difficult to read for those who are used to fluent interfaces. In addition, it&#39;s very far away from the DSL idea.</p><aside class='quote'>Fluent interfaces are good for users, but bad for developers. Small objects are good for developers, but difficult to use.</aside><p>But here is the list of benefits. First, each object is small, very cohesive and they are all loosely coupled---which are obvious merits in OOP. Second, adding new functionality to the library is as easy as creating a new class; no need to touch existing classes. Third, unit testing is simplified, since classes are small. Fourth, all classes can be immutable, which is also an <a href="/2014/06/09/objects-should-be-immutable.html">obvious merit</a> in OOP.</p><p>Thus, there seems to be a conflict between usefulness and maintainability. Fluent interfaces are good for users, but bad for library developers. Small objects are good for developers, but difficult to understand and use.</p><p>It seems to be so, but only if you are used to large classes and procedural programming. To me, a large amount of small classes seems to be an <a href="/2017/02/28/too-many-classes.html">advantage</a>, not a drawback. Libraries that are clear, simple, and readable inside are much easier to use, even when I don&#39;t know exactly which classes out there are the most suitable for me. Even without the code-auto-complete I can figure it out myself, because the code is clean.</p><p>Also, I very often find myself interested in extending existing functionality either inside my code base or via a pull request to the library. I am much more <a href="/2015/12/22/why-dont-you-contribute-to-open-source.html">interested</a> to do that if I know that the changes I introduce are isolated and easy to test.</p><p>Thus, no fluent interfaces anymore from me, only objects and decorators.</p></p>--> <nav class="buttons notranslate desktop-only"> <a href="http://www.facebook.com/sharer/sharer.php?u=https://www.yegor256.com/2018/03/13/fluent-interfaces.html" title="Share on Facebook" class="button" rel="nofollow"> <span class="count count-facebook">0</span> <i class="icon icon-facebook notranslate" aria-hidden="true"></i> </a> <a href="https://twitter.com/share?url=https://www.yegor256.com/2018/03/13/fluent-interfaces.html&amp;text=Fluent+Interfaces+Are+Bad+for+Maintainability" title="Share on Twitter" class="button" rel="nofollow"> <span class="count count-twitter">0</span> <i class="icon icon-twitter notranslate" aria-hidden="true"></i> </a> <a href="https://plus.google.com/share?url=https://www.yegor256.com/2018/03/13/fluent-interfaces.html" title="Share on Google+" class="button" rel="nofollow"> <span class="count count-googleplus">0</span> <i class="icon icon-googleplus notranslate" aria-hidden="true"></i> </a> <a href="https://www.linkedin.com/cws/share?url=https://www.yegor256.com/2018/03/13/fluent-interfaces.html" title="Share on LinkedIn" class="button" rel="nofollow"> <span class="count count-linkedin">0</span> <i class="icon icon-linkedin notranslate" aria-hidden="true"></i> </a> <a href="http://reddit.com/submit?url=https://www.yegor256.com/2018/03/13/fluent-interfaces.html%3F2018-10&amp;title=Fluent+Interfaces+Are+Bad+for+Maintainability" title="Share on Reddit" class="button" rel="nofollow"> <span class="count count-reddit">0</span> <i class="icon icon-reddit notranslate" aria-hidden="true"></i> </a> <a href="http://news.ycombinator.com/submitlink?u=https://www.yegor256.com/2018/03/13/fluent-interfaces.html%3F2018-10&amp;t=Fluent+Interfaces+Are+Bad+for+Maintainability" title="Share on Hacker News" class="button" rel="nofollow"> <span class="count count-hackernews">0</span> <i class="icon icon-hackernews notranslate" aria-hidden="true"></i> </a> </nav> </header> <article class="main" itemprop="articleBody"><div ><p><a href="https://en.wikipedia.org/wiki/Fluent_interface">Fluent interface</a>, first <a href="https://martinfowler.com/bliki/FluentInterface.html">coined</a> as a term by Martin Fowler, is a very convenient way of communicating with objects in OOP. It makes their facades easier to use and understand. However, it ruins their internal design, making them more difficult to maintain. A few words were said about that by Marco Pivetta in his blog post <a href="https://ocramius.github.io/blog/fluent-interfaces-are-evil/">Fluent Interfaces are Evil</a>; now I will add my few cents.</p><figure class='jb_picture'><img itemprop='image' alt='Donnie Brasco (1997) by Mike Newell' src='/images/2018/03/donnie-brasco.jpg' longdesc='#bda17a6d'/><figcaption id='bda17a6d'>Donnie Brasco (1997) by Mike Newell</figcaption></figure><p>Let&#39;s take my own library <a href="http://http.jcabi.com/">jcabi-http</a>, which I created a few years ago, when I thought that fluent interfaces were a good thing. Here is how you use the library to make an HTTP request and validate its output:</p><figure class="highlight"><pre><code class="language-java" data-lang="java"><span></span><span class="n">String</span> <span class="n">html</span> <span class="o">=</span> <span class="k">new</span> <span class="n">JdkRequest</span><span class="o">(</span><span class="s">&quot;https://www.google.com&quot;</span><span class="o">)</span>
  <span class="o">.</span><span class="na">method</span><span class="o">(</span><span class="s">&quot;GET&quot;</span><span class="o">)</span>
  <span class="o">.</span><span class="na">fetch</span><span class="o">()</span>
  <span class="o">.</span><span class="na">as</span><span class="o">(</span><span class="n">RestResponse</span><span class="o">.</span><span class="na">class</span><span class="o">)</span>
  <span class="o">.</span><span class="na">assertStatus</span><span class="o">(</span><span class="mi">200</span><span class="o">)</span>
  <span class="o">.</span><span class="na">body</span><span class="o">();</span></code></pre></figure><p>This convenient <a href="https://en.wikipedia.org/wiki/Method_chaining">method chaining</a> makes the code short and obvious, right? Yes, it does, on the surface. But the <em>internal</em> design of the library&#39;s classes, including <a href="http://static.javadoc.io/com.jcabi/jcabi-http/1.17.2/com/jcabi/http/request/JdkRequest.html"><code>JdkRequest</code></a>, which is the one you see, is very far from being elegant. The biggest problem is that they are rather big and it&#39;s <del>difficult</del> impossible to extend them without making them even bigger.</p><aside class='youtube'> <a href='https://www.youtube.com/watch?v=REj8pJesMVI'><div class='box'> <img src='https://i.ytimg.com/vi/REj8pJesMVI/mqdefault.jpg' alt='YouTube video #REj8pJesMVI'/><div class='play'><i class='icon icon-play'></i></div></div></a><div>The Alternative to Fluent Interfaces in Java (webinar #33); 4 April 2018.</div></aside><p>For example, right now <a href="http://static.javadoc.io/com.jcabi/jcabi-http/1.17.2/com/jcabi/http/request/JdkRequest.html"><code>JdkRequest</code></a> has the methods <a href="http://static.javadoc.io/com.jcabi/jcabi-http/1.17.2/com/jcabi/http/Request.html#method%28java.lang.String%29"><code>method()</code></a>, <a href="http://static.javadoc.io/com.jcabi/jcabi-http/1.17.2/com/jcabi/http/Request.html#fetch%28%29"><code>fetch()</code></a>, and a few others. What happens when new functionality is required? The only way to add to it would be to make the class bigger, by adding new methods, which is how we jeopardize its maintainability. <a href="https://github.com/jcabi/jcabi-http/pull/142/files">Here</a>, for example, we added <a href="http://static.javadoc.io/com.jcabi/jcabi-http/1.17.2/com/jcabi/http/Request.html#multipartBody%28%29"><code>multipartBody()</code></a> and <a href="https://github.com/jcabi/jcabi-http/pull/99/files">here</a> we added <a href="http://static.javadoc.io/com.jcabi/jcabi-http/1.17.2/com/jcabi/http/Request.html#timeout%28int,%20int%29">timeout()</a>.</p><p>I always feel scared when I get a new feature request in jcabi-http. I understand that it most probably means adding new methods to <a href="http://static.javadoc.io/com.jcabi/jcabi-http/1.17.2/com/jcabi/http/Request.html"><code>Request</code></a>, <a href="http://static.javadoc.io/com.jcabi/jcabi-http/1.17.2/com/jcabi/http/Response.html"><code>Response</code></a>, and other already bloated interfaces and classes.</p><p>I actually tried to do something in the library in order to solve this problem but it wasn&#39;t easy. Look at this <a href="http://static.javadoc.io/com.jcabi/jcabi-http/1.17.2/com/jcabi/http/Response.html#as%28java.lang.Class%29"><code>.as(RestResponse.class)</code></a> method call. What it does is decorate a <code>Response</code> with <a href="http://static.javadoc.io/com.jcabi/jcabi-http/1.17.2/com/jcabi/http/response/RestResponse.html"><code>RestResponse</code></a>, in order to make it method-richer. I just didn&#39;t want to make <a href="http://static.javadoc.io/com.jcabi/jcabi-http/1.17.2/com/jcabi/http/Response.html"><code>Response</code></a> contain 50+ methods, like many other libraries do. Here is what it does (this is pseudo-code):</p><figure class="highlight"><pre><code class="language-text" data-lang="text"><span></span>class Response {
  RestResponse as() {
    return new RestResponse(this);
  }
  // Seven methods
}
class RestResponse implements Response {
  private final Response origin;
  // Original seven methods from Response
  // Additional 14 methods
}</code></pre></figure><p>As you see, instead of adding all possible methods to <code>Response</code> I placed them in supplementary decorators <a href="http://static.javadoc.io/com.jcabi/jcabi-http/1.17.2/com/jcabi/http/response/RestResponse.html"><code>RestResponse</code></a>, <a href="http://static.javadoc.io/com.jcabi/jcabi-http/1.17.2/com/jcabi/http/response/JsonResponse.html"><code>JsonResponse</code></a>, <a href="http://static.javadoc.io/com.jcabi/jcabi-http/1.17.2/com/jcabi/http/response/JsonResponse.html"><code>XmlResponse</code></a>, and <a href="http://static.javadoc.io/com.jcabi/jcabi-http/1.17.2/com/jcabi/http/response/package-frame.html">others</a>. It helps, but in order to write these decorators with the central object of type <code>Response</code> we have to use that &quot;ugly&quot; method <a href="http://static.javadoc.io/com.jcabi/jcabi-http/1.17.2/com/jcabi/http/Response.html#as%28java.lang.Class%29"><code>as()</code></a>, which depends heavily on Reflection and <a href="/2015/04/02/class-casting-is-anti-pattern.html">type casting</a>.</p><aside class='quote'>Fluent interfaces mean large classes or some ugly workarounds.</aside><p>In other words, fluent interfaces mean large classes or some ugly workarounds. I mentioned this problem earlier, when I <a href="/2017/10/10/streams-vs-decorators.html">wrote</a> about <a href="http://www.oracle.com/technetwork/articles/java/ma14-java-se-8-streams-2177646.html">Streams API</a> and the interface <a href="https://docs.oracle.com/javase/8/docs/api/java/util/stream/Stream.html">Stream</a>, which is perfectly fluent. There are 43 methods!</p><p>That is the biggest problem with fluent interfaces---they <em>force</em> objects to be huge.</p><p>Fluent interfaces are perfect for their users, since all methods are in one place and the amount of classes is very small. It is easy to use them, especially with <a href="https://www.jetbrains.com/help/idea/auto-completing-code.html">code auto-completion</a> in most IDEs. They also make client code more readable, since &quot;fluent&quot; constructs look similar to plain English (aka <a href="https://en.wikipedia.org/wiki/Domain-specific_language">DSL</a>).</p><p>That is all true! However, the damage they cause to object design is the price, which is too high.</p><p>What is the alternative?</p><p>I would recommend you use decorators and <a href="/2016/04/26/why-inputstream-design-is-wrong.html">smart objects</a> instead. Here is how I would design jcabi-http, if I could do it now:</p><figure class="highlight"><pre><code class="language-java" data-lang="java"><span></span><span class="n">String</span> <span class="n">html</span> <span class="o">=</span> <span class="k">new</span> <span class="n">BodyOfResponse</span><span class="o">(</span>
  <span class="k">new</span> <span class="n">ResponseAssertStatus</span><span class="o">(</span>
    <span class="k">new</span> <span class="n">RequestWithMethod</span><span class="o">(</span>
      <span class="k">new</span> <span class="n">JdkRequest</span><span class="o">(</span><span class="s">&quot;https://www.google.com&quot;</span><span class="o">),</span>
      <span class="s">&quot;GET&quot;</span>
    <span class="o">),</span>
    <span class="mi">200</span>
  <span class="o">)</span>
<span class="o">).</span><span class="na">toString</span><span class="o">();</span></code></pre></figure><p>This is the same code as in the first snippet above, but it is much more object-oriented. The obvious problem with this code, of course, is that the IDE won&#39;t be able to auto-complete almost anything. Also, we will have to remember many of the names of the classes. And the construct looks rather difficult to read for those who are used to fluent interfaces. In addition, it&#39;s very far away from the DSL idea.</p><aside class='quote'>Fluent interfaces are good for users, but bad for developers. Small objects are good for developers, but difficult to use.</aside><p>But here is the list of benefits. First, each object is small, very cohesive and they are all loosely coupled---which are obvious merits in OOP. Second, adding new functionality to the library is as easy as creating a new class; no need to touch existing classes. Third, unit testing is simplified, since classes are small. Fourth, all classes can be immutable, which is also an <a href="/2014/06/09/objects-should-be-immutable.html">obvious merit</a> in OOP.</p><p>Thus, there seems to be a conflict between usefulness and maintainability. Fluent interfaces are good for users, but bad for library developers. Small objects are good for developers, but difficult to understand and use.</p><p>It seems to be so, but only if you are used to large classes and procedural programming. To me, a large amount of small classes seems to be an <a href="/2017/02/28/too-many-classes.html">advantage</a>, not a drawback. Libraries that are clear, simple, and readable inside are much easier to use, even when I don&#39;t know exactly which classes out there are the most suitable for me. Even without the code-auto-complete I can figure it out myself, because the code is clean.</p><p>Also, I very often find myself interested in extending existing functionality either inside my code base or via a pull request to the library. I am much more <a href="/2015/12/22/why-dont-you-contribute-to-open-source.html">interested</a> to do that if I know that the changes I introduce are isolated and easy to test.</p><p>Thus, no fluent interfaces anymore from me, only objects and decorators.</p></div></article></div><div class="wrapper"> <related-posts /></div><div class="disqus" role="complementary"><p class="disqus_hint"> Please, use <a href="https://help.disqus.com/commenting/what-html-tags-are-allowed-within-comments">syntax highlighting</a> in your comments, to make them more readable.</p><div id="disqus_thread" class="disqus-thread"> <a>&nbsp;</a></div><script> var disqus_config = function () { this.page.url = document.location.href.split('?')[0].split('#')[0].replace('https://', 'http://'); this.page.identifier = this.page.url; }; (function() { var d = document, s = d.createElement('script'); s.src = '//yegor256.disqus.com/embed.js'; s.setAttribute('data-timestamp', +new Date()); (d.head || d.body).appendChild(s); })(); </script> <noscript><div><p class="red"> JavaScript is disabled in your browser, that's why you can't see comments under this post.</p></div></noscript></div><div class="wrapper"> <footer class="footer"><p> &copy; <span itemscope="" itemprop="copyrightHolder" itemtype="http://schema.org/Person"> <span itemprop="name">Yegor Bugayenko</span> </span> 2014&ndash;<span itemprop="copyrightYear">2018</span></p></footer></div></section><div class="wrapper unprintable" style="text-align:center;margin-top:2em;"> <a href="http://www.sixnines.io/h/3ba1652f"> <img src="//www.sixnines.io/b/3ba1652f?style=flat" alt="sixnines availability badge"/> </a></div><script src="//code.jquery.com/jquery-1.9.0.min.js"></script> <script src="/js/all.js?4e047f6f42b"></script> <script>var disqus_shortname = 'yegor256';</script> <script id="dsq-count-scr" src="//yegor256.disqus.com/count.js" async="async"></script> <script> (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){ (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o), m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m) })(window,document,'script','//www.google-analytics.com/analytics.js','ga'); ga('create', 'UA-1963507-32', 'auto'); ga('send', 'pageview'); </script> <script> Cd=document;Cr="&"+Math.random();Cp="&s=1"; Cd.cookie="b=b";if(Cd.cookie)Cp+="&c=1"; Cp+="&t="+(new Date()).getTimezoneOffset(); if(self!=top)Cp+="&f=1"; </script> <script> if(navigator.javaEnabled())Cp+="&j=1"; </script> <script> if(typeof(screen)!='undefined')Cp+="&w="+screen.width+"&h="+ screen.height+"&d="+(screen.colorDepth?screen.colorDepth:screen.pixelDepth); </script> <script> Cd.write("<img src='//c.hit.ua/hit?i=95870&g=0&x=2"+Cp+Cr+ "&r="+escape(Cd.referrer)+"&u="+escape(window.location.href)+ "' border='0' wi"+"dth='1' he"+"ight='1'/>"); </script> <script type="application/ld+json"> { "@context": "http://schema.org", "@type": "Person", "name": "Yegor Bugayenko", "url": "http://www.yegor256.com", "sameAs": [ "https://www.facebook.com/yegor256", "https://instagram.com/yegor256", "https://www.linkedin.com/in/yegor256", "https://twitter.com/yegor256", "https://github.com/yegor256", "https://www.pinterest.com/yegor256/" ] } </script> </body> </html> <!DOCTYPE html> <html xmlns="http://www.w3.org/1999/xhtml" lang="en-US" xml:lang="en-US" itemscope="" itemtype="http://schema.org/WebSite"> <head> <meta charset="utf-8"/> <meta name="description" content="When project scope is perfectly decomposed and management rules are clear and strict, the speed of delivery is a virtue, not the quality. " /> <meta name="keywords" content="perfection vs speed, quality vs speed, speed is king, speed or perfection, speed vs quality" /> <meta name="viewport" content="width=device-width,minimum-scale=1,initial-scale=1"/> <meta name="google-site-verification" content="JEj_gQr2CPe2QKGw8XdMz0R7VboQIUbX3FlM-lwTq-8" /> <meta name="author" content="Yegor Bugayenko"> <meta name="article:published_time" content="2018-02-27 00:00:00 +0000"> <meta name="og:site_name" content="Yegor Bugayenko"/> <meta name="og:type" content="article" /> <meta name="og:locale" content="en_US" /> <meta name="twitter:account_id" content="4503599630178231" /> <meta name="twitter:creator" content="@yegor256"/> <meta name="twitter:site" content="@yegor256"/> <meta name="twitter:title" property="og:title" content="Don't Parse, Use Parsing Objects"/> <meta name="twitter:description" property="og:description" content="When project scope is perfectly decomposed and management rules are clear and strict, the speed of delivery is a virtue, not the quality. "/> <meta name="twitter:url" property="og:url" content="https://www.yegor256.com/2018/02/27/parsing-objects.html"/> <meta name="telegram:channel" content="AAAAAEJFMRzsRTRxM3ec6A"/> <link rel="search" type="application/opensearchdescription+xml" href="/opensearch.xml" title="yegor256" /> <link rel="shortcut icon" href="/favicon.ico?4e047f6f42b"/> <link rel="apple-touch-icon" href="/favicon.ico?4e047f6f42b"/> <link rel="alternate" type="application/rss+xml" title="RSS for yegor256.com" href="https://www.yegor256.com/rss.xml"/> <link rel="stylesheet" href="/css/layout.css?4e047f6f42b"/> <link rel="stylesheet" href="/css/icons.css?4e047f6f42b"/> <link rel="canonical" href="https://www.yegor256.com/2018/02/27/parsing-objects.html" /> <link rel="amphtml" href="https://www.yegor256.com/2018/02/27/parsing-objects.amp.html" /> <title>Don't Parse, Use Parsing Objects </title> <meta name='og:image' content='https://www.yegor256.com/images/2018/02/la-science-des-reves.jpg'/><meta name='twitter:image' content='https://www.yegor256.com/images/2018/02/la-science-des-reves.jpg'/><meta name='og:image:width' content='1600'/> <meta name='twitter:image:width' content='1600'/><meta name='og:image:height' content='900'/> <meta name='twitter:image:height' content='900'/><meta name='twitter:card' content='summary_large_image'/><meta name='twitter:image:alt' content='La science des rêves (2006) by Michel Gondry'/> </head> <body><div class="wrapper"> <aside class="header-toggle unprintable" id="header-toggle" title="Show the menu" onclick="$('#header').show();$('#header-toggle').hide();">&#9776;</aside> <header class="header" id="header"><div class="face"> <a href="/about-me.html#form" class="sub" title="Click to subscribe to my monthly newsletter"><span>Subscribe</span></a> <a href="/about-me.html" style="position:relative;"> <img src="/images/face-256x256.jpg" class="photo" alt="Yegor Bugayenko"/> </a></div><nav><ul class="menu social notranslate"> <li><a href="https://twitter.com/intent/follow?screen_name=yegor256" rel="nofollow" title="Follow me on Twitter"><i class="icon icon-twitter notranslate" aria-hidden="true"></i></a></li> <li><a href="/rss.xml" rel="nofollow" title="Subscribe to my RSS feed"><i class="icon icon-rss notranslate" aria-hidden="true"></i></a></li> <li><a itemprop="sameAs" href="https://github.com/yegor256" rel="nofollow" title="My GitHub profile"><i class="icon icon-github notranslate" aria-hidden="true"></i></a></li> <li><a itemprop="sameAs" href="http://stackoverflow.com/users/187141/yegor256" rel="nofollow" title="My StackOverflow profile"><i class="icon icon-stackoverflow notranslate" aria-hidden="true"></i></a></li> <li><a itemprop="sameAs" href="https://www.facebook.com/yegor256" rel="nofollow" title="Follow me on Facebook"><i class="icon icon-facebook notranslate" aria-hidden="true"></i></a></li> <li><a itemprop="sameAs" href="https://instagram.com/yegor256" rel="nofollow" title="Follow me on Instagram"><i class="icon icon-instagram notranslate" aria-hidden="true"></i></a></li> <li><a itemprop="sameAs" href="https://www.linkedin.com/in/yegor256" rel="nofollow" title="My LinkedIn profile"><i class="icon icon-linkedin notranslate" aria-hidden="true"></i></a></li> <li><a itemprop="sameAs" href="https://www.youtube.com/c/yegor256?sub_confirmation=1" rel="nofollow" title="My Youtube video channel"><i class="icon icon-youtube notranslate" aria-hidden="true"></i></a></li> <li><a itemprop="sameAs" href="https://www.pinterest.com/yegor256/" rel="nofollow" title="My Pinterest boards"><i class="icon icon-pinterest notranslate" aria-hidden="true"></i></a></li> <li><a itemprop="sameAs" href="https://angel.co/yegor256" rel="nofollow" title="My AngelList profile"><i class="icon icon-angellist notranslate" aria-hidden="true"></i></a></li> <li><a href="https://soundcloud.com/yegor256" rel="nofollow" title="My podcast"><i class="icon icon-podcast notranslate" aria-hidden="true"></i></a></li> <li><a href="https://itunes.apple.com/us/podcast/yegor256-podcast/id1150826721" rel="nofollow" title="My iTunes podcast"><i class="icon icon-itunes notranslate" aria-hidden="true"></i></a></li> <li><a href="https://t.me/joinchat/AAAAAEJFMRzsRTRxM3ec6A" rel="nofollow" title="My Telegram public channel"><i class="icon icon-telegram notranslate" aria-hidden="true"></i></a></li> <li><a href="mailto:blog@yegor256.com" rel="nofollow" title="Email me any time"><i class="icon icon-mail notranslate" aria-hidden="true"></i></a></li></ul><ul class="menu"> <li><a href="/" title="Home page">Home</a></li> <li ><a href="/best.html" title="Best articles to read">12&#160;Best</a></li> <li ><a href="/contents.html" title="The contents of the entire blog">All&#160;288</a></li> <li ><a href="/webinars.html" title="My webinars">Webinars</a></li> <li ><a href="/talks.html" title="Future and past conference talks">Talks</a></li> <li ><a href="/books.html" title="The books I wrote">Books</a></li> <li ><a href="/papers.html" title="My academic papers and patents">Papers</a></li> <li ><a href="/pets.html" title="My loved pet projects">Pets</a></li> <li ><a href="/award.html" title="Software quality award">Award</a></li> <li ><a href="/testimonials.html" title="What some people say about me">Testimonials</a></li> <li ><a href="/shift-m.html" title="Audio podcast about project management">Shift-M</a></li> <li ><a href="/paintings.html" title="My paintings for sale">Paintings</a></li> <li><a href="http://ru.yegor256.com/" title="Немного на русском языке">По-русски</a></li></ul></nav><div class="search"> <form method="get" action="https://www.google.com/search" itemprop="potentialAction" itemscope="" itemtype="http://schema.org/SearchAction"> <meta itemprop="target" content="https://www.google.com/search?q={q}"/> <input name="sitesearch" value="yegor256.com" type="hidden"/> <input itemprop="query-input" type="text" id="search-query" class="field field-text" required="required" onfocus="$('.google').css('visibility', 'visible');" name="q" placeholder="Search..." autocomplete="off"/> <input type="image" src="/images/google-search-icon.svg" class="google" title="Search via Google" alt="Search via Google"/> </form></div><div class="hot"><ul> <li> <a href="/code-ahead.html">Code Ahead</a> was published on Amazon just a few days ago! It is my new book, a novel about programmers. It explains in details the majority of ideas that stand behind <a href="https://www.zerocracy.com">Zerocracy</a> and <a href="https://www.xdsd.org">XDSD</a>. </li> <li> At <a href="/webinars.html">Webinar #37</a> we will discuss naming problem in OOP, for objects, methods and attributes; join us on <b>September 12</b>, at 11am PST. </li></ul></div></header></div><section itemscope="" itemtype="http://schema.org/BlogPosting"><div class="wrapper"> <header><p class="printable"> <img src="https://api.qrserver.com/v1/create-qr-code/?data=https://www.yegor256.com/2018/02/27/parsing-objects.html&amp;format=svg" style="width:125px;height:125px;" alt="QR code"/></p><p class="printable"> <code itemprop="url">https://www.yegor256.com/2018/02/27/parsing-objects.html</code></p><h1 itemprop="name headline mainEntityOfPage">Don't Parse, Use Parsing Objects</h1><ul class="subline"> <li> <time itemprop="datePublished" datetime="2018-02-27T00:00:00+00:00"> 27 February 2018 </time> </li> <li class="desktop-only" itemprop="locationCreated">Moscow, Russia</li> <li class="printable" itemscope="" itemprop="author" itemtype="http://schema.org/Person"> <span itemprop="name">Yegor Bugayenko</span> </li> <li class="unprintable"> <i class="icon icon-comments"></i> <a href="http://www.yegor256.com/2018/02/27/parsing-objects.html#disqus_thread" itemprop="discussionUrl">comments</a> </li></ul><p>The traditional way of integrating object-oriented back-end with an external system is through <a href="/2016/07/06/data-transfer-object.html">data transfer objects</a>, which are serialized into JSON before going out and deserialized when coming back. This way is as much popular as it is wrong. The serialization part should be replaced by <a href="/2016/04/05/printers-instead-of-getters.html">printers</a>, which I explained earlier. Here is my take on deserialization, which should be done by---guess what---objects.</p><figure class='jb_picture'><img itemprop='image' alt='La science des rêves (2006) by Michel Gondry' src='/images/2018/02/la-science-des-reves.jpg' longdesc='#bad54f07'/><figcaption id='bad54f07'>La science des rêves (2006) by Michel Gondry</figcaption></figure><p>Say there is a back-end entry point, which is supposed to register a new book in the library, arriving in JSON:</p><figure class="highlight"><pre><code class="language-json" data-lang="json"><span></span><span class="p">{</span>
  <span class="nt">&quot;title&quot;</span><span class="p">:</span> <span class="s2">&quot;Object Thinking&quot;</span><span class="p">,</span>
  <span class="nt">&quot;isbn: &quot;</span><span class="mi">0735619654</span><span class="s2">&quot;,</span>
<span class="s2">  &quot;</span><span class="err">author</span><span class="p">:</span> <span class="s2">&quot;David West&quot;</span>
<span class="p">}</span></code></pre></figure><p>Also, there is an object of class <code>Library</code>, which expects an object of type <code>Book</code> to be given to its method <code>register()</code>:</p><figure class="highlight"><pre><code class="language-java" data-lang="java"><span></span><span class="kd">class</span> <span class="nc">Library</span> <span class="o">{</span>
  <span class="kd">public</span> <span class="kt">void</span> <span class="nf">register</span><span class="o">(</span><span class="n">Book</span> <span class="n">book</span><span class="o">)</span> <span class="o">{</span>
    <span class="c1">// Create a new record in the database</span>
  <span class="o">}</span>
<span class="o">}</span></code></pre></figure><p>Say also, type <code>Book</code> has a simple method <code>isbn()</code>:</p><figure class="highlight"><pre><code class="language-java" data-lang="java"><span></span><span class="kd">interface</span> <span class="nc">Book</span> <span class="o">{</span>
  <span class="n">String</span> <span class="nf">isbn</span><span class="o">();</span>
<span class="o">}</span></code></pre></figure><p>Now, here is the HTTP entry point (I&#39;m using <a href="/2015/03/22/takes-java-web-framework.html">Takes</a> and <a href="/2017/06/22/object-oriented-input-output-in-cactoos.html">Cactoos</a>), which is accepting a POST <a href="https://www.ietf.org/rfc/rfc2045.txt"><code>multipart/form-data</code></a> request and registering the book in the library:</p><figure class="highlight"><pre><code class="language-java" data-lang="java"><span></span><span class="kd">public</span> <span class="kd">class</span> <span class="nc">TkUpload</span> <span class="kd">implements</span> <span class="n">Take</span> <span class="o">{</span>
  <span class="kd">private</span> <span class="kd">final</span> <span class="n">Library</span> <span class="n">library</span><span class="o">;</span>
  <span class="nd">@Override</span>
  <span class="kd">public</span> <span class="n">Response</span> <span class="nf">act</span><span class="o">(</span><span class="n">Request</span> <span class="n">req</span><span class="o">)</span> <span class="o">{</span>
    <span class="n">String</span> <span class="n">body</span> <span class="o">=</span> <span class="k">new</span> <span class="n">RqPrint</span><span class="o">(</span>
      <span class="k">new</span> <span class="n">RqMtSmart</span><span class="o">(</span><span class="k">new</span> <span class="n">RqMtBase</span><span class="o">(</span><span class="n">req</span><span class="o">)).</span><span class="na">single</span><span class="o">(</span><span class="s">&quot;book&quot;</span><span class="o">)</span>
    <span class="o">).</span><span class="na">printBody</span><span class="o">();</span>
    <span class="n">JsonObject</span> <span class="n">json</span> <span class="o">=</span> <span class="n">Json</span><span class="o">.</span><span class="na">createReader</span><span class="o">(</span>
      <span class="k">new</span> <span class="n">InputStreamOf</span><span class="o">(</span><span class="n">body</span><span class="o">)</span>
    <span class="o">).</span><span class="na">readObject</span><span class="o">();</span>
    <span class="n">Book</span> <span class="n">book</span> <span class="o">=</span> <span class="k">new</span> <span class="n">BookDTO</span><span class="o">();</span>
    <span class="n">book</span><span class="o">.</span><span class="na">setIsbn</span><span class="o">(</span><span class="n">json</span><span class="o">.</span><span class="na">getString</span><span class="o">(</span><span class="s">&quot;isbn&quot;</span><span class="o">));</span>
    <span class="n">library</span><span class="o">.</span><span class="na">register</span><span class="o">(</span><span class="n">book</span><span class="o">);</span>
  <span class="o">}</span>
<span class="o">}</span></code></pre></figure><p>What is wrong with this? Well, a few things.</p><p>First, it&#39;s not reusable. If we were to need something similar in a different place, we would have to write this HTTP processing and JSON parsing again.</p><p>Second, error handling and <a href="/2018/05/29/object-validation.html">validation</a> are not reusable either. If we add it to the method above, we will have to copy it everywhere. Of course, the DTO may encapsulate it, but that&#39;s not what DTOs are usually for.</p><p>Third, the code above is rather procedural and has a lot of <a href="/2015/12/08/temporal-coupling-between-method-calls.html">temporal coupling</a>.</p><p>A better design would be to hide this parsing inside a new class <code>JsonBook</code>:</p><figure class="highlight"><pre><code class="language-java" data-lang="java"><span></span><span class="kd">class</span> <span class="nc">JsonBook</span> <span class="kd">implements</span> <span class="n">Book</span> <span class="o">{</span>
  <span class="kd">private</span> <span class="kd">final</span> <span class="n">String</span> <span class="n">json</span><span class="o">;</span>
  <span class="n">JsonBook</span><span class="o">(</span><span class="n">String</span> <span class="n">body</span><span class="o">)</span> <span class="o">{</span>
    <span class="k">this</span><span class="o">.</span><span class="na">json</span> <span class="o">=</span> <span class="n">body</span><span class="o">;</span>
  <span class="o">}</span>
  <span class="nd">@Override</span>
  <span class="kd">public</span> <span class="n">String</span> <span class="nf">isbn</span><span class="o">()</span> <span class="o">{</span>
    <span class="k">return</span> <span class="n">Json</span><span class="o">.</span><span class="na">createReader</span><span class="o">(</span>
      <span class="k">new</span> <span class="n">InputStreamOf</span><span class="o">(</span><span class="n">body</span><span class="o">)</span>
    <span class="o">).</span><span class="na">readObject</span><span class="o">().</span><span class="na">getString</span><span class="o">(</span><span class="s">&quot;isbn&quot;</span><span class="o">);</span>
  <span class="o">}</span>
<span class="o">}</span></code></pre></figure><p>Then, the RESTful entry point will look like this:</p><figure class="highlight"><pre><code class="language-java" data-lang="java"><span></span><span class="kd">public</span> <span class="kd">class</span> <span class="nc">TkUpload</span> <span class="kd">implements</span> <span class="n">Take</span> <span class="o">{</span>
  <span class="kd">private</span> <span class="kd">final</span> <span class="n">Library</span> <span class="n">library</span><span class="o">;</span>
  <span class="nd">@Override</span>
  <span class="kd">public</span> <span class="n">Response</span> <span class="nf">act</span><span class="o">(</span><span class="n">Request</span> <span class="n">req</span><span class="o">)</span> <span class="o">{</span>
    <span class="n">library</span><span class="o">.</span><span class="na">register</span><span class="o">(</span>
      <span class="k">new</span> <span class="n">JsonBook</span><span class="o">(</span>
        <span class="k">new</span> <span class="n">RqPrint</span><span class="o">(</span>
          <span class="k">new</span> <span class="n">RqMtSmart</span><span class="o">(</span>
            <span class="k">new</span> <span class="n">RqMtBase</span><span class="o">(</span><span class="n">req</span><span class="o">)</span>
          <span class="o">).</span><span class="na">single</span><span class="o">(</span><span class="s">&quot;book&quot;</span><span class="o">)</span>
        <span class="o">).</span><span class="na">printBody</span><span class="o">()</span>
      <span class="o">)</span>
    <span class="o">);</span>
  <span class="o">}</span>
<span class="o">}</span></code></pre></figure><p>Isn&#39;t that more elegant?</p><p>Here are some examples from my projects: <a href="https://github.com/zerocracy/farm/blob/0.21/src/main/java/com/zerocracy/tk/RqUser.java"><code>RqUser</code></a> from <a href="https://github.com/zerocracy/farm/">zerocracy/farm</a> and <a href="https://github.com/yegor256/jare/blob/0.11.2/src/main/java/io/jare/tk/RqUser.java"><code>RqUser</code></a> from <a href="https://github.com/yegor256/jare/blob/0.11.2/src/main/java/io/jare/tk/RqUser.java">yegor256/jare</a>.</p><p>As you can see from the examples above, sometimes we can&#39;t use <code>implements</code> because some primitives in Java are not interfaces but <code>final</code> classes: <code>String</code> is a &quot;perfect&quot; example. That&#39;s why I have to do this:</p><figure class="highlight"><pre><code class="language-java" data-lang="java"><span></span><span class="kd">class</span> <span class="nc">RqUser</span> <span class="kd">implements</span> <span class="n">Scalar</span><span class="o">&lt;</span><span class="n">String</span><span class="o">&gt;</span> <span class="o">{</span>
  <span class="nd">@Override</span>
  <span class="kd">public</span> <span class="n">String</span> <span class="nf">value</span><span class="o">()</span> <span class="o">{</span>
    <span class="c1">// Parsing happens here and returns String</span>
  <span class="o">}</span>
<span class="o">}</span></code></pre></figure><p>But aside from that, these examples perfectly demonstrate the principle of &quot;parsing objects&quot; suggested above.</p></p>--> <nav class="buttons notranslate desktop-only"> <a href="http://www.facebook.com/sharer/sharer.php?u=https://www.yegor256.com/2018/02/27/parsing-objects.html" title="Share on Facebook" class="button" rel="nofollow"> <span class="count count-facebook">0</span> <i class="icon icon-facebook notranslate" aria-hidden="true"></i> </a> <a href="https://twitter.com/share?url=https://www.yegor256.com/2018/02/27/parsing-objects.html&amp;text=Don%27t+Parse%2C+Use+Parsing+Objects" title="Share on Twitter" class="button" rel="nofollow"> <span class="count count-twitter">0</span> <i class="icon icon-twitter notranslate" aria-hidden="true"></i> </a> <a href="https://plus.google.com/share?url=https://www.yegor256.com/2018/02/27/parsing-objects.html" title="Share on Google+" class="button" rel="nofollow"> <span class="count count-googleplus">0</span> <i class="icon icon-googleplus notranslate" aria-hidden="true"></i> </a> <a href="https://www.linkedin.com/cws/share?url=https://www.yegor256.com/2018/02/27/parsing-objects.html" title="Share on LinkedIn" class="button" rel="nofollow"> <span class="count count-linkedin">0</span> <i class="icon icon-linkedin notranslate" aria-hidden="true"></i> </a> <a href="http://reddit.com/submit?url=https://www.yegor256.com/2018/02/27/parsing-objects.html%3F2018-08&amp;title=Don%27t+Parse%2C+Use+Parsing+Objects" title="Share on Reddit" class="button" rel="nofollow"> <span class="count count-reddit">0</span> <i class="icon icon-reddit notranslate" aria-hidden="true"></i> </a> <a href="http://news.ycombinator.com/submitlink?u=https://www.yegor256.com/2018/02/27/parsing-objects.html%3F2018-08&amp;t=Don%27t+Parse%2C+Use+Parsing+Objects" title="Share on Hacker News" class="button" rel="nofollow"> <span class="count count-hackernews">0</span> <i class="icon icon-hackernews notranslate" aria-hidden="true"></i> </a> </nav> </header> <article class="main" itemprop="articleBody"><div ><p>The traditional way of integrating object-oriented back-end with an external system is through <a href="/2016/07/06/data-transfer-object.html">data transfer objects</a>, which are serialized into JSON before going out and deserialized when coming back. This way is as much popular as it is wrong. The serialization part should be replaced by <a href="/2016/04/05/printers-instead-of-getters.html">printers</a>, which I explained earlier. Here is my take on deserialization, which should be done by---guess what---objects.</p><figure class='jb_picture'><img itemprop='image' alt='La science des rêves (2006) by Michel Gondry' src='/images/2018/02/la-science-des-reves.jpg' longdesc='#bad54f07'/><figcaption id='bad54f07'>La science des rêves (2006) by Michel Gondry</figcaption></figure><p>Say there is a back-end entry point, which is supposed to register a new book in the library, arriving in JSON:</p><figure class="highlight"><pre><code class="language-json" data-lang="json"><span></span><span class="p">{</span>
  <span class="nt">&quot;title&quot;</span><span class="p">:</span> <span class="s2">&quot;Object Thinking&quot;</span><span class="p">,</span>
  <span class="nt">&quot;isbn: &quot;</span><span class="mi">0735619654</span><span class="s2">&quot;,</span>
<span class="s2">  &quot;</span><span class="err">author</span><span class="p">:</span> <span class="s2">&quot;David West&quot;</span>
<span class="p">}</span></code></pre></figure><p>Also, there is an object of class <code>Library</code>, which expects an object of type <code>Book</code> to be given to its method <code>register()</code>:</p><figure class="highlight"><pre><code class="language-java" data-lang="java"><span></span><span class="kd">class</span> <span class="nc">Library</span> <span class="o">{</span>
  <span class="kd">public</span> <span class="kt">void</span> <span class="nf">register</span><span class="o">(</span><span class="n">Book</span> <span class="n">book</span><span class="o">)</span> <span class="o">{</span>
    <span class="c1">// Create a new record in the database</span>
  <span class="o">}</span>
<span class="o">}</span></code></pre></figure><p>Say also, type <code>Book</code> has a simple method <code>isbn()</code>:</p><figure class="highlight"><pre><code class="language-java" data-lang="java"><span></span><span class="kd">interface</span> <span class="nc">Book</span> <span class="o">{</span>
  <span class="n">String</span> <span class="nf">isbn</span><span class="o">();</span>
<span class="o">}</span></code></pre></figure><p>Now, here is the HTTP entry point (I&#39;m using <a href="/2015/03/22/takes-java-web-framework.html">Takes</a> and <a href="/2017/06/22/object-oriented-input-output-in-cactoos.html">Cactoos</a>), which is accepting a POST <a href="https://www.ietf.org/rfc/rfc2045.txt"><code>multipart/form-data</code></a> request and registering the book in the library:</p><figure class="highlight"><pre><code class="language-java" data-lang="java"><span></span><span class="kd">public</span> <span class="kd">class</span> <span class="nc">TkUpload</span> <span class="kd">implements</span> <span class="n">Take</span> <span class="o">{</span>
  <span class="kd">private</span> <span class="kd">final</span> <span class="n">Library</span> <span class="n">library</span><span class="o">;</span>
  <span class="nd">@Override</span>
  <span class="kd">public</span> <span class="n">Response</span> <span class="nf">act</span><span class="o">(</span><span class="n">Request</span> <span class="n">req</span><span class="o">)</span> <span class="o">{</span>
    <span class="n">String</span> <span class="n">body</span> <span class="o">=</span> <span class="k">new</span> <span class="n">RqPrint</span><span class="o">(</span>
      <span class="k">new</span> <span class="n">RqMtSmart</span><span class="o">(</span><span class="k">new</span> <span class="n">RqMtBase</span><span class="o">(</span><span class="n">req</span><span class="o">)).</span><span class="na">single</span><span class="o">(</span><span class="s">&quot;book&quot;</span><span class="o">)</span>
    <span class="o">).</span><span class="na">printBody</span><span class="o">();</span>
    <span class="n">JsonObject</span> <span class="n">json</span> <span class="o">=</span> <span class="n">Json</span><span class="o">.</span><span class="na">createReader</span><span class="o">(</span>
      <span class="k">new</span> <span class="n">InputStreamOf</span><span class="o">(</span><span class="n">body</span><span class="o">)</span>
    <span class="o">).</span><span class="na">readObject</span><span class="o">();</span>
    <span class="n">Book</span> <span class="n">book</span> <span class="o">=</span> <span class="k">new</span> <span class="n">BookDTO</span><span class="o">();</span>
    <span class="n">book</span><span class="o">.</span><span class="na">setIsbn</span><span class="o">(</span><span class="n">json</span><span class="o">.</span><span class="na">getString</span><span class="o">(</span><span class="s">&quot;isbn&quot;</span><span class="o">));</span>
    <span class="n">library</span><span class="o">.</span><span class="na">register</span><span class="o">(</span><span class="n">book</span><span class="o">);</span>
  <span class="o">}</span>
<span class="o">}</span></code></pre></figure><p>What is wrong with this? Well, a few things.</p><p>First, it&#39;s not reusable. If we were to need something similar in a different place, we would have to write this HTTP processing and JSON parsing again.</p><p>Second, error handling and <a href="/2018/05/29/object-validation.html">validation</a> are not reusable either. If we add it to the method above, we will have to copy it everywhere. Of course, the DTO may encapsulate it, but that&#39;s not what DTOs are usually for.</p><p>Third, the code above is rather procedural and has a lot of <a href="/2015/12/08/temporal-coupling-between-method-calls.html">temporal coupling</a>.</p><p>A better design would be to hide this parsing inside a new class <code>JsonBook</code>:</p><figure class="highlight"><pre><code class="language-java" data-lang="java"><span></span><span class="kd">class</span> <span class="nc">JsonBook</span> <span class="kd">implements</span> <span class="n">Book</span> <span class="o">{</span>
  <span class="kd">private</span> <span class="kd">final</span> <span class="n">String</span> <span class="n">json</span><span class="o">;</span>
  <span class="n">JsonBook</span><span class="o">(</span><span class="n">String</span> <span class="n">body</span><span class="o">)</span> <span class="o">{</span>
    <span class="k">this</span><span class="o">.</span><span class="na">json</span> <span class="o">=</span> <span class="n">body</span><span class="o">;</span>
  <span class="o">}</span>
  <span class="nd">@Override</span>
  <span class="kd">public</span> <span class="n">String</span> <span class="nf">isbn</span><span class="o">()</span> <span class="o">{</span>
    <span class="k">return</span> <span class="n">Json</span><span class="o">.</span><span class="na">createReader</span><span class="o">(</span>
      <span class="k">new</span> <span class="n">InputStreamOf</span><span class="o">(</span><span class="n">body</span><span class="o">)</span>
    <span class="o">).</span><span class="na">readObject</span><span class="o">().</span><span class="na">getString</span><span class="o">(</span><span class="s">&quot;isbn&quot;</span><span class="o">);</span>
  <span class="o">}</span>
<span class="o">}</span></code></pre></figure><p>Then, the RESTful entry point will look like this:</p><figure class="highlight"><pre><code class="language-java" data-lang="java"><span></span><span class="kd">public</span> <span class="kd">class</span> <span class="nc">TkUpload</span> <span class="kd">implements</span> <span class="n">Take</span> <span class="o">{</span>
  <span class="kd">private</span> <span class="kd">final</span> <span class="n">Library</span> <span class="n">library</span><span class="o">;</span>
  <span class="nd">@Override</span>
  <span class="kd">public</span> <span class="n">Response</span> <span class="nf">act</span><span class="o">(</span><span class="n">Request</span> <span class="n">req</span><span class="o">)</span> <span class="o">{</span>
    <span class="n">library</span><span class="o">.</span><span class="na">register</span><span class="o">(</span>
      <span class="k">new</span> <span class="n">JsonBook</span><span class="o">(</span>
        <span class="k">new</span> <span class="n">RqPrint</span><span class="o">(</span>
          <span class="k">new</span> <span class="n">RqMtSmart</span><span class="o">(</span>
            <span class="k">new</span> <span class="n">RqMtBase</span><span class="o">(</span><span class="n">req</span><span class="o">)</span>
          <span class="o">).</span><span class="na">single</span><span class="o">(</span><span class="s">&quot;book&quot;</span><span class="o">)</span>
        <span class="o">).</span><span class="na">printBody</span><span class="o">()</span>
      <span class="o">)</span>
    <span class="o">);</span>
  <span class="o">}</span>
<span class="o">}</span></code></pre></figure><p>Isn&#39;t that more elegant?</p><p>Here are some examples from my projects: <a href="https://github.com/zerocracy/farm/blob/0.21/src/main/java/com/zerocracy/tk/RqUser.java"><code>RqUser</code></a> from <a href="https://github.com/zerocracy/farm/">zerocracy/farm</a> and <a href="https://github.com/yegor256/jare/blob/0.11.2/src/main/java/io/jare/tk/RqUser.java"><code>RqUser</code></a> from <a href="https://github.com/yegor256/jare/blob/0.11.2/src/main/java/io/jare/tk/RqUser.java">yegor256/jare</a>.</p><p>As you can see from the examples above, sometimes we can&#39;t use <code>implements</code> because some primitives in Java are not interfaces but <code>final</code> classes: <code>String</code> is a &quot;perfect&quot; example. That&#39;s why I have to do this:</p><figure class="highlight"><pre><code class="language-java" data-lang="java"><span></span><span class="kd">class</span> <span class="nc">RqUser</span> <span class="kd">implements</span> <span class="n">Scalar</span><span class="o">&lt;</span><span class="n">String</span><span class="o">&gt;</span> <span class="o">{</span>
  <span class="nd">@Override</span>
  <span class="kd">public</span> <span class="n">String</span> <span class="nf">value</span><span class="o">()</span> <span class="o">{</span>
    <span class="c1">// Parsing happens here and returns String</span>
  <span class="o">}</span>
<span class="o">}</span></code></pre></figure><p>But aside from that, these examples perfectly demonstrate the principle of &quot;parsing objects&quot; suggested above.</p></div></article></div><div class="wrapper"> <related-posts /></div><div class="disqus" role="complementary"><p class="disqus_hint"> Please, use <a href="https://help.disqus.com/commenting/what-html-tags-are-allowed-within-comments">syntax highlighting</a> in your comments, to make them more readable.</p><div id="disqus_thread" class="disqus-thread"> <a>&nbsp;</a></div><script> var disqus_config = function () { this.page.url = document.location.href.split('?')[0].split('#')[0].replace('https://', 'http://'); this.page.identifier = this.page.url; }; (function() { var d = document, s = d.createElement('script'); s.src = '//yegor256.disqus.com/embed.js'; s.setAttribute('data-timestamp', +new Date()); (d.head || d.body).appendChild(s); })(); </script> <noscript><div><p class="red"> JavaScript is disabled in your browser, that's why you can't see comments under this post.</p></div></noscript></div><div class="wrapper"> <footer class="footer"><p> &copy; <span itemscope="" itemprop="copyrightHolder" itemtype="http://schema.org/Person"> <span itemprop="name">Yegor Bugayenko</span> </span> 2014&ndash;<span itemprop="copyrightYear">2018</span></p></footer></div></section><div class="wrapper unprintable" style="text-align:center;margin-top:2em;"> <a href="http://www.sixnines.io/h/3ba1652f"> <img src="//www.sixnines.io/b/3ba1652f?style=flat" alt="sixnines availability badge"/> </a></div><script src="//code.jquery.com/jquery-1.9.0.min.js"></script> <script src="/js/all.js?4e047f6f42b"></script> <script>var disqus_shortname = 'yegor256';</script> <script id="dsq-count-scr" src="//yegor256.disqus.com/count.js" async="async"></script> <script> (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){ (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o), m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m) })(window,document,'script','//www.google-analytics.com/analytics.js','ga'); ga('create', 'UA-1963507-32', 'auto'); ga('send', 'pageview'); </script> <script> Cd=document;Cr="&"+Math.random();Cp="&s=1"; Cd.cookie="b=b";if(Cd.cookie)Cp+="&c=1"; Cp+="&t="+(new Date()).getTimezoneOffset(); if(self!=top)Cp+="&f=1"; </script> <script> if(navigator.javaEnabled())Cp+="&j=1"; </script> <script> if(typeof(screen)!='undefined')Cp+="&w="+screen.width+"&h="+ screen.height+"&d="+(screen.colorDepth?screen.colorDepth:screen.pixelDepth); </script> <script> Cd.write("<img src='//c.hit.ua/hit?i=95870&g=0&x=2"+Cp+Cr+ "&r="+escape(Cd.referrer)+"&u="+escape(window.location.href)+ "' border='0' wi"+"dth='1' he"+"ight='1'/>"); </script> <script type="application/ld+json"> { "@context": "http://schema.org", "@type": "Person", "name": "Yegor Bugayenko", "url": "http://www.yegor256.com", "sameAs": [ "https://www.facebook.com/yegor256", "https://instagram.com/yegor256", "https://www.linkedin.com/in/yegor256", "https://twitter.com/yegor256", "https://github.com/yegor256", "https://www.pinterest.com/yegor256/" ] } </script> </body> </html> <!DOCTYPE html> <html xmlns="http://www.w3.org/1999/xhtml" lang="en-US" xml:lang="en-US" itemscope="" itemtype="http://schema.org/WebSite"> <head> <meta charset="utf-8"/> <meta name="description" content="Alan Kay said in 1998 that object-oriented programming should have been called message-oriented programming instead; I disagree. " /> <meta name="keywords" content="alan kay about oop, alan kay oop, alan kay oop definition, message oriented programming, messages oop" /> <meta name="viewport" content="width=device-width,minimum-scale=1,initial-scale=1"/> <meta name="google-site-verification" content="JEj_gQr2CPe2QKGw8XdMz0R7VboQIUbX3FlM-lwTq-8" /> <meta name="author" content="Yegor Bugayenko"> <meta name="article:published_time" content="2017-12-12 00:00:00 +0000"> <meta name="og:site_name" content="Yegor Bugayenko"/> <meta name="og:type" content="article" /> <meta name="og:locale" content="en_US" /> <meta name="twitter:account_id" content="4503599630178231" /> <meta name="twitter:creator" content="@yegor256"/> <meta name="twitter:site" content="@yegor256"/> <meta name="twitter:title" property="og:title" content="Alan Kay Was Wrong About Him Being Wrong"/> <meta name="twitter:description" property="og:description" content="Alan Kay said in 1998 that object-oriented programming should have been called message-oriented programming instead; I disagree. "/> <meta name="twitter:url" property="og:url" content="https://www.yegor256.com/2017/12/12/alan-kay-was-wrong.html"/> <meta name="telegram:channel" content="AAAAAEJFMRzsRTRxM3ec6A"/> <link rel="search" type="application/opensearchdescription+xml" href="/opensearch.xml" title="yegor256" /> <link rel="shortcut icon" href="/favicon.ico?4e047f6f42b"/> <link rel="apple-touch-icon" href="/favicon.ico?4e047f6f42b"/> <link rel="alternate" type="application/rss+xml" title="RSS for yegor256.com" href="https://www.yegor256.com/rss.xml"/> <link rel="stylesheet" href="/css/layout.css?4e047f6f42b"/> <link rel="stylesheet" href="/css/icons.css?4e047f6f42b"/> <link rel="canonical" href="https://www.yegor256.com/2017/12/12/alan-kay-was-wrong.html" /> <link rel="amphtml" href="https://www.yegor256.com/2017/12/12/alan-kay-was-wrong.amp.html" /> <title>Alan Kay Was Wrong About Him Being Wrong </title> <meta name='og:image' content='https://www.yegor256.com/images/2017/12/rain-man.jpg'/><meta name='twitter:image' content='https://www.yegor256.com/images/2017/12/rain-man.jpg'/><meta name='og:image:width' content='1440'/> <meta name='twitter:image:width' content='1440'/><meta name='og:image:height' content='750'/> <meta name='twitter:image:height' content='750'/><meta name='twitter:card' content='summary_large_image'/><meta name='twitter:image:alt' content='Rain Man (1988) by Barry Levinson'/> </head> <body><div class="wrapper"> <aside class="header-toggle unprintable" id="header-toggle" title="Show the menu" onclick="$('#header').show();$('#header-toggle').hide();">&#9776;</aside> <header class="header" id="header"><div class="face"> <a href="/about-me.html#form" class="sub" title="Click to subscribe to my monthly newsletter"><span>Subscribe</span></a> <a href="/about-me.html" style="position:relative;"> <img src="/images/face-256x256.jpg" class="photo" alt="Yegor Bugayenko"/> </a></div><nav><ul class="menu social notranslate"> <li><a href="https://twitter.com/intent/follow?screen_name=yegor256" rel="nofollow" title="Follow me on Twitter"><i class="icon icon-twitter notranslate" aria-hidden="true"></i></a></li> <li><a href="/rss.xml" rel="nofollow" title="Subscribe to my RSS feed"><i class="icon icon-rss notranslate" aria-hidden="true"></i></a></li> <li><a itemprop="sameAs" href="https://github.com/yegor256" rel="nofollow" title="My GitHub profile"><i class="icon icon-github notranslate" aria-hidden="true"></i></a></li> <li><a itemprop="sameAs" href="http://stackoverflow.com/users/187141/yegor256" rel="nofollow" title="My StackOverflow profile"><i class="icon icon-stackoverflow notranslate" aria-hidden="true"></i></a></li> <li><a itemprop="sameAs" href="https://www.facebook.com/yegor256" rel="nofollow" title="Follow me on Facebook"><i class="icon icon-facebook notranslate" aria-hidden="true"></i></a></li> <li><a itemprop="sameAs" href="https://instagram.com/yegor256" rel="nofollow" title="Follow me on Instagram"><i class="icon icon-instagram notranslate" aria-hidden="true"></i></a></li> <li><a itemprop="sameAs" href="https://www.linkedin.com/in/yegor256" rel="nofollow" title="My LinkedIn profile"><i class="icon icon-linkedin notranslate" aria-hidden="true"></i></a></li> <li><a itemprop="sameAs" href="https://www.youtube.com/c/yegor256?sub_confirmation=1" rel="nofollow" title="My Youtube video channel"><i class="icon icon-youtube notranslate" aria-hidden="true"></i></a></li> <li><a itemprop="sameAs" href="https://www.pinterest.com/yegor256/" rel="nofollow" title="My Pinterest boards"><i class="icon icon-pinterest notranslate" aria-hidden="true"></i></a></li> <li><a itemprop="sameAs" href="https://angel.co/yegor256" rel="nofollow" title="My AngelList profile"><i class="icon icon-angellist notranslate" aria-hidden="true"></i></a></li> <li><a href="https://soundcloud.com/yegor256" rel="nofollow" title="My podcast"><i class="icon icon-podcast notranslate" aria-hidden="true"></i></a></li> <li><a href="https://itunes.apple.com/us/podcast/yegor256-podcast/id1150826721" rel="nofollow" title="My iTunes podcast"><i class="icon icon-itunes notranslate" aria-hidden="true"></i></a></li> <li><a href="https://t.me/joinchat/AAAAAEJFMRzsRTRxM3ec6A" rel="nofollow" title="My Telegram public channel"><i class="icon icon-telegram notranslate" aria-hidden="true"></i></a></li> <li><a href="mailto:blog@yegor256.com" rel="nofollow" title="Email me any time"><i class="icon icon-mail notranslate" aria-hidden="true"></i></a></li></ul><ul class="menu"> <li><a href="/" title="Home page">Home</a></li> <li ><a href="/best.html" title="Best articles to read">12&#160;Best</a></li> <li ><a href="/contents.html" title="The contents of the entire blog">All&#160;288</a></li> <li ><a href="/webinars.html" title="My webinars">Webinars</a></li> <li ><a href="/talks.html" title="Future and past conference talks">Talks</a></li> <li ><a href="/books.html" title="The books I wrote">Books</a></li> <li ><a href="/papers.html" title="My academic papers and patents">Papers</a></li> <li ><a href="/pets.html" title="My loved pet projects">Pets</a></li> <li ><a href="/award.html" title="Software quality award">Award</a></li> <li ><a href="/testimonials.html" title="What some people say about me">Testimonials</a></li> <li ><a href="/shift-m.html" title="Audio podcast about project management">Shift-M</a></li> <li ><a href="/paintings.html" title="My paintings for sale">Paintings</a></li> <li><a href="http://ru.yegor256.com/" title="Немного на русском языке">По-русски</a></li></ul></nav><div class="search"> <form method="get" action="https://www.google.com/search" itemprop="potentialAction" itemscope="" itemtype="http://schema.org/SearchAction"> <meta itemprop="target" content="https://www.google.com/search?q={q}"/> <input name="sitesearch" value="yegor256.com" type="hidden"/> <input itemprop="query-input" type="text" id="search-query" class="field field-text" required="required" onfocus="$('.google').css('visibility', 'visible');" name="q" placeholder="Search..." autocomplete="off"/> <input type="image" src="/images/google-search-icon.svg" class="google" title="Search via Google" alt="Search via Google"/> </form></div><div class="hot"><ul> <li> <a href="/code-ahead.html">Code Ahead</a> was published on Amazon just a few days ago! It is my new book, a novel about programmers. It explains in details the majority of ideas that stand behind <a href="https://www.zerocracy.com">Zerocracy</a> and <a href="https://www.xdsd.org">XDSD</a>. </li> <li> At <a href="/webinars.html">Webinar #37</a> we will discuss naming problem in OOP, for objects, methods and attributes; join us on <b>September 12</b>, at 11am PST. </li></ul></div></header></div><section itemscope="" itemtype="http://schema.org/BlogPosting"><div class="wrapper"> <header><p class="printable"> <img src="https://api.qrserver.com/v1/create-qr-code/?data=https://www.yegor256.com/2017/12/12/alan-kay-was-wrong.html&amp;format=svg" style="width:125px;height:125px;" alt="QR code"/></p><p class="printable"> <code itemprop="url">https://www.yegor256.com/2017/12/12/alan-kay-was-wrong.html</code></p><h1 itemprop="name headline mainEntityOfPage">Alan Kay Was Wrong About Him Being Wrong</h1><ul class="subline"> <li> <time itemprop="datePublished" datetime="2017-12-12T00:00:00+00:00"> 12 December 2017 </time> </li> <li class="desktop-only" itemprop="locationCreated">Moscow, Russia</li> <li class="printable" itemscope="" itemprop="author" itemtype="http://schema.org/Person"> <span itemprop="name">Yegor Bugayenko</span> </li> <li class="unprintable"> <i class="icon icon-comments"></i> <a href="http://www.yegor256.com/2017/12/12/alan-kay-was-wrong.html#disqus_thread" itemprop="discussionUrl">comments</a> </li></ul><figure class='jb_picture'><img itemprop='image' alt='Rain Man (1988) by Barry Levinson' src='/images/2017/12/rain-man.jpg' longdesc='#7b3f07bb'/><figcaption id='7b3f07bb'>Rain Man (1988) by Barry Levinson</figcaption></figure><p>I believe that there are two orthogonal means of interaction between objects: messaging and composition. Let&#39;s say, we have a point and a canvas:</p><figure class="highlight"><pre><code class="language-java" data-lang="java"><span></span><span class="n">Point</span> <span class="n">p</span> <span class="o">=</span> <span class="k">new</span> <span class="n">Point</span><span class="o">(</span><span class="n">x</span><span class="o">,</span> <span class="n">y</span><span class="o">);</span>
<span class="n">Canvas</span> <span class="n">canvas</span> <span class="o">=</span> <span class="k">new</span> <span class="n">Canvas</span><span class="o">();</span></code></pre></figure><p>This is how messaging would look:</p><figure class="highlight"><pre><code class="language-java" data-lang="java"><span></span><span class="n">p</span><span class="o">.</span><span class="na">printTo</span><span class="o">(</span><span class="n">canvas</span><span class="o">);</span></code></pre></figure><p>The problem with messaging is that it keeps objects on the same level of abstraction. They communicate as equal and independent &quot;modules,&quot; sending <a href="/2016/11/21/naked-data.html">data messages</a> to each other. Even though they look object-oriented, the entire communication pattern is very procedural. We try to encapsulate as much as we can inside a single object, however inevitably still having to expose a lot of its data in order to be able to &quot;connect&quot; it with other objects.</p><p>We turn objects into &quot;little computers,&quot; as <a href="http://amzn.to/2npiZZQ">some books</a> refer to them. They expect data to come in, they process the data, and return back some new data. The maintainability problem is not really solved with this approach---we still have to deal with a lot of data, remembering its semantic outside of the objects. In other words, there is no true encapsulation.</p><p>On the other hand, this is how composition would look instead:</p><figure class="highlight"><pre><code class="language-java" data-lang="java"><span></span><span class="n">Point</span> <span class="n">p2</span> <span class="o">=</span> <span class="k">new</span> <span class="n">PrintedOn</span><span class="o">(</span><span class="n">p</span><span class="o">,</span> <span class="n">canvas</span><span class="o">);</span></code></pre></figure><p>Every time we need objects to communicate we create a bigger object that encapsulates more primitive ones, letting them interact inside. Of course, the data will also go from object to object, but that will happen inside a bigger object. We can even make the encapsulator and the encapsulated &quot;friends,&quot; as <a href="/2016/12/20/can-objects-be-friends.html">I suggested before</a>, to make that interaction more transparent and avoid data exposure through <a href="/2014/09/16/getters-and-setters-are-evil.html">getters</a> or even <a href="/2016/04/05/printers-instead-of-getters.html">printers</a>.</p><p>Let me <a href="http://lists.squeakfoundation.org/pipermail/squeak-dev/1998-October/017019.html">quote</a> Alan Kay again:</p><blockquote><p>The key in making great and growable systems is much more to design how its modules communicate rather than what their internal properties and behaviors should be.</p></blockquote><p>It seems to me that he means <em>modules</em>, which are not objects. These are different things. Modules are elements of the architecture, while objects are elements of the design. These are two different levels. At the level of architecture we obviously need messages and Kay&#39;s statement is perfectly correct. However, at the level of design we need composable structures, to increase maintainability and messaging is not what can help us achieve this goal.</p><p>Thus, I believe Alan Kay was right when he invented objects, called them objects, and gave their programming style the &quot;object-oriented&quot; title.</p></p>--> <nav class="buttons notranslate desktop-only"> <a href="http://www.facebook.com/sharer/sharer.php?u=https://www.yegor256.com/2017/12/12/alan-kay-was-wrong.html" title="Share on Facebook" class="button" rel="nofollow"> <span class="count count-facebook">0</span> <i class="icon icon-facebook notranslate" aria-hidden="true"></i> </a> <a href="https://twitter.com/share?url=https://www.yegor256.com/2017/12/12/alan-kay-was-wrong.html&amp;text=Alan+Kay+Was+Wrong+About+Him+Being+Wrong" title="Share on Twitter" class="button" rel="nofollow"> <span class="count count-twitter">0</span> <i class="icon icon-twitter notranslate" aria-hidden="true"></i> </a> <a href="https://plus.google.com/share?url=https://www.yegor256.com/2017/12/12/alan-kay-was-wrong.html" title="Share on Google+" class="button" rel="nofollow"> <span class="count count-googleplus">0</span> <i class="icon icon-googleplus notranslate" aria-hidden="true"></i> </a> <a href="https://www.linkedin.com/cws/share?url=https://www.yegor256.com/2017/12/12/alan-kay-was-wrong.html" title="Share on LinkedIn" class="button" rel="nofollow"> <span class="count count-linkedin">0</span> <i class="icon icon-linkedin notranslate" aria-hidden="true"></i> </a> <a href="http://reddit.com/submit?url=https://www.yegor256.com/2017/12/12/alan-kay-was-wrong.html%3F2017-50&amp;title=Alan+Kay+Was+Wrong+About+Him+Being+Wrong" title="Share on Reddit" class="button" rel="nofollow"> <span class="count count-reddit">0</span> <i class="icon icon-reddit notranslate" aria-hidden="true"></i> </a> <a href="http://news.ycombinator.com/submitlink?u=https://www.yegor256.com/2017/12/12/alan-kay-was-wrong.html%3F2017-50&amp;t=Alan+Kay+Was+Wrong+About+Him+Being+Wrong" title="Share on Hacker News" class="button" rel="nofollow"> <span class="count count-hackernews">0</span> <i class="icon icon-hackernews notranslate" aria-hidden="true"></i> </a> </nav> </header> <article class="main" itemprop="articleBody"><div ><p>From time to time someone asks me what I think about what <a href="https://en.wikipedia.org/wiki/Alan_Kay">Alan Kay</a>, the father of OOP, the designer of <a href="https://en.wikipedia.org/wiki/Smalltalk">Smalltalk</a>, the first object-oriented language, <a href="http://lists.squeakfoundation.org/pipermail/squeak-dev/1998-October/017019.html">said</a> in 1998 about OOP. He literally said that the very term &quot;object&quot; was misleading and a more appropriate one would be &quot;messaging.&quot; Here is what I think.</p><figure class='jb_picture'><img itemprop='image' alt='Rain Man (1988) by Barry Levinson' src='/images/2017/12/rain-man.jpg' longdesc='#7b3f07bb'/><figcaption id='7b3f07bb'>Rain Man (1988) by Barry Levinson</figcaption></figure><p>I believe that there are two orthogonal means of interaction between objects: messaging and composition. Let&#39;s say, we have a point and a canvas:</p><figure class="highlight"><pre><code class="language-java" data-lang="java"><span></span><span class="n">Point</span> <span class="n">p</span> <span class="o">=</span> <span class="k">new</span> <span class="n">Point</span><span class="o">(</span><span class="n">x</span><span class="o">,</span> <span class="n">y</span><span class="o">);</span>
<span class="n">Canvas</span> <span class="n">canvas</span> <span class="o">=</span> <span class="k">new</span> <span class="n">Canvas</span><span class="o">();</span></code></pre></figure><p>This is how messaging would look:</p><figure class="highlight"><pre><code class="language-java" data-lang="java"><span></span><span class="n">p</span><span class="o">.</span><span class="na">printTo</span><span class="o">(</span><span class="n">canvas</span><span class="o">);</span></code></pre></figure><p>The problem with messaging is that it keeps objects on the same level of abstraction. They communicate as equal and independent &quot;modules,&quot; sending <a href="/2016/11/21/naked-data.html">data messages</a> to each other. Even though they look object-oriented, the entire communication pattern is very procedural. We try to encapsulate as much as we can inside a single object, however inevitably still having to expose a lot of its data in order to be able to &quot;connect&quot; it with other objects.</p><p>We turn objects into &quot;little computers,&quot; as <a href="http://amzn.to/2npiZZQ">some books</a> refer to them. They expect data to come in, they process the data, and return back some new data. The maintainability problem is not really solved with this approach---we still have to deal with a lot of data, remembering its semantic outside of the objects. In other words, there is no true encapsulation.</p><p>On the other hand, this is how composition would look instead:</p><figure class="highlight"><pre><code class="language-java" data-lang="java"><span></span><span class="n">Point</span> <span class="n">p2</span> <span class="o">=</span> <span class="k">new</span> <span class="n">PrintedOn</span><span class="o">(</span><span class="n">p</span><span class="o">,</span> <span class="n">canvas</span><span class="o">);</span></code></pre></figure><p>Every time we need objects to communicate we create a bigger object that encapsulates more primitive ones, letting them interact inside. Of course, the data will also go from object to object, but that will happen inside a bigger object. We can even make the encapsulator and the encapsulated &quot;friends,&quot; as <a href="/2016/12/20/can-objects-be-friends.html">I suggested before</a>, to make that interaction more transparent and avoid data exposure through <a href="/2014/09/16/getters-and-setters-are-evil.html">getters</a> or even <a href="/2016/04/05/printers-instead-of-getters.html">printers</a>.</p><p>Let me <a href="http://lists.squeakfoundation.org/pipermail/squeak-dev/1998-October/017019.html">quote</a> Alan Kay again:</p><blockquote><p>The key in making great and growable systems is much more to design how its modules communicate rather than what their internal properties and behaviors should be.</p></blockquote><p>It seems to me that he means <em>modules</em>, which are not objects. These are different things. Modules are elements of the architecture, while objects are elements of the design. These are two different levels. At the level of architecture we obviously need messages and Kay&#39;s statement is perfectly correct. However, at the level of design we need composable structures, to increase maintainability and messaging is not what can help us achieve this goal.</p><p>Thus, I believe Alan Kay was right when he invented objects, called them objects, and gave their programming style the &quot;object-oriented&quot; title.</p></div></article></div><div class="wrapper"> <related-posts /></div><div class="disqus" role="complementary"><p class="disqus_hint"> Please, use <a href="https://help.disqus.com/commenting/what-html-tags-are-allowed-within-comments">syntax highlighting</a> in your comments, to make them more readable.</p><div id="disqus_thread" class="disqus-thread"> <a>&nbsp;</a></div><script> var disqus_config = function () { this.page.url = document.location.href.split('?')[0].split('#')[0].replace('https://', 'http://'); this.page.identifier = this.page.url; }; (function() { var d = document, s = d.createElement('script'); s.src = '//yegor256.disqus.com/embed.js'; s.setAttribute('data-timestamp', +new Date()); (d.head || d.body).appendChild(s); })(); </script> <noscript><div><p class="red"> JavaScript is disabled in your browser, that's why you can't see comments under this post.</p></div></noscript></div><div class="wrapper"> <footer class="footer"><p> &copy; <span itemscope="" itemprop="copyrightHolder" itemtype="http://schema.org/Person"> <span itemprop="name">Yegor Bugayenko</span> </span> 2014&ndash;<span itemprop="copyrightYear">2018</span></p></footer></div></section><div class="wrapper unprintable" style="text-align:center;margin-top:2em;"> <a href="http://www.sixnines.io/h/3ba1652f"> <img src="//www.sixnines.io/b/3ba1652f?style=flat" alt="sixnines availability badge"/> </a></div><script src="//code.jquery.com/jquery-1.9.0.min.js"></script> <script src="/js/all.js?4e047f6f42b"></script> <script>var disqus_shortname = 'yegor256';</script> <script id="dsq-count-scr" src="//yegor256.disqus.com/count.js" async="async"></script> <script> (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){ (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o), m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m) })(window,document,'script','//www.google-analytics.com/analytics.js','ga'); ga('create', 'UA-1963507-32', 'auto'); ga('send', 'pageview'); </script> <script> Cd=document;Cr="&"+Math.random();Cp="&s=1"; Cd.cookie="b=b";if(Cd.cookie)Cp+="&c=1"; Cp+="&t="+(new Date()).getTimezoneOffset(); if(self!=top)Cp+="&f=1"; </script> <script> if(navigator.javaEnabled())Cp+="&j=1"; </script> <script> if(typeof(screen)!='undefined')Cp+="&w="+screen.width+"&h="+ screen.height+"&d="+(screen.colorDepth?screen.colorDepth:screen.pixelDepth); </script> <script> Cd.write("<img src='//c.hit.ua/hit?i=95870&g=0&x=2"+Cp+Cr+ "&r="+escape(Cd.referrer)+"&u="+escape(window.location.href)+ "' border='0' wi"+"dth='1' he"+"ight='1'/>"); </script> <script type="application/ld+json"> { "@context": "http://schema.org", "@type": "Person", "name": "Yegor Bugayenko", "url": "http://www.yegor256.com", "sameAs": [ "https://www.facebook.com/yegor256", "https://instagram.com/yegor256", "https://www.linkedin.com/in/yegor256", "https://twitter.com/yegor256", "https://github.com/yegor256", "https://www.pinterest.com/yegor256/" ] } </script> </body> </html> <!DOCTYPE html> <html xmlns="http://www.w3.org/1999/xhtml" lang="en-US" xml:lang="en-US" itemscope="" itemtype="http://schema.org/WebSite"> <head> <meta charset="utf-8"/> <meta name="description" content="Static factory methods are supposed to be a convenient replacement of object constructors; however, I disagree with this idea and explain why. " /> <meta name="keywords" content="constructor or factory, constructors, factories vs constructiors, factory method, factory methods" /> <meta name="viewport" content="width=device-width,minimum-scale=1,initial-scale=1"/> <meta name="google-site-verification" content="JEj_gQr2CPe2QKGw8XdMz0R7VboQIUbX3FlM-lwTq-8" /> <meta name="author" content="Yegor Bugayenko"> <meta name="article:published_time" content="2017-11-14 00:00:00 +0000"> <meta name="og:site_name" content="Yegor Bugayenko"/> <meta name="og:type" content="article" /> <meta name="og:locale" content="en_US" /> <meta name="twitter:account_id" content="4503599630178231" /> <meta name="twitter:creator" content="@yegor256"/> <meta name="twitter:site" content="@yegor256"/> <meta name="twitter:title" property="og:title" content="Constructors or Static Factory Methods?"/> <meta name="twitter:description" property="og:description" content="Static factory methods are supposed to be a convenient replacement of object constructors; however, I disagree with this idea and explain why. "/> <meta name="twitter:url" property="og:url" content="https://www.yegor256.com/2017/11/14/static-factory-methods.html"/> <meta name="telegram:channel" content="AAAAAEJFMRzsRTRxM3ec6A"/> <link rel="search" type="application/opensearchdescription+xml" href="/opensearch.xml" title="yegor256" /> <link rel="shortcut icon" href="/favicon.ico?4e047f6f42b"/> <link rel="apple-touch-icon" href="/favicon.ico?4e047f6f42b"/> <link rel="alternate" type="application/rss+xml" title="RSS for yegor256.com" href="https://www.yegor256.com/rss.xml"/> <link rel="stylesheet" href="/css/layout.css?4e047f6f42b"/> <link rel="stylesheet" href="/css/icons.css?4e047f6f42b"/> <link rel="canonical" href="https://www.yegor256.com/2017/11/14/static-factory-methods.html" /> <link rel="amphtml" href="https://www.yegor256.com/2017/11/14/static-factory-methods.amp.html" /> <title>Constructors or Static Factory Methods? </title> <meta name='og:image' content='https://www.yegor256.com/images/2017/11/extract.jpg'/><meta name='twitter:image' content='https://www.yegor256.com/images/2017/11/extract.jpg'/><meta name='og:image:width' content='1280'/> <meta name='twitter:image:width' content='1280'/><meta name='og:image:height' content='688'/> <meta name='twitter:image:height' content='688'/><meta name='twitter:card' content='summary_large_image'/><meta name='twitter:image:alt' content='Extract (2009) by Mike Judge'/> </head> <body><div class="wrapper"> <aside class="header-toggle unprintable" id="header-toggle" title="Show the menu" onclick="$('#header').show();$('#header-toggle').hide();">&#9776;</aside> <header class="header" id="header"><div class="face"> <a href="/about-me.html#form" class="sub" title="Click to subscribe to my monthly newsletter"><span>Subscribe</span></a> <a href="/about-me.html" style="position:relative;"> <img src="/images/face-256x256.jpg" class="photo" alt="Yegor Bugayenko"/> </a></div><nav><ul class="menu social notranslate"> <li><a href="https://twitter.com/intent/follow?screen_name=yegor256" rel="nofollow" title="Follow me on Twitter"><i class="icon icon-twitter notranslate" aria-hidden="true"></i></a></li> <li><a href="/rss.xml" rel="nofollow" title="Subscribe to my RSS feed"><i class="icon icon-rss notranslate" aria-hidden="true"></i></a></li> <li><a itemprop="sameAs" href="https://github.com/yegor256" rel="nofollow" title="My GitHub profile"><i class="icon icon-github notranslate" aria-hidden="true"></i></a></li> <li><a itemprop="sameAs" href="http://stackoverflow.com/users/187141/yegor256" rel="nofollow" title="My StackOverflow profile"><i class="icon icon-stackoverflow notranslate" aria-hidden="true"></i></a></li> <li><a itemprop="sameAs" href="https://www.facebook.com/yegor256" rel="nofollow" title="Follow me on Facebook"><i class="icon icon-facebook notranslate" aria-hidden="true"></i></a></li> <li><a itemprop="sameAs" href="https://instagram.com/yegor256" rel="nofollow" title="Follow me on Instagram"><i class="icon icon-instagram notranslate" aria-hidden="true"></i></a></li> <li><a itemprop="sameAs" href="https://www.linkedin.com/in/yegor256" rel="nofollow" title="My LinkedIn profile"><i class="icon icon-linkedin notranslate" aria-hidden="true"></i></a></li> <li><a itemprop="sameAs" href="https://www.youtube.com/c/yegor256?sub_confirmation=1" rel="nofollow" title="My Youtube video channel"><i class="icon icon-youtube notranslate" aria-hidden="true"></i></a></li> <li><a itemprop="sameAs" href="https://www.pinterest.com/yegor256/" rel="nofollow" title="My Pinterest boards"><i class="icon icon-pinterest notranslate" aria-hidden="true"></i></a></li> <li><a itemprop="sameAs" href="https://angel.co/yegor256" rel="nofollow" title="My AngelList profile"><i class="icon icon-angellist notranslate" aria-hidden="true"></i></a></li> <li><a href="https://soundcloud.com/yegor256" rel="nofollow" title="My podcast"><i class="icon icon-podcast notranslate" aria-hidden="true"></i></a></li> <li><a href="https://itunes.apple.com/us/podcast/yegor256-podcast/id1150826721" rel="nofollow" title="My iTunes podcast"><i class="icon icon-itunes notranslate" aria-hidden="true"></i></a></li> <li><a href="https://t.me/joinchat/AAAAAEJFMRzsRTRxM3ec6A" rel="nofollow" title="My Telegram public channel"><i class="icon icon-telegram notranslate" aria-hidden="true"></i></a></li> <li><a href="mailto:blog@yegor256.com" rel="nofollow" title="Email me any time"><i class="icon icon-mail notranslate" aria-hidden="true"></i></a></li></ul><ul class="menu"> <li><a href="/" title="Home page">Home</a></li> <li ><a href="/best.html" title="Best articles to read">12&#160;Best</a></li> <li ><a href="/contents.html" title="The contents of the entire blog">All&#160;288</a></li> <li ><a href="/webinars.html" title="My webinars">Webinars</a></li> <li ><a href="/talks.html" title="Future and past conference talks">Talks</a></li> <li ><a href="/books.html" title="The books I wrote">Books</a></li> <li ><a href="/papers.html" title="My academic papers and patents">Papers</a></li> <li ><a href="/pets.html" title="My loved pet projects">Pets</a></li> <li ><a href="/award.html" title="Software quality award">Award</a></li> <li ><a href="/testimonials.html" title="What some people say about me">Testimonials</a></li> <li ><a href="/shift-m.html" title="Audio podcast about project management">Shift-M</a></li> <li ><a href="/paintings.html" title="My paintings for sale">Paintings</a></li> <li><a href="http://ru.yegor256.com/" title="Немного на русском языке">По-русски</a></li></ul></nav><div class="search"> <form method="get" action="https://www.google.com/search" itemprop="potentialAction" itemscope="" itemtype="http://schema.org/SearchAction"> <meta itemprop="target" content="https://www.google.com/search?q={q}"/> <input name="sitesearch" value="yegor256.com" type="hidden"/> <input itemprop="query-input" type="text" id="search-query" class="field field-text" required="required" onfocus="$('.google').css('visibility', 'visible');" name="q" placeholder="Search..." autocomplete="off"/> <input type="image" src="/images/google-search-icon.svg" class="google" title="Search via Google" alt="Search via Google"/> </form></div><div class="hot"><ul> <li> <a href="/code-ahead.html">Code Ahead</a> was published on Amazon just a few days ago! It is my new book, a novel about programmers. It explains in details the majority of ideas that stand behind <a href="https://www.zerocracy.com">Zerocracy</a> and <a href="https://www.xdsd.org">XDSD</a>. </li> <li> At <a href="/webinars.html">Webinar #37</a> we will discuss naming problem in OOP, for objects, methods and attributes; join us on <b>September 12</b>, at 11am PST. </li></ul></div></header></div><section itemscope="" itemtype="http://schema.org/BlogPosting"><div class="wrapper"> <header><p class="printable"> <img src="https://api.qrserver.com/v1/create-qr-code/?data=https://www.yegor256.com/2017/11/14/static-factory-methods.html&amp;format=svg" style="width:125px;height:125px;" alt="QR code"/></p><p class="printable"> <code itemprop="url">https://www.yegor256.com/2017/11/14/static-factory-methods.html</code></p><h1 itemprop="name headline mainEntityOfPage">Constructors or Static Factory Methods?</h1><ul class="subline"> <li> <time itemprop="datePublished" datetime="2017-11-14T00:00:00+00:00"> 14 November 2017 </time> </li> <li class="desktop-only" itemprop="locationCreated">Odessa, Ukraine</li> <li class="printable" itemscope="" itemprop="author" itemtype="http://schema.org/Person"> <span itemprop="name">Yegor Bugayenko</span> </li> <li class="unprintable"> <i class="icon icon-comments"></i> <a href="http://www.yegor256.com/2017/11/14/static-factory-methods.html#disqus_thread" itemprop="discussionUrl">comments</a> </li></ul><ul class="subline"> <li>Discussed at:</li> <li><a href="https://dzone.com/articles/constructors-or-static-factory-methods">dzone</a></li></ul><figure class='jb_picture'><img itemprop='image' alt='Extract (2009) by Mike Judge' src='/images/2017/11/extract.jpg' longdesc='#81adfef8'/><figcaption id='81adfef8'>Extract (2009) by Mike Judge</figcaption></figure><p>Let&#39;s analyze the reasoning and see why it&#39;s wrong, from an object-oriented point of view.</p><p>This is a class with one primary and two secondary constructors:</p><figure class="highlight"><pre><code class="language-java" data-lang="java"><span></span><span class="kd">class</span> <span class="nc">Color</span> <span class="o">{</span>
  <span class="kd">private</span> <span class="kd">final</span> <span class="kt">int</span> <span class="n">hex</span><span class="o">;</span>
  <span class="n">Color</span><span class="o">(</span><span class="n">String</span> <span class="n">rgb</span><span class="o">)</span> <span class="o">{</span>
    <span class="k">this</span><span class="o">(</span><span class="n">Integer</span><span class="o">.</span><span class="na">parseInt</span><span class="o">(</span><span class="n">rgb</span><span class="o">,</span> <span class="mi">16</span><span class="o">));</span>
  <span class="o">}</span>
  <span class="n">Color</span><span class="o">(</span><span class="kt">int</span> <span class="n">red</span><span class="o">,</span> <span class="kt">int</span> <span class="n">green</span><span class="o">,</span> <span class="kt">int</span> <span class="n">blue</span><span class="o">)</span> <span class="o">{</span>
    <span class="k">this</span><span class="o">(</span><span class="n">red</span> <span class="o">&lt;&lt;</span> <span class="mi">16</span> <span class="o">+</span> <span class="n">green</span> <span class="o">&lt;&lt;</span> <span class="mi">8</span> <span class="o">+</span> <span class="n">blue</span><span class="o">);</span>
  <span class="o">}</span>
  <span class="n">Color</span><span class="o">(</span><span class="kt">int</span> <span class="n">h</span><span class="o">)</span> <span class="o">{</span>
    <span class="k">this</span><span class="o">.</span><span class="na">hex</span> <span class="o">=</span> <span class="n">h</span><span class="o">;</span>
  <span class="o">}</span>
<span class="o">}</span></code></pre></figure><p>This is a similar class with three static factory methods:</p><figure class="highlight"><pre><code class="language-java" data-lang="java"><span></span><span class="kd">class</span> <span class="nc">Color</span> <span class="o">{</span>
  <span class="kd">private</span> <span class="kd">final</span> <span class="kt">int</span> <span class="n">hex</span><span class="o">;</span>
  <span class="kd">static</span> <span class="n">Color</span> <span class="nf">makeFromRGB</span><span class="o">(</span><span class="n">String</span> <span class="n">rgb</span><span class="o">)</span> <span class="o">{</span>
    <span class="k">return</span> <span class="k">new</span> <span class="n">Color</span><span class="o">(</span><span class="n">Integer</span><span class="o">.</span><span class="na">parseInt</span><span class="o">(</span><span class="n">rgb</span><span class="o">,</span> <span class="mi">16</span><span class="o">));</span>
  <span class="o">}</span>
  <span class="kd">static</span> <span class="n">Color</span> <span class="nf">makeFromPalette</span><span class="o">(</span><span class="kt">int</span> <span class="n">red</span><span class="o">,</span> <span class="kt">int</span> <span class="n">green</span><span class="o">,</span> <span class="kt">int</span> <span class="n">blue</span><span class="o">)</span> <span class="o">{</span>
    <span class="k">return</span> <span class="k">new</span> <span class="n">Color</span><span class="o">(</span><span class="n">red</span> <span class="o">&lt;&lt;</span> <span class="mi">16</span> <span class="o">+</span> <span class="n">green</span> <span class="o">&lt;&lt;</span> <span class="mi">8</span> <span class="o">+</span> <span class="n">blue</span><span class="o">);</span>
  <span class="o">}</span>
  <span class="kd">static</span> <span class="n">Color</span> <span class="nf">makeFromHex</span><span class="o">(</span><span class="kt">int</span> <span class="n">h</span><span class="o">)</span> <span class="o">{</span>
    <span class="k">return</span> <span class="k">new</span> <span class="n">Color</span><span class="o">(</span><span class="n">h</span><span class="o">);</span>
  <span class="o">}</span>
  <span class="kd">private</span> <span class="nf">Color</span><span class="o">(</span><span class="kt">int</span> <span class="n">h</span><span class="o">)</span> <span class="o">{</span>
    <span class="k">this</span><span class="o">.</span><span class="na">hex</span> <span class="o">=</span> <span class="n">h</span><span class="o">;</span>
  <span class="o">}</span>
<span class="o">}</span></code></pre></figure><p>Which one do you like better?</p><aside class='quote'>Giving birth to an object through its constructor is the most "sacred" moment in any object-oriented software, don't miss the beauty of it!</aside><p>According to Joshua Bloch, there are three basic advantages to using static factory methods instead of constructors (there are actually four, but the fourth one is not applicable to Java <a href="https://docs.oracle.com/javase/7/docs/technotes/guides/language/type-inference-generic-instance-creation.html">anymore</a>):</p><ul> <li>They have names.</li> <li>They can cache.</li> <li>They can subtype.</li></ul><p>I believe that all three make perfect sense ... if the design is wrong. They are good excuses for workarounds. Let&#39;s take them one by one.</p><h2 id="they-have-names">They Have Names</h2><p>This is how you make a <a href="http://www.rapidtables.com/web/color/red-color.htm">red tomato</a> color object with a constructor:</p><figure class="highlight"><pre><code class="language-java" data-lang="java"><span></span><span class="n">Color</span> <span class="n">tomato</span> <span class="o">=</span> <span class="k">new</span> <span class="n">Color</span><span class="o">(</span><span class="mi">255</span><span class="o">,</span> <span class="mi">99</span><span class="o">,</span> <span class="mi">71</span><span class="o">);</span></code></pre></figure><p>This is how you do it with a static factory method:</p><figure class="highlight"><pre><code class="language-java" data-lang="java"><span></span><span class="n">Color</span> <span class="n">tomato</span> <span class="o">=</span> <span class="n">Color</span><span class="o">.</span><span class="na">makeFromPalette</span><span class="o">(</span><span class="mi">255</span><span class="o">,</span> <span class="mi">99</span><span class="o">,</span> <span class="mi">71</span><span class="o">);</span></code></pre></figure><p>It seems that <code>makeFromPalette()</code> is semantically richer than just <code>new Color()</code>, right? Well, yes. Who knows what those three numbers mean if we just pass them to the constructor. But the word &quot;palette&quot; helps us figure everything out immediately.</p><p>True.</p><p>However, the right solution would be to use polymorphism and encapsulation, to decompose the problem into a few semantically rich classes:</p><figure class="highlight"><pre><code class="language-java" data-lang="java"><span></span><span class="kd">interface</span> <span class="nc">Color</span> <span class="o">{</span>
<span class="o">}</span>
<span class="kd">class</span> <span class="nc">HexColor</span> <span class="kd">implements</span> <span class="n">Color</span> <span class="o">{</span>
  <span class="kd">private</span> <span class="kd">final</span> <span class="kt">int</span> <span class="n">hex</span><span class="o">;</span>
  <span class="n">HexColor</span><span class="o">(</span><span class="kt">int</span> <span class="n">h</span><span class="o">)</span> <span class="o">{</span>
    <span class="k">this</span><span class="o">.</span><span class="na">hex</span> <span class="o">=</span> <span class="n">h</span><span class="o">;</span>
  <span class="o">}</span>
<span class="o">}</span>
<span class="kd">class</span> <span class="nc">RGBColor</span> <span class="kd">implements</span> <span class="n">Color</span> <span class="o">{</span>
  <span class="kd">private</span> <span class="kd">final</span> <span class="n">Color</span> <span class="n">origin</span><span class="o">;</span>
  <span class="n">RGBColor</span><span class="o">(</span><span class="kt">int</span> <span class="n">red</span><span class="o">,</span> <span class="kt">int</span> <span class="n">green</span><span class="o">,</span> <span class="kt">int</span> <span class="n">blue</span><span class="o">)</span> <span class="o">{</span>
    <span class="k">this</span><span class="o">.</span><span class="na">origin</span> <span class="o">=</span> <span class="k">new</span> <span class="n">HexColor</span><span class="o">(</span>
      <span class="n">red</span> <span class="o">&lt;&lt;</span> <span class="mi">16</span> <span class="o">+</span> <span class="n">green</span> <span class="o">&lt;&lt;</span> <span class="mi">8</span> <span class="o">+</span> <span class="n">blue</span>
    <span class="o">);</span>
  <span class="o">}</span>
<span class="o">}</span></code></pre></figure><p>Now, we use the right constructor of the right class:</p><figure class="highlight"><pre><code class="language-java" data-lang="java"><span></span><span class="n">Color</span> <span class="n">tomato</span> <span class="o">=</span> <span class="k">new</span> <span class="n">RGBColor</span><span class="o">(</span><span class="mi">255</span><span class="o">,</span> <span class="mi">99</span><span class="o">,</span> <span class="mi">71</span><span class="o">);</span></code></pre></figure><p>See, Joshua?</p><h2 id="they-can-cache">They Can Cache</h2><p>Let&#39;s say I need a red tomato color in multiple places in the application:</p><figure class="highlight"><pre><code class="language-java" data-lang="java"><span></span><span class="n">Color</span> <span class="n">tomato</span> <span class="o">=</span> <span class="k">new</span> <span class="n">Color</span><span class="o">(</span><span class="mi">255</span><span class="o">,</span> <span class="mi">99</span><span class="o">,</span> <span class="mi">71</span><span class="o">);</span>
<span class="c1">// ... sometime later</span>
<span class="n">Color</span> <span class="n">red</span> <span class="o">=</span> <span class="k">new</span> <span class="n">Color</span><span class="o">(</span><span class="mi">255</span><span class="o">,</span> <span class="mi">99</span><span class="o">,</span> <span class="mi">71</span><span class="o">);</span></code></pre></figure><p>Two objects will be created, which is obviously inefficient, since they are identical. It would be better to keep the first instance somewhere in memory and return it when the second call arrives. Static factory methods make it possible to solve this very problem:</p><figure class="highlight"><pre><code class="language-java" data-lang="java"><span></span><span class="n">Color</span> <span class="n">tomato</span> <span class="o">=</span> <span class="n">Color</span><span class="o">.</span><span class="na">makeFromPalette</span><span class="o">(</span><span class="mi">255</span><span class="o">,</span> <span class="mi">99</span><span class="o">,</span> <span class="mi">71</span><span class="o">);</span>
<span class="c1">// ... sometime later</span>
<span class="n">Color</span> <span class="n">red</span> <span class="o">=</span> <span class="n">Color</span><span class="o">.</span><span class="na">makeFromPalette</span><span class="o">(</span><span class="mi">255</span><span class="o">,</span> <span class="mi">99</span><span class="o">,</span> <span class="mi">71</span><span class="o">);</span></code></pre></figure><p>Then somewhere inside the <code>Color</code> we keep a private static <code>Map</code> with all the objects already instantiated:</p><figure class="highlight"><pre><code class="language-java" data-lang="java"><span></span><span class="kd">class</span> <span class="nc">Color</span> <span class="o">{</span>
  <span class="kd">private</span> <span class="kd">static</span> <span class="kd">final</span> <span class="n">Map</span><span class="o">&lt;</span><span class="n">Integer</span><span class="o">,</span> <span class="n">Color</span><span class="o">&gt;</span> <span class="n">CACHE</span> <span class="o">=</span>
    <span class="k">new</span> <span class="n">HashMap</span><span class="o">&lt;&gt;();</span>
  <span class="kd">private</span> <span class="kd">final</span> <span class="kt">int</span> <span class="n">hex</span><span class="o">;</span>
  <span class="kd">static</span> <span class="n">Color</span> <span class="nf">makeFromPalette</span><span class="o">(</span><span class="kt">int</span> <span class="n">red</span><span class="o">,</span> <span class="kt">int</span> <span class="n">green</span><span class="o">,</span> <span class="kt">int</span> <span class="n">blue</span><span class="o">)</span> <span class="o">{</span>
    <span class="kd">final</span> <span class="kt">int</span> <span class="n">hex</span> <span class="o">=</span> <span class="n">red</span> <span class="o">&lt;&lt;</span> <span class="mi">16</span> <span class="o">+</span> <span class="n">green</span> <span class="o">&lt;&lt;</span> <span class="mi">8</span> <span class="o">+</span> <span class="n">blue</span><span class="o">;</span>
    <span class="k">return</span> <span class="n">Color</span><span class="o">.</span><span class="na">CACHE</span><span class="o">.</span><span class="na">computeIfAbsent</span><span class="o">(</span>
      <span class="n">hex</span><span class="o">,</span> <span class="n">h</span> <span class="o">-&gt;</span> <span class="k">new</span> <span class="n">Color</span><span class="o">(</span><span class="n">h</span><span class="o">)</span>
    <span class="o">);</span>
  <span class="o">}</span>
  <span class="kd">private</span> <span class="nf">Color</span><span class="o">(</span><span class="kt">int</span> <span class="n">h</span><span class="o">)</span> <span class="o">{</span>
    <span class="k">return</span> <span class="k">new</span> <span class="n">Color</span><span class="o">(</span><span class="n">h</span><span class="o">);</span>
  <span class="o">}</span>
<span class="o">}</span></code></pre></figure><p>It is very effective performance-wise. With a small object like our <code>Color</code> the problem may not be so obvious, but when objects are bigger, their instantiation and garbage collection may waste a lot of time.</p><p>True.</p><p>However, there is an object-oriented way to solve this problem. We just introduce a new class <code>Palette</code>, which becomes a store of colors:</p><figure class="highlight"><pre><code class="language-java" data-lang="java"><span></span><span class="kd">class</span> <span class="nc">Palette</span> <span class="o">{</span>
  <span class="kd">private</span> <span class="kd">final</span> <span class="n">Map</span><span class="o">&lt;</span><span class="n">Integer</span><span class="o">,</span> <span class="n">Color</span><span class="o">&gt;</span> <span class="n">colors</span> <span class="o">=</span>
    <span class="k">new</span> <span class="n">HashMap</span><span class="o">&lt;&gt;();</span>
  <span class="n">Color</span> <span class="nf">take</span><span class="o">(</span><span class="kt">int</span> <span class="n">red</span><span class="o">,</span> <span class="kt">int</span> <span class="n">green</span><span class="o">,</span> <span class="kt">int</span> <span class="n">blue</span><span class="o">)</span> <span class="o">{</span>
    <span class="kd">final</span> <span class="kt">int</span> <span class="n">hex</span> <span class="o">=</span> <span class="n">red</span> <span class="o">&lt;&lt;</span> <span class="mi">16</span> <span class="o">+</span> <span class="n">green</span> <span class="o">&lt;&lt;</span> <span class="mi">8</span> <span class="o">+</span> <span class="n">blue</span><span class="o">;</span>
    <span class="k">return</span> <span class="k">this</span><span class="o">.</span><span class="na">computerIfAbsent</span><span class="o">(</span>
      <span class="n">hex</span><span class="o">,</span> <span class="n">h</span> <span class="o">-&gt;</span> <span class="k">new</span> <span class="n">Color</span><span class="o">(</span><span class="n">h</span><span class="o">)</span>
    <span class="o">);</span>
  <span class="o">}</span>
<span class="o">}</span></code></pre></figure><p>Now, we make an instance of <code>Palette</code> once and ask it to return a color to us every time we need it:</p><figure class="highlight"><pre><code class="language-java" data-lang="java"><span></span><span class="n">Color</span> <span class="n">tomato</span> <span class="o">=</span> <span class="n">palette</span><span class="o">.</span><span class="na">take</span><span class="o">(</span><span class="mi">255</span><span class="o">,</span> <span class="mi">99</span><span class="o">,</span> <span class="mi">71</span><span class="o">);</span>
<span class="c1">// Later we will get the same instance:</span>
<span class="n">Color</span> <span class="n">red</span> <span class="o">=</span> <span class="n">palette</span><span class="o">.</span><span class="na">take</span><span class="o">(</span><span class="mi">255</span><span class="o">,</span> <span class="mi">99</span><span class="o">,</span> <span class="mi">71</span><span class="o">);</span></code></pre></figure><p>See, Joshua, no static methods, no static attributes.</p><h2 id="they-can-subtype">They Can Subtype</h2><p>Let&#39;s say our class <code>Color</code> has a method <code>lighter()</code>, which is supposed to shift the color to the next available lighter one:</p><figure class="highlight"><pre><code class="language-java" data-lang="java"><span></span><span class="kd">class</span> <span class="nc">Color</span> <span class="o">{</span>
  <span class="kd">protected</span> <span class="kd">final</span> <span class="kt">int</span> <span class="n">hex</span><span class="o">;</span>
  <span class="n">Color</span><span class="o">(</span><span class="kt">int</span> <span class="n">h</span><span class="o">)</span> <span class="o">{</span>
    <span class="k">this</span><span class="o">.</span><span class="na">hex</span> <span class="o">=</span> <span class="n">h</span><span class="o">;</span>
  <span class="o">}</span>
  <span class="kd">public</span> <span class="n">Color</span> <span class="nf">lighter</span><span class="o">()</span> <span class="o">{</span>
    <span class="k">return</span> <span class="k">new</span> <span class="n">Color</span><span class="o">(</span><span class="n">hex</span> <span class="o">+</span> <span class="mh">0x111</span><span class="o">);</span>
  <span class="o">}</span>
<span class="o">}</span></code></pre></figure><p>However, sometimes it&#39;s more desirable to pick the next lighter color through a set of available <a href="https://en.wikipedia.org/wiki/Pantone">Pantone</a> colors:</p><figure class="highlight"><pre><code class="language-java" data-lang="java"><span></span><span class="kd">class</span> <span class="nc">PantoneColor</span> <span class="kd">extends</span> <span class="n">Color</span> <span class="o">{</span>
  <span class="kd">private</span> <span class="kd">final</span> <span class="n">PantoneName</span> <span class="n">pantone</span><span class="o">;</span>
  <span class="n">PantoneColor</span><span class="o">(</span><span class="n">String</span> <span class="n">name</span><span class="o">)</span> <span class="o">{</span>
    <span class="k">this</span><span class="o">(</span><span class="k">new</span> <span class="n">PantoneName</span><span class="o">(</span><span class="n">name</span><span class="o">));</span>
  <span class="o">}</span>
  <span class="n">PantoneColor</span><span class="o">(</span><span class="n">PantoneName</span> <span class="n">name</span><span class="o">)</span> <span class="o">{</span>
    <span class="k">this</span><span class="o">.</span><span class="na">pantone</span> <span class="o">=</span> <span class="n">name</span><span class="o">;</span>
  <span class="o">}</span>
  <span class="nd">@Override</span>
  <span class="kd">public</span> <span class="n">Color</span> <span class="nf">lighter</span><span class="o">()</span> <span class="o">{</span>
    <span class="k">return</span> <span class="k">new</span> <span class="n">PantoneColor</span><span class="o">(</span><span class="k">this</span><span class="o">.</span><span class="na">pantone</span><span class="o">.</span><span class="na">up</span><span class="o">());</span>
  <span class="o">}</span>
<span class="o">}</span></code></pre></figure><p>Then, we create a static factory method, which will decide which <code>Color</code> implementation is the most suitable for us:</p><figure class="highlight"><pre><code class="language-java" data-lang="java"><span></span><span class="kd">class</span> <span class="nc">Color</span> <span class="o">{</span>
  <span class="kd">private</span> <span class="kd">final</span> <span class="n">String</span> <span class="n">code</span><span class="o">;</span>
  <span class="kd">static</span> <span class="n">Color</span> <span class="nf">make</span><span class="o">(</span><span class="kt">int</span> <span class="n">h</span><span class="o">)</span> <span class="o">{</span>
    <span class="k">if</span> <span class="o">(</span><span class="n">h</span> <span class="o">==</span> <span class="mh">0xBF1932</span><span class="o">)</span> <span class="o">{</span>
      <span class="k">return</span> <span class="k">new</span> <span class="n">PantoneColor</span><span class="o">(</span><span class="s">&quot;19-1664 TPX&quot;</span><span class="o">);</span>
    <span class="o">}</span>
    <span class="k">return</span> <span class="k">new</span> <span class="n">RGBColor</span><span class="o">(</span><span class="n">h</span><span class="o">);</span>
  <span class="o">}</span>
<span class="o">}</span></code></pre></figure><p>If the <a href="https://www.pantone.com/color-finder/19-1664-TPX">true red</a> color is requested, we return an instance of <code>PantoneColor</code>. In all other cases it&#39;s just a standard <code>RGBColor</code>. The decision is made by the static factory method. This is how we will call it:</p><figure class="highlight"><pre><code class="language-java" data-lang="java"><span></span><span class="n">Color</span> <span class="n">color</span> <span class="o">=</span> <span class="n">Color</span><span class="o">.</span><span class="na">make</span><span class="o">(</span><span class="mh">0xBF1932</span><span class="o">);</span></code></pre></figure><p>It would not be possible to do the same &quot;forking&quot; with a constructor, since it can only return the class it is declared in. A static method has all the necessary freedom to return any subtype of <code>Color</code>.</p><p>True.</p><p>However, in an object-oriented world we can and must do it all differently. First, we would make <code>Color</code> an interface:</p><figure class="highlight"><pre><code class="language-java" data-lang="java"><span></span><span class="kd">interface</span> <span class="nc">Color</span> <span class="o">{</span>
  <span class="n">Color</span> <span class="nf">lighter</span><span class="o">();</span>
<span class="o">}</span></code></pre></figure><p>Next, we would move this decision making process to its own class <code>Colors</code>, just like we did in the previous example:</p><figure class="highlight"><pre><code class="language-java" data-lang="java"><span></span><span class="kd">class</span> <span class="nc">Colors</span> <span class="o">{</span>
  <span class="n">Color</span> <span class="nf">make</span><span class="o">(</span><span class="kt">int</span> <span class="n">h</span><span class="o">)</span> <span class="o">{</span>
    <span class="k">if</span> <span class="o">(</span><span class="n">h</span> <span class="o">==</span> <span class="mh">0xBF1932</span><span class="o">)</span> <span class="o">{</span>
      <span class="k">return</span> <span class="k">new</span> <span class="n">PantoneColor</span><span class="o">(</span><span class="s">&quot;19-1664-TPX&quot;</span><span class="o">);</span>
    <span class="o">}</span>
    <span class="k">return</span> <span class="k">new</span> <span class="n">RGBColor</span><span class="o">(</span><span class="n">h</span><span class="o">);</span>
  <span class="o">}</span>
<span class="o">}</span></code></pre></figure><p>And we would use an instance of class <code>Colors</code> instead of a static faсtory method inside <code>Color</code>:</p><figure class="highlight"><pre><code class="language-java" data-lang="java"><span></span><span class="n">colors</span><span class="o">.</span><span class="na">make</span><span class="o">(</span><span class="mh">0xBF1932</span><span class="o">);</span></code></pre></figure> <aside class='youtube'> <a href='https://www.youtube.com/watch?v=9yjtsCK6Wdk'><div class='box'> <img src='https://i.ytimg.com/vi/9yjtsCK6Wdk/mqdefault.jpg' alt='YouTube video #9yjtsCK6Wdk'/><div class='play'><i class='icon icon-play'></i></div></div></a><div>A Few Thoughts About Constructors in OOP (webinar #7); 7 October 2015.</div></aside><p>However, this is still not really an object-oriented way of thinking, because we&#39;re taking the decision-making away from the object it belongs to. Either through a static factory method <code>make()</code> or a new class <code>Colors</code>---it doesn&#39;t really matter how---we tear our objects into two pieces. The first piece is the object itself and the second one is the decision making algorithm that stays somewhere else.</p><p>A much more object-oriented design would be to put the logic into an object of class <code>PantoneColor</code> which would decorate the original <code>RGBColor</code>:</p><figure class="highlight"><pre><code class="language-java" data-lang="java"><span></span><span class="kd">class</span> <span class="nc">PantoneColor</span> <span class="o">{</span>
  <span class="kd">private</span> <span class="kd">final</span> <span class="n">Color</span> <span class="n">origin</span><span class="o">;</span>
  <span class="n">PantoneColor</span><span class="o">(</span><span class="n">Color</span> <span class="n">color</span><span class="o">)</span> <span class="o">{</span>
    <span class="k">this</span><span class="o">.</span><span class="na">origin</span> <span class="o">=</span> <span class="n">color</span><span class="o">;</span>
  <span class="o">}</span>
  <span class="nd">@Override</span>
  <span class="kd">public</span> <span class="n">Color</span> <span class="nf">lighter</span><span class="o">()</span> <span class="o">{</span>
    <span class="kd">final</span> <span class="n">Color</span> <span class="n">next</span><span class="o">;</span>
    <span class="k">if</span> <span class="o">(</span><span class="k">this</span><span class="o">.</span><span class="na">origin</span><span class="o">.</span><span class="na">hex</span><span class="o">()</span> <span class="o">==</span> <span class="mh">0xBF1932</span><span class="o">)</span> <span class="o">{</span>
      <span class="n">next</span> <span class="o">=</span> <span class="k">new</span> <span class="n">RGBColor</span><span class="o">(</span><span class="mh">0xD12631</span><span class="o">);</span>
    <span class="o">}</span> <span class="k">else</span> <span class="o">{</span>
      <span class="n">next</span> <span class="o">=</span> <span class="k">this</span><span class="o">.</span><span class="na">origin</span><span class="o">.</span><span class="na">lighter</span><span class="o">();</span>
    <span class="o">}</span>
    <span class="k">return</span> <span class="k">new</span> <span class="n">PantoneColor</span><span class="o">(</span><span class="n">next</span><span class="o">);</span>
  <span class="o">}</span>
<span class="o">)</span></code></pre></figure><p>Then, we make an instance of <code>RGBColor</code> and decorate it with <code>PantoneColor</code>:</p><figure class="highlight"><pre><code class="language-java" data-lang="java"><span></span><span class="n">Color</span> <span class="n">red</span> <span class="o">=</span> <span class="k">new</span> <span class="n">PantoneColor</span><span class="o">(</span>
  <span class="k">new</span> <span class="n">RGBColor</span><span class="o">(</span><span class="mh">0xBF1932</span><span class="o">)</span>
<span class="o">);</span></code></pre></figure><p>We ask <code>red</code> to return a lighter color and it returns the one from the Pantone palette, not the one that is merely lighter in RGB coordinates:</p><figure class="highlight"><pre><code class="language-java" data-lang="java"><span></span><span class="n">Color</span> <span class="n">lighter</span> <span class="o">=</span> <span class="n">red</span><span class="o">.</span><span class="na">lighter</span><span class="o">();</span> <span class="c1">// 0xD12631</span></code></pre></figure><p>Of course, this example is rather primitive and needs <a href="/2016/12/20/can-objects-be-friends.html">further improvement</a> if we really want it to be applicable to all Pantone colors, but I hope you get the idea. The logic must stay <em>inside</em> the class, not somewhere outside, not in static factory methods or even in some other supplementary class. I&#39;m talking about the logic that belongs to this particular class, of course. If it&#39;s something related to the management of class instances, then there can be containers and stores, just like in the previous example above.</p><p>To summarize, I would strongly recommend you <em>never</em> use static methods, especially when they are going to replace object constructors. Giving birth to an object through its constructor is <a href="/2014/10/03/di-containers-are-evil.html">the most</a> &quot;sacred&quot; moment in any object-oriented software, don&#39;t miss the beauty of it.</p></p>--> <nav class="buttons notranslate desktop-only"> <a href="http://www.facebook.com/sharer/sharer.php?u=https://www.yegor256.com/2017/11/14/static-factory-methods.html" title="Share on Facebook" class="button" rel="nofollow"> <span class="count count-facebook">0</span> <i class="icon icon-facebook notranslate" aria-hidden="true"></i> </a> <a href="https://twitter.com/share?url=https://www.yegor256.com/2017/11/14/static-factory-methods.html&amp;text=Constructors+or+Static+Factory+Methods%3F" title="Share on Twitter" class="button" rel="nofollow"> <span class="count count-twitter">0</span> <i class="icon icon-twitter notranslate" aria-hidden="true"></i> </a> <a href="https://plus.google.com/share?url=https://www.yegor256.com/2017/11/14/static-factory-methods.html" title="Share on Google+" class="button" rel="nofollow"> <span class="count count-googleplus">0</span> <i class="icon icon-googleplus notranslate" aria-hidden="true"></i> </a> <a href="https://www.linkedin.com/cws/share?url=https://www.yegor256.com/2017/11/14/static-factory-methods.html" title="Share on LinkedIn" class="button" rel="nofollow"> <span class="count count-linkedin">0</span> <i class="icon icon-linkedin notranslate" aria-hidden="true"></i> </a> <a href="http://reddit.com/submit?url=https://www.yegor256.com/2017/11/14/static-factory-methods.html%3F2017-46&amp;title=Constructors+or+Static+Factory+Methods%3F" title="Share on Reddit" class="button" rel="nofollow"> <span class="count count-reddit">0</span> <i class="icon icon-reddit notranslate" aria-hidden="true"></i> </a> <a href="http://news.ycombinator.com/submitlink?u=https://www.yegor256.com/2017/11/14/static-factory-methods.html%3F2017-46&amp;t=Constructors+or+Static+Factory+Methods%3F" title="Share on Hacker News" class="button" rel="nofollow"> <span class="count count-hackernews">0</span> <i class="icon icon-hackernews notranslate" aria-hidden="true"></i> </a> </nav> </header> <article class="main" itemprop="articleBody"><div ><p>I believe Joshua Bloch said it first in his very good book &quot;<a href="http://amzn.to/2zgpiRI">Effective Java</a>&quot;: static factory methods are the preferred way to instantiate objects compared with constructors. I disagree. Not only because I believe that static methods are pure evil, but mostly because in this particular case they pretend to be good and make us think that we have to love them.</p><figure class='jb_picture'><img itemprop='image' alt='Extract (2009) by Mike Judge' src='/images/2017/11/extract.jpg' longdesc='#81adfef8'/><figcaption id='81adfef8'>Extract (2009) by Mike Judge</figcaption></figure><p>Let&#39;s analyze the reasoning and see why it&#39;s wrong, from an object-oriented point of view.</p><p>This is a class with one primary and two secondary constructors:</p><figure class="highlight"><pre><code class="language-java" data-lang="java"><span></span><span class="kd">class</span> <span class="nc">Color</span> <span class="o">{</span>
  <span class="kd">private</span> <span class="kd">final</span> <span class="kt">int</span> <span class="n">hex</span><span class="o">;</span>
  <span class="n">Color</span><span class="o">(</span><span class="n">String</span> <span class="n">rgb</span><span class="o">)</span> <span class="o">{</span>
    <span class="k">this</span><span class="o">(</span><span class="n">Integer</span><span class="o">.</span><span class="na">parseInt</span><span class="o">(</span><span class="n">rgb</span><span class="o">,</span> <span class="mi">16</span><span class="o">));</span>
  <span class="o">}</span>
  <span class="n">Color</span><span class="o">(</span><span class="kt">int</span> <span class="n">red</span><span class="o">,</span> <span class="kt">int</span> <span class="n">green</span><span class="o">,</span> <span class="kt">int</span> <span class="n">blue</span><span class="o">)</span> <span class="o">{</span>
    <span class="k">this</span><span class="o">(</span><span class="n">red</span> <span class="o">&lt;&lt;</span> <span class="mi">16</span> <span class="o">+</span> <span class="n">green</span> <span class="o">&lt;&lt;</span> <span class="mi">8</span> <span class="o">+</span> <span class="n">blue</span><span class="o">);</span>
  <span class="o">}</span>
  <span class="n">Color</span><span class="o">(</span><span class="kt">int</span> <span class="n">h</span><span class="o">)</span> <span class="o">{</span>
    <span class="k">this</span><span class="o">.</span><span class="na">hex</span> <span class="o">=</span> <span class="n">h</span><span class="o">;</span>
  <span class="o">}</span>
<span class="o">}</span></code></pre></figure><p>This is a similar class with three static factory methods:</p><figure class="highlight"><pre><code class="language-java" data-lang="java"><span></span><span class="kd">class</span> <span class="nc">Color</span> <span class="o">{</span>
  <span class="kd">private</span> <span class="kd">final</span> <span class="kt">int</span> <span class="n">hex</span><span class="o">;</span>
  <span class="kd">static</span> <span class="n">Color</span> <span class="nf">makeFromRGB</span><span class="o">(</span><span class="n">String</span> <span class="n">rgb</span><span class="o">)</span> <span class="o">{</span>
    <span class="k">return</span> <span class="k">new</span> <span class="n">Color</span><span class="o">(</span><span class="n">Integer</span><span class="o">.</span><span class="na">parseInt</span><span class="o">(</span><span class="n">rgb</span><span class="o">,</span> <span class="mi">16</span><span class="o">));</span>
  <span class="o">}</span>
  <span class="kd">static</span> <span class="n">Color</span> <span class="nf">makeFromPalette</span><span class="o">(</span><span class="kt">int</span> <span class="n">red</span><span class="o">,</span> <span class="kt">int</span> <span class="n">green</span><span class="o">,</span> <span class="kt">int</span> <span class="n">blue</span><span class="o">)</span> <span class="o">{</span>
    <span class="k">return</span> <span class="k">new</span> <span class="n">Color</span><span class="o">(</span><span class="n">red</span> <span class="o">&lt;&lt;</span> <span class="mi">16</span> <span class="o">+</span> <span class="n">green</span> <span class="o">&lt;&lt;</span> <span class="mi">8</span> <span class="o">+</span> <span class="n">blue</span><span class="o">);</span>
  <span class="o">}</span>
  <span class="kd">static</span> <span class="n">Color</span> <span class="nf">makeFromHex</span><span class="o">(</span><span class="kt">int</span> <span class="n">h</span><span class="o">)</span> <span class="o">{</span>
    <span class="k">return</span> <span class="k">new</span> <span class="n">Color</span><span class="o">(</span><span class="n">h</span><span class="o">);</span>
  <span class="o">}</span>
  <span class="kd">private</span> <span class="nf">Color</span><span class="o">(</span><span class="kt">int</span> <span class="n">h</span><span class="o">)</span> <span class="o">{</span>
    <span class="k">this</span><span class="o">.</span><span class="na">hex</span> <span class="o">=</span> <span class="n">h</span><span class="o">;</span>
  <span class="o">}</span>
<span class="o">}</span></code></pre></figure><p>Which one do you like better?</p><aside class='quote'>Giving birth to an object through its constructor is the most "sacred" moment in any object-oriented software, don't miss the beauty of it!</aside><p>According to Joshua Bloch, there are three basic advantages to using static factory methods instead of constructors (there are actually four, but the fourth one is not applicable to Java <a href="https://docs.oracle.com/javase/7/docs/technotes/guides/language/type-inference-generic-instance-creation.html">anymore</a>):</p><ul> <li>They have names.</li> <li>They can cache.</li> <li>They can subtype.</li></ul><p>I believe that all three make perfect sense ... if the design is wrong. They are good excuses for workarounds. Let&#39;s take them one by one.</p><h2 id="they-have-names">They Have Names</h2><p>This is how you make a <a href="http://www.rapidtables.com/web/color/red-color.htm">red tomato</a> color object with a constructor:</p><figure class="highlight"><pre><code class="language-java" data-lang="java"><span></span><span class="n">Color</span> <span class="n">tomato</span> <span class="o">=</span> <span class="k">new</span> <span class="n">Color</span><span class="o">(</span><span class="mi">255</span><span class="o">,</span> <span class="mi">99</span><span class="o">,</span> <span class="mi">71</span><span class="o">);</span></code></pre></figure><p>This is how you do it with a static factory method:</p><figure class="highlight"><pre><code class="language-java" data-lang="java"><span></span><span class="n">Color</span> <span class="n">tomato</span> <span class="o">=</span> <span class="n">Color</span><span class="o">.</span><span class="na">makeFromPalette</span><span class="o">(</span><span class="mi">255</span><span class="o">,</span> <span class="mi">99</span><span class="o">,</span> <span class="mi">71</span><span class="o">);</span></code></pre></figure><p>It seems that <code>makeFromPalette()</code> is semantically richer than just <code>new Color()</code>, right? Well, yes. Who knows what those three numbers mean if we just pass them to the constructor. But the word &quot;palette&quot; helps us figure everything out immediately.</p><p>True.</p><p>However, the right solution would be to use polymorphism and encapsulation, to decompose the problem into a few semantically rich classes:</p><figure class="highlight"><pre><code class="language-java" data-lang="java"><span></span><span class="kd">interface</span> <span class="nc">Color</span> <span class="o">{</span>
<span class="o">}</span>
<span class="kd">class</span> <span class="nc">HexColor</span> <span class="kd">implements</span> <span class="n">Color</span> <span class="o">{</span>
  <span class="kd">private</span> <span class="kd">final</span> <span class="kt">int</span> <span class="n">hex</span><span class="o">;</span>
  <span class="n">HexColor</span><span class="o">(</span><span class="kt">int</span> <span class="n">h</span><span class="o">)</span> <span class="o">{</span>
    <span class="k">this</span><span class="o">.</span><span class="na">hex</span> <span class="o">=</span> <span class="n">h</span><span class="o">;</span>
  <span class="o">}</span>
<span class="o">}</span>
<span class="kd">class</span> <span class="nc">RGBColor</span> <span class="kd">implements</span> <span class="n">Color</span> <span class="o">{</span>
  <span class="kd">private</span> <span class="kd">final</span> <span class="n">Color</span> <span class="n">origin</span><span class="o">;</span>
  <span class="n">RGBColor</span><span class="o">(</span><span class="kt">int</span> <span class="n">red</span><span class="o">,</span> <span class="kt">int</span> <span class="n">green</span><span class="o">,</span> <span class="kt">int</span> <span class="n">blue</span><span class="o">)</span> <span class="o">{</span>
    <span class="k">this</span><span class="o">.</span><span class="na">origin</span> <span class="o">=</span> <span class="k">new</span> <span class="n">HexColor</span><span class="o">(</span>
      <span class="n">red</span> <span class="o">&lt;&lt;</span> <span class="mi">16</span> <span class="o">+</span> <span class="n">green</span> <span class="o">&lt;&lt;</span> <span class="mi">8</span> <span class="o">+</span> <span class="n">blue</span>
    <span class="o">);</span>
  <span class="o">}</span>
<span class="o">}</span></code></pre></figure><p>Now, we use the right constructor of the right class:</p><figure class="highlight"><pre><code class="language-java" data-lang="java"><span></span><span class="n">Color</span> <span class="n">tomato</span> <span class="o">=</span> <span class="k">new</span> <span class="n">RGBColor</span><span class="o">(</span><span class="mi">255</span><span class="o">,</span> <span class="mi">99</span><span class="o">,</span> <span class="mi">71</span><span class="o">);</span></code></pre></figure><p>See, Joshua?</p><h2 id="they-can-cache">They Can Cache</h2><p>Let&#39;s say I need a red tomato color in multiple places in the application:</p><figure class="highlight"><pre><code class="language-java" data-lang="java"><span></span><span class="n">Color</span> <span class="n">tomato</span> <span class="o">=</span> <span class="k">new</span> <span class="n">Color</span><span class="o">(</span><span class="mi">255</span><span class="o">,</span> <span class="mi">99</span><span class="o">,</span> <span class="mi">71</span><span class="o">);</span>
<span class="c1">// ... sometime later</span>
<span class="n">Color</span> <span class="n">red</span> <span class="o">=</span> <span class="k">new</span> <span class="n">Color</span><span class="o">(</span><span class="mi">255</span><span class="o">,</span> <span class="mi">99</span><span class="o">,</span> <span class="mi">71</span><span class="o">);</span></code></pre></figure><p>Two objects will be created, which is obviously inefficient, since they are identical. It would be better to keep the first instance somewhere in memory and return it when the second call arrives. Static factory methods make it possible to solve this very problem:</p><figure class="highlight"><pre><code class="language-java" data-lang="java"><span></span><span class="n">Color</span> <span class="n">tomato</span> <span class="o">=</span> <span class="n">Color</span><span class="o">.</span><span class="na">makeFromPalette</span><span class="o">(</span><span class="mi">255</span><span class="o">,</span> <span class="mi">99</span><span class="o">,</span> <span class="mi">71</span><span class="o">);</span>
<span class="c1">// ... sometime later</span>
<span class="n">Color</span> <span class="n">red</span> <span class="o">=</span> <span class="n">Color</span><span class="o">.</span><span class="na">makeFromPalette</span><span class="o">(</span><span class="mi">255</span><span class="o">,</span> <span class="mi">99</span><span class="o">,</span> <span class="mi">71</span><span class="o">);</span></code></pre></figure><p>Then somewhere inside the <code>Color</code> we keep a private static <code>Map</code> with all the objects already instantiated:</p><figure class="highlight"><pre><code class="language-java" data-lang="java"><span></span><span class="kd">class</span> <span class="nc">Color</span> <span class="o">{</span>
  <span class="kd">private</span> <span class="kd">static</span> <span class="kd">final</span> <span class="n">Map</span><span class="o">&lt;</span><span class="n">Integer</span><span class="o">,</span> <span class="n">Color</span><span class="o">&gt;</span> <span class="n">CACHE</span> <span class="o">=</span>
    <span class="k">new</span> <span class="n">HashMap</span><span class="o">&lt;&gt;();</span>
  <span class="kd">private</span> <span class="kd">final</span> <span class="kt">int</span> <span class="n">hex</span><span class="o">;</span>
  <span class="kd">static</span> <span class="n">Color</span> <span class="nf">makeFromPalette</span><span class="o">(</span><span class="kt">int</span> <span class="n">red</span><span class="o">,</span> <span class="kt">int</span> <span class="n">green</span><span class="o">,</span> <span class="kt">int</span> <span class="n">blue</span><span class="o">)</span> <span class="o">{</span>
    <span class="kd">final</span> <span class="kt">int</span> <span class="n">hex</span> <span class="o">=</span> <span class="n">red</span> <span class="o">&lt;&lt;</span> <span class="mi">16</span> <span class="o">+</span> <span class="n">green</span> <span class="o">&lt;&lt;</span> <span class="mi">8</span> <span class="o">+</span> <span class="n">blue</span><span class="o">;</span>
    <span class="k">return</span> <span class="n">Color</span><span class="o">.</span><span class="na">CACHE</span><span class="o">.</span><span class="na">computeIfAbsent</span><span class="o">(</span>
      <span class="n">hex</span><span class="o">,</span> <span class="n">h</span> <span class="o">-&gt;</span> <span class="k">new</span> <span class="n">Color</span><span class="o">(</span><span class="n">h</span><span class="o">)</span>
    <span class="o">);</span>
  <span class="o">}</span>
  <span class="kd">private</span> <span class="nf">Color</span><span class="o">(</span><span class="kt">int</span> <span class="n">h</span><span class="o">)</span> <span class="o">{</span>
    <span class="k">return</span> <span class="k">new</span> <span class="n">Color</span><span class="o">(</span><span class="n">h</span><span class="o">);</span>
  <span class="o">}</span>
<span class="o">}</span></code></pre></figure><p>It is very effective performance-wise. With a small object like our <code>Color</code> the problem may not be so obvious, but when objects are bigger, their instantiation and garbage collection may waste a lot of time.</p><p>True.</p><p>However, there is an object-oriented way to solve this problem. We just introduce a new class <code>Palette</code>, which becomes a store of colors:</p><figure class="highlight"><pre><code class="language-java" data-lang="java"><span></span><span class="kd">class</span> <span class="nc">Palette</span> <span class="o">{</span>
  <span class="kd">private</span> <span class="kd">final</span> <span class="n">Map</span><span class="o">&lt;</span><span class="n">Integer</span><span class="o">,</span> <span class="n">Color</span><span class="o">&gt;</span> <span class="n">colors</span> <span class="o">=</span>
    <span class="k">new</span> <span class="n">HashMap</span><span class="o">&lt;&gt;();</span>
  <span class="n">Color</span> <span class="nf">take</span><span class="o">(</span><span class="kt">int</span> <span class="n">red</span><span class="o">,</span> <span class="kt">int</span> <span class="n">green</span><span class="o">,</span> <span class="kt">int</span> <span class="n">blue</span><span class="o">)</span> <span class="o">{</span>
    <span class="kd">final</span> <span class="kt">int</span> <span class="n">hex</span> <span class="o">=</span> <span class="n">red</span> <span class="o">&lt;&lt;</span> <span class="mi">16</span> <span class="o">+</span> <span class="n">green</span> <span class="o">&lt;&lt;</span> <span class="mi">8</span> <span class="o">+</span> <span class="n">blue</span><span class="o">;</span>
    <span class="k">return</span> <span class="k">this</span><span class="o">.</span><span class="na">computerIfAbsent</span><span class="o">(</span>
      <span class="n">hex</span><span class="o">,</span> <span class="n">h</span> <span class="o">-&gt;</span> <span class="k">new</span> <span class="n">Color</span><span class="o">(</span><span class="n">h</span><span class="o">)</span>
    <span class="o">);</span>
  <span class="o">}</span>
<span class="o">}</span></code></pre></figure><p>Now, we make an instance of <code>Palette</code> once and ask it to return a color to us every time we need it:</p><figure class="highlight"><pre><code class="language-java" data-lang="java"><span></span><span class="n">Color</span> <span class="n">tomato</span> <span class="o">=</span> <span class="n">palette</span><span class="o">.</span><span class="na">take</span><span class="o">(</span><span class="mi">255</span><span class="o">,</span> <span class="mi">99</span><span class="o">,</span> <span class="mi">71</span><span class="o">);</span>
<span class="c1">// Later we will get the same instance:</span>
<span class="n">Color</span> <span class="n">red</span> <span class="o">=</span> <span class="n">palette</span><span class="o">.</span><span class="na">take</span><span class="o">(</span><span class="mi">255</span><span class="o">,</span> <span class="mi">99</span><span class="o">,</span> <span class="mi">71</span><span class="o">);</span></code></pre></figure><p>See, Joshua, no static methods, no static attributes.</p><h2 id="they-can-subtype">They Can Subtype</h2><p>Let&#39;s say our class <code>Color</code> has a method <code>lighter()</code>, which is supposed to shift the color to the next available lighter one:</p><figure class="highlight"><pre><code class="language-java" data-lang="java"><span></span><span class="kd">class</span> <span class="nc">Color</span> <span class="o">{</span>
  <span class="kd">protected</span> <span class="kd">final</span> <span class="kt">int</span> <span class="n">hex</span><span class="o">;</span>
  <span class="n">Color</span><span class="o">(</span><span class="kt">int</span> <span class="n">h</span><span class="o">)</span> <span class="o">{</span>
    <span class="k">this</span><span class="o">.</span><span class="na">hex</span> <span class="o">=</span> <span class="n">h</span><span class="o">;</span>
  <span class="o">}</span>
  <span class="kd">public</span> <span class="n">Color</span> <span class="nf">lighter</span><span class="o">()</span> <span class="o">{</span>
    <span class="k">return</span> <span class="k">new</span> <span class="n">Color</span><span class="o">(</span><span class="n">hex</span> <span class="o">+</span> <span class="mh">0x111</span><span class="o">);</span>
  <span class="o">}</span>
<span class="o">}</span></code></pre></figure><p>However, sometimes it&#39;s more desirable to pick the next lighter color through a set of available <a href="https://en.wikipedia.org/wiki/Pantone">Pantone</a> colors:</p><figure class="highlight"><pre><code class="language-java" data-lang="java"><span></span><span class="kd">class</span> <span class="nc">PantoneColor</span> <span class="kd">extends</span> <span class="n">Color</span> <span class="o">{</span>
  <span class="kd">private</span> <span class="kd">final</span> <span class="n">PantoneName</span> <span class="n">pantone</span><span class="o">;</span>
  <span class="n">PantoneColor</span><span class="o">(</span><span class="n">String</span> <span class="n">name</span><span class="o">)</span> <span class="o">{</span>
    <span class="k">this</span><span class="o">(</span><span class="k">new</span> <span class="n">PantoneName</span><span class="o">(</span><span class="n">name</span><span class="o">));</span>
  <span class="o">}</span>
  <span class="n">PantoneColor</span><span class="o">(</span><span class="n">PantoneName</span> <span class="n">name</span><span class="o">)</span> <span class="o">{</span>
    <span class="k">this</span><span class="o">.</span><span class="na">pantone</span> <span class="o">=</span> <span class="n">name</span><span class="o">;</span>
  <span class="o">}</span>
  <span class="nd">@Override</span>
  <span class="kd">public</span> <span class="n">Color</span> <span class="nf">lighter</span><span class="o">()</span> <span class="o">{</span>
    <span class="k">return</span> <span class="k">new</span> <span class="n">PantoneColor</span><span class="o">(</span><span class="k">this</span><span class="o">.</span><span class="na">pantone</span><span class="o">.</span><span class="na">up</span><span class="o">());</span>
  <span class="o">}</span>
<span class="o">}</span></code></pre></figure><p>Then, we create a static factory method, which will decide which <code>Color</code> implementation is the most suitable for us:</p><figure class="highlight"><pre><code class="language-java" data-lang="java"><span></span><span class="kd">class</span> <span class="nc">Color</span> <span class="o">{</span>
  <span class="kd">private</span> <span class="kd">final</span> <span class="n">String</span> <span class="n">code</span><span class="o">;</span>
  <span class="kd">static</span> <span class="n">Color</span> <span class="nf">make</span><span class="o">(</span><span class="kt">int</span> <span class="n">h</span><span class="o">)</span> <span class="o">{</span>
    <span class="k">if</span> <span class="o">(</span><span class="n">h</span> <span class="o">==</span> <span class="mh">0xBF1932</span><span class="o">)</span> <span class="o">{</span>
      <span class="k">return</span> <span class="k">new</span> <span class="n">PantoneColor</span><span class="o">(</span><span class="s">&quot;19-1664 TPX&quot;</span><span class="o">);</span>
    <span class="o">}</span>
    <span class="k">return</span> <span class="k">new</span> <span class="n">RGBColor</span><span class="o">(</span><span class="n">h</span><span class="o">);</span>
  <span class="o">}</span>
<span class="o">}</span></code></pre></figure><p>If the <a href="https://www.pantone.com/color-finder/19-1664-TPX">true red</a> color is requested, we return an instance of <code>PantoneColor</code>. In all other cases it&#39;s just a standard <code>RGBColor</code>. The decision is made by the static factory method. This is how we will call it:</p><figure class="highlight"><pre><code class="language-java" data-lang="java"><span></span><span class="n">Color</span> <span class="n">color</span> <span class="o">=</span> <span class="n">Color</span><span class="o">.</span><span class="na">make</span><span class="o">(</span><span class="mh">0xBF1932</span><span class="o">);</span></code></pre></figure><p>It would not be possible to do the same &quot;forking&quot; with a constructor, since it can only return the class it is declared in. A static method has all the necessary freedom to return any subtype of <code>Color</code>.</p><p>True.</p><p>However, in an object-oriented world we can and must do it all differently. First, we would make <code>Color</code> an interface:</p><figure class="highlight"><pre><code class="language-java" data-lang="java"><span></span><span class="kd">interface</span> <span class="nc">Color</span> <span class="o">{</span>
  <span class="n">Color</span> <span class="nf">lighter</span><span class="o">();</span>
<span class="o">}</span></code></pre></figure><p>Next, we would move this decision making process to its own class <code>Colors</code>, just like we did in the previous example:</p><figure class="highlight"><pre><code class="language-java" data-lang="java"><span></span><span class="kd">class</span> <span class="nc">Colors</span> <span class="o">{</span>
  <span class="n">Color</span> <span class="nf">make</span><span class="o">(</span><span class="kt">int</span> <span class="n">h</span><span class="o">)</span> <span class="o">{</span>
    <span class="k">if</span> <span class="o">(</span><span class="n">h</span> <span class="o">==</span> <span class="mh">0xBF1932</span><span class="o">)</span> <span class="o">{</span>
      <span class="k">return</span> <span class="k">new</span> <span class="n">PantoneColor</span><span class="o">(</span><span class="s">&quot;19-1664-TPX&quot;</span><span class="o">);</span>
    <span class="o">}</span>
    <span class="k">return</span> <span class="k">new</span> <span class="n">RGBColor</span><span class="o">(</span><span class="n">h</span><span class="o">);</span>
  <span class="o">}</span>
<span class="o">}</span></code></pre></figure><p>And we would use an instance of class <code>Colors</code> instead of a static faсtory method inside <code>Color</code>:</p><figure class="highlight"><pre><code class="language-java" data-lang="java"><span></span><span class="n">colors</span><span class="o">.</span><span class="na">make</span><span class="o">(</span><span class="mh">0xBF1932</span><span class="o">);</span></code></pre></figure> <aside class='youtube'> <a href='https://www.youtube.com/watch?v=9yjtsCK6Wdk'><div class='box'> <img src='https://i.ytimg.com/vi/9yjtsCK6Wdk/mqdefault.jpg' alt='YouTube video #9yjtsCK6Wdk'/><div class='play'><i class='icon icon-play'></i></div></div></a><div>A Few Thoughts About Constructors in OOP (webinar #7); 7 October 2015.</div></aside><p>However, this is still not really an object-oriented way of thinking, because we&#39;re taking the decision-making away from the object it belongs to. Either through a static factory method <code>make()</code> or a new class <code>Colors</code>---it doesn&#39;t really matter how---we tear our objects into two pieces. The first piece is the object itself and the second one is the decision making algorithm that stays somewhere else.</p><p>A much more object-oriented design would be to put the logic into an object of class <code>PantoneColor</code> which would decorate the original <code>RGBColor</code>:</p><figure class="highlight"><pre><code class="language-java" data-lang="java"><span></span><span class="kd">class</span> <span class="nc">PantoneColor</span> <span class="o">{</span>
  <span class="kd">private</span> <span class="kd">final</span> <span class="n">Color</span> <span class="n">origin</span><span class="o">;</span>
  <span class="n">PantoneColor</span><span class="o">(</span><span class="n">Color</span> <span class="n">color</span><span class="o">)</span> <span class="o">{</span>
    <span class="k">this</span><span class="o">.</span><span class="na">origin</span> <span class="o">=</span> <span class="n">color</span><span class="o">;</span>
  <span class="o">}</span>
  <span class="nd">@Override</span>
  <span class="kd">public</span> <span class="n">Color</span> <span class="nf">lighter</span><span class="o">()</span> <span class="o">{</span>
    <span class="kd">final</span> <span class="n">Color</span> <span class="n">next</span><span class="o">;</span>
    <span class="k">if</span> <span class="o">(</span><span class="k">this</span><span class="o">.</span><span class="na">origin</span><span class="o">.</span><span class="na">hex</span><span class="o">()</span> <span class="o">==</span> <span class="mh">0xBF1932</span><span class="o">)</span> <span class="o">{</span>
      <span class="n">next</span> <span class="o">=</span> <span class="k">new</span> <span class="n">RGBColor</span><span class="o">(</span><span class="mh">0xD12631</span><span class="o">);</span>
    <span class="o">}</span> <span class="k">else</span> <span class="o">{</span>
      <span class="n">next</span> <span class="o">=</span> <span class="k">this</span><span class="o">.</span><span class="na">origin</span><span class="o">.</span><span class="na">lighter</span><span class="o">();</span>
    <span class="o">}</span>
    <span class="k">return</span> <span class="k">new</span> <span class="n">PantoneColor</span><span class="o">(</span><span class="n">next</span><span class="o">);</span>
  <span class="o">}</span>
<span class="o">)</span></code></pre></figure><p>Then, we make an instance of <code>RGBColor</code> and decorate it with <code>PantoneColor</code>:</p><figure class="highlight"><pre><code class="language-java" data-lang="java"><span></span><span class="n">Color</span> <span class="n">red</span> <span class="o">=</span> <span class="k">new</span> <span class="n">PantoneColor</span><span class="o">(</span>
  <span class="k">new</span> <span class="n">RGBColor</span><span class="o">(</span><span class="mh">0xBF1932</span><span class="o">)</span>
<span class="o">);</span></code></pre></figure><p>We ask <code>red</code> to return a lighter color and it returns the one from the Pantone palette, not the one that is merely lighter in RGB coordinates:</p><figure class="highlight"><pre><code class="language-java" data-lang="java"><span></span><span class="n">Color</span> <span class="n">lighter</span> <span class="o">=</span> <span class="n">red</span><span class="o">.</span><span class="na">lighter</span><span class="o">();</span> <span class="c1">// 0xD12631</span></code></pre></figure><p>Of course, this example is rather primitive and needs <a href="/2016/12/20/can-objects-be-friends.html">further improvement</a> if we really want it to be applicable to all Pantone colors, but I hope you get the idea. The logic must stay <em>inside</em> the class, not somewhere outside, not in static factory methods or even in some other supplementary class. I&#39;m talking about the logic that belongs to this particular class, of course. If it&#39;s something related to the management of class instances, then there can be containers and stores, just like in the previous example above.</p><p>To summarize, I would strongly recommend you <em>never</em> use static methods, especially when they are going to replace object constructors. Giving birth to an object through its constructor is <a href="/2014/10/03/di-containers-are-evil.html">the most</a> &quot;sacred&quot; moment in any object-oriented software, don&#39;t miss the beauty of it.</p></div></article></div><div class="wrapper"> <related-posts /></div><div class="disqus" role="complementary"><p class="disqus_hint"> Please, use <a href="https://help.disqus.com/commenting/what-html-tags-are-allowed-within-comments">syntax highlighting</a> in your comments, to make them more readable.</p><div id="disqus_thread" class="disqus-thread"> <a>&nbsp;</a></div><script> var disqus_config = function () { this.page.url = document.location.href.split('?')[0].split('#')[0].replace('https://', 'http://'); this.page.identifier = this.page.url; }; (function() { var d = document, s = d.createElement('script'); s.src = '//yegor256.disqus.com/embed.js'; s.setAttribute('data-timestamp', +new Date()); (d.head || d.body).appendChild(s); })(); </script> <noscript><div><p class="red"> JavaScript is disabled in your browser, that's why you can't see comments under this post.</p></div></noscript></div><div class="wrapper"> <footer class="footer"><p> &copy; <span itemscope="" itemprop="copyrightHolder" itemtype="http://schema.org/Person"> <span itemprop="name">Yegor Bugayenko</span> </span> 2014&ndash;<span itemprop="copyrightYear">2018</span></p></footer></div></section><div class="wrapper unprintable" style="text-align:center;margin-top:2em;"> <a href="http://www.sixnines.io/h/3ba1652f"> <img src="//www.sixnines.io/b/3ba1652f?style=flat" alt="sixnines availability badge"/> </a></div><script src="//code.jquery.com/jquery-1.9.0.min.js"></script> <script src="/js/all.js?4e047f6f42b"></script> <script>var disqus_shortname = 'yegor256';</script> <script id="dsq-count-scr" src="//yegor256.disqus.com/count.js" async="async"></script> <script> (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){ (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o), m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m) })(window,document,'script','//www.google-analytics.com/analytics.js','ga'); ga('create', 'UA-1963507-32', 'auto'); ga('send', 'pageview'); </script> <script> Cd=document;Cr="&"+Math.random();Cp="&s=1"; Cd.cookie="b=b";if(Cd.cookie)Cp+="&c=1"; Cp+="&t="+(new Date()).getTimezoneOffset(); if(self!=top)Cp+="&f=1"; </script> <script> if(navigator.javaEnabled())Cp+="&j=1"; </script> <script> if(typeof(screen)!='undefined')Cp+="&w="+screen.width+"&h="+ screen.height+"&d="+(screen.colorDepth?screen.colorDepth:screen.pixelDepth); </script> <script> Cd.write("<img src='//c.hit.ua/hit?i=95870&g=0&x=2"+Cp+Cr+ "&r="+escape(Cd.referrer)+"&u="+escape(window.location.href)+ "' border='0' wi"+"dth='1' he"+"ight='1'/>"); </script> <script type="application/ld+json"> { "@context": "http://schema.org", "@type": "Person", "name": "Yegor Bugayenko", "url": "http://www.yegor256.com", "sameAs": [ "https://www.facebook.com/yegor256", "https://instagram.com/yegor256", "https://www.linkedin.com/in/yegor256", "https://twitter.com/yegor256", "https://github.com/yegor256", "https://www.pinterest.com/yegor256/" ] } </script> </body> </html> <!DOCTYPE html> <html xmlns="http://www.w3.org/1999/xhtml" lang="en-US" xml:lang="en-US" itemscope="" itemtype="http://schema.org/WebSite"> <head> <meta charset="utf-8"/> <meta name="description" content="Even though Java is a great language, it obviously could be better; there are a number of areas where I see room for improvement. " /> <meta name="keywords" content="data classes in java, data structures in java, java data classes, java dto, java getters setters" /> <meta name="viewport" content="width=device-width,minimum-scale=1,initial-scale=1"/> <meta name="google-site-verification" content="JEj_gQr2CPe2QKGw8XdMz0R7VboQIUbX3FlM-lwTq-8" /> <meta name="author" content="Yegor Bugayenko"> <meta name="article:published_time" content="2017-11-07 00:00:00 +0000"> <meta name="og:site_name" content="Yegor Bugayenko"/> <meta name="og:type" content="article" /> <meta name="og:locale" content="en_US" /> <meta name="twitter:account_id" content="4503599630178231" /> <meta name="twitter:creator" content="@yegor256"/> <meta name="twitter:site" content="@yegor256"/> <meta name="twitter:title" property="og:title" content="Five Features to Make Java Even Better"/> <meta name="twitter:description" property="og:description" content="Even though Java is a great language, it obviously could be better; there are a number of areas where I see room for improvement. "/> <meta name="twitter:url" property="og:url" content="https://www.yegor256.com/2017/11/07/five-new-java-features.html"/> <meta name="telegram:channel" content="AAAAAEJFMRzsRTRxM3ec6A"/> <link rel="search" type="application/opensearchdescription+xml" href="/opensearch.xml" title="yegor256" /> <link rel="shortcut icon" href="/favicon.ico?4e047f6f42b"/> <link rel="apple-touch-icon" href="/favicon.ico?4e047f6f42b"/> <link rel="alternate" type="application/rss+xml" title="RSS for yegor256.com" href="https://www.yegor256.com/rss.xml"/> <link rel="stylesheet" href="/css/layout.css?4e047f6f42b"/> <link rel="stylesheet" href="/css/icons.css?4e047f6f42b"/> <link rel="canonical" href="https://www.yegor256.com/2017/11/07/five-new-java-features.html" /> <link rel="amphtml" href="https://www.yegor256.com/2017/11/07/five-new-java-features.amp.html" /> <title>Five Features to Make Java Even Better </title> <meta name='og:image' content='https://www.yegor256.com/images/2017/11/idiocracy.jpg'/><meta name='twitter:image' content='https://www.yegor256.com/images/2017/11/idiocracy.jpg'/><meta name='og:image:width' content='1280'/> <meta name='twitter:image:width' content='1280'/><meta name='og:image:height' content='689'/> <meta name='twitter:image:height' content='689'/><meta name='twitter:card' content='summary_large_image'/><meta name='twitter:image:alt' content='Idiocracy (2006) by Mike Judge'/> </head> <body><div class="wrapper"> <aside class="header-toggle unprintable" id="header-toggle" title="Show the menu" onclick="$('#header').show();$('#header-toggle').hide();">&#9776;</aside> <header class="header" id="header"><div class="face"> <a href="/about-me.html#form" class="sub" title="Click to subscribe to my monthly newsletter"><span>Subscribe</span></a> <a href="/about-me.html" style="position:relative;"> <img src="/images/face-256x256.jpg" class="photo" alt="Yegor Bugayenko"/> </a></div><nav><ul class="menu social notranslate"> <li><a href="https://twitter.com/intent/follow?screen_name=yegor256" rel="nofollow" title="Follow me on Twitter"><i class="icon icon-twitter notranslate" aria-hidden="true"></i></a></li> <li><a href="/rss.xml" rel="nofollow" title="Subscribe to my RSS feed"><i class="icon icon-rss notranslate" aria-hidden="true"></i></a></li> <li><a itemprop="sameAs" href="https://github.com/yegor256" rel="nofollow" title="My GitHub profile"><i class="icon icon-github notranslate" aria-hidden="true"></i></a></li> <li><a itemprop="sameAs" href="http://stackoverflow.com/users/187141/yegor256" rel="nofollow" title="My StackOverflow profile"><i class="icon icon-stackoverflow notranslate" aria-hidden="true"></i></a></li> <li><a itemprop="sameAs" href="https://www.facebook.com/yegor256" rel="nofollow" title="Follow me on Facebook"><i class="icon icon-facebook notranslate" aria-hidden="true"></i></a></li> <li><a itemprop="sameAs" href="https://instagram.com/yegor256" rel="nofollow" title="Follow me on Instagram"><i class="icon icon-instagram notranslate" aria-hidden="true"></i></a></li> <li><a itemprop="sameAs" href="https://www.linkedin.com/in/yegor256" rel="nofollow" title="My LinkedIn profile"><i class="icon icon-linkedin notranslate" aria-hidden="true"></i></a></li> <li><a itemprop="sameAs" href="https://www.youtube.com/c/yegor256?sub_confirmation=1" rel="nofollow" title="My Youtube video channel"><i class="icon icon-youtube notranslate" aria-hidden="true"></i></a></li> <li><a itemprop="sameAs" href="https://www.pinterest.com/yegor256/" rel="nofollow" title="My Pinterest boards"><i class="icon icon-pinterest notranslate" aria-hidden="true"></i></a></li> <li><a itemprop="sameAs" href="https://angel.co/yegor256" rel="nofollow" title="My AngelList profile"><i class="icon icon-angellist notranslate" aria-hidden="true"></i></a></li> <li><a href="https://soundcloud.com/yegor256" rel="nofollow" title="My podcast"><i class="icon icon-podcast notranslate" aria-hidden="true"></i></a></li> <li><a href="https://itunes.apple.com/us/podcast/yegor256-podcast/id1150826721" rel="nofollow" title="My iTunes podcast"><i class="icon icon-itunes notranslate" aria-hidden="true"></i></a></li> <li><a href="https://t.me/joinchat/AAAAAEJFMRzsRTRxM3ec6A" rel="nofollow" title="My Telegram public channel"><i class="icon icon-telegram notranslate" aria-hidden="true"></i></a></li> <li><a href="mailto:blog@yegor256.com" rel="nofollow" title="Email me any time"><i class="icon icon-mail notranslate" aria-hidden="true"></i></a></li></ul><ul class="menu"> <li><a href="/" title="Home page">Home</a></li> <li ><a href="/best.html" title="Best articles to read">12&#160;Best</a></li> <li ><a href="/contents.html" title="The contents of the entire blog">All&#160;288</a></li> <li ><a href="/webinars.html" title="My webinars">Webinars</a></li> <li ><a href="/talks.html" title="Future and past conference talks">Talks</a></li> <li ><a href="/books.html" title="The books I wrote">Books</a></li> <li ><a href="/papers.html" title="My academic papers and patents">Papers</a></li> <li ><a href="/pets.html" title="My loved pet projects">Pets</a></li> <li ><a href="/award.html" title="Software quality award">Award</a></li> <li ><a href="/testimonials.html" title="What some people say about me">Testimonials</a></li> <li ><a href="/shift-m.html" title="Audio podcast about project management">Shift-M</a></li> <li ><a href="/paintings.html" title="My paintings for sale">Paintings</a></li> <li><a href="http://ru.yegor256.com/" title="Немного на русском языке">По-русски</a></li></ul></nav><div class="search"> <form method="get" action="https://www.google.com/search" itemprop="potentialAction" itemscope="" itemtype="http://schema.org/SearchAction"> <meta itemprop="target" content="https://www.google.com/search?q={q}"/> <input name="sitesearch" value="yegor256.com" type="hidden"/> <input itemprop="query-input" type="text" id="search-query" class="field field-text" required="required" onfocus="$('.google').css('visibility', 'visible');" name="q" placeholder="Search..." autocomplete="off"/> <input type="image" src="/images/google-search-icon.svg" class="google" title="Search via Google" alt="Search via Google"/> </form></div><div class="hot"><ul> <li> <a href="/code-ahead.html">Code Ahead</a> was published on Amazon just a few days ago! It is my new book, a novel about programmers. It explains in details the majority of ideas that stand behind <a href="https://www.zerocracy.com">Zerocracy</a> and <a href="https://www.xdsd.org">XDSD</a>. </li> <li> At <a href="/webinars.html">Webinar #37</a> we will discuss naming problem in OOP, for objects, methods and attributes; join us on <b>September 12</b>, at 11am PST. </li></ul></div></header></div><section itemscope="" itemtype="http://schema.org/BlogPosting"><div class="wrapper"> <header><p class="printable"> <img src="https://api.qrserver.com/v1/create-qr-code/?data=https://www.yegor256.com/2017/11/07/five-new-java-features.html&amp;format=svg" style="width:125px;height:125px;" alt="QR code"/></p><p class="printable"> <code itemprop="url">https://www.yegor256.com/2017/11/07/five-new-java-features.html</code></p><h1 itemprop="name headline mainEntityOfPage">Five Features to Make Java Even Better</h1><ul class="subline"> <li> <time itemprop="datePublished" datetime="2017-11-07T00:00:00+00:00"> 7 November 2017 </time> </li> <li class="desktop-only" itemprop="locationCreated">Odessa, Ukraine</li> <li class="printable" itemscope="" itemprop="author" itemtype="http://schema.org/Person"> <span itemprop="name">Yegor Bugayenko</span> </li> <li class="unprintable"> <i class="icon icon-comments"></i> <a href="http://www.yegor256.com/2017/11/07/five-new-java-features.html#disqus_thread" itemprop="discussionUrl">comments</a> </li></ul><ul class="subline"> <li>Discussed at:</li> <li><a href="https://dzone.com/articles/five-features-to-make-java-even-better">dzone</a></li></ul><figure class='jb_picture'><img itemprop='image' alt='Idiocracy (2006) by Mike Judge' src='/images/2017/11/idiocracy.jpg' longdesc='#07fb0c2a'/><figcaption id='07fb0c2a'>Idiocracy (2006) by Mike Judge</figcaption></figure><p><strong>Global Variables</strong>. There are <a href="https://en.wikipedia.org/wiki/Singleton_pattern">Singletons</a> in Java, which, as we all know, are nothing but <a href="https://en.wikipedia.org/wiki/Global_variable">global variables</a>. Wouldn&#39;t it be great to enable global variables in Java and get rid of Singletons. PHP, JavaScript, Ruby and many other languages have them, why doesn&#39;t Java? Look at this code:</p><figure class="highlight"><pre><code class="language-java" data-lang="java"><span></span><span class="kd">class</span> <span class="nc">User</span> <span class="o">{</span>
  <span class="kd">private</span> <span class="kd">static</span> <span class="n">User</span> <span class="n">INSTANCE</span><span class="o">;</span>
  <span class="kd">private</span> <span class="nf">User</span><span class="o">()</span> <span class="o">{}</span>
  <span class="kd">public</span> <span class="kd">static</span> <span class="n">User</span> <span class="nf">getInstance</span><span class="o">()</span> <span class="o">{</span>
    <span class="kd">synchronized</span> <span class="o">(</span><span class="n">User</span><span class="o">.</span><span class="na">INSTANCE</span><span class="o">)</span> <span class="o">{</span>
      <span class="k">if</span> <span class="o">(</span><span class="n">User</span><span class="o">.</span><span class="na">INSTANCE</span> <span class="o">==</span> <span class="kc">null</span><span class="o">)</span> <span class="o">{</span>
        <span class="n">User</span><span class="o">.</span><span class="na">INSTANCE</span> <span class="o">=</span> <span class="k">new</span> <span class="n">User</span><span class="o">();</span>
      <span class="o">}</span>
    <span class="o">}</span>
    <span class="k">return</span> <span class="n">User</span><span class="o">.</span><span class="na">INSTANCE</span><span class="o">;</span>
  <span class="o">}</span>
  <span class="kd">public</span> <span class="n">String</span> <span class="nf">getName</span><span class="o">()</span> <span class="o">{</span>
    <span class="c1">// return user&#39;s name</span>
  <span class="o">}</span>
<span class="o">}</span></code></pre></figure><p>Then, to access it we have to use:</p><figure class="highlight"><pre><code class="language-java" data-lang="java"><span></span><span class="n">String</span> <span class="n">name</span> <span class="o">=</span> <span class="n">User</span><span class="o">.</span><span class="na">getInstance</span><span class="o">().</span><span class="na">getName</span><span class="o">();</span></code></pre></figure><p>This is a Singleton. See how verbose it is? We can simply replace it with a global variable (<code>global</code> is the keyword I&#39;m suggesting we use):</p><figure class="highlight"><pre><code class="language-java" data-lang="java"><span></span><span class="n">global</span> <span class="n">User</span> <span class="n">user</span><span class="o">;</span></code></pre></figure><p>And then:</p><figure class="highlight"><pre><code class="language-java" data-lang="java"><span></span><span class="n">user</span><span class="o">.</span><span class="na">getName</span><span class="o">();</span></code></pre></figure><p>Much less code to write, and way easier to read!</p><h2 id="global-functions-and-namespaces">Global Functions and Namespaces</h2><p>To group static methods together we create <a href="/2014/05/05/oop-alternative-to-utility-classes.html">utility classes</a>, where we have to define private constructors to prevent their instantiation. Also, we have to remember which particular utility class a static method is in. It&#39;s just extra hassle. I&#39;m suggesting we add global functions to Java and optional &quot;namespaces&quot; to group them. Take a look at this utility class:</p><figure class="highlight"><pre><code class="language-java" data-lang="java"><span></span><span class="kd">class</span> <span class="nc">TextUtils</span> <span class="o">{</span>
  <span class="kd">private</span> <span class="nf">TextUtils</span><span class="o">()</span> <span class="o">{}</span>
  <span class="kd">public</span> <span class="kd">static</span> <span class="n">String</span> <span class="nf">trim</span><span class="o">(</span><span class="n">String</span> <span class="n">text</span><span class="o">)</span> <span class="o">{</span>
    <span class="k">if</span> <span class="o">(</span><span class="n">text</span> <span class="o">==</span> <span class="kc">null</span><span class="o">)</span> <span class="o">{</span>
      <span class="k">return</span> <span class="s">&quot;&quot;</span><span class="o">;</span>
    <span class="o">}</span>
    <span class="k">return</span> <span class="n">text</span><span class="o">.</span><span class="na">trim</span><span class="o">();</span>
  <span class="o">}</span>
<span class="o">}</span></code></pre></figure><p>Now look at this global function with a namespace:</p><figure class="highlight"><pre><code class="language-java" data-lang="java"><span></span><span class="n">namespace</span> <span class="n">TextUtils</span> <span class="o">{</span>
  <span class="n">String</span> <span class="nf">trim</span><span class="o">(</span><span class="n">String</span> <span class="n">text</span><span class="o">)</span> <span class="o">{</span>
    <span class="k">if</span> <span class="o">(</span><span class="n">text</span> <span class="o">==</span> <span class="kc">null</span><span class="o">)</span> <span class="o">{</span>
      <span class="k">return</span> <span class="s">&quot;&quot;</span><span class="o">;</span>
    <span class="o">}</span>
    <span class="k">return</span> <span class="n">text</span><span class="o">.</span><span class="na">trim</span><span class="o">();</span>
  <span class="o">}</span>
<span class="o">}</span></code></pre></figure><p>My point is that since we are already using classes as collections of functions, let&#39;s make it more convenient. In some applications we won&#39;t even need namespaces, just global functions, like in C and C++.</p><h2 id="full-access-to-private-attributes-and-methods">Full Access to Private Attributes and Methods</h2><p>In order to access a private attribute or a method of an object from outside we have to use the <a href="https://docs.oracle.com/javase/tutorial/reflect/">Reflection API</a>. It&#39;s not particularly difficult, but it does take a few lines of code, which are not so easy to read and understand:</p><figure class="highlight"><pre><code class="language-java" data-lang="java"><span></span><span class="kd">class</span> <span class="nc">Point</span> <span class="o">{</span>
  <span class="kd">private</span> <span class="kt">int</span> <span class="n">x</span><span class="o">;</span>
  <span class="kd">private</span> <span class="kt">int</span> <span class="n">y</span><span class="o">;</span>
<span class="o">}</span>
<span class="n">Point</span> <span class="n">point</span> <span class="o">=</span> <span class="k">new</span> <span class="n">Point</span><span class="o">();</span>
<span class="n">Field</span> <span class="n">field</span> <span class="o">=</span> <span class="n">point</span><span class="o">.</span><span class="na">getClass</span><span class="o">().</span><span class="na">getDeclaredField</span><span class="o">(</span><span class="s">&quot;x&quot;</span><span class="o">);</span>
<span class="n">field</span><span class="o">.</span><span class="na">setAccessible</span><span class="o">(</span><span class="kc">true</span><span class="o">);</span>
<span class="kt">int</span> <span class="n">x</span> <span class="o">=</span> <span class="o">(</span><span class="kt">int</span><span class="o">)</span> <span class="n">field</span><span class="o">.</span><span class="na">get</span><span class="o">(</span><span class="n">point</span><span class="o">);</span></code></pre></figure><p>I&#39;m suggesting we allow any object to access any of the attributes and methods of another object:</p><figure class="highlight"><pre><code class="language-java" data-lang="java"><span></span><span class="n">Point</span> <span class="n">point</span> <span class="o">=</span> <span class="k">new</span> <span class="n">Point</span><span class="o">();</span>
<span class="kt">int</span> <span class="n">x</span> <span class="o">=</span> <span class="n">point</span><span class="o">.</span><span class="na">x</span><span class="o">;</span></code></pre></figure><p>Of course, if they are private, the compiler will issue a warning. At compile time you simply ignore the warning and move on. If you really care about encapsulation, pay attention to the warning and do something else. But in most cases programmers will ignore it, since they would happily use the Reflection API anyway.</p><h2 id="null-by-default">NULL by Default</h2><p>It would be convenient to let us call constructors and methods with an incomplete set of arguments. The arguments we don&#39;t provide will be set to <code>null</code> by default. Also, when a method has to return something, but there is no <code>return</code> statement, Java should return <code>null</code>. This is almost exactly how it works in PHP, Ruby, and many other languages. I believe it would be a convenient feature for Java <del>monkeys</del> developers too.</p><p>We won&#39;t need to define so many methods when some of the arguments are optional. <a href="https://docs.oracle.com/javase/tutorial/java/javaOO/methods.html">Method overloading</a> is very verbose and difficult to understand. Instead, we should have one method with a long list of arguments. Some of them will be provided by the caller, others will be set to <code>null</code>. The method will decide what to do, for example:</p><figure class="highlight"><pre><code class="language-java" data-lang="java"><span></span><span class="kt">void</span> <span class="nf">save</span><span class="o">(</span><span class="n">File</span> <span class="n">file</span><span class="o">,</span> <span class="n">String</span> <span class="n">encoding</span><span class="o">)</span> <span class="o">{</span>
 <span class="k">if</span> <span class="o">(</span><span class="n">encoding</span> <span class="o">==</span> <span class="kc">null</span><span class="o">)</span> <span class="o">{</span>
   <span class="n">encoding</span> <span class="o">=</span> <span class="s">&quot;UTF-8&quot;</span><span class="o">;</span>
 <span class="o">}</span>
<span class="o">}</span></code></pre></figure><p>Then we just call either <code>save(f)</code> or <code>save(f, &quot;UTF-16&quot;)</code>. The method will understand what we mean. We can also make it even more convenient, like it&#39;s done in Ruby, providing method arguments by names:</p><figure class="highlight"><pre><code class="language-java" data-lang="java"><span></span><span class="n">save</span><span class="o">(</span><span class="n">file</span><span class="o">:</span> <span class="n">f</span><span class="o">,</span> <span class="n">encoding</span><span class="o">:</span> <span class="s">&quot;UTF-16&quot;</span><span class="o">);</span></code></pre></figure><p>Also, when there is nothing to return, the method must return <code>null</code> by default. Writing <code>return null</code> is just a waste of a code line and doesn&#39;t really improve readability. Take a look:</p><figure class="highlight"><pre><code class="language-java" data-lang="java"><span></span><span class="n">String</span> <span class="nf">load</span><span class="o">(</span><span class="n">File</span> <span class="n">file</span><span class="o">)</span> <span class="o">{</span>
 <span class="k">if</span> <span class="o">(</span><span class="n">file</span><span class="o">.</span><span class="na">exists</span><span class="o">())</span> <span class="o">{</span>
   <span class="k">return</span> <span class="n">read_the_content</span><span class="o">();</span>
 <span class="o">}</span>
<span class="o">}</span></code></pre></figure><p>It&#39;s obvious from this code that if the file exists, the method loads and returns its content. If not, it returns <code>null</code>, which will be a good indicator for the caller that something is not right and the content of the file is not available.</p><h2 id="getters-and-setters">Getters and Setters</h2><p>I think it&#39;s only obvious that we need this feature: every private attribute must automatically have <a href="/2014/09/16/getters-and-setters-are-evil.html">a setter and a getter</a>. There should be no need to create them, Java will provide them out-of-the-box, just like <a href="https://kotlinlang.org/docs/reference/properties.html">Kotlin</a> and <a href="http://www.rubyist.net/%7Eslagell/ruby/accessors.html">Ruby</a> do. What is the point of having an attribute if there are no getters and setters to read it and to modify it, right?</p><p>With this new feature we&#39;ll no longer need the help of <a href="https://projectlombok.org/features/GetterSetter">Lombok</a>, or <a href="https://www.jetbrains.com/help/idea/generating-getters-and-setters.html">IntelliJ IDEA</a>.</p><hr/><p>Maybe I should turn my ideas into official proposals to <a href="https://jcp.org/en/participation/committee">JCP</a>. What do you think?</p></p>--> <nav class="buttons notranslate desktop-only"> <a href="http://www.facebook.com/sharer/sharer.php?u=https://www.yegor256.com/2017/11/07/five-new-java-features.html" title="Share on Facebook" class="button" rel="nofollow"> <span class="count count-facebook">0</span> <i class="icon icon-facebook notranslate" aria-hidden="true"></i> </a> <a href="https://twitter.com/share?url=https://www.yegor256.com/2017/11/07/five-new-java-features.html&amp;text=Five+Features+to+Make+Java+Even+Better" title="Share on Twitter" class="button" rel="nofollow"> <span class="count count-twitter">0</span> <i class="icon icon-twitter notranslate" aria-hidden="true"></i> </a> <a href="https://plus.google.com/share?url=https://www.yegor256.com/2017/11/07/five-new-java-features.html" title="Share on Google+" class="button" rel="nofollow"> <span class="count count-googleplus">0</span> <i class="icon icon-googleplus notranslate" aria-hidden="true"></i> </a> <a href="https://www.linkedin.com/cws/share?url=https://www.yegor256.com/2017/11/07/five-new-java-features.html" title="Share on LinkedIn" class="button" rel="nofollow"> <span class="count count-linkedin">0</span> <i class="icon icon-linkedin notranslate" aria-hidden="true"></i> </a> <a href="http://reddit.com/submit?url=https://www.yegor256.com/2017/11/07/five-new-java-features.html%3F2017-45&amp;title=Five+Features+to+Make+Java+Even+Better" title="Share on Reddit" class="button" rel="nofollow"> <span class="count count-reddit">0</span> <i class="icon icon-reddit notranslate" aria-hidden="true"></i> </a> <a href="http://news.ycombinator.com/submitlink?u=https://www.yegor256.com/2017/11/07/five-new-java-features.html%3F2017-45&amp;t=Five+Features+to+Make+Java+Even+Better" title="Share on Hacker News" class="button" rel="nofollow"> <span class="count count-hackernews">0</span> <i class="icon icon-hackernews notranslate" aria-hidden="true"></i> </a> </nav> </header> <article class="main" itemprop="articleBody"><div ><p>I stumbled upon <a href="http://cr.openjdk.java.net/%7Ebriangoetz/amber/datum.html">this proposal</a> by <a href="https://twitter.com/BrianGoetz">Brian Goetz</a> for data classes in Java, and immediately realized that I too have a few ideas about how to make Java better as a language. I actually have many of them, but this is a short list of the five most important.</p><figure class='jb_picture'><img itemprop='image' alt='Idiocracy (2006) by Mike Judge' src='/images/2017/11/idiocracy.jpg' longdesc='#07fb0c2a'/><figcaption id='07fb0c2a'>Idiocracy (2006) by Mike Judge</figcaption></figure><p><strong>Global Variables</strong>. There are <a href="https://en.wikipedia.org/wiki/Singleton_pattern">Singletons</a> in Java, which, as we all know, are nothing but <a href="https://en.wikipedia.org/wiki/Global_variable">global variables</a>. Wouldn&#39;t it be great to enable global variables in Java and get rid of Singletons. PHP, JavaScript, Ruby and many other languages have them, why doesn&#39;t Java? Look at this code:</p><figure class="highlight"><pre><code class="language-java" data-lang="java"><span></span><span class="kd">class</span> <span class="nc">User</span> <span class="o">{</span>
  <span class="kd">private</span> <span class="kd">static</span> <span class="n">User</span> <span class="n">INSTANCE</span><span class="o">;</span>
  <span class="kd">private</span> <span class="nf">User</span><span class="o">()</span> <span class="o">{}</span>
  <span class="kd">public</span> <span class="kd">static</span> <span class="n">User</span> <span class="nf">getInstance</span><span class="o">()</span> <span class="o">{</span>
    <span class="kd">synchronized</span> <span class="o">(</span><span class="n">User</span><span class="o">.</span><span class="na">INSTANCE</span><span class="o">)</span> <span class="o">{</span>
      <span class="k">if</span> <span class="o">(</span><span class="n">User</span><span class="o">.</span><span class="na">INSTANCE</span> <span class="o">==</span> <span class="kc">null</span><span class="o">)</span> <span class="o">{</span>
        <span class="n">User</span><span class="o">.</span><span class="na">INSTANCE</span> <span class="o">=</span> <span class="k">new</span> <span class="n">User</span><span class="o">();</span>
      <span class="o">}</span>
    <span class="o">}</span>
    <span class="k">return</span> <span class="n">User</span><span class="o">.</span><span class="na">INSTANCE</span><span class="o">;</span>
  <span class="o">}</span>
  <span class="kd">public</span> <span class="n">String</span> <span class="nf">getName</span><span class="o">()</span> <span class="o">{</span>
    <span class="c1">// return user&#39;s name</span>
  <span class="o">}</span>
<span class="o">}</span></code></pre></figure><p>Then, to access it we have to use:</p><figure class="highlight"><pre><code class="language-java" data-lang="java"><span></span><span class="n">String</span> <span class="n">name</span> <span class="o">=</span> <span class="n">User</span><span class="o">.</span><span class="na">getInstance</span><span class="o">().</span><span class="na">getName</span><span class="o">();</span></code></pre></figure><p>This is a Singleton. See how verbose it is? We can simply replace it with a global variable (<code>global</code> is the keyword I&#39;m suggesting we use):</p><figure class="highlight"><pre><code class="language-java" data-lang="java"><span></span><span class="n">global</span> <span class="n">User</span> <span class="n">user</span><span class="o">;</span></code></pre></figure><p>And then:</p><figure class="highlight"><pre><code class="language-java" data-lang="java"><span></span><span class="n">user</span><span class="o">.</span><span class="na">getName</span><span class="o">();</span></code></pre></figure><p>Much less code to write, and way easier to read!</p><h2 id="global-functions-and-namespaces">Global Functions and Namespaces</h2><p>To group static methods together we create <a href="/2014/05/05/oop-alternative-to-utility-classes.html">utility classes</a>, where we have to define private constructors to prevent their instantiation. Also, we have to remember which particular utility class a static method is in. It&#39;s just extra hassle. I&#39;m suggesting we add global functions to Java and optional &quot;namespaces&quot; to group them. Take a look at this utility class:</p><figure class="highlight"><pre><code class="language-java" data-lang="java"><span></span><span class="kd">class</span> <span class="nc">TextUtils</span> <span class="o">{</span>
  <span class="kd">private</span> <span class="nf">TextUtils</span><span class="o">()</span> <span class="o">{}</span>
  <span class="kd">public</span> <span class="kd">static</span> <span class="n">String</span> <span class="nf">trim</span><span class="o">(</span><span class="n">String</span> <span class="n">text</span><span class="o">)</span> <span class="o">{</span>
    <span class="k">if</span> <span class="o">(</span><span class="n">text</span> <span class="o">==</span> <span class="kc">null</span><span class="o">)</span> <span class="o">{</span>
      <span class="k">return</span> <span class="s">&quot;&quot;</span><span class="o">;</span>
    <span class="o">}</span>
    <span class="k">return</span> <span class="n">text</span><span class="o">.</span><span class="na">trim</span><span class="o">();</span>
  <span class="o">}</span>
<span class="o">}</span></code></pre></figure><p>Now look at this global function with a namespace:</p><figure class="highlight"><pre><code class="language-java" data-lang="java"><span></span><span class="n">namespace</span> <span class="n">TextUtils</span> <span class="o">{</span>
  <span class="n">String</span> <span class="nf">trim</span><span class="o">(</span><span class="n">String</span> <span class="n">text</span><span class="o">)</span> <span class="o">{</span>
    <span class="k">if</span> <span class="o">(</span><span class="n">text</span> <span class="o">==</span> <span class="kc">null</span><span class="o">)</span> <span class="o">{</span>
      <span class="k">return</span> <span class="s">&quot;&quot;</span><span class="o">;</span>
    <span class="o">}</span>
    <span class="k">return</span> <span class="n">text</span><span class="o">.</span><span class="na">trim</span><span class="o">();</span>
  <span class="o">}</span>
<span class="o">}</span></code></pre></figure><p>My point is that since we are already using classes as collections of functions, let&#39;s make it more convenient. In some applications we won&#39;t even need namespaces, just global functions, like in C and C++.</p><h2 id="full-access-to-private-attributes-and-methods">Full Access to Private Attributes and Methods</h2><p>In order to access a private attribute or a method of an object from outside we have to use the <a href="https://docs.oracle.com/javase/tutorial/reflect/">Reflection API</a>. It&#39;s not particularly difficult, but it does take a few lines of code, which are not so easy to read and understand:</p><figure class="highlight"><pre><code class="language-java" data-lang="java"><span></span><span class="kd">class</span> <span class="nc">Point</span> <span class="o">{</span>
  <span class="kd">private</span> <span class="kt">int</span> <span class="n">x</span><span class="o">;</span>
  <span class="kd">private</span> <span class="kt">int</span> <span class="n">y</span><span class="o">;</span>
<span class="o">}</span>
<span class="n">Point</span> <span class="n">point</span> <span class="o">=</span> <span class="k">new</span> <span class="n">Point</span><span class="o">();</span>
<span class="n">Field</span> <span class="n">field</span> <span class="o">=</span> <span class="n">point</span><span class="o">.</span><span class="na">getClass</span><span class="o">().</span><span class="na">getDeclaredField</span><span class="o">(</span><span class="s">&quot;x&quot;</span><span class="o">);</span>
<span class="n">field</span><span class="o">.</span><span class="na">setAccessible</span><span class="o">(</span><span class="kc">true</span><span class="o">);</span>
<span class="kt">int</span> <span class="n">x</span> <span class="o">=</span> <span class="o">(</span><span class="kt">int</span><span class="o">)</span> <span class="n">field</span><span class="o">.</span><span class="na">get</span><span class="o">(</span><span class="n">point</span><span class="o">);</span></code></pre></figure><p>I&#39;m suggesting we allow any object to access any of the attributes and methods of another object:</p><figure class="highlight"><pre><code class="language-java" data-lang="java"><span></span><span class="n">Point</span> <span class="n">point</span> <span class="o">=</span> <span class="k">new</span> <span class="n">Point</span><span class="o">();</span>
<span class="kt">int</span> <span class="n">x</span> <span class="o">=</span> <span class="n">point</span><span class="o">.</span><span class="na">x</span><span class="o">;</span></code></pre></figure><p>Of course, if they are private, the compiler will issue a warning. At compile time you simply ignore the warning and move on. If you really care about encapsulation, pay attention to the warning and do something else. But in most cases programmers will ignore it, since they would happily use the Reflection API anyway.</p><h2 id="null-by-default">NULL by Default</h2><p>It would be convenient to let us call constructors and methods with an incomplete set of arguments. The arguments we don&#39;t provide will be set to <code>null</code> by default. Also, when a method has to return something, but there is no <code>return</code> statement, Java should return <code>null</code>. This is almost exactly how it works in PHP, Ruby, and many other languages. I believe it would be a convenient feature for Java <del>monkeys</del> developers too.</p><p>We won&#39;t need to define so many methods when some of the arguments are optional. <a href="https://docs.oracle.com/javase/tutorial/java/javaOO/methods.html">Method overloading</a> is very verbose and difficult to understand. Instead, we should have one method with a long list of arguments. Some of them will be provided by the caller, others will be set to <code>null</code>. The method will decide what to do, for example:</p><figure class="highlight"><pre><code class="language-java" data-lang="java"><span></span><span class="kt">void</span> <span class="nf">save</span><span class="o">(</span><span class="n">File</span> <span class="n">file</span><span class="o">,</span> <span class="n">String</span> <span class="n">encoding</span><span class="o">)</span> <span class="o">{</span>
 <span class="k">if</span> <span class="o">(</span><span class="n">encoding</span> <span class="o">==</span> <span class="kc">null</span><span class="o">)</span> <span class="o">{</span>
   <span class="n">encoding</span> <span class="o">=</span> <span class="s">&quot;UTF-8&quot;</span><span class="o">;</span>
 <span class="o">}</span>
<span class="o">}</span></code></pre></figure><p>Then we just call either <code>save(f)</code> or <code>save(f, &quot;UTF-16&quot;)</code>. The method will understand what we mean. We can also make it even more convenient, like it&#39;s done in Ruby, providing method arguments by names:</p><figure class="highlight"><pre><code class="language-java" data-lang="java"><span></span><span class="n">save</span><span class="o">(</span><span class="n">file</span><span class="o">:</span> <span class="n">f</span><span class="o">,</span> <span class="n">encoding</span><span class="o">:</span> <span class="s">&quot;UTF-16&quot;</span><span class="o">);</span></code></pre></figure><p>Also, when there is nothing to return, the method must return <code>null</code> by default. Writing <code>return null</code> is just a waste of a code line and doesn&#39;t really improve readability. Take a look:</p><figure class="highlight"><pre><code class="language-java" data-lang="java"><span></span><span class="n">String</span> <span class="nf">load</span><span class="o">(</span><span class="n">File</span> <span class="n">file</span><span class="o">)</span> <span class="o">{</span>
 <span class="k">if</span> <span class="o">(</span><span class="n">file</span><span class="o">.</span><span class="na">exists</span><span class="o">())</span> <span class="o">{</span>
   <span class="k">return</span> <span class="n">read_the_content</span><span class="o">();</span>
 <span class="o">}</span>
<span class="o">}</span></code></pre></figure><p>It&#39;s obvious from this code that if the file exists, the method loads and returns its content. If not, it returns <code>null</code>, which will be a good indicator for the caller that something is not right and the content of the file is not available.</p><h2 id="getters-and-setters">Getters and Setters</h2><p>I think it&#39;s only obvious that we need this feature: every private attribute must automatically have <a href="/2014/09/16/getters-and-setters-are-evil.html">a setter and a getter</a>. There should be no need to create them, Java will provide them out-of-the-box, just like <a href="https://kotlinlang.org/docs/reference/properties.html">Kotlin</a> and <a href="http://www.rubyist.net/%7Eslagell/ruby/accessors.html">Ruby</a> do. What is the point of having an attribute if there are no getters and setters to read it and to modify it, right?</p><p>With this new feature we&#39;ll no longer need the help of <a href="https://projectlombok.org/features/GetterSetter">Lombok</a>, or <a href="https://www.jetbrains.com/help/idea/generating-getters-and-setters.html">IntelliJ IDEA</a>.</p><hr/><p>Maybe I should turn my ideas into official proposals to <a href="https://jcp.org/en/participation/committee">JCP</a>. What do you think?</p></div></article></div><div class="wrapper"> <related-posts /></div><div class="disqus" role="complementary"><p class="disqus_hint"> Please, use <a href="https://help.disqus.com/commenting/what-html-tags-are-allowed-within-comments">syntax highlighting</a> in your comments, to make them more readable.</p><div id="disqus_thread" class="disqus-thread"> <a>&nbsp;</a></div><script> var disqus_config = function () { this.page.url = document.location.href.split('?')[0].split('#')[0].replace('https://', 'http://'); this.page.identifier = this.page.url; }; (function() { var d = document, s = d.createElement('script'); s.src = '//yegor256.disqus.com/embed.js'; s.setAttribute('data-timestamp', +new Date()); (d.head || d.body).appendChild(s); })(); </script> <noscript><div><p class="red"> JavaScript is disabled in your browser, that's why you can't see comments under this post.</p></div></noscript></div><div class="wrapper"> <footer class="footer"><p> &copy; <span itemscope="" itemprop="copyrightHolder" itemtype="http://schema.org/Person"> <span itemprop="name">Yegor Bugayenko</span> </span> 2014&ndash;<span itemprop="copyrightYear">2018</span></p></footer></div></section><div class="wrapper unprintable" style="text-align:center;margin-top:2em;"> <a href="http://www.sixnines.io/h/3ba1652f"> <img src="//www.sixnines.io/b/3ba1652f?style=flat" alt="sixnines availability badge"/> </a></div><script src="//code.jquery.com/jquery-1.9.0.min.js"></script> <script src="/js/all.js?4e047f6f42b"></script> <script>var disqus_shortname = 'yegor256';</script> <script id="dsq-count-scr" src="//yegor256.disqus.com/count.js" async="async"></script> <script> (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){ (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o), m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m) })(window,document,'script','//www.google-analytics.com/analytics.js','ga'); ga('create', 'UA-1963507-32', 'auto'); ga('send', 'pageview'); </script> <script> Cd=document;Cr="&"+Math.random();Cp="&s=1"; Cd.cookie="b=b";if(Cd.cookie)Cp+="&c=1"; Cp+="&t="+(new Date()).getTimezoneOffset(); if(self!=top)Cp+="&f=1"; </script> <script> if(navigator.javaEnabled())Cp+="&j=1"; </script> <script> if(typeof(screen)!='undefined')Cp+="&w="+screen.width+"&h="+ screen.height+"&d="+(screen.colorDepth?screen.colorDepth:screen.pixelDepth); </script> <script> Cd.write("<img src='//c.hit.ua/hit?i=95870&g=0&x=2"+Cp+Cr+ "&r="+escape(Cd.referrer)+"&u="+escape(window.location.href)+ "' border='0' wi"+"dth='1' he"+"ight='1'/>"); </script> <script type="application/ld+json"> { "@context": "http://schema.org", "@type": "Person", "name": "Yegor Bugayenko", "url": "http://www.yegor256.com", "sameAs": [ "https://www.facebook.com/yegor256", "https://instagram.com/yegor256", "https://www.linkedin.com/in/yegor256", "https://twitter.com/yegor256", "https://github.com/yegor256", "https://www.pinterest.com/yegor256/" ] } </script> </body> </html> <!DOCTYPE html> <html xmlns="http://www.w3.org/1999/xhtml" lang="en-US" xml:lang="en-US" itemscope="" itemtype="http://schema.org/WebSite"> <head> <meta charset="utf-8"/> <meta name="description" content="Lazy loading is a popular technique in OOP, which is usually done through NULL references; Cactoos offers a better way, with the help of a few Java primitives. " /> <meta name="keywords" content="cactoos, java cache, java cache in memory, java cactoos, java lazy loading" /> <meta name="viewport" content="width=device-width,minimum-scale=1,initial-scale=1"/> <meta name="google-site-verification" content="JEj_gQr2CPe2QKGw8XdMz0R7VboQIUbX3FlM-lwTq-8" /> <meta name="author" content="Yegor Bugayenko"> <meta name="article:published_time" content="2017-10-17 00:00:00 +0000"> <meta name="og:site_name" content="Yegor Bugayenko"/> <meta name="og:type" content="article" /> <meta name="og:locale" content="en_US" /> <meta name="twitter:account_id" content="4503599630178231" /> <meta name="twitter:creator" content="@yegor256"/> <meta name="twitter:site" content="@yegor256"/> <meta name="twitter:title" property="og:title" content="Lazy Loading and Caching via Sticky Cactoos Primitives"/> <meta name="twitter:description" property="og:description" content="Lazy loading is a popular technique in OOP, which is usually done through NULL references; Cactoos offers a better way, with the help of a few Java primitives. "/> <meta name="twitter:url" property="og:url" content="https://www.yegor256.com/2017/10/17/lazy-loading-caching-sticky-cactoos.html"/> <meta name="telegram:channel" content="AAAAAEJFMRzsRTRxM3ec6A"/> <link rel="search" type="application/opensearchdescription+xml" href="/opensearch.xml" title="yegor256" /> <link rel="shortcut icon" href="/favicon.ico?4e047f6f42b"/> <link rel="apple-touch-icon" href="/favicon.ico?4e047f6f42b"/> <link rel="alternate" type="application/rss+xml" title="RSS for yegor256.com" href="https://www.yegor256.com/rss.xml"/> <link rel="stylesheet" href="/css/layout.css?4e047f6f42b"/> <link rel="stylesheet" href="/css/icons.css?4e047f6f42b"/> <link rel="canonical" href="https://www.yegor256.com/2017/10/17/lazy-loading-caching-sticky-cactoos.html" /> <link rel="amphtml" href="https://www.yegor256.com/2017/10/17/lazy-loading-caching-sticky-cactoos.amp.html" /> <title>Lazy Loading and Caching via Sticky Cactoos Primitives </title> <meta name='og:image' content='https://www.yegor256.com/images/2017/10/reality.jpg'/><meta name='twitter:image' content='https://www.yegor256.com/images/2017/10/reality.jpg'/><meta name='og:image:width' content='1828'/> <meta name='twitter:image:width' content='1828'/><meta name='og:image:height' content='778'/> <meta name='twitter:image:height' content='778'/><meta name='twitter:card' content='summary_large_image'/><meta name='twitter:image:alt' content='Reality (2012) by Matteo Garrone'/> </head> <body><div class="wrapper"> <aside class="header-toggle unprintable" id="header-toggle" title="Show the menu" onclick="$('#header').show();$('#header-toggle').hide();">&#9776;</aside> <header class="header" id="header"><div class="face"> <a href="/about-me.html#form" class="sub" title="Click to subscribe to my monthly newsletter"><span>Subscribe</span></a> <a href="/about-me.html" style="position:relative;"> <img src="/images/face-256x256.jpg" class="photo" alt="Yegor Bugayenko"/> </a></div><nav><ul class="menu social notranslate"> <li><a href="https://twitter.com/intent/follow?screen_name=yegor256" rel="nofollow" title="Follow me on Twitter"><i class="icon icon-twitter notranslate" aria-hidden="true"></i></a></li> <li><a href="/rss.xml" rel="nofollow" title="Subscribe to my RSS feed"><i class="icon icon-rss notranslate" aria-hidden="true"></i></a></li> <li><a itemprop="sameAs" href="https://github.com/yegor256" rel="nofollow" title="My GitHub profile"><i class="icon icon-github notranslate" aria-hidden="true"></i></a></li> <li><a itemprop="sameAs" href="http://stackoverflow.com/users/187141/yegor256" rel="nofollow" title="My StackOverflow profile"><i class="icon icon-stackoverflow notranslate" aria-hidden="true"></i></a></li> <li><a itemprop="sameAs" href="https://www.facebook.com/yegor256" rel="nofollow" title="Follow me on Facebook"><i class="icon icon-facebook notranslate" aria-hidden="true"></i></a></li> <li><a itemprop="sameAs" href="https://instagram.com/yegor256" rel="nofollow" title="Follow me on Instagram"><i class="icon icon-instagram notranslate" aria-hidden="true"></i></a></li> <li><a itemprop="sameAs" href="https://www.linkedin.com/in/yegor256" rel="nofollow" title="My LinkedIn profile"><i class="icon icon-linkedin notranslate" aria-hidden="true"></i></a></li> <li><a itemprop="sameAs" href="https://www.youtube.com/c/yegor256?sub_confirmation=1" rel="nofollow" title="My Youtube video channel"><i class="icon icon-youtube notranslate" aria-hidden="true"></i></a></li> <li><a itemprop="sameAs" href="https://www.pinterest.com/yegor256/" rel="nofollow" title="My Pinterest boards"><i class="icon icon-pinterest notranslate" aria-hidden="true"></i></a></li> <li><a itemprop="sameAs" href="https://angel.co/yegor256" rel="nofollow" title="My AngelList profile"><i class="icon icon-angellist notranslate" aria-hidden="true"></i></a></li> <li><a href="https://soundcloud.com/yegor256" rel="nofollow" title="My podcast"><i class="icon icon-podcast notranslate" aria-hidden="true"></i></a></li> <li><a href="https://itunes.apple.com/us/podcast/yegor256-podcast/id1150826721" rel="nofollow" title="My iTunes podcast"><i class="icon icon-itunes notranslate" aria-hidden="true"></i></a></li> <li><a href="https://t.me/joinchat/AAAAAEJFMRzsRTRxM3ec6A" rel="nofollow" title="My Telegram public channel"><i class="icon icon-telegram notranslate" aria-hidden="true"></i></a></li> <li><a href="mailto:blog@yegor256.com" rel="nofollow" title="Email me any time"><i class="icon icon-mail notranslate" aria-hidden="true"></i></a></li></ul><ul class="menu"> <li><a href="/" title="Home page">Home</a></li> <li ><a href="/best.html" title="Best articles to read">12&#160;Best</a></li> <li ><a href="/contents.html" title="The contents of the entire blog">All&#160;288</a></li> <li ><a href="/webinars.html" title="My webinars">Webinars</a></li> <li ><a href="/talks.html" title="Future and past conference talks">Talks</a></li> <li ><a href="/books.html" title="The books I wrote">Books</a></li> <li ><a href="/papers.html" title="My academic papers and patents">Papers</a></li> <li ><a href="/pets.html" title="My loved pet projects">Pets</a></li> <li ><a href="/award.html" title="Software quality award">Award</a></li> <li ><a href="/testimonials.html" title="What some people say about me">Testimonials</a></li> <li ><a href="/shift-m.html" title="Audio podcast about project management">Shift-M</a></li> <li ><a href="/paintings.html" title="My paintings for sale">Paintings</a></li> <li><a href="http://ru.yegor256.com/" title="Немного на русском языке">По-русски</a></li></ul></nav><div class="search"> <form method="get" action="https://www.google.com/search" itemprop="potentialAction" itemscope="" itemtype="http://schema.org/SearchAction"> <meta itemprop="target" content="https://www.google.com/search?q={q}"/> <input name="sitesearch" value="yegor256.com" type="hidden"/> <input itemprop="query-input" type="text" id="search-query" class="field field-text" required="required" onfocus="$('.google').css('visibility', 'visible');" name="q" placeholder="Search..." autocomplete="off"/> <input type="image" src="/images/google-search-icon.svg" class="google" title="Search via Google" alt="Search via Google"/> </form></div><div class="hot"><ul> <li> <a href="/code-ahead.html">Code Ahead</a> was published on Amazon just a few days ago! It is my new book, a novel about programmers. It explains in details the majority of ideas that stand behind <a href="https://www.zerocracy.com">Zerocracy</a> and <a href="https://www.xdsd.org">XDSD</a>. </li> <li> At <a href="/webinars.html">Webinar #37</a> we will discuss naming problem in OOP, for objects, methods and attributes; join us on <b>September 12</b>, at 11am PST. </li></ul></div></header></div><section itemscope="" itemtype="http://schema.org/BlogPosting"><div class="wrapper"> <header><p class="printable"> <img src="https://api.qrserver.com/v1/create-qr-code/?data=https://www.yegor256.com/2017/10/17/lazy-loading-caching-sticky-cactoos.html&amp;format=svg" style="width:125px;height:125px;" alt="QR code"/></p><p class="printable"> <code itemprop="url">https://www.yegor256.com/2017/10/17/lazy-loading-caching-sticky-cactoos.html</code></p><h1 itemprop="name headline mainEntityOfPage">Lazy Loading and Caching via Sticky Cactoos Primitives</h1><ul class="subline"> <li> <time itemprop="datePublished" datetime="2017-10-17T00:00:00+00:00"> 17 October 2017 </time> </li> <li class="desktop-only" itemprop="locationCreated">Odessa, Ukraine</li> <li class="printable" itemscope="" itemprop="author" itemtype="http://schema.org/Person"> <span itemprop="name">Yegor Bugayenko</span> </li> <li class="unprintable"> <i class="icon icon-comments"></i> <a href="http://www.yegor256.com/2017/10/17/lazy-loading-caching-sticky-cactoos.html#disqus_thread" itemprop="discussionUrl">comments</a> </li></ul><figure class='jb_picture'><img itemprop='image' alt='Reality (2012) by Matteo Garrone' src='/images/2017/10/reality.jpg' longdesc='#e68b1cc6'/><figcaption id='e68b1cc6'>Reality (2012) by Matteo Garrone</figcaption></figure><p>Let&#39;s say we need an object that will encrypt some text. Speaking in a more object-oriented way, it will encapsulate the text and <em>become</em> its encrypted form. Here is how we will use it (let&#39;s create <a href="/2017/03/24/tdd-that-works.html">tests first</a>):</p><figure class="highlight"><pre><code class="language-java" data-lang="java"><span></span><span class="kd">interface</span> <span class="nc">Encrypted</span> <span class="o">{</span>
  <span class="n">String</span> <span class="nf">asString</span><span class="o">()</span> <span class="kd">throws</span> <span class="n">IOException</span><span class="o">;</span>
<span class="o">}</span>
<span class="n">Encrypted</span> <span class="n">enc</span> <span class="o">=</span> <span class="k">new</span> <span class="n">EncryptedX</span><span class="o">(</span><span class="s">&quot;Hello, world!&quot;</span><span class="o">);</span>
<span class="n">System</span><span class="o">.</span><span class="na">out</span><span class="o">.</span><span class="na">println</span><span class="o">(</span><span class="n">enc</span><span class="o">.</span><span class="na">asString</span><span class="o">());</span></code></pre></figure><p>Now let&#39;s implement it, in a very primitive way, with one <a href="/2015/05/28/one-primary-constructor.html">primary</a> constructor. The encryption mechanism will just add <code>+1</code> to each byte in the incoming data, and will assume that the encryption won&#39;t break anything (a very stupid assumption, but for the sake of this example it will work):</p><figure class="highlight"><pre><code class="language-java" data-lang="java"><span></span><span class="kd">class</span> <span class="nc">Encrypted1</span> <span class="kd">implements</span> <span class="n">Encrypted</span> <span class="o">{</span>
  <span class="kd">private</span> <span class="kd">final</span> <span class="n">String</span> <span class="n">text</span><span class="o">;</span>
  <span class="n">Encrypted1</span><span class="o">(</span><span class="n">String</span> <span class="n">txt</span><span class="o">)</span> <span class="o">{</span>
    <span class="k">this</span><span class="o">.</span><span class="na">text</span> <span class="o">=</span> <span class="n">txt</span><span class="o">;</span>
  <span class="o">}</span>
  <span class="nd">@Override</span>
  <span class="kd">public</span> <span class="n">String</span> <span class="nf">asString</span><span class="o">()</span> <span class="o">{</span>
    <span class="kd">final</span> <span class="kt">byte</span><span class="o">[]</span> <span class="n">in</span> <span class="o">=</span> <span class="k">this</span><span class="o">.</span><span class="na">text</span><span class="o">.</span><span class="na">getBytes</span><span class="o">();</span>
    <span class="kd">final</span> <span class="kt">byte</span><span class="o">[]</span> <span class="n">out</span> <span class="o">=</span> <span class="k">new</span> <span class="kt">byte</span><span class="o">[</span><span class="n">in</span><span class="o">.</span><span class="na">length</span><span class="o">];</span>
    <span class="k">for</span> <span class="o">(</span><span class="kt">int</span> <span class="n">i</span> <span class="o">=</span> <span class="mi">0</span><span class="o">;</span> <span class="n">i</span> <span class="o">&lt;</span> <span class="n">in</span><span class="o">.</span><span class="na">length</span><span class="o">;</span> <span class="o">++</span><span class="n">i</span><span class="o">)</span> <span class="o">{</span>
      <span class="n">out</span><span class="o">[</span><span class="n">i</span><span class="o">]</span> <span class="o">=</span> <span class="o">(</span><span class="kt">byte</span><span class="o">)</span> <span class="o">(</span><span class="n">in</span><span class="o">[</span><span class="n">i</span><span class="o">]</span> <span class="o">+</span> <span class="mi">1</span><span class="o">);</span>
    <span class="o">}</span>
    <span class="k">return</span> <span class="k">new</span> <span class="n">String</span><span class="o">(</span><span class="n">out</span><span class="o">);</span>
  <span class="o">}</span>
<span class="o">}</span></code></pre></figure><p>Looks correct so far? I <a href="https://github.com/yegor256/blog/tree/master/_samples/2017/10/sticky">tested it</a> and it works. If the input is <code>&quot;Hello, world!&quot;</code>, the output will be <code>&quot;Ifmmp-!xpsme\&quot;&quot;</code>.</p><p>Next, let&#39;s say that we want our class to accept an <a href="https://docs.oracle.com/javase/8/docs/api/java/io/InputStream.html"><code>InputStream</code></a> as well as a <a href="https://docs.oracle.com/javase/8/docs/api/java/lang/String.html"><code>String</code></a>. We want to call it like this, for example:</p><figure class="highlight"><pre><code class="language-java" data-lang="java"><span></span><span class="n">Encrypted</span> <span class="n">enc</span> <span class="o">=</span> <span class="k">new</span> <span class="n">Encrypted2</span><span class="o">(</span>
  <span class="k">new</span> <span class="n">FileInputStream</span><span class="o">(</span><span class="s">&quot;/tmp/hello.txt&quot;</span><span class="o">)</span>
<span class="o">);</span>
<span class="n">System</span><span class="o">.</span><span class="na">out</span><span class="o">.</span><span class="na">println</span><span class="o">(</span><span class="n">enc</span><span class="o">.</span><span class="na">toString</span><span class="o">());</span></code></pre></figure><p>Here is the most obvious implementation, with two <a href="/2015/05/28/one-primary-constructor.html">primary</a> constructors (again, the implementation is primitive, but works):</p><figure class="highlight"><pre><code class="language-java" data-lang="java"><span></span><span class="kd">class</span> <span class="nc">Encrypted2</span> <span class="kd">implements</span> <span class="n">Encrypted</span> <span class="o">{</span>
  <span class="kd">private</span> <span class="kd">final</span> <span class="n">String</span> <span class="n">text</span><span class="o">;</span>
  <span class="n">Encrypted2</span><span class="o">(</span><span class="n">InputStream</span> <span class="n">input</span><span class="o">)</span> <span class="kd">throws</span> <span class="n">IOException</span> <span class="o">{</span>
    <span class="n">ByteArrayOutputStream</span> <span class="n">baos</span> <span class="o">=</span>
      <span class="k">new</span> <span class="n">ByteArrayOutputStream</span><span class="o">();</span>
    <span class="k">while</span> <span class="o">(</span><span class="kc">true</span><span class="o">)</span> <span class="o">{</span>
      <span class="kt">int</span> <span class="n">one</span> <span class="o">=</span> <span class="n">input</span><span class="o">.</span><span class="na">read</span><span class="o">();</span>
      <span class="k">if</span> <span class="o">(</span><span class="n">one</span> <span class="o">&lt;</span> <span class="mi">0</span><span class="o">)</span> <span class="o">{</span>
        <span class="k">break</span><span class="o">;</span>
      <span class="o">}</span>
      <span class="n">baos</span><span class="o">.</span><span class="na">write</span><span class="o">(</span><span class="n">one</span><span class="o">);</span>
    <span class="o">}</span>
    <span class="k">this</span><span class="o">.</span><span class="na">text</span> <span class="o">=</span> <span class="k">new</span> <span class="n">String</span><span class="o">(</span><span class="n">baos</span><span class="o">.</span><span class="na">toByteArray</span><span class="o">());</span>
  <span class="o">}</span>
  <span class="n">Encrypted2</span><span class="o">(</span><span class="n">String</span> <span class="n">txt</span><span class="o">)</span> <span class="o">{</span>
    <span class="k">this</span><span class="o">.</span><span class="na">text</span> <span class="o">=</span> <span class="n">txt</span><span class="o">;</span>
  <span class="o">}</span>
  <span class="c1">// asString() is exactly the same as in Encrypted1</span>
<span class="o">}</span></code></pre></figure><p>Technically it works, but stream reading is right inside the constructor, which is <a href="/2015/05/07/ctors-must-be-code-free.html">bad practice</a>. <a href="/2015/05/28/one-primary-constructor.html">Primary</a> constructors must not do anything but attribute assignments, while secondary ones may only create new objects.</p><p>Let&#39;s try to refactor and introduce lazy loading:</p><figure class="highlight"><pre><code class="language-java" data-lang="java"><span></span><span class="kd">class</span> <span class="nc">Encrypted3</span> <span class="kd">implements</span> <span class="n">Encrypted</span> <span class="o">{</span>
  <span class="kd">private</span> <span class="n">String</span> <span class="n">text</span><span class="o">;</span>
  <span class="kd">private</span> <span class="kd">final</span> <span class="n">InputStream</span> <span class="n">input</span><span class="o">;</span>
  <span class="n">Encrypted3</span><span class="o">(</span><span class="n">InputStream</span> <span class="n">stream</span><span class="o">)</span> <span class="o">{</span>
    <span class="k">this</span><span class="o">.</span><span class="na">text</span> <span class="o">=</span> <span class="kc">null</span><span class="o">;</span>
    <span class="k">this</span><span class="o">.</span><span class="na">input</span> <span class="o">=</span> <span class="n">stream</span><span class="o">;</span>
  <span class="o">}</span>
  <span class="n">Encrypted3</span><span class="o">(</span><span class="n">String</span> <span class="n">txt</span><span class="o">)</span> <span class="o">{</span>
    <span class="k">this</span><span class="o">.</span><span class="na">text</span> <span class="o">=</span> <span class="n">txt</span><span class="o">;</span>
    <span class="k">this</span><span class="o">.</span><span class="na">input</span> <span class="o">=</span> <span class="kc">null</span><span class="o">;</span>
  <span class="o">}</span>
  <span class="nd">@Override</span>
  <span class="kd">public</span> <span class="n">String</span> <span class="nf">asString</span><span class="o">()</span> <span class="kd">throws</span> <span class="n">IOException</span> <span class="o">{</span>
    <span class="k">if</span> <span class="o">(</span><span class="k">this</span><span class="o">.</span><span class="na">text</span> <span class="o">==</span> <span class="kc">null</span><span class="o">)</span> <span class="o">{</span>
      <span class="n">ByteArrayOutputStream</span> <span class="n">baos</span> <span class="o">=</span>
        <span class="k">new</span> <span class="n">ByteArrayOutputStream</span><span class="o">();</span>
      <span class="k">while</span> <span class="o">(</span><span class="kc">true</span><span class="o">)</span> <span class="o">{</span>
        <span class="kt">int</span> <span class="n">one</span> <span class="o">=</span> <span class="n">input</span><span class="o">.</span><span class="na">read</span><span class="o">();</span>
        <span class="k">if</span> <span class="o">(</span><span class="n">one</span> <span class="o">&lt;</span> <span class="mi">0</span><span class="o">)</span> <span class="o">{</span>
          <span class="k">break</span><span class="o">;</span>
        <span class="o">}</span>
        <span class="n">baos</span><span class="o">.</span><span class="na">write</span><span class="o">(</span><span class="n">one</span><span class="o">);</span>
      <span class="o">}</span>
      <span class="k">this</span><span class="o">.</span><span class="na">text</span> <span class="o">=</span> <span class="k">new</span> <span class="n">String</span><span class="o">(</span><span class="n">baos</span><span class="o">.</span><span class="na">toByteArray</span><span class="o">());</span>
    <span class="o">}</span>
    <span class="kd">final</span> <span class="kt">byte</span><span class="o">[]</span> <span class="n">in</span> <span class="o">=</span> <span class="k">this</span><span class="o">.</span><span class="na">text</span><span class="o">.</span><span class="na">getBytes</span><span class="o">();</span>
    <span class="kd">final</span> <span class="kt">byte</span><span class="o">[]</span> <span class="n">out</span> <span class="o">=</span> <span class="k">new</span> <span class="kt">byte</span><span class="o">[</span><span class="n">in</span><span class="o">.</span><span class="na">length</span><span class="o">];</span>
    <span class="k">for</span> <span class="o">(</span><span class="kt">int</span> <span class="n">i</span> <span class="o">=</span> <span class="mi">0</span><span class="o">;</span> <span class="n">i</span> <span class="o">&lt;</span> <span class="n">in</span><span class="o">.</span><span class="na">length</span><span class="o">;</span> <span class="o">++</span><span class="n">i</span><span class="o">)</span> <span class="o">{</span>
      <span class="n">out</span><span class="o">[</span><span class="n">i</span><span class="o">]</span> <span class="o">=</span> <span class="o">(</span><span class="kt">byte</span><span class="o">)</span> <span class="o">(</span><span class="n">in</span><span class="o">[</span><span class="n">i</span><span class="o">]</span> <span class="o">+</span> <span class="mi">1</span><span class="o">);</span>
    <span class="o">}</span>
    <span class="k">return</span> <span class="k">new</span> <span class="n">String</span><span class="o">(</span><span class="n">out</span><span class="o">);</span>
  <span class="o">}</span>
<span class="o">}</span></code></pre></figure><p>Works great, but looks ugly. The ugliest part is these two lines of course:</p><figure class="highlight"><pre><code class="language-java" data-lang="java"><span></span><span class="k">this</span><span class="o">.</span><span class="na">text</span> <span class="o">=</span> <span class="kc">null</span><span class="o">;</span>
<span class="k">this</span><span class="o">.</span><span class="na">input</span> <span class="o">=</span> <span class="kc">null</span><span class="o">;</span></code></pre></figure><p>They make the object <a href="/2014/06/09/objects-should-be-immutable.html">mutable</a> and they&#39;re using <a href="/2014/05/13/why-null-is-bad.html">NULL</a>. It&#39;s ugly, trust me. Unfortunately, lazy loading and NULL references always come together in <a href="https://stackoverflow.com/a/2192271/187141">classic examples</a>. However there is a better way to implement it. Let&#39;s refactor our class, this time using <a href="http://static.javadoc.io/org.cactoos/cactoos/0.16/org/cactoos/Scalar.html"><code>Scalar</code></a> from <a href="http://www.cactoos.org">Cactoos</a>:</p><figure class="highlight"><pre><code class="language-java" data-lang="java"><span></span><span class="kd">class</span> <span class="nc">Encrypted4</span> <span class="kd">implements</span> <span class="n">Encrypted</span> <span class="o">{</span>
  <span class="kd">private</span> <span class="kd">final</span> <span class="n">IoCheckedScalar</span><span class="o">&lt;</span><span class="n">String</span><span class="o">&gt;</span> <span class="n">text</span><span class="o">;</span>
  <span class="n">Encrypted4</span><span class="o">(</span><span class="n">InputStream</span> <span class="n">stream</span><span class="o">)</span> <span class="o">{</span>
    <span class="k">this</span><span class="o">(</span>
      <span class="o">()</span> <span class="o">-&gt;</span> <span class="o">{</span>
        <span class="n">ByteArrayOutputStream</span> <span class="n">baos</span> <span class="o">=</span>
          <span class="k">new</span> <span class="n">ByteArrayOutputStream</span><span class="o">();</span>
        <span class="k">while</span> <span class="o">(</span><span class="kc">true</span><span class="o">)</span> <span class="o">{</span>
          <span class="kt">int</span> <span class="n">one</span> <span class="o">=</span> <span class="n">stream</span><span class="o">.</span><span class="na">read</span><span class="o">();</span>
          <span class="k">if</span> <span class="o">(</span><span class="n">one</span> <span class="o">&lt;</span> <span class="mi">0</span><span class="o">)</span> <span class="o">{</span>
            <span class="k">break</span><span class="o">;</span>
          <span class="o">}</span>
          <span class="n">baos</span><span class="o">.</span><span class="na">write</span><span class="o">(</span><span class="n">one</span><span class="o">);</span>
        <span class="o">}</span>
        <span class="k">return</span> <span class="k">new</span> <span class="n">String</span><span class="o">(</span><span class="n">baos</span><span class="o">.</span><span class="na">toByteArray</span><span class="o">());</span>
      <span class="o">}</span>
    <span class="o">);</span>
  <span class="o">}</span>
  <span class="n">Encrypted4</span><span class="o">(</span><span class="n">String</span> <span class="n">txt</span><span class="o">)</span> <span class="o">{</span>
    <span class="k">this</span><span class="o">(()</span> <span class="o">-&gt;</span> <span class="n">txt</span><span class="o">);</span>
  <span class="o">}</span>
  <span class="n">Encrypted4</span><span class="o">(</span><span class="n">Scalar</span><span class="o">&lt;</span><span class="n">String</span><span class="o">&gt;</span> <span class="n">source</span><span class="o">)</span> <span class="o">{</span>
    <span class="k">this</span><span class="o">.</span><span class="na">text</span> <span class="o">=</span> <span class="k">new</span> <span class="n">IoCheckedScalar</span><span class="o">&lt;&gt;(</span><span class="n">source</span><span class="o">);</span>
  <span class="o">}</span>
  <span class="nd">@Override</span>
  <span class="kd">public</span> <span class="n">String</span> <span class="nf">asString</span><span class="o">()</span> <span class="kd">throws</span> <span class="n">IOException</span> <span class="o">{</span>
    <span class="kd">final</span> <span class="kt">byte</span><span class="o">[]</span> <span class="n">in</span> <span class="o">=</span> <span class="k">this</span><span class="o">.</span><span class="na">text</span><span class="o">.</span><span class="na">value</span><span class="o">().</span><span class="na">getBytes</span><span class="o">();</span>
    <span class="kd">final</span> <span class="kt">byte</span><span class="o">[]</span> <span class="n">out</span> <span class="o">=</span> <span class="k">new</span> <span class="kt">byte</span><span class="o">[</span><span class="n">in</span><span class="o">.</span><span class="na">length</span><span class="o">];</span>
    <span class="k">for</span> <span class="o">(</span><span class="kt">int</span> <span class="n">i</span> <span class="o">=</span> <span class="mi">0</span><span class="o">;</span> <span class="n">i</span> <span class="o">&lt;</span> <span class="n">in</span><span class="o">.</span><span class="na">length</span><span class="o">;</span> <span class="o">++</span><span class="n">i</span><span class="o">)</span> <span class="o">{</span>
      <span class="n">out</span><span class="o">[</span><span class="n">i</span><span class="o">]</span> <span class="o">=</span> <span class="o">(</span><span class="kt">byte</span><span class="o">)</span> <span class="o">(</span><span class="n">in</span><span class="o">[</span><span class="n">i</span><span class="o">]</span> <span class="o">+</span> <span class="mi">1</span><span class="o">);</span>
    <span class="o">}</span>
    <span class="k">return</span> <span class="k">new</span> <span class="n">String</span><span class="o">(</span><span class="n">out</span><span class="o">);</span>
  <span class="o">}</span></code></pre></figure><p>Now it looks way better. First of all, there is only one primary constructor and two secondary ones. Second, the object is <a href="/2014/06/09/objects-should-be-immutable.html">immutable</a>. Third, there is still a lot of room for <a href="/2014/11/07/how-immutability-helps.html">improvement</a>: we can add more constructors which will accept other sources of data, for example <a href="https://docs.oracle.com/javase/8/docs/api/java/io/File.html"><code>File</code></a> or a byte array.</p><aside class='youtube'> <a href='https://www.youtube.com/watch?v=7WmsiV22IXM'><div class='box'> <img src='https://i.ytimg.com/vi/7WmsiV22IXM/mqdefault.jpg' alt='YouTube video #7WmsiV22IXM'/><div class='play'><i class='icon icon-play'></i></div></div></a><div>Lazy Loading via Java Lambda (Webinar #30); 13 December 2017.</div></aside><p>In a nutshell, the attribute that is supposed to be loaded in a &quot;lazy&quot; way is represented inside an object as a &quot;function&quot; (<a href="https://docs.oracle.com/javase/tutorial/java/javaOO/lambdaexpressions.html">lambda expression</a> in Java&nbsp;8). Until we touch that attribute, it&#39;s not loaded. Once we need to work with it, the function gets executed and we have the result.</p><p>There is one problem with this code though. It will read the input stream every time we call <code>asString()</code>, which will obviously not work, since only the first time will the stream have the data. On every subsequent call the stream will simply be empty. Thus, we need to make sure that <code>this.text.value()</code> executes the encapsulated <code>Scalar</code> only once. All later calls must return the previously calculated value. So we need to <em>cache</em> it. Here is how:</p><figure class="highlight"><pre><code class="language-java" data-lang="java"><span></span><span class="kd">class</span> <span class="nc">Encrypted5</span> <span class="kd">implements</span> <span class="n">Encrypted</span> <span class="o">{</span>
  <span class="kd">private</span> <span class="kd">final</span> <span class="n">IoCheckedScalar</span><span class="o">&lt;</span><span class="n">String</span><span class="o">&gt;</span> <span class="n">text</span><span class="o">;</span>
  <span class="c1">// same as above in Encrypted4</span>
  <span class="n">Encrypted5</span><span class="o">(</span><span class="n">Scalar</span><span class="o">&lt;</span><span class="n">String</span><span class="o">&gt;</span> <span class="n">source</span><span class="o">)</span> <span class="o">{</span>
    <span class="k">this</span><span class="o">.</span><span class="na">text</span> <span class="o">=</span> <span class="k">new</span> <span class="n">IoCheckedScalar</span><span class="o">&lt;&gt;(</span>
      <span class="k">new</span> <span class="n">StickyScalar</span><span class="o">&lt;&gt;(</span><span class="n">source</span><span class="o">)</span>
    <span class="o">);</span>
  <span class="o">}</span>
  <span class="c1">// same as above in Encrypted4</span></code></pre></figure><p>This <a href="http://static.javadoc.io/org.cactoos/cactoos/0.16/org/cactoos/scalar/StickyScalar.html"><code>StickyScalar</code></a> will make sure that only the first call to its method <code>value()</code> will go through to the encapsulated <code>Scalar</code>. All other calls will receive the result of the first call.</p><p>The last problem to solve is about concurrency. The code we have above is not thread safe. If I create an instance of <code>Encrypted5</code> and pass it to two threads, which call <code>asString()</code> simultaneously, the result will be unpredictable, simply because <a href="http://static.javadoc.io/org.cactoos/cactoos/0.16/org/cactoos/scalar/StickyScalar.html"><code>StickyScalar</code></a> is not thread-safe. There is another primitive to help us out though, called <a href="http://static.javadoc.io/org.cactoos/cactoos/0.16/org/cactoos/scalar/SyncScalar.html"><code>SyncScalar</code></a>:</p><figure class="highlight"><pre><code class="language-java" data-lang="java"><span></span><span class="kd">class</span> <span class="nc">Encrypted5</span> <span class="kd">implements</span> <span class="n">Encrypted</span> <span class="o">{</span>
  <span class="kd">private</span> <span class="kd">final</span> <span class="n">IoCheckedScalar</span><span class="o">&lt;</span><span class="n">String</span><span class="o">&gt;</span> <span class="n">text</span><span class="o">;</span>
  <span class="c1">// same as above in Encrypted4</span>
  <span class="n">Encrypted5</span><span class="o">(</span><span class="n">Scalar</span><span class="o">&lt;</span><span class="n">String</span><span class="o">&gt;</span> <span class="n">source</span><span class="o">)</span> <span class="o">{</span>
    <span class="k">this</span><span class="o">.</span><span class="na">text</span> <span class="o">=</span> <span class="k">new</span> <span class="n">IoCheckedScalar</span><span class="o">&lt;&gt;(</span>
      <span class="k">new</span> <span class="n">SyncScalar</span><span class="o">&lt;&gt;(</span>
        <span class="k">new</span> <span class="n">StickyScalar</span><span class="o">&lt;&gt;(</span><span class="n">source</span><span class="o">)</span>
      <span class="o">)</span>
    <span class="o">);</span>
  <span class="o">}</span>
  <span class="c1">// same as above in Encrypted4</span></code></pre></figure><p>Now we&#39;re safe and the design is elegant. It includes lazy loading and caching.</p><p>I&#39;m using this approach in many projects now and it seems convenient, clear, and object-oriented.</p></p>--> <nav class="buttons notranslate desktop-only"> <a href="http://www.facebook.com/sharer/sharer.php?u=https://www.yegor256.com/2017/10/17/lazy-loading-caching-sticky-cactoos.html" title="Share on Facebook" class="button" rel="nofollow"> <span class="count count-facebook">0</span> <i class="icon icon-facebook notranslate" aria-hidden="true"></i> </a> <a href="https://twitter.com/share?url=https://www.yegor256.com/2017/10/17/lazy-loading-caching-sticky-cactoos.html&amp;text=Lazy+Loading+and+Caching+via+Sticky+Cactoos+Primitives" title="Share on Twitter" class="button" rel="nofollow"> <span class="count count-twitter">0</span> <i class="icon icon-twitter notranslate" aria-hidden="true"></i> </a> <a href="https://plus.google.com/share?url=https://www.yegor256.com/2017/10/17/lazy-loading-caching-sticky-cactoos.html" title="Share on Google+" class="button" rel="nofollow"> <span class="count count-googleplus">0</span> <i class="icon icon-googleplus notranslate" aria-hidden="true"></i> </a> <a href="https://www.linkedin.com/cws/share?url=https://www.yegor256.com/2017/10/17/lazy-loading-caching-sticky-cactoos.html" title="Share on LinkedIn" class="button" rel="nofollow"> <span class="count count-linkedin">0</span> <i class="icon icon-linkedin notranslate" aria-hidden="true"></i> </a> <a href="http://reddit.com/submit?url=https://www.yegor256.com/2017/10/17/lazy-loading-caching-sticky-cactoos.html%3F2017-42&amp;title=Lazy+Loading+and+Caching+via+Sticky+Cactoos+Primitives" title="Share on Reddit" class="button" rel="nofollow"> <span class="count count-reddit">0</span> <i class="icon icon-reddit notranslate" aria-hidden="true"></i> </a> <a href="http://news.ycombinator.com/submitlink?u=https://www.yegor256.com/2017/10/17/lazy-loading-caching-sticky-cactoos.html%3F2017-42&amp;t=Lazy+Loading+and+Caching+via+Sticky+Cactoos+Primitives" title="Share on Hacker News" class="button" rel="nofollow"> <span class="count count-hackernews">0</span> <i class="icon icon-hackernews notranslate" aria-hidden="true"></i> </a> </nav> </header> <article class="main" itemprop="articleBody"><div ><p>You obviously know what <a href="https://en.wikipedia.org/wiki/Lazy_loading">lazy loading</a> is, right? And you no doubt know about <a href="https://en.wikipedia.org/wiki/Cache_%28computing%29">caching</a>. To my knowledge, there is no elegant way in Java to implement either of them. Here is what I found out for myself with the help of Cactoos primitives.</p><figure class='jb_picture'><img itemprop='image' alt='Reality (2012) by Matteo Garrone' src='/images/2017/10/reality.jpg' longdesc='#e68b1cc6'/><figcaption id='e68b1cc6'>Reality (2012) by Matteo Garrone</figcaption></figure><p>Let&#39;s say we need an object that will encrypt some text. Speaking in a more object-oriented way, it will encapsulate the text and <em>become</em> its encrypted form. Here is how we will use it (let&#39;s create <a href="/2017/03/24/tdd-that-works.html">tests first</a>):</p><figure class="highlight"><pre><code class="language-java" data-lang="java"><span></span><span class="kd">interface</span> <span class="nc">Encrypted</span> <span class="o">{</span>
  <span class="n">String</span> <span class="nf">asString</span><span class="o">()</span> <span class="kd">throws</span> <span class="n">IOException</span><span class="o">;</span>
<span class="o">}</span>
<span class="n">Encrypted</span> <span class="n">enc</span> <span class="o">=</span> <span class="k">new</span> <span class="n">EncryptedX</span><span class="o">(</span><span class="s">&quot;Hello, world!&quot;</span><span class="o">);</span>
<span class="n">System</span><span class="o">.</span><span class="na">out</span><span class="o">.</span><span class="na">println</span><span class="o">(</span><span class="n">enc</span><span class="o">.</span><span class="na">asString</span><span class="o">());</span></code></pre></figure><p>Now let&#39;s implement it, in a very primitive way, with one <a href="/2015/05/28/one-primary-constructor.html">primary</a> constructor. The encryption mechanism will just add <code>+1</code> to each byte in the incoming data, and will assume that the encryption won&#39;t break anything (a very stupid assumption, but for the sake of this example it will work):</p><figure class="highlight"><pre><code class="language-java" data-lang="java"><span></span><span class="kd">class</span> <span class="nc">Encrypted1</span> <span class="kd">implements</span> <span class="n">Encrypted</span> <span class="o">{</span>
  <span class="kd">private</span> <span class="kd">final</span> <span class="n">String</span> <span class="n">text</span><span class="o">;</span>
  <span class="n">Encrypted1</span><span class="o">(</span><span class="n">String</span> <span class="n">txt</span><span class="o">)</span> <span class="o">{</span>
    <span class="k">this</span><span class="o">.</span><span class="na">text</span> <span class="o">=</span> <span class="n">txt</span><span class="o">;</span>
  <span class="o">}</span>
  <span class="nd">@Override</span>
  <span class="kd">public</span> <span class="n">String</span> <span class="nf">asString</span><span class="o">()</span> <span class="o">{</span>
    <span class="kd">final</span> <span class="kt">byte</span><span class="o">[]</span> <span class="n">in</span> <span class="o">=</span> <span class="k">this</span><span class="o">.</span><span class="na">text</span><span class="o">.</span><span class="na">getBytes</span><span class="o">();</span>
    <span class="kd">final</span> <span class="kt">byte</span><span class="o">[]</span> <span class="n">out</span> <span class="o">=</span> <span class="k">new</span> <span class="kt">byte</span><span class="o">[</span><span class="n">in</span><span class="o">.</span><span class="na">length</span><span class="o">];</span>
    <span class="k">for</span> <span class="o">(</span><span class="kt">int</span> <span class="n">i</span> <span class="o">=</span> <span class="mi">0</span><span class="o">;</span> <span class="n">i</span> <span class="o">&lt;</span> <span class="n">in</span><span class="o">.</span><span class="na">length</span><span class="o">;</span> <span class="o">++</span><span class="n">i</span><span class="o">)</span> <span class="o">{</span>
      <span class="n">out</span><span class="o">[</span><span class="n">i</span><span class="o">]</span> <span class="o">=</span> <span class="o">(</span><span class="kt">byte</span><span class="o">)</span> <span class="o">(</span><span class="n">in</span><span class="o">[</span><span class="n">i</span><span class="o">]</span> <span class="o">+</span> <span class="mi">1</span><span class="o">);</span>
    <span class="o">}</span>
    <span class="k">return</span> <span class="k">new</span> <span class="n">String</span><span class="o">(</span><span class="n">out</span><span class="o">);</span>
  <span class="o">}</span>
<span class="o">}</span></code></pre></figure><p>Looks correct so far? I <a href="https://github.com/yegor256/blog/tree/master/_samples/2017/10/sticky">tested it</a> and it works. If the input is <code>&quot;Hello, world!&quot;</code>, the output will be <code>&quot;Ifmmp-!xpsme\&quot;&quot;</code>.</p><p>Next, let&#39;s say that we want our class to accept an <a href="https://docs.oracle.com/javase/8/docs/api/java/io/InputStream.html"><code>InputStream</code></a> as well as a <a href="https://docs.oracle.com/javase/8/docs/api/java/lang/String.html"><code>String</code></a>. We want to call it like this, for example:</p><figure class="highlight"><pre><code class="language-java" data-lang="java"><span></span><span class="n">Encrypted</span> <span class="n">enc</span> <span class="o">=</span> <span class="k">new</span> <span class="n">Encrypted2</span><span class="o">(</span>
  <span class="k">new</span> <span class="n">FileInputStream</span><span class="o">(</span><span class="s">&quot;/tmp/hello.txt&quot;</span><span class="o">)</span>
<span class="o">);</span>
<span class="n">System</span><span class="o">.</span><span class="na">out</span><span class="o">.</span><span class="na">println</span><span class="o">(</span><span class="n">enc</span><span class="o">.</span><span class="na">toString</span><span class="o">());</span></code></pre></figure><p>Here is the most obvious implementation, with two <a href="/2015/05/28/one-primary-constructor.html">primary</a> constructors (again, the implementation is primitive, but works):</p><figure class="highlight"><pre><code class="language-java" data-lang="java"><span></span><span class="kd">class</span> <span class="nc">Encrypted2</span> <span class="kd">implements</span> <span class="n">Encrypted</span> <span class="o">{</span>
  <span class="kd">private</span> <span class="kd">final</span> <span class="n">String</span> <span class="n">text</span><span class="o">;</span>
  <span class="n">Encrypted2</span><span class="o">(</span><span class="n">InputStream</span> <span class="n">input</span><span class="o">)</span> <span class="kd">throws</span> <span class="n">IOException</span> <span class="o">{</span>
    <span class="n">ByteArrayOutputStream</span> <span class="n">baos</span> <span class="o">=</span>
      <span class="k">new</span> <span class="n">ByteArrayOutputStream</span><span class="o">();</span>
    <span class="k">while</span> <span class="o">(</span><span class="kc">true</span><span class="o">)</span> <span class="o">{</span>
      <span class="kt">int</span> <span class="n">one</span> <span class="o">=</span> <span class="n">input</span><span class="o">.</span><span class="na">read</span><span class="o">();</span>
      <span class="k">if</span> <span class="o">(</span><span class="n">one</span> <span class="o">&lt;</span> <span class="mi">0</span><span class="o">)</span> <span class="o">{</span>
        <span class="k">break</span><span class="o">;</span>
      <span class="o">}</span>
      <span class="n">baos</span><span class="o">.</span><span class="na">write</span><span class="o">(</span><span class="n">one</span><span class="o">);</span>
    <span class="o">}</span>
    <span class="k">this</span><span class="o">.</span><span class="na">text</span> <span class="o">=</span> <span class="k">new</span> <span class="n">String</span><span class="o">(</span><span class="n">baos</span><span class="o">.</span><span class="na">toByteArray</span><span class="o">());</span>
  <span class="o">}</span>
  <span class="n">Encrypted2</span><span class="o">(</span><span class="n">String</span> <span class="n">txt</span><span class="o">)</span> <span class="o">{</span>
    <span class="k">this</span><span class="o">.</span><span class="na">text</span> <span class="o">=</span> <span class="n">txt</span><span class="o">;</span>
  <span class="o">}</span>
  <span class="c1">// asString() is exactly the same as in Encrypted1</span>
<span class="o">}</span></code></pre></figure><p>Technically it works, but stream reading is right inside the constructor, which is <a href="/2015/05/07/ctors-must-be-code-free.html">bad practice</a>. <a href="/2015/05/28/one-primary-constructor.html">Primary</a> constructors must not do anything but attribute assignments, while secondary ones may only create new objects.</p><p>Let&#39;s try to refactor and introduce lazy loading:</p><figure class="highlight"><pre><code class="language-java" data-lang="java"><span></span><span class="kd">class</span> <span class="nc">Encrypted3</span> <span class="kd">implements</span> <span class="n">Encrypted</span> <span class="o">{</span>
  <span class="kd">private</span> <span class="n">String</span> <span class="n">text</span><span class="o">;</span>
  <span class="kd">private</span> <span class="kd">final</span> <span class="n">InputStream</span> <span class="n">input</span><span class="o">;</span>
  <span class="n">Encrypted3</span><span class="o">(</span><span class="n">InputStream</span> <span class="n">stream</span><span class="o">)</span> <span class="o">{</span>
    <span class="k">this</span><span class="o">.</span><span class="na">text</span> <span class="o">=</span> <span class="kc">null</span><span class="o">;</span>
    <span class="k">this</span><span class="o">.</span><span class="na">input</span> <span class="o">=</span> <span class="n">stream</span><span class="o">;</span>
  <span class="o">}</span>
  <span class="n">Encrypted3</span><span class="o">(</span><span class="n">String</span> <span class="n">txt</span><span class="o">)</span> <span class="o">{</span>
    <span class="k">this</span><span class="o">.</span><span class="na">text</span> <span class="o">=</span> <span class="n">txt</span><span class="o">;</span>
    <span class="k">this</span><span class="o">.</span><span class="na">input</span> <span class="o">=</span> <span class="kc">null</span><span class="o">;</span>
  <span class="o">}</span>
  <span class="nd">@Override</span>
  <span class="kd">public</span> <span class="n">String</span> <span class="nf">asString</span><span class="o">()</span> <span class="kd">throws</span> <span class="n">IOException</span> <span class="o">{</span>
    <span class="k">if</span> <span class="o">(</span><span class="k">this</span><span class="o">.</span><span class="na">text</span> <span class="o">==</span> <span class="kc">null</span><span class="o">)</span> <span class="o">{</span>
      <span class="n">ByteArrayOutputStream</span> <span class="n">baos</span> <span class="o">=</span>
        <span class="k">new</span> <span class="n">ByteArrayOutputStream</span><span class="o">();</span>
      <span class="k">while</span> <span class="o">(</span><span class="kc">true</span><span class="o">)</span> <span class="o">{</span>
        <span class="kt">int</span> <span class="n">one</span> <span class="o">=</span> <span class="n">input</span><span class="o">.</span><span class="na">read</span><span class="o">();</span>
        <span class="k">if</span> <span class="o">(</span><span class="n">one</span> <span class="o">&lt;</span> <span class="mi">0</span><span class="o">)</span> <span class="o">{</span>
          <span class="k">break</span><span class="o">;</span>
        <span class="o">}</span>
        <span class="n">baos</span><span class="o">.</span><span class="na">write</span><span class="o">(</span><span class="n">one</span><span class="o">);</span>
      <span class="o">}</span>
      <span class="k">this</span><span class="o">.</span><span class="na">text</span> <span class="o">=</span> <span class="k">new</span> <span class="n">String</span><span class="o">(</span><span class="n">baos</span><span class="o">.</span><span class="na">toByteArray</span><span class="o">());</span>
    <span class="o">}</span>
    <span class="kd">final</span> <span class="kt">byte</span><span class="o">[]</span> <span class="n">in</span> <span class="o">=</span> <span class="k">this</span><span class="o">.</span><span class="na">text</span><span class="o">.</span><span class="na">getBytes</span><span class="o">();</span>
    <span class="kd">final</span> <span class="kt">byte</span><span class="o">[]</span> <span class="n">out</span> <span class="o">=</span> <span class="k">new</span> <span class="kt">byte</span><span class="o">[</span><span class="n">in</span><span class="o">.</span><span class="na">length</span><span class="o">];</span>
    <span class="k">for</span> <span class="o">(</span><span class="kt">int</span> <span class="n">i</span> <span class="o">=</span> <span class="mi">0</span><span class="o">;</span> <span class="n">i</span> <span class="o">&lt;</span> <span class="n">in</span><span class="o">.</span><span class="na">length</span><span class="o">;</span> <span class="o">++</span><span class="n">i</span><span class="o">)</span> <span class="o">{</span>
      <span class="n">out</span><span class="o">[</span><span class="n">i</span><span class="o">]</span> <span class="o">=</span> <span class="o">(</span><span class="kt">byte</span><span class="o">)</span> <span class="o">(</span><span class="n">in</span><span class="o">[</span><span class="n">i</span><span class="o">]</span> <span class="o">+</span> <span class="mi">1</span><span class="o">);</span>
    <span class="o">}</span>
    <span class="k">return</span> <span class="k">new</span> <span class="n">String</span><span class="o">(</span><span class="n">out</span><span class="o">);</span>
  <span class="o">}</span>
<span class="o">}</span></code></pre></figure><p>Works great, but looks ugly. The ugliest part is these two lines of course:</p><figure class="highlight"><pre><code class="language-java" data-lang="java"><span></span><span class="k">this</span><span class="o">.</span><span class="na">text</span> <span class="o">=</span> <span class="kc">null</span><span class="o">;</span>
<span class="k">this</span><span class="o">.</span><span class="na">input</span> <span class="o">=</span> <span class="kc">null</span><span class="o">;</span></code></pre></figure><p>They make the object <a href="/2014/06/09/objects-should-be-immutable.html">mutable</a> and they&#39;re using <a href="/2014/05/13/why-null-is-bad.html">NULL</a>. It&#39;s ugly, trust me. Unfortunately, lazy loading and NULL references always come together in <a href="https://stackoverflow.com/a/2192271/187141">classic examples</a>. However there is a better way to implement it. Let&#39;s refactor our class, this time using <a href="http://static.javadoc.io/org.cactoos/cactoos/0.16/org/cactoos/Scalar.html"><code>Scalar</code></a> from <a href="http://www.cactoos.org">Cactoos</a>:</p><figure class="highlight"><pre><code class="language-java" data-lang="java"><span></span><span class="kd">class</span> <span class="nc">Encrypted4</span> <span class="kd">implements</span> <span class="n">Encrypted</span> <span class="o">{</span>
  <span class="kd">private</span> <span class="kd">final</span> <span class="n">IoCheckedScalar</span><span class="o">&lt;</span><span class="n">String</span><span class="o">&gt;</span> <span class="n">text</span><span class="o">;</span>
  <span class="n">Encrypted4</span><span class="o">(</span><span class="n">InputStream</span> <span class="n">stream</span><span class="o">)</span> <span class="o">{</span>
    <span class="k">this</span><span class="o">(</span>
      <span class="o">()</span> <span class="o">-&gt;</span> <span class="o">{</span>
        <span class="n">ByteArrayOutputStream</span> <span class="n">baos</span> <span class="o">=</span>
          <span class="k">new</span> <span class="n">ByteArrayOutputStream</span><span class="o">();</span>
        <span class="k">while</span> <span class="o">(</span><span class="kc">true</span><span class="o">)</span> <span class="o">{</span>
          <span class="kt">int</span> <span class="n">one</span> <span class="o">=</span> <span class="n">stream</span><span class="o">.</span><span class="na">read</span><span class="o">();</span>
          <span class="k">if</span> <span class="o">(</span><span class="n">one</span> <span class="o">&lt;</span> <span class="mi">0</span><span class="o">)</span> <span class="o">{</span>
            <span class="k">break</span><span class="o">;</span>
          <span class="o">}</span>
          <span class="n">baos</span><span class="o">.</span><span class="na">write</span><span class="o">(</span><span class="n">one</span><span class="o">);</span>
        <span class="o">}</span>
        <span class="k">return</span> <span class="k">new</span> <span class="n">String</span><span class="o">(</span><span class="n">baos</span><span class="o">.</span><span class="na">toByteArray</span><span class="o">());</span>
      <span class="o">}</span>
    <span class="o">);</span>
  <span class="o">}</span>
  <span class="n">Encrypted4</span><span class="o">(</span><span class="n">String</span> <span class="n">txt</span><span class="o">)</span> <span class="o">{</span>
    <span class="k">this</span><span class="o">(()</span> <span class="o">-&gt;</span> <span class="n">txt</span><span class="o">);</span>
  <span class="o">}</span>
  <span class="n">Encrypted4</span><span class="o">(</span><span class="n">Scalar</span><span class="o">&lt;</span><span class="n">String</span><span class="o">&gt;</span> <span class="n">source</span><span class="o">)</span> <span class="o">{</span>
    <span class="k">this</span><span class="o">.</span><span class="na">text</span> <span class="o">=</span> <span class="k">new</span> <span class="n">IoCheckedScalar</span><span class="o">&lt;&gt;(</span><span class="n">source</span><span class="o">);</span>
  <span class="o">}</span>
  <span class="nd">@Override</span>
  <span class="kd">public</span> <span class="n">String</span> <span class="nf">asString</span><span class="o">()</span> <span class="kd">throws</span> <span class="n">IOException</span> <span class="o">{</span>
    <span class="kd">final</span> <span class="kt">byte</span><span class="o">[]</span> <span class="n">in</span> <span class="o">=</span> <span class="k">this</span><span class="o">.</span><span class="na">text</span><span class="o">.</span><span class="na">value</span><span class="o">().</span><span class="na">getBytes</span><span class="o">();</span>
    <span class="kd">final</span> <span class="kt">byte</span><span class="o">[]</span> <span class="n">out</span> <span class="o">=</span> <span class="k">new</span> <span class="kt">byte</span><span class="o">[</span><span class="n">in</span><span class="o">.</span><span class="na">length</span><span class="o">];</span>
    <span class="k">for</span> <span class="o">(</span><span class="kt">int</span> <span class="n">i</span> <span class="o">=</span> <span class="mi">0</span><span class="o">;</span> <span class="n">i</span> <span class="o">&lt;</span> <span class="n">in</span><span class="o">.</span><span class="na">length</span><span class="o">;</span> <span class="o">++</span><span class="n">i</span><span class="o">)</span> <span class="o">{</span>
      <span class="n">out</span><span class="o">[</span><span class="n">i</span><span class="o">]</span> <span class="o">=</span> <span class="o">(</span><span class="kt">byte</span><span class="o">)</span> <span class="o">(</span><span class="n">in</span><span class="o">[</span><span class="n">i</span><span class="o">]</span> <span class="o">+</span> <span class="mi">1</span><span class="o">);</span>
    <span class="o">}</span>
    <span class="k">return</span> <span class="k">new</span> <span class="n">String</span><span class="o">(</span><span class="n">out</span><span class="o">);</span>
  <span class="o">}</span></code></pre></figure><p>Now it looks way better. First of all, there is only one primary constructor and two secondary ones. Second, the object is <a href="/2014/06/09/objects-should-be-immutable.html">immutable</a>. Third, there is still a lot of room for <a href="/2014/11/07/how-immutability-helps.html">improvement</a>: we can add more constructors which will accept other sources of data, for example <a href="https://docs.oracle.com/javase/8/docs/api/java/io/File.html"><code>File</code></a> or a byte array.</p><aside class='youtube'> <a href='https://www.youtube.com/watch?v=7WmsiV22IXM'><div class='box'> <img src='https://i.ytimg.com/vi/7WmsiV22IXM/mqdefault.jpg' alt='YouTube video #7WmsiV22IXM'/><div class='play'><i class='icon icon-play'></i></div></div></a><div>Lazy Loading via Java Lambda (Webinar #30); 13 December 2017.</div></aside><p>In a nutshell, the attribute that is supposed to be loaded in a &quot;lazy&quot; way is represented inside an object as a &quot;function&quot; (<a href="https://docs.oracle.com/javase/tutorial/java/javaOO/lambdaexpressions.html">lambda expression</a> in Java&nbsp;8). Until we touch that attribute, it&#39;s not loaded. Once we need to work with it, the function gets executed and we have the result.</p><p>There is one problem with this code though. It will read the input stream every time we call <code>asString()</code>, which will obviously not work, since only the first time will the stream have the data. On every subsequent call the stream will simply be empty. Thus, we need to make sure that <code>this.text.value()</code> executes the encapsulated <code>Scalar</code> only once. All later calls must return the previously calculated value. So we need to <em>cache</em> it. Here is how:</p><figure class="highlight"><pre><code class="language-java" data-lang="java"><span></span><span class="kd">class</span> <span class="nc">Encrypted5</span> <span class="kd">implements</span> <span class="n">Encrypted</span> <span class="o">{</span>
  <span class="kd">private</span> <span class="kd">final</span> <span class="n">IoCheckedScalar</span><span class="o">&lt;</span><span class="n">String</span><span class="o">&gt;</span> <span class="n">text</span><span class="o">;</span>
  <span class="c1">// same as above in Encrypted4</span>
  <span class="n">Encrypted5</span><span class="o">(</span><span class="n">Scalar</span><span class="o">&lt;</span><span class="n">String</span><span class="o">&gt;</span> <span class="n">source</span><span class="o">)</span> <span class="o">{</span>
    <span class="k">this</span><span class="o">.</span><span class="na">text</span> <span class="o">=</span> <span class="k">new</span> <span class="n">IoCheckedScalar</span><span class="o">&lt;&gt;(</span>
      <span class="k">new</span> <span class="n">StickyScalar</span><span class="o">&lt;&gt;(</span><span class="n">source</span><span class="o">)</span>
    <span class="o">);</span>
  <span class="o">}</span>
  <span class="c1">// same as above in Encrypted4</span></code></pre></figure><p>This <a href="http://static.javadoc.io/org.cactoos/cactoos/0.16/org/cactoos/scalar/StickyScalar.html"><code>StickyScalar</code></a> will make sure that only the first call to its method <code>value()</code> will go through to the encapsulated <code>Scalar</code>. All other calls will receive the result of the first call.</p><p>The last problem to solve is about concurrency. The code we have above is not thread safe. If I create an instance of <code>Encrypted5</code> and pass it to two threads, which call <code>asString()</code> simultaneously, the result will be unpredictable, simply because <a href="http://static.javadoc.io/org.cactoos/cactoos/0.16/org/cactoos/scalar/StickyScalar.html"><code>StickyScalar</code></a> is not thread-safe. There is another primitive to help us out though, called <a href="http://static.javadoc.io/org.cactoos/cactoos/0.16/org/cactoos/scalar/SyncScalar.html"><code>SyncScalar</code></a>:</p><figure class="highlight"><pre><code class="language-java" data-lang="java"><span></span><span class="kd">class</span> <span class="nc">Encrypted5</span> <span class="kd">implements</span> <span class="n">Encrypted</span> <span class="o">{</span>
  <span class="kd">private</span> <span class="kd">final</span> <span class="n">IoCheckedScalar</span><span class="o">&lt;</span><span class="n">String</span><span class="o">&gt;</span> <span class="n">text</span><span class="o">;</span>
  <span class="c1">// same as above in Encrypted4</span>
  <span class="n">Encrypted5</span><span class="o">(</span><span class="n">Scalar</span><span class="o">&lt;</span><span class="n">String</span><span class="o">&gt;</span> <span class="n">source</span><span class="o">)</span> <span class="o">{</span>
    <span class="k">this</span><span class="o">.</span><span class="na">text</span> <span class="o">=</span> <span class="k">new</span> <span class="n">IoCheckedScalar</span><span class="o">&lt;&gt;(</span>
      <span class="k">new</span> <span class="n">SyncScalar</span><span class="o">&lt;&gt;(</span>
        <span class="k">new</span> <span class="n">StickyScalar</span><span class="o">&lt;&gt;(</span><span class="n">source</span><span class="o">)</span>
      <span class="o">)</span>
    <span class="o">);</span>
  <span class="o">}</span>
  <span class="c1">// same as above in Encrypted4</span></code></pre></figure><p>Now we&#39;re safe and the design is elegant. It includes lazy loading and caching.</p><p>I&#39;m using this approach in many projects now and it seems convenient, clear, and object-oriented.</p></div></article></div><div class="wrapper"> <related-posts /></div><div class="disqus" role="complementary"><p class="disqus_hint"> Please, use <a href="https://help.disqus.com/commenting/what-html-tags-are-allowed-within-comments">syntax highlighting</a> in your comments, to make them more readable.</p><div id="disqus_thread" class="disqus-thread"> <a>&nbsp;</a></div><script> var disqus_config = function () { this.page.url = document.location.href.split('?')[0].split('#')[0].replace('https://', 'http://'); this.page.identifier = this.page.url; }; (function() { var d = document, s = d.createElement('script'); s.src = '//yegor256.disqus.com/embed.js'; s.setAttribute('data-timestamp', +new Date()); (d.head || d.body).appendChild(s); })(); </script> <noscript><div><p class="red"> JavaScript is disabled in your browser, that's why you can't see comments under this post.</p></div></noscript></div><div class="wrapper"> <footer class="footer"><p> &copy; <span itemscope="" itemprop="copyrightHolder" itemtype="http://schema.org/Person"> <span itemprop="name">Yegor Bugayenko</span> </span> 2014&ndash;<span itemprop="copyrightYear">2018</span></p></footer></div></section><div class="wrapper unprintable" style="text-align:center;margin-top:2em;"> <a href="http://www.sixnines.io/h/3ba1652f"> <img src="//www.sixnines.io/b/3ba1652f?style=flat" alt="sixnines availability badge"/> </a></div><script src="//code.jquery.com/jquery-1.9.0.min.js"></script> <script src="/js/all.js?4e047f6f42b"></script> <script>var disqus_shortname = 'yegor256';</script> <script id="dsq-count-scr" src="//yegor256.disqus.com/count.js" async="async"></script> <script> (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){ (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o), m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m) })(window,document,'script','//www.google-analytics.com/analytics.js','ga'); ga('create', 'UA-1963507-32', 'auto'); ga('send', 'pageview'); </script> <script> Cd=document;Cr="&"+Math.random();Cp="&s=1"; Cd.cookie="b=b";if(Cd.cookie)Cp+="&c=1"; Cp+="&t="+(new Date()).getTimezoneOffset(); if(self!=top)Cp+="&f=1"; </script> <script> if(navigator.javaEnabled())Cp+="&j=1"; </script> <script> if(typeof(screen)!='undefined')Cp+="&w="+screen.width+"&h="+ screen.height+"&d="+(screen.colorDepth?screen.colorDepth:screen.pixelDepth); </script> <script> Cd.write("<img src='//c.hit.ua/hit?i=95870&g=0&x=2"+Cp+Cr+ "&r="+escape(Cd.referrer)+"&u="+escape(window.location.href)+ "' border='0' wi"+"dth='1' he"+"ight='1'/>"); </script> <script type="application/ld+json"> { "@context": "http://schema.org", "@type": "Person", "name": "Yegor Bugayenko", "url": "http://www.yegor256.com", "sameAs": [ "https://www.facebook.com/yegor256", "https://instagram.com/yegor256", "https://www.linkedin.com/in/yegor256", "https://twitter.com/yegor256", "https://github.com/yegor256", "https://www.pinterest.com/yegor256/" ] } </script> </body> </html> <!DOCTYPE html> <html xmlns="http://www.w3.org/1999/xhtml" lang="en-US" xml:lang="en-US" itemscope="" itemtype="http://schema.org/WebSite"> <head> <meta charset="utf-8"/> <meta name="description" content="Streams from Java 8 help us manipulate collections, but they ruin the idea of objects; decorators, on the other hand, do the same but in an object-oriented way. " /> <meta name="keywords" content="decorators vs streams, guava vs streams, java streams, streams, streams API" /> <meta name="viewport" content="width=device-width,minimum-scale=1,initial-scale=1"/> <meta name="google-site-verification" content="JEj_gQr2CPe2QKGw8XdMz0R7VboQIUbX3FlM-lwTq-8" /> <meta name="author" content="Yegor Bugayenko"> <meta name="article:published_time" content="2017-10-10 00:00:00 +0000"> <meta name="og:site_name" content="Yegor Bugayenko"/> <meta name="og:type" content="article" /> <meta name="og:locale" content="en_US" /> <meta name="twitter:account_id" content="4503599630178231" /> <meta name="twitter:creator" content="@yegor256"/> <meta name="twitter:site" content="@yegor256"/> <meta name="twitter:title" property="og:title" content="Streams vs. Decorators"/> <meta name="twitter:description" property="og:description" content="Streams from Java 8 help us manipulate collections, but they ruin the idea of objects; decorators, on the other hand, do the same but in an object-oriented way. "/> <meta name="twitter:url" property="og:url" content="https://www.yegor256.com/2017/10/10/streams-vs-decorators.html"/> <meta name="telegram:channel" content="AAAAAEJFMRzsRTRxM3ec6A"/> <link rel="search" type="application/opensearchdescription+xml" href="/opensearch.xml" title="yegor256" /> <link rel="shortcut icon" href="/favicon.ico?4e047f6f42b"/> <link rel="apple-touch-icon" href="/favicon.ico?4e047f6f42b"/> <link rel="alternate" type="application/rss+xml" title="RSS for yegor256.com" href="https://www.yegor256.com/rss.xml"/> <link rel="stylesheet" href="/css/layout.css?4e047f6f42b"/> <link rel="stylesheet" href="/css/icons.css?4e047f6f42b"/> <link rel="canonical" href="https://www.yegor256.com/2017/10/10/streams-vs-decorators.html" /> <link rel="amphtml" href="https://www.yegor256.com/2017/10/10/streams-vs-decorators.amp.html" /> <title>Streams vs. Decorators </title> <meta name='og:image' content='https://www.yegor256.com/images/2017/10/la-haine.jpg'/><meta name='twitter:image' content='https://www.yegor256.com/images/2017/10/la-haine.jpg'/><meta name='og:image:width' content='1280'/> <meta name='twitter:image:width' content='1280'/><meta name='og:image:height' content='694'/> <meta name='twitter:image:height' content='694'/><meta name='twitter:card' content='summary_large_image'/><meta name='twitter:image:alt' content='La Haine (1995) by Mathieu Kassovitz'/> </head> <body><div class="wrapper"> <aside class="header-toggle unprintable" id="header-toggle" title="Show the menu" onclick="$('#header').show();$('#header-toggle').hide();">&#9776;</aside> <header class="header" id="header"><div class="face"> <a href="/about-me.html#form" class="sub" title="Click to subscribe to my monthly newsletter"><span>Subscribe</span></a> <a href="/about-me.html" style="position:relative;"> <img src="/images/face-256x256.jpg" class="photo" alt="Yegor Bugayenko"/> </a></div><nav><ul class="menu social notranslate"> <li><a href="https://twitter.com/intent/follow?screen_name=yegor256" rel="nofollow" title="Follow me on Twitter"><i class="icon icon-twitter notranslate" aria-hidden="true"></i></a></li> <li><a href="/rss.xml" rel="nofollow" title="Subscribe to my RSS feed"><i class="icon icon-rss notranslate" aria-hidden="true"></i></a></li> <li><a itemprop="sameAs" href="https://github.com/yegor256" rel="nofollow" title="My GitHub profile"><i class="icon icon-github notranslate" aria-hidden="true"></i></a></li> <li><a itemprop="sameAs" href="http://stackoverflow.com/users/187141/yegor256" rel="nofollow" title="My StackOverflow profile"><i class="icon icon-stackoverflow notranslate" aria-hidden="true"></i></a></li> <li><a itemprop="sameAs" href="https://www.facebook.com/yegor256" rel="nofollow" title="Follow me on Facebook"><i class="icon icon-facebook notranslate" aria-hidden="true"></i></a></li> <li><a itemprop="sameAs" href="https://instagram.com/yegor256" rel="nofollow" title="Follow me on Instagram"><i class="icon icon-instagram notranslate" aria-hidden="true"></i></a></li> <li><a itemprop="sameAs" href="https://www.linkedin.com/in/yegor256" rel="nofollow" title="My LinkedIn profile"><i class="icon icon-linkedin notranslate" aria-hidden="true"></i></a></li> <li><a itemprop="sameAs" href="https://www.youtube.com/c/yegor256?sub_confirmation=1" rel="nofollow" title="My Youtube video channel"><i class="icon icon-youtube notranslate" aria-hidden="true"></i></a></li> <li><a itemprop="sameAs" href="https://www.pinterest.com/yegor256/" rel="nofollow" title="My Pinterest boards"><i class="icon icon-pinterest notranslate" aria-hidden="true"></i></a></li> <li><a itemprop="sameAs" href="https://angel.co/yegor256" rel="nofollow" title="My AngelList profile"><i class="icon icon-angellist notranslate" aria-hidden="true"></i></a></li> <li><a href="https://soundcloud.com/yegor256" rel="nofollow" title="My podcast"><i class="icon icon-podcast notranslate" aria-hidden="true"></i></a></li> <li><a href="https://itunes.apple.com/us/podcast/yegor256-podcast/id1150826721" rel="nofollow" title="My iTunes podcast"><i class="icon icon-itunes notranslate" aria-hidden="true"></i></a></li> <li><a href="https://t.me/joinchat/AAAAAEJFMRzsRTRxM3ec6A" rel="nofollow" title="My Telegram public channel"><i class="icon icon-telegram notranslate" aria-hidden="true"></i></a></li> <li><a href="mailto:blog@yegor256.com" rel="nofollow" title="Email me any time"><i class="icon icon-mail notranslate" aria-hidden="true"></i></a></li></ul><ul class="menu"> <li><a href="/" title="Home page">Home</a></li> <li ><a href="/best.html" title="Best articles to read">12&#160;Best</a></li> <li ><a href="/contents.html" title="The contents of the entire blog">All&#160;288</a></li> <li ><a href="/webinars.html" title="My webinars">Webinars</a></li> <li ><a href="/talks.html" title="Future and past conference talks">Talks</a></li> <li ><a href="/books.html" title="The books I wrote">Books</a></li> <li ><a href="/papers.html" title="My academic papers and patents">Papers</a></li> <li ><a href="/pets.html" title="My loved pet projects">Pets</a></li> <li ><a href="/award.html" title="Software quality award">Award</a></li> <li ><a href="/testimonials.html" title="What some people say about me">Testimonials</a></li> <li ><a href="/shift-m.html" title="Audio podcast about project management">Shift-M</a></li> <li ><a href="/paintings.html" title="My paintings for sale">Paintings</a></li> <li><a href="http://ru.yegor256.com/" title="Немного на русском языке">По-русски</a></li></ul></nav><div class="search"> <form method="get" action="https://www.google.com/search" itemprop="potentialAction" itemscope="" itemtype="http://schema.org/SearchAction"> <meta itemprop="target" content="https://www.google.com/search?q={q}"/> <input name="sitesearch" value="yegor256.com" type="hidden"/> <input itemprop="query-input" type="text" id="search-query" class="field field-text" required="required" onfocus="$('.google').css('visibility', 'visible');" name="q" placeholder="Search..." autocomplete="off"/> <input type="image" src="/images/google-search-icon.svg" class="google" title="Search via Google" alt="Search via Google"/> </form></div><div class="hot"><ul> <li> <a href="/code-ahead.html">Code Ahead</a> was published on Amazon just a few days ago! It is my new book, a novel about programmers. It explains in details the majority of ideas that stand behind <a href="https://www.zerocracy.com">Zerocracy</a> and <a href="https://www.xdsd.org">XDSD</a>. </li> <li> At <a href="/webinars.html">Webinar #37</a> we will discuss naming problem in OOP, for objects, methods and attributes; join us on <b>September 12</b>, at 11am PST. </li></ul></div></header></div><section itemscope="" itemtype="http://schema.org/BlogPosting"><div class="wrapper"> <header><p class="printable"> <img src="https://api.qrserver.com/v1/create-qr-code/?data=https://www.yegor256.com/2017/10/10/streams-vs-decorators.html&amp;format=svg" style="width:125px;height:125px;" alt="QR code"/></p><p class="printable"> <code itemprop="url">https://www.yegor256.com/2017/10/10/streams-vs-decorators.html</code></p><h1 itemprop="name headline mainEntityOfPage">Streams vs. Decorators</h1><ul class="subline"> <li> <time itemprop="datePublished" datetime="2017-10-10T00:00:00+00:00"> 10 October 2017 </time> </li> <li class="desktop-only" itemprop="locationCreated">Odessa, Ukraine</li> <li class="printable" itemscope="" itemprop="author" itemtype="http://schema.org/Person"> <span itemprop="name">Yegor Bugayenko</span> </li> <li class="unprintable"> <i class="icon icon-comments"></i> <a href="http://www.yegor256.com/2017/10/10/streams-vs-decorators.html#disqus_thread" itemprop="discussionUrl">comments</a> </li></ul><ul class="subline"> <li>Discussed at:</li> <li><a href="https://dzone.com/articles/streams-vs-decorators">dzone</a></li></ul><figure class='jb_picture'><img itemprop='image' alt='La Haine (1995) by Mathieu Kassovitz' src='/images/2017/10/la-haine.jpg' longdesc='#f2d417e0'/><figcaption id='f2d417e0'>La Haine (1995) by Mathieu Kassovitz</figcaption></figure><p>Here is a primitive example. Let&#39;s say we have a collection of measurements coming in from some data source, they are all numbers between zero and one:</p><figure class="highlight"><pre><code class="language-java" data-lang="java"><span></span><span class="n">Iterable</span><span class="o">&lt;</span><span class="n">Double</span><span class="o">&gt;</span> <span class="n">probes</span><span class="o">;</span></code></pre></figure><p>Now, we need to show only the first 10 of them, ignoring zeros and ones, and re-scaling them to <code>(0..100)</code>. Sounds like an easy task, right? There are three ways to do it: procedural, object-oriented, and the Java&nbsp;8 way. Let&#39;s start with the procedural way:</p><figure class="highlight"><pre><code class="language-java" data-lang="java"><span></span><span class="kt">int</span> <span class="n">pos</span> <span class="o">=</span> <span class="mi">0</span><span class="o">;</span>
<span class="k">for</span> <span class="o">(</span><span class="n">Double</span> <span class="n">probe</span> <span class="o">:</span> <span class="n">probes</span><span class="o">)</span> <span class="o">{</span>
  <span class="k">if</span> <span class="o">(</span><span class="n">probe</span> <span class="o">==</span> <span class="mf">0.0d</span> <span class="o">||</span> <span class="n">probe</span> <span class="o">==</span> <span class="mf">1.0d</span><span class="o">)</span> <span class="o">{</span>
    <span class="k">continue</span><span class="o">;</span>
  <span class="o">}</span>
  <span class="k">if</span> <span class="o">(++</span><span class="n">pos</span> <span class="o">&gt;</span> <span class="mi">10</span><span class="o">)</span> <span class="o">{</span>
    <span class="k">break</span><span class="o">;</span>
  <span class="o">}</span>
  <span class="n">System</span><span class="o">.</span><span class="na">out</span><span class="o">.</span><span class="na">printf</span><span class="o">(</span>
    <span class="s">&quot;Probe #%d: %f&quot;</span><span class="o">,</span> <span class="n">pos</span><span class="o">,</span> <span class="n">probe</span> <span class="o">*</span> <span class="mf">100.0d</span>
  <span class="o">);</span>
<span class="o">}</span></code></pre></figure><p>Why is this a procedural way? Because it&#39;s imperative. Why is it imperative? Because it&#39;s procedural. Nah, I&#39;m kidding.</p><p>It&#39;s imperative because we&#39;re giving instructions to the computer about what data to put where and how to iterate through it. We&#39;re not declaring the result, but imperatively building it. It works, but it&#39;s not really scalable. We can&#39;t take part of this algorithm and apply it to another use case. We can&#39;t really modify it easily, for example to take numbers from two sources instead of one, etc. It&#39;s procedural. Enough said. Don&#39;t do it this way.</p><p>Now, Java&nbsp;8 gives us the <a href="http://www.oracle.com/technetwork/articles/java/ma14-java-se-8-streams-2177646.html">Streams API</a>, which is supposed to offer a functional way to do the same. Let&#39;s try to use it.</p><p>First, we need to create an instance of <a href="https://docs.oracle.com/javase/8/docs/api/java/util/stream/Stream.html"><code>Stream</code></a>, which <a href="https://docs.oracle.com/javase/8/docs/api/java/lang/Iterable.html"><code>Iterable</code></a> <a href="https://stackoverflow.com/questions/23114015/">doesn&#39;t</a> let us obtain directly. Then we use the stream API to do the job:</p><figure class="highlight"><pre><code class="language-java" data-lang="java"><span></span><span class="n">StreamSupport</span><span class="o">.</span><span class="na">stream</span><span class="o">(</span><span class="n">probes</span><span class="o">.</span><span class="na">spliterator</span><span class="o">(),</span> <span class="kc">false</span><span class="o">)</span>
  <span class="o">.</span><span class="na">filter</span><span class="o">(</span><span class="n">p</span> <span class="o">-&gt;</span> <span class="n">p</span> <span class="o">==</span> <span class="mf">0.0d</span> <span class="o">||</span> <span class="n">p</span> <span class="o">==</span> <span class="mf">1.0d</span><span class="o">)</span>
  <span class="o">.</span><span class="na">limit</span><span class="o">(</span><span class="mi">10L</span><span class="o">)</span>
  <span class="o">.</span><span class="na">forEach</span><span class="o">(</span>
    <span class="n">probe</span> <span class="o">-&gt;</span> <span class="n">System</span><span class="o">.</span><span class="na">out</span><span class="o">.</span><span class="na">printf</span><span class="o">(</span>
      <span class="s">&quot;Probe #%d: %f&quot;</span><span class="o">,</span> <span class="mi">0</span><span class="o">,</span> <span class="n">probe</span> <span class="o">*</span> <span class="mf">100.0d</span>
    <span class="o">)</span>
  <span class="o">);</span></code></pre></figure><p>This will work, but will say <code>Probe #0</code> for all probes, because <code>forEach()</code> doesn&#39;t work with indexes. There is no such thing as <code>forEachWithIndex()</code> in the <a href="https://docs.oracle.com/javase/8/docs/api/java/util/stream/Stream.html"><code>Stream</code></a> interface as of Java&nbsp;8 (and Java&nbsp;9 <a href="http://download.java.net/java/jdk9/docs/api/java/util/stream/Stream.html">too</a>). Here is a <a href="https://stackoverflow.com/a/18552071/187141">workaround</a> with an atomic counter:</p><figure class="highlight"><pre><code class="language-java" data-lang="java"><span></span><span class="n">AtomicInteger</span> <span class="n">index</span> <span class="o">=</span> <span class="k">new</span> <span class="n">AtomicInteger</span><span class="o">();</span>
<span class="n">StreamSupport</span><span class="o">.</span><span class="na">stream</span><span class="o">(</span><span class="n">probes</span><span class="o">.</span><span class="na">spliterator</span><span class="o">(),</span> <span class="kc">false</span><span class="o">)</span>
  <span class="o">.</span><span class="na">filter</span><span class="o">(</span><span class="n">probe</span> <span class="o">-&gt;</span> <span class="n">probe</span> <span class="o">!=</span> <span class="mf">0.0d</span> <span class="o">&amp;&amp;</span> <span class="n">probe</span> <span class="o">!=</span> <span class="mf">1.0d</span><span class="o">)</span>
  <span class="o">.</span><span class="na">limit</span><span class="o">(</span><span class="mi">10L</span><span class="o">)</span>
  <span class="o">.</span><span class="na">forEach</span><span class="o">(</span>
    <span class="n">probe</span> <span class="o">-&gt;</span> <span class="n">System</span><span class="o">.</span><span class="na">out</span><span class="o">.</span><span class="na">printf</span><span class="o">(</span>
      <span class="s">&quot;Probe #%d: %f&quot;</span><span class="o">,</span>
      <span class="n">index</span><span class="o">.</span><span class="na">getAndIncrement</span><span class="o">(),</span>
      <span class="n">probe</span> <span class="o">*</span> <span class="mf">100.0d</span>
    <span class="o">)</span>
  <span class="o">);</span></code></pre></figure><p>&quot;What&#39;s wrong with that?&quot; you may ask. First, see how easily we got into trouble when we didn&#39;t find the right method in the <code>Stream</code> interface. We immediately fell off the &quot;streaming&quot; paradigm and got back to the good old procedural global variable (the counter). Second, we don&#39;t really see what&#39;s going on inside those <code>filter()</code>, <code>limit()</code>, and <code>forEach()</code> methods. How exactly do they work? The documentation says that this approach is &quot;declarative&quot; and each method in the <code>Stream</code> interface returns an instance of some class. What classes are they? We have no idea by just looking at this code.</p><aside class='quote'>The biggest issue with this streaming API is the very interface Stream, it's huge!</aside><p>These two problems are connected. The biggest issue with this streaming API is the very interface <code>Stream</code>---it&#39;s huge. At the time of writing there are 43 methods. Forty three, in a single interface! This is against each and every <a href="/2014/11/20/seven-virtues-of-good-object.html">principle</a> of object-oriented programming, starting with <a href="/2017/03/28/solid.html">SOLID</a> and then up to more serious ones.</p><p>What is the object-oriented way to implement the same algorithm? Here is how I would do it with <a href="http://www.cactoos.org">Cactoos</a>, which is just a collection of <del>primitive</del> simple Java classes:</p><figure class="highlight"><pre><code class="language-java" data-lang="java"><span></span><span class="k">new</span> <span class="n">And</span><span class="o">(</span>
  <span class="k">new</span> <span class="n">Mapped</span><span class="o">&lt;</span><span class="n">Double</span><span class="o">,</span> <span class="n">Scalar</span><span class="o">&lt;</span><span class="n">Boolean</span><span class="o">&gt;&gt;(</span>
    <span class="k">new</span> <span class="n">Limited</span><span class="o">&lt;</span><span class="n">Double</span><span class="o">&gt;(</span>
      <span class="k">new</span> <span class="n">Filtered</span><span class="o">&lt;</span><span class="n">Double</span><span class="o">&gt;(</span>
        <span class="n">probes</span><span class="o">,</span>
        <span class="n">probe</span> <span class="o">-&gt;</span> <span class="n">probe</span> <span class="o">!=</span> <span class="mf">0.0d</span> <span class="o">&amp;&amp;</span> <span class="n">probe</span> <span class="o">!=</span> <span class="mf">1.0d</span>
      <span class="o">),</span>
      <span class="mi">10</span>
    <span class="o">),</span>
    <span class="n">probe</span> <span class="o">-&gt;</span> <span class="o">()</span> <span class="o">-&gt;</span> <span class="o">{</span>
      <span class="n">System</span><span class="o">.</span><span class="na">out</span><span class="o">.</span><span class="na">printf</span><span class="o">(</span>
        <span class="s">&quot;Probe #%d: %f&quot;</span><span class="o">,</span> <span class="mi">0</span><span class="o">,</span> <span class="n">probe</span> <span class="o">*</span> <span class="mf">100.0d</span>
      <span class="o">);</span>
      <span class="k">return</span> <span class="kc">true</span><span class="o">;</span>
    <span class="o">}</span>
  <span class="o">)</span>
<span class="o">).</span><span class="na">value</span><span class="o">();</span></code></pre></figure><p>Let&#39;s see what&#39;s going on here. First, <a href="http://static.javadoc.io/org.cactoos/cactoos/0.16/org/cactoos/iterable/Filtered.html"><code>Filtered</code></a> decorates our iterable <code>probes</code> to take certain items out of it. Notice that <code>Filtered</code> implements <code>Iterable</code>. Then <a href="http://static.javadoc.io/org.cactoos/cactoos/0.16/org/cactoos/iterable/Limited.html"><code>Limited</code></a>, also being an <code>Iterable</code>, takes only the first ten items out. Then <a href="http://static.javadoc.io/org.cactoos/cactoos/0.16/org/cactoos/iterable/Mapped.html"><code>Mapped</code></a> converts each probe into an instance of <a href="http://static.javadoc.io/org.cactoos/cactoos/0.16/org/cactoos/Scalar.html"><code>Scalar&lt;Boolean&gt;</code></a>, which does the line printing.</p><p>Finally, the instance of <code>And</code> goes through the list of &quot;scalars&quot; and ask each of them to return <code>boolean</code>. They print the line and return <code>true</code>. Since it&#39;s <code>true</code>, <code>And</code> makes the next attempt with the next scalar. Finally, its method <code>value()</code> returns <code>true</code>.</p><p>But wait, there are no indexes. Let&#39;s add them. In order to do that we just use another class, called <code>AndWithIndex</code>:</p><figure class="highlight"><pre><code class="language-java" data-lang="java"><span></span><span class="k">new</span> <span class="n">AndWithIndex</span><span class="o">(</span>
  <span class="k">new</span> <span class="n">Mapped</span><span class="o">&lt;</span><span class="n">Double</span><span class="o">,</span> <span class="n">Func</span><span class="o">&lt;</span><span class="n">Integer</span><span class="o">,</span> <span class="n">Boolean</span><span class="o">&gt;&gt;(</span>
    <span class="k">new</span> <span class="n">Limited</span><span class="o">&lt;</span><span class="n">Double</span><span class="o">&gt;(</span>
      <span class="k">new</span> <span class="n">Filtered</span><span class="o">&lt;</span><span class="n">Double</span><span class="o">&gt;(</span>
        <span class="n">probes</span><span class="o">,</span>
        <span class="n">probe</span> <span class="o">-&gt;</span> <span class="n">probe</span> <span class="o">!=</span> <span class="mf">0.0d</span> <span class="o">&amp;&amp;</span> <span class="n">probe</span> <span class="o">!=</span> <span class="mf">1.0d</span>
      <span class="o">),</span>
      <span class="mi">10</span>
    <span class="o">),</span>
    <span class="n">probe</span> <span class="o">-&gt;</span> <span class="n">index</span> <span class="o">-&gt;</span> <span class="o">{</span>
      <span class="n">System</span><span class="o">.</span><span class="na">out</span><span class="o">.</span><span class="na">printf</span><span class="o">(</span>
        <span class="s">&quot;Probe #%d: %f&quot;</span><span class="o">,</span> <span class="n">index</span><span class="o">,</span> <span class="n">probe</span> <span class="o">*</span> <span class="mf">100.0d</span>
      <span class="o">);</span>
      <span class="k">return</span> <span class="kc">true</span><span class="o">;</span>
    <span class="o">}</span>
  <span class="o">)</span>
<span class="o">).</span><span class="na">value</span><span class="o">();</span></code></pre></figure><p>Instead of <code>Scalar&lt;Boolean&gt;</code> we now map our probes to <a href="http://static.javadoc.io/org.cactoos/cactoos/0.16/org/cactoos/Func.html"><code>Func&lt;Integer, Boolean&gt;</code></a> to let them accept the index.</p><p>The beauty of this approach is that all classes and interfaces are small and that&#39;s why they&#39;re very composable. To make an iterable of probes limited we decorate it with <code>Limited</code>; to make it filtered we decorate it with <code>Filtered</code>; to do something else we create a new decorator and use it. We&#39;re not stuck to one single interface like <code>Stream</code>.</p><p>The bottom line is that decorators are an object-oriented instrument to modify the behavior of collections, while streams is something else which I can&#39;t even find the name for.</p><p>P.S. By the way, this is how the same algorithm can be implemented with the help of Guava&#39;s <a href="https://google.github.io/guava/releases/21.0/api/docs/com/google/common/collect/Iterables.html"><code>Iterables</code></a>:</p><figure class="highlight"><pre><code class="language-java" data-lang="java"><span></span><span class="n">Iterable</span><span class="o">&lt;</span><span class="n">Double</span><span class="o">&gt;</span> <span class="n">ready</span> <span class="o">=</span> <span class="n">Iterables</span><span class="o">.</span><span class="na">limit</span><span class="o">(</span>
  <span class="n">Iterables</span><span class="o">.</span><span class="na">filter</span><span class="o">(</span>
    <span class="n">probes</span><span class="o">,</span>
    <span class="n">probe</span> <span class="o">-&gt;</span> <span class="n">probe</span> <span class="o">!=</span> <span class="mf">0.0d</span> <span class="o">&amp;&amp;</span> <span class="n">probe</span> <span class="o">!=</span> <span class="mf">1.0d</span>
  <span class="o">),</span>
  <span class="mi">10</span>
<span class="o">);</span>
<span class="kt">int</span> <span class="n">pos</span> <span class="o">=</span> <span class="mi">0</span><span class="o">;</span>
<span class="k">for</span> <span class="o">(</span><span class="n">Double</span> <span class="n">probe</span> <span class="o">:</span> <span class="n">probes</span><span class="o">)</span> <span class="o">{</span>
  <span class="n">System</span><span class="o">.</span><span class="na">out</span><span class="o">.</span><span class="na">printf</span><span class="o">(</span>
    <span class="s">&quot;Probe #%d: %f&quot;</span><span class="o">,</span> <span class="n">pos</span><span class="o">++,</span> <span class="n">probe</span> <span class="o">*</span> <span class="mf">100.0d</span>
  <span class="o">);</span>
<span class="o">}</span></code></pre></figure><p>This is some weird combination of object-oriented and functional styles.</p></p>--> <nav class="buttons notranslate desktop-only"> <a href="http://www.facebook.com/sharer/sharer.php?u=https://www.yegor256.com/2017/10/10/streams-vs-decorators.html" title="Share on Facebook" class="button" rel="nofollow"> <span class="count count-facebook">0</span> <i class="icon icon-facebook notranslate" aria-hidden="true"></i> </a> <a href="https://twitter.com/share?url=https://www.yegor256.com/2017/10/10/streams-vs-decorators.html&amp;text=Streams+vs.+Decorators" title="Share on Twitter" class="button" rel="nofollow"> <span class="count count-twitter">0</span> <i class="icon icon-twitter notranslate" aria-hidden="true"></i> </a> <a href="https://plus.google.com/share?url=https://www.yegor256.com/2017/10/10/streams-vs-decorators.html" title="Share on Google+" class="button" rel="nofollow"> <span class="count count-googleplus">0</span> <i class="icon icon-googleplus notranslate" aria-hidden="true"></i> </a> <a href="https://www.linkedin.com/cws/share?url=https://www.yegor256.com/2017/10/10/streams-vs-decorators.html" title="Share on LinkedIn" class="button" rel="nofollow"> <span class="count count-linkedin">0</span> <i class="icon icon-linkedin notranslate" aria-hidden="true"></i> </a> <a href="http://reddit.com/submit?url=https://www.yegor256.com/2017/10/10/streams-vs-decorators.html%3F2017-41&amp;title=Streams+vs.+Decorators" title="Share on Reddit" class="button" rel="nofollow"> <span class="count count-reddit">0</span> <i class="icon icon-reddit notranslate" aria-hidden="true"></i> </a> <a href="http://news.ycombinator.com/submitlink?u=https://www.yegor256.com/2017/10/10/streams-vs-decorators.html%3F2017-41&amp;t=Streams+vs.+Decorators" title="Share on Hacker News" class="button" rel="nofollow"> <span class="count count-hackernews">0</span> <i class="icon icon-hackernews notranslate" aria-hidden="true"></i> </a> </nav> </header> <article class="main" itemprop="articleBody"><div ><p>The <a href="http://www.oracle.com/technetwork/articles/java/ma14-java-se-8-streams-2177646.html">Streams API</a> was introduced in Java&nbsp;8, together with <a href="http://openjdk.java.net/projects/lambda/">lambda expressions</a>, just a few years ago. I, as a disciplined Java adept, tried to use this new feature in a few of my projects, for example <a href="https://github.com/yegor256/jare/blob/0.11/src/main/java/io/jare/dynamo/DyUser.java#L85-L88">here</a> and <a href="https://github.com/yegor256/wring/blob/0.17.2/src/main/java/io/wring/dynamo/DyEvents.java#L95-L98">here</a>. I didn&#39;t really like it and went back to good old decorators. Moreover, I created <a href="http://www.cactoos.org">Cactoos</a>, a library of decorators, to replace <a href="https://github.com/google/guava">Guava</a>, which is not so good in so many places.</p><figure class='jb_picture'><img itemprop='image' alt='La Haine (1995) by Mathieu Kassovitz' src='/images/2017/10/la-haine.jpg' longdesc='#f2d417e0'/><figcaption id='f2d417e0'>La Haine (1995) by Mathieu Kassovitz</figcaption></figure><p>Here is a primitive example. Let&#39;s say we have a collection of measurements coming in from some data source, they are all numbers between zero and one:</p><figure class="highlight"><pre><code class="language-java" data-lang="java"><span></span><span class="n">Iterable</span><span class="o">&lt;</span><span class="n">Double</span><span class="o">&gt;</span> <span class="n">probes</span><span class="o">;</span></code></pre></figure><p>Now, we need to show only the first 10 of them, ignoring zeros and ones, and re-scaling them to <code>(0..100)</code>. Sounds like an easy task, right? There are three ways to do it: procedural, object-oriented, and the Java&nbsp;8 way. Let&#39;s start with the procedural way:</p><figure class="highlight"><pre><code class="language-java" data-lang="java"><span></span><span class="kt">int</span> <span class="n">pos</span> <span class="o">=</span> <span class="mi">0</span><span class="o">;</span>
<span class="k">for</span> <span class="o">(</span><span class="n">Double</span> <span class="n">probe</span> <span class="o">:</span> <span class="n">probes</span><span class="o">)</span> <span class="o">{</span>
  <span class="k">if</span> <span class="o">(</span><span class="n">probe</span> <span class="o">==</span> <span class="mf">0.0d</span> <span class="o">||</span> <span class="n">probe</span> <span class="o">==</span> <span class="mf">1.0d</span><span class="o">)</span> <span class="o">{</span>
    <span class="k">continue</span><span class="o">;</span>
  <span class="o">}</span>
  <span class="k">if</span> <span class="o">(++</span><span class="n">pos</span> <span class="o">&gt;</span> <span class="mi">10</span><span class="o">)</span> <span class="o">{</span>
    <span class="k">break</span><span class="o">;</span>
  <span class="o">}</span>
  <span class="n">System</span><span class="o">.</span><span class="na">out</span><span class="o">.</span><span class="na">printf</span><span class="o">(</span>
    <span class="s">&quot;Probe #%d: %f&quot;</span><span class="o">,</span> <span class="n">pos</span><span class="o">,</span> <span class="n">probe</span> <span class="o">*</span> <span class="mf">100.0d</span>
  <span class="o">);</span>
<span class="o">}</span></code></pre></figure><p>Why is this a procedural way? Because it&#39;s imperative. Why is it imperative? Because it&#39;s procedural. Nah, I&#39;m kidding.</p><p>It&#39;s imperative because we&#39;re giving instructions to the computer about what data to put where and how to iterate through it. We&#39;re not declaring the result, but imperatively building it. It works, but it&#39;s not really scalable. We can&#39;t take part of this algorithm and apply it to another use case. We can&#39;t really modify it easily, for example to take numbers from two sources instead of one, etc. It&#39;s procedural. Enough said. Don&#39;t do it this way.</p><p>Now, Java&nbsp;8 gives us the <a href="http://www.oracle.com/technetwork/articles/java/ma14-java-se-8-streams-2177646.html">Streams API</a>, which is supposed to offer a functional way to do the same. Let&#39;s try to use it.</p><p>First, we need to create an instance of <a href="https://docs.oracle.com/javase/8/docs/api/java/util/stream/Stream.html"><code>Stream</code></a>, which <a href="https://docs.oracle.com/javase/8/docs/api/java/lang/Iterable.html"><code>Iterable</code></a> <a href="https://stackoverflow.com/questions/23114015/">doesn&#39;t</a> let us obtain directly. Then we use the stream API to do the job:</p><figure class="highlight"><pre><code class="language-java" data-lang="java"><span></span><span class="n">StreamSupport</span><span class="o">.</span><span class="na">stream</span><span class="o">(</span><span class="n">probes</span><span class="o">.</span><span class="na">spliterator</span><span class="o">(),</span> <span class="kc">false</span><span class="o">)</span>
  <span class="o">.</span><span class="na">filter</span><span class="o">(</span><span class="n">p</span> <span class="o">-&gt;</span> <span class="n">p</span> <span class="o">==</span> <span class="mf">0.0d</span> <span class="o">||</span> <span class="n">p</span> <span class="o">==</span> <span class="mf">1.0d</span><span class="o">)</span>
  <span class="o">.</span><span class="na">limit</span><span class="o">(</span><span class="mi">10L</span><span class="o">)</span>
  <span class="o">.</span><span class="na">forEach</span><span class="o">(</span>
    <span class="n">probe</span> <span class="o">-&gt;</span> <span class="n">System</span><span class="o">.</span><span class="na">out</span><span class="o">.</span><span class="na">printf</span><span class="o">(</span>
      <span class="s">&quot;Probe #%d: %f&quot;</span><span class="o">,</span> <span class="mi">0</span><span class="o">,</span> <span class="n">probe</span> <span class="o">*</span> <span class="mf">100.0d</span>
    <span class="o">)</span>
  <span class="o">);</span></code></pre></figure><p>This will work, but will say <code>Probe #0</code> for all probes, because <code>forEach()</code> doesn&#39;t work with indexes. There is no such thing as <code>forEachWithIndex()</code> in the <a href="https://docs.oracle.com/javase/8/docs/api/java/util/stream/Stream.html"><code>Stream</code></a> interface as of Java&nbsp;8 (and Java&nbsp;9 <a href="http://download.java.net/java/jdk9/docs/api/java/util/stream/Stream.html">too</a>). Here is a <a href="https://stackoverflow.com/a/18552071/187141">workaround</a> with an atomic counter:</p><figure class="highlight"><pre><code class="language-java" data-lang="java"><span></span><span class="n">AtomicInteger</span> <span class="n">index</span> <span class="o">=</span> <span class="k">new</span> <span class="n">AtomicInteger</span><span class="o">();</span>
<span class="n">StreamSupport</span><span class="o">.</span><span class="na">stream</span><span class="o">(</span><span class="n">probes</span><span class="o">.</span><span class="na">spliterator</span><span class="o">(),</span> <span class="kc">false</span><span class="o">)</span>
  <span class="o">.</span><span class="na">filter</span><span class="o">(</span><span class="n">probe</span> <span class="o">-&gt;</span> <span class="n">probe</span> <span class="o">!=</span> <span class="mf">0.0d</span> <span class="o">&amp;&amp;</span> <span class="n">probe</span> <span class="o">!=</span> <span class="mf">1.0d</span><span class="o">)</span>
  <span class="o">.</span><span class="na">limit</span><span class="o">(</span><span class="mi">10L</span><span class="o">)</span>
  <span class="o">.</span><span class="na">forEach</span><span class="o">(</span>
    <span class="n">probe</span> <span class="o">-&gt;</span> <span class="n">System</span><span class="o">.</span><span class="na">out</span><span class="o">.</span><span class="na">printf</span><span class="o">(</span>
      <span class="s">&quot;Probe #%d: %f&quot;</span><span class="o">,</span>
      <span class="n">index</span><span class="o">.</span><span class="na">getAndIncrement</span><span class="o">(),</span>
      <span class="n">probe</span> <span class="o">*</span> <span class="mf">100.0d</span>
    <span class="o">)</span>
  <span class="o">);</span></code></pre></figure><p>&quot;What&#39;s wrong with that?&quot; you may ask. First, see how easily we got into trouble when we didn&#39;t find the right method in the <code>Stream</code> interface. We immediately fell off the &quot;streaming&quot; paradigm and got back to the good old procedural global variable (the counter). Second, we don&#39;t really see what&#39;s going on inside those <code>filter()</code>, <code>limit()</code>, and <code>forEach()</code> methods. How exactly do they work? The documentation says that this approach is &quot;declarative&quot; and each method in the <code>Stream</code> interface returns an instance of some class. What classes are they? We have no idea by just looking at this code.</p><aside class='quote'>The biggest issue with this streaming API is the very interface Stream, it's huge!</aside><p>These two problems are connected. The biggest issue with this streaming API is the very interface <code>Stream</code>---it&#39;s huge. At the time of writing there are 43 methods. Forty three, in a single interface! This is against each and every <a href="/2014/11/20/seven-virtues-of-good-object.html">principle</a> of object-oriented programming, starting with <a href="/2017/03/28/solid.html">SOLID</a> and then up to more serious ones.</p><p>What is the object-oriented way to implement the same algorithm? Here is how I would do it with <a href="http://www.cactoos.org">Cactoos</a>, which is just a collection of <del>primitive</del> simple Java classes:</p><figure class="highlight"><pre><code class="language-java" data-lang="java"><span></span><span class="k">new</span> <span class="n">And</span><span class="o">(</span>
  <span class="k">new</span> <span class="n">Mapped</span><span class="o">&lt;</span><span class="n">Double</span><span class="o">,</span> <span class="n">Scalar</span><span class="o">&lt;</span><span class="n">Boolean</span><span class="o">&gt;&gt;(</span>
    <span class="k">new</span> <span class="n">Limited</span><span class="o">&lt;</span><span class="n">Double</span><span class="o">&gt;(</span>
      <span class="k">new</span> <span class="n">Filtered</span><span class="o">&lt;</span><span class="n">Double</span><span class="o">&gt;(</span>
        <span class="n">probes</span><span class="o">,</span>
        <span class="n">probe</span> <span class="o">-&gt;</span> <span class="n">probe</span> <span class="o">!=</span> <span class="mf">0.0d</span> <span class="o">&amp;&amp;</span> <span class="n">probe</span> <span class="o">!=</span> <span class="mf">1.0d</span>
      <span class="o">),</span>
      <span class="mi">10</span>
    <span class="o">),</span>
    <span class="n">probe</span> <span class="o">-&gt;</span> <span class="o">()</span> <span class="o">-&gt;</span> <span class="o">{</span>
      <span class="n">System</span><span class="o">.</span><span class="na">out</span><span class="o">.</span><span class="na">printf</span><span class="o">(</span>
        <span class="s">&quot;Probe #%d: %f&quot;</span><span class="o">,</span> <span class="mi">0</span><span class="o">,</span> <span class="n">probe</span> <span class="o">*</span> <span class="mf">100.0d</span>
      <span class="o">);</span>
      <span class="k">return</span> <span class="kc">true</span><span class="o">;</span>
    <span class="o">}</span>
  <span class="o">)</span>
<span class="o">).</span><span class="na">value</span><span class="o">();</span></code></pre></figure><p>Let&#39;s see what&#39;s going on here. First, <a href="http://static.javadoc.io/org.cactoos/cactoos/0.16/org/cactoos/iterable/Filtered.html"><code>Filtered</code></a> decorates our iterable <code>probes</code> to take certain items out of it. Notice that <code>Filtered</code> implements <code>Iterable</code>. Then <a href="http://static.javadoc.io/org.cactoos/cactoos/0.16/org/cactoos/iterable/Limited.html"><code>Limited</code></a>, also being an <code>Iterable</code>, takes only the first ten items out. Then <a href="http://static.javadoc.io/org.cactoos/cactoos/0.16/org/cactoos/iterable/Mapped.html"><code>Mapped</code></a> converts each probe into an instance of <a href="http://static.javadoc.io/org.cactoos/cactoos/0.16/org/cactoos/Scalar.html"><code>Scalar&lt;Boolean&gt;</code></a>, which does the line printing.</p><p>Finally, the instance of <code>And</code> goes through the list of &quot;scalars&quot; and ask each of them to return <code>boolean</code>. They print the line and return <code>true</code>. Since it&#39;s <code>true</code>, <code>And</code> makes the next attempt with the next scalar. Finally, its method <code>value()</code> returns <code>true</code>.</p><p>But wait, there are no indexes. Let&#39;s add them. In order to do that we just use another class, called <code>AndWithIndex</code>:</p><figure class="highlight"><pre><code class="language-java" data-lang="java"><span></span><span class="k">new</span> <span class="n">AndWithIndex</span><span class="o">(</span>
  <span class="k">new</span> <span class="n">Mapped</span><span class="o">&lt;</span><span class="n">Double</span><span class="o">,</span> <span class="n">Func</span><span class="o">&lt;</span><span class="n">Integer</span><span class="o">,</span> <span class="n">Boolean</span><span class="o">&gt;&gt;(</span>
    <span class="k">new</span> <span class="n">Limited</span><span class="o">&lt;</span><span class="n">Double</span><span class="o">&gt;(</span>
      <span class="k">new</span> <span class="n">Filtered</span><span class="o">&lt;</span><span class="n">Double</span><span class="o">&gt;(</span>
        <span class="n">probes</span><span class="o">,</span>
        <span class="n">probe</span> <span class="o">-&gt;</span> <span class="n">probe</span> <span class="o">!=</span> <span class="mf">0.0d</span> <span class="o">&amp;&amp;</span> <span class="n">probe</span> <span class="o">!=</span> <span class="mf">1.0d</span>
      <span class="o">),</span>
      <span class="mi">10</span>
    <span class="o">),</span>
    <span class="n">probe</span> <span class="o">-&gt;</span> <span class="n">index</span> <span class="o">-&gt;</span> <span class="o">{</span>
      <span class="n">System</span><span class="o">.</span><span class="na">out</span><span class="o">.</span><span class="na">printf</span><span class="o">(</span>
        <span class="s">&quot;Probe #%d: %f&quot;</span><span class="o">,</span> <span class="n">index</span><span class="o">,</span> <span class="n">probe</span> <span class="o">*</span> <span class="mf">100.0d</span>
      <span class="o">);</span>
      <span class="k">return</span> <span class="kc">true</span><span class="o">;</span>
    <span class="o">}</span>
  <span class="o">)</span>
<span class="o">).</span><span class="na">value</span><span class="o">();</span></code></pre></figure><p>Instead of <code>Scalar&lt;Boolean&gt;</code> we now map our probes to <a href="http://static.javadoc.io/org.cactoos/cactoos/0.16/org/cactoos/Func.html"><code>Func&lt;Integer, Boolean&gt;</code></a> to let them accept the index.</p><p>The beauty of this approach is that all classes and interfaces are small and that&#39;s why they&#39;re very composable. To make an iterable of probes limited we decorate it with <code>Limited</code>; to make it filtered we decorate it with <code>Filtered</code>; to do something else we create a new decorator and use it. We&#39;re not stuck to one single interface like <code>Stream</code>.</p><p>The bottom line is that decorators are an object-oriented instrument to modify the behavior of collections, while streams is something else which I can&#39;t even find the name for.</p><p>P.S. By the way, this is how the same algorithm can be implemented with the help of Guava&#39;s <a href="https://google.github.io/guava/releases/21.0/api/docs/com/google/common/collect/Iterables.html"><code>Iterables</code></a>:</p><figure class="highlight"><pre><code class="language-java" data-lang="java"><span></span><span class="n">Iterable</span><span class="o">&lt;</span><span class="n">Double</span><span class="o">&gt;</span> <span class="n">ready</span> <span class="o">=</span> <span class="n">Iterables</span><span class="o">.</span><span class="na">limit</span><span class="o">(</span>
  <span class="n">Iterables</span><span class="o">.</span><span class="na">filter</span><span class="o">(</span>
    <span class="n">probes</span><span class="o">,</span>
    <span class="n">probe</span> <span class="o">-&gt;</span> <span class="n">probe</span> <span class="o">!=</span> <span class="mf">0.0d</span> <span class="o">&amp;&amp;</span> <span class="n">probe</span> <span class="o">!=</span> <span class="mf">1.0d</span>
  <span class="o">),</span>
  <span class="mi">10</span>
<span class="o">);</span>
<span class="kt">int</span> <span class="n">pos</span> <span class="o">=</span> <span class="mi">0</span><span class="o">;</span>
<span class="k">for</span> <span class="o">(</span><span class="n">Double</span> <span class="n">probe</span> <span class="o">:</span> <span class="n">probes</span><span class="o">)</span> <span class="o">{</span>
  <span class="n">System</span><span class="o">.</span><span class="na">out</span><span class="o">.</span><span class="na">printf</span><span class="o">(</span>
    <span class="s">&quot;Probe #%d: %f&quot;</span><span class="o">,</span> <span class="n">pos</span><span class="o">++,</span> <span class="n">probe</span> <span class="o">*</span> <span class="mf">100.0d</span>
  <span class="o">);</span>
<span class="o">}</span></code></pre></figure><p>This is some weird combination of object-oriented and functional styles.</p></div></article></div><div class="wrapper"> <related-posts /></div><div class="disqus" role="complementary"><p class="disqus_hint"> Please, use <a href="https://help.disqus.com/commenting/what-html-tags-are-allowed-within-comments">syntax highlighting</a> in your comments, to make them more readable.</p><div id="disqus_thread" class="disqus-thread"> <a>&nbsp;</a></div><script> var disqus_config = function () { this.page.url = document.location.href.split('?')[0].split('#')[0].replace('https://', 'http://'); this.page.identifier = this.page.url; }; (function() { var d = document, s = d.createElement('script'); s.src = '//yegor256.disqus.com/embed.js'; s.setAttribute('data-timestamp', +new Date()); (d.head || d.body).appendChild(s); })(); </script> <noscript><div><p class="red"> JavaScript is disabled in your browser, that's why you can't see comments under this post.</p></div></noscript></div><div class="wrapper"> <footer class="footer"><p> &copy; <span itemscope="" itemprop="copyrightHolder" itemtype="http://schema.org/Person"> <span itemprop="name">Yegor Bugayenko</span> </span> 2014&ndash;<span itemprop="copyrightYear">2018</span></p></footer></div></section><div class="wrapper unprintable" style="text-align:center;margin-top:2em;"> <a href="http://www.sixnines.io/h/3ba1652f"> <img src="//www.sixnines.io/b/3ba1652f?style=flat" alt="sixnines availability badge"/> </a></div><script src="//code.jquery.com/jquery-1.9.0.min.js"></script> <script src="/js/all.js?4e047f6f42b"></script> <script>var disqus_shortname = 'yegor256';</script> <script id="dsq-count-scr" src="//yegor256.disqus.com/count.js" async="async"></script> <script> (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){ (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o), m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m) })(window,document,'script','//www.google-analytics.com/analytics.js','ga'); ga('create', 'UA-1963507-32', 'auto'); ga('send', 'pageview'); </script> <script> Cd=document;Cr="&"+Math.random();Cp="&s=1"; Cd.cookie="b=b";if(Cd.cookie)Cp+="&c=1"; Cp+="&t="+(new Date()).getTimezoneOffset(); if(self!=top)Cp+="&f=1"; </script> <script> if(navigator.javaEnabled())Cp+="&j=1"; </script> <script> if(typeof(screen)!='undefined')Cp+="&w="+screen.width+"&h="+ screen.height+"&d="+(screen.colorDepth?screen.colorDepth:screen.pixelDepth); </script> <script> Cd.write("<img src='//c.hit.ua/hit?i=95870&g=0&x=2"+Cp+Cr+ "&r="+escape(Cd.referrer)+"&u="+escape(window.location.href)+ "' border='0' wi"+"dth='1' he"+"ight='1'/>"); </script> <script type="application/ld+json"> { "@context": "http://schema.org", "@type": "Person", "name": "Yegor Bugayenko", "url": "http://www.yegor256.com", "sameAs": [ "https://www.facebook.com/yegor256", "https://instagram.com/yegor256", "https://www.linkedin.com/in/yegor256", "https://twitter.com/yegor256", "https://github.com/yegor256", "https://www.pinterest.com/yegor256/" ] } </script> </body> </html> <!DOCTYPE html> <html xmlns="http://www.w3.org/1999/xhtml" lang="en-US" xml:lang="en-US" itemscope="" itemtype="http://schema.org/WebSite"> <head> <meta charset="utf-8"/> <meta name="description" content="Java platform is getting more mature, the JDK is getting bigger and the Java language is getting uglier, unfortunately. " /> <meta name="keywords" content="analysis of java 9, features of java 9, java 10, java 9, java 9 features" /> <meta name="viewport" content="width=device-width,minimum-scale=1,initial-scale=1"/> <meta name="google-site-verification" content="JEj_gQr2CPe2QKGw8XdMz0R7VboQIUbX3FlM-lwTq-8" /> <meta name="author" content="Yegor Bugayenko"> <meta name="article:published_time" content="2017-10-03 00:00:00 +0000"> <meta name="og:site_name" content="Yegor Bugayenko"/> <meta name="og:type" content="article" /> <meta name="og:locale" content="en_US" /> <meta name="twitter:account_id" content="4503599630178231" /> <meta name="twitter:creator" content="@yegor256"/> <meta name="twitter:site" content="@yegor256"/> <meta name="twitter:title" property="og:title" content="Java 9: The Good, The Bad, and Private Interface Methods"/> <meta name="twitter:description" property="og:description" content="Java platform is getting more mature, the JDK is getting bigger and the Java language is getting uglier, unfortunately. "/> <meta name="twitter:url" property="og:url" content="https://www.yegor256.com/2017/10/03/java9.html"/> <meta name="telegram:channel" content="AAAAAEJFMRzsRTRxM3ec6A"/> <link rel="search" type="application/opensearchdescription+xml" href="/opensearch.xml" title="yegor256" /> <link rel="shortcut icon" href="/favicon.ico?4e047f6f42b"/> <link rel="apple-touch-icon" href="/favicon.ico?4e047f6f42b"/> <link rel="alternate" type="application/rss+xml" title="RSS for yegor256.com" href="https://www.yegor256.com/rss.xml"/> <link rel="stylesheet" href="/css/layout.css?4e047f6f42b"/> <link rel="stylesheet" href="/css/icons.css?4e047f6f42b"/> <link rel="canonical" href="https://www.yegor256.com/2017/10/03/java9.html" /> <link rel="amphtml" href="https://www.yegor256.com/2017/10/03/java9.amp.html" /> <title>Java 9: The Good, The Bad, and Private Interface Methods </title> <meta name='og:image' content='https://www.yegor256.com/images/2017/10/birdman.jpg'/><meta name='twitter:image' content='https://www.yegor256.com/images/2017/10/birdman.jpg'/><meta name='og:image:width' content='1280'/> <meta name='twitter:image:width' content='1280'/><meta name='og:image:height' content='687'/> <meta name='twitter:image:height' content='687'/><meta name='twitter:card' content='summary_large_image'/><meta name='twitter:image:alt' content='Birdman (2014) by Alejandro G. Iñárritu'/> </head> <body><div class="wrapper"> <aside class="header-toggle unprintable" id="header-toggle" title="Show the menu" onclick="$('#header').show();$('#header-toggle').hide();">&#9776;</aside> <header class="header" id="header"><div class="face"> <a href="/about-me.html#form" class="sub" title="Click to subscribe to my monthly newsletter"><span>Subscribe</span></a> <a href="/about-me.html" style="position:relative;"> <img src="/images/face-256x256.jpg" class="photo" alt="Yegor Bugayenko"/> </a></div><nav><ul class="menu social notranslate"> <li><a href="https://twitter.com/intent/follow?screen_name=yegor256" rel="nofollow" title="Follow me on Twitter"><i class="icon icon-twitter notranslate" aria-hidden="true"></i></a></li> <li><a href="/rss.xml" rel="nofollow" title="Subscribe to my RSS feed"><i class="icon icon-rss notranslate" aria-hidden="true"></i></a></li> <li><a itemprop="sameAs" href="https://github.com/yegor256" rel="nofollow" title="My GitHub profile"><i class="icon icon-github notranslate" aria-hidden="true"></i></a></li> <li><a itemprop="sameAs" href="http://stackoverflow.com/users/187141/yegor256" rel="nofollow" title="My StackOverflow profile"><i class="icon icon-stackoverflow notranslate" aria-hidden="true"></i></a></li> <li><a itemprop="sameAs" href="https://www.facebook.com/yegor256" rel="nofollow" title="Follow me on Facebook"><i class="icon icon-facebook notranslate" aria-hidden="true"></i></a></li> <li><a itemprop="sameAs" href="https://instagram.com/yegor256" rel="nofollow" title="Follow me on Instagram"><i class="icon icon-instagram notranslate" aria-hidden="true"></i></a></li> <li><a itemprop="sameAs" href="https://www.linkedin.com/in/yegor256" rel="nofollow" title="My LinkedIn profile"><i class="icon icon-linkedin notranslate" aria-hidden="true"></i></a></li> <li><a itemprop="sameAs" href="https://www.youtube.com/c/yegor256?sub_confirmation=1" rel="nofollow" title="My Youtube video channel"><i class="icon icon-youtube notranslate" aria-hidden="true"></i></a></li> <li><a itemprop="sameAs" href="https://www.pinterest.com/yegor256/" rel="nofollow" title="My Pinterest boards"><i class="icon icon-pinterest notranslate" aria-hidden="true"></i></a></li> <li><a itemprop="sameAs" href="https://angel.co/yegor256" rel="nofollow" title="My AngelList profile"><i class="icon icon-angellist notranslate" aria-hidden="true"></i></a></li> <li><a href="https://soundcloud.com/yegor256" rel="nofollow" title="My podcast"><i class="icon icon-podcast notranslate" aria-hidden="true"></i></a></li> <li><a href="https://itunes.apple.com/us/podcast/yegor256-podcast/id1150826721" rel="nofollow" title="My iTunes podcast"><i class="icon icon-itunes notranslate" aria-hidden="true"></i></a></li> <li><a href="https://t.me/joinchat/AAAAAEJFMRzsRTRxM3ec6A" rel="nofollow" title="My Telegram public channel"><i class="icon icon-telegram notranslate" aria-hidden="true"></i></a></li> <li><a href="mailto:blog@yegor256.com" rel="nofollow" title="Email me any time"><i class="icon icon-mail notranslate" aria-hidden="true"></i></a></li></ul><ul class="menu"> <li><a href="/" title="Home page">Home</a></li> <li ><a href="/best.html" title="Best articles to read">12&#160;Best</a></li> <li ><a href="/contents.html" title="The contents of the entire blog">All&#160;288</a></li> <li ><a href="/webinars.html" title="My webinars">Webinars</a></li> <li ><a href="/talks.html" title="Future and past conference talks">Talks</a></li> <li ><a href="/books.html" title="The books I wrote">Books</a></li> <li ><a href="/papers.html" title="My academic papers and patents">Papers</a></li> <li ><a href="/pets.html" title="My loved pet projects">Pets</a></li> <li ><a href="/award.html" title="Software quality award">Award</a></li> <li ><a href="/testimonials.html" title="What some people say about me">Testimonials</a></li> <li ><a href="/shift-m.html" title="Audio podcast about project management">Shift-M</a></li> <li ><a href="/paintings.html" title="My paintings for sale">Paintings</a></li> <li><a href="http://ru.yegor256.com/" title="Немного на русском языке">По-русски</a></li></ul></nav><div class="search"> <form method="get" action="https://www.google.com/search" itemprop="potentialAction" itemscope="" itemtype="http://schema.org/SearchAction"> <meta itemprop="target" content="https://www.google.com/search?q={q}"/> <input name="sitesearch" value="yegor256.com" type="hidden"/> <input itemprop="query-input" type="text" id="search-query" class="field field-text" required="required" onfocus="$('.google').css('visibility', 'visible');" name="q" placeholder="Search..." autocomplete="off"/> <input type="image" src="/images/google-search-icon.svg" class="google" title="Search via Google" alt="Search via Google"/> </form></div><div class="hot"><ul> <li> <a href="/code-ahead.html">Code Ahead</a> was published on Amazon just a few days ago! It is my new book, a novel about programmers. It explains in details the majority of ideas that stand behind <a href="https://www.zerocracy.com">Zerocracy</a> and <a href="https://www.xdsd.org">XDSD</a>. </li> <li> At <a href="/webinars.html">Webinar #37</a> we will discuss naming problem in OOP, for objects, methods and attributes; join us on <b>September 12</b>, at 11am PST. </li></ul></div></header></div><section itemscope="" itemtype="http://schema.org/BlogPosting"><div class="wrapper"> <header><p class="printable"> <img src="https://api.qrserver.com/v1/create-qr-code/?data=https://www.yegor256.com/2017/10/03/java9.html&amp;format=svg" style="width:125px;height:125px;" alt="QR code"/></p><p class="printable"> <code itemprop="url">https://www.yegor256.com/2017/10/03/java9.html</code></p><h1 itemprop="name headline mainEntityOfPage">Java 9: The Good, The Bad, and Private Interface Methods</h1><ul class="subline"> <li> <time itemprop="datePublished" datetime="2017-10-03T00:00:00+00:00"> 3 October 2017 </time> </li> <li class="desktop-only" itemprop="locationCreated">Odessa, Ukraine</li> <li class="printable" itemscope="" itemprop="author" itemtype="http://schema.org/Person"> <span itemprop="name">Yegor Bugayenko</span> </li> <li class="unprintable"> <i class="icon icon-comments"></i> <a href="http://www.yegor256.com/2017/10/03/java9.html#disqus_thread" itemprop="discussionUrl">comments</a> </li></ul><ul class="subline"> <li>Discussed at:</li> <li><a href="https://dzone.com/articles/java-9-the-good-the-bad-and-private-interface-meth">dzone</a></li></ul><figure class='jb_picture'><img itemprop='image' alt='Birdman (2014) by Alejandro G. Iñárritu' src='/images/2017/10/birdman.jpg' longdesc='#e53725ca'/><figcaption id='e53725ca'>Birdman (2014) by Alejandro G. Iñárritu</figcaption></figure><h2 id="the-platform">The Platform</h2><p>The first trend is an obvious improvement of the platform that compiles Java, packages JARs, and runs the bytecode. It definitely becomes better with every new Java release. Here is a list of improvements Java&nbsp;9 made, which are very useful, without doubt:</p><ul> <li><p><a href="http://openjdk.java.net/projects/jigsaw/spec/">JSR 376</a>: Module System a.k.a. <a href="http://openjdk.java.net/projects/jigsaw/">Jigsaw</a></p></li> <li><p><a href="http://openjdk.java.net/jeps/222">JEP 222</a>: <a href="http://jakubdziworski.github.io/java/2016/07/31/jshell-getting-started-examples.html"><code>jshell</code></a></p></li> <li><p><a href="http://openjdk.java.net/jeps/238">JEP 238</a>: Multi-release JARs</p></li> <li><p><a href="http://openjdk.java.net/jeps/282">JEP 282</a>: <a href="https://blog.idrsolutions.com/2017/05/java-9-jlink-explained-in-5-minutes/"><code>jlink</code></a></p></li> <li><p><a href="http://openjdk.java.net/jeps/158">JEP 158</a>: Unified logging</p></li></ul><p>The platform is obviously becoming more mature. This is a <strong>good</strong> trend.</p><h2 id="the-jdk">The JDK</h2><p>The second trend, which I&#39;ve observed since <a href="http://www.oracle.com/technetwork/java/javase/features-141434.html">Java&nbsp;6</a>, shows that the JDK, which is essentially a collection of classes and interfaces designed, developed, and maintained by <a href="https://www.oracle.com/java/index.html">Oracle</a>, gets bigger with every new release. In Java&nbsp;9 they added and extended, besides others, the following:</p><ul> <li><p>JEP <a href="http://openjdk.java.net/jeps/221">221</a>, <a href="http://openjdk.java.net/jeps/224">224</a> <a href="http://openjdk.java.net/jeps/225">225</a>, <a href="http://openjdk.java.net/jeps/261">261</a>: Javadoc processing (extended)</p></li> <li><p><a href="http://openjdk.java.net/jeps/268">JEP 268</a>: XML Catalogs (new)</p></li> <li><p><a href="http://openjdk.java.net/jeps/262">JEP 262</a>: TIFF image I/O (new)</p></li> <li><p><a href="http://openjdk.java.net/jeps/251">JEP 251</a>: multi-resolution images (new)</p></li> <li><p><a href="http://openjdk.java.net/jeps/110">JEP 110</a>: HTTP 2.0 client (new)</p></li> <li><p><a href="http://openjdk.java.net/jeps/236">JEP 236</a>: Parser for Nashorn (extended)</p></li></ul><p>Of course some features must be implemented in the JDK itself, like Unicode support (<a href="http://openjdk.java.net/jeps/267">JEP 267</a>), platform-specific Desktop features (<a href="http://openjdk.java.net/jeps/272">JEP 272</a>), Spin-Wait Hints (<a href="http://openjdk.java.net/jeps/285">JEP 285</a>), compact strings (<a href="http://openjdk.java.net/jeps/254">JEP 254</a>), and the process API (<a href="http://openjdk.java.net/jeps/102">JEP 102</a>). Their implementation depends on the underlying platform and has to be provided together with the JVM.</p><p>But what is HTTP 2.0 client doing in the JDK, together with <a href="https://jcp.org/en/jsr/detail?id=311">JAX-RS</a>, <a href="https://www.jcp.org/en/jsr/detail?id=338">JPA</a>, <a href="https://jcp.org/en/jsr/detail?id=224">JAX-WS</a>, <a href="https://www.jcp.org/en/jsr/detail?id=221">JDBC</a>, and many other things that, in my opinion, should stay as far away from Oracle as possible? They are not platform specific and they can be, in a much better way, designed by the open source community as independent packages. Aggregating them under one monster umbrella brand is a mistake, I believe.</p><p>I think that big corporations are only killing the software market, instead of making it better, because of the financial and political motives they expose it to. That&#39;s exactly what is happening with JDK. Thanks to the Oracle monopoly it lacks flexibility and dynamicity in growth. In other words, we&#39;re stuck with what Oracle and its big friends <a href="https://news.ycombinator.com/item?id=14301531">think is right</a>.</p><p>Thus, making JDK bigger is a <strong>bad</strong> trend. Instead, I believe, Oracle would only benefit from making it smaller, delegating everything that is not platform-specific to the open source community, supporting programmers somehow and promoting open and effective standardization processes on the market.</p><h2 id="the-language">The Language</h2><p><a href="https://en.wikipedia.org/wiki/Java_%28programming_language%29">Java</a> was developed by <a href="https://en.wikipedia.org/wiki/James_Gosling">James Gosling</a> in <a href="https://en.wikipedia.org/wiki/Sun_Microsystems">Sun Microsystems</a> in 1995 as an object-oriented language. There were <a href="/2016/08/15/what-is-wrong-object-oriented-programming.html">many concerns</a> about this claim of object-orientation and I&#39;m also not sure that Java is more OO than it is procedural. However it is officially object-oriented.</p><p>There were many procedural features inherited by Java from C/C++, since its first version, including <a href="/2014/05/05/oop-alternative-to-utility-classes.html">static methods</a>, <a href="/2014/05/13/why-null-is-bad.html">NULL</a>, <a href="/2016/09/13/inheritance-is-procedural.html">implementation inheritance</a>, etc. It was not a perfect object-oriented language and it was not going to be one, as I understand it. The key idea was to create something that could be <a href="https://en.wikipedia.org/wiki/Write_once,_run_anywhere">written once and ran anywhere</a>. However the language was a big deal also, not just the JVM. It was simple and sexy.</p><p>Java&nbsp;5 made a serious step forward in 2004 and improved the language by adding <a href="https://en.wikipedia.org/wiki/Generics_in_Java">generics</a>, for-each loop, <a href="https://en.wikipedia.org/wiki/Java_syntax#Varargs">varargs</a>, and static import. However, <a href="/2016/04/12/java-annotations-are-evil.html">annotations</a> and enumerations were introduced, which helped the language to divert from the object paradigm to something completely different and procedural.</p><p>Java&nbsp;7 added <a href="http://docs.oracle.com/javase/7/docs/technotes/guides/language/try-with-resources.html">try-with-resource</a> in 2011, which was a good move, in line with the OOP paradigm.</p><p>Java&nbsp;8 added <a href="http://openjdk.java.net/projects/lambda/">lambda expressions</a> in 2014, which was a great feature, but absolutely irrelevant to OOP. Lambda and <a href="http://www.oracle.com/technetwork/articles/java/ma14-java-se-8-streams-2177646.html">Streams API</a> turned Java into a mix of the object, procedural, and functional paradigms. <a href="https://docs.oracle.com/javase/tutorial/java/IandI/defaultmethods.html">Default methods</a> were also added to interfaces, which turned types into libraries of code. Types into libraries! It&#39;s even worse than <a href="/2016/09/13/inheritance-is-procedural.html">implementation inheritance</a>, if you ask me.</p><p>Now Java&nbsp;9 made the next &quot;improvement&quot; to interfaces, allowing them to have private methods. Private static methods in types! Can you believe it? What will be the next step? Attributes, in Java&nbsp;10, I guess.</p><p>Also, let&#39;s take a look at what was done to some core classes in the JDK, to understand where the language is heading. Just two examples.</p><p><strong>Factory methods for collections</strong> (<a href="http://openjdk.java.net/jeps/269">JEP 269</a>). Instead of introducing new constructors and allowing us to do this:</p><figure class="highlight"><pre><code class="language-java" data-lang="java"><span></span><span class="n">List</span><span class="o">&lt;</span><span class="n">Integer</span><span class="o">&gt;</span> <span class="n">list</span> <span class="o">=</span> <span class="k">new</span> <span class="n">ArrayList</span><span class="o">&lt;&gt;(</span><span class="mi">1</span><span class="o">,</span> <span class="mi">2</span><span class="o">,</span> <span class="mi">3</span><span class="o">);</span></code></pre></figure><p>...in Java&nbsp;9 they created more <a href="/2017/11/14/static-factory-methods.html">static factory methods</a> and made us do this:</p><figure class="highlight"><pre><code class="language-java" data-lang="java"><span></span><span class="n">List</span><span class="o">&lt;</span><span class="n">Integer</span><span class="o">&gt;</span> <span class="n">list</span> <span class="o">=</span> <span class="n">List</span><span class="o">.</span><span class="na">of</span><span class="o">(</span><span class="mi">1</span><span class="o">,</span> <span class="mi">2</span><span class="o">,</span> <span class="mi">3</span><span class="o">);</span></code></pre></figure><p>&quot;Fewer constructors, more static methods!&quot; seems to be the philosophy of those who introduced this JEP. Needless to say that this is completely against the very spirit of object-oriented programming. Objects must be created by constructors, not static methods, no matter what Joshua Bloch <a href="http://amzn.to/2crH5tW">says</a>. Static methods make the moment of operator <code>new</code> usage invisible for us and that&#39;s why the code is way less maintainable---we simply don&#39;t know exactly what class is instantiated and what the real arguments of its ctor are.</p><p>By the way, with <a href="http://www.cactoos.org">Cactoos</a> you can do it the right way:</p><figure class="highlight"><pre><code class="language-java" data-lang="java"><span></span><span class="n">List</span><span class="o">&lt;</span><span class="n">Integer</span><span class="o">&gt;</span> <span class="n">list</span> <span class="o">=</span> <span class="k">new</span> <span class="n">ListOf</span><span class="o">(</span><span class="mi">1</span><span class="o">,</span> <span class="mi">2</span><span class="o">,</span> <span class="mi">3</span><span class="o">);</span></code></pre></figure><p>This is OOP.</p><p><strong>New methods in <code>InputStream</code></strong>. Three new methods were added to the already <a href="/2016/04/26/why-inputstream-design-is-wrong.html">over bloated</a> class <a href="http://download.java.net/java/jdk9/docs/api/java/io/InputStream.html"><code>InputStream</code></a>: <code>transferTo()</code>, <code>readNBytes()</code>, and <code>readAllBytes()</code>. Now we are supposed to do this, when we want input stream to copy to an output stream:</p><figure class="highlight"><pre><code class="language-java" data-lang="java"><span></span><span class="n">input</span><span class="o">.</span><span class="na">transferTo</span><span class="o">(</span><span class="n">output</span><span class="o">);</span></code></pre></figure><p>It&#39;s one of the most typical mistakes young OOP programmers are making: they make their interfaces big. Just because they need more functionality. I guess the <a href="https://en.wikipedia.org/wiki/Interface_segregation_principle">interface segregation principle</a> is part of the famous <a href="/2017/03/28/solid.html">SOLID</a> and is many years old. What&#39;s wrong with you, Oracle? What will the next step be? In Java&nbsp;10 we will also have <code>saveToFile()</code> and <code>printToConsole()</code>? How about <code>emailToAFriend()</code>?</p><p>This is how you would do the same with the <a href="https://commons.apache.org/proper/commons-io/javadocs/api-2.4/org/apache/commons/io/IOUtils.html"><code>IOUtils</code></a> utility class from <a href="https://commons.apache.org/proper/commons-io/">commons-io</a>:</p><figure class="highlight"><pre><code class="language-java" data-lang="java"><span></span><span class="n">IOUtils</span><span class="o">.</span><span class="na">copy</span><span class="o">(</span><span class="n">input</span><span class="o">,</span> <span class="n">output</span><span class="o">);</span></code></pre></figure><p>It&#39;s <a href="/2014/05/05/oop-alternative-to-utility-classes.html">not perfect</a>, but it&#39;s better. The most object-oriented way is to use objects, not utility classes and static methods. This is how it works in <a href="/2017/06/22/object-oriented-input-output-in-cactoos.html">Cactoos</a>:</p><figure class="highlight"><pre><code class="language-java" data-lang="java"><span></span><span class="k">new</span> <span class="n">LengthOf</span><span class="o">(</span><span class="k">new</span> <span class="n">TeeInput</span><span class="o">(</span><span class="n">input</span><span class="o">,</span> <span class="n">output</span><span class="o">)).</span><span class="na">length</span><span class="o">();</span></code></pre></figure><p>This is OOP.</p><hr/><p>In my opinion, Java is getting <strong>uglier</strong>, and this is a trend. Does it mean that it&#39;s time to quit? No! No matter how ugly you are, we will always love you Java!</p></p>--> <nav class="buttons notranslate desktop-only"> <a href="http://www.facebook.com/sharer/sharer.php?u=https://www.yegor256.com/2017/10/03/java9.html" title="Share on Facebook" class="button" rel="nofollow"> <span class="count count-facebook">0</span> <i class="icon icon-facebook notranslate" aria-hidden="true"></i> </a> <a href="https://twitter.com/share?url=https://www.yegor256.com/2017/10/03/java9.html&amp;text=Java+9%3A+The+Good%2C+The+Bad%2C+and+Private+Interface+Methods" title="Share on Twitter" class="button" rel="nofollow"> <span class="count count-twitter">0</span> <i class="icon icon-twitter notranslate" aria-hidden="true"></i> </a> <a href="https://plus.google.com/share?url=https://www.yegor256.com/2017/10/03/java9.html" title="Share on Google+" class="button" rel="nofollow"> <span class="count count-googleplus">0</span> <i class="icon icon-googleplus notranslate" aria-hidden="true"></i> </a> <a href="https://www.linkedin.com/cws/share?url=https://www.yegor256.com/2017/10/03/java9.html" title="Share on LinkedIn" class="button" rel="nofollow"> <span class="count count-linkedin">0</span> <i class="icon icon-linkedin notranslate" aria-hidden="true"></i> </a> <a href="http://reddit.com/submit?url=https://www.yegor256.com/2017/10/03/java9.html%3F2017-40&amp;title=Java+9%3A+The+Good%2C+The+Bad%2C+and+Private+Interface+Methods" title="Share on Reddit" class="button" rel="nofollow"> <span class="count count-reddit">0</span> <i class="icon icon-reddit notranslate" aria-hidden="true"></i> </a> <a href="http://news.ycombinator.com/submitlink?u=https://www.yegor256.com/2017/10/03/java9.html%3F2017-40&amp;t=Java+9%3A+The+Good%2C+The+Bad%2C+and+Private+Interface+Methods" title="Share on Hacker News" class="button" rel="nofollow"> <span class="count count-hackernews">0</span> <i class="icon icon-hackernews notranslate" aria-hidden="true"></i> </a> </nav> </header> <article class="main" itemprop="articleBody"><div ><p>Java 9 <a href="https://blogs.oracle.com/java/java-9-release-now-available">was released</a> a few weeks ago. Check the <a href="https://docs.oracle.com/javase/9/whatsnew/toc.htm">release notes</a>, they include many interesting features. However, I think that not everything is as good as Oracle and Java adepts <a href="https://www.reddit.com/r/programming/comments/71ls99/java_9_released/">seem to picture it</a>. I see three trends in the Java world, which are good, bad, and ugly, respectively. Let&#39;s start with the good one.</p><figure class='jb_picture'><img itemprop='image' alt='Birdman (2014) by Alejandro G. Iñárritu' src='/images/2017/10/birdman.jpg' longdesc='#e53725ca'/><figcaption id='e53725ca'>Birdman (2014) by Alejandro G. Iñárritu</figcaption></figure><h2 id="the-platform">The Platform</h2><p>The first trend is an obvious improvement of the platform that compiles Java, packages JARs, and runs the bytecode. It definitely becomes better with every new Java release. Here is a list of improvements Java&nbsp;9 made, which are very useful, without doubt:</p><ul> <li><p><a href="http://openjdk.java.net/projects/jigsaw/spec/">JSR 376</a>: Module System a.k.a. <a href="http://openjdk.java.net/projects/jigsaw/">Jigsaw</a></p></li> <li><p><a href="http://openjdk.java.net/jeps/222">JEP 222</a>: <a href="http://jakubdziworski.github.io/java/2016/07/31/jshell-getting-started-examples.html"><code>jshell</code></a></p></li> <li><p><a href="http://openjdk.java.net/jeps/238">JEP 238</a>: Multi-release JARs</p></li> <li><p><a href="http://openjdk.java.net/jeps/282">JEP 282</a>: <a href="https://blog.idrsolutions.com/2017/05/java-9-jlink-explained-in-5-minutes/"><code>jlink</code></a></p></li> <li><p><a href="http://openjdk.java.net/jeps/158">JEP 158</a>: Unified logging</p></li></ul><p>The platform is obviously becoming more mature. This is a <strong>good</strong> trend.</p><h2 id="the-jdk">The JDK</h2><p>The second trend, which I&#39;ve observed since <a href="http://www.oracle.com/technetwork/java/javase/features-141434.html">Java&nbsp;6</a>, shows that the JDK, which is essentially a collection of classes and interfaces designed, developed, and maintained by <a href="https://www.oracle.com/java/index.html">Oracle</a>, gets bigger with every new release. In Java&nbsp;9 they added and extended, besides others, the following:</p><ul> <li><p>JEP <a href="http://openjdk.java.net/jeps/221">221</a>, <a href="http://openjdk.java.net/jeps/224">224</a> <a href="http://openjdk.java.net/jeps/225">225</a>, <a href="http://openjdk.java.net/jeps/261">261</a>: Javadoc processing (extended)</p></li> <li><p><a href="http://openjdk.java.net/jeps/268">JEP 268</a>: XML Catalogs (new)</p></li> <li><p><a href="http://openjdk.java.net/jeps/262">JEP 262</a>: TIFF image I/O (new)</p></li> <li><p><a href="http://openjdk.java.net/jeps/251">JEP 251</a>: multi-resolution images (new)</p></li> <li><p><a href="http://openjdk.java.net/jeps/110">JEP 110</a>: HTTP 2.0 client (new)</p></li> <li><p><a href="http://openjdk.java.net/jeps/236">JEP 236</a>: Parser for Nashorn (extended)</p></li></ul><p>Of course some features must be implemented in the JDK itself, like Unicode support (<a href="http://openjdk.java.net/jeps/267">JEP 267</a>), platform-specific Desktop features (<a href="http://openjdk.java.net/jeps/272">JEP 272</a>), Spin-Wait Hints (<a href="http://openjdk.java.net/jeps/285">JEP 285</a>), compact strings (<a href="http://openjdk.java.net/jeps/254">JEP 254</a>), and the process API (<a href="http://openjdk.java.net/jeps/102">JEP 102</a>). Their implementation depends on the underlying platform and has to be provided together with the JVM.</p><p>But what is HTTP 2.0 client doing in the JDK, together with <a href="https://jcp.org/en/jsr/detail?id=311">JAX-RS</a>, <a href="https://www.jcp.org/en/jsr/detail?id=338">JPA</a>, <a href="https://jcp.org/en/jsr/detail?id=224">JAX-WS</a>, <a href="https://www.jcp.org/en/jsr/detail?id=221">JDBC</a>, and many other things that, in my opinion, should stay as far away from Oracle as possible? They are not platform specific and they can be, in a much better way, designed by the open source community as independent packages. Aggregating them under one monster umbrella brand is a mistake, I believe.</p><p>I think that big corporations are only killing the software market, instead of making it better, because of the financial and political motives they expose it to. That&#39;s exactly what is happening with JDK. Thanks to the Oracle monopoly it lacks flexibility and dynamicity in growth. In other words, we&#39;re stuck with what Oracle and its big friends <a href="https://news.ycombinator.com/item?id=14301531">think is right</a>.</p><p>Thus, making JDK bigger is a <strong>bad</strong> trend. Instead, I believe, Oracle would only benefit from making it smaller, delegating everything that is not platform-specific to the open source community, supporting programmers somehow and promoting open and effective standardization processes on the market.</p><h2 id="the-language">The Language</h2><p><a href="https://en.wikipedia.org/wiki/Java_%28programming_language%29">Java</a> was developed by <a href="https://en.wikipedia.org/wiki/James_Gosling">James Gosling</a> in <a href="https://en.wikipedia.org/wiki/Sun_Microsystems">Sun Microsystems</a> in 1995 as an object-oriented language. There were <a href="/2016/08/15/what-is-wrong-object-oriented-programming.html">many concerns</a> about this claim of object-orientation and I&#39;m also not sure that Java is more OO than it is procedural. However it is officially object-oriented.</p><p>There were many procedural features inherited by Java from C/C++, since its first version, including <a href="/2014/05/05/oop-alternative-to-utility-classes.html">static methods</a>, <a href="/2014/05/13/why-null-is-bad.html">NULL</a>, <a href="/2016/09/13/inheritance-is-procedural.html">implementation inheritance</a>, etc. It was not a perfect object-oriented language and it was not going to be one, as I understand it. The key idea was to create something that could be <a href="https://en.wikipedia.org/wiki/Write_once,_run_anywhere">written once and ran anywhere</a>. However the language was a big deal also, not just the JVM. It was simple and sexy.</p><p>Java&nbsp;5 made a serious step forward in 2004 and improved the language by adding <a href="https://en.wikipedia.org/wiki/Generics_in_Java">generics</a>, for-each loop, <a href="https://en.wikipedia.org/wiki/Java_syntax#Varargs">varargs</a>, and static import. However, <a href="/2016/04/12/java-annotations-are-evil.html">annotations</a> and enumerations were introduced, which helped the language to divert from the object paradigm to something completely different and procedural.</p><p>Java&nbsp;7 added <a href="http://docs.oracle.com/javase/7/docs/technotes/guides/language/try-with-resources.html">try-with-resource</a> in 2011, which was a good move, in line with the OOP paradigm.</p><p>Java&nbsp;8 added <a href="http://openjdk.java.net/projects/lambda/">lambda expressions</a> in 2014, which was a great feature, but absolutely irrelevant to OOP. Lambda and <a href="http://www.oracle.com/technetwork/articles/java/ma14-java-se-8-streams-2177646.html">Streams API</a> turned Java into a mix of the object, procedural, and functional paradigms. <a href="https://docs.oracle.com/javase/tutorial/java/IandI/defaultmethods.html">Default methods</a> were also added to interfaces, which turned types into libraries of code. Types into libraries! It&#39;s even worse than <a href="/2016/09/13/inheritance-is-procedural.html">implementation inheritance</a>, if you ask me.</p><p>Now Java&nbsp;9 made the next &quot;improvement&quot; to interfaces, allowing them to have private methods. Private static methods in types! Can you believe it? What will be the next step? Attributes, in Java&nbsp;10, I guess.</p><p>Also, let&#39;s take a look at what was done to some core classes in the JDK, to understand where the language is heading. Just two examples.</p><p><strong>Factory methods for collections</strong> (<a href="http://openjdk.java.net/jeps/269">JEP 269</a>). Instead of introducing new constructors and allowing us to do this:</p><figure class="highlight"><pre><code class="language-java" data-lang="java"><span></span><span class="n">List</span><span class="o">&lt;</span><span class="n">Integer</span><span class="o">&gt;</span> <span class="n">list</span> <span class="o">=</span> <span class="k">new</span> <span class="n">ArrayList</span><span class="o">&lt;&gt;(</span><span class="mi">1</span><span class="o">,</span> <span class="mi">2</span><span class="o">,</span> <span class="mi">3</span><span class="o">);</span></code></pre></figure><p>...in Java&nbsp;9 they created more <a href="/2017/11/14/static-factory-methods.html">static factory methods</a> and made us do this:</p><figure class="highlight"><pre><code class="language-java" data-lang="java"><span></span><span class="n">List</span><span class="o">&lt;</span><span class="n">Integer</span><span class="o">&gt;</span> <span class="n">list</span> <span class="o">=</span> <span class="n">List</span><span class="o">.</span><span class="na">of</span><span class="o">(</span><span class="mi">1</span><span class="o">,</span> <span class="mi">2</span><span class="o">,</span> <span class="mi">3</span><span class="o">);</span></code></pre></figure><p>&quot;Fewer constructors, more static methods!&quot; seems to be the philosophy of those who introduced this JEP. Needless to say that this is completely against the very spirit of object-oriented programming. Objects must be created by constructors, not static methods, no matter what Joshua Bloch <a href="http://amzn.to/2crH5tW">says</a>. Static methods make the moment of operator <code>new</code> usage invisible for us and that&#39;s why the code is way less maintainable---we simply don&#39;t know exactly what class is instantiated and what the real arguments of its ctor are.</p><p>By the way, with <a href="http://www.cactoos.org">Cactoos</a> you can do it the right way:</p><figure class="highlight"><pre><code class="language-java" data-lang="java"><span></span><span class="n">List</span><span class="o">&lt;</span><span class="n">Integer</span><span class="o">&gt;</span> <span class="n">list</span> <span class="o">=</span> <span class="k">new</span> <span class="n">ListOf</span><span class="o">(</span><span class="mi">1</span><span class="o">,</span> <span class="mi">2</span><span class="o">,</span> <span class="mi">3</span><span class="o">);</span></code></pre></figure><p>This is OOP.</p><p><strong>New methods in <code>InputStream</code></strong>. Three new methods were added to the already <a href="/2016/04/26/why-inputstream-design-is-wrong.html">over bloated</a> class <a href="http://download.java.net/java/jdk9/docs/api/java/io/InputStream.html"><code>InputStream</code></a>: <code>transferTo()</code>, <code>readNBytes()</code>, and <code>readAllBytes()</code>. Now we are supposed to do this, when we want input stream to copy to an output stream:</p><figure class="highlight"><pre><code class="language-java" data-lang="java"><span></span><span class="n">input</span><span class="o">.</span><span class="na">transferTo</span><span class="o">(</span><span class="n">output</span><span class="o">);</span></code></pre></figure><p>It&#39;s one of the most typical mistakes young OOP programmers are making: they make their interfaces big. Just because they need more functionality. I guess the <a href="https://en.wikipedia.org/wiki/Interface_segregation_principle">interface segregation principle</a> is part of the famous <a href="/2017/03/28/solid.html">SOLID</a> and is many years old. What&#39;s wrong with you, Oracle? What will the next step be? In Java&nbsp;10 we will also have <code>saveToFile()</code> and <code>printToConsole()</code>? How about <code>emailToAFriend()</code>?</p><p>This is how you would do the same with the <a href="https://commons.apache.org/proper/commons-io/javadocs/api-2.4/org/apache/commons/io/IOUtils.html"><code>IOUtils</code></a> utility class from <a href="https://commons.apache.org/proper/commons-io/">commons-io</a>:</p><figure class="highlight"><pre><code class="language-java" data-lang="java"><span></span><span class="n">IOUtils</span><span class="o">.</span><span class="na">copy</span><span class="o">(</span><span class="n">input</span><span class="o">,</span> <span class="n">output</span><span class="o">);</span></code></pre></figure><p>It&#39;s <a href="/2014/05/05/oop-alternative-to-utility-classes.html">not perfect</a>, but it&#39;s better. The most object-oriented way is to use objects, not utility classes and static methods. This is how it works in <a href="/2017/06/22/object-oriented-input-output-in-cactoos.html">Cactoos</a>:</p><figure class="highlight"><pre><code class="language-java" data-lang="java"><span></span><span class="k">new</span> <span class="n">LengthOf</span><span class="o">(</span><span class="k">new</span> <span class="n">TeeInput</span><span class="o">(</span><span class="n">input</span><span class="o">,</span> <span class="n">output</span><span class="o">)).</span><span class="na">length</span><span class="o">();</span></code></pre></figure><p>This is OOP.</p><hr/><p>In my opinion, Java is getting <strong>uglier</strong>, and this is a trend. Does it mean that it&#39;s time to quit? No! No matter how ugly you are, we will always love you Java!</p></div></article></div><div class="wrapper"> <related-posts /></div><div class="disqus" role="complementary"><p class="disqus_hint"> Please, use <a href="https://help.disqus.com/commenting/what-html-tags-are-allowed-within-comments">syntax highlighting</a> in your comments, to make them more readable.</p><div id="disqus_thread" class="disqus-thread"> <a>&nbsp;</a></div><script> var disqus_config = function () { this.page.url = document.location.href.split('?')[0].split('#')[0].replace('https://', 'http://'); this.page.identifier = this.page.url; }; (function() { var d = document, s = d.createElement('script'); s.src = '//yegor256.disqus.com/embed.js'; s.setAttribute('data-timestamp', +new Date()); (d.head || d.body).appendChild(s); })(); </script> <noscript><div><p class="red"> JavaScript is disabled in your browser, that's why you can't see comments under this post.</p></div></noscript></div><div class="wrapper"> <footer class="footer"><p> &copy; <span itemscope="" itemprop="copyrightHolder" itemtype="http://schema.org/Person"> <span itemprop="name">Yegor Bugayenko</span> </span> 2014&ndash;<span itemprop="copyrightYear">2018</span></p></footer></div></section><div class="wrapper unprintable" style="text-align:center;margin-top:2em;"> <a href="http://www.sixnines.io/h/3ba1652f"> <img src="//www.sixnines.io/b/3ba1652f?style=flat" alt="sixnines availability badge"/> </a></div><script src="//code.jquery.com/jquery-1.9.0.min.js"></script> <script src="/js/all.js?4e047f6f42b"></script> <script>var disqus_shortname = 'yegor256';</script> <script id="dsq-count-scr" src="//yegor256.disqus.com/count.js" async="async"></script> <script> (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){ (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o), m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m) })(window,document,'script','//www.google-analytics.com/analytics.js','ga'); ga('create', 'UA-1963507-32', 'auto'); ga('send', 'pageview'); </script> <script> Cd=document;Cr="&"+Math.random();Cp="&s=1"; Cd.cookie="b=b";if(Cd.cookie)Cp+="&c=1"; Cp+="&t="+(new Date()).getTimezoneOffset(); if(self!=top)Cp+="&f=1"; </script> <script> if(navigator.javaEnabled())Cp+="&j=1"; </script> <script> if(typeof(screen)!='undefined')Cp+="&w="+screen.width+"&h="+ screen.height+"&d="+(screen.colorDepth?screen.colorDepth:screen.pixelDepth); </script> <script> Cd.write("<img src='//c.hit.ua/hit?i=95870&g=0&x=2"+Cp+Cr+ "&r="+escape(Cd.referrer)+"&u="+escape(window.location.href)+ "' border='0' wi"+"dth='1' he"+"ight='1'/>"); </script> <script type="application/ld+json"> { "@context": "http://schema.org", "@type": "Person", "name": "Yegor Bugayenko", "url": "http://www.yegor256.com", "sameAs": [ "https://www.facebook.com/yegor256", "https://instagram.com/yegor256", "https://www.linkedin.com/in/yegor256", "https://twitter.com/yegor256", "https://github.com/yegor256", "https://www.pinterest.com/yegor256/" ] } </script> </body> </html> <!DOCTYPE html> <html xmlns="http://www.w3.org/1999/xhtml" lang="en-US" xml:lang="en-US" itemscope="" itemtype="http://schema.org/WebSite"> <head> <meta charset="utf-8"/> <meta name="description" content="Resource Acquisition Is Initialization (RAII) is a design idea introduced in C++; it is applicable to Java as well. " /> <meta name="keywords" content="RAII, RAII in C++, RAII in Java, RAII in OOP, resource acquisition is initialization" /> <meta name="viewport" content="width=device-width,minimum-scale=1,initial-scale=1"/> <meta name="google-site-verification" content="JEj_gQr2CPe2QKGw8XdMz0R7VboQIUbX3FlM-lwTq-8" /> <meta name="author" content="Yegor Bugayenko"> <meta name="article:published_time" content="2017-08-08 00:00:00 +0000"> <meta name="og:site_name" content="Yegor Bugayenko"/> <meta name="og:type" content="article" /> <meta name="og:locale" content="en_US" /> <meta name="twitter:account_id" content="4503599630178231" /> <meta name="twitter:creator" content="@yegor256"/> <meta name="twitter:site" content="@yegor256"/> <meta name="twitter:title" property="og:title" content="RAII in Java"/> <meta name="twitter:description" property="og:description" content="Resource Acquisition Is Initialization (RAII) is a design idea introduced in C++; it is applicable to Java as well. "/> <meta name="twitter:url" property="og:url" content="https://www.yegor256.com/2017/08/08/raii-in-java.html"/> <meta name="telegram:channel" content="AAAAAEJFMRzsRTRxM3ec6A"/> <link rel="search" type="application/opensearchdescription+xml" href="/opensearch.xml" title="yegor256" /> <link rel="shortcut icon" href="/favicon.ico?4e047f6f42b"/> <link rel="apple-touch-icon" href="/favicon.ico?4e047f6f42b"/> <link rel="alternate" type="application/rss+xml" title="RSS for yegor256.com" href="https://www.yegor256.com/rss.xml"/> <link rel="stylesheet" href="/css/layout.css?4e047f6f42b"/> <link rel="stylesheet" href="/css/icons.css?4e047f6f42b"/> <link rel="canonical" href="https://www.yegor256.com/2017/08/08/raii-in-java.html" /> <link rel="amphtml" href="https://www.yegor256.com/2017/08/08/raii-in-java.amp.html" /> <title>RAII in Java </title> <meta name='og:image' content='https://www.yegor256.com/images/2017/08/at-sachem-farm.jpg'/><meta name='twitter:image' content='https://www.yegor256.com/images/2017/08/at-sachem-farm.jpg'/><meta name='og:image:width' content='1280'/> <meta name='twitter:image:width' content='1280'/><meta name='og:image:height' content='674'/> <meta name='twitter:image:height' content='674'/><meta name='twitter:card' content='summary_large_image'/><meta name='twitter:image:alt' content='At Sachem Farm (1998) by John Huddles'/> </head> <body><div class="wrapper"> <aside class="header-toggle unprintable" id="header-toggle" title="Show the menu" onclick="$('#header').show();$('#header-toggle').hide();">&#9776;</aside> <header class="header" id="header"><div class="face"> <a href="/about-me.html#form" class="sub" title="Click to subscribe to my monthly newsletter"><span>Subscribe</span></a> <a href="/about-me.html" style="position:relative;"> <img src="/images/face-256x256.jpg" class="photo" alt="Yegor Bugayenko"/> </a></div><nav><ul class="menu social notranslate"> <li><a href="https://twitter.com/intent/follow?screen_name=yegor256" rel="nofollow" title="Follow me on Twitter"><i class="icon icon-twitter notranslate" aria-hidden="true"></i></a></li> <li><a href="/rss.xml" rel="nofollow" title="Subscribe to my RSS feed"><i class="icon icon-rss notranslate" aria-hidden="true"></i></a></li> <li><a itemprop="sameAs" href="https://github.com/yegor256" rel="nofollow" title="My GitHub profile"><i class="icon icon-github notranslate" aria-hidden="true"></i></a></li> <li><a itemprop="sameAs" href="http://stackoverflow.com/users/187141/yegor256" rel="nofollow" title="My StackOverflow profile"><i class="icon icon-stackoverflow notranslate" aria-hidden="true"></i></a></li> <li><a itemprop="sameAs" href="https://www.facebook.com/yegor256" rel="nofollow" title="Follow me on Facebook"><i class="icon icon-facebook notranslate" aria-hidden="true"></i></a></li> <li><a itemprop="sameAs" href="https://instagram.com/yegor256" rel="nofollow" title="Follow me on Instagram"><i class="icon icon-instagram notranslate" aria-hidden="true"></i></a></li> <li><a itemprop="sameAs" href="https://www.linkedin.com/in/yegor256" rel="nofollow" title="My LinkedIn profile"><i class="icon icon-linkedin notranslate" aria-hidden="true"></i></a></li> <li><a itemprop="sameAs" href="https://www.youtube.com/c/yegor256?sub_confirmation=1" rel="nofollow" title="My Youtube video channel"><i class="icon icon-youtube notranslate" aria-hidden="true"></i></a></li> <li><a itemprop="sameAs" href="https://www.pinterest.com/yegor256/" rel="nofollow" title="My Pinterest boards"><i class="icon icon-pinterest notranslate" aria-hidden="true"></i></a></li> <li><a itemprop="sameAs" href="https://angel.co/yegor256" rel="nofollow" title="My AngelList profile"><i class="icon icon-angellist notranslate" aria-hidden="true"></i></a></li> <li><a href="https://soundcloud.com/yegor256" rel="nofollow" title="My podcast"><i class="icon icon-podcast notranslate" aria-hidden="true"></i></a></li> <li><a href="https://itunes.apple.com/us/podcast/yegor256-podcast/id1150826721" rel="nofollow" title="My iTunes podcast"><i class="icon icon-itunes notranslate" aria-hidden="true"></i></a></li> <li><a href="https://t.me/joinchat/AAAAAEJFMRzsRTRxM3ec6A" rel="nofollow" title="My Telegram public channel"><i class="icon icon-telegram notranslate" aria-hidden="true"></i></a></li> <li><a href="mailto:blog@yegor256.com" rel="nofollow" title="Email me any time"><i class="icon icon-mail notranslate" aria-hidden="true"></i></a></li></ul><ul class="menu"> <li><a href="/" title="Home page">Home</a></li> <li ><a href="/best.html" title="Best articles to read">12&#160;Best</a></li> <li ><a href="/contents.html" title="The contents of the entire blog">All&#160;288</a></li> <li ><a href="/webinars.html" title="My webinars">Webinars</a></li> <li ><a href="/talks.html" title="Future and past conference talks">Talks</a></li> <li ><a href="/books.html" title="The books I wrote">Books</a></li> <li ><a href="/papers.html" title="My academic papers and patents">Papers</a></li> <li ><a href="/pets.html" title="My loved pet projects">Pets</a></li> <li ><a href="/award.html" title="Software quality award">Award</a></li> <li ><a href="/testimonials.html" title="What some people say about me">Testimonials</a></li> <li ><a href="/shift-m.html" title="Audio podcast about project management">Shift-M</a></li> <li ><a href="/paintings.html" title="My paintings for sale">Paintings</a></li> <li><a href="http://ru.yegor256.com/" title="Немного на русском языке">По-русски</a></li></ul></nav><div class="search"> <form method="get" action="https://www.google.com/search" itemprop="potentialAction" itemscope="" itemtype="http://schema.org/SearchAction"> <meta itemprop="target" content="https://www.google.com/search?q={q}"/> <input name="sitesearch" value="yegor256.com" type="hidden"/> <input itemprop="query-input" type="text" id="search-query" class="field field-text" required="required" onfocus="$('.google').css('visibility', 'visible');" name="q" placeholder="Search..." autocomplete="off"/> <input type="image" src="/images/google-search-icon.svg" class="google" title="Search via Google" alt="Search via Google"/> </form></div><div class="hot"><ul> <li> <a href="/code-ahead.html">Code Ahead</a> was published on Amazon just a few days ago! It is my new book, a novel about programmers. It explains in details the majority of ideas that stand behind <a href="https://www.zerocracy.com">Zerocracy</a> and <a href="https://www.xdsd.org">XDSD</a>. </li> <li> At <a href="/webinars.html">Webinar #37</a> we will discuss naming problem in OOP, for objects, methods and attributes; join us on <b>September 12</b>, at 11am PST. </li></ul></div></header></div><section itemscope="" itemtype="http://schema.org/BlogPosting"><div class="wrapper"> <header><p class="printable"> <img src="https://api.qrserver.com/v1/create-qr-code/?data=https://www.yegor256.com/2017/08/08/raii-in-java.html&amp;format=svg" style="width:125px;height:125px;" alt="QR code"/></p><p class="printable"> <code itemprop="url">https://www.yegor256.com/2017/08/08/raii-in-java.html</code></p><h1 itemprop="name headline mainEntityOfPage">RAII in Java</h1><aside class='book'><a href='http://amzn.to/2qFt4Tn'><img src='/images/books/elegant-objects/cover.png' class='book-cover' alt='book cover'/></a>Read more about this subject in <a href='http://amzn.to/2qFt4Tn'>Section&nbsp;4.4</a><br/> of my book<a href='http://amzn.to/2qFt4Tn'><img src='/images/books/amazon-buy-button.png' class='amazon-button' alt='Click to buy'/></a></aside><ul class="subline"> <li> <time itemprop="datePublished" datetime="2017-08-08T00:00:00+00:00"> 8 August 2017 </time> </li> <li class="desktop-only" itemprop="locationCreated">Riga, Latvia</li> <li class="printable" itemscope="" itemprop="author" itemtype="http://schema.org/Person"> <span itemprop="name">Yegor Bugayenko</span> </li> <li class="unprintable"> <i class="icon icon-comments"></i> <a href="http://www.yegor256.com/2017/08/08/raii-in-java.html#disqus_thread" itemprop="discussionUrl">comments</a> </li></ul><figure class='jb_picture'><img itemprop='image' alt='At Sachem Farm (1998) by John Huddles' src='/images/2017/08/at-sachem-farm.jpg' longdesc='#7aef3b5b'/><figcaption id='7aef3b5b'>At Sachem Farm (1998) by John Huddles</figcaption></figure><p>The problem RAII is solving is obvious; have a look at this code (I&#39;m sure you know what <a href="https://docs.oracle.com/javase/7/docs/api/java/util/concurrent/Semaphore.html"><code>Semaphore</code></a> is and how it works in Java):</p><figure class="highlight"><pre><code class="language-java" data-lang="java"><span></span><span class="kd">class</span> <span class="nc">Foo</span> <span class="o">{</span>
  <span class="kd">private</span> <span class="n">Semaphore</span> <span class="n">sem</span> <span class="o">=</span> <span class="k">new</span> <span class="n">Semaphore</span><span class="o">(</span><span class="mi">5</span><span class="o">);</span>
  <span class="kt">void</span> <span class="nf">print</span><span class="o">(</span><span class="kt">int</span> <span class="n">x</span><span class="o">)</span> <span class="kd">throws</span> <span class="n">Exception</span> <span class="o">{</span>
    <span class="k">this</span><span class="o">.</span><span class="na">sem</span><span class="o">.</span><span class="na">acquire</span><span class="o">();</span>
    <span class="k">if</span> <span class="o">(</span><span class="n">x</span> <span class="o">&gt;</span> <span class="mi">1000</span><span class="o">)</span> <span class="o">{</span>
      <span class="k">throw</span> <span class="k">new</span> <span class="n">Exception</span><span class="o">(</span><span class="s">&quot;Too large!&quot;</span><span class="o">);</span>
    <span class="o">}</span>
    <span class="n">System</span><span class="o">.</span><span class="na">out</span><span class="o">.</span><span class="na">printf</span><span class="o">(</span><span class="s">&quot;x = %d&quot;</span><span class="o">,</span> <span class="n">x</span><span class="o">);</span>
    <span class="k">this</span><span class="o">.</span><span class="na">sem</span><span class="o">.</span><span class="na">release</span><span class="o">();</span>
  <span class="o">}</span>
<span class="o">}</span></code></pre></figure><p>The code is rather primitive and doesn&#39;t do anything useful, but you most probably get the idea: the method <code>print()</code>, if being called from multiple parallel threads, will allow only five of them to print in parallel. Sometimes it will not allow some of them to print and will throw an exception if <code>x</code> is bigger than <code>1000</code>.</p><p>The problem with this code is---<a href="https://en.wikipedia.org/wiki/Resource_leak">resource leakage</a>. Each <code>print()</code> call with <code>x</code> larger than <code>1000</code> will take one permit from the semaphore and won&#39;t return it. In five calls with exceptions the semaphore will be empty and all other threads won&#39;t print anything.</p><p>What is the solution? Here it is:</p><figure class="highlight"><pre><code class="language-java" data-lang="java"><span></span><span class="kd">class</span> <span class="nc">Foo</span> <span class="o">{</span>
  <span class="kd">private</span> <span class="n">Semaphore</span> <span class="n">sem</span> <span class="o">=</span> <span class="k">new</span> <span class="n">Semaphore</span><span class="o">(</span><span class="mi">5</span><span class="o">);</span>
  <span class="kt">void</span> <span class="nf">print</span><span class="o">(</span><span class="kt">int</span> <span class="n">x</span><span class="o">)</span> <span class="kd">throws</span> <span class="n">Exception</span> <span class="o">{</span>
    <span class="k">this</span><span class="o">.</span><span class="na">sem</span><span class="o">.</span><span class="na">acquire</span><span class="o">();</span>
    <span class="k">if</span> <span class="o">(</span><span class="n">x</span> <span class="o">&gt;</span> <span class="mi">1000</span><span class="o">)</span> <span class="o">{</span>
      <span class="k">this</span><span class="o">.</span><span class="na">sem</span><span class="o">.</span><span class="na">release</span><span class="o">();</span>
      <span class="k">throw</span> <span class="k">new</span> <span class="n">Exception</span><span class="o">(</span><span class="s">&quot;Too large!&quot;</span><span class="o">);</span>
    <span class="o">}</span>
    <span class="n">System</span><span class="o">.</span><span class="na">out</span><span class="o">.</span><span class="na">printf</span><span class="o">(</span><span class="s">&quot;x = %d&quot;</span><span class="o">,</span> <span class="n">x</span><span class="o">);</span>
    <span class="k">this</span><span class="o">.</span><span class="na">sem</span><span class="o">.</span><span class="na">release</span><span class="o">();</span>
  <span class="o">}</span>
<span class="o">}</span></code></pre></figure><p>We must release the permit before we throw the exception.</p><p>However, there is another problem that shows up: code duplication. We release the permit in two places. If we add more <code>throw</code> instructions we will also have to add more <code>sem.release()</code> calls.</p><p>A very elegant solution was introduced in C++ and is called RAII. This is how it would look in Java:</p><figure class="highlight"><pre><code class="language-java" data-lang="java"><span></span><span class="kd">class</span> <span class="nc">Permit</span> <span class="o">{</span>
  <span class="kd">private</span> <span class="n">Semaphore</span> <span class="n">sem</span><span class="o">;</span>
  <span class="n">Permit</span><span class="o">(</span><span class="n">Semaphore</span> <span class="n">s</span><span class="o">)</span> <span class="o">{</span>
    <span class="k">this</span><span class="o">.</span><span class="na">sem</span> <span class="o">=</span> <span class="n">s</span><span class="o">;</span>
    <span class="k">this</span><span class="o">.</span><span class="na">sem</span><span class="o">.</span><span class="na">acquire</span><span class="o">();</span>
  <span class="o">}</span>
  <span class="nd">@Override</span>
  <span class="kd">public</span> <span class="kt">void</span> <span class="nf">finalize</span><span class="o">()</span> <span class="o">{</span>
    <span class="k">this</span><span class="o">.</span><span class="na">sem</span><span class="o">.</span><span class="na">release</span><span class="o">();</span>
  <span class="o">}</span>
<span class="o">}</span>
<span class="kd">class</span> <span class="nc">Foo</span> <span class="o">{</span>
  <span class="kd">private</span> <span class="n">Semaphore</span> <span class="n">sem</span> <span class="o">=</span> <span class="k">new</span> <span class="n">Semaphore</span><span class="o">(</span><span class="mi">5</span><span class="o">);</span>
  <span class="kt">void</span> <span class="nf">print</span><span class="o">(</span><span class="kt">int</span> <span class="n">x</span><span class="o">)</span> <span class="kd">throws</span> <span class="n">Exception</span> <span class="o">{</span>
    <span class="k">new</span> <span class="n">Permit</span><span class="o">(</span><span class="k">this</span><span class="o">.</span><span class="na">sem</span><span class="o">);</span>
    <span class="k">if</span> <span class="o">(</span><span class="n">x</span> <span class="o">&gt;</span> <span class="mi">1000</span><span class="o">)</span> <span class="o">{</span>
      <span class="k">throw</span> <span class="k">new</span> <span class="n">Exception</span><span class="o">(</span><span class="s">&quot;Too large!&quot;</span><span class="o">);</span>
    <span class="o">}</span>
    <span class="n">System</span><span class="o">.</span><span class="na">out</span><span class="o">.</span><span class="na">printf</span><span class="o">(</span><span class="s">&quot;x = %d&quot;</span><span class="o">,</span> <span class="n">x</span><span class="o">);</span>
  <span class="o">}</span>
<span class="o">}</span></code></pre></figure><p>See how beautiful the code is inside method <code>Foo.print()</code>. We just create an instance of class <code>Permit</code> and it immediately acquires a new permit at the semaphore. Then we exit the method <code>print()</code>, either by exception or in the normal way, and the method <code>Permit.finalize()</code> releases the permit.</p><p>Elegant, isn&#39;t it? Yes, it is, but it won&#39;t work in Java.</p><p>It won&#39;t work because, unlike C++, Java doesn&#39;t destroy objects when their scope of visibility is closed. The object of class <code>Permit</code> won&#39;t be destroyed when we exit the method <code>print()</code>. It will be destroyed <em>eventually</em> but we don&#39;t know when exactly. Most likely it will be destroyed way after all permits in the semaphore got acquired and we get blocked.</p><p>There is a solution in Java too. It is not as elegant as the one from C++, but it does work. Here it is:</p><figure class="highlight"><pre><code class="language-java" data-lang="java"><span></span><span class="kd">class</span> <span class="nc">Permit</span> <span class="kd">implements</span> <span class="n">Closeable</span> <span class="o">{</span>
  <span class="kd">private</span> <span class="n">Semaphore</span> <span class="n">sem</span><span class="o">;</span>
  <span class="n">Permit</span><span class="o">(</span><span class="n">Semaphore</span> <span class="n">s</span><span class="o">)</span> <span class="o">{</span>
    <span class="k">this</span><span class="o">.</span><span class="na">sem</span> <span class="o">=</span> <span class="n">s</span><span class="o">;</span>
  <span class="o">}</span>
  <span class="nd">@Override</span>
  <span class="kd">public</span> <span class="kt">void</span> <span class="nf">close</span><span class="o">()</span> <span class="o">{</span>
    <span class="k">this</span><span class="o">.</span><span class="na">sem</span><span class="o">.</span><span class="na">release</span><span class="o">();</span>
  <span class="o">}</span>
  <span class="kd">public</span> <span class="n">Permit</span> <span class="nf">acquire</span><span class="o">()</span> <span class="o">{</span>
    <span class="k">this</span><span class="o">.</span><span class="na">sem</span><span class="o">.</span><span class="na">acquire</span><span class="o">();</span>
    <span class="k">return</span> <span class="k">this</span><span class="o">;</span>
  <span class="o">}</span>
<span class="o">}</span>
<span class="kd">class</span> <span class="nc">Foo</span> <span class="o">{</span>
  <span class="kd">private</span> <span class="n">Semaphore</span> <span class="n">sem</span> <span class="o">=</span> <span class="k">new</span> <span class="n">Semaphore</span><span class="o">(</span><span class="mi">5</span><span class="o">);</span>
  <span class="kt">void</span> <span class="nf">print</span><span class="o">(</span><span class="kt">int</span> <span class="n">x</span><span class="o">)</span> <span class="kd">throws</span> <span class="n">Exception</span> <span class="o">{</span>
    <span class="k">try</span> <span class="o">(</span><span class="n">Permit</span> <span class="n">p</span> <span class="o">=</span> <span class="k">new</span> <span class="n">Permit</span><span class="o">(</span><span class="k">this</span><span class="o">.</span><span class="na">sem</span><span class="o">).</span><span class="na">acquire</span><span class="o">())</span> <span class="o">{</span>
      <span class="k">if</span> <span class="o">(</span><span class="n">x</span> <span class="o">&gt;</span> <span class="mi">1000</span><span class="o">)</span> <span class="o">{</span>
        <span class="k">throw</span> <span class="k">new</span> <span class="n">Exception</span><span class="o">(</span><span class="s">&quot;Too large!&quot;</span><span class="o">);</span>
      <span class="o">}</span>
      <span class="n">System</span><span class="o">.</span><span class="na">out</span><span class="o">.</span><span class="na">printf</span><span class="o">(</span><span class="s">&quot;x = %d&quot;</span><span class="o">,</span> <span class="n">x</span><span class="o">);</span>
    <span class="o">}</span>
  <span class="o">}</span>
<span class="o">}</span></code></pre></figure><p>Pay attention to the <code>try</code> block and to the <a href="https://docs.oracle.com/javase/7/docs/api/java/io/Closeable.html"><code>Closeable</code></a> interface that the class <code>Permit</code> now implements. The object <code>p</code> will be &quot;closed&quot; when the <code>try</code> block exits. It may exit either at the end, or by the <code>return</code> or <code>throw</code> statements. In either case <code>Permit.close()</code> will be called: this is how <a href="https://docs.oracle.com/javase/tutorial/essential/exceptions/tryResourceClose.html">try-with-resources</a> works in Java.</p><p>I introduced method <code>acquire()</code> and moved <code>sem.acquire()</code> out of the <code>Permit</code> constructor because I <a href="/2015/05/07/ctors-must-be-code-free.html">believe</a> that constructors must be code-free.</p><p>To summarize, RAII is a perfect design <del>pattern</del> approach when you deal with resources that may <a href="https://en.wikipedia.org/wiki/Resource_leak">leak</a>. Even though Java doesn&#39;t have it out of the box we can implement it via <a href="https://docs.oracle.com/javase/tutorial/essential/exceptions/tryResourceClose.html">try-with-resources</a> and <a href="https://docs.oracle.com/javase/7/docs/api/java/io/Closeable.html"><code>Closeable</code></a>.</p></p>--> <nav class="buttons notranslate desktop-only"> <a href="http://www.facebook.com/sharer/sharer.php?u=https://www.yegor256.com/2017/08/08/raii-in-java.html" title="Share on Facebook" class="button" rel="nofollow"> <span class="count count-facebook">0</span> <i class="icon icon-facebook notranslate" aria-hidden="true"></i> </a> <a href="https://twitter.com/share?url=https://www.yegor256.com/2017/08/08/raii-in-java.html&amp;text=RAII+in+Java" title="Share on Twitter" class="button" rel="nofollow"> <span class="count count-twitter">0</span> <i class="icon icon-twitter notranslate" aria-hidden="true"></i> </a> <a href="https://plus.google.com/share?url=https://www.yegor256.com/2017/08/08/raii-in-java.html" title="Share on Google+" class="button" rel="nofollow"> <span class="count count-googleplus">0</span> <i class="icon icon-googleplus notranslate" aria-hidden="true"></i> </a> <a href="https://www.linkedin.com/cws/share?url=https://www.yegor256.com/2017/08/08/raii-in-java.html" title="Share on LinkedIn" class="button" rel="nofollow"> <span class="count count-linkedin">0</span> <i class="icon icon-linkedin notranslate" aria-hidden="true"></i> </a> <a href="http://reddit.com/submit?url=https://www.yegor256.com/2017/08/08/raii-in-java.html%3F2017-32&amp;title=RAII+in+Java" title="Share on Reddit" class="button" rel="nofollow"> <span class="count count-reddit">0</span> <i class="icon icon-reddit notranslate" aria-hidden="true"></i> </a> <a href="http://news.ycombinator.com/submitlink?u=https://www.yegor256.com/2017/08/08/raii-in-java.html%3F2017-32&amp;t=RAII+in+Java" title="Share on Hacker News" class="button" rel="nofollow"> <span class="count count-hackernews">0</span> <i class="icon icon-hackernews notranslate" aria-hidden="true"></i> </a> </nav> </header> <article class="main" itemprop="articleBody"><div ><p>Resource Acquisition Is Initialization (<a href="https://en.wikipedia.org/wiki/Resource_acquisition_is_initialization">RAII</a>) is a design idea introduced in C++ by <a href="http://amzn.to/2uMlANB">Bjarne Stroustrup</a> for exception-safe resource management. Thanks to garbage collection Java <a href="https://stackoverflow.com/questions/477399">doesn&#39;t have</a> this feature, but we can implement something similar, using <a href="https://docs.oracle.com/javase/tutorial/essential/exceptions/tryResourceClose.html">try-with-resources</a>.</p><figure class='jb_picture'><img itemprop='image' alt='At Sachem Farm (1998) by John Huddles' src='/images/2017/08/at-sachem-farm.jpg' longdesc='#7aef3b5b'/><figcaption id='7aef3b5b'>At Sachem Farm (1998) by John Huddles</figcaption></figure><p>The problem RAII is solving is obvious; have a look at this code (I&#39;m sure you know what <a href="https://docs.oracle.com/javase/7/docs/api/java/util/concurrent/Semaphore.html"><code>Semaphore</code></a> is and how it works in Java):</p><figure class="highlight"><pre><code class="language-java" data-lang="java"><span></span><span class="kd">class</span> <span class="nc">Foo</span> <span class="o">{</span>
  <span class="kd">private</span> <span class="n">Semaphore</span> <span class="n">sem</span> <span class="o">=</span> <span class="k">new</span> <span class="n">Semaphore</span><span class="o">(</span><span class="mi">5</span><span class="o">);</span>
  <span class="kt">void</span> <span class="nf">print</span><span class="o">(</span><span class="kt">int</span> <span class="n">x</span><span class="o">)</span> <span class="kd">throws</span> <span class="n">Exception</span> <span class="o">{</span>
    <span class="k">this</span><span class="o">.</span><span class="na">sem</span><span class="o">.</span><span class="na">acquire</span><span class="o">();</span>
    <span class="k">if</span> <span class="o">(</span><span class="n">x</span> <span class="o">&gt;</span> <span class="mi">1000</span><span class="o">)</span> <span class="o">{</span>
      <span class="k">throw</span> <span class="k">new</span> <span class="n">Exception</span><span class="o">(</span><span class="s">&quot;Too large!&quot;</span><span class="o">);</span>
    <span class="o">}</span>
    <span class="n">System</span><span class="o">.</span><span class="na">out</span><span class="o">.</span><span class="na">printf</span><span class="o">(</span><span class="s">&quot;x = %d&quot;</span><span class="o">,</span> <span class="n">x</span><span class="o">);</span>
    <span class="k">this</span><span class="o">.</span><span class="na">sem</span><span class="o">.</span><span class="na">release</span><span class="o">();</span>
  <span class="o">}</span>
<span class="o">}</span></code></pre></figure><p>The code is rather primitive and doesn&#39;t do anything useful, but you most probably get the idea: the method <code>print()</code>, if being called from multiple parallel threads, will allow only five of them to print in parallel. Sometimes it will not allow some of them to print and will throw an exception if <code>x</code> is bigger than <code>1000</code>.</p><p>The problem with this code is---<a href="https://en.wikipedia.org/wiki/Resource_leak">resource leakage</a>. Each <code>print()</code> call with <code>x</code> larger than <code>1000</code> will take one permit from the semaphore and won&#39;t return it. In five calls with exceptions the semaphore will be empty and all other threads won&#39;t print anything.</p><p>What is the solution? Here it is:</p><figure class="highlight"><pre><code class="language-java" data-lang="java"><span></span><span class="kd">class</span> <span class="nc">Foo</span> <span class="o">{</span>
  <span class="kd">private</span> <span class="n">Semaphore</span> <span class="n">sem</span> <span class="o">=</span> <span class="k">new</span> <span class="n">Semaphore</span><span class="o">(</span><span class="mi">5</span><span class="o">);</span>
  <span class="kt">void</span> <span class="nf">print</span><span class="o">(</span><span class="kt">int</span> <span class="n">x</span><span class="o">)</span> <span class="kd">throws</span> <span class="n">Exception</span> <span class="o">{</span>
    <span class="k">this</span><span class="o">.</span><span class="na">sem</span><span class="o">.</span><span class="na">acquire</span><span class="o">();</span>
    <span class="k">if</span> <span class="o">(</span><span class="n">x</span> <span class="o">&gt;</span> <span class="mi">1000</span><span class="o">)</span> <span class="o">{</span>
      <span class="k">this</span><span class="o">.</span><span class="na">sem</span><span class="o">.</span><span class="na">release</span><span class="o">();</span>
      <span class="k">throw</span> <span class="k">new</span> <span class="n">Exception</span><span class="o">(</span><span class="s">&quot;Too large!&quot;</span><span class="o">);</span>
    <span class="o">}</span>
    <span class="n">System</span><span class="o">.</span><span class="na">out</span><span class="o">.</span><span class="na">printf</span><span class="o">(</span><span class="s">&quot;x = %d&quot;</span><span class="o">,</span> <span class="n">x</span><span class="o">);</span>
    <span class="k">this</span><span class="o">.</span><span class="na">sem</span><span class="o">.</span><span class="na">release</span><span class="o">();</span>
  <span class="o">}</span>
<span class="o">}</span></code></pre></figure><p>We must release the permit before we throw the exception.</p><p>However, there is another problem that shows up: code duplication. We release the permit in two places. If we add more <code>throw</code> instructions we will also have to add more <code>sem.release()</code> calls.</p><p>A very elegant solution was introduced in C++ and is called RAII. This is how it would look in Java:</p><figure class="highlight"><pre><code class="language-java" data-lang="java"><span></span><span class="kd">class</span> <span class="nc">Permit</span> <span class="o">{</span>
  <span class="kd">private</span> <span class="n">Semaphore</span> <span class="n">sem</span><span class="o">;</span>
  <span class="n">Permit</span><span class="o">(</span><span class="n">Semaphore</span> <span class="n">s</span><span class="o">)</span> <span class="o">{</span>
    <span class="k">this</span><span class="o">.</span><span class="na">sem</span> <span class="o">=</span> <span class="n">s</span><span class="o">;</span>
    <span class="k">this</span><span class="o">.</span><span class="na">sem</span><span class="o">.</span><span class="na">acquire</span><span class="o">();</span>
  <span class="o">}</span>
  <span class="nd">@Override</span>
  <span class="kd">public</span> <span class="kt">void</span> <span class="nf">finalize</span><span class="o">()</span> <span class="o">{</span>
    <span class="k">this</span><span class="o">.</span><span class="na">sem</span><span class="o">.</span><span class="na">release</span><span class="o">();</span>
  <span class="o">}</span>
<span class="o">}</span>
<span class="kd">class</span> <span class="nc">Foo</span> <span class="o">{</span>
  <span class="kd">private</span> <span class="n">Semaphore</span> <span class="n">sem</span> <span class="o">=</span> <span class="k">new</span> <span class="n">Semaphore</span><span class="o">(</span><span class="mi">5</span><span class="o">);</span>
  <span class="kt">void</span> <span class="nf">print</span><span class="o">(</span><span class="kt">int</span> <span class="n">x</span><span class="o">)</span> <span class="kd">throws</span> <span class="n">Exception</span> <span class="o">{</span>
    <span class="k">new</span> <span class="n">Permit</span><span class="o">(</span><span class="k">this</span><span class="o">.</span><span class="na">sem</span><span class="o">);</span>
    <span class="k">if</span> <span class="o">(</span><span class="n">x</span> <span class="o">&gt;</span> <span class="mi">1000</span><span class="o">)</span> <span class="o">{</span>
      <span class="k">throw</span> <span class="k">new</span> <span class="n">Exception</span><span class="o">(</span><span class="s">&quot;Too large!&quot;</span><span class="o">);</span>
    <span class="o">}</span>
    <span class="n">System</span><span class="o">.</span><span class="na">out</span><span class="o">.</span><span class="na">printf</span><span class="o">(</span><span class="s">&quot;x = %d&quot;</span><span class="o">,</span> <span class="n">x</span><span class="o">);</span>
  <span class="o">}</span>
<span class="o">}</span></code></pre></figure><p>See how beautiful the code is inside method <code>Foo.print()</code>. We just create an instance of class <code>Permit</code> and it immediately acquires a new permit at the semaphore. Then we exit the method <code>print()</code>, either by exception or in the normal way, and the method <code>Permit.finalize()</code> releases the permit.</p><p>Elegant, isn&#39;t it? Yes, it is, but it won&#39;t work in Java.</p><p>It won&#39;t work because, unlike C++, Java doesn&#39;t destroy objects when their scope of visibility is closed. The object of class <code>Permit</code> won&#39;t be destroyed when we exit the method <code>print()</code>. It will be destroyed <em>eventually</em> but we don&#39;t know when exactly. Most likely it will be destroyed way after all permits in the semaphore got acquired and we get blocked.</p><p>There is a solution in Java too. It is not as elegant as the one from C++, but it does work. Here it is:</p><figure class="highlight"><pre><code class="language-java" data-lang="java"><span></span><span class="kd">class</span> <span class="nc">Permit</span> <span class="kd">implements</span> <span class="n">Closeable</span> <span class="o">{</span>
  <span class="kd">private</span> <span class="n">Semaphore</span> <span class="n">sem</span><span class="o">;</span>
  <span class="n">Permit</span><span class="o">(</span><span class="n">Semaphore</span> <span class="n">s</span><span class="o">)</span> <span class="o">{</span>
    <span class="k">this</span><span class="o">.</span><span class="na">sem</span> <span class="o">=</span> <span class="n">s</span><span class="o">;</span>
  <span class="o">}</span>
  <span class="nd">@Override</span>
  <span class="kd">public</span> <span class="kt">void</span> <span class="nf">close</span><span class="o">()</span> <span class="o">{</span>
    <span class="k">this</span><span class="o">.</span><span class="na">sem</span><span class="o">.</span><span class="na">release</span><span class="o">();</span>
  <span class="o">}</span>
  <span class="kd">public</span> <span class="n">Permit</span> <span class="nf">acquire</span><span class="o">()</span> <span class="o">{</span>
    <span class="k">this</span><span class="o">.</span><span class="na">sem</span><span class="o">.</span><span class="na">acquire</span><span class="o">();</span>
    <span class="k">return</span> <span class="k">this</span><span class="o">;</span>
  <span class="o">}</span>
<span class="o">}</span>
<span class="kd">class</span> <span class="nc">Foo</span> <span class="o">{</span>
  <span class="kd">private</span> <span class="n">Semaphore</span> <span class="n">sem</span> <span class="o">=</span> <span class="k">new</span> <span class="n">Semaphore</span><span class="o">(</span><span class="mi">5</span><span class="o">);</span>
  <span class="kt">void</span> <span class="nf">print</span><span class="o">(</span><span class="kt">int</span> <span class="n">x</span><span class="o">)</span> <span class="kd">throws</span> <span class="n">Exception</span> <span class="o">{</span>
    <span class="k">try</span> <span class="o">(</span><span class="n">Permit</span> <span class="n">p</span> <span class="o">=</span> <span class="k">new</span> <span class="n">Permit</span><span class="o">(</span><span class="k">this</span><span class="o">.</span><span class="na">sem</span><span class="o">).</span><span class="na">acquire</span><span class="o">())</span> <span class="o">{</span>
      <span class="k">if</span> <span class="o">(</span><span class="n">x</span> <span class="o">&gt;</span> <span class="mi">1000</span><span class="o">)</span> <span class="o">{</span>
        <span class="k">throw</span> <span class="k">new</span> <span class="n">Exception</span><span class="o">(</span><span class="s">&quot;Too large!&quot;</span><span class="o">);</span>
      <span class="o">}</span>
      <span class="n">System</span><span class="o">.</span><span class="na">out</span><span class="o">.</span><span class="na">printf</span><span class="o">(</span><span class="s">&quot;x = %d&quot;</span><span class="o">,</span> <span class="n">x</span><span class="o">);</span>
    <span class="o">}</span>
  <span class="o">}</span>
<span class="o">}</span></code></pre></figure><p>Pay attention to the <code>try</code> block and to the <a href="https://docs.oracle.com/javase/7/docs/api/java/io/Closeable.html"><code>Closeable</code></a> interface that the class <code>Permit</code> now implements. The object <code>p</code> will be &quot;closed&quot; when the <code>try</code> block exits. It may exit either at the end, or by the <code>return</code> or <code>throw</code> statements. In either case <code>Permit.close()</code> will be called: this is how <a href="https://docs.oracle.com/javase/tutorial/essential/exceptions/tryResourceClose.html">try-with-resources</a> works in Java.</p><p>I introduced method <code>acquire()</code> and moved <code>sem.acquire()</code> out of the <code>Permit</code> constructor because I <a href="/2015/05/07/ctors-must-be-code-free.html">believe</a> that constructors must be code-free.</p><p>To summarize, RAII is a perfect design <del>pattern</del> approach when you deal with resources that may <a href="https://en.wikipedia.org/wiki/Resource_leak">leak</a>. Even though Java doesn&#39;t have it out of the box we can implement it via <a href="https://docs.oracle.com/javase/tutorial/essential/exceptions/tryResourceClose.html">try-with-resources</a> and <a href="https://docs.oracle.com/javase/7/docs/api/java/io/Closeable.html"><code>Closeable</code></a>.</p></div></article></div><div class="wrapper"> <related-posts /></div><div class="disqus" role="complementary"><p class="disqus_hint"> Please, use <a href="https://help.disqus.com/commenting/what-html-tags-are-allowed-within-comments">syntax highlighting</a> in your comments, to make them more readable.</p><div id="disqus_thread" class="disqus-thread"> <a>&nbsp;</a></div><script> var disqus_config = function () { this.page.url = document.location.href.split('?')[0].split('#')[0].replace('https://', 'http://'); this.page.identifier = this.page.url; }; (function() { var d = document, s = d.createElement('script'); s.src = '//yegor256.disqus.com/embed.js'; s.setAttribute('data-timestamp', +new Date()); (d.head || d.body).appendChild(s); })(); </script> <noscript><div><p class="red"> JavaScript is disabled in your browser, that's why you can't see comments under this post.</p></div></noscript></div><div class="wrapper"> <footer class="footer"><p> &copy; <span itemscope="" itemprop="copyrightHolder" itemtype="http://schema.org/Person"> <span itemprop="name">Yegor Bugayenko</span> </span> 2014&ndash;<span itemprop="copyrightYear">2018</span></p></footer></div></section><div class="wrapper unprintable" style="text-align:center;margin-top:2em;"> <a href="http://www.sixnines.io/h/3ba1652f"> <img src="//www.sixnines.io/b/3ba1652f?style=flat" alt="sixnines availability badge"/> </a></div><script src="//code.jquery.com/jquery-1.9.0.min.js"></script> <script src="/js/all.js?4e047f6f42b"></script> <script>var disqus_shortname = 'yegor256';</script> <script id="dsq-count-scr" src="//yegor256.disqus.com/count.js" async="async"></script> <script> (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){ (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o), m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m) })(window,document,'script','//www.google-analytics.com/analytics.js','ga'); ga('create', 'UA-1963507-32', 'auto'); ga('send', 'pageview'); </script> <script> Cd=document;Cr="&"+Math.random();Cp="&s=1"; Cd.cookie="b=b";if(Cd.cookie)Cp+="&c=1"; Cp+="&t="+(new Date()).getTimezoneOffset(); if(self!=top)Cp+="&f=1"; </script> <script> if(navigator.javaEnabled())Cp+="&j=1"; </script> <script> if(typeof(screen)!='undefined')Cp+="&w="+screen.width+"&h="+ screen.height+"&d="+(screen.colorDepth?screen.colorDepth:screen.pixelDepth); </script> <script> Cd.write("<img src='//c.hit.ua/hit?i=95870&g=0&x=2"+Cp+Cr+ "&r="+escape(Cd.referrer)+"&u="+escape(window.location.href)+ "' border='0' wi"+"dth='1' he"+"ight='1'/>"); </script> <script type="application/ld+json"> { "@context": "http://schema.org", "@type": "Person", "name": "Yegor Bugayenko", "url": "http://www.yegor256.com", "sameAs": [ "https://www.facebook.com/yegor256", "https://instagram.com/yegor256", "https://www.linkedin.com/in/yegor256", "https://twitter.com/yegor256", "https://github.com/yegor256", "https://www.pinterest.com/yegor256/" ] } </script> </body> </html> <!DOCTYPE html> <html xmlns="http://www.w3.org/1999/xhtml" lang="en-US" xml:lang="en-US" itemscope="" itemtype="http://schema.org/WebSite"> <head> <meta charset="utf-8"/> <meta name="description" content="The design of equals() and compareTo() in Java is far from perfect; this is how I would improve it and make more object-oriented. " /> <meta name="keywords" content="design of compareTo(), design of equals(), how to compare objects, object-oriented compare objects, oop object comparison" /> <meta name="viewport" content="width=device-width,minimum-scale=1,initial-scale=1"/> <meta name="google-site-verification" content="JEj_gQr2CPe2QKGw8XdMz0R7VboQIUbX3FlM-lwTq-8" /> <meta name="author" content="Yegor Bugayenko"> <meta name="article:published_time" content="2017-07-11 00:00:00 +0000"> <meta name="og:site_name" content="Yegor Bugayenko"/> <meta name="og:type" content="article" /> <meta name="og:locale" content="en_US" /> <meta name="twitter:account_id" content="4503599630178231" /> <meta name="twitter:creator" content="@yegor256"/> <meta name="twitter:site" content="@yegor256"/> <meta name="twitter:title" property="og:title" content="How I Would Re-design equals()"/> <meta name="twitter:description" property="og:description" content="The design of equals() and compareTo() in Java is far from perfect; this is how I would improve it and make more object-oriented. "/> <meta name="twitter:url" property="og:url" content="https://www.yegor256.com/2017/07/11/how-to-redesign-equals.html"/> <meta name="telegram:channel" content="AAAAAEJFMRzsRTRxM3ec6A"/> <link rel="search" type="application/opensearchdescription+xml" href="/opensearch.xml" title="yegor256" /> <link rel="shortcut icon" href="/favicon.ico?4e047f6f42b"/> <link rel="apple-touch-icon" href="/favicon.ico?4e047f6f42b"/> <link rel="alternate" type="application/rss+xml" title="RSS for yegor256.com" href="https://www.yegor256.com/rss.xml"/> <link rel="stylesheet" href="/css/layout.css?4e047f6f42b"/> <link rel="stylesheet" href="/css/icons.css?4e047f6f42b"/> <link rel="canonical" href="https://www.yegor256.com/2017/07/11/how-to-redesign-equals.html" /> <link rel="amphtml" href="https://www.yegor256.com/2017/07/11/how-to-redesign-equals.amp.html" /> <title>How I Would Re-design equals() </title> <meta name='og:image' content='https://www.yegor256.com/images/2017/07/lultimo-capodanno.jpg'/><meta name='twitter:image' content='https://www.yegor256.com/images/2017/07/lultimo-capodanno.jpg'/><meta name='og:image:width' content='1280'/> <meta name='twitter:image:width' content='1280'/><meta name='og:image:height' content='542'/> <meta name='twitter:image:height' content='542'/><meta name='twitter:card' content='summary_large_image'/><meta name='twitter:image:alt' content='L&#39;ultimo capodanno (1998) by Marco Risi'/> </head> <body><div class="wrapper"> <aside class="header-toggle unprintable" id="header-toggle" title="Show the menu" onclick="$('#header').show();$('#header-toggle').hide();">&#9776;</aside> <header class="header" id="header"><div class="face"> <a href="/about-me.html#form" class="sub" title="Click to subscribe to my monthly newsletter"><span>Subscribe</span></a> <a href="/about-me.html" style="position:relative;"> <img src="/images/face-256x256.jpg" class="photo" alt="Yegor Bugayenko"/> </a></div><nav><ul class="menu social notranslate"> <li><a href="https://twitter.com/intent/follow?screen_name=yegor256" rel="nofollow" title="Follow me on Twitter"><i class="icon icon-twitter notranslate" aria-hidden="true"></i></a></li> <li><a href="/rss.xml" rel="nofollow" title="Subscribe to my RSS feed"><i class="icon icon-rss notranslate" aria-hidden="true"></i></a></li> <li><a itemprop="sameAs" href="https://github.com/yegor256" rel="nofollow" title="My GitHub profile"><i class="icon icon-github notranslate" aria-hidden="true"></i></a></li> <li><a itemprop="sameAs" href="http://stackoverflow.com/users/187141/yegor256" rel="nofollow" title="My StackOverflow profile"><i class="icon icon-stackoverflow notranslate" aria-hidden="true"></i></a></li> <li><a itemprop="sameAs" href="https://www.facebook.com/yegor256" rel="nofollow" title="Follow me on Facebook"><i class="icon icon-facebook notranslate" aria-hidden="true"></i></a></li> <li><a itemprop="sameAs" href="https://instagram.com/yegor256" rel="nofollow" title="Follow me on Instagram"><i class="icon icon-instagram notranslate" aria-hidden="true"></i></a></li> <li><a itemprop="sameAs" href="https://www.linkedin.com/in/yegor256" rel="nofollow" title="My LinkedIn profile"><i class="icon icon-linkedin notranslate" aria-hidden="true"></i></a></li> <li><a itemprop="sameAs" href="https://www.youtube.com/c/yegor256?sub_confirmation=1" rel="nofollow" title="My Youtube video channel"><i class="icon icon-youtube notranslate" aria-hidden="true"></i></a></li> <li><a itemprop="sameAs" href="https://www.pinterest.com/yegor256/" rel="nofollow" title="My Pinterest boards"><i class="icon icon-pinterest notranslate" aria-hidden="true"></i></a></li> <li><a itemprop="sameAs" href="https://angel.co/yegor256" rel="nofollow" title="My AngelList profile"><i class="icon icon-angellist notranslate" aria-hidden="true"></i></a></li> <li><a href="https://soundcloud.com/yegor256" rel="nofollow" title="My podcast"><i class="icon icon-podcast notranslate" aria-hidden="true"></i></a></li> <li><a href="https://itunes.apple.com/us/podcast/yegor256-podcast/id1150826721" rel="nofollow" title="My iTunes podcast"><i class="icon icon-itunes notranslate" aria-hidden="true"></i></a></li> <li><a href="https://t.me/joinchat/AAAAAEJFMRzsRTRxM3ec6A" rel="nofollow" title="My Telegram public channel"><i class="icon icon-telegram notranslate" aria-hidden="true"></i></a></li> <li><a href="mailto:blog@yegor256.com" rel="nofollow" title="Email me any time"><i class="icon icon-mail notranslate" aria-hidden="true"></i></a></li></ul><ul class="menu"> <li><a href="/" title="Home page">Home</a></li> <li ><a href="/best.html" title="Best articles to read">12&#160;Best</a></li> <li ><a href="/contents.html" title="The contents of the entire blog">All&#160;288</a></li> <li ><a href="/webinars.html" title="My webinars">Webinars</a></li> <li ><a href="/talks.html" title="Future and past conference talks">Talks</a></li> <li ><a href="/books.html" title="The books I wrote">Books</a></li> <li ><a href="/papers.html" title="My academic papers and patents">Papers</a></li> <li ><a href="/pets.html" title="My loved pet projects">Pets</a></li> <li ><a href="/award.html" title="Software quality award">Award</a></li> <li ><a href="/testimonials.html" title="What some people say about me">Testimonials</a></li> <li ><a href="/shift-m.html" title="Audio podcast about project management">Shift-M</a></li> <li ><a href="/paintings.html" title="My paintings for sale">Paintings</a></li> <li><a href="http://ru.yegor256.com/" title="Немного на русском языке">По-русски</a></li></ul></nav><div class="search"> <form method="get" action="https://www.google.com/search" itemprop="potentialAction" itemscope="" itemtype="http://schema.org/SearchAction"> <meta itemprop="target" content="https://www.google.com/search?q={q}"/> <input name="sitesearch" value="yegor256.com" type="hidden"/> <input itemprop="query-input" type="text" id="search-query" class="field field-text" required="required" onfocus="$('.google').css('visibility', 'visible');" name="q" placeholder="Search..." autocomplete="off"/> <input type="image" src="/images/google-search-icon.svg" class="google" title="Search via Google" alt="Search via Google"/> </form></div><div class="hot"><ul> <li> <a href="/code-ahead.html">Code Ahead</a> was published on Amazon just a few days ago! It is my new book, a novel about programmers. It explains in details the majority of ideas that stand behind <a href="https://www.zerocracy.com">Zerocracy</a> and <a href="https://www.xdsd.org">XDSD</a>. </li> <li> At <a href="/webinars.html">Webinar #37</a> we will discuss naming problem in OOP, for objects, methods and attributes; join us on <b>September 12</b>, at 11am PST. </li></ul></div></header></div><section itemscope="" itemtype="http://schema.org/BlogPosting"><div class="wrapper"> <header><p class="printable"> <img src="https://api.qrserver.com/v1/create-qr-code/?data=https://www.yegor256.com/2017/07/11/how-to-redesign-equals.html&amp;format=svg" style="width:125px;height:125px;" alt="QR code"/></p><p class="printable"> <code itemprop="url">https://www.yegor256.com/2017/07/11/how-to-redesign-equals.html</code></p><h1 itemprop="name headline mainEntityOfPage">How I Would Re-design equals()</h1><ul class="subline"> <li> <time itemprop="datePublished" datetime="2017-07-11T00:00:00+00:00"> 11 July 2017 </time> </li> <li class="desktop-only" itemprop="locationCreated">Copenhagen, Denmark</li> <li class="printable" itemscope="" itemprop="author" itemtype="http://schema.org/Person"> <span itemprop="name">Yegor Bugayenko</span> </li> <li class="unprintable"> <i class="icon icon-comments"></i> <a href="http://www.yegor256.com/2017/07/11/how-to-redesign-equals.html#disqus_thread" itemprop="discussionUrl">comments</a> </li></ul><figure class='jb_picture'><img itemprop='image' alt='L&#39;ultimo capodanno (1998) by Marco Risi' src='/images/2017/07/lultimo-capodanno.jpg' longdesc='#4900028f'/><figcaption id='4900028f'>L&#39;ultimo capodanno (1998) by Marco Risi</figcaption></figure><p>Say we have a <del>simple</del> primitive class <code>Weight</code>, objects of which represent the weight of something in kilos:</p><figure class="highlight"><pre><code class="language-java" data-lang="java"><span></span><span class="kd">class</span> <span class="nc">Weight</span> <span class="o">{</span>
  <span class="kd">private</span> <span class="kt">int</span> <span class="n">kilos</span><span class="o">;</span>
  <span class="n">Weight</span><span class="o">(</span><span class="kt">int</span> <span class="n">k</span><span class="o">)</span> <span class="o">{</span>
    <span class="k">this</span><span class="o">.</span><span class="na">kilos</span> <span class="o">=</span> <span class="n">k</span><span class="o">;</span>
  <span class="o">}</span>
<span class="o">}</span></code></pre></figure><p>Next, we want two objects of the same weight to be equal to each other:</p><figure class="highlight"><pre><code class="language-java" data-lang="java"><span></span><span class="k">new</span> <span class="n">Weight</span><span class="o">(</span><span class="mi">15</span><span class="o">).</span><span class="na">equals</span><span class="o">(</span><span class="k">new</span> <span class="n">Weight</span><span class="o">(</span><span class="mi">15</span><span class="o">));</span></code></pre></figure><p>Here is how such a method may look:</p><figure class="highlight"><pre><code class="language-java" data-lang="java"><span></span><span class="kd">class</span> <span class="nc">Weight</span> <span class="o">{</span>
  <span class="kd">private</span> <span class="kt">int</span> <span class="n">kilos</span><span class="o">;</span>
  <span class="n">Weight</span><span class="o">(</span><span class="kt">int</span> <span class="n">k</span><span class="o">)</span> <span class="o">{</span>
    <span class="k">this</span><span class="o">.</span><span class="na">kilos</span> <span class="o">=</span> <span class="n">k</span><span class="o">;</span>
  <span class="o">}</span>
  <span class="kd">public</span> <span class="kt">boolean</span> <span class="nf">equals</span><span class="o">(</span><span class="n">Object</span> <span class="n">obj</span><span class="o">)</span> <span class="o">{</span>
    <span class="k">if</span> <span class="o">(!(</span><span class="n">obj</span> <span class="k">instanceof</span> <span class="n">Weight</span><span class="o">))</span> <span class="o">{</span>
      <span class="k">return</span> <span class="kc">false</span><span class="o">;</span>
    <span class="o">}</span>
    <span class="n">Weight</span> <span class="n">weight</span> <span class="o">=</span> <span class="n">Weight</span><span class="o">.</span><span class="na">class</span><span class="o">.</span><span class="na">cast</span><span class="o">(</span><span class="n">obj</span><span class="o">);</span>
    <span class="k">return</span> <span class="n">weight</span><span class="o">.</span><span class="na">kilos</span> <span class="o">==</span> <span class="k">this</span><span class="o">.</span><span class="na">kilos</span><span class="o">;</span>
  <span class="o">}</span>
<span class="o">}</span></code></pre></figure><p>The ugly part here is, first of all, the <a href="/2015/04/02/class-casting-is-anti-pattern.html">type casting</a> with <code>instanceof</code>. The second problem is that we touch the internals of the incoming object. This design makes polymorphic behavior of the <code>Weight</code> impossible. We simply can&#39;t pass anything else to the <code>equals()</code> method, besides an instance of the class <code>Weight</code>. We can&#39;t turn it into an interface and introduce multiple implementations of it:</p><figure class="highlight"><pre><code class="language-java" data-lang="java"><span></span><span class="kd">interface</span> <span class="nc">Weight</span> <span class="o">{</span>
  <span class="kt">boolean</span> <span class="nf">equals</span><span class="o">(</span><span class="n">Object</span> <span class="n">obj</span><span class="o">);</span>
<span class="o">}</span></code></pre></figure><p>This code will not work:</p><figure class="highlight"><pre><code class="language-java" data-lang="java"><span></span><span class="kd">class</span> <span class="nc">DefaultWeight</span> <span class="kd">implements</span> <span class="n">Weight</span> <span class="o">{</span>
  <span class="c1">// attribute and ctor skipped</span>
  <span class="kd">public</span> <span class="kt">boolean</span> <span class="nf">equals</span><span class="o">(</span><span class="n">Object</span> <span class="n">obj</span><span class="o">)</span> <span class="o">{</span>
    <span class="k">if</span> <span class="o">(!(</span><span class="n">obj</span> <span class="k">instanceof</span> <span class="n">Weight</span><span class="o">))</span> <span class="o">{</span>
      <span class="k">return</span> <span class="kc">false</span><span class="o">;</span>
    <span class="o">}</span>
    <span class="n">Weight</span> <span class="n">weight</span> <span class="o">=</span> <span class="n">Weight</span><span class="o">.</span><span class="na">class</span><span class="o">.</span><span class="na">cast</span><span class="o">(</span><span class="n">obj</span><span class="o">);</span>
    <span class="k">return</span> <span class="n">weight</span><span class="o">.</span><span class="na">kilos</span> <span class="o">==</span> <span class="k">this</span><span class="o">.</span><span class="na">kilos</span><span class="o">;</span> <span class="c1">// error here!</span>
  <span class="o">}</span>
<span class="o">}</span></code></pre></figure><p>The problem is that one object decides for the other whether they are equal. This inevitably leads to a necessity to touch private attributes in order to do the actual comparison.</p><p>What is the solution?</p><p>This is what I&#39;m offering. Any comparison, no matter what types we are talking about, is about comparing two digital values. Either we compare a weight with a weight, text with text, or a user with a user---our CPUs can only compare numbers. Thus, we introduce a new interface <code>Digitizable</code>:</p><figure class="highlight"><pre><code class="language-java" data-lang="java"><span></span><span class="kd">interface</span> <span class="nc">Digitizable</span> <span class="o">{</span>
  <span class="kt">byte</span><span class="o">[]</span> <span class="nf">digits</span><span class="o">();</span>
<span class="o">}</span></code></pre></figure><p>Next, we introduce a new class <code>Comparison</code>, which <em>is</em> the comparison of two streams of bytes (I&#39;m not sure the code is perfect, I tested it <a href="https://github.com/yegor256/blog/tree/master/_samples/2017/07/equals">here</a>, feel free to improve and contribute with a pull request):</p><figure class="highlight"><pre><code class="language-java" data-lang="java"><span></span><span class="kd">class</span> <span class="nc">Comparison</span><span class="o">&lt;</span><span class="n">T</span> <span class="kd">extends</span> <span class="n">Digitizable</span><span class="o">&gt;</span> <span class="o">{</span>
  <span class="kd">private</span> <span class="n">T</span> <span class="n">lt</span><span class="o">;</span>
  <span class="kd">private</span> <span class="n">T</span> <span class="n">rt</span><span class="o">;</span>
  <span class="n">Comparison</span><span class="o">(</span><span class="n">T</span> <span class="n">left</span><span class="o">,</span> <span class="n">T</span> <span class="n">right</span><span class="o">)</span> <span class="o">{</span>
    <span class="k">this</span><span class="o">.</span><span class="na">lt</span> <span class="o">=</span> <span class="n">left</span><span class="o">;</span>
    <span class="k">this</span><span class="o">.</span><span class="na">rt</span> <span class="o">=</span> <span class="n">right</span><span class="o">;</span>
  <span class="o">}</span>
  <span class="kt">int</span> <span class="nf">value</span><span class="o">()</span> <span class="o">{</span>
    <span class="kd">final</span> <span class="kt">byte</span><span class="o">[]</span> <span class="n">left</span> <span class="o">=</span> <span class="k">this</span><span class="o">.</span><span class="na">lt</span><span class="o">.</span><span class="na">digits</span><span class="o">();</span>
    <span class="kd">final</span> <span class="kt">byte</span><span class="o">[]</span> <span class="n">right</span> <span class="o">=</span> <span class="k">this</span><span class="o">.</span><span class="na">rt</span><span class="o">.</span><span class="na">digits</span><span class="o">();</span>
    <span class="kt">int</span> <span class="n">result</span> <span class="o">=</span> <span class="mi">0</span><span class="o">;</span>
    <span class="kt">int</span> <span class="n">max</span> <span class="o">=</span> <span class="n">Math</span><span class="o">.</span><span class="na">max</span><span class="o">(</span><span class="n">left</span><span class="o">.</span><span class="na">length</span><span class="o">,</span> <span class="n">right</span><span class="o">.</span><span class="na">length</span><span class="o">);</span>
    <span class="k">for</span> <span class="o">(</span><span class="kt">int</span> <span class="n">idx</span> <span class="o">=</span> <span class="n">max</span><span class="o">;</span> <span class="n">idx</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="o">;</span> <span class="o">--</span><span class="n">idx</span><span class="o">)</span> <span class="o">{</span>
      <span class="kt">byte</span> <span class="n">lft</span> <span class="o">=</span> <span class="mi">0</span><span class="o">;</span>
      <span class="k">if</span> <span class="o">(</span><span class="n">idx</span> <span class="o">&lt;=</span> <span class="n">left</span><span class="o">.</span><span class="na">length</span><span class="o">)</span> <span class="o">{</span>
        <span class="n">lft</span> <span class="o">=</span> <span class="n">left</span><span class="o">[</span><span class="n">max</span> <span class="o">-</span> <span class="n">idx</span><span class="o">];</span>
      <span class="o">}</span>
      <span class="kt">byte</span> <span class="n">rht</span> <span class="o">=</span> <span class="mi">0</span><span class="o">;</span>
      <span class="k">if</span> <span class="o">(</span><span class="n">idx</span> <span class="o">&lt;=</span> <span class="n">right</span><span class="o">.</span><span class="na">length</span><span class="o">)</span> <span class="o">{</span>
        <span class="n">rht</span> <span class="o">=</span> <span class="n">right</span><span class="o">[</span><span class="n">max</span> <span class="o">-</span> <span class="n">idx</span><span class="o">];</span>
      <span class="o">}</span>
      <span class="n">result</span> <span class="o">=</span> <span class="n">lft</span> <span class="o">-</span> <span class="n">rht</span><span class="o">;</span>
      <span class="k">if</span> <span class="o">(</span><span class="n">result</span> <span class="o">!=</span> <span class="mi">0</span><span class="o">)</span> <span class="o">{</span>
        <span class="k">break</span><span class="o">;</span>
      <span class="o">}</span>
    <span class="o">}</span>
    <span class="k">return</span> <span class="o">(</span><span class="kt">int</span><span class="o">)</span> <span class="n">Math</span><span class="o">.</span><span class="na">signum</span><span class="o">(</span><span class="n">result</span><span class="o">);</span>
  <span class="o">}</span>
<span class="o">}</span></code></pre></figure><p>Now, we need <code>Weight</code> to implement <code>Digitizable</code>:</p><figure class="highlight"><pre><code class="language-java" data-lang="java"><span></span><span class="kd">class</span> <span class="nc">Weight</span> <span class="kd">implements</span> <span class="n">Digitizable</span> <span class="o">{</span>
  <span class="kd">private</span> <span class="kt">int</span> <span class="n">kilos</span><span class="o">;</span>
  <span class="n">Weight</span><span class="o">(</span><span class="kt">int</span> <span class="n">k</span><span class="o">)</span> <span class="o">{</span>
    <span class="k">this</span><span class="o">.</span><span class="na">kilos</span> <span class="o">=</span> <span class="n">k</span><span class="o">;</span>
  <span class="o">}</span>
  <span class="nd">@Override</span>
  <span class="kd">public</span> <span class="kt">byte</span><span class="o">[]</span> <span class="nf">digits</span><span class="o">()</span> <span class="o">{</span>
    <span class="k">return</span> <span class="n">ByteBuffer</span><span class="o">.</span><span class="na">allocate</span><span class="o">(</span><span class="mi">4</span><span class="o">)</span>
      <span class="o">.</span><span class="na">putInt</span><span class="o">(</span><span class="k">this</span><span class="o">.</span><span class="na">kilos</span><span class="o">).</span><span class="na">array</span><span class="o">();</span>
  <span class="o">}</span>
<span class="o">}</span></code></pre></figure><p>Finally, this is how we compare them:</p><figure class="highlight"><pre><code class="language-java" data-lang="java"><span></span><span class="kt">int</span> <span class="n">v</span> <span class="o">=</span> <span class="k">new</span> <span class="n">Comparison</span><span class="o">&lt;</span><span class="n">Weight</span><span class="o">&gt;(</span>
  <span class="k">new</span> <span class="n">Weight</span><span class="o">(</span><span class="mi">400</span><span class="o">),</span> <span class="k">new</span> <span class="n">Weight</span><span class="o">(</span><span class="mi">500</span><span class="o">)</span>
<span class="o">).</span><span class="na">value</span><span class="o">();</span></code></pre></figure><p>This <code>v</code> will either be <code>-1</code>, <code>0</code>, or <code>1</code>. In this particular case it will be <code>-1</code>, because <code>400</code> is less than <code>500</code>.</p><p>No more violation of encapsulation, no more type casting, no more ugly code inside those <code>equals()</code> and <code>compareTo()</code> methods. The class <code>Comparison</code> will work with all possible types. All our objects need to do in order to become comparable is to implement <code>Digitizable</code> and &quot;provide&quot; their bytes for inspection/comparison.</p><p>This approach is actually very close to the <a href="/2016/04/05/printers-instead-of-getters.html">printers</a> I described earlier.</p></p>--> <nav class="buttons notranslate desktop-only"> <a href="http://www.facebook.com/sharer/sharer.php?u=https://www.yegor256.com/2017/07/11/how-to-redesign-equals.html" title="Share on Facebook" class="button" rel="nofollow"> <span class="count count-facebook">0</span> <i class="icon icon-facebook notranslate" aria-hidden="true"></i> </a> <a href="https://twitter.com/share?url=https://www.yegor256.com/2017/07/11/how-to-redesign-equals.html&amp;text=How+I+Would+Re-design+equals%28%29" title="Share on Twitter" class="button" rel="nofollow"> <span class="count count-twitter">0</span> <i class="icon icon-twitter notranslate" aria-hidden="true"></i> </a> <a href="https://plus.google.com/share?url=https://www.yegor256.com/2017/07/11/how-to-redesign-equals.html" title="Share on Google+" class="button" rel="nofollow"> <span class="count count-googleplus">0</span> <i class="icon icon-googleplus notranslate" aria-hidden="true"></i> </a> <a href="https://www.linkedin.com/cws/share?url=https://www.yegor256.com/2017/07/11/how-to-redesign-equals.html" title="Share on LinkedIn" class="button" rel="nofollow"> <span class="count count-linkedin">0</span> <i class="icon icon-linkedin notranslate" aria-hidden="true"></i> </a> <a href="http://reddit.com/submit?url=https://www.yegor256.com/2017/07/11/how-to-redesign-equals.html%3F2017-28&amp;title=How+I+Would+Re-design+equals%28%29" title="Share on Reddit" class="button" rel="nofollow"> <span class="count count-reddit">0</span> <i class="icon icon-reddit notranslate" aria-hidden="true"></i> </a> <a href="http://news.ycombinator.com/submitlink?u=https://www.yegor256.com/2017/07/11/how-to-redesign-equals.html%3F2017-28&amp;t=How+I+Would+Re-design+equals%28%29" title="Share on Hacker News" class="button" rel="nofollow"> <span class="count count-hackernews">0</span> <i class="icon icon-hackernews notranslate" aria-hidden="true"></i> </a> </nav> </header> <article class="main" itemprop="articleBody"><div ><p>I want to rant a bit about Java design, in particular about the methods <a href="https://docs.oracle.com/javase/7/docs/api/java/lang/Object.html#equals%28java.lang.Object%29"><code>Object.equals()</code></a> and <a href="https://docs.oracle.com/javase/7/docs/api/java/lang/Comparable.html#compareTo%28T%29"><code>Comparable.compareTo()</code></a>. I&#39;ve hated them for years, because, no matter how hard I try to like them, the code inside looks ugly. Now I know what exactly is wrong and how I would design this &quot;object-to-object comparing&quot; mechanism <em>better</em>.</p><figure class='jb_picture'><img itemprop='image' alt='L&#39;ultimo capodanno (1998) by Marco Risi' src='/images/2017/07/lultimo-capodanno.jpg' longdesc='#4900028f'/><figcaption id='4900028f'>L&#39;ultimo capodanno (1998) by Marco Risi</figcaption></figure><p>Say we have a <del>simple</del> primitive class <code>Weight</code>, objects of which represent the weight of something in kilos:</p><figure class="highlight"><pre><code class="language-java" data-lang="java"><span></span><span class="kd">class</span> <span class="nc">Weight</span> <span class="o">{</span>
  <span class="kd">private</span> <span class="kt">int</span> <span class="n">kilos</span><span class="o">;</span>
  <span class="n">Weight</span><span class="o">(</span><span class="kt">int</span> <span class="n">k</span><span class="o">)</span> <span class="o">{</span>
    <span class="k">this</span><span class="o">.</span><span class="na">kilos</span> <span class="o">=</span> <span class="n">k</span><span class="o">;</span>
  <span class="o">}</span>
<span class="o">}</span></code></pre></figure><p>Next, we want two objects of the same weight to be equal to each other:</p><figure class="highlight"><pre><code class="language-java" data-lang="java"><span></span><span class="k">new</span> <span class="n">Weight</span><span class="o">(</span><span class="mi">15</span><span class="o">).</span><span class="na">equals</span><span class="o">(</span><span class="k">new</span> <span class="n">Weight</span><span class="o">(</span><span class="mi">15</span><span class="o">));</span></code></pre></figure><p>Here is how such a method may look:</p><figure class="highlight"><pre><code class="language-java" data-lang="java"><span></span><span class="kd">class</span> <span class="nc">Weight</span> <span class="o">{</span>
  <span class="kd">private</span> <span class="kt">int</span> <span class="n">kilos</span><span class="o">;</span>
  <span class="n">Weight</span><span class="o">(</span><span class="kt">int</span> <span class="n">k</span><span class="o">)</span> <span class="o">{</span>
    <span class="k">this</span><span class="o">.</span><span class="na">kilos</span> <span class="o">=</span> <span class="n">k</span><span class="o">;</span>
  <span class="o">}</span>
  <span class="kd">public</span> <span class="kt">boolean</span> <span class="nf">equals</span><span class="o">(</span><span class="n">Object</span> <span class="n">obj</span><span class="o">)</span> <span class="o">{</span>
    <span class="k">if</span> <span class="o">(!(</span><span class="n">obj</span> <span class="k">instanceof</span> <span class="n">Weight</span><span class="o">))</span> <span class="o">{</span>
      <span class="k">return</span> <span class="kc">false</span><span class="o">;</span>
    <span class="o">}</span>
    <span class="n">Weight</span> <span class="n">weight</span> <span class="o">=</span> <span class="n">Weight</span><span class="o">.</span><span class="na">class</span><span class="o">.</span><span class="na">cast</span><span class="o">(</span><span class="n">obj</span><span class="o">);</span>
    <span class="k">return</span> <span class="n">weight</span><span class="o">.</span><span class="na">kilos</span> <span class="o">==</span> <span class="k">this</span><span class="o">.</span><span class="na">kilos</span><span class="o">;</span>
  <span class="o">}</span>
<span class="o">}</span></code></pre></figure><p>The ugly part here is, first of all, the <a href="/2015/04/02/class-casting-is-anti-pattern.html">type casting</a> with <code>instanceof</code>. The second problem is that we touch the internals of the incoming object. This design makes polymorphic behavior of the <code>Weight</code> impossible. We simply can&#39;t pass anything else to the <code>equals()</code> method, besides an instance of the class <code>Weight</code>. We can&#39;t turn it into an interface and introduce multiple implementations of it:</p><figure class="highlight"><pre><code class="language-java" data-lang="java"><span></span><span class="kd">interface</span> <span class="nc">Weight</span> <span class="o">{</span>
  <span class="kt">boolean</span> <span class="nf">equals</span><span class="o">(</span><span class="n">Object</span> <span class="n">obj</span><span class="o">);</span>
<span class="o">}</span></code></pre></figure><p>This code will not work:</p><figure class="highlight"><pre><code class="language-java" data-lang="java"><span></span><span class="kd">class</span> <span class="nc">DefaultWeight</span> <span class="kd">implements</span> <span class="n">Weight</span> <span class="o">{</span>
  <span class="c1">// attribute and ctor skipped</span>
  <span class="kd">public</span> <span class="kt">boolean</span> <span class="nf">equals</span><span class="o">(</span><span class="n">Object</span> <span class="n">obj</span><span class="o">)</span> <span class="o">{</span>
    <span class="k">if</span> <span class="o">(!(</span><span class="n">obj</span> <span class="k">instanceof</span> <span class="n">Weight</span><span class="o">))</span> <span class="o">{</span>
      <span class="k">return</span> <span class="kc">false</span><span class="o">;</span>
    <span class="o">}</span>
    <span class="n">Weight</span> <span class="n">weight</span> <span class="o">=</span> <span class="n">Weight</span><span class="o">.</span><span class="na">class</span><span class="o">.</span><span class="na">cast</span><span class="o">(</span><span class="n">obj</span><span class="o">);</span>
    <span class="k">return</span> <span class="n">weight</span><span class="o">.</span><span class="na">kilos</span> <span class="o">==</span> <span class="k">this</span><span class="o">.</span><span class="na">kilos</span><span class="o">;</span> <span class="c1">// error here!</span>
  <span class="o">}</span>
<span class="o">}</span></code></pre></figure><p>The problem is that one object decides for the other whether they are equal. This inevitably leads to a necessity to touch private attributes in order to do the actual comparison.</p><p>What is the solution?</p><p>This is what I&#39;m offering. Any comparison, no matter what types we are talking about, is about comparing two digital values. Either we compare a weight with a weight, text with text, or a user with a user---our CPUs can only compare numbers. Thus, we introduce a new interface <code>Digitizable</code>:</p><figure class="highlight"><pre><code class="language-java" data-lang="java"><span></span><span class="kd">interface</span> <span class="nc">Digitizable</span> <span class="o">{</span>
  <span class="kt">byte</span><span class="o">[]</span> <span class="nf">digits</span><span class="o">();</span>
<span class="o">}</span></code></pre></figure><p>Next, we introduce a new class <code>Comparison</code>, which <em>is</em> the comparison of two streams of bytes (I&#39;m not sure the code is perfect, I tested it <a href="https://github.com/yegor256/blog/tree/master/_samples/2017/07/equals">here</a>, feel free to improve and contribute with a pull request):</p><figure class="highlight"><pre><code class="language-java" data-lang="java"><span></span><span class="kd">class</span> <span class="nc">Comparison</span><span class="o">&lt;</span><span class="n">T</span> <span class="kd">extends</span> <span class="n">Digitizable</span><span class="o">&gt;</span> <span class="o">{</span>
  <span class="kd">private</span> <span class="n">T</span> <span class="n">lt</span><span class="o">;</span>
  <span class="kd">private</span> <span class="n">T</span> <span class="n">rt</span><span class="o">;</span>
  <span class="n">Comparison</span><span class="o">(</span><span class="n">T</span> <span class="n">left</span><span class="o">,</span> <span class="n">T</span> <span class="n">right</span><span class="o">)</span> <span class="o">{</span>
    <span class="k">this</span><span class="o">.</span><span class="na">lt</span> <span class="o">=</span> <span class="n">left</span><span class="o">;</span>
    <span class="k">this</span><span class="o">.</span><span class="na">rt</span> <span class="o">=</span> <span class="n">right</span><span class="o">;</span>
  <span class="o">}</span>
  <span class="kt">int</span> <span class="nf">value</span><span class="o">()</span> <span class="o">{</span>
    <span class="kd">final</span> <span class="kt">byte</span><span class="o">[]</span> <span class="n">left</span> <span class="o">=</span> <span class="k">this</span><span class="o">.</span><span class="na">lt</span><span class="o">.</span><span class="na">digits</span><span class="o">();</span>
    <span class="kd">final</span> <span class="kt">byte</span><span class="o">[]</span> <span class="n">right</span> <span class="o">=</span> <span class="k">this</span><span class="o">.</span><span class="na">rt</span><span class="o">.</span><span class="na">digits</span><span class="o">();</span>
    <span class="kt">int</span> <span class="n">result</span> <span class="o">=</span> <span class="mi">0</span><span class="o">;</span>
    <span class="kt">int</span> <span class="n">max</span> <span class="o">=</span> <span class="n">Math</span><span class="o">.</span><span class="na">max</span><span class="o">(</span><span class="n">left</span><span class="o">.</span><span class="na">length</span><span class="o">,</span> <span class="n">right</span><span class="o">.</span><span class="na">length</span><span class="o">);</span>
    <span class="k">for</span> <span class="o">(</span><span class="kt">int</span> <span class="n">idx</span> <span class="o">=</span> <span class="n">max</span><span class="o">;</span> <span class="n">idx</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="o">;</span> <span class="o">--</span><span class="n">idx</span><span class="o">)</span> <span class="o">{</span>
      <span class="kt">byte</span> <span class="n">lft</span> <span class="o">=</span> <span class="mi">0</span><span class="o">;</span>
      <span class="k">if</span> <span class="o">(</span><span class="n">idx</span> <span class="o">&lt;=</span> <span class="n">left</span><span class="o">.</span><span class="na">length</span><span class="o">)</span> <span class="o">{</span>
        <span class="n">lft</span> <span class="o">=</span> <span class="n">left</span><span class="o">[</span><span class="n">max</span> <span class="o">-</span> <span class="n">idx</span><span class="o">];</span>
      <span class="o">}</span>
      <span class="kt">byte</span> <span class="n">rht</span> <span class="o">=</span> <span class="mi">0</span><span class="o">;</span>
      <span class="k">if</span> <span class="o">(</span><span class="n">idx</span> <span class="o">&lt;=</span> <span class="n">right</span><span class="o">.</span><span class="na">length</span><span class="o">)</span> <span class="o">{</span>
        <span class="n">rht</span> <span class="o">=</span> <span class="n">right</span><span class="o">[</span><span class="n">max</span> <span class="o">-</span> <span class="n">idx</span><span class="o">];</span>
      <span class="o">}</span>
      <span class="n">result</span> <span class="o">=</span> <span class="n">lft</span> <span class="o">-</span> <span class="n">rht</span><span class="o">;</span>
      <span class="k">if</span> <span class="o">(</span><span class="n">result</span> <span class="o">!=</span> <span class="mi">0</span><span class="o">)</span> <span class="o">{</span>
        <span class="k">break</span><span class="o">;</span>
      <span class="o">}</span>
    <span class="o">}</span>
    <span class="k">return</span> <span class="o">(</span><span class="kt">int</span><span class="o">)</span> <span class="n">Math</span><span class="o">.</span><span class="na">signum</span><span class="o">(</span><span class="n">result</span><span class="o">);</span>
  <span class="o">}</span>
<span class="o">}</span></code></pre></figure><p>Now, we need <code>Weight</code> to implement <code>Digitizable</code>:</p><figure class="highlight"><pre><code class="language-java" data-lang="java"><span></span><span class="kd">class</span> <span class="nc">Weight</span> <span class="kd">implements</span> <span class="n">Digitizable</span> <span class="o">{</span>
  <span class="kd">private</span> <span class="kt">int</span> <span class="n">kilos</span><span class="o">;</span>
  <span class="n">Weight</span><span class="o">(</span><span class="kt">int</span> <span class="n">k</span><span class="o">)</span> <span class="o">{</span>
    <span class="k">this</span><span class="o">.</span><span class="na">kilos</span> <span class="o">=</span> <span class="n">k</span><span class="o">;</span>
  <span class="o">}</span>
  <span class="nd">@Override</span>
  <span class="kd">public</span> <span class="kt">byte</span><span class="o">[]</span> <span class="nf">digits</span><span class="o">()</span> <span class="o">{</span>
    <span class="k">return</span> <span class="n">ByteBuffer</span><span class="o">.</span><span class="na">allocate</span><span class="o">(</span><span class="mi">4</span><span class="o">)</span>
      <span class="o">.</span><span class="na">putInt</span><span class="o">(</span><span class="k">this</span><span class="o">.</span><span class="na">kilos</span><span class="o">).</span><span class="na">array</span><span class="o">();</span>
  <span class="o">}</span>
<span class="o">}</span></code></pre></figure><p>Finally, this is how we compare them:</p><figure class="highlight"><pre><code class="language-java" data-lang="java"><span></span><span class="kt">int</span> <span class="n">v</span> <span class="o">=</span> <span class="k">new</span> <span class="n">Comparison</span><span class="o">&lt;</span><span class="n">Weight</span><span class="o">&gt;(</span>
  <span class="k">new</span> <span class="n">Weight</span><span class="o">(</span><span class="mi">400</span><span class="o">),</span> <span class="k">new</span> <span class="n">Weight</span><span class="o">(</span><span class="mi">500</span><span class="o">)</span>
<span class="o">).</span><span class="na">value</span><span class="o">();</span></code></pre></figure><p>This <code>v</code> will either be <code>-1</code>, <code>0</code>, or <code>1</code>. In this particular case it will be <code>-1</code>, because <code>400</code> is less than <code>500</code>.</p><p>No more violation of encapsulation, no more type casting, no more ugly code inside those <code>equals()</code> and <code>compareTo()</code> methods. The class <code>Comparison</code> will work with all possible types. All our objects need to do in order to become comparable is to implement <code>Digitizable</code> and &quot;provide&quot; their bytes for inspection/comparison.</p><p>This approach is actually very close to the <a href="/2016/04/05/printers-instead-of-getters.html">printers</a> I described earlier.</p></div></article></div><div class="wrapper"> <related-posts /></div><div class="disqus" role="complementary"><p class="disqus_hint"> Please, use <a href="https://help.disqus.com/commenting/what-html-tags-are-allowed-within-comments">syntax highlighting</a> in your comments, to make them more readable.</p><div id="disqus_thread" class="disqus-thread"> <a>&nbsp;</a></div><script> var disqus_config = function () { this.page.url = document.location.href.split('?')[0].split('#')[0].replace('https://', 'http://'); this.page.identifier = this.page.url; }; (function() { var d = document, s = d.createElement('script'); s.src = '//yegor256.disqus.com/embed.js'; s.setAttribute('data-timestamp', +new Date()); (d.head || d.body).appendChild(s); })(); </script> <noscript><div><p class="red"> JavaScript is disabled in your browser, that's why you can't see comments under this post.</p></div></noscript></div><div class="wrapper"> <footer class="footer"><p> &copy; <span itemscope="" itemprop="copyrightHolder" itemtype="http://schema.org/Person"> <span itemprop="name">Yegor Bugayenko</span> </span> 2014&ndash;<span itemprop="copyrightYear">2018</span></p></footer></div></section><div class="wrapper unprintable" style="text-align:center;margin-top:2em;"> <a href="http://www.sixnines.io/h/3ba1652f"> <img src="//www.sixnines.io/b/3ba1652f?style=flat" alt="sixnines availability badge"/> </a></div><script src="//code.jquery.com/jquery-1.9.0.min.js"></script> <script src="/js/all.js?4e047f6f42b"></script> <script>var disqus_shortname = 'yegor256';</script> <script id="dsq-count-scr" src="//yegor256.disqus.com/count.js" async="async"></script> <script> (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){ (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o), m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m) })(window,document,'script','//www.google-analytics.com/analytics.js','ga'); ga('create', 'UA-1963507-32', 'auto'); ga('send', 'pageview'); </script> <script> Cd=document;Cr="&"+Math.random();Cp="&s=1"; Cd.cookie="b=b";if(Cd.cookie)Cp+="&c=1"; Cp+="&t="+(new Date()).getTimezoneOffset(); if(self!=top)Cp+="&f=1"; </script> <script> if(navigator.javaEnabled())Cp+="&j=1"; </script> <script> if(typeof(screen)!='undefined')Cp+="&w="+screen.width+"&h="+ screen.height+"&d="+(screen.colorDepth?screen.colorDepth:screen.pixelDepth); </script> <script> Cd.write("<img src='//c.hit.ua/hit?i=95870&g=0&x=2"+Cp+Cr+ "&r="+escape(Cd.referrer)+"&u="+escape(window.location.href)+ "' border='0' wi"+"dth='1' he"+"ight='1'/>"); </script> <script type="application/ld+json"> { "@context": "http://schema.org", "@type": "Person", "name": "Yegor Bugayenko", "url": "http://www.yegor256.com", "sameAs": [ "https://www.facebook.com/yegor256", "https://instagram.com/yegor256", "https://www.linkedin.com/in/yegor256", "https://twitter.com/yegor256", "https://github.com/yegor256", "https://www.pinterest.com/yegor256/" ] } </script> </body> </html> <!DOCTYPE html> <html xmlns="http://www.w3.org/1999/xhtml" lang="en-US" xml:lang="en-US" itemscope="" itemtype="http://schema.org/WebSite"> <head> <meta charset="utf-8"/> <meta name="description" content="Instead of calling static procedures we may want to use objects, the way they are supposed to be used; that&apos;s why Cactoos. " /> <meta name="keywords" content="IO java, cactoos, input/output cactoos, object-oriented input/output, read/write java" /> <meta name="viewport" content="width=device-width,minimum-scale=1,initial-scale=1"/> <meta name="google-site-verification" content="JEj_gQr2CPe2QKGw8XdMz0R7VboQIUbX3FlM-lwTq-8" /> <meta name="author" content="Yegor Bugayenko"> <meta name="article:published_time" content="2017-06-22 00:00:00 +0000"> <meta name="og:site_name" content="Yegor Bugayenko"/> <meta name="og:type" content="article" /> <meta name="og:locale" content="en_US" /> <meta name="twitter:account_id" content="4503599630178231" /> <meta name="twitter:creator" content="@yegor256"/> <meta name="twitter:site" content="@yegor256"/> <meta name="twitter:title" property="og:title" content="Object-Oriented Declarative Input/Output in Cactoos"/> <meta name="twitter:description" property="og:description" content="Instead of calling static procedures we may want to use objects, the way they are supposed to be used; that&apos;s why Cactoos. "/> <meta name="twitter:url" property="og:url" content="https://www.yegor256.com/2017/06/22/object-oriented-input-output-in-cactoos.html"/> <meta name="telegram:channel" content="AAAAAEJFMRzsRTRxM3ec6A"/> <link rel="search" type="application/opensearchdescription+xml" href="/opensearch.xml" title="yegor256" /> <link rel="shortcut icon" href="/favicon.ico?4e047f6f42b"/> <link rel="apple-touch-icon" href="/favicon.ico?4e047f6f42b"/> <link rel="alternate" type="application/rss+xml" title="RSS for yegor256.com" href="https://www.yegor256.com/rss.xml"/> <link rel="stylesheet" href="/css/layout.css?4e047f6f42b"/> <link rel="stylesheet" href="/css/icons.css?4e047f6f42b"/> <link rel="canonical" href="https://www.yegor256.com/2017/06/22/object-oriented-input-output-in-cactoos.html" /> <link rel="amphtml" href="https://www.yegor256.com/2017/06/22/object-oriented-input-output-in-cactoos.amp.html" /> <title>Object-Oriented Declarative Input/Output in Cactoos </title> </head> <body><div class="wrapper"> <aside class="header-toggle unprintable" id="header-toggle" title="Show the menu" onclick="$('#header').show();$('#header-toggle').hide();">&#9776;</aside> <header class="header" id="header"><div class="face"> <a href="/about-me.html#form" class="sub" title="Click to subscribe to my monthly newsletter"><span>Subscribe</span></a> <a href="/about-me.html" style="position:relative;"> <img src="/images/face-256x256.jpg" class="photo" alt="Yegor Bugayenko"/> </a></div><nav><ul class="menu social notranslate"> <li><a href="https://twitter.com/intent/follow?screen_name=yegor256" rel="nofollow" title="Follow me on Twitter"><i class="icon icon-twitter notranslate" aria-hidden="true"></i></a></li> <li><a href="/rss.xml" rel="nofollow" title="Subscribe to my RSS feed"><i class="icon icon-rss notranslate" aria-hidden="true"></i></a></li> <li><a itemprop="sameAs" href="https://github.com/yegor256" rel="nofollow" title="My GitHub profile"><i class="icon icon-github notranslate" aria-hidden="true"></i></a></li> <li><a itemprop="sameAs" href="http://stackoverflow.com/users/187141/yegor256" rel="nofollow" title="My StackOverflow profile"><i class="icon icon-stackoverflow notranslate" aria-hidden="true"></i></a></li> <li><a itemprop="sameAs" href="https://www.facebook.com/yegor256" rel="nofollow" title="Follow me on Facebook"><i class="icon icon-facebook notranslate" aria-hidden="true"></i></a></li> <li><a itemprop="sameAs" href="https://instagram.com/yegor256" rel="nofollow" title="Follow me on Instagram"><i class="icon icon-instagram notranslate" aria-hidden="true"></i></a></li> <li><a itemprop="sameAs" href="https://www.linkedin.com/in/yegor256" rel="nofollow" title="My LinkedIn profile"><i class="icon icon-linkedin notranslate" aria-hidden="true"></i></a></li> <li><a itemprop="sameAs" href="https://www.youtube.com/c/yegor256?sub_confirmation=1" rel="nofollow" title="My Youtube video channel"><i class="icon icon-youtube notranslate" aria-hidden="true"></i></a></li> <li><a itemprop="sameAs" href="https://www.pinterest.com/yegor256/" rel="nofollow" title="My Pinterest boards"><i class="icon icon-pinterest notranslate" aria-hidden="true"></i></a></li> <li><a itemprop="sameAs" href="https://angel.co/yegor256" rel="nofollow" title="My AngelList profile"><i class="icon icon-angellist notranslate" aria-hidden="true"></i></a></li> <li><a href="https://soundcloud.com/yegor256" rel="nofollow" title="My podcast"><i class="icon icon-podcast notranslate" aria-hidden="true"></i></a></li> <li><a href="https://itunes.apple.com/us/podcast/yegor256-podcast/id1150826721" rel="nofollow" title="My iTunes podcast"><i class="icon icon-itunes notranslate" aria-hidden="true"></i></a></li> <li><a href="https://t.me/joinchat/AAAAAEJFMRzsRTRxM3ec6A" rel="nofollow" title="My Telegram public channel"><i class="icon icon-telegram notranslate" aria-hidden="true"></i></a></li> <li><a href="mailto:blog@yegor256.com" rel="nofollow" title="Email me any time"><i class="icon icon-mail notranslate" aria-hidden="true"></i></a></li></ul><ul class="menu"> <li><a href="/" title="Home page">Home</a></li> <li ><a href="/best.html" title="Best articles to read">12&#160;Best</a></li> <li ><a href="/contents.html" title="The contents of the entire blog">All&#160;288</a></li> <li ><a href="/webinars.html" title="My webinars">Webinars</a></li> <li ><a href="/talks.html" title="Future and past conference talks">Talks</a></li> <li ><a href="/books.html" title="The books I wrote">Books</a></li> <li ><a href="/papers.html" title="My academic papers and patents">Papers</a></li> <li ><a href="/pets.html" title="My loved pet projects">Pets</a></li> <li ><a href="/award.html" title="Software quality award">Award</a></li> <li ><a href="/testimonials.html" title="What some people say about me">Testimonials</a></li> <li ><a href="/shift-m.html" title="Audio podcast about project management">Shift-M</a></li> <li ><a href="/paintings.html" title="My paintings for sale">Paintings</a></li> <li><a href="http://ru.yegor256.com/" title="Немного на русском языке">По-русски</a></li></ul></nav><div class="search"> <form method="get" action="https://www.google.com/search" itemprop="potentialAction" itemscope="" itemtype="http://schema.org/SearchAction"> <meta itemprop="target" content="https://www.google.com/search?q={q}"/> <input name="sitesearch" value="yegor256.com" type="hidden"/> <input itemprop="query-input" type="text" id="search-query" class="field field-text" required="required" onfocus="$('.google').css('visibility', 'visible');" name="q" placeholder="Search..." autocomplete="off"/> <input type="image" src="/images/google-search-icon.svg" class="google" title="Search via Google" alt="Search via Google"/> </form></div><div class="hot"><ul> <li> <a href="/code-ahead.html">Code Ahead</a> was published on Amazon just a few days ago! It is my new book, a novel about programmers. It explains in details the majority of ideas that stand behind <a href="https://www.zerocracy.com">Zerocracy</a> and <a href="https://www.xdsd.org">XDSD</a>. </li> <li> At <a href="/webinars.html">Webinar #37</a> we will discuss naming problem in OOP, for objects, methods and attributes; join us on <b>September 12</b>, at 11am PST. </li></ul></div></header></div><section itemscope="" itemtype="http://schema.org/BlogPosting"><div class="wrapper"> <header><p class="printable"> <img src="https://api.qrserver.com/v1/create-qr-code/?data=https://www.yegor256.com/2017/06/22/object-oriented-input-output-in-cactoos.html&amp;format=svg" style="width:125px;height:125px;" alt="QR code"/></p><p class="printable"> <code itemprop="url">https://www.yegor256.com/2017/06/22/object-oriented-input-output-in-cactoos.html</code></p><h1 itemprop="name headline mainEntityOfPage">Object-Oriented Declarative Input/Output in Cactoos</h1><ul class="subline"> <li> <time itemprop="datePublished" datetime="2017-06-22T00:00:00+00:00"> 22 June 2017 </time> </li> <li class="desktop-only" itemprop="locationCreated">Dnipro, Ukraine</li> <li class="printable" itemscope="" itemprop="author" itemtype="http://schema.org/Person"> <span itemprop="name">Yegor Bugayenko</span> </li> <li class="unprintable"> <i class="icon icon-comments"></i> <a href="http://www.yegor256.com/2017/06/22/object-oriented-input-output-in-cactoos.html#disqus_thread" itemprop="discussionUrl">comments</a> </li></ul><p><strong>Disclaimer</strong>: The version I&#39;m using at the time of writing is <a href="https://github.com/yegor256/cactoos/releases/tag/0.9">0.9</a>. Later versions may have different names of classes and a totally different design.</p><p>Let&#39;s say you want to read a file. This is how you would do it with the static method <a href="https://docs.oracle.com/javase/7/docs/api/java/nio/file/Files.html#readAllBytes%28java.nio.file.Path%29"><code>readAllBytes()</code></a> from the <a href="/2014/05/05/oop-alternative-to-utility-classes.html">utility class</a> <a href="https://docs.oracle.com/javase/7/docs/api/java/nio/file/Files.html"><code>Files</code></a> in JDK7:</p><figure class="highlight"><pre><code class="language-java" data-lang="java"><span></span><span class="kt">byte</span><span class="o">[]</span> <span class="n">content</span> <span class="o">=</span> <span class="n">Files</span><span class="o">.</span><span class="na">readAllBytes</span><span class="o">(</span>
  <span class="k">new</span> <span class="n">File</span><span class="o">(</span><span class="s">&quot;/tmp/photo.jpg&quot;</span><span class="o">).</span><span class="na">toPath</span><span class="o">()</span>
<span class="o">);</span></code></pre></figure><p>This code is very imperative---it reads the file content right here and now, placing it into the array.</p><p>This is how you do it with <a href="https://github.com/yegor256/cactoos">Cactoos</a>:</p><figure class="highlight"><pre><code class="language-java" data-lang="java"><span></span><span class="n">Bytes</span> <span class="n">source</span> <span class="o">=</span> <span class="k">new</span> <span class="n">InputAsBytes</span><span class="o">(</span>
  <span class="k">new</span> <span class="n">FileAsInput</span><span class="o">(</span>
    <span class="k">new</span> <span class="n">File</span><span class="o">(</span><span class="s">&quot;/tmp/photo.jpg&quot;</span><span class="o">)</span>
  <span class="o">)</span>
<span class="o">);</span></code></pre></figure><p>Pay attention---there are no method calls yet. Just three constructors of three classes that compose a bigger object. The object <code>source</code> is of type <a href="http://static.javadoc.io/org.cactoos/cactoos/0.9/org/cactoos/Bytes.html"><code>Bytes</code></a> and represents the content of the file. To get that content out of it we call its method <code>asBytes()</code>:</p><figure class="highlight"><pre><code class="language-java" data-lang="java"><span></span><span class="n">bytes</span><span class="o">[]</span> <span class="n">content</span> <span class="o">=</span> <span class="n">source</span><span class="o">.</span><span class="na">asBytes</span><span class="o">();</span></code></pre></figure><p>This is the moment when the file system is touched. This approach, as you can see, is absolutely declarative and thanks to that possesses all the benefits of object orientation.</p><p>Here is another example. Say you want to write some text into a file. Here is how you do it in Cactoos. First you need the <a href="http://static.javadoc.io/org.cactoos/cactoos/0.9/org/cactoos/Input.html"><code>Input</code></a>:</p><figure class="highlight"><pre><code class="language-java" data-lang="java"><span></span><span class="n">Input</span> <span class="n">input</span> <span class="o">=</span> <span class="k">new</span> <span class="n">BytesAsInput</span><span class="o">(</span>
  <span class="k">new</span> <span class="n">TextAsBytes</span><span class="o">(</span>
    <span class="k">new</span> <span class="n">StringAsText</span><span class="o">(</span>
      <span class="s">&quot;Hello, world!&quot;</span>
    <span class="o">)</span>
  <span class="o">)</span>
<span class="o">);</span></code></pre></figure><p>Then you need the <a href="http://static.javadoc.io/org.cactoos/cactoos/0.9/org/cactoos/Output.html"><code>Output</code></a>:</p><figure class="highlight"><pre><code class="language-java" data-lang="java"><span></span><span class="n">Output</span> <span class="n">output</span> <span class="o">=</span> <span class="k">new</span> <span class="n">FileAsOutput</span><span class="o">(</span>
  <span class="k">new</span> <span class="n">File</span><span class="o">(</span><span class="s">&quot;/tmp/hello.txt&quot;</span><span class="o">)</span>
<span class="o">);</span></code></pre></figure><p>Now, we want to copy the input to the output. There is no &quot;copy&quot; operation in <em>pure</em> OOP. Moreover, there must be no operations at all. Just objects. We have a class named <a href="http://static.javadoc.io/org.cactoos/cactoos/0.9/org/cactoos/io/TeeInput.html"><code>TeeInput</code></a>, which is an <code>Input</code> that copies everything you read from it to the <a href="http://static.javadoc.io/org.cactoos/cactoos/0.9/org/cactoos/Output.html"><code>Output</code></a>, similar to what <a href="https://commons.apache.org/proper/commons-io/javadocs/api-1.4/org/apache/commons/io/input/TeeInputStream.html"><code>TeeInputStream</code></a> from <a href="https://commons.apache.org/">Apache Commons</a> does, but encapsulated. So we don&#39;t copy, we create an <a href="http://static.javadoc.io/org.cactoos/cactoos/0.9/org/cactoos/Input.html"><code>Input</code></a> that will copy if you <em>touch</em> it:</p><figure class="highlight"><pre><code class="language-java" data-lang="java"><span></span><span class="n">Input</span> <span class="n">tee</span> <span class="o">=</span> <span class="k">new</span> <span class="n">TeeInput</span><span class="o">(</span><span class="n">input</span><span class="o">,</span> <span class="n">output</span><span class="o">);</span></code></pre></figure><p>Now, we have to &quot;touch&quot; it. And we have to touch every single byte of it, in order to make sure they all are copied. If we just <code>read()</code> the first byte, only one byte will be copied to the file. The best way to touch them all is to calculate the size of the <code>tee</code> object, going byte by byte. We have an object for it, called <a href="http://static.javadoc.io/org.cactoos/cactoos/0.9/org/cactoos/io/LengthOfInput.html"><code>LengthOfInput</code></a>. It encapsulates an <a href="http://static.javadoc.io/org.cactoos/cactoos/0.9/org/cactoos/Input.html"><code>Input</code></a> and behaves like its length in bytes:</p><figure class="highlight"><pre><code class="language-java" data-lang="java"><span></span><span class="n">Scalar</span><span class="o">&lt;</span><span class="n">Long</span><span class="o">&gt;</span> <span class="n">length</span> <span class="o">=</span> <span class="k">new</span> <span class="n">LengthOfInput</span><span class="o">(</span><span class="n">tee</span><span class="o">);</span></code></pre></figure><p>Then we take the value out of it and the file writing operation takes place:</p><figure class="highlight"><pre><code class="language-java" data-lang="java"><span></span><span class="kt">long</span> <span class="n">len</span> <span class="o">=</span> <span class="n">length</span><span class="o">.</span><span class="na">value</span><span class="o">();</span></code></pre></figure><p>Thus, the entire operation of writing the string to the file will look like this:</p><figure class="highlight"><pre><code class="language-java" data-lang="java"><span></span><span class="k">new</span> <span class="n">LengthOfInput</span><span class="o">(</span>
  <span class="k">new</span> <span class="n">TeeInput</span><span class="o">(</span>
    <span class="k">new</span> <span class="n">BytesAsInput</span><span class="o">(</span>
      <span class="k">new</span> <span class="n">TextAsBytes</span><span class="o">(</span>
        <span class="k">new</span> <span class="n">StringAsText</span><span class="o">(</span>
          <span class="s">&quot;Hello, world!&quot;</span>
        <span class="o">)</span>
      <span class="o">)</span>
    <span class="o">),</span>
    <span class="k">new</span> <span class="n">FileAsOutput</span><span class="o">(</span>
      <span class="k">new</span> <span class="n">File</span><span class="o">(</span><span class="s">&quot;/tmp/hello.txt&quot;</span><span class="o">)</span>
    <span class="o">)</span>
  <span class="o">)</span>
<span class="o">).</span><span class="na">value</span><span class="o">();</span> <span class="c1">// happens here</span></code></pre></figure><p>This is its procedural alternative from <a href="https://docs.oracle.com/javase/7/docs/api/java/nio/file/Files.html#write%28java.nio.file.Path,%20byte%5B%5D,%20java.nio.file.OpenOption...%29">JDK7</a>:</p><figure class="highlight"><pre><code class="language-java" data-lang="java"><span></span><span class="n">Files</span><span class="o">.</span><span class="na">write</span><span class="o">(</span>
  <span class="k">new</span> <span class="n">File</span><span class="o">(</span><span class="s">&quot;/tmp/hello.txt&quot;</span><span class="o">).</span><span class="na">toPath</span><span class="o">(),</span>
  <span class="s">&quot;Hello, world!&quot;</span><span class="o">.</span><span class="na">getBytes</span><span class="o">()</span>
<span class="o">);</span></code></pre></figure><p>&quot;Why is object-oriented better, even though it&#39;s longer?&quot; I hear you ask. Because it perfectly <strong>decouples</strong> concepts, while the procedural one keeps them together.</p><p>Let&#39;s say, you are designing a class that is supposed to encrypt some text and save it to a file. Here is how you would design it the procedural way (not a real encryption, of course):</p><figure class="highlight"><pre><code class="language-java" data-lang="java"><span></span><span class="kd">class</span> <span class="nc">Encoder</span> <span class="o">{</span>
  <span class="kd">private</span> <span class="kd">final</span> <span class="n">File</span> <span class="n">target</span><span class="o">;</span>
  <span class="n">Encoder</span><span class="o">(</span><span class="kd">final</span> <span class="n">File</span> <span class="n">file</span><span class="o">)</span> <span class="o">{</span>
    <span class="k">this</span><span class="o">.</span><span class="na">target</span> <span class="o">=</span> <span class="n">file</span><span class="o">;</span>
  <span class="o">}</span>
  <span class="kt">void</span> <span class="nf">encode</span><span class="o">(</span><span class="n">String</span> <span class="n">text</span><span class="o">)</span> <span class="o">{</span>
    <span class="n">Files</span><span class="o">.</span><span class="na">write</span><span class="o">(</span>
      <span class="k">this</span><span class="o">.</span><span class="na">target</span><span class="o">,</span>
      <span class="n">text</span><span class="o">.</span><span class="na">replaceAll</span><span class="o">(</span><span class="s">&quot;[a-z]&quot;</span><span class="o">,</span> <span class="s">&quot;*&quot;</span><span class="o">)</span>
    <span class="o">);</span>
  <span class="o">}</span>
<span class="o">}</span></code></pre></figure><p>Works fine, but what will happen when you decide to extend it to also write to an <a href="https://docs.oracle.com/javase/7/docs/api/java/io/OutputStream.html"><code>OutputStream</code></a>? How will you modify this class? How ugly will it look after that? That&#39;s because the design is not object-oriented.</p><p>This is how you would do the same design, in an object-oriented way, with <a href="http://www.cactoos.org">Cactoos</a>:</p><figure class="highlight"><pre><code class="language-java" data-lang="java"><span></span><span class="kd">class</span> <span class="nc">Encoder</span> <span class="o">{</span>
  <span class="kd">private</span> <span class="kd">final</span> <span class="n">Output</span> <span class="n">target</span><span class="o">;</span>
  <span class="n">Encoder</span><span class="o">(</span><span class="kd">final</span> <span class="n">File</span> <span class="n">file</span><span class="o">)</span> <span class="o">{</span>
    <span class="k">this</span><span class="o">(</span><span class="k">new</span> <span class="n">FileAsOutput</span><span class="o">(</span><span class="n">file</span><span class="o">));</span>
  <span class="o">}</span>
  <span class="n">Encoder</span><span class="o">(</span><span class="kd">final</span> <span class="n">Output</span> <span class="n">output</span><span class="o">)</span> <span class="o">{</span>
    <span class="k">this</span><span class="o">.</span><span class="na">target</span> <span class="o">=</span> <span class="n">output</span><span class="o">;</span>
  <span class="o">}</span>
  <span class="kt">void</span> <span class="nf">encode</span><span class="o">(</span><span class="n">String</span> <span class="n">text</span><span class="o">)</span> <span class="o">{</span>
    <span class="k">new</span> <span class="n">LengthOfInput</span><span class="o">(</span>
      <span class="k">new</span> <span class="n">TeeInput</span><span class="o">(</span>
        <span class="k">new</span> <span class="n">BytesAsInput</span><span class="o">(</span>
          <span class="k">new</span> <span class="n">TextAsBytes</span><span class="o">(</span>
            <span class="k">new</span> <span class="n">StringAsText</span><span class="o">(</span>
              <span class="n">text</span><span class="o">.</span><span class="na">replaceAll</span><span class="o">(</span><span class="s">&quot;[a-z]&quot;</span><span class="o">,</span> <span class="s">&quot;*&quot;</span><span class="o">)</span>
            <span class="o">)</span>
          <span class="o">)</span>
        <span class="o">),</span>
        <span class="k">this</span><span class="o">.</span><span class="na">target</span>
      <span class="o">)</span>
    <span class="o">).</span><span class="na">value</span><span class="o">();</span>
  <span class="o">}</span>
<span class="o">}</span></code></pre></figure><p>What do we do with this design if we want <a href="https://docs.oracle.com/javase/7/docs/api/java/io/OutputStream.html"><code>OutputStream</code></a> to be accepted? We just add one <a href="/2015/05/28/one-primary-constructor.html">secondary</a> constructor:</p><figure class="highlight"><pre><code class="language-java" data-lang="java"><span></span><span class="kd">class</span> <span class="nc">Encoder</span> <span class="o">{</span>
  <span class="n">Encoder</span><span class="o">(</span><span class="kd">final</span> <span class="n">OutputStream</span> <span class="n">stream</span><span class="o">)</span> <span class="o">{</span>
    <span class="k">this</span><span class="o">(</span><span class="k">new</span> <span class="n">OutputStreamAsOutput</span><span class="o">(</span><span class="n">stream</span><span class="o">));</span>
  <span class="o">}</span>
<span class="o">}</span></code></pre></figure><p>Done. That&#39;s how easy and elegant it is.</p><p>That&#39;s because concepts are perfectly separated and functionality is encapsulated. In the procedural example the behavior of the object is located outside of it, in the method <code>encode()</code>. The file itself doesn&#39;t know how to write, some outside procedure <a href="https://docs.oracle.com/javase/7/docs/api/java/nio/file/Files.html#write%28java.nio.file.Path,%20byte%5B%5D,%20java.nio.file.OpenOption...%29"><code>Files.write()</code></a> knows that instead.</p><p>To the contrary, in the object-oriented design the <a href="http://static.javadoc.io/org.cactoos/cactoos/0.9/org/cactoos/io/FileAsOutput.html"><code>FileAsOutput</code></a> knows how to write, and nobody else does. The file writing functionality is encapsulated and this makes it possible to decorate the objects in any possible way, creating reusable and replaceable composite objects.</p><p>Do you see the beauty of OOP now?</p></p>--> <nav class="buttons notranslate desktop-only"> <a href="http://www.facebook.com/sharer/sharer.php?u=https://www.yegor256.com/2017/06/22/object-oriented-input-output-in-cactoos.html" title="Share on Facebook" class="button" rel="nofollow"> <span class="count count-facebook">0</span> <i class="icon icon-facebook notranslate" aria-hidden="true"></i> </a> <a href="https://twitter.com/share?url=https://www.yegor256.com/2017/06/22/object-oriented-input-output-in-cactoos.html&amp;text=Object-Oriented+Declarative+Input%2FOutput+in+Cactoos" title="Share on Twitter" class="button" rel="nofollow"> <span class="count count-twitter">0</span> <i class="icon icon-twitter notranslate" aria-hidden="true"></i> </a> <a href="https://plus.google.com/share?url=https://www.yegor256.com/2017/06/22/object-oriented-input-output-in-cactoos.html" title="Share on Google+" class="button" rel="nofollow"> <span class="count count-googleplus">0</span> <i class="icon icon-googleplus notranslate" aria-hidden="true"></i> </a> <a href="https://www.linkedin.com/cws/share?url=https://www.yegor256.com/2017/06/22/object-oriented-input-output-in-cactoos.html" title="Share on LinkedIn" class="button" rel="nofollow"> <span class="count count-linkedin">0</span> <i class="icon icon-linkedin notranslate" aria-hidden="true"></i> </a> <a href="http://reddit.com/submit?url=https://www.yegor256.com/2017/06/22/object-oriented-input-output-in-cactoos.html%3F2017-25&amp;title=Object-Oriented+Declarative+Input%2FOutput+in+Cactoos" title="Share on Reddit" class="button" rel="nofollow"> <span class="count count-reddit">0</span> <i class="icon icon-reddit notranslate" aria-hidden="true"></i> </a> <a href="http://news.ycombinator.com/submitlink?u=https://www.yegor256.com/2017/06/22/object-oriented-input-output-in-cactoos.html%3F2017-25&amp;t=Object-Oriented+Declarative+Input%2FOutput+in+Cactoos" title="Share on Hacker News" class="button" rel="nofollow"> <span class="count count-hackernews">0</span> <i class="icon icon-hackernews notranslate" aria-hidden="true"></i> </a> </nav> </header> <article class="main" itemprop="articleBody"><div > <figure class='badge'><a href='http://www.cactoos.org'><img src='https://www.yegor256.com/images/books/elegant-objects/cactus.svg' style='width:92px;max-width:100%;' alt='badge'/></a></figure><p><a href="http://www.cactoos.org">Cactoos</a> is a library of object-oriented Java primitives <a href="https://github.com/yegor256/cactoos#contributors">we</a> started to work on just a few weeks ago. The intent was to propose a clean and more declarative alternative to <a href="https://en.wikipedia.org/wiki/Java_Development_Kit">JDK</a>, <a href="https://github.com/google/guava">Guava</a>, <a href="https://commons.apache.org/">Apache Commons</a>, and others. Instead of calling static <a href="/2014/05/05/oop-alternative-to-utility-classes.html">procedures</a> we want to use <a href="/2016/07/14/who-is-object.html">objects</a>, the way they are supposed to be used. Let&#39;s see how input/output works in a <em>pure</em> <a href="/2016/08/15/what-is-wrong-object-oriented-programming.html">object-oriented</a> fashion.</p><p><strong>Disclaimer</strong>: The version I&#39;m using at the time of writing is <a href="https://github.com/yegor256/cactoos/releases/tag/0.9">0.9</a>. Later versions may have different names of classes and a totally different design.</p><p>Let&#39;s say you want to read a file. This is how you would do it with the static method <a href="https://docs.oracle.com/javase/7/docs/api/java/nio/file/Files.html#readAllBytes%28java.nio.file.Path%29"><code>readAllBytes()</code></a> from the <a href="/2014/05/05/oop-alternative-to-utility-classes.html">utility class</a> <a href="https://docs.oracle.com/javase/7/docs/api/java/nio/file/Files.html"><code>Files</code></a> in JDK7:</p><figure class="highlight"><pre><code class="language-java" data-lang="java"><span></span><span class="kt">byte</span><span class="o">[]</span> <span class="n">content</span> <span class="o">=</span> <span class="n">Files</span><span class="o">.</span><span class="na">readAllBytes</span><span class="o">(</span>
  <span class="k">new</span> <span class="n">File</span><span class="o">(</span><span class="s">&quot;/tmp/photo.jpg&quot;</span><span class="o">).</span><span class="na">toPath</span><span class="o">()</span>
<span class="o">);</span></code></pre></figure><p>This code is very imperative---it reads the file content right here and now, placing it into the array.</p><p>This is how you do it with <a href="https://github.com/yegor256/cactoos">Cactoos</a>:</p><figure class="highlight"><pre><code class="language-java" data-lang="java"><span></span><span class="n">Bytes</span> <span class="n">source</span> <span class="o">=</span> <span class="k">new</span> <span class="n">InputAsBytes</span><span class="o">(</span>
  <span class="k">new</span> <span class="n">FileAsInput</span><span class="o">(</span>
    <span class="k">new</span> <span class="n">File</span><span class="o">(</span><span class="s">&quot;/tmp/photo.jpg&quot;</span><span class="o">)</span>
  <span class="o">)</span>
<span class="o">);</span></code></pre></figure><p>Pay attention---there are no method calls yet. Just three constructors of three classes that compose a bigger object. The object <code>source</code> is of type <a href="http://static.javadoc.io/org.cactoos/cactoos/0.9/org/cactoos/Bytes.html"><code>Bytes</code></a> and represents the content of the file. To get that content out of it we call its method <code>asBytes()</code>:</p><figure class="highlight"><pre><code class="language-java" data-lang="java"><span></span><span class="n">bytes</span><span class="o">[]</span> <span class="n">content</span> <span class="o">=</span> <span class="n">source</span><span class="o">.</span><span class="na">asBytes</span><span class="o">();</span></code></pre></figure><p>This is the moment when the file system is touched. This approach, as you can see, is absolutely declarative and thanks to that possesses all the benefits of object orientation.</p><p>Here is another example. Say you want to write some text into a file. Here is how you do it in Cactoos. First you need the <a href="http://static.javadoc.io/org.cactoos/cactoos/0.9/org/cactoos/Input.html"><code>Input</code></a>:</p><figure class="highlight"><pre><code class="language-java" data-lang="java"><span></span><span class="n">Input</span> <span class="n">input</span> <span class="o">=</span> <span class="k">new</span> <span class="n">BytesAsInput</span><span class="o">(</span>
  <span class="k">new</span> <span class="n">TextAsBytes</span><span class="o">(</span>
    <span class="k">new</span> <span class="n">StringAsText</span><span class="o">(</span>
      <span class="s">&quot;Hello, world!&quot;</span>
    <span class="o">)</span>
  <span class="o">)</span>
<span class="o">);</span></code></pre></figure><p>Then you need the <a href="http://static.javadoc.io/org.cactoos/cactoos/0.9/org/cactoos/Output.html"><code>Output</code></a>:</p><figure class="highlight"><pre><code class="language-java" data-lang="java"><span></span><span class="n">Output</span> <span class="n">output</span> <span class="o">=</span> <span class="k">new</span> <span class="n">FileAsOutput</span><span class="o">(</span>
  <span class="k">new</span> <span class="n">File</span><span class="o">(</span><span class="s">&quot;/tmp/hello.txt&quot;</span><span class="o">)</span>
<span class="o">);</span></code></pre></figure><p>Now, we want to copy the input to the output. There is no &quot;copy&quot; operation in <em>pure</em> OOP. Moreover, there must be no operations at all. Just objects. We have a class named <a href="http://static.javadoc.io/org.cactoos/cactoos/0.9/org/cactoos/io/TeeInput.html"><code>TeeInput</code></a>, which is an <code>Input</code> that copies everything you read from it to the <a href="http://static.javadoc.io/org.cactoos/cactoos/0.9/org/cactoos/Output.html"><code>Output</code></a>, similar to what <a href="https://commons.apache.org/proper/commons-io/javadocs/api-1.4/org/apache/commons/io/input/TeeInputStream.html"><code>TeeInputStream</code></a> from <a href="https://commons.apache.org/">Apache Commons</a> does, but encapsulated. So we don&#39;t copy, we create an <a href="http://static.javadoc.io/org.cactoos/cactoos/0.9/org/cactoos/Input.html"><code>Input</code></a> that will copy if you <em>touch</em> it:</p><figure class="highlight"><pre><code class="language-java" data-lang="java"><span></span><span class="n">Input</span> <span class="n">tee</span> <span class="o">=</span> <span class="k">new</span> <span class="n">TeeInput</span><span class="o">(</span><span class="n">input</span><span class="o">,</span> <span class="n">output</span><span class="o">);</span></code></pre></figure><p>Now, we have to &quot;touch&quot; it. And we have to touch every single byte of it, in order to make sure they all are copied. If we just <code>read()</code> the first byte, only one byte will be copied to the file. The best way to touch them all is to calculate the size of the <code>tee</code> object, going byte by byte. We have an object for it, called <a href="http://static.javadoc.io/org.cactoos/cactoos/0.9/org/cactoos/io/LengthOfInput.html"><code>LengthOfInput</code></a>. It encapsulates an <a href="http://static.javadoc.io/org.cactoos/cactoos/0.9/org/cactoos/Input.html"><code>Input</code></a> and behaves like its length in bytes:</p><figure class="highlight"><pre><code class="language-java" data-lang="java"><span></span><span class="n">Scalar</span><span class="o">&lt;</span><span class="n">Long</span><span class="o">&gt;</span> <span class="n">length</span> <span class="o">=</span> <span class="k">new</span> <span class="n">LengthOfInput</span><span class="o">(</span><span class="n">tee</span><span class="o">);</span></code></pre></figure><p>Then we take the value out of it and the file writing operation takes place:</p><figure class="highlight"><pre><code class="language-java" data-lang="java"><span></span><span class="kt">long</span> <span class="n">len</span> <span class="o">=</span> <span class="n">length</span><span class="o">.</span><span class="na">value</span><span class="o">();</span></code></pre></figure><p>Thus, the entire operation of writing the string to the file will look like this:</p><figure class="highlight"><pre><code class="language-java" data-lang="java"><span></span><span class="k">new</span> <span class="n">LengthOfInput</span><span class="o">(</span>
  <span class="k">new</span> <span class="n">TeeInput</span><span class="o">(</span>
    <span class="k">new</span> <span class="n">BytesAsInput</span><span class="o">(</span>
      <span class="k">new</span> <span class="n">TextAsBytes</span><span class="o">(</span>
        <span class="k">new</span> <span class="n">StringAsText</span><span class="o">(</span>
          <span class="s">&quot;Hello, world!&quot;</span>
        <span class="o">)</span>
      <span class="o">)</span>
    <span class="o">),</span>
    <span class="k">new</span> <span class="n">FileAsOutput</span><span class="o">(</span>
      <span class="k">new</span> <span class="n">File</span><span class="o">(</span><span class="s">&quot;/tmp/hello.txt&quot;</span><span class="o">)</span>
    <span class="o">)</span>
  <span class="o">)</span>
<span class="o">).</span><span class="na">value</span><span class="o">();</span> <span class="c1">// happens here</span></code></pre></figure><p>This is its procedural alternative from <a href="https://docs.oracle.com/javase/7/docs/api/java/nio/file/Files.html#write%28java.nio.file.Path,%20byte%5B%5D,%20java.nio.file.OpenOption...%29">JDK7</a>:</p><figure class="highlight"><pre><code class="language-java" data-lang="java"><span></span><span class="n">Files</span><span class="o">.</span><span class="na">write</span><span class="o">(</span>
  <span class="k">new</span> <span class="n">File</span><span class="o">(</span><span class="s">&quot;/tmp/hello.txt&quot;</span><span class="o">).</span><span class="na">toPath</span><span class="o">(),</span>
  <span class="s">&quot;Hello, world!&quot;</span><span class="o">.</span><span class="na">getBytes</span><span class="o">()</span>
<span class="o">);</span></code></pre></figure><p>&quot;Why is object-oriented better, even though it&#39;s longer?&quot; I hear you ask. Because it perfectly <strong>decouples</strong> concepts, while the procedural one keeps them together.</p><p>Let&#39;s say, you are designing a class that is supposed to encrypt some text and save it to a file. Here is how you would design it the procedural way (not a real encryption, of course):</p><figure class="highlight"><pre><code class="language-java" data-lang="java"><span></span><span class="kd">class</span> <span class="nc">Encoder</span> <span class="o">{</span>
  <span class="kd">private</span> <span class="kd">final</span> <span class="n">File</span> <span class="n">target</span><span class="o">;</span>
  <span class="n">Encoder</span><span class="o">(</span><span class="kd">final</span> <span class="n">File</span> <span class="n">file</span><span class="o">)</span> <span class="o">{</span>
    <span class="k">this</span><span class="o">.</span><span class="na">target</span> <span class="o">=</span> <span class="n">file</span><span class="o">;</span>
  <span class="o">}</span>
  <span class="kt">void</span> <span class="nf">encode</span><span class="o">(</span><span class="n">String</span> <span class="n">text</span><span class="o">)</span> <span class="o">{</span>
    <span class="n">Files</span><span class="o">.</span><span class="na">write</span><span class="o">(</span>
      <span class="k">this</span><span class="o">.</span><span class="na">target</span><span class="o">,</span>
      <span class="n">text</span><span class="o">.</span><span class="na">replaceAll</span><span class="o">(</span><span class="s">&quot;[a-z]&quot;</span><span class="o">,</span> <span class="s">&quot;*&quot;</span><span class="o">)</span>
    <span class="o">);</span>
  <span class="o">}</span>
<span class="o">}</span></code></pre></figure><p>Works fine, but what will happen when you decide to extend it to also write to an <a href="https://docs.oracle.com/javase/7/docs/api/java/io/OutputStream.html"><code>OutputStream</code></a>? How will you modify this class? How ugly will it look after that? That&#39;s because the design is not object-oriented.</p><p>This is how you would do the same design, in an object-oriented way, with <a href="http://www.cactoos.org">Cactoos</a>:</p><figure class="highlight"><pre><code class="language-java" data-lang="java"><span></span><span class="kd">class</span> <span class="nc">Encoder</span> <span class="o">{</span>
  <span class="kd">private</span> <span class="kd">final</span> <span class="n">Output</span> <span class="n">target</span><span class="o">;</span>
  <span class="n">Encoder</span><span class="o">(</span><span class="kd">final</span> <span class="n">File</span> <span class="n">file</span><span class="o">)</span> <span class="o">{</span>
    <span class="k">this</span><span class="o">(</span><span class="k">new</span> <span class="n">FileAsOutput</span><span class="o">(</span><span class="n">file</span><span class="o">));</span>
  <span class="o">}</span>
  <span class="n">Encoder</span><span class="o">(</span><span class="kd">final</span> <span class="n">Output</span> <span class="n">output</span><span class="o">)</span> <span class="o">{</span>
    <span class="k">this</span><span class="o">.</span><span class="na">target</span> <span class="o">=</span> <span class="n">output</span><span class="o">;</span>
  <span class="o">}</span>
  <span class="kt">void</span> <span class="nf">encode</span><span class="o">(</span><span class="n">String</span> <span class="n">text</span><span class="o">)</span> <span class="o">{</span>
    <span class="k">new</span> <span class="n">LengthOfInput</span><span class="o">(</span>
      <span class="k">new</span> <span class="n">TeeInput</span><span class="o">(</span>
        <span class="k">new</span> <span class="n">BytesAsInput</span><span class="o">(</span>
          <span class="k">new</span> <span class="n">TextAsBytes</span><span class="o">(</span>
            <span class="k">new</span> <span class="n">StringAsText</span><span class="o">(</span>
              <span class="n">text</span><span class="o">.</span><span class="na">replaceAll</span><span class="o">(</span><span class="s">&quot;[a-z]&quot;</span><span class="o">,</span> <span class="s">&quot;*&quot;</span><span class="o">)</span>
            <span class="o">)</span>
          <span class="o">)</span>
        <span class="o">),</span>
        <span class="k">this</span><span class="o">.</span><span class="na">target</span>
      <span class="o">)</span>
    <span class="o">).</span><span class="na">value</span><span class="o">();</span>
  <span class="o">}</span>
<span class="o">}</span></code></pre></figure><p>What do we do with this design if we want <a href="https://docs.oracle.com/javase/7/docs/api/java/io/OutputStream.html"><code>OutputStream</code></a> to be accepted? We just add one <a href="/2015/05/28/one-primary-constructor.html">secondary</a> constructor:</p><figure class="highlight"><pre><code class="language-java" data-lang="java"><span></span><span class="kd">class</span> <span class="nc">Encoder</span> <span class="o">{</span>
  <span class="n">Encoder</span><span class="o">(</span><span class="kd">final</span> <span class="n">OutputStream</span> <span class="n">stream</span><span class="o">)</span> <span class="o">{</span>
    <span class="k">this</span><span class="o">(</span><span class="k">new</span> <span class="n">OutputStreamAsOutput</span><span class="o">(</span><span class="n">stream</span><span class="o">));</span>
  <span class="o">}</span>
<span class="o">}</span></code></pre></figure><p>Done. That&#39;s how easy and elegant it is.</p><p>That&#39;s because concepts are perfectly separated and functionality is encapsulated. In the procedural example the behavior of the object is located outside of it, in the method <code>encode()</code>. The file itself doesn&#39;t know how to write, some outside procedure <a href="https://docs.oracle.com/javase/7/docs/api/java/nio/file/Files.html#write%28java.nio.file.Path,%20byte%5B%5D,%20java.nio.file.OpenOption...%29"><code>Files.write()</code></a> knows that instead.</p><p>To the contrary, in the object-oriented design the <a href="http://static.javadoc.io/org.cactoos/cactoos/0.9/org/cactoos/io/FileAsOutput.html"><code>FileAsOutput</code></a> knows how to write, and nobody else does. The file writing functionality is encapsulated and this makes it possible to decorate the objects in any possible way, creating reusable and replaceable composite objects.</p><p>Do you see the beauty of OOP now?</p></div></article></div><div class="wrapper"> <related-posts /></div><div class="disqus" role="complementary"><p class="disqus_hint"> Please, use <a href="https://help.disqus.com/commenting/what-html-tags-are-allowed-within-comments">syntax highlighting</a> in your comments, to make them more readable.</p><div id="disqus_thread" class="disqus-thread"> <a>&nbsp;</a></div><script> var disqus_config = function () { this.page.url = document.location.href.split('?')[0].split('#')[0].replace('https://', 'http://'); this.page.identifier = this.page.url; }; (function() { var d = document, s = d.createElement('script'); s.src = '//yegor256.disqus.com/embed.js'; s.setAttribute('data-timestamp', +new Date()); (d.head || d.body).appendChild(s); })(); </script> <noscript><div><p class="red"> JavaScript is disabled in your browser, that's why you can't see comments under this post.</p></div></noscript></div><div class="wrapper"> <footer class="footer"><p> &copy; <span itemscope="" itemprop="copyrightHolder" itemtype="http://schema.org/Person"> <span itemprop="name">Yegor Bugayenko</span> </span> 2014&ndash;<span itemprop="copyrightYear">2018</span></p></footer></div></section><div class="wrapper unprintable" style="text-align:center;margin-top:2em;"> <a href="http://www.sixnines.io/h/3ba1652f"> <img src="//www.sixnines.io/b/3ba1652f?style=flat" alt="sixnines availability badge"/> </a></div><script src="//code.jquery.com/jquery-1.9.0.min.js"></script> <script src="/js/all.js?4e047f6f42b"></script> <script>var disqus_shortname = 'yegor256';</script> <script id="dsq-count-scr" src="//yegor256.disqus.com/count.js" async="async"></script> <script> (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){ (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o), m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m) })(window,document,'script','//www.google-analytics.com/analytics.js','ga'); ga('create', 'UA-1963507-32', 'auto'); ga('send', 'pageview'); </script> <script> Cd=document;Cr="&"+Math.random();Cp="&s=1"; Cd.cookie="b=b";if(Cd.cookie)Cp+="&c=1"; Cp+="&t="+(new Date()).getTimezoneOffset(); if(self!=top)Cp+="&f=1"; </script> <script> if(navigator.javaEnabled())Cp+="&j=1"; </script> <script> if(typeof(screen)!='undefined')Cp+="&w="+screen.width+"&h="+ screen.height+"&d="+(screen.colorDepth?screen.colorDepth:screen.pixelDepth); </script> <script> Cd.write("<img src='//c.hit.ua/hit?i=95870&g=0&x=2"+Cp+Cr+ "&r="+escape(Cd.referrer)+"&u="+escape(window.location.href)+ "' border='0' wi"+"dth='1' he"+"ight='1'/>"); </script> <script type="application/ld+json"> { "@context": "http://schema.org", "@type": "Person", "name": "Yegor Bugayenko", "url": "http://www.yegor256.com", "sameAs": [ "https://www.facebook.com/yegor256", "https://instagram.com/yegor256", "https://www.linkedin.com/in/yegor256", "https://twitter.com/yegor256", "https://github.com/yegor256", "https://www.pinterest.com/yegor256/" ] } </script> </body> </html> <!DOCTYPE html> <html xmlns="http://www.w3.org/1999/xhtml" lang="en-US" xml:lang="en-US" itemscope="" itemtype="http://schema.org/WebSite"> <head> <meta charset="utf-8"/> <meta name="description" content="Test methods are traditionally very procedural and algorithmic, which makes them difficult to read and maintain; this principle may improve them. " /> <meta name="keywords" content="hamcrest, junit, junit design, testing, testing design patterns" /> <meta name="viewport" content="width=device-width,minimum-scale=1,initial-scale=1"/> <meta name="google-site-verification" content="JEj_gQr2CPe2QKGw8XdMz0R7VboQIUbX3FlM-lwTq-8" /> <meta name="author" content="Yegor Bugayenko"> <meta name="article:published_time" content="2017-05-17 00:00:00 +0000"> <meta name="og:site_name" content="Yegor Bugayenko"/> <meta name="og:type" content="article" /> <meta name="og:locale" content="en_US" /> <meta name="twitter:account_id" content="4503599630178231" /> <meta name="twitter:creator" content="@yegor256"/> <meta name="twitter:site" content="@yegor256"/> <meta name="twitter:title" property="og:title" content="Single Statement Unit Tests"/> <meta name="twitter:description" property="og:description" content="Test methods are traditionally very procedural and algorithmic, which makes them difficult to read and maintain; this principle may improve them. "/> <meta name="twitter:url" property="og:url" content="https://www.yegor256.com/2017/05/17/single-statement-unit-tests.html"/> <meta name="telegram:channel" content="AAAAAEJFMRzsRTRxM3ec6A"/> <link rel="search" type="application/opensearchdescription+xml" href="/opensearch.xml" title="yegor256" /> <link rel="shortcut icon" href="/favicon.ico?4e047f6f42b"/> <link rel="apple-touch-icon" href="/favicon.ico?4e047f6f42b"/> <link rel="alternate" type="application/rss+xml" title="RSS for yegor256.com" href="https://www.yegor256.com/rss.xml"/> <link rel="stylesheet" href="/css/layout.css?4e047f6f42b"/> <link rel="stylesheet" href="/css/icons.css?4e047f6f42b"/> <link rel="canonical" href="https://www.yegor256.com/2017/05/17/single-statement-unit-tests.html" /> <link rel="amphtml" href="https://www.yegor256.com/2017/05/17/single-statement-unit-tests.amp.html" /> <title>Single Statement Unit Tests </title> <meta name='og:image' content='https://www.yegor256.com/images/2017/05/bullet.jpg'/><meta name='twitter:image' content='https://www.yegor256.com/images/2017/05/bullet.jpg'/><meta name='og:image:width' content='1670'/> <meta name='twitter:image:width' content='1670'/><meta name='og:image:height' content='924'/> <meta name='twitter:image:height' content='924'/><meta name='twitter:card' content='summary_large_image'/><meta name='twitter:image:alt' content='Bullet (1996) by Julien Temple'/> </head> <body><div class="wrapper"> <aside class="header-toggle unprintable" id="header-toggle" title="Show the menu" onclick="$('#header').show();$('#header-toggle').hide();">&#9776;</aside> <header class="header" id="header"><div class="face"> <a href="/about-me.html#form" class="sub" title="Click to subscribe to my monthly newsletter"><span>Subscribe</span></a> <a href="/about-me.html" style="position:relative;"> <img src="/images/face-256x256.jpg" class="photo" alt="Yegor Bugayenko"/> </a></div><nav><ul class="menu social notranslate"> <li><a href="https://twitter.com/intent/follow?screen_name=yegor256" rel="nofollow" title="Follow me on Twitter"><i class="icon icon-twitter notranslate" aria-hidden="true"></i></a></li> <li><a href="/rss.xml" rel="nofollow" title="Subscribe to my RSS feed"><i class="icon icon-rss notranslate" aria-hidden="true"></i></a></li> <li><a itemprop="sameAs" href="https://github.com/yegor256" rel="nofollow" title="My GitHub profile"><i class="icon icon-github notranslate" aria-hidden="true"></i></a></li> <li><a itemprop="sameAs" href="http://stackoverflow.com/users/187141/yegor256" rel="nofollow" title="My StackOverflow profile"><i class="icon icon-stackoverflow notranslate" aria-hidden="true"></i></a></li> <li><a itemprop="sameAs" href="https://www.facebook.com/yegor256" rel="nofollow" title="Follow me on Facebook"><i class="icon icon-facebook notranslate" aria-hidden="true"></i></a></li> <li><a itemprop="sameAs" href="https://instagram.com/yegor256" rel="nofollow" title="Follow me on Instagram"><i class="icon icon-instagram notranslate" aria-hidden="true"></i></a></li> <li><a itemprop="sameAs" href="https://www.linkedin.com/in/yegor256" rel="nofollow" title="My LinkedIn profile"><i class="icon icon-linkedin notranslate" aria-hidden="true"></i></a></li> <li><a itemprop="sameAs" href="https://www.youtube.com/c/yegor256?sub_confirmation=1" rel="nofollow" title="My Youtube video channel"><i class="icon icon-youtube notranslate" aria-hidden="true"></i></a></li> <li><a itemprop="sameAs" href="https://www.pinterest.com/yegor256/" rel="nofollow" title="My Pinterest boards"><i class="icon icon-pinterest notranslate" aria-hidden="true"></i></a></li> <li><a itemprop="sameAs" href="https://angel.co/yegor256" rel="nofollow" title="My AngelList profile"><i class="icon icon-angellist notranslate" aria-hidden="true"></i></a></li> <li><a href="https://soundcloud.com/yegor256" rel="nofollow" title="My podcast"><i class="icon icon-podcast notranslate" aria-hidden="true"></i></a></li> <li><a href="https://itunes.apple.com/us/podcast/yegor256-podcast/id1150826721" rel="nofollow" title="My iTunes podcast"><i class="icon icon-itunes notranslate" aria-hidden="true"></i></a></li> <li><a href="https://t.me/joinchat/AAAAAEJFMRzsRTRxM3ec6A" rel="nofollow" title="My Telegram public channel"><i class="icon icon-telegram notranslate" aria-hidden="true"></i></a></li> <li><a href="mailto:blog@yegor256.com" rel="nofollow" title="Email me any time"><i class="icon icon-mail notranslate" aria-hidden="true"></i></a></li></ul><ul class="menu"> <li><a href="/" title="Home page">Home</a></li> <li ><a href="/best.html" title="Best articles to read">12&#160;Best</a></li> <li ><a href="/contents.html" title="The contents of the entire blog">All&#160;288</a></li> <li ><a href="/webinars.html" title="My webinars">Webinars</a></li> <li ><a href="/talks.html" title="Future and past conference talks">Talks</a></li> <li ><a href="/books.html" title="The books I wrote">Books</a></li> <li ><a href="/papers.html" title="My academic papers and patents">Papers</a></li> <li ><a href="/pets.html" title="My loved pet projects">Pets</a></li> <li ><a href="/award.html" title="Software quality award">Award</a></li> <li ><a href="/testimonials.html" title="What some people say about me">Testimonials</a></li> <li ><a href="/shift-m.html" title="Audio podcast about project management">Shift-M</a></li> <li ><a href="/paintings.html" title="My paintings for sale">Paintings</a></li> <li><a href="http://ru.yegor256.com/" title="Немного на русском языке">По-русски</a></li></ul></nav><div class="search"> <form method="get" action="https://www.google.com/search" itemprop="potentialAction" itemscope="" itemtype="http://schema.org/SearchAction"> <meta itemprop="target" content="https://www.google.com/search?q={q}"/> <input name="sitesearch" value="yegor256.com" type="hidden"/> <input itemprop="query-input" type="text" id="search-query" class="field field-text" required="required" onfocus="$('.google').css('visibility', 'visible');" name="q" placeholder="Search..." autocomplete="off"/> <input type="image" src="/images/google-search-icon.svg" class="google" title="Search via Google" alt="Search via Google"/> </form></div><div class="hot"><ul> <li> <a href="/code-ahead.html">Code Ahead</a> was published on Amazon just a few days ago! It is my new book, a novel about programmers. It explains in details the majority of ideas that stand behind <a href="https://www.zerocracy.com">Zerocracy</a> and <a href="https://www.xdsd.org">XDSD</a>. </li> <li> At <a href="/webinars.html">Webinar #37</a> we will discuss naming problem in OOP, for objects, methods and attributes; join us on <b>September 12</b>, at 11am PST. </li></ul></div></header></div><section itemscope="" itemtype="http://schema.org/BlogPosting"><div class="wrapper"> <header><p class="printable"> <img src="https://api.qrserver.com/v1/create-qr-code/?data=https://www.yegor256.com/2017/05/17/single-statement-unit-tests.html&amp;format=svg" style="width:125px;height:125px;" alt="QR code"/></p><p class="printable"> <code itemprop="url">https://www.yegor256.com/2017/05/17/single-statement-unit-tests.html</code></p><h1 itemprop="name headline mainEntityOfPage">Single Statement Unit Tests</h1><ul class="subline"> <li> <time itemprop="datePublished" datetime="2017-05-17T00:00:00+00:00"> 17 May 2017 </time> </li> <li class="desktop-only" itemprop="locationCreated">Odessa, Ukraine</li> <li class="printable" itemscope="" itemprop="author" itemtype="http://schema.org/Person"> <span itemprop="name">Yegor Bugayenko</span> </li> <li class="unprintable"> <i class="icon icon-comments"></i> <a href="http://www.yegor256.com/2017/05/17/single-statement-unit-tests.html#disqus_thread" itemprop="discussionUrl">comments</a> </li></ul><figure class='jb_picture'><img itemprop='image' alt='Bullet (1996) by Julien Temple' src='/images/2017/05/bullet.jpg' longdesc='#80ac9633'/><figcaption id='80ac9633'>Bullet (1996) by Julien Temple</figcaption></figure><p>Look at this test method from <code>RandomStreamTest</code> from OpenJDK&nbsp;8, created by Brian Goetz:</p><figure class="highlight"><pre><code class="language-java" data-lang="java"><span></span><span class="nd">@Test</span>
<span class="kd">public</span> <span class="kt">void</span> <span class="nf">testIntStream</span><span class="o">()</span> <span class="o">{</span>
  <span class="kd">final</span> <span class="kt">long</span> <span class="n">seed</span> <span class="o">=</span> <span class="n">System</span><span class="o">.</span><span class="na">currentTimeMillis</span><span class="o">();</span>
  <span class="kd">final</span> <span class="n">Random</span> <span class="n">r1</span> <span class="o">=</span> <span class="k">new</span> <span class="n">Random</span><span class="o">(</span><span class="n">seed</span><span class="o">);</span>
  <span class="kd">final</span> <span class="kt">int</span><span class="o">[]</span> <span class="n">a</span> <span class="o">=</span> <span class="k">new</span> <span class="kt">int</span><span class="o">[</span><span class="n">SIZE</span><span class="o">];</span>
  <span class="k">for</span> <span class="o">(</span><span class="kt">int</span> <span class="n">i</span><span class="o">=</span><span class="mi">0</span><span class="o">;</span> <span class="n">i</span> <span class="o">&lt;</span> <span class="n">SIZE</span><span class="o">;</span> <span class="n">i</span><span class="o">++)</span> <span class="o">{</span>
    <span class="n">a</span><span class="o">[</span><span class="n">i</span><span class="o">]</span> <span class="o">=</span> <span class="n">r1</span><span class="o">.</span><span class="na">nextInt</span><span class="o">();</span>
  <span class="o">}</span>
  <span class="kd">final</span> <span class="n">Random</span> <span class="n">r2</span> <span class="o">=</span> <span class="k">new</span> <span class="n">Random</span><span class="o">(</span><span class="n">seed</span><span class="o">);</span>
  <span class="kd">final</span> <span class="kt">int</span><span class="o">[]</span> <span class="n">b</span> <span class="o">=</span> <span class="n">r2</span><span class="o">.</span><span class="na">ints</span><span class="o">().</span><span class="na">limit</span><span class="o">(</span><span class="n">SIZE</span><span class="o">).</span><span class="na">toArray</span><span class="o">();</span>
  <span class="n">assertEquals</span><span class="o">(</span><span class="n">a</span><span class="o">,</span> <span class="n">b</span><span class="o">);</span>
<span class="o">}</span></code></pre></figure><p>There are two parts in this method: the algorithm and the assertion. The algorithm prepares two arrays of integers and the assertion compares them and throws <code>AssertionError</code> if they are not equal.</p><aside class='youtube'> <a href='https://www.youtube.com/watch?v=1bAixLaOCSA'><div class='box'> <img src='https://i.ytimg.com/vi/1bAixLaOCSA/mqdefault.jpg' alt='YouTube video #1bAixLaOCSA'/><div class='play'><i class='icon icon-play'></i></div></div></a><div>Java Day Minsk 2017 | Yegor Bugayenko - Object Oriented JUnit Tests; 3 June 2017.</div></aside><p>I&#39;m saying that the first part, the algorithm, is the one we should try to avoid. The only thing we must have is the assertion. Here is how I would re-design this test method:</p><figure class="highlight"><pre><code class="language-java" data-lang="java"><span></span><span class="nd">@Test</span>
<span class="kd">public</span> <span class="kt">void</span> <span class="nf">testIntStream</span><span class="o">()</span> <span class="o">{</span>
  <span class="kd">final</span> <span class="kt">long</span> <span class="n">seed</span> <span class="o">=</span> <span class="n">System</span><span class="o">.</span><span class="na">currentTimeMillis</span><span class="o">();</span>
  <span class="n">assertEquals</span><span class="o">(</span>
    <span class="k">new</span> <span class="n">ArrayFromRandom</span><span class="o">(</span>
      <span class="k">new</span> <span class="n">Random</span><span class="o">(</span><span class="n">seed</span><span class="o">)</span>
    <span class="o">).</span><span class="na">toArray</span><span class="o">(</span><span class="n">SIZE</span><span class="o">),</span>
    <span class="k">new</span> <span class="n">Random</span><span class="o">(</span><span class="n">seed</span><span class="o">).</span><span class="na">ints</span><span class="o">().</span><span class="na">limit</span><span class="o">(</span><span class="n">SIZE</span><span class="o">).</span><span class="na">toArray</span><span class="o">()</span>
  <span class="o">);</span>
<span class="o">}</span>
<span class="kd">private</span> <span class="kd">static</span> <span class="kd">class</span> <span class="nc">ArrayFromRandom</span> <span class="o">{</span>
  <span class="kd">private</span> <span class="kd">final</span> <span class="n">Random</span> <span class="n">random</span><span class="o">;</span>
  <span class="n">ArrayFromRandom</span><span class="o">(</span><span class="n">Random</span> <span class="n">r</span><span class="o">)</span> <span class="o">{</span>
    <span class="k">this</span><span class="o">.</span><span class="na">random</span> <span class="o">=</span> <span class="n">r</span><span class="o">;</span>
  <span class="o">}</span>
  <span class="kt">int</span><span class="o">[]</span> <span class="nf">toArray</span><span class="o">(</span><span class="kt">int</span> <span class="n">s</span><span class="o">)</span> <span class="o">{</span>
    <span class="kd">final</span> <span class="kt">int</span><span class="o">[]</span> <span class="n">a</span> <span class="o">=</span> <span class="k">new</span> <span class="kt">int</span><span class="o">[</span><span class="n">s</span><span class="o">];</span>
    <span class="k">for</span> <span class="o">(</span><span class="kt">int</span> <span class="n">i</span><span class="o">=</span><span class="mi">0</span><span class="o">;</span> <span class="n">i</span> <span class="o">&lt;</span> <span class="n">s</span><span class="o">;</span> <span class="n">i</span><span class="o">++)</span> <span class="o">{</span>
      <span class="n">a</span><span class="o">[</span><span class="n">i</span><span class="o">]</span> <span class="o">=</span> <span class="k">this</span><span class="o">.</span><span class="na">random</span><span class="o">.</span><span class="na">nextInt</span><span class="o">();</span>
    <span class="o">}</span>
    <span class="k">return</span> <span class="n">a</span><span class="o">;</span>
  <span class="o">}</span>
<span class="o">}</span></code></pre></figure><p>If Java had <a href="/2017/05/16/monikers.html">monikers</a> this code would look even more elegant:</p><figure class="highlight"><pre><code class="language-java" data-lang="java"><span></span><span class="nd">@Test</span>
<span class="kd">public</span> <span class="kt">void</span> <span class="nf">testIntStream</span><span class="o">()</span> <span class="o">{</span>
  <span class="n">assertEquals</span><span class="o">(</span>
    <span class="k">new</span> <span class="n">ArrayFromRandom</span><span class="o">(</span>
      <span class="k">new</span> <span class="n">Random</span><span class="o">(</span><span class="n">System</span><span class="o">.</span><span class="na">currentTimeMillis</span><span class="o">()</span> <span class="n">as</span> <span class="n">seed</span><span class="o">)</span>
    <span class="o">).</span><span class="na">toArray</span><span class="o">(</span><span class="n">SIZE</span><span class="o">),</span>
    <span class="k">new</span> <span class="n">Random</span><span class="o">(</span><span class="n">seed</span><span class="o">).</span><span class="na">ints</span><span class="o">().</span><span class="na">limit</span><span class="o">(</span><span class="n">SIZE</span><span class="o">).</span><span class="na">toArray</span><span class="o">()</span>
  <span class="o">);</span>
<span class="o">}</span></code></pre></figure><p>As you can see, there is only one &quot;statement&quot; in this method: <code>assertEquals()</code>.</p><p><a href="http://hamcrest.org/">Hamcrest</a> with its <a href="http://hamcrest.org/JavaHamcrest/javadoc/2.0.0.0/org/hamcrest/MatcherAssert.html"><code>assertThat()</code></a> and its <a href="http://hamcrest.org/JavaHamcrest/javadoc/2.0.0.0/allclasses-frame.html">collection</a> of basic matchers is a perfect instrument to make our single-statement test methods even more cohesive and readable.</p><aside class='youtube'> <a href='https://www.youtube.com/watch?v=CCr8hRE_TUs'><div class='box'> <img src='https://i.ytimg.com/vi/CCr8hRE_TUs/mqdefault.jpg' alt='YouTube video #CCr8hRE_TUs'/><div class='play'><i class='icon icon-play'></i></div></div></a><div>Object-Oriented Flavor for JUnit Tests; 29 May 2017.</div></aside><p>There are a number of practical benefits of this principle, if we agree to follow it:</p><ul> <li><p><strong>Reusability</strong>. The classes we will have to create for test assertions will be reusable in other test methods and test cases. Just as, in the example above, <code>ArrayFromRandom</code> could be used somewhere else. Similarly, Hamcrest matchers may and will constitute a library of reusable test components.</p></li> <li><p><strong>Brevity</strong>. Since it will be rather difficult to create a long test method when it only has a single <code>assert</code>, you and your fellow programmers will inevitably write shorter and more readable code.</p></li> <li><p><strong>Readability</strong>. With a single <code>assert</code> it will always be obvious what the intent of the test method is. It will start with the intent declaration while all other lower level details will be indented.</p></li> <li><p><strong>Immutability</strong>. It will be almost impossible to have <a href="/2014/09/16/getters-and-setters-are-evil.html">setters</a> in the production code if test methods have no place for algorithmic code. You inevitably will create <a href="/2014/06/09/objects-should-be-immutable.html">immutable objects</a> to make them testable with a single <code>assert</code>.</p></li></ul><p>The biggest benefit we get when this principle is applied to our tests is that they become declarative and object-oriented, instead of being algorithmic, imperative, and procedural.</p></p>--> <nav class="buttons notranslate desktop-only"> <a href="http://www.facebook.com/sharer/sharer.php?u=https://www.yegor256.com/2017/05/17/single-statement-unit-tests.html" title="Share on Facebook" class="button" rel="nofollow"> <span class="count count-facebook">0</span> <i class="icon icon-facebook notranslate" aria-hidden="true"></i> </a> <a href="https://twitter.com/share?url=https://www.yegor256.com/2017/05/17/single-statement-unit-tests.html&amp;text=Single+Statement+Unit+Tests" title="Share on Twitter" class="button" rel="nofollow"> <span class="count count-twitter">0</span> <i class="icon icon-twitter notranslate" aria-hidden="true"></i> </a> <a href="https://plus.google.com/share?url=https://www.yegor256.com/2017/05/17/single-statement-unit-tests.html" title="Share on Google+" class="button" rel="nofollow"> <span class="count count-googleplus">0</span> <i class="icon icon-googleplus notranslate" aria-hidden="true"></i> </a> <a href="https://www.linkedin.com/cws/share?url=https://www.yegor256.com/2017/05/17/single-statement-unit-tests.html" title="Share on LinkedIn" class="button" rel="nofollow"> <span class="count count-linkedin">0</span> <i class="icon icon-linkedin notranslate" aria-hidden="true"></i> </a> <a href="http://reddit.com/submit?url=https://www.yegor256.com/2017/05/17/single-statement-unit-tests.html%3F2017-20&amp;title=Single+Statement+Unit+Tests" title="Share on Reddit" class="button" rel="nofollow"> <span class="count count-reddit">0</span> <i class="icon icon-reddit notranslate" aria-hidden="true"></i> </a> <a href="http://news.ycombinator.com/submitlink?u=https://www.yegor256.com/2017/05/17/single-statement-unit-tests.html%3F2017-20&amp;t=Single+Statement+Unit+Tests" title="Share on Hacker News" class="button" rel="nofollow"> <span class="count count-hackernews">0</span> <i class="icon icon-hackernews notranslate" aria-hidden="true"></i> </a> </nav> </header> <article class="main" itemprop="articleBody"><div ><p>Many articles and books have already been written about unit testing patterns and anti-patterns. I want to add one more recommendation which, I believe, can help us make our tests, <em>and</em> our production code, more <em>object-oriented</em>. Here it is: a test method must contain nothing but a single <code>assert</code>.</p><figure class='jb_picture'><img itemprop='image' alt='Bullet (1996) by Julien Temple' src='/images/2017/05/bullet.jpg' longdesc='#80ac9633'/><figcaption id='80ac9633'>Bullet (1996) by Julien Temple</figcaption></figure><p>Look at this test method from <code>RandomStreamTest</code> from OpenJDK&nbsp;8, created by Brian Goetz:</p><figure class="highlight"><pre><code class="language-java" data-lang="java"><span></span><span class="nd">@Test</span>
<span class="kd">public</span> <span class="kt">void</span> <span class="nf">testIntStream</span><span class="o">()</span> <span class="o">{</span>
  <span class="kd">final</span> <span class="kt">long</span> <span class="n">seed</span> <span class="o">=</span> <span class="n">System</span><span class="o">.</span><span class="na">currentTimeMillis</span><span class="o">();</span>
  <span class="kd">final</span> <span class="n">Random</span> <span class="n">r1</span> <span class="o">=</span> <span class="k">new</span> <span class="n">Random</span><span class="o">(</span><span class="n">seed</span><span class="o">);</span>
  <span class="kd">final</span> <span class="kt">int</span><span class="o">[]</span> <span class="n">a</span> <span class="o">=</span> <span class="k">new</span> <span class="kt">int</span><span class="o">[</span><span class="n">SIZE</span><span class="o">];</span>
  <span class="k">for</span> <span class="o">(</span><span class="kt">int</span> <span class="n">i</span><span class="o">=</span><span class="mi">0</span><span class="o">;</span> <span class="n">i</span> <span class="o">&lt;</span> <span class="n">SIZE</span><span class="o">;</span> <span class="n">i</span><span class="o">++)</span> <span class="o">{</span>
    <span class="n">a</span><span class="o">[</span><span class="n">i</span><span class="o">]</span> <span class="o">=</span> <span class="n">r1</span><span class="o">.</span><span class="na">nextInt</span><span class="o">();</span>
  <span class="o">}</span>
  <span class="kd">final</span> <span class="n">Random</span> <span class="n">r2</span> <span class="o">=</span> <span class="k">new</span> <span class="n">Random</span><span class="o">(</span><span class="n">seed</span><span class="o">);</span>
  <span class="kd">final</span> <span class="kt">int</span><span class="o">[]</span> <span class="n">b</span> <span class="o">=</span> <span class="n">r2</span><span class="o">.</span><span class="na">ints</span><span class="o">().</span><span class="na">limit</span><span class="o">(</span><span class="n">SIZE</span><span class="o">).</span><span class="na">toArray</span><span class="o">();</span>
  <span class="n">assertEquals</span><span class="o">(</span><span class="n">a</span><span class="o">,</span> <span class="n">b</span><span class="o">);</span>
<span class="o">}</span></code></pre></figure><p>There are two parts in this method: the algorithm and the assertion. The algorithm prepares two arrays of integers and the assertion compares them and throws <code>AssertionError</code> if they are not equal.</p><aside class='youtube'> <a href='https://www.youtube.com/watch?v=1bAixLaOCSA'><div class='box'> <img src='https://i.ytimg.com/vi/1bAixLaOCSA/mqdefault.jpg' alt='YouTube video #1bAixLaOCSA'/><div class='play'><i class='icon icon-play'></i></div></div></a><div>Java Day Minsk 2017 | Yegor Bugayenko - Object Oriented JUnit Tests; 3 June 2017.</div></aside><p>I&#39;m saying that the first part, the algorithm, is the one we should try to avoid. The only thing we must have is the assertion. Here is how I would re-design this test method:</p><figure class="highlight"><pre><code class="language-java" data-lang="java"><span></span><span class="nd">@Test</span>
<span class="kd">public</span> <span class="kt">void</span> <span class="nf">testIntStream</span><span class="o">()</span> <span class="o">{</span>
  <span class="kd">final</span> <span class="kt">long</span> <span class="n">seed</span> <span class="o">=</span> <span class="n">System</span><span class="o">.</span><span class="na">currentTimeMillis</span><span class="o">();</span>
  <span class="n">assertEquals</span><span class="o">(</span>
    <span class="k">new</span> <span class="n">ArrayFromRandom</span><span class="o">(</span>
      <span class="k">new</span> <span class="n">Random</span><span class="o">(</span><span class="n">seed</span><span class="o">)</span>
    <span class="o">).</span><span class="na">toArray</span><span class="o">(</span><span class="n">SIZE</span><span class="o">),</span>
    <span class="k">new</span> <span class="n">Random</span><span class="o">(</span><span class="n">seed</span><span class="o">).</span><span class="na">ints</span><span class="o">().</span><span class="na">limit</span><span class="o">(</span><span class="n">SIZE</span><span class="o">).</span><span class="na">toArray</span><span class="o">()</span>
  <span class="o">);</span>
<span class="o">}</span>
<span class="kd">private</span> <span class="kd">static</span> <span class="kd">class</span> <span class="nc">ArrayFromRandom</span> <span class="o">{</span>
  <span class="kd">private</span> <span class="kd">final</span> <span class="n">Random</span> <span class="n">random</span><span class="o">;</span>
  <span class="n">ArrayFromRandom</span><span class="o">(</span><span class="n">Random</span> <span class="n">r</span><span class="o">)</span> <span class="o">{</span>
    <span class="k">this</span><span class="o">.</span><span class="na">random</span> <span class="o">=</span> <span class="n">r</span><span class="o">;</span>
  <span class="o">}</span>
  <span class="kt">int</span><span class="o">[]</span> <span class="nf">toArray</span><span class="o">(</span><span class="kt">int</span> <span class="n">s</span><span class="o">)</span> <span class="o">{</span>
    <span class="kd">final</span> <span class="kt">int</span><span class="o">[]</span> <span class="n">a</span> <span class="o">=</span> <span class="k">new</span> <span class="kt">int</span><span class="o">[</span><span class="n">s</span><span class="o">];</span>
    <span class="k">for</span> <span class="o">(</span><span class="kt">int</span> <span class="n">i</span><span class="o">=</span><span class="mi">0</span><span class="o">;</span> <span class="n">i</span> <span class="o">&lt;</span> <span class="n">s</span><span class="o">;</span> <span class="n">i</span><span class="o">++)</span> <span class="o">{</span>
      <span class="n">a</span><span class="o">[</span><span class="n">i</span><span class="o">]</span> <span class="o">=</span> <span class="k">this</span><span class="o">.</span><span class="na">random</span><span class="o">.</span><span class="na">nextInt</span><span class="o">();</span>
    <span class="o">}</span>
    <span class="k">return</span> <span class="n">a</span><span class="o">;</span>
  <span class="o">}</span>
<span class="o">}</span></code></pre></figure><p>If Java had <a href="/2017/05/16/monikers.html">monikers</a> this code would look even more elegant:</p><figure class="highlight"><pre><code class="language-java" data-lang="java"><span></span><span class="nd">@Test</span>
<span class="kd">public</span> <span class="kt">void</span> <span class="nf">testIntStream</span><span class="o">()</span> <span class="o">{</span>
  <span class="n">assertEquals</span><span class="o">(</span>
    <span class="k">new</span> <span class="n">ArrayFromRandom</span><span class="o">(</span>
      <span class="k">new</span> <span class="n">Random</span><span class="o">(</span><span class="n">System</span><span class="o">.</span><span class="na">currentTimeMillis</span><span class="o">()</span> <span class="n">as</span> <span class="n">seed</span><span class="o">)</span>
    <span class="o">).</span><span class="na">toArray</span><span class="o">(</span><span class="n">SIZE</span><span class="o">),</span>
    <span class="k">new</span> <span class="n">Random</span><span class="o">(</span><span class="n">seed</span><span class="o">).</span><span class="na">ints</span><span class="o">().</span><span class="na">limit</span><span class="o">(</span><span class="n">SIZE</span><span class="o">).</span><span class="na">toArray</span><span class="o">()</span>
  <span class="o">);</span>
<span class="o">}</span></code></pre></figure><p>As you can see, there is only one &quot;statement&quot; in this method: <code>assertEquals()</code>.</p><p><a href="http://hamcrest.org/">Hamcrest</a> with its <a href="http://hamcrest.org/JavaHamcrest/javadoc/2.0.0.0/org/hamcrest/MatcherAssert.html"><code>assertThat()</code></a> and its <a href="http://hamcrest.org/JavaHamcrest/javadoc/2.0.0.0/allclasses-frame.html">collection</a> of basic matchers is a perfect instrument to make our single-statement test methods even more cohesive and readable.</p><aside class='youtube'> <a href='https://www.youtube.com/watch?v=CCr8hRE_TUs'><div class='box'> <img src='https://i.ytimg.com/vi/CCr8hRE_TUs/mqdefault.jpg' alt='YouTube video #CCr8hRE_TUs'/><div class='play'><i class='icon icon-play'></i></div></div></a><div>Object-Oriented Flavor for JUnit Tests; 29 May 2017.</div></aside><p>There are a number of practical benefits of this principle, if we agree to follow it:</p><ul> <li><p><strong>Reusability</strong>. The classes we will have to create for test assertions will be reusable in other test methods and test cases. Just as, in the example above, <code>ArrayFromRandom</code> could be used somewhere else. Similarly, Hamcrest matchers may and will constitute a library of reusable test components.</p></li> <li><p><strong>Brevity</strong>. Since it will be rather difficult to create a long test method when it only has a single <code>assert</code>, you and your fellow programmers will inevitably write shorter and more readable code.</p></li> <li><p><strong>Readability</strong>. With a single <code>assert</code> it will always be obvious what the intent of the test method is. It will start with the intent declaration while all other lower level details will be indented.</p></li> <li><p><strong>Immutability</strong>. It will be almost impossible to have <a href="/2014/09/16/getters-and-setters-are-evil.html">setters</a> in the production code if test methods have no place for algorithmic code. You inevitably will create <a href="/2014/06/09/objects-should-be-immutable.html">immutable objects</a> to make them testable with a single <code>assert</code>.</p></li></ul><p>The biggest benefit we get when this principle is applied to our tests is that they become declarative and object-oriented, instead of being algorithmic, imperative, and procedural.</p></div></article></div><div class="wrapper"> <related-posts /></div><div class="disqus" role="complementary"><p class="disqus_hint"> Please, use <a href="https://help.disqus.com/commenting/what-html-tags-are-allowed-within-comments">syntax highlighting</a> in your comments, to make them more readable.</p><div id="disqus_thread" class="disqus-thread"> <a>&nbsp;</a></div><script> var disqus_config = function () { this.page.url = document.location.href.split('?')[0].split('#')[0].replace('https://', 'http://'); this.page.identifier = this.page.url; }; (function() { var d = document, s = d.createElement('script'); s.src = '//yegor256.disqus.com/embed.js'; s.setAttribute('data-timestamp', +new Date()); (d.head || d.body).appendChild(s); })(); </script> <noscript><div><p class="red"> JavaScript is disabled in your browser, that's why you can't see comments under this post.</p></div></noscript></div><div class="wrapper"> <footer class="footer"><p> &copy; <span itemscope="" itemprop="copyrightHolder" itemtype="http://schema.org/Person"> <span itemprop="name">Yegor Bugayenko</span> </span> 2014&ndash;<span itemprop="copyrightYear">2018</span></p></footer></div></section><div class="wrapper unprintable" style="text-align:center;margin-top:2em;"> <a href="http://www.sixnines.io/h/3ba1652f"> <img src="//www.sixnines.io/b/3ba1652f?style=flat" alt="sixnines availability badge"/> </a></div><script src="//code.jquery.com/jquery-1.9.0.min.js"></script> <script src="/js/all.js?4e047f6f42b"></script> <script>var disqus_shortname = 'yegor256';</script> <script id="dsq-count-scr" src="//yegor256.disqus.com/count.js" async="async"></script> <script> (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){ (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o), m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m) })(window,document,'script','//www.google-analytics.com/analytics.js','ga'); ga('create', 'UA-1963507-32', 'auto'); ga('send', 'pageview'); </script> <script> Cd=document;Cr="&"+Math.random();Cp="&s=1"; Cd.cookie="b=b";if(Cd.cookie)Cp+="&c=1"; Cp+="&t="+(new Date()).getTimezoneOffset(); if(self!=top)Cp+="&f=1"; </script> <script> if(navigator.javaEnabled())Cp+="&j=1"; </script> <script> if(typeof(screen)!='undefined')Cp+="&w="+screen.width+"&h="+ screen.height+"&d="+(screen.colorDepth?screen.colorDepth:screen.pixelDepth); </script> <script> Cd.write("<img src='//c.hit.ua/hit?i=95870&g=0&x=2"+Cp+Cr+ "&r="+escape(Cd.referrer)+"&u="+escape(window.location.href)+ "' border='0' wi"+"dth='1' he"+"ight='1'/>"); </script> <script type="application/ld+json"> { "@context": "http://schema.org", "@type": "Person", "name": "Yegor Bugayenko", "url": "http://www.yegor256.com", "sameAs": [ "https://www.facebook.com/yegor256", "https://instagram.com/yegor256", "https://www.linkedin.com/in/yegor256", "https://twitter.com/yegor256", "https://github.com/yegor256", "https://www.pinterest.com/yegor256/" ] } </script> </body> </html> <!DOCTYPE html> <html xmlns="http://www.w3.org/1999/xhtml" lang="en-US" xml:lang="en-US" itemscope="" itemtype="http://schema.org/WebSite"> <head> <meta charset="utf-8"/> <meta name="description" content="Mixins and traits are becoming popular in OOP, but do they really have anything to do with proper object-oriented thinking and design? " /> <meta name="keywords" content="OOP, mixin oop, oop traits, trait in programming, traits" /> <meta name="viewport" content="width=device-width,minimum-scale=1,initial-scale=1"/> <meta name="google-site-verification" content="JEj_gQr2CPe2QKGw8XdMz0R7VboQIUbX3FlM-lwTq-8" /> <meta name="author" content="Yegor Bugayenko"> <meta name="article:published_time" content="2017-03-07 00:00:00 +0000"> <meta name="og:site_name" content="Yegor Bugayenko"/> <meta name="og:type" content="article" /> <meta name="og:locale" content="en_US" /> <meta name="twitter:account_id" content="4503599630178231" /> <meta name="twitter:creator" content="@yegor256"/> <meta name="twitter:site" content="@yegor256"/> <meta name="twitter:title" property="og:title" content="Traits and Mixins Are Not OOP"/> <meta name="twitter:description" property="og:description" content="Mixins and traits are becoming popular in OOP, but do they really have anything to do with proper object-oriented thinking and design? "/> <meta name="twitter:url" property="og:url" content="https://www.yegor256.com/2017/03/07/traits-and-mixins.html"/> <meta name="telegram:channel" content="AAAAAEJFMRzsRTRxM3ec6A"/> <link rel="search" type="application/opensearchdescription+xml" href="/opensearch.xml" title="yegor256" /> <link rel="shortcut icon" href="/favicon.ico?4e047f6f42b"/> <link rel="apple-touch-icon" href="/favicon.ico?4e047f6f42b"/> <link rel="alternate" type="application/rss+xml" title="RSS for yegor256.com" href="https://www.yegor256.com/rss.xml"/> <link rel="stylesheet" href="/css/layout.css?4e047f6f42b"/> <link rel="stylesheet" href="/css/icons.css?4e047f6f42b"/> <link rel="canonical" href="https://www.yegor256.com/2017/03/07/traits-and-mixins.html" /> <link rel="amphtml" href="https://www.yegor256.com/2017/03/07/traits-and-mixins.amp.html" /> <title>Traits and Mixins Are Not OOP </title> <meta name='og:image' content='https://www.yegor256.com/images/2014/04/fear-and-loathing-adrenochrome.png'/><meta name='twitter:image' content='https://www.yegor256.com/images/2014/04/fear-and-loathing-adrenochrome.png'/><meta name='og:image:width' content='1920'/> <meta name='twitter:image:width' content='1920'/><meta name='og:image:height' content='816'/> <meta name='twitter:image:height' content='816'/><meta name='twitter:card' content='summary_large_image'/><meta name='twitter:image:alt' content='Fear and Loathing in Las Vegas (1998) by Terry Gilliam'/> </head> <body><div class="wrapper"> <aside class="header-toggle unprintable" id="header-toggle" title="Show the menu" onclick="$('#header').show();$('#header-toggle').hide();">&#9776;</aside> <header class="header" id="header"><div class="face"> <a href="/about-me.html#form" class="sub" title="Click to subscribe to my monthly newsletter"><span>Subscribe</span></a> <a href="/about-me.html" style="position:relative;"> <img src="/images/face-256x256.jpg" class="photo" alt="Yegor Bugayenko"/> </a></div><nav><ul class="menu social notranslate"> <li><a href="https://twitter.com/intent/follow?screen_name=yegor256" rel="nofollow" title="Follow me on Twitter"><i class="icon icon-twitter notranslate" aria-hidden="true"></i></a></li> <li><a href="/rss.xml" rel="nofollow" title="Subscribe to my RSS feed"><i class="icon icon-rss notranslate" aria-hidden="true"></i></a></li> <li><a itemprop="sameAs" href="https://github.com/yegor256" rel="nofollow" title="My GitHub profile"><i class="icon icon-github notranslate" aria-hidden="true"></i></a></li> <li><a itemprop="sameAs" href="http://stackoverflow.com/users/187141/yegor256" rel="nofollow" title="My StackOverflow profile"><i class="icon icon-stackoverflow notranslate" aria-hidden="true"></i></a></li> <li><a itemprop="sameAs" href="https://www.facebook.com/yegor256" rel="nofollow" title="Follow me on Facebook"><i class="icon icon-facebook notranslate" aria-hidden="true"></i></a></li> <li><a itemprop="sameAs" href="https://instagram.com/yegor256" rel="nofollow" title="Follow me on Instagram"><i class="icon icon-instagram notranslate" aria-hidden="true"></i></a></li> <li><a itemprop="sameAs" href="https://www.linkedin.com/in/yegor256" rel="nofollow" title="My LinkedIn profile"><i class="icon icon-linkedin notranslate" aria-hidden="true"></i></a></li> <li><a itemprop="sameAs" href="https://www.youtube.com/c/yegor256?sub_confirmation=1" rel="nofollow" title="My Youtube video channel"><i class="icon icon-youtube notranslate" aria-hidden="true"></i></a></li> <li><a itemprop="sameAs" href="https://www.pinterest.com/yegor256/" rel="nofollow" title="My Pinterest boards"><i class="icon icon-pinterest notranslate" aria-hidden="true"></i></a></li> <li><a itemprop="sameAs" href="https://angel.co/yegor256" rel="nofollow" title="My AngelList profile"><i class="icon icon-angellist notranslate" aria-hidden="true"></i></a></li> <li><a href="https://soundcloud.com/yegor256" rel="nofollow" title="My podcast"><i class="icon icon-podcast notranslate" aria-hidden="true"></i></a></li> <li><a href="https://itunes.apple.com/us/podcast/yegor256-podcast/id1150826721" rel="nofollow" title="My iTunes podcast"><i class="icon icon-itunes notranslate" aria-hidden="true"></i></a></li> <li><a href="https://t.me/joinchat/AAAAAEJFMRzsRTRxM3ec6A" rel="nofollow" title="My Telegram public channel"><i class="icon icon-telegram notranslate" aria-hidden="true"></i></a></li> <li><a href="mailto:blog@yegor256.com" rel="nofollow" title="Email me any time"><i class="icon icon-mail notranslate" aria-hidden="true"></i></a></li></ul><ul class="menu"> <li><a href="/" title="Home page">Home</a></li> <li ><a href="/best.html" title="Best articles to read">12&#160;Best</a></li> <li ><a href="/contents.html" title="The contents of the entire blog">All&#160;288</a></li> <li ><a href="/webinars.html" title="My webinars">Webinars</a></li> <li ><a href="/talks.html" title="Future and past conference talks">Talks</a></li> <li ><a href="/books.html" title="The books I wrote">Books</a></li> <li ><a href="/papers.html" title="My academic papers and patents">Papers</a></li> <li ><a href="/pets.html" title="My loved pet projects">Pets</a></li> <li ><a href="/award.html" title="Software quality award">Award</a></li> <li ><a href="/testimonials.html" title="What some people say about me">Testimonials</a></li> <li ><a href="/shift-m.html" title="Audio podcast about project management">Shift-M</a></li> <li ><a href="/paintings.html" title="My paintings for sale">Paintings</a></li> <li><a href="http://ru.yegor256.com/" title="Немного на русском языке">По-русски</a></li></ul></nav><div class="search"> <form method="get" action="https://www.google.com/search" itemprop="potentialAction" itemscope="" itemtype="http://schema.org/SearchAction"> <meta itemprop="target" content="https://www.google.com/search?q={q}"/> <input name="sitesearch" value="yegor256.com" type="hidden"/> <input itemprop="query-input" type="text" id="search-query" class="field field-text" required="required" onfocus="$('.google').css('visibility', 'visible');" name="q" placeholder="Search..." autocomplete="off"/> <input type="image" src="/images/google-search-icon.svg" class="google" title="Search via Google" alt="Search via Google"/> </form></div><div class="hot"><ul> <li> <a href="/code-ahead.html">Code Ahead</a> was published on Amazon just a few days ago! It is my new book, a novel about programmers. It explains in details the majority of ideas that stand behind <a href="https://www.zerocracy.com">Zerocracy</a> and <a href="https://www.xdsd.org">XDSD</a>. </li> <li> At <a href="/webinars.html">Webinar #37</a> we will discuss naming problem in OOP, for objects, methods and attributes; join us on <b>September 12</b>, at 11am PST. </li></ul></div></header></div><section itemscope="" itemtype="http://schema.org/BlogPosting"><div class="wrapper"> <header><p class="printable"> <img src="https://api.qrserver.com/v1/create-qr-code/?data=https://www.yegor256.com/2017/03/07/traits-and-mixins.html&amp;format=svg" style="width:125px;height:125px;" alt="QR code"/></p><p class="printable"> <code itemprop="url">https://www.yegor256.com/2017/03/07/traits-and-mixins.html</code></p><h1 itemprop="name headline mainEntityOfPage">Traits and Mixins Are Not OOP</h1><ul class="subline"> <li> <time itemprop="datePublished" datetime="2017-03-07T00:00:00+00:00"> 7 March 2017 </time> </li> <li class="desktop-only" itemprop="locationCreated">Odessa, Ukraine</li> <li class="printable" itemscope="" itemprop="author" itemtype="http://schema.org/Person"> <span itemprop="name">Yegor Bugayenko</span> </li> <li class="unprintable"> <i class="icon icon-comments"></i> <a href="http://www.yegor256.com/2017/03/07/traits-and-mixins.html#disqus_thread" itemprop="discussionUrl">comments</a> </li></ul><figure class='jb_picture'><img itemprop='image' alt='Fear and Loathing in Las Vegas (1998) by Terry Gilliam' src='/images/2014/04/fear-and-loathing-adrenochrome.png' longdesc='#8efe9524'/><figcaption id='8efe9524'>Fear and Loathing in Las Vegas (1998) by Terry Gilliam</figcaption></figure><p>First, here&#39;s how they work in a nutshell. Let&#39;s use <a href="http://phrogz.net/programmingruby/tut_modules.html">Ruby modules</a> as a sample implementation. Say that we have a class <code>Book</code>:</p><figure class="highlight"><pre><code class="language-ruby" data-lang="ruby"><span></span><span class="k">class</span> <span class="nc">Book</span>
  <span class="k">def</span> <span class="nf">initialize</span><span class="p">(</span><span class="n">title</span><span class="p">)</span>
    <span class="vi">@title</span> <span class="o">=</span> <span class="n">title</span>
  <span class="k">end</span>
<span class="k">end</span></code></pre></figure><p>Now, we want class <code>Book</code> to use a static method (a procedure) that does something useful. We may either define it in a <a href="/2014/05/05/oop-alternative-to-utility-classes.html">utility class</a> and let <code>Book</code> call it:</p><figure class="highlight"><pre><code class="language-ruby" data-lang="ruby"><span></span><span class="k">class</span> <span class="nc">TextUtils</span>
  <span class="k">def</span> <span class="nc">self</span><span class="o">.</span><span class="nf">caps</span><span class="p">(</span><span class="n">text</span><span class="p">)</span>
    <span class="n">text</span><span class="o">.</span><span class="n">split</span><span class="o">.</span><span class="n">map</span><span class="p">(</span><span class="o">&amp;</span><span class="ss">:capitalize</span><span class="p">)</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="s1">&#39; &#39;</span><span class="p">)</span>
  <span class="k">end</span>
<span class="k">end</span>
<span class="k">class</span> <span class="nc">Book</span>
  <span class="k">def</span> <span class="nf">print</span>
    <span class="nb">puts</span> <span class="s2">&quot;My title is </span><span class="si">#{</span><span class="no">TextUtils</span><span class="o">.</span><span class="n">caps</span><span class="p">(</span><span class="vi">@title</span><span class="p">)</span><span class="si">}</span><span class="s2">&quot;</span>
  <span class="k">end</span>
<span class="k">end</span></code></pre></figure><p>Or we may make it even more &quot;convenient&quot; and <code>extend</code> our module in order to access its methods directly:</p><figure class="highlight"><pre><code class="language-ruby" data-lang="ruby"><span></span><span class="k">module</span> <span class="nn">TextModule</span>
  <span class="k">def</span> <span class="nf">caps</span><span class="p">(</span><span class="n">text</span><span class="p">)</span>
    <span class="n">text</span><span class="o">.</span><span class="n">split</span><span class="o">.</span><span class="n">map</span><span class="p">(</span><span class="o">&amp;</span><span class="ss">:capitalize</span><span class="p">)</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="s1">&#39; &#39;</span><span class="p">)</span>
  <span class="k">end</span>
<span class="k">end</span>
<span class="k">class</span> <span class="nc">Book</span>
  <span class="kp">extend</span> <span class="no">TextModule</span>
  <span class="k">def</span> <span class="nf">print</span>
    <span class="nb">puts</span> <span class="s2">&quot;My title is </span><span class="si">#{</span><span class="n">caps</span><span class="p">(</span><span class="vi">@title</span><span class="p">)</span><span class="si">}</span><span class="s2">&quot;</span>
  <span class="k">end</span>
<span class="k">end</span></code></pre></figure><p>It seems nice---if you don&#39;t understand the <a href="/2014/05/05/oop-alternative-to-utility-classes.html">difference</a> between <a href="/2016/08/15/what-is-wrong-object-oriented-programming.html">object-oriented programming</a> and static methods. Moreover, if we forget <a href="/2014/11/20/seven-virtues-of-good-object.html">OOP purity</a> for a minute, this approach actually looks less readable to me, even though it has fewer characters; it&#39;s difficult to understand where the method <code>caps()</code> is coming from when it&#39;s called just like <code>#{caps(@title)}</code> instead of <code>#{TextUtils.caps(@title)}</code>. Don&#39;t you think?</p><p>Mixins start to play their role better when we <code>include</code> them. We can combine them to construct the behavior of the class we&#39;re looking for. Let&#39;s create two mixins. The first one will be called <code>PlainMixin</code> and will print the title of the book the way it is, and the second one will be called <code>CapsMixin</code> and will capitalize what&#39;s already printed:</p><figure class="highlight"><pre><code class="language-ruby" data-lang="ruby"><span></span><span class="k">module</span> <span class="nn">CapsMixin</span>
  <span class="k">def</span> <span class="nf">to_s</span>
    <span class="k">super</span><span class="o">.</span><span class="n">to_s</span><span class="o">.</span><span class="n">split</span><span class="o">.</span><span class="n">map</span><span class="p">(</span><span class="o">&amp;</span><span class="ss">:capitalize</span><span class="p">)</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="s1">&#39; &#39;</span><span class="p">)</span>
  <span class="k">end</span>
<span class="k">end</span>
<span class="k">module</span> <span class="nn">PlainMixin</span>
  <span class="k">def</span> <span class="nf">to_s</span>
    <span class="vi">@title</span>
  <span class="k">end</span>
<span class="k">end</span>
<span class="k">class</span> <span class="nc">Book</span>
  <span class="k">def</span> <span class="nf">initialize</span><span class="p">(</span><span class="n">title</span><span class="p">)</span>
    <span class="vi">@title</span> <span class="o">=</span> <span class="n">title</span>
  <span class="k">end</span>
  <span class="kp">include</span> <span class="no">CapsMixin</span><span class="p">,</span> <span class="no">PlainMixin</span>
  <span class="k">def</span> <span class="nf">print</span>
    <span class="nb">puts</span> <span class="s2">&quot;My title is </span><span class="si">#{</span><span class="nb">self</span><span class="si">}</span><span class="s2">&quot;</span>
  <span class="k">end</span>
<span class="k">end</span></code></pre></figure><p>Calling <code>Book</code> without the included mixin will print its title the way it is. Once we add the <code>include</code> statement, the behavior of <code>to_s</code> is overridden and method <code>print</code> produces a different result. We can combine mixins to produce the required functionality. For example, we can add one more, which will <a href="http://stackoverflow.com/a/25136035/187141">abbreviate</a> the title to 16 characters:</p><figure class="highlight"><pre><code class="language-ruby" data-lang="ruby"><span></span><span class="k">module</span> <span class="nn">AbbrMixin</span>
  <span class="k">def</span> <span class="nf">to_s</span>
    <span class="k">super</span><span class="o">.</span><span class="n">to_s</span><span class="o">.</span><span class="n">gsub</span><span class="p">(</span><span class="sr">/^(.{16,}?).*$/m</span><span class="p">,</span><span class="s1">&#39;\1...&#39;</span><span class="p">)</span>
  <span class="k">end</span>
<span class="k">end</span>
<span class="k">class</span> <span class="nc">Book</span>
  <span class="k">def</span> <span class="nf">initialize</span><span class="p">(</span><span class="n">title</span><span class="p">)</span>
    <span class="vi">@title</span> <span class="o">=</span> <span class="n">title</span>
  <span class="k">end</span>
  <span class="kp">include</span> <span class="no">AbbrMixin</span><span class="p">,</span> <span class="no">CapsMixin</span><span class="p">,</span> <span class="no">PlainMixin</span>
  <span class="k">def</span> <span class="nf">print</span>
    <span class="nb">puts</span> <span class="s2">&quot;My title is </span><span class="si">#{</span><span class="nb">self</span><span class="si">}</span><span class="s2">&quot;</span>
  <span class="k">end</span>
<span class="k">end</span></code></pre></figure><p>I&#39;m sure you already understand that they both have access to the private attribute <code>@title</code> of class <code>Book</code>. They actually have full access to <em>everything</em> in the class. They literally are &quot;pieces of code&quot; that we <em>inject</em> into the class to make it more powerful and complex. What&#39;s wrong with this approach?</p><p>It&#39;s the same issue as with <a href="/2016/04/12/java-annotations-are-evil.html">annotations</a>, <a href="/2016/07/06/data-transfer-object.html">DTOs</a>, <a href="/2014/09/16/getters-and-setters-are-evil.html">getters</a>, and <a href="/2014/05/05/oop-alternative-to-utility-classes.html">utility classes</a>---they tear objects apart and place pieces of functionality in places where objects don&#39;t see them.</p><p>In the case of mixins, the functionality is in the Ruby <code>modules</code>, which make assumptions about the internal structure of <code>Book</code> and further assume that the programmer will still understand what&#39;s in <code>Book</code> after the internal structure changes. Such assumptions completely violate the very idea of <a href="/2016/11/21/naked-data.html">encapsulation</a>.</p><p>Such a tight coupling between mixins and object private structure leads to nothing but unmaintainable and difficult to understand code.</p><p>The very obvious alternatives to mixins are <a href="/2015/02/26/composable-decorators.html">composable decorators</a>. Take a look at the example given in the <a href="/2015/02/26/composable-decorators.html">article</a>:</p><figure class="highlight"><pre><code class="language-java" data-lang="java"><span></span><span class="n">Text</span> <span class="n">text</span> <span class="o">=</span> <span class="k">new</span> <span class="n">AllCapsText</span><span class="o">(</span>
  <span class="k">new</span> <span class="n">TrimmedText</span><span class="o">(</span>
    <span class="k">new</span> <span class="n">PrintableText</span><span class="o">(</span>
      <span class="k">new</span> <span class="n">TextInFile</span><span class="o">(</span><span class="k">new</span> <span class="n">File</span><span class="o">(</span><span class="s">&quot;/tmp/a.txt&quot;</span><span class="o">))</span>
    <span class="o">)</span>
  <span class="o">)</span>
<span class="o">);</span></code></pre></figure><p>Doesn&#39;t it look very similar to what we were doing above with Ruby mixins?</p><p>However, unlike mixins, decorators leave objects small and cohesive, layering extra functionality on top of them. Mixins do the opposite---they make objects more complex and, thanks to that, less readable and maintainable.</p><p>I honestly believe they are just poison. Whoever invented them was a long ways from understanding the philosophy of object-oriented design.</p></p>--> <nav class="buttons notranslate desktop-only"> <a href="http://www.facebook.com/sharer/sharer.php?u=https://www.yegor256.com/2017/03/07/traits-and-mixins.html" title="Share on Facebook" class="button" rel="nofollow"> <span class="count count-facebook">0</span> <i class="icon icon-facebook notranslate" aria-hidden="true"></i> </a> <a href="https://twitter.com/share?url=https://www.yegor256.com/2017/03/07/traits-and-mixins.html&amp;text=Traits+and+Mixins+Are+Not+OOP" title="Share on Twitter" class="button" rel="nofollow"> <span class="count count-twitter">0</span> <i class="icon icon-twitter notranslate" aria-hidden="true"></i> </a> <a href="https://plus.google.com/share?url=https://www.yegor256.com/2017/03/07/traits-and-mixins.html" title="Share on Google+" class="button" rel="nofollow"> <span class="count count-googleplus">0</span> <i class="icon icon-googleplus notranslate" aria-hidden="true"></i> </a> <a href="https://www.linkedin.com/cws/share?url=https://www.yegor256.com/2017/03/07/traits-and-mixins.html" title="Share on LinkedIn" class="button" rel="nofollow"> <span class="count count-linkedin">0</span> <i class="icon icon-linkedin notranslate" aria-hidden="true"></i> </a> <a href="http://reddit.com/submit?url=https://www.yegor256.com/2017/03/07/traits-and-mixins.html%3F2017-10&amp;title=Traits+and+Mixins+Are+Not+OOP" title="Share on Reddit" class="button" rel="nofollow"> <span class="count count-reddit">0</span> <i class="icon icon-reddit notranslate" aria-hidden="true"></i> </a> <a href="http://news.ycombinator.com/submitlink?u=https://www.yegor256.com/2017/03/07/traits-and-mixins.html%3F2017-10&amp;t=Traits+and+Mixins+Are+Not+OOP" title="Share on Hacker News" class="button" rel="nofollow"> <span class="count count-hackernews">0</span> <i class="icon icon-hackernews notranslate" aria-hidden="true"></i> </a> </nav> </header> <article class="main" itemprop="articleBody"><div ><p>Let me say right off the bat that the features we will discuss here are pure <em>poison</em> brought to object-oriented programming by those who desperately needed a lobotomy, just like David West suggested in his <a href="http://amzn.to/2ass77O">Object Thinking</a> book. These features have different names, but the most common ones are <a href="https://en.wikipedia.org/wiki/Trait_%28computer_programming%29">traits</a> and <a href="https://en.wikipedia.org/wiki/Mixin">mixins</a>. I seriously can&#39;t understand how we can still call programming object-oriented when it has <a href="http://stackoverflow.com/questions/925609/mixins-vs-traits">these features</a>.</p><figure class='jb_picture'><img itemprop='image' alt='Fear and Loathing in Las Vegas (1998) by Terry Gilliam' src='/images/2014/04/fear-and-loathing-adrenochrome.png' longdesc='#8efe9524'/><figcaption id='8efe9524'>Fear and Loathing in Las Vegas (1998) by Terry Gilliam</figcaption></figure><p>First, here&#39;s how they work in a nutshell. Let&#39;s use <a href="http://phrogz.net/programmingruby/tut_modules.html">Ruby modules</a> as a sample implementation. Say that we have a class <code>Book</code>:</p><figure class="highlight"><pre><code class="language-ruby" data-lang="ruby"><span></span><span class="k">class</span> <span class="nc">Book</span>
  <span class="k">def</span> <span class="nf">initialize</span><span class="p">(</span><span class="n">title</span><span class="p">)</span>
    <span class="vi">@title</span> <span class="o">=</span> <span class="n">title</span>
  <span class="k">end</span>
<span class="k">end</span></code></pre></figure><p>Now, we want class <code>Book</code> to use a static method (a procedure) that does something useful. We may either define it in a <a href="/2014/05/05/oop-alternative-to-utility-classes.html">utility class</a> and let <code>Book</code> call it:</p><figure class="highlight"><pre><code class="language-ruby" data-lang="ruby"><span></span><span class="k">class</span> <span class="nc">TextUtils</span>
  <span class="k">def</span> <span class="nc">self</span><span class="o">.</span><span class="nf">caps</span><span class="p">(</span><span class="n">text</span><span class="p">)</span>
    <span class="n">text</span><span class="o">.</span><span class="n">split</span><span class="o">.</span><span class="n">map</span><span class="p">(</span><span class="o">&amp;</span><span class="ss">:capitalize</span><span class="p">)</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="s1">&#39; &#39;</span><span class="p">)</span>
  <span class="k">end</span>
<span class="k">end</span>
<span class="k">class</span> <span class="nc">Book</span>
  <span class="k">def</span> <span class="nf">print</span>
    <span class="nb">puts</span> <span class="s2">&quot;My title is </span><span class="si">#{</span><span class="no">TextUtils</span><span class="o">.</span><span class="n">caps</span><span class="p">(</span><span class="vi">@title</span><span class="p">)</span><span class="si">}</span><span class="s2">&quot;</span>
  <span class="k">end</span>
<span class="k">end</span></code></pre></figure><p>Or we may make it even more &quot;convenient&quot; and <code>extend</code> our module in order to access its methods directly:</p><figure class="highlight"><pre><code class="language-ruby" data-lang="ruby"><span></span><span class="k">module</span> <span class="nn">TextModule</span>
  <span class="k">def</span> <span class="nf">caps</span><span class="p">(</span><span class="n">text</span><span class="p">)</span>
    <span class="n">text</span><span class="o">.</span><span class="n">split</span><span class="o">.</span><span class="n">map</span><span class="p">(</span><span class="o">&amp;</span><span class="ss">:capitalize</span><span class="p">)</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="s1">&#39; &#39;</span><span class="p">)</span>
  <span class="k">end</span>
<span class="k">end</span>
<span class="k">class</span> <span class="nc">Book</span>
  <span class="kp">extend</span> <span class="no">TextModule</span>
  <span class="k">def</span> <span class="nf">print</span>
    <span class="nb">puts</span> <span class="s2">&quot;My title is </span><span class="si">#{</span><span class="n">caps</span><span class="p">(</span><span class="vi">@title</span><span class="p">)</span><span class="si">}</span><span class="s2">&quot;</span>
  <span class="k">end</span>
<span class="k">end</span></code></pre></figure><p>It seems nice---if you don&#39;t understand the <a href="/2014/05/05/oop-alternative-to-utility-classes.html">difference</a> between <a href="/2016/08/15/what-is-wrong-object-oriented-programming.html">object-oriented programming</a> and static methods. Moreover, if we forget <a href="/2014/11/20/seven-virtues-of-good-object.html">OOP purity</a> for a minute, this approach actually looks less readable to me, even though it has fewer characters; it&#39;s difficult to understand where the method <code>caps()</code> is coming from when it&#39;s called just like <code>#{caps(@title)}</code> instead of <code>#{TextUtils.caps(@title)}</code>. Don&#39;t you think?</p><p>Mixins start to play their role better when we <code>include</code> them. We can combine them to construct the behavior of the class we&#39;re looking for. Let&#39;s create two mixins. The first one will be called <code>PlainMixin</code> and will print the title of the book the way it is, and the second one will be called <code>CapsMixin</code> and will capitalize what&#39;s already printed:</p><figure class="highlight"><pre><code class="language-ruby" data-lang="ruby"><span></span><span class="k">module</span> <span class="nn">CapsMixin</span>
  <span class="k">def</span> <span class="nf">to_s</span>
    <span class="k">super</span><span class="o">.</span><span class="n">to_s</span><span class="o">.</span><span class="n">split</span><span class="o">.</span><span class="n">map</span><span class="p">(</span><span class="o">&amp;</span><span class="ss">:capitalize</span><span class="p">)</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="s1">&#39; &#39;</span><span class="p">)</span>
  <span class="k">end</span>
<span class="k">end</span>
<span class="k">module</span> <span class="nn">PlainMixin</span>
  <span class="k">def</span> <span class="nf">to_s</span>
    <span class="vi">@title</span>
  <span class="k">end</span>
<span class="k">end</span>
<span class="k">class</span> <span class="nc">Book</span>
  <span class="k">def</span> <span class="nf">initialize</span><span class="p">(</span><span class="n">title</span><span class="p">)</span>
    <span class="vi">@title</span> <span class="o">=</span> <span class="n">title</span>
  <span class="k">end</span>
  <span class="kp">include</span> <span class="no">CapsMixin</span><span class="p">,</span> <span class="no">PlainMixin</span>
  <span class="k">def</span> <span class="nf">print</span>
    <span class="nb">puts</span> <span class="s2">&quot;My title is </span><span class="si">#{</span><span class="nb">self</span><span class="si">}</span><span class="s2">&quot;</span>
  <span class="k">end</span>
<span class="k">end</span></code></pre></figure><p>Calling <code>Book</code> without the included mixin will print its title the way it is. Once we add the <code>include</code> statement, the behavior of <code>to_s</code> is overridden and method <code>print</code> produces a different result. We can combine mixins to produce the required functionality. For example, we can add one more, which will <a href="http://stackoverflow.com/a/25136035/187141">abbreviate</a> the title to 16 characters:</p><figure class="highlight"><pre><code class="language-ruby" data-lang="ruby"><span></span><span class="k">module</span> <span class="nn">AbbrMixin</span>
  <span class="k">def</span> <span class="nf">to_s</span>
    <span class="k">super</span><span class="o">.</span><span class="n">to_s</span><span class="o">.</span><span class="n">gsub</span><span class="p">(</span><span class="sr">/^(.{16,}?).*$/m</span><span class="p">,</span><span class="s1">&#39;\1...&#39;</span><span class="p">)</span>
  <span class="k">end</span>
<span class="k">end</span>
<span class="k">class</span> <span class="nc">Book</span>
  <span class="k">def</span> <span class="nf">initialize</span><span class="p">(</span><span class="n">title</span><span class="p">)</span>
    <span class="vi">@title</span> <span class="o">=</span> <span class="n">title</span>
  <span class="k">end</span>
  <span class="kp">include</span> <span class="no">AbbrMixin</span><span class="p">,</span> <span class="no">CapsMixin</span><span class="p">,</span> <span class="no">PlainMixin</span>
  <span class="k">def</span> <span class="nf">print</span>
    <span class="nb">puts</span> <span class="s2">&quot;My title is </span><span class="si">#{</span><span class="nb">self</span><span class="si">}</span><span class="s2">&quot;</span>
  <span class="k">end</span>
<span class="k">end</span></code></pre></figure><p>I&#39;m sure you already understand that they both have access to the private attribute <code>@title</code> of class <code>Book</code>. They actually have full access to <em>everything</em> in the class. They literally are &quot;pieces of code&quot; that we <em>inject</em> into the class to make it more powerful and complex. What&#39;s wrong with this approach?</p><p>It&#39;s the same issue as with <a href="/2016/04/12/java-annotations-are-evil.html">annotations</a>, <a href="/2016/07/06/data-transfer-object.html">DTOs</a>, <a href="/2014/09/16/getters-and-setters-are-evil.html">getters</a>, and <a href="/2014/05/05/oop-alternative-to-utility-classes.html">utility classes</a>---they tear objects apart and place pieces of functionality in places where objects don&#39;t see them.</p><p>In the case of mixins, the functionality is in the Ruby <code>modules</code>, which make assumptions about the internal structure of <code>Book</code> and further assume that the programmer will still understand what&#39;s in <code>Book</code> after the internal structure changes. Such assumptions completely violate the very idea of <a href="/2016/11/21/naked-data.html">encapsulation</a>.</p><p>Such a tight coupling between mixins and object private structure leads to nothing but unmaintainable and difficult to understand code.</p><p>The very obvious alternatives to mixins are <a href="/2015/02/26/composable-decorators.html">composable decorators</a>. Take a look at the example given in the <a href="/2015/02/26/composable-decorators.html">article</a>:</p><figure class="highlight"><pre><code class="language-java" data-lang="java"><span></span><span class="n">Text</span> <span class="n">text</span> <span class="o">=</span> <span class="k">new</span> <span class="n">AllCapsText</span><span class="o">(</span>
  <span class="k">new</span> <span class="n">TrimmedText</span><span class="o">(</span>
    <span class="k">new</span> <span class="n">PrintableText</span><span class="o">(</span>
      <span class="k">new</span> <span class="n">TextInFile</span><span class="o">(</span><span class="k">new</span> <span class="n">File</span><span class="o">(</span><span class="s">&quot;/tmp/a.txt&quot;</span><span class="o">))</span>
    <span class="o">)</span>
  <span class="o">)</span>
<span class="o">);</span></code></pre></figure><p>Doesn&#39;t it look very similar to what we were doing above with Ruby mixins?</p><p>However, unlike mixins, decorators leave objects small and cohesive, layering extra functionality on top of them. Mixins do the opposite---they make objects more complex and, thanks to that, less readable and maintainable.</p><p>I honestly believe they are just poison. Whoever invented them was a long ways from understanding the philosophy of object-oriented design.</p></div></article></div><div class="wrapper"> <related-posts /></div><div class="disqus" role="complementary"><p class="disqus_hint"> Please, use <a href="https://help.disqus.com/commenting/what-html-tags-are-allowed-within-comments">syntax highlighting</a> in your comments, to make them more readable.</p><div id="disqus_thread" class="disqus-thread"> <a>&nbsp;</a></div><script> var disqus_config = function () { this.page.url = document.location.href.split('?')[0].split('#')[0].replace('https://', 'http://'); this.page.identifier = this.page.url; }; (function() { var d = document, s = d.createElement('script'); s.src = '//yegor256.disqus.com/embed.js'; s.setAttribute('data-timestamp', +new Date()); (d.head || d.body).appendChild(s); })(); </script> <noscript><div><p class="red"> JavaScript is disabled in your browser, that's why you can't see comments under this post.</p></div></noscript></div><div class="wrapper"> <footer class="footer"><p> &copy; <span itemscope="" itemprop="copyrightHolder" itemtype="http://schema.org/Person"> <span itemprop="name">Yegor Bugayenko</span> </span> 2014&ndash;<span itemprop="copyrightYear">2018</span></p></footer></div></section><div class="wrapper unprintable" style="text-align:center;margin-top:2em;"> <a href="http://www.sixnines.io/h/3ba1652f"> <img src="//www.sixnines.io/b/3ba1652f?style=flat" alt="sixnines availability badge"/> </a></div><script src="//code.jquery.com/jquery-1.9.0.min.js"></script> <script src="/js/all.js?4e047f6f42b"></script> <script>var disqus_shortname = 'yegor256';</script> <script id="dsq-count-scr" src="//yegor256.disqus.com/count.js" async="async"></script> <script> (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){ (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o), m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m) })(window,document,'script','//www.google-analytics.com/analytics.js','ga'); ga('create', 'UA-1963507-32', 'auto'); ga('send', 'pageview'); </script> <script> Cd=document;Cr="&"+Math.random();Cp="&s=1"; Cd.cookie="b=b";if(Cd.cookie)Cp+="&c=1"; Cp+="&t="+(new Date()).getTimezoneOffset(); if(self!=top)Cp+="&f=1"; </script> <script> if(navigator.javaEnabled())Cp+="&j=1"; </script> <script> if(typeof(screen)!='undefined')Cp+="&w="+screen.width+"&h="+ screen.height+"&d="+(screen.colorDepth?screen.colorDepth:screen.pixelDepth); </script> <script> Cd.write("<img src='//c.hit.ua/hit?i=95870&g=0&x=2"+Cp+Cr+ "&r="+escape(Cd.referrer)+"&u="+escape(window.location.href)+ "' border='0' wi"+"dth='1' he"+"ight='1'/>"); </script> <script type="application/ld+json"> { "@context": "http://schema.org", "@type": "Person", "name": "Yegor Bugayenko", "url": "http://www.yegor256.com", "sameAs": [ "https://www.facebook.com/yegor256", "https://instagram.com/yegor256", "https://www.linkedin.com/in/yegor256", "https://twitter.com/yegor256", "https://github.com/yegor256", "https://www.pinterest.com/yegor256/" ] } </script> </body> </html> <!DOCTYPE html> <html xmlns="http://www.w3.org/1999/xhtml" lang="en-US" xml:lang="en-US" itemscope="" itemtype="http://schema.org/WebSite"> <head> <meta charset="utf-8"/> <meta name="description" content="I often hear that having too many classes in an object-oriented design is a problem; let&apos;s investigate when this is likely to happen and how to handle it correctly. " /> <meta name="keywords" content="OOP classes, class names in OOP, many classes, naming classes in OOP, too many classes" /> <meta name="viewport" content="width=device-width,minimum-scale=1,initial-scale=1"/> <meta name="google-site-verification" content="JEj_gQr2CPe2QKGw8XdMz0R7VboQIUbX3FlM-lwTq-8" /> <meta name="author" content="Yegor Bugayenko"> <meta name="article:published_time" content="2017-02-28 00:00:00 +0000"> <meta name="og:site_name" content="Yegor Bugayenko"/> <meta name="og:type" content="article" /> <meta name="og:locale" content="en_US" /> <meta name="twitter:account_id" content="4503599630178231" /> <meta name="twitter:creator" content="@yegor256"/> <meta name="twitter:site" content="@yegor256"/> <meta name="twitter:title" property="og:title" content="How to Handle the Problem of Too Many Classes"/> <meta name="twitter:description" property="og:description" content="I often hear that having too many classes in an object-oriented design is a problem; let&apos;s investigate when this is likely to happen and how to handle it correctly. "/> <meta name="twitter:url" property="og:url" content="https://www.yegor256.com/2017/02/28/too-many-classes.html"/> <meta name="telegram:channel" content="AAAAAEJFMRzsRTRxM3ec6A"/> <link rel="search" type="application/opensearchdescription+xml" href="/opensearch.xml" title="yegor256" /> <link rel="shortcut icon" href="/favicon.ico?4e047f6f42b"/> <link rel="apple-touch-icon" href="/favicon.ico?4e047f6f42b"/> <link rel="alternate" type="application/rss+xml" title="RSS for yegor256.com" href="https://www.yegor256.com/rss.xml"/> <link rel="stylesheet" href="/css/layout.css?4e047f6f42b"/> <link rel="stylesheet" href="/css/icons.css?4e047f6f42b"/> <link rel="canonical" href="https://www.yegor256.com/2017/02/28/too-many-classes.html" /> <link rel="amphtml" href="https://www.yegor256.com/2017/02/28/too-many-classes.amp.html" /> <title>How to Handle the Problem of Too Many Classes </title> <meta name='og:image' content='https://www.yegor256.com/images/2017/02/el-dia-de-la-bestia.jpg'/><meta name='twitter:image' content='https://www.yegor256.com/images/2017/02/el-dia-de-la-bestia.jpg'/><meta name='og:image:width' content='1200'/> <meta name='twitter:image:width' content='1200'/><meta name='og:image:height' content='646'/> <meta name='twitter:image:height' content='646'/><meta name='twitter:card' content='summary_large_image'/><meta name='twitter:image:alt' content='El día de la bestia (1995) by Álex de la Iglesia'/> </head> <body><div class="wrapper"> <aside class="header-toggle unprintable" id="header-toggle" title="Show the menu" onclick="$('#header').show();$('#header-toggle').hide();">&#9776;</aside> <header class="header" id="header"><div class="face"> <a href="/about-me.html#form" class="sub" title="Click to subscribe to my monthly newsletter"><span>Subscribe</span></a> <a href="/about-me.html" style="position:relative;"> <img src="/images/face-256x256.jpg" class="photo" alt="Yegor Bugayenko"/> </a></div><nav><ul class="menu social notranslate"> <li><a href="https://twitter.com/intent/follow?screen_name=yegor256" rel="nofollow" title="Follow me on Twitter"><i class="icon icon-twitter notranslate" aria-hidden="true"></i></a></li> <li><a href="/rss.xml" rel="nofollow" title="Subscribe to my RSS feed"><i class="icon icon-rss notranslate" aria-hidden="true"></i></a></li> <li><a itemprop="sameAs" href="https://github.com/yegor256" rel="nofollow" title="My GitHub profile"><i class="icon icon-github notranslate" aria-hidden="true"></i></a></li> <li><a itemprop="sameAs" href="http://stackoverflow.com/users/187141/yegor256" rel="nofollow" title="My StackOverflow profile"><i class="icon icon-stackoverflow notranslate" aria-hidden="true"></i></a></li> <li><a itemprop="sameAs" href="https://www.facebook.com/yegor256" rel="nofollow" title="Follow me on Facebook"><i class="icon icon-facebook notranslate" aria-hidden="true"></i></a></li> <li><a itemprop="sameAs" href="https://instagram.com/yegor256" rel="nofollow" title="Follow me on Instagram"><i class="icon icon-instagram notranslate" aria-hidden="true"></i></a></li> <li><a itemprop="sameAs" href="https://www.linkedin.com/in/yegor256" rel="nofollow" title="My LinkedIn profile"><i class="icon icon-linkedin notranslate" aria-hidden="true"></i></a></li> <li><a itemprop="sameAs" href="https://www.youtube.com/c/yegor256?sub_confirmation=1" rel="nofollow" title="My Youtube video channel"><i class="icon icon-youtube notranslate" aria-hidden="true"></i></a></li> <li><a itemprop="sameAs" href="https://www.pinterest.com/yegor256/" rel="nofollow" title="My Pinterest boards"><i class="icon icon-pinterest notranslate" aria-hidden="true"></i></a></li> <li><a itemprop="sameAs" href="https://angel.co/yegor256" rel="nofollow" title="My AngelList profile"><i class="icon icon-angellist notranslate" aria-hidden="true"></i></a></li> <li><a href="https://soundcloud.com/yegor256" rel="nofollow" title="My podcast"><i class="icon icon-podcast notranslate" aria-hidden="true"></i></a></li> <li><a href="https://itunes.apple.com/us/podcast/yegor256-podcast/id1150826721" rel="nofollow" title="My iTunes podcast"><i class="icon icon-itunes notranslate" aria-hidden="true"></i></a></li> <li><a href="https://t.me/joinchat/AAAAAEJFMRzsRTRxM3ec6A" rel="nofollow" title="My Telegram public channel"><i class="icon icon-telegram notranslate" aria-hidden="true"></i></a></li> <li><a href="mailto:blog@yegor256.com" rel="nofollow" title="Email me any time"><i class="icon icon-mail notranslate" aria-hidden="true"></i></a></li></ul><ul class="menu"> <li><a href="/" title="Home page">Home</a></li> <li ><a href="/best.html" title="Best articles to read">12&#160;Best</a></li> <li ><a href="/contents.html" title="The contents of the entire blog">All&#160;288</a></li> <li ><a href="/webinars.html" title="My webinars">Webinars</a></li> <li ><a href="/talks.html" title="Future and past conference talks">Talks</a></li> <li ><a href="/books.html" title="The books I wrote">Books</a></li> <li ><a href="/papers.html" title="My academic papers and patents">Papers</a></li> <li ><a href="/pets.html" title="My loved pet projects">Pets</a></li> <li ><a href="/award.html" title="Software quality award">Award</a></li> <li ><a href="/testimonials.html" title="What some people say about me">Testimonials</a></li> <li ><a href="/shift-m.html" title="Audio podcast about project management">Shift-M</a></li> <li ><a href="/paintings.html" title="My paintings for sale">Paintings</a></li> <li><a href="http://ru.yegor256.com/" title="Немного на русском языке">По-русски</a></li></ul></nav><div class="search"> <form method="get" action="https://www.google.com/search" itemprop="potentialAction" itemscope="" itemtype="http://schema.org/SearchAction"> <meta itemprop="target" content="https://www.google.com/search?q={q}"/> <input name="sitesearch" value="yegor256.com" type="hidden"/> <input itemprop="query-input" type="text" id="search-query" class="field field-text" required="required" onfocus="$('.google').css('visibility', 'visible');" name="q" placeholder="Search..." autocomplete="off"/> <input type="image" src="/images/google-search-icon.svg" class="google" title="Search via Google" alt="Search via Google"/> </form></div><div class="hot"><ul> <li> <a href="/code-ahead.html">Code Ahead</a> was published on Amazon just a few days ago! It is my new book, a novel about programmers. It explains in details the majority of ideas that stand behind <a href="https://www.zerocracy.com">Zerocracy</a> and <a href="https://www.xdsd.org">XDSD</a>. </li> <li> At <a href="/webinars.html">Webinar #37</a> we will discuss naming problem in OOP, for objects, methods and attributes; join us on <b>September 12</b>, at 11am PST. </li></ul></div></header></div><section itemscope="" itemtype="http://schema.org/BlogPosting"><div class="wrapper"> <header><p class="printable"> <img src="https://api.qrserver.com/v1/create-qr-code/?data=https://www.yegor256.com/2017/02/28/too-many-classes.html&amp;format=svg" style="width:125px;height:125px;" alt="QR code"/></p><p class="printable"> <code itemprop="url">https://www.yegor256.com/2017/02/28/too-many-classes.html</code></p><h1 itemprop="name headline mainEntityOfPage">How to Handle the Problem of Too Many Classes</h1><ul class="subline"> <li> <time itemprop="datePublished" datetime="2017-02-28T00:00:00+00:00"> 28 February 2017 </time> </li> <li class="desktop-only" itemprop="locationCreated">Odessa, Ukraine</li> <li class="printable" itemscope="" itemprop="author" itemtype="http://schema.org/Person"> <span itemprop="name">Yegor Bugayenko</span> </li> <li class="unprintable"> <i class="icon icon-comments"></i> <a href="http://www.yegor256.com/2017/02/28/too-many-classes.html#disqus_thread" itemprop="discussionUrl">comments</a> </li></ul><figure class='jb_picture'><img itemprop='image' alt='El día de la bestia (1995) by Álex de la Iglesia' src='/images/2017/02/el-dia-de-la-bestia.jpg' longdesc='#746b98ae'/><figcaption id='746b98ae'>El día de la bestia (1995) by Álex de la Iglesia</figcaption></figure><p>There were a number of &quot;rules&quot; previously mentioned that, if applied, would obviously lead to a large number of classes, including: a) all public methods <a href="/2014/11/20/seven-virtues-of-good-object.html">must be</a> declared in interfaces; b) objects must not have more than four attributes (Section 2.1 of <a href="/elegant-objects.html">Elegant Objects</a>); c) static methods are <a href="/2014/05/05/oop-alternative-to-utility-classes.html">not allowed</a>; d) constructors <a href="/2015/05/07/ctors-must-be-code-free.html">must be</a> code-free; e) objects must expose fewer than five public methods (Section 3.1 of <a href="/elegant-objects.html">Elegant Objects</a>).</p><aside class='quote'>Types in OOP constitute your vocabulary, which explains the world around your code.</aside><p>The biggest concern, of course, is maintainability: &quot;If, instead of 50 longer classes, we had 300 shorter ones, then the code would be way less readable.&quot; This will most certainly happen if you design them wrong.</p><p>Types (or classes) in OOP constitute your <a href="https://en.wikipedia.org/wiki/Vocabulary"><em>vocabulary</em></a>, which explains the world around your code---the world your code lives in. The richer the vocabulary, the more powerful your code. The more types you have, the better you can understand and explain the world.</p><p>If your vocabulary is big enough, you will say something like:</p><blockquote><p>Read the book that is on the table.</p></blockquote><p>With a much smaller vocabulary, the same phrase would sound like:</p><blockquote><p>Do it with the thing that is on that thing.</p></blockquote><p>Obviously, it&#39;s easier to read and understand the first phrase. The same occurs with types in OOP: the more of them you have at your disposal, the more expressive, bright, and readable your code is.</p><p>Unfortunately, Java and many other languages are not designed with this concept in mind. Packages, modules, and namespaces don&#39;t really help, and we usually end up with names like <a href="https://docs.spring.io/spring/docs/current/javadoc-api/org/springframework/web/method/annotation/AbstractCookieValueMethodArgumentResolver.html"><code>AbstractCookieValueMethodArgumentResolver</code></a> (Spring) or <a href="https://hadoop.apache.org/docs/r3.0.0-alpha1/api/org/apache/hadoop/mapreduce/lib/input/CombineFileRecordReaderWrapper.html"><code>CombineFileRecordReaderWrapper</code></a> (Hadoop). We&#39;re trying to pack as many semantics into class names as possible so their users won&#39;t doubt for a second. Then we&#39;re trying to put as many methods into one class as possible to make life easier for users; they will use their IDE hints to find the right one.</p><p>This is anything but OOP.</p><p>If your code is object-oriented, your classes must be small, their names must be nouns, and their method names must be just one word. Here is what I do in my code to make that happen:</p><p><strong>Interfaces are nouns</strong>. For example, <a href="http://static.javadoc.io/org.takes/takes/1.1/org/takes/Request.html"><code>Request</code></a>, <a href="http://static.javadoc.io/com.jcabi.incubator/xembly/0.22/org/xembly/Directive.html"><code>Directive</code></a>, or <a href="https://github.com/yegor256/jare/blob/0.8.4/src/main/java/io/jare/model/Domain.java"><code>Domain</code></a>. There are no exceptions. Types (also known as <a href="https://docs.oracle.com/javase/tutorial/java/concepts/interface.html">interfaces</a> in Java) are the core part of my vocabulary; they have to be nouns.</p><p><strong>Classes are prefixed</strong>. My classes <a href="/2014/11/20/seven-virtues-of-good-object.html">always</a> implement interfaces. Thanks to that, I can say they always <em>are</em> requests, directives, or domains. And I always want their users to remember that. Prefixes help. For example, <a href="http://static.javadoc.io/org.takes/takes/1.1/org/takes/rq/RqBuffered.html"><code>RqBuffered</code></a> is a buffered request, <a href="http://static.javadoc.io/org.takes/takes/1.1/org/takes/rq/RqSimple.html"><code>RqSimple</code></a> is a simple request, <a href="http://static.javadoc.io/org.takes/takes/1.1/org/takes/rq/RqLive.html"><code>RqLive</code></a> is a request that represents a &quot;live&quot; HTTP connection, and <a href="http://static.javadoc.io/org.takes/takes/1.1/org/takes/rq/RqWithHeader.html"><code>RqWithHeader</code></a> is a request with an extra header.</p><p>An alternative approach is to use the type name as the central part of the class name and add a prefix that explains implementation details. For example, <a href="https://github.com/yegor256/jare/blob/0.8.4/src/main/java/io/jare/dynamo/DyDomain.java"><code>DyDomain</code></a> is a domain that persists its data in DynamoDB. Once you know what that <code>Dy</code> prefix is for, you can easily understand what <a href="https://github.com/yegor256/jare/blob/0.8.4/src/main/java/io/jare/dynamo/DyUser.java"><code>DyUser</code></a> and <a href="https://github.com/yegor256/jare/blob/0.8.4/src/main/java/io/jare/dynamo/DyBase.java"><code>DyBase</code></a> are about.</p><p>In a medium-sized application or a library, there will be as many as 10 to 15 prefixes you will have to remember, no more. For example, in the <a href="http://www.takes.org">Takes Framework</a>, there are 24,000 lines of code, 410 Java files, and 10 prefixes: <code>Bc</code>, <code>Cc</code>, <code>Tk</code>, <code>Rq</code>, <code>Rs</code>, <code>Fb</code>, <code>Fk</code>, <code>Hm</code>, <code>Ps</code>, and <code>Xe</code>. Not so difficult to remember what they mean, right?</p><p>Among all <a href="http://static.javadoc.io/org.takes/takes/1.1/allclasses-frame.html">240 classes</a>, the longest name is <a href="http://static.javadoc.io/org.takes/takes/1.1/org/takes/rq/RqWithDefaultHeader.html"><code>RqWithDefaultHeader</code></a>.</p><p>I find this approach to class naming rather convenient. I used it in these open source projects (in GitHub): <a href="https://github.com/yegor256/takes">yegor256/takes</a> (10 prefixes), <a href="https://github.com/yegor256/jare">yegor256/jare</a> (5 prefixes), <a href="https://github.com/yegor256/rultor">yegor256/rultor</a> (6 prefixes), and <a href="https://github.com/yegor256/wring">yegor256/wring</a> (5 prefixes).</p></p>--> <nav class="buttons notranslate desktop-only"> <a href="http://www.facebook.com/sharer/sharer.php?u=https://www.yegor256.com/2017/02/28/too-many-classes.html" title="Share on Facebook" class="button" rel="nofollow"> <span class="count count-facebook">0</span> <i class="icon icon-facebook notranslate" aria-hidden="true"></i> </a> <a href="https://twitter.com/share?url=https://www.yegor256.com/2017/02/28/too-many-classes.html&amp;text=How+to+Handle+the+Problem+of+Too+Many+Classes" title="Share on Twitter" class="button" rel="nofollow"> <span class="count count-twitter">0</span> <i class="icon icon-twitter notranslate" aria-hidden="true"></i> </a> <a href="https://plus.google.com/share?url=https://www.yegor256.com/2017/02/28/too-many-classes.html" title="Share on Google+" class="button" rel="nofollow"> <span class="count count-googleplus">0</span> <i class="icon icon-googleplus notranslate" aria-hidden="true"></i> </a> <a href="https://www.linkedin.com/cws/share?url=https://www.yegor256.com/2017/02/28/too-many-classes.html" title="Share on LinkedIn" class="button" rel="nofollow"> <span class="count count-linkedin">0</span> <i class="icon icon-linkedin notranslate" aria-hidden="true"></i> </a> <a href="http://reddit.com/submit?url=https://www.yegor256.com/2017/02/28/too-many-classes.html%3F2017-09&amp;title=How+to+Handle+the+Problem+of+Too+Many+Classes" title="Share on Reddit" class="button" rel="nofollow"> <span class="count count-reddit">0</span> <i class="icon icon-reddit notranslate" aria-hidden="true"></i> </a> <a href="http://news.ycombinator.com/submitlink?u=https://www.yegor256.com/2017/02/28/too-many-classes.html%3F2017-09&amp;t=How+to+Handle+the+Problem+of+Too+Many+Classes" title="Share on Hacker News" class="button" rel="nofollow"> <span class="count count-hackernews">0</span> <i class="icon icon-hackernews notranslate" aria-hidden="true"></i> </a> </nav> </header> <article class="main" itemprop="articleBody"><div ><p>During nearly <a href="/talks.html">every presentation</a> in which I explain <a href="/2016/07/14/who-is-object.html">my view</a> of <a href="/2016/08/15/what-is-wrong-object-oriented-programming.html">object-oriented programming</a>, there is someone who shares a comment like this: &quot;If we follow your advice, we will have so many small classes.&quot; And my answer is always the same: &quot;Of course we will, and that&#39;s great!&quot; I honestly believe that even if you can&#39;t consider having &quot;a lot of classes&quot; a virtue, you can&#39;t call it a drawback of any truly object-oriented code either. However, there may come a point when classes become a problem; let&#39;s see when, how, and what to do about that.</p><figure class='jb_picture'><img itemprop='image' alt='El día de la bestia (1995) by Álex de la Iglesia' src='/images/2017/02/el-dia-de-la-bestia.jpg' longdesc='#746b98ae'/><figcaption id='746b98ae'>El día de la bestia (1995) by Álex de la Iglesia</figcaption></figure><p>There were a number of &quot;rules&quot; previously mentioned that, if applied, would obviously lead to a large number of classes, including: a) all public methods <a href="/2014/11/20/seven-virtues-of-good-object.html">must be</a> declared in interfaces; b) objects must not have more than four attributes (Section 2.1 of <a href="/elegant-objects.html">Elegant Objects</a>); c) static methods are <a href="/2014/05/05/oop-alternative-to-utility-classes.html">not allowed</a>; d) constructors <a href="/2015/05/07/ctors-must-be-code-free.html">must be</a> code-free; e) objects must expose fewer than five public methods (Section 3.1 of <a href="/elegant-objects.html">Elegant Objects</a>).</p><aside class='quote'>Types in OOP constitute your vocabulary, which explains the world around your code.</aside><p>The biggest concern, of course, is maintainability: &quot;If, instead of 50 longer classes, we had 300 shorter ones, then the code would be way less readable.&quot; This will most certainly happen if you design them wrong.</p><p>Types (or classes) in OOP constitute your <a href="https://en.wikipedia.org/wiki/Vocabulary"><em>vocabulary</em></a>, which explains the world around your code---the world your code lives in. The richer the vocabulary, the more powerful your code. The more types you have, the better you can understand and explain the world.</p><p>If your vocabulary is big enough, you will say something like:</p><blockquote><p>Read the book that is on the table.</p></blockquote><p>With a much smaller vocabulary, the same phrase would sound like:</p><blockquote><p>Do it with the thing that is on that thing.</p></blockquote><p>Obviously, it&#39;s easier to read and understand the first phrase. The same occurs with types in OOP: the more of them you have at your disposal, the more expressive, bright, and readable your code is.</p><p>Unfortunately, Java and many other languages are not designed with this concept in mind. Packages, modules, and namespaces don&#39;t really help, and we usually end up with names like <a href="https://docs.spring.io/spring/docs/current/javadoc-api/org/springframework/web/method/annotation/AbstractCookieValueMethodArgumentResolver.html"><code>AbstractCookieValueMethodArgumentResolver</code></a> (Spring) or <a href="https://hadoop.apache.org/docs/r3.0.0-alpha1/api/org/apache/hadoop/mapreduce/lib/input/CombineFileRecordReaderWrapper.html"><code>CombineFileRecordReaderWrapper</code></a> (Hadoop). We&#39;re trying to pack as many semantics into class names as possible so their users won&#39;t doubt for a second. Then we&#39;re trying to put as many methods into one class as possible to make life easier for users; they will use their IDE hints to find the right one.</p><p>This is anything but OOP.</p><p>If your code is object-oriented, your classes must be small, their names must be nouns, and their method names must be just one word. Here is what I do in my code to make that happen:</p><p><strong>Interfaces are nouns</strong>. For example, <a href="http://static.javadoc.io/org.takes/takes/1.1/org/takes/Request.html"><code>Request</code></a>, <a href="http://static.javadoc.io/com.jcabi.incubator/xembly/0.22/org/xembly/Directive.html"><code>Directive</code></a>, or <a href="https://github.com/yegor256/jare/blob/0.8.4/src/main/java/io/jare/model/Domain.java"><code>Domain</code></a>. There are no exceptions. Types (also known as <a href="https://docs.oracle.com/javase/tutorial/java/concepts/interface.html">interfaces</a> in Java) are the core part of my vocabulary; they have to be nouns.</p><p><strong>Classes are prefixed</strong>. My classes <a href="/2014/11/20/seven-virtues-of-good-object.html">always</a> implement interfaces. Thanks to that, I can say they always <em>are</em> requests, directives, or domains. And I always want their users to remember that. Prefixes help. For example, <a href="http://static.javadoc.io/org.takes/takes/1.1/org/takes/rq/RqBuffered.html"><code>RqBuffered</code></a> is a buffered request, <a href="http://static.javadoc.io/org.takes/takes/1.1/org/takes/rq/RqSimple.html"><code>RqSimple</code></a> is a simple request, <a href="http://static.javadoc.io/org.takes/takes/1.1/org/takes/rq/RqLive.html"><code>RqLive</code></a> is a request that represents a &quot;live&quot; HTTP connection, and <a href="http://static.javadoc.io/org.takes/takes/1.1/org/takes/rq/RqWithHeader.html"><code>RqWithHeader</code></a> is a request with an extra header.</p><p>An alternative approach is to use the type name as the central part of the class name and add a prefix that explains implementation details. For example, <a href="https://github.com/yegor256/jare/blob/0.8.4/src/main/java/io/jare/dynamo/DyDomain.java"><code>DyDomain</code></a> is a domain that persists its data in DynamoDB. Once you know what that <code>Dy</code> prefix is for, you can easily understand what <a href="https://github.com/yegor256/jare/blob/0.8.4/src/main/java/io/jare/dynamo/DyUser.java"><code>DyUser</code></a> and <a href="https://github.com/yegor256/jare/blob/0.8.4/src/main/java/io/jare/dynamo/DyBase.java"><code>DyBase</code></a> are about.</p><p>In a medium-sized application or a library, there will be as many as 10 to 15 prefixes you will have to remember, no more. For example, in the <a href="http://www.takes.org">Takes Framework</a>, there are 24,000 lines of code, 410 Java files, and 10 prefixes: <code>Bc</code>, <code>Cc</code>, <code>Tk</code>, <code>Rq</code>, <code>Rs</code>, <code>Fb</code>, <code>Fk</code>, <code>Hm</code>, <code>Ps</code>, and <code>Xe</code>. Not so difficult to remember what they mean, right?</p><p>Among all <a href="http://static.javadoc.io/org.takes/takes/1.1/allclasses-frame.html">240 classes</a>, the longest name is <a href="http://static.javadoc.io/org.takes/takes/1.1/org/takes/rq/RqWithDefaultHeader.html"><code>RqWithDefaultHeader</code></a>.</p><p>I find this approach to class naming rather convenient. I used it in these open source projects (in GitHub): <a href="https://github.com/yegor256/takes">yegor256/takes</a> (10 prefixes), <a href="https://github.com/yegor256/jare">yegor256/jare</a> (5 prefixes), <a href="https://github.com/yegor256/rultor">yegor256/rultor</a> (6 prefixes), and <a href="https://github.com/yegor256/wring">yegor256/wring</a> (5 prefixes).</p></div></article></div><div class="wrapper"> <related-posts /></div><div class="disqus" role="complementary"><p class="disqus_hint"> Please, use <a href="https://help.disqus.com/commenting/what-html-tags-are-allowed-within-comments">syntax highlighting</a> in your comments, to make them more readable.</p><div id="disqus_thread" class="disqus-thread"> <a>&nbsp;</a></div><script> var disqus_config = function () { this.page.url = document.location.href.split('?')[0].split('#')[0].replace('https://', 'http://'); this.page.identifier = this.page.url; }; (function() { var d = document, s = d.createElement('script'); s.src = '//yegor256.disqus.com/embed.js'; s.setAttribute('data-timestamp', +new Date()); (d.head || d.body).appendChild(s); })(); </script> <noscript><div><p class="red"> JavaScript is disabled in your browser, that's why you can't see comments under this post.</p></div></noscript></div><div class="wrapper"> <footer class="footer"><p> &copy; <span itemscope="" itemprop="copyrightHolder" itemtype="http://schema.org/Person"> <span itemprop="name">Yegor Bugayenko</span> </span> 2014&ndash;<span itemprop="copyrightYear">2018</span></p></footer></div></section><div class="wrapper unprintable" style="text-align:center;margin-top:2em;"> <a href="http://www.sixnines.io/h/3ba1652f"> <img src="//www.sixnines.io/b/3ba1652f?style=flat" alt="sixnines availability badge"/> </a></div><script src="//code.jquery.com/jquery-1.9.0.min.js"></script> <script src="/js/all.js?4e047f6f42b"></script> <script>var disqus_shortname = 'yegor256';</script> <script id="dsq-count-scr" src="//yegor256.disqus.com/count.js" async="async"></script> <script> (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){ (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o), m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m) })(window,document,'script','//www.google-analytics.com/analytics.js','ga'); ga('create', 'UA-1963507-32', 'auto'); ga('send', 'pageview'); </script> <script> Cd=document;Cr="&"+Math.random();Cp="&s=1"; Cd.cookie="b=b";if(Cd.cookie)Cp+="&c=1"; Cp+="&t="+(new Date()).getTimezoneOffset(); if(self!=top)Cp+="&f=1"; </script> <script> if(navigator.javaEnabled())Cp+="&j=1"; </script> <script> if(typeof(screen)!='undefined')Cp+="&w="+screen.width+"&h="+ screen.height+"&d="+(screen.colorDepth?screen.colorDepth:screen.pixelDepth); </script> <script> Cd.write("<img src='//c.hit.ua/hit?i=95870&g=0&x=2"+Cp+Cr+ "&r="+escape(Cd.referrer)+"&u="+escape(window.location.href)+ "' border='0' wi"+"dth='1' he"+"ight='1'/>"); </script> <script type="application/ld+json"> { "@context": "http://schema.org", "@type": "Person", "name": "Yegor Bugayenko", "url": "http://www.yegor256.com", "sameAs": [ "https://www.facebook.com/yegor256", "https://instagram.com/yegor256", "https://www.linkedin.com/in/yegor256", "https://twitter.com/yegor256", "https://github.com/yegor256", "https://www.pinterest.com/yegor256/" ] } </script> </body> </html> <!DOCTYPE html> <html xmlns="http://www.w3.org/1999/xhtml" lang="en-US" xml:lang="en-US" itemscope="" itemtype="http://schema.org/WebSite"> <head> <meta charset="utf-8"/> <meta name="description" content="Private static methods are perfect instruments to avoid code duplication inside a class, but they introduce duplication between classes and are not testable. " /> <meta name="keywords" content="java private method, private method, private static, private static method, static method" /> <meta name="viewport" content="width=device-width,minimum-scale=1,initial-scale=1"/> <meta name="google-site-verification" content="JEj_gQr2CPe2QKGw8XdMz0R7VboQIUbX3FlM-lwTq-8" /> <meta name="author" content="Yegor Bugayenko"> <meta name="article:published_time" content="2017-02-07 00:00:00 +0000"> <meta name="og:site_name" content="Yegor Bugayenko"/> <meta name="og:type" content="article" /> <meta name="og:locale" content="en_US" /> <meta name="twitter:account_id" content="4503599630178231" /> <meta name="twitter:creator" content="@yegor256"/> <meta name="twitter:site" content="@yegor256"/> <meta name="twitter:title" property="og:title" content="Each Private Static Method Is a Candidate for a New Class"/> <meta name="twitter:description" property="og:description" content="Private static methods are perfect instruments to avoid code duplication inside a class, but they introduce duplication between classes and are not testable. "/> <meta name="twitter:url" property="og:url" content="https://www.yegor256.com/2017/02/07/private-method-is-new-class.html"/> <meta name="telegram:channel" content="AAAAAEJFMRzsRTRxM3ec6A"/> <link rel="search" type="application/opensearchdescription+xml" href="/opensearch.xml" title="yegor256" /> <link rel="shortcut icon" href="/favicon.ico?4e047f6f42b"/> <link rel="apple-touch-icon" href="/favicon.ico?4e047f6f42b"/> <link rel="alternate" type="application/rss+xml" title="RSS for yegor256.com" href="https://www.yegor256.com/rss.xml"/> <link rel="stylesheet" href="/css/layout.css?4e047f6f42b"/> <link rel="stylesheet" href="/css/icons.css?4e047f6f42b"/> <link rel="canonical" href="https://www.yegor256.com/2017/02/07/private-method-is-new-class.html" /> <link rel="amphtml" href="https://www.yegor256.com/2017/02/07/private-method-is-new-class.amp.html" /> <title>Each Private Static Method Is a Candidate for a New Class </title> <meta name='og:image' content='https://www.yegor256.com/images/2017/02/the-master.jpg'/><meta name='twitter:image' content='https://www.yegor256.com/images/2017/02/the-master.jpg'/><meta name='og:image:width' content='1200'/> <meta name='twitter:image:width' content='1200'/><meta name='og:image:height' content='675'/> <meta name='twitter:image:height' content='675'/><meta name='twitter:card' content='summary_large_image'/><meta name='twitter:image:alt' content='The Master (2012) by Paul Thomas Anderson'/> </head> <body><div class="wrapper"> <aside class="header-toggle unprintable" id="header-toggle" title="Show the menu" onclick="$('#header').show();$('#header-toggle').hide();">&#9776;</aside> <header class="header" id="header"><div class="face"> <a href="/about-me.html#form" class="sub" title="Click to subscribe to my monthly newsletter"><span>Subscribe</span></a> <a href="/about-me.html" style="position:relative;"> <img src="/images/face-256x256.jpg" class="photo" alt="Yegor Bugayenko"/> </a></div><nav><ul class="menu social notranslate"> <li><a href="https://twitter.com/intent/follow?screen_name=yegor256" rel="nofollow" title="Follow me on Twitter"><i class="icon icon-twitter notranslate" aria-hidden="true"></i></a></li> <li><a href="/rss.xml" rel="nofollow" title="Subscribe to my RSS feed"><i class="icon icon-rss notranslate" aria-hidden="true"></i></a></li> <li><a itemprop="sameAs" href="https://github.com/yegor256" rel="nofollow" title="My GitHub profile"><i class="icon icon-github notranslate" aria-hidden="true"></i></a></li> <li><a itemprop="sameAs" href="http://stackoverflow.com/users/187141/yegor256" rel="nofollow" title="My StackOverflow profile"><i class="icon icon-stackoverflow notranslate" aria-hidden="true"></i></a></li> <li><a itemprop="sameAs" href="https://www.facebook.com/yegor256" rel="nofollow" title="Follow me on Facebook"><i class="icon icon-facebook notranslate" aria-hidden="true"></i></a></li> <li><a itemprop="sameAs" href="https://instagram.com/yegor256" rel="nofollow" title="Follow me on Instagram"><i class="icon icon-instagram notranslate" aria-hidden="true"></i></a></li> <li><a itemprop="sameAs" href="https://www.linkedin.com/in/yegor256" rel="nofollow" title="My LinkedIn profile"><i class="icon icon-linkedin notranslate" aria-hidden="true"></i></a></li> <li><a itemprop="sameAs" href="https://www.youtube.com/c/yegor256?sub_confirmation=1" rel="nofollow" title="My Youtube video channel"><i class="icon icon-youtube notranslate" aria-hidden="true"></i></a></li> <li><a itemprop="sameAs" href="https://www.pinterest.com/yegor256/" rel="nofollow" title="My Pinterest boards"><i class="icon icon-pinterest notranslate" aria-hidden="true"></i></a></li> <li><a itemprop="sameAs" href="https://angel.co/yegor256" rel="nofollow" title="My AngelList profile"><i class="icon icon-angellist notranslate" aria-hidden="true"></i></a></li> <li><a href="https://soundcloud.com/yegor256" rel="nofollow" title="My podcast"><i class="icon icon-podcast notranslate" aria-hidden="true"></i></a></li> <li><a href="https://itunes.apple.com/us/podcast/yegor256-podcast/id1150826721" rel="nofollow" title="My iTunes podcast"><i class="icon icon-itunes notranslate" aria-hidden="true"></i></a></li> <li><a href="https://t.me/joinchat/AAAAAEJFMRzsRTRxM3ec6A" rel="nofollow" title="My Telegram public channel"><i class="icon icon-telegram notranslate" aria-hidden="true"></i></a></li> <li><a href="mailto:blog@yegor256.com" rel="nofollow" title="Email me any time"><i class="icon icon-mail notranslate" aria-hidden="true"></i></a></li></ul><ul class="menu"> <li><a href="/" title="Home page">Home</a></li> <li ><a href="/best.html" title="Best articles to read">12&#160;Best</a></li> <li ><a href="/contents.html" title="The contents of the entire blog">All&#160;288</a></li> <li ><a href="/webinars.html" title="My webinars">Webinars</a></li> <li ><a href="/talks.html" title="Future and past conference talks">Talks</a></li> <li ><a href="/books.html" title="The books I wrote">Books</a></li> <li ><a href="/papers.html" title="My academic papers and patents">Papers</a></li> <li ><a href="/pets.html" title="My loved pet projects">Pets</a></li> <li ><a href="/award.html" title="Software quality award">Award</a></li> <li ><a href="/testimonials.html" title="What some people say about me">Testimonials</a></li> <li ><a href="/shift-m.html" title="Audio podcast about project management">Shift-M</a></li> <li ><a href="/paintings.html" title="My paintings for sale">Paintings</a></li> <li><a href="http://ru.yegor256.com/" title="Немного на русском языке">По-русски</a></li></ul></nav><div class="search"> <form method="get" action="https://www.google.com/search" itemprop="potentialAction" itemscope="" itemtype="http://schema.org/SearchAction"> <meta itemprop="target" content="https://www.google.com/search?q={q}"/> <input name="sitesearch" value="yegor256.com" type="hidden"/> <input itemprop="query-input" type="text" id="search-query" class="field field-text" required="required" onfocus="$('.google').css('visibility', 'visible');" name="q" placeholder="Search..." autocomplete="off"/> <input type="image" src="/images/google-search-icon.svg" class="google" title="Search via Google" alt="Search via Google"/> </form></div><div class="hot"><ul> <li> <a href="/code-ahead.html">Code Ahead</a> was published on Amazon just a few days ago! It is my new book, a novel about programmers. It explains in details the majority of ideas that stand behind <a href="https://www.zerocracy.com">Zerocracy</a> and <a href="https://www.xdsd.org">XDSD</a>. </li> <li> At <a href="/webinars.html">Webinar #37</a> we will discuss naming problem in OOP, for objects, methods and attributes; join us on <b>September 12</b>, at 11am PST. </li></ul></div></header></div><section itemscope="" itemtype="http://schema.org/BlogPosting"><div class="wrapper"> <header><p class="printable"> <img src="https://api.qrserver.com/v1/create-qr-code/?data=https://www.yegor256.com/2017/02/07/private-method-is-new-class.html&amp;format=svg" style="width:125px;height:125px;" alt="QR code"/></p><p class="printable"> <code itemprop="url">https://www.yegor256.com/2017/02/07/private-method-is-new-class.html</code></p><h1 itemprop="name headline mainEntityOfPage">Each Private Static Method Is a Candidate for a New Class</h1><ul class="subline"> <li> <time itemprop="datePublished" datetime="2017-02-07T00:00:00+00:00"> 7 February 2017 </time> </li> <li class="desktop-only" itemprop="locationCreated">Kharkiv, Ukraine</li> <li class="printable" itemscope="" itemprop="author" itemtype="http://schema.org/Person"> <span itemprop="name">Yegor Bugayenko</span> </li> <li class="unprintable"> <i class="icon icon-comments"></i> <a href="http://www.yegor256.com/2017/02/07/private-method-is-new-class.html#disqus_thread" itemprop="discussionUrl">comments</a> </li></ul><figure class='jb_picture'><img itemprop='image' alt='The Master (2012) by Paul Thomas Anderson' src='/images/2017/02/the-master.jpg' longdesc='#b894db33'/><figcaption id='b894db33'>The Master (2012) by Paul Thomas Anderson</figcaption></figure><p>Here is an example of a simple class:</p><figure class="highlight"><pre><code class="language-java" data-lang="java"><span></span><span class="kd">class</span> <span class="nc">Token</span> <span class="o">{</span>
  <span class="kd">private</span> <span class="n">String</span> <span class="n">key</span><span class="o">;</span>
  <span class="kd">private</span> <span class="n">String</span> <span class="n">secret</span><span class="o">;</span>
  <span class="n">String</span> <span class="nf">encoded</span><span class="o">()</span> <span class="o">{</span>
    <span class="k">return</span> <span class="s">&quot;key=&quot;</span>
      <span class="o">+</span> <span class="n">URLEncoder</span><span class="o">.</span><span class="na">encode</span><span class="o">(</span><span class="n">key</span><span class="o">,</span> <span class="s">&quot;UTF-8&quot;</span><span class="o">)</span>
      <span class="o">+</span> <span class="s">&quot;&amp;secret=&quot;</span>
      <span class="o">+</span> <span class="n">URLEncoder</span><span class="o">.</span><span class="na">encode</span><span class="o">(</span><span class="n">secret</span><span class="o">,</span> <span class="s">&quot;UTF-8&quot;</span><span class="o">);</span>
  <span class="o">}</span>
<span class="o">}</span></code></pre></figure><p>There is an obvious code duplication, right? The easiest way to resolve it is to introduce a private static method:</p><figure class="highlight"><pre><code class="language-java" data-lang="java"><span></span><span class="kd">class</span> <span class="nc">Token</span> <span class="o">{</span>
  <span class="kd">private</span> <span class="n">String</span> <span class="n">key</span><span class="o">;</span>
  <span class="kd">private</span> <span class="n">String</span> <span class="n">secret</span><span class="o">;</span>
  <span class="n">String</span> <span class="nf">encoded</span><span class="o">()</span> <span class="o">{</span>
    <span class="k">return</span> <span class="s">&quot;key=&quot;</span>
      <span class="o">+</span> <span class="n">Token</span><span class="o">.</span><span class="na">encoded</span><span class="o">(</span><span class="n">key</span><span class="o">)</span>
      <span class="o">+</span> <span class="s">&quot;&amp;secret=&quot;</span>
      <span class="o">+</span> <span class="n">Token</span><span class="o">.</span><span class="na">encoded</span><span class="o">(</span><span class="n">secret</span><span class="o">);</span>
  <span class="o">}</span>
  <span class="kd">private</span> <span class="kd">static</span> <span class="n">String</span> <span class="nf">encoded</span><span class="o">(</span><span class="n">String</span> <span class="n">text</span><span class="o">)</span> <span class="o">{</span>
    <span class="k">return</span> <span class="n">URLEncoder</span><span class="o">.</span><span class="na">encode</span><span class="o">(</span><span class="n">text</span><span class="o">,</span> <span class="s">&quot;UTF-8&quot;</span><span class="o">);</span>
  <span class="o">}</span>
<span class="o">}</span></code></pre></figure><p>Looks much better now. But what will happen if we have another class that needs the exact same functionality? We will have to copy and paste this private static method <code>encoded()</code> into it, right?</p><p>A better alternative would be to introduce a new class <code>Encoded</code> that implements the functionality we want to share:</p><figure class="highlight"><pre><code class="language-java" data-lang="java"><span></span><span class="kd">class</span> <span class="nc">Encoded</span> <span class="o">{</span>
  <span class="kd">private</span> <span class="kd">final</span> <span class="n">String</span> <span class="n">raw</span><span class="o">;</span>
  <span class="nd">@Override</span>
  <span class="kd">public</span> <span class="n">String</span> <span class="nf">toString</span><span class="o">()</span> <span class="o">{</span>
    <span class="k">return</span> <span class="n">URLEncoder</span><span class="o">.</span><span class="na">encode</span><span class="o">(</span><span class="k">this</span><span class="o">.</span><span class="na">raw</span><span class="o">,</span> <span class="s">&quot;UTF-8&quot;</span><span class="o">);</span>
  <span class="o">}</span>
<span class="o">}</span></code></pre></figure><p>And then:</p><figure class="highlight"><pre><code class="language-java" data-lang="java"><span></span><span class="kd">class</span> <span class="nc">Token</span> <span class="o">{</span>
  <span class="kd">private</span> <span class="n">String</span> <span class="n">key</span><span class="o">;</span>
  <span class="kd">private</span> <span class="n">String</span> <span class="n">secret</span><span class="o">;</span>
  <span class="n">String</span> <span class="nf">encoded</span><span class="o">()</span> <span class="o">{</span>
    <span class="k">return</span> <span class="s">&quot;key=&quot;</span>
      <span class="o">+</span> <span class="k">new</span> <span class="n">Encoded</span><span class="o">(</span><span class="n">key</span><span class="o">)</span>
      <span class="o">+</span> <span class="s">&quot;&amp;secret=&quot;</span>
      <span class="o">+</span> <span class="k">new</span> <span class="n">Encoded</span><span class="o">(</span><span class="n">secret</span><span class="o">);</span>
  <span class="o">}</span>
<span class="o">}</span></code></pre></figure><p>Now this functionality is 1) reusable, and 2) testable. We can easily use this class <code>Encoded</code> in many other places, and we can create a unit test for it. We were not able to do that with the private static method before.</p><p>See the point? The rule of thumb I&#39;ve already figured for myself is that <em>each</em> private static method is a perfect candidate for a new class. That&#39;s why we don&#39;t have them at all in <a href="http://www.eolang.org">EO</a>.</p><p>By the way, <em>public</em> static methods are a different story. They are also evil, but for <a href="/2014/05/05/oop-alternative-to-utility-classes.html">different reasons</a>.</p><p>P.S. Now I think that the reasons in this article are applicable to <em>all</em> private methods, not only static ones.</p></p>--> <nav class="buttons notranslate desktop-only"> <a href="http://www.facebook.com/sharer/sharer.php?u=https://www.yegor256.com/2017/02/07/private-method-is-new-class.html" title="Share on Facebook" class="button" rel="nofollow"> <span class="count count-facebook">0</span> <i class="icon icon-facebook notranslate" aria-hidden="true"></i> </a> <a href="https://twitter.com/share?url=https://www.yegor256.com/2017/02/07/private-method-is-new-class.html&amp;text=Each+Private+Static+Method+Is+a+Candidate+for+a+New+Class" title="Share on Twitter" class="button" rel="nofollow"> <span class="count count-twitter">0</span> <i class="icon icon-twitter notranslate" aria-hidden="true"></i> </a> <a href="https://plus.google.com/share?url=https://www.yegor256.com/2017/02/07/private-method-is-new-class.html" title="Share on Google+" class="button" rel="nofollow"> <span class="count count-googleplus">0</span> <i class="icon icon-googleplus notranslate" aria-hidden="true"></i> </a> <a href="https://www.linkedin.com/cws/share?url=https://www.yegor256.com/2017/02/07/private-method-is-new-class.html" title="Share on LinkedIn" class="button" rel="nofollow"> <span class="count count-linkedin">0</span> <i class="icon icon-linkedin notranslate" aria-hidden="true"></i> </a> <a href="http://reddit.com/submit?url=https://www.yegor256.com/2017/02/07/private-method-is-new-class.html%3F2017-06&amp;title=Each+Private+Static+Method+Is+a+Candidate+for+a+New+Class" title="Share on Reddit" class="button" rel="nofollow"> <span class="count count-reddit">0</span> <i class="icon icon-reddit notranslate" aria-hidden="true"></i> </a> <a href="http://news.ycombinator.com/submitlink?u=https://www.yegor256.com/2017/02/07/private-method-is-new-class.html%3F2017-06&amp;t=Each+Private+Static+Method+Is+a+Candidate+for+a+New+Class" title="Share on Hacker News" class="button" rel="nofollow"> <span class="count count-hackernews">0</span> <i class="icon icon-hackernews notranslate" aria-hidden="true"></i> </a> </nav> </header> <article class="main" itemprop="articleBody"><div ><p>Do you have private static methods that help you break your algorithms down into smaller parts? I do. Every time I write a new method, I realize that it can be a new class instead. Of course, I don&#39;t make classes out of all of them, but that has to be the goal. Private static methods are not reusable, while classes are---that is the main difference between them, and it is crucial.</p><figure class='jb_picture'><img itemprop='image' alt='The Master (2012) by Paul Thomas Anderson' src='/images/2017/02/the-master.jpg' longdesc='#b894db33'/><figcaption id='b894db33'>The Master (2012) by Paul Thomas Anderson</figcaption></figure><p>Here is an example of a simple class:</p><figure class="highlight"><pre><code class="language-java" data-lang="java"><span></span><span class="kd">class</span> <span class="nc">Token</span> <span class="o">{</span>
  <span class="kd">private</span> <span class="n">String</span> <span class="n">key</span><span class="o">;</span>
  <span class="kd">private</span> <span class="n">String</span> <span class="n">secret</span><span class="o">;</span>
  <span class="n">String</span> <span class="nf">encoded</span><span class="o">()</span> <span class="o">{</span>
    <span class="k">return</span> <span class="s">&quot;key=&quot;</span>
      <span class="o">+</span> <span class="n">URLEncoder</span><span class="o">.</span><span class="na">encode</span><span class="o">(</span><span class="n">key</span><span class="o">,</span> <span class="s">&quot;UTF-8&quot;</span><span class="o">)</span>
      <span class="o">+</span> <span class="s">&quot;&amp;secret=&quot;</span>
      <span class="o">+</span> <span class="n">URLEncoder</span><span class="o">.</span><span class="na">encode</span><span class="o">(</span><span class="n">secret</span><span class="o">,</span> <span class="s">&quot;UTF-8&quot;</span><span class="o">);</span>
  <span class="o">}</span>
<span class="o">}</span></code></pre></figure><p>There is an obvious code duplication, right? The easiest way to resolve it is to introduce a private static method:</p><figure class="highlight"><pre><code class="language-java" data-lang="java"><span></span><span class="kd">class</span> <span class="nc">Token</span> <span class="o">{</span>
  <span class="kd">private</span> <span class="n">String</span> <span class="n">key</span><span class="o">;</span>
  <span class="kd">private</span> <span class="n">String</span> <span class="n">secret</span><span class="o">;</span>
  <span class="n">String</span> <span class="nf">encoded</span><span class="o">()</span> <span class="o">{</span>
    <span class="k">return</span> <span class="s">&quot;key=&quot;</span>
      <span class="o">+</span> <span class="n">Token</span><span class="o">.</span><span class="na">encoded</span><span class="o">(</span><span class="n">key</span><span class="o">)</span>
      <span class="o">+</span> <span class="s">&quot;&amp;secret=&quot;</span>
      <span class="o">+</span> <span class="n">Token</span><span class="o">.</span><span class="na">encoded</span><span class="o">(</span><span class="n">secret</span><span class="o">);</span>
  <span class="o">}</span>
  <span class="kd">private</span> <span class="kd">static</span> <span class="n">String</span> <span class="nf">encoded</span><span class="o">(</span><span class="n">String</span> <span class="n">text</span><span class="o">)</span> <span class="o">{</span>
    <span class="k">return</span> <span class="n">URLEncoder</span><span class="o">.</span><span class="na">encode</span><span class="o">(</span><span class="n">text</span><span class="o">,</span> <span class="s">&quot;UTF-8&quot;</span><span class="o">);</span>
  <span class="o">}</span>
<span class="o">}</span></code></pre></figure><p>Looks much better now. But what will happen if we have another class that needs the exact same functionality? We will have to copy and paste this private static method <code>encoded()</code> into it, right?</p><p>A better alternative would be to introduce a new class <code>Encoded</code> that implements the functionality we want to share:</p><figure class="highlight"><pre><code class="language-java" data-lang="java"><span></span><span class="kd">class</span> <span class="nc">Encoded</span> <span class="o">{</span>
  <span class="kd">private</span> <span class="kd">final</span> <span class="n">String</span> <span class="n">raw</span><span class="o">;</span>
  <span class="nd">@Override</span>
  <span class="kd">public</span> <span class="n">String</span> <span class="nf">toString</span><span class="o">()</span> <span class="o">{</span>
    <span class="k">return</span> <span class="n">URLEncoder</span><span class="o">.</span><span class="na">encode</span><span class="o">(</span><span class="k">this</span><span class="o">.</span><span class="na">raw</span><span class="o">,</span> <span class="s">&quot;UTF-8&quot;</span><span class="o">);</span>
  <span class="o">}</span>
<span class="o">}</span></code></pre></figure><p>And then:</p><figure class="highlight"><pre><code class="language-java" data-lang="java"><span></span><span class="kd">class</span> <span class="nc">Token</span> <span class="o">{</span>
  <span class="kd">private</span> <span class="n">String</span> <span class="n">key</span><span class="o">;</span>
  <span class="kd">private</span> <span class="n">String</span> <span class="n">secret</span><span class="o">;</span>
  <span class="n">String</span> <span class="nf">encoded</span><span class="o">()</span> <span class="o">{</span>
    <span class="k">return</span> <span class="s">&quot;key=&quot;</span>
      <span class="o">+</span> <span class="k">new</span> <span class="n">Encoded</span><span class="o">(</span><span class="n">key</span><span class="o">)</span>
      <span class="o">+</span> <span class="s">&quot;&amp;secret=&quot;</span>
      <span class="o">+</span> <span class="k">new</span> <span class="n">Encoded</span><span class="o">(</span><span class="n">secret</span><span class="o">);</span>
  <span class="o">}</span>
<span class="o">}</span></code></pre></figure><p>Now this functionality is 1) reusable, and 2) testable. We can easily use this class <code>Encoded</code> in many other places, and we can create a unit test for it. We were not able to do that with the private static method before.</p><p>See the point? The rule of thumb I&#39;ve already figured for myself is that <em>each</em> private static method is a perfect candidate for a new class. That&#39;s why we don&#39;t have them at all in <a href="http://www.eolang.org">EO</a>.</p><p>By the way, <em>public</em> static methods are a different story. They are also evil, but for <a href="/2014/05/05/oop-alternative-to-utility-classes.html">different reasons</a>.</p><p>P.S. Now I think that the reasons in this article are applicable to <em>all</em> private methods, not only static ones.</p></div></article></div><div class="wrapper"> <related-posts /></div><div class="disqus" role="complementary"><p class="disqus_hint"> Please, use <a href="https://help.disqus.com/commenting/what-html-tags-are-allowed-within-comments">syntax highlighting</a> in your comments, to make them more readable.</p><div id="disqus_thread" class="disqus-thread"> <a>&nbsp;</a></div><script> var disqus_config = function () { this.page.url = document.location.href.split('?')[0].split('#')[0].replace('https://', 'http://'); this.page.identifier = this.page.url; }; (function() { var d = document, s = d.createElement('script'); s.src = '//yegor256.disqus.com/embed.js'; s.setAttribute('data-timestamp', +new Date()); (d.head || d.body).appendChild(s); })(); </script> <noscript><div><p class="red"> JavaScript is disabled in your browser, that's why you can't see comments under this post.</p></div></noscript></div><div class="wrapper"> <footer class="footer"><p> &copy; <span itemscope="" itemprop="copyrightHolder" itemtype="http://schema.org/Person"> <span itemprop="name">Yegor Bugayenko</span> </span> 2014&ndash;<span itemprop="copyrightYear">2018</span></p></footer></div></section><div class="wrapper unprintable" style="text-align:center;margin-top:2em;"> <a href="http://www.sixnines.io/h/3ba1652f"> <img src="//www.sixnines.io/b/3ba1652f?style=flat" alt="sixnines availability badge"/> </a></div><script src="//code.jquery.com/jquery-1.9.0.min.js"></script> <script src="/js/all.js?4e047f6f42b"></script> <script>var disqus_shortname = 'yegor256';</script> <script id="dsq-count-scr" src="//yegor256.disqus.com/count.js" async="async"></script> <script> (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){ (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o), m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m) })(window,document,'script','//www.google-analytics.com/analytics.js','ga'); ga('create', 'UA-1963507-32', 'auto'); ga('send', 'pageview'); </script> <script> Cd=document;Cr="&"+Math.random();Cp="&s=1"; Cd.cookie="b=b";if(Cd.cookie)Cp+="&c=1"; Cp+="&t="+(new Date()).getTimezoneOffset(); if(self!=top)Cp+="&f=1"; </script> <script> if(navigator.javaEnabled())Cp+="&j=1"; </script> <script> if(typeof(screen)!='undefined')Cp+="&w="+screen.width+"&h="+ screen.height+"&d="+(screen.colorDepth?screen.colorDepth:screen.pixelDepth); </script> <script> Cd.write("<img src='//c.hit.ua/hit?i=95870&g=0&x=2"+Cp+Cr+ "&r="+escape(Cd.referrer)+"&u="+escape(window.location.href)+ "' border='0' wi"+"dth='1' he"+"ight='1'/>"); </script> <script type="application/ld+json"> { "@context": "http://schema.org", "@type": "Person", "name": "Yegor Bugayenko", "url": "http://www.yegor256.com", "sameAs": [ "https://www.facebook.com/yegor256", "https://instagram.com/yegor256", "https://www.linkedin.com/in/yegor256", "https://twitter.com/yegor256", "https://github.com/yegor256", "https://www.pinterest.com/yegor256/" ] } </script> </body> </html> <!DOCTYPE html> <html xmlns="http://www.w3.org/1999/xhtml" lang="en-US" xml:lang="en-US" itemscope="" itemtype="http://schema.org/WebSite"> <head> <meta charset="utf-8"/> <meta name="description" content="Composing a large object is a rather verbose process in Java; it would be great to have the ability to do it more succinctly. " /> <meta name="keywords" content="constructor in oop, decorators, object oriented programming, oop constructor, primary constructor oop" /> <meta name="viewport" content="width=device-width,minimum-scale=1,initial-scale=1"/> <meta name="google-site-verification" content="JEj_gQr2CPe2QKGw8XdMz0R7VboQIUbX3FlM-lwTq-8" /> <meta name="author" content="Yegor Bugayenko"> <meta name="article:published_time" content="2017-01-31 00:00:00 +0000"> <meta name="og:site_name" content="Yegor Bugayenko"/> <meta name="og:type" content="article" /> <meta name="og:locale" content="en_US" /> <meta name="twitter:account_id" content="4503599630178231" /> <meta name="twitter:creator" content="@yegor256"/> <meta name="twitter:site" content="@yegor256"/> <meta name="twitter:title" property="og:title" content="Decorating Envelopes"/> <meta name="twitter:description" property="og:description" content="Composing a large object is a rather verbose process in Java; it would be great to have the ability to do it more succinctly. "/> <meta name="twitter:url" property="og:url" content="https://www.yegor256.com/2017/01/31/decorating-envelopes.html"/> <meta name="telegram:channel" content="AAAAAEJFMRzsRTRxM3ec6A"/> <link rel="search" type="application/opensearchdescription+xml" href="/opensearch.xml" title="yegor256" /> <link rel="shortcut icon" href="/favicon.ico?4e047f6f42b"/> <link rel="apple-touch-icon" href="/favicon.ico?4e047f6f42b"/> <link rel="alternate" type="application/rss+xml" title="RSS for yegor256.com" href="https://www.yegor256.com/rss.xml"/> <link rel="stylesheet" href="/css/layout.css?4e047f6f42b"/> <link rel="stylesheet" href="/css/icons.css?4e047f6f42b"/> <link rel="canonical" href="https://www.yegor256.com/2017/01/31/decorating-envelopes.html" /> <link rel="amphtml" href="https://www.yegor256.com/2017/01/31/decorating-envelopes.amp.html" /> <title>Decorating Envelopes </title> <meta name='og:image' content='https://www.yegor256.com/images/2017/01/north-by-northwest.jpg'/><meta name='twitter:image' content='https://www.yegor256.com/images/2017/01/north-by-northwest.jpg'/><meta name='og:image:width' content='1280'/> <meta name='twitter:image:width' content='1280'/><meta name='og:image:height' content='717'/> <meta name='twitter:image:height' content='717'/><meta name='twitter:card' content='summary_large_image'/><meta name='twitter:image:alt' content='North by Northwest (1959) by Alfred Hitchcock'/> </head> <body><div class="wrapper"> <aside class="header-toggle unprintable" id="header-toggle" title="Show the menu" onclick="$('#header').show();$('#header-toggle').hide();">&#9776;</aside> <header class="header" id="header"><div class="face"> <a href="/about-me.html#form" class="sub" title="Click to subscribe to my monthly newsletter"><span>Subscribe</span></a> <a href="/about-me.html" style="position:relative;"> <img src="/images/face-256x256.jpg" class="photo" alt="Yegor Bugayenko"/> </a></div><nav><ul class="menu social notranslate"> <li><a href="https://twitter.com/intent/follow?screen_name=yegor256" rel="nofollow" title="Follow me on Twitter"><i class="icon icon-twitter notranslate" aria-hidden="true"></i></a></li> <li><a href="/rss.xml" rel="nofollow" title="Subscribe to my RSS feed"><i class="icon icon-rss notranslate" aria-hidden="true"></i></a></li> <li><a itemprop="sameAs" href="https://github.com/yegor256" rel="nofollow" title="My GitHub profile"><i class="icon icon-github notranslate" aria-hidden="true"></i></a></li> <li><a itemprop="sameAs" href="http://stackoverflow.com/users/187141/yegor256" rel="nofollow" title="My StackOverflow profile"><i class="icon icon-stackoverflow notranslate" aria-hidden="true"></i></a></li> <li><a itemprop="sameAs" href="https://www.facebook.com/yegor256" rel="nofollow" title="Follow me on Facebook"><i class="icon icon-facebook notranslate" aria-hidden="true"></i></a></li> <li><a itemprop="sameAs" href="https://instagram.com/yegor256" rel="nofollow" title="Follow me on Instagram"><i class="icon icon-instagram notranslate" aria-hidden="true"></i></a></li> <li><a itemprop="sameAs" href="https://www.linkedin.com/in/yegor256" rel="nofollow" title="My LinkedIn profile"><i class="icon icon-linkedin notranslate" aria-hidden="true"></i></a></li> <li><a itemprop="sameAs" href="https://www.youtube.com/c/yegor256?sub_confirmation=1" rel="nofollow" title="My Youtube video channel"><i class="icon icon-youtube notranslate" aria-hidden="true"></i></a></li> <li><a itemprop="sameAs" href="https://www.pinterest.com/yegor256/" rel="nofollow" title="My Pinterest boards"><i class="icon icon-pinterest notranslate" aria-hidden="true"></i></a></li> <li><a itemprop="sameAs" href="https://angel.co/yegor256" rel="nofollow" title="My AngelList profile"><i class="icon icon-angellist notranslate" aria-hidden="true"></i></a></li> <li><a href="https://soundcloud.com/yegor256" rel="nofollow" title="My podcast"><i class="icon icon-podcast notranslate" aria-hidden="true"></i></a></li> <li><a href="https://itunes.apple.com/us/podcast/yegor256-podcast/id1150826721" rel="nofollow" title="My iTunes podcast"><i class="icon icon-itunes notranslate" aria-hidden="true"></i></a></li> <li><a href="https://t.me/joinchat/AAAAAEJFMRzsRTRxM3ec6A" rel="nofollow" title="My Telegram public channel"><i class="icon icon-telegram notranslate" aria-hidden="true"></i></a></li> <li><a href="mailto:blog@yegor256.com" rel="nofollow" title="Email me any time"><i class="icon icon-mail notranslate" aria-hidden="true"></i></a></li></ul><ul class="menu"> <li><a href="/" title="Home page">Home</a></li> <li ><a href="/best.html" title="Best articles to read">12&#160;Best</a></li> <li ><a href="/contents.html" title="The contents of the entire blog">All&#160;288</a></li> <li ><a href="/webinars.html" title="My webinars">Webinars</a></li> <li ><a href="/talks.html" title="Future and past conference talks">Talks</a></li> <li ><a href="/books.html" title="The books I wrote">Books</a></li> <li ><a href="/papers.html" title="My academic papers and patents">Papers</a></li> <li ><a href="/pets.html" title="My loved pet projects">Pets</a></li> <li ><a href="/award.html" title="Software quality award">Award</a></li> <li ><a href="/testimonials.html" title="What some people say about me">Testimonials</a></li> <li ><a href="/shift-m.html" title="Audio podcast about project management">Shift-M</a></li> <li ><a href="/paintings.html" title="My paintings for sale">Paintings</a></li> <li><a href="http://ru.yegor256.com/" title="Немного на русском языке">По-русски</a></li></ul></nav><div class="search"> <form method="get" action="https://www.google.com/search" itemprop="potentialAction" itemscope="" itemtype="http://schema.org/SearchAction"> <meta itemprop="target" content="https://www.google.com/search?q={q}"/> <input name="sitesearch" value="yegor256.com" type="hidden"/> <input itemprop="query-input" type="text" id="search-query" class="field field-text" required="required" onfocus="$('.google').css('visibility', 'visible');" name="q" placeholder="Search..." autocomplete="off"/> <input type="image" src="/images/google-search-icon.svg" class="google" title="Search via Google" alt="Search via Google"/> </form></div><div class="hot"><ul> <li> <a href="/code-ahead.html">Code Ahead</a> was published on Amazon just a few days ago! It is my new book, a novel about programmers. It explains in details the majority of ideas that stand behind <a href="https://www.zerocracy.com">Zerocracy</a> and <a href="https://www.xdsd.org">XDSD</a>. </li> <li> At <a href="/webinars.html">Webinar #37</a> we will discuss naming problem in OOP, for objects, methods and attributes; join us on <b>September 12</b>, at 11am PST. </li></ul></div></header></div><section itemscope="" itemtype="http://schema.org/BlogPosting"><div class="wrapper"> <header><p class="printable"> <img src="https://api.qrserver.com/v1/create-qr-code/?data=https://www.yegor256.com/2017/01/31/decorating-envelopes.html&amp;format=svg" style="width:125px;height:125px;" alt="QR code"/></p><p class="printable"> <code itemprop="url">https://www.yegor256.com/2017/01/31/decorating-envelopes.html</code></p><h1 itemprop="name headline mainEntityOfPage">Decorating Envelopes</h1><ul class="subline"> <li> <time itemprop="datePublished" datetime="2017-01-31T00:00:00+00:00"> 31 January 2017 </time> </li> <li class="desktop-only" itemprop="locationCreated">Lviv, Ukraine</li> <li class="printable" itemscope="" itemprop="author" itemtype="http://schema.org/Person"> <span itemprop="name">Yegor Bugayenko</span> </li> <li class="unprintable"> <i class="icon icon-comments"></i> <a href="http://www.yegor256.com/2017/01/31/decorating-envelopes.html#disqus_thread" itemprop="discussionUrl">comments</a> </li></ul><figure class='jb_picture'><img itemprop='image' alt='North by Northwest (1959) by Alfred Hitchcock' src='/images/2017/01/north-by-northwest.jpg' longdesc='#1633d9e6'/><figcaption id='1633d9e6'>North by Northwest (1959) by Alfred Hitchcock</figcaption></figure><p>Take a look at <a href="https://github.com/yegor256/takes/blob/1.1/src/main/java/org/takes/rs/RsHtml.java"><code>RsHtml</code></a> from <a href="http://www.takes.org">Takes Framework</a>. Its design looks like this (a simplified version with only one primary constructor):</p><figure class="highlight"><pre><code class="language-java" data-lang="java"><span></span><span class="kd">class</span> <span class="nc">RsHtml</span> <span class="kd">extends</span> <span class="n">RsWrap</span> <span class="o">{</span>
  <span class="n">RsHtml</span><span class="o">(</span><span class="kd">final</span> <span class="n">String</span> <span class="n">text</span><span class="o">)</span> <span class="o">{</span>
    <span class="kd">super</span><span class="o">(</span>
      <span class="k">new</span> <span class="n">RsWithType</span><span class="o">(</span>
        <span class="k">new</span> <span class="n">RsWithStatus</span><span class="o">(</span><span class="n">text</span><span class="o">,</span> <span class="mi">200</span><span class="o">),</span>
        <span class="s">&quot;text/html&quot;</span>
      <span class="o">)</span>
    <span class="o">);</span>
  <span class="o">}</span>
<span class="o">}</span></code></pre></figure><p>Now, let&#39;s take a look at that <a href="https://github.com/yegor256/takes/blob/1.1/src/main/java/org/takes/rs/RsWrap.java"><code>RsWrap</code></a> it extends:</p><figure class="highlight"><pre><code class="language-java" data-lang="java"><span></span><span class="kd">public</span> <span class="kd">class</span> <span class="nc">RsWrap</span> <span class="kd">implements</span> <span class="n">Response</span> <span class="o">{</span>
  <span class="kd">private</span> <span class="kd">final</span> <span class="n">Response</span> <span class="n">origin</span><span class="o">;</span>
  <span class="kd">public</span> <span class="nf">RsWrap</span><span class="o">(</span><span class="kd">final</span> <span class="n">Response</span> <span class="n">res</span><span class="o">)</span> <span class="o">{</span>
    <span class="k">this</span><span class="o">.</span><span class="na">origin</span> <span class="o">=</span> <span class="n">res</span><span class="o">;</span>
  <span class="o">}</span>
  <span class="nd">@Override</span>
  <span class="kd">public</span> <span class="kd">final</span> <span class="n">Iterable</span><span class="o">&lt;</span><span class="n">String</span><span class="o">&gt;</span> <span class="nf">head</span><span class="o">()</span> <span class="o">{</span>
    <span class="k">return</span> <span class="k">this</span><span class="o">.</span><span class="na">origin</span><span class="o">.</span><span class="na">head</span><span class="o">();</span>
  <span class="o">}</span>
  <span class="nd">@Override</span>
  <span class="kd">public</span> <span class="kd">final</span> <span class="n">InputStream</span> <span class="nf">body</span><span class="o">()</span> <span class="o">{</span>
    <span class="k">return</span> <span class="k">this</span><span class="o">.</span><span class="na">origin</span><span class="o">.</span><span class="na">body</span><span class="o">();</span>
  <span class="o">}</span>
<span class="o">}</span></code></pre></figure><p>As you see, this &quot;decorator&quot; doesn&#39;t do anything except &quot;just decorating.&quot; It encapsulates another <code>Response</code> and passes through all method calls.</p><aside class='youtube'> <a href='https://www.youtube.com/watch?v=Wcy53ZSF78o'><div class='box'> <img src='https://i.ytimg.com/vi/Wcy53ZSF78o/mqdefault.jpg' alt='YouTube video #Wcy53ZSF78o'/><div class='play'><i class='icon icon-play'></i></div></div></a><div>Decorating Envelopes in OOP (webinar #31); 3 January 2018.</div></aside><p>If it&#39;s not clear yet, I&#39;ll explain the purpose of <code>RsHtml</code>. Let&#39;s say you have text and you want to create a <code>Response</code>:</p><figure class="highlight"><pre><code class="language-java" data-lang="java"><span></span><span class="n">String</span> <span class="n">text</span> <span class="o">=</span> <span class="c1">// you have it already</span>
<span class="n">Response</span> <span class="n">response</span> <span class="o">=</span> <span class="k">new</span> <span class="n">RsWithType</span><span class="o">(</span>
  <span class="k">new</span> <span class="n">RsWithStatus</span><span class="o">(</span><span class="n">text</span><span class="o">,</span> <span class="n">HttpURLConnection</span><span class="o">.</span><span class="na">HTTP_OK</span><span class="o">),</span>
  <span class="s">&quot;text/html&quot;</span>
<span class="o">);</span></code></pre></figure><p>Instead of doing this <a href="/2015/02/26/composable-decorators.html">composition of decorators</a> over and over again in many places, you use <code>RsHtml</code>:</p><figure class="highlight"><pre><code class="language-java" data-lang="java"><span></span><span class="n">String</span> <span class="n">text</span> <span class="o">=</span> <span class="c1">// you have it already</span>
<span class="n">Response</span> <span class="n">response</span> <span class="o">=</span> <span class="k">new</span> <span class="n">RsHtml</span><span class="o">(</span><span class="n">text</span><span class="o">);</span></code></pre></figure><p>It is very convenient, but that <code>RsWrap</code> is very verbose. There are too many lines that don&#39;t do anything special; they just forward all method calls to the encapsulated <code>Response</code>.</p><p>How about we introduce a new concept, &quot;decorators,&quot; with a new keyword, <code>decorates</code>:</p><figure class="highlight"><pre><code class="language-java" data-lang="java"><span></span><span class="kd">class</span> <span class="nc">RsHtml</span> <span class="n">decorates</span> <span class="n">Response</span> <span class="o">{</span>
  <span class="n">RsHtml</span><span class="o">(</span><span class="kd">final</span> <span class="n">String</span> <span class="n">text</span><span class="o">)</span> <span class="o">{</span>
    <span class="k">this</span><span class="o">(</span>
      <span class="k">new</span> <span class="n">RsWithType</span><span class="o">(</span>
        <span class="k">new</span> <span class="n">RsWithStatus</span><span class="o">(</span><span class="n">text</span><span class="o">,</span> <span class="mi">200</span><span class="o">),</span>
        <span class="s">&quot;text/html&quot;</span>
      <span class="o">)</span>
    <span class="o">)</span>
  <span class="o">}</span>
<span class="o">}</span></code></pre></figure><p>Then, in order to create an object, we just call:</p><figure class="highlight"><pre><code class="language-java" data-lang="java"><span></span><span class="n">Response</span> <span class="n">response</span> <span class="o">=</span> <span class="k">new</span> <span class="n">RsHtml</span><span class="o">(</span><span class="n">text</span><span class="o">);</span></code></pre></figure><p>We don&#39;t have any new methods in the decorators, just constructors. The only purpose for these guys is to create other objects and encapsulate them. They are not really full-purpose objects. They only help us create other objects.</p><p>That&#39;s why I would call them &quot;decorating envelopes.&quot;</p><p>This idea may look very similar to the <a href="https://en.wikipedia.org/wiki/Factory_%28object-oriented_programming%29">Factory</a> design pattern, but it doesn&#39;t have <a href="/2014/05/05/oop-alternative-to-utility-classes.html">static methods</a>, which we are trying to avoid in <a href="/2016/08/15/what-is-wrong-object-oriented-programming.html">object-oriented programming</a>.</p></p>--> <nav class="buttons notranslate desktop-only"> <a href="http://www.facebook.com/sharer/sharer.php?u=https://www.yegor256.com/2017/01/31/decorating-envelopes.html" title="Share on Facebook" class="button" rel="nofollow"> <span class="count count-facebook">0</span> <i class="icon icon-facebook notranslate" aria-hidden="true"></i> </a> <a href="https://twitter.com/share?url=https://www.yegor256.com/2017/01/31/decorating-envelopes.html&amp;text=Decorating+Envelopes" title="Share on Twitter" class="button" rel="nofollow"> <span class="count count-twitter">0</span> <i class="icon icon-twitter notranslate" aria-hidden="true"></i> </a> <a href="https://plus.google.com/share?url=https://www.yegor256.com/2017/01/31/decorating-envelopes.html" title="Share on Google+" class="button" rel="nofollow"> <span class="count count-googleplus">0</span> <i class="icon icon-googleplus notranslate" aria-hidden="true"></i> </a> <a href="https://www.linkedin.com/cws/share?url=https://www.yegor256.com/2017/01/31/decorating-envelopes.html" title="Share on LinkedIn" class="button" rel="nofollow"> <span class="count count-linkedin">0</span> <i class="icon icon-linkedin notranslate" aria-hidden="true"></i> </a> <a href="http://reddit.com/submit?url=https://www.yegor256.com/2017/01/31/decorating-envelopes.html%3F2017-05&amp;title=Decorating+Envelopes" title="Share on Reddit" class="button" rel="nofollow"> <span class="count count-reddit">0</span> <i class="icon icon-reddit notranslate" aria-hidden="true"></i> </a> <a href="http://news.ycombinator.com/submitlink?u=https://www.yegor256.com/2017/01/31/decorating-envelopes.html%3F2017-05&amp;t=Decorating+Envelopes" title="Share on Hacker News" class="button" rel="nofollow"> <span class="count count-hackernews">0</span> <i class="icon icon-hackernews notranslate" aria-hidden="true"></i> </a> </nav> </header> <article class="main" itemprop="articleBody"><div ><p><del>Sometimes</del> Very often I need a <a href="/2016/09/20/oop-without-classes.html">class</a> that implements an interface by making an instance of another class. Sound weird? Let me show you an example. There are many classes of that kind in the <a href="http://www.takes.org">Takes Framework</a>, and they all are named like <code>*Wrap</code>. It&#39;s a convenient design concept that, unfortunately, looks rather verbose in Java. It would be great to have something shorter, like in <a href="http://www.eolang.org">EO</a> for example.</p><figure class='jb_picture'><img itemprop='image' alt='North by Northwest (1959) by Alfred Hitchcock' src='/images/2017/01/north-by-northwest.jpg' longdesc='#1633d9e6'/><figcaption id='1633d9e6'>North by Northwest (1959) by Alfred Hitchcock</figcaption></figure><p>Take a look at <a href="https://github.com/yegor256/takes/blob/1.1/src/main/java/org/takes/rs/RsHtml.java"><code>RsHtml</code></a> from <a href="http://www.takes.org">Takes Framework</a>. Its design looks like this (a simplified version with only one primary constructor):</p><figure class="highlight"><pre><code class="language-java" data-lang="java"><span></span><span class="kd">class</span> <span class="nc">RsHtml</span> <span class="kd">extends</span> <span class="n">RsWrap</span> <span class="o">{</span>
  <span class="n">RsHtml</span><span class="o">(</span><span class="kd">final</span> <span class="n">String</span> <span class="n">text</span><span class="o">)</span> <span class="o">{</span>
    <span class="kd">super</span><span class="o">(</span>
      <span class="k">new</span> <span class="n">RsWithType</span><span class="o">(</span>
        <span class="k">new</span> <span class="n">RsWithStatus</span><span class="o">(</span><span class="n">text</span><span class="o">,</span> <span class="mi">200</span><span class="o">),</span>
        <span class="s">&quot;text/html&quot;</span>
      <span class="o">)</span>
    <span class="o">);</span>
  <span class="o">}</span>
<span class="o">}</span></code></pre></figure><p>Now, let&#39;s take a look at that <a href="https://github.com/yegor256/takes/blob/1.1/src/main/java/org/takes/rs/RsWrap.java"><code>RsWrap</code></a> it extends:</p><figure class="highlight"><pre><code class="language-java" data-lang="java"><span></span><span class="kd">public</span> <span class="kd">class</span> <span class="nc">RsWrap</span> <span class="kd">implements</span> <span class="n">Response</span> <span class="o">{</span>
  <span class="kd">private</span> <span class="kd">final</span> <span class="n">Response</span> <span class="n">origin</span><span class="o">;</span>
  <span class="kd">public</span> <span class="nf">RsWrap</span><span class="o">(</span><span class="kd">final</span> <span class="n">Response</span> <span class="n">res</span><span class="o">)</span> <span class="o">{</span>
    <span class="k">this</span><span class="o">.</span><span class="na">origin</span> <span class="o">=</span> <span class="n">res</span><span class="o">;</span>
  <span class="o">}</span>
  <span class="nd">@Override</span>
  <span class="kd">public</span> <span class="kd">final</span> <span class="n">Iterable</span><span class="o">&lt;</span><span class="n">String</span><span class="o">&gt;</span> <span class="nf">head</span><span class="o">()</span> <span class="o">{</span>
    <span class="k">return</span> <span class="k">this</span><span class="o">.</span><span class="na">origin</span><span class="o">.</span><span class="na">head</span><span class="o">();</span>
  <span class="o">}</span>
  <span class="nd">@Override</span>
  <span class="kd">public</span> <span class="kd">final</span> <span class="n">InputStream</span> <span class="nf">body</span><span class="o">()</span> <span class="o">{</span>
    <span class="k">return</span> <span class="k">this</span><span class="o">.</span><span class="na">origin</span><span class="o">.</span><span class="na">body</span><span class="o">();</span>
  <span class="o">}</span>
<span class="o">}</span></code></pre></figure><p>As you see, this &quot;decorator&quot; doesn&#39;t do anything except &quot;just decorating.&quot; It encapsulates another <code>Response</code> and passes through all method calls.</p><aside class='youtube'> <a href='https://www.youtube.com/watch?v=Wcy53ZSF78o'><div class='box'> <img src='https://i.ytimg.com/vi/Wcy53ZSF78o/mqdefault.jpg' alt='YouTube video #Wcy53ZSF78o'/><div class='play'><i class='icon icon-play'></i></div></div></a><div>Decorating Envelopes in OOP (webinar #31); 3 January 2018.</div></aside><p>If it&#39;s not clear yet, I&#39;ll explain the purpose of <code>RsHtml</code>. Let&#39;s say you have text and you want to create a <code>Response</code>:</p><figure class="highlight"><pre><code class="language-java" data-lang="java"><span></span><span class="n">String</span> <span class="n">text</span> <span class="o">=</span> <span class="c1">// you have it already</span>
<span class="n">Response</span> <span class="n">response</span> <span class="o">=</span> <span class="k">new</span> <span class="n">RsWithType</span><span class="o">(</span>
  <span class="k">new</span> <span class="n">RsWithStatus</span><span class="o">(</span><span class="n">text</span><span class="o">,</span> <span class="n">HttpURLConnection</span><span class="o">.</span><span class="na">HTTP_OK</span><span class="o">),</span>
  <span class="s">&quot;text/html&quot;</span>
<span class="o">);</span></code></pre></figure><p>Instead of doing this <a href="/2015/02/26/composable-decorators.html">composition of decorators</a> over and over again in many places, you use <code>RsHtml</code>:</p><figure class="highlight"><pre><code class="language-java" data-lang="java"><span></span><span class="n">String</span> <span class="n">text</span> <span class="o">=</span> <span class="c1">// you have it already</span>
<span class="n">Response</span> <span class="n">response</span> <span class="o">=</span> <span class="k">new</span> <span class="n">RsHtml</span><span class="o">(</span><span class="n">text</span><span class="o">);</span></code></pre></figure><p>It is very convenient, but that <code>RsWrap</code> is very verbose. There are too many lines that don&#39;t do anything special; they just forward all method calls to the encapsulated <code>Response</code>.</p><p>How about we introduce a new concept, &quot;decorators,&quot; with a new keyword, <code>decorates</code>:</p><figure class="highlight"><pre><code class="language-java" data-lang="java"><span></span><span class="kd">class</span> <span class="nc">RsHtml</span> <span class="n">decorates</span> <span class="n">Response</span> <span class="o">{</span>
  <span class="n">RsHtml</span><span class="o">(</span><span class="kd">final</span> <span class="n">String</span> <span class="n">text</span><span class="o">)</span> <span class="o">{</span>
    <span class="k">this</span><span class="o">(</span>
      <span class="k">new</span> <span class="n">RsWithType</span><span class="o">(</span>
        <span class="k">new</span> <span class="n">RsWithStatus</span><span class="o">(</span><span class="n">text</span><span class="o">,</span> <span class="mi">200</span><span class="o">),</span>
        <span class="s">&quot;text/html&quot;</span>
      <span class="o">)</span>
    <span class="o">)</span>
  <span class="o">}</span>
<span class="o">}</span></code></pre></figure><p>Then, in order to create an object, we just call:</p><figure class="highlight"><pre><code class="language-java" data-lang="java"><span></span><span class="n">Response</span> <span class="n">response</span> <span class="o">=</span> <span class="k">new</span> <span class="n">RsHtml</span><span class="o">(</span><span class="n">text</span><span class="o">);</span></code></pre></figure><p>We don&#39;t have any new methods in the decorators, just constructors. The only purpose for these guys is to create other objects and encapsulate them. They are not really full-purpose objects. They only help us create other objects.</p><p>That&#39;s why I would call them &quot;decorating envelopes.&quot;</p><p>This idea may look very similar to the <a href="https://en.wikipedia.org/wiki/Factory_%28object-oriented_programming%29">Factory</a> design pattern, but it doesn&#39;t have <a href="/2014/05/05/oop-alternative-to-utility-classes.html">static methods</a>, which we are trying to avoid in <a href="/2016/08/15/what-is-wrong-object-oriented-programming.html">object-oriented programming</a>.</p></div></article></div><div class="wrapper"> <related-posts /></div><div class="disqus" role="complementary"><p class="disqus_hint"> Please, use <a href="https://help.disqus.com/commenting/what-html-tags-are-allowed-within-comments">syntax highlighting</a> in your comments, to make them more readable.</p><div id="disqus_thread" class="disqus-thread"> <a>&nbsp;</a></div><script> var disqus_config = function () { this.page.url = document.location.href.split('?')[0].split('#')[0].replace('https://', 'http://'); this.page.identifier = this.page.url; }; (function() { var d = document, s = d.createElement('script'); s.src = '//yegor256.disqus.com/embed.js'; s.setAttribute('data-timestamp', +new Date()); (d.head || d.body).appendChild(s); })(); </script> <noscript><div><p class="red"> JavaScript is disabled in your browser, that's why you can't see comments under this post.</p></div></noscript></div><div class="wrapper"> <footer class="footer"><p> &copy; <span itemscope="" itemprop="copyrightHolder" itemtype="http://schema.org/Person"> <span itemprop="name">Yegor Bugayenko</span> </span> 2014&ndash;<span itemprop="copyrightYear">2018</span></p></footer></div></section><div class="wrapper unprintable" style="text-align:center;margin-top:2em;"> <a href="http://www.sixnines.io/h/3ba1652f"> <img src="//www.sixnines.io/b/3ba1652f?style=flat" alt="sixnines availability badge"/> </a></div><script src="//code.jquery.com/jquery-1.9.0.min.js"></script> <script src="/js/all.js?4e047f6f42b"></script> <script>var disqus_shortname = 'yegor256';</script> <script id="dsq-count-scr" src="//yegor256.disqus.com/count.js" async="async"></script> <script> (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){ (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o), m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m) })(window,document,'script','//www.google-analytics.com/analytics.js','ga'); ga('create', 'UA-1963507-32', 'auto'); ga('send', 'pageview'); </script> <script> Cd=document;Cr="&"+Math.random();Cp="&s=1"; Cd.cookie="b=b";if(Cd.cookie)Cp+="&c=1"; Cp+="&t="+(new Date()).getTimezoneOffset(); if(self!=top)Cp+="&f=1"; </script> <script> if(navigator.javaEnabled())Cp+="&j=1"; </script> <script> if(typeof(screen)!='undefined')Cp+="&w="+screen.width+"&h="+ screen.height+"&d="+(screen.colorDepth?screen.colorDepth:screen.pixelDepth); </script> <script> Cd.write("<img src='//c.hit.ua/hit?i=95870&g=0&x=2"+Cp+Cr+ "&r="+escape(Cd.referrer)+"&u="+escape(window.location.href)+ "' border='0' wi"+"dth='1' he"+"ight='1'/>"); </script> <script type="application/ld+json"> { "@context": "http://schema.org", "@type": "Person", "name": "Yegor Bugayenko", "url": "http://www.yegor256.com", "sameAs": [ "https://www.facebook.com/yegor256", "https://instagram.com/yegor256", "https://www.linkedin.com/in/yegor256", "https://twitter.com/yegor256", "https://github.com/yegor256", "https://www.pinterest.com/yegor256/" ] } </script> </body> </html> <!DOCTYPE html> <html xmlns="http://www.w3.org/1999/xhtml" lang="en-US" xml:lang="en-US" itemscope="" itemtype="http://schema.org/WebSite"> <head> <meta charset="utf-8"/> <meta name="description" content="Don&apos;t make your classes thread-safe; instead, create thread-safe decorators to make thread safety configurable. " /> <meta name="keywords" content="how to make class thread-safe, synchronized in java, synchronized java, thread safety, thread-safe java" /> <meta name="viewport" content="width=device-width,minimum-scale=1,initial-scale=1"/> <meta name="google-site-verification" content="JEj_gQr2CPe2QKGw8XdMz0R7VboQIUbX3FlM-lwTq-8" /> <meta name="author" content="Yegor Bugayenko"> <meta name="article:published_time" content="2017-01-17 00:00:00 +0000"> <meta name="og:site_name" content="Yegor Bugayenko"/> <meta name="og:type" content="article" /> <meta name="og:locale" content="en_US" /> <meta name="twitter:account_id" content="4503599630178231" /> <meta name="twitter:creator" content="@yegor256"/> <meta name="twitter:site" content="@yegor256"/> <meta name="twitter:title" property="og:title" content="Synchronized Decorators to Replace Thread-Safe Classes"/> <meta name="twitter:description" property="og:description" content="Don&apos;t make your classes thread-safe; instead, create thread-safe decorators to make thread safety configurable. "/> <meta name="twitter:url" property="og:url" content="https://www.yegor256.com/2017/01/17/synchronized-decorators.html"/> <meta name="telegram:channel" content="AAAAAEJFMRzsRTRxM3ec6A"/> <link rel="search" type="application/opensearchdescription+xml" href="/opensearch.xml" title="yegor256" /> <link rel="shortcut icon" href="/favicon.ico?4e047f6f42b"/> <link rel="apple-touch-icon" href="/favicon.ico?4e047f6f42b"/> <link rel="alternate" type="application/rss+xml" title="RSS for yegor256.com" href="https://www.yegor256.com/rss.xml"/> <link rel="stylesheet" href="/css/layout.css?4e047f6f42b"/> <link rel="stylesheet" href="/css/icons.css?4e047f6f42b"/> <link rel="canonical" href="https://www.yegor256.com/2017/01/17/synchronized-decorators.html" /> <link rel="amphtml" href="https://www.yegor256.com/2017/01/17/synchronized-decorators.amp.html" /> <title>Synchronized Decorators to Replace Thread-Safe Classes </title> <meta name='og:image' content='https://www.yegor256.com/images/2017/01/aladdin.jpg'/><meta name='twitter:image' content='https://www.yegor256.com/images/2017/01/aladdin.jpg'/><meta name='og:image:width' content='1200'/> <meta name='twitter:image:width' content='1200'/><meta name='og:image:height' content='679'/> <meta name='twitter:image:height' content='679'/><meta name='twitter:card' content='summary_large_image'/><meta name='twitter:image:alt' content='Aladdin (1992) by Ron Clements and John Musker'/> </head> <body><div class="wrapper"> <aside class="header-toggle unprintable" id="header-toggle" title="Show the menu" onclick="$('#header').show();$('#header-toggle').hide();">&#9776;</aside> <header class="header" id="header"><div class="face"> <a href="/about-me.html#form" class="sub" title="Click to subscribe to my monthly newsletter"><span>Subscribe</span></a> <a href="/about-me.html" style="position:relative;"> <img src="/images/face-256x256.jpg" class="photo" alt="Yegor Bugayenko"/> </a></div><nav><ul class="menu social notranslate"> <li><a href="https://twitter.com/intent/follow?screen_name=yegor256" rel="nofollow" title="Follow me on Twitter"><i class="icon icon-twitter notranslate" aria-hidden="true"></i></a></li> <li><a href="/rss.xml" rel="nofollow" title="Subscribe to my RSS feed"><i class="icon icon-rss notranslate" aria-hidden="true"></i></a></li> <li><a itemprop="sameAs" href="https://github.com/yegor256" rel="nofollow" title="My GitHub profile"><i class="icon icon-github notranslate" aria-hidden="true"></i></a></li> <li><a itemprop="sameAs" href="http://stackoverflow.com/users/187141/yegor256" rel="nofollow" title="My StackOverflow profile"><i class="icon icon-stackoverflow notranslate" aria-hidden="true"></i></a></li> <li><a itemprop="sameAs" href="https://www.facebook.com/yegor256" rel="nofollow" title="Follow me on Facebook"><i class="icon icon-facebook notranslate" aria-hidden="true"></i></a></li> <li><a itemprop="sameAs" href="https://instagram.com/yegor256" rel="nofollow" title="Follow me on Instagram"><i class="icon icon-instagram notranslate" aria-hidden="true"></i></a></li> <li><a itemprop="sameAs" href="https://www.linkedin.com/in/yegor256" rel="nofollow" title="My LinkedIn profile"><i class="icon icon-linkedin notranslate" aria-hidden="true"></i></a></li> <li><a itemprop="sameAs" href="https://www.youtube.com/c/yegor256?sub_confirmation=1" rel="nofollow" title="My Youtube video channel"><i class="icon icon-youtube notranslate" aria-hidden="true"></i></a></li> <li><a itemprop="sameAs" href="https://www.pinterest.com/yegor256/" rel="nofollow" title="My Pinterest boards"><i class="icon icon-pinterest notranslate" aria-hidden="true"></i></a></li> <li><a itemprop="sameAs" href="https://angel.co/yegor256" rel="nofollow" title="My AngelList profile"><i class="icon icon-angellist notranslate" aria-hidden="true"></i></a></li> <li><a href="https://soundcloud.com/yegor256" rel="nofollow" title="My podcast"><i class="icon icon-podcast notranslate" aria-hidden="true"></i></a></li> <li><a href="https://itunes.apple.com/us/podcast/yegor256-podcast/id1150826721" rel="nofollow" title="My iTunes podcast"><i class="icon icon-itunes notranslate" aria-hidden="true"></i></a></li> <li><a href="https://t.me/joinchat/AAAAAEJFMRzsRTRxM3ec6A" rel="nofollow" title="My Telegram public channel"><i class="icon icon-telegram notranslate" aria-hidden="true"></i></a></li> <li><a href="mailto:blog@yegor256.com" rel="nofollow" title="Email me any time"><i class="icon icon-mail notranslate" aria-hidden="true"></i></a></li></ul><ul class="menu"> <li><a href="/" title="Home page">Home</a></li> <li ><a href="/best.html" title="Best articles to read">12&#160;Best</a></li> <li ><a href="/contents.html" title="The contents of the entire blog">All&#160;288</a></li> <li ><a href="/webinars.html" title="My webinars">Webinars</a></li> <li ><a href="/talks.html" title="Future and past conference talks">Talks</a></li> <li ><a href="/books.html" title="The books I wrote">Books</a></li> <li ><a href="/papers.html" title="My academic papers and patents">Papers</a></li> <li ><a href="/pets.html" title="My loved pet projects">Pets</a></li> <li ><a href="/award.html" title="Software quality award">Award</a></li> <li ><a href="/testimonials.html" title="What some people say about me">Testimonials</a></li> <li ><a href="/shift-m.html" title="Audio podcast about project management">Shift-M</a></li> <li ><a href="/paintings.html" title="My paintings for sale">Paintings</a></li> <li><a href="http://ru.yegor256.com/" title="Немного на русском языке">По-русски</a></li></ul></nav><div class="search"> <form method="get" action="https://www.google.com/search" itemprop="potentialAction" itemscope="" itemtype="http://schema.org/SearchAction"> <meta itemprop="target" content="https://www.google.com/search?q={q}"/> <input name="sitesearch" value="yegor256.com" type="hidden"/> <input itemprop="query-input" type="text" id="search-query" class="field field-text" required="required" onfocus="$('.google').css('visibility', 'visible');" name="q" placeholder="Search..." autocomplete="off"/> <input type="image" src="/images/google-search-icon.svg" class="google" title="Search via Google" alt="Search via Google"/> </form></div><div class="hot"><ul> <li> <a href="/code-ahead.html">Code Ahead</a> was published on Amazon just a few days ago! It is my new book, a novel about programmers. It explains in details the majority of ideas that stand behind <a href="https://www.zerocracy.com">Zerocracy</a> and <a href="https://www.xdsd.org">XDSD</a>. </li> <li> At <a href="/webinars.html">Webinar #37</a> we will discuss naming problem in OOP, for objects, methods and attributes; join us on <b>September 12</b>, at 11am PST. </li></ul></div></header></div><section itemscope="" itemtype="http://schema.org/BlogPosting"><div class="wrapper"> <header><p class="printable"> <img src="https://api.qrserver.com/v1/create-qr-code/?data=https://www.yegor256.com/2017/01/17/synchronized-decorators.html&amp;format=svg" style="width:125px;height:125px;" alt="QR code"/></p><p class="printable"> <code itemprop="url">https://www.yegor256.com/2017/01/17/synchronized-decorators.html</code></p><h1 itemprop="name headline mainEntityOfPage">Synchronized Decorators to Replace Thread-Safe Classes</h1><ul class="subline"> <li> <time itemprop="datePublished" datetime="2017-01-17T00:00:00+00:00"> 17 January 2017 </time> </li> <li class="desktop-only" itemprop="locationCreated">Odessa, Ukraine</li> <li class="printable" itemscope="" itemprop="author" itemtype="http://schema.org/Person"> <span itemprop="name">Yegor Bugayenko</span> </li> <li class="unprintable"> <i class="icon icon-comments"></i> <a href="http://www.yegor256.com/2017/01/17/synchronized-decorators.html#disqus_thread" itemprop="discussionUrl">comments</a> </li></ul><figure class='jb_picture'><img itemprop='image' alt='Aladdin (1992) by Ron Clements and John Musker' src='/images/2017/01/aladdin.jpg' longdesc='#f5aa3c20'/><figcaption id='f5aa3c20'>Aladdin (1992) by Ron Clements and John Musker</figcaption></figure><p>Let&#39;s start with an example (it&#39;s <a href="/2014/06/09/objects-should-be-immutable.html">mutable</a>, by the way):</p><figure class="highlight"><pre><code class="language-java" data-lang="java"><span></span><span class="kd">class</span> <span class="nc">Position</span> <span class="o">{</span>
  <span class="kd">private</span> <span class="kt">int</span> <span class="n">number</span> <span class="o">=</span> <span class="mi">0</span><span class="o">;</span>
  <span class="nd">@Override</span>
  <span class="kd">public</span> <span class="kt">void</span> <span class="nf">increment</span><span class="o">()</span> <span class="o">{</span>
    <span class="kt">int</span> <span class="n">before</span> <span class="o">=</span> <span class="k">this</span><span class="o">.</span><span class="na">number</span><span class="o">;</span>
    <span class="kt">int</span> <span class="n">after</span> <span class="o">=</span> <span class="n">before</span> <span class="o">+</span> <span class="mi">1</span><span class="o">;</span>
    <span class="k">this</span><span class="o">.</span><span class="na">number</span> <span class="o">=</span> <span class="n">after</span><span class="o">;</span>
  <span class="o">}</span>
<span class="o">}</span></code></pre></figure><p>What do you think---is it <a href="https://en.wikipedia.org/wiki/Thread_safety">thread-safe</a>? This term refers to whether an object of this class will operate without mistakes when used by multiple threads at the same time. Let&#39;s say we have two threads working with the same object, <code>position</code>, and calling its method <code>increment()</code> at exactly the same moment in time.</p><p>We expect the <code>number</code> integer to be equal to 2 when both threads finish up, because each of them will increment it once, right? However, most likely this won&#39;t happen.</p><aside class='youtube'> <a href='https://www.youtube.com/watch?v=rC17YwowURQ'><div class='box'> <img src='https://i.ytimg.com/vi/rC17YwowURQ/mqdefault.jpg' alt='YouTube video #rC17YwowURQ'/><div class='play'><i class='icon icon-play'></i></div></div></a><div>Synchronized Decorators for Thread-Safety (Webinar #32); 7 February 2018.</div></aside><p>Let&#39;s see what will happen. In both threads, <code>before</code> will equal <code>0</code> when they start. Then <code>after</code> will be set to <code>1</code>. Then, both threads will do <code>this.number = 1</code> and we will end up with <code>1</code> in <code>number</code> instead of the expected <code>2</code>. See the problem? Classes with such a flaw in their design are <strong>not thread-safe</strong>.</p><p>The simplest and most obvious solution is to make our method <a href="https://docs.oracle.com/javase/tutorial/essential/concurrency/syncmeth.html"><code>synchronized</code></a>. That will guarantee that no matter how many threads call it at the same time, they will all go sequentially, not in parallel: one thread after another. Of course, it will take longer, but it will prevent that mistake from happening:</p><figure class="highlight"><pre><code class="language-java" data-lang="java"><span></span><span class="kd">class</span> <span class="nc">Position</span> <span class="o">{</span>
  <span class="kd">private</span> <span class="kt">int</span> <span class="n">number</span> <span class="o">=</span> <span class="mi">0</span><span class="o">;</span>
  <span class="nd">@Override</span>
  <span class="kd">public</span> <span class="kd">synchronized</span> <span class="kt">void</span> <span class="nf">increment</span><span class="o">()</span> <span class="o">{</span>
    <span class="kt">int</span> <span class="n">before</span> <span class="o">=</span> <span class="k">this</span><span class="o">.</span><span class="na">number</span><span class="o">;</span>
    <span class="kt">int</span> <span class="n">after</span> <span class="o">=</span> <span class="n">before</span> <span class="o">+</span> <span class="mi">1</span><span class="o">;</span>
    <span class="k">this</span><span class="o">.</span><span class="na">number</span> <span class="o">=</span> <span class="n">after</span><span class="o">;</span>
  <span class="o">}</span>
<span class="o">}</span></code></pre></figure><p>A class that guarantees it won&#39;t break no matter how many threads are working with it is called <strong>thread-safe</strong>.</p><p>Now the question is: Do we have to make all classes thread-safe or only some of them? It would seem to be better to have all classes error-free, right? Why would anyone want an object that may break at some point? Well, not exactly. Remember, there is a performance concern involved; we don&#39;t often have multiple threads, and we always want our objects to run as fast as possible. A between-threads synchronization mechanism will definitely slow us down.</p><p>I think the right approach is to have two classes. The first one is not thread-safe, while the other one is a <strong>synchronized decorator</strong>, which would look like this:</p><figure class="highlight"><pre><code class="language-java" data-lang="java"><span></span><span class="kd">class</span> <span class="nc">SyncPosition</span> <span class="kd">implements</span> <span class="n">Position</span> <span class="o">{</span>
  <span class="kd">private</span> <span class="kd">final</span> <span class="n">Position</span> <span class="n">origin</span><span class="o">;</span>
  <span class="n">SyncPosition</span><span class="o">(</span><span class="n">Position</span> <span class="n">pos</span><span class="o">)</span> <span class="o">{</span>
    <span class="k">this</span><span class="o">.</span><span class="na">origin</span> <span class="o">=</span> <span class="n">pos</span><span class="o">;</span>
  <span class="o">}</span>
  <span class="nd">@Override</span>
  <span class="kd">public</span> <span class="kd">synchronized</span> <span class="kt">void</span> <span class="nf">increment</span><span class="o">()</span> <span class="o">{</span>
    <span class="k">this</span><span class="o">.</span><span class="na">origin</span><span class="o">.</span><span class="na">increment</span><span class="o">();</span>
  <span class="o">}</span>
<span class="o">}</span></code></pre></figure><p>Now, when we need our <code>position</code> object to be thread-safe, we decorate it with <code>SyncPosition</code>:</p><figure class="highlight"><pre><code class="language-java" data-lang="java"><span></span><span class="n">Position</span> <span class="n">position</span> <span class="o">=</span> <span class="k">new</span> <span class="n">SyncPosition</span><span class="o">(</span>
  <span class="k">new</span> <span class="n">SimplePosition</span><span class="o">()</span>
<span class="o">);</span></code></pre></figure><p>When we need a plain simple position, without any thread safety, we do this:</p><figure class="highlight"><pre><code class="language-java" data-lang="java"><span></span><span class="n">Position</span> <span class="n">position</span> <span class="o">=</span> <span class="k">new</span> <span class="n">SimplePosition</span><span class="o">();</span></code></pre></figure><p>Making class functionality both rich <em>and</em> thread-safe is, in my opinion, a violation of that famous <a href="https://en.wikipedia.org/wiki/Single_responsibility_principle">single responsibility principle</a>.</p><p>By the way, this problem is very close to the one of <a href="/2016/01/26/defensive-programming.html">defensive programming</a> and validators.</p></p>--> <nav class="buttons notranslate desktop-only"> <a href="http://www.facebook.com/sharer/sharer.php?u=https://www.yegor256.com/2017/01/17/synchronized-decorators.html" title="Share on Facebook" class="button" rel="nofollow"> <span class="count count-facebook">0</span> <i class="icon icon-facebook notranslate" aria-hidden="true"></i> </a> <a href="https://twitter.com/share?url=https://www.yegor256.com/2017/01/17/synchronized-decorators.html&amp;text=Synchronized+Decorators+to+Replace+Thread-Safe+Classes" title="Share on Twitter" class="button" rel="nofollow"> <span class="count count-twitter">0</span> <i class="icon icon-twitter notranslate" aria-hidden="true"></i> </a> <a href="https://plus.google.com/share?url=https://www.yegor256.com/2017/01/17/synchronized-decorators.html" title="Share on Google+" class="button" rel="nofollow"> <span class="count count-googleplus">0</span> <i class="icon icon-googleplus notranslate" aria-hidden="true"></i> </a> <a href="https://www.linkedin.com/cws/share?url=https://www.yegor256.com/2017/01/17/synchronized-decorators.html" title="Share on LinkedIn" class="button" rel="nofollow"> <span class="count count-linkedin">0</span> <i class="icon icon-linkedin notranslate" aria-hidden="true"></i> </a> <a href="http://reddit.com/submit?url=https://www.yegor256.com/2017/01/17/synchronized-decorators.html%3F2017-03&amp;title=Synchronized+Decorators+to+Replace+Thread-Safe+Classes" title="Share on Reddit" class="button" rel="nofollow"> <span class="count count-reddit">0</span> <i class="icon icon-reddit notranslate" aria-hidden="true"></i> </a> <a href="http://news.ycombinator.com/submitlink?u=https://www.yegor256.com/2017/01/17/synchronized-decorators.html%3F2017-03&amp;t=Synchronized+Decorators+to+Replace+Thread-Safe+Classes" title="Share on Hacker News" class="button" rel="nofollow"> <span class="count count-hackernews">0</span> <i class="icon icon-hackernews notranslate" aria-hidden="true"></i> </a> </nav> </header> <article class="main" itemprop="articleBody"><div ><p>You know what thread safety is, right? If not, there is a simple example below. All classes must be thread-safe, right? Not really. Some of them have to be thread-safe? Wrong again. I think none of them have to be thread-safe, while all of them have to provide synchronized decorators.</p><figure class='jb_picture'><img itemprop='image' alt='Aladdin (1992) by Ron Clements and John Musker' src='/images/2017/01/aladdin.jpg' longdesc='#f5aa3c20'/><figcaption id='f5aa3c20'>Aladdin (1992) by Ron Clements and John Musker</figcaption></figure><p>Let&#39;s start with an example (it&#39;s <a href="/2014/06/09/objects-should-be-immutable.html">mutable</a>, by the way):</p><figure class="highlight"><pre><code class="language-java" data-lang="java"><span></span><span class="kd">class</span> <span class="nc">Position</span> <span class="o">{</span>
  <span class="kd">private</span> <span class="kt">int</span> <span class="n">number</span> <span class="o">=</span> <span class="mi">0</span><span class="o">;</span>
  <span class="nd">@Override</span>
  <span class="kd">public</span> <span class="kt">void</span> <span class="nf">increment</span><span class="o">()</span> <span class="o">{</span>
    <span class="kt">int</span> <span class="n">before</span> <span class="o">=</span> <span class="k">this</span><span class="o">.</span><span class="na">number</span><span class="o">;</span>
    <span class="kt">int</span> <span class="n">after</span> <span class="o">=</span> <span class="n">before</span> <span class="o">+</span> <span class="mi">1</span><span class="o">;</span>
    <span class="k">this</span><span class="o">.</span><span class="na">number</span> <span class="o">=</span> <span class="n">after</span><span class="o">;</span>
  <span class="o">}</span>
<span class="o">}</span></code></pre></figure><p>What do you think---is it <a href="https://en.wikipedia.org/wiki/Thread_safety">thread-safe</a>? This term refers to whether an object of this class will operate without mistakes when used by multiple threads at the same time. Let&#39;s say we have two threads working with the same object, <code>position</code>, and calling its method <code>increment()</code> at exactly the same moment in time.</p><p>We expect the <code>number</code> integer to be equal to 2 when both threads finish up, because each of them will increment it once, right? However, most likely this won&#39;t happen.</p><aside class='youtube'> <a href='https://www.youtube.com/watch?v=rC17YwowURQ'><div class='box'> <img src='https://i.ytimg.com/vi/rC17YwowURQ/mqdefault.jpg' alt='YouTube video #rC17YwowURQ'/><div class='play'><i class='icon icon-play'></i></div></div></a><div>Synchronized Decorators for Thread-Safety (Webinar #32); 7 February 2018.</div></aside><p>Let&#39;s see what will happen. In both threads, <code>before</code> will equal <code>0</code> when they start. Then <code>after</code> will be set to <code>1</code>. Then, both threads will do <code>this.number = 1</code> and we will end up with <code>1</code> in <code>number</code> instead of the expected <code>2</code>. See the problem? Classes with such a flaw in their design are <strong>not thread-safe</strong>.</p><p>The simplest and most obvious solution is to make our method <a href="https://docs.oracle.com/javase/tutorial/essential/concurrency/syncmeth.html"><code>synchronized</code></a>. That will guarantee that no matter how many threads call it at the same time, they will all go sequentially, not in parallel: one thread after another. Of course, it will take longer, but it will prevent that mistake from happening:</p><figure class="highlight"><pre><code class="language-java" data-lang="java"><span></span><span class="kd">class</span> <span class="nc">Position</span> <span class="o">{</span>
  <span class="kd">private</span> <span class="kt">int</span> <span class="n">number</span> <span class="o">=</span> <span class="mi">0</span><span class="o">;</span>
  <span class="nd">@Override</span>
  <span class="kd">public</span> <span class="kd">synchronized</span> <span class="kt">void</span> <span class="nf">increment</span><span class="o">()</span> <span class="o">{</span>
    <span class="kt">int</span> <span class="n">before</span> <span class="o">=</span> <span class="k">this</span><span class="o">.</span><span class="na">number</span><span class="o">;</span>
    <span class="kt">int</span> <span class="n">after</span> <span class="o">=</span> <span class="n">before</span> <span class="o">+</span> <span class="mi">1</span><span class="o">;</span>
    <span class="k">this</span><span class="o">.</span><span class="na">number</span> <span class="o">=</span> <span class="n">after</span><span class="o">;</span>
  <span class="o">}</span>
<span class="o">}</span></code></pre></figure><p>A class that guarantees it won&#39;t break no matter how many threads are working with it is called <strong>thread-safe</strong>.</p><p>Now the question is: Do we have to make all classes thread-safe or only some of them? It would seem to be better to have all classes error-free, right? Why would anyone want an object that may break at some point? Well, not exactly. Remember, there is a performance concern involved; we don&#39;t often have multiple threads, and we always want our objects to run as fast as possible. A between-threads synchronization mechanism will definitely slow us down.</p><p>I think the right approach is to have two classes. The first one is not thread-safe, while the other one is a <strong>synchronized decorator</strong>, which would look like this:</p><figure class="highlight"><pre><code class="language-java" data-lang="java"><span></span><span class="kd">class</span> <span class="nc">SyncPosition</span> <span class="kd">implements</span> <span class="n">Position</span> <span class="o">{</span>
  <span class="kd">private</span> <span class="kd">final</span> <span class="n">Position</span> <span class="n">origin</span><span class="o">;</span>
  <span class="n">SyncPosition</span><span class="o">(</span><span class="n">Position</span> <span class="n">pos</span><span class="o">)</span> <span class="o">{</span>
    <span class="k">this</span><span class="o">.</span><span class="na">origin</span> <span class="o">=</span> <span class="n">pos</span><span class="o">;</span>
  <span class="o">}</span>
  <span class="nd">@Override</span>
  <span class="kd">public</span> <span class="kd">synchronized</span> <span class="kt">void</span> <span class="nf">increment</span><span class="o">()</span> <span class="o">{</span>
    <span class="k">this</span><span class="o">.</span><span class="na">origin</span><span class="o">.</span><span class="na">increment</span><span class="o">();</span>
  <span class="o">}</span>
<span class="o">}</span></code></pre></figure><p>Now, when we need our <code>position</code> object to be thread-safe, we decorate it with <code>SyncPosition</code>:</p><figure class="highlight"><pre><code class="language-java" data-lang="java"><span></span><span class="n">Position</span> <span class="n">position</span> <span class="o">=</span> <span class="k">new</span> <span class="n">SyncPosition</span><span class="o">(</span>
  <span class="k">new</span> <span class="n">SimplePosition</span><span class="o">()</span>
<span class="o">);</span></code></pre></figure><p>When we need a plain simple position, without any thread safety, we do this:</p><figure class="highlight"><pre><code class="language-java" data-lang="java"><span></span><span class="n">Position</span> <span class="n">position</span> <span class="o">=</span> <span class="k">new</span> <span class="n">SimplePosition</span><span class="o">();</span></code></pre></figure><p>Making class functionality both rich <em>and</em> thread-safe is, in my opinion, a violation of that famous <a href="https://en.wikipedia.org/wiki/Single_responsibility_principle">single responsibility principle</a>.</p><p>By the way, this problem is very close to the one of <a href="/2016/01/26/defensive-programming.html">defensive programming</a> and validators.</p></div></article></div><div class="wrapper"> <related-posts /></div><div class="disqus" role="complementary"><p class="disqus_hint"> Please, use <a href="https://help.disqus.com/commenting/what-html-tags-are-allowed-within-comments">syntax highlighting</a> in your comments, to make them more readable.</p><div id="disqus_thread" class="disqus-thread"> <a>&nbsp;</a></div><script> var disqus_config = function () { this.page.url = document.location.href.split('?')[0].split('#')[0].replace('https://', 'http://'); this.page.identifier = this.page.url; }; (function() { var d = document, s = d.createElement('script'); s.src = '//yegor256.disqus.com/embed.js'; s.setAttribute('data-timestamp', +new Date()); (d.head || d.body).appendChild(s); })(); </script> <noscript><div><p class="red"> JavaScript is disabled in your browser, that's why you can't see comments under this post.</p></div></noscript></div><div class="wrapper"> <footer class="footer"><p> &copy; <span itemscope="" itemprop="copyrightHolder" itemtype="http://schema.org/Person"> <span itemprop="name">Yegor Bugayenko</span> </span> 2014&ndash;<span itemprop="copyrightYear">2018</span></p></footer></div></section><div class="wrapper unprintable" style="text-align:center;margin-top:2em;"> <a href="http://www.sixnines.io/h/3ba1652f"> <img src="//www.sixnines.io/b/3ba1652f?style=flat" alt="sixnines availability badge"/> </a></div><script src="//code.jquery.com/jquery-1.9.0.min.js"></script> <script src="/js/all.js?4e047f6f42b"></script> <script>var disqus_shortname = 'yegor256';</script> <script id="dsq-count-scr" src="//yegor256.disqus.com/count.js" async="async"></script> <script> (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){ (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o), m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m) })(window,document,'script','//www.google-analytics.com/analytics.js','ga'); ga('create', 'UA-1963507-32', 'auto'); ga('send', 'pageview'); </script> <script> Cd=document;Cr="&"+Math.random();Cp="&s=1"; Cd.cookie="b=b";if(Cd.cookie)Cp+="&c=1"; Cp+="&t="+(new Date()).getTimezoneOffset(); if(self!=top)Cp+="&f=1"; </script> <script> if(navigator.javaEnabled())Cp+="&j=1"; </script> <script> if(typeof(screen)!='undefined')Cp+="&w="+screen.width+"&h="+ screen.height+"&d="+(screen.colorDepth?screen.colorDepth:screen.pixelDepth); </script> <script> Cd.write("<img src='//c.hit.ua/hit?i=95870&g=0&x=2"+Cp+Cr+ "&r="+escape(Cd.referrer)+"&u="+escape(window.location.href)+ "' border='0' wi"+"dth='1' he"+"ight='1'/>"); </script> <script type="application/ld+json"> { "@context": "http://schema.org", "@type": "Person", "name": "Yegor Bugayenko", "url": "http://www.yegor256.com", "sameAs": [ "https://www.facebook.com/yegor256", "https://instagram.com/yegor256", "https://www.linkedin.com/in/yegor256", "https://twitter.com/yegor256", "https://github.com/yegor256", "https://www.pinterest.com/yegor256/" ] } </script> </body> </html> <!DOCTYPE html> <html xmlns="http://www.w3.org/1999/xhtml" lang="en-US" xml:lang="en-US" itemscope="" itemtype="http://schema.org/WebSite"> <head> <meta charset="utf-8"/> <meta name="description" content="Can you have encapsulation with only objects and no naked data? The question boils down to how objects can interact without data. They can be friends! " /> <meta name="keywords" content="encapsulation, encapsulation friends, encapsulation meaning, encapsulation trusted objects, encapsulation violation" /> <meta name="viewport" content="width=device-width,minimum-scale=1,initial-scale=1"/> <meta name="google-site-verification" content="JEj_gQr2CPe2QKGw8XdMz0R7VboQIUbX3FlM-lwTq-8" /> <meta name="author" content="Yegor Bugayenko"> <meta name="article:published_time" content="2016-12-20 00:00:00 +0000"> <meta name="og:site_name" content="Yegor Bugayenko"/> <meta name="og:type" content="article" /> <meta name="og:locale" content="en_US" /> <meta name="twitter:account_id" content="4503599630178231" /> <meta name="twitter:creator" content="@yegor256"/> <meta name="twitter:site" content="@yegor256"/> <meta name="twitter:title" property="og:title" content="Can Objects Be Friends?"/> <meta name="twitter:description" property="og:description" content="Can you have encapsulation with only objects and no naked data? The question boils down to how objects can interact without data. They can be friends! "/> <meta name="twitter:url" property="og:url" content="https://www.yegor256.com/2016/12/20/can-objects-be-friends.html"/> <meta name="telegram:channel" content="AAAAAEJFMRzsRTRxM3ec6A"/> <link rel="search" type="application/opensearchdescription+xml" href="/opensearch.xml" title="yegor256" /> <link rel="shortcut icon" href="/favicon.ico?4e047f6f42b"/> <link rel="apple-touch-icon" href="/favicon.ico?4e047f6f42b"/> <link rel="alternate" type="application/rss+xml" title="RSS for yegor256.com" href="https://www.yegor256.com/rss.xml"/> <link rel="stylesheet" href="/css/layout.css?4e047f6f42b"/> <link rel="stylesheet" href="/css/icons.css?4e047f6f42b"/> <link rel="canonical" href="https://www.yegor256.com/2016/12/20/can-objects-be-friends.html" /> <link rel="amphtml" href="https://www.yegor256.com/2016/12/20/can-objects-be-friends.amp.html" /> <title>Can Objects Be Friends? </title> <meta name='og:image' content='https://www.yegor256.com/images/2016/12/raging-bull.jpg'/><meta name='twitter:image' content='https://www.yegor256.com/images/2016/12/raging-bull.jpg'/><meta name='og:image:width' content='1280'/> <meta name='twitter:image:width' content='1280'/><meta name='og:image:height' content='688'/> <meta name='twitter:image:height' content='688'/><meta name='twitter:card' content='summary_large_image'/><meta name='twitter:image:alt' content='Raging Bull (1980) by Martin Scorsese'/> </head> <body><div class="wrapper"> <aside class="header-toggle unprintable" id="header-toggle" title="Show the menu" onclick="$('#header').show();$('#header-toggle').hide();">&#9776;</aside> <header class="header" id="header"><div class="face"> <a href="/about-me.html#form" class="sub" title="Click to subscribe to my monthly newsletter"><span>Subscribe</span></a> <a href="/about-me.html" style="position:relative;"> <img src="/images/face-256x256.jpg" class="photo" alt="Yegor Bugayenko"/> </a></div><nav><ul class="menu social notranslate"> <li><a href="https://twitter.com/intent/follow?screen_name=yegor256" rel="nofollow" title="Follow me on Twitter"><i class="icon icon-twitter notranslate" aria-hidden="true"></i></a></li> <li><a href="/rss.xml" rel="nofollow" title="Subscribe to my RSS feed"><i class="icon icon-rss notranslate" aria-hidden="true"></i></a></li> <li><a itemprop="sameAs" href="https://github.com/yegor256" rel="nofollow" title="My GitHub profile"><i class="icon icon-github notranslate" aria-hidden="true"></i></a></li> <li><a itemprop="sameAs" href="http://stackoverflow.com/users/187141/yegor256" rel="nofollow" title="My StackOverflow profile"><i class="icon icon-stackoverflow notranslate" aria-hidden="true"></i></a></li> <li><a itemprop="sameAs" href="https://www.facebook.com/yegor256" rel="nofollow" title="Follow me on Facebook"><i class="icon icon-facebook notranslate" aria-hidden="true"></i></a></li> <li><a itemprop="sameAs" href="https://instagram.com/yegor256" rel="nofollow" title="Follow me on Instagram"><i class="icon icon-instagram notranslate" aria-hidden="true"></i></a></li> <li><a itemprop="sameAs" href="https://www.linkedin.com/in/yegor256" rel="nofollow" title="My LinkedIn profile"><i class="icon icon-linkedin notranslate" aria-hidden="true"></i></a></li> <li><a itemprop="sameAs" href="https://www.youtube.com/c/yegor256?sub_confirmation=1" rel="nofollow" title="My Youtube video channel"><i class="icon icon-youtube notranslate" aria-hidden="true"></i></a></li> <li><a itemprop="sameAs" href="https://www.pinterest.com/yegor256/" rel="nofollow" title="My Pinterest boards"><i class="icon icon-pinterest notranslate" aria-hidden="true"></i></a></li> <li><a itemprop="sameAs" href="https://angel.co/yegor256" rel="nofollow" title="My AngelList profile"><i class="icon icon-angellist notranslate" aria-hidden="true"></i></a></li> <li><a href="https://soundcloud.com/yegor256" rel="nofollow" title="My podcast"><i class="icon icon-podcast notranslate" aria-hidden="true"></i></a></li> <li><a href="https://itunes.apple.com/us/podcast/yegor256-podcast/id1150826721" rel="nofollow" title="My iTunes podcast"><i class="icon icon-itunes notranslate" aria-hidden="true"></i></a></li> <li><a href="https://t.me/joinchat/AAAAAEJFMRzsRTRxM3ec6A" rel="nofollow" title="My Telegram public channel"><i class="icon icon-telegram notranslate" aria-hidden="true"></i></a></li> <li><a href="mailto:blog@yegor256.com" rel="nofollow" title="Email me any time"><i class="icon icon-mail notranslate" aria-hidden="true"></i></a></li></ul><ul class="menu"> <li><a href="/" title="Home page">Home</a></li> <li ><a href="/best.html" title="Best articles to read">12&#160;Best</a></li> <li ><a href="/contents.html" title="The contents of the entire blog">All&#160;288</a></li> <li ><a href="/webinars.html" title="My webinars">Webinars</a></li> <li ><a href="/talks.html" title="Future and past conference talks">Talks</a></li> <li ><a href="/books.html" title="The books I wrote">Books</a></li> <li ><a href="/papers.html" title="My academic papers and patents">Papers</a></li> <li ><a href="/pets.html" title="My loved pet projects">Pets</a></li> <li ><a href="/award.html" title="Software quality award">Award</a></li> <li ><a href="/testimonials.html" title="What some people say about me">Testimonials</a></li> <li ><a href="/shift-m.html" title="Audio podcast about project management">Shift-M</a></li> <li ><a href="/paintings.html" title="My paintings for sale">Paintings</a></li> <li><a href="http://ru.yegor256.com/" title="Немного на русском языке">По-русски</a></li></ul></nav><div class="search"> <form method="get" action="https://www.google.com/search" itemprop="potentialAction" itemscope="" itemtype="http://schema.org/SearchAction"> <meta itemprop="target" content="https://www.google.com/search?q={q}"/> <input name="sitesearch" value="yegor256.com" type="hidden"/> <input itemprop="query-input" type="text" id="search-query" class="field field-text" required="required" onfocus="$('.google').css('visibility', 'visible');" name="q" placeholder="Search..." autocomplete="off"/> <input type="image" src="/images/google-search-icon.svg" class="google" title="Search via Google" alt="Search via Google"/> </form></div><div class="hot"><ul> <li> <a href="/code-ahead.html">Code Ahead</a> was published on Amazon just a few days ago! It is my new book, a novel about programmers. It explains in details the majority of ideas that stand behind <a href="https://www.zerocracy.com">Zerocracy</a> and <a href="https://www.xdsd.org">XDSD</a>. </li> <li> At <a href="/webinars.html">Webinar #37</a> we will discuss naming problem in OOP, for objects, methods and attributes; join us on <b>September 12</b>, at 11am PST. </li></ul></div></header></div><section itemscope="" itemtype="http://schema.org/BlogPosting"><div class="wrapper"> <header><p class="printable"> <img src="https://api.qrserver.com/v1/create-qr-code/?data=https://www.yegor256.com/2016/12/20/can-objects-be-friends.html&amp;format=svg" style="width:125px;height:125px;" alt="QR code"/></p><p class="printable"> <code itemprop="url">https://www.yegor256.com/2016/12/20/can-objects-be-friends.html</code></p><h1 itemprop="name headline mainEntityOfPage">Can Objects Be Friends?</h1><ul class="subline"> <li> <time itemprop="datePublished" datetime="2016-12-20T00:00:00+00:00"> 20 December 2016 </time> </li> <li class="desktop-only" itemprop="locationCreated">Moscow, Russia</li> <li class="printable" itemscope="" itemprop="author" itemtype="http://schema.org/Person"> <span itemprop="name">Yegor Bugayenko</span> </li> <li class="unprintable"> <i class="icon icon-comments"></i> <a href="http://www.yegor256.com/2016/12/20/can-objects-be-friends.html#disqus_thread" itemprop="discussionUrl">comments</a> </li></ul><figure class='jb_picture'><img itemprop='image' alt='Raging Bull (1980) by Martin Scorsese' src='/images/2016/12/raging-bull.jpg' longdesc='#52a9356c'/><figcaption id='52a9356c'>Raging Bull (1980) by Martin Scorsese</figcaption></figure><p>Say that this is our object:</p><figure class="highlight"><pre><code class="language-java" data-lang="java"><span></span><span class="kd">class</span> <span class="nc">Temperature</span> <span class="o">{</span>
  <span class="kd">private</span> <span class="kt">int</span> <span class="n">t</span><span class="o">;</span>
  <span class="kd">public</span> <span class="n">String</span> <span class="nf">toString</span><span class="o">()</span> <span class="o">{</span>
    <span class="k">return</span> <span class="n">String</span><span class="o">.</span><span class="na">format</span><span class="o">(</span><span class="s">&quot;%d C&quot;</span><span class="o">,</span> <span class="k">this</span><span class="o">.</span><span class="na">t</span><span class="o">);</span>
  <span class="o">}</span>
<span class="o">}</span></code></pre></figure><p>It represents a temperature. The only behavior it exposes is printing the temperature in Celsius. We don&#39;t want to expose <code>t</code>, because that will lead to the &quot;<a href="/2016/11/21/naked-data.html">naked data</a>&quot; problem. We want to keep <code>t</code> secret, and that&#39;s a good desire.</p><p>Now, we want to have the ability to print temperature in Fahrenheit. The most obvious approach would be to introduce another method, <code>toFahrenheitString()</code>, or add a Boolean flag to the object, which will change the behavior of method <code>toString()</code>, right? Either one of these solutions is better than adding a method <code>getT()</code>, but neither one is perfect.</p><p>What if we create this decorator:</p><figure class="highlight"><pre><code class="language-java" data-lang="java"><span></span><span class="kd">class</span> <span class="nc">TempFahrenheit</span> <span class="kd">implements</span> <span class="n">Temperature</span> <span class="o">{</span>
  <span class="kd">private</span> <span class="n">TempCelsius</span> <span class="n">origin</span><span class="o">;</span>
  <span class="kd">public</span> <span class="n">String</span> <span class="nf">toString</span><span class="o">()</span> <span class="o">{</span>
    <span class="k">return</span> <span class="n">String</span><span class="o">.</span><span class="na">format</span><span class="o">(</span>
      <span class="s">&quot;%d F&quot;</span><span class="o">,</span> <span class="k">this</span><span class="o">.</span><span class="na">origin</span><span class="o">.</span><span class="na">t</span> <span class="o">*</span> <span class="mf">1.8</span> <span class="o">+</span> <span class="mi">32</span>
    <span class="o">);</span>
  <span class="o">}</span>
<span class="o">}</span></code></pre></figure><p>It should work just great:</p><figure class="highlight"><pre><code class="language-java" data-lang="java"><span></span><span class="n">Temperature</span> <span class="n">t</span> <span class="o">=</span> <span class="k">new</span> <span class="n">TempFahrenheit</span><span class="o">(</span>
  <span class="k">new</span> <span class="n">TempCelsius</span><span class="o">(</span><span class="mi">35</span><span class="o">)</span>
<span class="o">);</span></code></pre></figure><p>The only problem is that it won&#39;t compile in Java, because class <code>TempFahrenheit</code> is not allowed to access private <code>t</code> in class <code>TempCelsius</code>. And if we make <code>t</code> public, everybody will be able to read it directly, and we&#39;ll have that &quot;naked data&quot; problem---a severe violation of encapsulation.</p><p>However, if we allow that access <em>only</em> to one class, everything will be fine. Something like this (won&#39;t work in Java; it&#39;s just a concept):</p><figure class="highlight"><pre><code class="language-java" data-lang="java"><span></span><span class="kd">class</span> <span class="nc">TempCelsius</span> <span class="o">{</span>
  <span class="n">trust</span> <span class="n">TempFahrenheit</span><span class="o">;</span> <span class="c1">// here!</span>
  <span class="kd">private</span> <span class="kt">int</span> <span class="n">t</span><span class="o">;</span>
  <span class="kd">public</span> <span class="n">String</span> <span class="nf">toString</span><span class="o">()</span> <span class="o">{</span>
    <span class="k">return</span> <span class="n">String</span><span class="o">.</span><span class="na">format</span><span class="o">(</span><span class="s">&quot;%d C&quot;</span><span class="o">,</span> <span class="k">this</span><span class="o">.</span><span class="na">t</span><span class="o">);</span>
  <span class="o">}</span>
<span class="o">}</span></code></pre></figure><p>Since this <code>trust</code> keyword is placed into the class that allows access, we won&#39;t have the &quot;naked data&quot; problem---we will always know exactly which objects posses knowledge about <code>t</code>. When we change something about <code>t</code>, we know exactly where to update the code.</p><p>What do you think?</p><p>P.S. After discussing this idea below in comments I <a href="http://www.yegor256.com/2016/12/20/can-objects-be-friends.html#comment-3068629632">started</a> to think that we don&#39;t need that <code>trust</code> keyword at all. Instead, we should just give all decorators access to all private attributes of an object.</p></p>--> <nav class="buttons notranslate desktop-only"> <a href="http://www.facebook.com/sharer/sharer.php?u=https://www.yegor256.com/2016/12/20/can-objects-be-friends.html" title="Share on Facebook" class="button" rel="nofollow"> <span class="count count-facebook">0</span> <i class="icon icon-facebook notranslate" aria-hidden="true"></i> </a> <a href="https://twitter.com/share?url=https://www.yegor256.com/2016/12/20/can-objects-be-friends.html&amp;text=Can+Objects+Be+Friends%3F" title="Share on Twitter" class="button" rel="nofollow"> <span class="count count-twitter">0</span> <i class="icon icon-twitter notranslate" aria-hidden="true"></i> </a> <a href="https://plus.google.com/share?url=https://www.yegor256.com/2016/12/20/can-objects-be-friends.html" title="Share on Google+" class="button" rel="nofollow"> <span class="count count-googleplus">0</span> <i class="icon icon-googleplus notranslate" aria-hidden="true"></i> </a> <a href="https://www.linkedin.com/cws/share?url=https://www.yegor256.com/2016/12/20/can-objects-be-friends.html" title="Share on LinkedIn" class="button" rel="nofollow"> <span class="count count-linkedin">0</span> <i class="icon icon-linkedin notranslate" aria-hidden="true"></i> </a> <a href="http://reddit.com/submit?url=https://www.yegor256.com/2016/12/20/can-objects-be-friends.html%3F2016-51&amp;title=Can+Objects+Be+Friends%3F" title="Share on Reddit" class="button" rel="nofollow"> <span class="count count-reddit">0</span> <i class="icon icon-reddit notranslate" aria-hidden="true"></i> </a> <a href="http://news.ycombinator.com/submitlink?u=https://www.yegor256.com/2016/12/20/can-objects-be-friends.html%3F2016-51&amp;t=Can+Objects+Be+Friends%3F" title="Share on Hacker News" class="button" rel="nofollow"> <span class="count count-hackernews">0</span> <i class="icon icon-hackernews notranslate" aria-hidden="true"></i> </a> </nav> </header> <article class="main" itemprop="articleBody"><div ><p>As <a href="/2016/11/21/naked-data.html">discussed before</a>, proper encapsulation leads to a complete absence of &quot;naked data.&quot; However, the question remains: How can objects interact if they can&#39;t exchange data? Eventually we have to expose some data in order to let other objects use it, right? Yes, that&#39;s true. However, I guess I have a solution that keeps encapsulation in place while allowing objects to interact.</p><figure class='jb_picture'><img itemprop='image' alt='Raging Bull (1980) by Martin Scorsese' src='/images/2016/12/raging-bull.jpg' longdesc='#52a9356c'/><figcaption id='52a9356c'>Raging Bull (1980) by Martin Scorsese</figcaption></figure><p>Say that this is our object:</p><figure class="highlight"><pre><code class="language-java" data-lang="java"><span></span><span class="kd">class</span> <span class="nc">Temperature</span> <span class="o">{</span>
  <span class="kd">private</span> <span class="kt">int</span> <span class="n">t</span><span class="o">;</span>
  <span class="kd">public</span> <span class="n">String</span> <span class="nf">toString</span><span class="o">()</span> <span class="o">{</span>
    <span class="k">return</span> <span class="n">String</span><span class="o">.</span><span class="na">format</span><span class="o">(</span><span class="s">&quot;%d C&quot;</span><span class="o">,</span> <span class="k">this</span><span class="o">.</span><span class="na">t</span><span class="o">);</span>
  <span class="o">}</span>
<span class="o">}</span></code></pre></figure><p>It represents a temperature. The only behavior it exposes is printing the temperature in Celsius. We don&#39;t want to expose <code>t</code>, because that will lead to the &quot;<a href="/2016/11/21/naked-data.html">naked data</a>&quot; problem. We want to keep <code>t</code> secret, and that&#39;s a good desire.</p><p>Now, we want to have the ability to print temperature in Fahrenheit. The most obvious approach would be to introduce another method, <code>toFahrenheitString()</code>, or add a Boolean flag to the object, which will change the behavior of method <code>toString()</code>, right? Either one of these solutions is better than adding a method <code>getT()</code>, but neither one is perfect.</p><p>What if we create this decorator:</p><figure class="highlight"><pre><code class="language-java" data-lang="java"><span></span><span class="kd">class</span> <span class="nc">TempFahrenheit</span> <span class="kd">implements</span> <span class="n">Temperature</span> <span class="o">{</span>
  <span class="kd">private</span> <span class="n">TempCelsius</span> <span class="n">origin</span><span class="o">;</span>
  <span class="kd">public</span> <span class="n">String</span> <span class="nf">toString</span><span class="o">()</span> <span class="o">{</span>
    <span class="k">return</span> <span class="n">String</span><span class="o">.</span><span class="na">format</span><span class="o">(</span>
      <span class="s">&quot;%d F&quot;</span><span class="o">,</span> <span class="k">this</span><span class="o">.</span><span class="na">origin</span><span class="o">.</span><span class="na">t</span> <span class="o">*</span> <span class="mf">1.8</span> <span class="o">+</span> <span class="mi">32</span>
    <span class="o">);</span>
  <span class="o">}</span>
<span class="o">}</span></code></pre></figure><p>It should work just great:</p><figure class="highlight"><pre><code class="language-java" data-lang="java"><span></span><span class="n">Temperature</span> <span class="n">t</span> <span class="o">=</span> <span class="k">new</span> <span class="n">TempFahrenheit</span><span class="o">(</span>
  <span class="k">new</span> <span class="n">TempCelsius</span><span class="o">(</span><span class="mi">35</span><span class="o">)</span>
<span class="o">);</span></code></pre></figure><p>The only problem is that it won&#39;t compile in Java, because class <code>TempFahrenheit</code> is not allowed to access private <code>t</code> in class <code>TempCelsius</code>. And if we make <code>t</code> public, everybody will be able to read it directly, and we&#39;ll have that &quot;naked data&quot; problem---a severe violation of encapsulation.</p><p>However, if we allow that access <em>only</em> to one class, everything will be fine. Something like this (won&#39;t work in Java; it&#39;s just a concept):</p><figure class="highlight"><pre><code class="language-java" data-lang="java"><span></span><span class="kd">class</span> <span class="nc">TempCelsius</span> <span class="o">{</span>
  <span class="n">trust</span> <span class="n">TempFahrenheit</span><span class="o">;</span> <span class="c1">// here!</span>
  <span class="kd">private</span> <span class="kt">int</span> <span class="n">t</span><span class="o">;</span>
  <span class="kd">public</span> <span class="n">String</span> <span class="nf">toString</span><span class="o">()</span> <span class="o">{</span>
    <span class="k">return</span> <span class="n">String</span><span class="o">.</span><span class="na">format</span><span class="o">(</span><span class="s">&quot;%d C&quot;</span><span class="o">,</span> <span class="k">this</span><span class="o">.</span><span class="na">t</span><span class="o">);</span>
  <span class="o">}</span>
<span class="o">}</span></code></pre></figure><p>Since this <code>trust</code> keyword is placed into the class that allows access, we won&#39;t have the &quot;naked data&quot; problem---we will always know exactly which objects posses knowledge about <code>t</code>. When we change something about <code>t</code>, we know exactly where to update the code.</p><p>What do you think?</p><p>P.S. After discussing this idea below in comments I <a href="http://www.yegor256.com/2016/12/20/can-objects-be-friends.html#comment-3068629632">started</a> to think that we don&#39;t need that <code>trust</code> keyword at all. Instead, we should just give all decorators access to all private attributes of an object.</p></div></article></div><div class="wrapper"> <related-posts /></div><div class="disqus" role="complementary"><p class="disqus_hint"> Please, use <a href="https://help.disqus.com/commenting/what-html-tags-are-allowed-within-comments">syntax highlighting</a> in your comments, to make them more readable.</p><div id="disqus_thread" class="disqus-thread"> <a>&nbsp;</a></div><script> var disqus_config = function () { this.page.url = document.location.href.split('?')[0].split('#')[0].replace('https://', 'http://'); this.page.identifier = this.page.url; }; (function() { var d = document, s = d.createElement('script'); s.src = '//yegor256.disqus.com/embed.js'; s.setAttribute('data-timestamp', +new Date()); (d.head || d.body).appendChild(s); })(); </script> <noscript><div><p class="red"> JavaScript is disabled in your browser, that's why you can't see comments under this post.</p></div></noscript></div><div class="wrapper"> <footer class="footer"><p> &copy; <span itemscope="" itemprop="copyrightHolder" itemtype="http://schema.org/Person"> <span itemprop="name">Yegor Bugayenko</span> </span> 2014&ndash;<span itemprop="copyrightYear">2018</span></p></footer></div></section><div class="wrapper unprintable" style="text-align:center;margin-top:2em;"> <a href="http://www.sixnines.io/h/3ba1652f"> <img src="//www.sixnines.io/b/3ba1652f?style=flat" alt="sixnines availability badge"/> </a></div><script src="//code.jquery.com/jquery-1.9.0.min.js"></script> <script src="/js/all.js?4e047f6f42b"></script> <script>var disqus_shortname = 'yegor256';</script> <script id="dsq-count-scr" src="//yegor256.disqus.com/count.js" async="async"></script> <script> (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){ (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o), m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m) })(window,document,'script','//www.google-analytics.com/analytics.js','ga'); ga('create', 'UA-1963507-32', 'auto'); ga('send', 'pageview'); </script> <script> Cd=document;Cr="&"+Math.random();Cp="&s=1"; Cd.cookie="b=b";if(Cd.cookie)Cp+="&c=1"; Cp+="&t="+(new Date()).getTimezoneOffset(); if(self!=top)Cp+="&f=1"; </script> <script> if(navigator.javaEnabled())Cp+="&j=1"; </script> <script> if(typeof(screen)!='undefined')Cp+="&w="+screen.width+"&h="+ screen.height+"&d="+(screen.colorDepth?screen.colorDepth:screen.pixelDepth); </script> <script> Cd.write("<img src='//c.hit.ua/hit?i=95870&g=0&x=2"+Cp+Cr+ "&r="+escape(Cd.referrer)+"&u="+escape(window.location.href)+ "' border='0' wi"+"dth='1' he"+"ight='1'/>"); </script> <script type="application/ld+json"> { "@context": "http://schema.org", "@type": "Person", "name": "Yegor Bugayenko", "url": "http://www.yegor256.com", "sameAs": [ "https://www.facebook.com/yegor256", "https://instagram.com/yegor256", "https://www.linkedin.com/in/yegor256", "https://twitter.com/yegor256", "https://github.com/yegor256", "https://www.pinterest.com/yegor256/" ] } </script> </body> </html> <!DOCTYPE html> <html xmlns="http://www.w3.org/1999/xhtml" lang="en-US" xml:lang="en-US" itemscope="" itemtype="http://schema.org/WebSite"> <head> <meta charset="utf-8"/> <meta name="description" content="MVC is a very popular architectural design pattern that goes absolutely against the spirit of object-oriented programming. " /> <meta name="keywords" content="mvc, mvc design pattern, mvc design pattern in java, mvc in java, mvc java" /> <meta name="viewport" content="width=device-width,minimum-scale=1,initial-scale=1"/> <meta name="google-site-verification" content="JEj_gQr2CPe2QKGw8XdMz0R7VboQIUbX3FlM-lwTq-8" /> <meta name="author" content="Yegor Bugayenko"> <meta name="article:published_time" content="2016-12-13 00:00:00 +0000"> <meta name="og:site_name" content="Yegor Bugayenko"/> <meta name="og:type" content="article" /> <meta name="og:locale" content="en_US" /> <meta name="twitter:account_id" content="4503599630178231" /> <meta name="twitter:creator" content="@yegor256"/> <meta name="twitter:site" content="@yegor256"/> <meta name="twitter:title" property="og:title" content="MVC vs. OOP"/> <meta name="twitter:description" property="og:description" content="MVC is a very popular architectural design pattern that goes absolutely against the spirit of object-oriented programming. "/> <meta name="twitter:url" property="og:url" content="https://www.yegor256.com/2016/12/13/mvc-vs-oop.html"/> <meta name="telegram:channel" content="AAAAAEJFMRzsRTRxM3ec6A"/> <link rel="search" type="application/opensearchdescription+xml" href="/opensearch.xml" title="yegor256" /> <link rel="shortcut icon" href="/favicon.ico?4e047f6f42b"/> <link rel="apple-touch-icon" href="/favicon.ico?4e047f6f42b"/> <link rel="alternate" type="application/rss+xml" title="RSS for yegor256.com" href="https://www.yegor256.com/rss.xml"/> <link rel="stylesheet" href="/css/layout.css?4e047f6f42b"/> <link rel="stylesheet" href="/css/icons.css?4e047f6f42b"/> <link rel="canonical" href="https://www.yegor256.com/2016/12/13/mvc-vs-oop.html" /> <link rel="amphtml" href="https://www.yegor256.com/2016/12/13/mvc-vs-oop.amp.html" /> <title>MVC vs. OOP </title> <meta name='og:image' content='https://www.yegor256.com/images/2016/12/hot-shots.jpg'/><meta name='twitter:image' content='https://www.yegor256.com/images/2016/12/hot-shots.jpg'/><meta name='og:image:width' content='1192'/> <meta name='twitter:image:width' content='1192'/><meta name='og:image:height' content='787'/> <meta name='twitter:image:height' content='787'/><meta name='twitter:card' content='summary_large_image'/><meta name='twitter:image:alt' content='Hot Shots! (1991) by Jim Abrahams'/> </head> <body><div class="wrapper"> <aside class="header-toggle unprintable" id="header-toggle" title="Show the menu" onclick="$('#header').show();$('#header-toggle').hide();">&#9776;</aside> <header class="header" id="header"><div class="face"> <a href="/about-me.html#form" class="sub" title="Click to subscribe to my monthly newsletter"><span>Subscribe</span></a> <a href="/about-me.html" style="position:relative;"> <img src="/images/face-256x256.jpg" class="photo" alt="Yegor Bugayenko"/> </a></div><nav><ul class="menu social notranslate"> <li><a href="https://twitter.com/intent/follow?screen_name=yegor256" rel="nofollow" title="Follow me on Twitter"><i class="icon icon-twitter notranslate" aria-hidden="true"></i></a></li> <li><a href="/rss.xml" rel="nofollow" title="Subscribe to my RSS feed"><i class="icon icon-rss notranslate" aria-hidden="true"></i></a></li> <li><a itemprop="sameAs" href="https://github.com/yegor256" rel="nofollow" title="My GitHub profile"><i class="icon icon-github notranslate" aria-hidden="true"></i></a></li> <li><a itemprop="sameAs" href="http://stackoverflow.com/users/187141/yegor256" rel="nofollow" title="My StackOverflow profile"><i class="icon icon-stackoverflow notranslate" aria-hidden="true"></i></a></li> <li><a itemprop="sameAs" href="https://www.facebook.com/yegor256" rel="nofollow" title="Follow me on Facebook"><i class="icon icon-facebook notranslate" aria-hidden="true"></i></a></li> <li><a itemprop="sameAs" href="https://instagram.com/yegor256" rel="nofollow" title="Follow me on Instagram"><i class="icon icon-instagram notranslate" aria-hidden="true"></i></a></li> <li><a itemprop="sameAs" href="https://www.linkedin.com/in/yegor256" rel="nofollow" title="My LinkedIn profile"><i class="icon icon-linkedin notranslate" aria-hidden="true"></i></a></li> <li><a itemprop="sameAs" href="https://www.youtube.com/c/yegor256?sub_confirmation=1" rel="nofollow" title="My Youtube video channel"><i class="icon icon-youtube notranslate" aria-hidden="true"></i></a></li> <li><a itemprop="sameAs" href="https://www.pinterest.com/yegor256/" rel="nofollow" title="My Pinterest boards"><i class="icon icon-pinterest notranslate" aria-hidden="true"></i></a></li> <li><a itemprop="sameAs" href="https://angel.co/yegor256" rel="nofollow" title="My AngelList profile"><i class="icon icon-angellist notranslate" aria-hidden="true"></i></a></li> <li><a href="https://soundcloud.com/yegor256" rel="nofollow" title="My podcast"><i class="icon icon-podcast notranslate" aria-hidden="true"></i></a></li> <li><a href="https://itunes.apple.com/us/podcast/yegor256-podcast/id1150826721" rel="nofollow" title="My iTunes podcast"><i class="icon icon-itunes notranslate" aria-hidden="true"></i></a></li> <li><a href="https://t.me/joinchat/AAAAAEJFMRzsRTRxM3ec6A" rel="nofollow" title="My Telegram public channel"><i class="icon icon-telegram notranslate" aria-hidden="true"></i></a></li> <li><a href="mailto:blog@yegor256.com" rel="nofollow" title="Email me any time"><i class="icon icon-mail notranslate" aria-hidden="true"></i></a></li></ul><ul class="menu"> <li><a href="/" title="Home page">Home</a></li> <li ><a href="/best.html" title="Best articles to read">12&#160;Best</a></li> <li ><a href="/contents.html" title="The contents of the entire blog">All&#160;288</a></li> <li ><a href="/webinars.html" title="My webinars">Webinars</a></li> <li ><a href="/talks.html" title="Future and past conference talks">Talks</a></li> <li ><a href="/books.html" title="The books I wrote">Books</a></li> <li ><a href="/papers.html" title="My academic papers and patents">Papers</a></li> <li ><a href="/pets.html" title="My loved pet projects">Pets</a></li> <li ><a href="/award.html" title="Software quality award">Award</a></li> <li ><a href="/testimonials.html" title="What some people say about me">Testimonials</a></li> <li ><a href="/shift-m.html" title="Audio podcast about project management">Shift-M</a></li> <li ><a href="/paintings.html" title="My paintings for sale">Paintings</a></li> <li><a href="http://ru.yegor256.com/" title="Немного на русском языке">По-русски</a></li></ul></nav><div class="search"> <form method="get" action="https://www.google.com/search" itemprop="potentialAction" itemscope="" itemtype="http://schema.org/SearchAction"> <meta itemprop="target" content="https://www.google.com/search?q={q}"/> <input name="sitesearch" value="yegor256.com" type="hidden"/> <input itemprop="query-input" type="text" id="search-query" class="field field-text" required="required" onfocus="$('.google').css('visibility', 'visible');" name="q" placeholder="Search..." autocomplete="off"/> <input type="image" src="/images/google-search-icon.svg" class="google" title="Search via Google" alt="Search via Google"/> </form></div><div class="hot"><ul> <li> <a href="/code-ahead.html">Code Ahead</a> was published on Amazon just a few days ago! It is my new book, a novel about programmers. It explains in details the majority of ideas that stand behind <a href="https://www.zerocracy.com">Zerocracy</a> and <a href="https://www.xdsd.org">XDSD</a>. </li> <li> At <a href="/webinars.html">Webinar #37</a> we will discuss naming problem in OOP, for objects, methods and attributes; join us on <b>September 12</b>, at 11am PST. </li></ul></div></header></div><section itemscope="" itemtype="http://schema.org/BlogPosting"><div class="wrapper"> <header><p class="printable"> <img src="https://api.qrserver.com/v1/create-qr-code/?data=https://www.yegor256.com/2016/12/13/mvc-vs-oop.html&amp;format=svg" style="width:125px;height:125px;" alt="QR code"/></p><p class="printable"> <code itemprop="url">https://www.yegor256.com/2016/12/13/mvc-vs-oop.html</code></p><h1 itemprop="name headline mainEntityOfPage">MVC vs. OOP</h1><aside class='book'><a href='http://amzn.to/2pyceWc'><img src='/images/books/elegant-objects/cover.png' class='book-cover' alt='book cover'/></a>Read more about this subject in <a href='http://amzn.to/2pyceWc'>Section&nbsp;6.2</a><br/> of my book<a href='http://amzn.to/2pyceWc'><img src='/images/books/amazon-buy-button.png' class='amazon-button' alt='Click to buy'/></a></aside><ul class="subline"> <li> <time itemprop="datePublished" datetime="2016-12-13T00:00:00+00:00"> 13 December 2016 </time> </li> <li class="desktop-only" itemprop="locationCreated">Kiev, Ukraine</li> <li class="printable" itemscope="" itemprop="author" itemtype="http://schema.org/Person"> <span itemprop="name">Yegor Bugayenko</span> </li> <li class="unprintable"> <i class="icon icon-comments"></i> <a href="http://www.yegor256.com/2016/12/13/mvc-vs-oop.html#disqus_thread" itemprop="discussionUrl">comments</a> </li></ul><ul class="subline"> <li>Discussed at:</li> <li><a href="https://dzone.com/articles/mvc-vs-oop">dzone</a></li></ul><figure class='jb_picture'><img itemprop='image' alt='Hot Shots! (1991) by Jim Abrahams' src='/images/2016/12/hot-shots.jpg' longdesc='#cdf5cce3'/><figcaption id='cdf5cce3'>Hot Shots! (1991) by Jim Abrahams</figcaption></figure><p>This is how MVC architecture looks:</p><p><img src='/uml/45d05ab3bd9a93ad88ec209352b62f60.svg' style="width:35%" alt='PlantUML SVG diagram' class='plantuml'/></p><p>Controller is <em>in charge</em>, taking care of the data received from Model and injecting it into View---and this is exactly the problem. The data escapes the Model and becomes &quot;naked,&quot; which is a big problem, as we <a href="/2016/11/21/naked-data.html">agreed earlier</a>. OOP is all about encapsulation---data hiding.</p><p>MVC architecture does exactly the opposite by <em>exposing</em> the data and hiding behavior. The controller deals with the data directly, making decisions about its purpose and properties, while the objects, which are supposed to know everything about the data and hide it, remain <a href="/2016/07/06/data-transfer-object.html">anemic</a>. That is exactly the principle any procedural architecture is built upon; the code is in charge of the data. Take this C++ code, for example:</p><figure class="highlight"><pre><code class="language-c" data-lang="c"><span></span><span class="kt">void</span> <span class="nf">print_speed</span><span class="p">()</span> <span class="p">{</span> <span class="c1">// controller</span>
  <span class="kt">int</span> <span class="n">s</span> <span class="o">=</span> <span class="n">load_from_engine</span><span class="p">();</span> <span class="c1">// model</span>
  <span class="n">printf</span><span class="p">(</span><span class="s">&quot;The speed is %d mph&quot;</span><span class="p">,</span> <span class="n">s</span><span class="p">);</span> <span class="c1">// view</span>
<span class="p">}</span></code></pre></figure><p>The function <code>print_speed()</code> is the controller. It gets the data <code>s</code> from the model <code>load_from_engine()</code> and renders it via the view <code>printf()</code>. Only the controller knows that the data is in miles per hour. The engine returns <code>int</code> without any properties. The controller simply assumed that that data is in mph. If we want to create a similar controller somewhere else, we will have to make a similar assumption again and again. That&#39;s what the &quot;naked data&quot; problem is about, and it leads to serious maintainability issues.</p><p>This is an object-oriented alternative to the code above (pseudo-C++):</p><figure class="highlight"><pre><code class="language-c" data-lang="c"><span></span><span class="n">printf</span><span class="p">(</span>
  <span class="n">new</span> <span class="n">PrintedSpeed</span><span class="p">(</span> <span class="c1">// view</span>
    <span class="n">new</span> <span class="n">FormattedSpeed</span><span class="p">(</span> <span class="c1">// controller</span>
      <span class="n">new</span> <span class="n">SpeedFromEngine</span><span class="p">()</span> <span class="c1">// model</span>
    <span class="p">)</span>
  <span class="p">)</span>
<span class="p">);</span></code></pre></figure><p>Here, <code>SpeedFromEngine.speed()</code> returns speed in mph, as an integer; <code>FormattedSpeed.speed()</code> returns <code>&quot;%d mph&quot;</code>; and finally, <code>PrintedSpeed.to_str()</code> returns the full text of the message. We can call them &quot;model, view, and controller,&quot; but in reality they are just objects decorating each other. It&#39;s still the same entity---the speed. But it gets more complex and intelligent by being decorated.</p><p>We don&#39;t tear the concept of speed apart. The speed is the speed, no matter who works with it and where it is presented. It just gets new behavior from decorators. It grows, but never falls apart.</p><p>To summarize, Controller is a pure <em>procedural</em> component in the MVC trio, which turns Model into a passive data holder and View into a passive data renderer. The controll<b>er</b>, the hold<b>er</b>, the render<b>er</b> ... Is it <a href="/2015/03/09/objects-end-with-er.html">really OOP</a>?</p></p>--> <nav class="buttons notranslate desktop-only"> <a href="http://www.facebook.com/sharer/sharer.php?u=https://www.yegor256.com/2016/12/13/mvc-vs-oop.html" title="Share on Facebook" class="button" rel="nofollow"> <span class="count count-facebook">0</span> <i class="icon icon-facebook notranslate" aria-hidden="true"></i> </a> <a href="https://twitter.com/share?url=https://www.yegor256.com/2016/12/13/mvc-vs-oop.html&amp;text=MVC+vs.+OOP" title="Share on Twitter" class="button" rel="nofollow"> <span class="count count-twitter">0</span> <i class="icon icon-twitter notranslate" aria-hidden="true"></i> </a> <a href="https://plus.google.com/share?url=https://www.yegor256.com/2016/12/13/mvc-vs-oop.html" title="Share on Google+" class="button" rel="nofollow"> <span class="count count-googleplus">0</span> <i class="icon icon-googleplus notranslate" aria-hidden="true"></i> </a> <a href="https://www.linkedin.com/cws/share?url=https://www.yegor256.com/2016/12/13/mvc-vs-oop.html" title="Share on LinkedIn" class="button" rel="nofollow"> <span class="count count-linkedin">0</span> <i class="icon icon-linkedin notranslate" aria-hidden="true"></i> </a> <a href="http://reddit.com/submit?url=https://www.yegor256.com/2016/12/13/mvc-vs-oop.html%3F2016-50&amp;title=MVC+vs.+OOP" title="Share on Reddit" class="button" rel="nofollow"> <span class="count count-reddit">0</span> <i class="icon icon-reddit notranslate" aria-hidden="true"></i> </a> <a href="http://news.ycombinator.com/submitlink?u=https://www.yegor256.com/2016/12/13/mvc-vs-oop.html%3F2016-50&amp;t=MVC+vs.+OOP" title="Share on Hacker News" class="button" rel="nofollow"> <span class="count count-hackernews">0</span> <i class="icon icon-hackernews notranslate" aria-hidden="true"></i> </a> </nav> </header> <article class="main" itemprop="articleBody"><div ><p><a href="https://en.wikipedia.org/wiki/Model%E2%80%93view%E2%80%93controller">Model-View-Controller</a> (MVC) is an architectural pattern we all are well aware of. It&#39;s a de-facto standard for almost all UI and <a href="https://en.wikipedia.org/wiki/Web_framework">Web frameworks</a>. It is convenient and easy to use. It is simple and effective. It is a great concept ... for a procedural programmer. If your software is object-oriented, you should dislike MVC as much as I do. Here is why.</p><figure class='jb_picture'><img itemprop='image' alt='Hot Shots! (1991) by Jim Abrahams' src='/images/2016/12/hot-shots.jpg' longdesc='#cdf5cce3'/><figcaption id='cdf5cce3'>Hot Shots! (1991) by Jim Abrahams</figcaption></figure><p>This is how MVC architecture looks:</p><p><img src='/uml/45d05ab3bd9a93ad88ec209352b62f60.svg' style="width:35%" alt='PlantUML SVG diagram' class='plantuml'/></p><p>Controller is <em>in charge</em>, taking care of the data received from Model and injecting it into View---and this is exactly the problem. The data escapes the Model and becomes &quot;naked,&quot; which is a big problem, as we <a href="/2016/11/21/naked-data.html">agreed earlier</a>. OOP is all about encapsulation---data hiding.</p><p>MVC architecture does exactly the opposite by <em>exposing</em> the data and hiding behavior. The controller deals with the data directly, making decisions about its purpose and properties, while the objects, which are supposed to know everything about the data and hide it, remain <a href="/2016/07/06/data-transfer-object.html">anemic</a>. That is exactly the principle any procedural architecture is built upon; the code is in charge of the data. Take this C++ code, for example:</p><figure class="highlight"><pre><code class="language-c" data-lang="c"><span></span><span class="kt">void</span> <span class="nf">print_speed</span><span class="p">()</span> <span class="p">{</span> <span class="c1">// controller</span>
  <span class="kt">int</span> <span class="n">s</span> <span class="o">=</span> <span class="n">load_from_engine</span><span class="p">();</span> <span class="c1">// model</span>
  <span class="n">printf</span><span class="p">(</span><span class="s">&quot;The speed is %d mph&quot;</span><span class="p">,</span> <span class="n">s</span><span class="p">);</span> <span class="c1">// view</span>
<span class="p">}</span></code></pre></figure><p>The function <code>print_speed()</code> is the controller. It gets the data <code>s</code> from the model <code>load_from_engine()</code> and renders it via the view <code>printf()</code>. Only the controller knows that the data is in miles per hour. The engine returns <code>int</code> without any properties. The controller simply assumed that that data is in mph. If we want to create a similar controller somewhere else, we will have to make a similar assumption again and again. That&#39;s what the &quot;naked data&quot; problem is about, and it leads to serious maintainability issues.</p><p>This is an object-oriented alternative to the code above (pseudo-C++):</p><figure class="highlight"><pre><code class="language-c" data-lang="c"><span></span><span class="n">printf</span><span class="p">(</span>
  <span class="n">new</span> <span class="n">PrintedSpeed</span><span class="p">(</span> <span class="c1">// view</span>
    <span class="n">new</span> <span class="n">FormattedSpeed</span><span class="p">(</span> <span class="c1">// controller</span>
      <span class="n">new</span> <span class="n">SpeedFromEngine</span><span class="p">()</span> <span class="c1">// model</span>
    <span class="p">)</span>
  <span class="p">)</span>
<span class="p">);</span></code></pre></figure><p>Here, <code>SpeedFromEngine.speed()</code> returns speed in mph, as an integer; <code>FormattedSpeed.speed()</code> returns <code>&quot;%d mph&quot;</code>; and finally, <code>PrintedSpeed.to_str()</code> returns the full text of the message. We can call them &quot;model, view, and controller,&quot; but in reality they are just objects decorating each other. It&#39;s still the same entity---the speed. But it gets more complex and intelligent by being decorated.</p><p>We don&#39;t tear the concept of speed apart. The speed is the speed, no matter who works with it and where it is presented. It just gets new behavior from decorators. It grows, but never falls apart.</p><p>To summarize, Controller is a pure <em>procedural</em> component in the MVC trio, which turns Model into a passive data holder and View into a passive data renderer. The controll<b>er</b>, the hold<b>er</b>, the render<b>er</b> ... Is it <a href="/2015/03/09/objects-end-with-er.html">really OOP</a>?</p></div></article></div><div class="wrapper"> <related-posts /></div><div class="disqus" role="complementary"><p class="disqus_hint"> Please, use <a href="https://help.disqus.com/commenting/what-html-tags-are-allowed-within-comments">syntax highlighting</a> in your comments, to make them more readable.</p><div id="disqus_thread" class="disqus-thread"> <a>&nbsp;</a></div><script> var disqus_config = function () { this.page.url = document.location.href.split('?')[0].split('#')[0].replace('https://', 'http://'); this.page.identifier = this.page.url; }; (function() { var d = document, s = d.createElement('script'); s.src = '//yegor256.disqus.com/embed.js'; s.setAttribute('data-timestamp', +new Date()); (d.head || d.body).appendChild(s); })(); </script> <noscript><div><p class="red"> JavaScript is disabled in your browser, that's why you can't see comments under this post.</p></div></noscript></div><div class="wrapper"> <footer class="footer"><p> &copy; <span itemscope="" itemprop="copyrightHolder" itemtype="http://schema.org/Person"> <span itemprop="name">Yegor Bugayenko</span> </span> 2014&ndash;<span itemprop="copyrightYear">2018</span></p></footer></div></section><div class="wrapper unprintable" style="text-align:center;margin-top:2em;"> <a href="http://www.sixnines.io/h/3ba1652f"> <img src="//www.sixnines.io/b/3ba1652f?style=flat" alt="sixnines availability badge"/> </a></div><script src="//code.jquery.com/jquery-1.9.0.min.js"></script> <script src="/js/all.js?4e047f6f42b"></script> <script>var disqus_shortname = 'yegor256';</script> <script id="dsq-count-scr" src="//yegor256.disqus.com/count.js" async="async"></script> <script> (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){ (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o), m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m) })(window,document,'script','//www.google-analytics.com/analytics.js','ga'); ga('create', 'UA-1963507-32', 'auto'); ga('send', 'pageview'); </script> <script> Cd=document;Cr="&"+Math.random();Cp="&s=1"; Cd.cookie="b=b";if(Cd.cookie)Cp+="&c=1"; Cp+="&t="+(new Date()).getTimezoneOffset(); if(self!=top)Cp+="&f=1"; </script> <script> if(navigator.javaEnabled())Cp+="&j=1"; </script> <script> if(typeof(screen)!='undefined')Cp+="&w="+screen.width+"&h="+ screen.height+"&d="+(screen.colorDepth?screen.colorDepth:screen.pixelDepth); </script> <script> Cd.write("<img src='//c.hit.ua/hit?i=95870&g=0&x=2"+Cp+Cr+ "&r="+escape(Cd.referrer)+"&u="+escape(window.location.href)+ "' border='0' wi"+"dth='1' he"+"ight='1'/>"); </script> <script type="application/ld+json"> { "@context": "http://schema.org", "@type": "Person", "name": "Yegor Bugayenko", "url": "http://www.yegor256.com", "sameAs": [ "https://www.facebook.com/yegor256", "https://instagram.com/yegor256", "https://www.linkedin.com/in/yegor256", "https://twitter.com/yegor256", "https://github.com/yegor256", "https://www.pinterest.com/yegor256/" ] } </script> </body> </html> <!DOCTYPE html> <html xmlns="http://www.w3.org/1999/xhtml" lang="en-US" xml:lang="en-US" itemscope="" itemtype="http://schema.org/WebSite"> <head> <meta charset="utf-8"/> <meta name="description" content="Encapsulation is what makes OOP objects solid, cohesive, and trustworthy; publicly accessible data is what breaks encapsulation. " /> <meta name="keywords" content="encapsulation, encapsulation data, encapsulation meaning, encapsulation trusted objects, encapsulation violation" /> <meta name="viewport" content="width=device-width,minimum-scale=1,initial-scale=1"/> <meta name="google-site-verification" content="JEj_gQr2CPe2QKGw8XdMz0R7VboQIUbX3FlM-lwTq-8" /> <meta name="author" content="Yegor Bugayenko"> <meta name="article:published_time" content="2016-11-21 00:00:00 +0000"> <meta name="og:site_name" content="Yegor Bugayenko"/> <meta name="og:type" content="article" /> <meta name="og:locale" content="en_US" /> <meta name="twitter:account_id" content="4503599630178231" /> <meta name="twitter:creator" content="@yegor256"/> <meta name="twitter:site" content="@yegor256"/> <meta name="twitter:title" property="og:title" content="Encapsulation Covers Up Naked&nbsp;Data"/> <meta name="twitter:description" property="og:description" content="Encapsulation is what makes OOP objects solid, cohesive, and trustworthy; publicly accessible data is what breaks encapsulation. "/> <meta name="twitter:url" property="og:url" content="https://www.yegor256.com/2016/11/21/naked-data.html"/> <meta name="telegram:channel" content="AAAAAEJFMRzsRTRxM3ec6A"/> <link rel="search" type="application/opensearchdescription+xml" href="/opensearch.xml" title="yegor256" /> <link rel="shortcut icon" href="/favicon.ico?4e047f6f42b"/> <link rel="apple-touch-icon" href="/favicon.ico?4e047f6f42b"/> <link rel="alternate" type="application/rss+xml" title="RSS for yegor256.com" href="https://www.yegor256.com/rss.xml"/> <link rel="stylesheet" href="/css/layout.css?4e047f6f42b"/> <link rel="stylesheet" href="/css/icons.css?4e047f6f42b"/> <link rel="canonical" href="https://www.yegor256.com/2016/11/21/naked-data.html" /> <link rel="amphtml" href="https://www.yegor256.com/2016/11/21/naked-data.amp.html" /> <title>Encapsulation Covers Up Naked&nbsp;Data </title> <meta name='og:image' content='https://www.yegor256.com/images/2016/11/borat.jpg'/><meta name='twitter:image' content='https://www.yegor256.com/images/2016/11/borat.jpg'/><meta name='og:image:width' content='1280'/> <meta name='twitter:image:width' content='1280'/><meta name='og:image:height' content='688'/> <meta name='twitter:image:height' content='688'/><meta name='twitter:card' content='summary_large_image'/><meta name='twitter:image:alt' content='Borat: Cultural Learnings of America for Make Benefit Glorious Nation of Kazakhstan (2006) by Larry Charles'/> </head> <body><div class="wrapper"> <aside class="header-toggle unprintable" id="header-toggle" title="Show the menu" onclick="$('#header').show();$('#header-toggle').hide();">&#9776;</aside> <header class="header" id="header"><div class="face"> <a href="/about-me.html#form" class="sub" title="Click to subscribe to my monthly newsletter"><span>Subscribe</span></a> <a href="/about-me.html" style="position:relative;"> <img src="/images/face-256x256.jpg" class="photo" alt="Yegor Bugayenko"/> </a></div><nav><ul class="menu social notranslate"> <li><a href="https://twitter.com/intent/follow?screen_name=yegor256" rel="nofollow" title="Follow me on Twitter"><i class="icon icon-twitter notranslate" aria-hidden="true"></i></a></li> <li><a href="/rss.xml" rel="nofollow" title="Subscribe to my RSS feed"><i class="icon icon-rss notranslate" aria-hidden="true"></i></a></li> <li><a itemprop="sameAs" href="https://github.com/yegor256" rel="nofollow" title="My GitHub profile"><i class="icon icon-github notranslate" aria-hidden="true"></i></a></li> <li><a itemprop="sameAs" href="http://stackoverflow.com/users/187141/yegor256" rel="nofollow" title="My StackOverflow profile"><i class="icon icon-stackoverflow notranslate" aria-hidden="true"></i></a></li> <li><a itemprop="sameAs" href="https://www.facebook.com/yegor256" rel="nofollow" title="Follow me on Facebook"><i class="icon icon-facebook notranslate" aria-hidden="true"></i></a></li> <li><a itemprop="sameAs" href="https://instagram.com/yegor256" rel="nofollow" title="Follow me on Instagram"><i class="icon icon-instagram notranslate" aria-hidden="true"></i></a></li> <li><a itemprop="sameAs" href="https://www.linkedin.com/in/yegor256" rel="nofollow" title="My LinkedIn profile"><i class="icon icon-linkedin notranslate" aria-hidden="true"></i></a></li> <li><a itemprop="sameAs" href="https://www.youtube.com/c/yegor256?sub_confirmation=1" rel="nofollow" title="My Youtube video channel"><i class="icon icon-youtube notranslate" aria-hidden="true"></i></a></li> <li><a itemprop="sameAs" href="https://www.pinterest.com/yegor256/" rel="nofollow" title="My Pinterest boards"><i class="icon icon-pinterest notranslate" aria-hidden="true"></i></a></li> <li><a itemprop="sameAs" href="https://angel.co/yegor256" rel="nofollow" title="My AngelList profile"><i class="icon icon-angellist notranslate" aria-hidden="true"></i></a></li> <li><a href="https://soundcloud.com/yegor256" rel="nofollow" title="My podcast"><i class="icon icon-podcast notranslate" aria-hidden="true"></i></a></li> <li><a href="https://itunes.apple.com/us/podcast/yegor256-podcast/id1150826721" rel="nofollow" title="My iTunes podcast"><i class="icon icon-itunes notranslate" aria-hidden="true"></i></a></li> <li><a href="https://t.me/joinchat/AAAAAEJFMRzsRTRxM3ec6A" rel="nofollow" title="My Telegram public channel"><i class="icon icon-telegram notranslate" aria-hidden="true"></i></a></li> <li><a href="mailto:blog@yegor256.com" rel="nofollow" title="Email me any time"><i class="icon icon-mail notranslate" aria-hidden="true"></i></a></li></ul><ul class="menu"> <li><a href="/" title="Home page">Home</a></li> <li ><a href="/best.html" title="Best articles to read">12&#160;Best</a></li> <li ><a href="/contents.html" title="The contents of the entire blog">All&#160;288</a></li> <li ><a href="/webinars.html" title="My webinars">Webinars</a></li> <li ><a href="/talks.html" title="Future and past conference talks">Talks</a></li> <li ><a href="/books.html" title="The books I wrote">Books</a></li> <li ><a href="/papers.html" title="My academic papers and patents">Papers</a></li> <li ><a href="/pets.html" title="My loved pet projects">Pets</a></li> <li ><a href="/award.html" title="Software quality award">Award</a></li> <li ><a href="/testimonials.html" title="What some people say about me">Testimonials</a></li> <li ><a href="/shift-m.html" title="Audio podcast about project management">Shift-M</a></li> <li ><a href="/paintings.html" title="My paintings for sale">Paintings</a></li> <li><a href="http://ru.yegor256.com/" title="Немного на русском языке">По-русски</a></li></ul></nav><div class="search"> <form method="get" action="https://www.google.com/search" itemprop="potentialAction" itemscope="" itemtype="http://schema.org/SearchAction"> <meta itemprop="target" content="https://www.google.com/search?q={q}"/> <input name="sitesearch" value="yegor256.com" type="hidden"/> <input itemprop="query-input" type="text" id="search-query" class="field field-text" required="required" onfocus="$('.google').css('visibility', 'visible');" name="q" placeholder="Search..." autocomplete="off"/> <input type="image" src="/images/google-search-icon.svg" class="google" title="Search via Google" alt="Search via Google"/> </form></div><div class="hot"><ul> <li> <a href="/code-ahead.html">Code Ahead</a> was published on Amazon just a few days ago! It is my new book, a novel about programmers. It explains in details the majority of ideas that stand behind <a href="https://www.zerocracy.com">Zerocracy</a> and <a href="https://www.xdsd.org">XDSD</a>. </li> <li> At <a href="/webinars.html">Webinar #37</a> we will discuss naming problem in OOP, for objects, methods and attributes; join us on <b>September 12</b>, at 11am PST. </li></ul></div></header></div><section itemscope="" itemtype="http://schema.org/BlogPosting"><div class="wrapper"> <header><p class="printable"> <img src="https://api.qrserver.com/v1/create-qr-code/?data=https://www.yegor256.com/2016/11/21/naked-data.html&amp;format=svg" style="width:125px;height:125px;" alt="QR code"/></p><p class="printable"> <code itemprop="url">https://www.yegor256.com/2016/11/21/naked-data.html</code></p><h1 itemprop="name headline mainEntityOfPage">Encapsulation Covers Up Naked&nbsp;Data</h1><ul class="subline"> <li> <time itemprop="datePublished" datetime="2016-11-21T00:00:00+00:00"> 21 November 2016 </time> </li> <li class="desktop-only" itemprop="locationCreated">Moscow, Russia</li> <li class="printable" itemscope="" itemprop="author" itemtype="http://schema.org/Person"> <span itemprop="name">Yegor Bugayenko</span> </li> <li class="unprintable"> <i class="icon icon-comments"></i> <a href="http://www.yegor256.com/2016/11/21/naked-data.html#disqus_thread" itemprop="discussionUrl">comments</a> </li></ul><figure class='jb_picture'><img itemprop='image' alt='Borat: Cultural Learnings of America for Make Benefit Glorious Nation of Kazakhstan (2006) by Larry Charles' src='/images/2016/11/borat.jpg' longdesc='#30fc8a97'/><figcaption id='30fc8a97'>Borat: Cultural Learnings of America for Make Benefit Glorious Nation of Kazakhstan (2006) by Larry Charles</figcaption></figure><p>This is what naked data is (C code):</p><figure class="highlight"><pre><code class="language-c" data-lang="c"><span></span><span class="kt">int</span> <span class="n">t</span><span class="p">;</span>
<span class="n">t</span> <span class="o">=</span> <span class="mi">85</span><span class="p">;</span>
<span class="n">printf</span><span class="p">(</span><span class="s">&quot;The temperature is %d F&quot;</span><span class="p">,</span> <span class="n">t</span><span class="p">);</span></code></pre></figure><p>Here <code>t</code> is the data, which is publicly accessible by the code around it. Anyone can modify it or read it.</p><p>Why is that bad? For one reason: tight and hidden coupling.</p><p>The code around <code>t</code> inevitably makes a lot of assumptions about the data. For example, both lines after <code>int t</code> decided that the temperature is in Fahrenheit. At the moment of writing, this may be true, but this assumption couples the code with the data. If tomorrow we change <code>t</code> to Celsius, the code won&#39;t know about this change. That&#39;s why I call this coupling <em>hidden</em>.</p><aside class='youtube'> <a href='https://www.youtube.com/watch?v=Nm274dGikFc'><div class='box'> <img src='https://i.ytimg.com/vi/Nm274dGikFc/mqdefault.jpg' alt='YouTube video #Nm274dGikFc'/><div class='play'><i class='icon icon-play'></i></div></div></a><div>Naked Data in OOP (webinar #22); 15 March 2017.</div></aside><p>If we change the type of <code>t</code> from <code>int</code> to, say, <code>double</code>, the <code>printf</code> line won&#39;t print anything after the decimal point. Again, the coupling is there, but it&#39;s hidden. Later on, we simply won&#39;t be able to find all the places in our code where we made these or other assumptions about <code>t</code>.</p><p>This will seriously affect maintainability.</p><p>And this is not a solution, as you can imagine (Java now):</p><figure class="highlight"><pre><code class="language-java" data-lang="java"><span></span><span class="kd">class</span> <span class="nc">Temperature</span> <span class="o">{</span>
  <span class="kd">private</span> <span class="kt">int</span> <span class="n">t</span><span class="o">;</span>
  <span class="kd">public</span> <span class="kt">int</span> <span class="nf">getT</span><span class="o">()</span> <span class="o">{</span> <span class="k">return</span> <span class="k">this</span><span class="o">.</span><span class="na">t</span><span class="o">;</span> <span class="o">}</span>
  <span class="kd">public</span> <span class="kt">void</span> <span class="nf">setT</span><span class="o">(</span><span class="kt">int</span> <span class="n">t</span><span class="o">)</span> <span class="o">{</span> <span class="k">this</span><span class="o">.</span><span class="na">t</span> <span class="o">=</span> <span class="n">t</span><span class="o">;</span> <span class="o">}</span>
<span class="o">}</span></code></pre></figure><p>It looks like an object, but the data is still naked. Anyone can retrieve <code>t</code> from the object and decide whether it&#39;s Fahrenheit or Celsius, whether it has digits after the dot or not, etc. This is not encapsulation yet!</p><p>The only way to encapsulate <code>t</code> is to make sure nobody can touch it either directly or by retrieving it from an object. How do we do that? Just stop exposing data and start exposing functionality. Here is how, for example:</p><figure class="highlight"><pre><code class="language-java" data-lang="java"><span></span><span class="kd">class</span> <span class="nc">Temperature</span> <span class="o">{</span>
  <span class="kd">private</span> <span class="kt">int</span> <span class="n">t</span><span class="o">;</span>
  <span class="kd">public</span> <span class="n">String</span> <span class="nf">toString</span><span class="o">()</span> <span class="o">{</span>
    <span class="k">return</span> <span class="n">String</span><span class="o">.</span><span class="na">format</span><span class="o">(</span><span class="s">&quot;%d F&quot;</span><span class="o">,</span> <span class="k">this</span><span class="o">.</span><span class="na">t</span><span class="o">);</span>
  <span class="o">}</span>
<span class="o">}</span></code></pre></figure><p>We don&#39;t allow anyone to retrieve <code>t</code> anymore. All they can do is convert temperature to text. If and when we decide to change <code>t</code> to Celsius, we will do it just once and in one place: in the class <code>Temperature</code>.</p><aside class='quote'>Any data elements that escape objects are naked and lead to maintainability problems</aside><p>If we need other functions in the future, like math operations or conversion to Celsius, we add more methods to class <code>Temperature</code>. But we never let anyone touch or know about <code>t</code>.</p><p>This idea is close to &quot;<a href="/2016/04/05/printers-instead-of-getters.html">printers instead of getters</a>,&quot; which we discussed earlier, though from a much wider perspective. Here I&#39;m saying that any data elements that escape objects are <em>naked</em> and lead to maintainability problems.</p><p>The question is how we can work entirely without naked data, right? Eventually we have to let objects exchange data, don&#39;t we? Yes, that&#39;s true. But not entirely. I&#39;ll explain that in <a href="/2016/12/20/can-objects-be-friends.html">my next post</a>.</p></p>--> <nav class="buttons notranslate desktop-only"> <a href="http://www.facebook.com/sharer/sharer.php?u=https://www.yegor256.com/2016/11/21/naked-data.html" title="Share on Facebook" class="button" rel="nofollow"> <span class="count count-facebook">0</span> <i class="icon icon-facebook notranslate" aria-hidden="true"></i> </a> <a href="https://twitter.com/share?url=https://www.yegor256.com/2016/11/21/naked-data.html&amp;text=Encapsulation+Covers+Up+Naked%26nbsp%3BData" title="Share on Twitter" class="button" rel="nofollow"> <span class="count count-twitter">0</span> <i class="icon icon-twitter notranslate" aria-hidden="true"></i> </a> <a href="https://plus.google.com/share?url=https://www.yegor256.com/2016/11/21/naked-data.html" title="Share on Google+" class="button" rel="nofollow"> <span class="count count-googleplus">0</span> <i class="icon icon-googleplus notranslate" aria-hidden="true"></i> </a> <a href="https://www.linkedin.com/cws/share?url=https://www.yegor256.com/2016/11/21/naked-data.html" title="Share on LinkedIn" class="button" rel="nofollow"> <span class="count count-linkedin">0</span> <i class="icon icon-linkedin notranslate" aria-hidden="true"></i> </a> <a href="http://reddit.com/submit?url=https://www.yegor256.com/2016/11/21/naked-data.html%3F2016-47&amp;title=Encapsulation+Covers+Up+Naked%26nbsp%3BData" title="Share on Reddit" class="button" rel="nofollow"> <span class="count count-reddit">0</span> <i class="icon icon-reddit notranslate" aria-hidden="true"></i> </a> <a href="http://news.ycombinator.com/submitlink?u=https://www.yegor256.com/2016/11/21/naked-data.html%3F2016-47&amp;t=Encapsulation+Covers+Up+Naked%26nbsp%3BData" title="Share on Hacker News" class="button" rel="nofollow"> <span class="count count-hackernews">0</span> <i class="icon icon-hackernews notranslate" aria-hidden="true"></i> </a> </nav> </header> <article class="main" itemprop="articleBody"><div ><p>Encapsulation is the core principle of object-oriented programming that makes objects solid, cohesive, trustworthy, etc. But what exactly is encapsulation? Does it only protect against access to private attributes from outside an object? I think it&#39;s much more. Encapsulation leads to the absence of <em>naked</em> data on all levels and in all forms.</p><figure class='jb_picture'><img itemprop='image' alt='Borat: Cultural Learnings of America for Make Benefit Glorious Nation of Kazakhstan (2006) by Larry Charles' src='/images/2016/11/borat.jpg' longdesc='#30fc8a97'/><figcaption id='30fc8a97'>Borat: Cultural Learnings of America for Make Benefit Glorious Nation of Kazakhstan (2006) by Larry Charles</figcaption></figure><p>This is what naked data is (C code):</p><figure class="highlight"><pre><code class="language-c" data-lang="c"><span></span><span class="kt">int</span> <span class="n">t</span><span class="p">;</span>
<span class="n">t</span> <span class="o">=</span> <span class="mi">85</span><span class="p">;</span>
<span class="n">printf</span><span class="p">(</span><span class="s">&quot;The temperature is %d F&quot;</span><span class="p">,</span> <span class="n">t</span><span class="p">);</span></code></pre></figure><p>Here <code>t</code> is the data, which is publicly accessible by the code around it. Anyone can modify it or read it.</p><p>Why is that bad? For one reason: tight and hidden coupling.</p><p>The code around <code>t</code> inevitably makes a lot of assumptions about the data. For example, both lines after <code>int t</code> decided that the temperature is in Fahrenheit. At the moment of writing, this may be true, but this assumption couples the code with the data. If tomorrow we change <code>t</code> to Celsius, the code won&#39;t know about this change. That&#39;s why I call this coupling <em>hidden</em>.</p><aside class='youtube'> <a href='https://www.youtube.com/watch?v=Nm274dGikFc'><div class='box'> <img src='https://i.ytimg.com/vi/Nm274dGikFc/mqdefault.jpg' alt='YouTube video #Nm274dGikFc'/><div class='play'><i class='icon icon-play'></i></div></div></a><div>Naked Data in OOP (webinar #22); 15 March 2017.</div></aside><p>If we change the type of <code>t</code> from <code>int</code> to, say, <code>double</code>, the <code>printf</code> line won&#39;t print anything after the decimal point. Again, the coupling is there, but it&#39;s hidden. Later on, we simply won&#39;t be able to find all the places in our code where we made these or other assumptions about <code>t</code>.</p><p>This will seriously affect maintainability.</p><p>And this is not a solution, as you can imagine (Java now):</p><figure class="highlight"><pre><code class="language-java" data-lang="java"><span></span><span class="kd">class</span> <span class="nc">Temperature</span> <span class="o">{</span>
  <span class="kd">private</span> <span class="kt">int</span> <span class="n">t</span><span class="o">;</span>
  <span class="kd">public</span> <span class="kt">int</span> <span class="nf">getT</span><span class="o">()</span> <span class="o">{</span> <span class="k">return</span> <span class="k">this</span><span class="o">.</span><span class="na">t</span><span class="o">;</span> <span class="o">}</span>
  <span class="kd">public</span> <span class="kt">void</span> <span class="nf">setT</span><span class="o">(</span><span class="kt">int</span> <span class="n">t</span><span class="o">)</span> <span class="o">{</span> <span class="k">this</span><span class="o">.</span><span class="na">t</span> <span class="o">=</span> <span class="n">t</span><span class="o">;</span> <span class="o">}</span>
<span class="o">}</span></code></pre></figure><p>It looks like an object, but the data is still naked. Anyone can retrieve <code>t</code> from the object and decide whether it&#39;s Fahrenheit or Celsius, whether it has digits after the dot or not, etc. This is not encapsulation yet!</p><p>The only way to encapsulate <code>t</code> is to make sure nobody can touch it either directly or by retrieving it from an object. How do we do that? Just stop exposing data and start exposing functionality. Here is how, for example:</p><figure class="highlight"><pre><code class="language-java" data-lang="java"><span></span><span class="kd">class</span> <span class="nc">Temperature</span> <span class="o">{</span>
  <span class="kd">private</span> <span class="kt">int</span> <span class="n">t</span><span class="o">;</span>
  <span class="kd">public</span> <span class="n">String</span> <span class="nf">toString</span><span class="o">()</span> <span class="o">{</span>
    <span class="k">return</span> <span class="n">String</span><span class="o">.</span><span class="na">format</span><span class="o">(</span><span class="s">&quot;%d F&quot;</span><span class="o">,</span> <span class="k">this</span><span class="o">.</span><span class="na">t</span><span class="o">);</span>
  <span class="o">}</span>
<span class="o">}</span></code></pre></figure><p>We don&#39;t allow anyone to retrieve <code>t</code> anymore. All they can do is convert temperature to text. If and when we decide to change <code>t</code> to Celsius, we will do it just once and in one place: in the class <code>Temperature</code>.</p><aside class='quote'>Any data elements that escape objects are naked and lead to maintainability problems</aside><p>If we need other functions in the future, like math operations or conversion to Celsius, we add more methods to class <code>Temperature</code>. But we never let anyone touch or know about <code>t</code>.</p><p>This idea is close to &quot;<a href="/2016/04/05/printers-instead-of-getters.html">printers instead of getters</a>,&quot; which we discussed earlier, though from a much wider perspective. Here I&#39;m saying that any data elements that escape objects are <em>naked</em> and lead to maintainability problems.</p><p>The question is how we can work entirely without naked data, right? Eventually we have to let objects exchange data, don&#39;t we? Yes, that&#39;s true. But not entirely. I&#39;ll explain that in <a href="/2016/12/20/can-objects-be-friends.html">my next post</a>.</p></div></article></div><div class="wrapper"> <related-posts /></div><div class="disqus" role="complementary"><p class="disqus_hint"> Please, use <a href="https://help.disqus.com/commenting/what-html-tags-are-allowed-within-comments">syntax highlighting</a> in your comments, to make them more readable.</p><div id="disqus_thread" class="disqus-thread"> <a>&nbsp;</a></div><script> var disqus_config = function () { this.page.url = document.location.href.split('?')[0].split('#')[0].replace('https://', 'http://'); this.page.identifier = this.page.url; }; (function() { var d = document, s = d.createElement('script'); s.src = '//yegor256.disqus.com/embed.js'; s.setAttribute('data-timestamp', +new Date()); (d.head || d.body).appendChild(s); })(); </script> <noscript><div><p class="red"> JavaScript is disabled in your browser, that's why you can't see comments under this post.</p></div></noscript></div><div class="wrapper"> <footer class="footer"><p> &copy; <span itemscope="" itemprop="copyrightHolder" itemtype="http://schema.org/Person"> <span itemprop="name">Yegor Bugayenko</span> </span> 2014&ndash;<span itemprop="copyrightYear">2018</span></p></footer></div></section><div class="wrapper unprintable" style="text-align:center;margin-top:2em;"> <a href="http://www.sixnines.io/h/3ba1652f"> <img src="//www.sixnines.io/b/3ba1652f?style=flat" alt="sixnines availability badge"/> </a></div><script src="//code.jquery.com/jquery-1.9.0.min.js"></script> <script src="/js/all.js?4e047f6f42b"></script> <script>var disqus_shortname = 'yegor256';</script> <script id="dsq-count-scr" src="//yegor256.disqus.com/count.js" async="async"></script> <script> (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){ (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o), m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m) })(window,document,'script','//www.google-analytics.com/analytics.js','ga'); ga('create', 'UA-1963507-32', 'auto'); ga('send', 'pageview'); </script> <script> Cd=document;Cr="&"+Math.random();Cp="&s=1"; Cd.cookie="b=b";if(Cd.cookie)Cp+="&c=1"; Cp+="&t="+(new Date()).getTimezoneOffset(); if(self!=top)Cp+="&f=1"; </script> <script> if(navigator.javaEnabled())Cp+="&j=1"; </script> <script> if(typeof(screen)!='undefined')Cp+="&w="+screen.width+"&h="+ screen.height+"&d="+(screen.colorDepth?screen.colorDepth:screen.pixelDepth); </script> <script> Cd.write("<img src='//c.hit.ua/hit?i=95870&g=0&x=2"+Cp+Cr+ "&r="+escape(Cd.referrer)+"&u="+escape(window.location.href)+ "' border='0' wi"+"dth='1' he"+"ight='1'/>"); </script> <script type="application/ld+json"> { "@context": "http://schema.org", "@type": "Person", "name": "Yegor Bugayenko", "url": "http://www.yegor256.com", "sameAs": [ "https://www.facebook.com/yegor256", "https://instagram.com/yegor256", "https://www.linkedin.com/in/yegor256", "https://twitter.com/yegor256", "https://github.com/yegor256", "https://www.pinterest.com/yegor256/" ] } </script> </body> </html> <!DOCTYPE html> <html xmlns="http://www.w3.org/1999/xhtml" lang="en-US" xml:lang="en-US" itemscope="" itemtype="http://schema.org/WebSite"> <head> <meta charset="utf-8"/> <meta name="description" content="Assertions are an outdated and flawed feature in Java (and some other languages) that I would not recommend you use. " /> <meta name="keywords" content="assertion or exception, assertions java, assertions or exceptions, exceptions over assertions, throw exception not assertion" /> <meta name="viewport" content="width=device-width,minimum-scale=1,initial-scale=1"/> <meta name="google-site-verification" content="JEj_gQr2CPe2QKGw8XdMz0R7VboQIUbX3FlM-lwTq-8" /> <meta name="author" content="Yegor Bugayenko"> <meta name="article:published_time" content="2016-06-17 00:00:00 +0000"> <meta name="og:site_name" content="Yegor Bugayenko"/> <meta name="og:type" content="article" /> <meta name="og:locale" content="en_US" /> <meta name="twitter:account_id" content="4503599630178231" /> <meta name="twitter:creator" content="@yegor256"/> <meta name="twitter:site" content="@yegor256"/> <meta name="twitter:title" property="og:title" content="Don't Use Java Assertions"/> <meta name="twitter:description" property="og:description" content="Assertions are an outdated and flawed feature in Java (and some other languages) that I would not recommend you use. "/> <meta name="twitter:url" property="og:url" content="https://www.yegor256.com/2016/06/17/dont-use-java-assertions.html"/> <meta name="telegram:channel" content="AAAAAEJFMRzsRTRxM3ec6A"/> <link rel="search" type="application/opensearchdescription+xml" href="/opensearch.xml" title="yegor256" /> <link rel="shortcut icon" href="/favicon.ico?4e047f6f42b"/> <link rel="apple-touch-icon" href="/favicon.ico?4e047f6f42b"/> <link rel="alternate" type="application/rss+xml" title="RSS for yegor256.com" href="https://www.yegor256.com/rss.xml"/> <link rel="stylesheet" href="/css/layout.css?4e047f6f42b"/> <link rel="stylesheet" href="/css/icons.css?4e047f6f42b"/> <link rel="canonical" href="https://www.yegor256.com/2016/06/17/dont-use-java-assertions.html" /> <link rel="amphtml" href="https://www.yegor256.com/2016/06/17/dont-use-java-assertions.amp.html" /> <title>Don't Use Java Assertions </title> <meta name='og:image' content='https://www.yegor256.com/images/2016/06/natural-born-killers.jpg'/><meta name='twitter:image' content='https://www.yegor256.com/images/2016/06/natural-born-killers.jpg'/><meta name='og:image:width' content='1200'/> <meta name='twitter:image:width' content='1200'/><meta name='og:image:height' content='672'/> <meta name='twitter:image:height' content='672'/><meta name='twitter:card' content='summary_large_image'/><meta name='twitter:image:alt' content='Natural Born Killers (1994) by Oliver Stone'/> </head> <body><div class="wrapper"> <aside class="header-toggle unprintable" id="header-toggle" title="Show the menu" onclick="$('#header').show();$('#header-toggle').hide();">&#9776;</aside> <header class="header" id="header"><div class="face"> <a href="/about-me.html#form" class="sub" title="Click to subscribe to my monthly newsletter"><span>Subscribe</span></a> <a href="/about-me.html" style="position:relative;"> <img src="/images/face-256x256.jpg" class="photo" alt="Yegor Bugayenko"/> </a></div><nav><ul class="menu social notranslate"> <li><a href="https://twitter.com/intent/follow?screen_name=yegor256" rel="nofollow" title="Follow me on Twitter"><i class="icon icon-twitter notranslate" aria-hidden="true"></i></a></li> <li><a href="/rss.xml" rel="nofollow" title="Subscribe to my RSS feed"><i class="icon icon-rss notranslate" aria-hidden="true"></i></a></li> <li><a itemprop="sameAs" href="https://github.com/yegor256" rel="nofollow" title="My GitHub profile"><i class="icon icon-github notranslate" aria-hidden="true"></i></a></li> <li><a itemprop="sameAs" href="http://stackoverflow.com/users/187141/yegor256" rel="nofollow" title="My StackOverflow profile"><i class="icon icon-stackoverflow notranslate" aria-hidden="true"></i></a></li> <li><a itemprop="sameAs" href="https://www.facebook.com/yegor256" rel="nofollow" title="Follow me on Facebook"><i class="icon icon-facebook notranslate" aria-hidden="true"></i></a></li> <li><a itemprop="sameAs" href="https://instagram.com/yegor256" rel="nofollow" title="Follow me on Instagram"><i class="icon icon-instagram notranslate" aria-hidden="true"></i></a></li> <li><a itemprop="sameAs" href="https://www.linkedin.com/in/yegor256" rel="nofollow" title="My LinkedIn profile"><i class="icon icon-linkedin notranslate" aria-hidden="true"></i></a></li> <li><a itemprop="sameAs" href="https://www.youtube.com/c/yegor256?sub_confirmation=1" rel="nofollow" title="My Youtube video channel"><i class="icon icon-youtube notranslate" aria-hidden="true"></i></a></li> <li><a itemprop="sameAs" href="https://www.pinterest.com/yegor256/" rel="nofollow" title="My Pinterest boards"><i class="icon icon-pinterest notranslate" aria-hidden="true"></i></a></li> <li><a itemprop="sameAs" href="https://angel.co/yegor256" rel="nofollow" title="My AngelList profile"><i class="icon icon-angellist notranslate" aria-hidden="true"></i></a></li> <li><a href="https://soundcloud.com/yegor256" rel="nofollow" title="My podcast"><i class="icon icon-podcast notranslate" aria-hidden="true"></i></a></li> <li><a href="https://itunes.apple.com/us/podcast/yegor256-podcast/id1150826721" rel="nofollow" title="My iTunes podcast"><i class="icon icon-itunes notranslate" aria-hidden="true"></i></a></li> <li><a href="https://t.me/joinchat/AAAAAEJFMRzsRTRxM3ec6A" rel="nofollow" title="My Telegram public channel"><i class="icon icon-telegram notranslate" aria-hidden="true"></i></a></li> <li><a href="mailto:blog@yegor256.com" rel="nofollow" title="Email me any time"><i class="icon icon-mail notranslate" aria-hidden="true"></i></a></li></ul><ul class="menu"> <li><a href="/" title="Home page">Home</a></li> <li ><a href="/best.html" title="Best articles to read">12&#160;Best</a></li> <li ><a href="/contents.html" title="The contents of the entire blog">All&#160;288</a></li> <li ><a href="/webinars.html" title="My webinars">Webinars</a></li> <li ><a href="/talks.html" title="Future and past conference talks">Talks</a></li> <li ><a href="/books.html" title="The books I wrote">Books</a></li> <li ><a href="/papers.html" title="My academic papers and patents">Papers</a></li> <li ><a href="/pets.html" title="My loved pet projects">Pets</a></li> <li ><a href="/award.html" title="Software quality award">Award</a></li> <li ><a href="/testimonials.html" title="What some people say about me">Testimonials</a></li> <li ><a href="/shift-m.html" title="Audio podcast about project management">Shift-M</a></li> <li ><a href="/paintings.html" title="My paintings for sale">Paintings</a></li> <li><a href="http://ru.yegor256.com/" title="Немного на русском языке">По-русски</a></li></ul></nav><div class="search"> <form method="get" action="https://www.google.com/search" itemprop="potentialAction" itemscope="" itemtype="http://schema.org/SearchAction"> <meta itemprop="target" content="https://www.google.com/search?q={q}"/> <input name="sitesearch" value="yegor256.com" type="hidden"/> <input itemprop="query-input" type="text" id="search-query" class="field field-text" required="required" onfocus="$('.google').css('visibility', 'visible');" name="q" placeholder="Search..." autocomplete="off"/> <input type="image" src="/images/google-search-icon.svg" class="google" title="Search via Google" alt="Search via Google"/> </form></div><div class="hot"><ul> <li> <a href="/code-ahead.html">Code Ahead</a> was published on Amazon just a few days ago! It is my new book, a novel about programmers. It explains in details the majority of ideas that stand behind <a href="https://www.zerocracy.com">Zerocracy</a> and <a href="https://www.xdsd.org">XDSD</a>. </li> <li> At <a href="/webinars.html">Webinar #37</a> we will discuss naming problem in OOP, for objects, methods and attributes; join us on <b>September 12</b>, at 11am PST. </li></ul></div></header></div><section itemscope="" itemtype="http://schema.org/BlogPosting"><div class="wrapper"> <header><p class="printable"> <img src="https://api.qrserver.com/v1/create-qr-code/?data=https://www.yegor256.com/2016/06/17/dont-use-java-assertions.html&amp;format=svg" style="width:125px;height:125px;" alt="QR code"/></p><p class="printable"> <code itemprop="url">https://www.yegor256.com/2016/06/17/dont-use-java-assertions.html</code></p><h1 itemprop="name headline mainEntityOfPage">Don't Use Java Assertions</h1><ul class="subline"> <li> <time itemprop="datePublished" datetime="2016-06-17T00:00:00+00:00"> 17 June 2016 </time> </li> <li class="desktop-only" itemprop="locationCreated">Los Angeles, CA</li> <li class="printable" itemscope="" itemprop="author" itemtype="http://schema.org/Person"> <span itemprop="name">Yegor Bugayenko</span> </li> <li class="unprintable"> <i class="icon icon-comments"></i> <a href="http://www.yegor256.com/2016/06/17/dont-use-java-assertions.html#disqus_thread" itemprop="discussionUrl">comments</a> </li></ul><figure class='jb_picture'><img itemprop='image' alt='Natural Born Killers (1994) by Oliver Stone' src='/images/2016/06/natural-born-killers.jpg' longdesc='#44ce340c'/><figcaption id='44ce340c'>Natural Born Killers (1994) by Oliver Stone</figcaption></figure><p>Let&#39;s see what happens when an assertion is triggered. Say that this is our code:</p><figure class="highlight"><pre><code class="language-java" data-lang="java"><span></span><span class="kd">public</span> <span class="kd">class</span> <span class="nc">Main</span> <span class="o">{</span>
  <span class="kd">public</span> <span class="kd">static</span> <span class="kt">void</span> <span class="nf">main</span><span class="o">(</span><span class="n">String</span><span class="o">...</span> <span class="n">args</span><span class="o">)</span> <span class="o">{</span>
    <span class="k">assert</span> <span class="kc">true</span> <span class="o">==</span> <span class="kc">false</span> <span class="o">:</span> <span class="s">&quot;There is a problem&quot;</span><span class="o">;</span>
    <span class="n">System</span><span class="o">.</span><span class="na">out</span><span class="o">.</span><span class="na">println</span><span class="o">(</span><span class="s">&quot;Hello, world!&quot;</span><span class="o">);</span>
  <span class="o">}</span>
<span class="o">}</span></code></pre></figure><p>Save this code to <code>Main.java</code> and compile:</p><figure class="highlight"><pre><code class="language-bash" data-lang="bash"><span></span>$ javac Main.java</code></pre></figure><p>Then run it:</p><figure class="highlight"><pre><code class="language-bash" data-lang="bash"><span></span>$ java Main
Hello, world!</code></pre></figure><p>The assertion wasn&#39;t triggered. It was ignored. Now run it with an <code>-enableassertions</code> flag:</p><figure class="highlight"><pre><code class="language-bash" data-lang="bash"><span></span>$ java -enableassertions Main
Exception in thread <span class="s2">&quot;main&quot;</span> java.lang.AssertionError: There is a problem
  at Main.main<span class="o">(</span>Main.java:3<span class="o">)</span></code></pre></figure><p>This is the first difference between exceptions and assertions. Exceptions will always be thrown, while assertions are not enabled by default. They are supposed to be turned on during testing and turned off in production. The assertion caused the runtime exception <a href="https://docs.oracle.com/javase/7/docs/api/java/lang/AssertionError.html"><code>AssertionError</code></a>. But hold on; it&#39;s not a <a href="https://docs.oracle.com/javase/7/docs/api/java/lang/RuntimeException.html"><code>RuntimeException</code></a>. It extends <a href="https://docs.oracle.com/javase/7/docs/api/java/lang/Error.html"><code>Error</code></a> class, which extends <a href="https://docs.oracle.com/javase/7/docs/api/java/lang/Throwable.html"><code>Throwable</code></a>. This is the second difference. I don&#39;t know of any other differences.</p><p>I would recommend <strong>not</strong> to use assertions ... ever. Simply because I strongly believe in the <a href="/2015/08/25/fail-fast.html">Fail Fast</a> approach. I think bugs must be visible not only during testing but also in production. Moreover, I believe making bugs visible in production is very important if you want to achieve a high-quality product.</p><p>Thus, no assertions. They are simply a flawed and outdated feature in Java (and some other languages).</p></p>--> <nav class="buttons notranslate desktop-only"> <a href="http://www.facebook.com/sharer/sharer.php?u=https://www.yegor256.com/2016/06/17/dont-use-java-assertions.html" title="Share on Facebook" class="button" rel="nofollow"> <span class="count count-facebook">0</span> <i class="icon icon-facebook notranslate" aria-hidden="true"></i> </a> <a href="https://twitter.com/share?url=https://www.yegor256.com/2016/06/17/dont-use-java-assertions.html&amp;text=Don%27t+Use+Java+Assertions" title="Share on Twitter" class="button" rel="nofollow"> <span class="count count-twitter">0</span> <i class="icon icon-twitter notranslate" aria-hidden="true"></i> </a> <a href="https://plus.google.com/share?url=https://www.yegor256.com/2016/06/17/dont-use-java-assertions.html" title="Share on Google+" class="button" rel="nofollow"> <span class="count count-googleplus">0</span> <i class="icon icon-googleplus notranslate" aria-hidden="true"></i> </a> <a href="https://www.linkedin.com/cws/share?url=https://www.yegor256.com/2016/06/17/dont-use-java-assertions.html" title="Share on LinkedIn" class="button" rel="nofollow"> <span class="count count-linkedin">0</span> <i class="icon icon-linkedin notranslate" aria-hidden="true"></i> </a> <a href="http://reddit.com/submit?url=https://www.yegor256.com/2016/06/17/dont-use-java-assertions.html%3F2016-24&amp;title=Don%27t+Use+Java+Assertions" title="Share on Reddit" class="button" rel="nofollow"> <span class="count count-reddit">0</span> <i class="icon icon-reddit notranslate" aria-hidden="true"></i> </a> <a href="http://news.ycombinator.com/submitlink?u=https://www.yegor256.com/2016/06/17/dont-use-java-assertions.html%3F2016-24&amp;t=Don%27t+Use+Java+Assertions" title="Share on Hacker News" class="button" rel="nofollow"> <span class="count count-hackernews">0</span> <i class="icon icon-hackernews notranslate" aria-hidden="true"></i> </a> </nav> </header> <article class="main" itemprop="articleBody"><div ><p>There are basically two ways to validate a situation in Java and complain when something unexpected happens. It&#39;s either an exception or an assertion. Technically, they are almost the same, but there are some small differences. I believe that exceptions are the right way to go in all situations and assertions should never be used. Here&#39;s why.</p><figure class='jb_picture'><img itemprop='image' alt='Natural Born Killers (1994) by Oliver Stone' src='/images/2016/06/natural-born-killers.jpg' longdesc='#44ce340c'/><figcaption id='44ce340c'>Natural Born Killers (1994) by Oliver Stone</figcaption></figure><p>Let&#39;s see what happens when an assertion is triggered. Say that this is our code:</p><figure class="highlight"><pre><code class="language-java" data-lang="java"><span></span><span class="kd">public</span> <span class="kd">class</span> <span class="nc">Main</span> <span class="o">{</span>
  <span class="kd">public</span> <span class="kd">static</span> <span class="kt">void</span> <span class="nf">main</span><span class="o">(</span><span class="n">String</span><span class="o">...</span> <span class="n">args</span><span class="o">)</span> <span class="o">{</span>
    <span class="k">assert</span> <span class="kc">true</span> <span class="o">==</span> <span class="kc">false</span> <span class="o">:</span> <span class="s">&quot;There is a problem&quot;</span><span class="o">;</span>
    <span class="n">System</span><span class="o">.</span><span class="na">out</span><span class="o">.</span><span class="na">println</span><span class="o">(</span><span class="s">&quot;Hello, world!&quot;</span><span class="o">);</span>
  <span class="o">}</span>
<span class="o">}</span></code></pre></figure><p>Save this code to <code>Main.java</code> and compile:</p><figure class="highlight"><pre><code class="language-bash" data-lang="bash"><span></span>$ javac Main.java</code></pre></figure><p>Then run it:</p><figure class="highlight"><pre><code class="language-bash" data-lang="bash"><span></span>$ java Main
Hello, world!</code></pre></figure><p>The assertion wasn&#39;t triggered. It was ignored. Now run it with an <code>-enableassertions</code> flag:</p><figure class="highlight"><pre><code class="language-bash" data-lang="bash"><span></span>$ java -enableassertions Main
Exception in thread <span class="s2">&quot;main&quot;</span> java.lang.AssertionError: There is a problem
  at Main.main<span class="o">(</span>Main.java:3<span class="o">)</span></code></pre></figure><p>This is the first difference between exceptions and assertions. Exceptions will always be thrown, while assertions are not enabled by default. They are supposed to be turned on during testing and turned off in production. The assertion caused the runtime exception <a href="https://docs.oracle.com/javase/7/docs/api/java/lang/AssertionError.html"><code>AssertionError</code></a>. But hold on; it&#39;s not a <a href="https://docs.oracle.com/javase/7/docs/api/java/lang/RuntimeException.html"><code>RuntimeException</code></a>. It extends <a href="https://docs.oracle.com/javase/7/docs/api/java/lang/Error.html"><code>Error</code></a> class, which extends <a href="https://docs.oracle.com/javase/7/docs/api/java/lang/Throwable.html"><code>Throwable</code></a>. This is the second difference. I don&#39;t know of any other differences.</p><p>I would recommend <strong>not</strong> to use assertions ... ever. Simply because I strongly believe in the <a href="/2015/08/25/fail-fast.html">Fail Fast</a> approach. I think bugs must be visible not only during testing but also in production. Moreover, I believe making bugs visible in production is very important if you want to achieve a high-quality product.</p><p>Thus, no assertions. They are simply a flawed and outdated feature in Java (and some other languages).</p></div></article></div><div class="wrapper"> <related-posts /></div><div class="disqus" role="complementary"><p class="disqus_hint"> Please, use <a href="https://help.disqus.com/commenting/what-html-tags-are-allowed-within-comments">syntax highlighting</a> in your comments, to make them more readable.</p><div id="disqus_thread" class="disqus-thread"> <a>&nbsp;</a></div><script> var disqus_config = function () { this.page.url = document.location.href.split('?')[0].split('#')[0].replace('https://', 'http://'); this.page.identifier = this.page.url; }; (function() { var d = document, s = d.createElement('script'); s.src = '//yegor256.disqus.com/embed.js'; s.setAttribute('data-timestamp', +new Date()); (d.head || d.body).appendChild(s); })(); </script> <noscript><div><p class="red"> JavaScript is disabled in your browser, that's why you can't see comments under this post.</p></div></noscript></div><div class="wrapper"> <footer class="footer"><p> &copy; <span itemscope="" itemprop="copyrightHolder" itemtype="http://schema.org/Person"> <span itemprop="name">Yegor Bugayenko</span> </span> 2014&ndash;<span itemprop="copyrightYear">2018</span></p></footer></div></section><div class="wrapper unprintable" style="text-align:center;margin-top:2em;"> <a href="http://www.sixnines.io/h/3ba1652f"> <img src="//www.sixnines.io/b/3ba1652f?style=flat" alt="sixnines availability badge"/> </a></div><script src="//code.jquery.com/jquery-1.9.0.min.js"></script> <script src="/js/all.js?4e047f6f42b"></script> <script>var disqus_shortname = 'yegor256';</script> <script id="dsq-count-scr" src="//yegor256.disqus.com/count.js" async="async"></script> <script> (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){ (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o), m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m) })(window,document,'script','//www.google-analytics.com/analytics.js','ga'); ga('create', 'UA-1963507-32', 'auto'); ga('send', 'pageview'); </script> <script> Cd=document;Cr="&"+Math.random();Cp="&s=1"; Cd.cookie="b=b";if(Cd.cookie)Cp+="&c=1"; Cp+="&t="+(new Date()).getTimezoneOffset(); if(self!=top)Cp+="&f=1"; </script> <script> if(navigator.javaEnabled())Cp+="&j=1"; </script> <script> if(typeof(screen)!='undefined')Cp+="&w="+screen.width+"&h="+ screen.height+"&d="+(screen.colorDepth?screen.colorDepth:screen.pixelDepth); </script> <script> Cd.write("<img src='//c.hit.ua/hit?i=95870&g=0&x=2"+Cp+Cr+ "&r="+escape(Cd.referrer)+"&u="+escape(window.location.href)+ "' border='0' wi"+"dth='1' he"+"ight='1'/>"); </script> <script type="application/ld+json"> { "@context": "http://schema.org", "@type": "Person", "name": "Yegor Bugayenko", "url": "http://www.yegor256.com", "sameAs": [ "https://www.facebook.com/yegor256", "https://instagram.com/yegor256", "https://www.linkedin.com/in/yegor256", "https://twitter.com/yegor256", "https://github.com/yegor256", "https://www.pinterest.com/yegor256/" ] } </script> </body> </html> <!DOCTYPE html> <html xmlns="http://www.w3.org/1999/xhtml" lang="en-US" xml:lang="en-US" itemscope="" itemtype="http://schema.org/WebSite"> <head> <meta charset="utf-8"/> <meta name="description" content="When we use private static literals to get rid of value duplication, unnecessary coupling between test methods serously affects maintainability. " /> <meta name="keywords" content="code duplication, coupling and cohesion, java private static final, private static final, private static final java" /> <meta name="viewport" content="width=device-width,minimum-scale=1,initial-scale=1"/> <meta name="google-site-verification" content="JEj_gQr2CPe2QKGw8XdMz0R7VboQIUbX3FlM-lwTq-8" /> <meta name="author" content="Yegor Bugayenko"> <meta name="article:published_time" content="2016-05-03 00:00:00 +0000"> <meta name="og:site_name" content="Yegor Bugayenko"/> <meta name="og:type" content="article" /> <meta name="og:locale" content="en_US" /> <meta name="twitter:account_id" content="4503599630178231" /> <meta name="twitter:creator" content="@yegor256"/> <meta name="twitter:site" content="@yegor256"/> <meta name="twitter:title" property="og:title" content="Test Methods Must Share Nothing"/> <meta name="twitter:description" property="og:description" content="When we use private static literals to get rid of value duplication, unnecessary coupling between test methods serously affects maintainability. "/> <meta name="twitter:url" property="og:url" content="https://www.yegor256.com/2016/05/03/test-methods-must-share-nothing.html"/> <meta name="telegram:channel" content="AAAAAEJFMRzsRTRxM3ec6A"/> <link rel="search" type="application/opensearchdescription+xml" href="/opensearch.xml" title="yegor256" /> <link rel="shortcut icon" href="/favicon.ico?4e047f6f42b"/> <link rel="apple-touch-icon" href="/favicon.ico?4e047f6f42b"/> <link rel="alternate" type="application/rss+xml" title="RSS for yegor256.com" href="https://www.yegor256.com/rss.xml"/> <link rel="stylesheet" href="/css/layout.css?4e047f6f42b"/> <link rel="stylesheet" href="/css/icons.css?4e047f6f42b"/> <link rel="canonical" href="https://www.yegor256.com/2016/05/03/test-methods-must-share-nothing.html" /> <link rel="amphtml" href="https://www.yegor256.com/2016/05/03/test-methods-must-share-nothing.amp.html" /> <title>Test Methods Must Share Nothing </title> <meta name='og:image' content='https://www.yegor256.com/images/2016/05/old-boy.jpg'/><meta name='twitter:image' content='https://www.yegor256.com/images/2016/05/old-boy.jpg'/><meta name='og:image:width' content='1200'/> <meta name='twitter:image:width' content='1200'/><meta name='og:image:height' content='675'/> <meta name='twitter:image:height' content='675'/><meta name='twitter:card' content='summary_large_image'/><meta name='twitter:image:alt' content='Oldeuboi (2003) by Chan-wook Park'/> </head> <body><div class="wrapper"> <aside class="header-toggle unprintable" id="header-toggle" title="Show the menu" onclick="$('#header').show();$('#header-toggle').hide();">&#9776;</aside> <header class="header" id="header"><div class="face"> <a href="/about-me.html#form" class="sub" title="Click to subscribe to my monthly newsletter"><span>Subscribe</span></a> <a href="/about-me.html" style="position:relative;"> <img src="/images/face-256x256.jpg" class="photo" alt="Yegor Bugayenko"/> </a></div><nav><ul class="menu social notranslate"> <li><a href="https://twitter.com/intent/follow?screen_name=yegor256" rel="nofollow" title="Follow me on Twitter"><i class="icon icon-twitter notranslate" aria-hidden="true"></i></a></li> <li><a href="/rss.xml" rel="nofollow" title="Subscribe to my RSS feed"><i class="icon icon-rss notranslate" aria-hidden="true"></i></a></li> <li><a itemprop="sameAs" href="https://github.com/yegor256" rel="nofollow" title="My GitHub profile"><i class="icon icon-github notranslate" aria-hidden="true"></i></a></li> <li><a itemprop="sameAs" href="http://stackoverflow.com/users/187141/yegor256" rel="nofollow" title="My StackOverflow profile"><i class="icon icon-stackoverflow notranslate" aria-hidden="true"></i></a></li> <li><a itemprop="sameAs" href="https://www.facebook.com/yegor256" rel="nofollow" title="Follow me on Facebook"><i class="icon icon-facebook notranslate" aria-hidden="true"></i></a></li> <li><a itemprop="sameAs" href="https://instagram.com/yegor256" rel="nofollow" title="Follow me on Instagram"><i class="icon icon-instagram notranslate" aria-hidden="true"></i></a></li> <li><a itemprop="sameAs" href="https://www.linkedin.com/in/yegor256" rel="nofollow" title="My LinkedIn profile"><i class="icon icon-linkedin notranslate" aria-hidden="true"></i></a></li> <li><a itemprop="sameAs" href="https://www.youtube.com/c/yegor256?sub_confirmation=1" rel="nofollow" title="My Youtube video channel"><i class="icon icon-youtube notranslate" aria-hidden="true"></i></a></li> <li><a itemprop="sameAs" href="https://www.pinterest.com/yegor256/" rel="nofollow" title="My Pinterest boards"><i class="icon icon-pinterest notranslate" aria-hidden="true"></i></a></li> <li><a itemprop="sameAs" href="https://angel.co/yegor256" rel="nofollow" title="My AngelList profile"><i class="icon icon-angellist notranslate" aria-hidden="true"></i></a></li> <li><a href="https://soundcloud.com/yegor256" rel="nofollow" title="My podcast"><i class="icon icon-podcast notranslate" aria-hidden="true"></i></a></li> <li><a href="https://itunes.apple.com/us/podcast/yegor256-podcast/id1150826721" rel="nofollow" title="My iTunes podcast"><i class="icon icon-itunes notranslate" aria-hidden="true"></i></a></li> <li><a href="https://t.me/joinchat/AAAAAEJFMRzsRTRxM3ec6A" rel="nofollow" title="My Telegram public channel"><i class="icon icon-telegram notranslate" aria-hidden="true"></i></a></li> <li><a href="mailto:blog@yegor256.com" rel="nofollow" title="Email me any time"><i class="icon icon-mail notranslate" aria-hidden="true"></i></a></li></ul><ul class="menu"> <li><a href="/" title="Home page">Home</a></li> <li ><a href="/best.html" title="Best articles to read">12&#160;Best</a></li> <li ><a href="/contents.html" title="The contents of the entire blog">All&#160;288</a></li> <li ><a href="/webinars.html" title="My webinars">Webinars</a></li> <li ><a href="/talks.html" title="Future and past conference talks">Talks</a></li> <li ><a href="/books.html" title="The books I wrote">Books</a></li> <li ><a href="/papers.html" title="My academic papers and patents">Papers</a></li> <li ><a href="/pets.html" title="My loved pet projects">Pets</a></li> <li ><a href="/award.html" title="Software quality award">Award</a></li> <li ><a href="/testimonials.html" title="What some people say about me">Testimonials</a></li> <li ><a href="/shift-m.html" title="Audio podcast about project management">Shift-M</a></li> <li ><a href="/paintings.html" title="My paintings for sale">Paintings</a></li> <li><a href="http://ru.yegor256.com/" title="Немного на русском языке">По-русски</a></li></ul></nav><div class="search"> <form method="get" action="https://www.google.com/search" itemprop="potentialAction" itemscope="" itemtype="http://schema.org/SearchAction"> <meta itemprop="target" content="https://www.google.com/search?q={q}"/> <input name="sitesearch" value="yegor256.com" type="hidden"/> <input itemprop="query-input" type="text" id="search-query" class="field field-text" required="required" onfocus="$('.google').css('visibility', 'visible');" name="q" placeholder="Search..." autocomplete="off"/> <input type="image" src="/images/google-search-icon.svg" class="google" title="Search via Google" alt="Search via Google"/> </form></div><div class="hot"><ul> <li> <a href="/code-ahead.html">Code Ahead</a> was published on Amazon just a few days ago! It is my new book, a novel about programmers. It explains in details the majority of ideas that stand behind <a href="https://www.zerocracy.com">Zerocracy</a> and <a href="https://www.xdsd.org">XDSD</a>. </li> <li> At <a href="/webinars.html">Webinar #37</a> we will discuss naming problem in OOP, for objects, methods and attributes; join us on <b>September 12</b>, at 11am PST. </li></ul></div></header></div><section itemscope="" itemtype="http://schema.org/BlogPosting"><div class="wrapper"> <header><p class="printable"> <img src="https://api.qrserver.com/v1/create-qr-code/?data=https://www.yegor256.com/2016/05/03/test-methods-must-share-nothing.html&amp;format=svg" style="width:125px;height:125px;" alt="QR code"/></p><p class="printable"> <code itemprop="url">https://www.yegor256.com/2016/05/03/test-methods-must-share-nothing.html</code></p><h1 itemprop="name headline mainEntityOfPage">Test Methods Must Share Nothing</h1><ul class="subline"> <li> <time itemprop="datePublished" datetime="2016-05-03T00:00:00+00:00"> 3 May 2016 </time> </li> <li class="desktop-only" itemprop="locationCreated">Palo Alto, CA</li> <li class="printable" itemscope="" itemprop="author" itemtype="http://schema.org/Person"> <span itemprop="name">Yegor Bugayenko</span> </li> <li class="unprintable"> <i class="icon icon-comments"></i> <a href="http://www.yegor256.com/2016/05/03/test-methods-must-share-nothing.html#disqus_thread" itemprop="discussionUrl">comments</a> </li></ul><figure class='jb_picture'><img itemprop='image' alt='Oldeuboi (2003) by Chan-wook Park' src='/images/2016/05/old-boy.jpg' longdesc='#934a9853'/><figcaption id='934a9853'>Oldeuboi (2003) by Chan-wook Park</figcaption></figure><p>Unit tests, naturally, duplicate a lot of code. Test methods contain similar or almost identical functionality and this is almost inevitable. Well, we can use more of that <a href="http://junit.sourceforge.net/javadoc/org/junit/Before.html"><code>@Before</code></a> and <a href="http://junit.sourceforge.net/javadoc/org/junit/Before.html"><code>@BeforeClass</code></a> features, but sometimes it&#39;s just not possible. We may have, say, 20 test methods in one <code>FooTest.java</code> file. Preparing all objects in one &quot;before&quot; is not possible. So we have to do certain things again and again in our test methods.</p><p>Let&#39;s take a look at one of the classes in our <a href="http://www.takes.org">Takes Framework</a>: <a href="https://github.com/yegor256/takes/blob/0.32.7/src/test/java/org/takes/misc/VerboseListTest.java"><code>VerboseListTest</code></a>. It&#39;s a unit test and it has a problem, which I&#39;m trying to tell you about. Look at that <a href="https://github.com/yegor256/takes/blob/0.32.7/src/test/java/org/takes/misc/VerboseListTest.java#L54"><code>MSG</code></a> private literal. It is used for the first time in <a href="https://github.com/yegor256/takes/blob/0.32.7/src/test/java/org/takes/misc/VerboseListTest.java#L77-L80"><code>setUp()</code></a> method as an argument of an object constructor and then in a few test methods to check how that object behaves. Let me simplify that code:</p><figure class="highlight"><pre><code class="language-java" data-lang="java"><span></span><span class="kd">class</span> <span class="nc">FooTest</span> <span class="o">{</span>
  <span class="kd">private</span> <span class="kd">static</span> <span class="kd">final</span> <span class="n">String</span> <span class="n">MSG</span> <span class="o">=</span> <span class="s">&quot;something&quot;</span><span class="o">;</span>
  <span class="nd">@Before</span>
  <span class="kd">public</span> <span class="kd">final</span> <span class="kt">void</span> <span class="nf">setUp</span><span class="o">()</span> <span class="kd">throws</span> <span class="n">Exception</span> <span class="o">{</span>
    <span class="k">this</span><span class="o">.</span><span class="na">foo</span> <span class="o">=</span> <span class="k">new</span> <span class="n">Foo</span><span class="o">(</span><span class="n">FooTest</span><span class="o">.</span><span class="na">MSG</span><span class="o">);</span>
  <span class="o">}</span>
  <span class="nd">@Test</span>
  <span class="kd">public</span> <span class="kt">void</span> <span class="nf">simplyWorks</span><span class="o">()</span> <span class="kd">throws</span> <span class="n">IOException</span> <span class="o">{</span>
    <span class="n">assertThat</span><span class="o">(</span>
      <span class="n">foo</span><span class="o">.</span><span class="na">doSomething</span><span class="o">(),</span>
      <span class="n">containsString</span><span class="o">(</span><span class="n">FooTest</span><span class="o">.</span><span class="na">MSG</span><span class="o">)</span>
    <span class="o">);</span>
  <span class="o">}</span>
  <span class="nd">@Test</span>
  <span class="kd">public</span> <span class="kt">void</span> <span class="nf">simplyWorksAgain</span><span class="o">()</span> <span class="kd">throws</span> <span class="n">IOException</span> <span class="o">{</span>
    <span class="n">assertThat</span><span class="o">(</span>
      <span class="n">foo</span><span class="o">.</span><span class="na">doSomethingElse</span><span class="o">(),</span>
      <span class="n">containsString</span><span class="o">(</span><span class="n">FooTest</span><span class="o">.</span><span class="na">MSG</span><span class="o">)</span>
    <span class="o">);</span>
  <span class="o">}</span>
<span class="o">}</span></code></pre></figure><p>This is basically what is happening in <a href="https://github.com/yegor256/takes/blob/0.32.7/src/test/java/org/takes/misc/VerboseListTest.java"><code>VerboseListTest</code></a> and it&#39;s very wrong. Why? Because this shared literal <code>MSG</code> introduced an unnatural coupling between these two test methods. They have nothing in common, because they test different behaviors of class <code>Foo</code>. But this private constant ties them together. Now they are somehow related.</p><p>If and when I want to modify one of the test methods, I may need to modify the other one too. Say I want to see how <code>doSomethingElse()</code> behaves if the encapsulated message is an empty string. What do I do? I change the value of the constant <code>FooTest.MSG</code>, which is used by another test method. This is called coupling. And it&#39;s a bad thing.</p><p>What do we do? Well, we can use that <code>&quot;something&quot;</code> string literal in both test methods:</p><figure class="highlight"><pre><code class="language-java" data-lang="java"><span></span><span class="kd">class</span> <span class="nc">FooTest</span> <span class="o">{</span>
  <span class="nd">@Test</span>
  <span class="kd">public</span> <span class="kt">void</span> <span class="nf">simplyWorks</span><span class="o">()</span> <span class="kd">throws</span> <span class="n">IOException</span> <span class="o">{</span>
    <span class="n">assertThat</span><span class="o">(</span>
      <span class="k">new</span> <span class="n">Foo</span><span class="o">(</span><span class="s">&quot;something&quot;</span><span class="o">).</span><span class="na">doSomething</span><span class="o">(),</span>
      <span class="n">containsString</span><span class="o">(</span><span class="s">&quot;something&quot;</span><span class="o">)</span>
    <span class="o">);</span>
  <span class="o">}</span>
  <span class="nd">@Test</span>
  <span class="kd">public</span> <span class="kt">void</span> <span class="nf">simplyWorksAgain</span><span class="o">()</span> <span class="kd">throws</span> <span class="n">IOException</span> <span class="o">{</span>
    <span class="n">assertThat</span><span class="o">(</span>
      <span class="k">new</span> <span class="n">Foo</span><span class="o">(</span><span class="s">&quot;something&quot;</span><span class="o">).</span><span class="na">doSomethingElse</span><span class="o">(),</span>
      <span class="n">containsString</span><span class="o">(</span><span class="s">&quot;something&quot;</span><span class="o">)</span>
    <span class="o">);</span>
  <span class="o">}</span>
<span class="o">}</span></code></pre></figure><p>As you see, I got rid of that <code>setUp()</code> method and the private static literal <code>MSG</code>. What do we have now? Code duplication. String <code>&quot;something&quot;</code> shows up four times in the test class. No static analyzers will tolerate that. Moreover, there are seven (!) test methods in <a href="https://github.com/yegor256/takes/blob/0.32.7/src/test/java/org/takes/misc/VerboseListTest.java"><code>VerboseListTest</code></a>, which are using <code>MSG</code>. Thus, we will have 14 occurrences of <code>&quot;something&quot;</code>, right? Yes, that&#39;s right and that&#39;s most likely why one of authors of this test case introduced the constant---to get rid of duplication. BTW, <a href="https://github.com/Happy-Neko">@Happy-Neko</a> did that in pull request <a href="https://github.com/yegor256/takes/pull/513">#513</a>, <a href="https://github.com/carlosmiranda"><code>@carlosmiranda</code></a> reviewed the code and I approved the changes. So, three people made/approved that mistake, including myself.</p><p>So what is the right approach that will avoid code duplication and at the same time won&#39;t introduce coupling? Here it is:</p><figure class="highlight"><pre><code class="language-java" data-lang="java"><span></span><span class="kd">class</span> <span class="nc">FooTest</span> <span class="o">{</span>
  <span class="nd">@Test</span>
  <span class="kd">public</span> <span class="kt">void</span> <span class="nf">simplyWorks</span><span class="o">()</span> <span class="kd">throws</span> <span class="n">IOException</span> <span class="o">{</span>
    <span class="kd">final</span> <span class="n">String</span> <span class="n">msg</span> <span class="o">=</span> <span class="s">&quot;something&quot;</span><span class="o">;</span>
    <span class="n">assertThat</span><span class="o">(</span>
      <span class="k">new</span> <span class="n">Foo</span><span class="o">(</span><span class="n">msg</span><span class="o">).</span><span class="na">doSomething</span><span class="o">(),</span>
      <span class="n">containsString</span><span class="o">(</span><span class="n">msg</span><span class="o">)</span>
    <span class="o">);</span>
  <span class="o">}</span>
  <span class="nd">@Test</span>
  <span class="kd">public</span> <span class="kt">void</span> <span class="nf">simplyWorksAgain</span><span class="o">()</span> <span class="kd">throws</span> <span class="n">IOException</span> <span class="o">{</span>
    <span class="kd">final</span> <span class="n">String</span> <span class="n">msg</span> <span class="o">=</span> <span class="s">&quot;something else&quot;</span><span class="o">;</span>
    <span class="n">assertThat</span><span class="o">(</span>
      <span class="k">new</span> <span class="n">Foo</span><span class="o">(</span><span class="n">msg</span><span class="o">).</span><span class="na">doSomethingElse</span><span class="o">(),</span>
      <span class="n">containsString</span><span class="o">(</span><span class="n">msg</span><span class="o">)</span>
    <span class="o">);</span>
  <span class="o">}</span>
<span class="o">}</span></code></pre></figure><p>These literals must be different. This is what any static analyzer is saying when it sees <code>&quot;something&quot;</code> in so many places. It questions us---why are they the same? Is it really so important to use <code>&quot;something&quot;</code> everywhere? Why can&#39;t you use different literals? Of course we can. And we should.</p><p>The bottom line is that each test method must have its own set of data and objects. They must not be shared between test methods ever. Test methods must always be independent, having nothing in common.</p><p>Having that in mind, we can easily conclude that methods like <code>setUp()</code> or any shared variables in test classes are <strong>evil</strong>. They must not be used and simply must not exist. I think that their invention in JUnit caused a lot of harm to Java code.</p></p>--> <nav class="buttons notranslate desktop-only"> <a href="http://www.facebook.com/sharer/sharer.php?u=https://www.yegor256.com/2016/05/03/test-methods-must-share-nothing.html" title="Share on Facebook" class="button" rel="nofollow"> <span class="count count-facebook">0</span> <i class="icon icon-facebook notranslate" aria-hidden="true"></i> </a> <a href="https://twitter.com/share?url=https://www.yegor256.com/2016/05/03/test-methods-must-share-nothing.html&amp;text=Test+Methods+Must+Share+Nothing" title="Share on Twitter" class="button" rel="nofollow"> <span class="count count-twitter">0</span> <i class="icon icon-twitter notranslate" aria-hidden="true"></i> </a> <a href="https://plus.google.com/share?url=https://www.yegor256.com/2016/05/03/test-methods-must-share-nothing.html" title="Share on Google+" class="button" rel="nofollow"> <span class="count count-googleplus">0</span> <i class="icon icon-googleplus notranslate" aria-hidden="true"></i> </a> <a href="https://www.linkedin.com/cws/share?url=https://www.yegor256.com/2016/05/03/test-methods-must-share-nothing.html" title="Share on LinkedIn" class="button" rel="nofollow"> <span class="count count-linkedin">0</span> <i class="icon icon-linkedin notranslate" aria-hidden="true"></i> </a> <a href="http://reddit.com/submit?url=https://www.yegor256.com/2016/05/03/test-methods-must-share-nothing.html%3F2016-18&amp;title=Test+Methods+Must+Share+Nothing" title="Share on Reddit" class="button" rel="nofollow"> <span class="count count-reddit">0</span> <i class="icon icon-reddit notranslate" aria-hidden="true"></i> </a> <a href="http://news.ycombinator.com/submitlink?u=https://www.yegor256.com/2016/05/03/test-methods-must-share-nothing.html%3F2016-18&amp;t=Test+Methods+Must+Share+Nothing" title="Share on Hacker News" class="button" rel="nofollow"> <span class="count count-hackernews">0</span> <i class="icon icon-hackernews notranslate" aria-hidden="true"></i> </a> </nav> </header> <article class="main" itemprop="articleBody"><div ><p>Constants... I wrote about them <a href="/2015/07/06/public-static-literals.html">some time ago</a>, mostly saying that they are a bad thing, if being public. They reduce duplication, but introduce coupling. A much better way to get rid of duplication is by creating new classes or methods---a traditional OOP method. This seems to make sense and in our projects I see less and less public constants. In some projects we don&#39;t have them at all. But one thing still bothers me: unit tests. Most programmers seem to think that when static analysis says that there are too many similar literals in the same file, the best way to get rid of them is via a private static literal. This is just wrong.</p><figure class='jb_picture'><img itemprop='image' alt='Oldeuboi (2003) by Chan-wook Park' src='/images/2016/05/old-boy.jpg' longdesc='#934a9853'/><figcaption id='934a9853'>Oldeuboi (2003) by Chan-wook Park</figcaption></figure><p>Unit tests, naturally, duplicate a lot of code. Test methods contain similar or almost identical functionality and this is almost inevitable. Well, we can use more of that <a href="http://junit.sourceforge.net/javadoc/org/junit/Before.html"><code>@Before</code></a> and <a href="http://junit.sourceforge.net/javadoc/org/junit/Before.html"><code>@BeforeClass</code></a> features, but sometimes it&#39;s just not possible. We may have, say, 20 test methods in one <code>FooTest.java</code> file. Preparing all objects in one &quot;before&quot; is not possible. So we have to do certain things again and again in our test methods.</p><p>Let&#39;s take a look at one of the classes in our <a href="http://www.takes.org">Takes Framework</a>: <a href="https://github.com/yegor256/takes/blob/0.32.7/src/test/java/org/takes/misc/VerboseListTest.java"><code>VerboseListTest</code></a>. It&#39;s a unit test and it has a problem, which I&#39;m trying to tell you about. Look at that <a href="https://github.com/yegor256/takes/blob/0.32.7/src/test/java/org/takes/misc/VerboseListTest.java#L54"><code>MSG</code></a> private literal. It is used for the first time in <a href="https://github.com/yegor256/takes/blob/0.32.7/src/test/java/org/takes/misc/VerboseListTest.java#L77-L80"><code>setUp()</code></a> method as an argument of an object constructor and then in a few test methods to check how that object behaves. Let me simplify that code:</p><figure class="highlight"><pre><code class="language-java" data-lang="java"><span></span><span class="kd">class</span> <span class="nc">FooTest</span> <span class="o">{</span>
  <span class="kd">private</span> <span class="kd">static</span> <span class="kd">final</span> <span class="n">String</span> <span class="n">MSG</span> <span class="o">=</span> <span class="s">&quot;something&quot;</span><span class="o">;</span>
  <span class="nd">@Before</span>
  <span class="kd">public</span> <span class="kd">final</span> <span class="kt">void</span> <span class="nf">setUp</span><span class="o">()</span> <span class="kd">throws</span> <span class="n">Exception</span> <span class="o">{</span>
    <span class="k">this</span><span class="o">.</span><span class="na">foo</span> <span class="o">=</span> <span class="k">new</span> <span class="n">Foo</span><span class="o">(</span><span class="n">FooTest</span><span class="o">.</span><span class="na">MSG</span><span class="o">);</span>
  <span class="o">}</span>
  <span class="nd">@Test</span>
  <span class="kd">public</span> <span class="kt">void</span> <span class="nf">simplyWorks</span><span class="o">()</span> <span class="kd">throws</span> <span class="n">IOException</span> <span class="o">{</span>
    <span class="n">assertThat</span><span class="o">(</span>
      <span class="n">foo</span><span class="o">.</span><span class="na">doSomething</span><span class="o">(),</span>
      <span class="n">containsString</span><span class="o">(</span><span class="n">FooTest</span><span class="o">.</span><span class="na">MSG</span><span class="o">)</span>
    <span class="o">);</span>
  <span class="o">}</span>
  <span class="nd">@Test</span>
  <span class="kd">public</span> <span class="kt">void</span> <span class="nf">simplyWorksAgain</span><span class="o">()</span> <span class="kd">throws</span> <span class="n">IOException</span> <span class="o">{</span>
    <span class="n">assertThat</span><span class="o">(</span>
      <span class="n">foo</span><span class="o">.</span><span class="na">doSomethingElse</span><span class="o">(),</span>
      <span class="n">containsString</span><span class="o">(</span><span class="n">FooTest</span><span class="o">.</span><span class="na">MSG</span><span class="o">)</span>
    <span class="o">);</span>
  <span class="o">}</span>
<span class="o">}</span></code></pre></figure><p>This is basically what is happening in <a href="https://github.com/yegor256/takes/blob/0.32.7/src/test/java/org/takes/misc/VerboseListTest.java"><code>VerboseListTest</code></a> and it&#39;s very wrong. Why? Because this shared literal <code>MSG</code> introduced an unnatural coupling between these two test methods. They have nothing in common, because they test different behaviors of class <code>Foo</code>. But this private constant ties them together. Now they are somehow related.</p><p>If and when I want to modify one of the test methods, I may need to modify the other one too. Say I want to see how <code>doSomethingElse()</code> behaves if the encapsulated message is an empty string. What do I do? I change the value of the constant <code>FooTest.MSG</code>, which is used by another test method. This is called coupling. And it&#39;s a bad thing.</p><p>What do we do? Well, we can use that <code>&quot;something&quot;</code> string literal in both test methods:</p><figure class="highlight"><pre><code class="language-java" data-lang="java"><span></span><span class="kd">class</span> <span class="nc">FooTest</span> <span class="o">{</span>
  <span class="nd">@Test</span>
  <span class="kd">public</span> <span class="kt">void</span> <span class="nf">simplyWorks</span><span class="o">()</span> <span class="kd">throws</span> <span class="n">IOException</span> <span class="o">{</span>
    <span class="n">assertThat</span><span class="o">(</span>
      <span class="k">new</span> <span class="n">Foo</span><span class="o">(</span><span class="s">&quot;something&quot;</span><span class="o">).</span><span class="na">doSomething</span><span class="o">(),</span>
      <span class="n">containsString</span><span class="o">(</span><span class="s">&quot;something&quot;</span><span class="o">)</span>
    <span class="o">);</span>
  <span class="o">}</span>
  <span class="nd">@Test</span>
  <span class="kd">public</span> <span class="kt">void</span> <span class="nf">simplyWorksAgain</span><span class="o">()</span> <span class="kd">throws</span> <span class="n">IOException</span> <span class="o">{</span>
    <span class="n">assertThat</span><span class="o">(</span>
      <span class="k">new</span> <span class="n">Foo</span><span class="o">(</span><span class="s">&quot;something&quot;</span><span class="o">).</span><span class="na">doSomethingElse</span><span class="o">(),</span>
      <span class="n">containsString</span><span class="o">(</span><span class="s">&quot;something&quot;</span><span class="o">)</span>
    <span class="o">);</span>
  <span class="o">}</span>
<span class="o">}</span></code></pre></figure><p>As you see, I got rid of that <code>setUp()</code> method and the private static literal <code>MSG</code>. What do we have now? Code duplication. String <code>&quot;something&quot;</code> shows up four times in the test class. No static analyzers will tolerate that. Moreover, there are seven (!) test methods in <a href="https://github.com/yegor256/takes/blob/0.32.7/src/test/java/org/takes/misc/VerboseListTest.java"><code>VerboseListTest</code></a>, which are using <code>MSG</code>. Thus, we will have 14 occurrences of <code>&quot;something&quot;</code>, right? Yes, that&#39;s right and that&#39;s most likely why one of authors of this test case introduced the constant---to get rid of duplication. BTW, <a href="https://github.com/Happy-Neko">@Happy-Neko</a> did that in pull request <a href="https://github.com/yegor256/takes/pull/513">#513</a>, <a href="https://github.com/carlosmiranda"><code>@carlosmiranda</code></a> reviewed the code and I approved the changes. So, three people made/approved that mistake, including myself.</p><p>So what is the right approach that will avoid code duplication and at the same time won&#39;t introduce coupling? Here it is:</p><figure class="highlight"><pre><code class="language-java" data-lang="java"><span></span><span class="kd">class</span> <span class="nc">FooTest</span> <span class="o">{</span>
  <span class="nd">@Test</span>
  <span class="kd">public</span> <span class="kt">void</span> <span class="nf">simplyWorks</span><span class="o">()</span> <span class="kd">throws</span> <span class="n">IOException</span> <span class="o">{</span>
    <span class="kd">final</span> <span class="n">String</span> <span class="n">msg</span> <span class="o">=</span> <span class="s">&quot;something&quot;</span><span class="o">;</span>
    <span class="n">assertThat</span><span class="o">(</span>
      <span class="k">new</span> <span class="n">Foo</span><span class="o">(</span><span class="n">msg</span><span class="o">).</span><span class="na">doSomething</span><span class="o">(),</span>
      <span class="n">containsString</span><span class="o">(</span><span class="n">msg</span><span class="o">)</span>
    <span class="o">);</span>
  <span class="o">}</span>
  <span class="nd">@Test</span>
  <span class="kd">public</span> <span class="kt">void</span> <span class="nf">simplyWorksAgain</span><span class="o">()</span> <span class="kd">throws</span> <span class="n">IOException</span> <span class="o">{</span>
    <span class="kd">final</span> <span class="n">String</span> <span class="n">msg</span> <span class="o">=</span> <span class="s">&quot;something else&quot;</span><span class="o">;</span>
    <span class="n">assertThat</span><span class="o">(</span>
      <span class="k">new</span> <span class="n">Foo</span><span class="o">(</span><span class="n">msg</span><span class="o">).</span><span class="na">doSomethingElse</span><span class="o">(),</span>
      <span class="n">containsString</span><span class="o">(</span><span class="n">msg</span><span class="o">)</span>
    <span class="o">);</span>
  <span class="o">}</span>
<span class="o">}</span></code></pre></figure><p>These literals must be different. This is what any static analyzer is saying when it sees <code>&quot;something&quot;</code> in so many places. It questions us---why are they the same? Is it really so important to use <code>&quot;something&quot;</code> everywhere? Why can&#39;t you use different literals? Of course we can. And we should.</p><p>The bottom line is that each test method must have its own set of data and objects. They must not be shared between test methods ever. Test methods must always be independent, having nothing in common.</p><p>Having that in mind, we can easily conclude that methods like <code>setUp()</code> or any shared variables in test classes are <strong>evil</strong>. They must not be used and simply must not exist. I think that their invention in JUnit caused a lot of harm to Java code.</p></div></article></div><div class="wrapper"> <related-posts /></div><div class="disqus" role="complementary"><p class="disqus_hint"> Please, use <a href="https://help.disqus.com/commenting/what-html-tags-are-allowed-within-comments">syntax highlighting</a> in your comments, to make them more readable.</p><div id="disqus_thread" class="disqus-thread"> <a>&nbsp;</a></div><script> var disqus_config = function () { this.page.url = document.location.href.split('?')[0].split('#')[0].replace('https://', 'http://'); this.page.identifier = this.page.url; }; (function() { var d = document, s = d.createElement('script'); s.src = '//yegor256.disqus.com/embed.js'; s.setAttribute('data-timestamp', +new Date()); (d.head || d.body).appendChild(s); })(); </script> <noscript><div><p class="red"> JavaScript is disabled in your browser, that's why you can't see comments under this post.</p></div></noscript></div><div class="wrapper"> <footer class="footer"><p> &copy; <span itemscope="" itemprop="copyrightHolder" itemtype="http://schema.org/Person"> <span itemprop="name">Yegor Bugayenko</span> </span> 2014&ndash;<span itemprop="copyrightYear">2018</span></p></footer></div></section><div class="wrapper unprintable" style="text-align:center;margin-top:2em;"> <a href="http://www.sixnines.io/h/3ba1652f"> <img src="//www.sixnines.io/b/3ba1652f?style=flat" alt="sixnines availability badge"/> </a></div><script src="//code.jquery.com/jquery-1.9.0.min.js"></script> <script src="/js/all.js?4e047f6f42b"></script> <script>var disqus_shortname = 'yegor256';</script> <script id="dsq-count-scr" src="//yegor256.disqus.com/count.js" async="async"></script> <script> (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){ (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o), m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m) })(window,document,'script','//www.google-analytics.com/analytics.js','ga'); ga('create', 'UA-1963507-32', 'auto'); ga('send', 'pageview'); </script> <script> Cd=document;Cr="&"+Math.random();Cp="&s=1"; Cd.cookie="b=b";if(Cd.cookie)Cp+="&c=1"; Cp+="&t="+(new Date()).getTimezoneOffset(); if(self!=top)Cp+="&f=1"; </script> <script> if(navigator.javaEnabled())Cp+="&j=1"; </script> <script> if(typeof(screen)!='undefined')Cp+="&w="+screen.width+"&h="+ screen.height+"&d="+(screen.colorDepth?screen.colorDepth:screen.pixelDepth); </script> <script> Cd.write("<img src='//c.hit.ua/hit?i=95870&g=0&x=2"+Cp+Cr+ "&r="+escape(Cd.referrer)+"&u="+escape(window.location.href)+ "' border='0' wi"+"dth='1' he"+"ight='1'/>"); </script> <script type="application/ld+json"> { "@context": "http://schema.org", "@type": "Person", "name": "Yegor Bugayenko", "url": "http://www.yegor256.com", "sameAs": [ "https://www.facebook.com/yegor256", "https://instagram.com/yegor256", "https://www.linkedin.com/in/yegor256", "https://twitter.com/yegor256", "https://github.com/yegor256", "https://www.pinterest.com/yegor256/" ] } </script> </body> </html> <!DOCTYPE html> <html xmlns="http://www.w3.org/1999/xhtml" lang="en-US" xml:lang="en-US" itemscope="" itemtype="http://schema.org/WebSite"> <head> <meta charset="utf-8"/> <meta name="description" content="Class InputStream in Java has three methods read(), this is what I think is very wrong. Not only in this class, but in general in OOP. " /> <meta name="keywords" content="InputStream, InputStream java, method overloading, method overloading java, why InputStream is a class" /> <meta name="viewport" content="width=device-width,minimum-scale=1,initial-scale=1"/> <meta name="google-site-verification" content="JEj_gQr2CPe2QKGw8XdMz0R7VboQIUbX3FlM-lwTq-8" /> <meta name="author" content="Yegor Bugayenko"> <meta name="article:published_time" content="2016-04-26 00:00:00 +0000"> <meta name="og:site_name" content="Yegor Bugayenko"/> <meta name="og:type" content="article" /> <meta name="og:locale" content="en_US" /> <meta name="twitter:account_id" content="4503599630178231" /> <meta name="twitter:creator" content="@yegor256"/> <meta name="twitter:site" content="@yegor256"/> <meta name="twitter:title" property="og:title" content="Why InputStream Design Is Wrong"/> <meta name="twitter:description" property="og:description" content="Class InputStream in Java has three methods read(), this is what I think is very wrong. Not only in this class, but in general in OOP. "/> <meta name="twitter:url" property="og:url" content="https://www.yegor256.com/2016/04/26/why-inputstream-design-is-wrong.html"/> <meta name="telegram:channel" content="AAAAAEJFMRzsRTRxM3ec6A"/> <link rel="search" type="application/opensearchdescription+xml" href="/opensearch.xml" title="yegor256" /> <link rel="shortcut icon" href="/favicon.ico?4e047f6f42b"/> <link rel="apple-touch-icon" href="/favicon.ico?4e047f6f42b"/> <link rel="alternate" type="application/rss+xml" title="RSS for yegor256.com" href="https://www.yegor256.com/rss.xml"/> <link rel="stylesheet" href="/css/layout.css?4e047f6f42b"/> <link rel="stylesheet" href="/css/icons.css?4e047f6f42b"/> <link rel="canonical" href="https://www.yegor256.com/2016/04/26/why-inputstream-design-is-wrong.html" /> <link rel="amphtml" href="https://www.yegor256.com/2016/04/26/why-inputstream-design-is-wrong.amp.html" /> <title>Why InputStream Design Is Wrong </title> <meta name='og:image' content='https://www.yegor256.com/images/2016/04/a-serious-man.jpg'/><meta name='twitter:image' content='https://www.yegor256.com/images/2016/04/a-serious-man.jpg'/><meta name='og:image:width' content='1200'/> <meta name='twitter:image:width' content='1200'/><meta name='og:image:height' content='656'/> <meta name='twitter:image:height' content='656'/><meta name='twitter:card' content='summary_large_image'/><meta name='twitter:image:alt' content='A Serious Man (2009) by Coen Brothers'/> </head> <body><div class="wrapper"> <aside class="header-toggle unprintable" id="header-toggle" title="Show the menu" onclick="$('#header').show();$('#header-toggle').hide();">&#9776;</aside> <header class="header" id="header"><div class="face"> <a href="/about-me.html#form" class="sub" title="Click to subscribe to my monthly newsletter"><span>Subscribe</span></a> <a href="/about-me.html" style="position:relative;"> <img src="/images/face-256x256.jpg" class="photo" alt="Yegor Bugayenko"/> </a></div><nav><ul class="menu social notranslate"> <li><a href="https://twitter.com/intent/follow?screen_name=yegor256" rel="nofollow" title="Follow me on Twitter"><i class="icon icon-twitter notranslate" aria-hidden="true"></i></a></li> <li><a href="/rss.xml" rel="nofollow" title="Subscribe to my RSS feed"><i class="icon icon-rss notranslate" aria-hidden="true"></i></a></li> <li><a itemprop="sameAs" href="https://github.com/yegor256" rel="nofollow" title="My GitHub profile"><i class="icon icon-github notranslate" aria-hidden="true"></i></a></li> <li><a itemprop="sameAs" href="http://stackoverflow.com/users/187141/yegor256" rel="nofollow" title="My StackOverflow profile"><i class="icon icon-stackoverflow notranslate" aria-hidden="true"></i></a></li> <li><a itemprop="sameAs" href="https://www.facebook.com/yegor256" rel="nofollow" title="Follow me on Facebook"><i class="icon icon-facebook notranslate" aria-hidden="true"></i></a></li> <li><a itemprop="sameAs" href="https://instagram.com/yegor256" rel="nofollow" title="Follow me on Instagram"><i class="icon icon-instagram notranslate" aria-hidden="true"></i></a></li> <li><a itemprop="sameAs" href="https://www.linkedin.com/in/yegor256" rel="nofollow" title="My LinkedIn profile"><i class="icon icon-linkedin notranslate" aria-hidden="true"></i></a></li> <li><a itemprop="sameAs" href="https://www.youtube.com/c/yegor256?sub_confirmation=1" rel="nofollow" title="My Youtube video channel"><i class="icon icon-youtube notranslate" aria-hidden="true"></i></a></li> <li><a itemprop="sameAs" href="https://www.pinterest.com/yegor256/" rel="nofollow" title="My Pinterest boards"><i class="icon icon-pinterest notranslate" aria-hidden="true"></i></a></li> <li><a itemprop="sameAs" href="https://angel.co/yegor256" rel="nofollow" title="My AngelList profile"><i class="icon icon-angellist notranslate" aria-hidden="true"></i></a></li> <li><a href="https://soundcloud.com/yegor256" rel="nofollow" title="My podcast"><i class="icon icon-podcast notranslate" aria-hidden="true"></i></a></li> <li><a href="https://itunes.apple.com/us/podcast/yegor256-podcast/id1150826721" rel="nofollow" title="My iTunes podcast"><i class="icon icon-itunes notranslate" aria-hidden="true"></i></a></li> <li><a href="https://t.me/joinchat/AAAAAEJFMRzsRTRxM3ec6A" rel="nofollow" title="My Telegram public channel"><i class="icon icon-telegram notranslate" aria-hidden="true"></i></a></li> <li><a href="mailto:blog@yegor256.com" rel="nofollow" title="Email me any time"><i class="icon icon-mail notranslate" aria-hidden="true"></i></a></li></ul><ul class="menu"> <li><a href="/" title="Home page">Home</a></li> <li ><a href="/best.html" title="Best articles to read">12&#160;Best</a></li> <li ><a href="/contents.html" title="The contents of the entire blog">All&#160;288</a></li> <li ><a href="/webinars.html" title="My webinars">Webinars</a></li> <li ><a href="/talks.html" title="Future and past conference talks">Talks</a></li> <li ><a href="/books.html" title="The books I wrote">Books</a></li> <li ><a href="/papers.html" title="My academic papers and patents">Papers</a></li> <li ><a href="/pets.html" title="My loved pet projects">Pets</a></li> <li ><a href="/award.html" title="Software quality award">Award</a></li> <li ><a href="/testimonials.html" title="What some people say about me">Testimonials</a></li> <li ><a href="/shift-m.html" title="Audio podcast about project management">Shift-M</a></li> <li ><a href="/paintings.html" title="My paintings for sale">Paintings</a></li> <li><a href="http://ru.yegor256.com/" title="Немного на русском языке">По-русски</a></li></ul></nav><div class="search"> <form method="get" action="https://www.google.com/search" itemprop="potentialAction" itemscope="" itemtype="http://schema.org/SearchAction"> <meta itemprop="target" content="https://www.google.com/search?q={q}"/> <input name="sitesearch" value="yegor256.com" type="hidden"/> <input itemprop="query-input" type="text" id="search-query" class="field field-text" required="required" onfocus="$('.google').css('visibility', 'visible');" name="q" placeholder="Search..." autocomplete="off"/> <input type="image" src="/images/google-search-icon.svg" class="google" title="Search via Google" alt="Search via Google"/> </form></div><div class="hot"><ul> <li> <a href="/code-ahead.html">Code Ahead</a> was published on Amazon just a few days ago! It is my new book, a novel about programmers. It explains in details the majority of ideas that stand behind <a href="https://www.zerocracy.com">Zerocracy</a> and <a href="https://www.xdsd.org">XDSD</a>. </li> <li> At <a href="/webinars.html">Webinar #37</a> we will discuss naming problem in OOP, for objects, methods and attributes; join us on <b>September 12</b>, at 11am PST. </li></ul></div></header></div><section itemscope="" itemtype="http://schema.org/BlogPosting"><div class="wrapper"> <header><p class="printable"> <img src="https://api.qrserver.com/v1/create-qr-code/?data=https://www.yegor256.com/2016/04/26/why-inputstream-design-is-wrong.html&amp;format=svg" style="width:125px;height:125px;" alt="QR code"/></p><p class="printable"> <code itemprop="url">https://www.yegor256.com/2016/04/26/why-inputstream-design-is-wrong.html</code></p><h1 itemprop="name headline mainEntityOfPage">Why InputStream Design Is Wrong</h1><aside class='book'><a href='http://amzn.to/2qFt4Tn'><img src='/images/books/elegant-objects/cover.png' class='book-cover' alt='book cover'/></a>Read more about this subject in <a href='http://amzn.to/2qFt4Tn'>Section&nbsp;2.9</a><br/> of my book<a href='http://amzn.to/2qFt4Tn'><img src='/images/books/amazon-buy-button.png' class='amazon-button' alt='Click to buy'/></a></aside><ul class="subline"> <li> <time itemprop="datePublished" datetime="2016-04-26T00:00:00+00:00"> 26 April 2016 </time> </li> <li class="desktop-only" itemprop="locationCreated">Washington, D.C.</li> <li class="printable" itemscope="" itemprop="author" itemtype="http://schema.org/Person"> <span itemprop="name">Yegor Bugayenko</span> </li> <li class="unprintable"> <i class="icon icon-comments"></i> <a href="http://www.yegor256.com/2016/04/26/why-inputstream-design-is-wrong.html#disqus_thread" itemprop="discussionUrl">comments</a> </li></ul><figure class='jb_picture'><img itemprop='image' alt='A Serious Man (2009) by Coen Brothers' src='/images/2016/04/a-serious-man.jpg' longdesc='#490f983a'/><figcaption id='490f983a'>A Serious Man (2009) by Coen Brothers</figcaption></figure><p>This is how it looks now:</p><figure class="highlight"><pre><code class="language-java" data-lang="java"><span></span><span class="kd">abstract</span> <span class="kd">class</span> <span class="nc">InputStream</span> <span class="o">{</span>
  <span class="kt">int</span> <span class="nf">read</span><span class="o">();</span>
  <span class="kt">int</span> <span class="nf">read</span><span class="o">(</span><span class="kt">byte</span><span class="o">[]</span> <span class="n">buffer</span><span class="o">,</span> <span class="kt">int</span> <span class="n">offset</span><span class="o">,</span> <span class="kt">int</span> <span class="n">length</span><span class="o">);</span>
  <span class="kt">int</span> <span class="nf">read</span><span class="o">(</span><span class="kt">byte</span><span class="o">[]</span> <span class="n">buffer</span><span class="o">);</span>
<span class="o">}</span></code></pre></figure><p>What&#39;s wrong? It&#39;s very convenient to have the ability to read a single byte, an array of bytes or even an array of bytes with a direct positioning into a specific place in the buffer!</p><aside class='youtube'> <a href='https://www.youtube.com/watch?v=Xk9tIqwca3k'><div class='box'> <img src='https://i.ytimg.com/vi/Xk9tIqwca3k/mqdefault.jpg' alt='YouTube video #Xk9tIqwca3k'/><div class='play'><i class='icon icon-play'></i></div></div></a><div>Smart Classes and Functionality-Poor Interfaces (webinar #16); 7 July 2016.</div></aside><p>However, we are still lacking a few methods: for reading the bytes and immediately saving into a file, converting to a text with a selected encoding, sending them by email and posting on Twitter. It would be great to have the features too, right in the poor <code>InputStream</code>. I hope the Oracle Java team is working on them now.</p><p>In the mean time, let&#39;s see what exactly is wrong with what these bright engineers designed for us already. Or maybe let me show how I would design <code>InputStream</code> and we&#39;ll compare:</p><figure class="highlight"><pre><code class="language-java" data-lang="java"><span></span><span class="kd">interface</span> <span class="nc">InputStream</span> <span class="o">{</span>
  <span class="kt">int</span> <span class="nf">read</span><span class="o">(</span><span class="kt">byte</span><span class="o">[]</span> <span class="n">buffer</span><span class="o">,</span> <span class="kt">int</span> <span class="n">offset</span><span class="o">,</span> <span class="kt">int</span> <span class="n">length</span><span class="o">);</span>
<span class="o">}</span></code></pre></figure><p>This is my design. The <code>InputStream</code> is responsible for reading bytes from the stream. There is one single method for this feature. Is it convenient for everybody? Does it read and post on Twitter? Not yet. Do we need that functionality? Of course we do, but it doesn&#39;t mean that we will add it to the interface. Instead, we will create supplementary &quot;smart&quot; class:</p><figure class="highlight"><pre><code class="language-java" data-lang="java"><span></span><span class="kd">interface</span> <span class="nc">InputStream</span> <span class="o">{</span>
  <span class="kt">int</span> <span class="nf">read</span><span class="o">(</span><span class="kt">byte</span><span class="o">[]</span> <span class="n">buffer</span><span class="o">,</span> <span class="kt">int</span> <span class="n">offset</span><span class="o">,</span> <span class="kt">int</span> <span class="n">length</span><span class="o">);</span>
  <span class="kd">class</span> <span class="nc">Smart</span> <span class="o">{</span>
    <span class="kd">private</span> <span class="kd">final</span> <span class="n">InputStream</span> <span class="n">origin</span><span class="o">;</span>
    <span class="kd">public</span> <span class="nf">Smart</span><span class="o">(</span><span class="n">InputStream</span> <span class="n">stream</span><span class="o">)</span> <span class="o">{</span>
      <span class="k">this</span><span class="o">.</span><span class="na">origin</span> <span class="o">=</span> <span class="n">stream</span><span class="o">;</span>
    <span class="o">}</span>
    <span class="kd">public</span> <span class="kt">int</span> <span class="nf">read</span><span class="o">()</span> <span class="o">{</span>
      <span class="kd">final</span> <span class="kt">byte</span><span class="o">[]</span> <span class="n">buffer</span> <span class="o">=</span> <span class="k">new</span> <span class="kt">byte</span><span class="o">[</span><span class="mi">1</span><span class="o">];</span>
      <span class="kd">final</span> <span class="kt">int</span> <span class="n">read</span> <span class="o">=</span> <span class="k">this</span><span class="o">.</span><span class="na">origin</span><span class="o">.</span><span class="na">read</span><span class="o">(</span><span class="n">buffer</span><span class="o">,</span> <span class="mi">0</span><span class="o">,</span> <span class="mi">1</span><span class="o">);</span>
      <span class="kd">final</span> <span class="kt">int</span> <span class="n">result</span><span class="o">;</span>
      <span class="k">if</span> <span class="o">(</span><span class="n">read</span> <span class="o">&lt;</span> <span class="mi">1</span><span class="o">)</span> <span class="o">{</span>
        <span class="n">result</span> <span class="o">=</span> <span class="o">-</span><span class="mi">1</span><span class="o">;</span>
      <span class="o">}</span> <span class="k">else</span> <span class="o">{</span>
        <span class="n">result</span> <span class="o">=</span> <span class="n">buffer</span><span class="o">[</span><span class="mi">0</span><span class="o">];</span>
      <span class="o">}</span>
      <span class="k">return</span> <span class="n">result</span><span class="o">;</span>
    <span class="o">}</span>
  <span class="o">}</span>
<span class="o">}</span></code></pre></figure><p>Now, we want to read a single byte from the stream. Here is how:</p><figure class="highlight"><pre><code class="language-java" data-lang="java"><span></span><span class="kd">final</span> <span class="n">InputStream</span> <span class="n">input</span> <span class="o">=</span> <span class="k">new</span> <span class="n">FileInputStream</span><span class="o">(</span><span class="s">&quot;/tmp/a.txt&quot;</span><span class="o">);</span>
<span class="kd">final</span> <span class="kt">byte</span> <span class="n">b</span> <span class="o">=</span> <span class="k">new</span> <span class="n">InputStream</span><span class="o">.</span><span class="na">Smart</span><span class="o">(</span><span class="n">input</span><span class="o">).</span><span class="na">read</span><span class="o">();</span></code></pre></figure><p>The functionality of reading a single byte is outside of <code>InputStream</code>, because this is not its business. The stream doesn&#39;t need to know how to manage the data after it is read. All the stream is <strong>responsible</strong> for is reading, not parsing or manipulating afterwards.</p><p>Interfaces must be small.</p><p>Obviously, method overloading in interfaces is a code smell. An interface with more than <strong>three methods</strong> is a good candidate for refactoring. If methods overload each other---it&#39;s serious trouble.</p><p>Interfaces must be small!</p><p>You may say that the creators of <code>InputStream</code> cared about performance, that&#39;s why allowed us to implement <code>read()</code> in three different forms. Then I have to ask again, why not create a method for reading and immediately post it on Twitter? That would be fantastically fast. Isn&#39;t it what we all want? A fast software which nobody has any desire to read or maintain.</p></p>--> <nav class="buttons notranslate desktop-only"> <a href="http://www.facebook.com/sharer/sharer.php?u=https://www.yegor256.com/2016/04/26/why-inputstream-design-is-wrong.html" title="Share on Facebook" class="button" rel="nofollow"> <span class="count count-facebook">0</span> <i class="icon icon-facebook notranslate" aria-hidden="true"></i> </a> <a href="https://twitter.com/share?url=https://www.yegor256.com/2016/04/26/why-inputstream-design-is-wrong.html&amp;text=Why+InputStream+Design+Is+Wrong" title="Share on Twitter" class="button" rel="nofollow"> <span class="count count-twitter">0</span> <i class="icon icon-twitter notranslate" aria-hidden="true"></i> </a> <a href="https://plus.google.com/share?url=https://www.yegor256.com/2016/04/26/why-inputstream-design-is-wrong.html" title="Share on Google+" class="button" rel="nofollow"> <span class="count count-googleplus">0</span> <i class="icon icon-googleplus notranslate" aria-hidden="true"></i> </a> <a href="https://www.linkedin.com/cws/share?url=https://www.yegor256.com/2016/04/26/why-inputstream-design-is-wrong.html" title="Share on LinkedIn" class="button" rel="nofollow"> <span class="count count-linkedin">0</span> <i class="icon icon-linkedin notranslate" aria-hidden="true"></i> </a> <a href="http://reddit.com/submit?url=https://www.yegor256.com/2016/04/26/why-inputstream-design-is-wrong.html%3F2016-17&amp;title=Why+InputStream+Design+Is+Wrong" title="Share on Reddit" class="button" rel="nofollow"> <span class="count count-reddit">0</span> <i class="icon icon-reddit notranslate" aria-hidden="true"></i> </a> <a href="http://news.ycombinator.com/submitlink?u=https://www.yegor256.com/2016/04/26/why-inputstream-design-is-wrong.html%3F2016-17&amp;t=Why+InputStream+Design+Is+Wrong" title="Share on Hacker News" class="button" rel="nofollow"> <span class="count count-hackernews">0</span> <i class="icon icon-hackernews notranslate" aria-hidden="true"></i> </a> </nav> </header> <article class="main" itemprop="articleBody"><div ><p>It&#39;s not just about <code>InputSteam</code>, this class is a good example of a bad design. I&#39;m talking about three overloaded methods <code>read()</code>. I&#39;ve mentioned this problem in Section 2.9 of <a href="/elegant-objects.html">Elegant Objects</a>. In a few words, I strongly believe that interfaces must be &quot;functionality poor.&quot; <code>InputStream</code> should have been an interface in the first place and it should have had a single method <code>read(byte[])</code>. Then if its authors wanted to give us extra functionality, they should have created supplementary &quot;smart&quot; classes.</p><figure class='jb_picture'><img itemprop='image' alt='A Serious Man (2009) by Coen Brothers' src='/images/2016/04/a-serious-man.jpg' longdesc='#490f983a'/><figcaption id='490f983a'>A Serious Man (2009) by Coen Brothers</figcaption></figure><p>This is how it looks now:</p><figure class="highlight"><pre><code class="language-java" data-lang="java"><span></span><span class="kd">abstract</span> <span class="kd">class</span> <span class="nc">InputStream</span> <span class="o">{</span>
  <span class="kt">int</span> <span class="nf">read</span><span class="o">();</span>
  <span class="kt">int</span> <span class="nf">read</span><span class="o">(</span><span class="kt">byte</span><span class="o">[]</span> <span class="n">buffer</span><span class="o">,</span> <span class="kt">int</span> <span class="n">offset</span><span class="o">,</span> <span class="kt">int</span> <span class="n">length</span><span class="o">);</span>
  <span class="kt">int</span> <span class="nf">read</span><span class="o">(</span><span class="kt">byte</span><span class="o">[]</span> <span class="n">buffer</span><span class="o">);</span>
<span class="o">}</span></code></pre></figure><p>What&#39;s wrong? It&#39;s very convenient to have the ability to read a single byte, an array of bytes or even an array of bytes with a direct positioning into a specific place in the buffer!</p><aside class='youtube'> <a href='https://www.youtube.com/watch?v=Xk9tIqwca3k'><div class='box'> <img src='https://i.ytimg.com/vi/Xk9tIqwca3k/mqdefault.jpg' alt='YouTube video #Xk9tIqwca3k'/><div class='play'><i class='icon icon-play'></i></div></div></a><div>Smart Classes and Functionality-Poor Interfaces (webinar #16); 7 July 2016.</div></aside><p>However, we are still lacking a few methods: for reading the bytes and immediately saving into a file, converting to a text with a selected encoding, sending them by email and posting on Twitter. It would be great to have the features too, right in the poor <code>InputStream</code>. I hope the Oracle Java team is working on them now.</p><p>In the mean time, let&#39;s see what exactly is wrong with what these bright engineers designed for us already. Or maybe let me show how I would design <code>InputStream</code> and we&#39;ll compare:</p><figure class="highlight"><pre><code class="language-java" data-lang="java"><span></span><span class="kd">interface</span> <span class="nc">InputStream</span> <span class="o">{</span>
  <span class="kt">int</span> <span class="nf">read</span><span class="o">(</span><span class="kt">byte</span><span class="o">[]</span> <span class="n">buffer</span><span class="o">,</span> <span class="kt">int</span> <span class="n">offset</span><span class="o">,</span> <span class="kt">int</span> <span class="n">length</span><span class="o">);</span>
<span class="o">}</span></code></pre></figure><p>This is my design. The <code>InputStream</code> is responsible for reading bytes from the stream. There is one single method for this feature. Is it convenient for everybody? Does it read and post on Twitter? Not yet. Do we need that functionality? Of course we do, but it doesn&#39;t mean that we will add it to the interface. Instead, we will create supplementary &quot;smart&quot; class:</p><figure class="highlight"><pre><code class="language-java" data-lang="java"><span></span><span class="kd">interface</span> <span class="nc">InputStream</span> <span class="o">{</span>
  <span class="kt">int</span> <span class="nf">read</span><span class="o">(</span><span class="kt">byte</span><span class="o">[]</span> <span class="n">buffer</span><span class="o">,</span> <span class="kt">int</span> <span class="n">offset</span><span class="o">,</span> <span class="kt">int</span> <span class="n">length</span><span class="o">);</span>
  <span class="kd">class</span> <span class="nc">Smart</span> <span class="o">{</span>
    <span class="kd">private</span> <span class="kd">final</span> <span class="n">InputStream</span> <span class="n">origin</span><span class="o">;</span>
    <span class="kd">public</span> <span class="nf">Smart</span><span class="o">(</span><span class="n">InputStream</span> <span class="n">stream</span><span class="o">)</span> <span class="o">{</span>
      <span class="k">this</span><span class="o">.</span><span class="na">origin</span> <span class="o">=</span> <span class="n">stream</span><span class="o">;</span>
    <span class="o">}</span>
    <span class="kd">public</span> <span class="kt">int</span> <span class="nf">read</span><span class="o">()</span> <span class="o">{</span>
      <span class="kd">final</span> <span class="kt">byte</span><span class="o">[]</span> <span class="n">buffer</span> <span class="o">=</span> <span class="k">new</span> <span class="kt">byte</span><span class="o">[</span><span class="mi">1</span><span class="o">];</span>
      <span class="kd">final</span> <span class="kt">int</span> <span class="n">read</span> <span class="o">=</span> <span class="k">this</span><span class="o">.</span><span class="na">origin</span><span class="o">.</span><span class="na">read</span><span class="o">(</span><span class="n">buffer</span><span class="o">,</span> <span class="mi">0</span><span class="o">,</span> <span class="mi">1</span><span class="o">);</span>
      <span class="kd">final</span> <span class="kt">int</span> <span class="n">result</span><span class="o">;</span>
      <span class="k">if</span> <span class="o">(</span><span class="n">read</span> <span class="o">&lt;</span> <span class="mi">1</span><span class="o">)</span> <span class="o">{</span>
        <span class="n">result</span> <span class="o">=</span> <span class="o">-</span><span class="mi">1</span><span class="o">;</span>
      <span class="o">}</span> <span class="k">else</span> <span class="o">{</span>
        <span class="n">result</span> <span class="o">=</span> <span class="n">buffer</span><span class="o">[</span><span class="mi">0</span><span class="o">];</span>
      <span class="o">}</span>
      <span class="k">return</span> <span class="n">result</span><span class="o">;</span>
    <span class="o">}</span>
  <span class="o">}</span>
<span class="o">}</span></code></pre></figure><p>Now, we want to read a single byte from the stream. Here is how:</p><figure class="highlight"><pre><code class="language-java" data-lang="java"><span></span><span class="kd">final</span> <span class="n">InputStream</span> <span class="n">input</span> <span class="o">=</span> <span class="k">new</span> <span class="n">FileInputStream</span><span class="o">(</span><span class="s">&quot;/tmp/a.txt&quot;</span><span class="o">);</span>
<span class="kd">final</span> <span class="kt">byte</span> <span class="n">b</span> <span class="o">=</span> <span class="k">new</span> <span class="n">InputStream</span><span class="o">.</span><span class="na">Smart</span><span class="o">(</span><span class="n">input</span><span class="o">).</span><span class="na">read</span><span class="o">();</span></code></pre></figure><p>The functionality of reading a single byte is outside of <code>InputStream</code>, because this is not its business. The stream doesn&#39;t need to know how to manage the data after it is read. All the stream is <strong>responsible</strong> for is reading, not parsing or manipulating afterwards.</p><p>Interfaces must be small.</p><p>Obviously, method overloading in interfaces is a code smell. An interface with more than <strong>three methods</strong> is a good candidate for refactoring. If methods overload each other---it&#39;s serious trouble.</p><p>Interfaces must be small!</p><p>You may say that the creators of <code>InputStream</code> cared about performance, that&#39;s why allowed us to implement <code>read()</code> in three different forms. Then I have to ask again, why not create a method for reading and immediately post it on Twitter? That would be fantastically fast. Isn&#39;t it what we all want? A fast software which nobody has any desire to read or maintain.</p></div></article></div><div class="wrapper"> <related-posts /></div><div class="disqus" role="complementary"><p class="disqus_hint"> Please, use <a href="https://help.disqus.com/commenting/what-html-tags-are-allowed-within-comments">syntax highlighting</a> in your comments, to make them more readable.</p><div id="disqus_thread" class="disqus-thread"> <a>&nbsp;</a></div><script> var disqus_config = function () { this.page.url = document.location.href.split('?')[0].split('#')[0].replace('https://', 'http://'); this.page.identifier = this.page.url; }; (function() { var d = document, s = d.createElement('script'); s.src = '//yegor256.disqus.com/embed.js'; s.setAttribute('data-timestamp', +new Date()); (d.head || d.body).appendChild(s); })(); </script> <noscript><div><p class="red"> JavaScript is disabled in your browser, that's why you can't see comments under this post.</p></div></noscript></div><div class="wrapper"> <footer class="footer"><p> &copy; <span itemscope="" itemprop="copyrightHolder" itemtype="http://schema.org/Person"> <span itemprop="name">Yegor Bugayenko</span> </span> 2014&ndash;<span itemprop="copyrightYear">2018</span></p></footer></div></section><div class="wrapper unprintable" style="text-align:center;margin-top:2em;"> <a href="http://www.sixnines.io/h/3ba1652f"> <img src="//www.sixnines.io/b/3ba1652f?style=flat" alt="sixnines availability badge"/> </a></div><script src="//code.jquery.com/jquery-1.9.0.min.js"></script> <script src="/js/all.js?4e047f6f42b"></script> <script>var disqus_shortname = 'yegor256';</script> <script id="dsq-count-scr" src="//yegor256.disqus.com/count.js" async="async"></script> <script> (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){ (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o), m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m) })(window,document,'script','//www.google-analytics.com/analytics.js','ga'); ga('create', 'UA-1963507-32', 'auto'); ga('send', 'pageview'); </script> <script> Cd=document;Cr="&"+Math.random();Cp="&s=1"; Cd.cookie="b=b";if(Cd.cookie)Cp+="&c=1"; Cp+="&t="+(new Date()).getTimezoneOffset(); if(self!=top)Cp+="&f=1"; </script> <script> if(navigator.javaEnabled())Cp+="&j=1"; </script> <script> if(typeof(screen)!='undefined')Cp+="&w="+screen.width+"&h="+ screen.height+"&d="+(screen.colorDepth?screen.colorDepth:screen.pixelDepth); </script> <script> Cd.write("<img src='//c.hit.ua/hit?i=95870&g=0&x=2"+Cp+Cr+ "&r="+escape(Cd.referrer)+"&u="+escape(window.location.href)+ "' border='0' wi"+"dth='1' he"+"ight='1'/>"); </script> <script type="application/ld+json"> { "@context": "http://schema.org", "@type": "Person", "name": "Yegor Bugayenko", "url": "http://www.yegor256.com", "sameAs": [ "https://www.facebook.com/yegor256", "https://instagram.com/yegor256", "https://www.linkedin.com/in/yegor256", "https://twitter.com/yegor256", "https://github.com/yegor256", "https://www.pinterest.com/yegor256/" ] } </script> </body> </html> <!DOCTYPE html> <html xmlns="http://www.w3.org/1999/xhtml" lang="en-US" xml:lang="en-US" itemscope="" itemtype="http://schema.org/WebSite"> <head> <meta charset="utf-8"/> <meta name="description" content="Using object properties as configuration parameters for object behavior is a bad practice that leads to bigger and less cohesive objects. " /> <meta name="keywords" content="decorator pattern, decorator pattern java, object configuration, parameters object, settings object" /> <meta name="viewport" content="width=device-width,minimum-scale=1,initial-scale=1"/> <meta name="google-site-verification" content="JEj_gQr2CPe2QKGw8XdMz0R7VboQIUbX3FlM-lwTq-8" /> <meta name="author" content="Yegor Bugayenko"> <meta name="article:published_time" content="2016-04-19 00:00:00 +0000"> <meta name="og:site_name" content="Yegor Bugayenko"/> <meta name="og:type" content="article" /> <meta name="og:locale" content="en_US" /> <meta name="twitter:account_id" content="4503599630178231" /> <meta name="twitter:creator" content="@yegor256"/> <meta name="twitter:site" content="@yegor256"/> <meta name="twitter:title" property="og:title" content="Object Behavior Must Not Be Configurable"/> <meta name="twitter:description" property="og:description" content="Using object properties as configuration parameters for object behavior is a bad practice that leads to bigger and less cohesive objects. "/> <meta name="twitter:url" property="og:url" content="https://www.yegor256.com/2016/04/19/object-must-not-be-configurable.html"/> <meta name="telegram:channel" content="AAAAAEJFMRzsRTRxM3ec6A"/> <link rel="search" type="application/opensearchdescription+xml" href="/opensearch.xml" title="yegor256" /> <link rel="shortcut icon" href="/favicon.ico?4e047f6f42b"/> <link rel="apple-touch-icon" href="/favicon.ico?4e047f6f42b"/> <link rel="alternate" type="application/rss+xml" title="RSS for yegor256.com" href="https://www.yegor256.com/rss.xml"/> <link rel="stylesheet" href="/css/layout.css?4e047f6f42b"/> <link rel="stylesheet" href="/css/icons.css?4e047f6f42b"/> <link rel="canonical" href="https://www.yegor256.com/2016/04/19/object-must-not-be-configurable.html" /> <link rel="amphtml" href="https://www.yegor256.com/2016/04/19/object-must-not-be-configurable.amp.html" /> <title>Object Behavior Must Not Be Configurable </title> <meta name='og:image' content='https://www.yegor256.com/images/2016/04/the-take.jpg'/><meta name='twitter:image' content='https://www.yegor256.com/images/2016/04/the-take.jpg'/><meta name='og:image:width' content='1200'/> <meta name='twitter:image:width' content='1200'/><meta name='og:image:height' content='677'/> <meta name='twitter:image:height' content='677'/><meta name='twitter:card' content='summary_large_image'/><meta name='twitter:image:alt' content='The Take (2009) by David Drury'/> </head> <body><div class="wrapper"> <aside class="header-toggle unprintable" id="header-toggle" title="Show the menu" onclick="$('#header').show();$('#header-toggle').hide();">&#9776;</aside> <header class="header" id="header"><div class="face"> <a href="/about-me.html#form" class="sub" title="Click to subscribe to my monthly newsletter"><span>Subscribe</span></a> <a href="/about-me.html" style="position:relative;"> <img src="/images/face-256x256.jpg" class="photo" alt="Yegor Bugayenko"/> </a></div><nav><ul class="menu social notranslate"> <li><a href="https://twitter.com/intent/follow?screen_name=yegor256" rel="nofollow" title="Follow me on Twitter"><i class="icon icon-twitter notranslate" aria-hidden="true"></i></a></li> <li><a href="/rss.xml" rel="nofollow" title="Subscribe to my RSS feed"><i class="icon icon-rss notranslate" aria-hidden="true"></i></a></li> <li><a itemprop="sameAs" href="https://github.com/yegor256" rel="nofollow" title="My GitHub profile"><i class="icon icon-github notranslate" aria-hidden="true"></i></a></li> <li><a itemprop="sameAs" href="http://stackoverflow.com/users/187141/yegor256" rel="nofollow" title="My StackOverflow profile"><i class="icon icon-stackoverflow notranslate" aria-hidden="true"></i></a></li> <li><a itemprop="sameAs" href="https://www.facebook.com/yegor256" rel="nofollow" title="Follow me on Facebook"><i class="icon icon-facebook notranslate" aria-hidden="true"></i></a></li> <li><a itemprop="sameAs" href="https://instagram.com/yegor256" rel="nofollow" title="Follow me on Instagram"><i class="icon icon-instagram notranslate" aria-hidden="true"></i></a></li> <li><a itemprop="sameAs" href="https://www.linkedin.com/in/yegor256" rel="nofollow" title="My LinkedIn profile"><i class="icon icon-linkedin notranslate" aria-hidden="true"></i></a></li> <li><a itemprop="sameAs" href="https://www.youtube.com/c/yegor256?sub_confirmation=1" rel="nofollow" title="My Youtube video channel"><i class="icon icon-youtube notranslate" aria-hidden="true"></i></a></li> <li><a itemprop="sameAs" href="https://www.pinterest.com/yegor256/" rel="nofollow" title="My Pinterest boards"><i class="icon icon-pinterest notranslate" aria-hidden="true"></i></a></li> <li><a itemprop="sameAs" href="https://angel.co/yegor256" rel="nofollow" title="My AngelList profile"><i class="icon icon-angellist notranslate" aria-hidden="true"></i></a></li> <li><a href="https://soundcloud.com/yegor256" rel="nofollow" title="My podcast"><i class="icon icon-podcast notranslate" aria-hidden="true"></i></a></li> <li><a href="https://itunes.apple.com/us/podcast/yegor256-podcast/id1150826721" rel="nofollow" title="My iTunes podcast"><i class="icon icon-itunes notranslate" aria-hidden="true"></i></a></li> <li><a href="https://t.me/joinchat/AAAAAEJFMRzsRTRxM3ec6A" rel="nofollow" title="My Telegram public channel"><i class="icon icon-telegram notranslate" aria-hidden="true"></i></a></li> <li><a href="mailto:blog@yegor256.com" rel="nofollow" title="Email me any time"><i class="icon icon-mail notranslate" aria-hidden="true"></i></a></li></ul><ul class="menu"> <li><a href="/" title="Home page">Home</a></li> <li ><a href="/best.html" title="Best articles to read">12&#160;Best</a></li> <li ><a href="/contents.html" title="The contents of the entire blog">All&#160;288</a></li> <li ><a href="/webinars.html" title="My webinars">Webinars</a></li> <li ><a href="/talks.html" title="Future and past conference talks">Talks</a></li> <li ><a href="/books.html" title="The books I wrote">Books</a></li> <li ><a href="/papers.html" title="My academic papers and patents">Papers</a></li> <li ><a href="/pets.html" title="My loved pet projects">Pets</a></li> <li ><a href="/award.html" title="Software quality award">Award</a></li> <li ><a href="/testimonials.html" title="What some people say about me">Testimonials</a></li> <li ><a href="/shift-m.html" title="Audio podcast about project management">Shift-M</a></li> <li ><a href="/paintings.html" title="My paintings for sale">Paintings</a></li> <li><a href="http://ru.yegor256.com/" title="Немного на русском языке">По-русски</a></li></ul></nav><div class="search"> <form method="get" action="https://www.google.com/search" itemprop="potentialAction" itemscope="" itemtype="http://schema.org/SearchAction"> <meta itemprop="target" content="https://www.google.com/search?q={q}"/> <input name="sitesearch" value="yegor256.com" type="hidden"/> <input itemprop="query-input" type="text" id="search-query" class="field field-text" required="required" onfocus="$('.google').css('visibility', 'visible');" name="q" placeholder="Search..." autocomplete="off"/> <input type="image" src="/images/google-search-icon.svg" class="google" title="Search via Google" alt="Search via Google"/> </form></div><div class="hot"><ul> <li> <a href="/code-ahead.html">Code Ahead</a> was published on Amazon just a few days ago! It is my new book, a novel about programmers. It explains in details the majority of ideas that stand behind <a href="https://www.zerocracy.com">Zerocracy</a> and <a href="https://www.xdsd.org">XDSD</a>. </li> <li> At <a href="/webinars.html">Webinar #37</a> we will discuss naming problem in OOP, for objects, methods and attributes; join us on <b>September 12</b>, at 11am PST. </li></ul></div></header></div><section itemscope="" itemtype="http://schema.org/BlogPosting"><div class="wrapper"> <header><p class="printable"> <img src="https://api.qrserver.com/v1/create-qr-code/?data=https://www.yegor256.com/2016/04/19/object-must-not-be-configurable.html&amp;format=svg" style="width:125px;height:125px;" alt="QR code"/></p><p class="printable"> <code itemprop="url">https://www.yegor256.com/2016/04/19/object-must-not-be-configurable.html</code></p><h1 itemprop="name headline mainEntityOfPage">Object Behavior Must Not Be Configurable</h1><aside class='book'><a href='http://amzn.to/2pyceWc'><img src='/images/books/elegant-objects/cover.png' class='book-cover' alt='book cover'/></a>Read more about this subject in <a href='http://amzn.to/2pyceWc'>Section&nbsp;5.5</a><br/> of my book<a href='http://amzn.to/2pyceWc'><img src='/images/books/amazon-buy-button.png' class='amazon-button' alt='Click to buy'/></a></aside><ul class="subline"> <li> <time itemprop="datePublished" datetime="2016-04-19T00:00:00+00:00"> 19 April 2016 </time> </li> <li class="desktop-only" itemprop="locationCreated">New York, NY</li> <li class="printable" itemscope="" itemprop="author" itemtype="http://schema.org/Person"> <span itemprop="name">Yegor Bugayenko</span> </li> <li class="unprintable"> <i class="icon icon-comments"></i> <a href="http://www.yegor256.com/2016/04/19/object-must-not-be-configurable.html#disqus_thread" itemprop="discussionUrl">comments</a> </li></ul><figure class='jb_picture'><img itemprop='image' alt='The Take (2009) by David Drury' src='/images/2016/04/the-take.jpg' longdesc='#b28b6a76'/><figcaption id='b28b6a76'>The Take (2009) by David Drury</figcaption></figure><p>Let&#39;s say there is a class that is supposed to read a web page and return its content:</p><figure class="highlight"><pre><code class="language-java" data-lang="java"><span></span><span class="kd">class</span> <span class="nc">Page</span> <span class="o">{</span>
  <span class="kd">private</span> <span class="kd">final</span> <span class="n">String</span> <span class="n">uri</span><span class="o">;</span>
  <span class="n">Page</span><span class="o">(</span><span class="kd">final</span> <span class="n">String</span> <span class="n">address</span><span class="o">)</span> <span class="o">{</span>
    <span class="k">this</span><span class="o">.</span><span class="na">uri</span> <span class="o">=</span> <span class="n">address</span><span class="o">;</span>
  <span class="o">}</span>
  <span class="kd">public</span> <span class="n">String</span> <span class="nf">html</span><span class="o">()</span> <span class="kd">throws</span> <span class="n">IOException</span> <span class="o">{</span>
    <span class="k">return</span> <span class="n">IOUtils</span><span class="o">.</span><span class="na">toString</span><span class="o">(</span>
      <span class="k">new</span> <span class="n">URL</span><span class="o">(</span><span class="k">this</span><span class="o">.</span><span class="na">uri</span><span class="o">).</span><span class="na">openStream</span><span class="o">(),</span>
      <span class="s">&quot;UTF-8&quot;</span>
    <span class="o">);</span>
  <span class="o">}</span>
<span class="o">}</span></code></pre></figure><p>Looks simple and straight-forward, right? Yes, it&#39;s a rather cohesive and solid class. Here is how we use it to read the content of Google front page:</p><figure class="highlight"><pre><code class="language-java" data-lang="java"><span></span><span class="n">String</span> <span class="n">html</span> <span class="o">=</span> <span class="k">new</span> <span class="n">Page</span><span class="o">(</span><span class="s">&quot;http://www.google.com&quot;</span><span class="o">).</span><span class="na">html</span><span class="o">();</span></code></pre></figure><p>Everything is fine until we start making this class more powerful. Let&#39;s say we want to configure the encoding. We don&#39;t always want to use <code>&quot;UTF-8&quot;</code>. We want it to be configurable. Here is what we do:</p><figure class="highlight"><pre><code class="language-java" data-lang="java"><span></span><span class="kd">class</span> <span class="nc">Page</span> <span class="o">{</span>
  <span class="kd">private</span> <span class="kd">final</span> <span class="n">String</span> <span class="n">uri</span><span class="o">;</span>
  <span class="kd">private</span> <span class="kd">final</span> <span class="n">String</span> <span class="n">encoding</span><span class="o">;</span>
  <span class="n">Page</span><span class="o">(</span><span class="kd">final</span> <span class="n">String</span> <span class="n">address</span><span class="o">,</span> <span class="kd">final</span> <span class="n">String</span> <span class="n">enc</span><span class="o">)</span> <span class="o">{</span>
    <span class="k">this</span><span class="o">.</span><span class="na">uri</span> <span class="o">=</span> <span class="n">address</span><span class="o">;</span>
    <span class="k">this</span><span class="o">.</span><span class="na">encoding</span> <span class="o">=</span> <span class="n">enc</span><span class="o">;</span>
  <span class="o">}</span>
  <span class="kd">public</span> <span class="n">String</span> <span class="nf">html</span><span class="o">()</span> <span class="kd">throws</span> <span class="n">IOException</span> <span class="o">{</span>
    <span class="k">return</span> <span class="n">IOUtils</span><span class="o">.</span><span class="na">toString</span><span class="o">(</span>
      <span class="k">new</span> <span class="n">URL</span><span class="o">(</span><span class="k">this</span><span class="o">.</span><span class="na">uri</span><span class="o">).</span><span class="na">openStream</span><span class="o">(),</span>
      <span class="k">this</span><span class="o">.</span><span class="na">encoding</span>
    <span class="o">);</span>
  <span class="o">}</span>
<span class="o">}</span></code></pre></figure><p>Done, the encoding is encapsulated and configurable. Now, let&#39;s say we want to change the behavior of the class for the situation of an empty page. If an empty page is loaded, we want to return <code>&quot;&lt;html/&gt;&quot;</code>. But not always. We want this to be configurable. Here is what we do:</p><figure class="highlight"><pre><code class="language-java" data-lang="java"><span></span><span class="kd">class</span> <span class="nc">Page</span> <span class="o">{</span>
  <span class="kd">private</span> <span class="kd">final</span> <span class="n">String</span> <span class="n">uri</span><span class="o">;</span>
  <span class="kd">private</span> <span class="kd">final</span> <span class="n">String</span> <span class="n">encoding</span><span class="o">;</span>
  <span class="kd">private</span> <span class="kd">final</span> <span class="kt">boolean</span> <span class="n">alwaysHtml</span><span class="o">;</span>
  <span class="n">Page</span><span class="o">(</span><span class="kd">final</span> <span class="n">String</span> <span class="n">address</span><span class="o">,</span> <span class="kd">final</span> <span class="n">String</span> <span class="n">enc</span><span class="o">,</span>
    <span class="kd">final</span> <span class="kt">boolean</span> <span class="n">always</span><span class="o">)</span> <span class="o">{</span>
    <span class="k">this</span><span class="o">.</span><span class="na">uri</span> <span class="o">=</span> <span class="n">address</span><span class="o">;</span>
    <span class="k">this</span><span class="o">.</span><span class="na">encoding</span> <span class="o">=</span> <span class="n">enc</span><span class="o">;</span>
    <span class="k">this</span><span class="o">.</span><span class="na">alwaysHtml</span> <span class="o">=</span> <span class="n">always</span><span class="o">;</span>
  <span class="o">}</span>
  <span class="kd">public</span> <span class="n">String</span> <span class="nf">html</span><span class="o">()</span> <span class="kd">throws</span> <span class="n">IOException</span> <span class="o">{</span>
    <span class="n">String</span> <span class="n">html</span> <span class="o">=</span> <span class="n">IOUtils</span><span class="o">.</span><span class="na">toString</span><span class="o">(</span>
      <span class="k">new</span> <span class="n">URL</span><span class="o">(</span><span class="k">this</span><span class="o">.</span><span class="na">uri</span><span class="o">).</span><span class="na">openStream</span><span class="o">(),</span>
      <span class="k">this</span><span class="o">.</span><span class="na">encoding</span>
    <span class="o">);</span>
    <span class="k">if</span> <span class="o">(</span><span class="n">html</span><span class="o">.</span><span class="na">isEmpty</span><span class="o">()</span> <span class="o">&amp;&amp;</span> <span class="k">this</span><span class="o">.</span><span class="na">alwaysHtml</span><span class="o">)</span> <span class="o">{</span>
      <span class="n">html</span> <span class="o">=</span> <span class="s">&quot;&lt;html/&gt;&quot;</span><span class="o">;</span>
    <span class="o">}</span>
    <span class="k">return</span> <span class="n">html</span><span class="o">;</span>
  <span class="o">}</span>
<span class="o">}</span></code></pre></figure><p>The class is getting bigger, huh? It&#39;s great, we&#39;re good programmers and our code must be complex, right? The more complex it is, the better programmers we are! I&#39;m being sarcastic. Definitely <a href="/2015/06/29/simple-diagrams.html">not</a>! But let&#39;s move on. Now we want our class to proceed anyway, even if the encoding is not supported on the current platform:</p><figure class="highlight"><pre><code class="language-java" data-lang="java"><span></span><span class="kd">class</span> <span class="nc">Page</span> <span class="o">{</span>
  <span class="kd">private</span> <span class="kd">final</span> <span class="n">String</span> <span class="n">uri</span><span class="o">;</span>
  <span class="kd">private</span> <span class="kd">final</span> <span class="n">String</span> <span class="n">encoding</span><span class="o">;</span>
  <span class="kd">private</span> <span class="kd">final</span> <span class="kt">boolean</span> <span class="n">alwaysHtml</span><span class="o">;</span>
  <span class="kd">private</span> <span class="kd">final</span> <span class="kt">boolean</span> <span class="n">encodeAnyway</span><span class="o">;</span>
  <span class="n">Page</span><span class="o">(</span><span class="kd">final</span> <span class="n">String</span> <span class="n">address</span><span class="o">,</span> <span class="kd">final</span> <span class="n">String</span> <span class="n">enc</span><span class="o">,</span>
    <span class="kd">final</span> <span class="kt">boolean</span> <span class="n">always</span><span class="o">,</span> <span class="kd">final</span> <span class="kt">boolean</span> <span class="n">encode</span><span class="o">)</span> <span class="o">{</span>
    <span class="k">this</span><span class="o">.</span><span class="na">uri</span> <span class="o">=</span> <span class="n">address</span><span class="o">;</span>
    <span class="k">this</span><span class="o">.</span><span class="na">encoding</span> <span class="o">=</span> <span class="n">enc</span><span class="o">;</span>
    <span class="k">this</span><span class="o">.</span><span class="na">alwaysHtml</span> <span class="o">=</span> <span class="n">always</span><span class="o">;</span>
    <span class="k">this</span><span class="o">.</span><span class="na">encodeAnyway</span> <span class="o">=</span> <span class="n">encode</span><span class="o">;</span>
  <span class="o">}</span>
  <span class="kd">public</span> <span class="n">String</span> <span class="nf">html</span><span class="o">()</span> <span class="kd">throws</span> <span class="n">IOException</span><span class="o">,</span>
  <span class="n">UnsupportedEncodingException</span> <span class="o">{</span>
    <span class="kd">final</span> <span class="kt">byte</span><span class="o">[]</span> <span class="n">bytes</span> <span class="o">=</span> <span class="n">IOUtils</span><span class="o">.</span><span class="na">toByteArray</span><span class="o">(</span>
      <span class="k">new</span> <span class="n">URL</span><span class="o">(</span><span class="k">this</span><span class="o">.</span><span class="na">uri</span><span class="o">).</span><span class="na">openStream</span><span class="o">()</span>
    <span class="o">);</span>
    <span class="n">String</span> <span class="n">html</span><span class="o">;</span>
    <span class="k">try</span> <span class="o">{</span>
      <span class="n">html</span> <span class="o">=</span> <span class="k">new</span> <span class="n">String</span><span class="o">(</span><span class="n">bytes</span><span class="o">,</span> <span class="k">this</span><span class="o">.</span><span class="na">encoding</span><span class="o">);</span>
    <span class="o">}</span> <span class="k">catch</span> <span class="o">(</span><span class="n">UnsupportedEncodingException</span> <span class="n">ex</span><span class="o">)</span> <span class="o">{</span>
      <span class="k">if</span> <span class="o">(!</span><span class="k">this</span><span class="o">.</span><span class="na">encodeAnyway</span><span class="o">)</span> <span class="o">{</span>
        <span class="k">throw</span> <span class="n">ex</span><span class="o">;</span>
      <span class="o">}</span>
      <span class="n">html</span> <span class="o">=</span> <span class="k">new</span> <span class="n">String</span><span class="o">(</span><span class="n">bytes</span><span class="o">,</span> <span class="s">&quot;UTF-8&quot;</span><span class="o">)</span>
    <span class="o">}</span>
    <span class="k">if</span> <span class="o">(</span><span class="n">html</span><span class="o">.</span><span class="na">isEmpty</span><span class="o">()</span> <span class="o">&amp;&amp;</span> <span class="k">this</span><span class="o">.</span><span class="na">alwaysHtml</span><span class="o">)</span> <span class="o">{</span>
      <span class="n">html</span> <span class="o">=</span> <span class="s">&quot;&lt;html/&gt;&quot;</span><span class="o">;</span>
    <span class="o">}</span>
    <span class="k">return</span> <span class="n">html</span><span class="o">;</span>
  <span class="o">}</span>
<span class="o">}</span></code></pre></figure><p>The class is growing and becoming more and more powerful! Now it&#39;s time to introduce a new class, which we will call <code>PageSettings</code>:</p><figure class="highlight"><pre><code class="language-java" data-lang="java"><span></span><span class="kd">class</span> <span class="nc">Page</span> <span class="o">{</span>
  <span class="kd">private</span> <span class="kd">final</span> <span class="n">String</span> <span class="n">uri</span><span class="o">;</span>
  <span class="kd">private</span> <span class="kd">final</span> <span class="n">PageSettings</span> <span class="n">settings</span><span class="o">;</span>
  <span class="n">Page</span><span class="o">(</span><span class="kd">final</span> <span class="n">String</span> <span class="n">address</span><span class="o">,</span> <span class="kd">final</span> <span class="n">PageSettings</span> <span class="n">stts</span><span class="o">)</span> <span class="o">{</span>
    <span class="k">this</span><span class="o">.</span><span class="na">uri</span> <span class="o">=</span> <span class="n">address</span><span class="o">;</span>
    <span class="k">this</span><span class="o">.</span><span class="na">settings</span> <span class="o">=</span> <span class="n">stts</span><span class="o">;</span>
  <span class="o">}</span>
  <span class="kd">public</span> <span class="n">String</span> <span class="nf">html</span><span class="o">()</span> <span class="kd">throws</span> <span class="n">IOException</span> <span class="o">{</span>
    <span class="kd">final</span> <span class="kt">byte</span><span class="o">[]</span> <span class="n">bytes</span> <span class="o">=</span> <span class="n">IOUtils</span><span class="o">.</span><span class="na">toByteArray</span><span class="o">(</span>
      <span class="k">new</span> <span class="n">URL</span><span class="o">(</span><span class="k">this</span><span class="o">.</span><span class="na">uri</span><span class="o">).</span><span class="na">openStream</span><span class="o">()</span>
    <span class="o">);</span>
    <span class="n">String</span> <span class="n">html</span><span class="o">;</span>
    <span class="k">try</span> <span class="o">{</span>
      <span class="n">html</span> <span class="o">=</span> <span class="k">new</span> <span class="n">String</span><span class="o">(</span><span class="n">bytes</span><span class="o">,</span> <span class="k">this</span><span class="o">.</span><span class="na">settings</span><span class="o">.</span><span class="na">getEncoding</span><span class="o">());</span>
    <span class="o">}</span> <span class="k">catch</span> <span class="o">(</span><span class="n">UnsupportedEncodingException</span> <span class="n">ex</span><span class="o">)</span> <span class="o">{</span>
      <span class="k">if</span> <span class="o">(!</span><span class="k">this</span><span class="o">.</span><span class="na">settings</span><span class="o">.</span><span class="na">isEncodeAnyway</span><span class="o">())</span> <span class="o">{</span>
        <span class="k">throw</span> <span class="n">ex</span><span class="o">;</span>
      <span class="o">}</span>
      <span class="n">html</span> <span class="o">=</span> <span class="k">new</span> <span class="n">String</span><span class="o">(</span><span class="n">bytes</span><span class="o">,</span> <span class="s">&quot;UTF-8&quot;</span><span class="o">)</span>
    <span class="o">}</span>
    <span class="k">if</span> <span class="o">(</span><span class="n">html</span><span class="o">.</span><span class="na">isEmpty</span><span class="o">()</span> <span class="o">&amp;&amp;</span> <span class="k">this</span><span class="o">.</span><span class="na">settings</span><span class="o">.</span><span class="na">isAlwaysHtml</span><span class="o">())</span> <span class="o">{</span>
      <span class="n">html</span> <span class="o">=</span> <span class="s">&quot;&lt;html/&gt;&quot;</span><span class="o">;</span>
    <span class="o">}</span>
    <span class="k">return</span> <span class="n">html</span><span class="o">;</span>
  <span class="o">}</span>
<span class="o">}</span></code></pre></figure><p>Class <code>PageSettings</code> is basically a holder of parameters, without any behavior. It has getters, which give us access to the parameters: <code>isEncodeAnyway()</code>, <code>isAlwaysHtml()</code>, and <code>getEncoding()</code>. If we keep going in this direction, there could be a few dozen configuration settings in that class. This may look very convenient and is a very typical pattern in Java world. For example, look at <a href="https://hadoop.apache.org/docs/r2.4.1/api/org/apache/hadoop/mapred/JobConf.html"><code>JobConf</code></a> from Hadoop. This is how we will call our highly configurable <code>Page</code> (I&#39;m assuming <code>PageSettings</code> is immutable):</p><figure class="highlight"><pre><code class="language-java" data-lang="java"><span></span><span class="n">String</span> <span class="n">html</span> <span class="o">=</span> <span class="k">new</span> <span class="n">Page</span><span class="o">(</span>
  <span class="s">&quot;http://www.google.com&quot;</span><span class="o">,</span>
  <span class="k">new</span> <span class="n">PageSettings</span><span class="o">()</span>
    <span class="o">.</span><span class="na">withEncoding</span><span class="o">(</span><span class="s">&quot;ISO_8859_1&quot;</span><span class="o">)</span>
    <span class="o">.</span><span class="na">withAlwaysHtml</span><span class="o">(</span><span class="kc">true</span><span class="o">)</span>
    <span class="o">.</span><span class="na">withEncodeAnyway</span><span class="o">(</span><span class="kc">false</span><span class="o">)</span>
<span class="o">).</span><span class="na">html</span><span class="o">();</span></code></pre></figure><p>However, no matter how convenient it may look at first glance, this approach is <strong>very wrong</strong>. Mostly because it encourages us to make big and non-cohesive objects. They grow in size and become less testable, less maintainable and less readable.</p><aside class='quote'>Encapsulated properties must not be used to change the behavior of an object</aside><p>To prevent that from happening, I would suggest a simple rule here: object behavior should not be configurable. Or, more technically, encapsulated properties must not be used to change the behavior of an object.</p><p>Object properties are there only to coordinate the location of a real-world entity, which the object is representing. The <code>uri</code> is the coordinate, while the <code>alwaysHtml</code> boolean property is a behavior changing trigger. See the difference?</p><p>So, what should we do instead? What is the right design? We must use <a href="/2015/02/26/composable-decorators.html">composable decorators</a>. Here is how:</p><figure class="highlight"><pre><code class="language-java" data-lang="java"><span></span><span class="n">Page</span> <span class="n">page</span> <span class="o">=</span> <span class="k">new</span> <span class="n">NeverEmptyPage</span><span class="o">(</span>
  <span class="k">new</span> <span class="n">DefaultPage</span><span class="o">(</span><span class="s">&quot;http://www.google.com&quot;</span><span class="o">)</span>
<span class="o">)</span>
<span class="n">String</span> <span class="n">html</span> <span class="o">=</span> <span class="k">new</span> <span class="n">AlwaysTextPage</span><span class="o">(</span>
  <span class="k">new</span> <span class="n">TextPage</span><span class="o">(</span><span class="n">page</span><span class="o">,</span> <span class="s">&quot;ISO_8859_1&quot;</span><span class="o">)</span>
  <span class="n">page</span>
<span class="o">).</span><span class="na">html</span><span class="o">();</span></code></pre></figure><p>Here is how our <code>DefaultPage</code> would look (yes, I had to change its design a bit):</p><figure class="highlight"><pre><code class="language-java" data-lang="java"><span></span><span class="kd">class</span> <span class="nc">DefaultPage</span> <span class="kd">implements</span> <span class="n">Page</span> <span class="o">{</span>
  <span class="kd">private</span> <span class="kd">final</span> <span class="n">String</span> <span class="n">uri</span><span class="o">;</span>
  <span class="n">DefaultPage</span><span class="o">(</span><span class="kd">final</span> <span class="n">String</span> <span class="n">address</span><span class="o">)</span> <span class="o">{</span>
    <span class="k">this</span><span class="o">.</span><span class="na">uri</span> <span class="o">=</span> <span class="n">address</span><span class="o">;</span>
  <span class="o">}</span>
  <span class="nd">@Override</span>
  <span class="kd">public</span> <span class="kt">byte</span><span class="o">[]</span> <span class="nf">html</span><span class="o">()</span> <span class="kd">throws</span> <span class="n">IOException</span> <span class="o">{</span>
    <span class="k">return</span> <span class="n">IOUtils</span><span class="o">.</span><span class="na">toByteArray</span><span class="o">(</span>
      <span class="k">new</span> <span class="n">URL</span><span class="o">(</span><span class="k">this</span><span class="o">.</span><span class="na">uri</span><span class="o">).</span><span class="na">openStream</span><span class="o">()</span>
    <span class="o">);</span>
  <span class="o">}</span>
<span class="o">}</span></code></pre></figure><p>As you see, I&#39;m making it implement interface <code>Page</code>. Now <code>TextPage</code> decorator, which converts an array of bytes to a text using provided encoding:</p><figure class="highlight"><pre><code class="language-java" data-lang="java"><span></span><span class="kd">class</span> <span class="nc">TextPage</span> <span class="o">{</span>
  <span class="kd">private</span> <span class="kd">final</span> <span class="n">Page</span> <span class="n">origin</span><span class="o">;</span>
  <span class="kd">private</span> <span class="kd">final</span> <span class="n">String</span> <span class="n">encoding</span><span class="o">;</span>
  <span class="n">TextPage</span><span class="o">(</span><span class="kd">final</span> <span class="n">Page</span> <span class="n">page</span><span class="o">,</span> <span class="kd">final</span> <span class="n">String</span> <span class="n">enc</span><span class="o">)</span> <span class="o">{</span>
    <span class="k">this</span><span class="o">.</span><span class="na">origin</span> <span class="o">=</span> <span class="n">page</span><span class="o">;</span>
    <span class="k">this</span><span class="o">.</span><span class="na">encoding</span> <span class="o">=</span> <span class="n">enc</span><span class="o">;</span>
  <span class="o">}</span>
  <span class="kd">public</span> <span class="n">String</span> <span class="nf">html</span><span class="o">()</span> <span class="kd">throws</span> <span class="n">IOException</span> <span class="o">{</span>
    <span class="k">return</span> <span class="k">new</span> <span class="n">String</span><span class="o">(</span>
      <span class="k">this</span><span class="o">.</span><span class="na">origin</span><span class="o">.</span><span class="na">html</span><span class="o">(),</span>
      <span class="k">this</span><span class="o">.</span><span class="na">encoding</span>
    <span class="o">);</span>
  <span class="o">}</span>
<span class="o">}</span></code></pre></figure><p>Now the <code>NeverEmptyPage</code>:</p><figure class="highlight"><pre><code class="language-java" data-lang="java"><span></span><span class="kd">class</span> <span class="nc">NeverEmptyPage</span> <span class="kd">implements</span> <span class="n">Page</span> <span class="o">{</span>
  <span class="kd">private</span> <span class="kd">final</span> <span class="n">Page</span> <span class="n">origin</span><span class="o">;</span>
  <span class="n">NeverEmptyPage</span><span class="o">(</span><span class="kd">final</span> <span class="n">Page</span> <span class="n">page</span><span class="o">)</span> <span class="o">{</span>
    <span class="k">this</span><span class="o">.</span><span class="na">origin</span> <span class="o">=</span> <span class="n">page</span><span class="o">;</span>
  <span class="o">}</span>
  <span class="nd">@Override</span>
  <span class="kd">public</span> <span class="kt">byte</span><span class="o">[]</span> <span class="nf">html</span><span class="o">()</span> <span class="kd">throws</span> <span class="n">IOException</span> <span class="o">{</span>
    <span class="kt">byte</span><span class="o">[]</span> <span class="n">bytes</span> <span class="o">=</span> <span class="k">this</span><span class="o">.</span><span class="na">origin</span><span class="o">.</span><span class="na">html</span><span class="o">();</span>
    <span class="k">if</span> <span class="o">(</span><span class="n">bytes</span><span class="o">.</span><span class="na">length</span> <span class="o">==</span> <span class="mi">0</span><span class="o">)</span> <span class="o">{</span>
      <span class="n">bytes</span> <span class="o">=</span> <span class="s">&quot;&lt;html/&gt;&quot;</span><span class="o">.</span><span class="na">getBytes</span><span class="o">();</span>
    <span class="o">}</span>
    <span class="k">return</span> <span class="n">bytes</span><span class="o">;</span>
  <span class="o">}</span>
<span class="o">}</span></code></pre></figure><p>And finally the <code>AlwaysTextPage</code>:</p><figure class="highlight"><pre><code class="language-java" data-lang="java"><span></span><span class="kd">class</span> <span class="nc">AlwaysTextPage</span> <span class="o">{</span>
  <span class="kd">private</span> <span class="kd">final</span> <span class="n">TextPage</span> <span class="n">origin</span><span class="o">;</span>
  <span class="kd">private</span> <span class="kd">final</span> <span class="n">Page</span> <span class="n">source</span><span class="o">;</span>
  <span class="n">AlwaysTextPage</span><span class="o">(</span><span class="kd">final</span> <span class="n">TextPage</span> <span class="n">page</span><span class="o">,</span> <span class="kd">final</span> <span class="n">Page</span> <span class="n">src</span><span class="o">)</span> <span class="o">{</span>
    <span class="k">this</span><span class="o">.</span><span class="na">origin</span> <span class="o">=</span> <span class="n">page</span><span class="o">;</span>
    <span class="k">this</span><span class="o">.</span><span class="na">source</span> <span class="o">=</span> <span class="n">src</span><span class="o">;</span>
  <span class="o">}</span>
  <span class="kd">public</span> <span class="n">String</span> <span class="nf">html</span><span class="o">()</span> <span class="kd">throws</span> <span class="n">IOException</span> <span class="o">{</span>
    <span class="n">String</span> <span class="n">html</span><span class="o">;</span>
    <span class="k">try</span> <span class="o">{</span>
      <span class="n">html</span> <span class="o">=</span> <span class="k">this</span><span class="o">.</span><span class="na">origin</span><span class="o">.</span><span class="na">html</span><span class="o">();</span>
    <span class="o">}</span> <span class="k">catch</span> <span class="o">(</span><span class="n">UnsupportedEncodingException</span> <span class="n">ex</span><span class="o">)</span> <span class="o">{</span>
      <span class="n">html</span> <span class="o">=</span> <span class="k">new</span> <span class="n">TextPage</span><span class="o">(</span><span class="k">this</span><span class="o">.</span><span class="na">source</span><span class="o">,</span> <span class="s">&quot;UTF-8&quot;</span><span class="o">).</span><span class="na">html</span><span class="o">();</span>
    <span class="o">}</span>
    <span class="k">return</span> <span class="n">html</span><span class="o">;</span>
  <span class="o">}</span>
<span class="o">}</span></code></pre></figure><p>You may say that <code>AlwaysTextPage</code> will make two calls to the encapsulated <code>origin</code>, in case of an unsupported encoding, which will lead to a duplicated HTTP request. That&#39;s true and this is by design. We don&#39;t want this duplicated HTTP roundtrip to happen. Let&#39;s introduce one more class, which will cache the page fetched ( <a href="/2017/01/17/synchronized-decorators.html">not thread-safe</a>, but it&#39;s not important now):</p><figure class="highlight"><pre><code class="language-java" data-lang="java"><span></span><span class="kd">class</span> <span class="nc">OncePage</span> <span class="kd">implements</span> <span class="n">Page</span> <span class="o">{</span>
  <span class="kd">private</span> <span class="kd">final</span> <span class="n">Page</span> <span class="n">origin</span><span class="o">;</span>
  <span class="kd">private</span> <span class="kd">final</span> <span class="n">AtomicReference</span><span class="o">&lt;</span><span class="kt">byte</span><span class="o">[]&gt;</span> <span class="n">cache</span> <span class="o">=</span>
    <span class="k">new</span> <span class="n">AtomicReference</span><span class="o">&lt;&gt;;</span>
  <span class="n">OncePage</span><span class="o">(</span><span class="kd">final</span> <span class="n">Page</span> <span class="n">page</span><span class="o">)</span> <span class="o">{</span>
    <span class="k">this</span><span class="o">.</span><span class="na">origin</span> <span class="o">=</span> <span class="n">page</span><span class="o">;</span>
  <span class="o">}</span>
  <span class="nd">@Override</span>
  <span class="kd">public</span> <span class="kt">byte</span><span class="o">[]</span> <span class="nf">html</span><span class="o">()</span> <span class="kd">throws</span> <span class="n">IOException</span> <span class="o">{</span>
    <span class="k">if</span> <span class="o">(</span><span class="k">this</span><span class="o">.</span><span class="na">cache</span><span class="o">.</span><span class="na">get</span><span class="o">()</span> <span class="o">==</span> <span class="kc">null</span><span class="o">)</span> <span class="o">{</span>
      <span class="k">this</span><span class="o">.</span><span class="na">cache</span><span class="o">.</span><span class="na">set</span><span class="o">(</span><span class="k">this</span><span class="o">.</span><span class="na">origin</span><span class="o">.</span><span class="na">html</span><span class="o">());</span>
    <span class="o">}</span>
    <span class="k">return</span> <span class="k">this</span><span class="o">.</span><span class="na">cache</span><span class="o">.</span><span class="na">get</span><span class="o">();</span>
  <span class="o">}</span>
<span class="o">}</span></code></pre></figure><p>Now, our code should look like this (pay attention, I&#39;m now using <code>OncePage</code>):</p><figure class="highlight"><pre><code class="language-java" data-lang="java"><span></span><span class="n">Page</span> <span class="n">page</span> <span class="o">=</span> <span class="k">new</span> <span class="n">NeverEmptyPage</span><span class="o">(</span>
  <span class="k">new</span> <span class="n">OncePage</span><span class="o">(</span>
    <span class="k">new</span> <span class="n">DefaultPage</span><span class="o">(</span><span class="s">&quot;http://www.google.com&quot;</span><span class="o">)</span>
  <span class="o">)</span>
<span class="o">)</span>
<span class="n">String</span> <span class="n">html</span> <span class="o">=</span> <span class="k">new</span> <span class="n">AlwaysTextPage</span><span class="o">(</span>
  <span class="k">new</span> <span class="n">TextPage</span><span class="o">(</span><span class="n">page</span><span class="o">,</span> <span class="s">&quot;ISO_8859_1&quot;</span><span class="o">)</span>
  <span class="s">&quot;UTF-8&quot;</span>
<span class="o">).</span><span class="na">html</span><span class="o">();</span></code></pre></figure><p>This is probably the most code-intensive post on this site so far, but I hope it&#39;s readable and I managed to convey the idea. Now we have five classes, each of which is rather small, easy to read and easy to reuse.</p><p>Just follow the rule: never make classes configurable!</p></p>--> <nav class="buttons notranslate desktop-only"> <a href="http://www.facebook.com/sharer/sharer.php?u=https://www.yegor256.com/2016/04/19/object-must-not-be-configurable.html" title="Share on Facebook" class="button" rel="nofollow"> <span class="count count-facebook">0</span> <i class="icon icon-facebook notranslate" aria-hidden="true"></i> </a> <a href="https://twitter.com/share?url=https://www.yegor256.com/2016/04/19/object-must-not-be-configurable.html&amp;text=Object+Behavior+Must+Not+Be+Configurable" title="Share on Twitter" class="button" rel="nofollow"> <span class="count count-twitter">0</span> <i class="icon icon-twitter notranslate" aria-hidden="true"></i> </a> <a href="https://plus.google.com/share?url=https://www.yegor256.com/2016/04/19/object-must-not-be-configurable.html" title="Share on Google+" class="button" rel="nofollow"> <span class="count count-googleplus">0</span> <i class="icon icon-googleplus notranslate" aria-hidden="true"></i> </a> <a href="https://www.linkedin.com/cws/share?url=https://www.yegor256.com/2016/04/19/object-must-not-be-configurable.html" title="Share on LinkedIn" class="button" rel="nofollow"> <span class="count count-linkedin">0</span> <i class="icon icon-linkedin notranslate" aria-hidden="true"></i> </a> <a href="http://reddit.com/submit?url=https://www.yegor256.com/2016/04/19/object-must-not-be-configurable.html%3F2016-16&amp;title=Object+Behavior+Must+Not+Be+Configurable" title="Share on Reddit" class="button" rel="nofollow"> <span class="count count-reddit">0</span> <i class="icon icon-reddit notranslate" aria-hidden="true"></i> </a> <a href="http://news.ycombinator.com/submitlink?u=https://www.yegor256.com/2016/04/19/object-must-not-be-configurable.html%3F2016-16&amp;t=Object+Behavior+Must+Not+Be+Configurable" title="Share on Hacker News" class="button" rel="nofollow"> <span class="count count-hackernews">0</span> <i class="icon icon-hackernews notranslate" aria-hidden="true"></i> </a> </nav> </header> <article class="main" itemprop="articleBody"><div ><p>Using object properties as configuration parameters is a very common mistake we keep making mostly because our objects are mutable---we <strong>configure</strong> them. We change their behavior by injecting parameters or even entire settings/configuration objects into them. Do I have to say that it&#39;s abusive and disrespectful from a <a href="/2014/11/20/seven-virtues-of-good-object.html">philosophical</a> point of view? I can, but let&#39;s take a look at it from a practical perspective.</p><figure class='jb_picture'><img itemprop='image' alt='The Take (2009) by David Drury' src='/images/2016/04/the-take.jpg' longdesc='#b28b6a76'/><figcaption id='b28b6a76'>The Take (2009) by David Drury</figcaption></figure><p>Let&#39;s say there is a class that is supposed to read a web page and return its content:</p><figure class="highlight"><pre><code class="language-java" data-lang="java"><span></span><span class="kd">class</span> <span class="nc">Page</span> <span class="o">{</span>
  <span class="kd">private</span> <span class="kd">final</span> <span class="n">String</span> <span class="n">uri</span><span class="o">;</span>
  <span class="n">Page</span><span class="o">(</span><span class="kd">final</span> <span class="n">String</span> <span class="n">address</span><span class="o">)</span> <span class="o">{</span>
    <span class="k">this</span><span class="o">.</span><span class="na">uri</span> <span class="o">=</span> <span class="n">address</span><span class="o">;</span>
  <span class="o">}</span>
  <span class="kd">public</span> <span class="n">String</span> <span class="nf">html</span><span class="o">()</span> <span class="kd">throws</span> <span class="n">IOException</span> <span class="o">{</span>
    <span class="k">return</span> <span class="n">IOUtils</span><span class="o">.</span><span class="na">toString</span><span class="o">(</span>
      <span class="k">new</span> <span class="n">URL</span><span class="o">(</span><span class="k">this</span><span class="o">.</span><span class="na">uri</span><span class="o">).</span><span class="na">openStream</span><span class="o">(),</span>
      <span class="s">&quot;UTF-8&quot;</span>
    <span class="o">);</span>
  <span class="o">}</span>
<span class="o">}</span></code></pre></figure><p>Looks simple and straight-forward, right? Yes, it&#39;s a rather cohesive and solid class. Here is how we use it to read the content of Google front page:</p><figure class="highlight"><pre><code class="language-java" data-lang="java"><span></span><span class="n">String</span> <span class="n">html</span> <span class="o">=</span> <span class="k">new</span> <span class="n">Page</span><span class="o">(</span><span class="s">&quot;http://www.google.com&quot;</span><span class="o">).</span><span class="na">html</span><span class="o">();</span></code></pre></figure><p>Everything is fine until we start making this class more powerful. Let&#39;s say we want to configure the encoding. We don&#39;t always want to use <code>&quot;UTF-8&quot;</code>. We want it to be configurable. Here is what we do:</p><figure class="highlight"><pre><code class="language-java" data-lang="java"><span></span><span class="kd">class</span> <span class="nc">Page</span> <span class="o">{</span>
  <span class="kd">private</span> <span class="kd">final</span> <span class="n">String</span> <span class="n">uri</span><span class="o">;</span>
  <span class="kd">private</span> <span class="kd">final</span> <span class="n">String</span> <span class="n">encoding</span><span class="o">;</span>
  <span class="n">Page</span><span class="o">(</span><span class="kd">final</span> <span class="n">String</span> <span class="n">address</span><span class="o">,</span> <span class="kd">final</span> <span class="n">String</span> <span class="n">enc</span><span class="o">)</span> <span class="o">{</span>
    <span class="k">this</span><span class="o">.</span><span class="na">uri</span> <span class="o">=</span> <span class="n">address</span><span class="o">;</span>
    <span class="k">this</span><span class="o">.</span><span class="na">encoding</span> <span class="o">=</span> <span class="n">enc</span><span class="o">;</span>
  <span class="o">}</span>
  <span class="kd">public</span> <span class="n">String</span> <span class="nf">html</span><span class="o">()</span> <span class="kd">throws</span> <span class="n">IOException</span> <span class="o">{</span>
    <span class="k">return</span> <span class="n">IOUtils</span><span class="o">.</span><span class="na">toString</span><span class="o">(</span>
      <span class="k">new</span> <span class="n">URL</span><span class="o">(</span><span class="k">this</span><span class="o">.</span><span class="na">uri</span><span class="o">).</span><span class="na">openStream</span><span class="o">(),</span>
      <span class="k">this</span><span class="o">.</span><span class="na">encoding</span>
    <span class="o">);</span>
  <span class="o">}</span>
<span class="o">}</span></code></pre></figure><p>Done, the encoding is encapsulated and configurable. Now, let&#39;s say we want to change the behavior of the class for the situation of an empty page. If an empty page is loaded, we want to return <code>&quot;&lt;html/&gt;&quot;</code>. But not always. We want this to be configurable. Here is what we do:</p><figure class="highlight"><pre><code class="language-java" data-lang="java"><span></span><span class="kd">class</span> <span class="nc">Page</span> <span class="o">{</span>
  <span class="kd">private</span> <span class="kd">final</span> <span class="n">String</span> <span class="n">uri</span><span class="o">;</span>
  <span class="kd">private</span> <span class="kd">final</span> <span class="n">String</span> <span class="n">encoding</span><span class="o">;</span>
  <span class="kd">private</span> <span class="kd">final</span> <span class="kt">boolean</span> <span class="n">alwaysHtml</span><span class="o">;</span>
  <span class="n">Page</span><span class="o">(</span><span class="kd">final</span> <span class="n">String</span> <span class="n">address</span><span class="o">,</span> <span class="kd">final</span> <span class="n">String</span> <span class="n">enc</span><span class="o">,</span>
    <span class="kd">final</span> <span class="kt">boolean</span> <span class="n">always</span><span class="o">)</span> <span class="o">{</span>
    <span class="k">this</span><span class="o">.</span><span class="na">uri</span> <span class="o">=</span> <span class="n">address</span><span class="o">;</span>
    <span class="k">this</span><span class="o">.</span><span class="na">encoding</span> <span class="o">=</span> <span class="n">enc</span><span class="o">;</span>
    <span class="k">this</span><span class="o">.</span><span class="na">alwaysHtml</span> <span class="o">=</span> <span class="n">always</span><span class="o">;</span>
  <span class="o">}</span>
  <span class="kd">public</span> <span class="n">String</span> <span class="nf">html</span><span class="o">()</span> <span class="kd">throws</span> <span class="n">IOException</span> <span class="o">{</span>
    <span class="n">String</span> <span class="n">html</span> <span class="o">=</span> <span class="n">IOUtils</span><span class="o">.</span><span class="na">toString</span><span class="o">(</span>
      <span class="k">new</span> <span class="n">URL</span><span class="o">(</span><span class="k">this</span><span class="o">.</span><span class="na">uri</span><span class="o">).</span><span class="na">openStream</span><span class="o">(),</span>
      <span class="k">this</span><span class="o">.</span><span class="na">encoding</span>
    <span class="o">);</span>
    <span class="k">if</span> <span class="o">(</span><span class="n">html</span><span class="o">.</span><span class="na">isEmpty</span><span class="o">()</span> <span class="o">&amp;&amp;</span> <span class="k">this</span><span class="o">.</span><span class="na">alwaysHtml</span><span class="o">)</span> <span class="o">{</span>
      <span class="n">html</span> <span class="o">=</span> <span class="s">&quot;&lt;html/&gt;&quot;</span><span class="o">;</span>
    <span class="o">}</span>
    <span class="k">return</span> <span class="n">html</span><span class="o">;</span>
  <span class="o">}</span>
<span class="o">}</span></code></pre></figure><p>The class is getting bigger, huh? It&#39;s great, we&#39;re good programmers and our code must be complex, right? The more complex it is, the better programmers we are! I&#39;m being sarcastic. Definitely <a href="/2015/06/29/simple-diagrams.html">not</a>! But let&#39;s move on. Now we want our class to proceed anyway, even if the encoding is not supported on the current platform:</p><figure class="highlight"><pre><code class="language-java" data-lang="java"><span></span><span class="kd">class</span> <span class="nc">Page</span> <span class="o">{</span>
  <span class="kd">private</span> <span class="kd">final</span> <span class="n">String</span> <span class="n">uri</span><span class="o">;</span>
  <span class="kd">private</span> <span class="kd">final</span> <span class="n">String</span> <span class="n">encoding</span><span class="o">;</span>
  <span class="kd">private</span> <span class="kd">final</span> <span class="kt">boolean</span> <span class="n">alwaysHtml</span><span class="o">;</span>
  <span class="kd">private</span> <span class="kd">final</span> <span class="kt">boolean</span> <span class="n">encodeAnyway</span><span class="o">;</span>
  <span class="n">Page</span><span class="o">(</span><span class="kd">final</span> <span class="n">String</span> <span class="n">address</span><span class="o">,</span> <span class="kd">final</span> <span class="n">String</span> <span class="n">enc</span><span class="o">,</span>
    <span class="kd">final</span> <span class="kt">boolean</span> <span class="n">always</span><span class="o">,</span> <span class="kd">final</span> <span class="kt">boolean</span> <span class="n">encode</span><span class="o">)</span> <span class="o">{</span>
    <span class="k">this</span><span class="o">.</span><span class="na">uri</span> <span class="o">=</span> <span class="n">address</span><span class="o">;</span>
    <span class="k">this</span><span class="o">.</span><span class="na">encoding</span> <span class="o">=</span> <span class="n">enc</span><span class="o">;</span>
    <span class="k">this</span><span class="o">.</span><span class="na">alwaysHtml</span> <span class="o">=</span> <span class="n">always</span><span class="o">;</span>
    <span class="k">this</span><span class="o">.</span><span class="na">encodeAnyway</span> <span class="o">=</span> <span class="n">encode</span><span class="o">;</span>
  <span class="o">}</span>
  <span class="kd">public</span> <span class="n">String</span> <span class="nf">html</span><span class="o">()</span> <span class="kd">throws</span> <span class="n">IOException</span><span class="o">,</span>
  <span class="n">UnsupportedEncodingException</span> <span class="o">{</span>
    <span class="kd">final</span> <span class="kt">byte</span><span class="o">[]</span> <span class="n">bytes</span> <span class="o">=</span> <span class="n">IOUtils</span><span class="o">.</span><span class="na">toByteArray</span><span class="o">(</span>
      <span class="k">new</span> <span class="n">URL</span><span class="o">(</span><span class="k">this</span><span class="o">.</span><span class="na">uri</span><span class="o">).</span><span class="na">openStream</span><span class="o">()</span>
    <span class="o">);</span>
    <span class="n">String</span> <span class="n">html</span><span class="o">;</span>
    <span class="k">try</span> <span class="o">{</span>
      <span class="n">html</span> <span class="o">=</span> <span class="k">new</span> <span class="n">String</span><span class="o">(</span><span class="n">bytes</span><span class="o">,</span> <span class="k">this</span><span class="o">.</span><span class="na">encoding</span><span class="o">);</span>
    <span class="o">}</span> <span class="k">catch</span> <span class="o">(</span><span class="n">UnsupportedEncodingException</span> <span class="n">ex</span><span class="o">)</span> <span class="o">{</span>
      <span class="k">if</span> <span class="o">(!</span><span class="k">this</span><span class="o">.</span><span class="na">encodeAnyway</span><span class="o">)</span> <span class="o">{</span>
        <span class="k">throw</span> <span class="n">ex</span><span class="o">;</span>
      <span class="o">}</span>
      <span class="n">html</span> <span class="o">=</span> <span class="k">new</span> <span class="n">String</span><span class="o">(</span><span class="n">bytes</span><span class="o">,</span> <span class="s">&quot;UTF-8&quot;</span><span class="o">)</span>
    <span class="o">}</span>
    <span class="k">if</span> <span class="o">(</span><span class="n">html</span><span class="o">.</span><span class="na">isEmpty</span><span class="o">()</span> <span class="o">&amp;&amp;</span> <span class="k">this</span><span class="o">.</span><span class="na">alwaysHtml</span><span class="o">)</span> <span class="o">{</span>
      <span class="n">html</span> <span class="o">=</span> <span class="s">&quot;&lt;html/&gt;&quot;</span><span class="o">;</span>
    <span class="o">}</span>
    <span class="k">return</span> <span class="n">html</span><span class="o">;</span>
  <span class="o">}</span>
<span class="o">}</span></code></pre></figure><p>The class is growing and becoming more and more powerful! Now it&#39;s time to introduce a new class, which we will call <code>PageSettings</code>:</p><figure class="highlight"><pre><code class="language-java" data-lang="java"><span></span><span class="kd">class</span> <span class="nc">Page</span> <span class="o">{</span>
  <span class="kd">private</span> <span class="kd">final</span> <span class="n">String</span> <span class="n">uri</span><span class="o">;</span>
  <span class="kd">private</span> <span class="kd">final</span> <span class="n">PageSettings</span> <span class="n">settings</span><span class="o">;</span>
  <span class="n">Page</span><span class="o">(</span><span class="kd">final</span> <span class="n">String</span> <span class="n">address</span><span class="o">,</span> <span class="kd">final</span> <span class="n">PageSettings</span> <span class="n">stts</span><span class="o">)</span> <span class="o">{</span>
    <span class="k">this</span><span class="o">.</span><span class="na">uri</span> <span class="o">=</span> <span class="n">address</span><span class="o">;</span>
    <span class="k">this</span><span class="o">.</span><span class="na">settings</span> <span class="o">=</span> <span class="n">stts</span><span class="o">;</span>
  <span class="o">}</span>
  <span class="kd">public</span> <span class="n">String</span> <span class="nf">html</span><span class="o">()</span> <span class="kd">throws</span> <span class="n">IOException</span> <span class="o">{</span>
    <span class="kd">final</span> <span class="kt">byte</span><span class="o">[]</span> <span class="n">bytes</span> <span class="o">=</span> <span class="n">IOUtils</span><span class="o">.</span><span class="na">toByteArray</span><span class="o">(</span>
      <span class="k">new</span> <span class="n">URL</span><span class="o">(</span><span class="k">this</span><span class="o">.</span><span class="na">uri</span><span class="o">).</span><span class="na">openStream</span><span class="o">()</span>
    <span class="o">);</span>
    <span class="n">String</span> <span class="n">html</span><span class="o">;</span>
    <span class="k">try</span> <span class="o">{</span>
      <span class="n">html</span> <span class="o">=</span> <span class="k">new</span> <span class="n">String</span><span class="o">(</span><span class="n">bytes</span><span class="o">,</span> <span class="k">this</span><span class="o">.</span><span class="na">settings</span><span class="o">.</span><span class="na">getEncoding</span><span class="o">());</span>
    <span class="o">}</span> <span class="k">catch</span> <span class="o">(</span><span class="n">UnsupportedEncodingException</span> <span class="n">ex</span><span class="o">)</span> <span class="o">{</span>
      <span class="k">if</span> <span class="o">(!</span><span class="k">this</span><span class="o">.</span><span class="na">settings</span><span class="o">.</span><span class="na">isEncodeAnyway</span><span class="o">())</span> <span class="o">{</span>
        <span class="k">throw</span> <span class="n">ex</span><span class="o">;</span>
      <span class="o">}</span>
      <span class="n">html</span> <span class="o">=</span> <span class="k">new</span> <span class="n">String</span><span class="o">(</span><span class="n">bytes</span><span class="o">,</span> <span class="s">&quot;UTF-8&quot;</span><span class="o">)</span>
    <span class="o">}</span>
    <span class="k">if</span> <span class="o">(</span><span class="n">html</span><span class="o">.</span><span class="na">isEmpty</span><span class="o">()</span> <span class="o">&amp;&amp;</span> <span class="k">this</span><span class="o">.</span><span class="na">settings</span><span class="o">.</span><span class="na">isAlwaysHtml</span><span class="o">())</span> <span class="o">{</span>
      <span class="n">html</span> <span class="o">=</span> <span class="s">&quot;&lt;html/&gt;&quot;</span><span class="o">;</span>
    <span class="o">}</span>
    <span class="k">return</span> <span class="n">html</span><span class="o">;</span>
  <span class="o">}</span>
<span class="o">}</span></code></pre></figure><p>Class <code>PageSettings</code> is basically a holder of parameters, without any behavior. It has getters, which give us access to the parameters: <code>isEncodeAnyway()</code>, <code>isAlwaysHtml()</code>, and <code>getEncoding()</code>. If we keep going in this direction, there could be a few dozen configuration settings in that class. This may look very convenient and is a very typical pattern in Java world. For example, look at <a href="https://hadoop.apache.org/docs/r2.4.1/api/org/apache/hadoop/mapred/JobConf.html"><code>JobConf</code></a> from Hadoop. This is how we will call our highly configurable <code>Page</code> (I&#39;m assuming <code>PageSettings</code> is immutable):</p><figure class="highlight"><pre><code class="language-java" data-lang="java"><span></span><span class="n">String</span> <span class="n">html</span> <span class="o">=</span> <span class="k">new</span> <span class="n">Page</span><span class="o">(</span>
  <span class="s">&quot;http://www.google.com&quot;</span><span class="o">,</span>
  <span class="k">new</span> <span class="n">PageSettings</span><span class="o">()</span>
    <span class="o">.</span><span class="na">withEncoding</span><span class="o">(</span><span class="s">&quot;ISO_8859_1&quot;</span><span class="o">)</span>
    <span class="o">.</span><span class="na">withAlwaysHtml</span><span class="o">(</span><span class="kc">true</span><span class="o">)</span>
    <span class="o">.</span><span class="na">withEncodeAnyway</span><span class="o">(</span><span class="kc">false</span><span class="o">)</span>
<span class="o">).</span><span class="na">html</span><span class="o">();</span></code></pre></figure><p>However, no matter how convenient it may look at first glance, this approach is <strong>very wrong</strong>. Mostly because it encourages us to make big and non-cohesive objects. They grow in size and become less testable, less maintainable and less readable.</p><aside class='quote'>Encapsulated properties must not be used to change the behavior of an object</aside><p>To prevent that from happening, I would suggest a simple rule here: object behavior should not be configurable. Or, more technically, encapsulated properties must not be used to change the behavior of an object.</p><p>Object properties are there only to coordinate the location of a real-world entity, which the object is representing. The <code>uri</code> is the coordinate, while the <code>alwaysHtml</code> boolean property is a behavior changing trigger. See the difference?</p><p>So, what should we do instead? What is the right design? We must use <a href="/2015/02/26/composable-decorators.html">composable decorators</a>. Here is how:</p><figure class="highlight"><pre><code class="language-java" data-lang="java"><span></span><span class="n">Page</span> <span class="n">page</span> <span class="o">=</span> <span class="k">new</span> <span class="n">NeverEmptyPage</span><span class="o">(</span>
  <span class="k">new</span> <span class="n">DefaultPage</span><span class="o">(</span><span class="s">&quot;http://www.google.com&quot;</span><span class="o">)</span>
<span class="o">)</span>
<span class="n">String</span> <span class="n">html</span> <span class="o">=</span> <span class="k">new</span> <span class="n">AlwaysTextPage</span><span class="o">(</span>
  <span class="k">new</span> <span class="n">TextPage</span><span class="o">(</span><span class="n">page</span><span class="o">,</span> <span class="s">&quot;ISO_8859_1&quot;</span><span class="o">)</span>
  <span class="n">page</span>
<span class="o">).</span><span class="na">html</span><span class="o">();</span></code></pre></figure><p>Here is how our <code>DefaultPage</code> would look (yes, I had to change its design a bit):</p><figure class="highlight"><pre><code class="language-java" data-lang="java"><span></span><span class="kd">class</span> <span class="nc">DefaultPage</span> <span class="kd">implements</span> <span class="n">Page</span> <span class="o">{</span>
  <span class="kd">private</span> <span class="kd">final</span> <span class="n">String</span> <span class="n">uri</span><span class="o">;</span>
  <span class="n">DefaultPage</span><span class="o">(</span><span class="kd">final</span> <span class="n">String</span> <span class="n">address</span><span class="o">)</span> <span class="o">{</span>
    <span class="k">this</span><span class="o">.</span><span class="na">uri</span> <span class="o">=</span> <span class="n">address</span><span class="o">;</span>
  <span class="o">}</span>
  <span class="nd">@Override</span>
  <span class="kd">public</span> <span class="kt">byte</span><span class="o">[]</span> <span class="nf">html</span><span class="o">()</span> <span class="kd">throws</span> <span class="n">IOException</span> <span class="o">{</span>
    <span class="k">return</span> <span class="n">IOUtils</span><span class="o">.</span><span class="na">toByteArray</span><span class="o">(</span>
      <span class="k">new</span> <span class="n">URL</span><span class="o">(</span><span class="k">this</span><span class="o">.</span><span class="na">uri</span><span class="o">).</span><span class="na">openStream</span><span class="o">()</span>
    <span class="o">);</span>
  <span class="o">}</span>
<span class="o">}</span></code></pre></figure><p>As you see, I&#39;m making it implement interface <code>Page</code>. Now <code>TextPage</code> decorator, which converts an array of bytes to a text using provided encoding:</p><figure class="highlight"><pre><code class="language-java" data-lang="java"><span></span><span class="kd">class</span> <span class="nc">TextPage</span> <span class="o">{</span>
  <span class="kd">private</span> <span class="kd">final</span> <span class="n">Page</span> <span class="n">origin</span><span class="o">;</span>
  <span class="kd">private</span> <span class="kd">final</span> <span class="n">String</span> <span class="n">encoding</span><span class="o">;</span>
  <span class="n">TextPage</span><span class="o">(</span><span class="kd">final</span> <span class="n">Page</span> <span class="n">page</span><span class="o">,</span> <span class="kd">final</span> <span class="n">String</span> <span class="n">enc</span><span class="o">)</span> <span class="o">{</span>
    <span class="k">this</span><span class="o">.</span><span class="na">origin</span> <span class="o">=</span> <span class="n">page</span><span class="o">;</span>
    <span class="k">this</span><span class="o">.</span><span class="na">encoding</span> <span class="o">=</span> <span class="n">enc</span><span class="o">;</span>
  <span class="o">}</span>
  <span class="kd">public</span> <span class="n">String</span> <span class="nf">html</span><span class="o">()</span> <span class="kd">throws</span> <span class="n">IOException</span> <span class="o">{</span>
    <span class="k">return</span> <span class="k">new</span> <span class="n">String</span><span class="o">(</span>
      <span class="k">this</span><span class="o">.</span><span class="na">origin</span><span class="o">.</span><span class="na">html</span><span class="o">(),</span>
      <span class="k">this</span><span class="o">.</span><span class="na">encoding</span>
    <span class="o">);</span>
  <span class="o">}</span>
<span class="o">}</span></code></pre></figure><p>Now the <code>NeverEmptyPage</code>:</p><figure class="highlight"><pre><code class="language-java" data-lang="java"><span></span><span class="kd">class</span> <span class="nc">NeverEmptyPage</span> <span class="kd">implements</span> <span class="n">Page</span> <span class="o">{</span>
  <span class="kd">private</span> <span class="kd">final</span> <span class="n">Page</span> <span class="n">origin</span><span class="o">;</span>
  <span class="n">NeverEmptyPage</span><span class="o">(</span><span class="kd">final</span> <span class="n">Page</span> <span class="n">page</span><span class="o">)</span> <span class="o">{</span>
    <span class="k">this</span><span class="o">.</span><span class="na">origin</span> <span class="o">=</span> <span class="n">page</span><span class="o">;</span>
  <span class="o">}</span>
  <span class="nd">@Override</span>
  <span class="kd">public</span> <span class="kt">byte</span><span class="o">[]</span> <span class="nf">html</span><span class="o">()</span> <span class="kd">throws</span> <span class="n">IOException</span> <span class="o">{</span>
    <span class="kt">byte</span><span class="o">[]</span> <span class="n">bytes</span> <span class="o">=</span> <span class="k">this</span><span class="o">.</span><span class="na">origin</span><span class="o">.</span><span class="na">html</span><span class="o">();</span>
    <span class="k">if</span> <span class="o">(</span><span class="n">bytes</span><span class="o">.</span><span class="na">length</span> <span class="o">==</span> <span class="mi">0</span><span class="o">)</span> <span class="o">{</span>
      <span class="n">bytes</span> <span class="o">=</span> <span class="s">&quot;&lt;html/&gt;&quot;</span><span class="o">.</span><span class="na">getBytes</span><span class="o">();</span>
    <span class="o">}</span>
    <span class="k">return</span> <span class="n">bytes</span><span class="o">;</span>
  <span class="o">}</span>
<span class="o">}</span></code></pre></figure><p>And finally the <code>AlwaysTextPage</code>:</p><figure class="highlight"><pre><code class="language-java" data-lang="java"><span></span><span class="kd">class</span> <span class="nc">AlwaysTextPage</span> <span class="o">{</span>
  <span class="kd">private</span> <span class="kd">final</span> <span class="n">TextPage</span> <span class="n">origin</span><span class="o">;</span>
  <span class="kd">private</span> <span class="kd">final</span> <span class="n">Page</span> <span class="n">source</span><span class="o">;</span>
  <span class="n">AlwaysTextPage</span><span class="o">(</span><span class="kd">final</span> <span class="n">TextPage</span> <span class="n">page</span><span class="o">,</span> <span class="kd">final</span> <span class="n">Page</span> <span class="n">src</span><span class="o">)</span> <span class="o">{</span>
    <span class="k">this</span><span class="o">.</span><span class="na">origin</span> <span class="o">=</span> <span class="n">page</span><span class="o">;</span>
    <span class="k">this</span><span class="o">.</span><span class="na">source</span> <span class="o">=</span> <span class="n">src</span><span class="o">;</span>
  <span class="o">}</span>
  <span class="kd">public</span> <span class="n">String</span> <span class="nf">html</span><span class="o">()</span> <span class="kd">throws</span> <span class="n">IOException</span> <span class="o">{</span>
    <span class="n">String</span> <span class="n">html</span><span class="o">;</span>
    <span class="k">try</span> <span class="o">{</span>
      <span class="n">html</span> <span class="o">=</span> <span class="k">this</span><span class="o">.</span><span class="na">origin</span><span class="o">.</span><span class="na">html</span><span class="o">();</span>
    <span class="o">}</span> <span class="k">catch</span> <span class="o">(</span><span class="n">UnsupportedEncodingException</span> <span class="n">ex</span><span class="o">)</span> <span class="o">{</span>
      <span class="n">html</span> <span class="o">=</span> <span class="k">new</span> <span class="n">TextPage</span><span class="o">(</span><span class="k">this</span><span class="o">.</span><span class="na">source</span><span class="o">,</span> <span class="s">&quot;UTF-8&quot;</span><span class="o">).</span><span class="na">html</span><span class="o">();</span>
    <span class="o">}</span>
    <span class="k">return</span> <span class="n">html</span><span class="o">;</span>
  <span class="o">}</span>
<span class="o">}</span></code></pre></figure><p>You may say that <code>AlwaysTextPage</code> will make two calls to the encapsulated <code>origin</code>, in case of an unsupported encoding, which will lead to a duplicated HTTP request. That&#39;s true and this is by design. We don&#39;t want this duplicated HTTP roundtrip to happen. Let&#39;s introduce one more class, which will cache the page fetched ( <a href="/2017/01/17/synchronized-decorators.html">not thread-safe</a>, but it&#39;s not important now):</p><figure class="highlight"><pre><code class="language-java" data-lang="java"><span></span><span class="kd">class</span> <span class="nc">OncePage</span> <span class="kd">implements</span> <span class="n">Page</span> <span class="o">{</span>
  <span class="kd">private</span> <span class="kd">final</span> <span class="n">Page</span> <span class="n">origin</span><span class="o">;</span>
  <span class="kd">private</span> <span class="kd">final</span> <span class="n">AtomicReference</span><span class="o">&lt;</span><span class="kt">byte</span><span class="o">[]&gt;</span> <span class="n">cache</span> <span class="o">=</span>
    <span class="k">new</span> <span class="n">AtomicReference</span><span class="o">&lt;&gt;;</span>
  <span class="n">OncePage</span><span class="o">(</span><span class="kd">final</span> <span class="n">Page</span> <span class="n">page</span><span class="o">)</span> <span class="o">{</span>
    <span class="k">this</span><span class="o">.</span><span class="na">origin</span> <span class="o">=</span> <span class="n">page</span><span class="o">;</span>
  <span class="o">}</span>
  <span class="nd">@Override</span>
  <span class="kd">public</span> <span class="kt">byte</span><span class="o">[]</span> <span class="nf">html</span><span class="o">()</span> <span class="kd">throws</span> <span class="n">IOException</span> <span class="o">{</span>
    <span class="k">if</span> <span class="o">(</span><span class="k">this</span><span class="o">.</span><span class="na">cache</span><span class="o">.</span><span class="na">get</span><span class="o">()</span> <span class="o">==</span> <span class="kc">null</span><span class="o">)</span> <span class="o">{</span>
      <span class="k">this</span><span class="o">.</span><span class="na">cache</span><span class="o">.</span><span class="na">set</span><span class="o">(</span><span class="k">this</span><span class="o">.</span><span class="na">origin</span><span class="o">.</span><span class="na">html</span><span class="o">());</span>
    <span class="o">}</span>
    <span class="k">return</span> <span class="k">this</span><span class="o">.</span><span class="na">cache</span><span class="o">.</span><span class="na">get</span><span class="o">();</span>
  <span class="o">}</span>
<span class="o">}</span></code></pre></figure><p>Now, our code should look like this (pay attention, I&#39;m now using <code>OncePage</code>):</p><figure class="highlight"><pre><code class="language-java" data-lang="java"><span></span><span class="n">Page</span> <span class="n">page</span> <span class="o">=</span> <span class="k">new</span> <span class="n">NeverEmptyPage</span><span class="o">(</span>
  <span class="k">new</span> <span class="n">OncePage</span><span class="o">(</span>
    <span class="k">new</span> <span class="n">DefaultPage</span><span class="o">(</span><span class="s">&quot;http://www.google.com&quot;</span><span class="o">)</span>
  <span class="o">)</span>
<span class="o">)</span>
<span class="n">String</span> <span class="n">html</span> <span class="o">=</span> <span class="k">new</span> <span class="n">AlwaysTextPage</span><span class="o">(</span>
  <span class="k">new</span> <span class="n">TextPage</span><span class="o">(</span><span class="n">page</span><span class="o">,</span> <span class="s">&quot;ISO_8859_1&quot;</span><span class="o">)</span>
  <span class="s">&quot;UTF-8&quot;</span>
<span class="o">).</span><span class="na">html</span><span class="o">();</span></code></pre></figure><p>This is probably the most code-intensive post on this site so far, but I hope it&#39;s readable and I managed to convey the idea. Now we have five classes, each of which is rather small, easy to read and easy to reuse.</p><p>Just follow the rule: never make classes configurable!</p></div></article></div><div class="wrapper"> <related-posts /></div><div class="disqus" role="complementary"><p class="disqus_hint"> Please, use <a href="https://help.disqus.com/commenting/what-html-tags-are-allowed-within-comments">syntax highlighting</a> in your comments, to make them more readable.</p><div id="disqus_thread" class="disqus-thread"> <a>&nbsp;</a></div><script> var disqus_config = function () { this.page.url = document.location.href.split('?')[0].split('#')[0].replace('https://', 'http://'); this.page.identifier = this.page.url; }; (function() { var d = document, s = d.createElement('script'); s.src = '//yegor256.disqus.com/embed.js'; s.setAttribute('data-timestamp', +new Date()); (d.head || d.body).appendChild(s); })(); </script> <noscript><div><p class="red"> JavaScript is disabled in your browser, that's why you can't see comments under this post.</p></div></noscript></div><div class="wrapper"> <footer class="footer"><p> &copy; <span itemscope="" itemprop="copyrightHolder" itemtype="http://schema.org/Person"> <span itemprop="name">Yegor Bugayenko</span> </span> 2014&ndash;<span itemprop="copyrightYear">2018</span></p></footer></div></section><div class="wrapper unprintable" style="text-align:center;margin-top:2em;"> <a href="http://www.sixnines.io/h/3ba1652f"> <img src="//www.sixnines.io/b/3ba1652f?style=flat" alt="sixnines availability badge"/> </a></div><script src="//code.jquery.com/jquery-1.9.0.min.js"></script> <script src="/js/all.js?4e047f6f42b"></script> <script>var disqus_shortname = 'yegor256';</script> <script id="dsq-count-scr" src="//yegor256.disqus.com/count.js" async="async"></script> <script> (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){ (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o), m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m) })(window,document,'script','//www.google-analytics.com/analytics.js','ga'); ga('create', 'UA-1963507-32', 'auto'); ga('send', 'pageview'); </script> <script> Cd=document;Cr="&"+Math.random();Cp="&s=1"; Cd.cookie="b=b";if(Cd.cookie)Cp+="&c=1"; Cp+="&t="+(new Date()).getTimezoneOffset(); if(self!=top)Cp+="&f=1"; </script> <script> if(navigator.javaEnabled())Cp+="&j=1"; </script> <script> if(typeof(screen)!='undefined')Cp+="&w="+screen.width+"&h="+ screen.height+"&d="+(screen.colorDepth?screen.colorDepth:screen.pixelDepth); </script> <script> Cd.write("<img src='//c.hit.ua/hit?i=95870&g=0&x=2"+Cp+Cr+ "&r="+escape(Cd.referrer)+"&u="+escape(window.location.href)+ "' border='0' wi"+"dth='1' he"+"ight='1'/>"); </script> <script type="application/ld+json"> { "@context": "http://schema.org", "@type": "Person", "name": "Yegor Bugayenko", "url": "http://www.yegor256.com", "sameAs": [ "https://www.facebook.com/yegor256", "https://instagram.com/yegor256", "https://www.linkedin.com/in/yegor256", "https://twitter.com/yegor256", "https://github.com/yegor256", "https://www.pinterest.com/yegor256/" ] } </script> </body> </html> <!DOCTYPE html> <html xmlns="http://www.w3.org/1999/xhtml" lang="en-US" xml:lang="en-US" itemscope="" itemtype="http://schema.org/WebSite"> <head> <meta charset="utf-8"/> <meta name="description" content="Even though Java annotations are very popular and convenient, they are making Java code less object-oriented and more messy. " /> <meta name="keywords" content="java annotations, java annotations example, java annotations list, java annotations runtime, java annotations tutorial" /> <meta name="viewport" content="width=device-width,minimum-scale=1,initial-scale=1"/> <meta name="google-site-verification" content="JEj_gQr2CPe2QKGw8XdMz0R7VboQIUbX3FlM-lwTq-8" /> <meta name="author" content="Yegor Bugayenko"> <meta name="article:published_time" content="2016-04-12 00:00:00 +0000"> <meta name="og:site_name" content="Yegor Bugayenko"/> <meta name="og:type" content="article" /> <meta name="og:locale" content="en_US" /> <meta name="twitter:account_id" content="4503599630178231" /> <meta name="twitter:creator" content="@yegor256"/> <meta name="twitter:site" content="@yegor256"/> <meta name="twitter:title" property="og:title" content="Java Annotations Are a Big Mistake"/> <meta name="twitter:description" property="og:description" content="Even though Java annotations are very popular and convenient, they are making Java code less object-oriented and more messy. "/> <meta name="twitter:url" property="og:url" content="https://www.yegor256.com/2016/04/12/java-annotations-are-evil.html"/> <meta name="telegram:channel" content="AAAAAEJFMRzsRTRxM3ec6A"/> <link rel="search" type="application/opensearchdescription+xml" href="/opensearch.xml" title="yegor256" /> <link rel="shortcut icon" href="/favicon.ico?4e047f6f42b"/> <link rel="apple-touch-icon" href="/favicon.ico?4e047f6f42b"/> <link rel="alternate" type="application/rss+xml" title="RSS for yegor256.com" href="https://www.yegor256.com/rss.xml"/> <link rel="stylesheet" href="/css/layout.css?4e047f6f42b"/> <link rel="stylesheet" href="/css/icons.css?4e047f6f42b"/> <link rel="canonical" href="https://www.yegor256.com/2016/04/12/java-annotations-are-evil.html" /> <link rel="amphtml" href="https://www.yegor256.com/2016/04/12/java-annotations-are-evil.amp.html" /> <title>Java Annotations Are a Big Mistake </title> <meta name='og:image' content='https://www.yegor256.com/images/2016/04/gomorrah.jpg'/><meta name='twitter:image' content='https://www.yegor256.com/images/2016/04/gomorrah.jpg'/><meta name='og:image:width' content='1280'/> <meta name='twitter:image:width' content='1280'/><meta name='og:image:height' content='852'/> <meta name='twitter:image:height' content='852'/><meta name='twitter:card' content='summary_large_image'/><meta name='twitter:image:alt' content='Gomorra (2008) by Matteo Garrone)'/> </head> <body><div class="wrapper"> <aside class="header-toggle unprintable" id="header-toggle" title="Show the menu" onclick="$('#header').show();$('#header-toggle').hide();">&#9776;</aside> <header class="header" id="header"><div class="face"> <a href="/about-me.html#form" class="sub" title="Click to subscribe to my monthly newsletter"><span>Subscribe</span></a> <a href="/about-me.html" style="position:relative;"> <img src="/images/face-256x256.jpg" class="photo" alt="Yegor Bugayenko"/> </a></div><nav><ul class="menu social notranslate"> <li><a href="https://twitter.com/intent/follow?screen_name=yegor256" rel="nofollow" title="Follow me on Twitter"><i class="icon icon-twitter notranslate" aria-hidden="true"></i></a></li> <li><a href="/rss.xml" rel="nofollow" title="Subscribe to my RSS feed"><i class="icon icon-rss notranslate" aria-hidden="true"></i></a></li> <li><a itemprop="sameAs" href="https://github.com/yegor256" rel="nofollow" title="My GitHub profile"><i class="icon icon-github notranslate" aria-hidden="true"></i></a></li> <li><a itemprop="sameAs" href="http://stackoverflow.com/users/187141/yegor256" rel="nofollow" title="My StackOverflow profile"><i class="icon icon-stackoverflow notranslate" aria-hidden="true"></i></a></li> <li><a itemprop="sameAs" href="https://www.facebook.com/yegor256" rel="nofollow" title="Follow me on Facebook"><i class="icon icon-facebook notranslate" aria-hidden="true"></i></a></li> <li><a itemprop="sameAs" href="https://instagram.com/yegor256" rel="nofollow" title="Follow me on Instagram"><i class="icon icon-instagram notranslate" aria-hidden="true"></i></a></li> <li><a itemprop="sameAs" href="https://www.linkedin.com/in/yegor256" rel="nofollow" title="My LinkedIn profile"><i class="icon icon-linkedin notranslate" aria-hidden="true"></i></a></li> <li><a itemprop="sameAs" href="https://www.youtube.com/c/yegor256?sub_confirmation=1" rel="nofollow" title="My Youtube video channel"><i class="icon icon-youtube notranslate" aria-hidden="true"></i></a></li> <li><a itemprop="sameAs" href="https://www.pinterest.com/yegor256/" rel="nofollow" title="My Pinterest boards"><i class="icon icon-pinterest notranslate" aria-hidden="true"></i></a></li> <li><a itemprop="sameAs" href="https://angel.co/yegor256" rel="nofollow" title="My AngelList profile"><i class="icon icon-angellist notranslate" aria-hidden="true"></i></a></li> <li><a href="https://soundcloud.com/yegor256" rel="nofollow" title="My podcast"><i class="icon icon-podcast notranslate" aria-hidden="true"></i></a></li> <li><a href="https://itunes.apple.com/us/podcast/yegor256-podcast/id1150826721" rel="nofollow" title="My iTunes podcast"><i class="icon icon-itunes notranslate" aria-hidden="true"></i></a></li> <li><a href="https://t.me/joinchat/AAAAAEJFMRzsRTRxM3ec6A" rel="nofollow" title="My Telegram public channel"><i class="icon icon-telegram notranslate" aria-hidden="true"></i></a></li> <li><a href="mailto:blog@yegor256.com" rel="nofollow" title="Email me any time"><i class="icon icon-mail notranslate" aria-hidden="true"></i></a></li></ul><ul class="menu"> <li><a href="/" title="Home page">Home</a></li> <li ><a href="/best.html" title="Best articles to read">12&#160;Best</a></li> <li ><a href="/contents.html" title="The contents of the entire blog">All&#160;288</a></li> <li ><a href="/webinars.html" title="My webinars">Webinars</a></li> <li ><a href="/talks.html" title="Future and past conference talks">Talks</a></li> <li ><a href="/books.html" title="The books I wrote">Books</a></li> <li ><a href="/papers.html" title="My academic papers and patents">Papers</a></li> <li ><a href="/pets.html" title="My loved pet projects">Pets</a></li> <li ><a href="/award.html" title="Software quality award">Award</a></li> <li ><a href="/testimonials.html" title="What some people say about me">Testimonials</a></li> <li ><a href="/shift-m.html" title="Audio podcast about project management">Shift-M</a></li> <li ><a href="/paintings.html" title="My paintings for sale">Paintings</a></li> <li><a href="http://ru.yegor256.com/" title="Немного на русском языке">По-русски</a></li></ul></nav><div class="search"> <form method="get" action="https://www.google.com/search" itemprop="potentialAction" itemscope="" itemtype="http://schema.org/SearchAction"> <meta itemprop="target" content="https://www.google.com/search?q={q}"/> <input name="sitesearch" value="yegor256.com" type="hidden"/> <input itemprop="query-input" type="text" id="search-query" class="field field-text" required="required" onfocus="$('.google').css('visibility', 'visible');" name="q" placeholder="Search..." autocomplete="off"/> <input type="image" src="/images/google-search-icon.svg" class="google" title="Search via Google" alt="Search via Google"/> </form></div><div class="hot"><ul> <li> <a href="/code-ahead.html">Code Ahead</a> was published on Amazon just a few days ago! It is my new book, a novel about programmers. It explains in details the majority of ideas that stand behind <a href="https://www.zerocracy.com">Zerocracy</a> and <a href="https://www.xdsd.org">XDSD</a>. </li> <li> At <a href="/webinars.html">Webinar #37</a> we will discuss naming problem in OOP, for objects, methods and attributes; join us on <b>September 12</b>, at 11am PST. </li></ul></div></header></div><section itemscope="" itemtype="http://schema.org/BlogPosting"><div class="wrapper"> <header><p class="printable"> <img src="https://api.qrserver.com/v1/create-qr-code/?data=https://www.yegor256.com/2016/04/12/java-annotations-are-evil.html&amp;format=svg" style="width:125px;height:125px;" alt="QR code"/></p><p class="printable"> <code itemprop="url">https://www.yegor256.com/2016/04/12/java-annotations-are-evil.html</code></p><h1 itemprop="name headline mainEntityOfPage">Java Annotations Are a Big Mistake</h1><aside class='book'><a href='http://amzn.to/2pyceWc'><img src='/images/books/elegant-objects/cover.png' class='book-cover' alt='book cover'/></a>Read more about this subject in <a href='http://amzn.to/2pyceWc'>Section&nbsp;6.1</a><br/> of my book<a href='http://amzn.to/2pyceWc'><img src='/images/books/amazon-buy-button.png' class='amazon-button' alt='Click to buy'/></a></aside><ul class="subline"> <li> <time itemprop="datePublished" datetime="2016-04-12T00:00:00+00:00"> 12 April 2016 </time> </li> <li class="desktop-only" itemprop="locationCreated">Seattle, WA</li> <li class="printable" itemscope="" itemprop="author" itemtype="http://schema.org/Person"> <span itemprop="name">Yegor Bugayenko</span> </li> <li class="unprintable"> <i class="icon icon-comments"></i> <a href="http://www.yegor256.com/2016/04/12/java-annotations-are-evil.html#disqus_thread" itemprop="discussionUrl">comments</a> </li></ul><figure class='jb_picture'><img itemprop='image' alt='Gomorra (2008) by Matteo Garrone)' src='/images/2016/04/gomorrah.jpg' longdesc='#8ef9c86b'/><figcaption id='8ef9c86b'>Gomorra (2008) by Matteo Garrone)</figcaption></figure> <aside class='youtube'> <a href='https://www.youtube.com/watch?v=g1ctRcW214w'><div class='box'> <img src='https://i.ytimg.com/vi/g1ctRcW214w/mqdefault.jpg' alt='YouTube video #g1ctRcW214w'/><div class='play'><i class='icon icon-play'></i></div></div></a><div>Java Annotations Are a Big Mistake (webinar #14); 4 May 2016.</div></aside><p>Long story short, there is one big problem with annotations---they encourage us to implement <a href="/2014/11/20/seven-virtues-of-good-object.html">object</a> functionality <strong>outside</strong> of an object, which is against the very principle of <a href="/2016/11/21/naked-data.html">encapsulation</a>. The object is not solid any more, since its behavior is not defined entirely by its own methods---some of its functionality stays elsewhere. Why is it bad? Let&#39;s see in a few examples.</p><h2 id="inject"><code>@Inject</code></h2><p>Say we annotate a property with <code>@Inject</code>:</p><figure class="highlight"><pre><code class="language-java" data-lang="java"><span></span><span class="kn">import</span> <span class="nn">javax.inject.Inject</span><span class="o">;</span>
<span class="kd">public</span> <span class="kd">class</span> <span class="nc">Books</span> <span class="o">{</span>
  <span class="nd">@Inject</span>
  <span class="kd">private</span> <span class="kd">final</span> <span class="n">DB</span> <span class="n">db</span><span class="o">;</span>
  <span class="c1">// some methods here, which use this.db</span>
<span class="o">}</span></code></pre></figure><p>Then we have an injector that knows what to inject:</p><figure class="highlight"><pre><code class="language-java" data-lang="java"><span></span><span class="n">Injector</span> <span class="n">injector</span> <span class="o">=</span> <span class="n">Guice</span><span class="o">.</span><span class="na">createInjector</span><span class="o">(</span>
  <span class="k">new</span> <span class="n">AbstractModule</span><span class="o">()</span> <span class="o">{</span>
    <span class="nd">@Override</span>
    <span class="kd">public</span> <span class="kt">void</span> <span class="nf">configure</span><span class="o">()</span> <span class="o">{</span>
      <span class="k">this</span><span class="o">.</span><span class="na">bind</span><span class="o">(</span><span class="n">DB</span><span class="o">.</span><span class="na">class</span><span class="o">).</span><span class="na">toInstance</span><span class="o">(</span>
        <span class="k">new</span> <span class="n">Postgres</span><span class="o">(</span><span class="s">&quot;jdbc:postgresql:5740/main&quot;</span><span class="o">)</span>
      <span class="o">);</span>
    <span class="o">}</span>
  <span class="o">}</span>
<span class="o">);</span></code></pre></figure><p>Now we&#39;re making an instance of class <code>Books</code> via the container:</p><figure class="highlight"><pre><code class="language-java" data-lang="java"><span></span><span class="n">Books</span> <span class="n">books</span> <span class="o">=</span> <span class="n">injector</span><span class="o">.</span><span class="na">getInstance</span><span class="o">(</span><span class="n">Books</span><span class="o">.</span><span class="na">class</span><span class="o">);</span></code></pre></figure><p>The class <code>Books</code> has no idea how and who will inject an instance of class <code>DB</code> into it. This will happen behind the scenes and outside of its control. The injection will do it. It may look convenient, but this attitude causes a lot of damage to the entire code base. The control is lost (not inverted, but lost!). The object is not in charge any more. It can&#39;t be responsible for what&#39;s happening to it.</p><p>Instead, here is how this should be done:</p><figure class="highlight"><pre><code class="language-java" data-lang="java"><span></span><span class="kd">class</span> <span class="nc">Books</span> <span class="o">{</span>
  <span class="kd">private</span> <span class="kd">final</span> <span class="n">DB</span> <span class="n">db</span><span class="o">;</span>
  <span class="n">Books</span><span class="o">(</span><span class="kd">final</span> <span class="n">DB</span> <span class="n">base</span><span class="o">)</span> <span class="o">{</span>
    <span class="k">this</span><span class="o">.</span><span class="na">db</span> <span class="o">=</span> <span class="n">base</span><span class="o">;</span>
  <span class="o">}</span>
  <span class="c1">// some methods here, which use this.db</span>
<span class="o">}</span></code></pre></figure><p>This article explains why Dependency Injection containers are a wrong idea in the first place: <a href="/2014/10/03/di-containers-are-evil.html">Dependency Injection Containers are Code Polluters</a>. Annotations basically provoke us to make the containers and use them. We move functionality outside of our objects and put it into containers, or somewhere else. That&#39;s because we don&#39;t want to duplicate the same code over and over again, right? That&#39;s correct, duplication is bad, but tearing an object apart is even worse. Way worse. The same is true about ORM (JPA/Hibernate), where annotations are being actively used. Check this post, it explains what is wrong about ORM: <a href="/2014/12/01/orm-offensive-anti-pattern.html">ORM Is an Offensive Anti-Pattern</a>. Annotations by themselves are not the key motivator, but they help us and encourage us by tearing objects apart and keeping parts in different places. They are containers, sessions, managers, controllers, etc.</p><h2 id="xmlelement"><code>@XmlElement</code></h2><aside class='youtube'> <a href='https://www.youtube.com/watch?v=oV6Utb5Jows'><div class='box'> <img src='https://i.ytimg.com/vi/oV6Utb5Jows/mqdefault.jpg' alt='YouTube video #oV6Utb5Jows'/><div class='play'><i class='icon icon-play'></i></div></div></a><div>Dependency Injection Container is a Bad Idea (webinar #9); 1 December 2015.</div></aside><p>This is how JAXB <a href="/2015/03/26/jaxb-vs-xembly.html">works</a>, when you want to convert your <a href="https://en.wikipedia.org/wiki/Plain_Old_Java_Object">POJO</a> to XML. First, you attach the <code>@XmlElement</code> annotation to the getter:</p><figure class="highlight"><pre><code class="language-java" data-lang="java"><span></span><span class="kn">import</span> <span class="nn">javax.xml.bind.annotation.XmlElement</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">javax.xml.bind.annotation.XmlRootElement</span><span class="o">;</span>
<span class="nd">@XmlRootElement</span>
<span class="kd">public</span> <span class="kd">class</span> <span class="nc">Book</span> <span class="o">{</span>
  <span class="kd">private</span> <span class="kd">final</span> <span class="n">String</span> <span class="n">title</span><span class="o">;</span>
  <span class="kd">public</span> <span class="nf">Book</span><span class="o">(</span><span class="kd">final</span> <span class="n">String</span> <span class="n">title</span><span class="o">)</span> <span class="o">{</span>
    <span class="k">this</span><span class="o">.</span><span class="na">title</span> <span class="o">=</span> <span class="n">title</span><span class="o">;</span>
  <span class="o">}</span>
  <span class="nd">@XmlElement</span>
  <span class="kd">public</span> <span class="n">String</span> <span class="nf">getTitle</span><span class="o">()</span> <span class="o">{</span>
    <span class="k">return</span> <span class="k">this</span><span class="o">.</span><span class="na">title</span><span class="o">;</span>
  <span class="o">}</span>
<span class="o">}</span></code></pre></figure><p>Then, you create a marshaller and ask it to convert an instance of class <code>Book</code> into XML:</p><figure class="highlight"><pre><code class="language-java" data-lang="java"><span></span><span class="kd">final</span> <span class="n">Book</span> <span class="n">book</span> <span class="o">=</span> <span class="k">new</span> <span class="n">Book</span><span class="o">(</span><span class="s">&quot;0132350882&quot;</span><span class="o">,</span> <span class="s">&quot;Clean Code&quot;</span><span class="o">);</span>
<span class="kd">final</span> <span class="n">JAXBContext</span> <span class="n">ctx</span> <span class="o">=</span> <span class="n">JAXBContext</span><span class="o">.</span><span class="na">newInstance</span><span class="o">(</span><span class="n">Book</span><span class="o">.</span><span class="na">class</span><span class="o">);</span>
<span class="kd">final</span> <span class="n">Marshaller</span> <span class="n">marshaller</span> <span class="o">=</span> <span class="n">ctx</span><span class="o">.</span><span class="na">createMarshaller</span><span class="o">();</span>
<span class="n">marshaller</span><span class="o">.</span><span class="na">marshal</span><span class="o">(</span><span class="n">book</span><span class="o">,</span> <span class="n">System</span><span class="o">.</span><span class="na">out</span><span class="o">);</span></code></pre></figure> <aside class='youtube'> <a href='https://www.youtube.com/watch?v=cv23Z6xpwDw'><div class='box'> <img src='https://i.ytimg.com/vi/cv23Z6xpwDw/mqdefault.jpg' alt='YouTube video #cv23Z6xpwDw'/><div class='play'><i class='icon icon-play'></i></div></div></a><div>Java Annotations Are a Bad Idea; 20 June 2017.</div></aside><p>Who is creating the XML? Not the <code>book</code>. Someone else, outside of the class <code>Book</code>. This is very wrong. Instead, this is how this should have been done. First, the class that has no idea about XML:</p><figure class="highlight"><pre><code class="language-java" data-lang="java"><span></span><span class="kd">class</span> <span class="nc">DefaultBook</span> <span class="kd">implements</span> <span class="n">Book</span> <span class="o">{</span>
  <span class="kd">private</span> <span class="kd">final</span> <span class="n">String</span> <span class="n">title</span><span class="o">;</span>
  <span class="n">DefaultBook</span><span class="o">(</span><span class="kd">final</span> <span class="n">String</span> <span class="n">title</span><span class="o">)</span> <span class="o">{</span>
    <span class="k">this</span><span class="o">.</span><span class="na">title</span> <span class="o">=</span> <span class="n">title</span><span class="o">;</span>
  <span class="o">}</span>
  <span class="nd">@Override</span>
  <span class="kd">public</span> <span class="n">String</span> <span class="nf">getTitle</span><span class="o">()</span> <span class="o">{</span>
    <span class="k">return</span> <span class="k">this</span><span class="o">.</span><span class="na">title</span><span class="o">;</span>
  <span class="o">}</span>
<span class="o">}</span></code></pre></figure><p>Then, the <a href="/2015/02/26/composable-decorators.html">decorator</a> that prints it to the XML:</p><figure class="highlight"><pre><code class="language-java" data-lang="java"><span></span><span class="kd">class</span> <span class="nc">XmlBook</span> <span class="kd">implements</span> <span class="n">Book</span><span class="o">{</span>
  <span class="kd">private</span> <span class="kd">final</span> <span class="n">Book</span> <span class="n">origin</span><span class="o">;</span>
  <span class="n">XmlBook</span><span class="o">(</span><span class="kd">final</span> <span class="n">Book</span> <span class="n">book</span><span class="o">)</span> <span class="o">{</span>
    <span class="k">this</span><span class="o">.</span><span class="na">origin</span> <span class="o">=</span> <span class="n">book</span><span class="o">;</span>
  <span class="o">}</span>
  <span class="nd">@Override</span>
  <span class="kd">public</span> <span class="n">String</span> <span class="nf">getTitle</span><span class="o">()</span> <span class="o">{</span>
    <span class="k">return</span> <span class="k">this</span><span class="o">.</span><span class="na">origin</span><span class="o">.</span><span class="na">getTitle</span><span class="o">();</span>
  <span class="o">}</span>
  <span class="kd">public</span> <span class="n">String</span> <span class="nf">toXML</span><span class="o">()</span> <span class="o">{</span>
    <span class="k">return</span> <span class="n">String</span><span class="o">.</span><span class="na">format</span><span class="o">(</span>
      <span class="s">&quot;&lt;book&gt;&lt;title&gt;%s&lt;/title&gt;&lt;/book&gt;&quot;</span><span class="o">,</span>
      <span class="k">this</span><span class="o">.</span><span class="na">getTitle</span><span class="o">()</span>
    <span class="o">);</span>
  <span class="o">}</span>
<span class="o">}</span></code></pre></figure><p>Now, in order to <a href="/2016/04/05/printers-instead-of-getters.html">print</a> the book in XML we do the following:</p><figure class="highlight"><pre><code class="language-java" data-lang="java"><span></span><span class="n">String</span> <span class="n">xml</span> <span class="o">=</span> <span class="k">new</span> <span class="n">XmlBook</span><span class="o">(</span>
  <span class="k">new</span> <span class="n">DefaultBook</span><span class="o">(</span><span class="s">&quot;Elegant Objects&quot;</span><span class="o">)</span>
<span class="o">).</span><span class="na">toXML</span><span class="o">();</span></code></pre></figure><p>The XML printing functionality is inside <code>XmlBook</code>. If you don&#39;t like the decorator idea, you can move the <code>toXML()</code> method to the <code>DefaultBook</code> class. It&#39;s not important. What is important is that the functionality always stays where it belongs---inside the object. Only the object knows how to <a href="/2016/04/05/printers-instead-of-getters.html">print itself</a> to the XML. Nobody else!</p><h2 id="retryonfailure"><code>@RetryOnFailure</code></h2><p>Here is an example (from <a href="/2014/08/15/retry-java-method-on-exception.html">my own library</a>):</p><figure class="highlight"><pre><code class="language-java" data-lang="java"><span></span><span class="kn">import</span> <span class="nn">com.jcabi.aspects.RetryOnFailure</span><span class="o">;</span>
<span class="kd">class</span> <span class="nc">Foo</span> <span class="o">{</span>
  <span class="nd">@RetryOnFailure</span>
  <span class="kd">public</span> <span class="n">String</span> <span class="nf">load</span><span class="o">(</span><span class="n">URL</span> <span class="n">url</span><span class="o">)</span> <span class="o">{</span>
    <span class="k">return</span> <span class="n">url</span><span class="o">.</span><span class="na">openConnection</span><span class="o">().</span><span class="na">getContent</span><span class="o">();</span>
  <span class="o">}</span>
<span class="o">}</span></code></pre></figure><p>After compilation, we run a so called <a href="/2014/06/01/aop-aspectj-java-method-logging.html">AOP weaver</a> that technically turns our code into something like this:</p><figure class="highlight"><pre><code class="language-java" data-lang="java"><span></span><span class="kd">class</span> <span class="nc">Foo</span> <span class="o">{</span>
  <span class="kd">public</span> <span class="n">String</span> <span class="nf">load</span><span class="o">(</span><span class="n">URL</span> <span class="n">url</span><span class="o">)</span> <span class="o">{</span>
    <span class="k">while</span> <span class="o">(</span><span class="kc">true</span><span class="o">)</span> <span class="o">{</span>
      <span class="k">try</span> <span class="o">{</span>
        <span class="k">return</span> <span class="n">_Foo</span><span class="o">.</span><span class="na">load</span><span class="o">(</span><span class="n">url</span><span class="o">);</span>
      <span class="o">}</span> <span class="k">catch</span> <span class="o">(</span><span class="n">Exception</span> <span class="n">ex</span><span class="o">)</span> <span class="o">{</span>
        <span class="c1">// ignore it</span>
      <span class="o">}</span>
    <span class="o">}</span>
  <span class="o">}</span>
  <span class="kd">class</span> <span class="nc">_Foo</span> <span class="o">{</span>
    <span class="kd">public</span> <span class="n">String</span> <span class="nf">load</span><span class="o">(</span><span class="n">URL</span> <span class="n">url</span><span class="o">)</span> <span class="o">{</span>
      <span class="k">return</span> <span class="n">url</span><span class="o">.</span><span class="na">openConnection</span><span class="o">().</span><span class="na">getContent</span><span class="o">();</span>
    <span class="o">}</span>
  <span class="o">}</span>
<span class="o">}</span></code></pre></figure><p>I simplified the actual algorithm of retrying a method call on failure, but I&#39;m sure you get the idea. <a href="http://www.eclipse.org/aspectj/">AspectJ</a>, the <a href="http://en.wikipedia.org/wiki/Aspect-oriented_programming">AOP</a> engine, uses <a href="http://aspects.jcabi.com/annotation-retryonfailure.html"><code>@RetryOnFailure</code></a> annotation as a signal, informing us that the class has to be wrapped into another one. This is happening behind the scenes. We don&#39;t see that supplementary class, which implements the retrying algorithm. But the bytecode produced by the AspectJ weaver contains a modified version of class <code>Foo</code>.</p><aside class='youtube'> <a href='https://www.youtube.com/watch?v=WSgP85kr6eU'><div class='box'> <img src='https://i.ytimg.com/vi/WSgP85kr6eU/mqdefault.jpg' alt='YouTube video #WSgP85kr6eU'/><div class='play'><i class='icon icon-play'></i></div></div></a><div>Why Getters-and-Setters Is An Anti-Pattern? (webinar #4); 1 July 2015.</div></aside><p>That is exactly what is wrong with this approach---we don&#39;t see and don&#39;t control the instantiation of that supplementary object. Object composition, which is the most important process in object design, is hidden somewhere behind the scenes. You may say that we don&#39;t need to see it since it&#39;s supplementary. I disagree. We must see how our objects are composed. We may not care about how they work, but we must see the entire composition process.</p><p>A much better design would look like this (instead of annotations):</p><figure class="highlight"><pre><code class="language-java" data-lang="java"><span></span><span class="n">Foo</span> <span class="n">foo</span> <span class="o">=</span> <span class="k">new</span> <span class="n">FooThatRetries</span><span class="o">(</span><span class="k">new</span> <span class="n">Foo</span><span class="o">());</span></code></pre></figure><p>And then, the implementation of <code>FooThatRetries</code>:</p><figure class="highlight"><pre><code class="language-java" data-lang="java"><span></span><span class="kd">class</span> <span class="nc">FooThatRetries</span> <span class="kd">implements</span> <span class="n">Foo</span> <span class="o">{</span>
  <span class="kd">private</span> <span class="kd">final</span> <span class="n">Foo</span> <span class="n">origin</span><span class="o">;</span>
  <span class="n">FooThatRetries</span><span class="o">(</span><span class="n">Foo</span> <span class="n">foo</span><span class="o">)</span> <span class="o">{</span>
    <span class="k">this</span><span class="o">.</span><span class="na">origin</span> <span class="o">=</span> <span class="n">foo</span><span class="o">;</span>
  <span class="o">}</span>
  <span class="kd">public</span> <span class="n">String</span> <span class="nf">load</span><span class="o">(</span><span class="n">URL</span> <span class="n">url</span><span class="o">)</span> <span class="o">{</span>
    <span class="k">return</span> <span class="k">new</span> <span class="n">Retry</span><span class="o">().</span><span class="na">eval</span><span class="o">(</span>
      <span class="k">new</span> <span class="n">Retry</span><span class="o">.</span><span class="na">Algorithm</span><span class="o">&lt;</span><span class="n">String</span><span class="o">&gt;()</span> <span class="o">{</span>
        <span class="nd">@Override</span>
        <span class="kd">public</span> <span class="n">String</span> <span class="nf">eval</span><span class="o">()</span> <span class="o">{</span>
          <span class="k">return</span> <span class="n">FooThatRetries</span><span class="o">.</span><span class="na">this</span><span class="o">.</span><span class="na">load</span><span class="o">(</span><span class="n">url</span><span class="o">);</span>
        <span class="o">}</span>
      <span class="o">}</span>
    <span class="o">);</span>
  <span class="o">}</span>
<span class="o">}</span></code></pre></figure><p>And now, the implementation of <code>Retry</code>:</p><figure class="highlight"><pre><code class="language-java" data-lang="java"><span></span><span class="kd">class</span> <span class="nc">Retry</span> <span class="o">{</span>
  <span class="kd">public</span> <span class="o">&lt;</span><span class="n">T</span><span class="o">&gt;</span> <span class="n">T</span> <span class="nf">eval</span><span class="o">(</span><span class="n">Retry</span><span class="o">.</span><span class="na">Algorithm</span><span class="o">&lt;</span><span class="n">T</span><span class="o">&gt;</span> <span class="n">algo</span><span class="o">)</span> <span class="o">{</span>
    <span class="k">while</span> <span class="o">(</span><span class="kc">true</span><span class="o">)</span> <span class="o">{</span>
      <span class="k">try</span> <span class="o">{</span>
        <span class="k">return</span> <span class="n">algo</span><span class="o">.</span><span class="na">eval</span><span class="o">();</span>
      <span class="o">}</span> <span class="k">catch</span> <span class="o">(</span><span class="n">Exception</span> <span class="n">ex</span><span class="o">)</span> <span class="o">{</span>
        <span class="c1">// ignore it</span>
      <span class="o">}</span>
    <span class="o">}</span>
  <span class="o">}</span>
  <span class="kd">interface</span> <span class="nc">Algorithm</span><span class="o">&lt;</span><span class="n">T</span><span class="o">&gt;</span> <span class="o">{</span>
    <span class="n">T</span> <span class="nf">eval</span><span class="o">();</span>
  <span class="o">}</span>
<span class="o">}</span></code></pre></figure><p>Is the code longer? Yes. Is it cleaner? A lot more. I regret that I didn&#39;t understand it two years ago, when I started to work with <a href="https://github.com/jcabi/jcabi-aspects">jcabi-aspects</a>.</p><hr/><p>The bottom line is that annotations are bad. Don&#39;t use them. What should be used instead? Object <a href="/2015/02/26/composable-decorators.html">composition</a>.</p><p>What could be worse than annotations? <a href="/2016/04/19/object-must-not-be-configurable.html">Configurations</a>. For example, XML configurations. Spring XML configuration mechanisms is a perfect example of terrible design. I&#39;ve said it many times before. Let me repeat it again---Spring Framework is one of the worst software products in the Java world. If you can stay away from it, you will do yourself a big favor.</p><p>There should not be any &quot;configurations&quot; in <a href="/2016/08/15/what-is-wrong-object-oriented-programming.html">OOP</a>. We can&#39;t configure our objects if they are real objects. We can only instantiate them. And the best method of instantiation is operator <code>new</code>. This operator is the key instrument for an OOP developer. Taking it away from us and giving us &quot;configuration mechanisms&quot; is an unforgivable <a href="/2015/11/24/imprisonment-for-irresponsible-coding.html">crime</a>.</p></p>--> <nav class="buttons notranslate desktop-only"> <a href="http://www.facebook.com/sharer/sharer.php?u=https://www.yegor256.com/2016/04/12/java-annotations-are-evil.html" title="Share on Facebook" class="button" rel="nofollow"> <span class="count count-facebook">0</span> <i class="icon icon-facebook notranslate" aria-hidden="true"></i> </a> <a href="https://twitter.com/share?url=https://www.yegor256.com/2016/04/12/java-annotations-are-evil.html&amp;text=Java+Annotations+Are+a+Big+Mistake" title="Share on Twitter" class="button" rel="nofollow"> <span class="count count-twitter">0</span> <i class="icon icon-twitter notranslate" aria-hidden="true"></i> </a> <a href="https://plus.google.com/share?url=https://www.yegor256.com/2016/04/12/java-annotations-are-evil.html" title="Share on Google+" class="button" rel="nofollow"> <span class="count count-googleplus">0</span> <i class="icon icon-googleplus notranslate" aria-hidden="true"></i> </a> <a href="https://www.linkedin.com/cws/share?url=https://www.yegor256.com/2016/04/12/java-annotations-are-evil.html" title="Share on LinkedIn" class="button" rel="nofollow"> <span class="count count-linkedin">0</span> <i class="icon icon-linkedin notranslate" aria-hidden="true"></i> </a> <a href="http://reddit.com/submit?url=https://www.yegor256.com/2016/04/12/java-annotations-are-evil.html%3F2016-15&amp;title=Java+Annotations+Are+a+Big+Mistake" title="Share on Reddit" class="button" rel="nofollow"> <span class="count count-reddit">0</span> <i class="icon icon-reddit notranslate" aria-hidden="true"></i> </a> <a href="http://news.ycombinator.com/submitlink?u=https://www.yegor256.com/2016/04/12/java-annotations-are-evil.html%3F2016-15&amp;t=Java+Annotations+Are+a+Big+Mistake" title="Share on Hacker News" class="button" rel="nofollow"> <span class="count count-hackernews">0</span> <i class="icon icon-hackernews notranslate" aria-hidden="true"></i> </a> </nav> </header> <article class="main" itemprop="articleBody"><div ><p><a href="https://en.wikipedia.org/wiki/Java_annotation">Annotations</a> were introduced in Java 5, and we all got excited. Such a great instrument to make code shorter! No more Hibernate/Spring XML configuration files! Just annotations, right there in the code where we need them. No more <a href="https://en.wikipedia.org/wiki/Marker_interface_pattern">marker interfaces</a>, just a <a href="https://docs.oracle.com/javase/7/docs/api/java/lang/annotation/Retention.html">runtime-retained</a> <a href="http://stackoverflow.com/questions/4296910/">reflection-discoverable</a> annotation! I was excited too. Moreover, I&#39;ve made a few open source libraries which use annotations heavily. Take <a href="https://github.com/jcabi/jcabi-aspects">jcabi-aspects</a>, for example. However, I&#39;m not excited any more. Moreover, I believe that annotations are a big mistake in Java design.</p><figure class='jb_picture'><img itemprop='image' alt='Gomorra (2008) by Matteo Garrone)' src='/images/2016/04/gomorrah.jpg' longdesc='#8ef9c86b'/><figcaption id='8ef9c86b'>Gomorra (2008) by Matteo Garrone)</figcaption></figure> <aside class='youtube'> <a href='https://www.youtube.com/watch?v=g1ctRcW214w'><div class='box'> <img src='https://i.ytimg.com/vi/g1ctRcW214w/mqdefault.jpg' alt='YouTube video #g1ctRcW214w'/><div class='play'><i class='icon icon-play'></i></div></div></a><div>Java Annotations Are a Big Mistake (webinar #14); 4 May 2016.</div></aside><p>Long story short, there is one big problem with annotations---they encourage us to implement <a href="/2014/11/20/seven-virtues-of-good-object.html">object</a> functionality <strong>outside</strong> of an object, which is against the very principle of <a href="/2016/11/21/naked-data.html">encapsulation</a>. The object is not solid any more, since its behavior is not defined entirely by its own methods---some of its functionality stays elsewhere. Why is it bad? Let&#39;s see in a few examples.</p><h2 id="inject"><code>@Inject</code></h2><p>Say we annotate a property with <code>@Inject</code>:</p><figure class="highlight"><pre><code class="language-java" data-lang="java"><span></span><span class="kn">import</span> <span class="nn">javax.inject.Inject</span><span class="o">;</span>
<span class="kd">public</span> <span class="kd">class</span> <span class="nc">Books</span> <span class="o">{</span>
  <span class="nd">@Inject</span>
  <span class="kd">private</span> <span class="kd">final</span> <span class="n">DB</span> <span class="n">db</span><span class="o">;</span>
  <span class="c1">// some methods here, which use this.db</span>
<span class="o">}</span></code></pre></figure><p>Then we have an injector that knows what to inject:</p><figure class="highlight"><pre><code class="language-java" data-lang="java"><span></span><span class="n">Injector</span> <span class="n">injector</span> <span class="o">=</span> <span class="n">Guice</span><span class="o">.</span><span class="na">createInjector</span><span class="o">(</span>
  <span class="k">new</span> <span class="n">AbstractModule</span><span class="o">()</span> <span class="o">{</span>
    <span class="nd">@Override</span>
    <span class="kd">public</span> <span class="kt">void</span> <span class="nf">configure</span><span class="o">()</span> <span class="o">{</span>
      <span class="k">this</span><span class="o">.</span><span class="na">bind</span><span class="o">(</span><span class="n">DB</span><span class="o">.</span><span class="na">class</span><span class="o">).</span><span class="na">toInstance</span><span class="o">(</span>
        <span class="k">new</span> <span class="n">Postgres</span><span class="o">(</span><span class="s">&quot;jdbc:postgresql:5740/main&quot;</span><span class="o">)</span>
      <span class="o">);</span>
    <span class="o">}</span>
  <span class="o">}</span>
<span class="o">);</span></code></pre></figure><p>Now we&#39;re making an instance of class <code>Books</code> via the container:</p><figure class="highlight"><pre><code class="language-java" data-lang="java"><span></span><span class="n">Books</span> <span class="n">books</span> <span class="o">=</span> <span class="n">injector</span><span class="o">.</span><span class="na">getInstance</span><span class="o">(</span><span class="n">Books</span><span class="o">.</span><span class="na">class</span><span class="o">);</span></code></pre></figure><p>The class <code>Books</code> has no idea how and who will inject an instance of class <code>DB</code> into it. This will happen behind the scenes and outside of its control. The injection will do it. It may look convenient, but this attitude causes a lot of damage to the entire code base. The control is lost (not inverted, but lost!). The object is not in charge any more. It can&#39;t be responsible for what&#39;s happening to it.</p><p>Instead, here is how this should be done:</p><figure class="highlight"><pre><code class="language-java" data-lang="java"><span></span><span class="kd">class</span> <span class="nc">Books</span> <span class="o">{</span>
  <span class="kd">private</span> <span class="kd">final</span> <span class="n">DB</span> <span class="n">db</span><span class="o">;</span>
  <span class="n">Books</span><span class="o">(</span><span class="kd">final</span> <span class="n">DB</span> <span class="n">base</span><span class="o">)</span> <span class="o">{</span>
    <span class="k">this</span><span class="o">.</span><span class="na">db</span> <span class="o">=</span> <span class="n">base</span><span class="o">;</span>
  <span class="o">}</span>
  <span class="c1">// some methods here, which use this.db</span>
<span class="o">}</span></code></pre></figure><p>This article explains why Dependency Injection containers are a wrong idea in the first place: <a href="/2014/10/03/di-containers-are-evil.html">Dependency Injection Containers are Code Polluters</a>. Annotations basically provoke us to make the containers and use them. We move functionality outside of our objects and put it into containers, or somewhere else. That&#39;s because we don&#39;t want to duplicate the same code over and over again, right? That&#39;s correct, duplication is bad, but tearing an object apart is even worse. Way worse. The same is true about ORM (JPA/Hibernate), where annotations are being actively used. Check this post, it explains what is wrong about ORM: <a href="/2014/12/01/orm-offensive-anti-pattern.html">ORM Is an Offensive Anti-Pattern</a>. Annotations by themselves are not the key motivator, but they help us and encourage us by tearing objects apart and keeping parts in different places. They are containers, sessions, managers, controllers, etc.</p><h2 id="xmlelement"><code>@XmlElement</code></h2><aside class='youtube'> <a href='https://www.youtube.com/watch?v=oV6Utb5Jows'><div class='box'> <img src='https://i.ytimg.com/vi/oV6Utb5Jows/mqdefault.jpg' alt='YouTube video #oV6Utb5Jows'/><div class='play'><i class='icon icon-play'></i></div></div></a><div>Dependency Injection Container is a Bad Idea (webinar #9); 1 December 2015.</div></aside><p>This is how JAXB <a href="/2015/03/26/jaxb-vs-xembly.html">works</a>, when you want to convert your <a href="https://en.wikipedia.org/wiki/Plain_Old_Java_Object">POJO</a> to XML. First, you attach the <code>@XmlElement</code> annotation to the getter:</p><figure class="highlight"><pre><code class="language-java" data-lang="java"><span></span><span class="kn">import</span> <span class="nn">javax.xml.bind.annotation.XmlElement</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">javax.xml.bind.annotation.XmlRootElement</span><span class="o">;</span>
<span class="nd">@XmlRootElement</span>
<span class="kd">public</span> <span class="kd">class</span> <span class="nc">Book</span> <span class="o">{</span>
  <span class="kd">private</span> <span class="kd">final</span> <span class="n">String</span> <span class="n">title</span><span class="o">;</span>
  <span class="kd">public</span> <span class="nf">Book</span><span class="o">(</span><span class="kd">final</span> <span class="n">String</span> <span class="n">title</span><span class="o">)</span> <span class="o">{</span>
    <span class="k">this</span><span class="o">.</span><span class="na">title</span> <span class="o">=</span> <span class="n">title</span><span class="o">;</span>
  <span class="o">}</span>
  <span class="nd">@XmlElement</span>
  <span class="kd">public</span> <span class="n">String</span> <span class="nf">getTitle</span><span class="o">()</span> <span class="o">{</span>
    <span class="k">return</span> <span class="k">this</span><span class="o">.</span><span class="na">title</span><span class="o">;</span>
  <span class="o">}</span>
<span class="o">}</span></code></pre></figure><p>Then, you create a marshaller and ask it to convert an instance of class <code>Book</code> into XML:</p><figure class="highlight"><pre><code class="language-java" data-lang="java"><span></span><span class="kd">final</span> <span class="n">Book</span> <span class="n">book</span> <span class="o">=</span> <span class="k">new</span> <span class="n">Book</span><span class="o">(</span><span class="s">&quot;0132350882&quot;</span><span class="o">,</span> <span class="s">&quot;Clean Code&quot;</span><span class="o">);</span>
<span class="kd">final</span> <span class="n">JAXBContext</span> <span class="n">ctx</span> <span class="o">=</span> <span class="n">JAXBContext</span><span class="o">.</span><span class="na">newInstance</span><span class="o">(</span><span class="n">Book</span><span class="o">.</span><span class="na">class</span><span class="o">);</span>
<span class="kd">final</span> <span class="n">Marshaller</span> <span class="n">marshaller</span> <span class="o">=</span> <span class="n">ctx</span><span class="o">.</span><span class="na">createMarshaller</span><span class="o">();</span>
<span class="n">marshaller</span><span class="o">.</span><span class="na">marshal</span><span class="o">(</span><span class="n">book</span><span class="o">,</span> <span class="n">System</span><span class="o">.</span><span class="na">out</span><span class="o">);</span></code></pre></figure> <aside class='youtube'> <a href='https://www.youtube.com/watch?v=cv23Z6xpwDw'><div class='box'> <img src='https://i.ytimg.com/vi/cv23Z6xpwDw/mqdefault.jpg' alt='YouTube video #cv23Z6xpwDw'/><div class='play'><i class='icon icon-play'></i></div></div></a><div>Java Annotations Are a Bad Idea; 20 June 2017.</div></aside><p>Who is creating the XML? Not the <code>book</code>. Someone else, outside of the class <code>Book</code>. This is very wrong. Instead, this is how this should have been done. First, the class that has no idea about XML:</p><figure class="highlight"><pre><code class="language-java" data-lang="java"><span></span><span class="kd">class</span> <span class="nc">DefaultBook</span> <span class="kd">implements</span> <span class="n">Book</span> <span class="o">{</span>
  <span class="kd">private</span> <span class="kd">final</span> <span class="n">String</span> <span class="n">title</span><span class="o">;</span>
  <span class="n">DefaultBook</span><span class="o">(</span><span class="kd">final</span> <span class="n">String</span> <span class="n">title</span><span class="o">)</span> <span class="o">{</span>
    <span class="k">this</span><span class="o">.</span><span class="na">title</span> <span class="o">=</span> <span class="n">title</span><span class="o">;</span>
  <span class="o">}</span>
  <span class="nd">@Override</span>
  <span class="kd">public</span> <span class="n">String</span> <span class="nf">getTitle</span><span class="o">()</span> <span class="o">{</span>
    <span class="k">return</span> <span class="k">this</span><span class="o">.</span><span class="na">title</span><span class="o">;</span>
  <span class="o">}</span>
<span class="o">}</span></code></pre></figure><p>Then, the <a href="/2015/02/26/composable-decorators.html">decorator</a> that prints it to the XML:</p><figure class="highlight"><pre><code class="language-java" data-lang="java"><span></span><span class="kd">class</span> <span class="nc">XmlBook</span> <span class="kd">implements</span> <span class="n">Book</span><span class="o">{</span>
  <span class="kd">private</span> <span class="kd">final</span> <span class="n">Book</span> <span class="n">origin</span><span class="o">;</span>
  <span class="n">XmlBook</span><span class="o">(</span><span class="kd">final</span> <span class="n">Book</span> <span class="n">book</span><span class="o">)</span> <span class="o">{</span>
    <span class="k">this</span><span class="o">.</span><span class="na">origin</span> <span class="o">=</span> <span class="n">book</span><span class="o">;</span>
  <span class="o">}</span>
  <span class="nd">@Override</span>
  <span class="kd">public</span> <span class="n">String</span> <span class="nf">getTitle</span><span class="o">()</span> <span class="o">{</span>
    <span class="k">return</span> <span class="k">this</span><span class="o">.</span><span class="na">origin</span><span class="o">.</span><span class="na">getTitle</span><span class="o">();</span>
  <span class="o">}</span>
  <span class="kd">public</span> <span class="n">String</span> <span class="nf">toXML</span><span class="o">()</span> <span class="o">{</span>
    <span class="k">return</span> <span class="n">String</span><span class="o">.</span><span class="na">format</span><span class="o">(</span>
      <span class="s">&quot;&lt;book&gt;&lt;title&gt;%s&lt;/title&gt;&lt;/book&gt;&quot;</span><span class="o">,</span>
      <span class="k">this</span><span class="o">.</span><span class="na">getTitle</span><span class="o">()</span>
    <span class="o">);</span>
  <span class="o">}</span>
<span class="o">}</span></code></pre></figure><p>Now, in order to <a href="/2016/04/05/printers-instead-of-getters.html">print</a> the book in XML we do the following:</p><figure class="highlight"><pre><code class="language-java" data-lang="java"><span></span><span class="n">String</span> <span class="n">xml</span> <span class="o">=</span> <span class="k">new</span> <span class="n">XmlBook</span><span class="o">(</span>
  <span class="k">new</span> <span class="n">DefaultBook</span><span class="o">(</span><span class="s">&quot;Elegant Objects&quot;</span><span class="o">)</span>
<span class="o">).</span><span class="na">toXML</span><span class="o">();</span></code></pre></figure><p>The XML printing functionality is inside <code>XmlBook</code>. If you don&#39;t like the decorator idea, you can move the <code>toXML()</code> method to the <code>DefaultBook</code> class. It&#39;s not important. What is important is that the functionality always stays where it belongs---inside the object. Only the object knows how to <a href="/2016/04/05/printers-instead-of-getters.html">print itself</a> to the XML. Nobody else!</p><h2 id="retryonfailure"><code>@RetryOnFailure</code></h2><p>Here is an example (from <a href="/2014/08/15/retry-java-method-on-exception.html">my own library</a>):</p><figure class="highlight"><pre><code class="language-java" data-lang="java"><span></span><span class="kn">import</span> <span class="nn">com.jcabi.aspects.RetryOnFailure</span><span class="o">;</span>
<span class="kd">class</span> <span class="nc">Foo</span> <span class="o">{</span>
  <span class="nd">@RetryOnFailure</span>
  <span class="kd">public</span> <span class="n">String</span> <span class="nf">load</span><span class="o">(</span><span class="n">URL</span> <span class="n">url</span><span class="o">)</span> <span class="o">{</span>
    <span class="k">return</span> <span class="n">url</span><span class="o">.</span><span class="na">openConnection</span><span class="o">().</span><span class="na">getContent</span><span class="o">();</span>
  <span class="o">}</span>
<span class="o">}</span></code></pre></figure><p>After compilation, we run a so called <a href="/2014/06/01/aop-aspectj-java-method-logging.html">AOP weaver</a> that technically turns our code into something like this:</p><figure class="highlight"><pre><code class="language-java" data-lang="java"><span></span><span class="kd">class</span> <span class="nc">Foo</span> <span class="o">{</span>
  <span class="kd">public</span> <span class="n">String</span> <span class="nf">load</span><span class="o">(</span><span class="n">URL</span> <span class="n">url</span><span class="o">)</span> <span class="o">{</span>
    <span class="k">while</span> <span class="o">(</span><span class="kc">true</span><span class="o">)</span> <span class="o">{</span>
      <span class="k">try</span> <span class="o">{</span>
        <span class="k">return</span> <span class="n">_Foo</span><span class="o">.</span><span class="na">load</span><span class="o">(</span><span class="n">url</span><span class="o">);</span>
      <span class="o">}</span> <span class="k">catch</span> <span class="o">(</span><span class="n">Exception</span> <span class="n">ex</span><span class="o">)</span> <span class="o">{</span>
        <span class="c1">// ignore it</span>
      <span class="o">}</span>
    <span class="o">}</span>
  <span class="o">}</span>
  <span class="kd">class</span> <span class="nc">_Foo</span> <span class="o">{</span>
    <span class="kd">public</span> <span class="n">String</span> <span class="nf">load</span><span class="o">(</span><span class="n">URL</span> <span class="n">url</span><span class="o">)</span> <span class="o">{</span>
      <span class="k">return</span> <span class="n">url</span><span class="o">.</span><span class="na">openConnection</span><span class="o">().</span><span class="na">getContent</span><span class="o">();</span>
    <span class="o">}</span>
  <span class="o">}</span>
<span class="o">}</span></code></pre></figure><p>I simplified the actual algorithm of retrying a method call on failure, but I&#39;m sure you get the idea. <a href="http://www.eclipse.org/aspectj/">AspectJ</a>, the <a href="http://en.wikipedia.org/wiki/Aspect-oriented_programming">AOP</a> engine, uses <a href="http://aspects.jcabi.com/annotation-retryonfailure.html"><code>@RetryOnFailure</code></a> annotation as a signal, informing us that the class has to be wrapped into another one. This is happening behind the scenes. We don&#39;t see that supplementary class, which implements the retrying algorithm. But the bytecode produced by the AspectJ weaver contains a modified version of class <code>Foo</code>.</p><aside class='youtube'> <a href='https://www.youtube.com/watch?v=WSgP85kr6eU'><div class='box'> <img src='https://i.ytimg.com/vi/WSgP85kr6eU/mqdefault.jpg' alt='YouTube video #WSgP85kr6eU'/><div class='play'><i class='icon icon-play'></i></div></div></a><div>Why Getters-and-Setters Is An Anti-Pattern? (webinar #4); 1 July 2015.</div></aside><p>That is exactly what is wrong with this approach---we don&#39;t see and don&#39;t control the instantiation of that supplementary object. Object composition, which is the most important process in object design, is hidden somewhere behind the scenes. You may say that we don&#39;t need to see it since it&#39;s supplementary. I disagree. We must see how our objects are composed. We may not care about how they work, but we must see the entire composition process.</p><p>A much better design would look like this (instead of annotations):</p><figure class="highlight"><pre><code class="language-java" data-lang="java"><span></span><span class="n">Foo</span> <span class="n">foo</span> <span class="o">=</span> <span class="k">new</span> <span class="n">FooThatRetries</span><span class="o">(</span><span class="k">new</span> <span class="n">Foo</span><span class="o">());</span></code></pre></figure><p>And then, the implementation of <code>FooThatRetries</code>:</p><figure class="highlight"><pre><code class="language-java" data-lang="java"><span></span><span class="kd">class</span> <span class="nc">FooThatRetries</span> <span class="kd">implements</span> <span class="n">Foo</span> <span class="o">{</span>
  <span class="kd">private</span> <span class="kd">final</span> <span class="n">Foo</span> <span class="n">origin</span><span class="o">;</span>
  <span class="n">FooThatRetries</span><span class="o">(</span><span class="n">Foo</span> <span class="n">foo</span><span class="o">)</span> <span class="o">{</span>
    <span class="k">this</span><span class="o">.</span><span class="na">origin</span> <span class="o">=</span> <span class="n">foo</span><span class="o">;</span>
  <span class="o">}</span>
  <span class="kd">public</span> <span class="n">String</span> <span class="nf">load</span><span class="o">(</span><span class="n">URL</span> <span class="n">url</span><span class="o">)</span> <span class="o">{</span>
    <span class="k">return</span> <span class="k">new</span> <span class="n">Retry</span><span class="o">().</span><span class="na">eval</span><span class="o">(</span>
      <span class="k">new</span> <span class="n">Retry</span><span class="o">.</span><span class="na">Algorithm</span><span class="o">&lt;</span><span class="n">String</span><span class="o">&gt;()</span> <span class="o">{</span>
        <span class="nd">@Override</span>
        <span class="kd">public</span> <span class="n">String</span> <span class="nf">eval</span><span class="o">()</span> <span class="o">{</span>
          <span class="k">return</span> <span class="n">FooThatRetries</span><span class="o">.</span><span class="na">this</span><span class="o">.</span><span class="na">load</span><span class="o">(</span><span class="n">url</span><span class="o">);</span>
        <span class="o">}</span>
      <span class="o">}</span>
    <span class="o">);</span>
  <span class="o">}</span>
<span class="o">}</span></code></pre></figure><p>And now, the implementation of <code>Retry</code>:</p><figure class="highlight"><pre><code class="language-java" data-lang="java"><span></span><span class="kd">class</span> <span class="nc">Retry</span> <span class="o">{</span>
  <span class="kd">public</span> <span class="o">&lt;</span><span class="n">T</span><span class="o">&gt;</span> <span class="n">T</span> <span class="nf">eval</span><span class="o">(</span><span class="n">Retry</span><span class="o">.</span><span class="na">Algorithm</span><span class="o">&lt;</span><span class="n">T</span><span class="o">&gt;</span> <span class="n">algo</span><span class="o">)</span> <span class="o">{</span>
    <span class="k">while</span> <span class="o">(</span><span class="kc">true</span><span class="o">)</span> <span class="o">{</span>
      <span class="k">try</span> <span class="o">{</span>
        <span class="k">return</span> <span class="n">algo</span><span class="o">.</span><span class="na">eval</span><span class="o">();</span>
      <span class="o">}</span> <span class="k">catch</span> <span class="o">(</span><span class="n">Exception</span> <span class="n">ex</span><span class="o">)</span> <span class="o">{</span>
        <span class="c1">// ignore it</span>
      <span class="o">}</span>
    <span class="o">}</span>
  <span class="o">}</span>
  <span class="kd">interface</span> <span class="nc">Algorithm</span><span class="o">&lt;</span><span class="n">T</span><span class="o">&gt;</span> <span class="o">{</span>
    <span class="n">T</span> <span class="nf">eval</span><span class="o">();</span>
  <span class="o">}</span>
<span class="o">}</span></code></pre></figure><p>Is the code longer? Yes. Is it cleaner? A lot more. I regret that I didn&#39;t understand it two years ago, when I started to work with <a href="https://github.com/jcabi/jcabi-aspects">jcabi-aspects</a>.</p><hr/><p>The bottom line is that annotations are bad. Don&#39;t use them. What should be used instead? Object <a href="/2015/02/26/composable-decorators.html">composition</a>.</p><p>What could be worse than annotations? <a href="/2016/04/19/object-must-not-be-configurable.html">Configurations</a>. For example, XML configurations. Spring XML configuration mechanisms is a perfect example of terrible design. I&#39;ve said it many times before. Let me repeat it again---Spring Framework is one of the worst software products in the Java world. If you can stay away from it, you will do yourself a big favor.</p><p>There should not be any &quot;configurations&quot; in <a href="/2016/08/15/what-is-wrong-object-oriented-programming.html">OOP</a>. We can&#39;t configure our objects if they are real objects. We can only instantiate them. And the best method of instantiation is operator <code>new</code>. This operator is the key instrument for an OOP developer. Taking it away from us and giving us &quot;configuration mechanisms&quot; is an unforgivable <a href="/2015/11/24/imprisonment-for-irresponsible-coding.html">crime</a>.</p></div></article></div><div class="wrapper"> <related-posts /></div><div class="disqus" role="complementary"><p class="disqus_hint"> Please, use <a href="https://help.disqus.com/commenting/what-html-tags-are-allowed-within-comments">syntax highlighting</a> in your comments, to make them more readable.</p><div id="disqus_thread" class="disqus-thread"> <a>&nbsp;</a></div><script> var disqus_config = function () { this.page.url = document.location.href.split('?')[0].split('#')[0].replace('https://', 'http://'); this.page.identifier = this.page.url; }; (function() { var d = document, s = d.createElement('script'); s.src = '//yegor256.disqus.com/embed.js'; s.setAttribute('data-timestamp', +new Date()); (d.head || d.body).appendChild(s); })(); </script> <noscript><div><p class="red"> JavaScript is disabled in your browser, that's why you can't see comments under this post.</p></div></noscript></div><div class="wrapper"> <footer class="footer"><p> &copy; <span itemscope="" itemprop="copyrightHolder" itemtype="http://schema.org/Person"> <span itemprop="name">Yegor Bugayenko</span> </span> 2014&ndash;<span itemprop="copyrightYear">2018</span></p></footer></div></section><div class="wrapper unprintable" style="text-align:center;margin-top:2em;"> <a href="http://www.sixnines.io/h/3ba1652f"> <img src="//www.sixnines.io/b/3ba1652f?style=flat" alt="sixnines availability badge"/> </a></div><script src="//code.jquery.com/jquery-1.9.0.min.js"></script> <script src="/js/all.js?4e047f6f42b"></script> <script>var disqus_shortname = 'yegor256';</script> <script id="dsq-count-scr" src="//yegor256.disqus.com/count.js" async="async"></script> <script> (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){ (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o), m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m) })(window,document,'script','//www.google-analytics.com/analytics.js','ga'); ga('create', 'UA-1963507-32', 'auto'); ga('send', 'pageview'); </script> <script> Cd=document;Cr="&"+Math.random();Cp="&s=1"; Cd.cookie="b=b";if(Cd.cookie)Cp+="&c=1"; Cp+="&t="+(new Date()).getTimezoneOffset(); if(self!=top)Cp+="&f=1"; </script> <script> if(navigator.javaEnabled())Cp+="&j=1"; </script> <script> if(typeof(screen)!='undefined')Cp+="&w="+screen.width+"&h="+ screen.height+"&d="+(screen.colorDepth?screen.colorDepth:screen.pixelDepth); </script> <script> Cd.write("<img src='//c.hit.ua/hit?i=95870&g=0&x=2"+Cp+Cr+ "&r="+escape(Cd.referrer)+"&u="+escape(window.location.href)+ "' border='0' wi"+"dth='1' he"+"ight='1'/>"); </script> <script type="application/ld+json"> { "@context": "http://schema.org", "@type": "Person", "name": "Yegor Bugayenko", "url": "http://www.yegor256.com", "sameAs": [ "https://www.facebook.com/yegor256", "https://instagram.com/yegor256", "https://www.linkedin.com/in/yegor256", "https://twitter.com/yegor256", "https://github.com/yegor256", "https://www.pinterest.com/yegor256/" ] } </script> </body> </html> <!DOCTYPE html> <html xmlns="http://www.w3.org/1999/xhtml" lang="en-US" xml:lang="en-US" itemscope="" itemtype="http://schema.org/WebSite"> <head> <meta charset="utf-8"/> <meta name="description" content="Since getters are an anti-pattern, how are we supposed to convert an object to, say, JSON or plain text? I&apos;m suggesting to use printers. " /> <meta name="keywords" content="alternative to getters, getters and setters, getters and setters java, getters java, how to avoid getters" /> <meta name="viewport" content="width=device-width,minimum-scale=1,initial-scale=1"/> <meta name="google-site-verification" content="JEj_gQr2CPe2QKGw8XdMz0R7VboQIUbX3FlM-lwTq-8" /> <meta name="author" content="Yegor Bugayenko"> <meta name="article:published_time" content="2016-04-05 00:00:00 +0000"> <meta name="og:site_name" content="Yegor Bugayenko"/> <meta name="og:type" content="article" /> <meta name="og:locale" content="en_US" /> <meta name="twitter:account_id" content="4503599630178231" /> <meta name="twitter:creator" content="@yegor256"/> <meta name="twitter:site" content="@yegor256"/> <meta name="twitter:title" property="og:title" content="Printers Instead of Getters"/> <meta name="twitter:description" property="og:description" content="Since getters are an anti-pattern, how are we supposed to convert an object to, say, JSON or plain text? I&apos;m suggesting to use printers. "/> <meta name="twitter:url" property="og:url" content="https://www.yegor256.com/2016/04/05/printers-instead-of-getters.html"/> <meta name="telegram:channel" content="AAAAAEJFMRzsRTRxM3ec6A"/> <link rel="search" type="application/opensearchdescription+xml" href="/opensearch.xml" title="yegor256" /> <link rel="shortcut icon" href="/favicon.ico?4e047f6f42b"/> <link rel="apple-touch-icon" href="/favicon.ico?4e047f6f42b"/> <link rel="alternate" type="application/rss+xml" title="RSS for yegor256.com" href="https://www.yegor256.com/rss.xml"/> <link rel="stylesheet" href="/css/layout.css?4e047f6f42b"/> <link rel="stylesheet" href="/css/icons.css?4e047f6f42b"/> <link rel="canonical" href="https://www.yegor256.com/2016/04/05/printers-instead-of-getters.html" /> <link rel="amphtml" href="https://www.yegor256.com/2016/04/05/printers-instead-of-getters.amp.html" /> <title>Printers Instead of Getters </title> <meta name='og:image' content='https://www.yegor256.com/images/2016/04/amelie.jpg'/><meta name='twitter:image' content='https://www.yegor256.com/images/2016/04/amelie.jpg'/><meta name='og:image:width' content='1200'/> <meta name='twitter:image:width' content='1200'/><meta name='og:image:height' content='675'/> <meta name='twitter:image:height' content='675'/><meta name='twitter:card' content='summary_large_image'/><meta name='twitter:image:alt' content='Le fabuleux destin d&#39;Amélie Poulain (2001) by Jean-Pierre Jeunet'/> </head> <body><div class="wrapper"> <aside class="header-toggle unprintable" id="header-toggle" title="Show the menu" onclick="$('#header').show();$('#header-toggle').hide();">&#9776;</aside> <header class="header" id="header"><div class="face"> <a href="/about-me.html#form" class="sub" title="Click to subscribe to my monthly newsletter"><span>Subscribe</span></a> <a href="/about-me.html" style="position:relative;"> <img src="/images/face-256x256.jpg" class="photo" alt="Yegor Bugayenko"/> </a></div><nav><ul class="menu social notranslate"> <li><a href="https://twitter.com/intent/follow?screen_name=yegor256" rel="nofollow" title="Follow me on Twitter"><i class="icon icon-twitter notranslate" aria-hidden="true"></i></a></li> <li><a href="/rss.xml" rel="nofollow" title="Subscribe to my RSS feed"><i class="icon icon-rss notranslate" aria-hidden="true"></i></a></li> <li><a itemprop="sameAs" href="https://github.com/yegor256" rel="nofollow" title="My GitHub profile"><i class="icon icon-github notranslate" aria-hidden="true"></i></a></li> <li><a itemprop="sameAs" href="http://stackoverflow.com/users/187141/yegor256" rel="nofollow" title="My StackOverflow profile"><i class="icon icon-stackoverflow notranslate" aria-hidden="true"></i></a></li> <li><a itemprop="sameAs" href="https://www.facebook.com/yegor256" rel="nofollow" title="Follow me on Facebook"><i class="icon icon-facebook notranslate" aria-hidden="true"></i></a></li> <li><a itemprop="sameAs" href="https://instagram.com/yegor256" rel="nofollow" title="Follow me on Instagram"><i class="icon icon-instagram notranslate" aria-hidden="true"></i></a></li> <li><a itemprop="sameAs" href="https://www.linkedin.com/in/yegor256" rel="nofollow" title="My LinkedIn profile"><i class="icon icon-linkedin notranslate" aria-hidden="true"></i></a></li> <li><a itemprop="sameAs" href="https://www.youtube.com/c/yegor256?sub_confirmation=1" rel="nofollow" title="My Youtube video channel"><i class="icon icon-youtube notranslate" aria-hidden="true"></i></a></li> <li><a itemprop="sameAs" href="https://www.pinterest.com/yegor256/" rel="nofollow" title="My Pinterest boards"><i class="icon icon-pinterest notranslate" aria-hidden="true"></i></a></li> <li><a itemprop="sameAs" href="https://angel.co/yegor256" rel="nofollow" title="My AngelList profile"><i class="icon icon-angellist notranslate" aria-hidden="true"></i></a></li> <li><a href="https://soundcloud.com/yegor256" rel="nofollow" title="My podcast"><i class="icon icon-podcast notranslate" aria-hidden="true"></i></a></li> <li><a href="https://itunes.apple.com/us/podcast/yegor256-podcast/id1150826721" rel="nofollow" title="My iTunes podcast"><i class="icon icon-itunes notranslate" aria-hidden="true"></i></a></li> <li><a href="https://t.me/joinchat/AAAAAEJFMRzsRTRxM3ec6A" rel="nofollow" title="My Telegram public channel"><i class="icon icon-telegram notranslate" aria-hidden="true"></i></a></li> <li><a href="mailto:blog@yegor256.com" rel="nofollow" title="Email me any time"><i class="icon icon-mail notranslate" aria-hidden="true"></i></a></li></ul><ul class="menu"> <li><a href="/" title="Home page">Home</a></li> <li ><a href="/best.html" title="Best articles to read">12&#160;Best</a></li> <li ><a href="/contents.html" title="The contents of the entire blog">All&#160;288</a></li> <li ><a href="/webinars.html" title="My webinars">Webinars</a></li> <li ><a href="/talks.html" title="Future and past conference talks">Talks</a></li> <li ><a href="/books.html" title="The books I wrote">Books</a></li> <li ><a href="/papers.html" title="My academic papers and patents">Papers</a></li> <li ><a href="/pets.html" title="My loved pet projects">Pets</a></li> <li ><a href="/award.html" title="Software quality award">Award</a></li> <li ><a href="/testimonials.html" title="What some people say about me">Testimonials</a></li> <li ><a href="/shift-m.html" title="Audio podcast about project management">Shift-M</a></li> <li ><a href="/paintings.html" title="My paintings for sale">Paintings</a></li> <li><a href="http://ru.yegor256.com/" title="Немного на русском языке">По-русски</a></li></ul></nav><div class="search"> <form method="get" action="https://www.google.com/search" itemprop="potentialAction" itemscope="" itemtype="http://schema.org/SearchAction"> <meta itemprop="target" content="https://www.google.com/search?q={q}"/> <input name="sitesearch" value="yegor256.com" type="hidden"/> <input itemprop="query-input" type="text" id="search-query" class="field field-text" required="required" onfocus="$('.google').css('visibility', 'visible');" name="q" placeholder="Search..." autocomplete="off"/> <input type="image" src="/images/google-search-icon.svg" class="google" title="Search via Google" alt="Search via Google"/> </form></div><div class="hot"><ul> <li> <a href="/code-ahead.html">Code Ahead</a> was published on Amazon just a few days ago! It is my new book, a novel about programmers. It explains in details the majority of ideas that stand behind <a href="https://www.zerocracy.com">Zerocracy</a> and <a href="https://www.xdsd.org">XDSD</a>. </li> <li> At <a href="/webinars.html">Webinar #37</a> we will discuss naming problem in OOP, for objects, methods and attributes; join us on <b>September 12</b>, at 11am PST. </li></ul></div></header></div><section itemscope="" itemtype="http://schema.org/BlogPosting"><div class="wrapper"> <header><p class="printable"> <img src="https://api.qrserver.com/v1/create-qr-code/?data=https://www.yegor256.com/2016/04/05/printers-instead-of-getters.html&amp;format=svg" style="width:125px;height:125px;" alt="QR code"/></p><p class="printable"> <code itemprop="url">https://www.yegor256.com/2016/04/05/printers-instead-of-getters.html</code></p><h1 itemprop="name headline mainEntityOfPage">Printers Instead of Getters</h1><aside class='book'><a href='http://amzn.to/2pyceWc'><img src='/images/books/elegant-objects/cover.png' class='book-cover' alt='book cover'/></a>Read more about this subject in <a href='http://amzn.to/2pyceWc'>Section&nbsp;5.3</a><br/> of my book<a href='http://amzn.to/2pyceWc'><img src='/images/books/amazon-buy-button.png' class='amazon-button' alt='Click to buy'/></a></aside><ul class="subline"> <li> <time itemprop="datePublished" datetime="2016-04-05T00:00:00+00:00"> 5 April 2016 </time> </li> <li class="desktop-only" itemprop="locationCreated">Palo Alto, CA</li> <li class="printable" itemscope="" itemprop="author" itemtype="http://schema.org/Person"> <span itemprop="name">Yegor Bugayenko</span> </li> <li class="unprintable"> <i class="icon icon-comments"></i> <a href="http://www.yegor256.com/2016/04/05/printers-instead-of-getters.html#disqus_thread" itemprop="discussionUrl">comments</a> </li></ul><figure class='jb_picture'><img itemprop='image' alt='Le fabuleux destin d&#39;Amélie Poulain (2001) by Jean-Pierre Jeunet' src='/images/2016/04/amelie.jpg' longdesc='#a123a2ca'/><figcaption id='a123a2ca'>Le fabuleux destin d&#39;Amélie Poulain (2001) by Jean-Pierre Jeunet</figcaption></figure><p>I&#39;m suggesting to use &quot;printers&quot; instead. Instead of exposing data via getters, an object will have a functionality of <strong>printing</strong> itself to some media.</p><p>Let&#39;s say this is our class:</p><figure class="highlight"><pre><code class="language-java" data-lang="java"><span></span><span class="kd">public</span> <span class="kd">class</span> <span class="nc">Book</span> <span class="o">{</span>
  <span class="kd">private</span> <span class="kd">final</span> <span class="n">String</span> <span class="n">isbn</span> <span class="o">=</span>
    <span class="s">&quot;0735619654&quot;</span><span class="o">;</span>
  <span class="kd">private</span> <span class="kd">final</span> <span class="n">String</span> <span class="n">title</span> <span class="o">=</span>
    <span class="s">&quot;Object Thinking&quot;</span><span class="o">;</span>
<span class="o">}</span></code></pre></figure><p>We need it to be transferred into XML format. A more or less traditional way to do it is via getters and <a href="/2015/03/26/jaxb-vs-xembly.html">JAXB</a>:</p><figure class="highlight"><pre><code class="language-java" data-lang="java"><span></span><span class="kn">import</span> <span class="nn">javax.xml.bind.annotation.XmlElement</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">javax.xml.bind.annotation.XmlRootElement</span><span class="o">;</span>
<span class="nd">@XmlRootElement</span>
<span class="kd">public</span> <span class="kd">class</span> <span class="nc">Book</span> <span class="o">{</span>
  <span class="kd">private</span> <span class="kd">final</span> <span class="n">String</span> <span class="n">isbn</span> <span class="o">=</span>
    <span class="s">&quot;0735619654&quot;</span><span class="o">;</span>
  <span class="kd">private</span> <span class="kd">final</span> <span class="n">String</span> <span class="n">title</span> <span class="o">=</span>
    <span class="s">&quot;Object Thinking&quot;</span><span class="o">;</span>
  <span class="nd">@XmlElement</span>
  <span class="kd">public</span> <span class="n">String</span> <span class="nf">getIsbn</span><span class="o">()</span> <span class="o">{</span>
    <span class="k">return</span> <span class="k">this</span><span class="o">.</span><span class="na">isbn</span><span class="o">;</span>
  <span class="o">}</span>
  <span class="nd">@XmlElement</span>
  <span class="kd">public</span> <span class="n">String</span> <span class="nf">getTitle</span><span class="o">()</span> <span class="o">{</span>
    <span class="k">return</span> <span class="k">this</span><span class="o">.</span><span class="na">title</span><span class="o">;</span>
  <span class="o">}</span>
<span class="o">}</span></code></pre></figure><p>This is a very <a href="/2014/12/01/orm-offensive-anti-pattern.html">offensive</a> way of treating the <a href="/2014/11/20/seven-virtues-of-good-object.html">object</a>. We&#39;re basically exposing everything that&#39;s inside to the public. It was a nice little self-sufficient solid object and we turned it into a <a href="/2016/07/06/data-transfer-object.html">bag of data</a>, which anyone can access in many possible ways. We can access it for reading, of course.</p><p>It is convenient to have these getters, you may say. We are all used to them. If we want to convert it into <a href="/2015/11/16/json-vs-xml.html">JSON</a>, they will be very helpful. If we want to use this poor object as a data object in JSP, getters will help us. There are many examples in Java, where getters are being actively used.</p><aside class='youtube'> <a href='https://www.youtube.com/watch?v=_Q0cNykXB04'><div class='box'> <img src='https://i.ytimg.com/vi/_Q0cNykXB04/mqdefault.jpg' alt='YouTube video #_Q0cNykXB04'/><div class='play'><i class='icon icon-play'></i></div></div></a><div>Printers Instead of Getters in OOP (webinar #18); 7 September 2016.</div></aside><p>This is <strong>not</strong> because they are so effective. This is because we&#39;re so <a href="/2015/02/20/utility-classes-vs-functional-programming.html"><strong>procedural</strong></a> in our way of thinking. We <strong>don&#39;t trust</strong> our objects. We only trust the data they store. We don&#39;t want this <code>Book</code> object to generate the XML. We want it to give us the data. We will build the XML. The <code>Book</code> is too stupid to do that job. We&#39;re way smarter!</p><p>I&#39;m suggesting to stop thinking this way. Instead, let&#39;s try to give this poor <code>Book</code> a chance, and equip it with a &quot;printer&quot;:</p><figure class="highlight"><pre><code class="language-java" data-lang="java"><span></span><span class="kd">public</span> <span class="kd">class</span> <span class="nc">Book</span> <span class="o">{</span>
  <span class="kd">private</span> <span class="kd">final</span> <span class="n">String</span> <span class="n">isbn</span> <span class="o">=</span>
    <span class="s">&quot;0735619654&quot;</span><span class="o">;</span>
  <span class="kd">private</span> <span class="kd">final</span> <span class="n">String</span> <span class="n">title</span> <span class="o">=</span>
    <span class="s">&quot;Object Thinking&quot;</span><span class="o">;</span>
  <span class="kd">public</span> <span class="n">String</span> <span class="nf">toXML</span><span class="o">()</span> <span class="o">{</span>
    <span class="k">return</span> <span class="n">String</span><span class="o">.</span><span class="na">format</span><span class="o">(</span>
      <span class="s">&quot;&lt;book&gt;&lt;isbn&gt;%s&lt;/isbn&gt;&lt;title&gt;%s&lt;/title&gt;&lt;/book&gt;&quot;</span><span class="o">,</span>
      <span class="k">this</span><span class="o">.</span><span class="na">isbn</span><span class="o">,</span> <span class="k">this</span><span class="o">.</span><span class="na">title</span>
    <span class="o">);</span>
  <span class="o">}</span>
<span class="o">}</span></code></pre></figure><p>This isn&#39;t the <a href="/2015/03/26/jaxb-vs-xembly.html">best</a> implementation, but you got the idea. The object is not exposing its internals any more. We can&#39;t get its ISBN and its title. We can only ask it to print itself in XML format.</p><p>We can add an additional printer, if another format is required:</p><figure class="highlight"><pre><code class="language-java" data-lang="java"><span></span><span class="kd">public</span> <span class="kd">class</span> <span class="nc">Book</span> <span class="o">{</span>
  <span class="kd">private</span> <span class="kd">final</span> <span class="n">String</span> <span class="n">isbn</span> <span class="o">=</span>
    <span class="s">&quot;0735619654&quot;</span><span class="o">;</span>
  <span class="kd">private</span> <span class="kd">final</span> <span class="n">String</span> <span class="n">title</span> <span class="o">=</span>
    <span class="s">&quot;Object Thinking&quot;</span><span class="o">;</span>
  <span class="kd">public</span> <span class="n">String</span> <span class="nf">toJSON</span><span class="o">()</span> <span class="o">{</span>
    <span class="k">return</span> <span class="n">String</span><span class="o">.</span><span class="na">format</span><span class="o">(</span>
      <span class="s">&quot;{\&quot;isbn\&quot;:\&quot;%s\&quot;, \&quot;title\&quot;:\&quot;%s\&quot;}&quot;</span><span class="o">,</span>
      <span class="k">this</span><span class="o">.</span><span class="na">isbn</span><span class="o">,</span> <span class="k">this</span><span class="o">.</span><span class="na">title</span>
    <span class="o">);</span>
  <span class="o">}</span>
<span class="o">}</span></code></pre></figure><p>Again, not the best implementation, but you see what I&#39;m trying to show. Each time we need a new format, we create a new printer.</p><p>You may say that the object will be rather big if there will be many formats. That&#39;s true, but a big object is a bad design in the first place. I would say that if there is more than one printer---it&#39;s a problem.</p><p>So, what to do if we need multiple formats? Use &quot;media,&quot; where that printers will be able to print to. Say, we have an object that represents a record in MySQL. We want it to be printable to XML, HTML, JSON, some binary format and God knows what else. We can add that many printers to it, but the object will be big and ugly. To avoid that, introduce a new object, that represents the media where the data will be printed to:</p><figure class="highlight"><pre><code class="language-java" data-lang="java"><span></span><span class="kd">public</span> <span class="kd">class</span> <span class="nc">Book</span> <span class="o">{</span>
  <span class="kd">private</span> <span class="kd">final</span> <span class="n">String</span> <span class="n">isbn</span> <span class="o">=</span>
    <span class="s">&quot;0735619654&quot;</span><span class="o">;</span>
  <span class="kd">private</span> <span class="kd">final</span> <span class="n">String</span> <span class="n">title</span> <span class="o">=</span>
    <span class="s">&quot;Object Thinking&quot;</span><span class="o">;</span>
  <span class="kd">public</span> <span class="n">Media</span> <span class="nf">print</span><span class="o">(</span><span class="n">Media</span> <span class="n">media</span><span class="o">)</span> <span class="o">{</span>
    <span class="k">return</span> <span class="n">media</span>
      <span class="o">.</span><span class="na">with</span><span class="o">(</span><span class="s">&quot;isbn&quot;</span><span class="o">,</span> <span class="k">this</span><span class="o">.</span><span class="na">isbn</span><span class="o">)</span>
      <span class="o">.</span><span class="na">with</span><span class="o">(</span><span class="s">&quot;title&quot;</span><span class="o">,</span> <span class="k">this</span><span class="o">.</span><span class="na">title</span><span class="o">);</span>
  <span class="o">}</span>
<span class="o">}</span></code></pre></figure><p>Again, it&#39;s a very primitive design of that <a href="/2014/06/09/objects-should-be-immutable.html">immutable</a> <code>Media</code> class, but you got the idea---the <code>media</code> accepts the data. Now, we want to print our object to JSON (this design is not really perfect, since <code>JsonObjectBuilder</code> is not immutable, even though it looks like one...):</p><figure class="highlight"><pre><code class="language-java" data-lang="java"><span></span><span class="kd">class</span> <span class="nc">JsonMedia</span> <span class="kd">implements</span> <span class="n">Media</span> <span class="o">{</span>
  <span class="kd">private</span> <span class="kd">final</span> <span class="n">JsonObjectBuilder</span> <span class="n">builder</span><span class="o">;</span>
  <span class="n">JsonMedia</span><span class="o">()</span> <span class="o">{</span>
    <span class="k">this</span><span class="o">(</span><span class="s">&quot;book&quot;</span><span class="o">);</span>
  <span class="o">}</span>
  <span class="n">JsonMedia</span><span class="o">(</span><span class="n">String</span> <span class="n">head</span><span class="o">)</span> <span class="o">{</span>
    <span class="k">this</span><span class="o">(</span><span class="n">Json</span><span class="o">.</span><span class="na">createObjectBuilder</span><span class="o">().</span><span class="na">add</span><span class="o">(</span><span class="n">head</span><span class="o">));</span>
  <span class="o">}</span>
  <span class="n">JsonMedia</span><span class="o">(</span><span class="n">JsonObjectBuilder</span> <span class="n">bdr</span><span class="o">)</span> <span class="o">{</span>
    <span class="k">this</span><span class="o">.</span><span class="na">builder</span> <span class="o">=</span> <span class="n">bdr</span><span class="o">;</span>
  <span class="o">}</span>
  <span class="nd">@Override</span>
  <span class="kd">public</span> <span class="n">Media</span> <span class="nf">with</span><span class="o">(</span><span class="n">String</span> <span class="n">name</span><span class="o">,</span> <span class="n">String</span> <span class="n">value</span><span class="o">)</span> <span class="o">{</span>
    <span class="k">return</span> <span class="k">new</span> <span class="n">JsonMedia</span><span class="o">(</span>
      <span class="k">this</span><span class="o">.</span><span class="na">builder</span><span class="o">.</span><span class="na">add</span><span class="o">(</span><span class="n">name</span><span class="o">,</span> <span class="n">value</span><span class="o">)</span>
    <span class="o">);</span>
  <span class="o">}</span>
  <span class="kd">public</span> <span class="n">JsonObject</span> <span class="nf">json</span><span class="o">()</span> <span class="o">{</span>
    <span class="k">return</span> <span class="k">this</span><span class="o">.</span><span class="na">builder</span><span class="o">.</span><span class="na">build</span><span class="o">();</span>
  <span class="o">}</span>
<span class="o">}</span></code></pre></figure><p>Now, we make an instance of <code>JsonMedia</code> and ask our book to print itself there:</p><figure class="highlight"><pre><code class="language-java" data-lang="java"><span></span><span class="n">JsonMedia</span> <span class="n">media</span> <span class="o">=</span> <span class="k">new</span> <span class="n">JsonMedia</span><span class="o">(</span><span class="s">&quot;book&quot;</span><span class="o">);</span>
<span class="n">book</span><span class="o">.</span><span class="na">print</span><span class="o">(</span><span class="n">media</span><span class="o">);</span>
<span class="n">JsonObject</span> <span class="n">json</span> <span class="o">=</span> <span class="n">media</span><span class="o">.</span><span class="na">json</span><span class="o">();</span></code></pre></figure><p>Voilà! The JSON object is ready and the book has no idea about what exactly what printed just now. We need to print the book to XML? We create <code>XmlMedia</code>, which will print the book to XML. The <code>Book</code> class stays small, while the complexity of &quot;media&quot; objects is unlimited.</p><p>My point here is simple---no <a href="/2014/09/16/getters-and-setters-are-evil.html">getters</a>, just printers!</p></p>--> <nav class="buttons notranslate desktop-only"> <a href="http://www.facebook.com/sharer/sharer.php?u=https://www.yegor256.com/2016/04/05/printers-instead-of-getters.html" title="Share on Facebook" class="button" rel="nofollow"> <span class="count count-facebook">0</span> <i class="icon icon-facebook notranslate" aria-hidden="true"></i> </a> <a href="https://twitter.com/share?url=https://www.yegor256.com/2016/04/05/printers-instead-of-getters.html&amp;text=Printers+Instead+of+Getters" title="Share on Twitter" class="button" rel="nofollow"> <span class="count count-twitter">0</span> <i class="icon icon-twitter notranslate" aria-hidden="true"></i> </a> <a href="https://plus.google.com/share?url=https://www.yegor256.com/2016/04/05/printers-instead-of-getters.html" title="Share on Google+" class="button" rel="nofollow"> <span class="count count-googleplus">0</span> <i class="icon icon-googleplus notranslate" aria-hidden="true"></i> </a> <a href="https://www.linkedin.com/cws/share?url=https://www.yegor256.com/2016/04/05/printers-instead-of-getters.html" title="Share on LinkedIn" class="button" rel="nofollow"> <span class="count count-linkedin">0</span> <i class="icon icon-linkedin notranslate" aria-hidden="true"></i> </a> <a href="http://reddit.com/submit?url=https://www.yegor256.com/2016/04/05/printers-instead-of-getters.html%3F2016-14&amp;title=Printers+Instead+of+Getters" title="Share on Reddit" class="button" rel="nofollow"> <span class="count count-reddit">0</span> <i class="icon icon-reddit notranslate" aria-hidden="true"></i> </a> <a href="http://news.ycombinator.com/submitlink?u=https://www.yegor256.com/2016/04/05/printers-instead-of-getters.html%3F2016-14&amp;t=Printers+Instead+of+Getters" title="Share on Hacker News" class="button" rel="nofollow"> <span class="count count-hackernews">0</span> <i class="icon icon-hackernews notranslate" aria-hidden="true"></i> </a> </nav> </header> <article class="main" itemprop="articleBody"><div ><p>Getters and setters <a href="/2014/09/16/getters-and-setters-are-evil.html">are evil</a>. No need to argue about this, it&#39;s settled. You disagree? Let&#39;s discuss that later. For now, let&#39;s say, we want to get rid of getters. The key question is how is it possible at all? We do need to get the data out of an object, right? Nope. Wrong.</p><figure class='jb_picture'><img itemprop='image' alt='Le fabuleux destin d&#39;Amélie Poulain (2001) by Jean-Pierre Jeunet' src='/images/2016/04/amelie.jpg' longdesc='#a123a2ca'/><figcaption id='a123a2ca'>Le fabuleux destin d&#39;Amélie Poulain (2001) by Jean-Pierre Jeunet</figcaption></figure><p>I&#39;m suggesting to use &quot;printers&quot; instead. Instead of exposing data via getters, an object will have a functionality of <strong>printing</strong> itself to some media.</p><p>Let&#39;s say this is our class:</p><figure class="highlight"><pre><code class="language-java" data-lang="java"><span></span><span class="kd">public</span> <span class="kd">class</span> <span class="nc">Book</span> <span class="o">{</span>
  <span class="kd">private</span> <span class="kd">final</span> <span class="n">String</span> <span class="n">isbn</span> <span class="o">=</span>
    <span class="s">&quot;0735619654&quot;</span><span class="o">;</span>
  <span class="kd">private</span> <span class="kd">final</span> <span class="n">String</span> <span class="n">title</span> <span class="o">=</span>
    <span class="s">&quot;Object Thinking&quot;</span><span class="o">;</span>
<span class="o">}</span></code></pre></figure><p>We need it to be transferred into XML format. A more or less traditional way to do it is via getters and <a href="/2015/03/26/jaxb-vs-xembly.html">JAXB</a>:</p><figure class="highlight"><pre><code class="language-java" data-lang="java"><span></span><span class="kn">import</span> <span class="nn">javax.xml.bind.annotation.XmlElement</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">javax.xml.bind.annotation.XmlRootElement</span><span class="o">;</span>
<span class="nd">@XmlRootElement</span>
<span class="kd">public</span> <span class="kd">class</span> <span class="nc">Book</span> <span class="o">{</span>
  <span class="kd">private</span> <span class="kd">final</span> <span class="n">String</span> <span class="n">isbn</span> <span class="o">=</span>
    <span class="s">&quot;0735619654&quot;</span><span class="o">;</span>
  <span class="kd">private</span> <span class="kd">final</span> <span class="n">String</span> <span class="n">title</span> <span class="o">=</span>
    <span class="s">&quot;Object Thinking&quot;</span><span class="o">;</span>
  <span class="nd">@XmlElement</span>
  <span class="kd">public</span> <span class="n">String</span> <span class="nf">getIsbn</span><span class="o">()</span> <span class="o">{</span>
    <span class="k">return</span> <span class="k">this</span><span class="o">.</span><span class="na">isbn</span><span class="o">;</span>
  <span class="o">}</span>
  <span class="nd">@XmlElement</span>
  <span class="kd">public</span> <span class="n">String</span> <span class="nf">getTitle</span><span class="o">()</span> <span class="o">{</span>
    <span class="k">return</span> <span class="k">this</span><span class="o">.</span><span class="na">title</span><span class="o">;</span>
  <span class="o">}</span>
<span class="o">}</span></code></pre></figure><p>This is a very <a href="/2014/12/01/orm-offensive-anti-pattern.html">offensive</a> way of treating the <a href="/2014/11/20/seven-virtues-of-good-object.html">object</a>. We&#39;re basically exposing everything that&#39;s inside to the public. It was a nice little self-sufficient solid object and we turned it into a <a href="/2016/07/06/data-transfer-object.html">bag of data</a>, which anyone can access in many possible ways. We can access it for reading, of course.</p><p>It is convenient to have these getters, you may say. We are all used to them. If we want to convert it into <a href="/2015/11/16/json-vs-xml.html">JSON</a>, they will be very helpful. If we want to use this poor object as a data object in JSP, getters will help us. There are many examples in Java, where getters are being actively used.</p><aside class='youtube'> <a href='https://www.youtube.com/watch?v=_Q0cNykXB04'><div class='box'> <img src='https://i.ytimg.com/vi/_Q0cNykXB04/mqdefault.jpg' alt='YouTube video #_Q0cNykXB04'/><div class='play'><i class='icon icon-play'></i></div></div></a><div>Printers Instead of Getters in OOP (webinar #18); 7 September 2016.</div></aside><p>This is <strong>not</strong> because they are so effective. This is because we&#39;re so <a href="/2015/02/20/utility-classes-vs-functional-programming.html"><strong>procedural</strong></a> in our way of thinking. We <strong>don&#39;t trust</strong> our objects. We only trust the data they store. We don&#39;t want this <code>Book</code> object to generate the XML. We want it to give us the data. We will build the XML. The <code>Book</code> is too stupid to do that job. We&#39;re way smarter!</p><p>I&#39;m suggesting to stop thinking this way. Instead, let&#39;s try to give this poor <code>Book</code> a chance, and equip it with a &quot;printer&quot;:</p><figure class="highlight"><pre><code class="language-java" data-lang="java"><span></span><span class="kd">public</span> <span class="kd">class</span> <span class="nc">Book</span> <span class="o">{</span>
  <span class="kd">private</span> <span class="kd">final</span> <span class="n">String</span> <span class="n">isbn</span> <span class="o">=</span>
    <span class="s">&quot;0735619654&quot;</span><span class="o">;</span>
  <span class="kd">private</span> <span class="kd">final</span> <span class="n">String</span> <span class="n">title</span> <span class="o">=</span>
    <span class="s">&quot;Object Thinking&quot;</span><span class="o">;</span>
  <span class="kd">public</span> <span class="n">String</span> <span class="nf">toXML</span><span class="o">()</span> <span class="o">{</span>
    <span class="k">return</span> <span class="n">String</span><span class="o">.</span><span class="na">format</span><span class="o">(</span>
      <span class="s">&quot;&lt;book&gt;&lt;isbn&gt;%s&lt;/isbn&gt;&lt;title&gt;%s&lt;/title&gt;&lt;/book&gt;&quot;</span><span class="o">,</span>
      <span class="k">this</span><span class="o">.</span><span class="na">isbn</span><span class="o">,</span> <span class="k">this</span><span class="o">.</span><span class="na">title</span>
    <span class="o">);</span>
  <span class="o">}</span>
<span class="o">}</span></code></pre></figure><p>This isn&#39;t the <a href="/2015/03/26/jaxb-vs-xembly.html">best</a> implementation, but you got the idea. The object is not exposing its internals any more. We can&#39;t get its ISBN and its title. We can only ask it to print itself in XML format.</p><p>We can add an additional printer, if another format is required:</p><figure class="highlight"><pre><code class="language-java" data-lang="java"><span></span><span class="kd">public</span> <span class="kd">class</span> <span class="nc">Book</span> <span class="o">{</span>
  <span class="kd">private</span> <span class="kd">final</span> <span class="n">String</span> <span class="n">isbn</span> <span class="o">=</span>
    <span class="s">&quot;0735619654&quot;</span><span class="o">;</span>
  <span class="kd">private</span> <span class="kd">final</span> <span class="n">String</span> <span class="n">title</span> <span class="o">=</span>
    <span class="s">&quot;Object Thinking&quot;</span><span class="o">;</span>
  <span class="kd">public</span> <span class="n">String</span> <span class="nf">toJSON</span><span class="o">()</span> <span class="o">{</span>
    <span class="k">return</span> <span class="n">String</span><span class="o">.</span><span class="na">format</span><span class="o">(</span>
      <span class="s">&quot;{\&quot;isbn\&quot;:\&quot;%s\&quot;, \&quot;title\&quot;:\&quot;%s\&quot;}&quot;</span><span class="o">,</span>
      <span class="k">this</span><span class="o">.</span><span class="na">isbn</span><span class="o">,</span> <span class="k">this</span><span class="o">.</span><span class="na">title</span>
    <span class="o">);</span>
  <span class="o">}</span>
<span class="o">}</span></code></pre></figure><p>Again, not the best implementation, but you see what I&#39;m trying to show. Each time we need a new format, we create a new printer.</p><p>You may say that the object will be rather big if there will be many formats. That&#39;s true, but a big object is a bad design in the first place. I would say that if there is more than one printer---it&#39;s a problem.</p><p>So, what to do if we need multiple formats? Use &quot;media,&quot; where that printers will be able to print to. Say, we have an object that represents a record in MySQL. We want it to be printable to XML, HTML, JSON, some binary format and God knows what else. We can add that many printers to it, but the object will be big and ugly. To avoid that, introduce a new object, that represents the media where the data will be printed to:</p><figure class="highlight"><pre><code class="language-java" data-lang="java"><span></span><span class="kd">public</span> <span class="kd">class</span> <span class="nc">Book</span> <span class="o">{</span>
  <span class="kd">private</span> <span class="kd">final</span> <span class="n">String</span> <span class="n">isbn</span> <span class="o">=</span>
    <span class="s">&quot;0735619654&quot;</span><span class="o">;</span>
  <span class="kd">private</span> <span class="kd">final</span> <span class="n">String</span> <span class="n">title</span> <span class="o">=</span>
    <span class="s">&quot;Object Thinking&quot;</span><span class="o">;</span>
  <span class="kd">public</span> <span class="n">Media</span> <span class="nf">print</span><span class="o">(</span><span class="n">Media</span> <span class="n">media</span><span class="o">)</span> <span class="o">{</span>
    <span class="k">return</span> <span class="n">media</span>
      <span class="o">.</span><span class="na">with</span><span class="o">(</span><span class="s">&quot;isbn&quot;</span><span class="o">,</span> <span class="k">this</span><span class="o">.</span><span class="na">isbn</span><span class="o">)</span>
      <span class="o">.</span><span class="na">with</span><span class="o">(</span><span class="s">&quot;title&quot;</span><span class="o">,</span> <span class="k">this</span><span class="o">.</span><span class="na">title</span><span class="o">);</span>
  <span class="o">}</span>
<span class="o">}</span></code></pre></figure><p>Again, it&#39;s a very primitive design of that <a href="/2014/06/09/objects-should-be-immutable.html">immutable</a> <code>Media</code> class, but you got the idea---the <code>media</code> accepts the data. Now, we want to print our object to JSON (this design is not really perfect, since <code>JsonObjectBuilder</code> is not immutable, even though it looks like one...):</p><figure class="highlight"><pre><code class="language-java" data-lang="java"><span></span><span class="kd">class</span> <span class="nc">JsonMedia</span> <span class="kd">implements</span> <span class="n">Media</span> <span class="o">{</span>
  <span class="kd">private</span> <span class="kd">final</span> <span class="n">JsonObjectBuilder</span> <span class="n">builder</span><span class="o">;</span>
  <span class="n">JsonMedia</span><span class="o">()</span> <span class="o">{</span>
    <span class="k">this</span><span class="o">(</span><span class="s">&quot;book&quot;</span><span class="o">);</span>
  <span class="o">}</span>
  <span class="n">JsonMedia</span><span class="o">(</span><span class="n">String</span> <span class="n">head</span><span class="o">)</span> <span class="o">{</span>
    <span class="k">this</span><span class="o">(</span><span class="n">Json</span><span class="o">.</span><span class="na">createObjectBuilder</span><span class="o">().</span><span class="na">add</span><span class="o">(</span><span class="n">head</span><span class="o">));</span>
  <span class="o">}</span>
  <span class="n">JsonMedia</span><span class="o">(</span><span class="n">JsonObjectBuilder</span> <span class="n">bdr</span><span class="o">)</span> <span class="o">{</span>
    <span class="k">this</span><span class="o">.</span><span class="na">builder</span> <span class="o">=</span> <span class="n">bdr</span><span class="o">;</span>
  <span class="o">}</span>
  <span class="nd">@Override</span>
  <span class="kd">public</span> <span class="n">Media</span> <span class="nf">with</span><span class="o">(</span><span class="n">String</span> <span class="n">name</span><span class="o">,</span> <span class="n">String</span> <span class="n">value</span><span class="o">)</span> <span class="o">{</span>
    <span class="k">return</span> <span class="k">new</span> <span class="n">JsonMedia</span><span class="o">(</span>
      <span class="k">this</span><span class="o">.</span><span class="na">builder</span><span class="o">.</span><span class="na">add</span><span class="o">(</span><span class="n">name</span><span class="o">,</span> <span class="n">value</span><span class="o">)</span>
    <span class="o">);</span>
  <span class="o">}</span>
  <span class="kd">public</span> <span class="n">JsonObject</span> <span class="nf">json</span><span class="o">()</span> <span class="o">{</span>
    <span class="k">return</span> <span class="k">this</span><span class="o">.</span><span class="na">builder</span><span class="o">.</span><span class="na">build</span><span class="o">();</span>
  <span class="o">}</span>
<span class="o">}</span></code></pre></figure><p>Now, we make an instance of <code>JsonMedia</code> and ask our book to print itself there:</p><figure class="highlight"><pre><code class="language-java" data-lang="java"><span></span><span class="n">JsonMedia</span> <span class="n">media</span> <span class="o">=</span> <span class="k">new</span> <span class="n">JsonMedia</span><span class="o">(</span><span class="s">&quot;book&quot;</span><span class="o">);</span>
<span class="n">book</span><span class="o">.</span><span class="na">print</span><span class="o">(</span><span class="n">media</span><span class="o">);</span>
<span class="n">JsonObject</span> <span class="n">json</span> <span class="o">=</span> <span class="n">media</span><span class="o">.</span><span class="na">json</span><span class="o">();</span></code></pre></figure><p>Voilà! The JSON object is ready and the book has no idea about what exactly what printed just now. We need to print the book to XML? We create <code>XmlMedia</code>, which will print the book to XML. The <code>Book</code> class stays small, while the complexity of &quot;media&quot; objects is unlimited.</p><p>My point here is simple---no <a href="/2014/09/16/getters-and-setters-are-evil.html">getters</a>, just printers!</p></div></article></div><div class="wrapper"> <related-posts /></div><div class="disqus" role="complementary"><p class="disqus_hint"> Please, use <a href="https://help.disqus.com/commenting/what-html-tags-are-allowed-within-comments">syntax highlighting</a> in your comments, to make them more readable.</p><div id="disqus_thread" class="disqus-thread"> <a>&nbsp;</a></div><script> var disqus_config = function () { this.page.url = document.location.href.split('?')[0].split('#')[0].replace('https://', 'http://'); this.page.identifier = this.page.url; }; (function() { var d = document, s = d.createElement('script'); s.src = '//yegor256.disqus.com/embed.js'; s.setAttribute('data-timestamp', +new Date()); (d.head || d.body).appendChild(s); })(); </script> <noscript><div><p class="red"> JavaScript is disabled in your browser, that's why you can't see comments under this post.</p></div></noscript></div><div class="wrapper"> <footer class="footer"><p> &copy; <span itemscope="" itemprop="copyrightHolder" itemtype="http://schema.org/Person"> <span itemprop="name">Yegor Bugayenko</span> </span> 2014&ndash;<span itemprop="copyrightYear">2018</span></p></footer></div></section><div class="wrapper unprintable" style="text-align:center;margin-top:2em;"> <a href="http://www.sixnines.io/h/3ba1652f"> <img src="//www.sixnines.io/b/3ba1652f?style=flat" alt="sixnines availability badge"/> </a></div><script src="//code.jquery.com/jquery-1.9.0.min.js"></script> <script src="/js/all.js?4e047f6f42b"></script> <script>var disqus_shortname = 'yegor256';</script> <script id="dsq-count-scr" src="//yegor256.disqus.com/count.js" async="async"></script> <script> (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){ (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o), m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m) })(window,document,'script','//www.google-analytics.com/analytics.js','ga'); ga('create', 'UA-1963507-32', 'auto'); ga('send', 'pageview'); </script> <script> Cd=document;Cr="&"+Math.random();Cp="&s=1"; Cd.cookie="b=b";if(Cd.cookie)Cp+="&c=1"; Cp+="&t="+(new Date()).getTimezoneOffset(); if(self!=top)Cp+="&f=1"; </script> <script> if(navigator.javaEnabled())Cp+="&j=1"; </script> <script> if(typeof(screen)!='undefined')Cp+="&w="+screen.width+"&h="+ screen.height+"&d="+(screen.colorDepth?screen.colorDepth:screen.pixelDepth); </script> <script> Cd.write("<img src='//c.hit.ua/hit?i=95870&g=0&x=2"+Cp+Cr+ "&r="+escape(Cd.referrer)+"&u="+escape(window.location.href)+ "' border='0' wi"+"dth='1' he"+"ight='1'/>"); </script> <script type="application/ld+json"> { "@context": "http://schema.org", "@type": "Person", "name": "Yegor Bugayenko", "url": "http://www.yegor256.com", "sameAs": [ "https://www.facebook.com/yegor256", "https://instagram.com/yegor256", "https://www.linkedin.com/in/yegor256", "https://twitter.com/yegor256", "https://github.com/yegor256", "https://www.pinterest.com/yegor256/" ] } </script> </body> </html> <!DOCTYPE html> <html xmlns="http://www.w3.org/1999/xhtml" lang="en-US" xml:lang="en-US" itemscope="" itemtype="http://schema.org/WebSite"> <head> <meta charset="utf-8"/> <meta name="description" content="Opening a resource inside a try/catch block and then finally checking for null is such a typical and annoying mistake. " /> <meta name="keywords" content="close stream java, java close stream in finally, java close stream try catch, java finally, java try catch" /> <meta name="viewport" content="width=device-width,minimum-scale=1,initial-scale=1"/> <meta name="google-site-verification" content="JEj_gQr2CPe2QKGw8XdMz0R7VboQIUbX3FlM-lwTq-8" /> <meta name="author" content="Yegor Bugayenko"> <meta name="article:published_time" content="2016-03-22 00:00:00 +0000"> <meta name="og:site_name" content="Yegor Bugayenko"/> <meta name="og:type" content="article" /> <meta name="og:locale" content="en_US" /> <meta name="twitter:account_id" content="4503599630178231" /> <meta name="twitter:creator" content="@yegor256"/> <meta name="twitter:site" content="@yegor256"/> <meta name="twitter:title" property="og:title" content="Try. Finally. If. Not. Null."/> <meta name="twitter:description" property="og:description" content="Opening a resource inside a try/catch block and then finally checking for null is such a typical and annoying mistake. "/> <meta name="twitter:url" property="og:url" content="https://www.yegor256.com/2016/03/22/try-finally-if-not-null.html"/> <meta name="telegram:channel" content="AAAAAEJFMRzsRTRxM3ec6A"/> <link rel="search" type="application/opensearchdescription+xml" href="/opensearch.xml" title="yegor256" /> <link rel="shortcut icon" href="/favicon.ico?4e047f6f42b"/> <link rel="apple-touch-icon" href="/favicon.ico?4e047f6f42b"/> <link rel="alternate" type="application/rss+xml" title="RSS for yegor256.com" href="https://www.yegor256.com/rss.xml"/> <link rel="stylesheet" href="/css/layout.css?4e047f6f42b"/> <link rel="stylesheet" href="/css/icons.css?4e047f6f42b"/> <link rel="canonical" href="https://www.yegor256.com/2016/03/22/try-finally-if-not-null.html" /> <link rel="amphtml" href="https://www.yegor256.com/2016/03/22/try-finally-if-not-null.amp.html" /> <title>Try. Finally. If. Not. Null. </title> <meta name='og:image' content='https://www.yegor256.com/images/2016/03/lock-stock-two-smoking-barrels.jpg'/><meta name='twitter:image' content='https://www.yegor256.com/images/2016/03/lock-stock-two-smoking-barrels.jpg'/><meta name='og:image:width' content='1200'/> <meta name='twitter:image:width' content='1200'/><meta name='og:image:height' content='675'/> <meta name='twitter:image:height' content='675'/><meta name='twitter:card' content='summary_large_image'/><meta name='twitter:image:alt' content='Lock, Stock and Two Smoking Barrels (1998) by Guy Ritchie'/> </head> <body><div class="wrapper"> <aside class="header-toggle unprintable" id="header-toggle" title="Show the menu" onclick="$('#header').show();$('#header-toggle').hide();">&#9776;</aside> <header class="header" id="header"><div class="face"> <a href="/about-me.html#form" class="sub" title="Click to subscribe to my monthly newsletter"><span>Subscribe</span></a> <a href="/about-me.html" style="position:relative;"> <img src="/images/face-256x256.jpg" class="photo" alt="Yegor Bugayenko"/> </a></div><nav><ul class="menu social notranslate"> <li><a href="https://twitter.com/intent/follow?screen_name=yegor256" rel="nofollow" title="Follow me on Twitter"><i class="icon icon-twitter notranslate" aria-hidden="true"></i></a></li> <li><a href="/rss.xml" rel="nofollow" title="Subscribe to my RSS feed"><i class="icon icon-rss notranslate" aria-hidden="true"></i></a></li> <li><a itemprop="sameAs" href="https://github.com/yegor256" rel="nofollow" title="My GitHub profile"><i class="icon icon-github notranslate" aria-hidden="true"></i></a></li> <li><a itemprop="sameAs" href="http://stackoverflow.com/users/187141/yegor256" rel="nofollow" title="My StackOverflow profile"><i class="icon icon-stackoverflow notranslate" aria-hidden="true"></i></a></li> <li><a itemprop="sameAs" href="https://www.facebook.com/yegor256" rel="nofollow" title="Follow me on Facebook"><i class="icon icon-facebook notranslate" aria-hidden="true"></i></a></li> <li><a itemprop="sameAs" href="https://instagram.com/yegor256" rel="nofollow" title="Follow me on Instagram"><i class="icon icon-instagram notranslate" aria-hidden="true"></i></a></li> <li><a itemprop="sameAs" href="https://www.linkedin.com/in/yegor256" rel="nofollow" title="My LinkedIn profile"><i class="icon icon-linkedin notranslate" aria-hidden="true"></i></a></li> <li><a itemprop="sameAs" href="https://www.youtube.com/c/yegor256?sub_confirmation=1" rel="nofollow" title="My Youtube video channel"><i class="icon icon-youtube notranslate" aria-hidden="true"></i></a></li> <li><a itemprop="sameAs" href="https://www.pinterest.com/yegor256/" rel="nofollow" title="My Pinterest boards"><i class="icon icon-pinterest notranslate" aria-hidden="true"></i></a></li> <li><a itemprop="sameAs" href="https://angel.co/yegor256" rel="nofollow" title="My AngelList profile"><i class="icon icon-angellist notranslate" aria-hidden="true"></i></a></li> <li><a href="https://soundcloud.com/yegor256" rel="nofollow" title="My podcast"><i class="icon icon-podcast notranslate" aria-hidden="true"></i></a></li> <li><a href="https://itunes.apple.com/us/podcast/yegor256-podcast/id1150826721" rel="nofollow" title="My iTunes podcast"><i class="icon icon-itunes notranslate" aria-hidden="true"></i></a></li> <li><a href="https://t.me/joinchat/AAAAAEJFMRzsRTRxM3ec6A" rel="nofollow" title="My Telegram public channel"><i class="icon icon-telegram notranslate" aria-hidden="true"></i></a></li> <li><a href="mailto:blog@yegor256.com" rel="nofollow" title="Email me any time"><i class="icon icon-mail notranslate" aria-hidden="true"></i></a></li></ul><ul class="menu"> <li><a href="/" title="Home page">Home</a></li> <li ><a href="/best.html" title="Best articles to read">12&#160;Best</a></li> <li ><a href="/contents.html" title="The contents of the entire blog">All&#160;288</a></li> <li ><a href="/webinars.html" title="My webinars">Webinars</a></li> <li ><a href="/talks.html" title="Future and past conference talks">Talks</a></li> <li ><a href="/books.html" title="The books I wrote">Books</a></li> <li ><a href="/papers.html" title="My academic papers and patents">Papers</a></li> <li ><a href="/pets.html" title="My loved pet projects">Pets</a></li> <li ><a href="/award.html" title="Software quality award">Award</a></li> <li ><a href="/testimonials.html" title="What some people say about me">Testimonials</a></li> <li ><a href="/shift-m.html" title="Audio podcast about project management">Shift-M</a></li> <li ><a href="/paintings.html" title="My paintings for sale">Paintings</a></li> <li><a href="http://ru.yegor256.com/" title="Немного на русском языке">По-русски</a></li></ul></nav><div class="search"> <form method="get" action="https://www.google.com/search" itemprop="potentialAction" itemscope="" itemtype="http://schema.org/SearchAction"> <meta itemprop="target" content="https://www.google.com/search?q={q}"/> <input name="sitesearch" value="yegor256.com" type="hidden"/> <input itemprop="query-input" type="text" id="search-query" class="field field-text" required="required" onfocus="$('.google').css('visibility', 'visible');" name="q" placeholder="Search..." autocomplete="off"/> <input type="image" src="/images/google-search-icon.svg" class="google" title="Search via Google" alt="Search via Google"/> </form></div><div class="hot"><ul> <li> <a href="/code-ahead.html">Code Ahead</a> was published on Amazon just a few days ago! It is my new book, a novel about programmers. It explains in details the majority of ideas that stand behind <a href="https://www.zerocracy.com">Zerocracy</a> and <a href="https://www.xdsd.org">XDSD</a>. </li> <li> At <a href="/webinars.html">Webinar #37</a> we will discuss naming problem in OOP, for objects, methods and attributes; join us on <b>September 12</b>, at 11am PST. </li></ul></div></header></div><section itemscope="" itemtype="http://schema.org/BlogPosting"><div class="wrapper"> <header><p class="printable"> <img src="https://api.qrserver.com/v1/create-qr-code/?data=https://www.yegor256.com/2016/03/22/try-finally-if-not-null.html&amp;format=svg" style="width:125px;height:125px;" alt="QR code"/></p><p class="printable"> <code itemprop="url">https://www.yegor256.com/2016/03/22/try-finally-if-not-null.html</code></p><h1 itemprop="name headline mainEntityOfPage">Try. Finally. If. Not. Null.</h1><aside class='book'><a href='http://amzn.to/2qFt4Tn'><img src='/images/books/elegant-objects/cover.png' class='book-cover' alt='book cover'/></a>Read more about this subject in <a href='http://amzn.to/2qFt4Tn'>Section&nbsp;2.6</a><br/> of my book<a href='http://amzn.to/2qFt4Tn'><img src='/images/books/amazon-buy-button.png' class='amazon-button' alt='Click to buy'/></a></aside><ul class="subline"> <li> <time itemprop="datePublished" datetime="2016-03-22T00:00:00+00:00"> 22 March 2016 </time> </li> <li class="desktop-only" itemprop="locationCreated">Palo Alto, CA</li> <li class="printable" itemscope="" itemprop="author" itemtype="http://schema.org/Person"> <span itemprop="name">Yegor Bugayenko</span> </li> <li class="unprintable"> <i class="icon icon-comments"></i> <a href="http://www.yegor256.com/2016/03/22/try-finally-if-not-null.html#disqus_thread" itemprop="discussionUrl">comments</a> </li></ul><figure class='jb_picture'><img itemprop='image' alt='Lock, Stock and Two Smoking Barrels (1998) by Guy Ritchie' src='/images/2016/03/lock-stock-two-smoking-barrels.jpg' longdesc='#118d4d8e'/><figcaption id='118d4d8e'>Lock, Stock and Two Smoking Barrels (1998) by Guy Ritchie</figcaption></figure><p>This is how it looks (assuming we are in Java 6):</p><figure class="highlight"><pre><code class="language-java" data-lang="java"><span></span><span class="n">InputStream</span> <span class="n">input</span> <span class="o">=</span> <span class="kc">null</span><span class="o">;</span>
<span class="k">try</span> <span class="o">{</span>
  <span class="n">input</span> <span class="o">=</span> <span class="n">url</span><span class="o">.</span><span class="na">openStream</span><span class="o">();</span>
  <span class="c1">// reads the stream, throws IOException</span>
<span class="o">}</span> <span class="k">catch</span> <span class="o">(</span><span class="n">IOException</span> <span class="n">ex</span><span class="o">)</span> <span class="o">{</span>
  <span class="k">throw</span> <span class="k">new</span> <span class="n">RuntimeException</span><span class="o">(</span><span class="n">ex</span><span class="o">);</span>
<span class="o">}</span> <span class="k">finally</span> <span class="o">{</span>
  <span class="k">if</span> <span class="o">(</span><span class="n">input</span> <span class="o">!=</span> <span class="kc">null</span><span class="o">)</span> <span class="o">{</span>
    <span class="n">input</span><span class="o">.</span><span class="na">close</span><span class="o">();</span>
  <span class="o">}</span>
<span class="o">}</span></code></pre></figure> <aside class='youtube'> <a href='https://www.youtube.com/watch?v=o3aNJX7AP3M'><div class='box'> <img src='https://i.ytimg.com/vi/o3aNJX7AP3M/mqdefault.jpg' alt='YouTube video #o3aNJX7AP3M'/><div class='play'><i class='icon icon-play'></i></div></div></a><div>What is Wrong About NULL in OOP? (webinar #3); 3 June 2015.</div></aside><p>I already wrote about <a href="/2014/05/13/why-null-is-bad.html"><code>null</code></a> and its evil nature. Here it comes again. If you just follow the rule of &quot;not using NULL anywhere ever,&quot; this code would need an immediate refactoring. Its correct version will look like this:</p><figure class="highlight"><pre><code class="language-java" data-lang="java"><span></span><span class="kd">final</span> <span class="n">InputStream</span> <span class="n">input</span> <span class="o">=</span> <span class="n">url</span><span class="o">.</span><span class="na">openStream</span><span class="o">();</span>
<span class="k">try</span> <span class="o">{</span>
  <span class="c1">// reads the stream, throws IOException</span>
<span class="o">}</span> <span class="k">catch</span> <span class="o">(</span><span class="n">IOException</span> <span class="n">ex</span><span class="o">)</span> <span class="o">{</span>
  <span class="k">throw</span> <span class="k">new</span> <span class="n">RuntimeException</span><span class="o">(</span><span class="n">ex</span><span class="o">);</span>
<span class="o">}</span> <span class="k">finally</span> <span class="o">{</span>
  <span class="n">input</span><span class="o">.</span><span class="na">close</span><span class="o">();</span>
<span class="o">}</span></code></pre></figure><p>There is no <code>null</code> anymore and it&#39;s very clean. Isn&#39;t it?</p><p>There are situations when opening the resource itself throws <code>IOException</code> and we can&#39;t put it outside of <code>try/catch</code>. In that case, we have to have <strong>two</strong> <code>try/catch</code> blocks:</p><figure class="highlight"><pre><code class="language-java" data-lang="java"><span></span><span class="kd">final</span> <span class="n">InputStream</span> <span class="n">input</span><span class="o">;</span>
<span class="k">try</span> <span class="o">{</span>
  <span class="n">input</span> <span class="o">=</span> <span class="n">url</span><span class="o">.</span><span class="na">openStream</span><span class="o">();</span>
<span class="o">}</span> <span class="k">catch</span> <span class="o">(</span><span class="n">IOException</span> <span class="n">ex</span><span class="o">)</span> <span class="o">{</span>
  <span class="k">throw</span> <span class="k">new</span> <span class="n">RuntimeException</span><span class="o">(</span><span class="n">ex</span><span class="o">);</span>
<span class="o">}</span>
<span class="k">try</span> <span class="o">{</span>
  <span class="c1">// reads the stream, throws IOException</span>
<span class="o">}</span> <span class="k">catch</span> <span class="o">(</span><span class="n">IOException</span> <span class="n">ex</span><span class="o">)</span> <span class="o">{</span>
  <span class="k">throw</span> <span class="k">new</span> <span class="n">RuntimeException</span><span class="o">(</span><span class="n">ex</span><span class="o">);</span>
<span class="o">}</span> <span class="k">finally</span> <span class="o">{</span>
  <span class="n">input</span><span class="o">.</span><span class="na">close</span><span class="o">();</span>
<span class="o">}</span></code></pre></figure><p>But there should be no <code>null</code>, never!</p><p>The presence of <code>null</code> in Java code is a clear indicator of code smell. Something is not right if you have to use <code>null</code>. The only place where the presence of <code>null</code> is justified is where we&#39;re using third-party APIs or JDK. They may return <code>null</code> sometimes because... well, their design is bad. We have no other option but to do <code>if(x==null)</code>. But that&#39;s it. No other places are good for <code>null</code>.</p></p>--> <nav class="buttons notranslate desktop-only"> <a href="http://www.facebook.com/sharer/sharer.php?u=https://www.yegor256.com/2016/03/22/try-finally-if-not-null.html" title="Share on Facebook" class="button" rel="nofollow"> <span class="count count-facebook">0</span> <i class="icon icon-facebook notranslate" aria-hidden="true"></i> </a> <a href="https://twitter.com/share?url=https://www.yegor256.com/2016/03/22/try-finally-if-not-null.html&amp;text=Try.+Finally.+If.+Not.+Null." title="Share on Twitter" class="button" rel="nofollow"> <span class="count count-twitter">0</span> <i class="icon icon-twitter notranslate" aria-hidden="true"></i> </a> <a href="https://plus.google.com/share?url=https://www.yegor256.com/2016/03/22/try-finally-if-not-null.html" title="Share on Google+" class="button" rel="nofollow"> <span class="count count-googleplus">0</span> <i class="icon icon-googleplus notranslate" aria-hidden="true"></i> </a> <a href="https://www.linkedin.com/cws/share?url=https://www.yegor256.com/2016/03/22/try-finally-if-not-null.html" title="Share on LinkedIn" class="button" rel="nofollow"> <span class="count count-linkedin">0</span> <i class="icon icon-linkedin notranslate" aria-hidden="true"></i> </a> <a href="http://reddit.com/submit?url=https://www.yegor256.com/2016/03/22/try-finally-if-not-null.html%3F2016-12&amp;title=Try.+Finally.+If.+Not.+Null." title="Share on Reddit" class="button" rel="nofollow"> <span class="count count-reddit">0</span> <i class="icon icon-reddit notranslate" aria-hidden="true"></i> </a> <a href="http://news.ycombinator.com/submitlink?u=https://www.yegor256.com/2016/03/22/try-finally-if-not-null.html%3F2016-12&amp;t=Try.+Finally.+If.+Not.+Null." title="Share on Hacker News" class="button" rel="nofollow"> <span class="count count-hackernews">0</span> <i class="icon icon-hackernews notranslate" aria-hidden="true"></i> </a> </nav> </header> <article class="main" itemprop="articleBody"><div ><p>There is a very typical mistake in pre-Java7 &quot;try/finally&quot; scenario, which I keep seeing in so many code reviews. I just have to write about it. Java7 introduced a solution, but it doesn&#39;t cover all situations. Sometimes we need to deal with non-<code>AutoCloseable</code> resources. Let&#39;s open and close them correctly, please.</p><figure class='jb_picture'><img itemprop='image' alt='Lock, Stock and Two Smoking Barrels (1998) by Guy Ritchie' src='/images/2016/03/lock-stock-two-smoking-barrels.jpg' longdesc='#118d4d8e'/><figcaption id='118d4d8e'>Lock, Stock and Two Smoking Barrels (1998) by Guy Ritchie</figcaption></figure><p>This is how it looks (assuming we are in Java 6):</p><figure class="highlight"><pre><code class="language-java" data-lang="java"><span></span><span class="n">InputStream</span> <span class="n">input</span> <span class="o">=</span> <span class="kc">null</span><span class="o">;</span>
<span class="k">try</span> <span class="o">{</span>
  <span class="n">input</span> <span class="o">=</span> <span class="n">url</span><span class="o">.</span><span class="na">openStream</span><span class="o">();</span>
  <span class="c1">// reads the stream, throws IOException</span>
<span class="o">}</span> <span class="k">catch</span> <span class="o">(</span><span class="n">IOException</span> <span class="n">ex</span><span class="o">)</span> <span class="o">{</span>
  <span class="k">throw</span> <span class="k">new</span> <span class="n">RuntimeException</span><span class="o">(</span><span class="n">ex</span><span class="o">);</span>
<span class="o">}</span> <span class="k">finally</span> <span class="o">{</span>
  <span class="k">if</span> <span class="o">(</span><span class="n">input</span> <span class="o">!=</span> <span class="kc">null</span><span class="o">)</span> <span class="o">{</span>
    <span class="n">input</span><span class="o">.</span><span class="na">close</span><span class="o">();</span>
  <span class="o">}</span>
<span class="o">}</span></code></pre></figure> <aside class='youtube'> <a href='https://www.youtube.com/watch?v=o3aNJX7AP3M'><div class='box'> <img src='https://i.ytimg.com/vi/o3aNJX7AP3M/mqdefault.jpg' alt='YouTube video #o3aNJX7AP3M'/><div class='play'><i class='icon icon-play'></i></div></div></a><div>What is Wrong About NULL in OOP? (webinar #3); 3 June 2015.</div></aside><p>I already wrote about <a href="/2014/05/13/why-null-is-bad.html"><code>null</code></a> and its evil nature. Here it comes again. If you just follow the rule of &quot;not using NULL anywhere ever,&quot; this code would need an immediate refactoring. Its correct version will look like this:</p><figure class="highlight"><pre><code class="language-java" data-lang="java"><span></span><span class="kd">final</span> <span class="n">InputStream</span> <span class="n">input</span> <span class="o">=</span> <span class="n">url</span><span class="o">.</span><span class="na">openStream</span><span class="o">();</span>
<span class="k">try</span> <span class="o">{</span>
  <span class="c1">// reads the stream, throws IOException</span>
<span class="o">}</span> <span class="k">catch</span> <span class="o">(</span><span class="n">IOException</span> <span class="n">ex</span><span class="o">)</span> <span class="o">{</span>
  <span class="k">throw</span> <span class="k">new</span> <span class="n">RuntimeException</span><span class="o">(</span><span class="n">ex</span><span class="o">);</span>
<span class="o">}</span> <span class="k">finally</span> <span class="o">{</span>
  <span class="n">input</span><span class="o">.</span><span class="na">close</span><span class="o">();</span>
<span class="o">}</span></code></pre></figure><p>There is no <code>null</code> anymore and it&#39;s very clean. Isn&#39;t it?</p><p>There are situations when opening the resource itself throws <code>IOException</code> and we can&#39;t put it outside of <code>try/catch</code>. In that case, we have to have <strong>two</strong> <code>try/catch</code> blocks:</p><figure class="highlight"><pre><code class="language-java" data-lang="java"><span></span><span class="kd">final</span> <span class="n">InputStream</span> <span class="n">input</span><span class="o">;</span>
<span class="k">try</span> <span class="o">{</span>
  <span class="n">input</span> <span class="o">=</span> <span class="n">url</span><span class="o">.</span><span class="na">openStream</span><span class="o">();</span>
<span class="o">}</span> <span class="k">catch</span> <span class="o">(</span><span class="n">IOException</span> <span class="n">ex</span><span class="o">)</span> <span class="o">{</span>
  <span class="k">throw</span> <span class="k">new</span> <span class="n">RuntimeException</span><span class="o">(</span><span class="n">ex</span><span class="o">);</span>
<span class="o">}</span>
<span class="k">try</span> <span class="o">{</span>
  <span class="c1">// reads the stream, throws IOException</span>
<span class="o">}</span> <span class="k">catch</span> <span class="o">(</span><span class="n">IOException</span> <span class="n">ex</span><span class="o">)</span> <span class="o">{</span>
  <span class="k">throw</span> <span class="k">new</span> <span class="n">RuntimeException</span><span class="o">(</span><span class="n">ex</span><span class="o">);</span>
<span class="o">}</span> <span class="k">finally</span> <span class="o">{</span>
  <span class="n">input</span><span class="o">.</span><span class="na">close</span><span class="o">();</span>
<span class="o">}</span></code></pre></figure><p>But there should be no <code>null</code>, never!</p><p>The presence of <code>null</code> in Java code is a clear indicator of code smell. Something is not right if you have to use <code>null</code>. The only place where the presence of <code>null</code> is justified is where we&#39;re using third-party APIs or JDK. They may return <code>null</code> sometimes because... well, their design is bad. We have no other option but to do <code>if(x==null)</code>. But that&#39;s it. No other places are good for <code>null</code>.</p></div></article></div><div class="wrapper"> <related-posts /></div><div class="disqus" role="complementary"><p class="disqus_hint"> Please, use <a href="https://help.disqus.com/commenting/what-html-tags-are-allowed-within-comments">syntax highlighting</a> in your comments, to make them more readable.</p><div id="disqus_thread" class="disqus-thread"> <a>&nbsp;</a></div><script> var disqus_config = function () { this.page.url = document.location.href.split('?')[0].split('#')[0].replace('https://', 'http://'); this.page.identifier = this.page.url; }; (function() { var d = document, s = d.createElement('script'); s.src = '//yegor256.disqus.com/embed.js'; s.setAttribute('data-timestamp', +new Date()); (d.head || d.body).appendChild(s); })(); </script> <noscript><div><p class="red"> JavaScript is disabled in your browser, that's why you can't see comments under this post.</p></div></noscript></div><div class="wrapper"> <footer class="footer"><p> &copy; <span itemscope="" itemprop="copyrightHolder" itemtype="http://schema.org/Person"> <span itemprop="name">Yegor Bugayenko</span> </span> 2014&ndash;<span itemprop="copyrightYear">2018</span></p></footer></div></section><div class="wrapper unprintable" style="text-align:center;margin-top:2em;"> <a href="http://www.sixnines.io/h/3ba1652f"> <img src="//www.sixnines.io/b/3ba1652f?style=flat" alt="sixnines availability badge"/> </a></div><script src="//code.jquery.com/jquery-1.9.0.min.js"></script> <script src="/js/all.js?4e047f6f42b"></script> <script>var disqus_shortname = 'yegor256';</script> <script id="dsq-count-scr" src="//yegor256.disqus.com/count.js" async="async"></script> <script> (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){ (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o), m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m) })(window,document,'script','//www.google-analytics.com/analytics.js','ga'); ga('create', 'UA-1963507-32', 'auto'); ga('send', 'pageview'); </script> <script> Cd=document;Cr="&"+Math.random();Cp="&s=1"; Cd.cookie="b=b";if(Cd.cookie)Cp+="&c=1"; Cp+="&t="+(new Date()).getTimezoneOffset(); if(self!=top)Cp+="&f=1"; </script> <script> if(navigator.javaEnabled())Cp+="&j=1"; </script> <script> if(typeof(screen)!='undefined')Cp+="&w="+screen.width+"&h="+ screen.height+"&d="+(screen.colorDepth?screen.colorDepth:screen.pixelDepth); </script> <script> Cd.write("<img src='//c.hit.ua/hit?i=95870&g=0&x=2"+Cp+Cr+ "&r="+escape(Cd.referrer)+"&u="+escape(window.location.href)+ "' border='0' wi"+"dth='1' he"+"ight='1'/>"); </script> <script type="application/ld+json"> { "@context": "http://schema.org", "@type": "Person", "name": "Yegor Bugayenko", "url": "http://www.yegor256.com", "sameAs": [ "https://www.facebook.com/yegor256", "https://instagram.com/yegor256", "https://www.linkedin.com/in/yegor256", "https://twitter.com/yegor256", "https://github.com/yegor256", "https://www.pinterest.com/yegor256/" ] } </script> </body> </html> <!DOCTYPE html> <html xmlns="http://www.w3.org/1999/xhtml" lang="en-US" xml:lang="en-US" itemscope="" itemtype="http://schema.org/WebSite"> <head> <meta charset="utf-8"/> <meta name="description" content="Sequential method calls inevitably mean temporal coupling, which is a bottleneck for effective refactoring; avoid them. " /> <meta name="keywords" content="temporal coupling, temporal coupling definition, temporal coupling hidden, temporal coupling in oop, temporal coupling java" /> <meta name="viewport" content="width=device-width,minimum-scale=1,initial-scale=1"/> <meta name="google-site-verification" content="JEj_gQr2CPe2QKGw8XdMz0R7VboQIUbX3FlM-lwTq-8" /> <meta name="author" content="Yegor Bugayenko"> <meta name="article:published_time" content="2015-12-08 00:00:00 +0000"> <meta name="og:site_name" content="Yegor Bugayenko"/> <meta name="og:type" content="article" /> <meta name="og:locale" content="en_US" /> <meta name="twitter:account_id" content="4503599630178231" /> <meta name="twitter:creator" content="@yegor256"/> <meta name="twitter:site" content="@yegor256"/> <meta name="twitter:title" property="og:title" content="Temporal Coupling Between Method Calls"/> <meta name="twitter:description" property="og:description" content="Sequential method calls inevitably mean temporal coupling, which is a bottleneck for effective refactoring; avoid them. "/> <meta name="twitter:url" property="og:url" content="https://www.yegor256.com/2015/12/08/temporal-coupling-between-method-calls.html"/> <meta name="telegram:channel" content="AAAAAEJFMRzsRTRxM3ec6A"/> <link rel="search" type="application/opensearchdescription+xml" href="/opensearch.xml" title="yegor256" /> <link rel="shortcut icon" href="/favicon.ico?4e047f6f42b"/> <link rel="apple-touch-icon" href="/favicon.ico?4e047f6f42b"/> <link rel="alternate" type="application/rss+xml" title="RSS for yegor256.com" href="https://www.yegor256.com/rss.xml"/> <link rel="stylesheet" href="/css/layout.css?4e047f6f42b"/> <link rel="stylesheet" href="/css/icons.css?4e047f6f42b"/> <link rel="canonical" href="https://www.yegor256.com/2015/12/08/temporal-coupling-between-method-calls.html" /> <link rel="amphtml" href="https://www.yegor256.com/2015/12/08/temporal-coupling-between-method-calls.amp.html" /> <title>Temporal Coupling Between Method Calls </title> <meta name='og:image' content='https://www.yegor256.com/images/2015/12/blueberry.jpg'/><meta name='twitter:image' content='https://www.yegor256.com/images/2015/12/blueberry.jpg'/><meta name='og:image:width' content='1200'/> <meta name='twitter:image:width' content='1200'/><meta name='og:image:height' content='675'/> <meta name='twitter:image:height' content='675'/><meta name='twitter:card' content='summary_large_image'/><meta name='twitter:image:alt' content='Blueberry (2004) by Jan Kounen'/> </head> <body><div class="wrapper"> <aside class="header-toggle unprintable" id="header-toggle" title="Show the menu" onclick="$('#header').show();$('#header-toggle').hide();">&#9776;</aside> <header class="header" id="header"><div class="face"> <a href="/about-me.html#form" class="sub" title="Click to subscribe to my monthly newsletter"><span>Subscribe</span></a> <a href="/about-me.html" style="position:relative;"> <img src="/images/face-256x256.jpg" class="photo" alt="Yegor Bugayenko"/> </a></div><nav><ul class="menu social notranslate"> <li><a href="https://twitter.com/intent/follow?screen_name=yegor256" rel="nofollow" title="Follow me on Twitter"><i class="icon icon-twitter notranslate" aria-hidden="true"></i></a></li> <li><a href="/rss.xml" rel="nofollow" title="Subscribe to my RSS feed"><i class="icon icon-rss notranslate" aria-hidden="true"></i></a></li> <li><a itemprop="sameAs" href="https://github.com/yegor256" rel="nofollow" title="My GitHub profile"><i class="icon icon-github notranslate" aria-hidden="true"></i></a></li> <li><a itemprop="sameAs" href="http://stackoverflow.com/users/187141/yegor256" rel="nofollow" title="My StackOverflow profile"><i class="icon icon-stackoverflow notranslate" aria-hidden="true"></i></a></li> <li><a itemprop="sameAs" href="https://www.facebook.com/yegor256" rel="nofollow" title="Follow me on Facebook"><i class="icon icon-facebook notranslate" aria-hidden="true"></i></a></li> <li><a itemprop="sameAs" href="https://instagram.com/yegor256" rel="nofollow" title="Follow me on Instagram"><i class="icon icon-instagram notranslate" aria-hidden="true"></i></a></li> <li><a itemprop="sameAs" href="https://www.linkedin.com/in/yegor256" rel="nofollow" title="My LinkedIn profile"><i class="icon icon-linkedin notranslate" aria-hidden="true"></i></a></li> <li><a itemprop="sameAs" href="https://www.youtube.com/c/yegor256?sub_confirmation=1" rel="nofollow" title="My Youtube video channel"><i class="icon icon-youtube notranslate" aria-hidden="true"></i></a></li> <li><a itemprop="sameAs" href="https://www.pinterest.com/yegor256/" rel="nofollow" title="My Pinterest boards"><i class="icon icon-pinterest notranslate" aria-hidden="true"></i></a></li> <li><a itemprop="sameAs" href="https://angel.co/yegor256" rel="nofollow" title="My AngelList profile"><i class="icon icon-angellist notranslate" aria-hidden="true"></i></a></li> <li><a href="https://soundcloud.com/yegor256" rel="nofollow" title="My podcast"><i class="icon icon-podcast notranslate" aria-hidden="true"></i></a></li> <li><a href="https://itunes.apple.com/us/podcast/yegor256-podcast/id1150826721" rel="nofollow" title="My iTunes podcast"><i class="icon icon-itunes notranslate" aria-hidden="true"></i></a></li> <li><a href="https://t.me/joinchat/AAAAAEJFMRzsRTRxM3ec6A" rel="nofollow" title="My Telegram public channel"><i class="icon icon-telegram notranslate" aria-hidden="true"></i></a></li> <li><a href="mailto:blog@yegor256.com" rel="nofollow" title="Email me any time"><i class="icon icon-mail notranslate" aria-hidden="true"></i></a></li></ul><ul class="menu"> <li><a href="/" title="Home page">Home</a></li> <li ><a href="/best.html" title="Best articles to read">12&#160;Best</a></li> <li ><a href="/contents.html" title="The contents of the entire blog">All&#160;288</a></li> <li ><a href="/webinars.html" title="My webinars">Webinars</a></li> <li ><a href="/talks.html" title="Future and past conference talks">Talks</a></li> <li ><a href="/books.html" title="The books I wrote">Books</a></li> <li ><a href="/papers.html" title="My academic papers and patents">Papers</a></li> <li ><a href="/pets.html" title="My loved pet projects">Pets</a></li> <li ><a href="/award.html" title="Software quality award">Award</a></li> <li ><a href="/testimonials.html" title="What some people say about me">Testimonials</a></li> <li ><a href="/shift-m.html" title="Audio podcast about project management">Shift-M</a></li> <li ><a href="/paintings.html" title="My paintings for sale">Paintings</a></li> <li><a href="http://ru.yegor256.com/" title="Немного на русском языке">По-русски</a></li></ul></nav><div class="search"> <form method="get" action="https://www.google.com/search" itemprop="potentialAction" itemscope="" itemtype="http://schema.org/SearchAction"> <meta itemprop="target" content="https://www.google.com/search?q={q}"/> <input name="sitesearch" value="yegor256.com" type="hidden"/> <input itemprop="query-input" type="text" id="search-query" class="field field-text" required="required" onfocus="$('.google').css('visibility', 'visible');" name="q" placeholder="Search..." autocomplete="off"/> <input type="image" src="/images/google-search-icon.svg" class="google" title="Search via Google" alt="Search via Google"/> </form></div><div class="hot"><ul> <li> <a href="/code-ahead.html">Code Ahead</a> was published on Amazon just a few days ago! It is my new book, a novel about programmers. It explains in details the majority of ideas that stand behind <a href="https://www.zerocracy.com">Zerocracy</a> and <a href="https://www.xdsd.org">XDSD</a>. </li> <li> At <a href="/webinars.html">Webinar #37</a> we will discuss naming problem in OOP, for objects, methods and attributes; join us on <b>September 12</b>, at 11am PST. </li></ul></div></header></div><section itemscope="" itemtype="http://schema.org/BlogPosting"><div class="wrapper"> <header><p class="printable"> <img src="https://api.qrserver.com/v1/create-qr-code/?data=https://www.yegor256.com/2015/12/08/temporal-coupling-between-method-calls.html&amp;format=svg" style="width:125px;height:125px;" alt="QR code"/></p><p class="printable"> <code itemprop="url">https://www.yegor256.com/2015/12/08/temporal-coupling-between-method-calls.html</code></p><h1 itemprop="name headline mainEntityOfPage">Temporal Coupling Between Method Calls</h1><aside class='book'><a href='http://amzn.to/2pyceWc'><img src='/images/books/elegant-objects/cover.png' class='book-cover' alt='book cover'/></a>Read more about this subject in <a href='http://amzn.to/2pyceWc'>Section&nbsp;5.6</a><br/> of my book<a href='http://amzn.to/2pyceWc'><img src='/images/books/amazon-buy-button.png' class='amazon-button' alt='Click to buy'/></a></aside><ul class="subline"> <li> <time itemprop="datePublished" datetime="2015-12-08T00:00:00+00:00"> 8 December 2015 </time> </li> <li class="desktop-only" itemprop="locationCreated">Kiev, Ukraine</li> <li class="printable" itemscope="" itemprop="author" itemtype="http://schema.org/Person"> <span itemprop="name">Yegor Bugayenko</span> </li> <li class="unprintable"> <i class="icon icon-comments"></i> <a href="http://www.yegor256.com/2015/12/08/temporal-coupling-between-method-calls.html#disqus_thread" itemprop="discussionUrl">comments</a> </li></ul><figure class='jb_picture'><img itemprop='image' alt='Blueberry (2004) by Jan Kounen' src='/images/2015/12/blueberry.jpg' longdesc='#17ff3e16'/><figcaption id='17ff3e16'>Blueberry (2004) by Jan Kounen</figcaption></figure><p>Here is the code:</p><figure class="highlight"><pre><code class="language-java" data-lang="java"><span></span><span class="kd">class</span> <span class="nc">Foo</span> <span class="o">{</span>
  <span class="kd">public</span> <span class="n">List</span><span class="o">&lt;</span><span class="n">String</span><span class="o">&gt;</span> <span class="nf">names</span><span class="o">()</span> <span class="o">{</span>
    <span class="n">List</span><span class="o">&lt;</span><span class="n">String</span><span class="o">&gt;</span> <span class="n">list</span> <span class="o">=</span> <span class="k">new</span> <span class="n">LinkedList</span><span class="o">();</span>
    <span class="n">Foo</span><span class="o">.</span><span class="na">append</span><span class="o">(</span><span class="n">list</span><span class="o">,</span> <span class="s">&quot;Jeff&quot;</span><span class="o">);</span>
    <span class="n">Foo</span><span class="o">.</span><span class="na">append</span><span class="o">(</span><span class="n">list</span><span class="o">,</span> <span class="s">&quot;Walter&quot;</span><span class="o">);</span>
    <span class="k">return</span> <span class="n">list</span><span class="o">;</span>
  <span class="o">}</span>
  <span class="kd">private</span> <span class="kd">static</span> <span class="kt">void</span> <span class="nf">append</span><span class="o">(</span>
    <span class="n">List</span><span class="o">&lt;</span><span class="n">String</span><span class="o">&gt;</span> <span class="n">list</span><span class="o">,</span> <span class="n">String</span> <span class="n">item</span><span class="o">)</span> <span class="o">{</span>
    <span class="n">list</span><span class="o">.</span><span class="na">add</span><span class="o">(</span><span class="n">item</span><span class="o">.</span><span class="na">toLowerCase</span><span class="o">());</span>
  <span class="o">}</span>
<span class="o">}</span></code></pre></figure><p>What do you think about that? I believe it&#39;s clear what <code>names()</code> is doing---creating a list of names. In order to avoid duplication, there is a supplementary <em>procedure</em>, <code>append()</code>, which converts an item to lowercase and adds it to the list.</p><p>This is poor design.</p><p>It is a <strong>procedural</strong> design, and there is <strong>temporal coupling</strong> between lines in method <code>names()</code>.</p><p>Let me first show you a better (though not the best!) design, then I will try to explain its benefits:</p><figure class="highlight"><pre><code class="language-java" data-lang="java"><span></span><span class="kd">class</span> <span class="nc">Foo</span> <span class="o">{</span>
  <span class="kd">public</span> <span class="n">List</span><span class="o">&lt;</span><span class="n">String</span><span class="o">&gt;</span> <span class="nf">names</span><span class="o">()</span> <span class="o">{</span>
    <span class="k">return</span> <span class="n">Foo</span><span class="o">.</span><span class="na">with</span><span class="o">(</span>
      <span class="n">Foo</span><span class="o">.</span><span class="na">with</span><span class="o">(</span>
        <span class="k">new</span> <span class="n">LinkedList</span><span class="o">(),</span>
        <span class="s">&quot;Jeff&quot;</span>
      <span class="o">),</span>
      <span class="s">&quot;Walter&quot;</span>
    <span class="o">);</span>
  <span class="o">}</span>
  <span class="kd">private</span> <span class="kd">static</span> <span class="n">List</span><span class="o">&lt;</span><span class="n">String</span><span class="o">&gt;</span> <span class="nf">with</span><span class="o">(</span>
    <span class="n">List</span><span class="o">&lt;</span><span class="n">String</span><span class="o">&gt;</span> <span class="n">list</span><span class="o">,</span> <span class="n">String</span> <span class="n">item</span><span class="o">)</span> <span class="o">{</span>
    <span class="n">list</span><span class="o">.</span><span class="na">add</span><span class="o">(</span><span class="n">item</span><span class="o">.</span><span class="na">toLowerCase</span><span class="o">());</span>
    <span class="k">return</span> <span class="n">list</span><span class="o">;</span>
  <span class="o">}</span>
<span class="o">}</span></code></pre></figure><p>An ideal design for method <code>with()</code> would create a new instance of <code>List</code>, populate it through <code>addAll(list)</code>, then <code>add(item)</code> to it, and finally return. That would be perfectly <a href="http://www.yegor256.com/2014/06/09/objects-should-be-immutable.html">immutable</a>, but slow.</p><p>So, what is wrong with this:</p><figure class="highlight"><pre><code class="language-java" data-lang="java"><span></span><span class="n">List</span><span class="o">&lt;</span><span class="n">String</span><span class="o">&gt;</span> <span class="n">list</span> <span class="o">=</span> <span class="k">new</span> <span class="n">LinkedList</span><span class="o">();</span>
<span class="n">Foo</span><span class="o">.</span><span class="na">append</span><span class="o">(</span><span class="n">list</span><span class="o">,</span> <span class="s">&quot;Jeff&quot;</span><span class="o">);</span>
<span class="n">Foo</span><span class="o">.</span><span class="na">append</span><span class="o">(</span><span class="n">list</span><span class="o">,</span> <span class="s">&quot;Walter&quot;</span><span class="o">);</span>
<span class="k">return</span> <span class="n">list</span><span class="o">;</span></code></pre></figure><p>It looks perfectly clean, doesn&#39;t it? Instantiate a list, append two items to it, and return it. Yes, it is clean---for now. Because we remember what <code>append()</code> is doing. In a few months, we&#39;ll get back to this code, and it will look like this:</p><figure class="highlight"><pre><code class="language-java" data-lang="java"><span></span><span class="n">List</span><span class="o">&lt;</span><span class="n">String</span><span class="o">&gt;</span> <span class="n">list</span> <span class="o">=</span> <span class="k">new</span> <span class="n">LinkedList</span><span class="o">();</span>
<span class="c1">// 10 more lines here</span>
<span class="n">Foo</span><span class="o">.</span><span class="na">append</span><span class="o">(</span><span class="n">list</span><span class="o">,</span> <span class="s">&quot;Jeff&quot;</span><span class="o">);</span>
<span class="n">Foo</span><span class="o">.</span><span class="na">append</span><span class="o">(</span><span class="n">list</span><span class="o">,</span> <span class="s">&quot;Walter&quot;</span><span class="o">);</span>
<span class="c1">// 10 more lines here</span>
<span class="k">return</span> <span class="n">list</span><span class="o">;</span></code></pre></figure><p>Is it so clear now that <code>append()</code> is actually adding <code>&quot;Jeff&quot;</code> to <code>list</code>? What will happen if I remove that line? Will it affect the result being returned in the last line? I don&#39;t know. I need to <strong>check</strong> the body of method <code>append()</code> to make sure.</p><p>Also, how about returning <code>list</code> first and calling <code>append()</code> afterwards? This is what possible &quot;refactoring&quot; may do to our code:</p><figure class="highlight"><pre><code class="language-java" data-lang="java"><span></span><span class="n">List</span><span class="o">&lt;</span><span class="n">String</span><span class="o">&gt;</span> <span class="n">list</span> <span class="o">=</span> <span class="k">new</span> <span class="n">LinkedList</span><span class="o">();</span>
<span class="k">if</span> <span class="o">(</span><span class="cm">/* something */</span><span class="o">)</span> <span class="o">{</span>
  <span class="k">return</span> <span class="n">list</span><span class="o">;</span>
<span class="o">}</span>
<span class="c1">// 10 more lines here</span>
<span class="n">Foo</span><span class="o">.</span><span class="na">append</span><span class="o">(</span><span class="n">list</span><span class="o">,</span> <span class="s">&quot;Walter&quot;</span><span class="o">);</span>
<span class="n">Foo</span><span class="o">.</span><span class="na">append</span><span class="o">(</span><span class="n">list</span><span class="o">,</span> <span class="s">&quot;Jeff&quot;</span><span class="o">);</span>
<span class="c1">// 10 more lines here</span>
<span class="k">return</span> <span class="n">list</span><span class="o">;</span></code></pre></figure><p>First of all, we return <code>list</code> too early, when it is not ready. But did anyone tell me that these two calls to <code>append()</code> must happen before <code>return list</code>? Second, we changed the order of <code>append()</code> calls. Again, did anyone tell me that it&#39;s important to call them in that particular order?</p><p>Nobody. Nowhere. This is called <strong>temporal coupling</strong>.</p><p>Our lines are <strong>coupled</strong> together. They must stay in this particular order, but the knowledge about that order is hidden. It&#39;s easy to destroy the order, and our compiler won&#39;t be able to catch us.</p><p>To the contrary, this design doesn&#39;t have any &quot;order&quot;:</p><figure class="highlight"><pre><code class="language-java" data-lang="java"><span></span><span class="k">return</span> <span class="n">Foo</span><span class="o">.</span><span class="na">with</span><span class="o">(</span>
  <span class="n">Foo</span><span class="o">.</span><span class="na">with</span><span class="o">(</span>
    <span class="k">new</span> <span class="n">LinkedList</span><span class="o">(),</span>
    <span class="s">&quot;Jeff&quot;</span>
  <span class="o">),</span>
  <span class="s">&quot;Walter&quot;</span>
<span class="o">);</span></code></pre></figure><p>It just <strong>returns</strong> a list, which is constructed by a few calls to the <code>with()</code> method. It is a single line instead of four.</p><p>As <a href="/2015/08/18/multiple-return-statements-in-oop.html">discussed before</a>, an ideal method in OOP must have just a single statement, and this statement is <code>return</code>.</p><p>The same is true about validation. For example, this code is bad:</p><figure class="highlight"><pre><code class="language-java" data-lang="java"><span></span><span class="n">list</span><span class="o">.</span><span class="na">add</span><span class="o">(</span><span class="s">&quot;Jeff&quot;</span><span class="o">);</span>
<span class="n">Foo</span><span class="o">.</span><span class="na">checkIfListStillHasSpace</span><span class="o">(</span><span class="n">list</span><span class="o">);</span>
<span class="n">list</span><span class="o">.</span><span class="na">add</span><span class="o">(</span><span class="s">&quot;Walter&quot;</span><span class="o">);</span></code></pre></figure><p>While this one is much better:</p><figure class="highlight"><pre><code class="language-java" data-lang="java"><span></span><span class="n">list</span><span class="o">.</span><span class="na">add</span><span class="o">(</span><span class="s">&quot;Jeff&quot;</span><span class="o">);</span>
<span class="n">Foo</span><span class="o">.</span><span class="na">withEnoughSpace</span><span class="o">(</span><span class="n">list</span><span class="o">).</span><span class="na">add</span><span class="o">(</span><span class="s">&quot;Walter&quot;</span><span class="o">);</span></code></pre></figure><p>See the difference?</p><p>And, of course, an ideal approach would be to use <a href="/2015/02/26/composable-decorators.html">composable decorators</a> instead of these ugly static methods. But if it&#39;s not possible for some reason, just don&#39;t make those static methods look like procedures. Make sure they always return results, which become arguments to further calls.</p></p>--> <nav class="buttons notranslate desktop-only"> <a href="http://www.facebook.com/sharer/sharer.php?u=https://www.yegor256.com/2015/12/08/temporal-coupling-between-method-calls.html" title="Share on Facebook" class="button" rel="nofollow"> <span class="count count-facebook">0</span> <i class="icon icon-facebook notranslate" aria-hidden="true"></i> </a> <a href="https://twitter.com/share?url=https://www.yegor256.com/2015/12/08/temporal-coupling-between-method-calls.html&amp;text=Temporal+Coupling+Between+Method+Calls" title="Share on Twitter" class="button" rel="nofollow"> <span class="count count-twitter">0</span> <i class="icon icon-twitter notranslate" aria-hidden="true"></i> </a> <a href="https://plus.google.com/share?url=https://www.yegor256.com/2015/12/08/temporal-coupling-between-method-calls.html" title="Share on Google+" class="button" rel="nofollow"> <span class="count count-googleplus">0</span> <i class="icon icon-googleplus notranslate" aria-hidden="true"></i> </a> <a href="https://www.linkedin.com/cws/share?url=https://www.yegor256.com/2015/12/08/temporal-coupling-between-method-calls.html" title="Share on LinkedIn" class="button" rel="nofollow"> <span class="count count-linkedin">0</span> <i class="icon icon-linkedin notranslate" aria-hidden="true"></i> </a> <a href="http://reddit.com/submit?url=https://www.yegor256.com/2015/12/08/temporal-coupling-between-method-calls.html%3F2015-49&amp;title=Temporal+Coupling+Between+Method+Calls" title="Share on Reddit" class="button" rel="nofollow"> <span class="count count-reddit">0</span> <i class="icon icon-reddit notranslate" aria-hidden="true"></i> </a> <a href="http://news.ycombinator.com/submitlink?u=https://www.yegor256.com/2015/12/08/temporal-coupling-between-method-calls.html%3F2015-49&amp;t=Temporal+Coupling+Between+Method+Calls" title="Share on Hacker News" class="button" rel="nofollow"> <span class="count count-hackernews">0</span> <i class="icon icon-hackernews notranslate" aria-hidden="true"></i> </a> </nav> </header> <article class="main" itemprop="articleBody"><div ><p>Temporal coupling happens between sequential method calls when they must stay in a particular order. This is inevitable in imperative programming, but we can reduce the negative effect of it just by turning those static procedures into functions. Take a look at this example.</p><figure class='jb_picture'><img itemprop='image' alt='Blueberry (2004) by Jan Kounen' src='/images/2015/12/blueberry.jpg' longdesc='#17ff3e16'/><figcaption id='17ff3e16'>Blueberry (2004) by Jan Kounen</figcaption></figure><p>Here is the code:</p><figure class="highlight"><pre><code class="language-java" data-lang="java"><span></span><span class="kd">class</span> <span class="nc">Foo</span> <span class="o">{</span>
  <span class="kd">public</span> <span class="n">List</span><span class="o">&lt;</span><span class="n">String</span><span class="o">&gt;</span> <span class="nf">names</span><span class="o">()</span> <span class="o">{</span>
    <span class="n">List</span><span class="o">&lt;</span><span class="n">String</span><span class="o">&gt;</span> <span class="n">list</span> <span class="o">=</span> <span class="k">new</span> <span class="n">LinkedList</span><span class="o">();</span>
    <span class="n">Foo</span><span class="o">.</span><span class="na">append</span><span class="o">(</span><span class="n">list</span><span class="o">,</span> <span class="s">&quot;Jeff&quot;</span><span class="o">);</span>
    <span class="n">Foo</span><span class="o">.</span><span class="na">append</span><span class="o">(</span><span class="n">list</span><span class="o">,</span> <span class="s">&quot;Walter&quot;</span><span class="o">);</span>
    <span class="k">return</span> <span class="n">list</span><span class="o">;</span>
  <span class="o">}</span>
  <span class="kd">private</span> <span class="kd">static</span> <span class="kt">void</span> <span class="nf">append</span><span class="o">(</span>
    <span class="n">List</span><span class="o">&lt;</span><span class="n">String</span><span class="o">&gt;</span> <span class="n">list</span><span class="o">,</span> <span class="n">String</span> <span class="n">item</span><span class="o">)</span> <span class="o">{</span>
    <span class="n">list</span><span class="o">.</span><span class="na">add</span><span class="o">(</span><span class="n">item</span><span class="o">.</span><span class="na">toLowerCase</span><span class="o">());</span>
  <span class="o">}</span>
<span class="o">}</span></code></pre></figure><p>What do you think about that? I believe it&#39;s clear what <code>names()</code> is doing---creating a list of names. In order to avoid duplication, there is a supplementary <em>procedure</em>, <code>append()</code>, which converts an item to lowercase and adds it to the list.</p><p>This is poor design.</p><p>It is a <strong>procedural</strong> design, and there is <strong>temporal coupling</strong> between lines in method <code>names()</code>.</p><p>Let me first show you a better (though not the best!) design, then I will try to explain its benefits:</p><figure class="highlight"><pre><code class="language-java" data-lang="java"><span></span><span class="kd">class</span> <span class="nc">Foo</span> <span class="o">{</span>
  <span class="kd">public</span> <span class="n">List</span><span class="o">&lt;</span><span class="n">String</span><span class="o">&gt;</span> <span class="nf">names</span><span class="o">()</span> <span class="o">{</span>
    <span class="k">return</span> <span class="n">Foo</span><span class="o">.</span><span class="na">with</span><span class="o">(</span>
      <span class="n">Foo</span><span class="o">.</span><span class="na">with</span><span class="o">(</span>
        <span class="k">new</span> <span class="n">LinkedList</span><span class="o">(),</span>
        <span class="s">&quot;Jeff&quot;</span>
      <span class="o">),</span>
      <span class="s">&quot;Walter&quot;</span>
    <span class="o">);</span>
  <span class="o">}</span>
  <span class="kd">private</span> <span class="kd">static</span> <span class="n">List</span><span class="o">&lt;</span><span class="n">String</span><span class="o">&gt;</span> <span class="nf">with</span><span class="o">(</span>
    <span class="n">List</span><span class="o">&lt;</span><span class="n">String</span><span class="o">&gt;</span> <span class="n">list</span><span class="o">,</span> <span class="n">String</span> <span class="n">item</span><span class="o">)</span> <span class="o">{</span>
    <span class="n">list</span><span class="o">.</span><span class="na">add</span><span class="o">(</span><span class="n">item</span><span class="o">.</span><span class="na">toLowerCase</span><span class="o">());</span>
    <span class="k">return</span> <span class="n">list</span><span class="o">;</span>
  <span class="o">}</span>
<span class="o">}</span></code></pre></figure><p>An ideal design for method <code>with()</code> would create a new instance of <code>List</code>, populate it through <code>addAll(list)</code>, then <code>add(item)</code> to it, and finally return. That would be perfectly <a href="http://www.yegor256.com/2014/06/09/objects-should-be-immutable.html">immutable</a>, but slow.</p><p>So, what is wrong with this:</p><figure class="highlight"><pre><code class="language-java" data-lang="java"><span></span><span class="n">List</span><span class="o">&lt;</span><span class="n">String</span><span class="o">&gt;</span> <span class="n">list</span> <span class="o">=</span> <span class="k">new</span> <span class="n">LinkedList</span><span class="o">();</span>
<span class="n">Foo</span><span class="o">.</span><span class="na">append</span><span class="o">(</span><span class="n">list</span><span class="o">,</span> <span class="s">&quot;Jeff&quot;</span><span class="o">);</span>
<span class="n">Foo</span><span class="o">.</span><span class="na">append</span><span class="o">(</span><span class="n">list</span><span class="o">,</span> <span class="s">&quot;Walter&quot;</span><span class="o">);</span>
<span class="k">return</span> <span class="n">list</span><span class="o">;</span></code></pre></figure><p>It looks perfectly clean, doesn&#39;t it? Instantiate a list, append two items to it, and return it. Yes, it is clean---for now. Because we remember what <code>append()</code> is doing. In a few months, we&#39;ll get back to this code, and it will look like this:</p><figure class="highlight"><pre><code class="language-java" data-lang="java"><span></span><span class="n">List</span><span class="o">&lt;</span><span class="n">String</span><span class="o">&gt;</span> <span class="n">list</span> <span class="o">=</span> <span class="k">new</span> <span class="n">LinkedList</span><span class="o">();</span>
<span class="c1">// 10 more lines here</span>
<span class="n">Foo</span><span class="o">.</span><span class="na">append</span><span class="o">(</span><span class="n">list</span><span class="o">,</span> <span class="s">&quot;Jeff&quot;</span><span class="o">);</span>
<span class="n">Foo</span><span class="o">.</span><span class="na">append</span><span class="o">(</span><span class="n">list</span><span class="o">,</span> <span class="s">&quot;Walter&quot;</span><span class="o">);</span>
<span class="c1">// 10 more lines here</span>
<span class="k">return</span> <span class="n">list</span><span class="o">;</span></code></pre></figure><p>Is it so clear now that <code>append()</code> is actually adding <code>&quot;Jeff&quot;</code> to <code>list</code>? What will happen if I remove that line? Will it affect the result being returned in the last line? I don&#39;t know. I need to <strong>check</strong> the body of method <code>append()</code> to make sure.</p><p>Also, how about returning <code>list</code> first and calling <code>append()</code> afterwards? This is what possible &quot;refactoring&quot; may do to our code:</p><figure class="highlight"><pre><code class="language-java" data-lang="java"><span></span><span class="n">List</span><span class="o">&lt;</span><span class="n">String</span><span class="o">&gt;</span> <span class="n">list</span> <span class="o">=</span> <span class="k">new</span> <span class="n">LinkedList</span><span class="o">();</span>
<span class="k">if</span> <span class="o">(</span><span class="cm">/* something */</span><span class="o">)</span> <span class="o">{</span>
  <span class="k">return</span> <span class="n">list</span><span class="o">;</span>
<span class="o">}</span>
<span class="c1">// 10 more lines here</span>
<span class="n">Foo</span><span class="o">.</span><span class="na">append</span><span class="o">(</span><span class="n">list</span><span class="o">,</span> <span class="s">&quot;Walter&quot;</span><span class="o">);</span>
<span class="n">Foo</span><span class="o">.</span><span class="na">append</span><span class="o">(</span><span class="n">list</span><span class="o">,</span> <span class="s">&quot;Jeff&quot;</span><span class="o">);</span>
<span class="c1">// 10 more lines here</span>
<span class="k">return</span> <span class="n">list</span><span class="o">;</span></code></pre></figure><p>First of all, we return <code>list</code> too early, when it is not ready. But did anyone tell me that these two calls to <code>append()</code> must happen before <code>return list</code>? Second, we changed the order of <code>append()</code> calls. Again, did anyone tell me that it&#39;s important to call them in that particular order?</p><p>Nobody. Nowhere. This is called <strong>temporal coupling</strong>.</p><p>Our lines are <strong>coupled</strong> together. They must stay in this particular order, but the knowledge about that order is hidden. It&#39;s easy to destroy the order, and our compiler won&#39;t be able to catch us.</p><p>To the contrary, this design doesn&#39;t have any &quot;order&quot;:</p><figure class="highlight"><pre><code class="language-java" data-lang="java"><span></span><span class="k">return</span> <span class="n">Foo</span><span class="o">.</span><span class="na">with</span><span class="o">(</span>
  <span class="n">Foo</span><span class="o">.</span><span class="na">with</span><span class="o">(</span>
    <span class="k">new</span> <span class="n">LinkedList</span><span class="o">(),</span>
    <span class="s">&quot;Jeff&quot;</span>
  <span class="o">),</span>
  <span class="s">&quot;Walter&quot;</span>
<span class="o">);</span></code></pre></figure><p>It just <strong>returns</strong> a list, which is constructed by a few calls to the <code>with()</code> method. It is a single line instead of four.</p><p>As <a href="/2015/08/18/multiple-return-statements-in-oop.html">discussed before</a>, an ideal method in OOP must have just a single statement, and this statement is <code>return</code>.</p><p>The same is true about validation. For example, this code is bad:</p><figure class="highlight"><pre><code class="language-java" data-lang="java"><span></span><span class="n">list</span><span class="o">.</span><span class="na">add</span><span class="o">(</span><span class="s">&quot;Jeff&quot;</span><span class="o">);</span>
<span class="n">Foo</span><span class="o">.</span><span class="na">checkIfListStillHasSpace</span><span class="o">(</span><span class="n">list</span><span class="o">);</span>
<span class="n">list</span><span class="o">.</span><span class="na">add</span><span class="o">(</span><span class="s">&quot;Walter&quot;</span><span class="o">);</span></code></pre></figure><p>While this one is much better:</p><figure class="highlight"><pre><code class="language-java" data-lang="java"><span></span><span class="n">list</span><span class="o">.</span><span class="na">add</span><span class="o">(</span><span class="s">&quot;Jeff&quot;</span><span class="o">);</span>
<span class="n">Foo</span><span class="o">.</span><span class="na">withEnoughSpace</span><span class="o">(</span><span class="n">list</span><span class="o">).</span><span class="na">add</span><span class="o">(</span><span class="s">&quot;Walter&quot;</span><span class="o">);</span></code></pre></figure><p>See the difference?</p><p>And, of course, an ideal approach would be to use <a href="/2015/02/26/composable-decorators.html">composable decorators</a> instead of these ugly static methods. But if it&#39;s not possible for some reason, just don&#39;t make those static methods look like procedures. Make sure they always return results, which become arguments to further calls.</p></div></article></div><div class="wrapper"> <related-posts /></div><div class="disqus" role="complementary"><p class="disqus_hint"> Please, use <a href="https://help.disqus.com/commenting/what-html-tags-are-allowed-within-comments">syntax highlighting</a> in your comments, to make them more readable.</p><div id="disqus_thread" class="disqus-thread"> <a>&nbsp;</a></div><script> var disqus_config = function () { this.page.url = document.location.href.split('?')[0].split('#')[0].replace('https://', 'http://'); this.page.identifier = this.page.url; }; (function() { var d = document, s = d.createElement('script'); s.src = '//yegor256.disqus.com/embed.js'; s.setAttribute('data-timestamp', +new Date()); (d.head || d.body).appendChild(s); })(); </script> <noscript><div><p class="red"> JavaScript is disabled in your browser, that's why you can't see comments under this post.</p></div></noscript></div><div class="wrapper"> <footer class="footer"><p> &copy; <span itemscope="" itemprop="copyrightHolder" itemtype="http://schema.org/Person"> <span itemprop="name">Yegor Bugayenko</span> </span> 2014&ndash;<span itemprop="copyrightYear">2018</span></p></footer></div></section><div class="wrapper unprintable" style="text-align:center;margin-top:2em;"> <a href="http://www.sixnines.io/h/3ba1652f"> <img src="//www.sixnines.io/b/3ba1652f?style=flat" alt="sixnines availability badge"/> </a></div><script src="//code.jquery.com/jquery-1.9.0.min.js"></script> <script src="/js/all.js?4e047f6f42b"></script> <script>var disqus_shortname = 'yegor256';</script> <script id="dsq-count-scr" src="//yegor256.disqus.com/count.js" async="async"></script> <script> (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){ (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o), m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m) })(window,document,'script','//www.google-analytics.com/analytics.js','ga'); ga('create', 'UA-1963507-32', 'auto'); ga('send', 'pageview'); </script> <script> Cd=document;Cr="&"+Math.random();Cp="&s=1"; Cd.cookie="b=b";if(Cd.cookie)Cp+="&c=1"; Cp+="&t="+(new Date()).getTimezoneOffset(); if(self!=top)Cp+="&f=1"; </script> <script> if(navigator.javaEnabled())Cp+="&j=1"; </script> <script> if(typeof(screen)!='undefined')Cp+="&w="+screen.width+"&h="+ screen.height+"&d="+(screen.colorDepth?screen.colorDepth:screen.pixelDepth); </script> <script> Cd.write("<img src='//c.hit.ua/hit?i=95870&g=0&x=2"+Cp+Cr+ "&r="+escape(Cd.referrer)+"&u="+escape(window.location.href)+ "' border='0' wi"+"dth='1' he"+"ight='1'/>"); </script> <script type="application/ld+json"> { "@context": "http://schema.org", "@type": "Person", "name": "Yegor Bugayenko", "url": "http://www.yegor256.com", "sameAs": [ "https://www.facebook.com/yegor256", "https://instagram.com/yegor256", "https://www.linkedin.com/in/yegor256", "https://twitter.com/yegor256", "https://github.com/yegor256", "https://www.pinterest.com/yegor256/" ] } </script> </body> </html> <!DOCTYPE html> <html xmlns="http://www.w3.org/1999/xhtml" lang="en-US" xml:lang="en-US" itemscope="" itemtype="http://schema.org/WebSite"> <head> <meta charset="utf-8"/> <meta name="description" content="One of the most helpful things you can do is add a contextual message to an exception on each re-throw &amp;dash; and actually, in all other situations. " /> <meta name="keywords" content="rethrow exception, rethrow exception c++, rethrow exception java, rethrow exception scala, rethrow exception with new message" /> <meta name="viewport" content="width=device-width,minimum-scale=1,initial-scale=1"/> <meta name="google-site-verification" content="JEj_gQr2CPe2QKGw8XdMz0R7VboQIUbX3FlM-lwTq-8" /> <meta name="author" content="Yegor Bugayenko"> <meta name="article:published_time" content="2015-12-01 00:00:00 +0000"> <meta name="og:site_name" content="Yegor Bugayenko"/> <meta name="og:type" content="article" /> <meta name="og:locale" content="en_US" /> <meta name="twitter:account_id" content="4503599630178231" /> <meta name="twitter:creator" content="@yegor256"/> <meta name="twitter:site" content="@yegor256"/> <meta name="twitter:title" property="og:title" content="Throwing an Exception Without Proper Context Is a Bad Habit"/> <meta name="twitter:description" property="og:description" content="One of the most helpful things you can do is add a contextual message to an exception on each re-throw &amp;dash; and actually, in all other situations. "/> <meta name="twitter:url" property="og:url" content="https://www.yegor256.com/2015/12/01/rethrow-exceptions.html"/> <meta name="telegram:channel" content="AAAAAEJFMRzsRTRxM3ec6A"/> <link rel="search" type="application/opensearchdescription+xml" href="/opensearch.xml" title="yegor256" /> <link rel="shortcut icon" href="/favicon.ico?4e047f6f42b"/> <link rel="apple-touch-icon" href="/favicon.ico?4e047f6f42b"/> <link rel="alternate" type="application/rss+xml" title="RSS for yegor256.com" href="https://www.yegor256.com/rss.xml"/> <link rel="stylesheet" href="/css/layout.css?4e047f6f42b"/> <link rel="stylesheet" href="/css/icons.css?4e047f6f42b"/> <link rel="canonical" href="https://www.yegor256.com/2015/12/01/rethrow-exceptions.html" /> <link rel="amphtml" href="https://www.yegor256.com/2015/12/01/rethrow-exceptions.amp.html" /> <title>Throwing an Exception Without Proper Context Is a Bad Habit </title> <meta name='og:image' content='https://www.yegor256.com/images/2015/12/four-rooms.jpg'/><meta name='twitter:image' content='https://www.yegor256.com/images/2015/12/four-rooms.jpg'/><meta name='og:image:width' content='1200'/> <meta name='twitter:image:width' content='1200'/><meta name='og:image:height' content='649'/> <meta name='twitter:image:height' content='649'/><meta name='twitter:card' content='summary_large_image'/><meta name='twitter:image:alt' content='Four Rooms (1995) by Allison Anders et al.'/> </head> <body><div class="wrapper"> <aside class="header-toggle unprintable" id="header-toggle" title="Show the menu" onclick="$('#header').show();$('#header-toggle').hide();">&#9776;</aside> <header class="header" id="header"><div class="face"> <a href="/about-me.html#form" class="sub" title="Click to subscribe to my monthly newsletter"><span>Subscribe</span></a> <a href="/about-me.html" style="position:relative;"> <img src="/images/face-256x256.jpg" class="photo" alt="Yegor Bugayenko"/> </a></div><nav><ul class="menu social notranslate"> <li><a href="https://twitter.com/intent/follow?screen_name=yegor256" rel="nofollow" title="Follow me on Twitter"><i class="icon icon-twitter notranslate" aria-hidden="true"></i></a></li> <li><a href="/rss.xml" rel="nofollow" title="Subscribe to my RSS feed"><i class="icon icon-rss notranslate" aria-hidden="true"></i></a></li> <li><a itemprop="sameAs" href="https://github.com/yegor256" rel="nofollow" title="My GitHub profile"><i class="icon icon-github notranslate" aria-hidden="true"></i></a></li> <li><a itemprop="sameAs" href="http://stackoverflow.com/users/187141/yegor256" rel="nofollow" title="My StackOverflow profile"><i class="icon icon-stackoverflow notranslate" aria-hidden="true"></i></a></li> <li><a itemprop="sameAs" href="https://www.facebook.com/yegor256" rel="nofollow" title="Follow me on Facebook"><i class="icon icon-facebook notranslate" aria-hidden="true"></i></a></li> <li><a itemprop="sameAs" href="https://instagram.com/yegor256" rel="nofollow" title="Follow me on Instagram"><i class="icon icon-instagram notranslate" aria-hidden="true"></i></a></li> <li><a itemprop="sameAs" href="https://www.linkedin.com/in/yegor256" rel="nofollow" title="My LinkedIn profile"><i class="icon icon-linkedin notranslate" aria-hidden="true"></i></a></li> <li><a itemprop="sameAs" href="https://www.youtube.com/c/yegor256?sub_confirmation=1" rel="nofollow" title="My Youtube video channel"><i class="icon icon-youtube notranslate" aria-hidden="true"></i></a></li> <li><a itemprop="sameAs" href="https://www.pinterest.com/yegor256/" rel="nofollow" title="My Pinterest boards"><i class="icon icon-pinterest notranslate" aria-hidden="true"></i></a></li> <li><a itemprop="sameAs" href="https://angel.co/yegor256" rel="nofollow" title="My AngelList profile"><i class="icon icon-angellist notranslate" aria-hidden="true"></i></a></li> <li><a href="https://soundcloud.com/yegor256" rel="nofollow" title="My podcast"><i class="icon icon-podcast notranslate" aria-hidden="true"></i></a></li> <li><a href="https://itunes.apple.com/us/podcast/yegor256-podcast/id1150826721" rel="nofollow" title="My iTunes podcast"><i class="icon icon-itunes notranslate" aria-hidden="true"></i></a></li> <li><a href="https://t.me/joinchat/AAAAAEJFMRzsRTRxM3ec6A" rel="nofollow" title="My Telegram public channel"><i class="icon icon-telegram notranslate" aria-hidden="true"></i></a></li> <li><a href="mailto:blog@yegor256.com" rel="nofollow" title="Email me any time"><i class="icon icon-mail notranslate" aria-hidden="true"></i></a></li></ul><ul class="menu"> <li><a href="/" title="Home page">Home</a></li> <li ><a href="/best.html" title="Best articles to read">12&#160;Best</a></li> <li ><a href="/contents.html" title="The contents of the entire blog">All&#160;288</a></li> <li ><a href="/webinars.html" title="My webinars">Webinars</a></li> <li ><a href="/talks.html" title="Future and past conference talks">Talks</a></li> <li ><a href="/books.html" title="The books I wrote">Books</a></li> <li ><a href="/papers.html" title="My academic papers and patents">Papers</a></li> <li ><a href="/pets.html" title="My loved pet projects">Pets</a></li> <li ><a href="/award.html" title="Software quality award">Award</a></li> <li ><a href="/testimonials.html" title="What some people say about me">Testimonials</a></li> <li ><a href="/shift-m.html" title="Audio podcast about project management">Shift-M</a></li> <li ><a href="/paintings.html" title="My paintings for sale">Paintings</a></li> <li><a href="http://ru.yegor256.com/" title="Немного на русском языке">По-русски</a></li></ul></nav><div class="search"> <form method="get" action="https://www.google.com/search" itemprop="potentialAction" itemscope="" itemtype="http://schema.org/SearchAction"> <meta itemprop="target" content="https://www.google.com/search?q={q}"/> <input name="sitesearch" value="yegor256.com" type="hidden"/> <input itemprop="query-input" type="text" id="search-query" class="field field-text" required="required" onfocus="$('.google').css('visibility', 'visible');" name="q" placeholder="Search..." autocomplete="off"/> <input type="image" src="/images/google-search-icon.svg" class="google" title="Search via Google" alt="Search via Google"/> </form></div><div class="hot"><ul> <li> <a href="/code-ahead.html">Code Ahead</a> was published on Amazon just a few days ago! It is my new book, a novel about programmers. It explains in details the majority of ideas that stand behind <a href="https://www.zerocracy.com">Zerocracy</a> and <a href="https://www.xdsd.org">XDSD</a>. </li> <li> At <a href="/webinars.html">Webinar #37</a> we will discuss naming problem in OOP, for objects, methods and attributes; join us on <b>September 12</b>, at 11am PST. </li></ul></div></header></div><section itemscope="" itemtype="http://schema.org/BlogPosting"><div class="wrapper"> <header><p class="printable"> <img src="https://api.qrserver.com/v1/create-qr-code/?data=https://www.yegor256.com/2015/12/01/rethrow-exceptions.html&amp;format=svg" style="width:125px;height:125px;" alt="QR code"/></p><p class="printable"> <code itemprop="url">https://www.yegor256.com/2015/12/01/rethrow-exceptions.html</code></p><h1 itemprop="name headline mainEntityOfPage">Throwing an Exception Without Proper Context Is a Bad Habit</h1><ul class="subline"> <li> <time itemprop="datePublished" datetime="2015-12-01T00:00:00+00:00"> 1 December 2015 </time> </li> <li class="desktop-only" itemprop="locationCreated">San Jose, CA</li> <li class="printable" itemscope="" itemprop="author" itemtype="http://schema.org/Person"> <span itemprop="name">Yegor Bugayenko</span> </li> <li class="unprintable"> <i class="icon icon-comments"></i> <a href="http://www.yegor256.com/2015/12/01/rethrow-exceptions.html#disqus_thread" itemprop="discussionUrl">comments</a> </li></ul><figure class='jb_picture'><img itemprop='image' alt='Four Rooms (1995) by Allison Anders et al.' src='/images/2015/12/four-rooms.jpg' longdesc='#ddf945c0'/><figcaption id='ddf945c0'>Four Rooms (1995) by Allison Anders et al.</figcaption></figure><p>This is how the code may look:</p><figure class="highlight"><pre><code class="language-java" data-lang="java"><span></span><span class="k">if</span> <span class="o">(!</span><span class="n">file</span><span class="o">.</span><span class="na">exists</span><span class="o">())</span> <span class="o">{</span>
  <span class="k">throw</span> <span class="k">new</span> <span class="n">IllegalArgumentException</span><span class="o">(</span>
    <span class="s">&quot;File doesn&#39;t exist&quot;</span>
  <span class="o">);</span>
<span class="o">}</span></code></pre></figure><p>It may also look like this:</p><figure class="highlight"><pre><code class="language-java" data-lang="java"><span></span><span class="k">try</span> <span class="o">{</span>
  <span class="n">Files</span><span class="o">.</span><span class="na">delete</span><span class="o">(</span><span class="n">file</span><span class="o">);</span>
<span class="o">}</span> <span class="k">catch</span> <span class="o">(</span><span class="n">IOException</span> <span class="n">ex</span><span class="o">)</span> <span class="o">{</span>
  <span class="k">throw</span> <span class="k">new</span> <span class="n">IllegalArgumentException</span><span class="o">(</span><span class="n">ex</span><span class="o">);</span>
<span class="o">}</span></code></pre></figure><p>Both examples demonstrate an inadequate style of handling situations that involve exceptions and reporting them. What&#39;s wrong here? The exception messages are not thorough enough. They simply don&#39;t contain any information from the place where they originated from.</p><p>This is how they should look instead:</p><figure class="highlight"><pre><code class="language-java" data-lang="java"><span></span><span class="k">if</span> <span class="o">(!</span><span class="n">file</span><span class="o">.</span><span class="na">exists</span><span class="o">())</span> <span class="o">{</span>
  <span class="k">throw</span> <span class="k">new</span> <span class="n">IllegalArgumentException</span><span class="o">(</span>
    <span class="n">String</span><span class="o">.</span><span class="na">format</span><span class="o">(</span>
      <span class="s">&quot;User profile file %s doesn&#39;t exist&quot;</span><span class="o">,</span>
      <span class="n">file</span><span class="o">.</span><span class="na">getAbsolutePath</span><span class="o">()</span>
    <span class="o">)</span>
  <span class="o">);</span>
<span class="o">}</span></code></pre></figure><p>And the second example should look like this:</p><figure class="highlight"><pre><code class="language-java" data-lang="java"><span></span><span class="k">try</span> <span class="o">{</span>
  <span class="n">Files</span><span class="o">.</span><span class="na">delete</span><span class="o">(</span><span class="n">file</span><span class="o">);</span>
<span class="o">}</span> <span class="k">catch</span> <span class="o">(</span><span class="n">IOException</span> <span class="n">ex</span><span class="o">)</span> <span class="o">{</span>
  <span class="k">throw</span> <span class="k">new</span> <span class="n">IllegalArgumentException</span><span class="o">(</span>
    <span class="n">String</span><span class="o">.</span><span class="na">format</span><span class="o">(</span>
      <span class="s">&quot;Can&#39;t delete user profile data file %s&quot;</span><span class="o">,</span>
      <span class="n">file</span><span class="o">.</span><span class="na">getAbsolutePath</span><span class="o">()</span>
    <span class="o">),</span>
    <span class="n">ex</span>
  <span class="o">);</span>
<span class="o">}</span></code></pre></figure><p>See the difference? This may look like redundant code, but it&#39;s not. Of course, when I&#39;m writing all this, I don&#39;t really care about logs and exceptions. I&#39;m not really expecting this file to be absent.</p><p>But I should.</p><p>There should be a rule: Every time we throw or re-throw, an exception message must describe the problem with as much detail as possible.</p><p>Of course, we can&#39;t forget about security and risk putting any sensitive information into the exception message, like passwords, credit card numbers, etc. Besides that, as much as possible must be exposed to the exception catcher at a higher level.</p><p>Throwing an exception is literally an escalation of a problem to a higher level of management. Imagine that my boss is asking me to install a new server. I come back to him in a few hours and say, &quot;I failed; sorry.&quot; That would sound strange. He would ask for more details. Why did I fail? What exactly went wrong? Is it possible to do it differently? Etc.</p><p>Such code is literally a sign of disrespect to the client:</p><figure class="highlight"><pre><code class="language-java" data-lang="java"><span></span><span class="k">throw</span> <span class="k">new</span> <span class="n">IllegalArgumentException</span><span class="o">(</span>
  <span class="s">&quot;File doesn&#39;t exist&quot;</span>
<span class="o">);</span></code></pre></figure><p>I have to be more verbose and give more details.</p><p>And I&#39;m not alone in this mistake. I see it everywhere, and it really makes <a href="/2016/02/09/are-you-still-debugging.html">debugging</a> difficult, especially in production, where it&#39;s almost impossible to reproduce the problem right away.</p><p>Thus, please be more verbose in your exception messages. I will do the same in my code :)</p><p>And one more thing before you go. In most OOP languages, exceptions are unchecked, which means that catching them is not a mandatory operation, <a href="/2015/07/28/checked-vs-unchecked-exceptions.html">unfortunately</a>. Nevertheless, I recommend you catch, add context, and re-throw them all, <strong>always</strong>. This may seem like pure noise, but it&#39;s not! Just make your methods smaller and ensure all exceptions sent out of them have enough information about their origins. You will do yourself and everybody else a big favor.</p></p>--> <nav class="buttons notranslate desktop-only"> <a href="http://www.facebook.com/sharer/sharer.php?u=https://www.yegor256.com/2015/12/01/rethrow-exceptions.html" title="Share on Facebook" class="button" rel="nofollow"> <span class="count count-facebook">0</span> <i class="icon icon-facebook notranslate" aria-hidden="true"></i> </a> <a href="https://twitter.com/share?url=https://www.yegor256.com/2015/12/01/rethrow-exceptions.html&amp;text=Throwing+an+Exception+Without+Proper+Context+Is+a+Bad+Habit" title="Share on Twitter" class="button" rel="nofollow"> <span class="count count-twitter">0</span> <i class="icon icon-twitter notranslate" aria-hidden="true"></i> </a> <a href="https://plus.google.com/share?url=https://www.yegor256.com/2015/12/01/rethrow-exceptions.html" title="Share on Google+" class="button" rel="nofollow"> <span class="count count-googleplus">0</span> <i class="icon icon-googleplus notranslate" aria-hidden="true"></i> </a> <a href="https://www.linkedin.com/cws/share?url=https://www.yegor256.com/2015/12/01/rethrow-exceptions.html" title="Share on LinkedIn" class="button" rel="nofollow"> <span class="count count-linkedin">0</span> <i class="icon icon-linkedin notranslate" aria-hidden="true"></i> </a> <a href="http://reddit.com/submit?url=https://www.yegor256.com/2015/12/01/rethrow-exceptions.html%3F2015-48&amp;title=Throwing+an+Exception+Without+Proper+Context+Is+a+Bad+Habit" title="Share on Reddit" class="button" rel="nofollow"> <span class="count count-reddit">0</span> <i class="icon icon-reddit notranslate" aria-hidden="true"></i> </a> <a href="http://news.ycombinator.com/submitlink?u=https://www.yegor256.com/2015/12/01/rethrow-exceptions.html%3F2015-48&amp;t=Throwing+an+Exception+Without+Proper+Context+Is+a+Bad+Habit" title="Share on Hacker News" class="button" rel="nofollow"> <span class="count count-hackernews">0</span> <i class="icon icon-hackernews notranslate" aria-hidden="true"></i> </a> </nav> </header> <article class="main" itemprop="articleBody"><div ><p>I keep repeating the same mistake again and again. So it&#39;s time to stop and make a rule to prevent this from happening anymore. The mistake is not fatal, but it&#39;s very annoying. When I look at production logs, I often see something like <code>&quot;File doesn&#39;t exist&quot;</code>, and I ask myself: What file? Where is it supposed to exist? What did the server try to do with it? What was going on a second before it crashed? There is no answer in the log, and it&#39;s totally my fault. I either 1) don&#39;t re-throw or 2) re-throw without providing context. Both are wrong.</p><figure class='jb_picture'><img itemprop='image' alt='Four Rooms (1995) by Allison Anders et al.' src='/images/2015/12/four-rooms.jpg' longdesc='#ddf945c0'/><figcaption id='ddf945c0'>Four Rooms (1995) by Allison Anders et al.</figcaption></figure><p>This is how the code may look:</p><figure class="highlight"><pre><code class="language-java" data-lang="java"><span></span><span class="k">if</span> <span class="o">(!</span><span class="n">file</span><span class="o">.</span><span class="na">exists</span><span class="o">())</span> <span class="o">{</span>
  <span class="k">throw</span> <span class="k">new</span> <span class="n">IllegalArgumentException</span><span class="o">(</span>
    <span class="s">&quot;File doesn&#39;t exist&quot;</span>
  <span class="o">);</span>
<span class="o">}</span></code></pre></figure><p>It may also look like this:</p><figure class="highlight"><pre><code class="language-java" data-lang="java"><span></span><span class="k">try</span> <span class="o">{</span>
  <span class="n">Files</span><span class="o">.</span><span class="na">delete</span><span class="o">(</span><span class="n">file</span><span class="o">);</span>
<span class="o">}</span> <span class="k">catch</span> <span class="o">(</span><span class="n">IOException</span> <span class="n">ex</span><span class="o">)</span> <span class="o">{</span>
  <span class="k">throw</span> <span class="k">new</span> <span class="n">IllegalArgumentException</span><span class="o">(</span><span class="n">ex</span><span class="o">);</span>
<span class="o">}</span></code></pre></figure><p>Both examples demonstrate an inadequate style of handling situations that involve exceptions and reporting them. What&#39;s wrong here? The exception messages are not thorough enough. They simply don&#39;t contain any information from the place where they originated from.</p><p>This is how they should look instead:</p><figure class="highlight"><pre><code class="language-java" data-lang="java"><span></span><span class="k">if</span> <span class="o">(!</span><span class="n">file</span><span class="o">.</span><span class="na">exists</span><span class="o">())</span> <span class="o">{</span>
  <span class="k">throw</span> <span class="k">new</span> <span class="n">IllegalArgumentException</span><span class="o">(</span>
    <span class="n">String</span><span class="o">.</span><span class="na">format</span><span class="o">(</span>
      <span class="s">&quot;User profile file %s doesn&#39;t exist&quot;</span><span class="o">,</span>
      <span class="n">file</span><span class="o">.</span><span class="na">getAbsolutePath</span><span class="o">()</span>
    <span class="o">)</span>
  <span class="o">);</span>
<span class="o">}</span></code></pre></figure><p>And the second example should look like this:</p><figure class="highlight"><pre><code class="language-java" data-lang="java"><span></span><span class="k">try</span> <span class="o">{</span>
  <span class="n">Files</span><span class="o">.</span><span class="na">delete</span><span class="o">(</span><span class="n">file</span><span class="o">);</span>
<span class="o">}</span> <span class="k">catch</span> <span class="o">(</span><span class="n">IOException</span> <span class="n">ex</span><span class="o">)</span> <span class="o">{</span>
  <span class="k">throw</span> <span class="k">new</span> <span class="n">IllegalArgumentException</span><span class="o">(</span>
    <span class="n">String</span><span class="o">.</span><span class="na">format</span><span class="o">(</span>
      <span class="s">&quot;Can&#39;t delete user profile data file %s&quot;</span><span class="o">,</span>
      <span class="n">file</span><span class="o">.</span><span class="na">getAbsolutePath</span><span class="o">()</span>
    <span class="o">),</span>
    <span class="n">ex</span>
  <span class="o">);</span>
<span class="o">}</span></code></pre></figure><p>See the difference? This may look like redundant code, but it&#39;s not. Of course, when I&#39;m writing all this, I don&#39;t really care about logs and exceptions. I&#39;m not really expecting this file to be absent.</p><p>But I should.</p><p>There should be a rule: Every time we throw or re-throw, an exception message must describe the problem with as much detail as possible.</p><p>Of course, we can&#39;t forget about security and risk putting any sensitive information into the exception message, like passwords, credit card numbers, etc. Besides that, as much as possible must be exposed to the exception catcher at a higher level.</p><p>Throwing an exception is literally an escalation of a problem to a higher level of management. Imagine that my boss is asking me to install a new server. I come back to him in a few hours and say, &quot;I failed; sorry.&quot; That would sound strange. He would ask for more details. Why did I fail? What exactly went wrong? Is it possible to do it differently? Etc.</p><p>Such code is literally a sign of disrespect to the client:</p><figure class="highlight"><pre><code class="language-java" data-lang="java"><span></span><span class="k">throw</span> <span class="k">new</span> <span class="n">IllegalArgumentException</span><span class="o">(</span>
  <span class="s">&quot;File doesn&#39;t exist&quot;</span>
<span class="o">);</span></code></pre></figure><p>I have to be more verbose and give more details.</p><p>And I&#39;m not alone in this mistake. I see it everywhere, and it really makes <a href="/2016/02/09/are-you-still-debugging.html">debugging</a> difficult, especially in production, where it&#39;s almost impossible to reproduce the problem right away.</p><p>Thus, please be more verbose in your exception messages. I will do the same in my code :)</p><p>And one more thing before you go. In most OOP languages, exceptions are unchecked, which means that catching them is not a mandatory operation, <a href="/2015/07/28/checked-vs-unchecked-exceptions.html">unfortunately</a>. Nevertheless, I recommend you catch, add context, and re-throw them all, <strong>always</strong>. This may seem like pure noise, but it&#39;s not! Just make your methods smaller and ensure all exceptions sent out of them have enough information about their origins. You will do yourself and everybody else a big favor.</p></div></article></div><div class="wrapper"> <related-posts /></div><div class="disqus" role="complementary"><p class="disqus_hint"> Please, use <a href="https://help.disqus.com/commenting/what-html-tags-are-allowed-within-comments">syntax highlighting</a> in your comments, to make them more readable.</p><div id="disqus_thread" class="disqus-thread"> <a>&nbsp;</a></div><script> var disqus_config = function () { this.page.url = document.location.href.split('?')[0].split('#')[0].replace('https://', 'http://'); this.page.identifier = this.page.url; }; (function() { var d = document, s = d.createElement('script'); s.src = '//yegor256.disqus.com/embed.js'; s.setAttribute('data-timestamp', +new Date()); (d.head || d.body).appendChild(s); })(); </script> <noscript><div><p class="red"> JavaScript is disabled in your browser, that's why you can't see comments under this post.</p></div></noscript></div><div class="wrapper"> <footer class="footer"><p> &copy; <span itemscope="" itemprop="copyrightHolder" itemtype="http://schema.org/Person"> <span itemprop="name">Yegor Bugayenko</span> </span> 2014&ndash;<span itemprop="copyrightYear">2018</span></p></footer></div></section><div class="wrapper unprintable" style="text-align:center;margin-top:2em;"> <a href="http://www.sixnines.io/h/3ba1652f"> <img src="//www.sixnines.io/b/3ba1652f?style=flat" alt="sixnines availability badge"/> </a></div><script src="//code.jquery.com/jquery-1.9.0.min.js"></script> <script src="/js/all.js?4e047f6f42b"></script> <script>var disqus_shortname = 'yegor256';</script> <script id="dsq-count-scr" src="//yegor256.disqus.com/count.js" async="async"></script> <script> (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){ (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o), m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m) })(window,document,'script','//www.google-analytics.com/analytics.js','ga'); ga('create', 'UA-1963507-32', 'auto'); ga('send', 'pageview'); </script> <script> Cd=document;Cr="&"+Math.random();Cp="&s=1"; Cd.cookie="b=b";if(Cd.cookie)Cp+="&c=1"; Cp+="&t="+(new Date()).getTimezoneOffset(); if(self!=top)Cp+="&f=1"; </script> <script> if(navigator.javaEnabled())Cp+="&j=1"; </script> <script> if(typeof(screen)!='undefined')Cp+="&w="+screen.width+"&h="+ screen.height+"&d="+(screen.colorDepth?screen.colorDepth:screen.pixelDepth); </script> <script> Cd.write("<img src='//c.hit.ua/hit?i=95870&g=0&x=2"+Cp+Cr+ "&r="+escape(Cd.referrer)+"&u="+escape(window.location.href)+ "' border='0' wi"+"dth='1' he"+"ight='1'/>"); </script> <script type="application/ld+json"> { "@context": "http://schema.org", "@type": "Person", "name": "Yegor Bugayenko", "url": "http://www.yegor256.com", "sameAs": [ "https://www.facebook.com/yegor256", "https://instagram.com/yegor256", "https://www.linkedin.com/in/yegor256", "https://twitter.com/yegor256", "https://github.com/yegor256", "https://www.pinterest.com/yegor256/" ] } </script> </body> </html> <!DOCTYPE html> <html xmlns="http://www.w3.org/1999/xhtml" lang="en-US" xml:lang="en-US" itemscope="" itemtype="http://schema.org/WebSite"> <head> <meta charset="utf-8"/> <meta name="description" content="Chatbot is a perfect alternative to a traditional user interface when dealing with a microservice and professional users. " /> <meta name="keywords" content="chatbot, chatbot architecture, chatbot in GitHub, chatbot java, chatbot user interface" /> <meta name="viewport" content="width=device-width,minimum-scale=1,initial-scale=1"/> <meta name="google-site-verification" content="JEj_gQr2CPe2QKGw8XdMz0R7VboQIUbX3FlM-lwTq-8" /> <meta name="author" content="Yegor Bugayenko"> <meta name="article:published_time" content="2015-11-03 00:00:00 +0000"> <meta name="og:site_name" content="Yegor Bugayenko"/> <meta name="og:type" content="article" /> <meta name="og:locale" content="en_US" /> <meta name="twitter:account_id" content="4503599630178231" /> <meta name="twitter:creator" content="@yegor256"/> <meta name="twitter:site" content="@yegor256"/> <meta name="twitter:title" property="og:title" content="A Chatbot Is Better Than a UI for a Microservice"/> <meta name="twitter:description" property="og:description" content="Chatbot is a perfect alternative to a traditional user interface when dealing with a microservice and professional users. "/> <meta name="twitter:url" property="og:url" content="https://www.yegor256.com/2015/11/03/chatbot-better-than-ui-for-microservice.html"/> <meta name="telegram:channel" content="AAAAAEJFMRzsRTRxM3ec6A"/> <link rel="search" type="application/opensearchdescription+xml" href="/opensearch.xml" title="yegor256" /> <link rel="shortcut icon" href="/favicon.ico?4e047f6f42b"/> <link rel="apple-touch-icon" href="/favicon.ico?4e047f6f42b"/> <link rel="alternate" type="application/rss+xml" title="RSS for yegor256.com" href="https://www.yegor256.com/rss.xml"/> <link rel="stylesheet" href="/css/layout.css?4e047f6f42b"/> <link rel="stylesheet" href="/css/icons.css?4e047f6f42b"/> <link rel="canonical" href="https://www.yegor256.com/2015/11/03/chatbot-better-than-ui-for-microservice.html" /> <link rel="amphtml" href="https://www.yegor256.com/2015/11/03/chatbot-better-than-ui-for-microservice.amp.html" /> <title>A Chatbot Is Better Than a UI for a Microservice </title> </head> <body><div class="wrapper"> <aside class="header-toggle unprintable" id="header-toggle" title="Show the menu" onclick="$('#header').show();$('#header-toggle').hide();">&#9776;</aside> <header class="header" id="header"><div class="face"> <a href="/about-me.html#form" class="sub" title="Click to subscribe to my monthly newsletter"><span>Subscribe</span></a> <a href="/about-me.html" style="position:relative;"> <img src="/images/face-256x256.jpg" class="photo" alt="Yegor Bugayenko"/> </a></div><nav><ul class="menu social notranslate"> <li><a href="https://twitter.com/intent/follow?screen_name=yegor256" rel="nofollow" title="Follow me on Twitter"><i class="icon icon-twitter notranslate" aria-hidden="true"></i></a></li> <li><a href="/rss.xml" rel="nofollow" title="Subscribe to my RSS feed"><i class="icon icon-rss notranslate" aria-hidden="true"></i></a></li> <li><a itemprop="sameAs" href="https://github.com/yegor256" rel="nofollow" title="My GitHub profile"><i class="icon icon-github notranslate" aria-hidden="true"></i></a></li> <li><a itemprop="sameAs" href="http://stackoverflow.com/users/187141/yegor256" rel="nofollow" title="My StackOverflow profile"><i class="icon icon-stackoverflow notranslate" aria-hidden="true"></i></a></li> <li><a itemprop="sameAs" href="https://www.facebook.com/yegor256" rel="nofollow" title="Follow me on Facebook"><i class="icon icon-facebook notranslate" aria-hidden="true"></i></a></li> <li><a itemprop="sameAs" href="https://instagram.com/yegor256" rel="nofollow" title="Follow me on Instagram"><i class="icon icon-instagram notranslate" aria-hidden="true"></i></a></li> <li><a itemprop="sameAs" href="https://www.linkedin.com/in/yegor256" rel="nofollow" title="My LinkedIn profile"><i class="icon icon-linkedin notranslate" aria-hidden="true"></i></a></li> <li><a itemprop="sameAs" href="https://www.youtube.com/c/yegor256?sub_confirmation=1" rel="nofollow" title="My Youtube video channel"><i class="icon icon-youtube notranslate" aria-hidden="true"></i></a></li> <li><a itemprop="sameAs" href="https://www.pinterest.com/yegor256/" rel="nofollow" title="My Pinterest boards"><i class="icon icon-pinterest notranslate" aria-hidden="true"></i></a></li> <li><a itemprop="sameAs" href="https://angel.co/yegor256" rel="nofollow" title="My AngelList profile"><i class="icon icon-angellist notranslate" aria-hidden="true"></i></a></li> <li><a href="https://soundcloud.com/yegor256" rel="nofollow" title="My podcast"><i class="icon icon-podcast notranslate" aria-hidden="true"></i></a></li> <li><a href="https://itunes.apple.com/us/podcast/yegor256-podcast/id1150826721" rel="nofollow" title="My iTunes podcast"><i class="icon icon-itunes notranslate" aria-hidden="true"></i></a></li> <li><a href="https://t.me/joinchat/AAAAAEJFMRzsRTRxM3ec6A" rel="nofollow" title="My Telegram public channel"><i class="icon icon-telegram notranslate" aria-hidden="true"></i></a></li> <li><a href="mailto:blog@yegor256.com" rel="nofollow" title="Email me any time"><i class="icon icon-mail notranslate" aria-hidden="true"></i></a></li></ul><ul class="menu"> <li><a href="/" title="Home page">Home</a></li> <li ><a href="/best.html" title="Best articles to read">12&#160;Best</a></li> <li ><a href="/contents.html" title="The contents of the entire blog">All&#160;288</a></li> <li ><a href="/webinars.html" title="My webinars">Webinars</a></li> <li ><a href="/talks.html" title="Future and past conference talks">Talks</a></li> <li ><a href="/books.html" title="The books I wrote">Books</a></li> <li ><a href="/papers.html" title="My academic papers and patents">Papers</a></li> <li ><a href="/pets.html" title="My loved pet projects">Pets</a></li> <li ><a href="/award.html" title="Software quality award">Award</a></li> <li ><a href="/testimonials.html" title="What some people say about me">Testimonials</a></li> <li ><a href="/shift-m.html" title="Audio podcast about project management">Shift-M</a></li> <li ><a href="/paintings.html" title="My paintings for sale">Paintings</a></li> <li><a href="http://ru.yegor256.com/" title="Немного на русском языке">По-русски</a></li></ul></nav><div class="search"> <form method="get" action="https://www.google.com/search" itemprop="potentialAction" itemscope="" itemtype="http://schema.org/SearchAction"> <meta itemprop="target" content="https://www.google.com/search?q={q}"/> <input name="sitesearch" value="yegor256.com" type="hidden"/> <input itemprop="query-input" type="text" id="search-query" class="field field-text" required="required" onfocus="$('.google').css('visibility', 'visible');" name="q" placeholder="Search..." autocomplete="off"/> <input type="image" src="/images/google-search-icon.svg" class="google" title="Search via Google" alt="Search via Google"/> </form></div><div class="hot"><ul> <li> <a href="/code-ahead.html">Code Ahead</a> was published on Amazon just a few days ago! It is my new book, a novel about programmers. It explains in details the majority of ideas that stand behind <a href="https://www.zerocracy.com">Zerocracy</a> and <a href="https://www.xdsd.org">XDSD</a>. </li> <li> At <a href="/webinars.html">Webinar #37</a> we will discuss naming problem in OOP, for objects, methods and attributes; join us on <b>September 12</b>, at 11am PST. </li></ul></div></header></div><section itemscope="" itemtype="http://schema.org/BlogPosting"><div class="wrapper"> <header><p class="printable"> <img src="https://api.qrserver.com/v1/create-qr-code/?data=https://www.yegor256.com/2015/11/03/chatbot-better-than-ui-for-microservice.html&amp;format=svg" style="width:125px;height:125px;" alt="QR code"/></p><p class="printable"> <code itemprop="url">https://www.yegor256.com/2015/11/03/chatbot-better-than-ui-for-microservice.html</code></p><h1 itemprop="name headline mainEntityOfPage">A Chatbot Is Better Than a UI for a Microservice</h1><ul class="subline"> <li> <time itemprop="datePublished" datetime="2015-11-03T00:00:00+00:00"> 3 November 2015 </time> </li> <li class="desktop-only" itemprop="locationCreated">Seattle, WA</li> <li class="printable" itemscope="" itemprop="author" itemtype="http://schema.org/Person"> <span itemprop="name">Yegor Bugayenko</span> </li> <li class="unprintable"> <i class="icon icon-comments"></i> <a href="http://www.yegor256.com/2015/11/03/chatbot-better-than-ui-for-microservice.html#disqus_thread" itemprop="discussionUrl">comments</a> </li></ul><ul class="subline"> <li>Discussed at:</li> <li><a href="https://www.reddit.com/r/programming/comments/3reqsj/a_chatbot_is_better_than_a_ui_for_a_microservice/">reddit</a></li></ul><p>Let me give an example first. Look at the <a href="https://github.com/jcabi/jcabi-http/issues/115">jcabi/jcabi-http#115</a> GitHub ticket:</p><figure class='unprintable'><img src='https://www.yegor256.com/images/2015/10/chatbot-1.png' itemprop='image' style='width:600px;max-width:100%;' alt='The figure'/></figure><p>Let&#39;s see what&#39;s going on here, and then we&#39;ll discuss how it&#39;s designed inside. Essentially, I&#39;m <strong>talking</strong> to a chatbot here. The name of the chatbot is <code>@rultor</code> (I wrote about it <a href="/2014/07/24/rultor-automated-merging.html">last year</a>). At <span class="bullet">1</span>, I&#39;m asking the chatbot to release a new version of the <a href="https://github.com/jcabi/jcabi-http">jcabi-http</a> library. At <span class="bullet">2</span>, the chatbot responds, just confirming that the task is clear and that it&#39;s on it. At <span class="bullet">3</span>, the bot says the job is completed and its completion took nine minutes. Our conversation is over. That&#39;s it.</p><aside class='youtube'> <a href='https://www.youtube.com/watch?v=mHCwlZSlZeU'><div class='box'> <img src='https://i.ytimg.com/vi/mHCwlZSlZeU/mqdefault.jpg' alt='YouTube video #mHCwlZSlZeU'/><div class='play'><i class='icon icon-play'></i></div></div></a><div>Chat Bots are the new UI; 18 February 2016.</div></aside><p>Now, what is so special about this?</p><p>One thing: There is no user interface. Well, there is no <strong>traditional</strong> web-based HTML/CSS user interface. There is no login, logout, profile, menu, or anything like this. Rultor is a web service that has <strong>no web UI</strong>. The only way to communicate with it is by talking with its chatbot.</p><p>What&#39;s so good about it? A few things.</p><h2 id="service-is-not-a-server">Service Is Not a Server</h2><p>This is how the traditional architecture of a web system would look:</p><p><img src='/uml/eee0d1bcdb7b9318e937e99e04e39ff7.svg' style="width:75%" alt='PlantUML SVG diagram' class='plantuml'/></p><p>A user gives instructions to a service and receives responses. This communication happens through a <strong>user interface</strong> (UI)---a bunch of HTTP entry points that receive requests from a browser and return HTML+CSS responses. Or, if a user is on another service, requests may contain some data, and responses will be in <a href="/2015/11/16/json-vs-xml.html">XML or JSON</a>. You get the idea; a user is a client, and the service is a server.</p><aside class='youtube'> <a href='https://www.youtube.com/watch?v=jUil-aTImgU'><div class='box'> <img src='https://i.ytimg.com/vi/jUil-aTImgU/mqdefault.jpg' alt='YouTube video #jUil-aTImgU'/><div class='play'><i class='icon icon-play'></i></div></div></a><div>How Do You Talk To Your Microservice?; 28 November 2015.</div></aside><p>Like in a restaurant---you say what you want, and a <strong>server</strong> goes to the kitchen, waits there, and in a few minutes, comes back with spaghetti carbonara. You&#39;re a client, and that cute lady is a server.</p><p>In the case of a chatbot, that&#39;s not the case anymore. Look at the architecture:</p><p><img src='/uml/d103661ebf8494340e260442970bf4af.svg' style="width:75%" alt='PlantUML SVG diagram' class='plantuml'/></p><p>First, a user posts a request to GitHub through a web user interface provided by GitHub. It is a communication <strong>hub</strong> for us. Then, the service connects to GitHub through its RESTful API and checks whether there are any new requests there. If something new is found, the service does the job, prepares a response, and posts it there. The client receives an email notification about a new response just posted to the ticket. The client then checks GitHub and finds the response.</p><figure class='badge'><img src='https://www.yegor256.com/images/2015/11/bot-3.jpg' style='width:250px;max-width:100%;' alt='badge'/></figure><p>Here is how this would look in a restaurant: There would be a board with sticky notes. First, you write the note, &quot;I&#39;d like spaghetti carbonara with parmesan and fresh pepper on top&quot; (Damn, I&#39;m just too hungry now), and pin it to the board at number 15. Then, you return to your table. A chef from the kitchen checks that board and finds your sticky note. He makes that spaghetti, tops it with parmesan, fresh pepper, some basil leaves, and virgin olive oil ... yeah, he makes it right ... and puts it next to the board. You hear an announcement that order number 15 is ready. You go there, collect the food, return to your table, and enjoy.</p><aside class='youtube'> <a href='https://www.youtube.com/watch?v=Xj226o2xI9Y'><div class='box'> <img src='https://i.ytimg.com/vi/Xj226o2xI9Y/mqdefault.jpg' alt='YouTube video #Xj226o2xI9Y'/><div class='play'><i class='icon icon-play'></i></div></div></a><div>Chat Bots vs UI; 18 February 2016.</div></aside><p>The point is that there is <strong>no cute lady</strong> involved anymore. There is no server. There are two parties communicating with the board---you and the kitchen. The kitchen is our microservice, but it&#39;s not a server anymore.</p><p>These two parties are perfectly <strong>decoupled</strong> now. They never talk to each other. And they both are <strong>clients</strong> of the communication hub, which is GitHub or a board in the restaurant.</p><p>Again, the microservice is <strong>not a server</strong> anymore. Instead, it is a client of a communication hub. And the flip of its position provides a lot of benefits to us, its developers.</p><h2 id="no-need-to-be-fast">No Need to Be Fast</h2><figure class='badge'><img src='https://www.yegor256.com/images/2015/11/bot-5.jpg' style='width:250px;max-width:100%;' alt='badge'/></figure><p>First of all, we don&#39;t need to care much about the performance of our UI. Well, we don&#39;t care at all, since we don&#39;t have a UI. Do we care about the <strong>speed</strong> of responses on GitHub? Not really. When a user posts a message to GitHub, he or she doesn&#39;t expect our chatbot to give an immediate answer in less than 100 milliseconds. (That&#39;s what any properly designed web system must guarantee, I believe.)</p><p>We put a note on the board, and we assume that the kitchen is probably doing something else at the moment. We&#39;ll wait for a few seconds or even minutes. If, on the other hand, I give an order to the waitress and she waits five seconds before replying back, I&#39;ll be very surprised. If she keeps doing that with every question, I&#39;ll start to wonder to myself if everything is OK with her.</p><aside class='youtube'> <a href='https://www.youtube.com/watch?v=vOMqDcSXnT0'><div class='box'> <img src='https://i.ytimg.com/vi/vOMqDcSXnT0/mqdefault.jpg' alt='YouTube video #vOMqDcSXnT0'/><div class='play'><i class='icon icon-play'></i></div></div></a><div>Microservices as Chat Bots; 19 May 2016.</div></aside><p>I expect a user interface to be instant, while in a chat I have no problem allowing some time for the bot to answer. This happens <strong>naturally</strong>. We&#39;re used to delays in chats, when we&#39;re talking with real people. They need some time to process our information, to think, and to type something back.</p><p>But a user interface doesn&#39;t have that luxury. It has to be bullet-fast; otherwise, I immediately get frustrated. The same thing happens to you, right?</p><h2 id="no-need-to-look-cute">No Need to Look Cute</h2><figure class='badge'><img src='https://www.yegor256.com/images/2015/11/bot-4.jpg' style='width:250px;max-width:100%;' alt='badge'/></figure><p>Another advantage of this no-server design is that there is no need to look pretty. There is no web interface, no HTML, no CSS, <strong>no graphic design</strong>. Perhaps not everybody really likes that. Most non-professional users may still prefer to talk to a cute server instead of sticking some paper notes to the board. But if we&#39;re dealing with professional computer engineers, they&#39;re not that demanding.</p><p>Rultor doesn&#39;t have any web UI, and its users simply don&#39;t know how it &quot;looks.&quot; It just <strong>talks</strong> to you. The only thing you see is its avatar in GitHub.</p><p>This saves a lot of money and time on design efforts, which are usually very expensive if you aim for high quality. If your web service looks <strong>average</strong>, most of its users will assume that it also works average. Many good ideas have simply died because their UI wasn&#39;t as impressive as people were used to, thanks to all those Pinterests and Instagrams.</p><p>A good-looking server has a greater chance for <strong>bigger tips</strong>, right? If there is no server and we don&#39;t see the chef, we judge him or her only by the <strong>quality</strong> of the food.</p><p>Same here. By getting rid of a UI, we allow ourselves to focus on the quality of the service we&#39;re delivering. We don&#39;t burn our time and money on being <strong>nice</strong>. We spend them on being <strong>useful</strong>.</p><h2 id="much-easier-to-scale">Much Easier to Scale</h2><figure class='badge'><img src='https://www.yegor256.com/images/2015/11/bot-6.jpg' style='width:250px;max-width:100%;' alt='badge'/></figure><p>If we have too many stickies on that board, we just hire more cooks, or maybe even build another kitchen, and the problem is solved. We can handle as many customers as necessary. Well, as long as the board is powerful enough to handle multiple parallel users.</p><p>GitHub is a pretty big platform, with hundreds of thousands of users and projects. If we have too many requests coming in, we can just add more processing nodes to Rultor. Remember, we&#39;re not a server anymore; we are a <strong>client of GitHub</strong>. We decide when to connect to GitHub and when to create responses to the requests submitted.</p><p>It is much easier to create a scalable client than a scalable server, mostly because there is nobody really waiting for us to respond quickly. The load of requests we&#39;re getting can be managed much easier, since the decision of when to process them is made by us.</p><h2 id="mistakes-are-not-so-visible">Mistakes Are Not So Visible</h2><figure class='badge'><img src='https://www.yegor256.com/images/2015/11/bot-2.jpg' style='width:250px;max-width:100%;' alt='badge'/></figure><p>When you&#39;re standing in front of a customer, most of your mistakes are unforgivable, primarily because they are very visible. On the other hand, when you&#39;re cooking something in the kitchen, nobody can see you and spot your faults. They will only spot them if the spaghetti has too much salt. In other words, they will <strong>judge</strong> you by your <strong>results</strong>, not by how you produce them.</p><p>It&#39;s the same story with the microservice. When it works as a server, we expect it to be seamless, respond immediately, and present everything in a structured and organized way. If something goes wrong, it&#39;s right here on the web page. Your best case is a 404, while the worst one is that you present some wrong information to the user. Even though the bug may not be critical inside the microservice engine, the user doesn&#39;t know that. The user will judge you by your appearance and won&#39;t forget even small mistakes.</p><p>However, when you both are clients of a message board, you don&#39;t see each other. The user communicates with GitHub, and the microservice interacts with GitHub. Mistakes are less visible. Trust me, we have had <strong>many of them</strong> over the 18 months that Rultor has been in public use. We&#39;ve had downtimes, we&#39;ve had serious logical mistakes, and we&#39;ve had data corruption. But very rarely have these problems become visible online. We merely saw them in our server logs. Users didn&#39;t see them. Well, mostly :)</p><h2 id="everything-is-traceable">Everything Is Traceable</h2><figure class='badge'><img src='https://www.yegor256.com/images/2015/11/bot-1.jpg' style='width:250px;max-width:100%;' alt='badge'/></figure><p>Since there is a communication board between us, it&#39;s very easy to see the entire history of our discussion, which is very intuitive. It&#39;s like a Slack chat history. You see what we started from, who said what, and which conclusions were made.</p><p>Basically, you can&#39;t have that visibility in a web UI. Well, you can probably create a special page with the &quot;history of operations,&quot; but who would check it? And how visible and simple would that information be? And, what&#39;s most important, how would that information match up with the UI?</p><p>In the log, you&#39;ll state that &quot;the build was started,&quot; but what&#39;s the build and how was it started? How can I start it again? Using which buttons and web controls? It&#39;s not clear.</p><p>Thus, the traceability of a <strong>chronological</strong> chat is unbeatable.</p><h2 id="easy-to-integrate-with-other-services">Easy to Integrate With Other Services</h2><p>Yes, think about the future of this approach. If there is a centralized message board where users talk to a chatbot, why can&#39;t other chatbots talk to each other too?</p><p>Forget about RESTful APIs. Just a message board where chatbots post their requests and collect responses. They are perfectly decoupled, replaceable, and very scalable. Also, their communication protocol is visible and very traceable. And they boast many other benefits, as was just explained above. It&#39;s much more convenient for us, both users and programmers, to monitor them and create them.</p><p>Well, maybe it&#39;s too extreme to get rid of RESTful APIs entirely, but to some extent, this approach is feasible, I believe.</p><p>I didn&#39;t go too far with this idea, but something was done. We have a messaging platform that allows multiple chatbots to communicate with users. It&#39;s called <a href="http://www.netbout.com">Netbout</a>. It&#39;s a very primitive web system with isolated discussions. Simply put, anyone can create a new discussion, invite a few friends, and post messages there. Both users and chatbots can do that.</p><p>So, when a new candidate wants to join <a href="http://www.zerocracy.com">Zerocracy</a>, we ask that person to fill out an <a href="https://www.0crat.com/join">online form</a>. When the candidate clicks the &quot;Submit&quot; button, a new discussion starts, and the first chatbot decides who should <a href="/2016/03/01/how-we-interview-programmers.html">interview</a> that person. The decision is made according to the skills listed in the form. The chatbot invites one of our <a href="http://www.teamed.io/#check-out-ourbest-developers">best programmers</a> to conduct the interview. When the interview is done, another chatbot explains to the candidate what the next steps are, registers him or her in our database, and starts to show the progress of work.</p><p>From a user perspective, it looks like he or she is talking to a few people who understand just a few simple commands. It is very intuitive and was easy to design.</p><p>I think chatbots are a good approach for interacting with microservices. Especially when users are more or less professional.</p><p>PS. Illustrations by <a href="https://www.behance.net/wheeat">Kristina Wheat</a>.</p></p>--> <nav class="buttons notranslate desktop-only"> <a href="http://www.facebook.com/sharer/sharer.php?u=https://www.yegor256.com/2015/11/03/chatbot-better-than-ui-for-microservice.html" title="Share on Facebook" class="button" rel="nofollow"> <span class="count count-facebook">0</span> <i class="icon icon-facebook notranslate" aria-hidden="true"></i> </a> <a href="https://twitter.com/share?url=https://www.yegor256.com/2015/11/03/chatbot-better-than-ui-for-microservice.html&amp;text=A+Chatbot+Is+Better+Than+a+UI+for+a+Microservice" title="Share on Twitter" class="button" rel="nofollow"> <span class="count count-twitter">0</span> <i class="icon icon-twitter notranslate" aria-hidden="true"></i> </a> <a href="https://plus.google.com/share?url=https://www.yegor256.com/2015/11/03/chatbot-better-than-ui-for-microservice.html" title="Share on Google+" class="button" rel="nofollow"> <span class="count count-googleplus">0</span> <i class="icon icon-googleplus notranslate" aria-hidden="true"></i> </a> <a href="https://www.linkedin.com/cws/share?url=https://www.yegor256.com/2015/11/03/chatbot-better-than-ui-for-microservice.html" title="Share on LinkedIn" class="button" rel="nofollow"> <span class="count count-linkedin">0</span> <i class="icon icon-linkedin notranslate" aria-hidden="true"></i> </a> <a href="http://reddit.com/submit?url=https://www.yegor256.com/2015/11/03/chatbot-better-than-ui-for-microservice.html%3F2015-44&amp;title=A+Chatbot+Is+Better+Than+a+UI+for+a+Microservice" title="Share on Reddit" class="button" rel="nofollow"> <span class="count count-reddit">0</span> <i class="icon icon-reddit notranslate" aria-hidden="true"></i> </a> <a href="http://news.ycombinator.com/submitlink?u=https://www.yegor256.com/2015/11/03/chatbot-better-than-ui-for-microservice.html%3F2015-44&amp;t=A+Chatbot+Is+Better+Than+a+UI+for+a+Microservice" title="Share on Hacker News" class="button" rel="nofollow"> <span class="count count-hackernews">0</span> <i class="icon icon-hackernews notranslate" aria-hidden="true"></i> </a> </nav> </header> <article class="main" itemprop="articleBody"><div ><p>A chatbot (or <a href="https://en.wikipedia.org/wiki/Chatterbot">chatterbot</a>, as Wikipedia says) is a piece of software that talks to you in chat format. <a href="http://www.zerocracy.com">We</a> use chatbots in a few (micro)services, and they fully <strong>replace</strong> user interfaces. I don&#39;t think there is any innovation in this approach, but it has proved to be very effective over the last year or so. That&#39;s the impetus for this post. Here is how the <a href="http://www.rultor.com">Rultor</a> chatbot works for us and what its benefits are.</p><p>Let me give an example first. Look at the <a href="https://github.com/jcabi/jcabi-http/issues/115">jcabi/jcabi-http#115</a> GitHub ticket:</p><figure class='unprintable'><img src='https://www.yegor256.com/images/2015/10/chatbot-1.png' itemprop='image' style='width:600px;max-width:100%;' alt='The figure'/></figure><p>Let&#39;s see what&#39;s going on here, and then we&#39;ll discuss how it&#39;s designed inside. Essentially, I&#39;m <strong>talking</strong> to a chatbot here. The name of the chatbot is <code>@rultor</code> (I wrote about it <a href="/2014/07/24/rultor-automated-merging.html">last year</a>). At <span class="bullet">1</span>, I&#39;m asking the chatbot to release a new version of the <a href="https://github.com/jcabi/jcabi-http">jcabi-http</a> library. At <span class="bullet">2</span>, the chatbot responds, just confirming that the task is clear and that it&#39;s on it. At <span class="bullet">3</span>, the bot says the job is completed and its completion took nine minutes. Our conversation is over. That&#39;s it.</p><aside class='youtube'> <a href='https://www.youtube.com/watch?v=mHCwlZSlZeU'><div class='box'> <img src='https://i.ytimg.com/vi/mHCwlZSlZeU/mqdefault.jpg' alt='YouTube video #mHCwlZSlZeU'/><div class='play'><i class='icon icon-play'></i></div></div></a><div>Chat Bots are the new UI; 18 February 2016.</div></aside><p>Now, what is so special about this?</p><p>One thing: There is no user interface. Well, there is no <strong>traditional</strong> web-based HTML/CSS user interface. There is no login, logout, profile, menu, or anything like this. Rultor is a web service that has <strong>no web UI</strong>. The only way to communicate with it is by talking with its chatbot.</p><p>What&#39;s so good about it? A few things.</p><h2 id="service-is-not-a-server">Service Is Not a Server</h2><p>This is how the traditional architecture of a web system would look:</p><p><img src='/uml/eee0d1bcdb7b9318e937e99e04e39ff7.svg' style="width:75%" alt='PlantUML SVG diagram' class='plantuml'/></p><p>A user gives instructions to a service and receives responses. This communication happens through a <strong>user interface</strong> (UI)---a bunch of HTTP entry points that receive requests from a browser and return HTML+CSS responses. Or, if a user is on another service, requests may contain some data, and responses will be in <a href="/2015/11/16/json-vs-xml.html">XML or JSON</a>. You get the idea; a user is a client, and the service is a server.</p><aside class='youtube'> <a href='https://www.youtube.com/watch?v=jUil-aTImgU'><div class='box'> <img src='https://i.ytimg.com/vi/jUil-aTImgU/mqdefault.jpg' alt='YouTube video #jUil-aTImgU'/><div class='play'><i class='icon icon-play'></i></div></div></a><div>How Do You Talk To Your Microservice?; 28 November 2015.</div></aside><p>Like in a restaurant---you say what you want, and a <strong>server</strong> goes to the kitchen, waits there, and in a few minutes, comes back with spaghetti carbonara. You&#39;re a client, and that cute lady is a server.</p><p>In the case of a chatbot, that&#39;s not the case anymore. Look at the architecture:</p><p><img src='/uml/d103661ebf8494340e260442970bf4af.svg' style="width:75%" alt='PlantUML SVG diagram' class='plantuml'/></p><p>First, a user posts a request to GitHub through a web user interface provided by GitHub. It is a communication <strong>hub</strong> for us. Then, the service connects to GitHub through its RESTful API and checks whether there are any new requests there. If something new is found, the service does the job, prepares a response, and posts it there. The client receives an email notification about a new response just posted to the ticket. The client then checks GitHub and finds the response.</p><figure class='badge'><img src='https://www.yegor256.com/images/2015/11/bot-3.jpg' style='width:250px;max-width:100%;' alt='badge'/></figure><p>Here is how this would look in a restaurant: There would be a board with sticky notes. First, you write the note, &quot;I&#39;d like spaghetti carbonara with parmesan and fresh pepper on top&quot; (Damn, I&#39;m just too hungry now), and pin it to the board at number 15. Then, you return to your table. A chef from the kitchen checks that board and finds your sticky note. He makes that spaghetti, tops it with parmesan, fresh pepper, some basil leaves, and virgin olive oil ... yeah, he makes it right ... and puts it next to the board. You hear an announcement that order number 15 is ready. You go there, collect the food, return to your table, and enjoy.</p><aside class='youtube'> <a href='https://www.youtube.com/watch?v=Xj226o2xI9Y'><div class='box'> <img src='https://i.ytimg.com/vi/Xj226o2xI9Y/mqdefault.jpg' alt='YouTube video #Xj226o2xI9Y'/><div class='play'><i class='icon icon-play'></i></div></div></a><div>Chat Bots vs UI; 18 February 2016.</div></aside><p>The point is that there is <strong>no cute lady</strong> involved anymore. There is no server. There are two parties communicating with the board---you and the kitchen. The kitchen is our microservice, but it&#39;s not a server anymore.</p><p>These two parties are perfectly <strong>decoupled</strong> now. They never talk to each other. And they both are <strong>clients</strong> of the communication hub, which is GitHub or a board in the restaurant.</p><p>Again, the microservice is <strong>not a server</strong> anymore. Instead, it is a client of a communication hub. And the flip of its position provides a lot of benefits to us, its developers.</p><h2 id="no-need-to-be-fast">No Need to Be Fast</h2><figure class='badge'><img src='https://www.yegor256.com/images/2015/11/bot-5.jpg' style='width:250px;max-width:100%;' alt='badge'/></figure><p>First of all, we don&#39;t need to care much about the performance of our UI. Well, we don&#39;t care at all, since we don&#39;t have a UI. Do we care about the <strong>speed</strong> of responses on GitHub? Not really. When a user posts a message to GitHub, he or she doesn&#39;t expect our chatbot to give an immediate answer in less than 100 milliseconds. (That&#39;s what any properly designed web system must guarantee, I believe.)</p><p>We put a note on the board, and we assume that the kitchen is probably doing something else at the moment. We&#39;ll wait for a few seconds or even minutes. If, on the other hand, I give an order to the waitress and she waits five seconds before replying back, I&#39;ll be very surprised. If she keeps doing that with every question, I&#39;ll start to wonder to myself if everything is OK with her.</p><aside class='youtube'> <a href='https://www.youtube.com/watch?v=vOMqDcSXnT0'><div class='box'> <img src='https://i.ytimg.com/vi/vOMqDcSXnT0/mqdefault.jpg' alt='YouTube video #vOMqDcSXnT0'/><div class='play'><i class='icon icon-play'></i></div></div></a><div>Microservices as Chat Bots; 19 May 2016.</div></aside><p>I expect a user interface to be instant, while in a chat I have no problem allowing some time for the bot to answer. This happens <strong>naturally</strong>. We&#39;re used to delays in chats, when we&#39;re talking with real people. They need some time to process our information, to think, and to type something back.</p><p>But a user interface doesn&#39;t have that luxury. It has to be bullet-fast; otherwise, I immediately get frustrated. The same thing happens to you, right?</p><h2 id="no-need-to-look-cute">No Need to Look Cute</h2><figure class='badge'><img src='https://www.yegor256.com/images/2015/11/bot-4.jpg' style='width:250px;max-width:100%;' alt='badge'/></figure><p>Another advantage of this no-server design is that there is no need to look pretty. There is no web interface, no HTML, no CSS, <strong>no graphic design</strong>. Perhaps not everybody really likes that. Most non-professional users may still prefer to talk to a cute server instead of sticking some paper notes to the board. But if we&#39;re dealing with professional computer engineers, they&#39;re not that demanding.</p><p>Rultor doesn&#39;t have any web UI, and its users simply don&#39;t know how it &quot;looks.&quot; It just <strong>talks</strong> to you. The only thing you see is its avatar in GitHub.</p><p>This saves a lot of money and time on design efforts, which are usually very expensive if you aim for high quality. If your web service looks <strong>average</strong>, most of its users will assume that it also works average. Many good ideas have simply died because their UI wasn&#39;t as impressive as people were used to, thanks to all those Pinterests and Instagrams.</p><p>A good-looking server has a greater chance for <strong>bigger tips</strong>, right? If there is no server and we don&#39;t see the chef, we judge him or her only by the <strong>quality</strong> of the food.</p><p>Same here. By getting rid of a UI, we allow ourselves to focus on the quality of the service we&#39;re delivering. We don&#39;t burn our time and money on being <strong>nice</strong>. We spend them on being <strong>useful</strong>.</p><h2 id="much-easier-to-scale">Much Easier to Scale</h2><figure class='badge'><img src='https://www.yegor256.com/images/2015/11/bot-6.jpg' style='width:250px;max-width:100%;' alt='badge'/></figure><p>If we have too many stickies on that board, we just hire more cooks, or maybe even build another kitchen, and the problem is solved. We can handle as many customers as necessary. Well, as long as the board is powerful enough to handle multiple parallel users.</p><p>GitHub is a pretty big platform, with hundreds of thousands of users and projects. If we have too many requests coming in, we can just add more processing nodes to Rultor. Remember, we&#39;re not a server anymore; we are a <strong>client of GitHub</strong>. We decide when to connect to GitHub and when to create responses to the requests submitted.</p><p>It is much easier to create a scalable client than a scalable server, mostly because there is nobody really waiting for us to respond quickly. The load of requests we&#39;re getting can be managed much easier, since the decision of when to process them is made by us.</p><h2 id="mistakes-are-not-so-visible">Mistakes Are Not So Visible</h2><figure class='badge'><img src='https://www.yegor256.com/images/2015/11/bot-2.jpg' style='width:250px;max-width:100%;' alt='badge'/></figure><p>When you&#39;re standing in front of a customer, most of your mistakes are unforgivable, primarily because they are very visible. On the other hand, when you&#39;re cooking something in the kitchen, nobody can see you and spot your faults. They will only spot them if the spaghetti has too much salt. In other words, they will <strong>judge</strong> you by your <strong>results</strong>, not by how you produce them.</p><p>It&#39;s the same story with the microservice. When it works as a server, we expect it to be seamless, respond immediately, and present everything in a structured and organized way. If something goes wrong, it&#39;s right here on the web page. Your best case is a 404, while the worst one is that you present some wrong information to the user. Even though the bug may not be critical inside the microservice engine, the user doesn&#39;t know that. The user will judge you by your appearance and won&#39;t forget even small mistakes.</p><p>However, when you both are clients of a message board, you don&#39;t see each other. The user communicates with GitHub, and the microservice interacts with GitHub. Mistakes are less visible. Trust me, we have had <strong>many of them</strong> over the 18 months that Rultor has been in public use. We&#39;ve had downtimes, we&#39;ve had serious logical mistakes, and we&#39;ve had data corruption. But very rarely have these problems become visible online. We merely saw them in our server logs. Users didn&#39;t see them. Well, mostly :)</p><h2 id="everything-is-traceable">Everything Is Traceable</h2><figure class='badge'><img src='https://www.yegor256.com/images/2015/11/bot-1.jpg' style='width:250px;max-width:100%;' alt='badge'/></figure><p>Since there is a communication board between us, it&#39;s very easy to see the entire history of our discussion, which is very intuitive. It&#39;s like a Slack chat history. You see what we started from, who said what, and which conclusions were made.</p><p>Basically, you can&#39;t have that visibility in a web UI. Well, you can probably create a special page with the &quot;history of operations,&quot; but who would check it? And how visible and simple would that information be? And, what&#39;s most important, how would that information match up with the UI?</p><p>In the log, you&#39;ll state that &quot;the build was started,&quot; but what&#39;s the build and how was it started? How can I start it again? Using which buttons and web controls? It&#39;s not clear.</p><p>Thus, the traceability of a <strong>chronological</strong> chat is unbeatable.</p><h2 id="easy-to-integrate-with-other-services">Easy to Integrate With Other Services</h2><p>Yes, think about the future of this approach. If there is a centralized message board where users talk to a chatbot, why can&#39;t other chatbots talk to each other too?</p><p>Forget about RESTful APIs. Just a message board where chatbots post their requests and collect responses. They are perfectly decoupled, replaceable, and very scalable. Also, their communication protocol is visible and very traceable. And they boast many other benefits, as was just explained above. It&#39;s much more convenient for us, both users and programmers, to monitor them and create them.</p><p>Well, maybe it&#39;s too extreme to get rid of RESTful APIs entirely, but to some extent, this approach is feasible, I believe.</p><p>I didn&#39;t go too far with this idea, but something was done. We have a messaging platform that allows multiple chatbots to communicate with users. It&#39;s called <a href="http://www.netbout.com">Netbout</a>. It&#39;s a very primitive web system with isolated discussions. Simply put, anyone can create a new discussion, invite a few friends, and post messages there. Both users and chatbots can do that.</p><p>So, when a new candidate wants to join <a href="http://www.zerocracy.com">Zerocracy</a>, we ask that person to fill out an <a href="https://www.0crat.com/join">online form</a>. When the candidate clicks the &quot;Submit&quot; button, a new discussion starts, and the first chatbot decides who should <a href="/2016/03/01/how-we-interview-programmers.html">interview</a> that person. The decision is made according to the skills listed in the form. The chatbot invites one of our <a href="http://www.teamed.io/#check-out-ourbest-developers">best programmers</a> to conduct the interview. When the interview is done, another chatbot explains to the candidate what the next steps are, registers him or her in our database, and starts to show the progress of work.</p><p>From a user perspective, it looks like he or she is talking to a few people who understand just a few simple commands. It is very intuitive and was easy to design.</p><p>I think chatbots are a good approach for interacting with microservices. Especially when users are more or less professional.</p><p>PS. Illustrations by <a href="https://www.behance.net/wheeat">Kristina Wheat</a>.</p></div></article></div><div class="wrapper"> <related-posts /></div><div class="disqus" role="complementary"><p class="disqus_hint"> Please, use <a href="https://help.disqus.com/commenting/what-html-tags-are-allowed-within-comments">syntax highlighting</a> in your comments, to make them more readable.</p><div id="disqus_thread" class="disqus-thread"> <a>&nbsp;</a></div><script> var disqus_config = function () { this.page.url = document.location.href.split('?')[0].split('#')[0].replace('https://', 'http://'); this.page.identifier = this.page.url; }; (function() { var d = document, s = d.createElement('script'); s.src = '//yegor256.disqus.com/embed.js'; s.setAttribute('data-timestamp', +new Date()); (d.head || d.body).appendChild(s); })(); </script> <noscript><div><p class="red"> JavaScript is disabled in your browser, that's why you can't see comments under this post.</p></div></noscript></div><div class="wrapper"> <footer class="footer"><p> &copy; <span itemscope="" itemprop="copyrightHolder" itemtype="http://schema.org/Person"> <span itemprop="name">Yegor Bugayenko</span> </span> 2014&ndash;<span itemprop="copyrightYear">2018</span></p></footer></div></section><div class="wrapper unprintable" style="text-align:center;margin-top:2em;"> <a href="http://www.sixnines.io/h/3ba1652f"> <img src="//www.sixnines.io/b/3ba1652f?style=flat" alt="sixnines availability badge"/> </a></div><script src="//code.jquery.com/jquery-1.9.0.min.js"></script> <script src="/js/all.js?4e047f6f42b"></script> <script>var disqus_shortname = 'yegor256';</script> <script id="dsq-count-scr" src="//yegor256.disqus.com/count.js" async="async"></script> <script> (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){ (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o), m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m) })(window,document,'script','//www.google-analytics.com/analytics.js','ga'); ga('create', 'UA-1963507-32', 'auto'); ga('send', 'pageview'); </script> <script> Cd=document;Cr="&"+Math.random();Cp="&s=1"; Cd.cookie="b=b";if(Cd.cookie)Cp+="&c=1"; Cp+="&t="+(new Date()).getTimezoneOffset(); if(self!=top)Cp+="&f=1"; </script> <script> if(navigator.javaEnabled())Cp+="&j=1"; </script> <script> if(typeof(screen)!='undefined')Cp+="&w="+screen.width+"&h="+ screen.height+"&d="+(screen.colorDepth?screen.colorDepth:screen.pixelDepth); </script> <script> Cd.write("<img src='//c.hit.ua/hit?i=95870&g=0&x=2"+Cp+Cr+ "&r="+escape(Cd.referrer)+"&u="+escape(window.location.href)+ "' border='0' wi"+"dth='1' he"+"ight='1'/>"); </script> <script type="application/ld+json"> { "@context": "http://schema.org", "@type": "Person", "name": "Yegor Bugayenko", "url": "http://www.yegor256.com", "sameAs": [ "https://www.facebook.com/yegor256", "https://instagram.com/yegor256", "https://www.linkedin.com/in/yegor256", "https://twitter.com/yegor256", "https://github.com/yegor256", "https://www.pinterest.com/yegor256/" ] } </script> </body> </html> <!DOCTYPE html> <html xmlns="http://www.w3.org/1999/xhtml" lang="en-US" xml:lang="en-US" itemscope="" itemtype="http://schema.org/WebSite"> <head> <meta charset="utf-8"/> <meta name="description" content="Checked InterruptedException in Java is a constant source of pain for many of us; here is my understanding of how it should be handled. " /> <meta name="keywords" content="InterruptedException, InterruptedException checked or unchecked, InterruptedException example, InterruptedException java, InterruptedException sleep" /> <meta name="viewport" content="width=device-width,minimum-scale=1,initial-scale=1"/> <meta name="google-site-verification" content="JEj_gQr2CPe2QKGw8XdMz0R7VboQIUbX3FlM-lwTq-8" /> <meta name="author" content="Yegor Bugayenko"> <meta name="article:published_time" content="2015-10-20 00:00:00 +0000"> <meta name="og:site_name" content="Yegor Bugayenko"/> <meta name="og:type" content="article" /> <meta name="og:locale" content="en_US" /> <meta name="twitter:account_id" content="4503599630178231" /> <meta name="twitter:creator" content="@yegor256"/> <meta name="twitter:site" content="@yegor256"/> <meta name="twitter:title" property="og:title" content="What Do You Do With InterruptedException?"/> <meta name="twitter:description" property="og:description" content="Checked InterruptedException in Java is a constant source of pain for many of us; here is my understanding of how it should be handled. "/> <meta name="twitter:url" property="og:url" content="https://www.yegor256.com/2015/10/20/interrupted-exception.html"/> <meta name="telegram:channel" content="AAAAAEJFMRzsRTRxM3ec6A"/> <link rel="search" type="application/opensearchdescription+xml" href="/opensearch.xml" title="yegor256" /> <link rel="shortcut icon" href="/favicon.ico?4e047f6f42b"/> <link rel="apple-touch-icon" href="/favicon.ico?4e047f6f42b"/> <link rel="alternate" type="application/rss+xml" title="RSS for yegor256.com" href="https://www.yegor256.com/rss.xml"/> <link rel="stylesheet" href="/css/layout.css?4e047f6f42b"/> <link rel="stylesheet" href="/css/icons.css?4e047f6f42b"/> <link rel="canonical" href="https://www.yegor256.com/2015/10/20/interrupted-exception.html" /> <link rel="amphtml" href="https://www.yegor256.com/2015/10/20/interrupted-exception.amp.html" /> <title>What Do You Do With InterruptedException? </title> <meta name='og:image' content='https://www.yegor256.com/images/2015/10/crouching-tiger-hidden-dragon.jpg'/><meta name='twitter:image' content='https://www.yegor256.com/images/2015/10/crouching-tiger-hidden-dragon.jpg'/><meta name='og:image:width' content='1200'/> <meta name='twitter:image:width' content='1200'/><meta name='og:image:height' content='516'/> <meta name='twitter:image:height' content='516'/><meta name='twitter:card' content='summary_large_image'/><meta name='twitter:image:alt' content='Crouching Tiger, Hidden Dragon (2000) by Ang Lee'/> </head> <body><div class="wrapper"> <aside class="header-toggle unprintable" id="header-toggle" title="Show the menu" onclick="$('#header').show();$('#header-toggle').hide();">&#9776;</aside> <header class="header" id="header"><div class="face"> <a href="/about-me.html#form" class="sub" title="Click to subscribe to my monthly newsletter"><span>Subscribe</span></a> <a href="/about-me.html" style="position:relative;"> <img src="/images/face-256x256.jpg" class="photo" alt="Yegor Bugayenko"/> </a></div><nav><ul class="menu social notranslate"> <li><a href="https://twitter.com/intent/follow?screen_name=yegor256" rel="nofollow" title="Follow me on Twitter"><i class="icon icon-twitter notranslate" aria-hidden="true"></i></a></li> <li><a href="/rss.xml" rel="nofollow" title="Subscribe to my RSS feed"><i class="icon icon-rss notranslate" aria-hidden="true"></i></a></li> <li><a itemprop="sameAs" href="https://github.com/yegor256" rel="nofollow" title="My GitHub profile"><i class="icon icon-github notranslate" aria-hidden="true"></i></a></li> <li><a itemprop="sameAs" href="http://stackoverflow.com/users/187141/yegor256" rel="nofollow" title="My StackOverflow profile"><i class="icon icon-stackoverflow notranslate" aria-hidden="true"></i></a></li> <li><a itemprop="sameAs" href="https://www.facebook.com/yegor256" rel="nofollow" title="Follow me on Facebook"><i class="icon icon-facebook notranslate" aria-hidden="true"></i></a></li> <li><a itemprop="sameAs" href="https://instagram.com/yegor256" rel="nofollow" title="Follow me on Instagram"><i class="icon icon-instagram notranslate" aria-hidden="true"></i></a></li> <li><a itemprop="sameAs" href="https://www.linkedin.com/in/yegor256" rel="nofollow" title="My LinkedIn profile"><i class="icon icon-linkedin notranslate" aria-hidden="true"></i></a></li> <li><a itemprop="sameAs" href="https://www.youtube.com/c/yegor256?sub_confirmation=1" rel="nofollow" title="My Youtube video channel"><i class="icon icon-youtube notranslate" aria-hidden="true"></i></a></li> <li><a itemprop="sameAs" href="https://www.pinterest.com/yegor256/" rel="nofollow" title="My Pinterest boards"><i class="icon icon-pinterest notranslate" aria-hidden="true"></i></a></li> <li><a itemprop="sameAs" href="https://angel.co/yegor256" rel="nofollow" title="My AngelList profile"><i class="icon icon-angellist notranslate" aria-hidden="true"></i></a></li> <li><a href="https://soundcloud.com/yegor256" rel="nofollow" title="My podcast"><i class="icon icon-podcast notranslate" aria-hidden="true"></i></a></li> <li><a href="https://itunes.apple.com/us/podcast/yegor256-podcast/id1150826721" rel="nofollow" title="My iTunes podcast"><i class="icon icon-itunes notranslate" aria-hidden="true"></i></a></li> <li><a href="https://t.me/joinchat/AAAAAEJFMRzsRTRxM3ec6A" rel="nofollow" title="My Telegram public channel"><i class="icon icon-telegram notranslate" aria-hidden="true"></i></a></li> <li><a href="mailto:blog@yegor256.com" rel="nofollow" title="Email me any time"><i class="icon icon-mail notranslate" aria-hidden="true"></i></a></li></ul><ul class="menu"> <li><a href="/" title="Home page">Home</a></li> <li ><a href="/best.html" title="Best articles to read">12&#160;Best</a></li> <li ><a href="/contents.html" title="The contents of the entire blog">All&#160;288</a></li> <li ><a href="/webinars.html" title="My webinars">Webinars</a></li> <li ><a href="/talks.html" title="Future and past conference talks">Talks</a></li> <li ><a href="/books.html" title="The books I wrote">Books</a></li> <li ><a href="/papers.html" title="My academic papers and patents">Papers</a></li> <li ><a href="/pets.html" title="My loved pet projects">Pets</a></li> <li ><a href="/award.html" title="Software quality award">Award</a></li> <li ><a href="/testimonials.html" title="What some people say about me">Testimonials</a></li> <li ><a href="/shift-m.html" title="Audio podcast about project management">Shift-M</a></li> <li ><a href="/paintings.html" title="My paintings for sale">Paintings</a></li> <li><a href="http://ru.yegor256.com/" title="Немного на русском языке">По-русски</a></li></ul></nav><div class="search"> <form method="get" action="https://www.google.com/search" itemprop="potentialAction" itemscope="" itemtype="http://schema.org/SearchAction"> <meta itemprop="target" content="https://www.google.com/search?q={q}"/> <input name="sitesearch" value="yegor256.com" type="hidden"/> <input itemprop="query-input" type="text" id="search-query" class="field field-text" required="required" onfocus="$('.google').css('visibility', 'visible');" name="q" placeholder="Search..." autocomplete="off"/> <input type="image" src="/images/google-search-icon.svg" class="google" title="Search via Google" alt="Search via Google"/> </form></div><div class="hot"><ul> <li> <a href="/code-ahead.html">Code Ahead</a> was published on Amazon just a few days ago! It is my new book, a novel about programmers. It explains in details the majority of ideas that stand behind <a href="https://www.zerocracy.com">Zerocracy</a> and <a href="https://www.xdsd.org">XDSD</a>. </li> <li> At <a href="/webinars.html">Webinar #37</a> we will discuss naming problem in OOP, for objects, methods and attributes; join us on <b>September 12</b>, at 11am PST. </li></ul></div></header></div><section itemscope="" itemtype="http://schema.org/BlogPosting"><div class="wrapper"> <header><p class="printable"> <img src="https://api.qrserver.com/v1/create-qr-code/?data=https://www.yegor256.com/2015/10/20/interrupted-exception.html&amp;format=svg" style="width:125px;height:125px;" alt="QR code"/></p><p class="printable"> <code itemprop="url">https://www.yegor256.com/2015/10/20/interrupted-exception.html</code></p><h1 itemprop="name headline mainEntityOfPage">What Do You Do With InterruptedException?</h1><ul class="subline"> <li> <time itemprop="datePublished" datetime="2015-10-20T00:00:00+00:00"> 20 October 2015 </time> </li> <li class="desktop-only" itemprop="locationCreated">Palo Alto, CA</li> <li class="printable" itemscope="" itemprop="author" itemtype="http://schema.org/Person"> <span itemprop="name">Yegor Bugayenko</span> </li> <li class="unprintable"> <i class="icon icon-comments"></i> <a href="http://www.yegor256.com/2015/10/20/interrupted-exception.html#disqus_thread" itemprop="discussionUrl">comments</a> </li></ul><figure class='jb_picture'><img itemprop='image' alt='Crouching Tiger, Hidden Dragon (2000) by Ang Lee' src='/images/2015/10/crouching-tiger-hidden-dragon.jpg' longdesc='#cea24c27'/><figcaption id='cea24c27'>Crouching Tiger, Hidden Dragon (2000) by Ang Lee</figcaption></figure><p>Let&#39;s start with this code:</p><figure class="highlight"><pre><code class="language-java" data-lang="java"><span></span><span class="k">while</span> <span class="o">(</span><span class="kc">true</span><span class="o">)</span> <span class="o">{</span>
  <span class="c1">// Nothing</span>
<span class="o">}</span></code></pre></figure><p>What does it do? Nothing, it just spins the CPU endlessly. Can we terminate it? Not in Java. It will only stop when the entire JVM stops, when you hit <code>Ctrl-C</code>. There is no way in Java to terminate a thread unless the thread exits by itself. That&#39;s the principle we have to have in mind, and everything else will just be obvious.</p><p>Let&#39;s put this endless loop into a thread:</p><figure class="highlight"><pre><code class="language-java" data-lang="java"><span></span><span class="n">Thread</span> <span class="n">loop</span> <span class="o">=</span> <span class="k">new</span> <span class="n">Thread</span><span class="o">(</span>
  <span class="k">new</span> <span class="n">Runnable</span><span class="o">()</span> <span class="o">{</span>
    <span class="nd">@Override</span>
    <span class="kd">public</span> <span class="kt">void</span> <span class="nf">run</span><span class="o">()</span> <span class="o">{</span>
      <span class="k">while</span> <span class="o">(</span><span class="kc">true</span><span class="o">)</span> <span class="o">{</span>
      <span class="o">}</span>
    <span class="o">}</span>
  <span class="o">}</span>
<span class="o">);</span>
<span class="n">loop</span><span class="o">.</span><span class="na">start</span><span class="o">();</span>
<span class="c1">// Now how do we stop it?</span></code></pre></figure><p>So, how do we stop a thread when we need it to stop?</p><p>Here is how it is designed in Java. There is a flag in every thread that we can set from the outside. And the thread may check it occasionally and stop its execution. Voluntarily! Here is how:</p><figure class="highlight"><pre><code class="language-java" data-lang="java"><span></span><span class="n">Thread</span> <span class="n">loop</span> <span class="o">=</span> <span class="k">new</span> <span class="n">Thread</span><span class="o">(</span>
  <span class="k">new</span> <span class="n">Runnable</span><span class="o">()</span> <span class="o">{</span>
    <span class="nd">@Override</span>
    <span class="kd">public</span> <span class="kt">void</span> <span class="nf">run</span><span class="o">()</span> <span class="o">{</span>
      <span class="k">while</span> <span class="o">(</span><span class="kc">true</span><span class="o">)</span> <span class="o">{</span>
        <span class="k">if</span> <span class="o">(</span><span class="n">Thread</span><span class="o">.</span><span class="na">interrupted</span><span class="o">())</span> <span class="o">{</span>
          <span class="k">break</span><span class="o">;</span>
        <span class="o">}</span>
        <span class="c1">// Continue to do nothing</span>
      <span class="o">}</span>
    <span class="o">}</span>
  <span class="o">}</span>
<span class="o">);</span>
<span class="n">loop</span><span class="o">.</span><span class="na">start</span><span class="o">();</span>
<span class="n">loop</span><span class="o">.</span><span class="na">interrupt</span><span class="o">();</span></code></pre></figure><p>This is the only way to ask a thread to stop. There are two methods that are used in this example. When I call <code>loop.interrupt()</code>, a flag is set to <code>true</code> somewhere inside the thread <code>loop</code>. When I call <a href="http://docs.oracle.com/javase/7/docs/api/java/lang/Thread.html#interrupted%28%29"><code>interrupted()</code></a>, the flag is returned and immediately set to <code>false</code>. Yeah, that&#39;s the design of the method. It checks the flag, returns it, and sets it to <code>false</code>. It&#39;s ugly, I know.</p><p>Thus, if I never call <code>Thread.interrupted()</code> inside the thread and don&#39;t exit when the flag is <code>true</code>, nobody will be able to stop me. Literally, I will just ignore their calls to <code>interrupt()</code>. They will ask me to stop, but I will ignore them. They won&#39;t be able to interrupt me.</p><p>Thus, to summarize what we&#39;ve learned so far, a properly designed thread will check that flag once in a while and stop gracefully. If the code doesn&#39;t check the flag and never calls <code>Thread.interrupted()</code>, it accepts the fact that sooner or later it will be terminated cold turkey, by clicking <code>Ctrl-C</code>.</p><aside class='quote'>The code should either be bullet-fast or interruption-ready, nothing in between.</aside><p>Sound logical so far? I hope so.</p><p>Now, there are some methods in JDK that check the flag for us and throw <a href="http://docs.oracle.com/javase/7/docs/api/java/lang/InterruptedException.html"><code>InterruptedException</code></a> if it is set. For example, this is how the method <a href="http://docs.oracle.com/javase/7/docs/api/java/lang/Thread.html#sleep%28long%29"><code>Thread.sleep()</code></a> is designed (taking a very primitive approach):</p><figure class="highlight"><pre><code class="language-java" data-lang="java"><span></span><span class="kd">public</span> <span class="kd">static</span> <span class="kt">void</span> <span class="nf">sleep</span><span class="o">(</span><span class="kt">long</span> <span class="n">millis</span><span class="o">)</span>
  <span class="kd">throws</span> <span class="n">InterruptedException</span> <span class="o">{</span>
  <span class="k">while</span> <span class="o">(</span><span class="cm">/* You still need to wait */</span><span class="o">)</span> <span class="o">{</span>
    <span class="k">if</span> <span class="o">(</span><span class="n">Thread</span><span class="o">.</span><span class="na">interrupted</span><span class="o">())</span> <span class="o">{</span>
      <span class="k">throw</span> <span class="k">new</span> <span class="n">InterruptedException</span><span class="o">();</span>
    <span class="o">}</span>
    <span class="c1">// Keep waiting</span>
  <span class="o">}</span>
<span class="o">}</span></code></pre></figure><p>Why is it done this way? Why can&#39;t it just wait and never check the flag? Well, I believe it&#39;s done for a good reason. And the reason is the following (correct me if I&#39;m wrong): The code should either be bullet-fast or interruption-ready, nothing in between.</p><p>If your code is fast, you never check the interruption flag, because you don&#39;t want to deal with any interruptions. If your code is slow and may take seconds to execute, make it explicit and handle interruptions somehow.</p><p>That&#39;s why <code>InterruptedException</code> is a <a href="/2015/07/28/checked-vs-unchecked-exceptions.html">checked</a> exception. Its design tells you that if you want to pause for a few milliseconds, make your code interruption-ready. This is how it looks in practice:</p><figure class="highlight"><pre><code class="language-java" data-lang="java"><span></span><span class="k">try</span> <span class="o">{</span>
  <span class="n">Thread</span><span class="o">.</span><span class="na">sleep</span><span class="o">(</span><span class="mi">100</span><span class="o">);</span>
<span class="o">}</span> <span class="k">catch</span> <span class="o">(</span><span class="n">InterruptedException</span> <span class="n">ex</span><span class="o">)</span> <span class="o">{</span>
  <span class="c1">// Stop immediately and go home</span>
<span class="o">}</span></code></pre></figure><p>Well, you could let it float up to a higher level, where they will be responsible for catching it. The point is that someone will have to catch it and do something with the thread. Ideally, just stop it, since that&#39;s what the flag is about. If <code>InterruptedException</code> is thrown, it means someone checked the flag and our thread has to finish what it&#39;s doing ASAP.</p><p>The owner of the thread <a href="/2014/06/20/limit-method-execution-time.html">doesn&#39;t want to wait</a> any longer. And we must respect the decision of our owner.</p><p>Thus, when you catch <code>InterruptedException</code>, you have to do whatever it takes to wrap up what you&#39;re doing and exit.</p><p>Now, look again at the code of <code>Thread.sleep()</code>:</p><figure class="highlight"><pre><code class="language-java" data-lang="java"><span></span><span class="kd">public</span> <span class="kd">static</span> <span class="kt">void</span> <span class="nf">sleep</span><span class="o">(</span><span class="kt">long</span> <span class="n">millis</span><span class="o">)</span>
  <span class="kd">throws</span> <span class="n">InterruptedException</span> <span class="o">{</span>
  <span class="k">while</span> <span class="o">(</span><span class="cm">/* ... */</span><span class="o">)</span> <span class="o">{</span>
    <span class="k">if</span> <span class="o">(</span><span class="n">Thread</span><span class="o">.</span><span class="na">interrupted</span><span class="o">())</span> <span class="o">{</span>
      <span class="k">throw</span> <span class="k">new</span> <span class="n">InterruptedException</span><span class="o">();</span>
    <span class="o">}</span>
  <span class="o">}</span>
<span class="o">}</span></code></pre></figure><p>Remember, <code>Thread.interrupted()</code> not only returns the flag but also sets it to <code>false</code>. Thus, once <code>InterruptedException</code> is thrown, the flag is reset. The thread no longer knows anything about the interruption request sent by the owner.</p><p>The owner of the thread asked us to stop, <code>Thread.sleep()</code> detected that request, removed it, and threw <code>InterruptedException</code>. If you call <code>Thread.sleep()</code>, again, it will not know anything about that interruption request and will not <a href="/2015/12/01/rethrow-exceptions.html">throw</a> anything.</p><p>See what I&#39;m getting at? It&#39;s very important not to lose that <code>InterruptedException</code>. We can&#39;t just swallow it and move on. That would be a severe violation of the entire Java multi-threading idea. Our owner (the owner of our thread) is asking us to stop, and we just ignore it. That&#39;s a very bad idea.</p><p>This is what most of us are doing with <code>InterruptedException</code>:</p><figure class="highlight"><pre><code class="language-java" data-lang="java"><span></span><span class="k">try</span> <span class="o">{</span>
  <span class="n">Thread</span><span class="o">.</span><span class="na">sleep</span><span class="o">(</span><span class="mi">100</span><span class="o">);</span>
<span class="o">}</span> <span class="k">catch</span> <span class="o">(</span><span class="n">InterruptedException</span> <span class="n">ex</span><span class="o">)</span> <span class="o">{</span>
  <span class="k">throw</span> <span class="k">new</span> <span class="n">RuntimeException</span><span class="o">(</span><span class="n">ex</span><span class="o">);</span>
<span class="o">}</span></code></pre></figure><p>It looks logical, but it doesn&#39;t guarantee that the higher level will actually stop everything and exit. They may just catch a runtime exception there, and the thread will remain alive. The owner of the thread will be disappointed.</p><p>We have to inform the higher level that we just caught an interruption request. We can&#39;t just throw a runtime exception. Such behavior would be too <a href="/2015/11/24/imprisonment-for-irresponsible-coding.html">irresponsible</a>. The entire thread received an interruption request, and we merely swallow it and convert it into a <code>RuntimeException</code>. We can&#39;t treat such a serious situation so loosely.</p><p>This is what we have to do:</p><figure class="highlight"><pre><code class="language-java" data-lang="java"><span></span><span class="k">try</span> <span class="o">{</span>
  <span class="n">Thread</span><span class="o">.</span><span class="na">sleep</span><span class="o">(</span><span class="mi">100</span><span class="o">);</span>
<span class="o">}</span> <span class="k">catch</span> <span class="o">(</span><span class="n">InterruptedException</span> <span class="n">ex</span><span class="o">)</span> <span class="o">{</span>
  <span class="n">Thread</span><span class="o">.</span><span class="na">currentThread</span><span class="o">().</span><span class="na">interrupt</span><span class="o">();</span> <span class="c1">// Here!</span>
  <span class="k">throw</span> <span class="k">new</span> <span class="n">RuntimeException</span><span class="o">(</span><span class="n">ex</span><span class="o">);</span>
<span class="o">}</span></code></pre></figure><p>We&#39;re setting the flag back to <code>true</code>!</p><p>Now, nobody will blame us for having an irresponsible attitude toward a valuable flag. We found it in <code>true</code> status, cleared it, set it back to <code>true</code>, and threw a runtime exception. What happens next, we don&#39;t care.</p><p>I think that&#39;s it. You can find a more detailed and official description of this problem here: <a href="http://www.ibm.com/developerworks/library/j-jtp05236/">Java Theory and Practice: Dealing With <code>InterruptedException</code></a>.</p></p>--> <nav class="buttons notranslate desktop-only"> <a href="http://www.facebook.com/sharer/sharer.php?u=https://www.yegor256.com/2015/10/20/interrupted-exception.html" title="Share on Facebook" class="button" rel="nofollow"> <span class="count count-facebook">0</span> <i class="icon icon-facebook notranslate" aria-hidden="true"></i> </a> <a href="https://twitter.com/share?url=https://www.yegor256.com/2015/10/20/interrupted-exception.html&amp;text=What+Do+You+Do+With+InterruptedException%3F" title="Share on Twitter" class="button" rel="nofollow"> <span class="count count-twitter">0</span> <i class="icon icon-twitter notranslate" aria-hidden="true"></i> </a> <a href="https://plus.google.com/share?url=https://www.yegor256.com/2015/10/20/interrupted-exception.html" title="Share on Google+" class="button" rel="nofollow"> <span class="count count-googleplus">0</span> <i class="icon icon-googleplus notranslate" aria-hidden="true"></i> </a> <a href="https://www.linkedin.com/cws/share?url=https://www.yegor256.com/2015/10/20/interrupted-exception.html" title="Share on LinkedIn" class="button" rel="nofollow"> <span class="count count-linkedin">0</span> <i class="icon icon-linkedin notranslate" aria-hidden="true"></i> </a> <a href="http://reddit.com/submit?url=https://www.yegor256.com/2015/10/20/interrupted-exception.html%3F2015-42&amp;title=What+Do+You+Do+With+InterruptedException%3F" title="Share on Reddit" class="button" rel="nofollow"> <span class="count count-reddit">0</span> <i class="icon icon-reddit notranslate" aria-hidden="true"></i> </a> <a href="http://news.ycombinator.com/submitlink?u=https://www.yegor256.com/2015/10/20/interrupted-exception.html%3F2015-42&amp;t=What+Do+You+Do+With+InterruptedException%3F" title="Share on Hacker News" class="button" rel="nofollow"> <span class="count count-hackernews">0</span> <i class="icon icon-hackernews notranslate" aria-hidden="true"></i> </a> </nav> </header> <article class="main" itemprop="articleBody"><div ><p><a href="http://docs.oracle.com/javase/7/docs/api/java/lang/InterruptedException.html"><code>InterruptedException</code></a> is a permanent source of pain in Java, for junior developers especially. But it shouldn&#39;t be. It&#39;s a rather simple and easy-to-understand idea. Let me try to describe and simplify it.</p><figure class='jb_picture'><img itemprop='image' alt='Crouching Tiger, Hidden Dragon (2000) by Ang Lee' src='/images/2015/10/crouching-tiger-hidden-dragon.jpg' longdesc='#cea24c27'/><figcaption id='cea24c27'>Crouching Tiger, Hidden Dragon (2000) by Ang Lee</figcaption></figure><p>Let&#39;s start with this code:</p><figure class="highlight"><pre><code class="language-java" data-lang="java"><span></span><span class="k">while</span> <span class="o">(</span><span class="kc">true</span><span class="o">)</span> <span class="o">{</span>
  <span class="c1">// Nothing</span>
<span class="o">}</span></code></pre></figure><p>What does it do? Nothing, it just spins the CPU endlessly. Can we terminate it? Not in Java. It will only stop when the entire JVM stops, when you hit <code>Ctrl-C</code>. There is no way in Java to terminate a thread unless the thread exits by itself. That&#39;s the principle we have to have in mind, and everything else will just be obvious.</p><p>Let&#39;s put this endless loop into a thread:</p><figure class="highlight"><pre><code class="language-java" data-lang="java"><span></span><span class="n">Thread</span> <span class="n">loop</span> <span class="o">=</span> <span class="k">new</span> <span class="n">Thread</span><span class="o">(</span>
  <span class="k">new</span> <span class="n">Runnable</span><span class="o">()</span> <span class="o">{</span>
    <span class="nd">@Override</span>
    <span class="kd">public</span> <span class="kt">void</span> <span class="nf">run</span><span class="o">()</span> <span class="o">{</span>
      <span class="k">while</span> <span class="o">(</span><span class="kc">true</span><span class="o">)</span> <span class="o">{</span>
      <span class="o">}</span>
    <span class="o">}</span>
  <span class="o">}</span>
<span class="o">);</span>
<span class="n">loop</span><span class="o">.</span><span class="na">start</span><span class="o">();</span>
<span class="c1">// Now how do we stop it?</span></code></pre></figure><p>So, how do we stop a thread when we need it to stop?</p><p>Here is how it is designed in Java. There is a flag in every thread that we can set from the outside. And the thread may check it occasionally and stop its execution. Voluntarily! Here is how:</p><figure class="highlight"><pre><code class="language-java" data-lang="java"><span></span><span class="n">Thread</span> <span class="n">loop</span> <span class="o">=</span> <span class="k">new</span> <span class="n">Thread</span><span class="o">(</span>
  <span class="k">new</span> <span class="n">Runnable</span><span class="o">()</span> <span class="o">{</span>
    <span class="nd">@Override</span>
    <span class="kd">public</span> <span class="kt">void</span> <span class="nf">run</span><span class="o">()</span> <span class="o">{</span>
      <span class="k">while</span> <span class="o">(</span><span class="kc">true</span><span class="o">)</span> <span class="o">{</span>
        <span class="k">if</span> <span class="o">(</span><span class="n">Thread</span><span class="o">.</span><span class="na">interrupted</span><span class="o">())</span> <span class="o">{</span>
          <span class="k">break</span><span class="o">;</span>
        <span class="o">}</span>
        <span class="c1">// Continue to do nothing</span>
      <span class="o">}</span>
    <span class="o">}</span>
  <span class="o">}</span>
<span class="o">);</span>
<span class="n">loop</span><span class="o">.</span><span class="na">start</span><span class="o">();</span>
<span class="n">loop</span><span class="o">.</span><span class="na">interrupt</span><span class="o">();</span></code></pre></figure><p>This is the only way to ask a thread to stop. There are two methods that are used in this example. When I call <code>loop.interrupt()</code>, a flag is set to <code>true</code> somewhere inside the thread <code>loop</code>. When I call <a href="http://docs.oracle.com/javase/7/docs/api/java/lang/Thread.html#interrupted%28%29"><code>interrupted()</code></a>, the flag is returned and immediately set to <code>false</code>. Yeah, that&#39;s the design of the method. It checks the flag, returns it, and sets it to <code>false</code>. It&#39;s ugly, I know.</p><p>Thus, if I never call <code>Thread.interrupted()</code> inside the thread and don&#39;t exit when the flag is <code>true</code>, nobody will be able to stop me. Literally, I will just ignore their calls to <code>interrupt()</code>. They will ask me to stop, but I will ignore them. They won&#39;t be able to interrupt me.</p><p>Thus, to summarize what we&#39;ve learned so far, a properly designed thread will check that flag once in a while and stop gracefully. If the code doesn&#39;t check the flag and never calls <code>Thread.interrupted()</code>, it accepts the fact that sooner or later it will be terminated cold turkey, by clicking <code>Ctrl-C</code>.</p><aside class='quote'>The code should either be bullet-fast or interruption-ready, nothing in between.</aside><p>Sound logical so far? I hope so.</p><p>Now, there are some methods in JDK that check the flag for us and throw <a href="http://docs.oracle.com/javase/7/docs/api/java/lang/InterruptedException.html"><code>InterruptedException</code></a> if it is set. For example, this is how the method <a href="http://docs.oracle.com/javase/7/docs/api/java/lang/Thread.html#sleep%28long%29"><code>Thread.sleep()</code></a> is designed (taking a very primitive approach):</p><figure class="highlight"><pre><code class="language-java" data-lang="java"><span></span><span class="kd">public</span> <span class="kd">static</span> <span class="kt">void</span> <span class="nf">sleep</span><span class="o">(</span><span class="kt">long</span> <span class="n">millis</span><span class="o">)</span>
  <span class="kd">throws</span> <span class="n">InterruptedException</span> <span class="o">{</span>
  <span class="k">while</span> <span class="o">(</span><span class="cm">/* You still need to wait */</span><span class="o">)</span> <span class="o">{</span>
    <span class="k">if</span> <span class="o">(</span><span class="n">Thread</span><span class="o">.</span><span class="na">interrupted</span><span class="o">())</span> <span class="o">{</span>
      <span class="k">throw</span> <span class="k">new</span> <span class="n">InterruptedException</span><span class="o">();</span>
    <span class="o">}</span>
    <span class="c1">// Keep waiting</span>
  <span class="o">}</span>
<span class="o">}</span></code></pre></figure><p>Why is it done this way? Why can&#39;t it just wait and never check the flag? Well, I believe it&#39;s done for a good reason. And the reason is the following (correct me if I&#39;m wrong): The code should either be bullet-fast or interruption-ready, nothing in between.</p><p>If your code is fast, you never check the interruption flag, because you don&#39;t want to deal with any interruptions. If your code is slow and may take seconds to execute, make it explicit and handle interruptions somehow.</p><p>That&#39;s why <code>InterruptedException</code> is a <a href="/2015/07/28/checked-vs-unchecked-exceptions.html">checked</a> exception. Its design tells you that if you want to pause for a few milliseconds, make your code interruption-ready. This is how it looks in practice:</p><figure class="highlight"><pre><code class="language-java" data-lang="java"><span></span><span class="k">try</span> <span class="o">{</span>
  <span class="n">Thread</span><span class="o">.</span><span class="na">sleep</span><span class="o">(</span><span class="mi">100</span><span class="o">);</span>
<span class="o">}</span> <span class="k">catch</span> <span class="o">(</span><span class="n">InterruptedException</span> <span class="n">ex</span><span class="o">)</span> <span class="o">{</span>
  <span class="c1">// Stop immediately and go home</span>
<span class="o">}</span></code></pre></figure><p>Well, you could let it float up to a higher level, where they will be responsible for catching it. The point is that someone will have to catch it and do something with the thread. Ideally, just stop it, since that&#39;s what the flag is about. If <code>InterruptedException</code> is thrown, it means someone checked the flag and our thread has to finish what it&#39;s doing ASAP.</p><p>The owner of the thread <a href="/2014/06/20/limit-method-execution-time.html">doesn&#39;t want to wait</a> any longer. And we must respect the decision of our owner.</p><p>Thus, when you catch <code>InterruptedException</code>, you have to do whatever it takes to wrap up what you&#39;re doing and exit.</p><p>Now, look again at the code of <code>Thread.sleep()</code>:</p><figure class="highlight"><pre><code class="language-java" data-lang="java"><span></span><span class="kd">public</span> <span class="kd">static</span> <span class="kt">void</span> <span class="nf">sleep</span><span class="o">(</span><span class="kt">long</span> <span class="n">millis</span><span class="o">)</span>
  <span class="kd">throws</span> <span class="n">InterruptedException</span> <span class="o">{</span>
  <span class="k">while</span> <span class="o">(</span><span class="cm">/* ... */</span><span class="o">)</span> <span class="o">{</span>
    <span class="k">if</span> <span class="o">(</span><span class="n">Thread</span><span class="o">.</span><span class="na">interrupted</span><span class="o">())</span> <span class="o">{</span>
      <span class="k">throw</span> <span class="k">new</span> <span class="n">InterruptedException</span><span class="o">();</span>
    <span class="o">}</span>
  <span class="o">}</span>
<span class="o">}</span></code></pre></figure><p>Remember, <code>Thread.interrupted()</code> not only returns the flag but also sets it to <code>false</code>. Thus, once <code>InterruptedException</code> is thrown, the flag is reset. The thread no longer knows anything about the interruption request sent by the owner.</p><p>The owner of the thread asked us to stop, <code>Thread.sleep()</code> detected that request, removed it, and threw <code>InterruptedException</code>. If you call <code>Thread.sleep()</code>, again, it will not know anything about that interruption request and will not <a href="/2015/12/01/rethrow-exceptions.html">throw</a> anything.</p><p>See what I&#39;m getting at? It&#39;s very important not to lose that <code>InterruptedException</code>. We can&#39;t just swallow it and move on. That would be a severe violation of the entire Java multi-threading idea. Our owner (the owner of our thread) is asking us to stop, and we just ignore it. That&#39;s a very bad idea.</p><p>This is what most of us are doing with <code>InterruptedException</code>:</p><figure class="highlight"><pre><code class="language-java" data-lang="java"><span></span><span class="k">try</span> <span class="o">{</span>
  <span class="n">Thread</span><span class="o">.</span><span class="na">sleep</span><span class="o">(</span><span class="mi">100</span><span class="o">);</span>
<span class="o">}</span> <span class="k">catch</span> <span class="o">(</span><span class="n">InterruptedException</span> <span class="n">ex</span><span class="o">)</span> <span class="o">{</span>
  <span class="k">throw</span> <span class="k">new</span> <span class="n">RuntimeException</span><span class="o">(</span><span class="n">ex</span><span class="o">);</span>
<span class="o">}</span></code></pre></figure><p>It looks logical, but it doesn&#39;t guarantee that the higher level will actually stop everything and exit. They may just catch a runtime exception there, and the thread will remain alive. The owner of the thread will be disappointed.</p><p>We have to inform the higher level that we just caught an interruption request. We can&#39;t just throw a runtime exception. Such behavior would be too <a href="/2015/11/24/imprisonment-for-irresponsible-coding.html">irresponsible</a>. The entire thread received an interruption request, and we merely swallow it and convert it into a <code>RuntimeException</code>. We can&#39;t treat such a serious situation so loosely.</p><p>This is what we have to do:</p><figure class="highlight"><pre><code class="language-java" data-lang="java"><span></span><span class="k">try</span> <span class="o">{</span>
  <span class="n">Thread</span><span class="o">.</span><span class="na">sleep</span><span class="o">(</span><span class="mi">100</span><span class="o">);</span>
<span class="o">}</span> <span class="k">catch</span> <span class="o">(</span><span class="n">InterruptedException</span> <span class="n">ex</span><span class="o">)</span> <span class="o">{</span>
  <span class="n">Thread</span><span class="o">.</span><span class="na">currentThread</span><span class="o">().</span><span class="na">interrupt</span><span class="o">();</span> <span class="c1">// Here!</span>
  <span class="k">throw</span> <span class="k">new</span> <span class="n">RuntimeException</span><span class="o">(</span><span class="n">ex</span><span class="o">);</span>
<span class="o">}</span></code></pre></figure><p>We&#39;re setting the flag back to <code>true</code>!</p><p>Now, nobody will blame us for having an irresponsible attitude toward a valuable flag. We found it in <code>true</code> status, cleared it, set it back to <code>true</code>, and threw a runtime exception. What happens next, we don&#39;t care.</p><p>I think that&#39;s it. You can find a more detailed and official description of this problem here: <a href="http://www.ibm.com/developerworks/library/j-jtp05236/">Java Theory and Practice: Dealing With <code>InterruptedException</code></a>.</p></div></article></div><div class="wrapper"> <related-posts /></div><div class="disqus" role="complementary"><p class="disqus_hint"> Please, use <a href="https://help.disqus.com/commenting/what-html-tags-are-allowed-within-comments">syntax highlighting</a> in your comments, to make them more readable.</p><div id="disqus_thread" class="disqus-thread"> <a>&nbsp;</a></div><script> var disqus_config = function () { this.page.url = document.location.href.split('?')[0].split('#')[0].replace('https://', 'http://'); this.page.identifier = this.page.url; }; (function() { var d = document, s = d.createElement('script'); s.src = '//yegor256.disqus.com/embed.js'; s.setAttribute('data-timestamp', +new Date()); (d.head || d.body).appendChild(s); })(); </script> <noscript><div><p class="red"> JavaScript is disabled in your browser, that's why you can't see comments under this post.</p></div></noscript></div><div class="wrapper"> <footer class="footer"><p> &copy; <span itemscope="" itemprop="copyrightHolder" itemtype="http://schema.org/Person"> <span itemprop="name">Yegor Bugayenko</span> </span> 2014&ndash;<span itemprop="copyrightYear">2018</span></p></footer></div></section><div class="wrapper unprintable" style="text-align:center;margin-top:2em;"> <a href="http://www.sixnines.io/h/3ba1652f"> <img src="//www.sixnines.io/b/3ba1652f?style=flat" alt="sixnines availability badge"/> </a></div><script src="//code.jquery.com/jquery-1.9.0.min.js"></script> <script src="/js/all.js?4e047f6f42b"></script> <script>var disqus_shortname = 'yegor256';</script> <script id="dsq-count-scr" src="//yegor256.disqus.com/count.js" async="async"></script> <script> (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){ (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o), m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m) })(window,document,'script','//www.google-analytics.com/analytics.js','ga'); ga('create', 'UA-1963507-32', 'auto'); ga('send', 'pageview'); </script> <script> Cd=document;Cr="&"+Math.random();Cp="&s=1"; Cd.cookie="b=b";if(Cd.cookie)Cp+="&c=1"; Cp+="&t="+(new Date()).getTimezoneOffset(); if(self!=top)Cp+="&f=1"; </script> <script> if(navigator.javaEnabled())Cp+="&j=1"; </script> <script> if(typeof(screen)!='undefined')Cp+="&w="+screen.width+"&h="+ screen.height+"&d="+(screen.colorDepth?screen.colorDepth:screen.pixelDepth); </script> <script> Cd.write("<img src='//c.hit.ua/hit?i=95870&g=0&x=2"+Cp+Cr+ "&r="+escape(Cd.referrer)+"&u="+escape(window.location.href)+ "' border='0' wi"+"dth='1' he"+"ight='1'/>"); </script> <script type="application/ld+json"> { "@context": "http://schema.org", "@type": "Person", "name": "Yegor Bugayenko", "url": "http://www.yegor256.com", "sameAs": [ "https://www.facebook.com/yegor256", "https://instagram.com/yegor256", "https://www.linkedin.com/in/yegor256", "https://twitter.com/yegor256", "https://github.com/yegor256", "https://www.pinterest.com/yegor256/" ] } </script> </body> </html> <!DOCTYPE html> <html xmlns="http://www.w3.org/1999/xhtml" lang="en-US" xml:lang="en-US" itemscope="" itemtype="http://schema.org/WebSite"> <head> <meta charset="utf-8"/> <meta name="description" content="Decorators are used to extend object functionality without changing their interfaces, and there are two approaches: horizontal and vertical. " /> <meta name="keywords" content="composable decorators, decorator java, decorator pattern, decorator pattern java, encapsulation" /> <meta name="viewport" content="width=device-width,minimum-scale=1,initial-scale=1"/> <meta name="google-site-verification" content="JEj_gQr2CPe2QKGw8XdMz0R7VboQIUbX3FlM-lwTq-8" /> <meta name="author" content="Yegor Bugayenko"> <meta name="article:published_time" content="2015-10-01 00:00:00 +0000"> <meta name="og:site_name" content="Yegor Bugayenko"/> <meta name="og:type" content="article" /> <meta name="og:locale" content="en_US" /> <meta name="twitter:account_id" content="4503599630178231" /> <meta name="twitter:creator" content="@yegor256"/> <meta name="twitter:site" content="@yegor256"/> <meta name="twitter:title" property="og:title" content="Vertical and Horizontal Decorating"/> <meta name="twitter:description" property="og:description" content="Decorators are used to extend object functionality without changing their interfaces, and there are two approaches: horizontal and vertical. "/> <meta name="twitter:url" property="og:url" content="https://www.yegor256.com/2015/10/01/vertical-horizontal-decorating.html"/> <meta name="telegram:channel" content="AAAAAEJFMRzsRTRxM3ec6A"/> <link rel="search" type="application/opensearchdescription+xml" href="/opensearch.xml" title="yegor256" /> <link rel="shortcut icon" href="/favicon.ico?4e047f6f42b"/> <link rel="apple-touch-icon" href="/favicon.ico?4e047f6f42b"/> <link rel="alternate" type="application/rss+xml" title="RSS for yegor256.com" href="https://www.yegor256.com/rss.xml"/> <link rel="stylesheet" href="/css/layout.css?4e047f6f42b"/> <link rel="stylesheet" href="/css/icons.css?4e047f6f42b"/> <link rel="canonical" href="https://www.yegor256.com/2015/10/01/vertical-horizontal-decorating.html" /> <link rel="amphtml" href="https://www.yegor256.com/2015/10/01/vertical-horizontal-decorating.amp.html" /> <title>Vertical and Horizontal Decorating </title> <meta name='og:image' content='https://www.yegor256.com/images/2015/10/the-apartment.jpg'/><meta name='twitter:image' content='https://www.yegor256.com/images/2015/10/the-apartment.jpg'/><meta name='og:image:width' content='1107'/> <meta name='twitter:image:width' content='1107'/><meta name='og:image:height' content='727'/> <meta name='twitter:image:height' content='727'/><meta name='twitter:card' content='summary_large_image'/><meta name='twitter:image:alt' content='The Apartment (1960) by Billy Wilder'/> </head> <body><div class="wrapper"> <aside class="header-toggle unprintable" id="header-toggle" title="Show the menu" onclick="$('#header').show();$('#header-toggle').hide();">&#9776;</aside> <header class="header" id="header"><div class="face"> <a href="/about-me.html#form" class="sub" title="Click to subscribe to my monthly newsletter"><span>Subscribe</span></a> <a href="/about-me.html" style="position:relative;"> <img src="/images/face-256x256.jpg" class="photo" alt="Yegor Bugayenko"/> </a></div><nav><ul class="menu social notranslate"> <li><a href="https://twitter.com/intent/follow?screen_name=yegor256" rel="nofollow" title="Follow me on Twitter"><i class="icon icon-twitter notranslate" aria-hidden="true"></i></a></li> <li><a href="/rss.xml" rel="nofollow" title="Subscribe to my RSS feed"><i class="icon icon-rss notranslate" aria-hidden="true"></i></a></li> <li><a itemprop="sameAs" href="https://github.com/yegor256" rel="nofollow" title="My GitHub profile"><i class="icon icon-github notranslate" aria-hidden="true"></i></a></li> <li><a itemprop="sameAs" href="http://stackoverflow.com/users/187141/yegor256" rel="nofollow" title="My StackOverflow profile"><i class="icon icon-stackoverflow notranslate" aria-hidden="true"></i></a></li> <li><a itemprop="sameAs" href="https://www.facebook.com/yegor256" rel="nofollow" title="Follow me on Facebook"><i class="icon icon-facebook notranslate" aria-hidden="true"></i></a></li> <li><a itemprop="sameAs" href="https://instagram.com/yegor256" rel="nofollow" title="Follow me on Instagram"><i class="icon icon-instagram notranslate" aria-hidden="true"></i></a></li> <li><a itemprop="sameAs" href="https://www.linkedin.com/in/yegor256" rel="nofollow" title="My LinkedIn profile"><i class="icon icon-linkedin notranslate" aria-hidden="true"></i></a></li> <li><a itemprop="sameAs" href="https://www.youtube.com/c/yegor256?sub_confirmation=1" rel="nofollow" title="My Youtube video channel"><i class="icon icon-youtube notranslate" aria-hidden="true"></i></a></li> <li><a itemprop="sameAs" href="https://www.pinterest.com/yegor256/" rel="nofollow" title="My Pinterest boards"><i class="icon icon-pinterest notranslate" aria-hidden="true"></i></a></li> <li><a itemprop="sameAs" href="https://angel.co/yegor256" rel="nofollow" title="My AngelList profile"><i class="icon icon-angellist notranslate" aria-hidden="true"></i></a></li> <li><a href="https://soundcloud.com/yegor256" rel="nofollow" title="My podcast"><i class="icon icon-podcast notranslate" aria-hidden="true"></i></a></li> <li><a href="https://itunes.apple.com/us/podcast/yegor256-podcast/id1150826721" rel="nofollow" title="My iTunes podcast"><i class="icon icon-itunes notranslate" aria-hidden="true"></i></a></li> <li><a href="https://t.me/joinchat/AAAAAEJFMRzsRTRxM3ec6A" rel="nofollow" title="My Telegram public channel"><i class="icon icon-telegram notranslate" aria-hidden="true"></i></a></li> <li><a href="mailto:blog@yegor256.com" rel="nofollow" title="Email me any time"><i class="icon icon-mail notranslate" aria-hidden="true"></i></a></li></ul><ul class="menu"> <li><a href="/" title="Home page">Home</a></li> <li ><a href="/best.html" title="Best articles to read">12&#160;Best</a></li> <li ><a href="/contents.html" title="The contents of the entire blog">All&#160;288</a></li> <li ><a href="/webinars.html" title="My webinars">Webinars</a></li> <li ><a href="/talks.html" title="Future and past conference talks">Talks</a></li> <li ><a href="/books.html" title="The books I wrote">Books</a></li> <li ><a href="/papers.html" title="My academic papers and patents">Papers</a></li> <li ><a href="/pets.html" title="My loved pet projects">Pets</a></li> <li ><a href="/award.html" title="Software quality award">Award</a></li> <li ><a href="/testimonials.html" title="What some people say about me">Testimonials</a></li> <li ><a href="/shift-m.html" title="Audio podcast about project management">Shift-M</a></li> <li ><a href="/paintings.html" title="My paintings for sale">Paintings</a></li> <li><a href="http://ru.yegor256.com/" title="Немного на русском языке">По-русски</a></li></ul></nav><div class="search"> <form method="get" action="https://www.google.com/search" itemprop="potentialAction" itemscope="" itemtype="http://schema.org/SearchAction"> <meta itemprop="target" content="https://www.google.com/search?q={q}"/> <input name="sitesearch" value="yegor256.com" type="hidden"/> <input itemprop="query-input" type="text" id="search-query" class="field field-text" required="required" onfocus="$('.google').css('visibility', 'visible');" name="q" placeholder="Search..." autocomplete="off"/> <input type="image" src="/images/google-search-icon.svg" class="google" title="Search via Google" alt="Search via Google"/> </form></div><div class="hot"><ul> <li> <a href="/code-ahead.html">Code Ahead</a> was published on Amazon just a few days ago! It is my new book, a novel about programmers. It explains in details the majority of ideas that stand behind <a href="https://www.zerocracy.com">Zerocracy</a> and <a href="https://www.xdsd.org">XDSD</a>. </li> <li> At <a href="/webinars.html">Webinar #37</a> we will discuss naming problem in OOP, for objects, methods and attributes; join us on <b>September 12</b>, at 11am PST. </li></ul></div></header></div><section itemscope="" itemtype="http://schema.org/BlogPosting"><div class="wrapper"> <header><p class="printable"> <img src="https://api.qrserver.com/v1/create-qr-code/?data=https://www.yegor256.com/2015/10/01/vertical-horizontal-decorating.html&amp;format=svg" style="width:125px;height:125px;" alt="QR code"/></p><p class="printable"> <code itemprop="url">https://www.yegor256.com/2015/10/01/vertical-horizontal-decorating.html</code></p><h1 itemprop="name headline mainEntityOfPage">Vertical and Horizontal Decorating</h1><aside class='book'><a href='http://amzn.to/2qFt4Tn'><img src='/images/books/elegant-objects/cover.png' class='book-cover' alt='book cover'/></a>Read more about this subject in <a href='http://amzn.to/2qFt4Tn'>Section&nbsp;3.2.6</a><br/> of my book<a href='http://amzn.to/2qFt4Tn'><img src='/images/books/amazon-buy-button.png' class='amazon-button' alt='Click to buy'/></a></aside><ul class="subline"> <li> <time itemprop="datePublished" datetime="2015-10-01T00:00:00+00:00"> 1 October 2015 </time> </li> <li class="desktop-only" itemprop="locationCreated">Moscow, Russia</li> <li class="printable" itemscope="" itemprop="author" itemtype="http://schema.org/Person"> <span itemprop="name">Yegor Bugayenko</span> </li> <li class="unprintable"> <i class="icon icon-comments"></i> <a href="http://www.yegor256.com/2015/10/01/vertical-horizontal-decorating.html#disqus_thread" itemprop="discussionUrl">comments</a> </li></ul><figure class='jb_picture'><img itemprop='image' alt='The Apartment (1960) by Billy Wilder' src='/images/2015/10/the-apartment.jpg' longdesc='#3406debc'/><figcaption id='3406debc'>The Apartment (1960) by Billy Wilder</figcaption></figure><p>Let&#39;s say I have a list of numbers:</p><figure class="highlight"><pre><code class="language-java" data-lang="java"><span></span><span class="kd">interface</span> <span class="nc">Numbers</span> <span class="o">{</span>
  <span class="n">Iterable</span><span class="o">&lt;</span><span class="n">Integer</span><span class="o">&gt;</span> <span class="nf">iterate</span><span class="o">();</span>
<span class="o">}</span></code></pre></figure><p>Now I want to create a list that will only have odd, unique, positive, and sorted numbers. The first approach is <strong>vertical</strong> (I just made this name up):</p><figure class="highlight"><pre><code class="language-java" data-lang="java"><span></span><span class="n">Numbers</span> <span class="n">numbers</span> <span class="o">=</span> <span class="k">new</span> <span class="n">Sorted</span><span class="o">(</span>
  <span class="k">new</span> <span class="n">Unique</span><span class="o">(</span>
    <span class="k">new</span> <span class="n">Odds</span><span class="o">(</span>
      <span class="k">new</span> <span class="n">Positive</span><span class="o">(</span>
        <span class="k">new</span> <span class="n">ArrayNumbers</span><span class="o">(</span>
          <span class="k">new</span> <span class="n">Integer</span><span class="o">[]</span> <span class="o">{</span>
            <span class="o">-</span><span class="mi">1</span><span class="o">,</span> <span class="mi">78</span><span class="o">,</span> <span class="mi">4</span><span class="o">,</span> <span class="o">-</span><span class="mi">34</span><span class="o">,</span> <span class="mi">98</span><span class="o">,</span> <span class="mi">4</span><span class="o">,</span>
          <span class="o">}</span>
        <span class="o">)</span>
      <span class="o">)</span>
    <span class="o">)</span>
  <span class="o">)</span>
<span class="o">);</span></code></pre></figure><p>The second approach is <strong>horizontal</strong> (again, a name I made up):</p><figure class="highlight"><pre><code class="language-java" data-lang="java"><span></span><span class="n">Numbers</span> <span class="n">numbers</span> <span class="o">=</span> <span class="k">new</span> <span class="n">Modified</span><span class="o">(</span>
  <span class="k">new</span> <span class="n">ArrayNumbers</span><span class="o">(</span>
    <span class="k">new</span> <span class="n">Integer</span><span class="o">[]</span> <span class="o">{</span>
      <span class="o">-</span><span class="mi">1</span><span class="o">,</span> <span class="mi">78</span><span class="o">,</span> <span class="mi">4</span><span class="o">,</span> <span class="o">-</span><span class="mi">34</span><span class="o">,</span> <span class="mi">98</span><span class="o">,</span> <span class="mi">4</span><span class="o">,</span>
    <span class="o">}</span>
  <span class="o">),</span>
  <span class="k">new</span> <span class="n">Diff</span><span class="o">[]</span> <span class="o">{</span>
    <span class="k">new</span> <span class="n">Positive</span><span class="o">(),</span>
    <span class="k">new</span> <span class="n">Odds</span><span class="o">(),</span>
    <span class="k">new</span> <span class="n">Unique</span><span class="o">(),</span>
    <span class="k">new</span> <span class="n">Sorted</span><span class="o">(),</span>
  <span class="o">}</span>
<span class="o">);</span></code></pre></figure><p>See the difference? The first approach decorates <code>ArrayNumbers</code> &quot;vertically,&quot; adding functionality through the composable decorators <code>Positive</code>, <code>Odds</code>, <code>Unique</code>, and <code>Sorted</code>.</p><p>The second approach introduces the new interface <code>Diff</code>, which implements the core functionality of iterating numbers through instances of <code>Positive</code>, <code>Odds</code>, <code>Unique</code>, and <code>Sorted</code>:</p><figure class="highlight"><pre><code class="language-java" data-lang="java"><span></span><span class="kd">interface</span> <span class="nc">Diff</span> <span class="o">{</span>
  <span class="n">Iterable</span><span class="o">&lt;</span><span class="n">Integer</span><span class="o">&gt;</span> <span class="nf">apply</span><span class="o">(</span><span class="n">Iterable</span><span class="o">&lt;</span><span class="n">Integer</span><span class="o">&gt;</span> <span class="n">origin</span><span class="o">);</span>
<span class="o">}</span></code></pre></figure><p>For the user of <code>numbers</code>, both approaches are the same. The difference is only in the design. Which one is better and when? It seems that vertical decorating is easier to implement and is more suitable for smaller objects that expose just a few methods.</p><p>As for my experience, I always tend to start with vertical decorating since it&#39;s easier to implement but eventually migrate to a horizontal one when the number of decorators starts to grow.</p></p>--> <nav class="buttons notranslate desktop-only"> <a href="http://www.facebook.com/sharer/sharer.php?u=https://www.yegor256.com/2015/10/01/vertical-horizontal-decorating.html" title="Share on Facebook" class="button" rel="nofollow"> <span class="count count-facebook">0</span> <i class="icon icon-facebook notranslate" aria-hidden="true"></i> </a> <a href="https://twitter.com/share?url=https://www.yegor256.com/2015/10/01/vertical-horizontal-decorating.html&amp;text=Vertical+and+Horizontal+Decorating" title="Share on Twitter" class="button" rel="nofollow"> <span class="count count-twitter">0</span> <i class="icon icon-twitter notranslate" aria-hidden="true"></i> </a> <a href="https://plus.google.com/share?url=https://www.yegor256.com/2015/10/01/vertical-horizontal-decorating.html" title="Share on Google+" class="button" rel="nofollow"> <span class="count count-googleplus">0</span> <i class="icon icon-googleplus notranslate" aria-hidden="true"></i> </a> <a href="https://www.linkedin.com/cws/share?url=https://www.yegor256.com/2015/10/01/vertical-horizontal-decorating.html" title="Share on LinkedIn" class="button" rel="nofollow"> <span class="count count-linkedin">0</span> <i class="icon icon-linkedin notranslate" aria-hidden="true"></i> </a> <a href="http://reddit.com/submit?url=https://www.yegor256.com/2015/10/01/vertical-horizontal-decorating.html%3F2015-39&amp;title=Vertical+and+Horizontal+Decorating" title="Share on Reddit" class="button" rel="nofollow"> <span class="count count-reddit">0</span> <i class="icon icon-reddit notranslate" aria-hidden="true"></i> </a> <a href="http://news.ycombinator.com/submitlink?u=https://www.yegor256.com/2015/10/01/vertical-horizontal-decorating.html%3F2015-39&amp;t=Vertical+and+Horizontal+Decorating" title="Share on Hacker News" class="button" rel="nofollow"> <span class="count count-hackernews">0</span> <i class="icon icon-hackernews notranslate" aria-hidden="true"></i> </a> </nav> </header> <article class="main" itemprop="articleBody"><div ><p>A <a href="http://en.wikipedia.org/wiki/Decorator_pattern">decorator pattern</a> is one of the best ways to add features to an object without changing its interface. I use <a href="/2015/02/26/composable-decorators.html">composable decorators</a> quite often and always question myself as to how to design them right when the list of features must be configurable. I&#39;m not sure I have the right answer, but here is some food for thought.</p><figure class='jb_picture'><img itemprop='image' alt='The Apartment (1960) by Billy Wilder' src='/images/2015/10/the-apartment.jpg' longdesc='#3406debc'/><figcaption id='3406debc'>The Apartment (1960) by Billy Wilder</figcaption></figure><p>Let&#39;s say I have a list of numbers:</p><figure class="highlight"><pre><code class="language-java" data-lang="java"><span></span><span class="kd">interface</span> <span class="nc">Numbers</span> <span class="o">{</span>
  <span class="n">Iterable</span><span class="o">&lt;</span><span class="n">Integer</span><span class="o">&gt;</span> <span class="nf">iterate</span><span class="o">();</span>
<span class="o">}</span></code></pre></figure><p>Now I want to create a list that will only have odd, unique, positive, and sorted numbers. The first approach is <strong>vertical</strong> (I just made this name up):</p><figure class="highlight"><pre><code class="language-java" data-lang="java"><span></span><span class="n">Numbers</span> <span class="n">numbers</span> <span class="o">=</span> <span class="k">new</span> <span class="n">Sorted</span><span class="o">(</span>
  <span class="k">new</span> <span class="n">Unique</span><span class="o">(</span>
    <span class="k">new</span> <span class="n">Odds</span><span class="o">(</span>
      <span class="k">new</span> <span class="n">Positive</span><span class="o">(</span>
        <span class="k">new</span> <span class="n">ArrayNumbers</span><span class="o">(</span>
          <span class="k">new</span> <span class="n">Integer</span><span class="o">[]</span> <span class="o">{</span>
            <span class="o">-</span><span class="mi">1</span><span class="o">,</span> <span class="mi">78</span><span class="o">,</span> <span class="mi">4</span><span class="o">,</span> <span class="o">-</span><span class="mi">34</span><span class="o">,</span> <span class="mi">98</span><span class="o">,</span> <span class="mi">4</span><span class="o">,</span>
          <span class="o">}</span>
        <span class="o">)</span>
      <span class="o">)</span>
    <span class="o">)</span>
  <span class="o">)</span>
<span class="o">);</span></code></pre></figure><p>The second approach is <strong>horizontal</strong> (again, a name I made up):</p><figure class="highlight"><pre><code class="language-java" data-lang="java"><span></span><span class="n">Numbers</span> <span class="n">numbers</span> <span class="o">=</span> <span class="k">new</span> <span class="n">Modified</span><span class="o">(</span>
  <span class="k">new</span> <span class="n">ArrayNumbers</span><span class="o">(</span>
    <span class="k">new</span> <span class="n">Integer</span><span class="o">[]</span> <span class="o">{</span>
      <span class="o">-</span><span class="mi">1</span><span class="o">,</span> <span class="mi">78</span><span class="o">,</span> <span class="mi">4</span><span class="o">,</span> <span class="o">-</span><span class="mi">34</span><span class="o">,</span> <span class="mi">98</span><span class="o">,</span> <span class="mi">4</span><span class="o">,</span>
    <span class="o">}</span>
  <span class="o">),</span>
  <span class="k">new</span> <span class="n">Diff</span><span class="o">[]</span> <span class="o">{</span>
    <span class="k">new</span> <span class="n">Positive</span><span class="o">(),</span>
    <span class="k">new</span> <span class="n">Odds</span><span class="o">(),</span>
    <span class="k">new</span> <span class="n">Unique</span><span class="o">(),</span>
    <span class="k">new</span> <span class="n">Sorted</span><span class="o">(),</span>
  <span class="o">}</span>
<span class="o">);</span></code></pre></figure><p>See the difference? The first approach decorates <code>ArrayNumbers</code> &quot;vertically,&quot; adding functionality through the composable decorators <code>Positive</code>, <code>Odds</code>, <code>Unique</code>, and <code>Sorted</code>.</p><p>The second approach introduces the new interface <code>Diff</code>, which implements the core functionality of iterating numbers through instances of <code>Positive</code>, <code>Odds</code>, <code>Unique</code>, and <code>Sorted</code>:</p><figure class="highlight"><pre><code class="language-java" data-lang="java"><span></span><span class="kd">interface</span> <span class="nc">Diff</span> <span class="o">{</span>
  <span class="n">Iterable</span><span class="o">&lt;</span><span class="n">Integer</span><span class="o">&gt;</span> <span class="nf">apply</span><span class="o">(</span><span class="n">Iterable</span><span class="o">&lt;</span><span class="n">Integer</span><span class="o">&gt;</span> <span class="n">origin</span><span class="o">);</span>
<span class="o">}</span></code></pre></figure><p>For the user of <code>numbers</code>, both approaches are the same. The difference is only in the design. Which one is better and when? It seems that vertical decorating is easier to implement and is more suitable for smaller objects that expose just a few methods.</p><p>As for my experience, I always tend to start with vertical decorating since it&#39;s easier to implement but eventually migrate to a horizontal one when the number of decorators starts to grow.</p></div></article></div><div class="wrapper"> <related-posts /></div><div class="disqus" role="complementary"><p class="disqus_hint"> Please, use <a href="https://help.disqus.com/commenting/what-html-tags-are-allowed-within-comments">syntax highlighting</a> in your comments, to make them more readable.</p><div id="disqus_thread" class="disqus-thread"> <a>&nbsp;</a></div><script> var disqus_config = function () { this.page.url = document.location.href.split('?')[0].split('#')[0].replace('https://', 'http://'); this.page.identifier = this.page.url; }; (function() { var d = document, s = d.createElement('script'); s.src = '//yegor256.disqus.com/embed.js'; s.setAttribute('data-timestamp', +new Date()); (d.head || d.body).appendChild(s); })(); </script> <noscript><div><p class="red"> JavaScript is disabled in your browser, that's why you can't see comments under this post.</p></div></noscript></div><div class="wrapper"> <footer class="footer"><p> &copy; <span itemscope="" itemprop="copyrightHolder" itemtype="http://schema.org/Person"> <span itemprop="name">Yegor Bugayenko</span> </span> 2014&ndash;<span itemprop="copyrightYear">2018</span></p></footer></div></section><div class="wrapper unprintable" style="text-align:center;margin-top:2em;"> <a href="http://www.sixnines.io/h/3ba1652f"> <img src="//www.sixnines.io/b/3ba1652f?style=flat" alt="sixnines availability badge"/> </a></div><script src="//code.jquery.com/jquery-1.9.0.min.js"></script> <script src="/js/all.js?4e047f6f42b"></script> <script>var disqus_shortname = 'yegor256';</script> <script id="dsq-count-scr" src="//yegor256.disqus.com/count.js" async="async"></script> <script> (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){ (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o), m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m) })(window,document,'script','//www.google-analytics.com/analytics.js','ga'); ga('create', 'UA-1963507-32', 'auto'); ga('send', 'pageview'); </script> <script> Cd=document;Cr="&"+Math.random();Cp="&s=1"; Cd.cookie="b=b";if(Cd.cookie)Cp+="&c=1"; Cp+="&t="+(new Date()).getTimezoneOffset(); if(self!=top)Cp+="&f=1"; </script> <script> if(navigator.javaEnabled())Cp+="&j=1"; </script> <script> if(typeof(screen)!='undefined')Cp+="&w="+screen.width+"&h="+ screen.height+"&d="+(screen.colorDepth?screen.colorDepth:screen.pixelDepth); </script> <script> Cd.write("<img src='//c.hit.ua/hit?i=95870&g=0&x=2"+Cp+Cr+ "&r="+escape(Cd.referrer)+"&u="+escape(window.location.href)+ "' border='0' wi"+"dth='1' he"+"ight='1'/>"); </script> <script type="application/ld+json"> { "@context": "http://schema.org", "@type": "Person", "name": "Yegor Bugayenko", "url": "http://www.yegor256.com", "sameAs": [ "https://www.facebook.com/yegor256", "https://instagram.com/yegor256", "https://www.linkedin.com/in/yegor256", "https://twitter.com/yegor256", "https://github.com/yegor256", "https://www.pinterest.com/yegor256/" ] } </script> </body> </html> <!DOCTYPE html> <html xmlns="http://www.w3.org/1999/xhtml" lang="en-US" xml:lang="en-US" itemscope="" itemtype="http://schema.org/WebSite"> <head> <meta charset="utf-8"/> <meta name="description" content="Amazon S3 is a perfect place for keeping private Maven artifacts, automatically deploying them there, and making them available through s3auth.com. " /> <meta name="keywords" content="amazon s3 maven, amazon s3 maven repository, maven repository s3, maven repository s3auth, private maven repository" /> <meta name="viewport" content="width=device-width,minimum-scale=1,initial-scale=1"/> <meta name="google-site-verification" content="JEj_gQr2CPe2QKGw8XdMz0R7VboQIUbX3FlM-lwTq-8" /> <meta name="author" content="Yegor Bugayenko"> <meta name="article:published_time" content="2015-09-07 00:00:00 +0000"> <meta name="og:site_name" content="Yegor Bugayenko"/> <meta name="og:type" content="article" /> <meta name="og:locale" content="en_US" /> <meta name="twitter:account_id" content="4503599630178231" /> <meta name="twitter:creator" content="@yegor256"/> <meta name="twitter:site" content="@yegor256"/> <meta name="twitter:title" property="og:title" content="How to Set Up a Private Maven Repository in Amazon S3"/> <meta name="twitter:description" property="og:description" content="Amazon S3 is a perfect place for keeping private Maven artifacts, automatically deploying them there, and making them available through s3auth.com. "/> <meta name="twitter:url" property="og:url" content="https://www.yegor256.com/2015/09/07/maven-repository-amazon-s3.html"/> <meta name="telegram:channel" content="AAAAAEJFMRzsRTRxM3ec6A"/> <link rel="search" type="application/opensearchdescription+xml" href="/opensearch.xml" title="yegor256" /> <link rel="shortcut icon" href="/favicon.ico?4e047f6f42b"/> <link rel="apple-touch-icon" href="/favicon.ico?4e047f6f42b"/> <link rel="alternate" type="application/rss+xml" title="RSS for yegor256.com" href="https://www.yegor256.com/rss.xml"/> <link rel="stylesheet" href="/css/layout.css?4e047f6f42b"/> <link rel="stylesheet" href="/css/icons.css?4e047f6f42b"/> <link rel="canonical" href="https://www.yegor256.com/2015/09/07/maven-repository-amazon-s3.html" /> <link rel="amphtml" href="https://www.yegor256.com/2015/09/07/maven-repository-amazon-s3.amp.html" /> <title>How to Set Up a Private Maven Repository in Amazon S3 </title> </head> <body><div class="wrapper"> <aside class="header-toggle unprintable" id="header-toggle" title="Show the menu" onclick="$('#header').show();$('#header-toggle').hide();">&#9776;</aside> <header class="header" id="header"><div class="face"> <a href="/about-me.html#form" class="sub" title="Click to subscribe to my monthly newsletter"><span>Subscribe</span></a> <a href="/about-me.html" style="position:relative;"> <img src="/images/face-256x256.jpg" class="photo" alt="Yegor Bugayenko"/> </a></div><nav><ul class="menu social notranslate"> <li><a href="https://twitter.com/intent/follow?screen_name=yegor256" rel="nofollow" title="Follow me on Twitter"><i class="icon icon-twitter notranslate" aria-hidden="true"></i></a></li> <li><a href="/rss.xml" rel="nofollow" title="Subscribe to my RSS feed"><i class="icon icon-rss notranslate" aria-hidden="true"></i></a></li> <li><a itemprop="sameAs" href="https://github.com/yegor256" rel="nofollow" title="My GitHub profile"><i class="icon icon-github notranslate" aria-hidden="true"></i></a></li> <li><a itemprop="sameAs" href="http://stackoverflow.com/users/187141/yegor256" rel="nofollow" title="My StackOverflow profile"><i class="icon icon-stackoverflow notranslate" aria-hidden="true"></i></a></li> <li><a itemprop="sameAs" href="https://www.facebook.com/yegor256" rel="nofollow" title="Follow me on Facebook"><i class="icon icon-facebook notranslate" aria-hidden="true"></i></a></li> <li><a itemprop="sameAs" href="https://instagram.com/yegor256" rel="nofollow" title="Follow me on Instagram"><i class="icon icon-instagram notranslate" aria-hidden="true"></i></a></li> <li><a itemprop="sameAs" href="https://www.linkedin.com/in/yegor256" rel="nofollow" title="My LinkedIn profile"><i class="icon icon-linkedin notranslate" aria-hidden="true"></i></a></li> <li><a itemprop="sameAs" href="https://www.youtube.com/c/yegor256?sub_confirmation=1" rel="nofollow" title="My Youtube video channel"><i class="icon icon-youtube notranslate" aria-hidden="true"></i></a></li> <li><a itemprop="sameAs" href="https://www.pinterest.com/yegor256/" rel="nofollow" title="My Pinterest boards"><i class="icon icon-pinterest notranslate" aria-hidden="true"></i></a></li> <li><a itemprop="sameAs" href="https://angel.co/yegor256" rel="nofollow" title="My AngelList profile"><i class="icon icon-angellist notranslate" aria-hidden="true"></i></a></li> <li><a href="https://soundcloud.com/yegor256" rel="nofollow" title="My podcast"><i class="icon icon-podcast notranslate" aria-hidden="true"></i></a></li> <li><a href="https://itunes.apple.com/us/podcast/yegor256-podcast/id1150826721" rel="nofollow" title="My iTunes podcast"><i class="icon icon-itunes notranslate" aria-hidden="true"></i></a></li> <li><a href="https://t.me/joinchat/AAAAAEJFMRzsRTRxM3ec6A" rel="nofollow" title="My Telegram public channel"><i class="icon icon-telegram notranslate" aria-hidden="true"></i></a></li> <li><a href="mailto:blog@yegor256.com" rel="nofollow" title="Email me any time"><i class="icon icon-mail notranslate" aria-hidden="true"></i></a></li></ul><ul class="menu"> <li><a href="/" title="Home page">Home</a></li> <li ><a href="/best.html" title="Best articles to read">12&#160;Best</a></li> <li ><a href="/contents.html" title="The contents of the entire blog">All&#160;288</a></li> <li ><a href="/webinars.html" title="My webinars">Webinars</a></li> <li ><a href="/talks.html" title="Future and past conference talks">Talks</a></li> <li ><a href="/books.html" title="The books I wrote">Books</a></li> <li ><a href="/papers.html" title="My academic papers and patents">Papers</a></li> <li ><a href="/pets.html" title="My loved pet projects">Pets</a></li> <li ><a href="/award.html" title="Software quality award">Award</a></li> <li ><a href="/testimonials.html" title="What some people say about me">Testimonials</a></li> <li ><a href="/shift-m.html" title="Audio podcast about project management">Shift-M</a></li> <li ><a href="/paintings.html" title="My paintings for sale">Paintings</a></li> <li><a href="http://ru.yegor256.com/" title="Немного на русском языке">По-русски</a></li></ul></nav><div class="search"> <form method="get" action="https://www.google.com/search" itemprop="potentialAction" itemscope="" itemtype="http://schema.org/SearchAction"> <meta itemprop="target" content="https://www.google.com/search?q={q}"/> <input name="sitesearch" value="yegor256.com" type="hidden"/> <input itemprop="query-input" type="text" id="search-query" class="field field-text" required="required" onfocus="$('.google').css('visibility', 'visible');" name="q" placeholder="Search..." autocomplete="off"/> <input type="image" src="/images/google-search-icon.svg" class="google" title="Search via Google" alt="Search via Google"/> </form></div><div class="hot"><ul> <li> <a href="/code-ahead.html">Code Ahead</a> was published on Amazon just a few days ago! It is my new book, a novel about programmers. It explains in details the majority of ideas that stand behind <a href="https://www.zerocracy.com">Zerocracy</a> and <a href="https://www.xdsd.org">XDSD</a>. </li> <li> At <a href="/webinars.html">Webinar #37</a> we will discuss naming problem in OOP, for objects, methods and attributes; join us on <b>September 12</b>, at 11am PST. </li></ul></div></header></div><section itemscope="" itemtype="http://schema.org/BlogPosting"><div class="wrapper"> <header><p class="printable"> <img src="https://api.qrserver.com/v1/create-qr-code/?data=https://www.yegor256.com/2015/09/07/maven-repository-amazon-s3.html&amp;format=svg" style="width:125px;height:125px;" alt="QR code"/></p><p class="printable"> <code itemprop="url">https://www.yegor256.com/2015/09/07/maven-repository-amazon-s3.html</code></p><h1 itemprop="name headline mainEntityOfPage">How to Set Up a Private Maven Repository in Amazon S3</h1><ul class="subline"> <li> <time itemprop="datePublished" datetime="2015-09-07T00:00:00+00:00"> 7 September 2015 </time> </li> <li class="desktop-only" itemprop="locationCreated">Kiev, Ukraine</li> <li class="printable" itemscope="" itemprop="author" itemtype="http://schema.org/Person"> <span itemprop="name">Yegor Bugayenko</span> </li> <li class="unprintable"> <i class="icon icon-comments"></i> <a href="http://www.yegor256.com/2015/09/07/maven-repository-amazon-s3.html#disqus_thread" itemprop="discussionUrl">comments</a> </li></ul><h2 id="create-an-s3-bucket">Create an S3 Bucket</h2><p>First, you create a new S3 bucket. I would recommend you name it using your project domain and a prefix. For example, with <code>repo.teamed.io</code>, <code>repo</code> is a prefix and <code>teamed.io</code> is the domain.</p><p>There&#39;s no need to configure any permissions for this bucket. Just create it through the <a href="https://console.aws.amazon.com/console/home">Amazon S3 console</a>.</p><h2 id="create-an-iam-user">Create an IAM User</h2><p>Create a new IAM user. I recommend you name it like <code>teamed-maven</code> if your project name is <code>teamed</code>.</p><p>Add a new &quot;inline policy&quot; to the user:</p><figure class="highlight"><pre><code class="language-text" data-lang="text"><span></span>{
  &quot;Statement&quot;: [
    {
      &quot;Effect&quot;: &quot;Allow&quot;,
      &quot;Action&quot;: &quot;s3:*&quot;,
      &quot;Resource&quot;: [
        &quot;arn:aws:s3:::repo.teamed.io&quot;,
        &quot;arn:aws:s3:::repo.teamed.io/*&quot;
      ]
    }
  ]
}</code></pre></figure><p>Here, <code>repo.teamed.io</code> is the name of the S3 bucket you created a minute ago.</p><p>Make sure you have an &quot;access key&quot; for this new user. It must look similar to this:</p><figure class="highlight"><pre><code class="language-text" data-lang="text"><span></span>key: AKIAI9NNNJD5D7X4TUVA
secret: t5tZQCwuaRhmlOXfbGE5aTBMFw34iFyxfCEr32av</code></pre></figure><p>The key is 20 characters (all caps), and the secret is 40 characters.</p><h2 id="extend-settings-xml">Extend <code>settings.xml</code></h2><p>Add this configuration to your <code>~/.m2/settings.xml</code> file:</p><figure class="highlight"><pre><code class="language-xml" data-lang="xml"><span></span><span class="nt">&lt;settings&gt;</span>
  <span class="nt">&lt;servers&gt;</span>
    <span class="nt">&lt;server&gt;</span>
      <span class="nt">&lt;id&gt;</span>repo.teamed.io<span class="nt">&lt;/id&gt;</span>
      <span class="nt">&lt;username&gt;</span>AKIAI9NNNJD5D7X4TUVA<span class="nt">&lt;/username&gt;</span>
      <span class="nt">&lt;password&gt;</span>t5tZQCwuaRhmlOXfbGE5aTBMFw34iFyxfCEr32av<span class="nt">&lt;/password&gt;</span>
    <span class="nt">&lt;/server&gt;</span>
    [...]
  <span class="nt">&lt;/servers&gt;</span>
  [...]
<span class="nt">&lt;/settings&gt;</span></code></pre></figure><h2 id="configure-pom-xml">Configure <code>pom.xml</code></h2><p>Add this configuration to <code>pom.xml</code>:</p><figure class="highlight"><pre><code class="language-xml" data-lang="xml"><span></span><span class="nt">&lt;project&gt;</span>
  <span class="nt">&lt;distributionManagement&gt;</span>
    <span class="nt">&lt;snapshotRepository&gt;</span>
      <span class="nt">&lt;id&gt;</span>repo.teamed.io<span class="nt">&lt;/id&gt;</span>
      <span class="nt">&lt;url&gt;</span>s3://repo.teamed.io/snapshot<span class="nt">&lt;/url&gt;</span>
    <span class="nt">&lt;/snapshotRepository&gt;</span>
    <span class="nt">&lt;repository&gt;</span>
      <span class="nt">&lt;id&gt;</span>repo.teamed.io<span class="nt">&lt;/id&gt;</span>
      <span class="nt">&lt;url&gt;</span>s3://repo.teamed.io/release<span class="nt">&lt;/url&gt;</span>
    <span class="nt">&lt;/repository&gt;</span>
  <span class="nt">&lt;/distributionManagement&gt;</span>
  <span class="nt">&lt;repositories&gt;</span>
    <span class="nt">&lt;repository&gt;</span>
      <span class="nt">&lt;id&gt;</span>repo.teamed.io<span class="nt">&lt;/id&gt;</span>
      <span class="nt">&lt;url&gt;</span>s3://repo.teamed.io/release<span class="nt">&lt;/url&gt;</span>
    <span class="nt">&lt;/repository&gt;</span>
  <span class="nt">&lt;/repositories&gt;</span>
  [...]
<span class="nt">&lt;/project&gt;</span></code></pre></figure><p>Then, configure <a href="https://github.com/jcaddel/maven-s3-wagon">S3 Wagon</a>, also in <code>pom.xml</code>:</p><figure class="highlight"><pre><code class="language-xml" data-lang="xml"><span></span><span class="nt">&lt;project&gt;</span>
  <span class="nt">&lt;build&gt;</span>
    <span class="nt">&lt;extensions&gt;</span>
      <span class="nt">&lt;extension&gt;</span>
        <span class="nt">&lt;groupId&gt;</span>org.kuali.maven.wagons<span class="nt">&lt;/groupId&gt;</span>
        <span class="nt">&lt;artifactId&gt;</span>maven-s3-wagon<span class="nt">&lt;/artifactId&gt;</span>
        <span class="nt">&lt;version&gt;</span>1.2.1<span class="nt">&lt;/version&gt;</span>
      <span class="nt">&lt;/extension&gt;</span>
    <span class="nt">&lt;/extensions&gt;</span>
    [...]
  <span class="nt">&lt;/build&gt;</span>
<span class="nt">&lt;/project&gt;</span></code></pre></figure><p>You&#39;re ready to go. You can deploy your artifacts just by running Maven from the command line:</p><figure class="highlight"><pre><code class="language-text" data-lang="text"><span></span>$ mvn clean deploy</code></pre></figure><h2 id="configure-s3auth-com">Configure <code>s3auth.com</code></h2><p>Now you want to see these artifacts in your browser, in a secure mode, by providing secure credentials. I recommend you use <a href="http://www.s3auth.com">s3auth.com</a>, as explained in <a href="/2014/04/21/s3-http-basic-auth.html">Basic HTTP Auth for S3 Buckets</a>.</p><h2 id="configure-rultor">Configure Rultor</h2><figure class='badge'><a href='http://www.rultor.com'><img src='http://doc.rultor.com/images/logo.svg' style='width:100px;max-width:100%;' alt='badge'/></a></figure><p>Another recommendation is to configure rultor.com for deployment of your artifacts to S3 automatically.</p><p>First, encrypt your <code>settings.xml</code> with this <a href="https://github.com/yegor256/rultor-remote">Rultor remote</a>:</p><figure class="highlight"><pre><code class="language-xml" data-lang="xml"><span></span>$ gem install rultor
$ rultor encrypt -p me/test settings.xml</code></pre></figure><p>Instead of <code>me/test</code>, you should use the name of your GitHub project.</p><p>As a result, you will get a new file named <code>settings.xml.asc</code>. Add it to the root directory of your project, then commit and push. The file contains your secret information, but only the Rultor server can decrypt it.</p><p>Create a <code>.rultor.yml</code> file in the root directory of your project (The Rultor <a href="http://doc.rultor.com/reference.html">reference page</a> explains this format in greater detail):</p><figure class="highlight"><pre><code class="language-text" data-lang="text"><span></span>decrypt:
  settings.xml: &quot;repo/settings.xml.asc&quot;
deploy:
  script: |
    mvn clean deploy --settings ../settings.xml</code></pre></figure><p>Now it&#39;s time to see how it all works together. Create a new ticket in the GitHub issue tracker and post something like this into it (read more about <a href="http://doc.rultor.com/basics.html">Rultor commands</a>):</p><figure class="highlight"><pre><code class="language-text" data-lang="text"><span></span>@rultor deploy</code></pre></figure><p>You will get a response in a few seconds. The rest will be done by Rultor.</p><p>That&#39;s it.</p></p>--> <nav class="buttons notranslate desktop-only"> <a href="http://www.facebook.com/sharer/sharer.php?u=https://www.yegor256.com/2015/09/07/maven-repository-amazon-s3.html" title="Share on Facebook" class="button" rel="nofollow"> <span class="count count-facebook">0</span> <i class="icon icon-facebook notranslate" aria-hidden="true"></i> </a> <a href="https://twitter.com/share?url=https://www.yegor256.com/2015/09/07/maven-repository-amazon-s3.html&amp;text=How+to+Set+Up+a+Private+Maven+Repository+in+Amazon+S3" title="Share on Twitter" class="button" rel="nofollow"> <span class="count count-twitter">0</span> <i class="icon icon-twitter notranslate" aria-hidden="true"></i> </a> <a href="https://plus.google.com/share?url=https://www.yegor256.com/2015/09/07/maven-repository-amazon-s3.html" title="Share on Google+" class="button" rel="nofollow"> <span class="count count-googleplus">0</span> <i class="icon icon-googleplus notranslate" aria-hidden="true"></i> </a> <a href="https://www.linkedin.com/cws/share?url=https://www.yegor256.com/2015/09/07/maven-repository-amazon-s3.html" title="Share on LinkedIn" class="button" rel="nofollow"> <span class="count count-linkedin">0</span> <i class="icon icon-linkedin notranslate" aria-hidden="true"></i> </a> <a href="http://reddit.com/submit?url=https://www.yegor256.com/2015/09/07/maven-repository-amazon-s3.html%3F2015-36&amp;title=How+to+Set+Up+a+Private+Maven+Repository+in+Amazon+S3" title="Share on Reddit" class="button" rel="nofollow"> <span class="count count-reddit">0</span> <i class="icon icon-reddit notranslate" aria-hidden="true"></i> </a> <a href="http://news.ycombinator.com/submitlink?u=https://www.yegor256.com/2015/09/07/maven-repository-amazon-s3.html%3F2015-36&amp;t=How+to+Set+Up+a+Private+Maven+Repository+in+Amazon+S3" title="Share on Hacker News" class="button" rel="nofollow"> <span class="count count-hackernews">0</span> <i class="icon icon-hackernews notranslate" aria-hidden="true"></i> </a> </nav> </header> <article class="main" itemprop="articleBody"><div ><p><a href="https://aws.amazon.com/s3/">Amazon S3</a> is a perfect place for keeping private <a href="https://maven.apache.org/">Maven</a> artifacts. I assume you keep public artifacts in <a href="/2014/08/19/how-to-release-to-maven-central.html">Maven Central</a> because you want them to be available to everybody. Private artifacts are those you don&#39;t want visible to anyone except members of your team. Thus, you want to deploy your <code>.jar</code> files there and make sure they are visible only by your team. Here is how we do this in all <a href="http://www.zerocracy.com">our</a> Java projects.</p><h2 id="create-an-s3-bucket">Create an S3 Bucket</h2><p>First, you create a new S3 bucket. I would recommend you name it using your project domain and a prefix. For example, with <code>repo.teamed.io</code>, <code>repo</code> is a prefix and <code>teamed.io</code> is the domain.</p><p>There&#39;s no need to configure any permissions for this bucket. Just create it through the <a href="https://console.aws.amazon.com/console/home">Amazon S3 console</a>.</p><h2 id="create-an-iam-user">Create an IAM User</h2><p>Create a new IAM user. I recommend you name it like <code>teamed-maven</code> if your project name is <code>teamed</code>.</p><p>Add a new &quot;inline policy&quot; to the user:</p><figure class="highlight"><pre><code class="language-text" data-lang="text"><span></span>{
  &quot;Statement&quot;: [
    {
      &quot;Effect&quot;: &quot;Allow&quot;,
      &quot;Action&quot;: &quot;s3:*&quot;,
      &quot;Resource&quot;: [
        &quot;arn:aws:s3:::repo.teamed.io&quot;,
        &quot;arn:aws:s3:::repo.teamed.io/*&quot;
      ]
    }
  ]
}</code></pre></figure><p>Here, <code>repo.teamed.io</code> is the name of the S3 bucket you created a minute ago.</p><p>Make sure you have an &quot;access key&quot; for this new user. It must look similar to this:</p><figure class="highlight"><pre><code class="language-text" data-lang="text"><span></span>key: AKIAI9NNNJD5D7X4TUVA
secret: t5tZQCwuaRhmlOXfbGE5aTBMFw34iFyxfCEr32av</code></pre></figure><p>The key is 20 characters (all caps), and the secret is 40 characters.</p><h2 id="extend-settings-xml">Extend <code>settings.xml</code></h2><p>Add this configuration to your <code>~/.m2/settings.xml</code> file:</p><figure class="highlight"><pre><code class="language-xml" data-lang="xml"><span></span><span class="nt">&lt;settings&gt;</span>
  <span class="nt">&lt;servers&gt;</span>
    <span class="nt">&lt;server&gt;</span>
      <span class="nt">&lt;id&gt;</span>repo.teamed.io<span class="nt">&lt;/id&gt;</span>
      <span class="nt">&lt;username&gt;</span>AKIAI9NNNJD5D7X4TUVA<span class="nt">&lt;/username&gt;</span>
      <span class="nt">&lt;password&gt;</span>t5tZQCwuaRhmlOXfbGE5aTBMFw34iFyxfCEr32av<span class="nt">&lt;/password&gt;</span>
    <span class="nt">&lt;/server&gt;</span>
    [...]
  <span class="nt">&lt;/servers&gt;</span>
  [...]
<span class="nt">&lt;/settings&gt;</span></code></pre></figure><h2 id="configure-pom-xml">Configure <code>pom.xml</code></h2><p>Add this configuration to <code>pom.xml</code>:</p><figure class="highlight"><pre><code class="language-xml" data-lang="xml"><span></span><span class="nt">&lt;project&gt;</span>
  <span class="nt">&lt;distributionManagement&gt;</span>
    <span class="nt">&lt;snapshotRepository&gt;</span>
      <span class="nt">&lt;id&gt;</span>repo.teamed.io<span class="nt">&lt;/id&gt;</span>
      <span class="nt">&lt;url&gt;</span>s3://repo.teamed.io/snapshot<span class="nt">&lt;/url&gt;</span>
    <span class="nt">&lt;/snapshotRepository&gt;</span>
    <span class="nt">&lt;repository&gt;</span>
      <span class="nt">&lt;id&gt;</span>repo.teamed.io<span class="nt">&lt;/id&gt;</span>
      <span class="nt">&lt;url&gt;</span>s3://repo.teamed.io/release<span class="nt">&lt;/url&gt;</span>
    <span class="nt">&lt;/repository&gt;</span>
  <span class="nt">&lt;/distributionManagement&gt;</span>
  <span class="nt">&lt;repositories&gt;</span>
    <span class="nt">&lt;repository&gt;</span>
      <span class="nt">&lt;id&gt;</span>repo.teamed.io<span class="nt">&lt;/id&gt;</span>
      <span class="nt">&lt;url&gt;</span>s3://repo.teamed.io/release<span class="nt">&lt;/url&gt;</span>
    <span class="nt">&lt;/repository&gt;</span>
  <span class="nt">&lt;/repositories&gt;</span>
  [...]
<span class="nt">&lt;/project&gt;</span></code></pre></figure><p>Then, configure <a href="https://github.com/jcaddel/maven-s3-wagon">S3 Wagon</a>, also in <code>pom.xml</code>:</p><figure class="highlight"><pre><code class="language-xml" data-lang="xml"><span></span><span class="nt">&lt;project&gt;</span>
  <span class="nt">&lt;build&gt;</span>
    <span class="nt">&lt;extensions&gt;</span>
      <span class="nt">&lt;extension&gt;</span>
        <span class="nt">&lt;groupId&gt;</span>org.kuali.maven.wagons<span class="nt">&lt;/groupId&gt;</span>
        <span class="nt">&lt;artifactId&gt;</span>maven-s3-wagon<span class="nt">&lt;/artifactId&gt;</span>
        <span class="nt">&lt;version&gt;</span>1.2.1<span class="nt">&lt;/version&gt;</span>
      <span class="nt">&lt;/extension&gt;</span>
    <span class="nt">&lt;/extensions&gt;</span>
    [...]
  <span class="nt">&lt;/build&gt;</span>
<span class="nt">&lt;/project&gt;</span></code></pre></figure><p>You&#39;re ready to go. You can deploy your artifacts just by running Maven from the command line:</p><figure class="highlight"><pre><code class="language-text" data-lang="text"><span></span>$ mvn clean deploy</code></pre></figure><h2 id="configure-s3auth-com">Configure <code>s3auth.com</code></h2><p>Now you want to see these artifacts in your browser, in a secure mode, by providing secure credentials. I recommend you use <a href="http://www.s3auth.com">s3auth.com</a>, as explained in <a href="/2014/04/21/s3-http-basic-auth.html">Basic HTTP Auth for S3 Buckets</a>.</p><h2 id="configure-rultor">Configure Rultor</h2><figure class='badge'><a href='http://www.rultor.com'><img src='http://doc.rultor.com/images/logo.svg' style='width:100px;max-width:100%;' alt='badge'/></a></figure><p>Another recommendation is to configure rultor.com for deployment of your artifacts to S3 automatically.</p><p>First, encrypt your <code>settings.xml</code> with this <a href="https://github.com/yegor256/rultor-remote">Rultor remote</a>:</p><figure class="highlight"><pre><code class="language-xml" data-lang="xml"><span></span>$ gem install rultor
$ rultor encrypt -p me/test settings.xml</code></pre></figure><p>Instead of <code>me/test</code>, you should use the name of your GitHub project.</p><p>As a result, you will get a new file named <code>settings.xml.asc</code>. Add it to the root directory of your project, then commit and push. The file contains your secret information, but only the Rultor server can decrypt it.</p><p>Create a <code>.rultor.yml</code> file in the root directory of your project (The Rultor <a href="http://doc.rultor.com/reference.html">reference page</a> explains this format in greater detail):</p><figure class="highlight"><pre><code class="language-text" data-lang="text"><span></span>decrypt:
  settings.xml: &quot;repo/settings.xml.asc&quot;
deploy:
  script: |
    mvn clean deploy --settings ../settings.xml</code></pre></figure><p>Now it&#39;s time to see how it all works together. Create a new ticket in the GitHub issue tracker and post something like this into it (read more about <a href="http://doc.rultor.com/basics.html">Rultor commands</a>):</p><figure class="highlight"><pre><code class="language-text" data-lang="text"><span></span>@rultor deploy</code></pre></figure><p>You will get a response in a few seconds. The rest will be done by Rultor.</p><p>That&#39;s it.</p></div></article></div><div class="wrapper"> <related-posts /></div><div class="disqus" role="complementary"><p class="disqus_hint"> Please, use <a href="https://help.disqus.com/commenting/what-html-tags-are-allowed-within-comments">syntax highlighting</a> in your comments, to make them more readable.</p><div id="disqus_thread" class="disqus-thread"> <a>&nbsp;</a></div><script> var disqus_config = function () { this.page.url = document.location.href.split('?')[0].split('#')[0].replace('https://', 'http://'); this.page.identifier = this.page.url; }; (function() { var d = document, s = d.createElement('script'); s.src = '//yegor256.disqus.com/embed.js'; s.setAttribute('data-timestamp', +new Date()); (d.head || d.body).appendChild(s); })(); </script> <noscript><div><p class="red"> JavaScript is disabled in your browser, that's why you can't see comments under this post.</p></div></noscript></div><div class="wrapper"> <footer class="footer"><p> &copy; <span itemscope="" itemprop="copyrightHolder" itemtype="http://schema.org/Person"> <span itemprop="name">Yegor Bugayenko</span> </span> 2014&ndash;<span itemprop="copyrightYear">2018</span></p></footer></div></section><div class="wrapper unprintable" style="text-align:center;margin-top:2em;"> <a href="http://www.sixnines.io/h/3ba1652f"> <img src="//www.sixnines.io/b/3ba1652f?style=flat" alt="sixnines availability badge"/> </a></div><script src="//code.jquery.com/jquery-1.9.0.min.js"></script> <script src="/js/all.js?4e047f6f42b"></script> <script>var disqus_shortname = 'yegor256';</script> <script id="dsq-count-scr" src="//yegor256.disqus.com/count.js" async="async"></script> <script> (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){ (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o), m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m) })(window,document,'script','//www.google-analytics.com/analytics.js','ga'); ga('create', 'UA-1963507-32', 'auto'); ga('send', 'pageview'); </script> <script> Cd=document;Cr="&"+Math.random();Cp="&s=1"; Cd.cookie="b=b";if(Cd.cookie)Cp+="&c=1"; Cp+="&t="+(new Date()).getTimezoneOffset(); if(self!=top)Cp+="&f=1"; </script> <script> if(navigator.javaEnabled())Cp+="&j=1"; </script> <script> if(typeof(screen)!='undefined')Cp+="&w="+screen.width+"&h="+ screen.height+"&d="+(screen.colorDepth?screen.colorDepth:screen.pixelDepth); </script> <script> Cd.write("<img src='//c.hit.ua/hit?i=95870&g=0&x=2"+Cp+Cr+ "&r="+escape(Cd.referrer)+"&u="+escape(window.location.href)+ "' border='0' wi"+"dth='1' he"+"ight='1'/>"); </script> <script type="application/ld+json"> { "@context": "http://schema.org", "@type": "Person", "name": "Yegor Bugayenko", "url": "http://www.yegor256.com", "sameAs": [ "https://www.facebook.com/yegor256", "https://instagram.com/yegor256", "https://www.linkedin.com/in/yegor256", "https://twitter.com/yegor256", "https://github.com/yegor256", "https://www.pinterest.com/yegor256/" ] } </script> </body> </html> <!DOCTYPE html> <html xmlns="http://www.w3.org/1999/xhtml" lang="en-US" xml:lang="en-US" itemscope="" itemtype="http://schema.org/WebSite"> <head> <meta charset="utf-8"/> <meta name="description" content="Despite good intentions, redundant variables actually make your code dirty and difficult to understand. " /> <meta name="keywords" content="java variables, redundant variables, too many variables, variables in java, variables in oop" /> <meta name="viewport" content="width=device-width,minimum-scale=1,initial-scale=1"/> <meta name="google-site-verification" content="JEj_gQr2CPe2QKGw8XdMz0R7VboQIUbX3FlM-lwTq-8" /> <meta name="author" content="Yegor Bugayenko"> <meta name="article:published_time" content="2015-09-01 00:00:00 +0000"> <meta name="og:site_name" content="Yegor Bugayenko"/> <meta name="og:type" content="article" /> <meta name="og:locale" content="en_US" /> <meta name="twitter:account_id" content="4503599630178231" /> <meta name="twitter:creator" content="@yegor256"/> <meta name="twitter:site" content="@yegor256"/> <meta name="twitter:title" property="og:title" content="Redundant Variables Are Pure Evil"/> <meta name="twitter:description" property="og:description" content="Despite good intentions, redundant variables actually make your code dirty and difficult to understand. "/> <meta name="twitter:url" property="og:url" content="https://www.yegor256.com/2015/09/01/redundant-variables-are-evil.html"/> <meta name="telegram:channel" content="AAAAAEJFMRzsRTRxM3ec6A"/> <link rel="search" type="application/opensearchdescription+xml" href="/opensearch.xml" title="yegor256" /> <link rel="shortcut icon" href="/favicon.ico?4e047f6f42b"/> <link rel="apple-touch-icon" href="/favicon.ico?4e047f6f42b"/> <link rel="alternate" type="application/rss+xml" title="RSS for yegor256.com" href="https://www.yegor256.com/rss.xml"/> <link rel="stylesheet" href="/css/layout.css?4e047f6f42b"/> <link rel="stylesheet" href="/css/icons.css?4e047f6f42b"/> <link rel="canonical" href="https://www.yegor256.com/2015/09/01/redundant-variables-are-evil.html" /> <link rel="amphtml" href="https://www.yegor256.com/2015/09/01/redundant-variables-are-evil.amp.html" /> <title>Redundant Variables Are Pure Evil </title> <meta name='og:image' content='https://www.yegor256.com/images/2015/09/y-tu-mama-tambien.jpg'/><meta name='twitter:image' content='https://www.yegor256.com/images/2015/09/y-tu-mama-tambien.jpg'/><meta name='og:image:width' content='1280'/> <meta name='twitter:image:width' content='1280'/><meta name='og:image:height' content='680'/> <meta name='twitter:image:height' content='680'/><meta name='twitter:card' content='summary_large_image'/><meta name='twitter:image:alt' content='Y Tu Mamá También (2001) by Alfonso Cuarón'/> </head> <body><div class="wrapper"> <aside class="header-toggle unprintable" id="header-toggle" title="Show the menu" onclick="$('#header').show();$('#header-toggle').hide();">&#9776;</aside> <header class="header" id="header"><div class="face"> <a href="/about-me.html#form" class="sub" title="Click to subscribe to my monthly newsletter"><span>Subscribe</span></a> <a href="/about-me.html" style="position:relative;"> <img src="/images/face-256x256.jpg" class="photo" alt="Yegor Bugayenko"/> </a></div><nav><ul class="menu social notranslate"> <li><a href="https://twitter.com/intent/follow?screen_name=yegor256" rel="nofollow" title="Follow me on Twitter"><i class="icon icon-twitter notranslate" aria-hidden="true"></i></a></li> <li><a href="/rss.xml" rel="nofollow" title="Subscribe to my RSS feed"><i class="icon icon-rss notranslate" aria-hidden="true"></i></a></li> <li><a itemprop="sameAs" href="https://github.com/yegor256" rel="nofollow" title="My GitHub profile"><i class="icon icon-github notranslate" aria-hidden="true"></i></a></li> <li><a itemprop="sameAs" href="http://stackoverflow.com/users/187141/yegor256" rel="nofollow" title="My StackOverflow profile"><i class="icon icon-stackoverflow notranslate" aria-hidden="true"></i></a></li> <li><a itemprop="sameAs" href="https://www.facebook.com/yegor256" rel="nofollow" title="Follow me on Facebook"><i class="icon icon-facebook notranslate" aria-hidden="true"></i></a></li> <li><a itemprop="sameAs" href="https://instagram.com/yegor256" rel="nofollow" title="Follow me on Instagram"><i class="icon icon-instagram notranslate" aria-hidden="true"></i></a></li> <li><a itemprop="sameAs" href="https://www.linkedin.com/in/yegor256" rel="nofollow" title="My LinkedIn profile"><i class="icon icon-linkedin notranslate" aria-hidden="true"></i></a></li> <li><a itemprop="sameAs" href="https://www.youtube.com/c/yegor256?sub_confirmation=1" rel="nofollow" title="My Youtube video channel"><i class="icon icon-youtube notranslate" aria-hidden="true"></i></a></li> <li><a itemprop="sameAs" href="https://www.pinterest.com/yegor256/" rel="nofollow" title="My Pinterest boards"><i class="icon icon-pinterest notranslate" aria-hidden="true"></i></a></li> <li><a itemprop="sameAs" href="https://angel.co/yegor256" rel="nofollow" title="My AngelList profile"><i class="icon icon-angellist notranslate" aria-hidden="true"></i></a></li> <li><a href="https://soundcloud.com/yegor256" rel="nofollow" title="My podcast"><i class="icon icon-podcast notranslate" aria-hidden="true"></i></a></li> <li><a href="https://itunes.apple.com/us/podcast/yegor256-podcast/id1150826721" rel="nofollow" title="My iTunes podcast"><i class="icon icon-itunes notranslate" aria-hidden="true"></i></a></li> <li><a href="https://t.me/joinchat/AAAAAEJFMRzsRTRxM3ec6A" rel="nofollow" title="My Telegram public channel"><i class="icon icon-telegram notranslate" aria-hidden="true"></i></a></li> <li><a href="mailto:blog@yegor256.com" rel="nofollow" title="Email me any time"><i class="icon icon-mail notranslate" aria-hidden="true"></i></a></li></ul><ul class="menu"> <li><a href="/" title="Home page">Home</a></li> <li ><a href="/best.html" title="Best articles to read">12&#160;Best</a></li> <li ><a href="/contents.html" title="The contents of the entire blog">All&#160;288</a></li> <li ><a href="/webinars.html" title="My webinars">Webinars</a></li> <li ><a href="/talks.html" title="Future and past conference talks">Talks</a></li> <li ><a href="/books.html" title="The books I wrote">Books</a></li> <li ><a href="/papers.html" title="My academic papers and patents">Papers</a></li> <li ><a href="/pets.html" title="My loved pet projects">Pets</a></li> <li ><a href="/award.html" title="Software quality award">Award</a></li> <li ><a href="/testimonials.html" title="What some people say about me">Testimonials</a></li> <li ><a href="/shift-m.html" title="Audio podcast about project management">Shift-M</a></li> <li ><a href="/paintings.html" title="My paintings for sale">Paintings</a></li> <li><a href="http://ru.yegor256.com/" title="Немного на русском языке">По-русски</a></li></ul></nav><div class="search"> <form method="get" action="https://www.google.com/search" itemprop="potentialAction" itemscope="" itemtype="http://schema.org/SearchAction"> <meta itemprop="target" content="https://www.google.com/search?q={q}"/> <input name="sitesearch" value="yegor256.com" type="hidden"/> <input itemprop="query-input" type="text" id="search-query" class="field field-text" required="required" onfocus="$('.google').css('visibility', 'visible');" name="q" placeholder="Search..." autocomplete="off"/> <input type="image" src="/images/google-search-icon.svg" class="google" title="Search via Google" alt="Search via Google"/> </form></div><div class="hot"><ul> <li> <a href="/code-ahead.html">Code Ahead</a> was published on Amazon just a few days ago! It is my new book, a novel about programmers. It explains in details the majority of ideas that stand behind <a href="https://www.zerocracy.com">Zerocracy</a> and <a href="https://www.xdsd.org">XDSD</a>. </li> <li> At <a href="/webinars.html">Webinar #37</a> we will discuss naming problem in OOP, for objects, methods and attributes; join us on <b>September 12</b>, at 11am PST. </li></ul></div></header></div><section itemscope="" itemtype="http://schema.org/BlogPosting"><div class="wrapper"> <header><p class="printable"> <img src="https://api.qrserver.com/v1/create-qr-code/?data=https://www.yegor256.com/2015/09/01/redundant-variables-are-evil.html&amp;format=svg" style="width:125px;height:125px;" alt="QR code"/></p><p class="printable"> <code itemprop="url">https://www.yegor256.com/2015/09/01/redundant-variables-are-evil.html</code></p><h1 itemprop="name headline mainEntityOfPage">Redundant Variables Are Pure Evil</h1><ul class="subline"> <li> <time itemprop="datePublished" datetime="2015-09-01T00:00:00+00:00"> 1 September 2015 </time> </li> <li class="desktop-only" itemprop="locationCreated">Kiev, Ukraine</li> <li class="printable" itemscope="" itemprop="author" itemtype="http://schema.org/Person"> <span itemprop="name">Yegor Bugayenko</span> </li> <li class="unprintable"> <i class="icon icon-comments"></i> <a href="http://www.yegor256.com/2015/09/01/redundant-variables-are-evil.html#disqus_thread" itemprop="discussionUrl">comments</a> </li></ul><figure class='jb_picture'><img itemprop='image' alt='Y Tu Mamá También (2001) by Alfonso Cuarón' src='/images/2015/09/y-tu-mama-tambien.jpg' longdesc='#c57934a9'/><figcaption id='c57934a9'>Y Tu Mamá También (2001) by Alfonso Cuarón</figcaption></figure><p>Here, variable <code>fileName</code> is redundant:</p><figure class="highlight"><pre><code class="language-java" data-lang="java"><span></span><span class="n">String</span> <span class="n">fileName</span> <span class="o">=</span> <span class="s">&quot;test.txt&quot;</span><span class="o">;</span>
<span class="n">print</span><span class="o">(</span><span class="s">&quot;Length is &quot;</span> <span class="o">+</span> <span class="k">new</span> <span class="n">File</span><span class="o">(</span><span class="n">fileName</span><span class="o">).</span><span class="na">length</span><span class="o">());</span></code></pre></figure><p>This code must look differently:</p><figure class="highlight"><pre><code class="language-java" data-lang="java"><span></span><span class="n">print</span><span class="o">(</span><span class="s">&quot;Length is &quot;</span> <span class="o">+</span> <span class="k">new</span> <span class="n">File</span><span class="o">(</span><span class="s">&quot;test.txt&quot;</span><span class="o">).</span><span class="na">length</span><span class="o">());</span></code></pre></figure><p>This example is very primitive, but I&#39;m sure you&#39;ve seen these redundant variables many times. We use them to &quot;explain&quot; the code---it&#39;s not just a string literal <code>&quot;test.txt&quot;</code> anymore but a <code>fileName</code>. The code looks easier to understand, right? Not really.</p><aside class='quote'>The more variable names I have to remember, the longer it takes to digest the code</aside><p>Let&#39;s dig into what &quot;readability&quot; of code is in the first place. I think this quality can be measured by the number of seconds I need to understand the code I&#39;m looking at. The longer the timeframe, the lower the readability. Ideally, I want to understand any piece of code in a <strong>few seconds</strong>. If I can&#39;t, that&#39;s a failure of its <strong>author</strong>.</p><p><a href="/2015/06/29/simple-diagrams.html">Remember</a>, if I don&#39;t understand you, it&#39;s your fault.</p><p>An increasing length of code degrades readability. So the more variable names I have to remember while reading through it, the longer it takes to digest the code and come to a conclusion about its purpose and effects. I think <strong>four</strong> is the maximum number of variables I can comfortably keep in my head without thinking about quitting the job.</p><p>New variables make the code longer because they need extra lines to be declared. And they make the code more complex because its reader has to remember more names.</p><p>Thus, when you want to introduce a new variable to explain what your code is doing, stop and think. Your code is too complex and long in the first place! Refactor it using new objects or methods but not variables. Make your code shorter by moving pieces of it into new classes or private methods.</p><p>Moreover, I think that in <a href="/2015/08/18/multiple-return-statements-in-oop.html">perfectly designed methods</a>, you won&#39;t need <strong>any</strong> variables aside from method arguments.</p></p>--> <nav class="buttons notranslate desktop-only"> <a href="http://www.facebook.com/sharer/sharer.php?u=https://www.yegor256.com/2015/09/01/redundant-variables-are-evil.html" title="Share on Facebook" class="button" rel="nofollow"> <span class="count count-facebook">0</span> <i class="icon icon-facebook notranslate" aria-hidden="true"></i> </a> <a href="https://twitter.com/share?url=https://www.yegor256.com/2015/09/01/redundant-variables-are-evil.html&amp;text=Redundant+Variables+Are+Pure+Evil" title="Share on Twitter" class="button" rel="nofollow"> <span class="count count-twitter">0</span> <i class="icon icon-twitter notranslate" aria-hidden="true"></i> </a> <a href="https://plus.google.com/share?url=https://www.yegor256.com/2015/09/01/redundant-variables-are-evil.html" title="Share on Google+" class="button" rel="nofollow"> <span class="count count-googleplus">0</span> <i class="icon icon-googleplus notranslate" aria-hidden="true"></i> </a> <a href="https://www.linkedin.com/cws/share?url=https://www.yegor256.com/2015/09/01/redundant-variables-are-evil.html" title="Share on LinkedIn" class="button" rel="nofollow"> <span class="count count-linkedin">0</span> <i class="icon icon-linkedin notranslate" aria-hidden="true"></i> </a> <a href="http://reddit.com/submit?url=https://www.yegor256.com/2015/09/01/redundant-variables-are-evil.html%3F2015-35&amp;title=Redundant+Variables+Are+Pure+Evil" title="Share on Reddit" class="button" rel="nofollow"> <span class="count count-reddit">0</span> <i class="icon icon-reddit notranslate" aria-hidden="true"></i> </a> <a href="http://news.ycombinator.com/submitlink?u=https://www.yegor256.com/2015/09/01/redundant-variables-are-evil.html%3F2015-35&amp;t=Redundant+Variables+Are+Pure+Evil" title="Share on Hacker News" class="button" rel="nofollow"> <span class="count count-hackernews">0</span> <i class="icon icon-hackernews notranslate" aria-hidden="true"></i> </a> </nav> </header> <article class="main" itemprop="articleBody"><div ><p>A redundant variable is one that exists exclusively to <strong>explain</strong> its value. I strongly believe that such a variable is not only pure noise but also <strong>evil</strong>, with a very negative effect on code readability. When we introduce a redundant variable, we intend to make our code cleaner and easier to read. In reality, though, we make it more verbose and difficult to understand. Without exception, any variable used only once is redundant and must be replaced with a value.</p><figure class='jb_picture'><img itemprop='image' alt='Y Tu Mamá También (2001) by Alfonso Cuarón' src='/images/2015/09/y-tu-mama-tambien.jpg' longdesc='#c57934a9'/><figcaption id='c57934a9'>Y Tu Mamá También (2001) by Alfonso Cuarón</figcaption></figure><p>Here, variable <code>fileName</code> is redundant:</p><figure class="highlight"><pre><code class="language-java" data-lang="java"><span></span><span class="n">String</span> <span class="n">fileName</span> <span class="o">=</span> <span class="s">&quot;test.txt&quot;</span><span class="o">;</span>
<span class="n">print</span><span class="o">(</span><span class="s">&quot;Length is &quot;</span> <span class="o">+</span> <span class="k">new</span> <span class="n">File</span><span class="o">(</span><span class="n">fileName</span><span class="o">).</span><span class="na">length</span><span class="o">());</span></code></pre></figure><p>This code must look differently:</p><figure class="highlight"><pre><code class="language-java" data-lang="java"><span></span><span class="n">print</span><span class="o">(</span><span class="s">&quot;Length is &quot;</span> <span class="o">+</span> <span class="k">new</span> <span class="n">File</span><span class="o">(</span><span class="s">&quot;test.txt&quot;</span><span class="o">).</span><span class="na">length</span><span class="o">());</span></code></pre></figure><p>This example is very primitive, but I&#39;m sure you&#39;ve seen these redundant variables many times. We use them to &quot;explain&quot; the code---it&#39;s not just a string literal <code>&quot;test.txt&quot;</code> anymore but a <code>fileName</code>. The code looks easier to understand, right? Not really.</p><aside class='quote'>The more variable names I have to remember, the longer it takes to digest the code</aside><p>Let&#39;s dig into what &quot;readability&quot; of code is in the first place. I think this quality can be measured by the number of seconds I need to understand the code I&#39;m looking at. The longer the timeframe, the lower the readability. Ideally, I want to understand any piece of code in a <strong>few seconds</strong>. If I can&#39;t, that&#39;s a failure of its <strong>author</strong>.</p><p><a href="/2015/06/29/simple-diagrams.html">Remember</a>, if I don&#39;t understand you, it&#39;s your fault.</p><p>An increasing length of code degrades readability. So the more variable names I have to remember while reading through it, the longer it takes to digest the code and come to a conclusion about its purpose and effects. I think <strong>four</strong> is the maximum number of variables I can comfortably keep in my head without thinking about quitting the job.</p><p>New variables make the code longer because they need extra lines to be declared. And they make the code more complex because its reader has to remember more names.</p><p>Thus, when you want to introduce a new variable to explain what your code is doing, stop and think. Your code is too complex and long in the first place! Refactor it using new objects or methods but not variables. Make your code shorter by moving pieces of it into new classes or private methods.</p><p>Moreover, I think that in <a href="/2015/08/18/multiple-return-statements-in-oop.html">perfectly designed methods</a>, you won&#39;t need <strong>any</strong> variables aside from method arguments.</p></div></article></div><div class="wrapper"> <related-posts /></div><div class="disqus" role="complementary"><p class="disqus_hint"> Please, use <a href="https://help.disqus.com/commenting/what-html-tags-are-allowed-within-comments">syntax highlighting</a> in your comments, to make them more readable.</p><div id="disqus_thread" class="disqus-thread"> <a>&nbsp;</a></div><script> var disqus_config = function () { this.page.url = document.location.href.split('?')[0].split('#')[0].replace('https://', 'http://'); this.page.identifier = this.page.url; }; (function() { var d = document, s = d.createElement('script'); s.src = '//yegor256.disqus.com/embed.js'; s.setAttribute('data-timestamp', +new Date()); (d.head || d.body).appendChild(s); })(); </script> <noscript><div><p class="red"> JavaScript is disabled in your browser, that's why you can't see comments under this post.</p></div></noscript></div><div class="wrapper"> <footer class="footer"><p> &copy; <span itemscope="" itemprop="copyrightHolder" itemtype="http://schema.org/Person"> <span itemprop="name">Yegor Bugayenko</span> </span> 2014&ndash;<span itemprop="copyrightYear">2018</span></p></footer></div></section><div class="wrapper unprintable" style="text-align:center;margin-top:2em;"> <a href="http://www.sixnines.io/h/3ba1652f"> <img src="//www.sixnines.io/b/3ba1652f?style=flat" alt="sixnines availability badge"/> </a></div><script src="//code.jquery.com/jquery-1.9.0.min.js"></script> <script src="/js/all.js?4e047f6f42b"></script> <script>var disqus_shortname = 'yegor256';</script> <script id="dsq-count-scr" src="//yegor256.disqus.com/count.js" async="async"></script> <script> (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){ (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o), m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m) })(window,document,'script','//www.google-analytics.com/analytics.js','ga'); ga('create', 'UA-1963507-32', 'auto'); ga('send', 'pageview'); </script> <script> Cd=document;Cr="&"+Math.random();Cp="&s=1"; Cd.cookie="b=b";if(Cd.cookie)Cp+="&c=1"; Cp+="&t="+(new Date()).getTimezoneOffset(); if(self!=top)Cp+="&f=1"; </script> <script> if(navigator.javaEnabled())Cp+="&j=1"; </script> <script> if(typeof(screen)!='undefined')Cp+="&w="+screen.width+"&h="+ screen.height+"&d="+(screen.colorDepth?screen.colorDepth:screen.pixelDepth); </script> <script> Cd.write("<img src='//c.hit.ua/hit?i=95870&g=0&x=2"+Cp+Cr+ "&r="+escape(Cd.referrer)+"&u="+escape(window.location.href)+ "' border='0' wi"+"dth='1' he"+"ight='1'/>"); </script> <script type="application/ld+json"> { "@context": "http://schema.org", "@type": "Person", "name": "Yegor Bugayenko", "url": "http://www.yegor256.com", "sameAs": [ "https://www.facebook.com/yegor256", "https://instagram.com/yegor256", "https://www.linkedin.com/in/yegor256", "https://twitter.com/yegor256", "https://github.com/yegor256", "https://www.pinterest.com/yegor256/" ] } </script> </body> </html> <!DOCTYPE html> <html xmlns="http://www.w3.org/1999/xhtml" lang="en-US" xml:lang="en-US" itemscope="" itemtype="http://schema.org/WebSite"> <head> <meta charset="utf-8"/> <meta name="description" content="A properly designed method in object-oriented software must have a single return statement---and nothing but a return statement. " /> <meta name="keywords" content="one return only, one return statement, single exit point, single function exit point, single return in method" /> <meta name="viewport" content="width=device-width,minimum-scale=1,initial-scale=1"/> <meta name="google-site-verification" content="JEj_gQr2CPe2QKGw8XdMz0R7VboQIUbX3FlM-lwTq-8" /> <meta name="author" content="Yegor Bugayenko"> <meta name="article:published_time" content="2015-08-18 00:00:00 +0000"> <meta name="og:site_name" content="Yegor Bugayenko"/> <meta name="og:type" content="article" /> <meta name="og:locale" content="en_US" /> <meta name="twitter:account_id" content="4503599630178231" /> <meta name="twitter:creator" content="@yegor256"/> <meta name="twitter:site" content="@yegor256"/> <meta name="twitter:title" property="og:title" content="Why Many Return Statements Are a Bad Idea in OOP"/> <meta name="twitter:description" property="og:description" content="A properly designed method in object-oriented software must have a single return statement---and nothing but a return statement. "/> <meta name="twitter:url" property="og:url" content="https://www.yegor256.com/2015/08/18/multiple-return-statements-in-oop.html"/> <meta name="telegram:channel" content="AAAAAEJFMRzsRTRxM3ec6A"/> <link rel="search" type="application/opensearchdescription+xml" href="/opensearch.xml" title="yegor256" /> <link rel="shortcut icon" href="/favicon.ico?4e047f6f42b"/> <link rel="apple-touch-icon" href="/favicon.ico?4e047f6f42b"/> <link rel="alternate" type="application/rss+xml" title="RSS for yegor256.com" href="https://www.yegor256.com/rss.xml"/> <link rel="stylesheet" href="/css/layout.css?4e047f6f42b"/> <link rel="stylesheet" href="/css/icons.css?4e047f6f42b"/> <link rel="canonical" href="https://www.yegor256.com/2015/08/18/multiple-return-statements-in-oop.html" /> <link rel="amphtml" href="https://www.yegor256.com/2015/08/18/multiple-return-statements-in-oop.amp.html" /> <title>Why Many Return Statements Are a Bad Idea in OOP </title> </head> <body><div class="wrapper"> <aside class="header-toggle unprintable" id="header-toggle" title="Show the menu" onclick="$('#header').show();$('#header-toggle').hide();">&#9776;</aside> <header class="header" id="header"><div class="face"> <a href="/about-me.html#form" class="sub" title="Click to subscribe to my monthly newsletter"><span>Subscribe</span></a> <a href="/about-me.html" style="position:relative;"> <img src="/images/face-256x256.jpg" class="photo" alt="Yegor Bugayenko"/> </a></div><nav><ul class="menu social notranslate"> <li><a href="https://twitter.com/intent/follow?screen_name=yegor256" rel="nofollow" title="Follow me on Twitter"><i class="icon icon-twitter notranslate" aria-hidden="true"></i></a></li> <li><a href="/rss.xml" rel="nofollow" title="Subscribe to my RSS feed"><i class="icon icon-rss notranslate" aria-hidden="true"></i></a></li> <li><a itemprop="sameAs" href="https://github.com/yegor256" rel="nofollow" title="My GitHub profile"><i class="icon icon-github notranslate" aria-hidden="true"></i></a></li> <li><a itemprop="sameAs" href="http://stackoverflow.com/users/187141/yegor256" rel="nofollow" title="My StackOverflow profile"><i class="icon icon-stackoverflow notranslate" aria-hidden="true"></i></a></li> <li><a itemprop="sameAs" href="https://www.facebook.com/yegor256" rel="nofollow" title="Follow me on Facebook"><i class="icon icon-facebook notranslate" aria-hidden="true"></i></a></li> <li><a itemprop="sameAs" href="https://instagram.com/yegor256" rel="nofollow" title="Follow me on Instagram"><i class="icon icon-instagram notranslate" aria-hidden="true"></i></a></li> <li><a itemprop="sameAs" href="https://www.linkedin.com/in/yegor256" rel="nofollow" title="My LinkedIn profile"><i class="icon icon-linkedin notranslate" aria-hidden="true"></i></a></li> <li><a itemprop="sameAs" href="https://www.youtube.com/c/yegor256?sub_confirmation=1" rel="nofollow" title="My Youtube video channel"><i class="icon icon-youtube notranslate" aria-hidden="true"></i></a></li> <li><a itemprop="sameAs" href="https://www.pinterest.com/yegor256/" rel="nofollow" title="My Pinterest boards"><i class="icon icon-pinterest notranslate" aria-hidden="true"></i></a></li> <li><a itemprop="sameAs" href="https://angel.co/yegor256" rel="nofollow" title="My AngelList profile"><i class="icon icon-angellist notranslate" aria-hidden="true"></i></a></li> <li><a href="https://soundcloud.com/yegor256" rel="nofollow" title="My podcast"><i class="icon icon-podcast notranslate" aria-hidden="true"></i></a></li> <li><a href="https://itunes.apple.com/us/podcast/yegor256-podcast/id1150826721" rel="nofollow" title="My iTunes podcast"><i class="icon icon-itunes notranslate" aria-hidden="true"></i></a></li> <li><a href="https://t.me/joinchat/AAAAAEJFMRzsRTRxM3ec6A" rel="nofollow" title="My Telegram public channel"><i class="icon icon-telegram notranslate" aria-hidden="true"></i></a></li> <li><a href="mailto:blog@yegor256.com" rel="nofollow" title="Email me any time"><i class="icon icon-mail notranslate" aria-hidden="true"></i></a></li></ul><ul class="menu"> <li><a href="/" title="Home page">Home</a></li> <li ><a href="/best.html" title="Best articles to read">12&#160;Best</a></li> <li ><a href="/contents.html" title="The contents of the entire blog">All&#160;288</a></li> <li ><a href="/webinars.html" title="My webinars">Webinars</a></li> <li ><a href="/talks.html" title="Future and past conference talks">Talks</a></li> <li ><a href="/books.html" title="The books I wrote">Books</a></li> <li ><a href="/papers.html" title="My academic papers and patents">Papers</a></li> <li ><a href="/pets.html" title="My loved pet projects">Pets</a></li> <li ><a href="/award.html" title="Software quality award">Award</a></li> <li ><a href="/testimonials.html" title="What some people say about me">Testimonials</a></li> <li ><a href="/shift-m.html" title="Audio podcast about project management">Shift-M</a></li> <li ><a href="/paintings.html" title="My paintings for sale">Paintings</a></li> <li><a href="http://ru.yegor256.com/" title="Немного на русском языке">По-русски</a></li></ul></nav><div class="search"> <form method="get" action="https://www.google.com/search" itemprop="potentialAction" itemscope="" itemtype="http://schema.org/SearchAction"> <meta itemprop="target" content="https://www.google.com/search?q={q}"/> <input name="sitesearch" value="yegor256.com" type="hidden"/> <input itemprop="query-input" type="text" id="search-query" class="field field-text" required="required" onfocus="$('.google').css('visibility', 'visible');" name="q" placeholder="Search..." autocomplete="off"/> <input type="image" src="/images/google-search-icon.svg" class="google" title="Search via Google" alt="Search via Google"/> </form></div><div class="hot"><ul> <li> <a href="/code-ahead.html">Code Ahead</a> was published on Amazon just a few days ago! It is my new book, a novel about programmers. It explains in details the majority of ideas that stand behind <a href="https://www.zerocracy.com">Zerocracy</a> and <a href="https://www.xdsd.org">XDSD</a>. </li> <li> At <a href="/webinars.html">Webinar #37</a> we will discuss naming problem in OOP, for objects, methods and attributes; join us on <b>September 12</b>, at 11am PST. </li></ul></div></header></div><section itemscope="" itemtype="http://schema.org/BlogPosting"><div class="wrapper"> <header><p class="printable"> <img src="https://api.qrserver.com/v1/create-qr-code/?data=https://www.yegor256.com/2015/08/18/multiple-return-statements-in-oop.html&amp;format=svg" style="width:125px;height:125px;" alt="QR code"/></p><p class="printable"> <code itemprop="url">https://www.yegor256.com/2015/08/18/multiple-return-statements-in-oop.html</code></p><h1 itemprop="name headline mainEntityOfPage">Why Many Return Statements Are a Bad Idea in OOP</h1><ul class="subline"> <li> <time itemprop="datePublished" datetime="2015-08-18T00:00:00+00:00"> 18 August 2015 </time> </li> <li class="desktop-only" itemprop="locationCreated">Kiev, Ukraine</li> <li class="printable" itemscope="" itemprop="author" itemtype="http://schema.org/Person"> <span itemprop="name">Yegor Bugayenko</span> </li> <li class="unprintable"> <i class="icon icon-comments"></i> <a href="http://www.yegor256.com/2015/08/18/multiple-return-statements-in-oop.html#disqus_thread" itemprop="discussionUrl">comments</a> </li></ul><p>This is a classical example:</p><figure class="highlight"><pre><code class="language-java" data-lang="java"><span></span><span class="kd">public</span> <span class="kt">int</span> <span class="nf">max</span><span class="o">(</span><span class="kt">int</span> <span class="n">a</span><span class="o">,</span> <span class="kt">int</span> <span class="n">b</span><span class="o">)</span> <span class="o">{</span>
  <span class="k">if</span> <span class="o">(</span><span class="n">a</span> <span class="o">&gt;</span> <span class="n">b</span><span class="o">)</span> <span class="o">{</span>
    <span class="k">return</span> <span class="n">a</span><span class="o">;</span>
  <span class="o">}</span>
  <span class="k">return</span> <span class="n">b</span><span class="o">;</span>
<span class="o">}</span></code></pre></figure><p>The code above has two <code>return</code> statements, and it is shorter than this one with a single <code>return</code>:</p><figure class="highlight"><pre><code class="language-java" data-lang="java"><span></span><span class="kd">public</span> <span class="kt">int</span> <span class="nf">max</span><span class="o">(</span><span class="kt">int</span> <span class="n">a</span><span class="o">,</span> <span class="kt">int</span> <span class="n">b</span><span class="o">)</span> <span class="o">{</span>
  <span class="kt">int</span> <span class="n">m</span><span class="o">;</span>
  <span class="k">if</span> <span class="o">(</span><span class="n">a</span> <span class="o">&gt;</span> <span class="n">b</span><span class="o">)</span> <span class="o">{</span>
    <span class="n">m</span> <span class="o">=</span> <span class="n">a</span><span class="o">;</span>
  <span class="o">}</span> <span class="k">else</span> <span class="o">{</span>
    <span class="n">m</span> <span class="o">=</span> <span class="n">b</span><span class="o">;</span>
  <span class="o">}</span>
  <span class="k">return</span> <span class="n">m</span><span class="o">;</span>
<span class="o">}</span></code></pre></figure><p>More verbose, less readable, and slower, right? Right.</p><p>This is the code in a <strong>pure</strong> object-oriented world:</p><figure class="highlight"><pre><code class="language-java" data-lang="java"><span></span><span class="kd">public</span> <span class="kt">int</span> <span class="nf">max</span><span class="o">(</span><span class="kt">int</span> <span class="n">a</span><span class="o">,</span> <span class="kt">int</span> <span class="n">b</span><span class="o">)</span> <span class="o">{</span>
  <span class="k">return</span> <span class="k">new</span> <span class="n">If</span><span class="o">(</span>
    <span class="k">new</span> <span class="n">GreaterThan</span><span class="o">(</span><span class="n">a</span><span class="o">,</span> <span class="n">b</span><span class="o">),</span>
    <span class="n">a</span><span class="o">,</span> <span class="n">b</span>
  <span class="o">);</span>
<span class="o">}</span></code></pre></figure><p>What do you think now? There are no statements or operators. No <code>if</code> and no <code>&gt;</code>. Instead, there are <strong>objects</strong> of class <code>If</code> and <code>GreaterThan</code>.</p><p>This is a pure and clean object-oriented approach.</p><p>However, Java doesn&#39;t have that. Java (and many other pseudo OOP languages) gives us operators like <code>if</code>, <code>else</code>, <code>switch</code>, <code>for</code>, <code>while</code>, etc. instead of giving built-in classes, which would do the same. Because of that, we continue to think in terms of procedures and keep talking about whether two <code>return</code> statements are better than one.</p><p>If your code is truly object-oriented, you won&#39;t be able to have more than one <code>return</code>. Moreover, you will have nothing except a <code>return</code> in each method. Actually, you will have only two operators in the entire software---<code>new</code> and <code>return</code>. That&#39;s it.</p><p>Until we&#39;re there, let&#39;s stick with just one <code>return</code> and at least try to look like pure <a href="/2016/08/15/what-is-wrong-object-oriented-programming.html">OOP</a>.</p></p>--> <nav class="buttons notranslate desktop-only"> <a href="http://www.facebook.com/sharer/sharer.php?u=https://www.yegor256.com/2015/08/18/multiple-return-statements-in-oop.html" title="Share on Facebook" class="button" rel="nofollow"> <span class="count count-facebook">0</span> <i class="icon icon-facebook notranslate" aria-hidden="true"></i> </a> <a href="https://twitter.com/share?url=https://www.yegor256.com/2015/08/18/multiple-return-statements-in-oop.html&amp;text=Why+Many+Return+Statements+Are+a+Bad+Idea+in+OOP" title="Share on Twitter" class="button" rel="nofollow"> <span class="count count-twitter">0</span> <i class="icon icon-twitter notranslate" aria-hidden="true"></i> </a> <a href="https://plus.google.com/share?url=https://www.yegor256.com/2015/08/18/multiple-return-statements-in-oop.html" title="Share on Google+" class="button" rel="nofollow"> <span class="count count-googleplus">0</span> <i class="icon icon-googleplus notranslate" aria-hidden="true"></i> </a> <a href="https://www.linkedin.com/cws/share?url=https://www.yegor256.com/2015/08/18/multiple-return-statements-in-oop.html" title="Share on LinkedIn" class="button" rel="nofollow"> <span class="count count-linkedin">0</span> <i class="icon icon-linkedin notranslate" aria-hidden="true"></i> </a> <a href="http://reddit.com/submit?url=https://www.yegor256.com/2015/08/18/multiple-return-statements-in-oop.html%3F2015-33&amp;title=Why+Many+Return+Statements+Are+a+Bad+Idea+in+OOP" title="Share on Reddit" class="button" rel="nofollow"> <span class="count count-reddit">0</span> <i class="icon icon-reddit notranslate" aria-hidden="true"></i> </a> <a href="http://news.ycombinator.com/submitlink?u=https://www.yegor256.com/2015/08/18/multiple-return-statements-in-oop.html%3F2015-33&amp;t=Why+Many+Return+Statements+Are+a+Bad+Idea+in+OOP" title="Share on Hacker News" class="button" rel="nofollow"> <span class="count count-hackernews">0</span> <i class="icon icon-hackernews notranslate" aria-hidden="true"></i> </a> </nav> </header> <article class="main" itemprop="articleBody"><div ><p>This <a href="http://programmers.stackexchange.com/questions/118703">debate</a> is very old, but I have something to say too. The question is whether a method may have multiple <code>return</code> statements or always just one. The answer may surprise you: In a pure object-oriented world, a method <strong>must</strong> have a <strong>single</strong> <code>return</code> statement and <strong>nothing</strong> else. Yes, just a <code>return</code> statement and that&#39;s it. No other operators or statements. Just <code>return</code>. All arguments in favor of multiple <code>return</code> statements go against the very idea of object-oriented programming.</p><p>This is a classical example:</p><figure class="highlight"><pre><code class="language-java" data-lang="java"><span></span><span class="kd">public</span> <span class="kt">int</span> <span class="nf">max</span><span class="o">(</span><span class="kt">int</span> <span class="n">a</span><span class="o">,</span> <span class="kt">int</span> <span class="n">b</span><span class="o">)</span> <span class="o">{</span>
  <span class="k">if</span> <span class="o">(</span><span class="n">a</span> <span class="o">&gt;</span> <span class="n">b</span><span class="o">)</span> <span class="o">{</span>
    <span class="k">return</span> <span class="n">a</span><span class="o">;</span>
  <span class="o">}</span>
  <span class="k">return</span> <span class="n">b</span><span class="o">;</span>
<span class="o">}</span></code></pre></figure><p>The code above has two <code>return</code> statements, and it is shorter than this one with a single <code>return</code>:</p><figure class="highlight"><pre><code class="language-java" data-lang="java"><span></span><span class="kd">public</span> <span class="kt">int</span> <span class="nf">max</span><span class="o">(</span><span class="kt">int</span> <span class="n">a</span><span class="o">,</span> <span class="kt">int</span> <span class="n">b</span><span class="o">)</span> <span class="o">{</span>
  <span class="kt">int</span> <span class="n">m</span><span class="o">;</span>
  <span class="k">if</span> <span class="o">(</span><span class="n">a</span> <span class="o">&gt;</span> <span class="n">b</span><span class="o">)</span> <span class="o">{</span>
    <span class="n">m</span> <span class="o">=</span> <span class="n">a</span><span class="o">;</span>
  <span class="o">}</span> <span class="k">else</span> <span class="o">{</span>
    <span class="n">m</span> <span class="o">=</span> <span class="n">b</span><span class="o">;</span>
  <span class="o">}</span>
  <span class="k">return</span> <span class="n">m</span><span class="o">;</span>
<span class="o">}</span></code></pre></figure><p>More verbose, less readable, and slower, right? Right.</p><p>This is the code in a <strong>pure</strong> object-oriented world:</p><figure class="highlight"><pre><code class="language-java" data-lang="java"><span></span><span class="kd">public</span> <span class="kt">int</span> <span class="nf">max</span><span class="o">(</span><span class="kt">int</span> <span class="n">a</span><span class="o">,</span> <span class="kt">int</span> <span class="n">b</span><span class="o">)</span> <span class="o">{</span>
  <span class="k">return</span> <span class="k">new</span> <span class="n">If</span><span class="o">(</span>
    <span class="k">new</span> <span class="n">GreaterThan</span><span class="o">(</span><span class="n">a</span><span class="o">,</span> <span class="n">b</span><span class="o">),</span>
    <span class="n">a</span><span class="o">,</span> <span class="n">b</span>
  <span class="o">);</span>
<span class="o">}</span></code></pre></figure><p>What do you think now? There are no statements or operators. No <code>if</code> and no <code>&gt;</code>. Instead, there are <strong>objects</strong> of class <code>If</code> and <code>GreaterThan</code>.</p><p>This is a pure and clean object-oriented approach.</p><p>However, Java doesn&#39;t have that. Java (and many other pseudo OOP languages) gives us operators like <code>if</code>, <code>else</code>, <code>switch</code>, <code>for</code>, <code>while</code>, etc. instead of giving built-in classes, which would do the same. Because of that, we continue to think in terms of procedures and keep talking about whether two <code>return</code> statements are better than one.</p><p>If your code is truly object-oriented, you won&#39;t be able to have more than one <code>return</code>. Moreover, you will have nothing except a <code>return</code> in each method. Actually, you will have only two operators in the entire software---<code>new</code> and <code>return</code>. That&#39;s it.</p><p>Until we&#39;re there, let&#39;s stick with just one <code>return</code> and at least try to look like pure <a href="/2016/08/15/what-is-wrong-object-oriented-programming.html">OOP</a>.</p></div></article></div><div class="wrapper"> <related-posts /></div><div class="disqus" role="complementary"><p class="disqus_hint"> Please, use <a href="https://help.disqus.com/commenting/what-html-tags-are-allowed-within-comments">syntax highlighting</a> in your comments, to make them more readable.</p><div id="disqus_thread" class="disqus-thread"> <a>&nbsp;</a></div><script> var disqus_config = function () { this.page.url = document.location.href.split('?')[0].split('#')[0].replace('https://', 'http://'); this.page.identifier = this.page.url; }; (function() { var d = document, s = d.createElement('script'); s.src = '//yegor256.disqus.com/embed.js'; s.setAttribute('data-timestamp', +new Date()); (d.head || d.body).appendChild(s); })(); </script> <noscript><div><p class="red"> JavaScript is disabled in your browser, that's why you can't see comments under this post.</p></div></noscript></div><div class="wrapper"> <footer class="footer"><p> &copy; <span itemscope="" itemprop="copyrightHolder" itemtype="http://schema.org/Person"> <span itemprop="name">Yegor Bugayenko</span> </span> 2014&ndash;<span itemprop="copyrightYear">2018</span></p></footer></div></section><div class="wrapper unprintable" style="text-align:center;margin-top:2em;"> <a href="http://www.sixnines.io/h/3ba1652f"> <img src="//www.sixnines.io/b/3ba1652f?style=flat" alt="sixnines availability badge"/> </a></div><script src="//code.jquery.com/jquery-1.9.0.min.js"></script> <script src="/js/all.js?4e047f6f42b"></script> <script>var disqus_shortname = 'yegor256';</script> <script id="dsq-count-scr" src="//yegor256.disqus.com/count.js" async="async"></script> <script> (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){ (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o), m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m) })(window,document,'script','//www.google-analytics.com/analytics.js','ga'); ga('create', 'UA-1963507-32', 'auto'); ga('send', 'pageview'); </script> <script> Cd=document;Cr="&"+Math.random();Cp="&s=1"; Cd.cookie="b=b";if(Cd.cookie)Cp+="&c=1"; Cp+="&t="+(new Date()).getTimezoneOffset(); if(self!=top)Cp+="&f=1"; </script> <script> if(navigator.javaEnabled())Cp+="&j=1"; </script> <script> if(typeof(screen)!='undefined')Cp+="&w="+screen.width+"&h="+ screen.height+"&d="+(screen.colorDepth?screen.colorDepth:screen.pixelDepth); </script> <script> Cd.write("<img src='//c.hit.ua/hit?i=95870&g=0&x=2"+Cp+Cr+ "&r="+escape(Cd.referrer)+"&u="+escape(window.location.href)+ "' border='0' wi"+"dth='1' he"+"ight='1'/>"); </script> <script type="application/ld+json"> { "@context": "http://schema.org", "@type": "Person", "name": "Yegor Bugayenko", "url": "http://www.yegor256.com", "sameAs": [ "https://www.facebook.com/yegor256", "https://instagram.com/yegor256", "https://www.linkedin.com/in/yegor256", "https://twitter.com/yegor256", "https://github.com/yegor256", "https://www.pinterest.com/yegor256/" ] } </script> </body> </html> <!DOCTYPE html> <html xmlns="http://www.w3.org/1999/xhtml" lang="en-US" xml:lang="en-US" itemscope="" itemtype="http://schema.org/WebSite"> <head> <meta charset="utf-8"/> <meta name="description" content="While most programmers think checked exceptions in Java are a mistake, I&apos;m of the opposite opinion---unchecked ones are a mistake. " /> <meta name="keywords" content="checked vs unchecked exceptions, checked vs unchecked exceptions c#, checked vs unchecked exceptions debate, checked vs unchecked exceptions example, checked vs unchecked exceptions java" /> <meta name="viewport" content="width=device-width,minimum-scale=1,initial-scale=1"/> <meta name="google-site-verification" content="JEj_gQr2CPe2QKGw8XdMz0R7VboQIUbX3FlM-lwTq-8" /> <meta name="author" content="Yegor Bugayenko"> <meta name="article:published_time" content="2015-07-28 00:00:00 +0000"> <meta name="og:site_name" content="Yegor Bugayenko"/> <meta name="og:type" content="article" /> <meta name="og:locale" content="en_US" /> <meta name="twitter:account_id" content="4503599630178231" /> <meta name="twitter:creator" content="@yegor256"/> <meta name="twitter:site" content="@yegor256"/> <meta name="twitter:title" property="og:title" content="Checked vs. Unchecked Exceptions: The Debate Is Not Over"/> <meta name="twitter:description" property="og:description" content="While most programmers think checked exceptions in Java are a mistake, I&apos;m of the opposite opinion---unchecked ones are a mistake. "/> <meta name="twitter:url" property="og:url" content="https://www.yegor256.com/2015/07/28/checked-vs-unchecked-exceptions.html"/> <meta name="telegram:channel" content="AAAAAEJFMRzsRTRxM3ec6A"/> <link rel="search" type="application/opensearchdescription+xml" href="/opensearch.xml" title="yegor256" /> <link rel="shortcut icon" href="/favicon.ico?4e047f6f42b"/> <link rel="apple-touch-icon" href="/favicon.ico?4e047f6f42b"/> <link rel="alternate" type="application/rss+xml" title="RSS for yegor256.com" href="https://www.yegor256.com/rss.xml"/> <link rel="stylesheet" href="/css/layout.css?4e047f6f42b"/> <link rel="stylesheet" href="/css/icons.css?4e047f6f42b"/> <link rel="canonical" href="https://www.yegor256.com/2015/07/28/checked-vs-unchecked-exceptions.html" /> <link rel="amphtml" href="https://www.yegor256.com/2015/07/28/checked-vs-unchecked-exceptions.amp.html" /> <title>Checked vs. Unchecked Exceptions: The Debate Is Not Over </title> <meta name='og:image' content='https://www.yegor256.com/images/2015/07/true-romance.jpg'/><meta name='twitter:image' content='https://www.yegor256.com/images/2015/07/true-romance.jpg'/><meta name='og:image:width' content='1200'/> <meta name='twitter:image:width' content='1200'/><meta name='og:image:height' content='496'/> <meta name='twitter:image:height' content='496'/><meta name='twitter:card' content='summary_large_image'/><meta name='twitter:image:alt' content='True Romance (1993) by Tony Scott'/> </head> <body><div class="wrapper"> <aside class="header-toggle unprintable" id="header-toggle" title="Show the menu" onclick="$('#header').show();$('#header-toggle').hide();">&#9776;</aside> <header class="header" id="header"><div class="face"> <a href="/about-me.html#form" class="sub" title="Click to subscribe to my monthly newsletter"><span>Subscribe</span></a> <a href="/about-me.html" style="position:relative;"> <img src="/images/face-256x256.jpg" class="photo" alt="Yegor Bugayenko"/> </a></div><nav><ul class="menu social notranslate"> <li><a href="https://twitter.com/intent/follow?screen_name=yegor256" rel="nofollow" title="Follow me on Twitter"><i class="icon icon-twitter notranslate" aria-hidden="true"></i></a></li> <li><a href="/rss.xml" rel="nofollow" title="Subscribe to my RSS feed"><i class="icon icon-rss notranslate" aria-hidden="true"></i></a></li> <li><a itemprop="sameAs" href="https://github.com/yegor256" rel="nofollow" title="My GitHub profile"><i class="icon icon-github notranslate" aria-hidden="true"></i></a></li> <li><a itemprop="sameAs" href="http://stackoverflow.com/users/187141/yegor256" rel="nofollow" title="My StackOverflow profile"><i class="icon icon-stackoverflow notranslate" aria-hidden="true"></i></a></li> <li><a itemprop="sameAs" href="https://www.facebook.com/yegor256" rel="nofollow" title="Follow me on Facebook"><i class="icon icon-facebook notranslate" aria-hidden="true"></i></a></li> <li><a itemprop="sameAs" href="https://instagram.com/yegor256" rel="nofollow" title="Follow me on Instagram"><i class="icon icon-instagram notranslate" aria-hidden="true"></i></a></li> <li><a itemprop="sameAs" href="https://www.linkedin.com/in/yegor256" rel="nofollow" title="My LinkedIn profile"><i class="icon icon-linkedin notranslate" aria-hidden="true"></i></a></li> <li><a itemprop="sameAs" href="https://www.youtube.com/c/yegor256?sub_confirmation=1" rel="nofollow" title="My Youtube video channel"><i class="icon icon-youtube notranslate" aria-hidden="true"></i></a></li> <li><a itemprop="sameAs" href="https://www.pinterest.com/yegor256/" rel="nofollow" title="My Pinterest boards"><i class="icon icon-pinterest notranslate" aria-hidden="true"></i></a></li> <li><a itemprop="sameAs" href="https://angel.co/yegor256" rel="nofollow" title="My AngelList profile"><i class="icon icon-angellist notranslate" aria-hidden="true"></i></a></li> <li><a href="https://soundcloud.com/yegor256" rel="nofollow" title="My podcast"><i class="icon icon-podcast notranslate" aria-hidden="true"></i></a></li> <li><a href="https://itunes.apple.com/us/podcast/yegor256-podcast/id1150826721" rel="nofollow" title="My iTunes podcast"><i class="icon icon-itunes notranslate" aria-hidden="true"></i></a></li> <li><a href="https://t.me/joinchat/AAAAAEJFMRzsRTRxM3ec6A" rel="nofollow" title="My Telegram public channel"><i class="icon icon-telegram notranslate" aria-hidden="true"></i></a></li> <li><a href="mailto:blog@yegor256.com" rel="nofollow" title="Email me any time"><i class="icon icon-mail notranslate" aria-hidden="true"></i></a></li></ul><ul class="menu"> <li><a href="/" title="Home page">Home</a></li> <li ><a href="/best.html" title="Best articles to read">12&#160;Best</a></li> <li ><a href="/contents.html" title="The contents of the entire blog">All&#160;288</a></li> <li ><a href="/webinars.html" title="My webinars">Webinars</a></li> <li ><a href="/talks.html" title="Future and past conference talks">Talks</a></li> <li ><a href="/books.html" title="The books I wrote">Books</a></li> <li ><a href="/papers.html" title="My academic papers and patents">Papers</a></li> <li ><a href="/pets.html" title="My loved pet projects">Pets</a></li> <li ><a href="/award.html" title="Software quality award">Award</a></li> <li ><a href="/testimonials.html" title="What some people say about me">Testimonials</a></li> <li ><a href="/shift-m.html" title="Audio podcast about project management">Shift-M</a></li> <li ><a href="/paintings.html" title="My paintings for sale">Paintings</a></li> <li><a href="http://ru.yegor256.com/" title="Немного на русском языке">По-русски</a></li></ul></nav><div class="search"> <form method="get" action="https://www.google.com/search" itemprop="potentialAction" itemscope="" itemtype="http://schema.org/SearchAction"> <meta itemprop="target" content="https://www.google.com/search?q={q}"/> <input name="sitesearch" value="yegor256.com" type="hidden"/> <input itemprop="query-input" type="text" id="search-query" class="field field-text" required="required" onfocus="$('.google').css('visibility', 'visible');" name="q" placeholder="Search..." autocomplete="off"/> <input type="image" src="/images/google-search-icon.svg" class="google" title="Search via Google" alt="Search via Google"/> </form></div><div class="hot"><ul> <li> <a href="/code-ahead.html">Code Ahead</a> was published on Amazon just a few days ago! It is my new book, a novel about programmers. It explains in details the majority of ideas that stand behind <a href="https://www.zerocracy.com">Zerocracy</a> and <a href="https://www.xdsd.org">XDSD</a>. </li> <li> At <a href="/webinars.html">Webinar #37</a> we will discuss naming problem in OOP, for objects, methods and attributes; join us on <b>September 12</b>, at 11am PST. </li></ul></div></header></div><section itemscope="" itemtype="http://schema.org/BlogPosting"><div class="wrapper"> <header><p class="printable"> <img src="https://api.qrserver.com/v1/create-qr-code/?data=https://www.yegor256.com/2015/07/28/checked-vs-unchecked-exceptions.html&amp;format=svg" style="width:125px;height:125px;" alt="QR code"/></p><p class="printable"> <code itemprop="url">https://www.yegor256.com/2015/07/28/checked-vs-unchecked-exceptions.html</code></p><h1 itemprop="name headline mainEntityOfPage">Checked vs. Unchecked Exceptions: The Debate Is Not Over</h1><aside class='book'><a href='http://amzn.to/2qFt4Tn'><img src='/images/books/elegant-objects/cover.png' class='book-cover' alt='book cover'/></a>Read more about this subject in <a href='http://amzn.to/2qFt4Tn'>Section&nbsp;4.2</a><br/> of my book<a href='http://amzn.to/2qFt4Tn'><img src='/images/books/amazon-buy-button.png' class='amazon-button' alt='Click to buy'/></a></aside><ul class="subline"> <li> <time itemprop="datePublished" datetime="2015-07-28T00:00:00+00:00"> 28 July 2015 </time> </li> <li class="desktop-only" itemprop="locationCreated">Sunnyvale, CA</li> <li class="printable" itemscope="" itemprop="author" itemtype="http://schema.org/Person"> <span itemprop="name">Yegor Bugayenko</span> </li> <li class="unprintable"> <i class="icon icon-comments"></i> <a href="http://www.yegor256.com/2015/07/28/checked-vs-unchecked-exceptions.html#disqus_thread" itemprop="discussionUrl">comments</a> </li></ul><figure class='jb_picture'><img itemprop='image' alt='True Romance (1993) by Tony Scott' src='/images/2015/07/true-romance.jpg' longdesc='#443dfa82'/><figcaption id='443dfa82'>True Romance (1993) by Tony Scott</figcaption></figure><p>Let me first explain how I understand exceptions in object-oriented programming. Then I&#39;ll compare my understanding with a &quot;traditional&quot; approach, and we&#39;ll discuss the differences. So, my understanding first.</p><p>Say there is a method that saves some binary data to a file:</p><figure class="highlight"><pre><code class="language-java" data-lang="java"><span></span><span class="kd">public</span> <span class="kt">void</span> <span class="nf">save</span><span class="o">(</span><span class="n">File</span> <span class="n">file</span><span class="o">,</span> <span class="kt">byte</span><span class="o">[]</span> <span class="n">data</span><span class="o">)</span>
  <span class="kd">throws</span> <span class="n">Exception</span> <span class="o">{</span>
  <span class="c1">// save data to the file</span>
<span class="o">}</span></code></pre></figure><p>When everything goes right, the method just saves the data and returns control. When something is wrong, it <a href="/2015/12/01/rethrow-exceptions.html">throws</a> <code>Exception</code> and we have to do something about it:</p><figure class="highlight"><pre><code class="language-java" data-lang="java"><span></span><span class="k">try</span> <span class="o">{</span>
  <span class="n">save</span><span class="o">(</span><span class="n">file</span><span class="o">,</span> <span class="n">data</span><span class="o">);</span>
<span class="o">}</span> <span class="k">catch</span> <span class="o">(</span><span class="n">Exception</span> <span class="n">ex</span><span class="o">)</span> <span class="o">{</span>
  <span class="n">System</span><span class="o">.</span><span class="na">out</span><span class="o">.</span><span class="na">println</span><span class="o">(</span><span class="s">&quot;Sorry, we can&#39;t save right now.&quot;</span><span class="o">);</span>
<span class="o">}</span></code></pre></figure><p>When a method says it <code>throws</code> an exception, I understand that the method is not <strong>safe</strong>. It may fail sometimes, and it&#39;s my responsibility to either 1) handle this failure or 2) declare myself as <strong>unsafe</strong> too.</p><p>I know each method is designed with a <a href="https://en.wikipedia.org/wiki/Single_responsibility_principle">single responsibility principle</a> in mind. This is a guarantee to me that if method <code>save()</code> fails, it means the entire saving operation can&#39;t be completed. If I need to know what the cause of this failure was, I will <a href="https://en.wikipedia.org/wiki/Exception_chaining">un-chain</a> the exception---traverse the stack of chained exceptions and stack traces encapsulated in <code>ex</code>.</p><p>I never use exceptions for flow control, which means I <strong>never recover</strong> situations where exceptions are thrown. When an exception occurs, I let it float up to the highest level of the application. Sometimes I <a href="/2015/12/01/rethrow-exceptions.html">rethrow</a> it in order to add more semantic information to the chain. That&#39;s why it doesn&#39;t matter to me what the cause of the exception thrown by <code>save()</code> was. I just know the method failed. That&#39;s enough for me. Always.</p><p>For the same reason, I don&#39;t need to differentiate between different exception types. I just don&#39;t need that type of hierarchy. <code>Exception</code> is enough for me. Again, that&#39;s because I don&#39;t use exceptions for flow control.</p><p>That&#39;s how I understand exceptions.</p><p>According to this paradigm, I would say we must:</p><ul> <li><p>always use checked exceptions.</p></li> <li><p>never throw/use unchecked exceptions.</p></li> <li><p>use only <code>Exception</code>, without any sub-types.</p></li> <li><p>always declare one exception type in the <code>throws</code> block.</p></li> <li><p>never catch without rethrowing; read <a href="/2015/07/09/catch-if-cant-otherwise.html">more about that here</a>.</p></li></ul><p>This paradigm diverges from many other articles I&#39;ve found on this subject. Let&#39;s compare and discuss.</p><h2 id="runtime-vs-api-exceptions">Runtime vs. API Exceptions</h2><p><a href="http://docs.oracle.com/javase/tutorial/essential/exceptions/runtime.html">Oracle says</a> some exceptions should be part of API (checked ones) while some are runtime exceptions and should not be part of it (unchecked). They will be documented in JavaDoc but not in the method signature.</p><p>I don&#39;t understand the logic here, and I&#39;m sure Java designers don&#39;t understand it either. How and why are some exceptions important while others are not? Why do some of them deserve a proper API position in the <code>throws</code> block of the method signature while others don&#39;t? What is the criteria?</p><p>I have an answer here, though. By introducing checked and unchecked exceptions, Java developers tried to solve the problem of methods that are too complex and messy. When a method is too big and does too many things at the same time (violates the single responsibility principle), it&#39;s definitely better to let us keep some exceptions &quot;hidden&quot; (a.k.a. unchecked). But it&#39;s not a real solution. It is only a temporary patch that does all of us more harm than good---methods keep growing in size and complexity.</p><p>Unchecked exceptions are a mistake in Java design, not <a href="/2015/10/20/interrupted-exception.html">checked</a> ones.</p><p>Hiding the fact that a method may fail at some point is a mistake. That&#39;s exactly what unchecked exceptions do.</p><p>Instead, we should make this fact visible. When a method does too many things, there will be too many points of failure, and the author of the method will realize that something is wrong---a method should not throw exceptions in so many situations. This will lead to refactoring. The existence of unchecked exceptions leads to a mess. By the way, checked exceptions don&#39;t exist at all in Ruby, C#, Python, PHP, etc. This means that creators of these languages understand <a href="/2016/08/15/what-is-wrong-object-oriented-programming.html">OOP</a> even less than Java authors.</p><h2 id="checked-exceptions-are-too-noisy">Checked Exceptions Are Too Noisy</h2><p>Another common argument against checked exceptions is that they make our code more verbose. We have to put <code>try/catch</code> everywhere instead of staying focused on the main logic. Bozhidar Bozhanov even <a href="http://techblog.bozho.net/checked-and-unchecked-exceptions-in-java/">suggests</a> a technical solution for this verbosity problem.</p><p>Again, I don&#39;t understand this logic. If I want to do something when method <code>save()</code> fails, I catch the exception and handle the situation somehow. If I don&#39;t want to do that, I just say my method also <code>throws</code> and pay no attention to exception handling. What is the problem? Where is the verbosity coming from?</p><p>I have an answer here, too. It&#39;s coming from the existence of unchecked exceptions. We simply can&#39;t always ignore failure, because the interfaces we&#39;re using don&#39;t allow us to do this. That&#39;s all. For example, class <a href="http://docs.oracle.com/javase/7/docs/api/java/lang/Runnable.html"><code>Runnable</code></a>, which is widely used for multi-thread programming, has method <code>run()</code> that is not supposed to throw anything. That&#39;s why we always have to catch everything inside the method and rethrow checked exceptions as unchecked.</p><p>If all methods in all Java <a href="/2016/04/26/why-inputstream-design-is-wrong.html">interfaces</a> would be declared either as &quot;safe&quot; (<code>throws</code> nothing) or &quot;unsafe&quot; (<code>throws Exception</code>), everything would become logical and clear. If you want to stay &quot;safe,&quot; take responsibility for failure handling. Otherwise, be &quot;unsafe&quot; and let your users worry about safety.</p><p>No noise, very clean code, and obvious logic.</p><h2 id="inappropriately-exposed-implementation-details">Inappropriately Exposed Implementation Details</h2><p><a href="http://www.ibm.com/developerworks/library/j-jtp05254/">Some say</a> the ability to put a checked exception into <code>throws</code> in the method signature instead of catching it here and rethrowing a new type encourages us to have too many irrelevant exception types in method signatures. For example, our method <code>save()</code> may declare that it may throw <code>OutOfMemoryException</code>, even though it seems to have nothing to do with memory allocation. But it does allocate some memory, right? So such a memory overflow may happen during a file saving operation.</p><p>Yet again, I don&#39;t get the logic of this argument. If all exceptions are checked, and we don&#39;t have multiple exception types, we just throw <code>Exception</code> everywhere, and that&#39;s it. Why do we need to care about the exception type in the first place? If we don&#39;t use exceptions to control flow, we won&#39;t do this.</p><p>If we really want to make our application memory overflow-resistant, we will introduce some memory manager, which will have something like the <code>bigEnough()</code> method, which will tell us whether our heap is big enough for the next operation. Using exceptions in such situations is a totally inappropriate approach to exception management in OOP.</p><h2 id="recoverable-exceptions">Recoverable Exceptions</h2><p>Joshua Bloch, in <a href="http://amzn.to/2crH5tW">Effective Java</a>, says to &quot;use checked exceptions for recoverable conditions and runtime exceptions for programming errors.&quot; He means something like this:</p><figure class="highlight"><pre><code class="language-java" data-lang="java"><span></span><span class="k">try</span> <span class="o">{</span>
  <span class="n">save</span><span class="o">(</span><span class="n">file</span><span class="o">,</span> <span class="n">data</span><span class="o">);</span>
<span class="o">}</span> <span class="k">catch</span> <span class="o">(</span><span class="n">Exception</span> <span class="n">ex</span><span class="o">)</span> <span class="o">{</span>
  <span class="c1">// We can&#39;t save the file, but it&#39;s OK</span>
  <span class="c1">// Let&#39;s move on and do something else</span>
<span class="o">}</span></code></pre></figure><p>How is that any different from a famous anti-pattern called <a href="http://c2.com/cgi/wiki?DontUseExceptionsForFlowControl">Don&#39;t Use Exceptions for Flow Control</a>? Joshua, with all due respect, you&#39;re wrong. There are no such things as recoverable conditions in OOP. An exception indicates that the execution of a chain of calls from method to method is broken, and it&#39;s time to go up through the chain and stop somewhere. But we never go back again after the exception:</p><figure class="highlight"><pre><code class="language-text" data-lang="text"><span></span>App#run()
  Data#update()
    Data#write()
      File#save() &lt;-- Boom, there&#39;s a failure here, so we go up</code></pre></figure><p>We can start this chain again, but we don&#39;t go back after <code>throw</code>. In other words, we don&#39;t <strong>do</strong> anything in the <code>catch</code> block. We only report the problem and wrap up execution. We never &quot;recover!&quot;</p><hr/><p>All arguments against checked exceptions demonstrate nothing but a serious misunderstanding of object-oriented programming by their authors. The mistake in Java and in many other languages is the existence of unchecked exceptions, not checked ones.</p></p>--> <nav class="buttons notranslate desktop-only"> <a href="http://www.facebook.com/sharer/sharer.php?u=https://www.yegor256.com/2015/07/28/checked-vs-unchecked-exceptions.html" title="Share on Facebook" class="button" rel="nofollow"> <span class="count count-facebook">0</span> <i class="icon icon-facebook notranslate" aria-hidden="true"></i> </a> <a href="https://twitter.com/share?url=https://www.yegor256.com/2015/07/28/checked-vs-unchecked-exceptions.html&amp;text=Checked+vs.+Unchecked+Exceptions%3A+The+Debate+Is+Not+Over" title="Share on Twitter" class="button" rel="nofollow"> <span class="count count-twitter">0</span> <i class="icon icon-twitter notranslate" aria-hidden="true"></i> </a> <a href="https://plus.google.com/share?url=https://www.yegor256.com/2015/07/28/checked-vs-unchecked-exceptions.html" title="Share on Google+" class="button" rel="nofollow"> <span class="count count-googleplus">0</span> <i class="icon icon-googleplus notranslate" aria-hidden="true"></i> </a> <a href="https://www.linkedin.com/cws/share?url=https://www.yegor256.com/2015/07/28/checked-vs-unchecked-exceptions.html" title="Share on LinkedIn" class="button" rel="nofollow"> <span class="count count-linkedin">0</span> <i class="icon icon-linkedin notranslate" aria-hidden="true"></i> </a> <a href="http://reddit.com/submit?url=https://www.yegor256.com/2015/07/28/checked-vs-unchecked-exceptions.html%3F2015-30&amp;title=Checked+vs.+Unchecked+Exceptions%3A+The+Debate+Is+Not+Over" title="Share on Reddit" class="button" rel="nofollow"> <span class="count count-reddit">0</span> <i class="icon icon-reddit notranslate" aria-hidden="true"></i> </a> <a href="http://news.ycombinator.com/submitlink?u=https://www.yegor256.com/2015/07/28/checked-vs-unchecked-exceptions.html%3F2015-30&amp;t=Checked+vs.+Unchecked+Exceptions%3A+The+Debate+Is+Not+Over" title="Share on Hacker News" class="button" rel="nofollow"> <span class="count count-hackernews">0</span> <i class="icon icon-hackernews notranslate" aria-hidden="true"></i> </a> </nav> </header> <article class="main" itemprop="articleBody"><div ><p>Do we need checked exceptions at all? The <a href="http://stackoverflow.com/questions/6115896/java-checked-vs-unchecked-exception-explanation">debate</a> is over, isn&#39;t it? Not for me. While most object-oriented languages don&#39;t have them, and most programmers think checked exceptions are a Java mistake, I believe in the opposite---unchecked exceptions are the <strong>mistake</strong>. Moreover, I believe multiple exception types are a bad idea too.</p><figure class='jb_picture'><img itemprop='image' alt='True Romance (1993) by Tony Scott' src='/images/2015/07/true-romance.jpg' longdesc='#443dfa82'/><figcaption id='443dfa82'>True Romance (1993) by Tony Scott</figcaption></figure><p>Let me first explain how I understand exceptions in object-oriented programming. Then I&#39;ll compare my understanding with a &quot;traditional&quot; approach, and we&#39;ll discuss the differences. So, my understanding first.</p><p>Say there is a method that saves some binary data to a file:</p><figure class="highlight"><pre><code class="language-java" data-lang="java"><span></span><span class="kd">public</span> <span class="kt">void</span> <span class="nf">save</span><span class="o">(</span><span class="n">File</span> <span class="n">file</span><span class="o">,</span> <span class="kt">byte</span><span class="o">[]</span> <span class="n">data</span><span class="o">)</span>
  <span class="kd">throws</span> <span class="n">Exception</span> <span class="o">{</span>
  <span class="c1">// save data to the file</span>
<span class="o">}</span></code></pre></figure><p>When everything goes right, the method just saves the data and returns control. When something is wrong, it <a href="/2015/12/01/rethrow-exceptions.html">throws</a> <code>Exception</code> and we have to do something about it:</p><figure class="highlight"><pre><code class="language-java" data-lang="java"><span></span><span class="k">try</span> <span class="o">{</span>
  <span class="n">save</span><span class="o">(</span><span class="n">file</span><span class="o">,</span> <span class="n">data</span><span class="o">);</span>
<span class="o">}</span> <span class="k">catch</span> <span class="o">(</span><span class="n">Exception</span> <span class="n">ex</span><span class="o">)</span> <span class="o">{</span>
  <span class="n">System</span><span class="o">.</span><span class="na">out</span><span class="o">.</span><span class="na">println</span><span class="o">(</span><span class="s">&quot;Sorry, we can&#39;t save right now.&quot;</span><span class="o">);</span>
<span class="o">}</span></code></pre></figure><p>When a method says it <code>throws</code> an exception, I understand that the method is not <strong>safe</strong>. It may fail sometimes, and it&#39;s my responsibility to either 1) handle this failure or 2) declare myself as <strong>unsafe</strong> too.</p><p>I know each method is designed with a <a href="https://en.wikipedia.org/wiki/Single_responsibility_principle">single responsibility principle</a> in mind. This is a guarantee to me that if method <code>save()</code> fails, it means the entire saving operation can&#39;t be completed. If I need to know what the cause of this failure was, I will <a href="https://en.wikipedia.org/wiki/Exception_chaining">un-chain</a> the exception---traverse the stack of chained exceptions and stack traces encapsulated in <code>ex</code>.</p><p>I never use exceptions for flow control, which means I <strong>never recover</strong> situations where exceptions are thrown. When an exception occurs, I let it float up to the highest level of the application. Sometimes I <a href="/2015/12/01/rethrow-exceptions.html">rethrow</a> it in order to add more semantic information to the chain. That&#39;s why it doesn&#39;t matter to me what the cause of the exception thrown by <code>save()</code> was. I just know the method failed. That&#39;s enough for me. Always.</p><p>For the same reason, I don&#39;t need to differentiate between different exception types. I just don&#39;t need that type of hierarchy. <code>Exception</code> is enough for me. Again, that&#39;s because I don&#39;t use exceptions for flow control.</p><p>That&#39;s how I understand exceptions.</p><p>According to this paradigm, I would say we must:</p><ul> <li><p>always use checked exceptions.</p></li> <li><p>never throw/use unchecked exceptions.</p></li> <li><p>use only <code>Exception</code>, without any sub-types.</p></li> <li><p>always declare one exception type in the <code>throws</code> block.</p></li> <li><p>never catch without rethrowing; read <a href="/2015/07/09/catch-if-cant-otherwise.html">more about that here</a>.</p></li></ul><p>This paradigm diverges from many other articles I&#39;ve found on this subject. Let&#39;s compare and discuss.</p><h2 id="runtime-vs-api-exceptions">Runtime vs. API Exceptions</h2><p><a href="http://docs.oracle.com/javase/tutorial/essential/exceptions/runtime.html">Oracle says</a> some exceptions should be part of API (checked ones) while some are runtime exceptions and should not be part of it (unchecked). They will be documented in JavaDoc but not in the method signature.</p><p>I don&#39;t understand the logic here, and I&#39;m sure Java designers don&#39;t understand it either. How and why are some exceptions important while others are not? Why do some of them deserve a proper API position in the <code>throws</code> block of the method signature while others don&#39;t? What is the criteria?</p><p>I have an answer here, though. By introducing checked and unchecked exceptions, Java developers tried to solve the problem of methods that are too complex and messy. When a method is too big and does too many things at the same time (violates the single responsibility principle), it&#39;s definitely better to let us keep some exceptions &quot;hidden&quot; (a.k.a. unchecked). But it&#39;s not a real solution. It is only a temporary patch that does all of us more harm than good---methods keep growing in size and complexity.</p><p>Unchecked exceptions are a mistake in Java design, not <a href="/2015/10/20/interrupted-exception.html">checked</a> ones.</p><p>Hiding the fact that a method may fail at some point is a mistake. That&#39;s exactly what unchecked exceptions do.</p><p>Instead, we should make this fact visible. When a method does too many things, there will be too many points of failure, and the author of the method will realize that something is wrong---a method should not throw exceptions in so many situations. This will lead to refactoring. The existence of unchecked exceptions leads to a mess. By the way, checked exceptions don&#39;t exist at all in Ruby, C#, Python, PHP, etc. This means that creators of these languages understand <a href="/2016/08/15/what-is-wrong-object-oriented-programming.html">OOP</a> even less than Java authors.</p><h2 id="checked-exceptions-are-too-noisy">Checked Exceptions Are Too Noisy</h2><p>Another common argument against checked exceptions is that they make our code more verbose. We have to put <code>try/catch</code> everywhere instead of staying focused on the main logic. Bozhidar Bozhanov even <a href="http://techblog.bozho.net/checked-and-unchecked-exceptions-in-java/">suggests</a> a technical solution for this verbosity problem.</p><p>Again, I don&#39;t understand this logic. If I want to do something when method <code>save()</code> fails, I catch the exception and handle the situation somehow. If I don&#39;t want to do that, I just say my method also <code>throws</code> and pay no attention to exception handling. What is the problem? Where is the verbosity coming from?</p><p>I have an answer here, too. It&#39;s coming from the existence of unchecked exceptions. We simply can&#39;t always ignore failure, because the interfaces we&#39;re using don&#39;t allow us to do this. That&#39;s all. For example, class <a href="http://docs.oracle.com/javase/7/docs/api/java/lang/Runnable.html"><code>Runnable</code></a>, which is widely used for multi-thread programming, has method <code>run()</code> that is not supposed to throw anything. That&#39;s why we always have to catch everything inside the method and rethrow checked exceptions as unchecked.</p><p>If all methods in all Java <a href="/2016/04/26/why-inputstream-design-is-wrong.html">interfaces</a> would be declared either as &quot;safe&quot; (<code>throws</code> nothing) or &quot;unsafe&quot; (<code>throws Exception</code>), everything would become logical and clear. If you want to stay &quot;safe,&quot; take responsibility for failure handling. Otherwise, be &quot;unsafe&quot; and let your users worry about safety.</p><p>No noise, very clean code, and obvious logic.</p><h2 id="inappropriately-exposed-implementation-details">Inappropriately Exposed Implementation Details</h2><p><a href="http://www.ibm.com/developerworks/library/j-jtp05254/">Some say</a> the ability to put a checked exception into <code>throws</code> in the method signature instead of catching it here and rethrowing a new type encourages us to have too many irrelevant exception types in method signatures. For example, our method <code>save()</code> may declare that it may throw <code>OutOfMemoryException</code>, even though it seems to have nothing to do with memory allocation. But it does allocate some memory, right? So such a memory overflow may happen during a file saving operation.</p><p>Yet again, I don&#39;t get the logic of this argument. If all exceptions are checked, and we don&#39;t have multiple exception types, we just throw <code>Exception</code> everywhere, and that&#39;s it. Why do we need to care about the exception type in the first place? If we don&#39;t use exceptions to control flow, we won&#39;t do this.</p><p>If we really want to make our application memory overflow-resistant, we will introduce some memory manager, which will have something like the <code>bigEnough()</code> method, which will tell us whether our heap is big enough for the next operation. Using exceptions in such situations is a totally inappropriate approach to exception management in OOP.</p><h2 id="recoverable-exceptions">Recoverable Exceptions</h2><p>Joshua Bloch, in <a href="http://amzn.to/2crH5tW">Effective Java</a>, says to &quot;use checked exceptions for recoverable conditions and runtime exceptions for programming errors.&quot; He means something like this:</p><figure class="highlight"><pre><code class="language-java" data-lang="java"><span></span><span class="k">try</span> <span class="o">{</span>
  <span class="n">save</span><span class="o">(</span><span class="n">file</span><span class="o">,</span> <span class="n">data</span><span class="o">);</span>
<span class="o">}</span> <span class="k">catch</span> <span class="o">(</span><span class="n">Exception</span> <span class="n">ex</span><span class="o">)</span> <span class="o">{</span>
  <span class="c1">// We can&#39;t save the file, but it&#39;s OK</span>
  <span class="c1">// Let&#39;s move on and do something else</span>
<span class="o">}</span></code></pre></figure><p>How is that any different from a famous anti-pattern called <a href="http://c2.com/cgi/wiki?DontUseExceptionsForFlowControl">Don&#39;t Use Exceptions for Flow Control</a>? Joshua, with all due respect, you&#39;re wrong. There are no such things as recoverable conditions in OOP. An exception indicates that the execution of a chain of calls from method to method is broken, and it&#39;s time to go up through the chain and stop somewhere. But we never go back again after the exception:</p><figure class="highlight"><pre><code class="language-text" data-lang="text"><span></span>App#run()
  Data#update()
    Data#write()
      File#save() &lt;-- Boom, there&#39;s a failure here, so we go up</code></pre></figure><p>We can start this chain again, but we don&#39;t go back after <code>throw</code>. In other words, we don&#39;t <strong>do</strong> anything in the <code>catch</code> block. We only report the problem and wrap up execution. We never &quot;recover!&quot;</p><hr/><p>All arguments against checked exceptions demonstrate nothing but a serious misunderstanding of object-oriented programming by their authors. The mistake in Java and in many other languages is the existence of unchecked exceptions, not checked ones.</p></div></article></div><div class="wrapper"> <related-posts /></div><div class="disqus" role="complementary"><p class="disqus_hint"> Please, use <a href="https://help.disqus.com/commenting/what-html-tags-are-allowed-within-comments">syntax highlighting</a> in your comments, to make them more readable.</p><div id="disqus_thread" class="disqus-thread"> <a>&nbsp;</a></div><script> var disqus_config = function () { this.page.url = document.location.href.split('?')[0].split('#')[0].replace('https://', 'http://'); this.page.identifier = this.page.url; }; (function() { var d = document, s = d.createElement('script'); s.src = '//yegor256.disqus.com/embed.js'; s.setAttribute('data-timestamp', +new Date()); (d.head || d.body).appendChild(s); })(); </script> <noscript><div><p class="red"> JavaScript is disabled in your browser, that's why you can't see comments under this post.</p></div></noscript></div><div class="wrapper"> <footer class="footer"><p> &copy; <span itemscope="" itemprop="copyrightHolder" itemtype="http://schema.org/Person"> <span itemprop="name">Yegor Bugayenko</span> </span> 2014&ndash;<span itemprop="copyrightYear">2018</span></p></footer></div></section><div class="wrapper unprintable" style="text-align:center;margin-top:2em;"> <a href="http://www.sixnines.io/h/3ba1652f"> <img src="//www.sixnines.io/b/3ba1652f?style=flat" alt="sixnines availability badge"/> </a></div><script src="//code.jquery.com/jquery-1.9.0.min.js"></script> <script src="/js/all.js?4e047f6f42b"></script> <script>var disqus_shortname = 'yegor256';</script> <script id="dsq-count-scr" src="//yegor256.disqus.com/count.js" async="async"></script> <script> (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){ (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o), m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m) })(window,document,'script','//www.google-analytics.com/analytics.js','ga'); ga('create', 'UA-1963507-32', 'auto'); ga('send', 'pageview'); </script> <script> Cd=document;Cr="&"+Math.random();Cp="&s=1"; Cd.cookie="b=b";if(Cd.cookie)Cp+="&c=1"; Cp+="&t="+(new Date()).getTimezoneOffset(); if(self!=top)Cp+="&f=1"; </script> <script> if(navigator.javaEnabled())Cp+="&j=1"; </script> <script> if(typeof(screen)!='undefined')Cp+="&w="+screen.width+"&h="+ screen.height+"&d="+(screen.colorDepth?screen.colorDepth:screen.pixelDepth); </script> <script> Cd.write("<img src='//c.hit.ua/hit?i=95870&g=0&x=2"+Cp+Cr+ "&r="+escape(Cd.referrer)+"&u="+escape(window.location.href)+ "' border='0' wi"+"dth='1' he"+"ight='1'/>"); </script> <script type="application/ld+json"> { "@context": "http://schema.org", "@type": "Person", "name": "Yegor Bugayenko", "url": "http://www.yegor256.com", "sameAs": [ "https://www.facebook.com/yegor256", "https://instagram.com/yegor256", "https://www.linkedin.com/in/yegor256", "https://twitter.com/yegor256", "https://github.com/yegor256", "https://www.pinterest.com/yegor256/" ] } </script> </body> </html> <!DOCTYPE html> <html xmlns="http://www.w3.org/1999/xhtml" lang="en-US" xml:lang="en-US" itemscope="" itemtype="http://schema.org/WebSite"> <head> <meta charset="utf-8"/> <meta name="description" content="It&apos;s a common practice to make constants public in order to avoid duplication, but it&apos;s a bad practice, so use objects instead. " /> <meta name="keywords" content="public static, public static java, public static literals, static constants java, static literals java" /> <meta name="viewport" content="width=device-width,minimum-scale=1,initial-scale=1"/> <meta name="google-site-verification" content="JEj_gQr2CPe2QKGw8XdMz0R7VboQIUbX3FlM-lwTq-8" /> <meta name="author" content="Yegor Bugayenko"> <meta name="article:published_time" content="2015-07-06 00:00:00 +0000"> <meta name="og:site_name" content="Yegor Bugayenko"/> <meta name="og:type" content="article" /> <meta name="og:locale" content="en_US" /> <meta name="twitter:account_id" content="4503599630178231" /> <meta name="twitter:creator" content="@yegor256"/> <meta name="twitter:site" content="@yegor256"/> <meta name="twitter:title" property="og:title" content="Public Static Literals ... Are Not a Solution for Data Duplication"/> <meta name="twitter:description" property="og:description" content="It&apos;s a common practice to make constants public in order to avoid duplication, but it&apos;s a bad practice, so use objects instead. "/> <meta name="twitter:url" property="og:url" content="https://www.yegor256.com/2015/07/06/public-static-literals.html"/> <meta name="telegram:channel" content="AAAAAEJFMRzsRTRxM3ec6A"/> <link rel="search" type="application/opensearchdescription+xml" href="/opensearch.xml" title="yegor256" /> <link rel="shortcut icon" href="/favicon.ico?4e047f6f42b"/> <link rel="apple-touch-icon" href="/favicon.ico?4e047f6f42b"/> <link rel="alternate" type="application/rss+xml" title="RSS for yegor256.com" href="https://www.yegor256.com/rss.xml"/> <link rel="stylesheet" href="/css/layout.css?4e047f6f42b"/> <link rel="stylesheet" href="/css/icons.css?4e047f6f42b"/> <link rel="canonical" href="https://www.yegor256.com/2015/07/06/public-static-literals.html" /> <link rel="amphtml" href="https://www.yegor256.com/2015/07/06/public-static-literals.amp.html" /> <title>Public Static Literals ... Are Not a Solution for Data Duplication </title> <meta name='og:image' content='https://www.yegor256.com/images/2015/07/the-shining.jpg'/><meta name='twitter:image' content='https://www.yegor256.com/images/2015/07/the-shining.jpg'/><meta name='og:image:width' content='1200'/> <meta name='twitter:image:width' content='1200'/><meta name='og:image:height' content='600'/> <meta name='twitter:image:height' content='600'/><meta name='twitter:card' content='summary_large_image'/><meta name='twitter:image:alt' content='The Shining (1980) by Stanley Kubrick'/> </head> <body><div class="wrapper"> <aside class="header-toggle unprintable" id="header-toggle" title="Show the menu" onclick="$('#header').show();$('#header-toggle').hide();">&#9776;</aside> <header class="header" id="header"><div class="face"> <a href="/about-me.html#form" class="sub" title="Click to subscribe to my monthly newsletter"><span>Subscribe</span></a> <a href="/about-me.html" style="position:relative;"> <img src="/images/face-256x256.jpg" class="photo" alt="Yegor Bugayenko"/> </a></div><nav><ul class="menu social notranslate"> <li><a href="https://twitter.com/intent/follow?screen_name=yegor256" rel="nofollow" title="Follow me on Twitter"><i class="icon icon-twitter notranslate" aria-hidden="true"></i></a></li> <li><a href="/rss.xml" rel="nofollow" title="Subscribe to my RSS feed"><i class="icon icon-rss notranslate" aria-hidden="true"></i></a></li> <li><a itemprop="sameAs" href="https://github.com/yegor256" rel="nofollow" title="My GitHub profile"><i class="icon icon-github notranslate" aria-hidden="true"></i></a></li> <li><a itemprop="sameAs" href="http://stackoverflow.com/users/187141/yegor256" rel="nofollow" title="My StackOverflow profile"><i class="icon icon-stackoverflow notranslate" aria-hidden="true"></i></a></li> <li><a itemprop="sameAs" href="https://www.facebook.com/yegor256" rel="nofollow" title="Follow me on Facebook"><i class="icon icon-facebook notranslate" aria-hidden="true"></i></a></li> <li><a itemprop="sameAs" href="https://instagram.com/yegor256" rel="nofollow" title="Follow me on Instagram"><i class="icon icon-instagram notranslate" aria-hidden="true"></i></a></li> <li><a itemprop="sameAs" href="https://www.linkedin.com/in/yegor256" rel="nofollow" title="My LinkedIn profile"><i class="icon icon-linkedin notranslate" aria-hidden="true"></i></a></li> <li><a itemprop="sameAs" href="https://www.youtube.com/c/yegor256?sub_confirmation=1" rel="nofollow" title="My Youtube video channel"><i class="icon icon-youtube notranslate" aria-hidden="true"></i></a></li> <li><a itemprop="sameAs" href="https://www.pinterest.com/yegor256/" rel="nofollow" title="My Pinterest boards"><i class="icon icon-pinterest notranslate" aria-hidden="true"></i></a></li> <li><a itemprop="sameAs" href="https://angel.co/yegor256" rel="nofollow" title="My AngelList profile"><i class="icon icon-angellist notranslate" aria-hidden="true"></i></a></li> <li><a href="https://soundcloud.com/yegor256" rel="nofollow" title="My podcast"><i class="icon icon-podcast notranslate" aria-hidden="true"></i></a></li> <li><a href="https://itunes.apple.com/us/podcast/yegor256-podcast/id1150826721" rel="nofollow" title="My iTunes podcast"><i class="icon icon-itunes notranslate" aria-hidden="true"></i></a></li> <li><a href="https://t.me/joinchat/AAAAAEJFMRzsRTRxM3ec6A" rel="nofollow" title="My Telegram public channel"><i class="icon icon-telegram notranslate" aria-hidden="true"></i></a></li> <li><a href="mailto:blog@yegor256.com" rel="nofollow" title="Email me any time"><i class="icon icon-mail notranslate" aria-hidden="true"></i></a></li></ul><ul class="menu"> <li><a href="/" title="Home page">Home</a></li> <li ><a href="/best.html" title="Best articles to read">12&#160;Best</a></li> <li ><a href="/contents.html" title="The contents of the entire blog">All&#160;288</a></li> <li ><a href="/webinars.html" title="My webinars">Webinars</a></li> <li ><a href="/talks.html" title="Future and past conference talks">Talks</a></li> <li ><a href="/books.html" title="The books I wrote">Books</a></li> <li ><a href="/papers.html" title="My academic papers and patents">Papers</a></li> <li ><a href="/pets.html" title="My loved pet projects">Pets</a></li> <li ><a href="/award.html" title="Software quality award">Award</a></li> <li ><a href="/testimonials.html" title="What some people say about me">Testimonials</a></li> <li ><a href="/shift-m.html" title="Audio podcast about project management">Shift-M</a></li> <li ><a href="/paintings.html" title="My paintings for sale">Paintings</a></li> <li><a href="http://ru.yegor256.com/" title="Немного на русском языке">По-русски</a></li></ul></nav><div class="search"> <form method="get" action="https://www.google.com/search" itemprop="potentialAction" itemscope="" itemtype="http://schema.org/SearchAction"> <meta itemprop="target" content="https://www.google.com/search?q={q}"/> <input name="sitesearch" value="yegor256.com" type="hidden"/> <input itemprop="query-input" type="text" id="search-query" class="field field-text" required="required" onfocus="$('.google').css('visibility', 'visible');" name="q" placeholder="Search..." autocomplete="off"/> <input type="image" src="/images/google-search-icon.svg" class="google" title="Search via Google" alt="Search via Google"/> </form></div><div class="hot"><ul> <li> <a href="/code-ahead.html">Code Ahead</a> was published on Amazon just a few days ago! It is my new book, a novel about programmers. It explains in details the majority of ideas that stand behind <a href="https://www.zerocracy.com">Zerocracy</a> and <a href="https://www.xdsd.org">XDSD</a>. </li> <li> At <a href="/webinars.html">Webinar #37</a> we will discuss naming problem in OOP, for objects, methods and attributes; join us on <b>September 12</b>, at 11am PST. </li></ul></div></header></div><section itemscope="" itemtype="http://schema.org/BlogPosting"><div class="wrapper"> <header><p class="printable"> <img src="https://api.qrserver.com/v1/create-qr-code/?data=https://www.yegor256.com/2015/07/06/public-static-literals.html&amp;format=svg" style="width:125px;height:125px;" alt="QR code"/></p><p class="printable"> <code itemprop="url">https://www.yegor256.com/2015/07/06/public-static-literals.html</code></p><h1 itemprop="name headline mainEntityOfPage">Public Static Literals ... Are Not a Solution for Data Duplication</h1><aside class='book'><a href='http://amzn.to/2qFt4Tn'><img src='/images/books/elegant-objects/cover.png' class='book-cover' alt='book cover'/></a>Read more about this subject in <a href='http://amzn.to/2qFt4Tn'>Section&nbsp;2.5</a><br/> of my book<a href='http://amzn.to/2qFt4Tn'><img src='/images/books/amazon-buy-button.png' class='amazon-button' alt='Click to buy'/></a></aside><ul class="subline"> <li> <time itemprop="datePublished" datetime="2015-07-06T00:00:00+00:00"> 6 July 2015 </time> </li> <li class="desktop-only" itemprop="locationCreated">Palo Alto, CA</li> <li class="printable" itemscope="" itemprop="author" itemtype="http://schema.org/Person"> <span itemprop="name">Yegor Bugayenko</span> </li> <li class="unprintable"> <i class="icon icon-comments"></i> <a href="http://www.yegor256.com/2015/07/06/public-static-literals.html#disqus_thread" itemprop="discussionUrl">comments</a> </li></ul><figure class='jb_picture'><img itemprop='image' alt='The Shining (1980) by Stanley Kubrick' src='/images/2015/07/the-shining.jpg' longdesc='#3741e70e'/><figcaption id='3741e70e'>The Shining (1980) by Stanley Kubrick</figcaption></figure><p>Here is what I&#39;m talking about, specifically:</p><figure class="highlight"><pre><code class="language-java" data-lang="java"><span></span><span class="kn">package</span> <span class="nn">org.apache.commons.lang3</span><span class="o">;</span>
<span class="kd">public</span> <span class="kd">class</span> <span class="nc">CharEncoding</span> <span class="o">{</span>
  <span class="kd">public</span> <span class="kd">static</span> <span class="kd">final</span> <span class="n">String</span> <span class="n">UTF_8</span> <span class="o">=</span> <span class="s">&quot;UTF-8&quot;</span><span class="o">;</span>
  <span class="c1">// some other methods and properties</span>
<span class="o">}</span></code></pre></figure><p>Now, when I need to create a <code>String</code> from a byte array, I use this:</p><figure class="highlight"><pre><code class="language-java" data-lang="java"><span></span><span class="kn">import</span> <span class="nn">org.apache.commons.lang3.CharEncoding</span><span class="o">;</span>
<span class="n">String</span> <span class="n">text</span> <span class="o">=</span> <span class="k">new</span> <span class="n">String</span><span class="o">(</span><span class="n">array</span><span class="o">,</span> <span class="n">CharEncoding</span><span class="o">.</span><span class="na">UTF_8</span><span class="o">);</span></code></pre></figure><p>Let&#39;s say I want to convert a <code>String</code> into a byte array:</p><figure class="highlight"><pre><code class="language-java" data-lang="java"><span></span><span class="kn">import</span> <span class="nn">org.apache.commons.lang3.CharEncoding</span><span class="o">;</span>
<span class="kt">byte</span><span class="o">[]</span> <span class="n">array</span> <span class="o">=</span> <span class="n">text</span><span class="o">.</span><span class="na">getBytes</span><span class="o">(</span><span class="n">CharEncoding</span><span class="o">.</span><span class="na">UTF_8</span><span class="o">);</span></code></pre></figure><p>Looks convenient, right? This is what the designers of Apache Commons think (one of the most popular but simply <em>terrible</em> libraries in the Java world). I encourage you to think differently. I can&#39;t tell you to stop using Apache Commons, because we just don&#39;t have a better alternative (yet!). But in your own code, don&#39;t use public static properties---ever. Even if this code may look convenient to you, it&#39;s a very bad design.</p><aside class='quote'>Every time you see data duplication, start thinking about the functionality you're duplicating</aside><p>The reason why is very similar to <a href="/2015/02/26/composable-decorators.html">utility classes</a> with public static methods---they are unbreakable hard-coded dependencies. Once you use that <code>CharEncoding.UTF_8</code>, your object starts to depend on this data, and its user (the user of your object) can&#39;t break this dependency. You may say that this is your intention, in the case of a <code>&quot;UTF-8&quot;</code> constant---to make sure that Unicode is specifically and exclusively being used. In this particular example, this may be true, but look at it from a more global perspective.</p><p>Let me show you the alternative I have in mind before we continue. Here is what I&#39;m suggesting instead to convert a byte array into a <code>String</code>:</p><figure class="highlight"><pre><code class="language-java" data-lang="java"><span></span><span class="n">String</span> <span class="n">text</span> <span class="o">=</span> <span class="k">new</span> <span class="n">UTF8String</span><span class="o">(</span><span class="n">array</span><span class="o">);</span></code></pre></figure><p>It&#39;s pseudo-code, since Java designers made class <code>String</code> final and we can&#39;t really extend it and create <code>UTF8String</code>, but you get the idea. In the real world, this would look like this:</p><figure class="highlight"><pre><code class="language-java" data-lang="java"><span></span><span class="n">String</span> <span class="n">text</span> <span class="o">=</span> <span class="k">new</span> <span class="n">UTF8String</span><span class="o">(</span><span class="n">array</span><span class="o">).</span><span class="na">toString</span><span class="o">();</span></code></pre></figure><p>As you see, we encapsulate the &quot;UTF-8&quot; constant somewhere inside the class <code>UTF8String</code>, and its users have no idea how exactly this &quot;byte array to string&quot; conversion is happening.</p><p>By introducing <code>UTF8String</code>, we solved the problem of &quot;UTF-8&quot; literal duplication. But we did it in a proper object-oriented way---we encapsulated the functionality inside a class and let everybody instantiate its objects and use them. We resolved the problem of functionality duplication, not just data duplication.</p><p>Placing data into one shared place (<code>CharEncoding.UTF_8</code>) doesn&#39;t really solve the duplication problem; it actually makes it <strong>worse</strong>, mostly because it encourages everybody to duplicate functionality using the same piece of shared data.</p><p>My point here is that every time you see that you have some data duplication in your application, start thinking about the functionality you&#39;re duplicating. You will easily find the code that is repeated again and again. Make a new class for this code and place the data there, as a <code>private</code> property (or private <code>static</code> property). That&#39;s how you will improve your design and truly get rid of duplication.</p><p>PS. You can use a method instead of a class, but not a static literal.</p></p>--> <nav class="buttons notranslate desktop-only"> <a href="http://www.facebook.com/sharer/sharer.php?u=https://www.yegor256.com/2015/07/06/public-static-literals.html" title="Share on Facebook" class="button" rel="nofollow"> <span class="count count-facebook">0</span> <i class="icon icon-facebook notranslate" aria-hidden="true"></i> </a> <a href="https://twitter.com/share?url=https://www.yegor256.com/2015/07/06/public-static-literals.html&amp;text=Public+Static+Literals+...+Are+Not+a+Solution+for+Data+Duplication" title="Share on Twitter" class="button" rel="nofollow"> <span class="count count-twitter">0</span> <i class="icon icon-twitter notranslate" aria-hidden="true"></i> </a> <a href="https://plus.google.com/share?url=https://www.yegor256.com/2015/07/06/public-static-literals.html" title="Share on Google+" class="button" rel="nofollow"> <span class="count count-googleplus">0</span> <i class="icon icon-googleplus notranslate" aria-hidden="true"></i> </a> <a href="https://www.linkedin.com/cws/share?url=https://www.yegor256.com/2015/07/06/public-static-literals.html" title="Share on LinkedIn" class="button" rel="nofollow"> <span class="count count-linkedin">0</span> <i class="icon icon-linkedin notranslate" aria-hidden="true"></i> </a> <a href="http://reddit.com/submit?url=https://www.yegor256.com/2015/07/06/public-static-literals.html%3F2015-27&amp;title=Public+Static+Literals+...+Are+Not+a+Solution+for+Data+Duplication" title="Share on Reddit" class="button" rel="nofollow"> <span class="count count-reddit">0</span> <i class="icon icon-reddit notranslate" aria-hidden="true"></i> </a> <a href="http://news.ycombinator.com/submitlink?u=https://www.yegor256.com/2015/07/06/public-static-literals.html%3F2015-27&amp;t=Public+Static+Literals+...+Are+Not+a+Solution+for+Data+Duplication" title="Share on Hacker News" class="button" rel="nofollow"> <span class="count count-hackernews">0</span> <i class="icon icon-hackernews notranslate" aria-hidden="true"></i> </a> </nav> </header> <article class="main" itemprop="articleBody"><div ><p>I have a <code>new String(array,&quot;UTF-8&quot;)</code> in one place and exactly the same code in another place in my app. Actually, I may have it in many places. And every time, I have to use that <code>&quot;UTF-8&quot;</code> constant in order to create a <code>String</code> from a byte array. It would be very convenient to define it once somewhere and reuse it, just like Apache Commons is doing; see <a href="https://commons.apache.org/proper/commons-lang/javadocs/api-2.6/org/apache/commons/lang/CharEncoding.html#UTF_8"><code>CharEncoding.UTF_8</code></a> (There are many other static literals there). These guys are setting a bad example! <code>public</code> <code>static</code> &quot;properties&quot; are as bad as <a href="/2014/05/05/oop-alternative-to-utility-classes.html">utility classes</a>.</p><figure class='jb_picture'><img itemprop='image' alt='The Shining (1980) by Stanley Kubrick' src='/images/2015/07/the-shining.jpg' longdesc='#3741e70e'/><figcaption id='3741e70e'>The Shining (1980) by Stanley Kubrick</figcaption></figure><p>Here is what I&#39;m talking about, specifically:</p><figure class="highlight"><pre><code class="language-java" data-lang="java"><span></span><span class="kn">package</span> <span class="nn">org.apache.commons.lang3</span><span class="o">;</span>
<span class="kd">public</span> <span class="kd">class</span> <span class="nc">CharEncoding</span> <span class="o">{</span>
  <span class="kd">public</span> <span class="kd">static</span> <span class="kd">final</span> <span class="n">String</span> <span class="n">UTF_8</span> <span class="o">=</span> <span class="s">&quot;UTF-8&quot;</span><span class="o">;</span>
  <span class="c1">// some other methods and properties</span>
<span class="o">}</span></code></pre></figure><p>Now, when I need to create a <code>String</code> from a byte array, I use this:</p><figure class="highlight"><pre><code class="language-java" data-lang="java"><span></span><span class="kn">import</span> <span class="nn">org.apache.commons.lang3.CharEncoding</span><span class="o">;</span>
<span class="n">String</span> <span class="n">text</span> <span class="o">=</span> <span class="k">new</span> <span class="n">String</span><span class="o">(</span><span class="n">array</span><span class="o">,</span> <span class="n">CharEncoding</span><span class="o">.</span><span class="na">UTF_8</span><span class="o">);</span></code></pre></figure><p>Let&#39;s say I want to convert a <code>String</code> into a byte array:</p><figure class="highlight"><pre><code class="language-java" data-lang="java"><span></span><span class="kn">import</span> <span class="nn">org.apache.commons.lang3.CharEncoding</span><span class="o">;</span>
<span class="kt">byte</span><span class="o">[]</span> <span class="n">array</span> <span class="o">=</span> <span class="n">text</span><span class="o">.</span><span class="na">getBytes</span><span class="o">(</span><span class="n">CharEncoding</span><span class="o">.</span><span class="na">UTF_8</span><span class="o">);</span></code></pre></figure><p>Looks convenient, right? This is what the designers of Apache Commons think (one of the most popular but simply <em>terrible</em> libraries in the Java world). I encourage you to think differently. I can&#39;t tell you to stop using Apache Commons, because we just don&#39;t have a better alternative (yet!). But in your own code, don&#39;t use public static properties---ever. Even if this code may look convenient to you, it&#39;s a very bad design.</p><aside class='quote'>Every time you see data duplication, start thinking about the functionality you're duplicating</aside><p>The reason why is very similar to <a href="/2015/02/26/composable-decorators.html">utility classes</a> with public static methods---they are unbreakable hard-coded dependencies. Once you use that <code>CharEncoding.UTF_8</code>, your object starts to depend on this data, and its user (the user of your object) can&#39;t break this dependency. You may say that this is your intention, in the case of a <code>&quot;UTF-8&quot;</code> constant---to make sure that Unicode is specifically and exclusively being used. In this particular example, this may be true, but look at it from a more global perspective.</p><p>Let me show you the alternative I have in mind before we continue. Here is what I&#39;m suggesting instead to convert a byte array into a <code>String</code>:</p><figure class="highlight"><pre><code class="language-java" data-lang="java"><span></span><span class="n">String</span> <span class="n">text</span> <span class="o">=</span> <span class="k">new</span> <span class="n">UTF8String</span><span class="o">(</span><span class="n">array</span><span class="o">);</span></code></pre></figure><p>It&#39;s pseudo-code, since Java designers made class <code>String</code> final and we can&#39;t really extend it and create <code>UTF8String</code>, but you get the idea. In the real world, this would look like this:</p><figure class="highlight"><pre><code class="language-java" data-lang="java"><span></span><span class="n">String</span> <span class="n">text</span> <span class="o">=</span> <span class="k">new</span> <span class="n">UTF8String</span><span class="o">(</span><span class="n">array</span><span class="o">).</span><span class="na">toString</span><span class="o">();</span></code></pre></figure><p>As you see, we encapsulate the &quot;UTF-8&quot; constant somewhere inside the class <code>UTF8String</code>, and its users have no idea how exactly this &quot;byte array to string&quot; conversion is happening.</p><p>By introducing <code>UTF8String</code>, we solved the problem of &quot;UTF-8&quot; literal duplication. But we did it in a proper object-oriented way---we encapsulated the functionality inside a class and let everybody instantiate its objects and use them. We resolved the problem of functionality duplication, not just data duplication.</p><p>Placing data into one shared place (<code>CharEncoding.UTF_8</code>) doesn&#39;t really solve the duplication problem; it actually makes it <strong>worse</strong>, mostly because it encourages everybody to duplicate functionality using the same piece of shared data.</p><p>My point here is that every time you see that you have some data duplication in your application, start thinking about the functionality you&#39;re duplicating. You will easily find the code that is repeated again and again. Make a new class for this code and place the data there, as a <code>private</code> property (or private <code>static</code> property). That&#39;s how you will improve your design and truly get rid of duplication.</p><p>PS. You can use a method instead of a class, but not a static literal.</p></div></article></div><div class="wrapper"> <related-posts /></div><div class="disqus" role="complementary"><p class="disqus_hint"> Please, use <a href="https://help.disqus.com/commenting/what-html-tags-are-allowed-within-comments">syntax highlighting</a> in your comments, to make them more readable.</p><div id="disqus_thread" class="disqus-thread"> <a>&nbsp;</a></div><script> var disqus_config = function () { this.page.url = document.location.href.split('?')[0].split('#')[0].replace('https://', 'http://'); this.page.identifier = this.page.url; }; (function() { var d = document, s = d.createElement('script'); s.src = '//yegor256.disqus.com/embed.js'; s.setAttribute('data-timestamp', +new Date()); (d.head || d.body).appendChild(s); })(); </script> <noscript><div><p class="red"> JavaScript is disabled in your browser, that's why you can't see comments under this post.</p></div></noscript></div><div class="wrapper"> <footer class="footer"><p> &copy; <span itemscope="" itemprop="copyrightHolder" itemtype="http://schema.org/Person"> <span itemprop="name">Yegor Bugayenko</span> </span> 2014&ndash;<span itemprop="copyrightYear">2018</span></p></footer></div></section><div class="wrapper unprintable" style="text-align:center;margin-top:2em;"> <a href="http://www.sixnines.io/h/3ba1652f"> <img src="//www.sixnines.io/b/3ba1652f?style=flat" alt="sixnines availability badge"/> </a></div><script src="//code.jquery.com/jquery-1.9.0.min.js"></script> <script src="/js/all.js?4e047f6f42b"></script> <script>var disqus_shortname = 'yegor256';</script> <script id="dsq-count-scr" src="//yegor256.disqus.com/count.js" async="async"></script> <script> (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){ (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o), m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m) })(window,document,'script','//www.google-analytics.com/analytics.js','ga'); ga('create', 'UA-1963507-32', 'auto'); ga('send', 'pageview'); </script> <script> Cd=document;Cr="&"+Math.random();Cp="&s=1"; Cd.cookie="b=b";if(Cd.cookie)Cp+="&c=1"; Cp+="&t="+(new Date()).getTimezoneOffset(); if(self!=top)Cp+="&f=1"; </script> <script> if(navigator.javaEnabled())Cp+="&j=1"; </script> <script> if(typeof(screen)!='undefined')Cp+="&w="+screen.width+"&h="+ screen.height+"&d="+(screen.colorDepth?screen.colorDepth:screen.pixelDepth); </script> <script> Cd.write("<img src='//c.hit.ua/hit?i=95870&g=0&x=2"+Cp+Cr+ "&r="+escape(Cd.referrer)+"&u="+escape(window.location.href)+ "' border='0' wi"+"dth='1' he"+"ight='1'/>"); </script> <script type="application/ld+json"> { "@context": "http://schema.org", "@type": "Person", "name": "Yegor Bugayenko", "url": "http://www.yegor256.com", "sameAs": [ "https://www.facebook.com/yegor256", "https://instagram.com/yegor256", "https://www.linkedin.com/in/yegor256", "https://twitter.com/yegor256", "https://github.com/yegor256", "https://www.pinterest.com/yegor256/" ] } </script> </body> </html> <!DOCTYPE html> <html xmlns="http://www.w3.org/1999/xhtml" lang="en-US" xml:lang="en-US" itemscope="" itemtype="http://schema.org/WebSite"> <head> <meta charset="utf-8"/> <meta name="description" content="XML+XSLT rendering for a web page is a powerful mechanism that is intensively used in the Takes framework; this post explains it in detail. " /> <meta name="keywords" content="xml xsl web page, xsl web framework java, xslt for web app, xslt java web framework, xslt web page" /> <meta name="viewport" content="width=device-width,minimum-scale=1,initial-scale=1"/> <meta name="google-site-verification" content="JEj_gQr2CPe2QKGw8XdMz0R7VboQIUbX3FlM-lwTq-8" /> <meta name="author" content="Yegor Bugayenko"> <meta name="article:published_time" content="2015-06-25 00:00:00 +0000"> <meta name="og:site_name" content="Yegor Bugayenko"/> <meta name="og:type" content="article" /> <meta name="og:locale" content="en_US" /> <meta name="twitter:account_id" content="4503599630178231" /> <meta name="twitter:creator" content="@yegor256"/> <meta name="twitter:site" content="@yegor256"/> <meta name="twitter:title" property="og:title" content="XML Data and XSL Views in Takes Framework"/> <meta name="twitter:description" property="og:description" content="XML+XSLT rendering for a web page is a powerful mechanism that is intensively used in the Takes framework; this post explains it in detail. "/> <meta name="twitter:url" property="og:url" content="https://www.yegor256.com/2015/06/25/xml-data-xsl-views-takes-framework.html"/> <meta name="telegram:channel" content="AAAAAEJFMRzsRTRxM3ec6A"/> <link rel="search" type="application/opensearchdescription+xml" href="/opensearch.xml" title="yegor256" /> <link rel="shortcut icon" href="/favicon.ico?4e047f6f42b"/> <link rel="apple-touch-icon" href="/favicon.ico?4e047f6f42b"/> <link rel="alternate" type="application/rss+xml" title="RSS for yegor256.com" href="https://www.yegor256.com/rss.xml"/> <link rel="stylesheet" href="/css/layout.css?4e047f6f42b"/> <link rel="stylesheet" href="/css/icons.css?4e047f6f42b"/> <link rel="canonical" href="https://www.yegor256.com/2015/06/25/xml-data-xsl-views-takes-framework.html" /> <link rel="amphtml" href="https://www.yegor256.com/2015/06/25/xml-data-xsl-views-takes-framework.amp.html" /> <title>XML Data and XSL Views in Takes Framework </title> </head> <body><div class="wrapper"> <aside class="header-toggle unprintable" id="header-toggle" title="Show the menu" onclick="$('#header').show();$('#header-toggle').hide();">&#9776;</aside> <header class="header" id="header"><div class="face"> <a href="/about-me.html#form" class="sub" title="Click to subscribe to my monthly newsletter"><span>Subscribe</span></a> <a href="/about-me.html" style="position:relative;"> <img src="/images/face-256x256.jpg" class="photo" alt="Yegor Bugayenko"/> </a></div><nav><ul class="menu social notranslate"> <li><a href="https://twitter.com/intent/follow?screen_name=yegor256" rel="nofollow" title="Follow me on Twitter"><i class="icon icon-twitter notranslate" aria-hidden="true"></i></a></li> <li><a href="/rss.xml" rel="nofollow" title="Subscribe to my RSS feed"><i class="icon icon-rss notranslate" aria-hidden="true"></i></a></li> <li><a itemprop="sameAs" href="https://github.com/yegor256" rel="nofollow" title="My GitHub profile"><i class="icon icon-github notranslate" aria-hidden="true"></i></a></li> <li><a itemprop="sameAs" href="http://stackoverflow.com/users/187141/yegor256" rel="nofollow" title="My StackOverflow profile"><i class="icon icon-stackoverflow notranslate" aria-hidden="true"></i></a></li> <li><a itemprop="sameAs" href="https://www.facebook.com/yegor256" rel="nofollow" title="Follow me on Facebook"><i class="icon icon-facebook notranslate" aria-hidden="true"></i></a></li> <li><a itemprop="sameAs" href="https://instagram.com/yegor256" rel="nofollow" title="Follow me on Instagram"><i class="icon icon-instagram notranslate" aria-hidden="true"></i></a></li> <li><a itemprop="sameAs" href="https://www.linkedin.com/in/yegor256" rel="nofollow" title="My LinkedIn profile"><i class="icon icon-linkedin notranslate" aria-hidden="true"></i></a></li> <li><a itemprop="sameAs" href="https://www.youtube.com/c/yegor256?sub_confirmation=1" rel="nofollow" title="My Youtube video channel"><i class="icon icon-youtube notranslate" aria-hidden="true"></i></a></li> <li><a itemprop="sameAs" href="https://www.pinterest.com/yegor256/" rel="nofollow" title="My Pinterest boards"><i class="icon icon-pinterest notranslate" aria-hidden="true"></i></a></li> <li><a itemprop="sameAs" href="https://angel.co/yegor256" rel="nofollow" title="My AngelList profile"><i class="icon icon-angellist notranslate" aria-hidden="true"></i></a></li> <li><a href="https://soundcloud.com/yegor256" rel="nofollow" title="My podcast"><i class="icon icon-podcast notranslate" aria-hidden="true"></i></a></li> <li><a href="https://itunes.apple.com/us/podcast/yegor256-podcast/id1150826721" rel="nofollow" title="My iTunes podcast"><i class="icon icon-itunes notranslate" aria-hidden="true"></i></a></li> <li><a href="https://t.me/joinchat/AAAAAEJFMRzsRTRxM3ec6A" rel="nofollow" title="My Telegram public channel"><i class="icon icon-telegram notranslate" aria-hidden="true"></i></a></li> <li><a href="mailto:blog@yegor256.com" rel="nofollow" title="Email me any time"><i class="icon icon-mail notranslate" aria-hidden="true"></i></a></li></ul><ul class="menu"> <li><a href="/" title="Home page">Home</a></li> <li ><a href="/best.html" title="Best articles to read">12&#160;Best</a></li> <li ><a href="/contents.html" title="The contents of the entire blog">All&#160;288</a></li> <li ><a href="/webinars.html" title="My webinars">Webinars</a></li> <li ><a href="/talks.html" title="Future and past conference talks">Talks</a></li> <li ><a href="/books.html" title="The books I wrote">Books</a></li> <li ><a href="/papers.html" title="My academic papers and patents">Papers</a></li> <li ><a href="/pets.html" title="My loved pet projects">Pets</a></li> <li ><a href="/award.html" title="Software quality award">Award</a></li> <li ><a href="/testimonials.html" title="What some people say about me">Testimonials</a></li> <li ><a href="/shift-m.html" title="Audio podcast about project management">Shift-M</a></li> <li ><a href="/paintings.html" title="My paintings for sale">Paintings</a></li> <li><a href="http://ru.yegor256.com/" title="Немного на русском языке">По-русски</a></li></ul></nav><div class="search"> <form method="get" action="https://www.google.com/search" itemprop="potentialAction" itemscope="" itemtype="http://schema.org/SearchAction"> <meta itemprop="target" content="https://www.google.com/search?q={q}"/> <input name="sitesearch" value="yegor256.com" type="hidden"/> <input itemprop="query-input" type="text" id="search-query" class="field field-text" required="required" onfocus="$('.google').css('visibility', 'visible');" name="q" placeholder="Search..." autocomplete="off"/> <input type="image" src="/images/google-search-icon.svg" class="google" title="Search via Google" alt="Search via Google"/> </form></div><div class="hot"><ul> <li> <a href="/code-ahead.html">Code Ahead</a> was published on Amazon just a few days ago! It is my new book, a novel about programmers. It explains in details the majority of ideas that stand behind <a href="https://www.zerocracy.com">Zerocracy</a> and <a href="https://www.xdsd.org">XDSD</a>. </li> <li> At <a href="/webinars.html">Webinar #37</a> we will discuss naming problem in OOP, for objects, methods and attributes; join us on <b>September 12</b>, at 11am PST. </li></ul></div></header></div><section itemscope="" itemtype="http://schema.org/BlogPosting"><div class="wrapper"> <header><p class="printable"> <img src="https://api.qrserver.com/v1/create-qr-code/?data=https://www.yegor256.com/2015/06/25/xml-data-xsl-views-takes-framework.html&amp;format=svg" style="width:125px;height:125px;" alt="QR code"/></p><p class="printable"> <code itemprop="url">https://www.yegor256.com/2015/06/25/xml-data-xsl-views-takes-framework.html</code></p><h1 itemprop="name headline mainEntityOfPage">XML Data and XSL Views in Takes Framework</h1><ul class="subline"> <li> <time itemprop="datePublished" datetime="2015-06-25T00:00:00+00:00"> 25 June 2015 </time> </li> <li class="desktop-only" itemprop="locationCreated">Palo Alto, CA</li> <li class="printable" itemscope="" itemprop="author" itemtype="http://schema.org/Person"> <span itemprop="name">Yegor Bugayenko</span> </li> <li class="unprintable"> <i class="icon icon-comments"></i> <a href="http://www.yegor256.com/2015/06/25/xml-data-xsl-views-takes-framework.html#disqus_thread" itemprop="discussionUrl">comments</a> </li></ul><p>First, let&#39;s agree that templating is a bad idea in the first place. Yes, I mean it. The entire design of JSP is wrong, with all due respect to its creators. Here is how it works: Let&#39;s say my website has to fetch the current exchange rate of the euro from a database and show it on the home page. Here&#39;s how my <code>index.jsp</code> would look:</p><figure class="highlight"><pre><code class="language-jsp" data-lang="jsp"><span></span><span class="nt">&lt;html&gt;</span>
  <span class="nt">&lt;body&gt;</span>
    <span class="nt">&lt;p&gt;</span>EUR/USD: <span class="k">&lt;%=</span> <span class="n">rates</span><span class="o">.</span><span class="na">get</span><span class="o">()</span> <span class="k">%&gt;</span><span class="nt">&lt;/p&gt;</span>
  <span class="nt">&lt;/body&gt;</span>
<span class="nt">&lt;/html&gt;</span></code></pre></figure><p>In order to create HTML, the JSP engine will have to call <code>get()</code> on object <code>rates</code> and render what&#39;s returned through <code>toString()</code>. It&#39;s a terrible design for a few reasons. First, the view is tightly coupled with the model. Second, the flexibility of rendering is very limited. Third, the result of rendering is not reusable, and views are not stackable. There are many other reasons ... more about them in one of the next articles.</p><aside class='youtube'> <a href='https://www.youtube.com/watch?v=nheD2LNYrpk'><div class='box'> <img src='https://i.ytimg.com/vi/nheD2LNYrpk/mqdefault.jpg' alt='YouTube video #nheD2LNYrpk'/><div class='play'><i class='icon icon-play'></i></div></div></a><div>Takes, Java Web Framework, Intro (webinar #12); 2 March 2016.</div></aside><p>Let&#39;s see how this should be done right. First, we let our model generate the output in XML format, for example:</p><figure class="highlight"><pre><code class="language-xml" data-lang="xml"><span></span><span class="cp">&lt;?xml version=&quot;1.1&quot;?&gt;</span>
<span class="nt">&lt;page&gt;</span>
  <span class="nt">&lt;rate&gt;</span>1.1324<span class="nt">&lt;/rate&gt;</span>
<span class="nt">&lt;/page&gt;</span></code></pre></figure><p>This is what the model will produce, having no knowledge of the view. Then, we create the view as an XSL stylesheet, which will transform XML into HTML:</p><figure class="highlight"><pre><code class="language-xml" data-lang="xml"><span></span><span class="nt">&lt;xsl:stylesheet</span> <span class="na">version=</span><span class="s">&quot;1.0&quot;</span>
  <span class="na">xmlns:xsl=</span><span class="s">&quot;http://www.w3.org/1999/XSL/Transform&quot;</span>
  <span class="na">xmlns=</span><span class="s">&quot;http://www.w3.org/1999/xhtml&quot;</span><span class="nt">&gt;</span>
  <span class="nt">&lt;xsl:template</span> <span class="na">match=</span><span class="s">&quot;page&quot;</span><span class="nt">&gt;</span>
    <span class="nt">&lt;html&gt;</span>
      <span class="nt">&lt;body&gt;</span>
        <span class="nt">&lt;p&gt;</span>
          <span class="nt">&lt;xsl:text&gt;</span>EUR/USD: <span class="nt">&lt;/xsl:text&gt;</span>
          <span class="nt">&lt;xsl:value-of</span> <span class="na">select=</span><span class="s">&quot;rate&quot;</span><span class="nt">/&gt;</span>
        <span class="nt">&lt;/p&gt;</span>
      <span class="nt">&lt;/body&gt;</span>
    <span class="nt">&lt;/html&gt;</span>
  <span class="nt">&lt;/xsl:template&gt;</span>
<span class="nt">&lt;/xsl:stylesheet&gt;</span></code></pre></figure><p>As you see, the view doesn&#39;t know anything about the model in terms of implementation. All it knows is the format of XML data output produced by the model. Here is how you design it in the <a href="http://www.takes.org">Takes framework</a>. Let&#39;s start with a simple example:</p><figure class="highlight"><pre><code class="language-java" data-lang="java"><span></span><span class="kn">import</span> <span class="nn">org.takes.http.Exit</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">org.takes.http.FtCli</span><span class="o">;</span>
<span class="kd">public</span> <span class="kd">final</span> <span class="kd">class</span> <span class="nc">Entry</span> <span class="o">{</span>
  <span class="kd">public</span> <span class="kd">static</span> <span class="kt">void</span> <span class="nf">main</span><span class="o">(</span><span class="kd">final</span> <span class="n">String</span><span class="o">...</span> <span class="n">args</span><span class="o">)</span> <span class="kd">throws</span> <span class="n">Exception</span> <span class="o">{</span>
    <span class="k">new</span> <span class="n">FtCli</span><span class="o">(</span><span class="k">new</span> <span class="n">TkApp</span><span class="o">(),</span> <span class="n">args</span><span class="o">).</span><span class="na">start</span><span class="o">(</span><span class="n">Exit</span><span class="o">.</span><span class="na">NEVER</span><span class="o">);</span>
  <span class="o">}</span>
<span class="o">}</span></code></pre></figure><p>It&#39;s a simple web application that starts a web server and never ends (it waits for connections in daemon mode). To make it work, we should create a simple &quot;take&quot; named <code>TkApp</code>:</p><figure class="highlight"><pre><code class="language-java" data-lang="java"><span></span><span class="kn">import</span> <span class="nn">org.takes.Take</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">org.takes.tk.TkWrap</span><span class="o">;</span>
<span class="kd">final</span> <span class="kd">class</span> <span class="nc">TkApp</span> <span class="kd">extends</span> <span class="n">TkWrap</span> <span class="o">{</span>
  <span class="nd">@Override</span>
  <span class="kd">public</span> <span class="n">Response</span> <span class="nf">act</span><span class="o">()</span> <span class="o">{</span>
    <span class="k">return</span> <span class="k">new</span> <span class="n">RsWithType</span><span class="o">(</span>
      <span class="k">new</span> <span class="n">RsText</span><span class="o">(</span>
        <span class="s">&quot;&lt;page&gt;&lt;rate&gt;1.1324&lt;/rate&gt;&lt;/page&gt;&quot;</span>
      <span class="o">),</span>
      <span class="s">&quot;application/xml&quot;</span>
    <span class="o">);</span>
  <span class="o">}</span>
<span class="o">}</span></code></pre></figure><p>This &quot;take&quot; always returns the same XML response, but it doesn&#39;t do any XSL transformation yet. We need to add the <code>RsXSLT</code> class to the picture:</p><figure class="highlight"><pre><code class="language-java" data-lang="java"><span></span><span class="nd">@Override</span>
<span class="kd">public</span> <span class="n">Response</span> <span class="nf">act</span><span class="o">()</span> <span class="o">{</span>
  <span class="k">return</span> <span class="k">new</span> <span class="n">RsXSLT</span><span class="o">(</span>
    <span class="k">new</span> <span class="n">RsWithType</span><span class="o">(</span>
      <span class="k">new</span> <span class="n">RsText</span><span class="o">(</span>
        <span class="s">&quot;&lt;?xml-stylesheet type=&#39;text/xsl&#39; href=&#39;/xsl/index.xsl&#39;?&gt;&quot;</span>
        <span class="o">+</span> <span class="s">&quot;&lt;page&gt;&lt;rate&gt;1.1324&lt;/rate&gt;&lt;/page&gt;&quot;</span>
      <span class="o">),</span>
      <span class="s">&quot;application/xml&quot;</span>
    <span class="o">)</span>
  <span class="o">);</span>
<span class="o">}</span></code></pre></figure><p>Excuse me for using string concatenation, which is a <a href="/2014/06/19/avoid-string-concatenation.html">bad practice</a>; it&#39;s merely for the simplicity of the example.</p><p>As you see, I also added an XML stylesheet processing instruction to the XML. <code>RsXSLT</code> will understand it and try to find the <code>/xsl/index.xsl</code> resource on classpath. You see the content of that file above.</p><p>That&#39;s it.</p><p>Well, not really. Building XML from strings is not a good idea. We have a better instrument in the Takes framework. We use <a href="http://www.xembly.org">Xembly</a>, which is a simple imperative language for building and modifying XML documents. More about it here: <a href="/2014/04/09/xembly-intro.html">Xembly, an Assembly for XML</a>.</p><p>Here is how our <code>TkApp</code> would look:</p><figure class="highlight"><pre><code class="language-java" data-lang="java"><span></span><span class="nd">@Override</span>
<span class="kd">public</span> <span class="n">Response</span> <span class="nf">act</span><span class="o">()</span> <span class="o">{</span>
  <span class="k">return</span> <span class="k">new</span> <span class="n">RsXSLT</span><span class="o">(</span>
    <span class="k">new</span> <span class="n">RsWithType</span><span class="o">(</span>
      <span class="k">new</span> <span class="n">RsXembly</span><span class="o">(</span>
        <span class="k">new</span> <span class="n">XeChain</span><span class="o">(</span>
          <span class="k">new</span> <span class="n">XeStylesheet</span><span class="o">(</span><span class="s">&quot;/xsl/index.xsl&quot;</span><span class="o">),</span>
          <span class="k">new</span> <span class="n">XeAppend</span><span class="o">(</span>
            <span class="s">&quot;page&quot;</span><span class="o">,</span>
            <span class="k">new</span> <span class="n">XeDirectives</span><span class="o">(</span>
              <span class="k">new</span> <span class="n">Directives</span><span class="o">().</span><span class="na">add</span><span class="o">(</span><span class="s">&quot;rate&quot;</span><span class="o">).</span><span class="na">set</span><span class="o">(</span><span class="s">&quot;1.1324&quot;</span><span class="o">)</span>
            <span class="o">)</span>
          <span class="o">)</span>
        <span class="o">)</span>
      <span class="o">),</span>
      <span class="s">&quot;application/xml&quot;</span>
    <span class="o">)</span>
  <span class="o">);</span>
<span class="o">}</span></code></pre></figure><p>The most important class here is <a href="http://static.javadoc.io/org.takes/takes/1.1/org/takes/rs/xe/RsXembly.html"><code>RsXembly</code></a>. The idea is to let model classes expose their data through Xembly &quot;directives,&quot; which will later be applied to a DOM structure by <code>RsXembly</code>.</p><p><code>XeChain</code>, <code>XeStylesheet</code>, <code>XeAppend</code>, and <code>XeDirectives</code> expose directives but with different meanings (they are all instances of an <code>XeSource</code> interface). Their names describe their intentions rather well. <a href="http://static.javadoc.io/org.takes/takes/1.1/org/takes/rs/xe/XeChain.html"><code>XeChain</code></a> just chains everything that is delivered by encapsulated &quot;directive sources.&quot; <a href="http://static.javadoc.io/org.takes/takes/1.1/org/takes/rs/xe/XeStylesheet.html"><code>XeStylesheet</code></a> returns directives that create a single XML processing instruction. <a href="http://static.javadoc.io/org.takes/takes/1.1/org/takes/rs/xe/XeAppend.html"><code>XeAppend</code></a> creates an XML node and adds encapsulated directives to it. <a href="http://static.javadoc.io/org.takes/takes/1.1/org/takes/rs/xe/XeDirectives.html"><code>XeDirectives</code></a> simply returns what&#39;s inside.</p><p>In the end, this code will create exactly the same XML document as I created above with string concatenation.</p><p>The beauty of this approach is in the perfect decoupling of data generation and XML building and translation between XML and HTML. It is perfectly reusable and &quot;stackable.&quot; We can transform the data in XML format multiple times, applying different XSL stylesheets to each one. We can even transform them into <a href="/2015/11/16/json-vs-xml.html">JSON</a> without changing a line of code in model classes.</p><p>Moreover, we can format them differently, using rather powerful XSLT 2.0 instruments. XSLT by itself is a powerful and purely functional language that enables any possible data manipulations. No templating engine is even close to it.</p><p>Take a look at how it works in the <a href="https://github.com/yegor256/rultor/blob/1.55/src/main/java/com/rultor/web/RsPage.java"><code>RsPage</code></a> class in Rultor, for example.</p></p>--> <nav class="buttons notranslate desktop-only"> <a href="http://www.facebook.com/sharer/sharer.php?u=https://www.yegor256.com/2015/06/25/xml-data-xsl-views-takes-framework.html" title="Share on Facebook" class="button" rel="nofollow"> <span class="count count-facebook">0</span> <i class="icon icon-facebook notranslate" aria-hidden="true"></i> </a> <a href="https://twitter.com/share?url=https://www.yegor256.com/2015/06/25/xml-data-xsl-views-takes-framework.html&amp;text=XML+Data+and+XSL+Views+in+Takes+Framework" title="Share on Twitter" class="button" rel="nofollow"> <span class="count count-twitter">0</span> <i class="icon icon-twitter notranslate" aria-hidden="true"></i> </a> <a href="https://plus.google.com/share?url=https://www.yegor256.com/2015/06/25/xml-data-xsl-views-takes-framework.html" title="Share on Google+" class="button" rel="nofollow"> <span class="count count-googleplus">0</span> <i class="icon icon-googleplus notranslate" aria-hidden="true"></i> </a> <a href="https://www.linkedin.com/cws/share?url=https://www.yegor256.com/2015/06/25/xml-data-xsl-views-takes-framework.html" title="Share on LinkedIn" class="button" rel="nofollow"> <span class="count count-linkedin">0</span> <i class="icon icon-linkedin notranslate" aria-hidden="true"></i> </a> <a href="http://reddit.com/submit?url=https://www.yegor256.com/2015/06/25/xml-data-xsl-views-takes-framework.html%3F2015-25&amp;title=XML+Data+and+XSL+Views+in+Takes+Framework" title="Share on Reddit" class="button" rel="nofollow"> <span class="count count-reddit">0</span> <i class="icon icon-reddit notranslate" aria-hidden="true"></i> </a> <a href="http://news.ycombinator.com/submitlink?u=https://www.yegor256.com/2015/06/25/xml-data-xsl-views-takes-framework.html%3F2015-25&amp;t=XML+Data+and+XSL+Views+in+Takes+Framework" title="Share on Hacker News" class="button" rel="nofollow"> <span class="count count-hackernews">0</span> <i class="icon icon-hackernews notranslate" aria-hidden="true"></i> </a> </nav> </header> <article class="main" itemprop="articleBody"><div > <figure class='badge'><a href='http://www.takes.org'><img src='http://www.takes.org/logo.png' style='width:96px;max-width:100%;' alt='badge'/></a></figure><p>A year ago, I <a href="/2014/06/25/xml-and-xslt-in-browser.html">tried to explain</a> how effectively data and its presentation can be separated in a web application with the help of XML and XSL. In a few words, instead of using <a href="https://en.wikipedia.org/wiki/Comparison_of_web_template_engines">templating</a> (like JSP, Velocity, FreeMarker, etc.) and injection of data into HTML, we compose them in the form of an XML document and then let the XSL stylesheet transform them into HTML. Here is a brief example of how all this can be used together with the <a href="http://www.takes.org">Takes framework</a>.</p><p>First, let&#39;s agree that templating is a bad idea in the first place. Yes, I mean it. The entire design of JSP is wrong, with all due respect to its creators. Here is how it works: Let&#39;s say my website has to fetch the current exchange rate of the euro from a database and show it on the home page. Here&#39;s how my <code>index.jsp</code> would look:</p><figure class="highlight"><pre><code class="language-jsp" data-lang="jsp"><span></span><span class="nt">&lt;html&gt;</span>
  <span class="nt">&lt;body&gt;</span>
    <span class="nt">&lt;p&gt;</span>EUR/USD: <span class="k">&lt;%=</span> <span class="n">rates</span><span class="o">.</span><span class="na">get</span><span class="o">()</span> <span class="k">%&gt;</span><span class="nt">&lt;/p&gt;</span>
  <span class="nt">&lt;/body&gt;</span>
<span class="nt">&lt;/html&gt;</span></code></pre></figure><p>In order to create HTML, the JSP engine will have to call <code>get()</code> on object <code>rates</code> and render what&#39;s returned through <code>toString()</code>. It&#39;s a terrible design for a few reasons. First, the view is tightly coupled with the model. Second, the flexibility of rendering is very limited. Third, the result of rendering is not reusable, and views are not stackable. There are many other reasons ... more about them in one of the next articles.</p><aside class='youtube'> <a href='https://www.youtube.com/watch?v=nheD2LNYrpk'><div class='box'> <img src='https://i.ytimg.com/vi/nheD2LNYrpk/mqdefault.jpg' alt='YouTube video #nheD2LNYrpk'/><div class='play'><i class='icon icon-play'></i></div></div></a><div>Takes, Java Web Framework, Intro (webinar #12); 2 March 2016.</div></aside><p>Let&#39;s see how this should be done right. First, we let our model generate the output in XML format, for example:</p><figure class="highlight"><pre><code class="language-xml" data-lang="xml"><span></span><span class="cp">&lt;?xml version=&quot;1.1&quot;?&gt;</span>
<span class="nt">&lt;page&gt;</span>
  <span class="nt">&lt;rate&gt;</span>1.1324<span class="nt">&lt;/rate&gt;</span>
<span class="nt">&lt;/page&gt;</span></code></pre></figure><p>This is what the model will produce, having no knowledge of the view. Then, we create the view as an XSL stylesheet, which will transform XML into HTML:</p><figure class="highlight"><pre><code class="language-xml" data-lang="xml"><span></span><span class="nt">&lt;xsl:stylesheet</span> <span class="na">version=</span><span class="s">&quot;1.0&quot;</span>
  <span class="na">xmlns:xsl=</span><span class="s">&quot;http://www.w3.org/1999/XSL/Transform&quot;</span>
  <span class="na">xmlns=</span><span class="s">&quot;http://www.w3.org/1999/xhtml&quot;</span><span class="nt">&gt;</span>
  <span class="nt">&lt;xsl:template</span> <span class="na">match=</span><span class="s">&quot;page&quot;</span><span class="nt">&gt;</span>
    <span class="nt">&lt;html&gt;</span>
      <span class="nt">&lt;body&gt;</span>
        <span class="nt">&lt;p&gt;</span>
          <span class="nt">&lt;xsl:text&gt;</span>EUR/USD: <span class="nt">&lt;/xsl:text&gt;</span>
          <span class="nt">&lt;xsl:value-of</span> <span class="na">select=</span><span class="s">&quot;rate&quot;</span><span class="nt">/&gt;</span>
        <span class="nt">&lt;/p&gt;</span>
      <span class="nt">&lt;/body&gt;</span>
    <span class="nt">&lt;/html&gt;</span>
  <span class="nt">&lt;/xsl:template&gt;</span>
<span class="nt">&lt;/xsl:stylesheet&gt;</span></code></pre></figure><p>As you see, the view doesn&#39;t know anything about the model in terms of implementation. All it knows is the format of XML data output produced by the model. Here is how you design it in the <a href="http://www.takes.org">Takes framework</a>. Let&#39;s start with a simple example:</p><figure class="highlight"><pre><code class="language-java" data-lang="java"><span></span><span class="kn">import</span> <span class="nn">org.takes.http.Exit</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">org.takes.http.FtCli</span><span class="o">;</span>
<span class="kd">public</span> <span class="kd">final</span> <span class="kd">class</span> <span class="nc">Entry</span> <span class="o">{</span>
  <span class="kd">public</span> <span class="kd">static</span> <span class="kt">void</span> <span class="nf">main</span><span class="o">(</span><span class="kd">final</span> <span class="n">String</span><span class="o">...</span> <span class="n">args</span><span class="o">)</span> <span class="kd">throws</span> <span class="n">Exception</span> <span class="o">{</span>
    <span class="k">new</span> <span class="n">FtCli</span><span class="o">(</span><span class="k">new</span> <span class="n">TkApp</span><span class="o">(),</span> <span class="n">args</span><span class="o">).</span><span class="na">start</span><span class="o">(</span><span class="n">Exit</span><span class="o">.</span><span class="na">NEVER</span><span class="o">);</span>
  <span class="o">}</span>
<span class="o">}</span></code></pre></figure><p>It&#39;s a simple web application that starts a web server and never ends (it waits for connections in daemon mode). To make it work, we should create a simple &quot;take&quot; named <code>TkApp</code>:</p><figure class="highlight"><pre><code class="language-java" data-lang="java"><span></span><span class="kn">import</span> <span class="nn">org.takes.Take</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">org.takes.tk.TkWrap</span><span class="o">;</span>
<span class="kd">final</span> <span class="kd">class</span> <span class="nc">TkApp</span> <span class="kd">extends</span> <span class="n">TkWrap</span> <span class="o">{</span>
  <span class="nd">@Override</span>
  <span class="kd">public</span> <span class="n">Response</span> <span class="nf">act</span><span class="o">()</span> <span class="o">{</span>
    <span class="k">return</span> <span class="k">new</span> <span class="n">RsWithType</span><span class="o">(</span>
      <span class="k">new</span> <span class="n">RsText</span><span class="o">(</span>
        <span class="s">&quot;&lt;page&gt;&lt;rate&gt;1.1324&lt;/rate&gt;&lt;/page&gt;&quot;</span>
      <span class="o">),</span>
      <span class="s">&quot;application/xml&quot;</span>
    <span class="o">);</span>
  <span class="o">}</span>
<span class="o">}</span></code></pre></figure><p>This &quot;take&quot; always returns the same XML response, but it doesn&#39;t do any XSL transformation yet. We need to add the <code>RsXSLT</code> class to the picture:</p><figure class="highlight"><pre><code class="language-java" data-lang="java"><span></span><span class="nd">@Override</span>
<span class="kd">public</span> <span class="n">Response</span> <span class="nf">act</span><span class="o">()</span> <span class="o">{</span>
  <span class="k">return</span> <span class="k">new</span> <span class="n">RsXSLT</span><span class="o">(</span>
    <span class="k">new</span> <span class="n">RsWithType</span><span class="o">(</span>
      <span class="k">new</span> <span class="n">RsText</span><span class="o">(</span>
        <span class="s">&quot;&lt;?xml-stylesheet type=&#39;text/xsl&#39; href=&#39;/xsl/index.xsl&#39;?&gt;&quot;</span>
        <span class="o">+</span> <span class="s">&quot;&lt;page&gt;&lt;rate&gt;1.1324&lt;/rate&gt;&lt;/page&gt;&quot;</span>
      <span class="o">),</span>
      <span class="s">&quot;application/xml&quot;</span>
    <span class="o">)</span>
  <span class="o">);</span>
<span class="o">}</span></code></pre></figure><p>Excuse me for using string concatenation, which is a <a href="/2014/06/19/avoid-string-concatenation.html">bad practice</a>; it&#39;s merely for the simplicity of the example.</p><p>As you see, I also added an XML stylesheet processing instruction to the XML. <code>RsXSLT</code> will understand it and try to find the <code>/xsl/index.xsl</code> resource on classpath. You see the content of that file above.</p><p>That&#39;s it.</p><p>Well, not really. Building XML from strings is not a good idea. We have a better instrument in the Takes framework. We use <a href="http://www.xembly.org">Xembly</a>, which is a simple imperative language for building and modifying XML documents. More about it here: <a href="/2014/04/09/xembly-intro.html">Xembly, an Assembly for XML</a>.</p><p>Here is how our <code>TkApp</code> would look:</p><figure class="highlight"><pre><code class="language-java" data-lang="java"><span></span><span class="nd">@Override</span>
<span class="kd">public</span> <span class="n">Response</span> <span class="nf">act</span><span class="o">()</span> <span class="o">{</span>
  <span class="k">return</span> <span class="k">new</span> <span class="n">RsXSLT</span><span class="o">(</span>
    <span class="k">new</span> <span class="n">RsWithType</span><span class="o">(</span>
      <span class="k">new</span> <span class="n">RsXembly</span><span class="o">(</span>
        <span class="k">new</span> <span class="n">XeChain</span><span class="o">(</span>
          <span class="k">new</span> <span class="n">XeStylesheet</span><span class="o">(</span><span class="s">&quot;/xsl/index.xsl&quot;</span><span class="o">),</span>
          <span class="k">new</span> <span class="n">XeAppend</span><span class="o">(</span>
            <span class="s">&quot;page&quot;</span><span class="o">,</span>
            <span class="k">new</span> <span class="n">XeDirectives</span><span class="o">(</span>
              <span class="k">new</span> <span class="n">Directives</span><span class="o">().</span><span class="na">add</span><span class="o">(</span><span class="s">&quot;rate&quot;</span><span class="o">).</span><span class="na">set</span><span class="o">(</span><span class="s">&quot;1.1324&quot;</span><span class="o">)</span>
            <span class="o">)</span>
          <span class="o">)</span>
        <span class="o">)</span>
      <span class="o">),</span>
      <span class="s">&quot;application/xml&quot;</span>
    <span class="o">)</span>
  <span class="o">);</span>
<span class="o">}</span></code></pre></figure><p>The most important class here is <a href="http://static.javadoc.io/org.takes/takes/1.1/org/takes/rs/xe/RsXembly.html"><code>RsXembly</code></a>. The idea is to let model classes expose their data through Xembly &quot;directives,&quot; which will later be applied to a DOM structure by <code>RsXembly</code>.</p><p><code>XeChain</code>, <code>XeStylesheet</code>, <code>XeAppend</code>, and <code>XeDirectives</code> expose directives but with different meanings (they are all instances of an <code>XeSource</code> interface). Their names describe their intentions rather well. <a href="http://static.javadoc.io/org.takes/takes/1.1/org/takes/rs/xe/XeChain.html"><code>XeChain</code></a> just chains everything that is delivered by encapsulated &quot;directive sources.&quot; <a href="http://static.javadoc.io/org.takes/takes/1.1/org/takes/rs/xe/XeStylesheet.html"><code>XeStylesheet</code></a> returns directives that create a single XML processing instruction. <a href="http://static.javadoc.io/org.takes/takes/1.1/org/takes/rs/xe/XeAppend.html"><code>XeAppend</code></a> creates an XML node and adds encapsulated directives to it. <a href="http://static.javadoc.io/org.takes/takes/1.1/org/takes/rs/xe/XeDirectives.html"><code>XeDirectives</code></a> simply returns what&#39;s inside.</p><p>In the end, this code will create exactly the same XML document as I created above with string concatenation.</p><p>The beauty of this approach is in the perfect decoupling of data generation and XML building and translation between XML and HTML. It is perfectly reusable and &quot;stackable.&quot; We can transform the data in XML format multiple times, applying different XSL stylesheets to each one. We can even transform them into <a href="/2015/11/16/json-vs-xml.html">JSON</a> without changing a line of code in model classes.</p><p>Moreover, we can format them differently, using rather powerful XSLT 2.0 instruments. XSLT by itself is a powerful and purely functional language that enables any possible data manipulations. No templating engine is even close to it.</p><p>Take a look at how it works in the <a href="https://github.com/yegor256/rultor/blob/1.55/src/main/java/com/rultor/web/RsPage.java"><code>RsPage</code></a> class in Rultor, for example.</p></div></article></div><div class="wrapper"> <related-posts /></div><div class="disqus" role="complementary"><p class="disqus_hint"> Please, use <a href="https://help.disqus.com/commenting/what-html-tags-are-allowed-within-comments">syntax highlighting</a> in your comments, to make them more readable.</p><div id="disqus_thread" class="disqus-thread"> <a>&nbsp;</a></div><script> var disqus_config = function () { this.page.url = document.location.href.split('?')[0].split('#')[0].replace('https://', 'http://'); this.page.identifier = this.page.url; }; (function() { var d = document, s = d.createElement('script'); s.src = '//yegor256.disqus.com/embed.js'; s.setAttribute('data-timestamp', +new Date()); (d.head || d.body).appendChild(s); })(); </script> <noscript><div><p class="red"> JavaScript is disabled in your browser, that's why you can't see comments under this post.</p></div></noscript></div><div class="wrapper"> <footer class="footer"><p> &copy; <span itemscope="" itemprop="copyrightHolder" itemtype="http://schema.org/Person"> <span itemprop="name">Yegor Bugayenko</span> </span> 2014&ndash;<span itemprop="copyrightYear">2018</span></p></footer></div></section><div class="wrapper unprintable" style="text-align:center;margin-top:2em;"> <a href="http://www.sixnines.io/h/3ba1652f"> <img src="//www.sixnines.io/b/3ba1652f?style=flat" alt="sixnines availability badge"/> </a></div><script src="//code.jquery.com/jquery-1.9.0.min.js"></script> <script src="/js/all.js?4e047f6f42b"></script> <script>var disqus_shortname = 'yegor256';</script> <script id="dsq-count-scr" src="//yegor256.disqus.com/count.js" async="async"></script> <script> (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){ (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o), m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m) })(window,document,'script','//www.google-analytics.com/analytics.js','ga'); ga('create', 'UA-1963507-32', 'auto'); ga('send', 'pageview'); </script> <script> Cd=document;Cr="&"+Math.random();Cp="&s=1"; Cd.cookie="b=b";if(Cd.cookie)Cp+="&c=1"; Cp+="&t="+(new Date()).getTimezoneOffset(); if(self!=top)Cp+="&f=1"; </script> <script> if(navigator.javaEnabled())Cp+="&j=1"; </script> <script> if(typeof(screen)!='undefined')Cp+="&w="+screen.width+"&h="+ screen.height+"&d="+(screen.colorDepth?screen.colorDepth:screen.pixelDepth); </script> <script> Cd.write("<img src='//c.hit.ua/hit?i=95870&g=0&x=2"+Cp+Cr+ "&r="+escape(Cd.referrer)+"&u="+escape(window.location.href)+ "' border='0' wi"+"dth='1' he"+"ight='1'/>"); </script> <script type="application/ld+json"> { "@context": "http://schema.org", "@type": "Person", "name": "Yegor Bugayenko", "url": "http://www.yegor256.com", "sameAs": [ "https://www.facebook.com/yegor256", "https://instagram.com/yegor256", "https://www.linkedin.com/in/yegor256", "https://twitter.com/yegor256", "https://github.com/yegor256", "https://www.pinterest.com/yegor256/" ] } </script> </body> </html> <!DOCTYPE html> <html xmlns="http://www.w3.org/1999/xhtml" lang="en-US" xml:lang="en-US" itemscope="" itemtype="http://schema.org/WebSite"> <head> <meta charset="utf-8"/> <meta name="description" content="In a properly designed class, there can only be one primary constructor and any number of secondary ones. " /> <meta name="keywords" content="class constructor, java constructor, object constructor, oop constructor, primary constructor" /> <meta name="viewport" content="width=device-width,minimum-scale=1,initial-scale=1"/> <meta name="google-site-verification" content="JEj_gQr2CPe2QKGw8XdMz0R7VboQIUbX3FlM-lwTq-8" /> <meta name="author" content="Yegor Bugayenko"> <meta name="article:published_time" content="2015-05-28 00:00:00 +0000"> <meta name="og:site_name" content="Yegor Bugayenko"/> <meta name="og:type" content="article" /> <meta name="og:locale" content="en_US" /> <meta name="twitter:account_id" content="4503599630178231" /> <meta name="twitter:creator" content="@yegor256"/> <meta name="twitter:site" content="@yegor256"/> <meta name="twitter:title" property="og:title" content="There Can Be Only One Primary Constructor"/> <meta name="twitter:description" property="og:description" content="In a properly designed class, there can only be one primary constructor and any number of secondary ones. "/> <meta name="twitter:url" property="og:url" content="https://www.yegor256.com/2015/05/28/one-primary-constructor.html"/> <meta name="telegram:channel" content="AAAAAEJFMRzsRTRxM3ec6A"/> <link rel="search" type="application/opensearchdescription+xml" href="/opensearch.xml" title="yegor256" /> <link rel="shortcut icon" href="/favicon.ico?4e047f6f42b"/> <link rel="apple-touch-icon" href="/favicon.ico?4e047f6f42b"/> <link rel="alternate" type="application/rss+xml" title="RSS for yegor256.com" href="https://www.yegor256.com/rss.xml"/> <link rel="stylesheet" href="/css/layout.css?4e047f6f42b"/> <link rel="stylesheet" href="/css/icons.css?4e047f6f42b"/> <link rel="canonical" href="https://www.yegor256.com/2015/05/28/one-primary-constructor.html" /> <link rel="amphtml" href="https://www.yegor256.com/2015/05/28/one-primary-constructor.amp.html" /> <title>There Can Be Only One Primary Constructor </title> <meta name='og:image' content='https://www.yegor256.com/images/2015/05/the-matrix-agent-smith.jpg'/><meta name='twitter:image' content='https://www.yegor256.com/images/2015/05/the-matrix-agent-smith.jpg'/><meta name='og:image:width' content='1200'/> <meta name='twitter:image:width' content='1200'/><meta name='og:image:height' content='678'/> <meta name='twitter:image:height' content='678'/><meta name='twitter:card' content='summary_large_image'/><meta name='twitter:image:alt' content='The Matrix (1999) by The Wachowski Brothers'/> </head> <body><div class="wrapper"> <aside class="header-toggle unprintable" id="header-toggle" title="Show the menu" onclick="$('#header').show();$('#header-toggle').hide();">&#9776;</aside> <header class="header" id="header"><div class="face"> <a href="/about-me.html#form" class="sub" title="Click to subscribe to my monthly newsletter"><span>Subscribe</span></a> <a href="/about-me.html" style="position:relative;"> <img src="/images/face-256x256.jpg" class="photo" alt="Yegor Bugayenko"/> </a></div><nav><ul class="menu social notranslate"> <li><a href="https://twitter.com/intent/follow?screen_name=yegor256" rel="nofollow" title="Follow me on Twitter"><i class="icon icon-twitter notranslate" aria-hidden="true"></i></a></li> <li><a href="/rss.xml" rel="nofollow" title="Subscribe to my RSS feed"><i class="icon icon-rss notranslate" aria-hidden="true"></i></a></li> <li><a itemprop="sameAs" href="https://github.com/yegor256" rel="nofollow" title="My GitHub profile"><i class="icon icon-github notranslate" aria-hidden="true"></i></a></li> <li><a itemprop="sameAs" href="http://stackoverflow.com/users/187141/yegor256" rel="nofollow" title="My StackOverflow profile"><i class="icon icon-stackoverflow notranslate" aria-hidden="true"></i></a></li> <li><a itemprop="sameAs" href="https://www.facebook.com/yegor256" rel="nofollow" title="Follow me on Facebook"><i class="icon icon-facebook notranslate" aria-hidden="true"></i></a></li> <li><a itemprop="sameAs" href="https://instagram.com/yegor256" rel="nofollow" title="Follow me on Instagram"><i class="icon icon-instagram notranslate" aria-hidden="true"></i></a></li> <li><a itemprop="sameAs" href="https://www.linkedin.com/in/yegor256" rel="nofollow" title="My LinkedIn profile"><i class="icon icon-linkedin notranslate" aria-hidden="true"></i></a></li> <li><a itemprop="sameAs" href="https://www.youtube.com/c/yegor256?sub_confirmation=1" rel="nofollow" title="My Youtube video channel"><i class="icon icon-youtube notranslate" aria-hidden="true"></i></a></li> <li><a itemprop="sameAs" href="https://www.pinterest.com/yegor256/" rel="nofollow" title="My Pinterest boards"><i class="icon icon-pinterest notranslate" aria-hidden="true"></i></a></li> <li><a itemprop="sameAs" href="https://angel.co/yegor256" rel="nofollow" title="My AngelList profile"><i class="icon icon-angellist notranslate" aria-hidden="true"></i></a></li> <li><a href="https://soundcloud.com/yegor256" rel="nofollow" title="My podcast"><i class="icon icon-podcast notranslate" aria-hidden="true"></i></a></li> <li><a href="https://itunes.apple.com/us/podcast/yegor256-podcast/id1150826721" rel="nofollow" title="My iTunes podcast"><i class="icon icon-itunes notranslate" aria-hidden="true"></i></a></li> <li><a href="https://t.me/joinchat/AAAAAEJFMRzsRTRxM3ec6A" rel="nofollow" title="My Telegram public channel"><i class="icon icon-telegram notranslate" aria-hidden="true"></i></a></li> <li><a href="mailto:blog@yegor256.com" rel="nofollow" title="Email me any time"><i class="icon icon-mail notranslate" aria-hidden="true"></i></a></li></ul><ul class="menu"> <li><a href="/" title="Home page">Home</a></li> <li ><a href="/best.html" title="Best articles to read">12&#160;Best</a></li> <li ><a href="/contents.html" title="The contents of the entire blog">All&#160;288</a></li> <li ><a href="/webinars.html" title="My webinars">Webinars</a></li> <li ><a href="/talks.html" title="Future and past conference talks">Talks</a></li> <li ><a href="/books.html" title="The books I wrote">Books</a></li> <li ><a href="/papers.html" title="My academic papers and patents">Papers</a></li> <li ><a href="/pets.html" title="My loved pet projects">Pets</a></li> <li ><a href="/award.html" title="Software quality award">Award</a></li> <li ><a href="/testimonials.html" title="What some people say about me">Testimonials</a></li> <li ><a href="/shift-m.html" title="Audio podcast about project management">Shift-M</a></li> <li ><a href="/paintings.html" title="My paintings for sale">Paintings</a></li> <li><a href="http://ru.yegor256.com/" title="Немного на русском языке">По-русски</a></li></ul></nav><div class="search"> <form method="get" action="https://www.google.com/search" itemprop="potentialAction" itemscope="" itemtype="http://schema.org/SearchAction"> <meta itemprop="target" content="https://www.google.com/search?q={q}"/> <input name="sitesearch" value="yegor256.com" type="hidden"/> <input itemprop="query-input" type="text" id="search-query" class="field field-text" required="required" onfocus="$('.google').css('visibility', 'visible');" name="q" placeholder="Search..." autocomplete="off"/> <input type="image" src="/images/google-search-icon.svg" class="google" title="Search via Google" alt="Search via Google"/> </form></div><div class="hot"><ul> <li> <a href="/code-ahead.html">Code Ahead</a> was published on Amazon just a few days ago! It is my new book, a novel about programmers. It explains in details the majority of ideas that stand behind <a href="https://www.zerocracy.com">Zerocracy</a> and <a href="https://www.xdsd.org">XDSD</a>. </li> <li> At <a href="/webinars.html">Webinar #37</a> we will discuss naming problem in OOP, for objects, methods and attributes; join us on <b>September 12</b>, at 11am PST. </li></ul></div></header></div><section itemscope="" itemtype="http://schema.org/BlogPosting"><div class="wrapper"> <header><p class="printable"> <img src="https://api.qrserver.com/v1/create-qr-code/?data=https://www.yegor256.com/2015/05/28/one-primary-constructor.html&amp;format=svg" style="width:125px;height:125px;" alt="QR code"/></p><p class="printable"> <code itemprop="url">https://www.yegor256.com/2015/05/28/one-primary-constructor.html</code></p><h1 itemprop="name headline mainEntityOfPage">There Can Be Only One Primary Constructor</h1><aside class='book'><a href='http://amzn.to/2qFt4Tn'><img src='/images/books/elegant-objects/cover.png' class='book-cover' alt='book cover'/></a>Read more about this subject in <a href='http://amzn.to/2qFt4Tn'>Section&nbsp;1.2</a><br/> of my book<a href='http://amzn.to/2qFt4Tn'><img src='/images/books/amazon-buy-button.png' class='amazon-button' alt='Click to buy'/></a></aside><ul class="subline"> <li> <time itemprop="datePublished" datetime="2015-05-28T00:00:00+00:00"> 28 May 2015 </time> </li> <li class="printable" itemscope="" itemprop="author" itemtype="http://schema.org/Person"> <span itemprop="name">Yegor Bugayenko</span> </li> <li class="unprintable"> <i class="icon icon-comments"></i> <a href="http://www.yegor256.com/2015/05/28/one-primary-constructor.html#disqus_thread" itemprop="discussionUrl">comments</a> </li></ul><ul class="unprintable subline"> <li>Translated:</li> <li><a href="http://blog.csdn.net/LvShuiLanTian/article/details/52390622">Chinese</a></li> <li><a href="mailto:translate@yegor256.com">add yours!</a></li></ul><figure class='jb_picture'><img itemprop='image' alt='The Matrix (1999) by The Wachowski Brothers' src='/images/2015/05/the-matrix-agent-smith.jpg' longdesc='#8bc62615'/><figcaption id='8bc62615'>The Matrix (1999) by The Wachowski Brothers</figcaption></figure><p>Here is what I mean:</p><figure class="highlight"><pre><code class="language-java" data-lang="java"><span></span><span class="kd">final</span> <span class="kd">class</span> <span class="nc">Cash</span> <span class="o">{</span>
  <span class="kd">private</span> <span class="kd">final</span> <span class="kt">int</span> <span class="n">cents</span><span class="o">;</span>
  <span class="kd">private</span> <span class="kd">final</span> <span class="n">String</span> <span class="n">currency</span><span class="o">;</span>
  <span class="kd">public</span> <span class="nf">Cash</span><span class="o">()</span> <span class="o">{</span> <span class="c1">// secondary</span>
    <span class="k">this</span><span class="o">(</span><span class="mi">0</span><span class="o">);</span>
  <span class="o">}</span>
  <span class="kd">public</span> <span class="nf">Cash</span><span class="o">(</span><span class="kt">int</span> <span class="n">cts</span><span class="o">)</span> <span class="o">{</span> <span class="c1">// secondary</span>
    <span class="k">this</span><span class="o">(</span><span class="n">cts</span><span class="o">,</span> <span class="s">&quot;USD&quot;</span><span class="o">);</span>
  <span class="o">}</span>
  <span class="kd">public</span> <span class="nf">Cash</span><span class="o">(</span><span class="kt">int</span> <span class="n">cts</span><span class="o">,</span> <span class="n">String</span> <span class="n">crn</span><span class="o">)</span> <span class="o">{</span> <span class="c1">// primary</span>
    <span class="k">this</span><span class="o">.</span><span class="na">cents</span> <span class="o">=</span> <span class="n">cts</span><span class="o">;</span>
    <span class="k">this</span><span class="o">.</span><span class="na">currency</span> <span class="o">=</span> <span class="n">crn</span><span class="o">;</span>
  <span class="o">}</span>
  <span class="c1">// methods here</span>
<span class="o">}</span></code></pre></figure><p>There are three constructors in the class---only one is <em>primary</em> and the other two are <em>secondary</em>. My definition of a secondary constructor is simple: It doesn&#39;t do anything besides calling a primary constructor, through <code>this(..)</code>.</p><p>My point here is that a <a href="/2014/11/20/seven-virtues-of-good-object.html">properly designed class</a> must have only one primary constructor, and it should be declared after all secondary ones. Why? There is only one reason behind this rule: It helps eliminate code duplication.</p><p>Without such a rule, we may have this design for our class:</p><figure class="highlight"><pre><code class="language-java" data-lang="java"><span></span><span class="kd">final</span> <span class="kd">class</span> <span class="nc">Cash</span> <span class="o">{</span>
  <span class="kd">private</span> <span class="kd">final</span> <span class="kt">int</span> <span class="n">cents</span><span class="o">;</span>
  <span class="kd">private</span> <span class="kd">final</span> <span class="n">String</span> <span class="n">currency</span><span class="o">;</span>
  <span class="kd">public</span> <span class="nf">Cash</span><span class="o">()</span> <span class="o">{</span> <span class="c1">// primary</span>
    <span class="k">this</span><span class="o">.</span><span class="na">cents</span> <span class="o">=</span> <span class="mi">0</span><span class="o">;</span>
    <span class="k">this</span><span class="o">.</span><span class="na">currency</span> <span class="o">=</span> <span class="s">&quot;USD&quot;</span><span class="o">;</span>
  <span class="o">}</span>
  <span class="kd">public</span> <span class="nf">Cash</span><span class="o">(</span><span class="kt">int</span> <span class="n">cts</span><span class="o">)</span> <span class="o">{</span> <span class="c1">// primary</span>
    <span class="k">this</span><span class="o">.</span><span class="na">cents</span> <span class="o">=</span> <span class="n">cts</span><span class="o">;</span>
    <span class="k">this</span><span class="o">.</span><span class="na">currency</span> <span class="o">=</span> <span class="s">&quot;USD&quot;</span><span class="o">;</span>
  <span class="o">}</span>
  <span class="kd">public</span> <span class="nf">Cash</span><span class="o">(</span><span class="kt">int</span> <span class="n">cts</span><span class="o">,</span> <span class="n">String</span> <span class="n">crn</span><span class="o">)</span> <span class="o">{</span> <span class="c1">// primary</span>
    <span class="k">this</span><span class="o">.</span><span class="na">cents</span> <span class="o">=</span> <span class="n">cts</span><span class="o">;</span>
    <span class="k">this</span><span class="o">.</span><span class="na">currency</span> <span class="o">=</span> <span class="n">crn</span><span class="o">;</span>
  <span class="o">}</span>
  <span class="c1">// methods here</span>
<span class="o">}</span></code></pre></figure><p>There&#39;s not a lot of code here, but the duplication is massive and ugly; I hope you see it for yourself.</p><p>By strictly following this suggested rule, all classes will have a single entry point (point of construction), which is a primary constructor, and it will always be easy to find because it stays below all secondary constructors.</p><p>More about this subject in <a href="/elegant-objects.html">Elegant Objects</a>, Section <a href="/images/books/elegant-objects/contents.pdf">1.2</a>.</p></p>--> <nav class="buttons notranslate desktop-only"> <a href="http://www.facebook.com/sharer/sharer.php?u=https://www.yegor256.com/2015/05/28/one-primary-constructor.html" title="Share on Facebook" class="button" rel="nofollow"> <span class="count count-facebook">0</span> <i class="icon icon-facebook notranslate" aria-hidden="true"></i> </a> <a href="https://twitter.com/share?url=https://www.yegor256.com/2015/05/28/one-primary-constructor.html&amp;text=There+Can+Be+Only+One+Primary+Constructor" title="Share on Twitter" class="button" rel="nofollow"> <span class="count count-twitter">0</span> <i class="icon icon-twitter notranslate" aria-hidden="true"></i> </a> <a href="https://plus.google.com/share?url=https://www.yegor256.com/2015/05/28/one-primary-constructor.html" title="Share on Google+" class="button" rel="nofollow"> <span class="count count-googleplus">0</span> <i class="icon icon-googleplus notranslate" aria-hidden="true"></i> </a> <a href="https://www.linkedin.com/cws/share?url=https://www.yegor256.com/2015/05/28/one-primary-constructor.html" title="Share on LinkedIn" class="button" rel="nofollow"> <span class="count count-linkedin">0</span> <i class="icon icon-linkedin notranslate" aria-hidden="true"></i> </a> <a href="http://reddit.com/submit?url=https://www.yegor256.com/2015/05/28/one-primary-constructor.html%3F2015-21&amp;title=There+Can+Be+Only+One+Primary+Constructor" title="Share on Reddit" class="button" rel="nofollow"> <span class="count count-reddit">0</span> <i class="icon icon-reddit notranslate" aria-hidden="true"></i> </a> <a href="http://news.ycombinator.com/submitlink?u=https://www.yegor256.com/2015/05/28/one-primary-constructor.html%3F2015-21&amp;t=There+Can+Be+Only+One+Primary+Constructor" title="Share on Hacker News" class="button" rel="nofollow"> <span class="count count-hackernews">0</span> <i class="icon icon-hackernews notranslate" aria-hidden="true"></i> </a> </nav> </header> <article class="main" itemprop="articleBody"><div ><p>I suggest classifying class constructors in OOP as <strong>primary</strong> and <strong>secondary</strong>. A primary constructor is the one that constructs an object and encapsulates other objects inside it. A secondary one is simply a preparation step before calling a primary constructor and is not really a constructor but rather an introductory layer in front of a real constructing mechanism.</p><figure class='jb_picture'><img itemprop='image' alt='The Matrix (1999) by The Wachowski Brothers' src='/images/2015/05/the-matrix-agent-smith.jpg' longdesc='#8bc62615'/><figcaption id='8bc62615'>The Matrix (1999) by The Wachowski Brothers</figcaption></figure><p>Here is what I mean:</p><figure class="highlight"><pre><code class="language-java" data-lang="java"><span></span><span class="kd">final</span> <span class="kd">class</span> <span class="nc">Cash</span> <span class="o">{</span>
  <span class="kd">private</span> <span class="kd">final</span> <span class="kt">int</span> <span class="n">cents</span><span class="o">;</span>
  <span class="kd">private</span> <span class="kd">final</span> <span class="n">String</span> <span class="n">currency</span><span class="o">;</span>
  <span class="kd">public</span> <span class="nf">Cash</span><span class="o">()</span> <span class="o">{</span> <span class="c1">// secondary</span>
    <span class="k">this</span><span class="o">(</span><span class="mi">0</span><span class="o">);</span>
  <span class="o">}</span>
  <span class="kd">public</span> <span class="nf">Cash</span><span class="o">(</span><span class="kt">int</span> <span class="n">cts</span><span class="o">)</span> <span class="o">{</span> <span class="c1">// secondary</span>
    <span class="k">this</span><span class="o">(</span><span class="n">cts</span><span class="o">,</span> <span class="s">&quot;USD&quot;</span><span class="o">);</span>
  <span class="o">}</span>
  <span class="kd">public</span> <span class="nf">Cash</span><span class="o">(</span><span class="kt">int</span> <span class="n">cts</span><span class="o">,</span> <span class="n">String</span> <span class="n">crn</span><span class="o">)</span> <span class="o">{</span> <span class="c1">// primary</span>
    <span class="k">this</span><span class="o">.</span><span class="na">cents</span> <span class="o">=</span> <span class="n">cts</span><span class="o">;</span>
    <span class="k">this</span><span class="o">.</span><span class="na">currency</span> <span class="o">=</span> <span class="n">crn</span><span class="o">;</span>
  <span class="o">}</span>
  <span class="c1">// methods here</span>
<span class="o">}</span></code></pre></figure><p>There are three constructors in the class---only one is <em>primary</em> and the other two are <em>secondary</em>. My definition of a secondary constructor is simple: It doesn&#39;t do anything besides calling a primary constructor, through <code>this(..)</code>.</p><p>My point here is that a <a href="/2014/11/20/seven-virtues-of-good-object.html">properly designed class</a> must have only one primary constructor, and it should be declared after all secondary ones. Why? There is only one reason behind this rule: It helps eliminate code duplication.</p><p>Without such a rule, we may have this design for our class:</p><figure class="highlight"><pre><code class="language-java" data-lang="java"><span></span><span class="kd">final</span> <span class="kd">class</span> <span class="nc">Cash</span> <span class="o">{</span>
  <span class="kd">private</span> <span class="kd">final</span> <span class="kt">int</span> <span class="n">cents</span><span class="o">;</span>
  <span class="kd">private</span> <span class="kd">final</span> <span class="n">String</span> <span class="n">currency</span><span class="o">;</span>
  <span class="kd">public</span> <span class="nf">Cash</span><span class="o">()</span> <span class="o">{</span> <span class="c1">// primary</span>
    <span class="k">this</span><span class="o">.</span><span class="na">cents</span> <span class="o">=</span> <span class="mi">0</span><span class="o">;</span>
    <span class="k">this</span><span class="o">.</span><span class="na">currency</span> <span class="o">=</span> <span class="s">&quot;USD&quot;</span><span class="o">;</span>
  <span class="o">}</span>
  <span class="kd">public</span> <span class="nf">Cash</span><span class="o">(</span><span class="kt">int</span> <span class="n">cts</span><span class="o">)</span> <span class="o">{</span> <span class="c1">// primary</span>
    <span class="k">this</span><span class="o">.</span><span class="na">cents</span> <span class="o">=</span> <span class="n">cts</span><span class="o">;</span>
    <span class="k">this</span><span class="o">.</span><span class="na">currency</span> <span class="o">=</span> <span class="s">&quot;USD&quot;</span><span class="o">;</span>
  <span class="o">}</span>
  <span class="kd">public</span> <span class="nf">Cash</span><span class="o">(</span><span class="kt">int</span> <span class="n">cts</span><span class="o">,</span> <span class="n">String</span> <span class="n">crn</span><span class="o">)</span> <span class="o">{</span> <span class="c1">// primary</span>
    <span class="k">this</span><span class="o">.</span><span class="na">cents</span> <span class="o">=</span> <span class="n">cts</span><span class="o">;</span>
    <span class="k">this</span><span class="o">.</span><span class="na">currency</span> <span class="o">=</span> <span class="n">crn</span><span class="o">;</span>
  <span class="o">}</span>
  <span class="c1">// methods here</span>
<span class="o">}</span></code></pre></figure><p>There&#39;s not a lot of code here, but the duplication is massive and ugly; I hope you see it for yourself.</p><p>By strictly following this suggested rule, all classes will have a single entry point (point of construction), which is a primary constructor, and it will always be easy to find because it stays below all secondary constructors.</p><p>More about this subject in <a href="/elegant-objects.html">Elegant Objects</a>, Section <a href="/images/books/elegant-objects/contents.pdf">1.2</a>.</p></div></article></div><div class="wrapper"> <related-posts /></div><div class="disqus" role="complementary"><p class="disqus_hint"> Please, use <a href="https://help.disqus.com/commenting/what-html-tags-are-allowed-within-comments">syntax highlighting</a> in your comments, to make them more readable.</p><div id="disqus_thread" class="disqus-thread"> <a>&nbsp;</a></div><script> var disqus_config = function () { this.page.url = document.location.href.split('?')[0].split('#')[0].replace('https://', 'http://'); this.page.identifier = this.page.url; }; (function() { var d = document, s = d.createElement('script'); s.src = '//yegor256.disqus.com/embed.js'; s.setAttribute('data-timestamp', +new Date()); (d.head || d.body).appendChild(s); })(); </script> <noscript><div><p class="red"> JavaScript is disabled in your browser, that's why you can't see comments under this post.</p></div></noscript></div><div class="wrapper"> <footer class="footer"><p> &copy; <span itemscope="" itemprop="copyrightHolder" itemtype="http://schema.org/Person"> <span itemprop="name">Yegor Bugayenko</span> </span> 2014&ndash;<span itemprop="copyrightYear">2018</span></p></footer></div></section><div class="wrapper unprintable" style="text-align:center;margin-top:2em;"> <a href="http://www.sixnines.io/h/3ba1652f"> <img src="//www.sixnines.io/b/3ba1652f?style=flat" alt="sixnines availability badge"/> </a></div><script src="//code.jquery.com/jquery-1.9.0.min.js"></script> <script src="/js/all.js?4e047f6f42b"></script> <script>var disqus_shortname = 'yegor256';</script> <script id="dsq-count-scr" src="//yegor256.disqus.com/count.js" async="async"></script> <script> (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){ (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o), m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m) })(window,document,'script','//www.google-analytics.com/analytics.js','ga'); ga('create', 'UA-1963507-32', 'auto'); ga('send', 'pageview'); </script> <script> Cd=document;Cr="&"+Math.random();Cp="&s=1"; Cd.cookie="b=b";if(Cd.cookie)Cp+="&c=1"; Cp+="&t="+(new Date()).getTimezoneOffset(); if(self!=top)Cp+="&f=1"; </script> <script> if(navigator.javaEnabled())Cp+="&j=1"; </script> <script> if(typeof(screen)!='undefined')Cp+="&w="+screen.width+"&h="+ screen.height+"&d="+(screen.colorDepth?screen.colorDepth:screen.pixelDepth); </script> <script> Cd.write("<img src='//c.hit.ua/hit?i=95870&g=0&x=2"+Cp+Cr+ "&r="+escape(Cd.referrer)+"&u="+escape(window.location.href)+ "' border='0' wi"+"dth='1' he"+"ight='1'/>"); </script> <script type="application/ld+json"> { "@context": "http://schema.org", "@type": "Person", "name": "Yegor Bugayenko", "url": "http://www.yegor256.com", "sameAs": [ "https://www.facebook.com/yegor256", "https://instagram.com/yegor256", "https://www.linkedin.com/in/yegor256", "https://twitter.com/yegor256", "https://github.com/yegor256", "https://www.pinterest.com/yegor256/" ] } </script> </body> </html> <!DOCTYPE html> <html xmlns="http://www.w3.org/1999/xhtml" lang="en-US" xml:lang="en-US" itemscope="" itemtype="http://schema.org/WebSite"> <head> <meta charset="utf-8"/> <meta name="description" content="Most unit tests require mocks, stubs, and the preparation of some other structures before a test can be initiated; here is how I recommend you do that. " /> <meta name="keywords" content="unit test scaffolding, unit testing best practices, unit testing mocks, unit testing of static, unit testing stubs" /> <meta name="viewport" content="width=device-width,minimum-scale=1,initial-scale=1"/> <meta name="google-site-verification" content="JEj_gQr2CPe2QKGw8XdMz0R7VboQIUbX3FlM-lwTq-8" /> <meta name="author" content="Yegor Bugayenko"> <meta name="article:published_time" content="2015-05-25 00:00:00 +0000"> <meta name="og:site_name" content="Yegor Bugayenko"/> <meta name="og:type" content="article" /> <meta name="og:locale" content="en_US" /> <meta name="twitter:account_id" content="4503599630178231" /> <meta name="twitter:creator" content="@yegor256"/> <meta name="twitter:site" content="@yegor256"/> <meta name="twitter:title" property="og:title" content="A Few Thoughts on Unit Test Scaffolding"/> <meta name="twitter:description" property="og:description" content="Most unit tests require mocks, stubs, and the preparation of some other structures before a test can be initiated; here is how I recommend you do that. "/> <meta name="twitter:url" property="og:url" content="https://www.yegor256.com/2015/05/25/unit-test-scaffolding.html"/> <meta name="telegram:channel" content="AAAAAEJFMRzsRTRxM3ec6A"/> <link rel="search" type="application/opensearchdescription+xml" href="/opensearch.xml" title="yegor256" /> <link rel="shortcut icon" href="/favicon.ico?4e047f6f42b"/> <link rel="apple-touch-icon" href="/favicon.ico?4e047f6f42b"/> <link rel="alternate" type="application/rss+xml" title="RSS for yegor256.com" href="https://www.yegor256.com/rss.xml"/> <link rel="stylesheet" href="/css/layout.css?4e047f6f42b"/> <link rel="stylesheet" href="/css/icons.css?4e047f6f42b"/> <link rel="canonical" href="https://www.yegor256.com/2015/05/25/unit-test-scaffolding.html" /> <link rel="amphtml" href="https://www.yegor256.com/2015/05/25/unit-test-scaffolding.amp.html" /> <title>A Few Thoughts on Unit Test Scaffolding </title> <meta name='og:image' content='https://www.yegor256.com/images/2015/05/leon-the-professional.jpg'/><meta name='twitter:image' content='https://www.yegor256.com/images/2015/05/leon-the-professional.jpg'/><meta name='og:image:width' content='1200'/> <meta name='twitter:image:width' content='1200'/><meta name='og:image:height' content='563'/> <meta name='twitter:image:height' content='563'/><meta name='twitter:card' content='summary_large_image'/><meta name='twitter:image:alt' content='Léon: The Professional by Luc Besson'/> </head> <body><div class="wrapper"> <aside class="header-toggle unprintable" id="header-toggle" title="Show the menu" onclick="$('#header').show();$('#header-toggle').hide();">&#9776;</aside> <header class="header" id="header"><div class="face"> <a href="/about-me.html#form" class="sub" title="Click to subscribe to my monthly newsletter"><span>Subscribe</span></a> <a href="/about-me.html" style="position:relative;"> <img src="/images/face-256x256.jpg" class="photo" alt="Yegor Bugayenko"/> </a></div><nav><ul class="menu social notranslate"> <li><a href="https://twitter.com/intent/follow?screen_name=yegor256" rel="nofollow" title="Follow me on Twitter"><i class="icon icon-twitter notranslate" aria-hidden="true"></i></a></li> <li><a href="/rss.xml" rel="nofollow" title="Subscribe to my RSS feed"><i class="icon icon-rss notranslate" aria-hidden="true"></i></a></li> <li><a itemprop="sameAs" href="https://github.com/yegor256" rel="nofollow" title="My GitHub profile"><i class="icon icon-github notranslate" aria-hidden="true"></i></a></li> <li><a itemprop="sameAs" href="http://stackoverflow.com/users/187141/yegor256" rel="nofollow" title="My StackOverflow profile"><i class="icon icon-stackoverflow notranslate" aria-hidden="true"></i></a></li> <li><a itemprop="sameAs" href="https://www.facebook.com/yegor256" rel="nofollow" title="Follow me on Facebook"><i class="icon icon-facebook notranslate" aria-hidden="true"></i></a></li> <li><a itemprop="sameAs" href="https://instagram.com/yegor256" rel="nofollow" title="Follow me on Instagram"><i class="icon icon-instagram notranslate" aria-hidden="true"></i></a></li> <li><a itemprop="sameAs" href="https://www.linkedin.com/in/yegor256" rel="nofollow" title="My LinkedIn profile"><i class="icon icon-linkedin notranslate" aria-hidden="true"></i></a></li> <li><a itemprop="sameAs" href="https://www.youtube.com/c/yegor256?sub_confirmation=1" rel="nofollow" title="My Youtube video channel"><i class="icon icon-youtube notranslate" aria-hidden="true"></i></a></li> <li><a itemprop="sameAs" href="https://www.pinterest.com/yegor256/" rel="nofollow" title="My Pinterest boards"><i class="icon icon-pinterest notranslate" aria-hidden="true"></i></a></li> <li><a itemprop="sameAs" href="https://angel.co/yegor256" rel="nofollow" title="My AngelList profile"><i class="icon icon-angellist notranslate" aria-hidden="true"></i></a></li> <li><a href="https://soundcloud.com/yegor256" rel="nofollow" title="My podcast"><i class="icon icon-podcast notranslate" aria-hidden="true"></i></a></li> <li><a href="https://itunes.apple.com/us/podcast/yegor256-podcast/id1150826721" rel="nofollow" title="My iTunes podcast"><i class="icon icon-itunes notranslate" aria-hidden="true"></i></a></li> <li><a href="https://t.me/joinchat/AAAAAEJFMRzsRTRxM3ec6A" rel="nofollow" title="My Telegram public channel"><i class="icon icon-telegram notranslate" aria-hidden="true"></i></a></li> <li><a href="mailto:blog@yegor256.com" rel="nofollow" title="Email me any time"><i class="icon icon-mail notranslate" aria-hidden="true"></i></a></li></ul><ul class="menu"> <li><a href="/" title="Home page">Home</a></li> <li ><a href="/best.html" title="Best articles to read">12&#160;Best</a></li> <li ><a href="/contents.html" title="The contents of the entire blog">All&#160;288</a></li> <li ><a href="/webinars.html" title="My webinars">Webinars</a></li> <li ><a href="/talks.html" title="Future and past conference talks">Talks</a></li> <li ><a href="/books.html" title="The books I wrote">Books</a></li> <li ><a href="/papers.html" title="My academic papers and patents">Papers</a></li> <li ><a href="/pets.html" title="My loved pet projects">Pets</a></li> <li ><a href="/award.html" title="Software quality award">Award</a></li> <li ><a href="/testimonials.html" title="What some people say about me">Testimonials</a></li> <li ><a href="/shift-m.html" title="Audio podcast about project management">Shift-M</a></li> <li ><a href="/paintings.html" title="My paintings for sale">Paintings</a></li> <li><a href="http://ru.yegor256.com/" title="Немного на русском языке">По-русски</a></li></ul></nav><div class="search"> <form method="get" action="https://www.google.com/search" itemprop="potentialAction" itemscope="" itemtype="http://schema.org/SearchAction"> <meta itemprop="target" content="https://www.google.com/search?q={q}"/> <input name="sitesearch" value="yegor256.com" type="hidden"/> <input itemprop="query-input" type="text" id="search-query" class="field field-text" required="required" onfocus="$('.google').css('visibility', 'visible');" name="q" placeholder="Search..." autocomplete="off"/> <input type="image" src="/images/google-search-icon.svg" class="google" title="Search via Google" alt="Search via Google"/> </form></div><div class="hot"><ul> <li> <a href="/code-ahead.html">Code Ahead</a> was published on Amazon just a few days ago! It is my new book, a novel about programmers. It explains in details the majority of ideas that stand behind <a href="https://www.zerocracy.com">Zerocracy</a> and <a href="https://www.xdsd.org">XDSD</a>. </li> <li> At <a href="/webinars.html">Webinar #37</a> we will discuss naming problem in OOP, for objects, methods and attributes; join us on <b>September 12</b>, at 11am PST. </li></ul></div></header></div><section itemscope="" itemtype="http://schema.org/BlogPosting"><div class="wrapper"> <header><p class="printable"> <img src="https://api.qrserver.com/v1/create-qr-code/?data=https://www.yegor256.com/2015/05/25/unit-test-scaffolding.html&amp;format=svg" style="width:125px;height:125px;" alt="QR code"/></p><p class="printable"> <code itemprop="url">https://www.yegor256.com/2015/05/25/unit-test-scaffolding.html</code></p><h1 itemprop="name headline mainEntityOfPage">A Few Thoughts on Unit Test Scaffolding</h1><ul class="subline"> <li> <time itemprop="datePublished" datetime="2015-05-25T00:00:00+00:00"> 25 May 2015 </time> </li> <li class="printable" itemscope="" itemprop="author" itemtype="http://schema.org/Person"> <span itemprop="name">Yegor Bugayenko</span> </li> <li class="unprintable"> <i class="icon icon-comments"></i> <a href="http://www.yegor256.com/2015/05/25/unit-test-scaffolding.html#disqus_thread" itemprop="discussionUrl">comments</a> </li></ul><figure class='jb_picture'><img itemprop='image' alt='Léon: The Professional by Luc Besson' src='/images/2015/05/leon-the-professional.jpg' longdesc='#6f716aac'/><figcaption id='6f716aac'>Léon: The Professional by Luc Besson</figcaption></figure><p>JUnit officially suggests a <a href="http://junit.org/faq.html#atests_2">test fixture</a>:</p><figure class="highlight"><pre><code class="language-java" data-lang="java"><span></span><span class="kd">public</span> <span class="kd">final</span> <span class="kd">class</span> <span class="nc">MetricsTest</span> <span class="o">{</span>
  <span class="kd">private</span> <span class="n">File</span> <span class="n">temp</span><span class="o">;</span>
  <span class="kd">private</span> <span class="n">Folder</span> <span class="n">folder</span><span class="o">;</span>
  <span class="nd">@Before</span>
  <span class="kd">public</span> <span class="kt">void</span> <span class="nf">prepare</span><span class="o">()</span> <span class="o">{</span>
    <span class="k">this</span><span class="o">.</span><span class="na">temp</span> <span class="o">=</span> <span class="n">Files</span><span class="o">.</span><span class="na">createTempDirectory</span><span class="o">(</span><span class="s">&quot;test&quot;</span><span class="o">);</span>
    <span class="k">this</span><span class="o">.</span><span class="na">folder</span> <span class="o">=</span> <span class="k">new</span> <span class="n">DiscFolder</span><span class="o">(</span><span class="k">this</span><span class="o">.</span><span class="na">temp</span><span class="o">);</span>
    <span class="k">this</span><span class="o">.</span><span class="na">folder</span><span class="o">.</span><span class="na">save</span><span class="o">(</span><span class="s">&quot;first.txt&quot;</span><span class="o">,</span> <span class="s">&quot;Hello, world!&quot;</span><span class="o">);</span>
    <span class="k">this</span><span class="o">.</span><span class="na">folder</span><span class="o">.</span><span class="na">save</span><span class="o">(</span><span class="s">&quot;second.txt&quot;</span><span class="o">,</span> <span class="s">&quot;Goodbye!&quot;</span><span class="o">);</span>
  <span class="o">}</span>
  <span class="nd">@After</span>
  <span class="kd">public</span> <span class="kt">void</span> <span class="nf">clean</span><span class="o">()</span> <span class="o">{</span>
    <span class="n">FileUtils</span><span class="o">.</span><span class="na">deleteDirectory</span><span class="o">(</span><span class="k">this</span><span class="o">.</span><span class="na">temp</span><span class="o">);</span>
  <span class="o">}</span>
  <span class="nd">@Test</span>
  <span class="kd">public</span> <span class="kt">void</span> <span class="nf">calculatesTotalSize</span><span class="o">()</span> <span class="o">{</span>
    <span class="n">assertEquals</span><span class="o">(</span><span class="mi">22</span><span class="o">,</span> <span class="k">new</span> <span class="n">Metrics</span><span class="o">(</span><span class="k">this</span><span class="o">.</span><span class="na">folder</span><span class="o">).</span><span class="na">size</span><span class="o">());</span>
  <span class="o">}</span>
  <span class="nd">@Test</span>
  <span class="kd">public</span> <span class="kt">void</span> <span class="nf">countsWordsInFiles</span><span class="o">()</span> <span class="o">{</span>
    <span class="n">assertEquals</span><span class="o">(</span><span class="mi">4</span><span class="o">,</span> <span class="k">new</span> <span class="n">Metrics</span><span class="o">(</span><span class="k">this</span><span class="o">.</span><span class="na">folder</span><span class="o">).</span><span class="na">wc</span><span class="o">());</span>
  <span class="o">}</span>
<span class="o">}</span></code></pre></figure><p>I think it&#39;s obvious what this test is doing. First, in <code>prepare()</code>, it creates a &quot;test fixture&quot; of type <code>Folder</code>. That is used in all three tests as an argument for the <code>Metrics</code> constructor. The real class being tested here is <code>Metrics</code> while <code>this.folder</code> is something we need in order to test it.</p><aside class='youtube'> <a href='https://www.youtube.com/watch?v=l6MpCBzwDbg'><div class='box'> <img src='https://i.ytimg.com/vi/l6MpCBzwDbg/mqdefault.jpg' alt='YouTube video #l6MpCBzwDbg'/><div class='play'><i class='icon icon-play'></i></div></div></a><div>What Fake Objects Are For? (webinar #8); 4 November 2015.</div></aside><p>What&#39;s wrong with this test? There is one serious issue: <strong>coupling</strong> between test methods. Test methods (and all tests in general) must be perfectly isolated from each other. This means that changing one test must not affect any others. In this example, that is not the case. When I want to change the <code>countsWords()</code> test, I have to change the internals of <code>before()</code>, which will affect the other method in the test &quot;class.&quot;</p><p>With all due respect to JUnit, the idea of creating test fixtures in <code>@Before</code> and <code>@After</code> is wrong, mostly because it encourages developers to couple test methods.</p><p>Here is how we can improve our test and isolate test methods:</p><figure class="highlight"><pre><code class="language-java" data-lang="java"><span></span><span class="kd">public</span> <span class="kd">final</span> <span class="kd">class</span> <span class="nc">MetricsTest</span> <span class="o">{</span>
  <span class="nd">@Test</span>
  <span class="kd">public</span> <span class="kt">void</span> <span class="nf">calculatesTotalSize</span><span class="o">()</span> <span class="o">{</span>
    <span class="kd">final</span> <span class="n">File</span> <span class="n">dir</span> <span class="o">=</span> <span class="n">Files</span><span class="o">.</span><span class="na">createTempDirectory</span><span class="o">(</span><span class="s">&quot;test-1&quot;</span><span class="o">);</span>
    <span class="kd">final</span> <span class="n">Folder</span> <span class="n">folder</span> <span class="o">=</span> <span class="n">MetricsTest</span><span class="o">.</span><span class="na">folder</span><span class="o">(</span>
      <span class="n">dir</span><span class="o">,</span>
      <span class="s">&quot;first.txt:Hello, world!&quot;</span><span class="o">,</span>
      <span class="s">&quot;second.txt:Goodbye!&quot;</span>
    <span class="o">);</span>
    <span class="k">try</span> <span class="o">{</span>
      <span class="n">assertEquals</span><span class="o">(</span><span class="mi">22</span><span class="o">,</span> <span class="k">new</span> <span class="n">Metrics</span><span class="o">(</span><span class="n">folder</span><span class="o">).</span><span class="na">size</span><span class="o">());</span>
    <span class="o">}</span> <span class="k">finally</span> <span class="o">{</span>
      <span class="n">FileUtils</span><span class="o">.</span><span class="na">deleteDirectory</span><span class="o">(</span><span class="n">dir</span><span class="o">);</span>
    <span class="o">}</span>
  <span class="o">}</span>
  <span class="nd">@Test</span>
  <span class="kd">public</span> <span class="kt">void</span> <span class="nf">countsWordsInFiles</span><span class="o">()</span> <span class="o">{</span>
    <span class="kd">final</span> <span class="n">File</span> <span class="n">dir</span> <span class="o">=</span> <span class="n">Files</span><span class="o">.</span><span class="na">createTempDirectory</span><span class="o">(</span><span class="s">&quot;test-2&quot;</span><span class="o">);</span>
    <span class="kd">final</span> <span class="n">Folder</span> <span class="n">folder</span> <span class="o">=</span> <span class="n">MetricsTest</span><span class="o">.</span><span class="na">folder</span><span class="o">(</span>
      <span class="n">dir</span><span class="o">,</span>
      <span class="s">&quot;alpha.txt:Three words here&quot;</span><span class="o">,</span>
      <span class="s">&quot;beta.txt:two words&quot;</span>
      <span class="s">&quot;gamma.txt:one!&quot;</span>
    <span class="o">);</span>
    <span class="k">try</span> <span class="o">{</span>
      <span class="n">assertEquals</span><span class="o">(</span><span class="mi">6</span><span class="o">,</span> <span class="k">new</span> <span class="n">Metrics</span><span class="o">(</span><span class="n">folder</span><span class="o">).</span><span class="na">wc</span><span class="o">());</span>
    <span class="o">}</span> <span class="k">finally</span> <span class="o">{</span>
      <span class="n">FileUtils</span><span class="o">.</span><span class="na">deleteDirectory</span><span class="o">(</span><span class="n">dir</span><span class="o">);</span>
    <span class="o">}</span>
  <span class="o">}</span>
  <span class="kd">private</span> <span class="kd">static</span> <span class="n">Folder</span> <span class="nf">folder</span><span class="o">(</span><span class="n">File</span> <span class="n">dir</span><span class="o">,</span> <span class="n">String</span><span class="o">...</span> <span class="n">parts</span><span class="o">)</span> <span class="o">{</span>
    <span class="n">Folder</span> <span class="n">folder</span> <span class="o">=</span> <span class="k">new</span> <span class="n">DiscFolder</span><span class="o">(</span><span class="n">dir</span><span class="o">);</span>
    <span class="k">for</span> <span class="o">(</span><span class="kd">final</span> <span class="n">String</span> <span class="n">part</span> <span class="o">:</span> <span class="n">parts</span><span class="o">)</span> <span class="o">{</span>
      <span class="kd">final</span> <span class="n">String</span><span class="o">[]</span> <span class="n">pair</span> <span class="o">=</span> <span class="n">part</span><span class="o">.</span><span class="na">split</span><span class="o">(</span><span class="s">&quot;:&quot;</span><span class="o">,</span> <span class="mi">2</span><span class="o">);</span>
      <span class="k">this</span><span class="o">.</span><span class="na">folder</span><span class="o">.</span><span class="na">save</span><span class="o">(</span><span class="n">pair</span><span class="o">[</span><span class="mi">0</span><span class="o">],</span> <span class="n">pair</span><span class="o">[</span><span class="mi">1</span><span class="o">]);</span>
    <span class="o">}</span>
    <span class="k">return</span> <span class="n">folder</span><span class="o">;</span>
  <span class="o">}</span>
<span class="o">}</span></code></pre></figure><p>Does it look better now? We&#39;re not there yet, but now our test methods are perfectly isolated. If I want to change one of them, I&#39;m not going to affect the others because I pass all configuration parameters to a private static utility (!) method <code>folder()</code>.</p><p>A utility method, huh? Yes, <a href="/2014/05/05/oop-alternative-to-utility-classes.html">it smells</a>.</p><p>The main issue with this design, even though it is way better than the previous one, is that it doesn&#39;t prevent code duplication between test &quot;classes.&quot; If I need a similar test fixture of type <code>Folder</code> in another test case, I will have to move this static method there. Or even worse, I will have to create a utility class. Yes, there is <a href="/2015/02/20/utility-classes-vs-functional-programming.html">nothing worse</a> in object-oriented programming than utility classes.</p><p>A much better design would be to use &quot;<a href="/2014/09/23/built-in-fake-objects.html">fake</a>&quot; objects instead of private static utilities. Here is how. First, we create a fake class and place it into <code>src/main/java</code>. This class can be used in tests and also in production code, if necessary (<code>Fk</code> for &quot;fake&quot;):</p><figure class="highlight"><pre><code class="language-java" data-lang="java"><span></span><span class="kd">public</span> <span class="kd">final</span> <span class="kd">class</span> <span class="nc">FkFolder</span> <span class="kd">implements</span> <span class="n">Folder</span><span class="o">,</span> <span class="n">Closeable</span> <span class="o">{</span>
  <span class="kd">private</span> <span class="kd">final</span> <span class="n">File</span> <span class="n">dir</span><span class="o">;</span>
  <span class="kd">private</span> <span class="kd">final</span> <span class="n">String</span><span class="o">[]</span> <span class="n">parts</span><span class="o">;</span>
  <span class="kd">public</span> <span class="nf">FkFolder</span><span class="o">(</span><span class="n">String</span><span class="o">...</span> <span class="n">prts</span><span class="o">)</span> <span class="o">{</span>
    <span class="k">this</span><span class="o">(</span><span class="n">Files</span><span class="o">.</span><span class="na">createTempDirectory</span><span class="o">(</span><span class="s">&quot;test-1&quot;</span><span class="o">),</span> <span class="n">parts</span><span class="o">);</span>
  <span class="o">}</span>
  <span class="kd">public</span> <span class="nf">FkFolder</span><span class="o">(</span><span class="n">File</span> <span class="n">file</span><span class="o">,</span> <span class="n">String</span><span class="o">...</span> <span class="n">prts</span><span class="o">)</span> <span class="o">{</span>
    <span class="k">this</span><span class="o">.</span><span class="na">dir</span> <span class="o">=</span> <span class="n">file</span><span class="o">;</span>
    <span class="k">this</span><span class="o">.</span><span class="na">parts</span> <span class="o">=</span> <span class="n">parts</span><span class="o">;</span>
  <span class="o">}</span>
  <span class="nd">@Override</span>
  <span class="kd">public</span> <span class="n">Iterable</span><span class="o">&lt;</span><span class="n">File</span><span class="o">&gt;</span> <span class="nf">files</span><span class="o">()</span> <span class="o">{</span>
    <span class="kd">final</span> <span class="n">Folder</span> <span class="n">folder</span> <span class="o">=</span> <span class="k">new</span> <span class="n">DiscFolder</span><span class="o">(</span><span class="k">this</span><span class="o">.</span><span class="na">dir</span><span class="o">);</span>
    <span class="k">for</span> <span class="o">(</span><span class="kd">final</span> <span class="n">String</span> <span class="n">part</span> <span class="o">:</span> <span class="k">this</span><span class="o">.</span><span class="na">parts</span><span class="o">)</span> <span class="o">{</span>
      <span class="kd">final</span> <span class="n">String</span><span class="o">[]</span> <span class="n">pair</span> <span class="o">=</span> <span class="n">part</span><span class="o">.</span><span class="na">split</span><span class="o">(</span><span class="s">&quot;:&quot;</span><span class="o">,</span> <span class="mi">2</span><span class="o">);</span>
      <span class="n">folder</span><span class="o">.</span><span class="na">save</span><span class="o">(</span><span class="n">pair</span><span class="o">[</span><span class="mi">0</span><span class="o">],</span> <span class="n">pair</span><span class="o">[</span><span class="mi">1</span><span class="o">]);</span>
    <span class="o">}</span>
    <span class="k">return</span> <span class="n">folder</span><span class="o">.</span><span class="na">files</span><span class="o">();</span>
  <span class="o">}</span>
  <span class="nd">@Override</span>
  <span class="kd">public</span> <span class="kt">void</span> <span class="nf">close</span><span class="o">()</span> <span class="o">{</span>
    <span class="n">FileUtils</span><span class="o">.</span><span class="na">deleteDirectory</span><span class="o">(</span><span class="k">this</span><span class="o">.</span><span class="na">dir</span><span class="o">);</span>
  <span class="o">}</span>
<span class="o">}</span></code></pre></figure><p>Here is how our test will look now:</p><figure class="highlight"><pre><code class="language-java" data-lang="java"><span></span><span class="kd">public</span> <span class="kd">final</span> <span class="kd">class</span> <span class="nc">MetricsTest</span> <span class="o">{</span>
  <span class="nd">@Test</span>
  <span class="kd">public</span> <span class="kt">void</span> <span class="nf">calculatesTotalSize</span><span class="o">()</span> <span class="o">{</span>
    <span class="kd">final</span> <span class="n">String</span><span class="o">[]</span> <span class="n">parts</span> <span class="o">=</span> <span class="o">{</span>
      <span class="s">&quot;first.txt:Hello, world!&quot;</span><span class="o">,</span>
      <span class="s">&quot;second.txt:Goodbye!&quot;</span>
    <span class="o">};</span>
    <span class="k">try</span> <span class="o">(</span><span class="kd">final</span> <span class="n">Folder</span> <span class="n">folder</span> <span class="o">=</span> <span class="k">new</span> <span class="n">FkFolder</span><span class="o">(</span><span class="n">parts</span><span class="o">))</span> <span class="o">{</span>
      <span class="n">assertEquals</span><span class="o">(</span><span class="mi">22</span><span class="o">,</span> <span class="k">new</span> <span class="n">Metrics</span><span class="o">(</span><span class="n">folder</span><span class="o">).</span><span class="na">size</span><span class="o">());</span>
    <span class="o">}</span>
  <span class="o">}</span>
  <span class="nd">@Test</span>
  <span class="kd">public</span> <span class="kt">void</span> <span class="nf">countsWordsInFiles</span><span class="o">()</span> <span class="o">{</span>
    <span class="kd">final</span> <span class="n">String</span><span class="o">[]</span> <span class="n">parts</span> <span class="o">=</span> <span class="o">{</span>
      <span class="s">&quot;alpha.txt:Three words here&quot;</span><span class="o">,</span>
      <span class="s">&quot;beta.txt:two words&quot;</span>
      <span class="s">&quot;gamma.txt:one!&quot;</span>
    <span class="o">};</span>
    <span class="k">try</span> <span class="o">(</span><span class="kd">final</span> <span class="n">Folder</span> <span class="n">folder</span> <span class="o">=</span> <span class="k">new</span> <span class="n">FkFolder</span><span class="o">(</span><span class="n">parts</span><span class="o">))</span> <span class="o">{</span>
      <span class="n">assertEquals</span><span class="o">(</span><span class="mi">6</span><span class="o">,</span> <span class="k">new</span> <span class="n">Metrics</span><span class="o">(</span><span class="n">folder</span><span class="o">).</span><span class="na">wc</span><span class="o">());</span>
    <span class="o">}</span>
  <span class="o">}</span>
<span class="o">}</span></code></pre></figure><p>What do you think? Isn&#39;t it better than what JUnit offers? Isn&#39;t it more reusable and extensible than utility methods?</p><p>To summarize, I believe scaffolding in unit testing must be done through <a href="/2014/09/23/built-in-fake-objects.html">fake objects</a> that are shipped together with production code.</p></p>--> <nav class="buttons notranslate desktop-only"> <a href="http://www.facebook.com/sharer/sharer.php?u=https://www.yegor256.com/2015/05/25/unit-test-scaffolding.html" title="Share on Facebook" class="button" rel="nofollow"> <span class="count count-facebook">0</span> <i class="icon icon-facebook notranslate" aria-hidden="true"></i> </a> <a href="https://twitter.com/share?url=https://www.yegor256.com/2015/05/25/unit-test-scaffolding.html&amp;text=A+Few+Thoughts+on+Unit+Test+Scaffolding" title="Share on Twitter" class="button" rel="nofollow"> <span class="count count-twitter">0</span> <i class="icon icon-twitter notranslate" aria-hidden="true"></i> </a> <a href="https://plus.google.com/share?url=https://www.yegor256.com/2015/05/25/unit-test-scaffolding.html" title="Share on Google+" class="button" rel="nofollow"> <span class="count count-googleplus">0</span> <i class="icon icon-googleplus notranslate" aria-hidden="true"></i> </a> <a href="https://www.linkedin.com/cws/share?url=https://www.yegor256.com/2015/05/25/unit-test-scaffolding.html" title="Share on LinkedIn" class="button" rel="nofollow"> <span class="count count-linkedin">0</span> <i class="icon icon-linkedin notranslate" aria-hidden="true"></i> </a> <a href="http://reddit.com/submit?url=https://www.yegor256.com/2015/05/25/unit-test-scaffolding.html%3F2015-21&amp;title=A+Few+Thoughts+on+Unit+Test+Scaffolding" title="Share on Reddit" class="button" rel="nofollow"> <span class="count count-reddit">0</span> <i class="icon icon-reddit notranslate" aria-hidden="true"></i> </a> <a href="http://news.ycombinator.com/submitlink?u=https://www.yegor256.com/2015/05/25/unit-test-scaffolding.html%3F2015-21&amp;t=A+Few+Thoughts+on+Unit+Test+Scaffolding" title="Share on Hacker News" class="button" rel="nofollow"> <span class="count count-hackernews">0</span> <i class="icon icon-hackernews notranslate" aria-hidden="true"></i> </a> </nav> </header> <article class="main" itemprop="articleBody"><div ><p>When I start to repeat myself in unit test methods by creating the same objects and preparing the data to run the test, I feel disappointed in my design. Long test methods with a lot of code duplication just don&#39;t look right. To simplify and shorten them, there are basically two options, at least in Java: 1) private properties initialized through <code>@Before</code> and <code>@BeforeClass</code>, and 2) <a href="/2017/02/07/private-method-is-new-class.html">private static methods</a>. They both look anti-OOP to me, and I think there is an alternative. Let me explain.</p><figure class='jb_picture'><img itemprop='image' alt='Léon: The Professional by Luc Besson' src='/images/2015/05/leon-the-professional.jpg' longdesc='#6f716aac'/><figcaption id='6f716aac'>Léon: The Professional by Luc Besson</figcaption></figure><p>JUnit officially suggests a <a href="http://junit.org/faq.html#atests_2">test fixture</a>:</p><figure class="highlight"><pre><code class="language-java" data-lang="java"><span></span><span class="kd">public</span> <span class="kd">final</span> <span class="kd">class</span> <span class="nc">MetricsTest</span> <span class="o">{</span>
  <span class="kd">private</span> <span class="n">File</span> <span class="n">temp</span><span class="o">;</span>
  <span class="kd">private</span> <span class="n">Folder</span> <span class="n">folder</span><span class="o">;</span>
  <span class="nd">@Before</span>
  <span class="kd">public</span> <span class="kt">void</span> <span class="nf">prepare</span><span class="o">()</span> <span class="o">{</span>
    <span class="k">this</span><span class="o">.</span><span class="na">temp</span> <span class="o">=</span> <span class="n">Files</span><span class="o">.</span><span class="na">createTempDirectory</span><span class="o">(</span><span class="s">&quot;test&quot;</span><span class="o">);</span>
    <span class="k">this</span><span class="o">.</span><span class="na">folder</span> <span class="o">=</span> <span class="k">new</span> <span class="n">DiscFolder</span><span class="o">(</span><span class="k">this</span><span class="o">.</span><span class="na">temp</span><span class="o">);</span>
    <span class="k">this</span><span class="o">.</span><span class="na">folder</span><span class="o">.</span><span class="na">save</span><span class="o">(</span><span class="s">&quot;first.txt&quot;</span><span class="o">,</span> <span class="s">&quot;Hello, world!&quot;</span><span class="o">);</span>
    <span class="k">this</span><span class="o">.</span><span class="na">folder</span><span class="o">.</span><span class="na">save</span><span class="o">(</span><span class="s">&quot;second.txt&quot;</span><span class="o">,</span> <span class="s">&quot;Goodbye!&quot;</span><span class="o">);</span>
  <span class="o">}</span>
  <span class="nd">@After</span>
  <span class="kd">public</span> <span class="kt">void</span> <span class="nf">clean</span><span class="o">()</span> <span class="o">{</span>
    <span class="n">FileUtils</span><span class="o">.</span><span class="na">deleteDirectory</span><span class="o">(</span><span class="k">this</span><span class="o">.</span><span class="na">temp</span><span class="o">);</span>
  <span class="o">}</span>
  <span class="nd">@Test</span>
  <span class="kd">public</span> <span class="kt">void</span> <span class="nf">calculatesTotalSize</span><span class="o">()</span> <span class="o">{</span>
    <span class="n">assertEquals</span><span class="o">(</span><span class="mi">22</span><span class="o">,</span> <span class="k">new</span> <span class="n">Metrics</span><span class="o">(</span><span class="k">this</span><span class="o">.</span><span class="na">folder</span><span class="o">).</span><span class="na">size</span><span class="o">());</span>
  <span class="o">}</span>
  <span class="nd">@Test</span>
  <span class="kd">public</span> <span class="kt">void</span> <span class="nf">countsWordsInFiles</span><span class="o">()</span> <span class="o">{</span>
    <span class="n">assertEquals</span><span class="o">(</span><span class="mi">4</span><span class="o">,</span> <span class="k">new</span> <span class="n">Metrics</span><span class="o">(</span><span class="k">this</span><span class="o">.</span><span class="na">folder</span><span class="o">).</span><span class="na">wc</span><span class="o">());</span>
  <span class="o">}</span>
<span class="o">}</span></code></pre></figure><p>I think it&#39;s obvious what this test is doing. First, in <code>prepare()</code>, it creates a &quot;test fixture&quot; of type <code>Folder</code>. That is used in all three tests as an argument for the <code>Metrics</code> constructor. The real class being tested here is <code>Metrics</code> while <code>this.folder</code> is something we need in order to test it.</p><aside class='youtube'> <a href='https://www.youtube.com/watch?v=l6MpCBzwDbg'><div class='box'> <img src='https://i.ytimg.com/vi/l6MpCBzwDbg/mqdefault.jpg' alt='YouTube video #l6MpCBzwDbg'/><div class='play'><i class='icon icon-play'></i></div></div></a><div>What Fake Objects Are For? (webinar #8); 4 November 2015.</div></aside><p>What&#39;s wrong with this test? There is one serious issue: <strong>coupling</strong> between test methods. Test methods (and all tests in general) must be perfectly isolated from each other. This means that changing one test must not affect any others. In this example, that is not the case. When I want to change the <code>countsWords()</code> test, I have to change the internals of <code>before()</code>, which will affect the other method in the test &quot;class.&quot;</p><p>With all due respect to JUnit, the idea of creating test fixtures in <code>@Before</code> and <code>@After</code> is wrong, mostly because it encourages developers to couple test methods.</p><p>Here is how we can improve our test and isolate test methods:</p><figure class="highlight"><pre><code class="language-java" data-lang="java"><span></span><span class="kd">public</span> <span class="kd">final</span> <span class="kd">class</span> <span class="nc">MetricsTest</span> <span class="o">{</span>
  <span class="nd">@Test</span>
  <span class="kd">public</span> <span class="kt">void</span> <span class="nf">calculatesTotalSize</span><span class="o">()</span> <span class="o">{</span>
    <span class="kd">final</span> <span class="n">File</span> <span class="n">dir</span> <span class="o">=</span> <span class="n">Files</span><span class="o">.</span><span class="na">createTempDirectory</span><span class="o">(</span><span class="s">&quot;test-1&quot;</span><span class="o">);</span>
    <span class="kd">final</span> <span class="n">Folder</span> <span class="n">folder</span> <span class="o">=</span> <span class="n">MetricsTest</span><span class="o">.</span><span class="na">folder</span><span class="o">(</span>
      <span class="n">dir</span><span class="o">,</span>
      <span class="s">&quot;first.txt:Hello, world!&quot;</span><span class="o">,</span>
      <span class="s">&quot;second.txt:Goodbye!&quot;</span>
    <span class="o">);</span>
    <span class="k">try</span> <span class="o">{</span>
      <span class="n">assertEquals</span><span class="o">(</span><span class="mi">22</span><span class="o">,</span> <span class="k">new</span> <span class="n">Metrics</span><span class="o">(</span><span class="n">folder</span><span class="o">).</span><span class="na">size</span><span class="o">());</span>
    <span class="o">}</span> <span class="k">finally</span> <span class="o">{</span>
      <span class="n">FileUtils</span><span class="o">.</span><span class="na">deleteDirectory</span><span class="o">(</span><span class="n">dir</span><span class="o">);</span>
    <span class="o">}</span>
  <span class="o">}</span>
  <span class="nd">@Test</span>
  <span class="kd">public</span> <span class="kt">void</span> <span class="nf">countsWordsInFiles</span><span class="o">()</span> <span class="o">{</span>
    <span class="kd">final</span> <span class="n">File</span> <span class="n">dir</span> <span class="o">=</span> <span class="n">Files</span><span class="o">.</span><span class="na">createTempDirectory</span><span class="o">(</span><span class="s">&quot;test-2&quot;</span><span class="o">);</span>
    <span class="kd">final</span> <span class="n">Folder</span> <span class="n">folder</span> <span class="o">=</span> <span class="n">MetricsTest</span><span class="o">.</span><span class="na">folder</span><span class="o">(</span>
      <span class="n">dir</span><span class="o">,</span>
      <span class="s">&quot;alpha.txt:Three words here&quot;</span><span class="o">,</span>
      <span class="s">&quot;beta.txt:two words&quot;</span>
      <span class="s">&quot;gamma.txt:one!&quot;</span>
    <span class="o">);</span>
    <span class="k">try</span> <span class="o">{</span>
      <span class="n">assertEquals</span><span class="o">(</span><span class="mi">6</span><span class="o">,</span> <span class="k">new</span> <span class="n">Metrics</span><span class="o">(</span><span class="n">folder</span><span class="o">).</span><span class="na">wc</span><span class="o">());</span>
    <span class="o">}</span> <span class="k">finally</span> <span class="o">{</span>
      <span class="n">FileUtils</span><span class="o">.</span><span class="na">deleteDirectory</span><span class="o">(</span><span class="n">dir</span><span class="o">);</span>
    <span class="o">}</span>
  <span class="o">}</span>
  <span class="kd">private</span> <span class="kd">static</span> <span class="n">Folder</span> <span class="nf">folder</span><span class="o">(</span><span class="n">File</span> <span class="n">dir</span><span class="o">,</span> <span class="n">String</span><span class="o">...</span> <span class="n">parts</span><span class="o">)</span> <span class="o">{</span>
    <span class="n">Folder</span> <span class="n">folder</span> <span class="o">=</span> <span class="k">new</span> <span class="n">DiscFolder</span><span class="o">(</span><span class="n">dir</span><span class="o">);</span>
    <span class="k">for</span> <span class="o">(</span><span class="kd">final</span> <span class="n">String</span> <span class="n">part</span> <span class="o">:</span> <span class="n">parts</span><span class="o">)</span> <span class="o">{</span>
      <span class="kd">final</span> <span class="n">String</span><span class="o">[]</span> <span class="n">pair</span> <span class="o">=</span> <span class="n">part</span><span class="o">.</span><span class="na">split</span><span class="o">(</span><span class="s">&quot;:&quot;</span><span class="o">,</span> <span class="mi">2</span><span class="o">);</span>
      <span class="k">this</span><span class="o">.</span><span class="na">folder</span><span class="o">.</span><span class="na">save</span><span class="o">(</span><span class="n">pair</span><span class="o">[</span><span class="mi">0</span><span class="o">],</span> <span class="n">pair</span><span class="o">[</span><span class="mi">1</span><span class="o">]);</span>
    <span class="o">}</span>
    <span class="k">return</span> <span class="n">folder</span><span class="o">;</span>
  <span class="o">}</span>
<span class="o">}</span></code></pre></figure><p>Does it look better now? We&#39;re not there yet, but now our test methods are perfectly isolated. If I want to change one of them, I&#39;m not going to affect the others because I pass all configuration parameters to a private static utility (!) method <code>folder()</code>.</p><p>A utility method, huh? Yes, <a href="/2014/05/05/oop-alternative-to-utility-classes.html">it smells</a>.</p><p>The main issue with this design, even though it is way better than the previous one, is that it doesn&#39;t prevent code duplication between test &quot;classes.&quot; If I need a similar test fixture of type <code>Folder</code> in another test case, I will have to move this static method there. Or even worse, I will have to create a utility class. Yes, there is <a href="/2015/02/20/utility-classes-vs-functional-programming.html">nothing worse</a> in object-oriented programming than utility classes.</p><p>A much better design would be to use &quot;<a href="/2014/09/23/built-in-fake-objects.html">fake</a>&quot; objects instead of private static utilities. Here is how. First, we create a fake class and place it into <code>src/main/java</code>. This class can be used in tests and also in production code, if necessary (<code>Fk</code> for &quot;fake&quot;):</p><figure class="highlight"><pre><code class="language-java" data-lang="java"><span></span><span class="kd">public</span> <span class="kd">final</span> <span class="kd">class</span> <span class="nc">FkFolder</span> <span class="kd">implements</span> <span class="n">Folder</span><span class="o">,</span> <span class="n">Closeable</span> <span class="o">{</span>
  <span class="kd">private</span> <span class="kd">final</span> <span class="n">File</span> <span class="n">dir</span><span class="o">;</span>
  <span class="kd">private</span> <span class="kd">final</span> <span class="n">String</span><span class="o">[]</span> <span class="n">parts</span><span class="o">;</span>
  <span class="kd">public</span> <span class="nf">FkFolder</span><span class="o">(</span><span class="n">String</span><span class="o">...</span> <span class="n">prts</span><span class="o">)</span> <span class="o">{</span>
    <span class="k">this</span><span class="o">(</span><span class="n">Files</span><span class="o">.</span><span class="na">createTempDirectory</span><span class="o">(</span><span class="s">&quot;test-1&quot;</span><span class="o">),</span> <span class="n">parts</span><span class="o">);</span>
  <span class="o">}</span>
  <span class="kd">public</span> <span class="nf">FkFolder</span><span class="o">(</span><span class="n">File</span> <span class="n">file</span><span class="o">,</span> <span class="n">String</span><span class="o">...</span> <span class="n">prts</span><span class="o">)</span> <span class="o">{</span>
    <span class="k">this</span><span class="o">.</span><span class="na">dir</span> <span class="o">=</span> <span class="n">file</span><span class="o">;</span>
    <span class="k">this</span><span class="o">.</span><span class="na">parts</span> <span class="o">=</span> <span class="n">parts</span><span class="o">;</span>
  <span class="o">}</span>
  <span class="nd">@Override</span>
  <span class="kd">public</span> <span class="n">Iterable</span><span class="o">&lt;</span><span class="n">File</span><span class="o">&gt;</span> <span class="nf">files</span><span class="o">()</span> <span class="o">{</span>
    <span class="kd">final</span> <span class="n">Folder</span> <span class="n">folder</span> <span class="o">=</span> <span class="k">new</span> <span class="n">DiscFolder</span><span class="o">(</span><span class="k">this</span><span class="o">.</span><span class="na">dir</span><span class="o">);</span>
    <span class="k">for</span> <span class="o">(</span><span class="kd">final</span> <span class="n">String</span> <span class="n">part</span> <span class="o">:</span> <span class="k">this</span><span class="o">.</span><span class="na">parts</span><span class="o">)</span> <span class="o">{</span>
      <span class="kd">final</span> <span class="n">String</span><span class="o">[]</span> <span class="n">pair</span> <span class="o">=</span> <span class="n">part</span><span class="o">.</span><span class="na">split</span><span class="o">(</span><span class="s">&quot;:&quot;</span><span class="o">,</span> <span class="mi">2</span><span class="o">);</span>
      <span class="n">folder</span><span class="o">.</span><span class="na">save</span><span class="o">(</span><span class="n">pair</span><span class="o">[</span><span class="mi">0</span><span class="o">],</span> <span class="n">pair</span><span class="o">[</span><span class="mi">1</span><span class="o">]);</span>
    <span class="o">}</span>
    <span class="k">return</span> <span class="n">folder</span><span class="o">.</span><span class="na">files</span><span class="o">();</span>
  <span class="o">}</span>
  <span class="nd">@Override</span>
  <span class="kd">public</span> <span class="kt">void</span> <span class="nf">close</span><span class="o">()</span> <span class="o">{</span>
    <span class="n">FileUtils</span><span class="o">.</span><span class="na">deleteDirectory</span><span class="o">(</span><span class="k">this</span><span class="o">.</span><span class="na">dir</span><span class="o">);</span>
  <span class="o">}</span>
<span class="o">}</span></code></pre></figure><p>Here is how our test will look now:</p><figure class="highlight"><pre><code class="language-java" data-lang="java"><span></span><span class="kd">public</span> <span class="kd">final</span> <span class="kd">class</span> <span class="nc">MetricsTest</span> <span class="o">{</span>
  <span class="nd">@Test</span>
  <span class="kd">public</span> <span class="kt">void</span> <span class="nf">calculatesTotalSize</span><span class="o">()</span> <span class="o">{</span>
    <span class="kd">final</span> <span class="n">String</span><span class="o">[]</span> <span class="n">parts</span> <span class="o">=</span> <span class="o">{</span>
      <span class="s">&quot;first.txt:Hello, world!&quot;</span><span class="o">,</span>
      <span class="s">&quot;second.txt:Goodbye!&quot;</span>
    <span class="o">};</span>
    <span class="k">try</span> <span class="o">(</span><span class="kd">final</span> <span class="n">Folder</span> <span class="n">folder</span> <span class="o">=</span> <span class="k">new</span> <span class="n">FkFolder</span><span class="o">(</span><span class="n">parts</span><span class="o">))</span> <span class="o">{</span>
      <span class="n">assertEquals</span><span class="o">(</span><span class="mi">22</span><span class="o">,</span> <span class="k">new</span> <span class="n">Metrics</span><span class="o">(</span><span class="n">folder</span><span class="o">).</span><span class="na">size</span><span class="o">());</span>
    <span class="o">}</span>
  <span class="o">}</span>
  <span class="nd">@Test</span>
  <span class="kd">public</span> <span class="kt">void</span> <span class="nf">countsWordsInFiles</span><span class="o">()</span> <span class="o">{</span>
    <span class="kd">final</span> <span class="n">String</span><span class="o">[]</span> <span class="n">parts</span> <span class="o">=</span> <span class="o">{</span>
      <span class="s">&quot;alpha.txt:Three words here&quot;</span><span class="o">,</span>
      <span class="s">&quot;beta.txt:two words&quot;</span>
      <span class="s">&quot;gamma.txt:one!&quot;</span>
    <span class="o">};</span>
    <span class="k">try</span> <span class="o">(</span><span class="kd">final</span> <span class="n">Folder</span> <span class="n">folder</span> <span class="o">=</span> <span class="k">new</span> <span class="n">FkFolder</span><span class="o">(</span><span class="n">parts</span><span class="o">))</span> <span class="o">{</span>
      <span class="n">assertEquals</span><span class="o">(</span><span class="mi">6</span><span class="o">,</span> <span class="k">new</span> <span class="n">Metrics</span><span class="o">(</span><span class="n">folder</span><span class="o">).</span><span class="na">wc</span><span class="o">());</span>
    <span class="o">}</span>
  <span class="o">}</span>
<span class="o">}</span></code></pre></figure><p>What do you think? Isn&#39;t it better than what JUnit offers? Isn&#39;t it more reusable and extensible than utility methods?</p><p>To summarize, I believe scaffolding in unit testing must be done through <a href="/2014/09/23/built-in-fake-objects.html">fake objects</a> that are shipped together with production code.</p></div></article></div><div class="wrapper"> <related-posts /></div><div class="disqus" role="complementary"><p class="disqus_hint"> Please, use <a href="https://help.disqus.com/commenting/what-html-tags-are-allowed-within-comments">syntax highlighting</a> in your comments, to make them more readable.</p><div id="disqus_thread" class="disqus-thread"> <a>&nbsp;</a></div><script> var disqus_config = function () { this.page.url = document.location.href.split('?')[0].split('#')[0].replace('https://', 'http://'); this.page.identifier = this.page.url; }; (function() { var d = document, s = d.createElement('script'); s.src = '//yegor256.disqus.com/embed.js'; s.setAttribute('data-timestamp', +new Date()); (d.head || d.body).appendChild(s); })(); </script> <noscript><div><p class="red"> JavaScript is disabled in your browser, that's why you can't see comments under this post.</p></div></noscript></div><div class="wrapper"> <footer class="footer"><p> &copy; <span itemscope="" itemprop="copyrightHolder" itemtype="http://schema.org/Person"> <span itemprop="name">Yegor Bugayenko</span> </span> 2014&ndash;<span itemprop="copyrightYear">2018</span></p></footer></div></section><div class="wrapper unprintable" style="text-align:center;margin-top:2em;"> <a href="http://www.sixnines.io/h/3ba1652f"> <img src="//www.sixnines.io/b/3ba1652f?style=flat" alt="sixnines availability badge"/> </a></div><script src="//code.jquery.com/jquery-1.9.0.min.js"></script> <script src="/js/all.js?4e047f6f42b"></script> <script>var disqus_shortname = 'yegor256';</script> <script id="dsq-count-scr" src="//yegor256.disqus.com/count.js" async="async"></script> <script> (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){ (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o), m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m) })(window,document,'script','//www.google-analytics.com/analytics.js','ga'); ga('create', 'UA-1963507-32', 'auto'); ga('send', 'pageview'); </script> <script> Cd=document;Cr="&"+Math.random();Cp="&s=1"; Cd.cookie="b=b";if(Cd.cookie)Cp+="&c=1"; Cp+="&t="+(new Date()).getTimezoneOffset(); if(self!=top)Cp+="&f=1"; </script> <script> if(navigator.javaEnabled())Cp+="&j=1"; </script> <script> if(typeof(screen)!='undefined')Cp+="&w="+screen.width+"&h="+ screen.height+"&d="+(screen.colorDepth?screen.colorDepth:screen.pixelDepth); </script> <script> Cd.write("<img src='//c.hit.ua/hit?i=95870&g=0&x=2"+Cp+Cr+ "&r="+escape(Cd.referrer)+"&u="+escape(window.location.href)+ "' border='0' wi"+"dth='1' he"+"ight='1'/>"); </script> <script type="application/ld+json"> { "@context": "http://schema.org", "@type": "Person", "name": "Yegor Bugayenko", "url": "http://www.yegor256.com", "sameAs": [ "https://www.facebook.com/yegor256", "https://instagram.com/yegor256", "https://www.linkedin.com/in/yegor256", "https://twitter.com/yegor256", "https://github.com/yegor256", "https://www.pinterest.com/yegor256/" ] } </script> </body> </html> <!DOCTYPE html> <html xmlns="http://www.w3.org/1999/xhtml" lang="en-US" xml:lang="en-US" itemscope="" itemtype="http://schema.org/WebSite"> <head> <meta charset="utf-8"/> <meta name="description" content="Cookie-based authentication is a simple and powerful mechanism to enable website user login in a RESTful and lightweight way; the Takes framework does it with a few composable decorators. " /> <meta name="keywords" content="cookie authentication best practices, cookie authentication security, cookie authentication web api, cookie based authentication, cookies for authentication" /> <meta name="viewport" content="width=device-width,minimum-scale=1,initial-scale=1"/> <meta name="google-site-verification" content="JEj_gQr2CPe2QKGw8XdMz0R7VboQIUbX3FlM-lwTq-8" /> <meta name="author" content="Yegor Bugayenko"> <meta name="article:published_time" content="2015-05-18 00:00:00 +0000"> <meta name="og:site_name" content="Yegor Bugayenko"/> <meta name="og:type" content="article" /> <meta name="og:locale" content="en_US" /> <meta name="twitter:account_id" content="4503599630178231" /> <meta name="twitter:creator" content="@yegor256"/> <meta name="twitter:site" content="@yegor256"/> <meta name="twitter:title" property="og:title" content="How Cookie-Based Authentication Works in the Takes Framework"/> <meta name="twitter:description" property="og:description" content="Cookie-based authentication is a simple and powerful mechanism to enable website user login in a RESTful and lightweight way; the Takes framework does it with a few composable decorators. "/> <meta name="twitter:url" property="og:url" content="https://www.yegor256.com/2015/05/18/cookie-based-authentication.html"/> <meta name="telegram:channel" content="AAAAAEJFMRzsRTRxM3ec6A"/> <link rel="search" type="application/opensearchdescription+xml" href="/opensearch.xml" title="yegor256" /> <link rel="shortcut icon" href="/favicon.ico?4e047f6f42b"/> <link rel="apple-touch-icon" href="/favicon.ico?4e047f6f42b"/> <link rel="alternate" type="application/rss+xml" title="RSS for yegor256.com" href="https://www.yegor256.com/rss.xml"/> <link rel="stylesheet" href="/css/layout.css?4e047f6f42b"/> <link rel="stylesheet" href="/css/icons.css?4e047f6f42b"/> <link rel="canonical" href="https://www.yegor256.com/2015/05/18/cookie-based-authentication.html" /> <link rel="amphtml" href="https://www.yegor256.com/2015/05/18/cookie-based-authentication.amp.html" /> <title>How Cookie-Based Authentication Works in the Takes Framework </title> </head> <body><div class="wrapper"> <aside class="header-toggle unprintable" id="header-toggle" title="Show the menu" onclick="$('#header').show();$('#header-toggle').hide();">&#9776;</aside> <header class="header" id="header"><div class="face"> <a href="/about-me.html#form" class="sub" title="Click to subscribe to my monthly newsletter"><span>Subscribe</span></a> <a href="/about-me.html" style="position:relative;"> <img src="/images/face-256x256.jpg" class="photo" alt="Yegor Bugayenko"/> </a></div><nav><ul class="menu social notranslate"> <li><a href="https://twitter.com/intent/follow?screen_name=yegor256" rel="nofollow" title="Follow me on Twitter"><i class="icon icon-twitter notranslate" aria-hidden="true"></i></a></li> <li><a href="/rss.xml" rel="nofollow" title="Subscribe to my RSS feed"><i class="icon icon-rss notranslate" aria-hidden="true"></i></a></li> <li><a itemprop="sameAs" href="https://github.com/yegor256" rel="nofollow" title="My GitHub profile"><i class="icon icon-github notranslate" aria-hidden="true"></i></a></li> <li><a itemprop="sameAs" href="http://stackoverflow.com/users/187141/yegor256" rel="nofollow" title="My StackOverflow profile"><i class="icon icon-stackoverflow notranslate" aria-hidden="true"></i></a></li> <li><a itemprop="sameAs" href="https://www.facebook.com/yegor256" rel="nofollow" title="Follow me on Facebook"><i class="icon icon-facebook notranslate" aria-hidden="true"></i></a></li> <li><a itemprop="sameAs" href="https://instagram.com/yegor256" rel="nofollow" title="Follow me on Instagram"><i class="icon icon-instagram notranslate" aria-hidden="true"></i></a></li> <li><a itemprop="sameAs" href="https://www.linkedin.com/in/yegor256" rel="nofollow" title="My LinkedIn profile"><i class="icon icon-linkedin notranslate" aria-hidden="true"></i></a></li> <li><a itemprop="sameAs" href="https://www.youtube.com/c/yegor256?sub_confirmation=1" rel="nofollow" title="My Youtube video channel"><i class="icon icon-youtube notranslate" aria-hidden="true"></i></a></li> <li><a itemprop="sameAs" href="https://www.pinterest.com/yegor256/" rel="nofollow" title="My Pinterest boards"><i class="icon icon-pinterest notranslate" aria-hidden="true"></i></a></li> <li><a itemprop="sameAs" href="https://angel.co/yegor256" rel="nofollow" title="My AngelList profile"><i class="icon icon-angellist notranslate" aria-hidden="true"></i></a></li> <li><a href="https://soundcloud.com/yegor256" rel="nofollow" title="My podcast"><i class="icon icon-podcast notranslate" aria-hidden="true"></i></a></li> <li><a href="https://itunes.apple.com/us/podcast/yegor256-podcast/id1150826721" rel="nofollow" title="My iTunes podcast"><i class="icon icon-itunes notranslate" aria-hidden="true"></i></a></li> <li><a href="https://t.me/joinchat/AAAAAEJFMRzsRTRxM3ec6A" rel="nofollow" title="My Telegram public channel"><i class="icon icon-telegram notranslate" aria-hidden="true"></i></a></li> <li><a href="mailto:blog@yegor256.com" rel="nofollow" title="Email me any time"><i class="icon icon-mail notranslate" aria-hidden="true"></i></a></li></ul><ul class="menu"> <li><a href="/" title="Home page">Home</a></li> <li ><a href="/best.html" title="Best articles to read">12&#160;Best</a></li> <li ><a href="/contents.html" title="The contents of the entire blog">All&#160;288</a></li> <li ><a href="/webinars.html" title="My webinars">Webinars</a></li> <li ><a href="/talks.html" title="Future and past conference talks">Talks</a></li> <li ><a href="/books.html" title="The books I wrote">Books</a></li> <li ><a href="/papers.html" title="My academic papers and patents">Papers</a></li> <li ><a href="/pets.html" title="My loved pet projects">Pets</a></li> <li ><a href="/award.html" title="Software quality award">Award</a></li> <li ><a href="/testimonials.html" title="What some people say about me">Testimonials</a></li> <li ><a href="/shift-m.html" title="Audio podcast about project management">Shift-M</a></li> <li ><a href="/paintings.html" title="My paintings for sale">Paintings</a></li> <li><a href="http://ru.yegor256.com/" title="Немного на русском языке">По-русски</a></li></ul></nav><div class="search"> <form method="get" action="https://www.google.com/search" itemprop="potentialAction" itemscope="" itemtype="http://schema.org/SearchAction"> <meta itemprop="target" content="https://www.google.com/search?q={q}"/> <input name="sitesearch" value="yegor256.com" type="hidden"/> <input itemprop="query-input" type="text" id="search-query" class="field field-text" required="required" onfocus="$('.google').css('visibility', 'visible');" name="q" placeholder="Search..." autocomplete="off"/> <input type="image" src="/images/google-search-icon.svg" class="google" title="Search via Google" alt="Search via Google"/> </form></div><div class="hot"><ul> <li> <a href="/code-ahead.html">Code Ahead</a> was published on Amazon just a few days ago! It is my new book, a novel about programmers. It explains in details the majority of ideas that stand behind <a href="https://www.zerocracy.com">Zerocracy</a> and <a href="https://www.xdsd.org">XDSD</a>. </li> <li> At <a href="/webinars.html">Webinar #37</a> we will discuss naming problem in OOP, for objects, methods and attributes; join us on <b>September 12</b>, at 11am PST. </li></ul></div></header></div><section itemscope="" itemtype="http://schema.org/BlogPosting"><div class="wrapper"> <header><p class="printable"> <img src="https://api.qrserver.com/v1/create-qr-code/?data=https://www.yegor256.com/2015/05/18/cookie-based-authentication.html&amp;format=svg" style="width:125px;height:125px;" alt="QR code"/></p><p class="printable"> <code itemprop="url">https://www.yegor256.com/2015/05/18/cookie-based-authentication.html</code></p><h1 itemprop="name headline mainEntityOfPage">How Cookie-Based Authentication Works in the Takes Framework</h1><ul class="subline"> <li> <time itemprop="datePublished" datetime="2015-05-18T00:00:00+00:00"> 18 May 2015 </time> </li> <li class="printable" itemscope="" itemprop="author" itemtype="http://schema.org/Person"> <span itemprop="name">Yegor Bugayenko</span> </li> <li class="unprintable"> <i class="icon icon-comments"></i> <a href="http://www.yegor256.com/2015/05/18/cookie-based-authentication.html#disqus_thread" itemprop="discussionUrl">comments</a> </li></ul><p>First, let&#39;s see how it works. Moreover, let&#39;s see how I believe it should work.</p><p>Step one: The user enters an email and password and clicks &quot;submit.&quot; The server receives a POST request with this information inside:</p><figure class="highlight"><pre><code class="language-text" data-lang="text"><span></span>POST / HTTP/1.1
Host: www.facebook.com
Content-Type: application/x-www-form-urlencoded

email=me@yegor256.com&amp;password=itisasecret</code></pre></figure><p>The server matches the provided information with its records and decides what to do. If the information is invalid, it returns the same login page, asking you to enter it all again. If the information is valid, the server returns something like this:</p><figure class="highlight"><pre><code class="language-text" data-lang="text"><span></span>HTTP/1.1 303 See Other
Location: www.facebook.com
Set-Cookie: user=me@yegor256.com</code></pre></figure><p>Since the response status code is 303, the browser goes to the page specified in the <code>Location</code> header and opens the front page of the site. This is what it sends to the server:</p><figure class="highlight"><pre><code class="language-text" data-lang="text"><span></span>GET / HTTP/1.1
Host: www.facebook.com
Cookie: user=me@yegor256.com</code></pre></figure><p>The server gets my email from the <code>Cookie</code> header and understands that it&#39;s me again! No need to ask for the password once more. The server trusts the information from the cookie. That&#39;s it. That&#39;s what cookie-based authentication is all about.</p><h2 id="wait-what-about-security">Wait ... What About Security?</h2><p>Right, what about security? If the server trusts any browser request with a user email in the <code>Cookie</code> header, anyone would be able to send my email from another place and get access to my account.</p><p>The first step to prevent this is to encrypt the email with a secret encryption key, known only to the server. Nobody except the server itself will be able to encrypt it the same way the server needs to decrypt it. The response would look like this, using an example of encryption by <a href="https://en.wikipedia.org/wiki/XOR_cipher">XOR cipher</a> with <code>bamboo</code> as a secret key:</p><figure class="highlight"><pre><code class="language-text" data-lang="text"><span></span>HTTP/1.1 303 See Other
Location: www.facebook.com
Set-Cookie: user=b1ccafd92c568515100f5c4d104671003cfa39</code></pre></figure><p>This is not the best encryption mechanism, though; for proper encryption, it&#39;s better to use something stronger like <a href="https://en.wikipedia.org/wiki/Data_Encryption_Standard">DES</a>.</p><p>This all sounds good, but what if someone hijacks the traffic between the server and the browser and gets a hold of a properly encrypted email cookie? In this case, the thief would be able to use the same cookie for authentication even without knowing its content. The server would trust the information and let the person into my account. This type of attack is called <a href="http://en.wikipedia.org/wiki/Man-in-the-middle_attack">man-in-the-middle</a> (MITM). To prevent this from happening, we should use HTTPS and inform the browser that the cookie is sensitive and should never be returned to the server without SSL encryption. That&#39;s done by an extra flag in the <code>Set-Cookie</code> header:</p><figure class="highlight"><pre><code class="language-text" data-lang="text"><span></span>HTTP/1.1 303 See Other
Location: www.facebook.com
Set-Cookie: user=me@yegor256.com; Secure</code></pre></figure><p>There is yet another type of attack associated with cookie-based authentication, based on a browser&#39;s ability to expose all cookies associated with a web page to JavaScript executed inside it. An attacker may inject some malicious JavaScript code into the page (Don&#39;t ask me how ... this will happen only if your entire HTML rendering is done wrong), and this code will gain access to the cookie. Then, the code will send the cookie somewhere else so the attacker can collect it. This type of attack is called <a href="http://en.wikipedia.org/wiki/Cross-site_scripting">cross-site scripting</a> (XSS). To prevent this, there is another flag for the <code>Set-Cookie</code> header, called <code>HttpOnly</code>:</p><figure class="highlight"><pre><code class="language-text" data-lang="text"><span></span>HTTP/1.1 303 See Other
Location: www.facebook.com
Set-Cookie: user=me@yegor256.com; Secure; HttpOnly</code></pre></figure><p>The presence of this flag will tell the browser that this particular cookie can be transferred back to the server only through HTTP requests. JavaScript won&#39;t have access to it.</p><h2 id="how-its-done-in-takes">How It&#39;s Done in Takes</h2><p>Here is how this cookie-based authentication mechanism is designed in the <a href="http://www.takes.org">Takes</a> framework. The entire framework consists of <em>takes</em>, which receive requests and produce responses (<a href="/2015/03/22/takes-java-web-framework.html">this article</a> explains the framework in more detail). When the request comes in, we should find the authentication cookie in the <code>Cookie</code> header and translate it to the user credentials. When the response goes out, we should add the <code>Set-Cookie</code> header to it with the encrypted user credentials. That&#39;s it. Just these two steps.</p><p>Let&#39;s say we have an account page that is supposed to show the current user&#39;s balance:</p><figure class="highlight"><pre><code class="language-java" data-lang="java"><span></span><span class="kd">final</span> <span class="kd">class</span> <span class="nc">TkAccount</span> <span class="kd">implements</span> <span class="n">Take</span> <span class="o">{</span>
  <span class="kd">private</span> <span class="kd">final</span> <span class="n">Balances</span> <span class="n">balances</span><span class="o">;</span>
  <span class="nd">@Override</span>
  <span class="kd">public</span> <span class="n">Response</span> <span class="nf">act</span><span class="o">(</span><span class="kd">final</span> <span class="n">Request</span> <span class="n">request</span><span class="o">)</span> <span class="o">{</span>
    <span class="kd">final</span> <span class="n">Identity</span> <span class="n">user</span> <span class="o">=</span> <span class="c1">// get it from request</span>
    <span class="k">return</span> <span class="n">RsHTML</span><span class="o">(</span>
      <span class="n">String</span><span class="o">.</span><span class="na">format</span><span class="o">(</span>
        <span class="s">&quot;&lt;html&gt;Your balance is %s&lt;/html&gt;&quot;</span><span class="o">,</span>
        <span class="k">this</span><span class="o">.</span><span class="na">balances</span><span class="o">.</span><span class="na">retrieve</span><span class="o">(</span><span class="n">user</span><span class="o">)</span>
      <span class="o">)</span>
    <span class="o">);</span>
  <span class="o">}</span>
<span class="o">}</span></code></pre></figure><p>Right after the <code>request</code> comes in, we should retrieve the identity of the user, encoded inside an authenticating cookie. To make this mechanism reusable, we have the <a href="http://static.javadoc.io/org.takes/takes/1.1/org/takes/facets/auth/TkAuth.html"><code>TkAuth</code></a> decorator, which wraps an existing <em>take</em>, decodes an incoming cookie, and adds a new <code>TkAuth</code> header to the request with the user&#39;s identification information:</p><figure class="highlight"><pre><code class="language-java" data-lang="java"><span></span><span class="kd">final</span> <span class="n">Codec</span> <span class="n">codec</span> <span class="o">=</span> <span class="k">new</span> <span class="n">CcHex</span><span class="o">(</span><span class="k">new</span> <span class="n">CcXOR</span><span class="o">(</span><span class="k">new</span> <span class="n">CcPlain</span><span class="o">()));</span>
<span class="kd">final</span> <span class="n">Pass</span> <span class="n">pass</span> <span class="o">=</span> <span class="k">new</span> <span class="n">PsCookie</span><span class="o">(</span><span class="n">codec</span><span class="o">);</span>
<span class="k">new</span> <span class="n">TkAuth</span><span class="o">(</span><span class="k">new</span> <span class="n">TkAccount</span><span class="o">(),</span> <span class="n">pass</span><span class="o">);</span></code></pre></figure><p>Again, when <code>TkAuth</code> receives a request with an authenticating cookie inside, it asks <code>pass</code> to decode the cookie and return either a valid <a href="http://static.javadoc.io/org.takes/takes/1.1/org/takes/facets/auth/Identity.html"><code>Identity</code></a> or <code>Identity.ANONYMOUS</code>.</p><p>Then, when the response goes back to the browser, <code>TkAuth</code> asks <code>pass</code> to encode the identity back into a string and adds <code>Set-Cookie</code> to the response.</p><p><a href="http://static.javadoc.io/org.takes/takes/1.1/org/takes/facets/auth/PsCookie.html"><code>PsCookie</code></a> uses an instance of <a href="http://static.javadoc.io/org.takes/takes/1.1/org/takes/facets/auth/codecs/Codec.html"><code>Codec</code></a> in order to do these backward and forward encoding operations.</p><p>When our <code>TkAccount</code> <em>take</em> wants to retrieve a currently authenticated user identity from the request, it can use <a href="http://static.javadoc.io/org.takes/takes/1.1/org/takes/facets/auth/RqAuth.html"><code>RqAuth</code></a>, a utility decorator of <a href="http://static.javadoc.io/org.takes/takes/1.1/org/takes/Request.html"><code>Request</code></a>:</p><figure class="highlight"><pre><code class="language-java" data-lang="java"><span></span><span class="kd">final</span> <span class="kd">class</span> <span class="nc">TkAccount</span> <span class="kd">implements</span> <span class="n">Take</span> <span class="o">{</span>
  <span class="nd">@Override</span>
  <span class="kd">public</span> <span class="n">Response</span> <span class="nf">act</span><span class="o">(</span><span class="kd">final</span> <span class="n">Request</span> <span class="n">request</span><span class="o">)</span> <span class="o">{</span>
    <span class="kd">final</span> <span class="n">Identity</span> <span class="n">user</span> <span class="o">=</span> <span class="k">new</span> <span class="n">RqAuth</span><span class="o">(</span><span class="n">request</span><span class="o">).</span><span class="na">identity</span><span class="o">();</span>
    <span class="c1">// other manipulations with the user</span>
  <span class="o">}</span>
<span class="o">}</span></code></pre></figure><p>The <code>RqAuth</code> decorator uses the header, added by <code>PsCookie</code>, in order to authenticate the user and create an <code>Identity</code> object.</p><h2 id="how-is-it-composable">How Is It Composable?</h2><p>This mechanism is indeed very extensible and &quot;composable.&quot; Let&#39;s say we want to skip authentication during integration testing. Here is how:</p><figure class="highlight"><pre><code class="language-java" data-lang="java"><span></span><span class="k">new</span> <span class="n">TkAuth</span><span class="o">(</span>
  <span class="n">take</span><span class="o">,</span> <span class="c1">// original application &quot;take&quot;</span>
  <span class="k">new</span> <span class="n">PsChain</span><span class="o">(</span>
    <span class="k">new</span> <span class="n">PsFake</span><span class="o">(</span><span class="cm">/* if running integration tests */</span><span class="o">),</span>
    <span class="k">new</span> <span class="n">PsCookie</span><span class="o">(</span>
      <span class="k">new</span> <span class="n">CcHex</span><span class="o">(</span><span class="k">new</span> <span class="n">CcXOR</span><span class="o">(</span><span class="k">new</span> <span class="n">CcPlain</span><span class="o">()))</span>
    <span class="o">)</span>
  <span class="o">)</span>
<span class="o">);</span></code></pre></figure><p><a href="http://static.javadoc.io/org.takes/takes/1.1/org/takes/facets/auth/PsChain.html"><code>PsChain</code></a> implements <a href="http://static.javadoc.io/org.takes/takes/1.1/org/takes/facets/auth/Pass.html"><code>Pass</code></a> and attempts to authenticate the user by asking all encapsulated passes, one by one. The first one in the chain is <a href="http://static.javadoc.io/org.takes/takes/1.1/org/takes/facets/auth/PsFake.html"><code>PsFake</code></a>. Using a single boolean argument in its constructor, it makes a decision whether to return a fake identity or return nothing. With just a single boolean trigger, we can switch off the entire authentication mechanism in the app.</p><p>Let&#39;s say you want to authenticate users through Facebook OAuth. Here is how:</p><figure class="highlight"><pre><code class="language-java" data-lang="java"><span></span><span class="k">new</span> <span class="n">TkAuth</span><span class="o">(</span>
  <span class="n">take</span><span class="o">,</span> <span class="c1">// original application &quot;take&quot;</span>
  <span class="k">new</span> <span class="n">PsChain</span><span class="o">(</span>
    <span class="k">new</span> <span class="n">PsByFlag</span><span class="o">(</span>
      <span class="k">new</span> <span class="n">PsByFlag</span><span class="o">.</span><span class="na">Pair</span><span class="o">(</span>
        <span class="n">PsFacebook</span><span class="o">.</span><span class="na">class</span><span class="o">.</span><span class="na">getSimpleName</span><span class="o">(),</span>
        <span class="k">new</span> <span class="n">PsFacebook</span><span class="o">(</span>
          <span class="s">&quot;... Facebook API key ...&quot;</span><span class="o">,</span>
          <span class="s">&quot;... Facebook API secret ...&quot;</span>
        <span class="o">)</span>
      <span class="o">)</span>
    <span class="o">),</span>
    <span class="k">new</span> <span class="n">PsCookie</span><span class="o">(</span>
      <span class="k">new</span> <span class="n">CcHex</span><span class="o">(</span><span class="k">new</span> <span class="n">CcXOR</span><span class="o">(</span><span class="k">new</span> <span class="n">CcPlain</span><span class="o">()))</span>
    <span class="o">)</span>
  <span class="o">)</span>
<span class="o">);</span></code></pre></figure><p>When a user clicks on the login link on your site, the browser goes to <code>facebook.com</code>, where his or her identity is verified. Then, Facebook returns a <code>302</code> redirection response with a <code>Location</code> header set to the URL we provide in the login link. The link must include something like this: <code>?PsByFlag=PsFacebook</code>. This will tell <a href="http://static.javadoc.io/org.takes/takes/1.1/org/takes/facets/auth/PsByFlag.html"><code>PsByFlag</code></a> that this request authenticates a user.</p><p><code>PsByFlag</code> will iterate through all encapsulated &quot;pairs&quot; and try to find the right one. <a href="http://static.javadoc.io/org.takes/takes/1.1/org/takes/facets/auth/social/PsFacebook.html"><code>PsFacebook</code></a> will be the first and the right one. It will connect to the Facebook API using the provided credentials and will retrieve all possible information about the user.</p><p>Here is how we can implement a logout mechanism:</p><figure class="highlight"><pre><code class="language-java" data-lang="java"><span></span><span class="k">new</span> <span class="n">TkAuth</span><span class="o">(</span>
  <span class="n">take</span><span class="o">,</span> <span class="c1">// original application &quot;take&quot;</span>
  <span class="k">new</span> <span class="n">PsChain</span><span class="o">(</span>
    <span class="k">new</span> <span class="n">PsByFlag</span><span class="o">(</span>
      <span class="k">new</span> <span class="n">PsByFlag</span><span class="o">.</span><span class="na">Pair</span><span class="o">(</span>
        <span class="n">PsFacebook</span><span class="o">.</span><span class="na">class</span><span class="o">.</span><span class="na">getSimpleName</span><span class="o">(),</span>
        <span class="k">new</span> <span class="n">PsFacebook</span><span class="o">(</span>
          <span class="s">&quot;... Facebook API key ...&quot;</span><span class="o">,</span>
          <span class="s">&quot;... Facebook API secret ...&quot;</span>
        <span class="o">)</span>
      <span class="o">),</span>
      <span class="k">new</span> <span class="n">PsByFlag</span><span class="o">.</span><span class="na">Pair</span><span class="o">(</span>
        <span class="n">PsLogout</span><span class="o">.</span><span class="na">class</span><span class="o">.</span><span class="na">getSimpleName</span><span class="o">(),</span>
        <span class="k">new</span> <span class="n">PsLogout</span><span class="o">()</span>
      <span class="o">)</span>
    <span class="o">),</span>
    <span class="k">new</span> <span class="n">PsCookie</span><span class="o">(</span>
      <span class="k">new</span> <span class="n">CcHex</span><span class="o">(</span><span class="k">new</span> <span class="n">CcXOR</span><span class="o">(</span><span class="k">new</span> <span class="n">CcPlain</span><span class="o">()))</span>
    <span class="o">)</span>
  <span class="o">)</span>
<span class="o">);</span></code></pre></figure><p>Now, we can add <code>?PsByFlag=PsLogout</code> to any link on the site and it will log the current user out.</p><p>You can see how all this works in a real application by checking out the <a href="https://github.com/yegor256/rultor/blob/master/src/main/java/com/rultor/web/TkAppAuth.java"><code>TkAppAuth</code></a> class in <a href="http://www.rultor.com">Rultor</a>.</p></p>--> <nav class="buttons notranslate desktop-only"> <a href="http://www.facebook.com/sharer/sharer.php?u=https://www.yegor256.com/2015/05/18/cookie-based-authentication.html" title="Share on Facebook" class="button" rel="nofollow"> <span class="count count-facebook">0</span> <i class="icon icon-facebook notranslate" aria-hidden="true"></i> </a> <a href="https://twitter.com/share?url=https://www.yegor256.com/2015/05/18/cookie-based-authentication.html&amp;text=How+Cookie-Based+Authentication+Works+in+the+Takes+Framework" title="Share on Twitter" class="button" rel="nofollow"> <span class="count count-twitter">0</span> <i class="icon icon-twitter notranslate" aria-hidden="true"></i> </a> <a href="https://plus.google.com/share?url=https://www.yegor256.com/2015/05/18/cookie-based-authentication.html" title="Share on Google+" class="button" rel="nofollow"> <span class="count count-googleplus">0</span> <i class="icon icon-googleplus notranslate" aria-hidden="true"></i> </a> <a href="https://www.linkedin.com/cws/share?url=https://www.yegor256.com/2015/05/18/cookie-based-authentication.html" title="Share on LinkedIn" class="button" rel="nofollow"> <span class="count count-linkedin">0</span> <i class="icon icon-linkedin notranslate" aria-hidden="true"></i> </a> <a href="http://reddit.com/submit?url=https://www.yegor256.com/2015/05/18/cookie-based-authentication.html%3F2015-20&amp;title=How+Cookie-Based+Authentication+Works+in+the+Takes+Framework" title="Share on Reddit" class="button" rel="nofollow"> <span class="count count-reddit">0</span> <i class="icon icon-reddit notranslate" aria-hidden="true"></i> </a> <a href="http://news.ycombinator.com/submitlink?u=https://www.yegor256.com/2015/05/18/cookie-based-authentication.html%3F2015-20&amp;t=How+Cookie-Based+Authentication+Works+in+the+Takes+Framework" title="Share on Hacker News" class="button" rel="nofollow"> <span class="count count-hackernews">0</span> <i class="icon icon-hackernews notranslate" aria-hidden="true"></i> </a> </nav> </header> <article class="main" itemprop="articleBody"><div > <figure class='badge'><a href='http://www.takes.org'><img src='http://www.takes.org/logo.png' style='width:96px;max-width:100%;' alt='badge'/></a></figure><p>When you enter your email and password into the Facebook login page, you get into your account. Then, wherever you go in the site, you always see your photo at the top right corner of the page. Facebook remembers you and doesn&#39;t ask for the password again and again. This works thanks to <a href="https://en.wikipedia.org/wiki/HTTP_cookie">HTTP cookies</a> and is called <strong>cookie-based authentication</strong>. Even though this mechanism often causes some security problems, it is very popular and simple. Here is how <a href="http://www.takes.org">Takes</a> makes it possible in a few lines of code.</p><p>First, let&#39;s see how it works. Moreover, let&#39;s see how I believe it should work.</p><p>Step one: The user enters an email and password and clicks &quot;submit.&quot; The server receives a POST request with this information inside:</p><figure class="highlight"><pre><code class="language-text" data-lang="text"><span></span>POST / HTTP/1.1
Host: www.facebook.com
Content-Type: application/x-www-form-urlencoded

email=me@yegor256.com&amp;password=itisasecret</code></pre></figure><p>The server matches the provided information with its records and decides what to do. If the information is invalid, it returns the same login page, asking you to enter it all again. If the information is valid, the server returns something like this:</p><figure class="highlight"><pre><code class="language-text" data-lang="text"><span></span>HTTP/1.1 303 See Other
Location: www.facebook.com
Set-Cookie: user=me@yegor256.com</code></pre></figure><p>Since the response status code is 303, the browser goes to the page specified in the <code>Location</code> header and opens the front page of the site. This is what it sends to the server:</p><figure class="highlight"><pre><code class="language-text" data-lang="text"><span></span>GET / HTTP/1.1
Host: www.facebook.com
Cookie: user=me@yegor256.com</code></pre></figure><p>The server gets my email from the <code>Cookie</code> header and understands that it&#39;s me again! No need to ask for the password once more. The server trusts the information from the cookie. That&#39;s it. That&#39;s what cookie-based authentication is all about.</p><h2 id="wait-what-about-security">Wait ... What About Security?</h2><p>Right, what about security? If the server trusts any browser request with a user email in the <code>Cookie</code> header, anyone would be able to send my email from another place and get access to my account.</p><p>The first step to prevent this is to encrypt the email with a secret encryption key, known only to the server. Nobody except the server itself will be able to encrypt it the same way the server needs to decrypt it. The response would look like this, using an example of encryption by <a href="https://en.wikipedia.org/wiki/XOR_cipher">XOR cipher</a> with <code>bamboo</code> as a secret key:</p><figure class="highlight"><pre><code class="language-text" data-lang="text"><span></span>HTTP/1.1 303 See Other
Location: www.facebook.com
Set-Cookie: user=b1ccafd92c568515100f5c4d104671003cfa39</code></pre></figure><p>This is not the best encryption mechanism, though; for proper encryption, it&#39;s better to use something stronger like <a href="https://en.wikipedia.org/wiki/Data_Encryption_Standard">DES</a>.</p><p>This all sounds good, but what if someone hijacks the traffic between the server and the browser and gets a hold of a properly encrypted email cookie? In this case, the thief would be able to use the same cookie for authentication even without knowing its content. The server would trust the information and let the person into my account. This type of attack is called <a href="http://en.wikipedia.org/wiki/Man-in-the-middle_attack">man-in-the-middle</a> (MITM). To prevent this from happening, we should use HTTPS and inform the browser that the cookie is sensitive and should never be returned to the server without SSL encryption. That&#39;s done by an extra flag in the <code>Set-Cookie</code> header:</p><figure class="highlight"><pre><code class="language-text" data-lang="text"><span></span>HTTP/1.1 303 See Other
Location: www.facebook.com
Set-Cookie: user=me@yegor256.com; Secure</code></pre></figure><p>There is yet another type of attack associated with cookie-based authentication, based on a browser&#39;s ability to expose all cookies associated with a web page to JavaScript executed inside it. An attacker may inject some malicious JavaScript code into the page (Don&#39;t ask me how ... this will happen only if your entire HTML rendering is done wrong), and this code will gain access to the cookie. Then, the code will send the cookie somewhere else so the attacker can collect it. This type of attack is called <a href="http://en.wikipedia.org/wiki/Cross-site_scripting">cross-site scripting</a> (XSS). To prevent this, there is another flag for the <code>Set-Cookie</code> header, called <code>HttpOnly</code>:</p><figure class="highlight"><pre><code class="language-text" data-lang="text"><span></span>HTTP/1.1 303 See Other
Location: www.facebook.com
Set-Cookie: user=me@yegor256.com; Secure; HttpOnly</code></pre></figure><p>The presence of this flag will tell the browser that this particular cookie can be transferred back to the server only through HTTP requests. JavaScript won&#39;t have access to it.</p><h2 id="how-its-done-in-takes">How It&#39;s Done in Takes</h2><p>Here is how this cookie-based authentication mechanism is designed in the <a href="http://www.takes.org">Takes</a> framework. The entire framework consists of <em>takes</em>, which receive requests and produce responses (<a href="/2015/03/22/takes-java-web-framework.html">this article</a> explains the framework in more detail). When the request comes in, we should find the authentication cookie in the <code>Cookie</code> header and translate it to the user credentials. When the response goes out, we should add the <code>Set-Cookie</code> header to it with the encrypted user credentials. That&#39;s it. Just these two steps.</p><p>Let&#39;s say we have an account page that is supposed to show the current user&#39;s balance:</p><figure class="highlight"><pre><code class="language-java" data-lang="java"><span></span><span class="kd">final</span> <span class="kd">class</span> <span class="nc">TkAccount</span> <span class="kd">implements</span> <span class="n">Take</span> <span class="o">{</span>
  <span class="kd">private</span> <span class="kd">final</span> <span class="n">Balances</span> <span class="n">balances</span><span class="o">;</span>
  <span class="nd">@Override</span>
  <span class="kd">public</span> <span class="n">Response</span> <span class="nf">act</span><span class="o">(</span><span class="kd">final</span> <span class="n">Request</span> <span class="n">request</span><span class="o">)</span> <span class="o">{</span>
    <span class="kd">final</span> <span class="n">Identity</span> <span class="n">user</span> <span class="o">=</span> <span class="c1">// get it from request</span>
    <span class="k">return</span> <span class="n">RsHTML</span><span class="o">(</span>
      <span class="n">String</span><span class="o">.</span><span class="na">format</span><span class="o">(</span>
        <span class="s">&quot;&lt;html&gt;Your balance is %s&lt;/html&gt;&quot;</span><span class="o">,</span>
        <span class="k">this</span><span class="o">.</span><span class="na">balances</span><span class="o">.</span><span class="na">retrieve</span><span class="o">(</span><span class="n">user</span><span class="o">)</span>
      <span class="o">)</span>
    <span class="o">);</span>
  <span class="o">}</span>
<span class="o">}</span></code></pre></figure><p>Right after the <code>request</code> comes in, we should retrieve the identity of the user, encoded inside an authenticating cookie. To make this mechanism reusable, we have the <a href="http://static.javadoc.io/org.takes/takes/1.1/org/takes/facets/auth/TkAuth.html"><code>TkAuth</code></a> decorator, which wraps an existing <em>take</em>, decodes an incoming cookie, and adds a new <code>TkAuth</code> header to the request with the user&#39;s identification information:</p><figure class="highlight"><pre><code class="language-java" data-lang="java"><span></span><span class="kd">final</span> <span class="n">Codec</span> <span class="n">codec</span> <span class="o">=</span> <span class="k">new</span> <span class="n">CcHex</span><span class="o">(</span><span class="k">new</span> <span class="n">CcXOR</span><span class="o">(</span><span class="k">new</span> <span class="n">CcPlain</span><span class="o">()));</span>
<span class="kd">final</span> <span class="n">Pass</span> <span class="n">pass</span> <span class="o">=</span> <span class="k">new</span> <span class="n">PsCookie</span><span class="o">(</span><span class="n">codec</span><span class="o">);</span>
<span class="k">new</span> <span class="n">TkAuth</span><span class="o">(</span><span class="k">new</span> <span class="n">TkAccount</span><span class="o">(),</span> <span class="n">pass</span><span class="o">);</span></code></pre></figure><p>Again, when <code>TkAuth</code> receives a request with an authenticating cookie inside, it asks <code>pass</code> to decode the cookie and return either a valid <a href="http://static.javadoc.io/org.takes/takes/1.1/org/takes/facets/auth/Identity.html"><code>Identity</code></a> or <code>Identity.ANONYMOUS</code>.</p><p>Then, when the response goes back to the browser, <code>TkAuth</code> asks <code>pass</code> to encode the identity back into a string and adds <code>Set-Cookie</code> to the response.</p><p><a href="http://static.javadoc.io/org.takes/takes/1.1/org/takes/facets/auth/PsCookie.html"><code>PsCookie</code></a> uses an instance of <a href="http://static.javadoc.io/org.takes/takes/1.1/org/takes/facets/auth/codecs/Codec.html"><code>Codec</code></a> in order to do these backward and forward encoding operations.</p><p>When our <code>TkAccount</code> <em>take</em> wants to retrieve a currently authenticated user identity from the request, it can use <a href="http://static.javadoc.io/org.takes/takes/1.1/org/takes/facets/auth/RqAuth.html"><code>RqAuth</code></a>, a utility decorator of <a href="http://static.javadoc.io/org.takes/takes/1.1/org/takes/Request.html"><code>Request</code></a>:</p><figure class="highlight"><pre><code class="language-java" data-lang="java"><span></span><span class="kd">final</span> <span class="kd">class</span> <span class="nc">TkAccount</span> <span class="kd">implements</span> <span class="n">Take</span> <span class="o">{</span>
  <span class="nd">@Override</span>
  <span class="kd">public</span> <span class="n">Response</span> <span class="nf">act</span><span class="o">(</span><span class="kd">final</span> <span class="n">Request</span> <span class="n">request</span><span class="o">)</span> <span class="o">{</span>
    <span class="kd">final</span> <span class="n">Identity</span> <span class="n">user</span> <span class="o">=</span> <span class="k">new</span> <span class="n">RqAuth</span><span class="o">(</span><span class="n">request</span><span class="o">).</span><span class="na">identity</span><span class="o">();</span>
    <span class="c1">// other manipulations with the user</span>
  <span class="o">}</span>
<span class="o">}</span></code></pre></figure><p>The <code>RqAuth</code> decorator uses the header, added by <code>PsCookie</code>, in order to authenticate the user and create an <code>Identity</code> object.</p><h2 id="how-is-it-composable">How Is It Composable?</h2><p>This mechanism is indeed very extensible and &quot;composable.&quot; Let&#39;s say we want to skip authentication during integration testing. Here is how:</p><figure class="highlight"><pre><code class="language-java" data-lang="java"><span></span><span class="k">new</span> <span class="n">TkAuth</span><span class="o">(</span>
  <span class="n">take</span><span class="o">,</span> <span class="c1">// original application &quot;take&quot;</span>
  <span class="k">new</span> <span class="n">PsChain</span><span class="o">(</span>
    <span class="k">new</span> <span class="n">PsFake</span><span class="o">(</span><span class="cm">/* if running integration tests */</span><span class="o">),</span>
    <span class="k">new</span> <span class="n">PsCookie</span><span class="o">(</span>
      <span class="k">new</span> <span class="n">CcHex</span><span class="o">(</span><span class="k">new</span> <span class="n">CcXOR</span><span class="o">(</span><span class="k">new</span> <span class="n">CcPlain</span><span class="o">()))</span>
    <span class="o">)</span>
  <span class="o">)</span>
<span class="o">);</span></code></pre></figure><p><a href="http://static.javadoc.io/org.takes/takes/1.1/org/takes/facets/auth/PsChain.html"><code>PsChain</code></a> implements <a href="http://static.javadoc.io/org.takes/takes/1.1/org/takes/facets/auth/Pass.html"><code>Pass</code></a> and attempts to authenticate the user by asking all encapsulated passes, one by one. The first one in the chain is <a href="http://static.javadoc.io/org.takes/takes/1.1/org/takes/facets/auth/PsFake.html"><code>PsFake</code></a>. Using a single boolean argument in its constructor, it makes a decision whether to return a fake identity or return nothing. With just a single boolean trigger, we can switch off the entire authentication mechanism in the app.</p><p>Let&#39;s say you want to authenticate users through Facebook OAuth. Here is how:</p><figure class="highlight"><pre><code class="language-java" data-lang="java"><span></span><span class="k">new</span> <span class="n">TkAuth</span><span class="o">(</span>
  <span class="n">take</span><span class="o">,</span> <span class="c1">// original application &quot;take&quot;</span>
  <span class="k">new</span> <span class="n">PsChain</span><span class="o">(</span>
    <span class="k">new</span> <span class="n">PsByFlag</span><span class="o">(</span>
      <span class="k">new</span> <span class="n">PsByFlag</span><span class="o">.</span><span class="na">Pair</span><span class="o">(</span>
        <span class="n">PsFacebook</span><span class="o">.</span><span class="na">class</span><span class="o">.</span><span class="na">getSimpleName</span><span class="o">(),</span>
        <span class="k">new</span> <span class="n">PsFacebook</span><span class="o">(</span>
          <span class="s">&quot;... Facebook API key ...&quot;</span><span class="o">,</span>
          <span class="s">&quot;... Facebook API secret ...&quot;</span>
        <span class="o">)</span>
      <span class="o">)</span>
    <span class="o">),</span>
    <span class="k">new</span> <span class="n">PsCookie</span><span class="o">(</span>
      <span class="k">new</span> <span class="n">CcHex</span><span class="o">(</span><span class="k">new</span> <span class="n">CcXOR</span><span class="o">(</span><span class="k">new</span> <span class="n">CcPlain</span><span class="o">()))</span>
    <span class="o">)</span>
  <span class="o">)</span>
<span class="o">);</span></code></pre></figure><p>When a user clicks on the login link on your site, the browser goes to <code>facebook.com</code>, where his or her identity is verified. Then, Facebook returns a <code>302</code> redirection response with a <code>Location</code> header set to the URL we provide in the login link. The link must include something like this: <code>?PsByFlag=PsFacebook</code>. This will tell <a href="http://static.javadoc.io/org.takes/takes/1.1/org/takes/facets/auth/PsByFlag.html"><code>PsByFlag</code></a> that this request authenticates a user.</p><p><code>PsByFlag</code> will iterate through all encapsulated &quot;pairs&quot; and try to find the right one. <a href="http://static.javadoc.io/org.takes/takes/1.1/org/takes/facets/auth/social/PsFacebook.html"><code>PsFacebook</code></a> will be the first and the right one. It will connect to the Facebook API using the provided credentials and will retrieve all possible information about the user.</p><p>Here is how we can implement a logout mechanism:</p><figure class="highlight"><pre><code class="language-java" data-lang="java"><span></span><span class="k">new</span> <span class="n">TkAuth</span><span class="o">(</span>
  <span class="n">take</span><span class="o">,</span> <span class="c1">// original application &quot;take&quot;</span>
  <span class="k">new</span> <span class="n">PsChain</span><span class="o">(</span>
    <span class="k">new</span> <span class="n">PsByFlag</span><span class="o">(</span>
      <span class="k">new</span> <span class="n">PsByFlag</span><span class="o">.</span><span class="na">Pair</span><span class="o">(</span>
        <span class="n">PsFacebook</span><span class="o">.</span><span class="na">class</span><span class="o">.</span><span class="na">getSimpleName</span><span class="o">(),</span>
        <span class="k">new</span> <span class="n">PsFacebook</span><span class="o">(</span>
          <span class="s">&quot;... Facebook API key ...&quot;</span><span class="o">,</span>
          <span class="s">&quot;... Facebook API secret ...&quot;</span>
        <span class="o">)</span>
      <span class="o">),</span>
      <span class="k">new</span> <span class="n">PsByFlag</span><span class="o">.</span><span class="na">Pair</span><span class="o">(</span>
        <span class="n">PsLogout</span><span class="o">.</span><span class="na">class</span><span class="o">.</span><span class="na">getSimpleName</span><span class="o">(),</span>
        <span class="k">new</span> <span class="n">PsLogout</span><span class="o">()</span>
      <span class="o">)</span>
    <span class="o">),</span>
    <span class="k">new</span> <span class="n">PsCookie</span><span class="o">(</span>
      <span class="k">new</span> <span class="n">CcHex</span><span class="o">(</span><span class="k">new</span> <span class="n">CcXOR</span><span class="o">(</span><span class="k">new</span> <span class="n">CcPlain</span><span class="o">()))</span>
    <span class="o">)</span>
  <span class="o">)</span>
<span class="o">);</span></code></pre></figure><p>Now, we can add <code>?PsByFlag=PsLogout</code> to any link on the site and it will log the current user out.</p><p>You can see how all this works in a real application by checking out the <a href="https://github.com/yegor256/rultor/blob/master/src/main/java/com/rultor/web/TkAppAuth.java"><code>TkAppAuth</code></a> class in <a href="http://www.rultor.com">Rultor</a>.</p></div></article></div><div class="wrapper"> <related-posts /></div><div class="disqus" role="complementary"><p class="disqus_hint"> Please, use <a href="https://help.disqus.com/commenting/what-html-tags-are-allowed-within-comments">syntax highlighting</a> in your comments, to make them more readable.</p><div id="disqus_thread" class="disqus-thread"> <a>&nbsp;</a></div><script> var disqus_config = function () { this.page.url = document.location.href.split('?')[0].split('#')[0].replace('https://', 'http://'); this.page.identifier = this.page.url; }; (function() { var d = document, s = d.createElement('script'); s.src = '//yegor256.disqus.com/embed.js'; s.setAttribute('data-timestamp', +new Date()); (d.head || d.body).appendChild(s); })(); </script> <noscript><div><p class="red"> JavaScript is disabled in your browser, that's why you can't see comments under this post.</p></div></noscript></div><div class="wrapper"> <footer class="footer"><p> &copy; <span itemscope="" itemprop="copyrightHolder" itemtype="http://schema.org/Person"> <span itemprop="name">Yegor Bugayenko</span> </span> 2014&ndash;<span itemprop="copyrightYear">2018</span></p></footer></div></section><div class="wrapper unprintable" style="text-align:center;margin-top:2em;"> <a href="http://www.sixnines.io/h/3ba1652f"> <img src="//www.sixnines.io/b/3ba1652f?style=flat" alt="sixnines availability badge"/> </a></div><script src="//code.jquery.com/jquery-1.9.0.min.js"></script> <script src="/js/all.js?4e047f6f42b"></script> <script>var disqus_shortname = 'yegor256';</script> <script id="dsq-count-scr" src="//yegor256.disqus.com/count.js" async="async"></script> <script> (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){ (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o), m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m) })(window,document,'script','//www.google-analytics.com/analytics.js','ga'); ga('create', 'UA-1963507-32', 'auto'); ga('send', 'pageview'); </script> <script> Cd=document;Cr="&"+Math.random();Cp="&s=1"; Cd.cookie="b=b";if(Cd.cookie)Cp+="&c=1"; Cp+="&t="+(new Date()).getTimezoneOffset(); if(self!=top)Cp+="&f=1"; </script> <script> if(navigator.javaEnabled())Cp+="&j=1"; </script> <script> if(typeof(screen)!='undefined')Cp+="&w="+screen.width+"&h="+ screen.height+"&d="+(screen.colorDepth?screen.colorDepth:screen.pixelDepth); </script> <script> Cd.write("<img src='//c.hit.ua/hit?i=95870&g=0&x=2"+Cp+Cr+ "&r="+escape(Cd.referrer)+"&u="+escape(window.location.href)+ "' border='0' wi"+"dth='1' he"+"ight='1'/>"); </script> <script type="application/ld+json"> { "@context": "http://schema.org", "@type": "Person", "name": "Yegor Bugayenko", "url": "http://www.yegor256.com", "sameAs": [ "https://www.facebook.com/yegor256", "https://instagram.com/yegor256", "https://www.linkedin.com/in/yegor256", "https://twitter.com/yegor256", "https://github.com/yegor256", "https://www.pinterest.com/yegor256/" ] } </script> </body> </html> <!DOCTYPE html> <html xmlns="http://www.w3.org/1999/xhtml" lang="en-US" xml:lang="en-US" itemscope="" itemtype="http://schema.org/WebSite"> <head> <meta charset="utf-8"/> <meta name="description" content="It is a bad idea to put executing statements into class constructors because that leads to side effects and uncontrollable behavior. " /> <meta name="keywords" content="best practices java constructors, constructors in java, how much code in constructors, how much code to put into constructors, oop constructors best practices" /> <meta name="viewport" content="width=device-width,minimum-scale=1,initial-scale=1"/> <meta name="google-site-verification" content="JEj_gQr2CPe2QKGw8XdMz0R7VboQIUbX3FlM-lwTq-8" /> <meta name="author" content="Yegor Bugayenko"> <meta name="article:published_time" content="2015-05-07 00:00:00 +0000"> <meta name="og:site_name" content="Yegor Bugayenko"/> <meta name="og:type" content="article" /> <meta name="og:locale" content="en_US" /> <meta name="twitter:account_id" content="4503599630178231" /> <meta name="twitter:creator" content="@yegor256"/> <meta name="twitter:site" content="@yegor256"/> <meta name="twitter:title" property="og:title" content="Constructors Must Be Code-Free"/> <meta name="twitter:description" property="og:description" content="It is a bad idea to put executing statements into class constructors because that leads to side effects and uncontrollable behavior. "/> <meta name="twitter:url" property="og:url" content="https://www.yegor256.com/2015/05/07/ctors-must-be-code-free.html"/> <meta name="telegram:channel" content="AAAAAEJFMRzsRTRxM3ec6A"/> <link rel="search" type="application/opensearchdescription+xml" href="/opensearch.xml" title="yegor256" /> <link rel="shortcut icon" href="/favicon.ico?4e047f6f42b"/> <link rel="apple-touch-icon" href="/favicon.ico?4e047f6f42b"/> <link rel="alternate" type="application/rss+xml" title="RSS for yegor256.com" href="https://www.yegor256.com/rss.xml"/> <link rel="stylesheet" href="/css/layout.css?4e047f6f42b"/> <link rel="stylesheet" href="/css/icons.css?4e047f6f42b"/> <link rel="canonical" href="https://www.yegor256.com/2015/05/07/ctors-must-be-code-free.html" /> <link rel="amphtml" href="https://www.yegor256.com/2015/05/07/ctors-must-be-code-free.amp.html" /> <title>Constructors Must Be Code-Free </title> <meta name='og:image' content='https://www.yegor256.com/images/2015/05/kill-bill.jpg'/><meta name='twitter:image' content='https://www.yegor256.com/images/2015/05/kill-bill.jpg'/><meta name='og:image:width' content='1694'/> <meta name='twitter:image:width' content='1694'/><meta name='og:image:height' content='718'/> <meta name='twitter:image:height' content='718'/><meta name='twitter:card' content='summary_large_image'/><meta name='twitter:image:alt' content='Kill Bill: Vol. 2 (2004) by Quentin Tarantino'/> </head> <body><div class="wrapper"> <aside class="header-toggle unprintable" id="header-toggle" title="Show the menu" onclick="$('#header').show();$('#header-toggle').hide();">&#9776;</aside> <header class="header" id="header"><div class="face"> <a href="/about-me.html#form" class="sub" title="Click to subscribe to my monthly newsletter"><span>Subscribe</span></a> <a href="/about-me.html" style="position:relative;"> <img src="/images/face-256x256.jpg" class="photo" alt="Yegor Bugayenko"/> </a></div><nav><ul class="menu social notranslate"> <li><a href="https://twitter.com/intent/follow?screen_name=yegor256" rel="nofollow" title="Follow me on Twitter"><i class="icon icon-twitter notranslate" aria-hidden="true"></i></a></li> <li><a href="/rss.xml" rel="nofollow" title="Subscribe to my RSS feed"><i class="icon icon-rss notranslate" aria-hidden="true"></i></a></li> <li><a itemprop="sameAs" href="https://github.com/yegor256" rel="nofollow" title="My GitHub profile"><i class="icon icon-github notranslate" aria-hidden="true"></i></a></li> <li><a itemprop="sameAs" href="http://stackoverflow.com/users/187141/yegor256" rel="nofollow" title="My StackOverflow profile"><i class="icon icon-stackoverflow notranslate" aria-hidden="true"></i></a></li> <li><a itemprop="sameAs" href="https://www.facebook.com/yegor256" rel="nofollow" title="Follow me on Facebook"><i class="icon icon-facebook notranslate" aria-hidden="true"></i></a></li> <li><a itemprop="sameAs" href="https://instagram.com/yegor256" rel="nofollow" title="Follow me on Instagram"><i class="icon icon-instagram notranslate" aria-hidden="true"></i></a></li> <li><a itemprop="sameAs" href="https://www.linkedin.com/in/yegor256" rel="nofollow" title="My LinkedIn profile"><i class="icon icon-linkedin notranslate" aria-hidden="true"></i></a></li> <li><a itemprop="sameAs" href="https://www.youtube.com/c/yegor256?sub_confirmation=1" rel="nofollow" title="My Youtube video channel"><i class="icon icon-youtube notranslate" aria-hidden="true"></i></a></li> <li><a itemprop="sameAs" href="https://www.pinterest.com/yegor256/" rel="nofollow" title="My Pinterest boards"><i class="icon icon-pinterest notranslate" aria-hidden="true"></i></a></li> <li><a itemprop="sameAs" href="https://angel.co/yegor256" rel="nofollow" title="My AngelList profile"><i class="icon icon-angellist notranslate" aria-hidden="true"></i></a></li> <li><a href="https://soundcloud.com/yegor256" rel="nofollow" title="My podcast"><i class="icon icon-podcast notranslate" aria-hidden="true"></i></a></li> <li><a href="https://itunes.apple.com/us/podcast/yegor256-podcast/id1150826721" rel="nofollow" title="My iTunes podcast"><i class="icon icon-itunes notranslate" aria-hidden="true"></i></a></li> <li><a href="https://t.me/joinchat/AAAAAEJFMRzsRTRxM3ec6A" rel="nofollow" title="My Telegram public channel"><i class="icon icon-telegram notranslate" aria-hidden="true"></i></a></li> <li><a href="mailto:blog@yegor256.com" rel="nofollow" title="Email me any time"><i class="icon icon-mail notranslate" aria-hidden="true"></i></a></li></ul><ul class="menu"> <li><a href="/" title="Home page">Home</a></li> <li ><a href="/best.html" title="Best articles to read">12&#160;Best</a></li> <li ><a href="/contents.html" title="The contents of the entire blog">All&#160;288</a></li> <li ><a href="/webinars.html" title="My webinars">Webinars</a></li> <li ><a href="/talks.html" title="Future and past conference talks">Talks</a></li> <li ><a href="/books.html" title="The books I wrote">Books</a></li> <li ><a href="/papers.html" title="My academic papers and patents">Papers</a></li> <li ><a href="/pets.html" title="My loved pet projects">Pets</a></li> <li ><a href="/award.html" title="Software quality award">Award</a></li> <li ><a href="/testimonials.html" title="What some people say about me">Testimonials</a></li> <li ><a href="/shift-m.html" title="Audio podcast about project management">Shift-M</a></li> <li ><a href="/paintings.html" title="My paintings for sale">Paintings</a></li> <li><a href="http://ru.yegor256.com/" title="Немного на русском языке">По-русски</a></li></ul></nav><div class="search"> <form method="get" action="https://www.google.com/search" itemprop="potentialAction" itemscope="" itemtype="http://schema.org/SearchAction"> <meta itemprop="target" content="https://www.google.com/search?q={q}"/> <input name="sitesearch" value="yegor256.com" type="hidden"/> <input itemprop="query-input" type="text" id="search-query" class="field field-text" required="required" onfocus="$('.google').css('visibility', 'visible');" name="q" placeholder="Search..." autocomplete="off"/> <input type="image" src="/images/google-search-icon.svg" class="google" title="Search via Google" alt="Search via Google"/> </form></div><div class="hot"><ul> <li> <a href="/code-ahead.html">Code Ahead</a> was published on Amazon just a few days ago! It is my new book, a novel about programmers. It explains in details the majority of ideas that stand behind <a href="https://www.zerocracy.com">Zerocracy</a> and <a href="https://www.xdsd.org">XDSD</a>. </li> <li> At <a href="/webinars.html">Webinar #37</a> we will discuss naming problem in OOP, for objects, methods and attributes; join us on <b>September 12</b>, at 11am PST. </li></ul></div></header></div><section itemscope="" itemtype="http://schema.org/BlogPosting"><div class="wrapper"> <header><p class="printable"> <img src="https://api.qrserver.com/v1/create-qr-code/?data=https://www.yegor256.com/2015/05/07/ctors-must-be-code-free.html&amp;format=svg" style="width:125px;height:125px;" alt="QR code"/></p><p class="printable"> <code itemprop="url">https://www.yegor256.com/2015/05/07/ctors-must-be-code-free.html</code></p><h1 itemprop="name headline mainEntityOfPage">Constructors Must Be Code-Free</h1><aside class='book'><a href='http://amzn.to/2qFt4Tn'><img src='/images/books/elegant-objects/cover.png' class='book-cover' alt='book cover'/></a>Read more about this subject in <a href='http://amzn.to/2qFt4Tn'>Section&nbsp;1.3</a><br/> of my book<a href='http://amzn.to/2qFt4Tn'><img src='/images/books/amazon-buy-button.png' class='amazon-button' alt='Click to buy'/></a></aside><ul class="subline"> <li> <time itemprop="datePublished" datetime="2015-05-07T00:00:00+00:00"> 7 May 2015 </time> </li> <li class="printable" itemscope="" itemprop="author" itemtype="http://schema.org/Person"> <span itemprop="name">Yegor Bugayenko</span> </li> <li class="unprintable"> <i class="icon icon-comments"></i> <a href="http://www.yegor256.com/2015/05/07/ctors-must-be-code-free.html#disqus_thread" itemprop="discussionUrl">comments</a> </li></ul><figure class='jb_picture'><img itemprop='image' alt='Kill Bill: Vol. 2 (2004) by Quentin Tarantino' src='/images/2015/05/kill-bill.jpg' longdesc='#780fae47'/><figcaption id='780fae47'>Kill Bill: Vol. 2 (2004) by Quentin Tarantino</figcaption></figure><p>Let&#39;s say we&#39;re making an interface that would represent a name of a person:</p><figure class="highlight"><pre><code class="language-java" data-lang="java"><span></span><span class="kd">interface</span> <span class="nc">Name</span> <span class="o">{</span>
  <span class="n">String</span> <span class="nf">first</span><span class="o">();</span>
<span class="o">}</span></code></pre></figure><p>Pretty easy, right? Now, let&#39;s try to implement it:</p><figure class="highlight"><pre><code class="language-java" data-lang="java"><span></span><span class="kd">public</span> <span class="kd">final</span> <span class="kd">class</span> <span class="nc">EnglishName</span> <span class="kd">implements</span> <span class="n">Name</span> <span class="o">{</span>
  <span class="kd">private</span> <span class="kd">final</span> <span class="n">String</span> <span class="n">name</span><span class="o">;</span>
  <span class="kd">public</span> <span class="nf">EnglishName</span><span class="o">(</span><span class="kd">final</span> <span class="n">CharSequence</span> <span class="n">text</span><span class="o">)</span> <span class="o">{</span>
    <span class="k">this</span><span class="o">.</span><span class="na">name</span> <span class="o">=</span> <span class="n">text</span><span class="o">.</span><span class="na">toString</span><span class="o">().</span><span class="na">split</span><span class="o">(</span><span class="s">&quot; &quot;</span><span class="o">,</span> <span class="mi">2</span><span class="o">)[</span><span class="mi">0</span><span class="o">];</span>
  <span class="o">}</span>
  <span class="nd">@Override</span>
  <span class="kd">public</span> <span class="n">String</span> <span class="nf">first</span><span class="o">()</span> <span class="o">{</span>
    <span class="k">return</span> <span class="k">this</span><span class="o">.</span><span class="na">name</span><span class="o">;</span>
  <span class="o">}</span>
<span class="o">}</span></code></pre></figure><p>What&#39;s wrong with this? It&#39;s faster, right? It splits the name into parts only once and encapsulates them. Then, no matter how many times we call the <code>first()</code> method, it will return the same value and won&#39;t need to do the splitting again. However, this is flawed thinking! Let me show you the right way and explain:</p><figure class="highlight"><pre><code class="language-java" data-lang="java"><span></span><span class="kd">public</span> <span class="kd">final</span> <span class="kd">class</span> <span class="nc">EnglishName</span> <span class="kd">implements</span> <span class="n">Name</span> <span class="o">{</span>
  <span class="kd">private</span> <span class="kd">final</span> <span class="n">CharSequence</span> <span class="n">text</span><span class="o">;</span>
  <span class="kd">public</span> <span class="nf">EnglishName</span><span class="o">(</span><span class="kd">final</span> <span class="n">CharSequence</span> <span class="n">txt</span><span class="o">)</span> <span class="o">{</span>
    <span class="k">this</span><span class="o">.</span><span class="na">text</span> <span class="o">=</span> <span class="n">txt</span><span class="o">;</span>
  <span class="o">}</span>
  <span class="nd">@Override</span>
  <span class="kd">public</span> <span class="n">String</span> <span class="nf">first</span><span class="o">()</span> <span class="o">{</span>
    <span class="k">return</span> <span class="k">this</span><span class="o">.</span><span class="na">text</span><span class="o">.</span><span class="na">toString</span><span class="o">().</span><span class="na">split</span><span class="o">(</span><span class="s">&quot;&quot;</span><span class="o">,</span> <span class="mi">2</span><span class="o">)[</span><span class="mi">0</span><span class="o">];</span>
  <span class="o">}</span>
<span class="o">}</span></code></pre></figure><p>This is the right design. I can see you smiling, so let me prove my point.</p><p>Before I start proving, though, let me ask you to read this article: <a href="/2015/02/26/composable-decorators.html">Composable Decorators vs. Imperative Utility Methods</a>. It explains the difference between a static method and composable decorators. The first snippet above is very close to an imperative utility method, even though it looks like an object. The second example is a true object.</p><aside class='youtube'> <a href='https://www.youtube.com/watch?v=9yjtsCK6Wdk'><div class='box'> <img src='https://i.ytimg.com/vi/9yjtsCK6Wdk/mqdefault.jpg' alt='YouTube video #9yjtsCK6Wdk'/><div class='play'><i class='icon icon-play'></i></div></div></a><div>A Few Thoughts About Constructors in OOP (webinar #7); 7 October 2015.</div></aside><p>In the first example, we are abusing the <code>new</code> operator and turning it into a static method, which does all calculations for us <em>right here and now</em>. This is what <em>imperative</em> programming is about. In imperative programming, we do all calculations right now and return fully ready results. In declarative programming, we are instead trying to delay calculations for as long as possible.</p><p>Let&#39;s try to use our <code>EnglishName</code> class:</p><figure class="highlight"><pre><code class="language-java" data-lang="java"><span></span><span class="kd">final</span> <span class="n">Name</span> <span class="n">name</span> <span class="o">=</span> <span class="k">new</span> <span class="n">EnglishName</span><span class="o">(</span>
  <span class="k">new</span> <span class="n">NameInPostgreSQL</span><span class="o">(</span><span class="cm">/*...*/</span><span class="o">)</span>
<span class="o">);</span>
<span class="k">if</span> <span class="o">(</span><span class="cm">/* something goes wrong */</span><span class="o">)</span> <span class="o">{</span>
  <span class="k">throw</span> <span class="k">new</span> <span class="n">IllegalStateException</span><span class="o">(</span>
    <span class="n">String</span><span class="o">.</span><span class="na">format</span><span class="o">(</span>
      <span class="s">&quot;Hi, %s, we can&#39;t proceed with your application&quot;</span><span class="o">,</span>
      <span class="n">name</span><span class="o">.</span><span class="na">first</span><span class="o">()</span>
    <span class="o">)</span>
  <span class="o">);</span>
<span class="o">}</span></code></pre></figure><p>In the first line of this snippet, we are just making an instance of an object and labeling it <code>name</code>. We don&#39;t want to go to the database yet and fetch the full name from there, split it into parts, and encapsulate them inside <code>name</code>. We just want to create an instance of an object. Such a parsing behavior would be a side effect for us and, in this case, will slow down the application. As you see, we may only need <code>name.first()</code> if something goes wrong and we need to construct an exception object.</p><p>My point is that having <strong>any</strong> computations done inside a constructor is a bad practice and must be avoided because they are side effects and are not requested by the object owner.</p><p>What about performance during the re-use of <code>name</code>, you may ask. If we make an instance of <code>EnglishName</code> and then call <code>name.first()</code> five times, we&#39;ll end up with five calls to the <code>String.split()</code> method.</p><p>To solve that, we create another class, a <a href="/2015/02/26/composable-decorators.html">composable decorator</a>, which will help us solve this &quot;re-use&quot; problem:</p><figure class="highlight"><pre><code class="language-java" data-lang="java"><span></span><span class="kd">public</span> <span class="kd">final</span> <span class="kd">class</span> <span class="nc">CachedName</span> <span class="kd">implements</span> <span class="n">Name</span> <span class="o">{</span>
  <span class="kd">private</span> <span class="kd">final</span> <span class="n">Name</span> <span class="n">origin</span><span class="o">;</span>
  <span class="kd">public</span> <span class="nf">CachedName</span><span class="o">(</span><span class="kd">final</span> <span class="n">Name</span> <span class="n">name</span><span class="o">)</span> <span class="o">{</span>
    <span class="k">this</span><span class="o">.</span><span class="na">origin</span> <span class="o">=</span> <span class="n">name</span><span class="o">;</span>
  <span class="o">}</span>
  <span class="nd">@Override</span>
  <span class="nd">@Cacheable</span><span class="o">(</span><span class="n">forever</span> <span class="o">=</span> <span class="kc">true</span><span class="o">)</span>
  <span class="kd">public</span> <span class="n">String</span> <span class="nf">first</span><span class="o">()</span> <span class="o">{</span>
    <span class="k">return</span> <span class="k">this</span><span class="o">.</span><span class="na">origin</span><span class="o">.</span><span class="na">first</span><span class="o">();</span>
  <span class="o">}</span>
<span class="o">}</span></code></pre></figure><p>I&#39;m using the <a href="http://aspects.jcabi.com/annotation-cacheable.html"><code>Cacheable</code></a> annotation from <a href="http://aspects.jcabi.com/">jcabi-aspects</a>, but you can use any other caching tools available in Java (or other languages), like <a href="https://code.google.com/p/guava-libraries/wiki/CachesExplained">Guava Cache</a>:</p><figure class="highlight"><pre><code class="language-java" data-lang="java"><span></span><span class="kd">public</span> <span class="kd">final</span> <span class="kd">class</span> <span class="nc">CachedName</span> <span class="kd">implements</span> <span class="n">Name</span> <span class="o">{</span>
  <span class="kd">private</span> <span class="kd">final</span> <span class="n">Cache</span><span class="o">&lt;</span><span class="n">Long</span><span class="o">,</span> <span class="n">String</span><span class="o">&gt;</span> <span class="n">cache</span> <span class="o">=</span>
    <span class="n">CacheBuilder</span><span class="o">.</span><span class="na">newBuilder</span><span class="o">().</span><span class="na">build</span><span class="o">();</span>
  <span class="kd">private</span> <span class="kd">final</span> <span class="n">Name</span> <span class="n">origin</span><span class="o">;</span>
  <span class="kd">public</span> <span class="nf">CachedName</span><span class="o">(</span><span class="kd">final</span> <span class="n">Name</span> <span class="n">name</span><span class="o">)</span> <span class="o">{</span>
    <span class="k">this</span><span class="o">.</span><span class="na">origin</span> <span class="o">=</span> <span class="n">name</span><span class="o">;</span>
  <span class="o">}</span>
  <span class="nd">@Override</span>
  <span class="kd">public</span> <span class="n">String</span> <span class="nf">first</span><span class="o">()</span> <span class="o">{</span>
    <span class="k">return</span> <span class="k">this</span><span class="o">.</span><span class="na">cache</span><span class="o">.</span><span class="na">get</span><span class="o">(</span>
      <span class="mi">1L</span><span class="o">,</span>
      <span class="k">new</span> <span class="n">Callable</span><span class="o">&lt;</span><span class="n">String</span><span class="o">&gt;()</span> <span class="o">{</span>
        <span class="nd">@Override</span>
        <span class="kd">public</span> <span class="n">String</span> <span class="nf">call</span><span class="o">()</span> <span class="o">{</span>
          <span class="k">return</span> <span class="n">CachedName</span><span class="o">.</span><span class="na">this</span><span class="o">.</span><span class="na">origin</span><span class="o">.</span><span class="na">first</span><span class="o">();</span>
        <span class="o">}</span>
      <span class="o">}</span>
    <span class="o">);</span>
  <span class="o">}</span>
<span class="o">}</span></code></pre></figure><p>But please don&#39;t make <code>CachedName</code> mutable and lazily loaded---it&#39;s an anti-pattern, which I&#39;ve discussed before in <a href="/2014/06/09/objects-should-be-immutable.html">Objects Should Be Immutable</a>.</p><p>This is how our code will look now:</p><figure class="highlight"><pre><code class="language-java" data-lang="java"><span></span><span class="kd">final</span> <span class="n">Name</span> <span class="n">name</span> <span class="o">=</span> <span class="k">new</span> <span class="n">CachedName</span><span class="o">(</span>
  <span class="k">new</span> <span class="n">EnglishName</span><span class="o">(</span>
    <span class="k">new</span> <span class="n">NameInPostgreSQL</span><span class="o">(</span><span class="cm">/*...*/</span><span class="o">)</span>
  <span class="o">)</span>
<span class="o">);</span></code></pre></figure><p>It&#39;s a very primitive example, but I hope you get the idea.</p><p>In this design, we&#39;re basically splitting the object into two parts. The first one knows how to get the first name from the English name. The second one knows how to cache the results of this calculation in memory. And now it&#39;s my decision, as a user of these classes, how exactly to use them. I will decide whether I need caching or not. This is what object composition is all about.</p><p>Let me reiterate that the only allowed statement inside a constructor is an assignment. If you need to put something else there, start thinking about refactoring---your class definitely needs a redesign.</p></p>--> <nav class="buttons notranslate desktop-only"> <a href="http://www.facebook.com/sharer/sharer.php?u=https://www.yegor256.com/2015/05/07/ctors-must-be-code-free.html" title="Share on Facebook" class="button" rel="nofollow"> <span class="count count-facebook">0</span> <i class="icon icon-facebook notranslate" aria-hidden="true"></i> </a> <a href="https://twitter.com/share?url=https://www.yegor256.com/2015/05/07/ctors-must-be-code-free.html&amp;text=Constructors+Must+Be+Code-Free" title="Share on Twitter" class="button" rel="nofollow"> <span class="count count-twitter">0</span> <i class="icon icon-twitter notranslate" aria-hidden="true"></i> </a> <a href="https://plus.google.com/share?url=https://www.yegor256.com/2015/05/07/ctors-must-be-code-free.html" title="Share on Google+" class="button" rel="nofollow"> <span class="count count-googleplus">0</span> <i class="icon icon-googleplus notranslate" aria-hidden="true"></i> </a> <a href="https://www.linkedin.com/cws/share?url=https://www.yegor256.com/2015/05/07/ctors-must-be-code-free.html" title="Share on LinkedIn" class="button" rel="nofollow"> <span class="count count-linkedin">0</span> <i class="icon icon-linkedin notranslate" aria-hidden="true"></i> </a> <a href="http://reddit.com/submit?url=https://www.yegor256.com/2015/05/07/ctors-must-be-code-free.html%3F2015-18&amp;title=Constructors+Must+Be+Code-Free" title="Share on Reddit" class="button" rel="nofollow"> <span class="count count-reddit">0</span> <i class="icon icon-reddit notranslate" aria-hidden="true"></i> </a> <a href="http://news.ycombinator.com/submitlink?u=https://www.yegor256.com/2015/05/07/ctors-must-be-code-free.html%3F2015-18&amp;t=Constructors+Must+Be+Code-Free" title="Share on Hacker News" class="button" rel="nofollow"> <span class="count count-hackernews">0</span> <i class="icon icon-hackernews notranslate" aria-hidden="true"></i> </a> </nav> </header> <article class="main" itemprop="articleBody"><div ><p>How much work should be done within a constructor? It seems reasonable to do some computations inside a constructor and then encapsulate results. That way, when the results are required by object methods, we&#39;ll have them ready. Sounds like a good approach? No, it&#39;s not. It&#39;s a bad idea for one reason: It prevents composition of objects and makes them un-extensible.</p><figure class='jb_picture'><img itemprop='image' alt='Kill Bill: Vol. 2 (2004) by Quentin Tarantino' src='/images/2015/05/kill-bill.jpg' longdesc='#780fae47'/><figcaption id='780fae47'>Kill Bill: Vol. 2 (2004) by Quentin Tarantino</figcaption></figure><p>Let&#39;s say we&#39;re making an interface that would represent a name of a person:</p><figure class="highlight"><pre><code class="language-java" data-lang="java"><span></span><span class="kd">interface</span> <span class="nc">Name</span> <span class="o">{</span>
  <span class="n">String</span> <span class="nf">first</span><span class="o">();</span>
<span class="o">}</span></code></pre></figure><p>Pretty easy, right? Now, let&#39;s try to implement it:</p><figure class="highlight"><pre><code class="language-java" data-lang="java"><span></span><span class="kd">public</span> <span class="kd">final</span> <span class="kd">class</span> <span class="nc">EnglishName</span> <span class="kd">implements</span> <span class="n">Name</span> <span class="o">{</span>
  <span class="kd">private</span> <span class="kd">final</span> <span class="n">String</span> <span class="n">name</span><span class="o">;</span>
  <span class="kd">public</span> <span class="nf">EnglishName</span><span class="o">(</span><span class="kd">final</span> <span class="n">CharSequence</span> <span class="n">text</span><span class="o">)</span> <span class="o">{</span>
    <span class="k">this</span><span class="o">.</span><span class="na">name</span> <span class="o">=</span> <span class="n">text</span><span class="o">.</span><span class="na">toString</span><span class="o">().</span><span class="na">split</span><span class="o">(</span><span class="s">&quot; &quot;</span><span class="o">,</span> <span class="mi">2</span><span class="o">)[</span><span class="mi">0</span><span class="o">];</span>
  <span class="o">}</span>
  <span class="nd">@Override</span>
  <span class="kd">public</span> <span class="n">String</span> <span class="nf">first</span><span class="o">()</span> <span class="o">{</span>
    <span class="k">return</span> <span class="k">this</span><span class="o">.</span><span class="na">name</span><span class="o">;</span>
  <span class="o">}</span>
<span class="o">}</span></code></pre></figure><p>What&#39;s wrong with this? It&#39;s faster, right? It splits the name into parts only once and encapsulates them. Then, no matter how many times we call the <code>first()</code> method, it will return the same value and won&#39;t need to do the splitting again. However, this is flawed thinking! Let me show you the right way and explain:</p><figure class="highlight"><pre><code class="language-java" data-lang="java"><span></span><span class="kd">public</span> <span class="kd">final</span> <span class="kd">class</span> <span class="nc">EnglishName</span> <span class="kd">implements</span> <span class="n">Name</span> <span class="o">{</span>
  <span class="kd">private</span> <span class="kd">final</span> <span class="n">CharSequence</span> <span class="n">text</span><span class="o">;</span>
  <span class="kd">public</span> <span class="nf">EnglishName</span><span class="o">(</span><span class="kd">final</span> <span class="n">CharSequence</span> <span class="n">txt</span><span class="o">)</span> <span class="o">{</span>
    <span class="k">this</span><span class="o">.</span><span class="na">text</span> <span class="o">=</span> <span class="n">txt</span><span class="o">;</span>
  <span class="o">}</span>
  <span class="nd">@Override</span>
  <span class="kd">public</span> <span class="n">String</span> <span class="nf">first</span><span class="o">()</span> <span class="o">{</span>
    <span class="k">return</span> <span class="k">this</span><span class="o">.</span><span class="na">text</span><span class="o">.</span><span class="na">toString</span><span class="o">().</span><span class="na">split</span><span class="o">(</span><span class="s">&quot;&quot;</span><span class="o">,</span> <span class="mi">2</span><span class="o">)[</span><span class="mi">0</span><span class="o">];</span>
  <span class="o">}</span>
<span class="o">}</span></code></pre></figure><p>This is the right design. I can see you smiling, so let me prove my point.</p><p>Before I start proving, though, let me ask you to read this article: <a href="/2015/02/26/composable-decorators.html">Composable Decorators vs. Imperative Utility Methods</a>. It explains the difference between a static method and composable decorators. The first snippet above is very close to an imperative utility method, even though it looks like an object. The second example is a true object.</p><aside class='youtube'> <a href='https://www.youtube.com/watch?v=9yjtsCK6Wdk'><div class='box'> <img src='https://i.ytimg.com/vi/9yjtsCK6Wdk/mqdefault.jpg' alt='YouTube video #9yjtsCK6Wdk'/><div class='play'><i class='icon icon-play'></i></div></div></a><div>A Few Thoughts About Constructors in OOP (webinar #7); 7 October 2015.</div></aside><p>In the first example, we are abusing the <code>new</code> operator and turning it into a static method, which does all calculations for us <em>right here and now</em>. This is what <em>imperative</em> programming is about. In imperative programming, we do all calculations right now and return fully ready results. In declarative programming, we are instead trying to delay calculations for as long as possible.</p><p>Let&#39;s try to use our <code>EnglishName</code> class:</p><figure class="highlight"><pre><code class="language-java" data-lang="java"><span></span><span class="kd">final</span> <span class="n">Name</span> <span class="n">name</span> <span class="o">=</span> <span class="k">new</span> <span class="n">EnglishName</span><span class="o">(</span>
  <span class="k">new</span> <span class="n">NameInPostgreSQL</span><span class="o">(</span><span class="cm">/*...*/</span><span class="o">)</span>
<span class="o">);</span>
<span class="k">if</span> <span class="o">(</span><span class="cm">/* something goes wrong */</span><span class="o">)</span> <span class="o">{</span>
  <span class="k">throw</span> <span class="k">new</span> <span class="n">IllegalStateException</span><span class="o">(</span>
    <span class="n">String</span><span class="o">.</span><span class="na">format</span><span class="o">(</span>
      <span class="s">&quot;Hi, %s, we can&#39;t proceed with your application&quot;</span><span class="o">,</span>
      <span class="n">name</span><span class="o">.</span><span class="na">first</span><span class="o">()</span>
    <span class="o">)</span>
  <span class="o">);</span>
<span class="o">}</span></code></pre></figure><p>In the first line of this snippet, we are just making an instance of an object and labeling it <code>name</code>. We don&#39;t want to go to the database yet and fetch the full name from there, split it into parts, and encapsulate them inside <code>name</code>. We just want to create an instance of an object. Such a parsing behavior would be a side effect for us and, in this case, will slow down the application. As you see, we may only need <code>name.first()</code> if something goes wrong and we need to construct an exception object.</p><p>My point is that having <strong>any</strong> computations done inside a constructor is a bad practice and must be avoided because they are side effects and are not requested by the object owner.</p><p>What about performance during the re-use of <code>name</code>, you may ask. If we make an instance of <code>EnglishName</code> and then call <code>name.first()</code> five times, we&#39;ll end up with five calls to the <code>String.split()</code> method.</p><p>To solve that, we create another class, a <a href="/2015/02/26/composable-decorators.html">composable decorator</a>, which will help us solve this &quot;re-use&quot; problem:</p><figure class="highlight"><pre><code class="language-java" data-lang="java"><span></span><span class="kd">public</span> <span class="kd">final</span> <span class="kd">class</span> <span class="nc">CachedName</span> <span class="kd">implements</span> <span class="n">Name</span> <span class="o">{</span>
  <span class="kd">private</span> <span class="kd">final</span> <span class="n">Name</span> <span class="n">origin</span><span class="o">;</span>
  <span class="kd">public</span> <span class="nf">CachedName</span><span class="o">(</span><span class="kd">final</span> <span class="n">Name</span> <span class="n">name</span><span class="o">)</span> <span class="o">{</span>
    <span class="k">this</span><span class="o">.</span><span class="na">origin</span> <span class="o">=</span> <span class="n">name</span><span class="o">;</span>
  <span class="o">}</span>
  <span class="nd">@Override</span>
  <span class="nd">@Cacheable</span><span class="o">(</span><span class="n">forever</span> <span class="o">=</span> <span class="kc">true</span><span class="o">)</span>
  <span class="kd">public</span> <span class="n">String</span> <span class="nf">first</span><span class="o">()</span> <span class="o">{</span>
    <span class="k">return</span> <span class="k">this</span><span class="o">.</span><span class="na">origin</span><span class="o">.</span><span class="na">first</span><span class="o">();</span>
  <span class="o">}</span>
<span class="o">}</span></code></pre></figure><p>I&#39;m using the <a href="http://aspects.jcabi.com/annotation-cacheable.html"><code>Cacheable</code></a> annotation from <a href="http://aspects.jcabi.com/">jcabi-aspects</a>, but you can use any other caching tools available in Java (or other languages), like <a href="https://code.google.com/p/guava-libraries/wiki/CachesExplained">Guava Cache</a>:</p><figure class="highlight"><pre><code class="language-java" data-lang="java"><span></span><span class="kd">public</span> <span class="kd">final</span> <span class="kd">class</span> <span class="nc">CachedName</span> <span class="kd">implements</span> <span class="n">Name</span> <span class="o">{</span>
  <span class="kd">private</span> <span class="kd">final</span> <span class="n">Cache</span><span class="o">&lt;</span><span class="n">Long</span><span class="o">,</span> <span class="n">String</span><span class="o">&gt;</span> <span class="n">cache</span> <span class="o">=</span>
    <span class="n">CacheBuilder</span><span class="o">.</span><span class="na">newBuilder</span><span class="o">().</span><span class="na">build</span><span class="o">();</span>
  <span class="kd">private</span> <span class="kd">final</span> <span class="n">Name</span> <span class="n">origin</span><span class="o">;</span>
  <span class="kd">public</span> <span class="nf">CachedName</span><span class="o">(</span><span class="kd">final</span> <span class="n">Name</span> <span class="n">name</span><span class="o">)</span> <span class="o">{</span>
    <span class="k">this</span><span class="o">.</span><span class="na">origin</span> <span class="o">=</span> <span class="n">name</span><span class="o">;</span>
  <span class="o">}</span>
  <span class="nd">@Override</span>
  <span class="kd">public</span> <span class="n">String</span> <span class="nf">first</span><span class="o">()</span> <span class="o">{</span>
    <span class="k">return</span> <span class="k">this</span><span class="o">.</span><span class="na">cache</span><span class="o">.</span><span class="na">get</span><span class="o">(</span>
      <span class="mi">1L</span><span class="o">,</span>
      <span class="k">new</span> <span class="n">Callable</span><span class="o">&lt;</span><span class="n">String</span><span class="o">&gt;()</span> <span class="o">{</span>
        <span class="nd">@Override</span>
        <span class="kd">public</span> <span class="n">String</span> <span class="nf">call</span><span class="o">()</span> <span class="o">{</span>
          <span class="k">return</span> <span class="n">CachedName</span><span class="o">.</span><span class="na">this</span><span class="o">.</span><span class="na">origin</span><span class="o">.</span><span class="na">first</span><span class="o">();</span>
        <span class="o">}</span>
      <span class="o">}</span>
    <span class="o">);</span>
  <span class="o">}</span>
<span class="o">}</span></code></pre></figure><p>But please don&#39;t make <code>CachedName</code> mutable and lazily loaded---it&#39;s an anti-pattern, which I&#39;ve discussed before in <a href="/2014/06/09/objects-should-be-immutable.html">Objects Should Be Immutable</a>.</p><p>This is how our code will look now:</p><figure class="highlight"><pre><code class="language-java" data-lang="java"><span></span><span class="kd">final</span> <span class="n">Name</span> <span class="n">name</span> <span class="o">=</span> <span class="k">new</span> <span class="n">CachedName</span><span class="o">(</span>
  <span class="k">new</span> <span class="n">EnglishName</span><span class="o">(</span>
    <span class="k">new</span> <span class="n">NameInPostgreSQL</span><span class="o">(</span><span class="cm">/*...*/</span><span class="o">)</span>
  <span class="o">)</span>
<span class="o">);</span></code></pre></figure><p>It&#39;s a very primitive example, but I hope you get the idea.</p><p>In this design, we&#39;re basically splitting the object into two parts. The first one knows how to get the first name from the English name. The second one knows how to cache the results of this calculation in memory. And now it&#39;s my decision, as a user of these classes, how exactly to use them. I will decide whether I need caching or not. This is what object composition is all about.</p><p>Let me reiterate that the only allowed statement inside a constructor is an assignment. If you need to put something else there, start thinking about refactoring---your class definitely needs a redesign.</p></div></article></div><div class="wrapper"> <related-posts /></div><div class="disqus" role="complementary"><p class="disqus_hint"> Please, use <a href="https://help.disqus.com/commenting/what-html-tags-are-allowed-within-comments">syntax highlighting</a> in your comments, to make them more readable.</p><div id="disqus_thread" class="disqus-thread"> <a>&nbsp;</a></div><script> var disqus_config = function () { this.page.url = document.location.href.split('?')[0].split('#')[0].replace('https://', 'http://'); this.page.identifier = this.page.url; }; (function() { var d = document, s = d.createElement('script'); s.src = '//yegor256.disqus.com/embed.js'; s.setAttribute('data-timestamp', +new Date()); (d.head || d.body).appendChild(s); })(); </script> <noscript><div><p class="red"> JavaScript is disabled in your browser, that's why you can't see comments under this post.</p></div></noscript></div><div class="wrapper"> <footer class="footer"><p> &copy; <span itemscope="" itemprop="copyrightHolder" itemtype="http://schema.org/Person"> <span itemprop="name">Yegor Bugayenko</span> </span> 2014&ndash;<span itemprop="copyrightYear">2018</span></p></footer></div></section><div class="wrapper unprintable" style="text-align:center;margin-top:2em;"> <a href="http://www.sixnines.io/h/3ba1652f"> <img src="//www.sixnines.io/b/3ba1652f?style=flat" alt="sixnines availability badge"/> </a></div><script src="//code.jquery.com/jquery-1.9.0.min.js"></script> <script src="/js/all.js?4e047f6f42b"></script> <script>var disqus_shortname = 'yegor256';</script> <script id="dsq-count-scr" src="//yegor256.disqus.com/count.js" async="async"></script> <script> (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){ (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o), m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m) })(window,document,'script','//www.google-analytics.com/analytics.js','ga'); ga('create', 'UA-1963507-32', 'auto'); ga('send', 'pageview'); </script> <script> Cd=document;Cr="&"+Math.random();Cp="&s=1"; Cd.cookie="b=b";if(Cd.cookie)Cp+="&c=1"; Cp+="&t="+(new Date()).getTimezoneOffset(); if(self!=top)Cp+="&f=1"; </script> <script> if(navigator.javaEnabled())Cp+="&j=1"; </script> <script> if(typeof(screen)!='undefined')Cp+="&w="+screen.width+"&h="+ screen.height+"&d="+(screen.colorDepth?screen.colorDepth:screen.pixelDepth); </script> <script> Cd.write("<img src='//c.hit.ua/hit?i=95870&g=0&x=2"+Cp+Cr+ "&r="+escape(Cd.referrer)+"&u="+escape(window.location.href)+ "' border='0' wi"+"dth='1' he"+"ight='1'/>"); </script> <script type="application/ld+json"> { "@context": "http://schema.org", "@type": "Person", "name": "Yegor Bugayenko", "url": "http://www.yegor256.com", "sameAs": [ "https://www.facebook.com/yegor256", "https://instagram.com/yegor256", "https://www.linkedin.com/in/yegor256", "https://twitter.com/yegor256", "https://github.com/yegor256", "https://www.pinterest.com/yegor256/" ] } </script> </body> </html> <!DOCTYPE html> <html xmlns="http://www.w3.org/1999/xhtml" lang="en-US" xml:lang="en-US" itemscope="" itemtype="http://schema.org/WebSite"> <head> <meta charset="utf-8"/> <meta name="description" content="In my experience, very few people understand how to implement an iterating adapter in Java; this article should give a practical example. " /> <meta name="keywords" content="implement java iterator, iterator in java adapter, iterator in java example, java iterator, java iterator example" /> <meta name="viewport" content="width=device-width,minimum-scale=1,initial-scale=1"/> <meta name="google-site-verification" content="JEj_gQr2CPe2QKGw8XdMz0R7VboQIUbX3FlM-lwTq-8" /> <meta name="author" content="Yegor Bugayenko"> <meta name="article:published_time" content="2015-04-30 00:00:00 +0000"> <meta name="og:site_name" content="Yegor Bugayenko"/> <meta name="og:type" content="article" /> <meta name="og:locale" content="en_US" /> <meta name="twitter:account_id" content="4503599630178231" /> <meta name="twitter:creator" content="@yegor256"/> <meta name="twitter:site" content="@yegor256"/> <meta name="twitter:title" property="og:title" content="How to Implement an Iterating Adapter"/> <meta name="twitter:description" property="og:description" content="In my experience, very few people understand how to implement an iterating adapter in Java; this article should give a practical example. "/> <meta name="twitter:url" property="og:url" content="https://www.yegor256.com/2015/04/30/iterating-adapter.html"/> <meta name="telegram:channel" content="AAAAAEJFMRzsRTRxM3ec6A"/> <link rel="search" type="application/opensearchdescription+xml" href="/opensearch.xml" title="yegor256" /> <link rel="shortcut icon" href="/favicon.ico?4e047f6f42b"/> <link rel="apple-touch-icon" href="/favicon.ico?4e047f6f42b"/> <link rel="alternate" type="application/rss+xml" title="RSS for yegor256.com" href="https://www.yegor256.com/rss.xml"/> <link rel="stylesheet" href="/css/layout.css?4e047f6f42b"/> <link rel="stylesheet" href="/css/icons.css?4e047f6f42b"/> <link rel="canonical" href="https://www.yegor256.com/2015/04/30/iterating-adapter.html" /> <link rel="amphtml" href="https://www.yegor256.com/2015/04/30/iterating-adapter.amp.html" /> <title>How to Implement an Iterating Adapter </title> </head> <body><div class="wrapper"> <aside class="header-toggle unprintable" id="header-toggle" title="Show the menu" onclick="$('#header').show();$('#header-toggle').hide();">&#9776;</aside> <header class="header" id="header"><div class="face"> <a href="/about-me.html#form" class="sub" title="Click to subscribe to my monthly newsletter"><span>Subscribe</span></a> <a href="/about-me.html" style="position:relative;"> <img src="/images/face-256x256.jpg" class="photo" alt="Yegor Bugayenko"/> </a></div><nav><ul class="menu social notranslate"> <li><a href="https://twitter.com/intent/follow?screen_name=yegor256" rel="nofollow" title="Follow me on Twitter"><i class="icon icon-twitter notranslate" aria-hidden="true"></i></a></li> <li><a href="/rss.xml" rel="nofollow" title="Subscribe to my RSS feed"><i class="icon icon-rss notranslate" aria-hidden="true"></i></a></li> <li><a itemprop="sameAs" href="https://github.com/yegor256" rel="nofollow" title="My GitHub profile"><i class="icon icon-github notranslate" aria-hidden="true"></i></a></li> <li><a itemprop="sameAs" href="http://stackoverflow.com/users/187141/yegor256" rel="nofollow" title="My StackOverflow profile"><i class="icon icon-stackoverflow notranslate" aria-hidden="true"></i></a></li> <li><a itemprop="sameAs" href="https://www.facebook.com/yegor256" rel="nofollow" title="Follow me on Facebook"><i class="icon icon-facebook notranslate" aria-hidden="true"></i></a></li> <li><a itemprop="sameAs" href="https://instagram.com/yegor256" rel="nofollow" title="Follow me on Instagram"><i class="icon icon-instagram notranslate" aria-hidden="true"></i></a></li> <li><a itemprop="sameAs" href="https://www.linkedin.com/in/yegor256" rel="nofollow" title="My LinkedIn profile"><i class="icon icon-linkedin notranslate" aria-hidden="true"></i></a></li> <li><a itemprop="sameAs" href="https://www.youtube.com/c/yegor256?sub_confirmation=1" rel="nofollow" title="My Youtube video channel"><i class="icon icon-youtube notranslate" aria-hidden="true"></i></a></li> <li><a itemprop="sameAs" href="https://www.pinterest.com/yegor256/" rel="nofollow" title="My Pinterest boards"><i class="icon icon-pinterest notranslate" aria-hidden="true"></i></a></li> <li><a itemprop="sameAs" href="https://angel.co/yegor256" rel="nofollow" title="My AngelList profile"><i class="icon icon-angellist notranslate" aria-hidden="true"></i></a></li> <li><a href="https://soundcloud.com/yegor256" rel="nofollow" title="My podcast"><i class="icon icon-podcast notranslate" aria-hidden="true"></i></a></li> <li><a href="https://itunes.apple.com/us/podcast/yegor256-podcast/id1150826721" rel="nofollow" title="My iTunes podcast"><i class="icon icon-itunes notranslate" aria-hidden="true"></i></a></li> <li><a href="https://t.me/joinchat/AAAAAEJFMRzsRTRxM3ec6A" rel="nofollow" title="My Telegram public channel"><i class="icon icon-telegram notranslate" aria-hidden="true"></i></a></li> <li><a href="mailto:blog@yegor256.com" rel="nofollow" title="Email me any time"><i class="icon icon-mail notranslate" aria-hidden="true"></i></a></li></ul><ul class="menu"> <li><a href="/" title="Home page">Home</a></li> <li ><a href="/best.html" title="Best articles to read">12&#160;Best</a></li> <li ><a href="/contents.html" title="The contents of the entire blog">All&#160;288</a></li> <li ><a href="/webinars.html" title="My webinars">Webinars</a></li> <li ><a href="/talks.html" title="Future and past conference talks">Talks</a></li> <li ><a href="/books.html" title="The books I wrote">Books</a></li> <li ><a href="/papers.html" title="My academic papers and patents">Papers</a></li> <li ><a href="/pets.html" title="My loved pet projects">Pets</a></li> <li ><a href="/award.html" title="Software quality award">Award</a></li> <li ><a href="/testimonials.html" title="What some people say about me">Testimonials</a></li> <li ><a href="/shift-m.html" title="Audio podcast about project management">Shift-M</a></li> <li ><a href="/paintings.html" title="My paintings for sale">Paintings</a></li> <li><a href="http://ru.yegor256.com/" title="Немного на русском языке">По-русски</a></li></ul></nav><div class="search"> <form method="get" action="https://www.google.com/search" itemprop="potentialAction" itemscope="" itemtype="http://schema.org/SearchAction"> <meta itemprop="target" content="https://www.google.com/search?q={q}"/> <input name="sitesearch" value="yegor256.com" type="hidden"/> <input itemprop="query-input" type="text" id="search-query" class="field field-text" required="required" onfocus="$('.google').css('visibility', 'visible');" name="q" placeholder="Search..." autocomplete="off"/> <input type="image" src="/images/google-search-icon.svg" class="google" title="Search via Google" alt="Search via Google"/> </form></div><div class="hot"><ul> <li> <a href="/code-ahead.html">Code Ahead</a> was published on Amazon just a few days ago! It is my new book, a novel about programmers. It explains in details the majority of ideas that stand behind <a href="https://www.zerocracy.com">Zerocracy</a> and <a href="https://www.xdsd.org">XDSD</a>. </li> <li> At <a href="/webinars.html">Webinar #37</a> we will discuss naming problem in OOP, for objects, methods and attributes; join us on <b>September 12</b>, at 11am PST. </li></ul></div></header></div><section itemscope="" itemtype="http://schema.org/BlogPosting"><div class="wrapper"> <header><p class="printable"> <img src="https://api.qrserver.com/v1/create-qr-code/?data=https://www.yegor256.com/2015/04/30/iterating-adapter.html&amp;format=svg" style="width:125px;height:125px;" alt="QR code"/></p><p class="printable"> <code itemprop="url">https://www.yegor256.com/2015/04/30/iterating-adapter.html</code></p><h1 itemprop="name headline mainEntityOfPage">How to Implement an Iterating Adapter</h1><ul class="subline"> <li> <time itemprop="datePublished" datetime="2015-04-30T00:00:00+00:00"> 30 April 2015 </time> </li> <li class="printable" itemscope="" itemprop="author" itemtype="http://schema.org/Person"> <span itemprop="name">Yegor Bugayenko</span> </li> <li class="unprintable"> <i class="icon icon-comments"></i> <a href="http://www.yegor256.com/2015/04/30/iterating-adapter.html#disqus_thread" itemprop="discussionUrl">comments</a> </li></ul><p>Let&#39;s say we have an object of this class:</p><figure class="highlight"><pre><code class="language-java" data-lang="java"><span></span><span class="kd">final</span> <span class="kd">class</span> <span class="nc">Data</span> <span class="o">{</span>
  <span class="kt">byte</span><span class="o">[]</span> <span class="nf">read</span><span class="o">();</span>
<span class="o">}</span></code></pre></figure><p>When we call <code>read()</code>, it returns a new array of bytes that were retrieved from somewhere. If there is nothing to retrieve, the array will be empty. Now, we want to create an <em>adapter</em> that would consume the bytes and let us iterate them:</p><figure class="highlight"><pre><code class="language-java" data-lang="java"><span></span><span class="kd">final</span> <span class="kd">class</span> <span class="nc">FluentData</span> <span class="kd">implements</span> <span class="n">Iterator</span><span class="o">&lt;</span><span class="n">Byte</span><span class="o">&gt;</span> <span class="o">{</span>
  <span class="kt">boolean</span> <span class="nf">hasNext</span><span class="o">()</span> <span class="o">{</span> <span class="cm">/* ... */</span> <span class="o">}</span>
  <span class="n">Byte</span> <span class="nf">next</span><span class="o">()</span> <span class="o">{</span> <span class="cm">/* ... */</span> <span class="o">}</span>
  <span class="kt">void</span> <span class="nf">remove</span><span class="o">()</span>  <span class="o">{</span> <span class="cm">/* ... */</span> <span class="o">}</span>
<span class="o">}</span></code></pre></figure><p>Here is how it should look (it is not thread-safe!):</p><figure class="highlight"><pre><code class="language-java" data-lang="java"><span></span><span class="kd">final</span> <span class="kd">class</span> <span class="nc">FluentData</span> <span class="kd">implements</span> <span class="n">Iterator</span><span class="o">&lt;</span><span class="n">Byte</span><span class="o">&gt;</span> <span class="o">{</span>
  <span class="kd">private</span> <span class="kd">final</span> <span class="n">Data</span> <span class="n">data</span><span class="o">;</span>
  <span class="kd">private</span> <span class="kd">final</span> <span class="n">Queue</span><span class="o">&lt;</span><span class="n">Byte</span><span class="o">&gt;</span> <span class="n">buffer</span> <span class="o">=</span> <span class="k">new</span> <span class="n">LinkedList</span><span class="o">&lt;&gt;();</span>
  <span class="kd">public</span> <span class="nf">FluentData</span><span class="o">(</span><span class="kd">final</span> <span class="n">Data</span> <span class="n">dat</span><span class="o">)</span> <span class="o">{</span>
    <span class="k">this</span><span class="o">.</span><span class="na">data</span> <span class="o">=</span> <span class="n">dat</span><span class="o">;</span>
  <span class="o">}</span>
  <span class="kd">public</span> <span class="kt">boolean</span> <span class="nf">hasNext</span><span class="o">()</span> <span class="o">{</span>
    <span class="k">if</span> <span class="o">(</span><span class="k">this</span><span class="o">.</span><span class="na">buffer</span><span class="o">.</span><span class="na">isEmpty</span><span class="o">())</span> <span class="o">{</span>
      <span class="k">for</span> <span class="o">(</span><span class="kd">final</span> <span class="kt">byte</span> <span class="n">item</span> <span class="o">:</span> <span class="k">this</span><span class="o">.</span><span class="na">data</span><span class="o">.</span><span class="na">read</span><span class="o">())</span> <span class="o">{</span>
        <span class="k">this</span><span class="o">.</span><span class="na">buffer</span><span class="o">.</span><span class="na">add</span><span class="o">(</span><span class="n">item</span><span class="o">);</span>
      <span class="o">}</span>
    <span class="o">}</span>
    <span class="k">return</span> <span class="o">!</span><span class="k">this</span><span class="o">.</span><span class="na">buffer</span><span class="o">.</span><span class="na">isEmpty</span><span class="o">();</span>
  <span class="o">}</span>
  <span class="kd">public</span> <span class="n">Byte</span> <span class="nf">next</span><span class="o">()</span> <span class="o">{</span>
    <span class="k">if</span> <span class="o">(!</span><span class="k">this</span><span class="o">.</span><span class="na">hasNext</span><span class="o">())</span> <span class="o">{</span>
      <span class="k">throw</span> <span class="k">new</span> <span class="n">NoSuchElementException</span><span class="o">(</span><span class="s">&quot;Nothing left&quot;</span><span class="o">);</span>
    <span class="o">}</span>
    <span class="k">return</span> <span class="k">this</span><span class="o">.</span><span class="na">buffer</span><span class="o">.</span><span class="na">poll</span><span class="o">();</span>
  <span class="o">}</span>
  <span class="kd">public</span> <span class="kt">void</span> <span class="nf">remove</span><span class="o">()</span> <span class="o">{</span>
    <span class="k">throw</span> <span class="k">new</span> <span class="n">UnsupportedOperationException</span><span class="o">(</span><span class="s">&quot;It is read-only&quot;</span><span class="o">);</span>
  <span class="o">}</span>
<span class="o">}</span></code></pre></figure><p>There is no way to make it <a href="/2017/01/17/synchronized-decorators.html">thread-safe</a> because the iterating process is outside the scope of the iterator. Even if we declare our methods as <code>synchronized</code>, this won&#39;t guarantee that two threads won&#39;t conflict when they both call <code>hasNext()</code> and <code>next()</code>. So don&#39;t bother with it and just document the iterator as not thread-safe, then let its users synchronize one level higher when necessary.</p></p>--> <nav class="buttons notranslate desktop-only"> <a href="http://www.facebook.com/sharer/sharer.php?u=https://www.yegor256.com/2015/04/30/iterating-adapter.html" title="Share on Facebook" class="button" rel="nofollow"> <span class="count count-facebook">0</span> <i class="icon icon-facebook notranslate" aria-hidden="true"></i> </a> <a href="https://twitter.com/share?url=https://www.yegor256.com/2015/04/30/iterating-adapter.html&amp;text=How+to+Implement+an+Iterating+Adapter" title="Share on Twitter" class="button" rel="nofollow"> <span class="count count-twitter">0</span> <i class="icon icon-twitter notranslate" aria-hidden="true"></i> </a> <a href="https://plus.google.com/share?url=https://www.yegor256.com/2015/04/30/iterating-adapter.html" title="Share on Google+" class="button" rel="nofollow"> <span class="count count-googleplus">0</span> <i class="icon icon-googleplus notranslate" aria-hidden="true"></i> </a> <a href="https://www.linkedin.com/cws/share?url=https://www.yegor256.com/2015/04/30/iterating-adapter.html" title="Share on LinkedIn" class="button" rel="nofollow"> <span class="count count-linkedin">0</span> <i class="icon icon-linkedin notranslate" aria-hidden="true"></i> </a> <a href="http://reddit.com/submit?url=https://www.yegor256.com/2015/04/30/iterating-adapter.html%3F2015-17&amp;title=How+to+Implement+an+Iterating+Adapter" title="Share on Reddit" class="button" rel="nofollow"> <span class="count count-reddit">0</span> <i class="icon icon-reddit notranslate" aria-hidden="true"></i> </a> <a href="http://news.ycombinator.com/submitlink?u=https://www.yegor256.com/2015/04/30/iterating-adapter.html%3F2015-17&amp;t=How+to+Implement+an+Iterating+Adapter" title="Share on Hacker News" class="button" rel="nofollow"> <span class="count count-hackernews">0</span> <i class="icon icon-hackernews notranslate" aria-hidden="true"></i> </a> </nav> </header> <article class="main" itemprop="articleBody"><div ><p><a href="http://docs.oracle.com/javase/7/docs/api/java/util/Iterator.html">Iterator</a> is one of the fundamental Java <a href="/2016/04/26/why-inputstream-design-is-wrong.html">interfaces</a>, introduced in Java 1.2. It is supposed to be very simple; however, in my experience, many Java developers don&#39;t understand how to implement a custom one, which should iterate a stream of data coming from some other source. In other words, it becomes an <strong>adapter</strong> of another source of data, in the form of an iterator. I hope this example will help.</p><p>Let&#39;s say we have an object of this class:</p><figure class="highlight"><pre><code class="language-java" data-lang="java"><span></span><span class="kd">final</span> <span class="kd">class</span> <span class="nc">Data</span> <span class="o">{</span>
  <span class="kt">byte</span><span class="o">[]</span> <span class="nf">read</span><span class="o">();</span>
<span class="o">}</span></code></pre></figure><p>When we call <code>read()</code>, it returns a new array of bytes that were retrieved from somewhere. If there is nothing to retrieve, the array will be empty. Now, we want to create an <em>adapter</em> that would consume the bytes and let us iterate them:</p><figure class="highlight"><pre><code class="language-java" data-lang="java"><span></span><span class="kd">final</span> <span class="kd">class</span> <span class="nc">FluentData</span> <span class="kd">implements</span> <span class="n">Iterator</span><span class="o">&lt;</span><span class="n">Byte</span><span class="o">&gt;</span> <span class="o">{</span>
  <span class="kt">boolean</span> <span class="nf">hasNext</span><span class="o">()</span> <span class="o">{</span> <span class="cm">/* ... */</span> <span class="o">}</span>
  <span class="n">Byte</span> <span class="nf">next</span><span class="o">()</span> <span class="o">{</span> <span class="cm">/* ... */</span> <span class="o">}</span>
  <span class="kt">void</span> <span class="nf">remove</span><span class="o">()</span>  <span class="o">{</span> <span class="cm">/* ... */</span> <span class="o">}</span>
<span class="o">}</span></code></pre></figure><p>Here is how it should look (it is not thread-safe!):</p><figure class="highlight"><pre><code class="language-java" data-lang="java"><span></span><span class="kd">final</span> <span class="kd">class</span> <span class="nc">FluentData</span> <span class="kd">implements</span> <span class="n">Iterator</span><span class="o">&lt;</span><span class="n">Byte</span><span class="o">&gt;</span> <span class="o">{</span>
  <span class="kd">private</span> <span class="kd">final</span> <span class="n">Data</span> <span class="n">data</span><span class="o">;</span>
  <span class="kd">private</span> <span class="kd">final</span> <span class="n">Queue</span><span class="o">&lt;</span><span class="n">Byte</span><span class="o">&gt;</span> <span class="n">buffer</span> <span class="o">=</span> <span class="k">new</span> <span class="n">LinkedList</span><span class="o">&lt;&gt;();</span>
  <span class="kd">public</span> <span class="nf">FluentData</span><span class="o">(</span><span class="kd">final</span> <span class="n">Data</span> <span class="n">dat</span><span class="o">)</span> <span class="o">{</span>
    <span class="k">this</span><span class="o">.</span><span class="na">data</span> <span class="o">=</span> <span class="n">dat</span><span class="o">;</span>
  <span class="o">}</span>
  <span class="kd">public</span> <span class="kt">boolean</span> <span class="nf">hasNext</span><span class="o">()</span> <span class="o">{</span>
    <span class="k">if</span> <span class="o">(</span><span class="k">this</span><span class="o">.</span><span class="na">buffer</span><span class="o">.</span><span class="na">isEmpty</span><span class="o">())</span> <span class="o">{</span>
      <span class="k">for</span> <span class="o">(</span><span class="kd">final</span> <span class="kt">byte</span> <span class="n">item</span> <span class="o">:</span> <span class="k">this</span><span class="o">.</span><span class="na">data</span><span class="o">.</span><span class="na">read</span><span class="o">())</span> <span class="o">{</span>
        <span class="k">this</span><span class="o">.</span><span class="na">buffer</span><span class="o">.</span><span class="na">add</span><span class="o">(</span><span class="n">item</span><span class="o">);</span>
      <span class="o">}</span>
    <span class="o">}</span>
    <span class="k">return</span> <span class="o">!</span><span class="k">this</span><span class="o">.</span><span class="na">buffer</span><span class="o">.</span><span class="na">isEmpty</span><span class="o">();</span>
  <span class="o">}</span>
  <span class="kd">public</span> <span class="n">Byte</span> <span class="nf">next</span><span class="o">()</span> <span class="o">{</span>
    <span class="k">if</span> <span class="o">(!</span><span class="k">this</span><span class="o">.</span><span class="na">hasNext</span><span class="o">())</span> <span class="o">{</span>
      <span class="k">throw</span> <span class="k">new</span> <span class="n">NoSuchElementException</span><span class="o">(</span><span class="s">&quot;Nothing left&quot;</span><span class="o">);</span>
    <span class="o">}</span>
    <span class="k">return</span> <span class="k">this</span><span class="o">.</span><span class="na">buffer</span><span class="o">.</span><span class="na">poll</span><span class="o">();</span>
  <span class="o">}</span>
  <span class="kd">public</span> <span class="kt">void</span> <span class="nf">remove</span><span class="o">()</span> <span class="o">{</span>
    <span class="k">throw</span> <span class="k">new</span> <span class="n">UnsupportedOperationException</span><span class="o">(</span><span class="s">&quot;It is read-only&quot;</span><span class="o">);</span>
  <span class="o">}</span>
<span class="o">}</span></code></pre></figure><p>There is no way to make it <a href="/2017/01/17/synchronized-decorators.html">thread-safe</a> because the iterating process is outside the scope of the iterator. Even if we declare our methods as <code>synchronized</code>, this won&#39;t guarantee that two threads won&#39;t conflict when they both call <code>hasNext()</code> and <code>next()</code>. So don&#39;t bother with it and just document the iterator as not thread-safe, then let its users synchronize one level higher when necessary.</p></div></article></div><div class="wrapper"> <related-posts /></div><div class="disqus" role="complementary"><p class="disqus_hint"> Please, use <a href="https://help.disqus.com/commenting/what-html-tags-are-allowed-within-comments">syntax highlighting</a> in your comments, to make them more readable.</p><div id="disqus_thread" class="disqus-thread"> <a>&nbsp;</a></div><script> var disqus_config = function () { this.page.url = document.location.href.split('?')[0].split('#')[0].replace('https://', 'http://'); this.page.identifier = this.page.url; }; (function() { var d = document, s = d.createElement('script'); s.src = '//yegor256.disqus.com/embed.js'; s.setAttribute('data-timestamp', +new Date()); (d.head || d.body).appendChild(s); })(); </script> <noscript><div><p class="red"> JavaScript is disabled in your browser, that's why you can't see comments under this post.</p></div></noscript></div><div class="wrapper"> <footer class="footer"><p> &copy; <span itemscope="" itemprop="copyrightHolder" itemtype="http://schema.org/Person"> <span itemprop="name">Yegor Bugayenko</span> </span> 2014&ndash;<span itemprop="copyrightYear">2018</span></p></footer></div></section><div class="wrapper unprintable" style="text-align:center;margin-top:2em;"> <a href="http://www.sixnines.io/h/3ba1652f"> <img src="//www.sixnines.io/b/3ba1652f?style=flat" alt="sixnines availability badge"/> </a></div><script src="//code.jquery.com/jquery-1.9.0.min.js"></script> <script src="/js/all.js?4e047f6f42b"></script> <script>var disqus_shortname = 'yegor256';</script> <script id="dsq-count-scr" src="//yegor256.disqus.com/count.js" async="async"></script> <script> (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){ (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o), m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m) })(window,document,'script','//www.google-analytics.com/analytics.js','ga'); ga('create', 'UA-1963507-32', 'auto'); ga('send', 'pageview'); </script> <script> Cd=document;Cr="&"+Math.random();Cp="&s=1"; Cd.cookie="b=b";if(Cd.cookie)Cp+="&c=1"; Cp+="&t="+(new Date()).getTimezoneOffset(); if(self!=top)Cp+="&f=1"; </script> <script> if(navigator.javaEnabled())Cp+="&j=1"; </script> <script> if(typeof(screen)!='undefined')Cp+="&w="+screen.width+"&h="+ screen.height+"&d="+(screen.colorDepth?screen.colorDepth:screen.pixelDepth); </script> <script> Cd.write("<img src='//c.hit.ua/hit?i=95870&g=0&x=2"+Cp+Cr+ "&r="+escape(Cd.referrer)+"&u="+escape(window.location.href)+ "' border='0' wi"+"dth='1' he"+"ight='1'/>"); </script> <script type="application/ld+json"> { "@context": "http://schema.org", "@type": "Person", "name": "Yegor Bugayenko", "url": "http://www.yegor256.com", "sameAs": [ "https://www.facebook.com/yegor256", "https://instagram.com/yegor256", "https://www.linkedin.com/in/yegor256", "https://twitter.com/yegor256", "https://github.com/yegor256", "https://www.pinterest.com/yegor256/" ] } </script> </body> </html> <!DOCTYPE html> <html xmlns="http://www.w3.org/1999/xhtml" lang="en-US" xml:lang="en-US" itemscope="" itemtype="http://schema.org/WebSite"> <head> <meta charset="utf-8"/> <meta name="description" content="JAXB is a 10-year-old anti-pattern that encourages Java developers to turn their objects into dumb, passive data structures. " /> <meta name="keywords" content="jaxb alternatives, jaxb anti-pattern, jaxb is bad, jaxb marshalling, jaxb marshalling example" /> <meta name="viewport" content="width=device-width,minimum-scale=1,initial-scale=1"/> <meta name="google-site-verification" content="JEj_gQr2CPe2QKGw8XdMz0R7VboQIUbX3FlM-lwTq-8" /> <meta name="author" content="Yegor Bugayenko"> <meta name="article:published_time" content="2015-03-26 00:00:00 +0000"> <meta name="og:site_name" content="Yegor Bugayenko"/> <meta name="og:type" content="article" /> <meta name="og:locale" content="en_US" /> <meta name="twitter:account_id" content="4503599630178231" /> <meta name="twitter:creator" content="@yegor256"/> <meta name="twitter:site" content="@yegor256"/> <meta name="twitter:title" property="og:title" content="JAXB Is Doing It Wrong; Try Xembly"/> <meta name="twitter:description" property="og:description" content="JAXB is a 10-year-old anti-pattern that encourages Java developers to turn their objects into dumb, passive data structures. "/> <meta name="twitter:url" property="og:url" content="https://www.yegor256.com/2015/03/26/jaxb-vs-xembly.html"/> <meta name="telegram:channel" content="AAAAAEJFMRzsRTRxM3ec6A"/> <link rel="search" type="application/opensearchdescription+xml" href="/opensearch.xml" title="yegor256" /> <link rel="shortcut icon" href="/favicon.ico?4e047f6f42b"/> <link rel="apple-touch-icon" href="/favicon.ico?4e047f6f42b"/> <link rel="alternate" type="application/rss+xml" title="RSS for yegor256.com" href="https://www.yegor256.com/rss.xml"/> <link rel="stylesheet" href="/css/layout.css?4e047f6f42b"/> <link rel="stylesheet" href="/css/icons.css?4e047f6f42b"/> <link rel="canonical" href="https://www.yegor256.com/2015/03/26/jaxb-vs-xembly.html" /> <link rel="amphtml" href="https://www.yegor256.com/2015/03/26/jaxb-vs-xembly.amp.html" /> <title>JAXB Is Doing It Wrong; Try Xembly </title> </head> <body><div class="wrapper"> <aside class="header-toggle unprintable" id="header-toggle" title="Show the menu" onclick="$('#header').show();$('#header-toggle').hide();">&#9776;</aside> <header class="header" id="header"><div class="face"> <a href="/about-me.html#form" class="sub" title="Click to subscribe to my monthly newsletter"><span>Subscribe</span></a> <a href="/about-me.html" style="position:relative;"> <img src="/images/face-256x256.jpg" class="photo" alt="Yegor Bugayenko"/> </a></div><nav><ul class="menu social notranslate"> <li><a href="https://twitter.com/intent/follow?screen_name=yegor256" rel="nofollow" title="Follow me on Twitter"><i class="icon icon-twitter notranslate" aria-hidden="true"></i></a></li> <li><a href="/rss.xml" rel="nofollow" title="Subscribe to my RSS feed"><i class="icon icon-rss notranslate" aria-hidden="true"></i></a></li> <li><a itemprop="sameAs" href="https://github.com/yegor256" rel="nofollow" title="My GitHub profile"><i class="icon icon-github notranslate" aria-hidden="true"></i></a></li> <li><a itemprop="sameAs" href="http://stackoverflow.com/users/187141/yegor256" rel="nofollow" title="My StackOverflow profile"><i class="icon icon-stackoverflow notranslate" aria-hidden="true"></i></a></li> <li><a itemprop="sameAs" href="https://www.facebook.com/yegor256" rel="nofollow" title="Follow me on Facebook"><i class="icon icon-facebook notranslate" aria-hidden="true"></i></a></li> <li><a itemprop="sameAs" href="https://instagram.com/yegor256" rel="nofollow" title="Follow me on Instagram"><i class="icon icon-instagram notranslate" aria-hidden="true"></i></a></li> <li><a itemprop="sameAs" href="https://www.linkedin.com/in/yegor256" rel="nofollow" title="My LinkedIn profile"><i class="icon icon-linkedin notranslate" aria-hidden="true"></i></a></li> <li><a itemprop="sameAs" href="https://www.youtube.com/c/yegor256?sub_confirmation=1" rel="nofollow" title="My Youtube video channel"><i class="icon icon-youtube notranslate" aria-hidden="true"></i></a></li> <li><a itemprop="sameAs" href="https://www.pinterest.com/yegor256/" rel="nofollow" title="My Pinterest boards"><i class="icon icon-pinterest notranslate" aria-hidden="true"></i></a></li> <li><a itemprop="sameAs" href="https://angel.co/yegor256" rel="nofollow" title="My AngelList profile"><i class="icon icon-angellist notranslate" aria-hidden="true"></i></a></li> <li><a href="https://soundcloud.com/yegor256" rel="nofollow" title="My podcast"><i class="icon icon-podcast notranslate" aria-hidden="true"></i></a></li> <li><a href="https://itunes.apple.com/us/podcast/yegor256-podcast/id1150826721" rel="nofollow" title="My iTunes podcast"><i class="icon icon-itunes notranslate" aria-hidden="true"></i></a></li> <li><a href="https://t.me/joinchat/AAAAAEJFMRzsRTRxM3ec6A" rel="nofollow" title="My Telegram public channel"><i class="icon icon-telegram notranslate" aria-hidden="true"></i></a></li> <li><a href="mailto:blog@yegor256.com" rel="nofollow" title="Email me any time"><i class="icon icon-mail notranslate" aria-hidden="true"></i></a></li></ul><ul class="menu"> <li><a href="/" title="Home page">Home</a></li> <li ><a href="/best.html" title="Best articles to read">12&#160;Best</a></li> <li ><a href="/contents.html" title="The contents of the entire blog">All&#160;288</a></li> <li ><a href="/webinars.html" title="My webinars">Webinars</a></li> <li ><a href="/talks.html" title="Future and past conference talks">Talks</a></li> <li ><a href="/books.html" title="The books I wrote">Books</a></li> <li ><a href="/papers.html" title="My academic papers and patents">Papers</a></li> <li ><a href="/pets.html" title="My loved pet projects">Pets</a></li> <li ><a href="/award.html" title="Software quality award">Award</a></li> <li ><a href="/testimonials.html" title="What some people say about me">Testimonials</a></li> <li ><a href="/shift-m.html" title="Audio podcast about project management">Shift-M</a></li> <li ><a href="/paintings.html" title="My paintings for sale">Paintings</a></li> <li><a href="http://ru.yegor256.com/" title="Немного на русском языке">По-русски</a></li></ul></nav><div class="search"> <form method="get" action="https://www.google.com/search" itemprop="potentialAction" itemscope="" itemtype="http://schema.org/SearchAction"> <meta itemprop="target" content="https://www.google.com/search?q={q}"/> <input name="sitesearch" value="yegor256.com" type="hidden"/> <input itemprop="query-input" type="text" id="search-query" class="field field-text" required="required" onfocus="$('.google').css('visibility', 'visible');" name="q" placeholder="Search..." autocomplete="off"/> <input type="image" src="/images/google-search-icon.svg" class="google" title="Search via Google" alt="Search via Google"/> </form></div><div class="hot"><ul> <li> <a href="/code-ahead.html">Code Ahead</a> was published on Amazon just a few days ago! It is my new book, a novel about programmers. It explains in details the majority of ideas that stand behind <a href="https://www.zerocracy.com">Zerocracy</a> and <a href="https://www.xdsd.org">XDSD</a>. </li> <li> At <a href="/webinars.html">Webinar #37</a> we will discuss naming problem in OOP, for objects, methods and attributes; join us on <b>September 12</b>, at 11am PST. </li></ul></div></header></div><section itemscope="" itemtype="http://schema.org/BlogPosting"><div class="wrapper"> <header><p class="printable"> <img src="https://api.qrserver.com/v1/create-qr-code/?data=https://www.yegor256.com/2015/03/26/jaxb-vs-xembly.html&amp;format=svg" style="width:125px;height:125px;" alt="QR code"/></p><p class="printable"> <code itemprop="url">https://www.yegor256.com/2015/03/26/jaxb-vs-xembly.html</code></p><h1 itemprop="name headline mainEntityOfPage">JAXB Is Doing It Wrong; Try Xembly</h1><ul class="subline"> <li> <time itemprop="datePublished" datetime="2015-03-26T00:00:00+00:00"> 26 March 2015 </time> </li> <li class="printable" itemscope="" itemprop="author" itemtype="http://schema.org/Person"> <span itemprop="name">Yegor Bugayenko</span> </li> <li class="unprintable"> <i class="icon icon-comments"></i> <a href="http://www.yegor256.com/2015/03/26/jaxb-vs-xembly.html#disqus_thread" itemprop="discussionUrl">comments</a> </li></ul><p>This is how JAXB marshalling works. Say you have a <code>Book</code> class that needs to be marshalled into an XML document. You have to create getters and annotate them:</p><figure class="highlight"><pre><code class="language-java" data-lang="java"><span></span><span class="kn">import</span> <span class="nn">javax.xml.bind.annotation.XmlElement</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">javax.xml.bind.annotation.XmlRootElement</span><span class="o">;</span>
<span class="nd">@XmlRootElement</span>
<span class="kd">public</span> <span class="kd">class</span> <span class="nc">Book</span> <span class="o">{</span>
  <span class="kd">private</span> <span class="kd">final</span> <span class="n">String</span> <span class="n">isbn</span><span class="o">;</span>
  <span class="kd">private</span> <span class="kd">final</span> <span class="n">String</span> <span class="n">title</span><span class="o">;</span>
  <span class="kd">public</span> <span class="nf">Book</span><span class="o">(</span><span class="kd">final</span> <span class="n">String</span> <span class="n">isbn</span><span class="o">,</span> <span class="kd">final</span> <span class="n">String</span> <span class="n">title</span><span class="o">)</span> <span class="o">{</span>
    <span class="k">this</span><span class="o">.</span><span class="na">isbn</span> <span class="o">=</span> <span class="n">isbn</span><span class="o">;</span>
    <span class="k">this</span><span class="o">.</span><span class="na">title</span> <span class="o">=</span> <span class="n">title</span><span class="o">;</span>
  <span class="o">}</span>
  <span class="nd">@XmlElement</span>
  <span class="kd">public</span> <span class="n">String</span> <span class="nf">getIsbn</span><span class="o">()</span> <span class="o">{</span>
    <span class="k">return</span> <span class="k">this</span><span class="o">.</span><span class="na">isbn</span><span class="o">;</span>
  <span class="o">}</span>
  <span class="nd">@XmlElement</span>
  <span class="kd">public</span> <span class="n">String</span> <span class="nf">getTitle</span><span class="o">()</span> <span class="o">{</span>
    <span class="k">return</span> <span class="k">this</span><span class="o">.</span><span class="na">title</span><span class="o">;</span>
  <span class="o">}</span>
<span class="o">}</span></code></pre></figure><p>Then you create a marshaller and ask it to convert an instance of class <code>Book</code> into XML:</p><figure class="highlight"><pre><code class="language-java" data-lang="java"><span></span><span class="kd">final</span> <span class="n">Book</span> <span class="n">book</span> <span class="o">=</span> <span class="k">new</span> <span class="n">Book</span><span class="o">(</span><span class="s">&quot;0132350882&quot;</span><span class="o">,</span> <span class="s">&quot;Clean Code&quot;</span><span class="o">);</span>
<span class="kd">final</span> <span class="n">JAXBContext</span> <span class="n">context</span> <span class="o">=</span> <span class="n">JAXBContext</span><span class="o">.</span><span class="na">newInstance</span><span class="o">(</span><span class="n">Book</span><span class="o">.</span><span class="na">class</span><span class="o">);</span>
<span class="kd">final</span> <span class="n">Marshaller</span> <span class="n">marshaller</span> <span class="o">=</span> <span class="n">jaxbContext</span><span class="o">.</span><span class="na">createMarshaller</span><span class="o">();</span>
<span class="n">marshaller</span><span class="o">.</span><span class="na">marshal</span><span class="o">(</span><span class="n">book</span><span class="o">,</span> <span class="n">System</span><span class="o">.</span><span class="na">out</span><span class="o">);</span></code></pre></figure><p>You should be expecting something like this in the output:</p><figure class="highlight"><pre><code class="language-xml" data-lang="xml"><span></span><span class="cp">&lt;?xml version=&quot;1.0&quot;?&gt;</span>
<span class="nt">&lt;book&gt;</span>
  <span class="nt">&lt;isbn&gt;</span>0132350882<span class="nt">&lt;/isbn&gt;</span>
  <span class="nt">&lt;title&gt;</span>Clean Code<span class="nt">&lt;/title&gt;</span>
<span class="nt">&lt;/book&gt;</span></code></pre></figure><p>So what&#39;s wrong with it? Pretty much the same thing that&#39;s wrong with object-relational mapping, which is explained in <a href="/2014/12/01/orm-offensive-anti-pattern.html">ORM Is an Offensive Anti-Pattern</a>. JAXB is treating an object as a bag of data, extracting the data and converting it into XML the way JAXB wants. The object has no control over this process. Therefore an object is not <a href="/2014/11/20/seven-virtues-of-good-object.html">an object</a> anymore but rather a passive bag of data.</p><p>An ideal approach would be to redesign our class <code>Book</code> this way:</p><figure class="highlight"><pre><code class="language-java" data-lang="java"><span></span><span class="kd">public</span> <span class="kd">class</span> <span class="nc">Book</span> <span class="o">{</span>
  <span class="kd">private</span> <span class="kd">final</span> <span class="n">String</span> <span class="n">isbn</span><span class="o">;</span>
  <span class="kd">private</span> <span class="kd">final</span> <span class="n">String</span> <span class="n">title</span><span class="o">;</span>
  <span class="kd">public</span> <span class="nf">Book</span><span class="o">(</span><span class="kd">final</span> <span class="n">String</span> <span class="n">isbn</span><span class="o">,</span> <span class="kd">final</span> <span class="n">String</span> <span class="n">title</span><span class="o">)</span> <span class="o">{</span>
    <span class="k">this</span><span class="o">.</span><span class="na">isbn</span> <span class="o">=</span> <span class="n">isbn</span><span class="o">;</span>
    <span class="k">this</span><span class="o">.</span><span class="na">title</span> <span class="o">=</span> <span class="n">title</span><span class="o">;</span>
  <span class="o">}</span>
  <span class="kd">public</span> <span class="n">String</span> <span class="nf">toXML</span><span class="o">()</span> <span class="o">{</span>
    <span class="c1">// create XML document and return</span>
  <span class="o">}</span>
<span class="o">}</span></code></pre></figure><p>However, there are a few problems with this approach. First of all, there&#39;s massive code duplication. Building an XML document is a rather verbose process in Java. If every class had to re-implement it in its <code>toXML()</code> method, we would have a big problem with duplicate code.</p><p>The second problem is that we don&#39;t know exactly what type of wrapping our XML document should be delivered in. It may be a <code>String</code> or an <code>InputStream</code> or maybe an instance of <code>org.w3c.dom.Document</code>. Making many <code>toXML()</code> methods in each object would definitely be a disaster.</p><p><a href="http://www.xembly.org">Xembly</a> provides a solution. As I&#39;ve <a href="/2014/04/09/xembly-intro.html">mentioned before</a>, it is an imperative language for XML constructions and manipulations. Here is how we can implement our <code>Book</code> object with the help of Xembly:</p><figure class="highlight"><pre><code class="language-java" data-lang="java"><span></span><span class="kn">import</span> <span class="nn">org.xembly.Directive</span><span class="o">;</span>
<span class="kd">public</span> <span class="kd">class</span> <span class="nc">Book</span> <span class="o">{</span>
  <span class="kd">private</span> <span class="kd">final</span> <span class="n">String</span> <span class="n">isbn</span><span class="o">;</span>
  <span class="kd">private</span> <span class="kd">final</span> <span class="n">String</span> <span class="n">title</span><span class="o">;</span>
  <span class="kd">public</span> <span class="nf">Book</span><span class="o">(</span><span class="kd">final</span> <span class="n">String</span> <span class="n">isbn</span><span class="o">,</span> <span class="kd">final</span> <span class="n">String</span> <span class="n">title</span><span class="o">)</span> <span class="o">{</span>
    <span class="k">this</span><span class="o">.</span><span class="na">isbn</span> <span class="o">=</span> <span class="n">isbn</span><span class="o">;</span>
    <span class="k">this</span><span class="o">.</span><span class="na">title</span> <span class="o">=</span> <span class="n">title</span><span class="o">;</span>
  <span class="o">}</span>
  <span class="kd">public</span> <span class="n">Iterable</span><span class="o">&lt;</span><span class="n">Directive</span><span class="o">&gt;</span> <span class="nf">toXembly</span><span class="o">()</span> <span class="o">{</span>
    <span class="k">return</span> <span class="k">new</span> <span class="n">Directives</span><span class="o">()</span>
      <span class="o">.</span><span class="na">add</span><span class="o">(</span><span class="s">&quot;book&quot;</span><span class="o">)</span>
      <span class="o">.</span><span class="na">add</span><span class="o">(</span><span class="s">&quot;isbn&quot;</span><span class="o">).</span><span class="na">set</span><span class="o">(</span><span class="k">this</span><span class="o">.</span><span class="na">isbn</span><span class="o">).</span><span class="na">up</span><span class="o">()</span>
      <span class="o">.</span><span class="na">add</span><span class="o">(</span><span class="s">&quot;title&quot;</span><span class="o">).</span><span class="na">set</span><span class="o">(</span><span class="k">this</span><span class="o">.</span><span class="na">title</span><span class="o">).</span><span class="na">up</span><span class="o">()</span>
      <span class="o">.</span><span class="na">up</span><span class="o">();</span>
  <span class="o">}</span>
<span class="o">}</span></code></pre></figure><p>Now, in order to build an XML document, we should use this code outside the object:</p><figure class="highlight"><pre><code class="language-java" data-lang="java"><span></span><span class="kd">final</span> <span class="n">Book</span> <span class="n">book</span> <span class="o">=</span> <span class="k">new</span> <span class="n">Book</span><span class="o">(</span><span class="s">&quot;0132350882&quot;</span><span class="o">,</span> <span class="s">&quot;Clean Code&quot;</span><span class="o">);</span>
<span class="kd">final</span> <span class="n">String</span> <span class="n">xml</span> <span class="o">=</span> <span class="k">new</span> <span class="n">Xembler</span><span class="o">(</span><span class="n">book</span><span class="o">.</span><span class="na">toXembly</span><span class="o">()).</span><span class="na">xml</span><span class="o">();</span></code></pre></figure><p>This <a href="http://www.xembly.org/apidocs-0.21/org/xembly/Xembler.html"><code>Xembler</code></a> class will convert Xembly directives into an XML document.</p><p>The beauty of this solution is that the internals of the object are not exposed via getters and the object is fully in charge of the XML marshalling process. In addition, the complexity of these directives may be very high---much higher than the rather cumbersome <a href="/2016/04/12/java-annotations-are-evil.html">annotations</a> of JAXB.</p><p>Xembly is an open source project, so feel free to submit your questions or corrections to <a href="https://github.com/yegor256/xembly">GitHub</a>.</p></p>--> <nav class="buttons notranslate desktop-only"> <a href="http://www.facebook.com/sharer/sharer.php?u=https://www.yegor256.com/2015/03/26/jaxb-vs-xembly.html" title="Share on Facebook" class="button" rel="nofollow"> <span class="count count-facebook">0</span> <i class="icon icon-facebook notranslate" aria-hidden="true"></i> </a> <a href="https://twitter.com/share?url=https://www.yegor256.com/2015/03/26/jaxb-vs-xembly.html&amp;text=JAXB+Is+Doing+It+Wrong%3B+Try+Xembly" title="Share on Twitter" class="button" rel="nofollow"> <span class="count count-twitter">0</span> <i class="icon icon-twitter notranslate" aria-hidden="true"></i> </a> <a href="https://plus.google.com/share?url=https://www.yegor256.com/2015/03/26/jaxb-vs-xembly.html" title="Share on Google+" class="button" rel="nofollow"> <span class="count count-googleplus">0</span> <i class="icon icon-googleplus notranslate" aria-hidden="true"></i> </a> <a href="https://www.linkedin.com/cws/share?url=https://www.yegor256.com/2015/03/26/jaxb-vs-xembly.html" title="Share on LinkedIn" class="button" rel="nofollow"> <span class="count count-linkedin">0</span> <i class="icon icon-linkedin notranslate" aria-hidden="true"></i> </a> <a href="http://reddit.com/submit?url=https://www.yegor256.com/2015/03/26/jaxb-vs-xembly.html%3F2015-12&amp;title=JAXB+Is+Doing+It+Wrong%3B+Try+Xembly" title="Share on Reddit" class="button" rel="nofollow"> <span class="count count-reddit">0</span> <i class="icon icon-reddit notranslate" aria-hidden="true"></i> </a> <a href="http://news.ycombinator.com/submitlink?u=https://www.yegor256.com/2015/03/26/jaxb-vs-xembly.html%3F2015-12&amp;t=JAXB+Is+Doing+It+Wrong%3B+Try+Xembly" title="Share on Hacker News" class="button" rel="nofollow"> <span class="count count-hackernews">0</span> <i class="icon icon-hackernews notranslate" aria-hidden="true"></i> </a> </nav> </header> <article class="main" itemprop="articleBody"><div > <figure class='badge'><a href='http://www.xembly.org'><img src='http://img.xembly.org/logo-256x256.png' style='width:64px;max-width:100%;' alt='badge'/></a></figure><p><a href="http://en.wikipedia.org/wiki/Java_Architecture_for_XML_Binding">JAXB</a> is a 10-year-old Java technology that allows us to convert a Java object into an XML document (marshalling) and back (unmarshalling). This technology is based on <a href="/2014/09/16/getters-and-setters-are-evil.html">setters and getters</a> and, in my opinion, violates key principles of object-oriented programming by turning objects into <strong>passive data structures</strong>. I would recommend you use <a href="http://www.xembly.org">Xembly</a> instead for marshalling Java objects into XML documents.</p><p>This is how JAXB marshalling works. Say you have a <code>Book</code> class that needs to be marshalled into an XML document. You have to create getters and annotate them:</p><figure class="highlight"><pre><code class="language-java" data-lang="java"><span></span><span class="kn">import</span> <span class="nn">javax.xml.bind.annotation.XmlElement</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">javax.xml.bind.annotation.XmlRootElement</span><span class="o">;</span>
<span class="nd">@XmlRootElement</span>
<span class="kd">public</span> <span class="kd">class</span> <span class="nc">Book</span> <span class="o">{</span>
  <span class="kd">private</span> <span class="kd">final</span> <span class="n">String</span> <span class="n">isbn</span><span class="o">;</span>
  <span class="kd">private</span> <span class="kd">final</span> <span class="n">String</span> <span class="n">title</span><span class="o">;</span>
  <span class="kd">public</span> <span class="nf">Book</span><span class="o">(</span><span class="kd">final</span> <span class="n">String</span> <span class="n">isbn</span><span class="o">,</span> <span class="kd">final</span> <span class="n">String</span> <span class="n">title</span><span class="o">)</span> <span class="o">{</span>
    <span class="k">this</span><span class="o">.</span><span class="na">isbn</span> <span class="o">=</span> <span class="n">isbn</span><span class="o">;</span>
    <span class="k">this</span><span class="o">.</span><span class="na">title</span> <span class="o">=</span> <span class="n">title</span><span class="o">;</span>
  <span class="o">}</span>
  <span class="nd">@XmlElement</span>
  <span class="kd">public</span> <span class="n">String</span> <span class="nf">getIsbn</span><span class="o">()</span> <span class="o">{</span>
    <span class="k">return</span> <span class="k">this</span><span class="o">.</span><span class="na">isbn</span><span class="o">;</span>
  <span class="o">}</span>
  <span class="nd">@XmlElement</span>
  <span class="kd">public</span> <span class="n">String</span> <span class="nf">getTitle</span><span class="o">()</span> <span class="o">{</span>
    <span class="k">return</span> <span class="k">this</span><span class="o">.</span><span class="na">title</span><span class="o">;</span>
  <span class="o">}</span>
<span class="o">}</span></code></pre></figure><p>Then you create a marshaller and ask it to convert an instance of class <code>Book</code> into XML:</p><figure class="highlight"><pre><code class="language-java" data-lang="java"><span></span><span class="kd">final</span> <span class="n">Book</span> <span class="n">book</span> <span class="o">=</span> <span class="k">new</span> <span class="n">Book</span><span class="o">(</span><span class="s">&quot;0132350882&quot;</span><span class="o">,</span> <span class="s">&quot;Clean Code&quot;</span><span class="o">);</span>
<span class="kd">final</span> <span class="n">JAXBContext</span> <span class="n">context</span> <span class="o">=</span> <span class="n">JAXBContext</span><span class="o">.</span><span class="na">newInstance</span><span class="o">(</span><span class="n">Book</span><span class="o">.</span><span class="na">class</span><span class="o">);</span>
<span class="kd">final</span> <span class="n">Marshaller</span> <span class="n">marshaller</span> <span class="o">=</span> <span class="n">jaxbContext</span><span class="o">.</span><span class="na">createMarshaller</span><span class="o">();</span>
<span class="n">marshaller</span><span class="o">.</span><span class="na">marshal</span><span class="o">(</span><span class="n">book</span><span class="o">,</span> <span class="n">System</span><span class="o">.</span><span class="na">out</span><span class="o">);</span></code></pre></figure><p>You should be expecting something like this in the output:</p><figure class="highlight"><pre><code class="language-xml" data-lang="xml"><span></span><span class="cp">&lt;?xml version=&quot;1.0&quot;?&gt;</span>
<span class="nt">&lt;book&gt;</span>
  <span class="nt">&lt;isbn&gt;</span>0132350882<span class="nt">&lt;/isbn&gt;</span>
  <span class="nt">&lt;title&gt;</span>Clean Code<span class="nt">&lt;/title&gt;</span>
<span class="nt">&lt;/book&gt;</span></code></pre></figure><p>So what&#39;s wrong with it? Pretty much the same thing that&#39;s wrong with object-relational mapping, which is explained in <a href="/2014/12/01/orm-offensive-anti-pattern.html">ORM Is an Offensive Anti-Pattern</a>. JAXB is treating an object as a bag of data, extracting the data and converting it into XML the way JAXB wants. The object has no control over this process. Therefore an object is not <a href="/2014/11/20/seven-virtues-of-good-object.html">an object</a> anymore but rather a passive bag of data.</p><p>An ideal approach would be to redesign our class <code>Book</code> this way:</p><figure class="highlight"><pre><code class="language-java" data-lang="java"><span></span><span class="kd">public</span> <span class="kd">class</span> <span class="nc">Book</span> <span class="o">{</span>
  <span class="kd">private</span> <span class="kd">final</span> <span class="n">String</span> <span class="n">isbn</span><span class="o">;</span>
  <span class="kd">private</span> <span class="kd">final</span> <span class="n">String</span> <span class="n">title</span><span class="o">;</span>
  <span class="kd">public</span> <span class="nf">Book</span><span class="o">(</span><span class="kd">final</span> <span class="n">String</span> <span class="n">isbn</span><span class="o">,</span> <span class="kd">final</span> <span class="n">String</span> <span class="n">title</span><span class="o">)</span> <span class="o">{</span>
    <span class="k">this</span><span class="o">.</span><span class="na">isbn</span> <span class="o">=</span> <span class="n">isbn</span><span class="o">;</span>
    <span class="k">this</span><span class="o">.</span><span class="na">title</span> <span class="o">=</span> <span class="n">title</span><span class="o">;</span>
  <span class="o">}</span>
  <span class="kd">public</span> <span class="n">String</span> <span class="nf">toXML</span><span class="o">()</span> <span class="o">{</span>
    <span class="c1">// create XML document and return</span>
  <span class="o">}</span>
<span class="o">}</span></code></pre></figure><p>However, there are a few problems with this approach. First of all, there&#39;s massive code duplication. Building an XML document is a rather verbose process in Java. If every class had to re-implement it in its <code>toXML()</code> method, we would have a big problem with duplicate code.</p><p>The second problem is that we don&#39;t know exactly what type of wrapping our XML document should be delivered in. It may be a <code>String</code> or an <code>InputStream</code> or maybe an instance of <code>org.w3c.dom.Document</code>. Making many <code>toXML()</code> methods in each object would definitely be a disaster.</p><p><a href="http://www.xembly.org">Xembly</a> provides a solution. As I&#39;ve <a href="/2014/04/09/xembly-intro.html">mentioned before</a>, it is an imperative language for XML constructions and manipulations. Here is how we can implement our <code>Book</code> object with the help of Xembly:</p><figure class="highlight"><pre><code class="language-java" data-lang="java"><span></span><span class="kn">import</span> <span class="nn">org.xembly.Directive</span><span class="o">;</span>
<span class="kd">public</span> <span class="kd">class</span> <span class="nc">Book</span> <span class="o">{</span>
  <span class="kd">private</span> <span class="kd">final</span> <span class="n">String</span> <span class="n">isbn</span><span class="o">;</span>
  <span class="kd">private</span> <span class="kd">final</span> <span class="n">String</span> <span class="n">title</span><span class="o">;</span>
  <span class="kd">public</span> <span class="nf">Book</span><span class="o">(</span><span class="kd">final</span> <span class="n">String</span> <span class="n">isbn</span><span class="o">,</span> <span class="kd">final</span> <span class="n">String</span> <span class="n">title</span><span class="o">)</span> <span class="o">{</span>
    <span class="k">this</span><span class="o">.</span><span class="na">isbn</span> <span class="o">=</span> <span class="n">isbn</span><span class="o">;</span>
    <span class="k">this</span><span class="o">.</span><span class="na">title</span> <span class="o">=</span> <span class="n">title</span><span class="o">;</span>
  <span class="o">}</span>
  <span class="kd">public</span> <span class="n">Iterable</span><span class="o">&lt;</span><span class="n">Directive</span><span class="o">&gt;</span> <span class="nf">toXembly</span><span class="o">()</span> <span class="o">{</span>
    <span class="k">return</span> <span class="k">new</span> <span class="n">Directives</span><span class="o">()</span>
      <span class="o">.</span><span class="na">add</span><span class="o">(</span><span class="s">&quot;book&quot;</span><span class="o">)</span>
      <span class="o">.</span><span class="na">add</span><span class="o">(</span><span class="s">&quot;isbn&quot;</span><span class="o">).</span><span class="na">set</span><span class="o">(</span><span class="k">this</span><span class="o">.</span><span class="na">isbn</span><span class="o">).</span><span class="na">up</span><span class="o">()</span>
      <span class="o">.</span><span class="na">add</span><span class="o">(</span><span class="s">&quot;title&quot;</span><span class="o">).</span><span class="na">set</span><span class="o">(</span><span class="k">this</span><span class="o">.</span><span class="na">title</span><span class="o">).</span><span class="na">up</span><span class="o">()</span>
      <span class="o">.</span><span class="na">up</span><span class="o">();</span>
  <span class="o">}</span>
<span class="o">}</span></code></pre></figure><p>Now, in order to build an XML document, we should use this code outside the object:</p><figure class="highlight"><pre><code class="language-java" data-lang="java"><span></span><span class="kd">final</span> <span class="n">Book</span> <span class="n">book</span> <span class="o">=</span> <span class="k">new</span> <span class="n">Book</span><span class="o">(</span><span class="s">&quot;0132350882&quot;</span><span class="o">,</span> <span class="s">&quot;Clean Code&quot;</span><span class="o">);</span>
<span class="kd">final</span> <span class="n">String</span> <span class="n">xml</span> <span class="o">=</span> <span class="k">new</span> <span class="n">Xembler</span><span class="o">(</span><span class="n">book</span><span class="o">.</span><span class="na">toXembly</span><span class="o">()).</span><span class="na">xml</span><span class="o">();</span></code></pre></figure><p>This <a href="http://www.xembly.org/apidocs-0.21/org/xembly/Xembler.html"><code>Xembler</code></a> class will convert Xembly directives into an XML document.</p><p>The beauty of this solution is that the internals of the object are not exposed via getters and the object is fully in charge of the XML marshalling process. In addition, the complexity of these directives may be very high---much higher than the rather cumbersome <a href="/2016/04/12/java-annotations-are-evil.html">annotations</a> of JAXB.</p><p>Xembly is an open source project, so feel free to submit your questions or corrections to <a href="https://github.com/yegor256/xembly">GitHub</a>.</p></div></article></div><div class="wrapper"> <related-posts /></div><div class="disqus" role="complementary"><p class="disqus_hint"> Please, use <a href="https://help.disqus.com/commenting/what-html-tags-are-allowed-within-comments">syntax highlighting</a> in your comments, to make them more readable.</p><div id="disqus_thread" class="disqus-thread"> <a>&nbsp;</a></div><script> var disqus_config = function () { this.page.url = document.location.href.split('?')[0].split('#')[0].replace('https://', 'http://'); this.page.identifier = this.page.url; }; (function() { var d = document, s = d.createElement('script'); s.src = '//yegor256.disqus.com/embed.js'; s.setAttribute('data-timestamp', +new Date()); (d.head || d.body).appendChild(s); })(); </script> <noscript><div><p class="red"> JavaScript is disabled in your browser, that's why you can't see comments under this post.</p></div></noscript></div><div class="wrapper"> <footer class="footer"><p> &copy; <span itemscope="" itemprop="copyrightHolder" itemtype="http://schema.org/Person"> <span itemprop="name">Yegor Bugayenko</span> </span> 2014&ndash;<span itemprop="copyrightYear">2018</span></p></footer></div></section><div class="wrapper unprintable" style="text-align:center;margin-top:2em;"> <a href="http://www.sixnines.io/h/3ba1652f"> <img src="//www.sixnines.io/b/3ba1652f?style=flat" alt="sixnines availability badge"/> </a></div><script src="//code.jquery.com/jquery-1.9.0.min.js"></script> <script src="/js/all.js?4e047f6f42b"></script> <script>var disqus_shortname = 'yegor256';</script> <script id="dsq-count-scr" src="//yegor256.disqus.com/count.js" async="async"></script> <script> (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){ (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o), m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m) })(window,document,'script','//www.google-analytics.com/analytics.js','ga'); ga('create', 'UA-1963507-32', 'auto'); ga('send', 'pageview'); </script> <script> Cd=document;Cr="&"+Math.random();Cp="&s=1"; Cd.cookie="b=b";if(Cd.cookie)Cp+="&c=1"; Cp+="&t="+(new Date()).getTimezoneOffset(); if(self!=top)Cp+="&f=1"; </script> <script> if(navigator.javaEnabled())Cp+="&j=1"; </script> <script> if(typeof(screen)!='undefined')Cp+="&w="+screen.width+"&h="+ screen.height+"&d="+(screen.colorDepth?screen.colorDepth:screen.pixelDepth); </script> <script> Cd.write("<img src='//c.hit.ua/hit?i=95870&g=0&x=2"+Cp+Cr+ "&r="+escape(Cd.referrer)+"&u="+escape(window.location.href)+ "' border='0' wi"+"dth='1' he"+"ight='1'/>"); </script> <script type="application/ld+json"> { "@context": "http://schema.org", "@type": "Person", "name": "Yegor Bugayenko", "url": "http://www.yegor256.com", "sameAs": [ "https://www.facebook.com/yegor256", "https://instagram.com/yegor256", "https://www.linkedin.com/in/yegor256", "https://twitter.com/yegor256", "https://github.com/yegor256", "https://www.pinterest.com/yegor256/" ] } </script> </body> </html> <!DOCTYPE html> <html xmlns="http://www.w3.org/1999/xhtml" lang="en-US" xml:lang="en-US" itemscope="" itemtype="http://schema.org/WebSite"> <head> <meta charset="utf-8"/> <meta name="description" content="Takes is a pure object-oriented and immutable Java web framework that turns the design and development of web applications into a pleasant and fun process. " /> <meta name="keywords" content="best java web framework, java web app framework, java web development framework, java web framework, object-oriented java web framework" /> <meta name="viewport" content="width=device-width,minimum-scale=1,initial-scale=1"/> <meta name="google-site-verification" content="JEj_gQr2CPe2QKGw8XdMz0R7VboQIUbX3FlM-lwTq-8" /> <meta name="author" content="Yegor Bugayenko"> <meta name="article:published_time" content="2015-03-22 00:00:00 +0000"> <meta name="og:site_name" content="Yegor Bugayenko"/> <meta name="og:type" content="article" /> <meta name="og:locale" content="en_US" /> <meta name="twitter:account_id" content="4503599630178231" /> <meta name="twitter:creator" content="@yegor256"/> <meta name="twitter:site" content="@yegor256"/> <meta name="twitter:title" property="og:title" content="Java Web App Architecture In Takes Framework"/> <meta name="twitter:description" property="og:description" content="Takes is a pure object-oriented and immutable Java web framework that turns the design and development of web applications into a pleasant and fun process. "/> <meta name="twitter:url" property="og:url" content="https://www.yegor256.com/2015/03/22/takes-java-web-framework.html"/> <meta name="telegram:channel" content="AAAAAEJFMRzsRTRxM3ec6A"/> <link rel="search" type="application/opensearchdescription+xml" href="/opensearch.xml" title="yegor256" /> <link rel="shortcut icon" href="/favicon.ico?4e047f6f42b"/> <link rel="apple-touch-icon" href="/favicon.ico?4e047f6f42b"/> <link rel="alternate" type="application/rss+xml" title="RSS for yegor256.com" href="https://www.yegor256.com/rss.xml"/> <link rel="stylesheet" href="/css/layout.css?4e047f6f42b"/> <link rel="stylesheet" href="/css/icons.css?4e047f6f42b"/> <link rel="canonical" href="https://www.yegor256.com/2015/03/22/takes-java-web-framework.html" /> <link rel="amphtml" href="https://www.yegor256.com/2015/03/22/takes-java-web-framework.amp.html" /> <title>Java Web App Architecture In Takes Framework </title> <meta name='og:image' content='https://www.yegor256.com/images/2015/03/godfather-shooting-scene.jpg'/><meta name='twitter:image' content='https://www.yegor256.com/images/2015/03/godfather-shooting-scene.jpg'/><meta name='og:image:width' content='1000'/> <meta name='twitter:image:width' content='1000'/><meta name='og:image:height' content='583'/> <meta name='twitter:image:height' content='583'/><meta name='twitter:card' content='summary_large_image'/><meta name='twitter:image:alt' content='Making of The Godfather (1972) by Francis Ford Coppola'/> </head> <body><div class="wrapper"> <aside class="header-toggle unprintable" id="header-toggle" title="Show the menu" onclick="$('#header').show();$('#header-toggle').hide();">&#9776;</aside> <header class="header" id="header"><div class="face"> <a href="/about-me.html#form" class="sub" title="Click to subscribe to my monthly newsletter"><span>Subscribe</span></a> <a href="/about-me.html" style="position:relative;"> <img src="/images/face-256x256.jpg" class="photo" alt="Yegor Bugayenko"/> </a></div><nav><ul class="menu social notranslate"> <li><a href="https://twitter.com/intent/follow?screen_name=yegor256" rel="nofollow" title="Follow me on Twitter"><i class="icon icon-twitter notranslate" aria-hidden="true"></i></a></li> <li><a href="/rss.xml" rel="nofollow" title="Subscribe to my RSS feed"><i class="icon icon-rss notranslate" aria-hidden="true"></i></a></li> <li><a itemprop="sameAs" href="https://github.com/yegor256" rel="nofollow" title="My GitHub profile"><i class="icon icon-github notranslate" aria-hidden="true"></i></a></li> <li><a itemprop="sameAs" href="http://stackoverflow.com/users/187141/yegor256" rel="nofollow" title="My StackOverflow profile"><i class="icon icon-stackoverflow notranslate" aria-hidden="true"></i></a></li> <li><a itemprop="sameAs" href="https://www.facebook.com/yegor256" rel="nofollow" title="Follow me on Facebook"><i class="icon icon-facebook notranslate" aria-hidden="true"></i></a></li> <li><a itemprop="sameAs" href="https://instagram.com/yegor256" rel="nofollow" title="Follow me on Instagram"><i class="icon icon-instagram notranslate" aria-hidden="true"></i></a></li> <li><a itemprop="sameAs" href="https://www.linkedin.com/in/yegor256" rel="nofollow" title="My LinkedIn profile"><i class="icon icon-linkedin notranslate" aria-hidden="true"></i></a></li> <li><a itemprop="sameAs" href="https://www.youtube.com/c/yegor256?sub_confirmation=1" rel="nofollow" title="My Youtube video channel"><i class="icon icon-youtube notranslate" aria-hidden="true"></i></a></li> <li><a itemprop="sameAs" href="https://www.pinterest.com/yegor256/" rel="nofollow" title="My Pinterest boards"><i class="icon icon-pinterest notranslate" aria-hidden="true"></i></a></li> <li><a itemprop="sameAs" href="https://angel.co/yegor256" rel="nofollow" title="My AngelList profile"><i class="icon icon-angellist notranslate" aria-hidden="true"></i></a></li> <li><a href="https://soundcloud.com/yegor256" rel="nofollow" title="My podcast"><i class="icon icon-podcast notranslate" aria-hidden="true"></i></a></li> <li><a href="https://itunes.apple.com/us/podcast/yegor256-podcast/id1150826721" rel="nofollow" title="My iTunes podcast"><i class="icon icon-itunes notranslate" aria-hidden="true"></i></a></li> <li><a href="https://t.me/joinchat/AAAAAEJFMRzsRTRxM3ec6A" rel="nofollow" title="My Telegram public channel"><i class="icon icon-telegram notranslate" aria-hidden="true"></i></a></li> <li><a href="mailto:blog@yegor256.com" rel="nofollow" title="Email me any time"><i class="icon icon-mail notranslate" aria-hidden="true"></i></a></li></ul><ul class="menu"> <li><a href="/" title="Home page">Home</a></li> <li ><a href="/best.html" title="Best articles to read">12&#160;Best</a></li> <li ><a href="/contents.html" title="The contents of the entire blog">All&#160;288</a></li> <li ><a href="/webinars.html" title="My webinars">Webinars</a></li> <li ><a href="/talks.html" title="Future and past conference talks">Talks</a></li> <li ><a href="/books.html" title="The books I wrote">Books</a></li> <li ><a href="/papers.html" title="My academic papers and patents">Papers</a></li> <li ><a href="/pets.html" title="My loved pet projects">Pets</a></li> <li ><a href="/award.html" title="Software quality award">Award</a></li> <li ><a href="/testimonials.html" title="What some people say about me">Testimonials</a></li> <li ><a href="/shift-m.html" title="Audio podcast about project management">Shift-M</a></li> <li ><a href="/paintings.html" title="My paintings for sale">Paintings</a></li> <li><a href="http://ru.yegor256.com/" title="Немного на русском языке">По-русски</a></li></ul></nav><div class="search"> <form method="get" action="https://www.google.com/search" itemprop="potentialAction" itemscope="" itemtype="http://schema.org/SearchAction"> <meta itemprop="target" content="https://www.google.com/search?q={q}"/> <input name="sitesearch" value="yegor256.com" type="hidden"/> <input itemprop="query-input" type="text" id="search-query" class="field field-text" required="required" onfocus="$('.google').css('visibility', 'visible');" name="q" placeholder="Search..." autocomplete="off"/> <input type="image" src="/images/google-search-icon.svg" class="google" title="Search via Google" alt="Search via Google"/> </form></div><div class="hot"><ul> <li> <a href="/code-ahead.html">Code Ahead</a> was published on Amazon just a few days ago! It is my new book, a novel about programmers. It explains in details the majority of ideas that stand behind <a href="https://www.zerocracy.com">Zerocracy</a> and <a href="https://www.xdsd.org">XDSD</a>. </li> <li> At <a href="/webinars.html">Webinar #37</a> we will discuss naming problem in OOP, for objects, methods and attributes; join us on <b>September 12</b>, at 11am PST. </li></ul></div></header></div><section itemscope="" itemtype="http://schema.org/BlogPosting"><div class="wrapper"> <header><p class="printable"> <img src="https://api.qrserver.com/v1/create-qr-code/?data=https://www.yegor256.com/2015/03/22/takes-java-web-framework.html&amp;format=svg" style="width:125px;height:125px;" alt="QR code"/></p><p class="printable"> <code itemprop="url">https://www.yegor256.com/2015/03/22/takes-java-web-framework.html</code></p><h1 itemprop="name headline mainEntityOfPage">Java Web App Architecture In Takes Framework</h1><ul class="subline"> <li> <time itemprop="datePublished" datetime="2015-03-22T00:00:00+00:00"> 22 March 2015 </time> </li> <li class="printable" itemscope="" itemprop="author" itemtype="http://schema.org/Person"> <span itemprop="name">Yegor Bugayenko</span> </li> <li class="unprintable"> <i class="icon icon-comments"></i> <a href="http://www.yegor256.com/2015/03/22/takes-java-web-framework.html#disqus_thread" itemprop="discussionUrl">comments</a> </li></ul><figure class='jb_picture'><img itemprop='image' alt='Making of The Godfather (1972) by Francis Ford Coppola' src='/images/2015/03/godfather-shooting-scene.jpg' longdesc='#9fedcf46'/><figcaption id='9fedcf46'>Making of The Godfather (1972) by Francis Ford Coppola</figcaption></figure><h2 id="java-web-architecture-in-a-nutshell">Java Web Architecture in a Nutshell</h2><p>This is how I understand a web application architecture and its components, in simple terms.</p><aside class='youtube'> <a href='https://www.youtube.com/watch?v=nheD2LNYrpk'><div class='box'> <img src='https://i.ytimg.com/vi/nheD2LNYrpk/mqdefault.jpg' alt='YouTube video #nheD2LNYrpk'/><div class='play'><i class='icon icon-play'></i></div></div></a><div>Takes, Java Web Framework, Intro (webinar #12); 2 March 2016.</div></aside><p>First, to create a web server, we should create a new <a href="http://en.wikipedia.org/wiki/Network_socket">network socket</a>, that accepts connections on a certain <a href="http://en.wikipedia.org/wiki/Port_%28computer_networking%29">TCP port</a>. Usually it is 80, but I&#39;m going to use 8080 for testing purposes. This is done in Java with the <a href="http://docs.oracle.com/javase/7/docs/api/java/net/ServerSocket.html"><code>ServerSocket</code></a> class:</p><figure class="highlight"><pre><code class="language-java" data-lang="java"><span></span><span class="kn">import</span> <span class="nn">java.net.ServerSocket</span><span class="o">;</span>
<span class="kd">public</span> <span class="kd">class</span> <span class="nc">Foo</span> <span class="o">{</span>
  <span class="kd">public</span> <span class="kd">static</span> <span class="kt">void</span> <span class="nf">main</span><span class="o">(</span><span class="kd">final</span> <span class="n">String</span><span class="o">...</span> <span class="n">args</span><span class="o">)</span> <span class="kd">throws</span> <span class="n">Exception</span> <span class="o">{</span>
    <span class="kd">final</span> <span class="n">ServerSocket</span> <span class="n">server</span> <span class="o">=</span> <span class="k">new</span> <span class="n">ServerSocket</span><span class="o">(</span><span class="mi">8080</span><span class="o">);</span>
    <span class="k">while</span> <span class="o">(</span><span class="kc">true</span><span class="o">);</span>
  <span class="o">}</span>
<span class="o">}</span></code></pre></figure><p>That&#39;s enough to start a web server. Now, the socket is ready and listening on port 8080. When someone opens <code>http://localhost:8080</code> in their browser, the connection will be established and the browser will spin its waiting wheel forever. Compile this snippet and try. We just built a simple web server without the use of any frameworks. We&#39;re not doing anything with incoming connections yet, but we&#39;re not rejecting them either. All of them are being lined up inside that <code>server</code> object. It&#39;s being done in a background thread; that&#39;s why we need to put that <code>while(true)</code> in afterward. Without this endless pause, the app will finish its execution immediately and the server socket will shut down.</p><p>The next step is to accept the incoming connections. In Java, that&#39;s done through a blocking call to the <code>accept()</code> method:</p><figure class="highlight"><pre><code class="language-java" data-lang="java"><span></span><span class="kd">final</span> <span class="n">Socket</span> <span class="n">socket</span> <span class="o">=</span> <span class="n">server</span><span class="o">.</span><span class="na">accept</span><span class="o">();</span></code></pre></figure><p>The method is blocking its thread and waiting until a new connection arrives. As soon as that happens, it returns an instance of <code>Socket</code>. In order to accept the next connection, we should call <code>accept()</code> again. So basically, our web server should work like this:</p><figure class="highlight"><pre><code class="language-java" data-lang="java"><span></span><span class="kd">public</span> <span class="kd">class</span> <span class="nc">Foo</span> <span class="o">{</span>
  <span class="kd">public</span> <span class="kd">static</span> <span class="kt">void</span> <span class="nf">main</span><span class="o">(</span><span class="kd">final</span> <span class="n">String</span><span class="o">...</span> <span class="n">args</span><span class="o">)</span> <span class="kd">throws</span> <span class="n">Exception</span> <span class="o">{</span>
    <span class="kd">final</span> <span class="n">ServerSocket</span> <span class="n">server</span> <span class="o">=</span> <span class="k">new</span> <span class="n">ServerSocket</span><span class="o">(</span><span class="mi">8080</span><span class="o">);</span>
    <span class="k">while</span> <span class="o">(</span><span class="kc">true</span><span class="o">)</span> <span class="o">{</span>
      <span class="kd">final</span> <span class="n">Socket</span> <span class="n">socket</span> <span class="o">=</span> <span class="n">server</span><span class="o">.</span><span class="na">accept</span><span class="o">();</span>
      <span class="c1">// 1. Read HTTP request from the socket</span>
      <span class="c1">// 2. Prepare an HTTP response</span>
      <span class="c1">// 3. Send HTTP response to the socket</span>
      <span class="c1">// 4. Close the socket</span>
    <span class="o">}</span>
  <span class="o">}</span>
<span class="o">}</span></code></pre></figure><p>It&#39;s an endless cycle that accepts a new connection, understands it, creates a response, returns the response, and accepts a new connection again. HTTP protocol is stateless, which means the server should not remember what happened in any previous connection. All it cares about is the incoming HTTP request in this particular connection.</p><p>The HTTP request is coming from the input stream of the socket and looks like a multi-line block of text. This is what you would see if you read an input stream of the socket:</p><figure class="highlight"><pre><code class="language-java" data-lang="java"><span></span><span class="kd">final</span> <span class="n">BufferedReader</span> <span class="n">reader</span> <span class="o">=</span> <span class="k">new</span> <span class="n">BufferedReader</span><span class="o">(</span>
  <span class="k">new</span> <span class="n">InputStreamReader</span><span class="o">(</span><span class="n">socket</span><span class="o">.</span><span class="na">getInputStream</span><span class="o">())</span>
<span class="o">);</span>
<span class="k">while</span> <span class="o">(</span><span class="kc">true</span><span class="o">)</span> <span class="o">{</span>
  <span class="kd">final</span> <span class="n">String</span> <span class="n">line</span> <span class="o">=</span> <span class="n">reader</span><span class="o">.</span><span class="na">readLine</span><span class="o">();</span>
  <span class="k">if</span> <span class="o">(</span><span class="n">line</span><span class="o">.</span><span class="na">isEmpty</span><span class="o">())</span> <span class="o">{</span>
    <span class="k">break</span><span class="o">;</span>
  <span class="o">}</span>
  <span class="n">System</span><span class="o">.</span><span class="na">out</span><span class="o">.</span><span class="na">println</span><span class="o">(</span><span class="n">line</span><span class="o">);</span>
<span class="o">}</span></code></pre></figure><p>You will see something like this:</p><figure class="highlight"><pre><code class="language-text" data-lang="text"><span></span>GET / HTTP/1.1
Host: localhost:8080
Connection: keep-alive
Cache-Control: max-age=0
Accept: text/html,application/xhtml+xml,application/xml;q=0.9,image/webp,*/*;q=0.8
User-Agent: Mozilla/5.0 (Macintosh; Intel Mac OS X 10_10_2) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/41.0.2272.89 Safari/537.36
Accept-Encoding: gzip, deflate, sdch
Accept-Language: en-US,en;q=0.8,ru;q=0.6,uk;q=0.4</code></pre></figure><p>The client (the Google Chrome browser, for example) passes this text into the connection established. It connects to port 8080 at <code>localhost</code>, and as soon as the connection is ready, it immediately sends this text into it, then waits for a response.</p><p>Our job is to create an HTTP response using the information we get in the request. If our server is very primitive, we can basically ignore all the information in the request and just return &quot;Hello, world!&quot; to all requests (I&#39;m using <a href="https://commons.apache.org/proper/commons-io/javadocs/api-2.5/org/apache/commons/io/IOUtils.html"><code>IOUtils</code></a> for simplicity):</p><figure class="highlight"><pre><code class="language-java" data-lang="java"><span></span><span class="kn">import</span> <span class="nn">java.net.Socket</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">java.net.ServerSocket</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">org.apache.commons.io.IOUtils</span><span class="o">;</span>
<span class="kd">public</span> <span class="kd">class</span> <span class="nc">Foo</span> <span class="o">{</span>
  <span class="kd">public</span> <span class="kd">static</span> <span class="kt">void</span> <span class="nf">main</span><span class="o">(</span><span class="kd">final</span> <span class="n">String</span><span class="o">...</span> <span class="n">args</span><span class="o">)</span> <span class="kd">throws</span> <span class="n">Exception</span> <span class="o">{</span>
    <span class="kd">final</span> <span class="n">ServerSocket</span> <span class="n">server</span> <span class="o">=</span> <span class="k">new</span> <span class="n">ServerSocket</span><span class="o">(</span><span class="mi">8080</span><span class="o">);</span>
    <span class="k">while</span> <span class="o">(</span><span class="kc">true</span><span class="o">)</span> <span class="o">{</span>
      <span class="k">try</span> <span class="o">(</span><span class="kd">final</span> <span class="n">Socket</span> <span class="n">socket</span> <span class="o">=</span> <span class="n">server</span><span class="o">.</span><span class="na">accept</span><span class="o">())</span> <span class="o">{</span>
        <span class="n">IOUtils</span><span class="o">.</span><span class="na">copy</span><span class="o">(</span>
          <span class="n">IOUtils</span><span class="o">.</span><span class="na">toInputStream</span><span class="o">(</span><span class="s">&quot;HTTP/1.1 200 OK\r\n\r\nHello, world!&quot;</span><span class="o">),</span>
          <span class="n">socket</span><span class="o">.</span><span class="na">getOutputStream</span><span class="o">()</span>
        <span class="o">);</span>
      <span class="o">}</span>
    <span class="o">}</span>
  <span class="o">}</span>
<span class="o">}</span></code></pre></figure><p>That&#39;s it. The server is ready. Try to compile and run it. Point your browser to <code>http://localhost:8080</code>, and you will see <code>Hello, world!</code>:</p><figure class="highlight"><pre><code class="language-bash" data-lang="bash"><span></span>$ javac -cp commons-io.jar Foo.java
$ java -cp commons-io.jar:. Foo <span class="p">&amp;</span>
$ curl http://localhost:8080 -v
* Rebuilt URL to: http://localhost:8080/
* Connected to localhost <span class="o">(</span>::1<span class="o">)</span> port <span class="m">8080</span> <span class="o">(</span><span class="c1">#0)</span>
&gt; GET / HTTP/1.1
&gt; User-Agent: curl/7.37.1
&gt; Host: localhost:8080
&gt; Accept: */*
&gt;
&lt; HTTP/1.1 <span class="m">200</span> OK
* no chunk, no close, no size. Assume close to signal end
&lt;
* Closing connection <span class="m">0</span>
Hello, world!</code></pre></figure><p>That&#39;s all you need to build a web server. Now let&#39;s discuss how to make it object-oriented and composable. Let&#39;s try to see how the <a href="http://www.takes.org">Takes</a> framework was built.</p><h2 id="routing-dispatching">Routing/Dispatching</h2><p>Routing/dispatching is combined with response printing in Takes. All you need to do to create a working web application is to create a single class that implements <a href="http://static.javadoc.io/org.takes/takes/1.1/org/takes/Take.html"><code>Take</code></a> interface:</p><figure class="highlight"><pre><code class="language-java" data-lang="java"><span></span><span class="kn">import</span> <span class="nn">org.takes.Request</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">org.takes.Take</span><span class="o">;</span>
<span class="kd">public</span> <span class="kd">final</span> <span class="kd">class</span> <span class="nc">TkFoo</span> <span class="kd">implements</span> <span class="n">Take</span> <span class="o">{</span>
  <span class="nd">@Override</span>
  <span class="kd">public</span> <span class="n">Response</span> <span class="nf">route</span><span class="o">(</span><span class="kd">final</span> <span class="n">Request</span> <span class="n">request</span><span class="o">)</span> <span class="o">{</span>
    <span class="k">return</span> <span class="k">new</span> <span class="n">RsText</span><span class="o">(</span><span class="s">&quot;Hello, world!&quot;</span><span class="o">);</span>
  <span class="o">}</span>
<span class="o">}</span></code></pre></figure><p>And now it&#39;s time to start a server:</p><figure class="highlight"><pre><code class="language-java" data-lang="java"><span></span><span class="kn">import</span> <span class="nn">org.takes.http.Exit</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">org.takes.http.FtBasic</span><span class="o">;</span>
<span class="kd">public</span> <span class="kd">class</span> <span class="nc">Foo</span> <span class="o">{</span>
  <span class="kd">public</span> <span class="kd">static</span> <span class="kt">void</span> <span class="nf">main</span><span class="o">(</span><span class="kd">final</span> <span class="n">String</span><span class="o">...</span> <span class="n">args</span><span class="o">)</span> <span class="kd">throws</span> <span class="n">Exception</span> <span class="o">{</span>
    <span class="k">new</span> <span class="n">FtBasic</span><span class="o">(</span><span class="k">new</span> <span class="n">TkFoo</span><span class="o">(),</span> <span class="mi">8080</span><span class="o">).</span><span class="na">start</span><span class="o">(</span><span class="n">Exit</span><span class="o">.</span><span class="na">NEVER</span><span class="o">);</span>
  <span class="o">}</span>
<span class="o">}</span></code></pre></figure><p>This <a href="http://static.javadoc.io/org.takes/takes/1.1/org/takes/http/FtBasic.html"><code>FtBasic</code></a> class does the exact same socket manipulations explained above. It starts a server socket on port 8080 and dispatches all incoming connections through an instance of <code>TkFoo</code> that we are giving to its constructor. It does this dispatching in an endless cycle, checking every second whether it&#39;s time to stop with an instance of <a href="http://static.javadoc.io/org.takes/takes/1.1/org/takes/http/Exit.html"><code>Exit</code></a>. Obviously, <code>Exit.NEVER</code> always responds with, &quot;Don&#39;t stop, please.&quot;</p><h2 id="http-request">HTTP Request</h2><p>Now let&#39;s see what&#39;s inside the HTTP request arriving at <code>TkFoo</code> and what we can get out of it. This is how the <a href="http://static.javadoc.io/org.takes/takes/1.1/org/takes/Request.html"><code>Request</code></a> interface is defined in <a href="http://www.takes.org">Takes</a>:</p><figure class="highlight"><pre><code class="language-java" data-lang="java"><span></span><span class="kd">public</span> <span class="kd">interface</span> <span class="nc">Request</span> <span class="o">{</span>
  <span class="n">Iterable</span><span class="o">&lt;</span><span class="n">String</span><span class="o">&gt;</span> <span class="nf">head</span><span class="o">()</span> <span class="kd">throws</span> <span class="n">IOException</span><span class="o">;</span>
  <span class="n">InputStream</span> <span class="nf">body</span><span class="o">()</span> <span class="kd">throws</span> <span class="n">IOException</span><span class="o">;</span>
<span class="o">}</span></code></pre></figure><p>The request is divided into two parts: the head and the body. The head contains all lines that go before the empty line that starts a body, according to HTTP specification in <a href="http://www.w3.org/Protocols/rfc2616/rfc2616-sec5.html">RFC 2616</a>. There are many useful decorators for <code>Request</code> in the framework. For example, <code>RqMethod</code> will help you get the method name from the first line of the header:</p><figure class="highlight"><pre><code class="language-java" data-lang="java"><span></span><span class="kd">final</span> <span class="n">String</span> <span class="n">method</span> <span class="o">=</span> <span class="k">new</span> <span class="n">RqMethod</span><span class="o">(</span><span class="n">request</span><span class="o">).</span><span class="na">method</span><span class="o">();</span></code></pre></figure><p><code>RqHref</code> will help extract the query part and parse it. For example, this is the request:</p><figure class="highlight"><pre><code class="language-java" data-lang="java"><span></span><span class="n">GET</span> <span class="o">/</span><span class="n">user</span><span class="o">?</span><span class="n">id</span><span class="o">=</span><span class="mi">123</span> <span class="n">HTTP</span><span class="o">/</span><span class="mf">1.1</span>
<span class="nl">Host:</span> <span class="n">www</span><span class="o">.</span><span class="na">example</span><span class="o">.</span><span class="na">com</span></code></pre></figure><p>This code will extract that <code>123</code>:</p><figure class="highlight"><pre><code class="language-java" data-lang="java"><span></span><span class="kd">final</span> <span class="kt">int</span> <span class="n">id</span> <span class="o">=</span> <span class="n">Integer</span><span class="o">.</span><span class="na">parseInt</span><span class="o">(</span>
  <span class="k">new</span> <span class="n">RqHref</span><span class="o">(</span><span class="n">request</span><span class="o">).</span><span class="na">href</span><span class="o">().</span><span class="na">param</span><span class="o">(</span><span class="s">&quot;id&quot;</span><span class="o">).</span><span class="na">get</span><span class="o">(</span><span class="mi">0</span><span class="o">)</span>
<span class="o">);</span></code></pre></figure><p><code>RqPrint</code> can get the entire request or its body printed as a <code>String</code>:</p><figure class="highlight"><pre><code class="language-java" data-lang="java"><span></span><span class="kd">final</span> <span class="n">String</span> <span class="n">body</span> <span class="o">=</span> <span class="k">new</span> <span class="n">RqPrint</span><span class="o">(</span><span class="n">request</span><span class="o">).</span><span class="na">printBody</span><span class="o">();</span></code></pre></figure><p>The idea here is to keep the <code>Request</code> interface simple and provide this request parsing functionality to its decorators. This approach helps the framework keep classes small and cohesive. Each decorator is very small and solid, doing exactly one thing. All of these decorators are in the <a href="http://static.javadoc.io/org.takes/takes/1.1/org/takes/rq/package-summary.html"><code>org.takes.rq</code></a> package. As you already probably understand, the <code>Rq</code> prefix stands for <code>Request</code>.</p><h2 id="first-real-web-app">First Real Web App</h2><p>Let&#39;s create our first real web application, which will do something useful. I would recommend starting with an <code>Entry</code> class, which is required by Java to start an app from the command line:</p><figure class="highlight"><pre><code class="language-java" data-lang="java"><span></span><span class="kn">import</span> <span class="nn">org.takes.http.Exit</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">org.takes.http.FtCli</span><span class="o">;</span>
<span class="kd">public</span> <span class="kd">final</span> <span class="kd">class</span> <span class="nc">Entry</span> <span class="o">{</span>
  <span class="kd">public</span> <span class="kd">static</span> <span class="kt">void</span> <span class="nf">main</span><span class="o">(</span><span class="kd">final</span> <span class="n">String</span><span class="o">...</span> <span class="n">args</span><span class="o">)</span> <span class="kd">throws</span> <span class="n">Exception</span> <span class="o">{</span>
    <span class="k">new</span> <span class="n">FtCli</span><span class="o">(</span><span class="k">new</span> <span class="n">TkApp</span><span class="o">(),</span> <span class="n">args</span><span class="o">).</span><span class="na">start</span><span class="o">(</span><span class="n">Exit</span><span class="o">.</span><span class="na">NEVER</span><span class="o">);</span>
  <span class="o">}</span>
<span class="o">}</span></code></pre></figure><p>This class contains just a single <code>main()</code> static method that will be called by JVM when the app starts from the command line. As you see, it instantiates <a href="http://static.javadoc.io/org.takes/takes/1.1/org/takes/http/FtCli.html"><code>FtCli</code></a>, giving it an instance of class <code>TkApp</code> and command line arguments. We&#39;ll create the <code>TkApp</code> class in a second. <code>FtCli</code> (translates to &quot;front-end with command line interface&quot;) makes an instance of the same <code>FtBasic</code>, wrapping it into a few useful decorators and configuring it according to command line arguments. For example, <code>--port=8080</code> will be converted into a <code>8080</code> port number and passed as a second argument of the <code>FtBasic</code> constructor.</p><p>The web application itself is called <code>TkApp</code> and extends <code>TsWrap</code>:</p><figure class="highlight"><pre><code class="language-java" data-lang="java"><span></span><span class="kn">import</span> <span class="nn">org.takes.Take</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">org.takes.facets.fork.FkRegex</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">org.takes.facets.fork.TkFork</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">org.takes.tk.TkWrap</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">org.takes.tk.TkClasspath</span><span class="o">;</span>
<span class="kd">final</span> <span class="kd">class</span> <span class="nc">TkApp</span> <span class="kd">extends</span> <span class="n">TkWrap</span> <span class="o">{</span>
  <span class="n">TkApp</span><span class="o">()</span> <span class="o">{</span>
    <span class="kd">super</span><span class="o">(</span><span class="n">TkApp</span><span class="o">.</span><span class="na">make</span><span class="o">());</span>
  <span class="o">}</span>
  <span class="kd">private</span> <span class="kd">static</span> <span class="n">Take</span> <span class="nf">make</span><span class="o">()</span> <span class="o">{</span>
    <span class="k">return</span> <span class="k">new</span> <span class="n">TkFork</span><span class="o">(</span>
      <span class="k">new</span> <span class="n">FkRegex</span><span class="o">(</span><span class="s">&quot;/robots.txt&quot;</span><span class="o">,</span> <span class="s">&quot;&quot;</span><span class="o">),</span>
      <span class="k">new</span> <span class="n">FkRegex</span><span class="o">(</span><span class="s">&quot;/css/.*&quot;</span><span class="o">,</span> <span class="k">new</span> <span class="n">TkClasspath</span><span class="o">()),</span>
      <span class="k">new</span> <span class="n">FkRegex</span><span class="o">(</span><span class="s">&quot;/&quot;</span><span class="o">,</span> <span class="k">new</span> <span class="n">TkIndex</span><span class="o">())</span>
    <span class="o">);</span>
  <span class="o">}</span>
<span class="o">}</span></code></pre></figure><p>We&#39;ll discuss this <code>TkFork</code> class in a minute.</p><p>If you&#39;re using Maven, this is the <code>pom.xml</code> you should start with:</p><figure class="highlight"><pre><code class="language-xml" data-lang="xml"><span></span><span class="cp">&lt;?xml version=&quot;1.0&quot;?&gt;</span>
<span class="nt">&lt;project</span> <span class="na">xmlns=</span><span class="s">&quot;http://maven.apache.org/POM/4.0.0&quot;</span>
  <span class="na">xmlns:xsi=</span><span class="s">&quot;http://www.w3.org/2001/XMLSchema-instance&quot;</span>
  <span class="na">xsi:schemaLocation=</span><span class="s">&quot;http://maven.apache.org/POM/4.0.0</span>
<span class="s">    http://maven.apache.org/xsd/maven-4.0.0.xsd&quot;</span><span class="nt">&gt;</span>
  <span class="nt">&lt;modelVersion&gt;</span>4.0.0<span class="nt">&lt;/modelVersion&gt;</span>
  <span class="nt">&lt;groupId&gt;</span>foo<span class="nt">&lt;/groupId&gt;</span>
  <span class="nt">&lt;artifactId&gt;</span>foo<span class="nt">&lt;/artifactId&gt;</span>
  <span class="nt">&lt;version&gt;</span>1.0-SNAPSHOT<span class="nt">&lt;/version&gt;</span>
  <span class="nt">&lt;dependencies&gt;</span>
    <span class="nt">&lt;dependency&gt;</span>
      <span class="nt">&lt;groupId&gt;</span>org.takes<span class="nt">&lt;/groupId&gt;</span>
      <span class="nt">&lt;artifactId&gt;</span>takes<span class="nt">&lt;/artifactId&gt;</span>
      <span class="nt">&lt;version&gt;</span>0.9<span class="nt">&lt;/version&gt;</span> <span class="c">&lt;!-- check the latest in Maven Central --&gt;</span>
    <span class="nt">&lt;/dependency&gt;</span>
  <span class="nt">&lt;/dependencies&gt;</span>
  <span class="nt">&lt;build&gt;</span>
    <span class="nt">&lt;finalName&gt;</span>foo<span class="nt">&lt;/finalName&gt;</span>
    <span class="nt">&lt;plugins&gt;</span>
      <span class="nt">&lt;plugin&gt;</span>
        <span class="nt">&lt;artifactId&gt;</span>maven-dependency-plugin<span class="nt">&lt;/artifactId&gt;</span>
        <span class="nt">&lt;executions&gt;</span>
          <span class="nt">&lt;execution&gt;</span>
            <span class="nt">&lt;goals&gt;</span>
              <span class="nt">&lt;goal&gt;</span>copy-dependencies<span class="nt">&lt;/goal&gt;</span>
            <span class="nt">&lt;/goals&gt;</span>
            <span class="nt">&lt;configuration&gt;</span>
              <span class="nt">&lt;outputDirectory&gt;</span>${project.build.directory}/deps<span class="nt">&lt;/outputDirectory&gt;</span>
            <span class="nt">&lt;/configuration&gt;</span>
          <span class="nt">&lt;/execution&gt;</span>
        <span class="nt">&lt;/executions&gt;</span>
      <span class="nt">&lt;/plugin&gt;</span>
    <span class="nt">&lt;/plugins&gt;</span>
  <span class="nt">&lt;/build&gt;</span>
<span class="nt">&lt;/project&gt;</span></code></pre></figure><p>Running <code>mvn clean package</code> should build a <code>foo.jar</code> file in <code>target</code> directory and a collection of all JAR dependencies in <code>target/deps</code>. Now you can run the app from the command line:</p><figure class="highlight"><pre><code class="language-bash" data-lang="bash"><span></span>$ mvn clean package
$ java -Dfile.encoding<span class="o">=</span>UTF-8 <span class="se">\</span>
  -cp ./target/foo.jar:./target/deps/* foo.Entry --port<span class="o">=</span><span class="m">8080</span></code></pre></figure><p>The application is ready, and you can deploy it to, say, Heroku. Just create a <code>Procfile</code> file in the root of the repository and push the repo to Heroku. This is what <code>Procfile</code> should look like:</p><figure class="highlight"><pre><code class="language-text" data-lang="text"><span></span>web: java -Dfile.encoding=UTF-8 \
  -cp target/foo.jar:target/deps/* \
  foo.Entry --port=${PORT}</code></pre></figure><h2 id="tkfork"><code>TkFork</code></h2><p>This <a href="http://static.javadoc.io/org.takes/takes/1.1/org/takes/facets/fork/TkFork.html"><code>TkFork</code></a> class seems to be one of the core elements of the framework. It helps route an incoming HTTP request to the right <em>take</em>. Its logic is very simple, and there are just a few lines of code inside it. It encapsulates a collection of &quot;forks,&quot; which are instances of the <a href="http://static.javadoc.io/org.takes/takes/1.1/org/takes/facets/fork/Fork.html"><code>Fork</code></a> interface:</p><figure class="highlight"><pre><code class="language-java" data-lang="java"><span></span><span class="kd">public</span> <span class="kd">interface</span> <span class="nc">Fork</span> <span class="o">{</span>
  <span class="n">Iterator</span><span class="o">&lt;</span><span class="n">Response</span><span class="o">&gt;</span> <span class="nf">route</span><span class="o">(</span><span class="n">Request</span> <span class="n">req</span><span class="o">)</span> <span class="kd">throws</span> <span class="n">IOException</span><span class="o">;</span>
<span class="o">}</span></code></pre></figure><p>Its only <code>route()</code> method either returns an empty iterator or an iterator with a single <code>Response</code>. <code>TkFork</code> goes through all forks, calling their <code>route()</code> methods until one of them returns a response. Once that happens, <code>TkFork</code> returns this response to the caller, which is <a href="http://static.javadoc.io/org.takes/takes/1.1/org/takes/http/FtBasic.html"><code>FtBasic</code></a>.</p><p>Let&#39;s create a simple fork ourselves now. For example, we want to show the status of the application when the <code>/status</code> URL is requested. Here is the code:</p><figure class="highlight"><pre><code class="language-java" data-lang="java"><span></span><span class="kd">final</span> <span class="kd">class</span> <span class="nc">TkApp</span> <span class="kd">extends</span> <span class="n">TkWrap</span> <span class="o">{</span>
  <span class="kd">private</span> <span class="kd">static</span> <span class="n">Take</span> <span class="nf">make</span><span class="o">()</span> <span class="o">{</span>
    <span class="k">return</span> <span class="k">new</span> <span class="n">TkFork</span><span class="o">(</span>
      <span class="k">new</span> <span class="n">Fork</span><span class="o">()</span> <span class="o">{</span>
        <span class="nd">@Override</span>
        <span class="kd">public</span> <span class="n">Iterator</span><span class="o">&lt;</span><span class="n">Response</span><span class="o">&gt;</span> <span class="nf">route</span><span class="o">(</span><span class="n">Request</span> <span class="n">req</span><span class="o">)</span> <span class="o">{</span>
          <span class="kd">final</span> <span class="n">Collection</span><span class="o">&lt;</span><span class="n">Response</span><span class="o">&gt;</span> <span class="n">responses</span> <span class="o">=</span> <span class="k">new</span> <span class="n">ArrayList</span><span class="o">&lt;&gt;(</span><span class="mi">1</span><span class="o">);</span>
          <span class="k">if</span> <span class="o">(</span><span class="k">new</span> <span class="n">RqHref</span><span class="o">(</span><span class="n">req</span><span class="o">).</span><span class="na">href</span><span class="o">().</span><span class="na">path</span><span class="o">().</span><span class="na">equals</span><span class="o">(</span><span class="s">&quot;/status&quot;</span><span class="o">))</span> <span class="o">{</span>
            <span class="n">responses</span><span class="o">.</span><span class="na">add</span><span class="o">(</span><span class="k">new</span> <span class="n">TkStatus</span><span class="o">());</span>
          <span class="o">}</span>
          <span class="k">return</span> <span class="n">responses</span><span class="o">.</span><span class="na">iterator</span><span class="o">();</span>
        <span class="o">}</span>
      <span class="o">}</span>
    <span class="o">);</span>
  <span class="o">}</span>
<span class="o">}</span></code></pre></figure><p>I believe the logic here is clear. We either return an empty iterator or an iterator with an instance of <code>TkStatus</code> inside. If an empty iterator is returned, <code>TkFork</code> will try to find another fork in the collection that actually gets an instance of <code>Response</code>. By the way, if nothing is found and all forks return empty iterators, <code>TkFork</code> will throw a &quot;Page not found&quot; exception.</p><p>This exact logic is implemented by an out-of-the-box fork called <code>FkRegex</code>, which attempts to match a request URI path with the regular expression provided:</p><figure class="highlight"><pre><code class="language-java" data-lang="java"><span></span><span class="kd">final</span> <span class="kd">class</span> <span class="nc">TkApp</span> <span class="kd">extends</span> <span class="n">TkWrap</span> <span class="o">{</span>
  <span class="kd">private</span> <span class="kd">static</span> <span class="n">Take</span> <span class="nf">make</span><span class="o">()</span> <span class="o">{</span>
    <span class="k">return</span> <span class="k">new</span> <span class="n">TkFork</span><span class="o">(</span>
      <span class="k">new</span> <span class="n">FkRegex</span><span class="o">(</span><span class="s">&quot;/status&quot;</span><span class="o">,</span> <span class="k">new</span> <span class="n">TkStatus</span><span class="o">())</span>
    <span class="o">);</span>
  <span class="o">}</span>
<span class="o">}</span></code></pre></figure><p>We can compose a multi-level structure of <code>TkFork</code> classes; for example:</p><figure class="highlight"><pre><code class="language-java" data-lang="java"><span></span><span class="kd">final</span> <span class="kd">class</span> <span class="nc">TkApp</span> <span class="kd">extends</span> <span class="n">TsWrap</span> <span class="o">{</span>
  <span class="kd">private</span> <span class="kd">static</span> <span class="n">Take</span> <span class="nf">make</span><span class="o">()</span> <span class="o">{</span>
    <span class="k">return</span> <span class="k">new</span> <span class="n">TkFork</span><span class="o">(</span>
      <span class="k">new</span> <span class="n">FkRegex</span><span class="o">(</span>
        <span class="s">&quot;/status&quot;</span><span class="o">,</span>
        <span class="k">new</span> <span class="n">TkFork</span><span class="o">(</span>
          <span class="k">new</span> <span class="n">FkParams</span><span class="o">(</span><span class="s">&quot;f&quot;</span><span class="o">,</span> <span class="s">&quot;json&quot;</span><span class="o">,</span> <span class="k">new</span> <span class="n">TkStatusJSON</span><span class="o">()),</span>
          <span class="k">new</span> <span class="n">FkParams</span><span class="o">(</span><span class="s">&quot;f&quot;</span><span class="o">,</span> <span class="s">&quot;xml&quot;</span><span class="o">,</span> <span class="k">new</span> <span class="n">TkStatusXML</span><span class="o">())</span>
        <span class="o">)</span>
      <span class="o">)</span>
    <span class="o">);</span>
  <span class="o">}</span>
<span class="o">}</span></code></pre></figure><p>Again, I believe it&#39;s obvious. The instance of <code>FkRegex</code> will ask an encapsulated instance of <code>TkFork</code> to return a response, and it will try to fetch it from one that <code>FkParams</code> encapsulated. If the HTTP query is <code>/status?f=xml</code>, an instance of <code>TkStatusXML</code> will be returned.</p><h2 id="http-response">HTTP Response</h2><p>Now let&#39;s discuss the structure of the HTTP response and its object-oriented abstraction, <a href="http://static.javadoc.io/org.takes/takes/1.1/org/takes/Response.html"><code>Response</code></a>. This is how the interface looks:</p><figure class="highlight"><pre><code class="language-java" data-lang="java"><span></span><span class="kd">public</span> <span class="kd">interface</span> <span class="nc">Response</span> <span class="o">{</span>
  <span class="n">Iterable</span><span class="o">&lt;</span><span class="n">String</span><span class="o">&gt;</span> <span class="nf">head</span><span class="o">()</span> <span class="kd">throws</span> <span class="n">IOException</span><span class="o">;</span>
  <span class="n">InputStream</span> <span class="nf">body</span><span class="o">()</span> <span class="kd">throws</span> <span class="n">IOException</span><span class="o">;</span>
<span class="o">}</span></code></pre></figure><p>Looks very similar to the <a href="http://static.javadoc.io/org.takes/takes/1.1/org/takes/Request.html"><code>Request</code></a>, doesn&#39;t it? Well, it&#39;s identical, mostly because the structure of the HTTP request and response is almost identical. The only difference is the first line.</p><p>There is a collection of useful decorators that help in response building. They are <a href="/2015/02/26/composable-decorators.html">composable</a>, which makes them very convenient. For example, if you want to build a response that contains an HTML page, you compose them like this:</p><figure class="highlight"><pre><code class="language-java" data-lang="java"><span></span><span class="kd">final</span> <span class="kd">class</span> <span class="nc">TkIndex</span> <span class="kd">implements</span> <span class="n">Take</span> <span class="o">{</span>
  <span class="nd">@Override</span>
  <span class="kd">public</span> <span class="n">Response</span> <span class="nf">act</span><span class="o">()</span> <span class="o">{</span>
    <span class="k">return</span> <span class="k">new</span> <span class="n">RsWithStatus</span><span class="o">(</span>
      <span class="k">new</span> <span class="n">RsWithType</span><span class="o">(</span>
        <span class="k">new</span> <span class="n">RsWithBody</span><span class="o">(</span><span class="s">&quot;&lt;html&gt;Hello, world!&lt;/html&gt;&quot;</span><span class="o">),</span>
        <span class="s">&quot;text/html&quot;</span>
      <span class="o">),</span>
      <span class="mi">200</span>
    <span class="o">);</span>
  <span class="o">}</span>
<span class="o">}</span></code></pre></figure><p>In this example, the decorator <code>RsWithBody</code> creates a response with a body but with no headers at all. Then, <code>RsWithType</code> adds the header <code>Content-Type: text/html</code> to it. Then, <code>RsWithStatus</code> makes sure the first line of the response contains <code>HTTP/1.1 200 OK</code>.</p><p>You can create your own decorators that can reuse existing ones. Take a look at how it&#39;s done in <a href="https://github.com/yegor256/rultor/blob/1.50.2/src/main/java/com/rultor/web/RsPage.java"><code>RsPage</code></a> from rultor.com.</p><h2 id="how-about-templates">How About Templates?</h2><p>Returning simple &quot;Hello, world&quot; pages is not a big problem, as we can see. But what about more complex output like HTML pages, <a href="/2015/11/16/json-vs-xml.html">XML</a> documents, JSON data sets, etc? There are a few convenient <code>Response</code> decorators that enable all of that. Let&#39;s start with <a href="http://velocity.apache.org">Velocity</a>, a simple templating engine. Well, it&#39;s not that simple. It&#39;s rather powerful, but I would suggest to use it in simple situations only. Here is how it works:</p><figure class="highlight"><pre><code class="language-java" data-lang="java"><span></span><span class="kd">final</span> <span class="kd">class</span> <span class="nc">TkIndex</span> <span class="kd">implements</span> <span class="n">Take</span> <span class="o">{</span>
  <span class="nd">@Override</span>
  <span class="kd">public</span> <span class="n">Response</span> <span class="nf">act</span><span class="o">()</span> <span class="o">{</span>
    <span class="k">return</span> <span class="k">new</span> <span class="n">RsVelocity</span><span class="o">(</span><span class="s">&quot;Hello, ${name}&quot;</span><span class="o">)</span>
      <span class="o">.</span><span class="na">with</span><span class="o">(</span><span class="s">&quot;name&quot;</span><span class="o">,</span> <span class="s">&quot;Jeffrey&quot;</span><span class="o">);</span>
  <span class="o">}</span>
<span class="o">}</span></code></pre></figure><p>The <a href="http://static.javadoc.io/org.takes/takes/1.1/org/takes/rs/RsVelocity.html"><code>RsVelocity</code></a> constructor accepts a single argument that has to be a Velocity template. Then, you call the <code>with()</code> method, injecting data into the Velocity context. When it&#39;s time to render the HTTP response, <code>RsVelocity</code> will &quot;evaluate&quot; the template against the context configured. Again, I would recommend you use this templating approach only for simple outputs.</p><p>For more complex HTML documents, I would recommend you use XML/XSLT in combination with Xembly. I explained this idea in a few previous posts: <a href="/2014/06/25/xml-and-xslt-in-browser.html">XML+XSLT in a Browser</a> and <a href="/2014/09/09/restful-web-sites.html">RESTful API and a Web Site in the Same URL</a>. It is simple and powerful---Java generates XML output and the XSLT processor transforms it into HTML documents. This is how we separate representation from data. The XSL stylesheet is a &quot;view&quot; and <code>TkIndex</code> is a &quot;controller,&quot; in terms of <a href="/2016/12/13/mvc-vs-oop.html">MVC</a>.</p><p>I&#39;ll write a separate article about templating with Xembly and XSL very soon.</p><p>In the meantime, we&#39;ll create decorators for <a href="http://en.wikipedia.org/wiki/Facelets">JSF/Facelets</a> and <a href="http://en.wikipedia.org/wiki/JavaServer_Pages">JSP</a> rendering in Takes. If you&#39;re interested in helping, please fork the framework and submit your pull requests.</p><h2 id="what-about-persistence">What About Persistence?</h2><p>Now, a question that comes up is what to do with persistent entities, like databases, in-memory structures, network connections, etc. My suggestion is to initialize them inside the <code>Entry</code> class and pass them as arguments into the <code>TkApp</code> constructor. Then, the <code>TkApp</code> will pass them into the constructors of custom <em>takes</em>.</p><p>For example, we have a PostgreSQL database that contains some table data that we need to render. Here is how I would initialize a connection to it in the <code>Entry</code> class (I&#39;m using a <a href="http://www.jolbox.com/">BoneCP</a> connection pool):</p><figure class="highlight"><pre><code class="language-java" data-lang="java"><span></span><span class="kd">public</span> <span class="kd">final</span> <span class="kd">class</span> <span class="nc">Entry</span> <span class="o">{</span>
  <span class="kd">public</span> <span class="kd">static</span> <span class="kt">void</span> <span class="nf">main</span><span class="o">(</span><span class="kd">final</span> <span class="n">String</span><span class="o">...</span> <span class="n">args</span><span class="o">)</span> <span class="kd">throws</span> <span class="n">Exception</span> <span class="o">{</span>
    <span class="k">new</span> <span class="n">FtCli</span><span class="o">(</span><span class="k">new</span> <span class="n">TkApp</span><span class="o">(</span><span class="n">Entry</span><span class="o">.</span><span class="na">postgres</span><span class="o">()),</span> <span class="n">args</span><span class="o">).</span><span class="na">start</span><span class="o">(</span><span class="n">Exit</span><span class="o">.</span><span class="na">NEVER</span><span class="o">);</span>
  <span class="o">}</span>
  <span class="kd">private</span> <span class="kd">static</span> <span class="n">Source</span> <span class="nf">postgres</span><span class="o">()</span> <span class="o">{</span>
    <span class="kd">final</span> <span class="n">BoneCPDataSource</span> <span class="n">src</span> <span class="o">=</span> <span class="k">new</span> <span class="n">BoneCPDataSource</span><span class="o">();</span>
    <span class="n">src</span><span class="o">.</span><span class="na">setDriverClass</span><span class="o">(</span><span class="s">&quot;org.postgresql.Driver&quot;</span><span class="o">);</span>
    <span class="n">src</span><span class="o">.</span><span class="na">setJdbcUrl</span><span class="o">(</span><span class="s">&quot;jdbc:postgresql://localhost/db&quot;</span><span class="o">);</span>
    <span class="n">src</span><span class="o">.</span><span class="na">setUser</span><span class="o">(</span><span class="s">&quot;root&quot;</span><span class="o">);</span>
    <span class="n">src</span><span class="o">.</span><span class="na">setPassword</span><span class="o">(</span><span class="s">&quot;super-secret-password&quot;</span><span class="o">);</span>
    <span class="k">return</span> <span class="n">src</span><span class="o">;</span>
  <span class="o">}</span>
<span class="o">}</span></code></pre></figure><p>Now, the constructor of <code>TkApp</code> must accept a single argument of type <code>java.sql.Source</code>:</p><figure class="highlight"><pre><code class="language-java" data-lang="java"><span></span><span class="kd">final</span> <span class="kd">class</span> <span class="nc">TkApp</span> <span class="kd">extends</span> <span class="n">TkWrap</span> <span class="o">{</span>
  <span class="n">TkApp</span><span class="o">(</span><span class="kd">final</span> <span class="n">Source</span> <span class="n">source</span><span class="o">)</span> <span class="o">{</span>
    <span class="kd">super</span><span class="o">(</span><span class="n">TkApp</span><span class="o">.</span><span class="na">make</span><span class="o">(</span><span class="n">source</span><span class="o">));</span>
  <span class="o">}</span>
  <span class="kd">private</span> <span class="kd">static</span> <span class="n">Take</span> <span class="nf">make</span><span class="o">(</span><span class="kd">final</span> <span class="n">Source</span> <span class="n">source</span><span class="o">)</span> <span class="o">{</span>
    <span class="k">return</span> <span class="k">new</span> <span class="n">TkFork</span><span class="o">(</span>
      <span class="k">new</span> <span class="n">FkRegex</span><span class="o">(</span><span class="s">&quot;/&quot;</span><span class="o">,</span> <span class="k">new</span> <span class="n">TkIndex</span><span class="o">(</span><span class="n">source</span><span class="o">))</span>
    <span class="o">);</span>
  <span class="o">}</span>
<span class="o">}</span></code></pre></figure><p>Class <code>TkIndex</code> also accepts a single argument of class <code>Source</code>. I believe you know what to do with it inside <code>TkIndex</code> in order to fetch the SQL table data and convert it into HTML. The point here is that the dependency must be injected into the application (instance of class <code>TkApp</code>) at the moment of its instantiation. This is a pure and clean dependency injection mechanism, which is absolutely container-free. Read more about it in <a href="/2014/10/03/di-containers-are-evil.html">Dependency Injection Containers Are Code Polluters</a>.</p><h2 id="unit-testing">Unit Testing</h2><p>Since every class is immutable and all dependencies are injected only through constructors, unit testing is extremely easy. Let&#39;s say we want to test <code>TkStatus</code>, which is supposed to return an HTML response (I&#39;m using <a href="http://junit.org/">JUnit 4</a> and <a href="https://github.com/hamcrest/JavaHamcrest">Hamcrest</a>):</p><figure class="highlight"><pre><code class="language-java" data-lang="java"><span></span><span class="kn">import</span> <span class="nn">org.junit.Test</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">org.hamcrest.MatcherAssert</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">org.hamcrest.Matchers</span><span class="o">;</span>
<span class="kd">public</span> <span class="kd">final</span> <span class="kd">class</span> <span class="nc">TkIndexTest</span> <span class="o">{</span>
  <span class="nd">@Test</span>
  <span class="kd">public</span> <span class="kt">void</span> <span class="nf">returnsHtmlPage</span><span class="o">()</span> <span class="kd">throws</span> <span class="n">Exception</span> <span class="o">{</span>
    <span class="n">MatcherAssert</span><span class="o">.</span><span class="na">assertThat</span><span class="o">(</span>
      <span class="k">new</span> <span class="n">RsPrint</span><span class="o">(</span>
        <span class="k">new</span> <span class="n">TkStatus</span><span class="o">().</span><span class="na">act</span><span class="o">(</span><span class="k">new</span> <span class="n">RqFake</span><span class="o">())</span>
      <span class="o">).</span><span class="na">printBody</span><span class="o">(),</span>
      <span class="n">Matchers</span><span class="o">.</span><span class="na">equalsTo</span><span class="o">(</span><span class="s">&quot;&lt;html&gt;Hello, world!&lt;/html&gt;&quot;</span><span class="o">)</span>
    <span class="o">);</span>
  <span class="o">}</span>
<span class="o">}</span></code></pre></figure><p>Also, we can start the entire application or any individual <em>take</em> in a test HTTP server and test its behavior via a real TCP socket; for example (I&#39;m using <a href="http://http.jcabi.com">jcabi-http</a> to make an HTTP request and check the output):</p><figure class="highlight"><pre><code class="language-java" data-lang="java"><span></span><span class="kd">public</span> <span class="kd">final</span> <span class="kd">class</span> <span class="nc">TkIndexTest</span> <span class="o">{</span>
  <span class="nd">@Test</span>
  <span class="kd">public</span> <span class="kt">void</span> <span class="nf">returnsHtmlPage</span><span class="o">()</span> <span class="kd">throws</span> <span class="n">Exception</span> <span class="o">{</span>
    <span class="k">new</span> <span class="n">FtRemote</span><span class="o">(</span><span class="k">new</span> <span class="n">TkIndex</span><span class="o">()).</span><span class="na">exec</span><span class="o">(</span>
      <span class="k">new</span> <span class="n">FtRemote</span><span class="o">.</span><span class="na">Script</span><span class="o">()</span> <span class="o">{</span>
        <span class="nd">@Override</span>
        <span class="kd">public</span> <span class="kt">void</span> <span class="nf">exec</span><span class="o">(</span><span class="kd">final</span> <span class="n">URI</span> <span class="n">home</span><span class="o">)</span> <span class="kd">throws</span> <span class="n">IOException</span> <span class="o">{</span>
          <span class="k">new</span> <span class="n">JdkRequest</span><span class="o">(</span><span class="n">home</span><span class="o">)</span>
            <span class="o">.</span><span class="na">fetch</span><span class="o">()</span>
            <span class="o">.</span><span class="na">as</span><span class="o">(</span><span class="n">RestResponse</span><span class="o">.</span><span class="na">class</span><span class="o">)</span>
            <span class="o">.</span><span class="na">assertStatus</span><span class="o">(</span><span class="n">HttpURLConnection</span><span class="o">.</span><span class="na">HTTP_OK</span><span class="o">)</span>
            <span class="o">.</span><span class="na">assertBody</span><span class="o">(</span><span class="n">Matchers</span><span class="o">.</span><span class="na">containsString</span><span class="o">(</span><span class="s">&quot;Hello, world!&quot;</span><span class="o">));</span>
        <span class="o">}</span>
      <span class="o">}</span>
    <span class="o">);</span>
  <span class="o">}</span>
<span class="o">}</span></code></pre></figure><p><a href="http://static.javadoc.io/org.takes/takes/1.1/org/takes/http/FtRemote.html"><code>FtRemote</code></a> starts a test web server at a random TCP port and calls the <code>exec()</code> method at the provided instance of <code>FtRemote.Script</code>. The first argument of this method is a URI of the just-started web server homepage.</p><p>The architecture of Takes framework is very modular and composable. Any individual <em>take</em> can be tested as a standalone component, absolutely independent from the framework and other <em>takes</em>.</p><h2 id="why-the-name">Why the Name?</h2><p>That&#39;s the question I&#39;ve been hearing rather often. The idea is simple, and it originates from the movie business. When a movie is made, the crew shoots many <em>takes</em> in order to capture the reality and put it on film. Each capture is called a <em>take</em>.</p><p>In other words, a <em>take</em> is like a snapshot of the reality.</p><p>The same applies to this framework. Each instance of <code>Take</code> represents a reality at one particular moment in time. This reality is then sent to the user in the form of a <code>Response</code>.</p><p>PS. There are a few words about authentication: <a href="/2015/05/18/cookie-based-authentication.html">How Cookie-Based Authentication Works in the Takes Framework</a>.</p><p>PPS. There are a few real web systems, which you may be interested to take a look at. They all are using Takes Framework and their code is open: <a href="https://github.com/yegor256/rultor">rultor.com</a>, <a href="/2016/03/30/jare-instant-free-cdn.html">jare.io</a>, <a href="/2016/03/15/wring-dispatcher-github-notifications.html">wring.io</a>.</p></p>--> <nav class="buttons notranslate desktop-only"> <a href="http://www.facebook.com/sharer/sharer.php?u=https://www.yegor256.com/2015/03/22/takes-java-web-framework.html" title="Share on Facebook" class="button" rel="nofollow"> <span class="count count-facebook">0</span> <i class="icon icon-facebook notranslate" aria-hidden="true"></i> </a> <a href="https://twitter.com/share?url=https://www.yegor256.com/2015/03/22/takes-java-web-framework.html&amp;text=Java+Web+App+Architecture+In+Takes+Framework" title="Share on Twitter" class="button" rel="nofollow"> <span class="count count-twitter">0</span> <i class="icon icon-twitter notranslate" aria-hidden="true"></i> </a> <a href="https://plus.google.com/share?url=https://www.yegor256.com/2015/03/22/takes-java-web-framework.html" title="Share on Google+" class="button" rel="nofollow"> <span class="count count-googleplus">0</span> <i class="icon icon-googleplus notranslate" aria-hidden="true"></i> </a> <a href="https://www.linkedin.com/cws/share?url=https://www.yegor256.com/2015/03/22/takes-java-web-framework.html" title="Share on LinkedIn" class="button" rel="nofollow"> <span class="count count-linkedin">0</span> <i class="icon icon-linkedin notranslate" aria-hidden="true"></i> </a> <a href="http://reddit.com/submit?url=https://www.yegor256.com/2015/03/22/takes-java-web-framework.html%3F2015-12&amp;title=Java+Web+App+Architecture+In+Takes+Framework" title="Share on Reddit" class="button" rel="nofollow"> <span class="count count-reddit">0</span> <i class="icon icon-reddit notranslate" aria-hidden="true"></i> </a> <a href="http://news.ycombinator.com/submitlink?u=https://www.yegor256.com/2015/03/22/takes-java-web-framework.html%3F2015-12&amp;t=Java+Web+App+Architecture+In+Takes+Framework" title="Share on Hacker News" class="button" rel="nofollow"> <span class="count count-hackernews">0</span> <i class="icon icon-hackernews notranslate" aria-hidden="true"></i> </a> </nav> </header> <article class="main" itemprop="articleBody"><div ><p>I used to utilize Servlets, JSP, JAX-RS, Spring Framework, Play Framework, JSF with Facelets, and a bit of Spark Framework. All of these solutions, in my humble opinion, are very far from being object-oriented and elegant. They all are full of static methods, un-testable data structures, and dirty hacks. So about a month ago, I decided to create my own Java web framework. I put a few basic principles into its foundation: 1) No <a href="/2014/05/13/why-null-is-bad.html">NULLs</a>, 2) no public <a href="/2014/05/05/oop-alternative-to-utility-classes.html">static</a> methods, 3) no <a href="/2014/06/09/objects-should-be-immutable.html">mutable</a> classes, and 4) no class casting, reflection, and <a href="/2015/04/02/class-casting-is-anti-pattern.html"><code>instanceof</code></a> operators. These four basic principles should guarantee clean code and transparent architecture. That&#39;s how the <a href="http://www.takes.org">Takes</a> framework was born. Let&#39;s see what was created and how it works.</p><figure class='jb_picture'><img itemprop='image' alt='Making of The Godfather (1972) by Francis Ford Coppola' src='/images/2015/03/godfather-shooting-scene.jpg' longdesc='#9fedcf46'/><figcaption id='9fedcf46'>Making of The Godfather (1972) by Francis Ford Coppola</figcaption></figure><h2 id="java-web-architecture-in-a-nutshell">Java Web Architecture in a Nutshell</h2><p>This is how I understand a web application architecture and its components, in simple terms.</p><aside class='youtube'> <a href='https://www.youtube.com/watch?v=nheD2LNYrpk'><div class='box'> <img src='https://i.ytimg.com/vi/nheD2LNYrpk/mqdefault.jpg' alt='YouTube video #nheD2LNYrpk'/><div class='play'><i class='icon icon-play'></i></div></div></a><div>Takes, Java Web Framework, Intro (webinar #12); 2 March 2016.</div></aside><p>First, to create a web server, we should create a new <a href="http://en.wikipedia.org/wiki/Network_socket">network socket</a>, that accepts connections on a certain <a href="http://en.wikipedia.org/wiki/Port_%28computer_networking%29">TCP port</a>. Usually it is 80, but I&#39;m going to use 8080 for testing purposes. This is done in Java with the <a href="http://docs.oracle.com/javase/7/docs/api/java/net/ServerSocket.html"><code>ServerSocket</code></a> class:</p><figure class="highlight"><pre><code class="language-java" data-lang="java"><span></span><span class="kn">import</span> <span class="nn">java.net.ServerSocket</span><span class="o">;</span>
<span class="kd">public</span> <span class="kd">class</span> <span class="nc">Foo</span> <span class="o">{</span>
  <span class="kd">public</span> <span class="kd">static</span> <span class="kt">void</span> <span class="nf">main</span><span class="o">(</span><span class="kd">final</span> <span class="n">String</span><span class="o">...</span> <span class="n">args</span><span class="o">)</span> <span class="kd">throws</span> <span class="n">Exception</span> <span class="o">{</span>
    <span class="kd">final</span> <span class="n">ServerSocket</span> <span class="n">server</span> <span class="o">=</span> <span class="k">new</span> <span class="n">ServerSocket</span><span class="o">(</span><span class="mi">8080</span><span class="o">);</span>
    <span class="k">while</span> <span class="o">(</span><span class="kc">true</span><span class="o">);</span>
  <span class="o">}</span>
<span class="o">}</span></code></pre></figure><p>That&#39;s enough to start a web server. Now, the socket is ready and listening on port 8080. When someone opens <code>http://localhost:8080</code> in their browser, the connection will be established and the browser will spin its waiting wheel forever. Compile this snippet and try. We just built a simple web server without the use of any frameworks. We&#39;re not doing anything with incoming connections yet, but we&#39;re not rejecting them either. All of them are being lined up inside that <code>server</code> object. It&#39;s being done in a background thread; that&#39;s why we need to put that <code>while(true)</code> in afterward. Without this endless pause, the app will finish its execution immediately and the server socket will shut down.</p><p>The next step is to accept the incoming connections. In Java, that&#39;s done through a blocking call to the <code>accept()</code> method:</p><figure class="highlight"><pre><code class="language-java" data-lang="java"><span></span><span class="kd">final</span> <span class="n">Socket</span> <span class="n">socket</span> <span class="o">=</span> <span class="n">server</span><span class="o">.</span><span class="na">accept</span><span class="o">();</span></code></pre></figure><p>The method is blocking its thread and waiting until a new connection arrives. As soon as that happens, it returns an instance of <code>Socket</code>. In order to accept the next connection, we should call <code>accept()</code> again. So basically, our web server should work like this:</p><figure class="highlight"><pre><code class="language-java" data-lang="java"><span></span><span class="kd">public</span> <span class="kd">class</span> <span class="nc">Foo</span> <span class="o">{</span>
  <span class="kd">public</span> <span class="kd">static</span> <span class="kt">void</span> <span class="nf">main</span><span class="o">(</span><span class="kd">final</span> <span class="n">String</span><span class="o">...</span> <span class="n">args</span><span class="o">)</span> <span class="kd">throws</span> <span class="n">Exception</span> <span class="o">{</span>
    <span class="kd">final</span> <span class="n">ServerSocket</span> <span class="n">server</span> <span class="o">=</span> <span class="k">new</span> <span class="n">ServerSocket</span><span class="o">(</span><span class="mi">8080</span><span class="o">);</span>
    <span class="k">while</span> <span class="o">(</span><span class="kc">true</span><span class="o">)</span> <span class="o">{</span>
      <span class="kd">final</span> <span class="n">Socket</span> <span class="n">socket</span> <span class="o">=</span> <span class="n">server</span><span class="o">.</span><span class="na">accept</span><span class="o">();</span>
      <span class="c1">// 1. Read HTTP request from the socket</span>
      <span class="c1">// 2. Prepare an HTTP response</span>
      <span class="c1">// 3. Send HTTP response to the socket</span>
      <span class="c1">// 4. Close the socket</span>
    <span class="o">}</span>
  <span class="o">}</span>
<span class="o">}</span></code></pre></figure><p>It&#39;s an endless cycle that accepts a new connection, understands it, creates a response, returns the response, and accepts a new connection again. HTTP protocol is stateless, which means the server should not remember what happened in any previous connection. All it cares about is the incoming HTTP request in this particular connection.</p><p>The HTTP request is coming from the input stream of the socket and looks like a multi-line block of text. This is what you would see if you read an input stream of the socket:</p><figure class="highlight"><pre><code class="language-java" data-lang="java"><span></span><span class="kd">final</span> <span class="n">BufferedReader</span> <span class="n">reader</span> <span class="o">=</span> <span class="k">new</span> <span class="n">BufferedReader</span><span class="o">(</span>
  <span class="k">new</span> <span class="n">InputStreamReader</span><span class="o">(</span><span class="n">socket</span><span class="o">.</span><span class="na">getInputStream</span><span class="o">())</span>
<span class="o">);</span>
<span class="k">while</span> <span class="o">(</span><span class="kc">true</span><span class="o">)</span> <span class="o">{</span>
  <span class="kd">final</span> <span class="n">String</span> <span class="n">line</span> <span class="o">=</span> <span class="n">reader</span><span class="o">.</span><span class="na">readLine</span><span class="o">();</span>
  <span class="k">if</span> <span class="o">(</span><span class="n">line</span><span class="o">.</span><span class="na">isEmpty</span><span class="o">())</span> <span class="o">{</span>
    <span class="k">break</span><span class="o">;</span>
  <span class="o">}</span>
  <span class="n">System</span><span class="o">.</span><span class="na">out</span><span class="o">.</span><span class="na">println</span><span class="o">(</span><span class="n">line</span><span class="o">);</span>
<span class="o">}</span></code></pre></figure><p>You will see something like this:</p><figure class="highlight"><pre><code class="language-text" data-lang="text"><span></span>GET / HTTP/1.1
Host: localhost:8080
Connection: keep-alive
Cache-Control: max-age=0
Accept: text/html,application/xhtml+xml,application/xml;q=0.9,image/webp,*/*;q=0.8
User-Agent: Mozilla/5.0 (Macintosh; Intel Mac OS X 10_10_2) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/41.0.2272.89 Safari/537.36
Accept-Encoding: gzip, deflate, sdch
Accept-Language: en-US,en;q=0.8,ru;q=0.6,uk;q=0.4</code></pre></figure><p>The client (the Google Chrome browser, for example) passes this text into the connection established. It connects to port 8080 at <code>localhost</code>, and as soon as the connection is ready, it immediately sends this text into it, then waits for a response.</p><p>Our job is to create an HTTP response using the information we get in the request. If our server is very primitive, we can basically ignore all the information in the request and just return &quot;Hello, world!&quot; to all requests (I&#39;m using <a href="https://commons.apache.org/proper/commons-io/javadocs/api-2.5/org/apache/commons/io/IOUtils.html"><code>IOUtils</code></a> for simplicity):</p><figure class="highlight"><pre><code class="language-java" data-lang="java"><span></span><span class="kn">import</span> <span class="nn">java.net.Socket</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">java.net.ServerSocket</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">org.apache.commons.io.IOUtils</span><span class="o">;</span>
<span class="kd">public</span> <span class="kd">class</span> <span class="nc">Foo</span> <span class="o">{</span>
  <span class="kd">public</span> <span class="kd">static</span> <span class="kt">void</span> <span class="nf">main</span><span class="o">(</span><span class="kd">final</span> <span class="n">String</span><span class="o">...</span> <span class="n">args</span><span class="o">)</span> <span class="kd">throws</span> <span class="n">Exception</span> <span class="o">{</span>
    <span class="kd">final</span> <span class="n">ServerSocket</span> <span class="n">server</span> <span class="o">=</span> <span class="k">new</span> <span class="n">ServerSocket</span><span class="o">(</span><span class="mi">8080</span><span class="o">);</span>
    <span class="k">while</span> <span class="o">(</span><span class="kc">true</span><span class="o">)</span> <span class="o">{</span>
      <span class="k">try</span> <span class="o">(</span><span class="kd">final</span> <span class="n">Socket</span> <span class="n">socket</span> <span class="o">=</span> <span class="n">server</span><span class="o">.</span><span class="na">accept</span><span class="o">())</span> <span class="o">{</span>
        <span class="n">IOUtils</span><span class="o">.</span><span class="na">copy</span><span class="o">(</span>
          <span class="n">IOUtils</span><span class="o">.</span><span class="na">toInputStream</span><span class="o">(</span><span class="s">&quot;HTTP/1.1 200 OK\r\n\r\nHello, world!&quot;</span><span class="o">),</span>
          <span class="n">socket</span><span class="o">.</span><span class="na">getOutputStream</span><span class="o">()</span>
        <span class="o">);</span>
      <span class="o">}</span>
    <span class="o">}</span>
  <span class="o">}</span>
<span class="o">}</span></code></pre></figure><p>That&#39;s it. The server is ready. Try to compile and run it. Point your browser to <code>http://localhost:8080</code>, and you will see <code>Hello, world!</code>:</p><figure class="highlight"><pre><code class="language-bash" data-lang="bash"><span></span>$ javac -cp commons-io.jar Foo.java
$ java -cp commons-io.jar:. Foo <span class="p">&amp;</span>
$ curl http://localhost:8080 -v
* Rebuilt URL to: http://localhost:8080/
* Connected to localhost <span class="o">(</span>::1<span class="o">)</span> port <span class="m">8080</span> <span class="o">(</span><span class="c1">#0)</span>
&gt; GET / HTTP/1.1
&gt; User-Agent: curl/7.37.1
&gt; Host: localhost:8080
&gt; Accept: */*
&gt;
&lt; HTTP/1.1 <span class="m">200</span> OK
* no chunk, no close, no size. Assume close to signal end
&lt;
* Closing connection <span class="m">0</span>
Hello, world!</code></pre></figure><p>That&#39;s all you need to build a web server. Now let&#39;s discuss how to make it object-oriented and composable. Let&#39;s try to see how the <a href="http://www.takes.org">Takes</a> framework was built.</p><h2 id="routing-dispatching">Routing/Dispatching</h2><p>Routing/dispatching is combined with response printing in Takes. All you need to do to create a working web application is to create a single class that implements <a href="http://static.javadoc.io/org.takes/takes/1.1/org/takes/Take.html"><code>Take</code></a> interface:</p><figure class="highlight"><pre><code class="language-java" data-lang="java"><span></span><span class="kn">import</span> <span class="nn">org.takes.Request</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">org.takes.Take</span><span class="o">;</span>
<span class="kd">public</span> <span class="kd">final</span> <span class="kd">class</span> <span class="nc">TkFoo</span> <span class="kd">implements</span> <span class="n">Take</span> <span class="o">{</span>
  <span class="nd">@Override</span>
  <span class="kd">public</span> <span class="n">Response</span> <span class="nf">route</span><span class="o">(</span><span class="kd">final</span> <span class="n">Request</span> <span class="n">request</span><span class="o">)</span> <span class="o">{</span>
    <span class="k">return</span> <span class="k">new</span> <span class="n">RsText</span><span class="o">(</span><span class="s">&quot;Hello, world!&quot;</span><span class="o">);</span>
  <span class="o">}</span>
<span class="o">}</span></code></pre></figure><p>And now it&#39;s time to start a server:</p><figure class="highlight"><pre><code class="language-java" data-lang="java"><span></span><span class="kn">import</span> <span class="nn">org.takes.http.Exit</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">org.takes.http.FtBasic</span><span class="o">;</span>
<span class="kd">public</span> <span class="kd">class</span> <span class="nc">Foo</span> <span class="o">{</span>
  <span class="kd">public</span> <span class="kd">static</span> <span class="kt">void</span> <span class="nf">main</span><span class="o">(</span><span class="kd">final</span> <span class="n">String</span><span class="o">...</span> <span class="n">args</span><span class="o">)</span> <span class="kd">throws</span> <span class="n">Exception</span> <span class="o">{</span>
    <span class="k">new</span> <span class="n">FtBasic</span><span class="o">(</span><span class="k">new</span> <span class="n">TkFoo</span><span class="o">(),</span> <span class="mi">8080</span><span class="o">).</span><span class="na">start</span><span class="o">(</span><span class="n">Exit</span><span class="o">.</span><span class="na">NEVER</span><span class="o">);</span>
  <span class="o">}</span>
<span class="o">}</span></code></pre></figure><p>This <a href="http://static.javadoc.io/org.takes/takes/1.1/org/takes/http/FtBasic.html"><code>FtBasic</code></a> class does the exact same socket manipulations explained above. It starts a server socket on port 8080 and dispatches all incoming connections through an instance of <code>TkFoo</code> that we are giving to its constructor. It does this dispatching in an endless cycle, checking every second whether it&#39;s time to stop with an instance of <a href="http://static.javadoc.io/org.takes/takes/1.1/org/takes/http/Exit.html"><code>Exit</code></a>. Obviously, <code>Exit.NEVER</code> always responds with, &quot;Don&#39;t stop, please.&quot;</p><h2 id="http-request">HTTP Request</h2><p>Now let&#39;s see what&#39;s inside the HTTP request arriving at <code>TkFoo</code> and what we can get out of it. This is how the <a href="http://static.javadoc.io/org.takes/takes/1.1/org/takes/Request.html"><code>Request</code></a> interface is defined in <a href="http://www.takes.org">Takes</a>:</p><figure class="highlight"><pre><code class="language-java" data-lang="java"><span></span><span class="kd">public</span> <span class="kd">interface</span> <span class="nc">Request</span> <span class="o">{</span>
  <span class="n">Iterable</span><span class="o">&lt;</span><span class="n">String</span><span class="o">&gt;</span> <span class="nf">head</span><span class="o">()</span> <span class="kd">throws</span> <span class="n">IOException</span><span class="o">;</span>
  <span class="n">InputStream</span> <span class="nf">body</span><span class="o">()</span> <span class="kd">throws</span> <span class="n">IOException</span><span class="o">;</span>
<span class="o">}</span></code></pre></figure><p>The request is divided into two parts: the head and the body. The head contains all lines that go before the empty line that starts a body, according to HTTP specification in <a href="http://www.w3.org/Protocols/rfc2616/rfc2616-sec5.html">RFC 2616</a>. There are many useful decorators for <code>Request</code> in the framework. For example, <code>RqMethod</code> will help you get the method name from the first line of the header:</p><figure class="highlight"><pre><code class="language-java" data-lang="java"><span></span><span class="kd">final</span> <span class="n">String</span> <span class="n">method</span> <span class="o">=</span> <span class="k">new</span> <span class="n">RqMethod</span><span class="o">(</span><span class="n">request</span><span class="o">).</span><span class="na">method</span><span class="o">();</span></code></pre></figure><p><code>RqHref</code> will help extract the query part and parse it. For example, this is the request:</p><figure class="highlight"><pre><code class="language-java" data-lang="java"><span></span><span class="n">GET</span> <span class="o">/</span><span class="n">user</span><span class="o">?</span><span class="n">id</span><span class="o">=</span><span class="mi">123</span> <span class="n">HTTP</span><span class="o">/</span><span class="mf">1.1</span>
<span class="nl">Host:</span> <span class="n">www</span><span class="o">.</span><span class="na">example</span><span class="o">.</span><span class="na">com</span></code></pre></figure><p>This code will extract that <code>123</code>:</p><figure class="highlight"><pre><code class="language-java" data-lang="java"><span></span><span class="kd">final</span> <span class="kt">int</span> <span class="n">id</span> <span class="o">=</span> <span class="n">Integer</span><span class="o">.</span><span class="na">parseInt</span><span class="o">(</span>
  <span class="k">new</span> <span class="n">RqHref</span><span class="o">(</span><span class="n">request</span><span class="o">).</span><span class="na">href</span><span class="o">().</span><span class="na">param</span><span class="o">(</span><span class="s">&quot;id&quot;</span><span class="o">).</span><span class="na">get</span><span class="o">(</span><span class="mi">0</span><span class="o">)</span>
<span class="o">);</span></code></pre></figure><p><code>RqPrint</code> can get the entire request or its body printed as a <code>String</code>:</p><figure class="highlight"><pre><code class="language-java" data-lang="java"><span></span><span class="kd">final</span> <span class="n">String</span> <span class="n">body</span> <span class="o">=</span> <span class="k">new</span> <span class="n">RqPrint</span><span class="o">(</span><span class="n">request</span><span class="o">).</span><span class="na">printBody</span><span class="o">();</span></code></pre></figure><p>The idea here is to keep the <code>Request</code> interface simple and provide this request parsing functionality to its decorators. This approach helps the framework keep classes small and cohesive. Each decorator is very small and solid, doing exactly one thing. All of these decorators are in the <a href="http://static.javadoc.io/org.takes/takes/1.1/org/takes/rq/package-summary.html"><code>org.takes.rq</code></a> package. As you already probably understand, the <code>Rq</code> prefix stands for <code>Request</code>.</p><h2 id="first-real-web-app">First Real Web App</h2><p>Let&#39;s create our first real web application, which will do something useful. I would recommend starting with an <code>Entry</code> class, which is required by Java to start an app from the command line:</p><figure class="highlight"><pre><code class="language-java" data-lang="java"><span></span><span class="kn">import</span> <span class="nn">org.takes.http.Exit</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">org.takes.http.FtCli</span><span class="o">;</span>
<span class="kd">public</span> <span class="kd">final</span> <span class="kd">class</span> <span class="nc">Entry</span> <span class="o">{</span>
  <span class="kd">public</span> <span class="kd">static</span> <span class="kt">void</span> <span class="nf">main</span><span class="o">(</span><span class="kd">final</span> <span class="n">String</span><span class="o">...</span> <span class="n">args</span><span class="o">)</span> <span class="kd">throws</span> <span class="n">Exception</span> <span class="o">{</span>
    <span class="k">new</span> <span class="n">FtCli</span><span class="o">(</span><span class="k">new</span> <span class="n">TkApp</span><span class="o">(),</span> <span class="n">args</span><span class="o">).</span><span class="na">start</span><span class="o">(</span><span class="n">Exit</span><span class="o">.</span><span class="na">NEVER</span><span class="o">);</span>
  <span class="o">}</span>
<span class="o">}</span></code></pre></figure><p>This class contains just a single <code>main()</code> static method that will be called by JVM when the app starts from the command line. As you see, it instantiates <a href="http://static.javadoc.io/org.takes/takes/1.1/org/takes/http/FtCli.html"><code>FtCli</code></a>, giving it an instance of class <code>TkApp</code> and command line arguments. We&#39;ll create the <code>TkApp</code> class in a second. <code>FtCli</code> (translates to &quot;front-end with command line interface&quot;) makes an instance of the same <code>FtBasic</code>, wrapping it into a few useful decorators and configuring it according to command line arguments. For example, <code>--port=8080</code> will be converted into a <code>8080</code> port number and passed as a second argument of the <code>FtBasic</code> constructor.</p><p>The web application itself is called <code>TkApp</code> and extends <code>TsWrap</code>:</p><figure class="highlight"><pre><code class="language-java" data-lang="java"><span></span><span class="kn">import</span> <span class="nn">org.takes.Take</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">org.takes.facets.fork.FkRegex</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">org.takes.facets.fork.TkFork</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">org.takes.tk.TkWrap</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">org.takes.tk.TkClasspath</span><span class="o">;</span>
<span class="kd">final</span> <span class="kd">class</span> <span class="nc">TkApp</span> <span class="kd">extends</span> <span class="n">TkWrap</span> <span class="o">{</span>
  <span class="n">TkApp</span><span class="o">()</span> <span class="o">{</span>
    <span class="kd">super</span><span class="o">(</span><span class="n">TkApp</span><span class="o">.</span><span class="na">make</span><span class="o">());</span>
  <span class="o">}</span>
  <span class="kd">private</span> <span class="kd">static</span> <span class="n">Take</span> <span class="nf">make</span><span class="o">()</span> <span class="o">{</span>
    <span class="k">return</span> <span class="k">new</span> <span class="n">TkFork</span><span class="o">(</span>
      <span class="k">new</span> <span class="n">FkRegex</span><span class="o">(</span><span class="s">&quot;/robots.txt&quot;</span><span class="o">,</span> <span class="s">&quot;&quot;</span><span class="o">),</span>
      <span class="k">new</span> <span class="n">FkRegex</span><span class="o">(</span><span class="s">&quot;/css/.*&quot;</span><span class="o">,</span> <span class="k">new</span> <span class="n">TkClasspath</span><span class="o">()),</span>
      <span class="k">new</span> <span class="n">FkRegex</span><span class="o">(</span><span class="s">&quot;/&quot;</span><span class="o">,</span> <span class="k">new</span> <span class="n">TkIndex</span><span class="o">())</span>
    <span class="o">);</span>
  <span class="o">}</span>
<span class="o">}</span></code></pre></figure><p>We&#39;ll discuss this <code>TkFork</code> class in a minute.</p><p>If you&#39;re using Maven, this is the <code>pom.xml</code> you should start with:</p><figure class="highlight"><pre><code class="language-xml" data-lang="xml"><span></span><span class="cp">&lt;?xml version=&quot;1.0&quot;?&gt;</span>
<span class="nt">&lt;project</span> <span class="na">xmlns=</span><span class="s">&quot;http://maven.apache.org/POM/4.0.0&quot;</span>
  <span class="na">xmlns:xsi=</span><span class="s">&quot;http://www.w3.org/2001/XMLSchema-instance&quot;</span>
  <span class="na">xsi:schemaLocation=</span><span class="s">&quot;http://maven.apache.org/POM/4.0.0</span>
<span class="s">    http://maven.apache.org/xsd/maven-4.0.0.xsd&quot;</span><span class="nt">&gt;</span>
  <span class="nt">&lt;modelVersion&gt;</span>4.0.0<span class="nt">&lt;/modelVersion&gt;</span>
  <span class="nt">&lt;groupId&gt;</span>foo<span class="nt">&lt;/groupId&gt;</span>
  <span class="nt">&lt;artifactId&gt;</span>foo<span class="nt">&lt;/artifactId&gt;</span>
  <span class="nt">&lt;version&gt;</span>1.0-SNAPSHOT<span class="nt">&lt;/version&gt;</span>
  <span class="nt">&lt;dependencies&gt;</span>
    <span class="nt">&lt;dependency&gt;</span>
      <span class="nt">&lt;groupId&gt;</span>org.takes<span class="nt">&lt;/groupId&gt;</span>
      <span class="nt">&lt;artifactId&gt;</span>takes<span class="nt">&lt;/artifactId&gt;</span>
      <span class="nt">&lt;version&gt;</span>0.9<span class="nt">&lt;/version&gt;</span> <span class="c">&lt;!-- check the latest in Maven Central --&gt;</span>
    <span class="nt">&lt;/dependency&gt;</span>
  <span class="nt">&lt;/dependencies&gt;</span>
  <span class="nt">&lt;build&gt;</span>
    <span class="nt">&lt;finalName&gt;</span>foo<span class="nt">&lt;/finalName&gt;</span>
    <span class="nt">&lt;plugins&gt;</span>
      <span class="nt">&lt;plugin&gt;</span>
        <span class="nt">&lt;artifactId&gt;</span>maven-dependency-plugin<span class="nt">&lt;/artifactId&gt;</span>
        <span class="nt">&lt;executions&gt;</span>
          <span class="nt">&lt;execution&gt;</span>
            <span class="nt">&lt;goals&gt;</span>
              <span class="nt">&lt;goal&gt;</span>copy-dependencies<span class="nt">&lt;/goal&gt;</span>
            <span class="nt">&lt;/goals&gt;</span>
            <span class="nt">&lt;configuration&gt;</span>
              <span class="nt">&lt;outputDirectory&gt;</span>${project.build.directory}/deps<span class="nt">&lt;/outputDirectory&gt;</span>
            <span class="nt">&lt;/configuration&gt;</span>
          <span class="nt">&lt;/execution&gt;</span>
        <span class="nt">&lt;/executions&gt;</span>
      <span class="nt">&lt;/plugin&gt;</span>
    <span class="nt">&lt;/plugins&gt;</span>
  <span class="nt">&lt;/build&gt;</span>
<span class="nt">&lt;/project&gt;</span></code></pre></figure><p>Running <code>mvn clean package</code> should build a <code>foo.jar</code> file in <code>target</code> directory and a collection of all JAR dependencies in <code>target/deps</code>. Now you can run the app from the command line:</p><figure class="highlight"><pre><code class="language-bash" data-lang="bash"><span></span>$ mvn clean package
$ java -Dfile.encoding<span class="o">=</span>UTF-8 <span class="se">\</span>
  -cp ./target/foo.jar:./target/deps/* foo.Entry --port<span class="o">=</span><span class="m">8080</span></code></pre></figure><p>The application is ready, and you can deploy it to, say, Heroku. Just create a <code>Procfile</code> file in the root of the repository and push the repo to Heroku. This is what <code>Procfile</code> should look like:</p><figure class="highlight"><pre><code class="language-text" data-lang="text"><span></span>web: java -Dfile.encoding=UTF-8 \
  -cp target/foo.jar:target/deps/* \
  foo.Entry --port=${PORT}</code></pre></figure><h2 id="tkfork"><code>TkFork</code></h2><p>This <a href="http://static.javadoc.io/org.takes/takes/1.1/org/takes/facets/fork/TkFork.html"><code>TkFork</code></a> class seems to be one of the core elements of the framework. It helps route an incoming HTTP request to the right <em>take</em>. Its logic is very simple, and there are just a few lines of code inside it. It encapsulates a collection of &quot;forks,&quot; which are instances of the <a href="http://static.javadoc.io/org.takes/takes/1.1/org/takes/facets/fork/Fork.html"><code>Fork</code></a> interface:</p><figure class="highlight"><pre><code class="language-java" data-lang="java"><span></span><span class="kd">public</span> <span class="kd">interface</span> <span class="nc">Fork</span> <span class="o">{</span>
  <span class="n">Iterator</span><span class="o">&lt;</span><span class="n">Response</span><span class="o">&gt;</span> <span class="nf">route</span><span class="o">(</span><span class="n">Request</span> <span class="n">req</span><span class="o">)</span> <span class="kd">throws</span> <span class="n">IOException</span><span class="o">;</span>
<span class="o">}</span></code></pre></figure><p>Its only <code>route()</code> method either returns an empty iterator or an iterator with a single <code>Response</code>. <code>TkFork</code> goes through all forks, calling their <code>route()</code> methods until one of them returns a response. Once that happens, <code>TkFork</code> returns this response to the caller, which is <a href="http://static.javadoc.io/org.takes/takes/1.1/org/takes/http/FtBasic.html"><code>FtBasic</code></a>.</p><p>Let&#39;s create a simple fork ourselves now. For example, we want to show the status of the application when the <code>/status</code> URL is requested. Here is the code:</p><figure class="highlight"><pre><code class="language-java" data-lang="java"><span></span><span class="kd">final</span> <span class="kd">class</span> <span class="nc">TkApp</span> <span class="kd">extends</span> <span class="n">TkWrap</span> <span class="o">{</span>
  <span class="kd">private</span> <span class="kd">static</span> <span class="n">Take</span> <span class="nf">make</span><span class="o">()</span> <span class="o">{</span>
    <span class="k">return</span> <span class="k">new</span> <span class="n">TkFork</span><span class="o">(</span>
      <span class="k">new</span> <span class="n">Fork</span><span class="o">()</span> <span class="o">{</span>
        <span class="nd">@Override</span>
        <span class="kd">public</span> <span class="n">Iterator</span><span class="o">&lt;</span><span class="n">Response</span><span class="o">&gt;</span> <span class="nf">route</span><span class="o">(</span><span class="n">Request</span> <span class="n">req</span><span class="o">)</span> <span class="o">{</span>
          <span class="kd">final</span> <span class="n">Collection</span><span class="o">&lt;</span><span class="n">Response</span><span class="o">&gt;</span> <span class="n">responses</span> <span class="o">=</span> <span class="k">new</span> <span class="n">ArrayList</span><span class="o">&lt;&gt;(</span><span class="mi">1</span><span class="o">);</span>
          <span class="k">if</span> <span class="o">(</span><span class="k">new</span> <span class="n">RqHref</span><span class="o">(</span><span class="n">req</span><span class="o">).</span><span class="na">href</span><span class="o">().</span><span class="na">path</span><span class="o">().</span><span class="na">equals</span><span class="o">(</span><span class="s">&quot;/status&quot;</span><span class="o">))</span> <span class="o">{</span>
            <span class="n">responses</span><span class="o">.</span><span class="na">add</span><span class="o">(</span><span class="k">new</span> <span class="n">TkStatus</span><span class="o">());</span>
          <span class="o">}</span>
          <span class="k">return</span> <span class="n">responses</span><span class="o">.</span><span class="na">iterator</span><span class="o">();</span>
        <span class="o">}</span>
      <span class="o">}</span>
    <span class="o">);</span>
  <span class="o">}</span>
<span class="o">}</span></code></pre></figure><p>I believe the logic here is clear. We either return an empty iterator or an iterator with an instance of <code>TkStatus</code> inside. If an empty iterator is returned, <code>TkFork</code> will try to find another fork in the collection that actually gets an instance of <code>Response</code>. By the way, if nothing is found and all forks return empty iterators, <code>TkFork</code> will throw a &quot;Page not found&quot; exception.</p><p>This exact logic is implemented by an out-of-the-box fork called <code>FkRegex</code>, which attempts to match a request URI path with the regular expression provided:</p><figure class="highlight"><pre><code class="language-java" data-lang="java"><span></span><span class="kd">final</span> <span class="kd">class</span> <span class="nc">TkApp</span> <span class="kd">extends</span> <span class="n">TkWrap</span> <span class="o">{</span>
  <span class="kd">private</span> <span class="kd">static</span> <span class="n">Take</span> <span class="nf">make</span><span class="o">()</span> <span class="o">{</span>
    <span class="k">return</span> <span class="k">new</span> <span class="n">TkFork</span><span class="o">(</span>
      <span class="k">new</span> <span class="n">FkRegex</span><span class="o">(</span><span class="s">&quot;/status&quot;</span><span class="o">,</span> <span class="k">new</span> <span class="n">TkStatus</span><span class="o">())</span>
    <span class="o">);</span>
  <span class="o">}</span>
<span class="o">}</span></code></pre></figure><p>We can compose a multi-level structure of <code>TkFork</code> classes; for example:</p><figure class="highlight"><pre><code class="language-java" data-lang="java"><span></span><span class="kd">final</span> <span class="kd">class</span> <span class="nc">TkApp</span> <span class="kd">extends</span> <span class="n">TsWrap</span> <span class="o">{</span>
  <span class="kd">private</span> <span class="kd">static</span> <span class="n">Take</span> <span class="nf">make</span><span class="o">()</span> <span class="o">{</span>
    <span class="k">return</span> <span class="k">new</span> <span class="n">TkFork</span><span class="o">(</span>
      <span class="k">new</span> <span class="n">FkRegex</span><span class="o">(</span>
        <span class="s">&quot;/status&quot;</span><span class="o">,</span>
        <span class="k">new</span> <span class="n">TkFork</span><span class="o">(</span>
          <span class="k">new</span> <span class="n">FkParams</span><span class="o">(</span><span class="s">&quot;f&quot;</span><span class="o">,</span> <span class="s">&quot;json&quot;</span><span class="o">,</span> <span class="k">new</span> <span class="n">TkStatusJSON</span><span class="o">()),</span>
          <span class="k">new</span> <span class="n">FkParams</span><span class="o">(</span><span class="s">&quot;f&quot;</span><span class="o">,</span> <span class="s">&quot;xml&quot;</span><span class="o">,</span> <span class="k">new</span> <span class="n">TkStatusXML</span><span class="o">())</span>
        <span class="o">)</span>
      <span class="o">)</span>
    <span class="o">);</span>
  <span class="o">}</span>
<span class="o">}</span></code></pre></figure><p>Again, I believe it&#39;s obvious. The instance of <code>FkRegex</code> will ask an encapsulated instance of <code>TkFork</code> to return a response, and it will try to fetch it from one that <code>FkParams</code> encapsulated. If the HTTP query is <code>/status?f=xml</code>, an instance of <code>TkStatusXML</code> will be returned.</p><h2 id="http-response">HTTP Response</h2><p>Now let&#39;s discuss the structure of the HTTP response and its object-oriented abstraction, <a href="http://static.javadoc.io/org.takes/takes/1.1/org/takes/Response.html"><code>Response</code></a>. This is how the interface looks:</p><figure class="highlight"><pre><code class="language-java" data-lang="java"><span></span><span class="kd">public</span> <span class="kd">interface</span> <span class="nc">Response</span> <span class="o">{</span>
  <span class="n">Iterable</span><span class="o">&lt;</span><span class="n">String</span><span class="o">&gt;</span> <span class="nf">head</span><span class="o">()</span> <span class="kd">throws</span> <span class="n">IOException</span><span class="o">;</span>
  <span class="n">InputStream</span> <span class="nf">body</span><span class="o">()</span> <span class="kd">throws</span> <span class="n">IOException</span><span class="o">;</span>
<span class="o">}</span></code></pre></figure><p>Looks very similar to the <a href="http://static.javadoc.io/org.takes/takes/1.1/org/takes/Request.html"><code>Request</code></a>, doesn&#39;t it? Well, it&#39;s identical, mostly because the structure of the HTTP request and response is almost identical. The only difference is the first line.</p><p>There is a collection of useful decorators that help in response building. They are <a href="/2015/02/26/composable-decorators.html">composable</a>, which makes them very convenient. For example, if you want to build a response that contains an HTML page, you compose them like this:</p><figure class="highlight"><pre><code class="language-java" data-lang="java"><span></span><span class="kd">final</span> <span class="kd">class</span> <span class="nc">TkIndex</span> <span class="kd">implements</span> <span class="n">Take</span> <span class="o">{</span>
  <span class="nd">@Override</span>
  <span class="kd">public</span> <span class="n">Response</span> <span class="nf">act</span><span class="o">()</span> <span class="o">{</span>
    <span class="k">return</span> <span class="k">new</span> <span class="n">RsWithStatus</span><span class="o">(</span>
      <span class="k">new</span> <span class="n">RsWithType</span><span class="o">(</span>
        <span class="k">new</span> <span class="n">RsWithBody</span><span class="o">(</span><span class="s">&quot;&lt;html&gt;Hello, world!&lt;/html&gt;&quot;</span><span class="o">),</span>
        <span class="s">&quot;text/html&quot;</span>
      <span class="o">),</span>
      <span class="mi">200</span>
    <span class="o">);</span>
  <span class="o">}</span>
<span class="o">}</span></code></pre></figure><p>In this example, the decorator <code>RsWithBody</code> creates a response with a body but with no headers at all. Then, <code>RsWithType</code> adds the header <code>Content-Type: text/html</code> to it. Then, <code>RsWithStatus</code> makes sure the first line of the response contains <code>HTTP/1.1 200 OK</code>.</p><p>You can create your own decorators that can reuse existing ones. Take a look at how it&#39;s done in <a href="https://github.com/yegor256/rultor/blob/1.50.2/src/main/java/com/rultor/web/RsPage.java"><code>RsPage</code></a> from rultor.com.</p><h2 id="how-about-templates">How About Templates?</h2><p>Returning simple &quot;Hello, world&quot; pages is not a big problem, as we can see. But what about more complex output like HTML pages, <a href="/2015/11/16/json-vs-xml.html">XML</a> documents, JSON data sets, etc? There are a few convenient <code>Response</code> decorators that enable all of that. Let&#39;s start with <a href="http://velocity.apache.org">Velocity</a>, a simple templating engine. Well, it&#39;s not that simple. It&#39;s rather powerful, but I would suggest to use it in simple situations only. Here is how it works:</p><figure class="highlight"><pre><code class="language-java" data-lang="java"><span></span><span class="kd">final</span> <span class="kd">class</span> <span class="nc">TkIndex</span> <span class="kd">implements</span> <span class="n">Take</span> <span class="o">{</span>
  <span class="nd">@Override</span>
  <span class="kd">public</span> <span class="n">Response</span> <span class="nf">act</span><span class="o">()</span> <span class="o">{</span>
    <span class="k">return</span> <span class="k">new</span> <span class="n">RsVelocity</span><span class="o">(</span><span class="s">&quot;Hello, ${name}&quot;</span><span class="o">)</span>
      <span class="o">.</span><span class="na">with</span><span class="o">(</span><span class="s">&quot;name&quot;</span><span class="o">,</span> <span class="s">&quot;Jeffrey&quot;</span><span class="o">);</span>
  <span class="o">}</span>
<span class="o">}</span></code></pre></figure><p>The <a href="http://static.javadoc.io/org.takes/takes/1.1/org/takes/rs/RsVelocity.html"><code>RsVelocity</code></a> constructor accepts a single argument that has to be a Velocity template. Then, you call the <code>with()</code> method, injecting data into the Velocity context. When it&#39;s time to render the HTTP response, <code>RsVelocity</code> will &quot;evaluate&quot; the template against the context configured. Again, I would recommend you use this templating approach only for simple outputs.</p><p>For more complex HTML documents, I would recommend you use XML/XSLT in combination with Xembly. I explained this idea in a few previous posts: <a href="/2014/06/25/xml-and-xslt-in-browser.html">XML+XSLT in a Browser</a> and <a href="/2014/09/09/restful-web-sites.html">RESTful API and a Web Site in the Same URL</a>. It is simple and powerful---Java generates XML output and the XSLT processor transforms it into HTML documents. This is how we separate representation from data. The XSL stylesheet is a &quot;view&quot; and <code>TkIndex</code> is a &quot;controller,&quot; in terms of <a href="/2016/12/13/mvc-vs-oop.html">MVC</a>.</p><p>I&#39;ll write a separate article about templating with Xembly and XSL very soon.</p><p>In the meantime, we&#39;ll create decorators for <a href="http://en.wikipedia.org/wiki/Facelets">JSF/Facelets</a> and <a href="http://en.wikipedia.org/wiki/JavaServer_Pages">JSP</a> rendering in Takes. If you&#39;re interested in helping, please fork the framework and submit your pull requests.</p><h2 id="what-about-persistence">What About Persistence?</h2><p>Now, a question that comes up is what to do with persistent entities, like databases, in-memory structures, network connections, etc. My suggestion is to initialize them inside the <code>Entry</code> class and pass them as arguments into the <code>TkApp</code> constructor. Then, the <code>TkApp</code> will pass them into the constructors of custom <em>takes</em>.</p><p>For example, we have a PostgreSQL database that contains some table data that we need to render. Here is how I would initialize a connection to it in the <code>Entry</code> class (I&#39;m using a <a href="http://www.jolbox.com/">BoneCP</a> connection pool):</p><figure class="highlight"><pre><code class="language-java" data-lang="java"><span></span><span class="kd">public</span> <span class="kd">final</span> <span class="kd">class</span> <span class="nc">Entry</span> <span class="o">{</span>
  <span class="kd">public</span> <span class="kd">static</span> <span class="kt">void</span> <span class="nf">main</span><span class="o">(</span><span class="kd">final</span> <span class="n">String</span><span class="o">...</span> <span class="n">args</span><span class="o">)</span> <span class="kd">throws</span> <span class="n">Exception</span> <span class="o">{</span>
    <span class="k">new</span> <span class="n">FtCli</span><span class="o">(</span><span class="k">new</span> <span class="n">TkApp</span><span class="o">(</span><span class="n">Entry</span><span class="o">.</span><span class="na">postgres</span><span class="o">()),</span> <span class="n">args</span><span class="o">).</span><span class="na">start</span><span class="o">(</span><span class="n">Exit</span><span class="o">.</span><span class="na">NEVER</span><span class="o">);</span>
  <span class="o">}</span>
  <span class="kd">private</span> <span class="kd">static</span> <span class="n">Source</span> <span class="nf">postgres</span><span class="o">()</span> <span class="o">{</span>
    <span class="kd">final</span> <span class="n">BoneCPDataSource</span> <span class="n">src</span> <span class="o">=</span> <span class="k">new</span> <span class="n">BoneCPDataSource</span><span class="o">();</span>
    <span class="n">src</span><span class="o">.</span><span class="na">setDriverClass</span><span class="o">(</span><span class="s">&quot;org.postgresql.Driver&quot;</span><span class="o">);</span>
    <span class="n">src</span><span class="o">.</span><span class="na">setJdbcUrl</span><span class="o">(</span><span class="s">&quot;jdbc:postgresql://localhost/db&quot;</span><span class="o">);</span>
    <span class="n">src</span><span class="o">.</span><span class="na">setUser</span><span class="o">(</span><span class="s">&quot;root&quot;</span><span class="o">);</span>
    <span class="n">src</span><span class="o">.</span><span class="na">setPassword</span><span class="o">(</span><span class="s">&quot;super-secret-password&quot;</span><span class="o">);</span>
    <span class="k">return</span> <span class="n">src</span><span class="o">;</span>
  <span class="o">}</span>
<span class="o">}</span></code></pre></figure><p>Now, the constructor of <code>TkApp</code> must accept a single argument of type <code>java.sql.Source</code>:</p><figure class="highlight"><pre><code class="language-java" data-lang="java"><span></span><span class="kd">final</span> <span class="kd">class</span> <span class="nc">TkApp</span> <span class="kd">extends</span> <span class="n">TkWrap</span> <span class="o">{</span>
  <span class="n">TkApp</span><span class="o">(</span><span class="kd">final</span> <span class="n">Source</span> <span class="n">source</span><span class="o">)</span> <span class="o">{</span>
    <span class="kd">super</span><span class="o">(</span><span class="n">TkApp</span><span class="o">.</span><span class="na">make</span><span class="o">(</span><span class="n">source</span><span class="o">));</span>
  <span class="o">}</span>
  <span class="kd">private</span> <span class="kd">static</span> <span class="n">Take</span> <span class="nf">make</span><span class="o">(</span><span class="kd">final</span> <span class="n">Source</span> <span class="n">source</span><span class="o">)</span> <span class="o">{</span>
    <span class="k">return</span> <span class="k">new</span> <span class="n">TkFork</span><span class="o">(</span>
      <span class="k">new</span> <span class="n">FkRegex</span><span class="o">(</span><span class="s">&quot;/&quot;</span><span class="o">,</span> <span class="k">new</span> <span class="n">TkIndex</span><span class="o">(</span><span class="n">source</span><span class="o">))</span>
    <span class="o">);</span>
  <span class="o">}</span>
<span class="o">}</span></code></pre></figure><p>Class <code>TkIndex</code> also accepts a single argument of class <code>Source</code>. I believe you know what to do with it inside <code>TkIndex</code> in order to fetch the SQL table data and convert it into HTML. The point here is that the dependency must be injected into the application (instance of class <code>TkApp</code>) at the moment of its instantiation. This is a pure and clean dependency injection mechanism, which is absolutely container-free. Read more about it in <a href="/2014/10/03/di-containers-are-evil.html">Dependency Injection Containers Are Code Polluters</a>.</p><h2 id="unit-testing">Unit Testing</h2><p>Since every class is immutable and all dependencies are injected only through constructors, unit testing is extremely easy. Let&#39;s say we want to test <code>TkStatus</code>, which is supposed to return an HTML response (I&#39;m using <a href="http://junit.org/">JUnit 4</a> and <a href="https://github.com/hamcrest/JavaHamcrest">Hamcrest</a>):</p><figure class="highlight"><pre><code class="language-java" data-lang="java"><span></span><span class="kn">import</span> <span class="nn">org.junit.Test</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">org.hamcrest.MatcherAssert</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">org.hamcrest.Matchers</span><span class="o">;</span>
<span class="kd">public</span> <span class="kd">final</span> <span class="kd">class</span> <span class="nc">TkIndexTest</span> <span class="o">{</span>
  <span class="nd">@Test</span>
  <span class="kd">public</span> <span class="kt">void</span> <span class="nf">returnsHtmlPage</span><span class="o">()</span> <span class="kd">throws</span> <span class="n">Exception</span> <span class="o">{</span>
    <span class="n">MatcherAssert</span><span class="o">.</span><span class="na">assertThat</span><span class="o">(</span>
      <span class="k">new</span> <span class="n">RsPrint</span><span class="o">(</span>
        <span class="k">new</span> <span class="n">TkStatus</span><span class="o">().</span><span class="na">act</span><span class="o">(</span><span class="k">new</span> <span class="n">RqFake</span><span class="o">())</span>
      <span class="o">).</span><span class="na">printBody</span><span class="o">(),</span>
      <span class="n">Matchers</span><span class="o">.</span><span class="na">equalsTo</span><span class="o">(</span><span class="s">&quot;&lt;html&gt;Hello, world!&lt;/html&gt;&quot;</span><span class="o">)</span>
    <span class="o">);</span>
  <span class="o">}</span>
<span class="o">}</span></code></pre></figure><p>Also, we can start the entire application or any individual <em>take</em> in a test HTTP server and test its behavior via a real TCP socket; for example (I&#39;m using <a href="http://http.jcabi.com">jcabi-http</a> to make an HTTP request and check the output):</p><figure class="highlight"><pre><code class="language-java" data-lang="java"><span></span><span class="kd">public</span> <span class="kd">final</span> <span class="kd">class</span> <span class="nc">TkIndexTest</span> <span class="o">{</span>
  <span class="nd">@Test</span>
  <span class="kd">public</span> <span class="kt">void</span> <span class="nf">returnsHtmlPage</span><span class="o">()</span> <span class="kd">throws</span> <span class="n">Exception</span> <span class="o">{</span>
    <span class="k">new</span> <span class="n">FtRemote</span><span class="o">(</span><span class="k">new</span> <span class="n">TkIndex</span><span class="o">()).</span><span class="na">exec</span><span class="o">(</span>
      <span class="k">new</span> <span class="n">FtRemote</span><span class="o">.</span><span class="na">Script</span><span class="o">()</span> <span class="o">{</span>
        <span class="nd">@Override</span>
        <span class="kd">public</span> <span class="kt">void</span> <span class="nf">exec</span><span class="o">(</span><span class="kd">final</span> <span class="n">URI</span> <span class="n">home</span><span class="o">)</span> <span class="kd">throws</span> <span class="n">IOException</span> <span class="o">{</span>
          <span class="k">new</span> <span class="n">JdkRequest</span><span class="o">(</span><span class="n">home</span><span class="o">)</span>
            <span class="o">.</span><span class="na">fetch</span><span class="o">()</span>
            <span class="o">.</span><span class="na">as</span><span class="o">(</span><span class="n">RestResponse</span><span class="o">.</span><span class="na">class</span><span class="o">)</span>
            <span class="o">.</span><span class="na">assertStatus</span><span class="o">(</span><span class="n">HttpURLConnection</span><span class="o">.</span><span class="na">HTTP_OK</span><span class="o">)</span>
            <span class="o">.</span><span class="na">assertBody</span><span class="o">(</span><span class="n">Matchers</span><span class="o">.</span><span class="na">containsString</span><span class="o">(</span><span class="s">&quot;Hello, world!&quot;</span><span class="o">));</span>
        <span class="o">}</span>
      <span class="o">}</span>
    <span class="o">);</span>
  <span class="o">}</span>
<span class="o">}</span></code></pre></figure><p><a href="http://static.javadoc.io/org.takes/takes/1.1/org/takes/http/FtRemote.html"><code>FtRemote</code></a> starts a test web server at a random TCP port and calls the <code>exec()</code> method at the provided instance of <code>FtRemote.Script</code>. The first argument of this method is a URI of the just-started web server homepage.</p><p>The architecture of Takes framework is very modular and composable. Any individual <em>take</em> can be tested as a standalone component, absolutely independent from the framework and other <em>takes</em>.</p><h2 id="why-the-name">Why the Name?</h2><p>That&#39;s the question I&#39;ve been hearing rather often. The idea is simple, and it originates from the movie business. When a movie is made, the crew shoots many <em>takes</em> in order to capture the reality and put it on film. Each capture is called a <em>take</em>.</p><p>In other words, a <em>take</em> is like a snapshot of the reality.</p><p>The same applies to this framework. Each instance of <code>Take</code> represents a reality at one particular moment in time. This reality is then sent to the user in the form of a <code>Response</code>.</p><p>PS. There are a few words about authentication: <a href="/2015/05/18/cookie-based-authentication.html">How Cookie-Based Authentication Works in the Takes Framework</a>.</p><p>PPS. There are a few real web systems, which you may be interested to take a look at. They all are using Takes Framework and their code is open: <a href="https://github.com/yegor256/rultor">rultor.com</a>, <a href="/2016/03/30/jare-instant-free-cdn.html">jare.io</a>, <a href="/2016/03/15/wring-dispatcher-github-notifications.html">wring.io</a>.</p></div></article></div><div class="wrapper"> <related-posts /></div><div class="disqus" role="complementary"><p class="disqus_hint"> Please, use <a href="https://help.disqus.com/commenting/what-html-tags-are-allowed-within-comments">syntax highlighting</a> in your comments, to make them more readable.</p><div id="disqus_thread" class="disqus-thread"> <a>&nbsp;</a></div><script> var disqus_config = function () { this.page.url = document.location.href.split('?')[0].split('#')[0].replace('https://', 'http://'); this.page.identifier = this.page.url; }; (function() { var d = document, s = d.createElement('script'); s.src = '//yegor256.disqus.com/embed.js'; s.setAttribute('data-timestamp', +new Date()); (d.head || d.body).appendChild(s); })(); </script> <noscript><div><p class="red"> JavaScript is disabled in your browser, that's why you can't see comments under this post.</p></div></noscript></div><div class="wrapper"> <footer class="footer"><p> &copy; <span itemscope="" itemprop="copyrightHolder" itemtype="http://schema.org/Person"> <span itemprop="name">Yegor Bugayenko</span> </span> 2014&ndash;<span itemprop="copyrightYear">2018</span></p></footer></div></section><div class="wrapper unprintable" style="text-align:center;margin-top:2em;"> <a href="http://www.sixnines.io/h/3ba1652f"> <img src="//www.sixnines.io/b/3ba1652f?style=flat" alt="sixnines availability badge"/> </a></div><script src="//code.jquery.com/jquery-1.9.0.min.js"></script> <script src="/js/all.js?4e047f6f42b"></script> <script>var disqus_shortname = 'yegor256';</script> <script id="dsq-count-scr" src="//yegor256.disqus.com/count.js" async="async"></script> <script> (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){ (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o), m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m) })(window,document,'script','//www.google-analytics.com/analytics.js','ga'); ga('create', 'UA-1963507-32', 'auto'); ga('send', 'pageview'); </script> <script> Cd=document;Cr="&"+Math.random();Cp="&s=1"; Cd.cookie="b=b";if(Cd.cookie)Cp+="&c=1"; Cp+="&t="+(new Date()).getTimezoneOffset(); if(self!=top)Cp+="&f=1"; </script> <script> if(navigator.javaEnabled())Cp+="&j=1"; </script> <script> if(typeof(screen)!='undefined')Cp+="&w="+screen.width+"&h="+ screen.height+"&d="+(screen.colorDepth?screen.colorDepth:screen.pixelDepth); </script> <script> Cd.write("<img src='//c.hit.ua/hit?i=95870&g=0&x=2"+Cp+Cr+ "&r="+escape(Cd.referrer)+"&u="+escape(window.location.href)+ "' border='0' wi"+"dth='1' he"+"ight='1'/>"); </script> <script type="application/ld+json"> { "@context": "http://schema.org", "@type": "Person", "name": "Yegor Bugayenko", "url": "http://www.yegor256.com", "sameAs": [ "https://www.facebook.com/yegor256", "https://instagram.com/yegor256", "https://www.linkedin.com/in/yegor256", "https://twitter.com/yegor256", "https://github.com/yegor256", "https://www.pinterest.com/yegor256/" ] } </script> </body> </html> <!DOCTYPE html> <html xmlns="http://www.w3.org/1999/xhtml" lang="en-US" xml:lang="en-US" itemscope="" itemtype="http://schema.org/WebSite"> <head> <meta charset="utf-8"/> <meta name="description" content="Maven pom.xml files may be repeatedly verbose from project to project; jcabi-parent offers a pre-configured solution. " /> <meta name="keywords" content="maven parent pom, maven pom, maven pom settings, parent pom maven, pom reference" /> <meta name="viewport" content="width=device-width,minimum-scale=1,initial-scale=1"/> <meta name="google-site-verification" content="JEj_gQr2CPe2QKGw8XdMz0R7VboQIUbX3FlM-lwTq-8" /> <meta name="author" content="Yegor Bugayenko"> <meta name="article:published_time" content="2015-02-05 00:00:00 +0000"> <meta name="og:site_name" content="Yegor Bugayenko"/> <meta name="og:type" content="article" /> <meta name="og:locale" content="en_US" /> <meta name="twitter:account_id" content="4503599630178231" /> <meta name="twitter:creator" content="@yegor256"/> <meta name="twitter:site" content="@yegor256"/> <meta name="twitter:title" property="og:title" content="Don't Repeat Yourself in Maven POMs; Use Jcabi-Parent"/> <meta name="twitter:description" property="og:description" content="Maven pom.xml files may be repeatedly verbose from project to project; jcabi-parent offers a pre-configured solution. "/> <meta name="twitter:url" property="og:url" content="https://www.yegor256.com/2015/02/05/jcabi-parent-maven-pom.html"/> <meta name="telegram:channel" content="AAAAAEJFMRzsRTRxM3ec6A"/> <link rel="search" type="application/opensearchdescription+xml" href="/opensearch.xml" title="yegor256" /> <link rel="shortcut icon" href="/favicon.ico?4e047f6f42b"/> <link rel="apple-touch-icon" href="/favicon.ico?4e047f6f42b"/> <link rel="alternate" type="application/rss+xml" title="RSS for yegor256.com" href="https://www.yegor256.com/rss.xml"/> <link rel="stylesheet" href="/css/layout.css?4e047f6f42b"/> <link rel="stylesheet" href="/css/icons.css?4e047f6f42b"/> <link rel="canonical" href="https://www.yegor256.com/2015/02/05/jcabi-parent-maven-pom.html" /> <link rel="amphtml" href="https://www.yegor256.com/2015/02/05/jcabi-parent-maven-pom.amp.html" /> <title>Don't Repeat Yourself in Maven POMs; Use Jcabi-Parent </title> </head> <body><div class="wrapper"> <aside class="header-toggle unprintable" id="header-toggle" title="Show the menu" onclick="$('#header').show();$('#header-toggle').hide();">&#9776;</aside> <header class="header" id="header"><div class="face"> <a href="/about-me.html#form" class="sub" title="Click to subscribe to my monthly newsletter"><span>Subscribe</span></a> <a href="/about-me.html" style="position:relative;"> <img src="/images/face-256x256.jpg" class="photo" alt="Yegor Bugayenko"/> </a></div><nav><ul class="menu social notranslate"> <li><a href="https://twitter.com/intent/follow?screen_name=yegor256" rel="nofollow" title="Follow me on Twitter"><i class="icon icon-twitter notranslate" aria-hidden="true"></i></a></li> <li><a href="/rss.xml" rel="nofollow" title="Subscribe to my RSS feed"><i class="icon icon-rss notranslate" aria-hidden="true"></i></a></li> <li><a itemprop="sameAs" href="https://github.com/yegor256" rel="nofollow" title="My GitHub profile"><i class="icon icon-github notranslate" aria-hidden="true"></i></a></li> <li><a itemprop="sameAs" href="http://stackoverflow.com/users/187141/yegor256" rel="nofollow" title="My StackOverflow profile"><i class="icon icon-stackoverflow notranslate" aria-hidden="true"></i></a></li> <li><a itemprop="sameAs" href="https://www.facebook.com/yegor256" rel="nofollow" title="Follow me on Facebook"><i class="icon icon-facebook notranslate" aria-hidden="true"></i></a></li> <li><a itemprop="sameAs" href="https://instagram.com/yegor256" rel="nofollow" title="Follow me on Instagram"><i class="icon icon-instagram notranslate" aria-hidden="true"></i></a></li> <li><a itemprop="sameAs" href="https://www.linkedin.com/in/yegor256" rel="nofollow" title="My LinkedIn profile"><i class="icon icon-linkedin notranslate" aria-hidden="true"></i></a></li> <li><a itemprop="sameAs" href="https://www.youtube.com/c/yegor256?sub_confirmation=1" rel="nofollow" title="My Youtube video channel"><i class="icon icon-youtube notranslate" aria-hidden="true"></i></a></li> <li><a itemprop="sameAs" href="https://www.pinterest.com/yegor256/" rel="nofollow" title="My Pinterest boards"><i class="icon icon-pinterest notranslate" aria-hidden="true"></i></a></li> <li><a itemprop="sameAs" href="https://angel.co/yegor256" rel="nofollow" title="My AngelList profile"><i class="icon icon-angellist notranslate" aria-hidden="true"></i></a></li> <li><a href="https://soundcloud.com/yegor256" rel="nofollow" title="My podcast"><i class="icon icon-podcast notranslate" aria-hidden="true"></i></a></li> <li><a href="https://itunes.apple.com/us/podcast/yegor256-podcast/id1150826721" rel="nofollow" title="My iTunes podcast"><i class="icon icon-itunes notranslate" aria-hidden="true"></i></a></li> <li><a href="https://t.me/joinchat/AAAAAEJFMRzsRTRxM3ec6A" rel="nofollow" title="My Telegram public channel"><i class="icon icon-telegram notranslate" aria-hidden="true"></i></a></li> <li><a href="mailto:blog@yegor256.com" rel="nofollow" title="Email me any time"><i class="icon icon-mail notranslate" aria-hidden="true"></i></a></li></ul><ul class="menu"> <li><a href="/" title="Home page">Home</a></li> <li ><a href="/best.html" title="Best articles to read">12&#160;Best</a></li> <li ><a href="/contents.html" title="The contents of the entire blog">All&#160;288</a></li> <li ><a href="/webinars.html" title="My webinars">Webinars</a></li> <li ><a href="/talks.html" title="Future and past conference talks">Talks</a></li> <li ><a href="/books.html" title="The books I wrote">Books</a></li> <li ><a href="/papers.html" title="My academic papers and patents">Papers</a></li> <li ><a href="/pets.html" title="My loved pet projects">Pets</a></li> <li ><a href="/award.html" title="Software quality award">Award</a></li> <li ><a href="/testimonials.html" title="What some people say about me">Testimonials</a></li> <li ><a href="/shift-m.html" title="Audio podcast about project management">Shift-M</a></li> <li ><a href="/paintings.html" title="My paintings for sale">Paintings</a></li> <li><a href="http://ru.yegor256.com/" title="Немного на русском языке">По-русски</a></li></ul></nav><div class="search"> <form method="get" action="https://www.google.com/search" itemprop="potentialAction" itemscope="" itemtype="http://schema.org/SearchAction"> <meta itemprop="target" content="https://www.google.com/search?q={q}"/> <input name="sitesearch" value="yegor256.com" type="hidden"/> <input itemprop="query-input" type="text" id="search-query" class="field field-text" required="required" onfocus="$('.google').css('visibility', 'visible');" name="q" placeholder="Search..." autocomplete="off"/> <input type="image" src="/images/google-search-icon.svg" class="google" title="Search via Google" alt="Search via Google"/> </form></div><div class="hot"><ul> <li> <a href="/code-ahead.html">Code Ahead</a> was published on Amazon just a few days ago! It is my new book, a novel about programmers. It explains in details the majority of ideas that stand behind <a href="https://www.zerocracy.com">Zerocracy</a> and <a href="https://www.xdsd.org">XDSD</a>. </li> <li> At <a href="/webinars.html">Webinar #37</a> we will discuss naming problem in OOP, for objects, methods and attributes; join us on <b>September 12</b>, at 11am PST. </li></ul></div></header></div><section itemscope="" itemtype="http://schema.org/BlogPosting"><div class="wrapper"> <header><p class="printable"> <img src="https://api.qrserver.com/v1/create-qr-code/?data=https://www.yegor256.com/2015/02/05/jcabi-parent-maven-pom.html&amp;format=svg" style="width:125px;height:125px;" alt="QR code"/></p><p class="printable"> <code itemprop="url">https://www.yegor256.com/2015/02/05/jcabi-parent-maven-pom.html</code></p><h1 itemprop="name headline mainEntityOfPage">Don't Repeat Yourself in Maven POMs; Use Jcabi-Parent</h1><ul class="subline"> <li> <time itemprop="datePublished" datetime="2015-02-05T00:00:00+00:00"> 5 February 2015 </time> </li> <li class="printable" itemscope="" itemprop="author" itemtype="http://schema.org/Person"> <span itemprop="name">Yegor Bugayenko</span> </li> <li class="unprintable"> <i class="icon icon-comments"></i> <a href="http://www.yegor256.com/2015/02/05/jcabi-parent-maven-pom.html#disqus_thread" itemprop="discussionUrl">comments</a> </li></ul><p><a href="http://parent.jcabi.com">jcabi-parent</a> is a very simple Maven dependency with nothing inside it except a large <code>pom.xml</code> with multiple pre-configured dependencies, profiles, and plugins. All you need to do in order to reuse them all in your project is define <code>com.jcabi:parent</code> as your parent POM:</p><figure class="highlight"><pre><code class="language-xml" data-lang="xml"><span></span><span class="nt">&lt;project</span> <span class="na">xmlns=</span><span class="s">&quot;http://maven.apache.org/POM/4.0.0&quot;</span>
  <span class="na">xmlns:xsi=</span><span class="s">&quot;http://www.w3.org/2001/XMLSchema-instance&quot;</span>
  <span class="na">xsi:schemaLocation=</span><span class="s">&quot;http://maven.apache.org/POM/4.0.0</span>
<span class="s">    http://maven.apache.org/xsd/maven-4.0.0.xsd&quot;</span><span class="nt">&gt;</span>
  <span class="nt">&lt;modelVersion&gt;</span>4.0.0<span class="nt">&lt;/modelVersion&gt;</span>
  <span class="nt">&lt;parent&gt;</span>
    <span class="nt">&lt;groupId&gt;</span>com.jcabi<span class="nt">&lt;/groupId&gt;</span>
    <span class="nt">&lt;artifactId&gt;</span>parent<span class="nt">&lt;/artifactId&gt;</span>
    <span class="c">&lt;!-- check the latest version at http://parent.jcabi.com --&gt;</span>
    <span class="nt">&lt;version&gt;</span>0.32.1<span class="nt">&lt;/version&gt;</span>
  <span class="nt">&lt;/parent&gt;</span>
  [...]
<span class="nt">&lt;/project&gt;</span></code></pre></figure><p>That&#39;s all you need. Now you can remove most of your custom configurations from <code>pom.xml</code> and rely on defaults provided by jcabi-parent. Its <a href="https://github.com/jcabi/jcabi-parent/blob/master/pom.xml"><code>pom.xml</code></a> is rather large and properly configured. Multiple projects depend on it, so you can be confident that you&#39;re using the best possible configuration of all standard plugins.</p><p>Here are a few examples of <code>pom.xml</code> from projects that are using jcabi-parent (you can see how compact they are): <a href="https://github.com/yegor256/xembly/blob/master/pom.xml">Xembly</a> <a href="https://github.com/yegor256/rexsl/blob/master/pom.xml">ReXSL</a> <a href="https://github.com/jcabi/jcabi-http/blob/master/pom.xml">jcabi-http</a> <a href="https://github.com/teamed/qulice/blob/master/pom.xml">Qulice</a></p></p>--> <nav class="buttons notranslate desktop-only"> <a href="http://www.facebook.com/sharer/sharer.php?u=https://www.yegor256.com/2015/02/05/jcabi-parent-maven-pom.html" title="Share on Facebook" class="button" rel="nofollow"> <span class="count count-facebook">0</span> <i class="icon icon-facebook notranslate" aria-hidden="true"></i> </a> <a href="https://twitter.com/share?url=https://www.yegor256.com/2015/02/05/jcabi-parent-maven-pom.html&amp;text=Don%27t+Repeat+Yourself+in+Maven+POMs%3B+Use+Jcabi-Parent" title="Share on Twitter" class="button" rel="nofollow"> <span class="count count-twitter">0</span> <i class="icon icon-twitter notranslate" aria-hidden="true"></i> </a> <a href="https://plus.google.com/share?url=https://www.yegor256.com/2015/02/05/jcabi-parent-maven-pom.html" title="Share on Google+" class="button" rel="nofollow"> <span class="count count-googleplus">0</span> <i class="icon icon-googleplus notranslate" aria-hidden="true"></i> </a> <a href="https://www.linkedin.com/cws/share?url=https://www.yegor256.com/2015/02/05/jcabi-parent-maven-pom.html" title="Share on LinkedIn" class="button" rel="nofollow"> <span class="count count-linkedin">0</span> <i class="icon icon-linkedin notranslate" aria-hidden="true"></i> </a> <a href="http://reddit.com/submit?url=https://www.yegor256.com/2015/02/05/jcabi-parent-maven-pom.html%3F2015-05&amp;title=Don%27t+Repeat+Yourself+in+Maven+POMs%3B+Use+Jcabi-Parent" title="Share on Reddit" class="button" rel="nofollow"> <span class="count count-reddit">0</span> <i class="icon icon-reddit notranslate" aria-hidden="true"></i> </a> <a href="http://news.ycombinator.com/submitlink?u=https://www.yegor256.com/2015/02/05/jcabi-parent-maven-pom.html%3F2015-05&amp;t=Don%27t+Repeat+Yourself+in+Maven+POMs%3B+Use+Jcabi-Parent" title="Share on Hacker News" class="button" rel="nofollow"> <span class="count count-hackernews">0</span> <i class="icon icon-hackernews notranslate" aria-hidden="true"></i> </a> </nav> </header> <article class="main" itemprop="articleBody"><div > <figure class='badge'><a href='http://http.jcabi.com'><img src='http://img.jcabi.com/logo-square.svg' style='width:64px;max-width:100%;' alt='badge'/></a></figure><p>Maven is a build automation tool mostly for Java projects. It&#39;s a great tool, but it has one important drawback that has motivated the creation of similar tools, like Gradle and SBT. That weakness is its verbosity of configuration. Maven gets all project build parameters from <code>pom.xml</code>, an XML file that can get very long. I&#39;ve seen POM files of 3,000-plus lines. Taking into account 1) recent DSL buzz and 2) fear of XML, it&#39;s only logical that many people don&#39;t like Maven because of its <code>pom.xml</code> verbosity.</p><p>But even if you&#39;re an XML fan who enjoys its strictness and elegance (like myself), you won&#39;t like the necessity to repeat yourself in <code>pom.xml</code> for every project. If you&#39;re working on multiple projects, code duplication will be enormous. An average Java web app uses a few dozen standard Maven plugins and almost the same number of pretty common dependencies, like JUnit, Apache Commons, Log4J, Mockito, etc. All of them have their versions and configurations, which have to be specified if you want to keep the project stable and avoid Maven warnings. Thus, once a new version of a plugin is released, you have to go through all <code>pom.xml</code> files in the projects you&#39;re working on and update it there. You obviously understand what code duplication means. It&#39;s a disaster. However, there is a solution.</p><p><a href="http://parent.jcabi.com">jcabi-parent</a> is a very simple Maven dependency with nothing inside it except a large <code>pom.xml</code> with multiple pre-configured dependencies, profiles, and plugins. All you need to do in order to reuse them all in your project is define <code>com.jcabi:parent</code> as your parent POM:</p><figure class="highlight"><pre><code class="language-xml" data-lang="xml"><span></span><span class="nt">&lt;project</span> <span class="na">xmlns=</span><span class="s">&quot;http://maven.apache.org/POM/4.0.0&quot;</span>
  <span class="na">xmlns:xsi=</span><span class="s">&quot;http://www.w3.org/2001/XMLSchema-instance&quot;</span>
  <span class="na">xsi:schemaLocation=</span><span class="s">&quot;http://maven.apache.org/POM/4.0.0</span>
<span class="s">    http://maven.apache.org/xsd/maven-4.0.0.xsd&quot;</span><span class="nt">&gt;</span>
  <span class="nt">&lt;modelVersion&gt;</span>4.0.0<span class="nt">&lt;/modelVersion&gt;</span>
  <span class="nt">&lt;parent&gt;</span>
    <span class="nt">&lt;groupId&gt;</span>com.jcabi<span class="nt">&lt;/groupId&gt;</span>
    <span class="nt">&lt;artifactId&gt;</span>parent<span class="nt">&lt;/artifactId&gt;</span>
    <span class="c">&lt;!-- check the latest version at http://parent.jcabi.com --&gt;</span>
    <span class="nt">&lt;version&gt;</span>0.32.1<span class="nt">&lt;/version&gt;</span>
  <span class="nt">&lt;/parent&gt;</span>
  [...]
<span class="nt">&lt;/project&gt;</span></code></pre></figure><p>That&#39;s all you need. Now you can remove most of your custom configurations from <code>pom.xml</code> and rely on defaults provided by jcabi-parent. Its <a href="https://github.com/jcabi/jcabi-parent/blob/master/pom.xml"><code>pom.xml</code></a> is rather large and properly configured. Multiple projects depend on it, so you can be confident that you&#39;re using the best possible configuration of all standard plugins.</p><p>Here are a few examples of <code>pom.xml</code> from projects that are using jcabi-parent (you can see how compact they are): <a href="https://github.com/yegor256/xembly/blob/master/pom.xml">Xembly</a> <a href="https://github.com/yegor256/rexsl/blob/master/pom.xml">ReXSL</a> <a href="https://github.com/jcabi/jcabi-http/blob/master/pom.xml">jcabi-http</a> <a href="https://github.com/teamed/qulice/blob/master/pom.xml">Qulice</a></p></div></article></div><div class="wrapper"> <related-posts /></div><div class="disqus" role="complementary"><p class="disqus_hint"> Please, use <a href="https://help.disqus.com/commenting/what-html-tags-are-allowed-within-comments">syntax highlighting</a> in your comments, to make them more readable.</p><div id="disqus_thread" class="disqus-thread"> <a>&nbsp;</a></div><script> var disqus_config = function () { this.page.url = document.location.href.split('?')[0].split('#')[0].replace('https://', 'http://'); this.page.identifier = this.page.url; }; (function() { var d = document, s = d.createElement('script'); s.src = '//yegor256.disqus.com/embed.js'; s.setAttribute('data-timestamp', +new Date()); (d.head || d.body).appendChild(s); })(); </script> <noscript><div><p class="red"> JavaScript is disabled in your browser, that's why you can't see comments under this post.</p></div></noscript></div><div class="wrapper"> <footer class="footer"><p> &copy; <span itemscope="" itemprop="copyrightHolder" itemtype="http://schema.org/Person"> <span itemprop="name">Yegor Bugayenko</span> </span> 2014&ndash;<span itemprop="copyrightYear">2018</span></p></footer></div></section><div class="wrapper unprintable" style="text-align:center;margin-top:2em;"> <a href="http://www.sixnines.io/h/3ba1652f"> <img src="//www.sixnines.io/b/3ba1652f?style=flat" alt="sixnines availability badge"/> </a></div><script src="//code.jquery.com/jquery-1.9.0.min.js"></script> <script src="/js/all.js?4e047f6f42b"></script> <script>var disqus_shortname = 'yegor256';</script> <script id="dsq-count-scr" src="//yegor256.disqus.com/count.js" async="async"></script> <script> (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){ (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o), m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m) })(window,document,'script','//www.google-analytics.com/analytics.js','ga'); ga('create', 'UA-1963507-32', 'auto'); ga('send', 'pageview'); </script> <script> Cd=document;Cr="&"+Math.random();Cp="&s=1"; Cd.cookie="b=b";if(Cd.cookie)Cp+="&c=1"; Cp+="&t="+(new Date()).getTimezoneOffset(); if(self!=top)Cp+="&f=1"; </script> <script> if(navigator.javaEnabled())Cp+="&j=1"; </script> <script> if(typeof(screen)!='undefined')Cp+="&w="+screen.width+"&h="+ screen.height+"&d="+(screen.colorDepth?screen.colorDepth:screen.pixelDepth); </script> <script> Cd.write("<img src='//c.hit.ua/hit?i=95870&g=0&x=2"+Cp+Cr+ "&r="+escape(Cd.referrer)+"&u="+escape(window.location.href)+ "' border='0' wi"+"dth='1' he"+"ight='1'/>"); </script> <script type="application/ld+json"> { "@context": "http://schema.org", "@type": "Person", "name": "Yegor Bugayenko", "url": "http://www.yegor256.com", "sameAs": [ "https://www.facebook.com/yegor256", "https://instagram.com/yegor256", "https://www.linkedin.com/in/yegor256", "https://twitter.com/yegor256", "https://github.com/yegor256", "https://www.pinterest.com/yegor256/" ] } </script> </body> </html> <!DOCTYPE html> <html xmlns="http://www.w3.org/1999/xhtml" lang="en-US" xml:lang="en-US" itemscope="" itemtype="http://schema.org/WebSite"> <head> <meta charset="utf-8"/> <meta name="description" content="XSL transformations can be accomplished in Java through a single method call with the help of jcabi-xml. " /> <meta name="keywords" content="java xslt code example, java xslt example, transform xml java, xml transformation java, xslt java" /> <meta name="viewport" content="width=device-width,minimum-scale=1,initial-scale=1"/> <meta name="google-site-verification" content="JEj_gQr2CPe2QKGw8XdMz0R7VboQIUbX3FlM-lwTq-8" /> <meta name="author" content="Yegor Bugayenko"> <meta name="article:published_time" content="2015-02-02 00:00:00 +0000"> <meta name="og:site_name" content="Yegor Bugayenko"/> <meta name="og:type" content="article" /> <meta name="og:locale" content="en_US" /> <meta name="twitter:account_id" content="4503599630178231" /> <meta name="twitter:creator" content="@yegor256"/> <meta name="twitter:site" content="@yegor256"/> <meta name="twitter:title" property="og:title" content="XSL Transformation in Java: An Easy Way"/> <meta name="twitter:description" property="og:description" content="XSL transformations can be accomplished in Java through a single method call with the help of jcabi-xml. "/> <meta name="twitter:url" property="og:url" content="https://www.yegor256.com/2015/02/02/xsl-transformations-in-java.html"/> <meta name="telegram:channel" content="AAAAAEJFMRzsRTRxM3ec6A"/> <link rel="search" type="application/opensearchdescription+xml" href="/opensearch.xml" title="yegor256" /> <link rel="shortcut icon" href="/favicon.ico?4e047f6f42b"/> <link rel="apple-touch-icon" href="/favicon.ico?4e047f6f42b"/> <link rel="alternate" type="application/rss+xml" title="RSS for yegor256.com" href="https://www.yegor256.com/rss.xml"/> <link rel="stylesheet" href="/css/layout.css?4e047f6f42b"/> <link rel="stylesheet" href="/css/icons.css?4e047f6f42b"/> <link rel="canonical" href="https://www.yegor256.com/2015/02/02/xsl-transformations-in-java.html" /> <link rel="amphtml" href="https://www.yegor256.com/2015/02/02/xsl-transformations-in-java.amp.html" /> <title>XSL Transformation in Java: An Easy Way </title> </head> <body><div class="wrapper"> <aside class="header-toggle unprintable" id="header-toggle" title="Show the menu" onclick="$('#header').show();$('#header-toggle').hide();">&#9776;</aside> <header class="header" id="header"><div class="face"> <a href="/about-me.html#form" class="sub" title="Click to subscribe to my monthly newsletter"><span>Subscribe</span></a> <a href="/about-me.html" style="position:relative;"> <img src="/images/face-256x256.jpg" class="photo" alt="Yegor Bugayenko"/> </a></div><nav><ul class="menu social notranslate"> <li><a href="https://twitter.com/intent/follow?screen_name=yegor256" rel="nofollow" title="Follow me on Twitter"><i class="icon icon-twitter notranslate" aria-hidden="true"></i></a></li> <li><a href="/rss.xml" rel="nofollow" title="Subscribe to my RSS feed"><i class="icon icon-rss notranslate" aria-hidden="true"></i></a></li> <li><a itemprop="sameAs" href="https://github.com/yegor256" rel="nofollow" title="My GitHub profile"><i class="icon icon-github notranslate" aria-hidden="true"></i></a></li> <li><a itemprop="sameAs" href="http://stackoverflow.com/users/187141/yegor256" rel="nofollow" title="My StackOverflow profile"><i class="icon icon-stackoverflow notranslate" aria-hidden="true"></i></a></li> <li><a itemprop="sameAs" href="https://www.facebook.com/yegor256" rel="nofollow" title="Follow me on Facebook"><i class="icon icon-facebook notranslate" aria-hidden="true"></i></a></li> <li><a itemprop="sameAs" href="https://instagram.com/yegor256" rel="nofollow" title="Follow me on Instagram"><i class="icon icon-instagram notranslate" aria-hidden="true"></i></a></li> <li><a itemprop="sameAs" href="https://www.linkedin.com/in/yegor256" rel="nofollow" title="My LinkedIn profile"><i class="icon icon-linkedin notranslate" aria-hidden="true"></i></a></li> <li><a itemprop="sameAs" href="https://www.youtube.com/c/yegor256?sub_confirmation=1" rel="nofollow" title="My Youtube video channel"><i class="icon icon-youtube notranslate" aria-hidden="true"></i></a></li> <li><a itemprop="sameAs" href="https://www.pinterest.com/yegor256/" rel="nofollow" title="My Pinterest boards"><i class="icon icon-pinterest notranslate" aria-hidden="true"></i></a></li> <li><a itemprop="sameAs" href="https://angel.co/yegor256" rel="nofollow" title="My AngelList profile"><i class="icon icon-angellist notranslate" aria-hidden="true"></i></a></li> <li><a href="https://soundcloud.com/yegor256" rel="nofollow" title="My podcast"><i class="icon icon-podcast notranslate" aria-hidden="true"></i></a></li> <li><a href="https://itunes.apple.com/us/podcast/yegor256-podcast/id1150826721" rel="nofollow" title="My iTunes podcast"><i class="icon icon-itunes notranslate" aria-hidden="true"></i></a></li> <li><a href="https://t.me/joinchat/AAAAAEJFMRzsRTRxM3ec6A" rel="nofollow" title="My Telegram public channel"><i class="icon icon-telegram notranslate" aria-hidden="true"></i></a></li> <li><a href="mailto:blog@yegor256.com" rel="nofollow" title="Email me any time"><i class="icon icon-mail notranslate" aria-hidden="true"></i></a></li></ul><ul class="menu"> <li><a href="/" title="Home page">Home</a></li> <li ><a href="/best.html" title="Best articles to read">12&#160;Best</a></li> <li ><a href="/contents.html" title="The contents of the entire blog">All&#160;288</a></li> <li ><a href="/webinars.html" title="My webinars">Webinars</a></li> <li ><a href="/talks.html" title="Future and past conference talks">Talks</a></li> <li ><a href="/books.html" title="The books I wrote">Books</a></li> <li ><a href="/papers.html" title="My academic papers and patents">Papers</a></li> <li ><a href="/pets.html" title="My loved pet projects">Pets</a></li> <li ><a href="/award.html" title="Software quality award">Award</a></li> <li ><a href="/testimonials.html" title="What some people say about me">Testimonials</a></li> <li ><a href="/shift-m.html" title="Audio podcast about project management">Shift-M</a></li> <li ><a href="/paintings.html" title="My paintings for sale">Paintings</a></li> <li><a href="http://ru.yegor256.com/" title="Немного на русском языке">По-русски</a></li></ul></nav><div class="search"> <form method="get" action="https://www.google.com/search" itemprop="potentialAction" itemscope="" itemtype="http://schema.org/SearchAction"> <meta itemprop="target" content="https://www.google.com/search?q={q}"/> <input name="sitesearch" value="yegor256.com" type="hidden"/> <input itemprop="query-input" type="text" id="search-query" class="field field-text" required="required" onfocus="$('.google').css('visibility', 'visible');" name="q" placeholder="Search..." autocomplete="off"/> <input type="image" src="/images/google-search-icon.svg" class="google" title="Search via Google" alt="Search via Google"/> </form></div><div class="hot"><ul> <li> <a href="/code-ahead.html">Code Ahead</a> was published on Amazon just a few days ago! It is my new book, a novel about programmers. It explains in details the majority of ideas that stand behind <a href="https://www.zerocracy.com">Zerocracy</a> and <a href="https://www.xdsd.org">XDSD</a>. </li> <li> At <a href="/webinars.html">Webinar #37</a> we will discuss naming problem in OOP, for objects, methods and attributes; join us on <b>September 12</b>, at 11am PST. </li></ul></div></header></div><section itemscope="" itemtype="http://schema.org/BlogPosting"><div class="wrapper"> <header><p class="printable"> <img src="https://api.qrserver.com/v1/create-qr-code/?data=https://www.yegor256.com/2015/02/02/xsl-transformations-in-java.html&amp;format=svg" style="width:125px;height:125px;" alt="QR code"/></p><p class="printable"> <code itemprop="url">https://www.yegor256.com/2015/02/02/xsl-transformations-in-java.html</code></p><h1 itemprop="name headline mainEntityOfPage">XSL Transformation in Java: An Easy Way</h1><ul class="subline"> <li> <time itemprop="datePublished" datetime="2015-02-02T00:00:00+00:00"> 2 February 2015 </time> </li> <li class="printable" itemscope="" itemprop="author" itemtype="http://schema.org/Person"> <span itemprop="name">Yegor Bugayenko</span> </li> <li class="unprintable"> <i class="icon icon-comments"></i> <a href="http://www.yegor256.com/2015/02/02/xsl-transformations-in-java.html#disqus_thread" itemprop="discussionUrl">comments</a> </li></ul><p>First, take a look at a practical example---<a href="http://www.rultor.com">rultor.com</a>---a hosted DevOps assistant that <a href="/2014/07/24/rultor-automated-merging.html">automates</a> release, merge, and deploy operations. Rultor keeps each conversation session with an end user (a.k.a. &quot;talk&quot;) in a DynamoDB record. There are multiple situations to handle in each talk; that&#39;s why using multiple columns of a record is not really feasible. Instead, we&#39;re keeping only a few parameters of each talk in record columns (like ID and name) and putting all the rest in a single XML column.</p><p>This is approximately how our DynamoDB table looks:</p><figure class="highlight"><pre><code class="language-text" data-lang="text"><span></span>+----+---------------+--------------------------------------+
| id | name          | xml                                  |
+----+---------------+--------------------------------------+
| 12 | jcabi-xml#54  | &lt;?xml version=&#39;1.0&#39;?&gt;                |
|    |               | &lt;talk public=&quot;true&quot;&gt;                 |
|    |               |   &lt;request id=&quot;e5f4b3&quot;&gt;...&lt;/request&gt; |
|    |               | &lt;/talk&gt;                              |
+----+---------------+--------------------------------------+
| 13 | jcabi-email#2 | &lt;?xml version=&#39;1.0&#39;?&gt;                |
|    |               | &lt;talk public=&quot;true&quot;&gt;                 |
|    |               |   &lt;daemon id=&quot;f787fe&quot;&gt;...&lt;/daemon&gt;   |
|    |               | &lt;/talk&gt;                              |
+----+---------------+--------------------------------------+</code></pre></figure><p>Once a user posts <code>@rultor status</code> into a GitHub ticket, Rultor has to answer with a full status report about the current talk. In order to create such a text answer (a regular user would not appreciate an XML response), we have to fetch that <code>xml</code> column from the necessary DynamoDB record and convert it to plain English text.</p><p>Here is how we&#39;re doing that with the help of <a href="/2014/04/24/java-xml-parsing-and-traversing.html">jcabi-xml</a> and its class, <a href="http://xml.jcabi.com/apidocs-0.15/com/jcabi/xml/XSLDocument.html"><code>XSLDocument</code></a>.</p><figure class="highlight"><pre><code class="language-java" data-lang="java"><span></span><span class="kd">final</span> <span class="n">String</span> <span class="n">xml</span> <span class="o">=</span> <span class="c1">// comes from DynamoDB</span>
<span class="kd">final</span> <span class="n">XSL</span> <span class="n">xsl</span> <span class="o">=</span> <span class="k">new</span> <span class="n">XSLDocument</span><span class="o">(</span>
  <span class="k">this</span><span class="o">.</span><span class="na">getClass</span><span class="o">().</span><span class="na">getResourceAsStream</span><span class="o">(</span><span class="s">&quot;status.xsl&quot;</span><span class="o">)</span>
<span class="o">);</span>
<span class="kd">final</span> <span class="n">String</span> <span class="n">text</span> <span class="o">=</span> <span class="n">xsl</span><span class="o">.</span><span class="na">applyTo</span><span class="o">(</span><span class="n">xml</span><span class="o">);</span></code></pre></figure><p>That&#39;s it. Now let&#39;s see what&#39;s there in that <code>status.xsl</code> file (this is just a skeleton of it; the full version is <a href="https://github.com/yegor256/rultor/blob/1.48/src/main/resources/com/rultor/agents/github/qtn/status.xsl">here</a>):</p><figure class="highlight"><pre><code class="language-xml" data-lang="xml"><span></span><span class="nt">&lt;xsl:stylesheet</span> <span class="na">xmlns:xsl=</span><span class="s">&quot;http://www.w3.org/1999/XSL/Transform&quot;</span>
  <span class="na">version=</span><span class="s">&quot;2.0&quot;</span><span class="nt">&gt;</span>
  <span class="nt">&lt;xsl:output</span> <span class="na">method=</span><span class="s">&quot;text&quot;</span><span class="nt">/&gt;</span>
  <span class="nt">&lt;xsl:template</span> <span class="na">match=</span><span class="s">&quot;/talk&quot;</span><span class="nt">&gt;</span>
    <span class="nt">&lt;xsl:text&gt;</span>Hi, here is your status report:<span class="nt">&lt;/xsl:text&gt;</span>
    ...
  <span class="nt">&lt;/xsl:template&gt;</span>
  <span class="nt">&lt;xsl:template</span> <span class="na">match=</span><span class="s">&quot;node()|@*&quot;</span><span class="nt">&gt;</span>
    <span class="nt">&lt;xsl:copy&gt;</span>
      <span class="nt">&lt;xsl:apply-templates</span> <span class="na">select=</span><span class="s">&quot;node()|@*&quot;</span><span class="nt">/&gt;</span>
    <span class="nt">&lt;/xsl:copy&gt;</span>
  <span class="nt">&lt;/xsl:template&gt;</span>
<span class="nt">&lt;/xsl:stylesheet&gt;</span></code></pre></figure><p>It is good practice to create XSL documents only once per application run. We have a static utility method <a href="http://xml.jcabi.com/apidocs-0.15/com/jcabi/xml/XSLDocument.html#make%28java.io.InputStream%29"><code>XSLDocument.make()</code></a> for this:</p><figure class="highlight"><pre><code class="language-java" data-lang="java"><span></span><span class="kd">final</span> <span class="kd">class</span> <span class="nc">Foo</span> <span class="o">{</span>
  <span class="kd">private</span> <span class="kd">static</span> <span class="kd">final</span> <span class="n">XSL</span> <span class="n">STYLESHEET</span> <span class="o">=</span> <span class="n">XSLDocument</span><span class="o">.</span><span class="na">make</span><span class="o">(</span>
    <span class="n">Foo</span><span class="o">.</span><span class="na">class</span><span class="o">.</span><span class="na">getResourceAsStream</span><span class="o">(</span><span class="s">&quot;stylesheet.xsl&quot;</span><span class="o">)</span>
  <span class="o">);</span>
  <span class="kd">public</span> <span class="n">XML</span> <span class="nf">style</span><span class="o">(</span><span class="kd">final</span> <span class="n">XML</span> <span class="n">xml</span><span class="o">)</span> <span class="o">{</span>
    <span class="k">return</span> <span class="n">Foo</span><span class="o">.</span><span class="na">STYLESHEET</span><span class="o">.</span><span class="na">transform</span><span class="o">(</span><span class="n">xml</span><span class="o">);</span>
  <span class="o">}</span>
<span class="o">}</span></code></pre></figure><p>Pay attention to the fact we&#39;re using XSLT 2.0. Built-in Java implementation of XSLT doesn&#39;t support version 2.0, and in order to make it work, we&#39;re using these two Maven Saxon dependencies:</p><figure class="highlight"><pre><code class="language-xml" data-lang="xml"><span></span><span class="nt">&lt;dependency&gt;</span>
  <span class="nt">&lt;groupId&gt;</span>net.sourceforge.saxon<span class="nt">&lt;/groupId&gt;</span>
  <span class="nt">&lt;artifactId&gt;</span>saxon<span class="nt">&lt;/artifactId&gt;</span>
  <span class="nt">&lt;version&gt;</span>9.1.0.8<span class="nt">&lt;/version&gt;</span>
  <span class="nt">&lt;scope&gt;</span>runtime<span class="nt">&lt;/scope&gt;</span>
<span class="nt">&lt;/dependency&gt;</span>
<span class="nt">&lt;dependency&gt;</span>
  <span class="nt">&lt;groupId&gt;</span>net.sourceforge.saxon<span class="nt">&lt;/groupId&gt;</span>
  <span class="nt">&lt;artifactId&gt;</span>saxon<span class="nt">&lt;/artifactId&gt;</span>
  <span class="nt">&lt;version&gt;</span>9.1.0.8<span class="nt">&lt;/version&gt;</span>
  <span class="nt">&lt;classifier&gt;</span>xpath<span class="nt">&lt;/classifier&gt;</span>
  <span class="nt">&lt;scope&gt;</span>runtime<span class="nt">&lt;/scope&gt;</span>
<span class="nt">&lt;/dependency&gt;</span></code></pre></figure><p>All you need to do to start using <code>jcabi-xml</code> for XSL transformations is add this dependency to your <code>pom.xml</code>:</p><figure class="highlight"><pre><code class="language-xml" data-lang="xml"><span></span><span class="nt">&lt;dependency&gt;</span>
  <span class="nt">&lt;groupId&gt;</span>com.jcabi<span class="nt">&lt;/groupId&gt;</span>
  <span class="nt">&lt;artifactId&gt;</span>jcabi-xml<span class="nt">&lt;/artifactId&gt;</span>
<span class="nt">&lt;/dependency&gt;</span></code></pre></figure><p>If you have any problems or suggestions, don&#39;t hesitate to submit an issue to the GitHub <a href="https://github.com/jcabi/jcabi-xml/issues">issue tracker</a>.</p></p>--> <nav class="buttons notranslate desktop-only"> <a href="http://www.facebook.com/sharer/sharer.php?u=https://www.yegor256.com/2015/02/02/xsl-transformations-in-java.html" title="Share on Facebook" class="button" rel="nofollow"> <span class="count count-facebook">0</span> <i class="icon icon-facebook notranslate" aria-hidden="true"></i> </a> <a href="https://twitter.com/share?url=https://www.yegor256.com/2015/02/02/xsl-transformations-in-java.html&amp;text=XSL+Transformation+in+Java%3A+An+Easy+Way" title="Share on Twitter" class="button" rel="nofollow"> <span class="count count-twitter">0</span> <i class="icon icon-twitter notranslate" aria-hidden="true"></i> </a> <a href="https://plus.google.com/share?url=https://www.yegor256.com/2015/02/02/xsl-transformations-in-java.html" title="Share on Google+" class="button" rel="nofollow"> <span class="count count-googleplus">0</span> <i class="icon icon-googleplus notranslate" aria-hidden="true"></i> </a> <a href="https://www.linkedin.com/cws/share?url=https://www.yegor256.com/2015/02/02/xsl-transformations-in-java.html" title="Share on LinkedIn" class="button" rel="nofollow"> <span class="count count-linkedin">0</span> <i class="icon icon-linkedin notranslate" aria-hidden="true"></i> </a> <a href="http://reddit.com/submit?url=https://www.yegor256.com/2015/02/02/xsl-transformations-in-java.html%3F2015-05&amp;title=XSL+Transformation+in+Java%3A+An+Easy+Way" title="Share on Reddit" class="button" rel="nofollow"> <span class="count count-reddit">0</span> <i class="icon icon-reddit notranslate" aria-hidden="true"></i> </a> <a href="http://news.ycombinator.com/submitlink?u=https://www.yegor256.com/2015/02/02/xsl-transformations-in-java.html%3F2015-05&amp;t=XSL+Transformation+in+Java%3A+An+Easy+Way" title="Share on Hacker News" class="button" rel="nofollow"> <span class="count count-hackernews">0</span> <i class="icon icon-hackernews notranslate" aria-hidden="true"></i> </a> </nav> </header> <article class="main" itemprop="articleBody"><div > <figure class='badge'><a href='http://http.jcabi.com'><img src='http://img.jcabi.com/logo-square.svg' style='width:64px;max-width:100%;' alt='badge'/></a></figure><p><a href="http://www.w3.org/TR/xslt20/">XSL transformation</a> (XSLT) is a powerful mechanism for converting one XML document into another. However, in Java, XML manipulations are rather verbose and complex. Even for a simple XSL transformation, you have to write a few dozen lines of code---and maybe even more than that if proper exception handling and logging is needed. <a href="/2014/04/24/java-xml-parsing-and-traversing.html">jcabi-xml</a> is a small open source library that makes life much easier by enabling XML parsing and XPath traversing with <a href="/2014/04/24/java-xml-parsing-and-traversing.html">a few simple methods</a>. Let&#39;s see how this library helps in XSL transformations.</p><p>First, take a look at a practical example---<a href="http://www.rultor.com">rultor.com</a>---a hosted DevOps assistant that <a href="/2014/07/24/rultor-automated-merging.html">automates</a> release, merge, and deploy operations. Rultor keeps each conversation session with an end user (a.k.a. &quot;talk&quot;) in a DynamoDB record. There are multiple situations to handle in each talk; that&#39;s why using multiple columns of a record is not really feasible. Instead, we&#39;re keeping only a few parameters of each talk in record columns (like ID and name) and putting all the rest in a single XML column.</p><p>This is approximately how our DynamoDB table looks:</p><figure class="highlight"><pre><code class="language-text" data-lang="text"><span></span>+----+---------------+--------------------------------------+
| id | name          | xml                                  |
+----+---------------+--------------------------------------+
| 12 | jcabi-xml#54  | &lt;?xml version=&#39;1.0&#39;?&gt;                |
|    |               | &lt;talk public=&quot;true&quot;&gt;                 |
|    |               |   &lt;request id=&quot;e5f4b3&quot;&gt;...&lt;/request&gt; |
|    |               | &lt;/talk&gt;                              |
+----+---------------+--------------------------------------+
| 13 | jcabi-email#2 | &lt;?xml version=&#39;1.0&#39;?&gt;                |
|    |               | &lt;talk public=&quot;true&quot;&gt;                 |
|    |               |   &lt;daemon id=&quot;f787fe&quot;&gt;...&lt;/daemon&gt;   |
|    |               | &lt;/talk&gt;                              |
+----+---------------+--------------------------------------+</code></pre></figure><p>Once a user posts <code>@rultor status</code> into a GitHub ticket, Rultor has to answer with a full status report about the current talk. In order to create such a text answer (a regular user would not appreciate an XML response), we have to fetch that <code>xml</code> column from the necessary DynamoDB record and convert it to plain English text.</p><p>Here is how we&#39;re doing that with the help of <a href="/2014/04/24/java-xml-parsing-and-traversing.html">jcabi-xml</a> and its class, <a href="http://xml.jcabi.com/apidocs-0.15/com/jcabi/xml/XSLDocument.html"><code>XSLDocument</code></a>.</p><figure class="highlight"><pre><code class="language-java" data-lang="java"><span></span><span class="kd">final</span> <span class="n">String</span> <span class="n">xml</span> <span class="o">=</span> <span class="c1">// comes from DynamoDB</span>
<span class="kd">final</span> <span class="n">XSL</span> <span class="n">xsl</span> <span class="o">=</span> <span class="k">new</span> <span class="n">XSLDocument</span><span class="o">(</span>
  <span class="k">this</span><span class="o">.</span><span class="na">getClass</span><span class="o">().</span><span class="na">getResourceAsStream</span><span class="o">(</span><span class="s">&quot;status.xsl&quot;</span><span class="o">)</span>
<span class="o">);</span>
<span class="kd">final</span> <span class="n">String</span> <span class="n">text</span> <span class="o">=</span> <span class="n">xsl</span><span class="o">.</span><span class="na">applyTo</span><span class="o">(</span><span class="n">xml</span><span class="o">);</span></code></pre></figure><p>That&#39;s it. Now let&#39;s see what&#39;s there in that <code>status.xsl</code> file (this is just a skeleton of it; the full version is <a href="https://github.com/yegor256/rultor/blob/1.48/src/main/resources/com/rultor/agents/github/qtn/status.xsl">here</a>):</p><figure class="highlight"><pre><code class="language-xml" data-lang="xml"><span></span><span class="nt">&lt;xsl:stylesheet</span> <span class="na">xmlns:xsl=</span><span class="s">&quot;http://www.w3.org/1999/XSL/Transform&quot;</span>
  <span class="na">version=</span><span class="s">&quot;2.0&quot;</span><span class="nt">&gt;</span>
  <span class="nt">&lt;xsl:output</span> <span class="na">method=</span><span class="s">&quot;text&quot;</span><span class="nt">/&gt;</span>
  <span class="nt">&lt;xsl:template</span> <span class="na">match=</span><span class="s">&quot;/talk&quot;</span><span class="nt">&gt;</span>
    <span class="nt">&lt;xsl:text&gt;</span>Hi, here is your status report:<span class="nt">&lt;/xsl:text&gt;</span>
    ...
  <span class="nt">&lt;/xsl:template&gt;</span>
  <span class="nt">&lt;xsl:template</span> <span class="na">match=</span><span class="s">&quot;node()|@*&quot;</span><span class="nt">&gt;</span>
    <span class="nt">&lt;xsl:copy&gt;</span>
      <span class="nt">&lt;xsl:apply-templates</span> <span class="na">select=</span><span class="s">&quot;node()|@*&quot;</span><span class="nt">/&gt;</span>
    <span class="nt">&lt;/xsl:copy&gt;</span>
  <span class="nt">&lt;/xsl:template&gt;</span>
<span class="nt">&lt;/xsl:stylesheet&gt;</span></code></pre></figure><p>It is good practice to create XSL documents only once per application run. We have a static utility method <a href="http://xml.jcabi.com/apidocs-0.15/com/jcabi/xml/XSLDocument.html#make%28java.io.InputStream%29"><code>XSLDocument.make()</code></a> for this:</p><figure class="highlight"><pre><code class="language-java" data-lang="java"><span></span><span class="kd">final</span> <span class="kd">class</span> <span class="nc">Foo</span> <span class="o">{</span>
  <span class="kd">private</span> <span class="kd">static</span> <span class="kd">final</span> <span class="n">XSL</span> <span class="n">STYLESHEET</span> <span class="o">=</span> <span class="n">XSLDocument</span><span class="o">.</span><span class="na">make</span><span class="o">(</span>
    <span class="n">Foo</span><span class="o">.</span><span class="na">class</span><span class="o">.</span><span class="na">getResourceAsStream</span><span class="o">(</span><span class="s">&quot;stylesheet.xsl&quot;</span><span class="o">)</span>
  <span class="o">);</span>
  <span class="kd">public</span> <span class="n">XML</span> <span class="nf">style</span><span class="o">(</span><span class="kd">final</span> <span class="n">XML</span> <span class="n">xml</span><span class="o">)</span> <span class="o">{</span>
    <span class="k">return</span> <span class="n">Foo</span><span class="o">.</span><span class="na">STYLESHEET</span><span class="o">.</span><span class="na">transform</span><span class="o">(</span><span class="n">xml</span><span class="o">);</span>
  <span class="o">}</span>
<span class="o">}</span></code></pre></figure><p>Pay attention to the fact we&#39;re using XSLT 2.0. Built-in Java implementation of XSLT doesn&#39;t support version 2.0, and in order to make it work, we&#39;re using these two Maven Saxon dependencies:</p><figure class="highlight"><pre><code class="language-xml" data-lang="xml"><span></span><span class="nt">&lt;dependency&gt;</span>
  <span class="nt">&lt;groupId&gt;</span>net.sourceforge.saxon<span class="nt">&lt;/groupId&gt;</span>
  <span class="nt">&lt;artifactId&gt;</span>saxon<span class="nt">&lt;/artifactId&gt;</span>
  <span class="nt">&lt;version&gt;</span>9.1.0.8<span class="nt">&lt;/version&gt;</span>
  <span class="nt">&lt;scope&gt;</span>runtime<span class="nt">&lt;/scope&gt;</span>
<span class="nt">&lt;/dependency&gt;</span>
<span class="nt">&lt;dependency&gt;</span>
  <span class="nt">&lt;groupId&gt;</span>net.sourceforge.saxon<span class="nt">&lt;/groupId&gt;</span>
  <span class="nt">&lt;artifactId&gt;</span>saxon<span class="nt">&lt;/artifactId&gt;</span>
  <span class="nt">&lt;version&gt;</span>9.1.0.8<span class="nt">&lt;/version&gt;</span>
  <span class="nt">&lt;classifier&gt;</span>xpath<span class="nt">&lt;/classifier&gt;</span>
  <span class="nt">&lt;scope&gt;</span>runtime<span class="nt">&lt;/scope&gt;</span>
<span class="nt">&lt;/dependency&gt;</span></code></pre></figure><p>All you need to do to start using <code>jcabi-xml</code> for XSL transformations is add this dependency to your <code>pom.xml</code>:</p><figure class="highlight"><pre><code class="language-xml" data-lang="xml"><span></span><span class="nt">&lt;dependency&gt;</span>
  <span class="nt">&lt;groupId&gt;</span>com.jcabi<span class="nt">&lt;/groupId&gt;</span>
  <span class="nt">&lt;artifactId&gt;</span>jcabi-xml<span class="nt">&lt;/artifactId&gt;</span>
<span class="nt">&lt;/dependency&gt;</span></code></pre></figure><p>If you have any problems or suggestions, don&#39;t hesitate to submit an issue to the GitHub <a href="https://github.com/jcabi/jcabi-xml/issues">issue tracker</a>.</p></div></article></div><div class="wrapper"> <related-posts /></div><div class="disqus" role="complementary"><p class="disqus_hint"> Please, use <a href="https://help.disqus.com/commenting/what-html-tags-are-allowed-within-comments">syntax highlighting</a> in your comments, to make them more readable.</p><div id="disqus_thread" class="disqus-thread"> <a>&nbsp;</a></div><script> var disqus_config = function () { this.page.url = document.location.href.split('?')[0].split('#')[0].replace('https://', 'http://'); this.page.identifier = this.page.url; }; (function() { var d = document, s = d.createElement('script'); s.src = '//yegor256.disqus.com/embed.js'; s.setAttribute('data-timestamp', +new Date()); (d.head || d.body).appendChild(s); })(); </script> <noscript><div><p class="red"> JavaScript is disabled in your browser, that's why you can't see comments under this post.</p></div></noscript></div><div class="wrapper"> <footer class="footer"><p> &copy; <span itemscope="" itemprop="copyrightHolder" itemtype="http://schema.org/Person"> <span itemprop="name">Yegor Bugayenko</span> </span> 2014&ndash;<span itemprop="copyrightYear">2018</span></p></footer></div></section><div class="wrapper unprintable" style="text-align:center;margin-top:2em;"> <a href="http://www.sixnines.io/h/3ba1652f"> <img src="//www.sixnines.io/b/3ba1652f?style=flat" alt="sixnines availability badge"/> </a></div><script src="//code.jquery.com/jquery-1.9.0.min.js"></script> <script src="/js/all.js?4e047f6f42b"></script> <script>var disqus_shortname = 'yegor256';</script> <script id="dsq-count-scr" src="//yegor256.disqus.com/count.js" async="async"></script> <script> (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){ (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o), m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m) })(window,document,'script','//www.google-analytics.com/analytics.js','ga'); ga('create', 'UA-1963507-32', 'auto'); ga('send', 'pageview'); </script> <script> Cd=document;Cr="&"+Math.random();Cp="&s=1"; Cd.cookie="b=b";if(Cd.cookie)Cp+="&c=1"; Cp+="&t="+(new Date()).getTimezoneOffset(); if(self!=top)Cp+="&f=1"; </script> <script> if(navigator.javaEnabled())Cp+="&j=1"; </script> <script> if(typeof(screen)!='undefined')Cp+="&w="+screen.width+"&h="+ screen.height+"&d="+(screen.colorDepth?screen.colorDepth:screen.pixelDepth); </script> <script> Cd.write("<img src='//c.hit.ua/hit?i=95870&g=0&x=2"+Cp+Cr+ "&r="+escape(Cd.referrer)+"&u="+escape(window.location.href)+ "' border='0' wi"+"dth='1' he"+"ight='1'/>"); </script> <script type="application/ld+json"> { "@context": "http://schema.org", "@type": "Person", "name": "Yegor Bugayenko", "url": "http://www.yegor256.com", "sameAs": [ "https://www.facebook.com/yegor256", "https://instagram.com/yegor256", "https://www.linkedin.com/in/yegor256", "https://twitter.com/yegor256", "https://github.com/yegor256", "https://www.pinterest.com/yegor256/" ] } </script> </body> </html> <!DOCTYPE html> <html xmlns="http://www.w3.org/1999/xhtml" lang="en-US" xml:lang="en-US" itemscope="" itemtype="http://schema.org/WebSite"> <head> <meta charset="utf-8"/> <meta name="description" content="When it comes to an if-then-else statement that throws an exception or exits by break or continue, there is an obvious optimization that is very often overlooked. " /> <meta name="keywords" content="if then else exception, if throw else exception, if throw exception, if throw exception java, if-throw-else" /> <meta name="viewport" content="width=device-width,minimum-scale=1,initial-scale=1"/> <meta name="google-site-verification" content="JEj_gQr2CPe2QKGw8XdMz0R7VboQIUbX3FlM-lwTq-8" /> <meta name="author" content="Yegor Bugayenko"> <meta name="article:published_time" content="2015-01-21 00:00:00 +0000"> <meta name="og:site_name" content="Yegor Bugayenko"/> <meta name="og:type" content="article" /> <meta name="og:locale" content="en_US" /> <meta name="twitter:account_id" content="4503599630178231" /> <meta name="twitter:creator" content="@yegor256"/> <meta name="twitter:site" content="@yegor256"/> <meta name="twitter:title" property="og:title" content="If. Then. Throw. Else. WTF?"/> <meta name="twitter:description" property="og:description" content="When it comes to an if-then-else statement that throws an exception or exits by break or continue, there is an obvious optimization that is very often overlooked. "/> <meta name="twitter:url" property="og:url" content="https://www.yegor256.com/2015/01/21/if-then-throw-else.html"/> <meta name="telegram:channel" content="AAAAAEJFMRzsRTRxM3ec6A"/> <link rel="search" type="application/opensearchdescription+xml" href="/opensearch.xml" title="yegor256" /> <link rel="shortcut icon" href="/favicon.ico?4e047f6f42b"/> <link rel="apple-touch-icon" href="/favicon.ico?4e047f6f42b"/> <link rel="alternate" type="application/rss+xml" title="RSS for yegor256.com" href="https://www.yegor256.com/rss.xml"/> <link rel="stylesheet" href="/css/layout.css?4e047f6f42b"/> <link rel="stylesheet" href="/css/icons.css?4e047f6f42b"/> <link rel="canonical" href="https://www.yegor256.com/2015/01/21/if-then-throw-else.html" /> <link rel="amphtml" href="https://www.yegor256.com/2015/01/21/if-then-throw-else.amp.html" /> <title>If. Then. Throw. Else. WTF? </title> </head> <body><div class="wrapper"> <aside class="header-toggle unprintable" id="header-toggle" title="Show the menu" onclick="$('#header').show();$('#header-toggle').hide();">&#9776;</aside> <header class="header" id="header"><div class="face"> <a href="/about-me.html#form" class="sub" title="Click to subscribe to my monthly newsletter"><span>Subscribe</span></a> <a href="/about-me.html" style="position:relative;"> <img src="/images/face-256x256.jpg" class="photo" alt="Yegor Bugayenko"/> </a></div><nav><ul class="menu social notranslate"> <li><a href="https://twitter.com/intent/follow?screen_name=yegor256" rel="nofollow" title="Follow me on Twitter"><i class="icon icon-twitter notranslate" aria-hidden="true"></i></a></li> <li><a href="/rss.xml" rel="nofollow" title="Subscribe to my RSS feed"><i class="icon icon-rss notranslate" aria-hidden="true"></i></a></li> <li><a itemprop="sameAs" href="https://github.com/yegor256" rel="nofollow" title="My GitHub profile"><i class="icon icon-github notranslate" aria-hidden="true"></i></a></li> <li><a itemprop="sameAs" href="http://stackoverflow.com/users/187141/yegor256" rel="nofollow" title="My StackOverflow profile"><i class="icon icon-stackoverflow notranslate" aria-hidden="true"></i></a></li> <li><a itemprop="sameAs" href="https://www.facebook.com/yegor256" rel="nofollow" title="Follow me on Facebook"><i class="icon icon-facebook notranslate" aria-hidden="true"></i></a></li> <li><a itemprop="sameAs" href="https://instagram.com/yegor256" rel="nofollow" title="Follow me on Instagram"><i class="icon icon-instagram notranslate" aria-hidden="true"></i></a></li> <li><a itemprop="sameAs" href="https://www.linkedin.com/in/yegor256" rel="nofollow" title="My LinkedIn profile"><i class="icon icon-linkedin notranslate" aria-hidden="true"></i></a></li> <li><a itemprop="sameAs" href="https://www.youtube.com/c/yegor256?sub_confirmation=1" rel="nofollow" title="My Youtube video channel"><i class="icon icon-youtube notranslate" aria-hidden="true"></i></a></li> <li><a itemprop="sameAs" href="https://www.pinterest.com/yegor256/" rel="nofollow" title="My Pinterest boards"><i class="icon icon-pinterest notranslate" aria-hidden="true"></i></a></li> <li><a itemprop="sameAs" href="https://angel.co/yegor256" rel="nofollow" title="My AngelList profile"><i class="icon icon-angellist notranslate" aria-hidden="true"></i></a></li> <li><a href="https://soundcloud.com/yegor256" rel="nofollow" title="My podcast"><i class="icon icon-podcast notranslate" aria-hidden="true"></i></a></li> <li><a href="https://itunes.apple.com/us/podcast/yegor256-podcast/id1150826721" rel="nofollow" title="My iTunes podcast"><i class="icon icon-itunes notranslate" aria-hidden="true"></i></a></li> <li><a href="https://t.me/joinchat/AAAAAEJFMRzsRTRxM3ec6A" rel="nofollow" title="My Telegram public channel"><i class="icon icon-telegram notranslate" aria-hidden="true"></i></a></li> <li><a href="mailto:blog@yegor256.com" rel="nofollow" title="Email me any time"><i class="icon icon-mail notranslate" aria-hidden="true"></i></a></li></ul><ul class="menu"> <li><a href="/" title="Home page">Home</a></li> <li ><a href="/best.html" title="Best articles to read">12&#160;Best</a></li> <li ><a href="/contents.html" title="The contents of the entire blog">All&#160;288</a></li> <li ><a href="/webinars.html" title="My webinars">Webinars</a></li> <li ><a href="/talks.html" title="Future and past conference talks">Talks</a></li> <li ><a href="/books.html" title="The books I wrote">Books</a></li> <li ><a href="/papers.html" title="My academic papers and patents">Papers</a></li> <li ><a href="/pets.html" title="My loved pet projects">Pets</a></li> <li ><a href="/award.html" title="Software quality award">Award</a></li> <li ><a href="/testimonials.html" title="What some people say about me">Testimonials</a></li> <li ><a href="/shift-m.html" title="Audio podcast about project management">Shift-M</a></li> <li ><a href="/paintings.html" title="My paintings for sale">Paintings</a></li> <li><a href="http://ru.yegor256.com/" title="Немного на русском языке">По-русски</a></li></ul></nav><div class="search"> <form method="get" action="https://www.google.com/search" itemprop="potentialAction" itemscope="" itemtype="http://schema.org/SearchAction"> <meta itemprop="target" content="https://www.google.com/search?q={q}"/> <input name="sitesearch" value="yegor256.com" type="hidden"/> <input itemprop="query-input" type="text" id="search-query" class="field field-text" required="required" onfocus="$('.google').css('visibility', 'visible');" name="q" placeholder="Search..." autocomplete="off"/> <input type="image" src="/images/google-search-icon.svg" class="google" title="Search via Google" alt="Search via Google"/> </form></div><div class="hot"><ul> <li> <a href="/code-ahead.html">Code Ahead</a> was published on Amazon just a few days ago! It is my new book, a novel about programmers. It explains in details the majority of ideas that stand behind <a href="https://www.zerocracy.com">Zerocracy</a> and <a href="https://www.xdsd.org">XDSD</a>. </li> <li> At <a href="/webinars.html">Webinar #37</a> we will discuss naming problem in OOP, for objects, methods and attributes; join us on <b>September 12</b>, at 11am PST. </li></ul></div></header></div><section itemscope="" itemtype="http://schema.org/BlogPosting"><div class="wrapper"> <header><p class="printable"> <img src="https://api.qrserver.com/v1/create-qr-code/?data=https://www.yegor256.com/2015/01/21/if-then-throw-else.html&amp;format=svg" style="width:125px;height:125px;" alt="QR code"/></p><p class="printable"> <code itemprop="url">https://www.yegor256.com/2015/01/21/if-then-throw-else.html</code></p><h1 itemprop="name headline mainEntityOfPage">If. Then. Throw. Else. WTF?</h1><ul class="subline"> <li> <time itemprop="datePublished" datetime="2015-01-21T00:00:00+00:00"> 21 January 2015 </time> </li> <li class="printable" itemscope="" itemprop="author" itemtype="http://schema.org/Person"> <span itemprop="name">Yegor Bugayenko</span> </li> <li class="unprintable"> <i class="icon icon-comments"></i> <a href="http://www.yegor256.com/2015/01/21/if-then-throw-else.html#disqus_thread" itemprop="discussionUrl">comments</a> </li></ul><p>If-then-else is a <a href="/2016/08/10/if-then-else-code-smell.html">forking</a> mechanism of procedural programming. The CPU either goes to the left and <strong>then</strong> does something or goes to the right and does something <strong>else</strong>. Imagine yourself driving a car and seeing this sign:</p><figure class='unprintable'><img src='https://www.yegor256.com/images/2015/01/if-then-throw-1.png' itemprop='image' style='width:500px;max-width:100%;' alt='The figure'/></figure><p>It looks logical, doesn&#39;t it? You can go in the left lane if you&#39;re not driving a truck. Otherwise you should go in the right lane. Both lanes meet up in a while. No matter which one you choose, you will end up on the same road. This is what this code block does:</p><figure class="highlight"><pre><code class="language-java" data-lang="java"><span></span><span class="k">if</span> <span class="o">(</span><span class="n">x</span> <span class="o">&lt;</span> <span class="mi">0</span><span class="o">)</span> <span class="o">{</span>
  <span class="n">System</span><span class="o">.</span><span class="na">out</span><span class="o">.</span><span class="na">println</span><span class="o">(</span><span class="s">&quot;X is negative&quot;</span><span class="o">);</span>
<span class="o">}</span> <span class="k">else</span> <span class="o">{</span>
  <span class="n">System</span><span class="o">.</span><span class="na">out</span><span class="o">.</span><span class="na">println</span><span class="o">(</span><span class="s">&quot;X is positive or zero&quot;</span><span class="o">);</span>
<span class="o">}</span></code></pre></figure><p>Now, try to imagine this sign:</p><figure class='unprintable'><img src='https://www.yegor256.com/images/2015/01/if-then-throw-2.png' itemprop='image' style='width:500px;max-width:100%;' alt='The figure'/></figure><p>It looks very strange to me, and you will never see this sign anywhere simply because a dead end means an <em>end</em>, a full stop, a finish. What is the point of drawing a lane after the dead end sign? There is no point.</p><p>This is how a proper sign would look:</p><figure class='unprintable'><img src='https://www.yegor256.com/images/2015/01/if-then-throw-3.png' itemprop='image' style='width:500px;max-width:100%;' alt='The figure'/></figure><p>This is how a proper code block would look:</p><figure class="highlight"><pre><code class="language-java" data-lang="java"><span></span><span class="k">if</span> <span class="o">(</span><span class="n">x</span> <span class="o">&lt;</span> <span class="mi">0</span><span class="o">)</span> <span class="o">{</span>
  <span class="k">throw</span> <span class="k">new</span> <span class="n">Exception</span><span class="o">(</span><span class="s">&quot;X can&#39;t be negative&quot;</span><span class="o">);</span>
<span class="o">}</span>
<span class="n">System</span><span class="o">.</span><span class="na">out</span><span class="o">.</span><span class="na">println</span><span class="o">(</span><span class="s">&quot;X is positive or zero&quot;</span><span class="o">);</span></code></pre></figure><p>The same is true for loops. This is wrong:</p><figure class="highlight"><pre><code class="language-java" data-lang="java"><span></span><span class="k">for</span> <span class="o">(</span><span class="kt">int</span> <span class="n">x</span> <span class="o">:</span> <span class="n">numbers</span><span class="o">)</span> <span class="o">{</span>
  <span class="k">if</span> <span class="o">(</span><span class="n">x</span> <span class="o">&lt;</span> <span class="mi">0</span><span class="o">)</span> <span class="o">{</span>
    <span class="k">continue</span><span class="o">;</span>
  <span class="o">}</span> <span class="k">else</span> <span class="o">{</span>
    <span class="n">System</span><span class="o">.</span><span class="na">out</span><span class="o">.</span><span class="na">println</span><span class="o">(</span><span class="s">&quot;found positive number&quot;</span><span class="o">);</span>
  <span class="o">}</span>
<span class="o">}</span></code></pre></figure><p>While this is right:</p><figure class="highlight"><pre><code class="language-java" data-lang="java"><span></span><span class="k">for</span> <span class="o">(</span><span class="kt">int</span> <span class="n">x</span> <span class="o">:</span> <span class="n">numbers</span><span class="o">)</span> <span class="o">{</span>
  <span class="k">if</span> <span class="o">(</span><span class="n">x</span> <span class="o">&lt;</span> <span class="mi">0</span><span class="o">)</span> <span class="o">{</span>
    <span class="k">continue</span><span class="o">;</span>
  <span class="o">}</span>
  <span class="n">System</span><span class="o">.</span><span class="na">out</span><span class="o">.</span><span class="na">println</span><span class="o">(</span><span class="s">&quot;found positive number&quot;</span><span class="o">);</span>
<span class="o">}</span></code></pre></figure><p>There is no road after the dead end! If you draw it, your code looks like this very funny snippet I found a few years ago reviewing sources written by some very well-paid developer in one very serious company:</p><figure class="highlight"><pre><code class="language-java" data-lang="java"><span></span><span class="k">if</span> <span class="o">(</span><span class="n">x</span> <span class="o">&lt;</span> <span class="mi">0</span><span class="o">)</span> <span class="o">{</span>
  <span class="k">throw</span> <span class="k">new</span> <span class="n">Exception</span><span class="o">(</span><span class="s">&quot;X is negative&quot;</span><span class="o">);</span>
  <span class="n">System</span><span class="o">.</span><span class="na">exit</span><span class="o">(</span><span class="mi">1</span><span class="o">);</span>
<span class="o">}</span></code></pre></figure><p>Don&#39;t do this.</p></p>--> <nav class="buttons notranslate desktop-only"> <a href="http://www.facebook.com/sharer/sharer.php?u=https://www.yegor256.com/2015/01/21/if-then-throw-else.html" title="Share on Facebook" class="button" rel="nofollow"> <span class="count count-facebook">0</span> <i class="icon icon-facebook notranslate" aria-hidden="true"></i> </a> <a href="https://twitter.com/share?url=https://www.yegor256.com/2015/01/21/if-then-throw-else.html&amp;text=If.+Then.+Throw.+Else.+WTF%3F" title="Share on Twitter" class="button" rel="nofollow"> <span class="count count-twitter">0</span> <i class="icon icon-twitter notranslate" aria-hidden="true"></i> </a> <a href="https://plus.google.com/share?url=https://www.yegor256.com/2015/01/21/if-then-throw-else.html" title="Share on Google+" class="button" rel="nofollow"> <span class="count count-googleplus">0</span> <i class="icon icon-googleplus notranslate" aria-hidden="true"></i> </a> <a href="https://www.linkedin.com/cws/share?url=https://www.yegor256.com/2015/01/21/if-then-throw-else.html" title="Share on LinkedIn" class="button" rel="nofollow"> <span class="count count-linkedin">0</span> <i class="icon icon-linkedin notranslate" aria-hidden="true"></i> </a> <a href="http://reddit.com/submit?url=https://www.yegor256.com/2015/01/21/if-then-throw-else.html%3F2015-03&amp;title=If.+Then.+Throw.+Else.+WTF%3F" title="Share on Reddit" class="button" rel="nofollow"> <span class="count count-reddit">0</span> <i class="icon icon-reddit notranslate" aria-hidden="true"></i> </a> <a href="http://news.ycombinator.com/submitlink?u=https://www.yegor256.com/2015/01/21/if-then-throw-else.html%3F2015-03&amp;t=If.+Then.+Throw.+Else.+WTF%3F" title="Share on Hacker News" class="button" rel="nofollow"> <span class="count count-hackernews">0</span> <i class="icon icon-hackernews notranslate" aria-hidden="true"></i> </a> </nav> </header> <article class="main" itemprop="articleBody"><div ><p>This is the code I could never understand:</p><figure class="highlight"><pre><code class="language-java" data-lang="java"><span></span><span class="k">if</span> <span class="o">(</span><span class="n">x</span> <span class="o">&lt;</span> <span class="mi">0</span><span class="o">)</span> <span class="o">{</span>
  <span class="k">throw</span> <span class="k">new</span> <span class="n">Exception</span><span class="o">(</span><span class="s">&quot;X can&#39;t be negative&quot;</span><span class="o">);</span>
<span class="o">}</span> <span class="k">else</span> <span class="o">{</span>
  <span class="n">System</span><span class="o">.</span><span class="na">out</span><span class="o">.</span><span class="na">println</span><span class="o">(</span><span class="s">&quot;X is positive or zero&quot;</span><span class="o">);</span>
<span class="o">}</span></code></pre></figure><p>I have been trying to find a proper metaphor to explain its incorrectness. Today I finally found it.</p><p>If-then-else is a <a href="/2016/08/10/if-then-else-code-smell.html">forking</a> mechanism of procedural programming. The CPU either goes to the left and <strong>then</strong> does something or goes to the right and does something <strong>else</strong>. Imagine yourself driving a car and seeing this sign:</p><figure class='unprintable'><img src='https://www.yegor256.com/images/2015/01/if-then-throw-1.png' itemprop='image' style='width:500px;max-width:100%;' alt='The figure'/></figure><p>It looks logical, doesn&#39;t it? You can go in the left lane if you&#39;re not driving a truck. Otherwise you should go in the right lane. Both lanes meet up in a while. No matter which one you choose, you will end up on the same road. This is what this code block does:</p><figure class="highlight"><pre><code class="language-java" data-lang="java"><span></span><span class="k">if</span> <span class="o">(</span><span class="n">x</span> <span class="o">&lt;</span> <span class="mi">0</span><span class="o">)</span> <span class="o">{</span>
  <span class="n">System</span><span class="o">.</span><span class="na">out</span><span class="o">.</span><span class="na">println</span><span class="o">(</span><span class="s">&quot;X is negative&quot;</span><span class="o">);</span>
<span class="o">}</span> <span class="k">else</span> <span class="o">{</span>
  <span class="n">System</span><span class="o">.</span><span class="na">out</span><span class="o">.</span><span class="na">println</span><span class="o">(</span><span class="s">&quot;X is positive or zero&quot;</span><span class="o">);</span>
<span class="o">}</span></code></pre></figure><p>Now, try to imagine this sign:</p><figure class='unprintable'><img src='https://www.yegor256.com/images/2015/01/if-then-throw-2.png' itemprop='image' style='width:500px;max-width:100%;' alt='The figure'/></figure><p>It looks very strange to me, and you will never see this sign anywhere simply because a dead end means an <em>end</em>, a full stop, a finish. What is the point of drawing a lane after the dead end sign? There is no point.</p><p>This is how a proper sign would look:</p><figure class='unprintable'><img src='https://www.yegor256.com/images/2015/01/if-then-throw-3.png' itemprop='image' style='width:500px;max-width:100%;' alt='The figure'/></figure><p>This is how a proper code block would look:</p><figure class="highlight"><pre><code class="language-java" data-lang="java"><span></span><span class="k">if</span> <span class="o">(</span><span class="n">x</span> <span class="o">&lt;</span> <span class="mi">0</span><span class="o">)</span> <span class="o">{</span>
  <span class="k">throw</span> <span class="k">new</span> <span class="n">Exception</span><span class="o">(</span><span class="s">&quot;X can&#39;t be negative&quot;</span><span class="o">);</span>
<span class="o">}</span>
<span class="n">System</span><span class="o">.</span><span class="na">out</span><span class="o">.</span><span class="na">println</span><span class="o">(</span><span class="s">&quot;X is positive or zero&quot;</span><span class="o">);</span></code></pre></figure><p>The same is true for loops. This is wrong:</p><figure class="highlight"><pre><code class="language-java" data-lang="java"><span></span><span class="k">for</span> <span class="o">(</span><span class="kt">int</span> <span class="n">x</span> <span class="o">:</span> <span class="n">numbers</span><span class="o">)</span> <span class="o">{</span>
  <span class="k">if</span> <span class="o">(</span><span class="n">x</span> <span class="o">&lt;</span> <span class="mi">0</span><span class="o">)</span> <span class="o">{</span>
    <span class="k">continue</span><span class="o">;</span>
  <span class="o">}</span> <span class="k">else</span> <span class="o">{</span>
    <span class="n">System</span><span class="o">.</span><span class="na">out</span><span class="o">.</span><span class="na">println</span><span class="o">(</span><span class="s">&quot;found positive number&quot;</span><span class="o">);</span>
  <span class="o">}</span>
<span class="o">}</span></code></pre></figure><p>While this is right:</p><figure class="highlight"><pre><code class="language-java" data-lang="java"><span></span><span class="k">for</span> <span class="o">(</span><span class="kt">int</span> <span class="n">x</span> <span class="o">:</span> <span class="n">numbers</span><span class="o">)</span> <span class="o">{</span>
  <span class="k">if</span> <span class="o">(</span><span class="n">x</span> <span class="o">&lt;</span> <span class="mi">0</span><span class="o">)</span> <span class="o">{</span>
    <span class="k">continue</span><span class="o">;</span>
  <span class="o">}</span>
  <span class="n">System</span><span class="o">.</span><span class="na">out</span><span class="o">.</span><span class="na">println</span><span class="o">(</span><span class="s">&quot;found positive number&quot;</span><span class="o">);</span>
<span class="o">}</span></code></pre></figure><p>There is no road after the dead end! If you draw it, your code looks like this very funny snippet I found a few years ago reviewing sources written by some very well-paid developer in one very serious company:</p><figure class="highlight"><pre><code class="language-java" data-lang="java"><span></span><span class="k">if</span> <span class="o">(</span><span class="n">x</span> <span class="o">&lt;</span> <span class="mi">0</span><span class="o">)</span> <span class="o">{</span>
  <span class="k">throw</span> <span class="k">new</span> <span class="n">Exception</span><span class="o">(</span><span class="s">&quot;X is negative&quot;</span><span class="o">);</span>
  <span class="n">System</span><span class="o">.</span><span class="na">exit</span><span class="o">(</span><span class="mi">1</span><span class="o">);</span>
<span class="o">}</span></code></pre></figure><p>Don&#39;t do this.</p></div></article></div><div class="wrapper"> <related-posts /></div><div class="disqus" role="complementary"><p class="disqus_hint"> Please, use <a href="https://help.disqus.com/commenting/what-html-tags-are-allowed-within-comments">syntax highlighting</a> in your comments, to make them more readable.</p><div id="disqus_thread" class="disqus-thread"> <a>&nbsp;</a></div><script> var disqus_config = function () { this.page.url = document.location.href.split('?')[0].split('#')[0].replace('https://', 'http://'); this.page.identifier = this.page.url; }; (function() { var d = document, s = d.createElement('script'); s.src = '//yegor256.disqus.com/embed.js'; s.setAttribute('data-timestamp', +new Date()); (d.head || d.body).appendChild(s); })(); </script> <noscript><div><p class="red"> JavaScript is disabled in your browser, that's why you can't see comments under this post.</p></div></noscript></div><div class="wrapper"> <footer class="footer"><p> &copy; <span itemscope="" itemprop="copyrightHolder" itemtype="http://schema.org/Person"> <span itemprop="name">Yegor Bugayenko</span> </span> 2014&ndash;<span itemprop="copyrightYear">2018</span></p></footer></div></section><div class="wrapper unprintable" style="text-align:center;margin-top:2em;"> <a href="http://www.sixnines.io/h/3ba1652f"> <img src="//www.sixnines.io/b/3ba1652f?style=flat" alt="sixnines availability badge"/> </a></div><script src="//code.jquery.com/jquery-1.9.0.min.js"></script> <script src="/js/all.js?4e047f6f42b"></script> <script>var disqus_shortname = 'yegor256';</script> <script id="dsq-count-scr" src="//yegor256.disqus.com/count.js" async="async"></script> <script> (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){ (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o), m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m) })(window,document,'script','//www.google-analytics.com/analytics.js','ga'); ga('create', 'UA-1963507-32', 'auto'); ga('send', 'pageview'); </script> <script> Cd=document;Cr="&"+Math.random();Cp="&s=1"; Cd.cookie="b=b";if(Cd.cookie)Cp+="&c=1"; Cp+="&t="+(new Date()).getTimezoneOffset(); if(self!=top)Cp+="&f=1"; </script> <script> if(navigator.javaEnabled())Cp+="&j=1"; </script> <script> if(typeof(screen)!='undefined')Cp+="&w="+screen.width+"&h="+ screen.height+"&d="+(screen.colorDepth?screen.colorDepth:screen.pixelDepth); </script> <script> Cd.write("<img src='//c.hit.ua/hit?i=95870&g=0&x=2"+Cp+Cr+ "&r="+escape(Cd.referrer)+"&u="+escape(window.location.href)+ "' border='0' wi"+"dth='1' he"+"ight='1'/>"); </script> <script type="application/ld+json"> { "@context": "http://schema.org", "@type": "Person", "name": "Yegor Bugayenko", "url": "http://www.yegor256.com", "sameAs": [ "https://www.facebook.com/yegor256", "https://instagram.com/yegor256", "https://www.linkedin.com/in/yegor256", "https://twitter.com/yegor256", "https://github.com/yegor256", "https://www.pinterest.com/yegor256/" ] } </script> </body> </html> <!DOCTYPE html> <html xmlns="http://www.w3.org/1999/xhtml" lang="en-US" xml:lang="en-US" itemscope="" itemtype="http://schema.org/WebSite"> <head> <meta charset="utf-8"/> <meta name="description" content="This article illustrates by example how immutability forces you to design small and cohesive objects, while mutability causes scope creep and tight coupling. " /> <meta name="keywords" content="email sending java, immutability example java, immutable object example, java email api, java email send, java email send sdk, java send email html" /> <meta name="viewport" content="width=device-width,minimum-scale=1,initial-scale=1"/> <meta name="google-site-verification" content="JEj_gQr2CPe2QKGw8XdMz0R7VboQIUbX3FlM-lwTq-8" /> <meta name="author" content="Yegor Bugayenko"> <meta name="article:published_time" content="2014-11-07 00:00:00 +0000"> <meta name="og:site_name" content="Yegor Bugayenko"/> <meta name="og:type" content="article" /> <meta name="og:locale" content="en_US" /> <meta name="twitter:account_id" content="4503599630178231" /> <meta name="twitter:creator" content="@yegor256"/> <meta name="twitter:site" content="@yegor256"/> <meta name="twitter:title" property="og:title" content="How Immutability Helps"/> <meta name="twitter:description" property="og:description" content="This article illustrates by example how immutability forces you to design small and cohesive objects, while mutability causes scope creep and tight coupling. "/> <meta name="twitter:url" property="og:url" content="https://www.yegor256.com/2014/11/07/how-immutability-helps.html"/> <meta name="telegram:channel" content="AAAAAEJFMRzsRTRxM3ec6A"/> <link rel="search" type="application/opensearchdescription+xml" href="/opensearch.xml" title="yegor256" /> <link rel="shortcut icon" href="/favicon.ico?4e047f6f42b"/> <link rel="apple-touch-icon" href="/favicon.ico?4e047f6f42b"/> <link rel="alternate" type="application/rss+xml" title="RSS for yegor256.com" href="https://www.yegor256.com/rss.xml"/> <link rel="stylesheet" href="/css/layout.css?4e047f6f42b"/> <link rel="stylesheet" href="/css/icons.css?4e047f6f42b"/> <link rel="canonical" href="https://www.yegor256.com/2014/11/07/how-immutability-helps.html" /> <link rel="amphtml" href="https://www.yegor256.com/2014/11/07/how-immutability-helps.amp.html" /> <title>How Immutability Helps </title> </head> <body><div class="wrapper"> <aside class="header-toggle unprintable" id="header-toggle" title="Show the menu" onclick="$('#header').show();$('#header-toggle').hide();">&#9776;</aside> <header class="header" id="header"><div class="face"> <a href="/about-me.html#form" class="sub" title="Click to subscribe to my monthly newsletter"><span>Subscribe</span></a> <a href="/about-me.html" style="position:relative;"> <img src="/images/face-256x256.jpg" class="photo" alt="Yegor Bugayenko"/> </a></div><nav><ul class="menu social notranslate"> <li><a href="https://twitter.com/intent/follow?screen_name=yegor256" rel="nofollow" title="Follow me on Twitter"><i class="icon icon-twitter notranslate" aria-hidden="true"></i></a></li> <li><a href="/rss.xml" rel="nofollow" title="Subscribe to my RSS feed"><i class="icon icon-rss notranslate" aria-hidden="true"></i></a></li> <li><a itemprop="sameAs" href="https://github.com/yegor256" rel="nofollow" title="My GitHub profile"><i class="icon icon-github notranslate" aria-hidden="true"></i></a></li> <li><a itemprop="sameAs" href="http://stackoverflow.com/users/187141/yegor256" rel="nofollow" title="My StackOverflow profile"><i class="icon icon-stackoverflow notranslate" aria-hidden="true"></i></a></li> <li><a itemprop="sameAs" href="https://www.facebook.com/yegor256" rel="nofollow" title="Follow me on Facebook"><i class="icon icon-facebook notranslate" aria-hidden="true"></i></a></li> <li><a itemprop="sameAs" href="https://instagram.com/yegor256" rel="nofollow" title="Follow me on Instagram"><i class="icon icon-instagram notranslate" aria-hidden="true"></i></a></li> <li><a itemprop="sameAs" href="https://www.linkedin.com/in/yegor256" rel="nofollow" title="My LinkedIn profile"><i class="icon icon-linkedin notranslate" aria-hidden="true"></i></a></li> <li><a itemprop="sameAs" href="https://www.youtube.com/c/yegor256?sub_confirmation=1" rel="nofollow" title="My Youtube video channel"><i class="icon icon-youtube notranslate" aria-hidden="true"></i></a></li> <li><a itemprop="sameAs" href="https://www.pinterest.com/yegor256/" rel="nofollow" title="My Pinterest boards"><i class="icon icon-pinterest notranslate" aria-hidden="true"></i></a></li> <li><a itemprop="sameAs" href="https://angel.co/yegor256" rel="nofollow" title="My AngelList profile"><i class="icon icon-angellist notranslate" aria-hidden="true"></i></a></li> <li><a href="https://soundcloud.com/yegor256" rel="nofollow" title="My podcast"><i class="icon icon-podcast notranslate" aria-hidden="true"></i></a></li> <li><a href="https://itunes.apple.com/us/podcast/yegor256-podcast/id1150826721" rel="nofollow" title="My iTunes podcast"><i class="icon icon-itunes notranslate" aria-hidden="true"></i></a></li> <li><a href="https://t.me/joinchat/AAAAAEJFMRzsRTRxM3ec6A" rel="nofollow" title="My Telegram public channel"><i class="icon icon-telegram notranslate" aria-hidden="true"></i></a></li> <li><a href="mailto:blog@yegor256.com" rel="nofollow" title="Email me any time"><i class="icon icon-mail notranslate" aria-hidden="true"></i></a></li></ul><ul class="menu"> <li><a href="/" title="Home page">Home</a></li> <li ><a href="/best.html" title="Best articles to read">12&#160;Best</a></li> <li ><a href="/contents.html" title="The contents of the entire blog">All&#160;288</a></li> <li ><a href="/webinars.html" title="My webinars">Webinars</a></li> <li ><a href="/talks.html" title="Future and past conference talks">Talks</a></li> <li ><a href="/books.html" title="The books I wrote">Books</a></li> <li ><a href="/papers.html" title="My academic papers and patents">Papers</a></li> <li ><a href="/pets.html" title="My loved pet projects">Pets</a></li> <li ><a href="/award.html" title="Software quality award">Award</a></li> <li ><a href="/testimonials.html" title="What some people say about me">Testimonials</a></li> <li ><a href="/shift-m.html" title="Audio podcast about project management">Shift-M</a></li> <li ><a href="/paintings.html" title="My paintings for sale">Paintings</a></li> <li><a href="http://ru.yegor256.com/" title="Немного на русском языке">По-русски</a></li></ul></nav><div class="search"> <form method="get" action="https://www.google.com/search" itemprop="potentialAction" itemscope="" itemtype="http://schema.org/SearchAction"> <meta itemprop="target" content="https://www.google.com/search?q={q}"/> <input name="sitesearch" value="yegor256.com" type="hidden"/> <input itemprop="query-input" type="text" id="search-query" class="field field-text" required="required" onfocus="$('.google').css('visibility', 'visible');" name="q" placeholder="Search..." autocomplete="off"/> <input type="image" src="/images/google-search-icon.svg" class="google" title="Search via Google" alt="Search via Google"/> </form></div><div class="hot"><ul> <li> <a href="/code-ahead.html">Code Ahead</a> was published on Amazon just a few days ago! It is my new book, a novel about programmers. It explains in details the majority of ideas that stand behind <a href="https://www.zerocracy.com">Zerocracy</a> and <a href="https://www.xdsd.org">XDSD</a>. </li> <li> At <a href="/webinars.html">Webinar #37</a> we will discuss naming problem in OOP, for objects, methods and attributes; join us on <b>September 12</b>, at 11am PST. </li></ul></div></header></div><section itemscope="" itemtype="http://schema.org/BlogPosting"><div class="wrapper"> <header><p class="printable"> <img src="https://api.qrserver.com/v1/create-qr-code/?data=https://www.yegor256.com/2014/11/07/how-immutability-helps.html&amp;format=svg" style="width:125px;height:125px;" alt="QR code"/></p><p class="printable"> <code itemprop="url">https://www.yegor256.com/2014/11/07/how-immutability-helps.html</code></p><h1 itemprop="name headline mainEntityOfPage">How Immutability Helps</h1><aside class='book'><a href='http://amzn.to/2qFt4Tn'><img src='/images/books/elegant-objects/cover.png' class='book-cover' alt='book cover'/></a>Read more about this subject in <a href='http://amzn.to/2qFt4Tn'>Section&nbsp;2.6</a><br/> of my book<a href='http://amzn.to/2qFt4Tn'><img src='/images/books/amazon-buy-button.png' class='amazon-button' alt='Click to buy'/></a></aside><ul class="subline"> <li> <time itemprop="datePublished" datetime="2014-11-07T00:00:00+00:00"> 7 November 2014 </time> </li> <li class="printable" itemscope="" itemprop="author" itemtype="http://schema.org/Person"> <span itemprop="name">Yegor Bugayenko</span> </li> <li class="unprintable"> <i class="icon icon-comments"></i> <a href="http://www.yegor256.com/2014/11/07/how-immutability-helps.html#disqus_thread" itemprop="discussionUrl">comments</a> </li></ul><ul class="subline"> <li>Discussed at:</li> <li><a href="https://www.reddit.com/r/programming/comments/2llw2x/how_immutability_helps_in_object_design/">reddit</a></li></ul><p>Here is how your code will look, if you send an email using commons-email:</p><figure class="highlight"><pre><code class="language-java" data-lang="java"><span></span><span class="n">Email</span> <span class="n">email</span> <span class="o">=</span> <span class="k">new</span> <span class="n">SimpleEmail</span><span class="o">();</span>
<span class="n">email</span><span class="o">.</span><span class="na">setHostName</span><span class="o">(</span><span class="s">&quot;smtp.googlemail.com&quot;</span><span class="o">);</span>
<span class="n">email</span><span class="o">.</span><span class="na">setSmtpPort</span><span class="o">(</span><span class="mi">465</span><span class="o">);</span>
<span class="n">email</span><span class="o">.</span><span class="na">setAuthenticator</span><span class="o">(</span><span class="k">new</span> <span class="n">DefaultAuthenticator</span><span class="o">(</span><span class="s">&quot;user&quot;</span><span class="o">,</span> <span class="s">&quot;pwd&quot;</span><span class="o">));</span>
<span class="n">email</span><span class="o">.</span><span class="na">setFrom</span><span class="o">(</span><span class="s">&quot;yegor256@gmail.com&quot;</span><span class="o">,</span> <span class="s">&quot;Yegor Bugayenko&quot;</span><span class="o">);</span>
<span class="n">email</span><span class="o">.</span><span class="na">addTo</span><span class="o">(</span><span class="s">&quot;dude@jcabi.com&quot;</span><span class="o">);</span>
<span class="n">email</span><span class="o">.</span><span class="na">setSubject</span><span class="o">(</span><span class="s">&quot;how are you?&quot;</span><span class="o">);</span>
<span class="n">email</span><span class="o">.</span><span class="na">setMsg</span><span class="o">(</span><span class="s">&quot;Dude, how are you?&quot;</span><span class="o">);</span>
<span class="n">email</span><span class="o">.</span><span class="na">send</span><span class="o">();</span></code></pre></figure><p>Here is how you do the same with <a href="http://email.jcabi.com">jcabi-email</a>:</p><figure class="highlight"><pre><code class="language-java" data-lang="java"><span></span><span class="n">Postman</span> <span class="n">postman</span> <span class="o">=</span> <span class="k">new</span> <span class="n">Postman</span><span class="o">.</span><span class="na">Default</span><span class="o">(</span>
  <span class="k">new</span> <span class="n">SMTP</span><span class="o">(</span><span class="s">&quot;smtp.googlemail.com&quot;</span><span class="o">,</span> <span class="mi">465</span><span class="o">,</span> <span class="s">&quot;user&quot;</span><span class="o">,</span> <span class="s">&quot;pwd&quot;</span><span class="o">)</span>
<span class="o">);</span>
<span class="n">Envelope</span> <span class="n">envelope</span> <span class="o">=</span> <span class="k">new</span> <span class="n">Envelope</span><span class="o">.</span><span class="na">MIME</span><span class="o">(</span>
  <span class="k">new</span> <span class="n">Array</span><span class="o">&lt;</span><span class="n">Stamp</span><span class="o">&gt;(</span>
    <span class="k">new</span> <span class="n">StSender</span><span class="o">(</span><span class="s">&quot;Yegor Bugayenko &lt;yegor256@gmail.com&gt;&quot;</span><span class="o">),</span>
    <span class="k">new</span> <span class="n">StRecipient</span><span class="o">(</span><span class="s">&quot;dude@jcabi.com&quot;</span><span class="o">),</span>
    <span class="k">new</span> <span class="n">StSubject</span><span class="o">(</span><span class="s">&quot;how are you?&quot;</span><span class="o">)</span>
  <span class="o">),</span>
  <span class="k">new</span> <span class="n">Array</span><span class="o">&lt;</span><span class="n">Enclosure</span><span class="o">&gt;(</span>
    <span class="k">new</span> <span class="n">EnPlain</span><span class="o">(</span><span class="s">&quot;Dude, how are you?&quot;</span><span class="o">)</span>
  <span class="o">)</span>
<span class="o">);</span>
<span class="n">postman</span><span class="o">.</span><span class="na">send</span><span class="o">(</span><span class="n">envelope</span><span class="o">);</span></code></pre></figure><p>I think the difference is obvious.</p><p>In the first example, you&#39;re dealing with a monster <a href="/2016/09/20/oop-without-classes.html">class</a> that can do everything for you, including sending your MIME message via SMTP, creating the message, configuring its parameters, adding MIME parts to it, etc. The <a href="http://svn.apache.org/viewvc/commons/proper/email/tags/EMAIL_1_3_3/src/main/java/org/apache/commons/mail/Email.java?revision=1609295&view=co"><code>Email</code></a> class from commons-email is really a huge class---33 private properties, over a hundred methods, about two thousands lines of code. First, you configure the class through a bunch of setters and then you ask it to <code>send()</code> an email for you.</p><aside class='youtube'> <a href='https://www.youtube.com/watch?v=KwP7Ay9Z-hc'><div class='box'> <img src='https://i.ytimg.com/vi/KwP7Ay9Z-hc/mqdefault.jpg' alt='YouTube video #KwP7Ay9Z-hc'/><div class='play'><i class='icon icon-play'></i></div></div></a><div>Immutable Objects vs. Common Sense (webinar #2); 6 May 2015.</div></aside><p>In the second example, we have seven objects instantiated via seven <code>new</code> calls. <code>Postman</code> is responsible for packaging a MIME message; <code>SMTP</code> is responsible for sending it via SMTP; stamps (<code>StSender</code>, <code>StRecipient</code>, and <code>StSubject</code>) are responsible for configuring the MIME message before delivery; enclosure <code>EnPlain</code> is responsible for creating a MIME part for the message we&#39;re going to send. We construct these seven objects, encapsulating one into another, and then we ask the postman to <code>send()</code> the envelope for us.</p><h2 id="whats-wrong-with-a-mutable-email">What&#39;s Wrong With a Mutable Email?</h2><p>From a user perspective, there is almost nothing wrong. <code>Email</code> is a powerful class with multiple controls---just hit the right one and the job gets done. However, from a developer perspective <code>Email</code> class is a nightmare. Mostly because the class is very big and difficult to maintain.</p><p><em>Because the class is so big</em>, every time you want to extend it by introducing a new method, you&#39;re facing the fact that you&#39;re making the class even worse---longer, less cohesive, less readable, less maintainable, etc. You have a feeling that you&#39;re digging into something dirty and that there is no hope to make it cleaner, ever. I&#39;m sure, you&#39;re familiar with this feeling---most legacy applications look that way. They have huge multi-line &quot;classes&quot; (in reality, COBOL programs written in Java) that were inherited from a few generations of programmers before you. When you start, you&#39;re full of energy, but after a few minutes of scrolling such a &quot;class&quot; you say---&quot;screw it, it&#39;s almost Saturday.&quot;</p><aside class='youtube'> <a href='https://www.youtube.com/watch?v=EnhRgXrHCC4'><div class='box'> <img src='https://i.ytimg.com/vi/EnhRgXrHCC4/mqdefault.jpg' alt='YouTube video #EnhRgXrHCC4'/><div class='play'><i class='icon icon-play'></i></div></div></a><div>How Immutability Helps in OOP (in Russian with English subtitles); 21 May 2016.</div></aside><p><em>Because the class is so big</em>, there is no data hiding or encapsulation any more---33 variables are accessible by over 100 methods. What is hidden? This <code>Email.java</code> file in reality is a big, procedural 2000-line script, called a &quot;class&quot; by mistake. Nothing is hidden, once you cross the border of the class by calling one of its methods. After that, you have full access to all the data you may need. Why is this bad? Well, why do we need <a href="/2016/11/21/naked-data.html">encapsulation</a> in the first place? In order to protect one programmer from another, aka <a href="/2016/01/26/defensive-programming.html">defensive programming</a>. While I&#39;m busy changing the subject of the MIME message, I want to be sure that I&#39;m not interfered with by some other method&#39;s activity, that is changing a sender and touching my subject by mistake. Encapsulation helps us narrow down the scope of the problem, while this <code>Email</code> class is doing exactly the opposite.</p><p><em>Because the class is so big</em>, its unit testing is even more complicated than the class itself. Why? Because of multiple inter-dependencies between its methods and properties. In order to test <code>setCharset()</code> you have to prepare the entire object by calling a few other methods, then you have to call <code>send()</code> to make sure the message being sent actually uses the encoding you specified. Thus, in order to test a one-line method <code>setCharset()</code> you run the entire integration testing scenario of sending a full MIME message through SMTP. Obviously, if something gets changed in one of the methods, almost every test method will be affected. In other words, tests are very fragile, unreliable and over-complicated.</p><p>I can go on and on with this &quot;<em>because the class is so big</em>,&quot; but I think it is obvious that a small, cohesive class is always better than a big one. It is obvious to me, to you, and to any object-oriented programmer. But why is it not so obvious to the developers of Apache Commons Email? I don&#39;t think they are stupid or un-educated. What is it then?</p><h2 id="how-and-why-did-it-happen">How and Why Did It Happen?</h2><p>This is how it always happens. You start to design a class as something cohesive, solid, and small. Your intentions are very positive. Very soon you realize that there is something else that this class has to do. Then, something else. Then, even more.</p><p>The best way to make your class more and more powerful is by adding setters that inject configuration parameters into the class so that it can process them inside, isn&#39;t it?</p><aside class='youtube'> <a href='https://www.youtube.com/watch?v=p7m7_iiqaHI'><div class='box'> <img src='https://i.ytimg.com/vi/p7m7_iiqaHI/mqdefault.jpg' alt='YouTube video #p7m7_iiqaHI'/><div class='play'><i class='icon icon-play'></i></div></div></a><div>How Much Immutability Is Enough?; 19 May 2016.</div></aside><p>This is the root cause of the problem! The root cause is our ability to <em>insert</em> data into mutable objects via configuration methods, also known as &quot;setters.&quot; When an <a href="/2016/07/14/who-is-object.html">object</a> is mutable and allows us to add setters whenever we want, we will do it without limits.</p><p>Let me put it this way---<em>mutable classes tend to grow in size and lose cohesiveness</em>.</p><p>If commons-email authors made this <code>Email</code> class immutable in the beginning, they wouldn&#39;t have been able to add so many methods into it and encapsulate so many properties. They wouldn&#39;t be able to turn it into a monster. Why? Because an immutable object only accepts a state through a constructor. Can you imagine a 33-argument constructor? Of course, not.</p><p>When you make your class immutable in the first place, you are forced to keep it cohesive, small, solid and robust. Because you can&#39;t encapsulate too much and you can&#39;t modify what&#39;s encapsulated. Just two or three arguments of a constructor and you&#39;re done.</p><h2 id="how-did-i-design-an-immutable-email">How Did I Design An Immutable Email?</h2><figure class='badge'><a href='http://http.jcabi.com'><img src='http://img.jcabi.com/logo-square.svg' style='width:64px;max-width:100%;' alt='badge'/></a></figure><p>When I was designing <a href="https://github.com/jcabi/jcabi-email">jcabi-email</a> I started with a small and simple class: <a href="https://github.com/jcabi/jcabi-email/blob/1.3/src/main/java/com/jcabi/email/Postman.java"><code>Postman</code></a>. Well, it is an interface, since I never make <a href="/2016/04/26/why-inputstream-design-is-wrong.html">interface</a>-less classes. So, <code>Postman</code> is... a post man. He is delivering messages to other people. First, I created a default version of it (I omit the ctor, for the sake of brevity):</p><figure class="highlight"><pre><code class="language-java" data-lang="java"><span></span><span class="kn">import</span> <span class="nn">javax.mail.Message</span><span class="o">;</span>
<span class="nd">@Immutable</span>
<span class="kd">class</span> <span class="nc">Postman</span><span class="o">.</span><span class="na">Default</span> <span class="kd">implements</span> <span class="n">Postman</span> <span class="o">{</span>
  <span class="kd">private</span> <span class="kd">final</span> <span class="n">String</span> <span class="n">host</span><span class="o">;</span>
  <span class="kd">private</span> <span class="kd">final</span> <span class="kt">int</span> <span class="n">port</span><span class="o">;</span>
  <span class="kd">private</span> <span class="kd">final</span> <span class="n">String</span> <span class="n">user</span><span class="o">;</span>
  <span class="kd">private</span> <span class="kd">final</span> <span class="n">String</span> <span class="n">password</span><span class="o">;</span>
  <span class="nd">@Override</span>
  <span class="kt">void</span> <span class="nf">send</span><span class="o">(</span><span class="n">Message</span> <span class="n">msg</span><span class="o">)</span> <span class="o">{</span>
    <span class="c1">// create SMTP session</span>
    <span class="c1">// create transport</span>
    <span class="c1">// transport.connect(this.host, this.port, etc.)</span>
    <span class="c1">// transport.send(msg)</span>
    <span class="c1">// transport.close();</span>
  <span class="o">}</span>
<span class="o">}</span></code></pre></figure><p>Good start, it works. What now? Well, the <a href="http://docs.oracle.com/javaee/7/api/javax/jms/Message.html"><code>Message</code></a> is difficult to construct. It is a complex class from JDK that requires some manipulations before it can become a nice HTML email. So I created an envelope, which will build this complex object for me (pay attention, both <a href="https://github.com/jcabi/jcabi-email/blob/1.3/src/main/java/com/jcabi/email/Postman.java"><code>Postman</code></a> and <a href="https://github.com/jcabi/jcabi-email/blob/1.3/src/main/java/com/jcabi/email/Envelope.java"><code>Envelope</code></a> are immutable and annotated with <a href="http://aspects.jcabi.com/apidocs-0.20/com/jcabi/aspects/Immutable.html">@Immutable</a> from <a href="http://aspects.jcabi.com/annotation-immutable.html">jcabi-aspects</a>):</p><figure class="highlight"><pre><code class="language-java" data-lang="java"><span></span><span class="nd">@Immutable</span>
<span class="kd">interface</span> <span class="nc">Envelope</span> <span class="o">{</span>
  <span class="n">Message</span> <span class="nf">unwrap</span><span class="o">();</span>
<span class="o">}</span></code></pre></figure><p>I also refactor the <code>Postman</code> to accept an envelope, not a message:</p><figure class="highlight"><pre><code class="language-java" data-lang="java"><span></span><span class="nd">@Immutable</span>
<span class="kd">interface</span> <span class="nc">Postman</span> <span class="o">{</span>
  <span class="kt">void</span> <span class="nf">send</span><span class="o">(</span><span class="n">Envelope</span> <span class="n">env</span><span class="o">);</span>
<span class="o">}</span></code></pre></figure><p>So far, so good. Now let&#39;s try to create a simple implementation of <code>Envelope</code>:</p><figure class="highlight"><pre><code class="language-java" data-lang="java"><span></span><span class="nd">@Immutable</span>
<span class="kd">class</span> <span class="nc">MIME</span> <span class="kd">implements</span> <span class="n">Envelope</span> <span class="o">{</span>
  <span class="nd">@Override</span>
  <span class="kd">public</span> <span class="n">Message</span> <span class="nf">unwrap</span><span class="o">()</span> <span class="o">{</span>
    <span class="k">return</span> <span class="k">new</span> <span class="n">MimeMessage</span><span class="o">(</span>
      <span class="n">Session</span><span class="o">.</span><span class="na">getDefaultInstance</span><span class="o">(</span><span class="k">new</span> <span class="n">Properties</span><span class="o">())</span>
    <span class="o">);</span>
  <span class="o">}</span>
<span class="o">}</span></code></pre></figure><p>It works, but it does nothing useful yet. It only creates an absolutely empty MIME message and returns it. How about adding a subject to it and both <code>To:</code> and <code>From:</code> addresses (pay attention, <a href="http://email.jcabi.com/apidocs-1.10/com/jcabi/email/Envelope.Mime.html"><code>MIME</code></a> class is also immutable):</p><figure class="highlight"><pre><code class="language-java" data-lang="java"><span></span><span class="nd">@Immutable</span>
<span class="kd">class</span> <span class="nc">Envelope</span><span class="o">.</span><span class="na">MIME</span> <span class="kd">implements</span> <span class="n">Envelope</span> <span class="o">{</span>
  <span class="kd">private</span> <span class="kd">final</span> <span class="n">String</span> <span class="n">subject</span><span class="o">;</span>
  <span class="kd">private</span> <span class="kd">final</span> <span class="n">String</span> <span class="n">from</span><span class="o">;</span>
  <span class="kd">private</span> <span class="kd">final</span> <span class="n">Array</span><span class="o">&lt;</span><span class="n">String</span><span class="o">&gt;</span> <span class="n">to</span><span class="o">;</span>
  <span class="kd">public</span> <span class="nf">MIME</span><span class="o">(</span><span class="n">String</span> <span class="n">subj</span><span class="o">,</span> <span class="n">String</span> <span class="n">sender</span><span class="o">,</span> <span class="n">Iterable</span><span class="o">&lt;</span><span class="n">String</span><span class="o">&gt;</span> <span class="n">rcpts</span><span class="o">)</span> <span class="o">{</span>
    <span class="k">this</span><span class="o">.</span><span class="na">subject</span> <span class="o">=</span> <span class="n">subj</span><span class="o">;</span>
    <span class="k">this</span><span class="o">.</span><span class="na">from</span> <span class="o">=</span> <span class="n">sender</span><span class="o">;</span>
    <span class="k">this</span><span class="o">.</span><span class="na">to</span> <span class="o">=</span> <span class="k">new</span> <span class="n">Array</span><span class="o">&lt;</span><span class="n">String</span><span class="o">&gt;(</span><span class="n">rcpts</span><span class="o">);</span>
  <span class="o">}</span>
  <span class="nd">@Override</span>
  <span class="kd">public</span> <span class="n">Message</span> <span class="nf">unwrap</span><span class="o">()</span> <span class="o">{</span>
    <span class="n">Message</span> <span class="n">msg</span> <span class="o">=</span> <span class="k">new</span> <span class="n">MimeMessage</span><span class="o">(</span>
      <span class="n">Session</span><span class="o">.</span><span class="na">getDefaultInstance</span><span class="o">(</span><span class="k">new</span> <span class="n">Properties</span><span class="o">())</span>
    <span class="o">);</span>
    <span class="n">msg</span><span class="o">.</span><span class="na">setSubject</span><span class="o">(</span><span class="k">this</span><span class="o">.</span><span class="na">subject</span><span class="o">);</span>
    <span class="n">msg</span><span class="o">.</span><span class="na">setFrom</span><span class="o">(</span><span class="k">new</span> <span class="n">InternetAddress</span><span class="o">(</span><span class="k">this</span><span class="o">.</span><span class="na">from</span><span class="o">));</span>
    <span class="k">for</span> <span class="o">(</span><span class="n">String</span> <span class="n">email</span> <span class="o">:</span> <span class="k">this</span><span class="o">.</span><span class="na">to</span><span class="o">)</span> <span class="o">{</span>
      <span class="n">msg</span><span class="o">.</span><span class="na">setRecipient</span><span class="o">(</span>
        <span class="n">Message</span><span class="o">.</span><span class="na">RecipientType</span><span class="o">.</span><span class="na">TO</span><span class="o">,</span>
        <span class="k">new</span> <span class="n">InternetAddress</span><span class="o">(</span><span class="n">email</span><span class="o">)</span>
      <span class="o">);</span>
    <span class="o">}</span>
    <span class="k">return</span> <span class="n">msg</span><span class="o">;</span>
  <span class="o">}</span>
<span class="o">}</span></code></pre></figure><p>Looks correct and it works. But it is still too primitive. How about <code>CC:</code> and <code>BCC:</code>? What about email text? How about PDF enclosures? What if I want to specify the encoding of the message? What about <code>Reply-To</code>?</p><p>Can I add all these parameters to the constructor? Remember, the class is immutable and I can&#39;t introduce the <code>setReplyTo()</code> method. I have to pass the <code>replyTo</code> argument into its constructor. It&#39;s impossible, because the constructor will have too many arguments, and nobody will be able to use it.</p><p>So, what do I do?</p><p>Well, I started to think: how can we break the concept of an &quot;envelope&quot; into smaller concepts---and this what I invented. Like a real-life envelope, my <code>MIME</code> object will have stamps. Stamps will be responsible for configuring an object <code>Message</code> (again, <a href="https://github.com/jcabi/jcabi-email/blob/1.3/src/main/java/com/jcabi/email/Stamp.java"><code>Stamp</code></a> is immutable, as well as all its implementers):</p><figure class="highlight"><pre><code class="language-java" data-lang="java"><span></span><span class="nd">@Immutable</span>
<span class="kd">interface</span> <span class="nc">Stamp</span> <span class="o">{</span>
  <span class="kt">void</span> <span class="nf">attach</span><span class="o">(</span><span class="n">Message</span> <span class="n">message</span><span class="o">);</span>
<span class="o">}</span></code></pre></figure><p>Now, I can simplify my <a href="https://github.com/jcabi/jcabi-email/blob/1.3/src/main/java/com/jcabi/email/Envelope.java"><code>MIME</code></a> class to the following:</p><figure class="highlight"><pre><code class="language-java" data-lang="java"><span></span><span class="nd">@Immutable</span>
<span class="kd">class</span> <span class="nc">Envelope</span><span class="o">.</span><span class="na">MIME</span> <span class="kd">implements</span> <span class="n">Envelope</span> <span class="o">{</span>
  <span class="kd">private</span> <span class="kd">final</span> <span class="n">Array</span><span class="o">&lt;</span><span class="n">Stamp</span><span class="o">&gt;</span> <span class="n">stamps</span><span class="o">;</span>
  <span class="kd">public</span> <span class="nf">MIME</span><span class="o">(</span><span class="n">Iterable</span><span class="o">&lt;</span><span class="n">Stamp</span><span class="o">&gt;</span> <span class="n">stmps</span><span class="o">)</span> <span class="o">{</span>
    <span class="k">this</span><span class="o">.</span><span class="na">stamps</span> <span class="o">=</span> <span class="k">new</span> <span class="n">Array</span><span class="o">&lt;</span><span class="n">Stamp</span><span class="o">&gt;(</span><span class="n">stmps</span><span class="o">);</span>
  <span class="o">}</span>
  <span class="nd">@Override</span>
  <span class="kd">public</span> <span class="n">Message</span> <span class="nf">unwrap</span><span class="o">()</span> <span class="o">{</span>
    <span class="n">Message</span> <span class="n">msg</span> <span class="o">=</span> <span class="k">new</span> <span class="n">MimeMessage</span><span class="o">(</span>
      <span class="n">Session</span><span class="o">.</span><span class="na">getDefaultInstance</span><span class="o">(</span><span class="k">new</span> <span class="n">Properties</span><span class="o">())</span>
    <span class="o">);</span>
    <span class="k">for</span> <span class="o">(</span><span class="n">Stamp</span> <span class="n">stamp</span> <span class="o">:</span> <span class="k">this</span><span class="o">.</span><span class="na">stamps</span><span class="o">)</span> <span class="o">{</span>
      <span class="n">stamp</span><span class="o">.</span><span class="na">attach</span><span class="o">(</span><span class="n">msg</span><span class="o">);</span>
    <span class="o">}</span>
    <span class="k">return</span> <span class="n">msg</span><span class="o">;</span>
  <span class="o">}</span>
<span class="o">}</span></code></pre></figure><p>Now, I will create stamps for the subject, for <code>To:</code>, for <code>From:</code>, for <code>CC:</code>, for <code>BCC:</code>, etc. As many stamps as I like. The class <code>MIME</code> will stay the same---small, cohesive, readable, solid, etc.</p><p>What is important here is why I made the decision to refactor while the class was relatively small. Indeed, I started to worry about these stamp classes when my <code>MIME</code> class was just 25 lines in size.</p><p>That is exactly the point of this article---<em>immutability forces you to design small and cohesive objects</em>.</p><p>Without immutability, I would have gone the same direction as commons-email. My <code>MIME</code> class would grow in size and sooner or later would become as big as <code>Email</code> from commons-email. The only thing that stopped me was the necessity to refactor it, because I wasn&#39;t able to pass all arguments through a constructor.</p><p>Without immutability, I wouldn&#39;t have had that motivator and I would have done what Apache developers did with commons-email---bloat the class and turn it into an unmaintainable <a href="/2017/09/12/evil-object-name-suffix-client.html">monster</a>.</p><p>That&#39;s <a href="http://email.jcabi.com">jcabi-email</a>. I hope this example was illustrative enough and that you will start writing cleaner code with immutable objects.</p></p>--> <nav class="buttons notranslate desktop-only"> <a href="http://www.facebook.com/sharer/sharer.php?u=https://www.yegor256.com/2014/11/07/how-immutability-helps.html" title="Share on Facebook" class="button" rel="nofollow"> <span class="count count-facebook">0</span> <i class="icon icon-facebook notranslate" aria-hidden="true"></i> </a> <a href="https://twitter.com/share?url=https://www.yegor256.com/2014/11/07/how-immutability-helps.html&amp;text=How+Immutability+Helps" title="Share on Twitter" class="button" rel="nofollow"> <span class="count count-twitter">0</span> <i class="icon icon-twitter notranslate" aria-hidden="true"></i> </a> <a href="https://plus.google.com/share?url=https://www.yegor256.com/2014/11/07/how-immutability-helps.html" title="Share on Google+" class="button" rel="nofollow"> <span class="count count-googleplus">0</span> <i class="icon icon-googleplus notranslate" aria-hidden="true"></i> </a> <a href="https://www.linkedin.com/cws/share?url=https://www.yegor256.com/2014/11/07/how-immutability-helps.html" title="Share on LinkedIn" class="button" rel="nofollow"> <span class="count count-linkedin">0</span> <i class="icon icon-linkedin notranslate" aria-hidden="true"></i> </a> <a href="http://reddit.com/submit?url=https://www.yegor256.com/2014/11/07/how-immutability-helps.html%3F2014-44&amp;title=How+Immutability+Helps" title="Share on Reddit" class="button" rel="nofollow"> <span class="count count-reddit">0</span> <i class="icon icon-reddit notranslate" aria-hidden="true"></i> </a> <a href="http://news.ycombinator.com/submitlink?u=https://www.yegor256.com/2014/11/07/how-immutability-helps.html%3F2014-44&amp;t=How+Immutability+Helps" title="Share on Hacker News" class="button" rel="nofollow"> <span class="count count-hackernews">0</span> <i class="icon icon-hackernews notranslate" aria-hidden="true"></i> </a> </nav> </header> <article class="main" itemprop="articleBody"><div ><p>In a few recent posts, including <a href="/2014/09/16/getters-and-setters-are-evil.html">Getters/Setters. Evil. Period.</a> <a href="/2014/06/09/objects-should-be-immutable.html">Objects Should Be Immutable</a>, and <a href="/2014/10/03/di-containers-are-evil.html">Dependency Injection Containers are Code Polluters</a>, I universally labeled all mutable objects with &quot;setters&quot; (object methods starting with <code>set</code>) evil. My argumentation was based mostly on metaphors and abstract examples. Apparently, this wasn&#39;t convincing enough for many of you---I received a few requests asking to provide more specific and practical examples.</p><p>Thus, in order to illustrate my strongly negative attitude to &quot;mutability via setters,&quot; I took an existing <a href="http://commons.apache.org/proper/commons-email/">commons-email</a> Java library from Apache and re-designed it my way, without setters and with &quot;object thinking&quot; in mind. I released my library as part of the <a href="http://www.jcabi.com">jcabi</a> family---<a href="http://email.jcabi.com">jcabi-email</a>. Let&#39;s see what benefits we get from a &quot;pure&quot; object-oriented and immutable approach, without getters.</p><p>Here is how your code will look, if you send an email using commons-email:</p><figure class="highlight"><pre><code class="language-java" data-lang="java"><span></span><span class="n">Email</span> <span class="n">email</span> <span class="o">=</span> <span class="k">new</span> <span class="n">SimpleEmail</span><span class="o">();</span>
<span class="n">email</span><span class="o">.</span><span class="na">setHostName</span><span class="o">(</span><span class="s">&quot;smtp.googlemail.com&quot;</span><span class="o">);</span>
<span class="n">email</span><span class="o">.</span><span class="na">setSmtpPort</span><span class="o">(</span><span class="mi">465</span><span class="o">);</span>
<span class="n">email</span><span class="o">.</span><span class="na">setAuthenticator</span><span class="o">(</span><span class="k">new</span> <span class="n">DefaultAuthenticator</span><span class="o">(</span><span class="s">&quot;user&quot;</span><span class="o">,</span> <span class="s">&quot;pwd&quot;</span><span class="o">));</span>
<span class="n">email</span><span class="o">.</span><span class="na">setFrom</span><span class="o">(</span><span class="s">&quot;yegor256@gmail.com&quot;</span><span class="o">,</span> <span class="s">&quot;Yegor Bugayenko&quot;</span><span class="o">);</span>
<span class="n">email</span><span class="o">.</span><span class="na">addTo</span><span class="o">(</span><span class="s">&quot;dude@jcabi.com&quot;</span><span class="o">);</span>
<span class="n">email</span><span class="o">.</span><span class="na">setSubject</span><span class="o">(</span><span class="s">&quot;how are you?&quot;</span><span class="o">);</span>
<span class="n">email</span><span class="o">.</span><span class="na">setMsg</span><span class="o">(</span><span class="s">&quot;Dude, how are you?&quot;</span><span class="o">);</span>
<span class="n">email</span><span class="o">.</span><span class="na">send</span><span class="o">();</span></code></pre></figure><p>Here is how you do the same with <a href="http://email.jcabi.com">jcabi-email</a>:</p><figure class="highlight"><pre><code class="language-java" data-lang="java"><span></span><span class="n">Postman</span> <span class="n">postman</span> <span class="o">=</span> <span class="k">new</span> <span class="n">Postman</span><span class="o">.</span><span class="na">Default</span><span class="o">(</span>
  <span class="k">new</span> <span class="n">SMTP</span><span class="o">(</span><span class="s">&quot;smtp.googlemail.com&quot;</span><span class="o">,</span> <span class="mi">465</span><span class="o">,</span> <span class="s">&quot;user&quot;</span><span class="o">,</span> <span class="s">&quot;pwd&quot;</span><span class="o">)</span>
<span class="o">);</span>
<span class="n">Envelope</span> <span class="n">envelope</span> <span class="o">=</span> <span class="k">new</span> <span class="n">Envelope</span><span class="o">.</span><span class="na">MIME</span><span class="o">(</span>
  <span class="k">new</span> <span class="n">Array</span><span class="o">&lt;</span><span class="n">Stamp</span><span class="o">&gt;(</span>
    <span class="k">new</span> <span class="n">StSender</span><span class="o">(</span><span class="s">&quot;Yegor Bugayenko &lt;yegor256@gmail.com&gt;&quot;</span><span class="o">),</span>
    <span class="k">new</span> <span class="n">StRecipient</span><span class="o">(</span><span class="s">&quot;dude@jcabi.com&quot;</span><span class="o">),</span>
    <span class="k">new</span> <span class="n">StSubject</span><span class="o">(</span><span class="s">&quot;how are you?&quot;</span><span class="o">)</span>
  <span class="o">),</span>
  <span class="k">new</span> <span class="n">Array</span><span class="o">&lt;</span><span class="n">Enclosure</span><span class="o">&gt;(</span>
    <span class="k">new</span> <span class="n">EnPlain</span><span class="o">(</span><span class="s">&quot;Dude, how are you?&quot;</span><span class="o">)</span>
  <span class="o">)</span>
<span class="o">);</span>
<span class="n">postman</span><span class="o">.</span><span class="na">send</span><span class="o">(</span><span class="n">envelope</span><span class="o">);</span></code></pre></figure><p>I think the difference is obvious.</p><p>In the first example, you&#39;re dealing with a monster <a href="/2016/09/20/oop-without-classes.html">class</a> that can do everything for you, including sending your MIME message via SMTP, creating the message, configuring its parameters, adding MIME parts to it, etc. The <a href="http://svn.apache.org/viewvc/commons/proper/email/tags/EMAIL_1_3_3/src/main/java/org/apache/commons/mail/Email.java?revision=1609295&view=co"><code>Email</code></a> class from commons-email is really a huge class---33 private properties, over a hundred methods, about two thousands lines of code. First, you configure the class through a bunch of setters and then you ask it to <code>send()</code> an email for you.</p><aside class='youtube'> <a href='https://www.youtube.com/watch?v=KwP7Ay9Z-hc'><div class='box'> <img src='https://i.ytimg.com/vi/KwP7Ay9Z-hc/mqdefault.jpg' alt='YouTube video #KwP7Ay9Z-hc'/><div class='play'><i class='icon icon-play'></i></div></div></a><div>Immutable Objects vs. Common Sense (webinar #2); 6 May 2015.</div></aside><p>In the second example, we have seven objects instantiated via seven <code>new</code> calls. <code>Postman</code> is responsible for packaging a MIME message; <code>SMTP</code> is responsible for sending it via SMTP; stamps (<code>StSender</code>, <code>StRecipient</code>, and <code>StSubject</code>) are responsible for configuring the MIME message before delivery; enclosure <code>EnPlain</code> is responsible for creating a MIME part for the message we&#39;re going to send. We construct these seven objects, encapsulating one into another, and then we ask the postman to <code>send()</code> the envelope for us.</p><h2 id="whats-wrong-with-a-mutable-email">What&#39;s Wrong With a Mutable Email?</h2><p>From a user perspective, there is almost nothing wrong. <code>Email</code> is a powerful class with multiple controls---just hit the right one and the job gets done. However, from a developer perspective <code>Email</code> class is a nightmare. Mostly because the class is very big and difficult to maintain.</p><p><em>Because the class is so big</em>, every time you want to extend it by introducing a new method, you&#39;re facing the fact that you&#39;re making the class even worse---longer, less cohesive, less readable, less maintainable, etc. You have a feeling that you&#39;re digging into something dirty and that there is no hope to make it cleaner, ever. I&#39;m sure, you&#39;re familiar with this feeling---most legacy applications look that way. They have huge multi-line &quot;classes&quot; (in reality, COBOL programs written in Java) that were inherited from a few generations of programmers before you. When you start, you&#39;re full of energy, but after a few minutes of scrolling such a &quot;class&quot; you say---&quot;screw it, it&#39;s almost Saturday.&quot;</p><aside class='youtube'> <a href='https://www.youtube.com/watch?v=EnhRgXrHCC4'><div class='box'> <img src='https://i.ytimg.com/vi/EnhRgXrHCC4/mqdefault.jpg' alt='YouTube video #EnhRgXrHCC4'/><div class='play'><i class='icon icon-play'></i></div></div></a><div>How Immutability Helps in OOP (in Russian with English subtitles); 21 May 2016.</div></aside><p><em>Because the class is so big</em>, there is no data hiding or encapsulation any more---33 variables are accessible by over 100 methods. What is hidden? This <code>Email.java</code> file in reality is a big, procedural 2000-line script, called a &quot;class&quot; by mistake. Nothing is hidden, once you cross the border of the class by calling one of its methods. After that, you have full access to all the data you may need. Why is this bad? Well, why do we need <a href="/2016/11/21/naked-data.html">encapsulation</a> in the first place? In order to protect one programmer from another, aka <a href="/2016/01/26/defensive-programming.html">defensive programming</a>. While I&#39;m busy changing the subject of the MIME message, I want to be sure that I&#39;m not interfered with by some other method&#39;s activity, that is changing a sender and touching my subject by mistake. Encapsulation helps us narrow down the scope of the problem, while this <code>Email</code> class is doing exactly the opposite.</p><p><em>Because the class is so big</em>, its unit testing is even more complicated than the class itself. Why? Because of multiple inter-dependencies between its methods and properties. In order to test <code>setCharset()</code> you have to prepare the entire object by calling a few other methods, then you have to call <code>send()</code> to make sure the message being sent actually uses the encoding you specified. Thus, in order to test a one-line method <code>setCharset()</code> you run the entire integration testing scenario of sending a full MIME message through SMTP. Obviously, if something gets changed in one of the methods, almost every test method will be affected. In other words, tests are very fragile, unreliable and over-complicated.</p><p>I can go on and on with this &quot;<em>because the class is so big</em>,&quot; but I think it is obvious that a small, cohesive class is always better than a big one. It is obvious to me, to you, and to any object-oriented programmer. But why is it not so obvious to the developers of Apache Commons Email? I don&#39;t think they are stupid or un-educated. What is it then?</p><h2 id="how-and-why-did-it-happen">How and Why Did It Happen?</h2><p>This is how it always happens. You start to design a class as something cohesive, solid, and small. Your intentions are very positive. Very soon you realize that there is something else that this class has to do. Then, something else. Then, even more.</p><p>The best way to make your class more and more powerful is by adding setters that inject configuration parameters into the class so that it can process them inside, isn&#39;t it?</p><aside class='youtube'> <a href='https://www.youtube.com/watch?v=p7m7_iiqaHI'><div class='box'> <img src='https://i.ytimg.com/vi/p7m7_iiqaHI/mqdefault.jpg' alt='YouTube video #p7m7_iiqaHI'/><div class='play'><i class='icon icon-play'></i></div></div></a><div>How Much Immutability Is Enough?; 19 May 2016.</div></aside><p>This is the root cause of the problem! The root cause is our ability to <em>insert</em> data into mutable objects via configuration methods, also known as &quot;setters.&quot; When an <a href="/2016/07/14/who-is-object.html">object</a> is mutable and allows us to add setters whenever we want, we will do it without limits.</p><p>Let me put it this way---<em>mutable classes tend to grow in size and lose cohesiveness</em>.</p><p>If commons-email authors made this <code>Email</code> class immutable in the beginning, they wouldn&#39;t have been able to add so many methods into it and encapsulate so many properties. They wouldn&#39;t be able to turn it into a monster. Why? Because an immutable object only accepts a state through a constructor. Can you imagine a 33-argument constructor? Of course, not.</p><p>When you make your class immutable in the first place, you are forced to keep it cohesive, small, solid and robust. Because you can&#39;t encapsulate too much and you can&#39;t modify what&#39;s encapsulated. Just two or three arguments of a constructor and you&#39;re done.</p><h2 id="how-did-i-design-an-immutable-email">How Did I Design An Immutable Email?</h2><figure class='badge'><a href='http://http.jcabi.com'><img src='http://img.jcabi.com/logo-square.svg' style='width:64px;max-width:100%;' alt='badge'/></a></figure><p>When I was designing <a href="https://github.com/jcabi/jcabi-email">jcabi-email</a> I started with a small and simple class: <a href="https://github.com/jcabi/jcabi-email/blob/1.3/src/main/java/com/jcabi/email/Postman.java"><code>Postman</code></a>. Well, it is an interface, since I never make <a href="/2016/04/26/why-inputstream-design-is-wrong.html">interface</a>-less classes. So, <code>Postman</code> is... a post man. He is delivering messages to other people. First, I created a default version of it (I omit the ctor, for the sake of brevity):</p><figure class="highlight"><pre><code class="language-java" data-lang="java"><span></span><span class="kn">import</span> <span class="nn">javax.mail.Message</span><span class="o">;</span>
<span class="nd">@Immutable</span>
<span class="kd">class</span> <span class="nc">Postman</span><span class="o">.</span><span class="na">Default</span> <span class="kd">implements</span> <span class="n">Postman</span> <span class="o">{</span>
  <span class="kd">private</span> <span class="kd">final</span> <span class="n">String</span> <span class="n">host</span><span class="o">;</span>
  <span class="kd">private</span> <span class="kd">final</span> <span class="kt">int</span> <span class="n">port</span><span class="o">;</span>
  <span class="kd">private</span> <span class="kd">final</span> <span class="n">String</span> <span class="n">user</span><span class="o">;</span>
  <span class="kd">private</span> <span class="kd">final</span> <span class="n">String</span> <span class="n">password</span><span class="o">;</span>
  <span class="nd">@Override</span>
  <span class="kt">void</span> <span class="nf">send</span><span class="o">(</span><span class="n">Message</span> <span class="n">msg</span><span class="o">)</span> <span class="o">{</span>
    <span class="c1">// create SMTP session</span>
    <span class="c1">// create transport</span>
    <span class="c1">// transport.connect(this.host, this.port, etc.)</span>
    <span class="c1">// transport.send(msg)</span>
    <span class="c1">// transport.close();</span>
  <span class="o">}</span>
<span class="o">}</span></code></pre></figure><p>Good start, it works. What now? Well, the <a href="http://docs.oracle.com/javaee/7/api/javax/jms/Message.html"><code>Message</code></a> is difficult to construct. It is a complex class from JDK that requires some manipulations before it can become a nice HTML email. So I created an envelope, which will build this complex object for me (pay attention, both <a href="https://github.com/jcabi/jcabi-email/blob/1.3/src/main/java/com/jcabi/email/Postman.java"><code>Postman</code></a> and <a href="https://github.com/jcabi/jcabi-email/blob/1.3/src/main/java/com/jcabi/email/Envelope.java"><code>Envelope</code></a> are immutable and annotated with <a href="http://aspects.jcabi.com/apidocs-0.20/com/jcabi/aspects/Immutable.html">@Immutable</a> from <a href="http://aspects.jcabi.com/annotation-immutable.html">jcabi-aspects</a>):</p><figure class="highlight"><pre><code class="language-java" data-lang="java"><span></span><span class="nd">@Immutable</span>
<span class="kd">interface</span> <span class="nc">Envelope</span> <span class="o">{</span>
  <span class="n">Message</span> <span class="nf">unwrap</span><span class="o">();</span>
<span class="o">}</span></code></pre></figure><p>I also refactor the <code>Postman</code> to accept an envelope, not a message:</p><figure class="highlight"><pre><code class="language-java" data-lang="java"><span></span><span class="nd">@Immutable</span>
<span class="kd">interface</span> <span class="nc">Postman</span> <span class="o">{</span>
  <span class="kt">void</span> <span class="nf">send</span><span class="o">(</span><span class="n">Envelope</span> <span class="n">env</span><span class="o">);</span>
<span class="o">}</span></code></pre></figure><p>So far, so good. Now let&#39;s try to create a simple implementation of <code>Envelope</code>:</p><figure class="highlight"><pre><code class="language-java" data-lang="java"><span></span><span class="nd">@Immutable</span>
<span class="kd">class</span> <span class="nc">MIME</span> <span class="kd">implements</span> <span class="n">Envelope</span> <span class="o">{</span>
  <span class="nd">@Override</span>
  <span class="kd">public</span> <span class="n">Message</span> <span class="nf">unwrap</span><span class="o">()</span> <span class="o">{</span>
    <span class="k">return</span> <span class="k">new</span> <span class="n">MimeMessage</span><span class="o">(</span>
      <span class="n">Session</span><span class="o">.</span><span class="na">getDefaultInstance</span><span class="o">(</span><span class="k">new</span> <span class="n">Properties</span><span class="o">())</span>
    <span class="o">);</span>
  <span class="o">}</span>
<span class="o">}</span></code></pre></figure><p>It works, but it does nothing useful yet. It only creates an absolutely empty MIME message and returns it. How about adding a subject to it and both <code>To:</code> and <code>From:</code> addresses (pay attention, <a href="http://email.jcabi.com/apidocs-1.10/com/jcabi/email/Envelope.Mime.html"><code>MIME</code></a> class is also immutable):</p><figure class="highlight"><pre><code class="language-java" data-lang="java"><span></span><span class="nd">@Immutable</span>
<span class="kd">class</span> <span class="nc">Envelope</span><span class="o">.</span><span class="na">MIME</span> <span class="kd">implements</span> <span class="n">Envelope</span> <span class="o">{</span>
  <span class="kd">private</span> <span class="kd">final</span> <span class="n">String</span> <span class="n">subject</span><span class="o">;</span>
  <span class="kd">private</span> <span class="kd">final</span> <span class="n">String</span> <span class="n">from</span><span class="o">;</span>
  <span class="kd">private</span> <span class="kd">final</span> <span class="n">Array</span><span class="o">&lt;</span><span class="n">String</span><span class="o">&gt;</span> <span class="n">to</span><span class="o">;</span>
  <span class="kd">public</span> <span class="nf">MIME</span><span class="o">(</span><span class="n">String</span> <span class="n">subj</span><span class="o">,</span> <span class="n">String</span> <span class="n">sender</span><span class="o">,</span> <span class="n">Iterable</span><span class="o">&lt;</span><span class="n">String</span><span class="o">&gt;</span> <span class="n">rcpts</span><span class="o">)</span> <span class="o">{</span>
    <span class="k">this</span><span class="o">.</span><span class="na">subject</span> <span class="o">=</span> <span class="n">subj</span><span class="o">;</span>
    <span class="k">this</span><span class="o">.</span><span class="na">from</span> <span class="o">=</span> <span class="n">sender</span><span class="o">;</span>
    <span class="k">this</span><span class="o">.</span><span class="na">to</span> <span class="o">=</span> <span class="k">new</span> <span class="n">Array</span><span class="o">&lt;</span><span class="n">String</span><span class="o">&gt;(</span><span class="n">rcpts</span><span class="o">);</span>
  <span class="o">}</span>
  <span class="nd">@Override</span>
  <span class="kd">public</span> <span class="n">Message</span> <span class="nf">unwrap</span><span class="o">()</span> <span class="o">{</span>
    <span class="n">Message</span> <span class="n">msg</span> <span class="o">=</span> <span class="k">new</span> <span class="n">MimeMessage</span><span class="o">(</span>
      <span class="n">Session</span><span class="o">.</span><span class="na">getDefaultInstance</span><span class="o">(</span><span class="k">new</span> <span class="n">Properties</span><span class="o">())</span>
    <span class="o">);</span>
    <span class="n">msg</span><span class="o">.</span><span class="na">setSubject</span><span class="o">(</span><span class="k">this</span><span class="o">.</span><span class="na">subject</span><span class="o">);</span>
    <span class="n">msg</span><span class="o">.</span><span class="na">setFrom</span><span class="o">(</span><span class="k">new</span> <span class="n">InternetAddress</span><span class="o">(</span><span class="k">this</span><span class="o">.</span><span class="na">from</span><span class="o">));</span>
    <span class="k">for</span> <span class="o">(</span><span class="n">String</span> <span class="n">email</span> <span class="o">:</span> <span class="k">this</span><span class="o">.</span><span class="na">to</span><span class="o">)</span> <span class="o">{</span>
      <span class="n">msg</span><span class="o">.</span><span class="na">setRecipient</span><span class="o">(</span>
        <span class="n">Message</span><span class="o">.</span><span class="na">RecipientType</span><span class="o">.</span><span class="na">TO</span><span class="o">,</span>
        <span class="k">new</span> <span class="n">InternetAddress</span><span class="o">(</span><span class="n">email</span><span class="o">)</span>
      <span class="o">);</span>
    <span class="o">}</span>
    <span class="k">return</span> <span class="n">msg</span><span class="o">;</span>
  <span class="o">}</span>
<span class="o">}</span></code></pre></figure><p>Looks correct and it works. But it is still too primitive. How about <code>CC:</code> and <code>BCC:</code>? What about email text? How about PDF enclosures? What if I want to specify the encoding of the message? What about <code>Reply-To</code>?</p><p>Can I add all these parameters to the constructor? Remember, the class is immutable and I can&#39;t introduce the <code>setReplyTo()</code> method. I have to pass the <code>replyTo</code> argument into its constructor. It&#39;s impossible, because the constructor will have too many arguments, and nobody will be able to use it.</p><p>So, what do I do?</p><p>Well, I started to think: how can we break the concept of an &quot;envelope&quot; into smaller concepts---and this what I invented. Like a real-life envelope, my <code>MIME</code> object will have stamps. Stamps will be responsible for configuring an object <code>Message</code> (again, <a href="https://github.com/jcabi/jcabi-email/blob/1.3/src/main/java/com/jcabi/email/Stamp.java"><code>Stamp</code></a> is immutable, as well as all its implementers):</p><figure class="highlight"><pre><code class="language-java" data-lang="java"><span></span><span class="nd">@Immutable</span>
<span class="kd">interface</span> <span class="nc">Stamp</span> <span class="o">{</span>
  <span class="kt">void</span> <span class="nf">attach</span><span class="o">(</span><span class="n">Message</span> <span class="n">message</span><span class="o">);</span>
<span class="o">}</span></code></pre></figure><p>Now, I can simplify my <a href="https://github.com/jcabi/jcabi-email/blob/1.3/src/main/java/com/jcabi/email/Envelope.java"><code>MIME</code></a> class to the following:</p><figure class="highlight"><pre><code class="language-java" data-lang="java"><span></span><span class="nd">@Immutable</span>
<span class="kd">class</span> <span class="nc">Envelope</span><span class="o">.</span><span class="na">MIME</span> <span class="kd">implements</span> <span class="n">Envelope</span> <span class="o">{</span>
  <span class="kd">private</span> <span class="kd">final</span> <span class="n">Array</span><span class="o">&lt;</span><span class="n">Stamp</span><span class="o">&gt;</span> <span class="n">stamps</span><span class="o">;</span>
  <span class="kd">public</span> <span class="nf">MIME</span><span class="o">(</span><span class="n">Iterable</span><span class="o">&lt;</span><span class="n">Stamp</span><span class="o">&gt;</span> <span class="n">stmps</span><span class="o">)</span> <span class="o">{</span>
    <span class="k">this</span><span class="o">.</span><span class="na">stamps</span> <span class="o">=</span> <span class="k">new</span> <span class="n">Array</span><span class="o">&lt;</span><span class="n">Stamp</span><span class="o">&gt;(</span><span class="n">stmps</span><span class="o">);</span>
  <span class="o">}</span>
  <span class="nd">@Override</span>
  <span class="kd">public</span> <span class="n">Message</span> <span class="nf">unwrap</span><span class="o">()</span> <span class="o">{</span>
    <span class="n">Message</span> <span class="n">msg</span> <span class="o">=</span> <span class="k">new</span> <span class="n">MimeMessage</span><span class="o">(</span>
      <span class="n">Session</span><span class="o">.</span><span class="na">getDefaultInstance</span><span class="o">(</span><span class="k">new</span> <span class="n">Properties</span><span class="o">())</span>
    <span class="o">);</span>
    <span class="k">for</span> <span class="o">(</span><span class="n">Stamp</span> <span class="n">stamp</span> <span class="o">:</span> <span class="k">this</span><span class="o">.</span><span class="na">stamps</span><span class="o">)</span> <span class="o">{</span>
      <span class="n">stamp</span><span class="o">.</span><span class="na">attach</span><span class="o">(</span><span class="n">msg</span><span class="o">);</span>
    <span class="o">}</span>
    <span class="k">return</span> <span class="n">msg</span><span class="o">;</span>
  <span class="o">}</span>
<span class="o">}</span></code></pre></figure><p>Now, I will create stamps for the subject, for <code>To:</code>, for <code>From:</code>, for <code>CC:</code>, for <code>BCC:</code>, etc. As many stamps as I like. The class <code>MIME</code> will stay the same---small, cohesive, readable, solid, etc.</p><p>What is important here is why I made the decision to refactor while the class was relatively small. Indeed, I started to worry about these stamp classes when my <code>MIME</code> class was just 25 lines in size.</p><p>That is exactly the point of this article---<em>immutability forces you to design small and cohesive objects</em>.</p><p>Without immutability, I would have gone the same direction as commons-email. My <code>MIME</code> class would grow in size and sooner or later would become as big as <code>Email</code> from commons-email. The only thing that stopped me was the necessity to refactor it, because I wasn&#39;t able to pass all arguments through a constructor.</p><p>Without immutability, I wouldn&#39;t have had that motivator and I would have done what Apache developers did with commons-email---bloat the class and turn it into an unmaintainable <a href="/2017/09/12/evil-object-name-suffix-client.html">monster</a>.</p><p>That&#39;s <a href="http://email.jcabi.com">jcabi-email</a>. I hope this example was illustrative enough and that you will start writing cleaner code with immutable objects.</p></div></article></div><div class="wrapper"> <related-posts /></div><div class="disqus" role="complementary"><p class="disqus_hint"> Please, use <a href="https://help.disqus.com/commenting/what-html-tags-are-allowed-within-comments">syntax highlighting</a> in your comments, to make them more readable.</p><div id="disqus_thread" class="disqus-thread"> <a>&nbsp;</a></div><script> var disqus_config = function () { this.page.url = document.location.href.split('?')[0].split('#')[0].replace('https://', 'http://'); this.page.identifier = this.page.url; }; (function() { var d = document, s = d.createElement('script'); s.src = '//yegor256.disqus.com/embed.js'; s.setAttribute('data-timestamp', +new Date()); (d.head || d.body).appendChild(s); })(); </script> <noscript><div><p class="red"> JavaScript is disabled in your browser, that's why you can't see comments under this post.</p></div></noscript></div><div class="wrapper"> <footer class="footer"><p> &copy; <span itemscope="" itemprop="copyrightHolder" itemtype="http://schema.org/Person"> <span itemprop="name">Yegor Bugayenko</span> </span> 2014&ndash;<span itemprop="copyrightYear">2018</span></p></footer></div></section><div class="wrapper unprintable" style="text-align:center;margin-top:2em;"> <a href="http://www.sixnines.io/h/3ba1652f"> <img src="//www.sixnines.io/b/3ba1652f?style=flat" alt="sixnines availability badge"/> </a></div><script src="//code.jquery.com/jquery-1.9.0.min.js"></script> <script src="/js/all.js?4e047f6f42b"></script> <script>var disqus_shortname = 'yegor256';</script> <script id="dsq-count-scr" src="//yegor256.disqus.com/count.js" async="async"></script> <script> (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){ (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o), m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m) })(window,document,'script','//www.google-analytics.com/analytics.js','ga'); ga('create', 'UA-1963507-32', 'auto'); ga('send', 'pageview'); </script> <script> Cd=document;Cr="&"+Math.random();Cp="&s=1"; Cd.cookie="b=b";if(Cd.cookie)Cp+="&c=1"; Cp+="&t="+(new Date()).getTimezoneOffset(); if(self!=top)Cp+="&f=1"; </script> <script> if(navigator.javaEnabled())Cp+="&j=1"; </script> <script> if(typeof(screen)!='undefined')Cp+="&w="+screen.width+"&h="+ screen.height+"&d="+(screen.colorDepth?screen.colorDepth:screen.pixelDepth); </script> <script> Cd.write("<img src='//c.hit.ua/hit?i=95870&g=0&x=2"+Cp+Cr+ "&r="+escape(Cd.referrer)+"&u="+escape(window.location.href)+ "' border='0' wi"+"dth='1' he"+"ight='1'/>"); </script> <script type="application/ld+json"> { "@context": "http://schema.org", "@type": "Person", "name": "Yegor Bugayenko", "url": "http://www.yegor256.com", "sameAs": [ "https://www.facebook.com/yegor256", "https://instagram.com/yegor256", "https://www.linkedin.com/in/yegor256", "https://twitter.com/yegor256", "https://github.com/yegor256", "https://www.pinterest.com/yegor256/" ] } </script> </body> </html> <!DOCTYPE html> <html xmlns="http://www.w3.org/1999/xhtml" lang="en-US" xml:lang="en-US" itemscope="" itemtype="http://schema.org/WebSite"> <head> <meta charset="utf-8"/> <meta name="description" content="Paired Brackets notation makes your object-oriented code look beautiful and disciplined, no matter how deep the nesting level. " /> <meta name="keywords" content="indentation in c++, indentation in java, indentation in php, indentation in ruby, indentation notation" /> <meta name="viewport" content="width=device-width,minimum-scale=1,initial-scale=1"/> <meta name="google-site-verification" content="JEj_gQr2CPe2QKGw8XdMz0R7VboQIUbX3FlM-lwTq-8" /> <meta name="author" content="Yegor Bugayenko"> <meta name="article:published_time" content="2014-10-23 00:00:00 +0000"> <meta name="og:site_name" content="Yegor Bugayenko"/> <meta name="og:type" content="article" /> <meta name="og:locale" content="en_US" /> <meta name="twitter:account_id" content="4503599630178231" /> <meta name="twitter:creator" content="@yegor256"/> <meta name="twitter:site" content="@yegor256"/> <meta name="twitter:title" property="og:title" content="Paired Brackets"/> <meta name="twitter:description" property="og:description" content="Paired Brackets notation makes your object-oriented code look beautiful and disciplined, no matter how deep the nesting level. "/> <meta name="twitter:url" property="og:url" content="https://www.yegor256.com/2014/10/23/paired-brackets-notation.html"/> <meta name="telegram:channel" content="AAAAAEJFMRzsRTRxM3ec6A"/> <link rel="search" type="application/opensearchdescription+xml" href="/opensearch.xml" title="yegor256" /> <link rel="shortcut icon" href="/favicon.ico?4e047f6f42b"/> <link rel="apple-touch-icon" href="/favicon.ico?4e047f6f42b"/> <link rel="alternate" type="application/rss+xml" title="RSS for yegor256.com" href="https://www.yegor256.com/rss.xml"/> <link rel="stylesheet" href="/css/layout.css?4e047f6f42b"/> <link rel="stylesheet" href="/css/icons.css?4e047f6f42b"/> <link rel="canonical" href="https://www.yegor256.com/2014/10/23/paired-brackets-notation.html" /> <link rel="amphtml" href="https://www.yegor256.com/2014/10/23/paired-brackets-notation.amp.html" /> <title>Paired Brackets </title> </head> <body><div class="wrapper"> <aside class="header-toggle unprintable" id="header-toggle" title="Show the menu" onclick="$('#header').show();$('#header-toggle').hide();">&#9776;</aside> <header class="header" id="header"><div class="face"> <a href="/about-me.html#form" class="sub" title="Click to subscribe to my monthly newsletter"><span>Subscribe</span></a> <a href="/about-me.html" style="position:relative;"> <img src="/images/face-256x256.jpg" class="photo" alt="Yegor Bugayenko"/> </a></div><nav><ul class="menu social notranslate"> <li><a href="https://twitter.com/intent/follow?screen_name=yegor256" rel="nofollow" title="Follow me on Twitter"><i class="icon icon-twitter notranslate" aria-hidden="true"></i></a></li> <li><a href="/rss.xml" rel="nofollow" title="Subscribe to my RSS feed"><i class="icon icon-rss notranslate" aria-hidden="true"></i></a></li> <li><a itemprop="sameAs" href="https://github.com/yegor256" rel="nofollow" title="My GitHub profile"><i class="icon icon-github notranslate" aria-hidden="true"></i></a></li> <li><a itemprop="sameAs" href="http://stackoverflow.com/users/187141/yegor256" rel="nofollow" title="My StackOverflow profile"><i class="icon icon-stackoverflow notranslate" aria-hidden="true"></i></a></li> <li><a itemprop="sameAs" href="https://www.facebook.com/yegor256" rel="nofollow" title="Follow me on Facebook"><i class="icon icon-facebook notranslate" aria-hidden="true"></i></a></li> <li><a itemprop="sameAs" href="https://instagram.com/yegor256" rel="nofollow" title="Follow me on Instagram"><i class="icon icon-instagram notranslate" aria-hidden="true"></i></a></li> <li><a itemprop="sameAs" href="https://www.linkedin.com/in/yegor256" rel="nofollow" title="My LinkedIn profile"><i class="icon icon-linkedin notranslate" aria-hidden="true"></i></a></li> <li><a itemprop="sameAs" href="https://www.youtube.com/c/yegor256?sub_confirmation=1" rel="nofollow" title="My Youtube video channel"><i class="icon icon-youtube notranslate" aria-hidden="true"></i></a></li> <li><a itemprop="sameAs" href="https://www.pinterest.com/yegor256/" rel="nofollow" title="My Pinterest boards"><i class="icon icon-pinterest notranslate" aria-hidden="true"></i></a></li> <li><a itemprop="sameAs" href="https://angel.co/yegor256" rel="nofollow" title="My AngelList profile"><i class="icon icon-angellist notranslate" aria-hidden="true"></i></a></li> <li><a href="https://soundcloud.com/yegor256" rel="nofollow" title="My podcast"><i class="icon icon-podcast notranslate" aria-hidden="true"></i></a></li> <li><a href="https://itunes.apple.com/us/podcast/yegor256-podcast/id1150826721" rel="nofollow" title="My iTunes podcast"><i class="icon icon-itunes notranslate" aria-hidden="true"></i></a></li> <li><a href="https://t.me/joinchat/AAAAAEJFMRzsRTRxM3ec6A" rel="nofollow" title="My Telegram public channel"><i class="icon icon-telegram notranslate" aria-hidden="true"></i></a></li> <li><a href="mailto:blog@yegor256.com" rel="nofollow" title="Email me any time"><i class="icon icon-mail notranslate" aria-hidden="true"></i></a></li></ul><ul class="menu"> <li><a href="/" title="Home page">Home</a></li> <li ><a href="/best.html" title="Best articles to read">12&#160;Best</a></li> <li ><a href="/contents.html" title="The contents of the entire blog">All&#160;288</a></li> <li ><a href="/webinars.html" title="My webinars">Webinars</a></li> <li ><a href="/talks.html" title="Future and past conference talks">Talks</a></li> <li ><a href="/books.html" title="The books I wrote">Books</a></li> <li ><a href="/papers.html" title="My academic papers and patents">Papers</a></li> <li ><a href="/pets.html" title="My loved pet projects">Pets</a></li> <li ><a href="/award.html" title="Software quality award">Award</a></li> <li ><a href="/testimonials.html" title="What some people say about me">Testimonials</a></li> <li ><a href="/shift-m.html" title="Audio podcast about project management">Shift-M</a></li> <li ><a href="/paintings.html" title="My paintings for sale">Paintings</a></li> <li><a href="http://ru.yegor256.com/" title="Немного на русском языке">По-русски</a></li></ul></nav><div class="search"> <form method="get" action="https://www.google.com/search" itemprop="potentialAction" itemscope="" itemtype="http://schema.org/SearchAction"> <meta itemprop="target" content="https://www.google.com/search?q={q}"/> <input name="sitesearch" value="yegor256.com" type="hidden"/> <input itemprop="query-input" type="text" id="search-query" class="field field-text" required="required" onfocus="$('.google').css('visibility', 'visible');" name="q" placeholder="Search..." autocomplete="off"/> <input type="image" src="/images/google-search-icon.svg" class="google" title="Search via Google" alt="Search via Google"/> </form></div><div class="hot"><ul> <li> <a href="/code-ahead.html">Code Ahead</a> was published on Amazon just a few days ago! It is my new book, a novel about programmers. It explains in details the majority of ideas that stand behind <a href="https://www.zerocracy.com">Zerocracy</a> and <a href="https://www.xdsd.org">XDSD</a>. </li> <li> At <a href="/webinars.html">Webinar #37</a> we will discuss naming problem in OOP, for objects, methods and attributes; join us on <b>September 12</b>, at 11am PST. </li></ul></div></header></div><section itemscope="" itemtype="http://schema.org/BlogPosting"><div class="wrapper"> <header><p class="printable"> <img src="https://api.qrserver.com/v1/create-qr-code/?data=https://www.yegor256.com/2014/10/23/paired-brackets-notation.html&amp;format=svg" style="width:125px;height:125px;" alt="QR code"/></p><p class="printable"> <code itemprop="url">https://www.yegor256.com/2014/10/23/paired-brackets-notation.html</code></p><h1 itemprop="name headline mainEntityOfPage">Paired Brackets</h1><ul class="subline"> <li> <time itemprop="datePublished" datetime="2014-10-23T00:00:00+00:00"> 23 October 2014 </time> </li> <li class="printable" itemscope="" itemprop="author" itemtype="http://schema.org/Person"> <span itemprop="name">Yegor Bugayenko</span> </li> <li class="unprintable"> <i class="icon icon-comments"></i> <a href="http://www.yegor256.com/2014/10/23/paired-brackets-notation.html#disqus_thread" itemprop="discussionUrl">comments</a> </li></ul><ul class="subline"> <li>Discussed at:</li> <li><a href="https://www.reddit.com/r/programming/comments/2k2wdo/paired_brackets_notation/">reddit</a></li></ul><p>Obviously, the line with a closing bracket should start at the same indentation level as the line with its opening pair.</p><p>This is how your IDE will render the code if you follow this notation (IntelliJ IDEA):</p><figure class='unprintable'><img src='https://www.yegor256.com/images/2014/10/intellij-idea-indentation.png' itemprop='image' style='width:529px;max-width:100%;' alt='The figure'/></figure><p>Sublime Text will also appreciate it:</p><figure class='unprintable'><img src='https://www.yegor256.com/images/2014/10/sublime-text-indentation.png' itemprop='image' style='width:584px;max-width:100%;' alt='The figure'/></figure><p>As you see, those light vertical lines at the left side of the code help you to navigate, if you follow the notation.</p><p>Those multiple closing brackets may look strange to you at the beginning---but give yourself some time and you will get used to them :)</p><h2 id="fluent">Fluent</h2><p>This is how I would recommend formatting <a href="/2018/03/13/fluent-interfaces.html">fluent</a> method calls (this is Java in <a href="https://netbeans.org/">NetBeans</a>):</p><figure class='unprintable'><img src='https://www.yegor256.com/images/2014/10/netbeans-fluent-indentation.png' itemprop='image' style='width:637px;max-width:100%;' alt='The figure'/></figure><h2 id="arrays">Arrays</h2><p>Here is how you format an array in &quot;Paired Brackets&quot; notation (this is Ruby in <a href="https://www.jetbrains.com/ruby/">RubyMine</a>):</p><figure class='unprintable'><img src='https://www.yegor256.com/images/2014/10/rubymine-array-indentation.png' itemprop='image' style='width:568px;max-width:100%;' alt='The figure'/></figure><p>As you see, the same principle applies to square and curled brackets.</p><h2 id="json">JSON</h2><p>The same principle is applicable to <a href="/2015/11/16/json-vs-xml.html">JSON</a> formatting. This is a small JSON document in <a href="http://panic.com/coda/">Coda 2</a>:</p><figure class='unprintable'><img src='https://www.yegor256.com/images/2014/10/coda-json-indentation.png' itemprop='image' style='width:406px;max-width:100%;' alt='The figure'/></figure><h2 id="javascript">JavaScript</h2><p>JavaScript should also follow the same principle. This is how your <code>.js</code> code would look in <a href="https://atom.io/">Atom</a>:</p><figure class='unprintable'><img src='https://www.yegor256.com/images/2014/10/atom-javascript-indentation.png' itemprop='image' style='width:520px;max-width:100%;' alt='The figure'/></figure><h2 id="python">Python</h2><p>Finally, here is Python in <a href="https://www.jetbrains.com/pycharm/">PyCharm</a>:</p><figure class='unprintable'><img src='https://www.yegor256.com/images/2014/10/pycharm-python-indentation.png' itemprop='image' style='width:852px;max-width:100%;' alt='The figure'/></figure></p>--> <nav class="buttons notranslate desktop-only"> <a href="http://www.facebook.com/sharer/sharer.php?u=https://www.yegor256.com/2014/10/23/paired-brackets-notation.html" title="Share on Facebook" class="button" rel="nofollow"> <span class="count count-facebook">0</span> <i class="icon icon-facebook notranslate" aria-hidden="true"></i> </a> <a href="https://twitter.com/share?url=https://www.yegor256.com/2014/10/23/paired-brackets-notation.html&amp;text=Paired+Brackets" title="Share on Twitter" class="button" rel="nofollow"> <span class="count count-twitter">0</span> <i class="icon icon-twitter notranslate" aria-hidden="true"></i> </a> <a href="https://plus.google.com/share?url=https://www.yegor256.com/2014/10/23/paired-brackets-notation.html" title="Share on Google+" class="button" rel="nofollow"> <span class="count count-googleplus">0</span> <i class="icon icon-googleplus notranslate" aria-hidden="true"></i> </a> <a href="https://www.linkedin.com/cws/share?url=https://www.yegor256.com/2014/10/23/paired-brackets-notation.html" title="Share on LinkedIn" class="button" rel="nofollow"> <span class="count count-linkedin">0</span> <i class="icon icon-linkedin notranslate" aria-hidden="true"></i> </a> <a href="http://reddit.com/submit?url=https://www.yegor256.com/2014/10/23/paired-brackets-notation.html%3F2014-42&amp;title=Paired+Brackets" title="Share on Reddit" class="button" rel="nofollow"> <span class="count count-reddit">0</span> <i class="icon icon-reddit notranslate" aria-hidden="true"></i> </a> <a href="http://news.ycombinator.com/submitlink?u=https://www.yegor256.com/2014/10/23/paired-brackets-notation.html%3F2014-42&amp;t=Paired+Brackets" title="Share on Hacker News" class="button" rel="nofollow"> <span class="count count-hackernews">0</span> <i class="icon icon-hackernews notranslate" aria-hidden="true"></i> </a> </nav> </header> <article class="main" itemprop="articleBody"><div ><p>Here is a notation rule I&#39;m using in Java code: <strong>a bracket should either start/end a line or be paired on the same line</strong>.</p><p>The notation applies universally to any programming language (incl. Java, Ruby, Python, C++, PHP, etc.) where brackets are used for method/function calls.</p><p>Here is how your code will look, if you follow this &quot;Paired Brackets&quot; notation:</p><figure class="highlight"><pre><code class="language-java" data-lang="java"><span></span><span class="k">new</span> <span class="n">Foo</span><span class="o">(</span> <span class="c1">// ends the line</span>
  <span class="n">Math</span><span class="o">.</span><span class="na">max</span><span class="o">(</span><span class="mi">10</span><span class="o">,</span> <span class="mi">40</span><span class="o">),</span> <span class="c1">// open/close at the same line</span>
  <span class="n">String</span><span class="o">.</span><span class="na">format</span><span class="o">(</span>
    <span class="s">&quot;hello, %s&quot;</span><span class="o">,</span>
    <span class="k">new</span> <span class="n">Name</span><span class="o">(</span>
      <span class="n">Arrays</span><span class="o">.</span><span class="na">asList</span><span class="o">(</span>
        <span class="s">&quot;Jeff&quot;</span><span class="o">,</span>
        <span class="s">&quot;Lebowski&quot;</span>
      <span class="o">)</span>
    <span class="o">)</span>
  <span class="o">)</span> <span class="c1">// starts the line</span>
<span class="o">);</span></code></pre></figure><p>Obviously, the line with a closing bracket should start at the same indentation level as the line with its opening pair.</p><p>This is how your IDE will render the code if you follow this notation (IntelliJ IDEA):</p><figure class='unprintable'><img src='https://www.yegor256.com/images/2014/10/intellij-idea-indentation.png' itemprop='image' style='width:529px;max-width:100%;' alt='The figure'/></figure><p>Sublime Text will also appreciate it:</p><figure class='unprintable'><img src='https://www.yegor256.com/images/2014/10/sublime-text-indentation.png' itemprop='image' style='width:584px;max-width:100%;' alt='The figure'/></figure><p>As you see, those light vertical lines at the left side of the code help you to navigate, if you follow the notation.</p><p>Those multiple closing brackets may look strange to you at the beginning---but give yourself some time and you will get used to them :)</p><h2 id="fluent">Fluent</h2><p>This is how I would recommend formatting <a href="/2018/03/13/fluent-interfaces.html">fluent</a> method calls (this is Java in <a href="https://netbeans.org/">NetBeans</a>):</p><figure class='unprintable'><img src='https://www.yegor256.com/images/2014/10/netbeans-fluent-indentation.png' itemprop='image' style='width:637px;max-width:100%;' alt='The figure'/></figure><h2 id="arrays">Arrays</h2><p>Here is how you format an array in &quot;Paired Brackets&quot; notation (this is Ruby in <a href="https://www.jetbrains.com/ruby/">RubyMine</a>):</p><figure class='unprintable'><img src='https://www.yegor256.com/images/2014/10/rubymine-array-indentation.png' itemprop='image' style='width:568px;max-width:100%;' alt='The figure'/></figure><p>As you see, the same principle applies to square and curled brackets.</p><h2 id="json">JSON</h2><p>The same principle is applicable to <a href="/2015/11/16/json-vs-xml.html">JSON</a> formatting. This is a small JSON document in <a href="http://panic.com/coda/">Coda 2</a>:</p><figure class='unprintable'><img src='https://www.yegor256.com/images/2014/10/coda-json-indentation.png' itemprop='image' style='width:406px;max-width:100%;' alt='The figure'/></figure><h2 id="javascript">JavaScript</h2><p>JavaScript should also follow the same principle. This is how your <code>.js</code> code would look in <a href="https://atom.io/">Atom</a>:</p><figure class='unprintable'><img src='https://www.yegor256.com/images/2014/10/atom-javascript-indentation.png' itemprop='image' style='width:520px;max-width:100%;' alt='The figure'/></figure><h2 id="python">Python</h2><p>Finally, here is Python in <a href="https://www.jetbrains.com/pycharm/">PyCharm</a>:</p><figure class='unprintable'><img src='https://www.yegor256.com/images/2014/10/pycharm-python-indentation.png' itemprop='image' style='width:852px;max-width:100%;' alt='The figure'/></figure></div></article></div><div class="wrapper"> <related-posts /></div><div class="disqus" role="complementary"><p class="disqus_hint"> Please, use <a href="https://help.disqus.com/commenting/what-html-tags-are-allowed-within-comments">syntax highlighting</a> in your comments, to make them more readable.</p><div id="disqus_thread" class="disqus-thread"> <a>&nbsp;</a></div><script> var disqus_config = function () { this.page.url = document.location.href.split('?')[0].split('#')[0].replace('https://', 'http://'); this.page.identifier = this.page.url; }; (function() { var d = document, s = d.createElement('script'); s.src = '//yegor256.disqus.com/embed.js'; s.setAttribute('data-timestamp', +new Date()); (d.head || d.body).appendChild(s); })(); </script> <noscript><div><p class="red"> JavaScript is disabled in your browser, that's why you can't see comments under this post.</p></div></noscript></div><div class="wrapper"> <footer class="footer"><p> &copy; <span itemscope="" itemprop="copyrightHolder" itemtype="http://schema.org/Person"> <span itemprop="name">Yegor Bugayenko</span> </span> 2014&ndash;<span itemprop="copyrightYear">2018</span></p></footer></div></section><div class="wrapper unprintable" style="text-align:center;margin-top:2em;"> <a href="http://www.sixnines.io/h/3ba1652f"> <img src="//www.sixnines.io/b/3ba1652f?style=flat" alt="sixnines availability badge"/> </a></div><script src="//code.jquery.com/jquery-1.9.0.min.js"></script> <script src="/js/all.js?4e047f6f42b"></script> <script>var disqus_shortname = 'yegor256';</script> <script id="dsq-count-scr" src="//yegor256.disqus.com/count.js" async="async"></script> <script> (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){ (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o), m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m) })(window,document,'script','//www.google-analytics.com/analytics.js','ga'); ga('create', 'UA-1963507-32', 'auto'); ga('send', 'pageview'); </script> <script> Cd=document;Cr="&"+Math.random();Cp="&s=1"; Cd.cookie="b=b";if(Cd.cookie)Cp+="&c=1"; Cp+="&t="+(new Date()).getTimezoneOffset(); if(self!=top)Cp+="&f=1"; </script> <script> if(navigator.javaEnabled())Cp+="&j=1"; </script> <script> if(typeof(screen)!='undefined')Cp+="&w="+screen.width+"&h="+ screen.height+"&d="+(screen.colorDepth?screen.colorDepth:screen.pixelDepth); </script> <script> Cd.write("<img src='//c.hit.ua/hit?i=95870&g=0&x=2"+Cp+Cr+ "&r="+escape(Cd.referrer)+"&u="+escape(window.location.href)+ "' border='0' wi"+"dth='1' he"+"ight='1'/>"); </script> <script type="application/ld+json"> { "@context": "http://schema.org", "@type": "Person", "name": "Yegor Bugayenko", "url": "http://www.yegor256.com", "sameAs": [ "https://www.facebook.com/yegor256", "https://instagram.com/yegor256", "https://www.linkedin.com/in/yegor256", "https://twitter.com/yegor256", "https://github.com/yegor256", "https://www.pinterest.com/yegor256/" ] } </script> </body> </html> <!DOCTYPE html> <html xmlns="http://www.w3.org/1999/xhtml" lang="en-US" xml:lang="en-US" itemscope="" itemtype="http://schema.org/WebSite"> <head> <meta charset="utf-8"/> <meta name="description" content="Mocking frameworks is not a good practice and should be your last resort; instead, create and ship fake classes together with your code. " /> <meta name="keywords" content="best practices of mocking, java mock framework, java mocking, mocking frameworks, mocking is bad, mocking is evil, mocks are evil" /> <meta name="viewport" content="width=device-width,minimum-scale=1,initial-scale=1"/> <meta name="google-site-verification" content="JEj_gQr2CPe2QKGw8XdMz0R7VboQIUbX3FlM-lwTq-8" /> <meta name="author" content="Yegor Bugayenko"> <meta name="article:published_time" content="2014-09-23 00:00:00 +0000"> <meta name="og:site_name" content="Yegor Bugayenko"/> <meta name="og:type" content="article" /> <meta name="og:locale" content="en_US" /> <meta name="twitter:account_id" content="4503599630178231" /> <meta name="twitter:creator" content="@yegor256"/> <meta name="twitter:site" content="@yegor256"/> <meta name="twitter:title" property="og:title" content="Built-in Fake Objects"/> <meta name="twitter:description" property="og:description" content="Mocking frameworks is not a good practice and should be your last resort; instead, create and ship fake classes together with your code. "/> <meta name="twitter:url" property="og:url" content="https://www.yegor256.com/2014/09/23/built-in-fake-objects.html"/> <meta name="telegram:channel" content="AAAAAEJFMRzsRTRxM3ec6A"/> <link rel="search" type="application/opensearchdescription+xml" href="/opensearch.xml" title="yegor256" /> <link rel="shortcut icon" href="/favicon.ico?4e047f6f42b"/> <link rel="apple-touch-icon" href="/favicon.ico?4e047f6f42b"/> <link rel="alternate" type="application/rss+xml" title="RSS for yegor256.com" href="https://www.yegor256.com/rss.xml"/> <link rel="stylesheet" href="/css/layout.css?4e047f6f42b"/> <link rel="stylesheet" href="/css/icons.css?4e047f6f42b"/> <link rel="canonical" href="https://www.yegor256.com/2014/09/23/built-in-fake-objects.html" /> <link rel="amphtml" href="https://www.yegor256.com/2014/09/23/built-in-fake-objects.amp.html" /> <title>Built-in Fake Objects </title> </head> <body><div class="wrapper"> <aside class="header-toggle unprintable" id="header-toggle" title="Show the menu" onclick="$('#header').show();$('#header-toggle').hide();">&#9776;</aside> <header class="header" id="header"><div class="face"> <a href="/about-me.html#form" class="sub" title="Click to subscribe to my monthly newsletter"><span>Subscribe</span></a> <a href="/about-me.html" style="position:relative;"> <img src="/images/face-256x256.jpg" class="photo" alt="Yegor Bugayenko"/> </a></div><nav><ul class="menu social notranslate"> <li><a href="https://twitter.com/intent/follow?screen_name=yegor256" rel="nofollow" title="Follow me on Twitter"><i class="icon icon-twitter notranslate" aria-hidden="true"></i></a></li> <li><a href="/rss.xml" rel="nofollow" title="Subscribe to my RSS feed"><i class="icon icon-rss notranslate" aria-hidden="true"></i></a></li> <li><a itemprop="sameAs" href="https://github.com/yegor256" rel="nofollow" title="My GitHub profile"><i class="icon icon-github notranslate" aria-hidden="true"></i></a></li> <li><a itemprop="sameAs" href="http://stackoverflow.com/users/187141/yegor256" rel="nofollow" title="My StackOverflow profile"><i class="icon icon-stackoverflow notranslate" aria-hidden="true"></i></a></li> <li><a itemprop="sameAs" href="https://www.facebook.com/yegor256" rel="nofollow" title="Follow me on Facebook"><i class="icon icon-facebook notranslate" aria-hidden="true"></i></a></li> <li><a itemprop="sameAs" href="https://instagram.com/yegor256" rel="nofollow" title="Follow me on Instagram"><i class="icon icon-instagram notranslate" aria-hidden="true"></i></a></li> <li><a itemprop="sameAs" href="https://www.linkedin.com/in/yegor256" rel="nofollow" title="My LinkedIn profile"><i class="icon icon-linkedin notranslate" aria-hidden="true"></i></a></li> <li><a itemprop="sameAs" href="https://www.youtube.com/c/yegor256?sub_confirmation=1" rel="nofollow" title="My Youtube video channel"><i class="icon icon-youtube notranslate" aria-hidden="true"></i></a></li> <li><a itemprop="sameAs" href="https://www.pinterest.com/yegor256/" rel="nofollow" title="My Pinterest boards"><i class="icon icon-pinterest notranslate" aria-hidden="true"></i></a></li> <li><a itemprop="sameAs" href="https://angel.co/yegor256" rel="nofollow" title="My AngelList profile"><i class="icon icon-angellist notranslate" aria-hidden="true"></i></a></li> <li><a href="https://soundcloud.com/yegor256" rel="nofollow" title="My podcast"><i class="icon icon-podcast notranslate" aria-hidden="true"></i></a></li> <li><a href="https://itunes.apple.com/us/podcast/yegor256-podcast/id1150826721" rel="nofollow" title="My iTunes podcast"><i class="icon icon-itunes notranslate" aria-hidden="true"></i></a></li> <li><a href="https://t.me/joinchat/AAAAAEJFMRzsRTRxM3ec6A" rel="nofollow" title="My Telegram public channel"><i class="icon icon-telegram notranslate" aria-hidden="true"></i></a></li> <li><a href="mailto:blog@yegor256.com" rel="nofollow" title="Email me any time"><i class="icon icon-mail notranslate" aria-hidden="true"></i></a></li></ul><ul class="menu"> <li><a href="/" title="Home page">Home</a></li> <li ><a href="/best.html" title="Best articles to read">12&#160;Best</a></li> <li ><a href="/contents.html" title="The contents of the entire blog">All&#160;288</a></li> <li ><a href="/webinars.html" title="My webinars">Webinars</a></li> <li ><a href="/talks.html" title="Future and past conference talks">Talks</a></li> <li ><a href="/books.html" title="The books I wrote">Books</a></li> <li ><a href="/papers.html" title="My academic papers and patents">Papers</a></li> <li ><a href="/pets.html" title="My loved pet projects">Pets</a></li> <li ><a href="/award.html" title="Software quality award">Award</a></li> <li ><a href="/testimonials.html" title="What some people say about me">Testimonials</a></li> <li ><a href="/shift-m.html" title="Audio podcast about project management">Shift-M</a></li> <li ><a href="/paintings.html" title="My paintings for sale">Paintings</a></li> <li><a href="http://ru.yegor256.com/" title="Немного на русском языке">По-русски</a></li></ul></nav><div class="search"> <form method="get" action="https://www.google.com/search" itemprop="potentialAction" itemscope="" itemtype="http://schema.org/SearchAction"> <meta itemprop="target" content="https://www.google.com/search?q={q}"/> <input name="sitesearch" value="yegor256.com" type="hidden"/> <input itemprop="query-input" type="text" id="search-query" class="field field-text" required="required" onfocus="$('.google').css('visibility', 'visible');" name="q" placeholder="Search..." autocomplete="off"/> <input type="image" src="/images/google-search-icon.svg" class="google" title="Search via Google" alt="Search via Google"/> </form></div><div class="hot"><ul> <li> <a href="/code-ahead.html">Code Ahead</a> was published on Amazon just a few days ago! It is my new book, a novel about programmers. It explains in details the majority of ideas that stand behind <a href="https://www.zerocracy.com">Zerocracy</a> and <a href="https://www.xdsd.org">XDSD</a>. </li> <li> At <a href="/webinars.html">Webinar #37</a> we will discuss naming problem in OOP, for objects, methods and attributes; join us on <b>September 12</b>, at 11am PST. </li></ul></div></header></div><section itemscope="" itemtype="http://schema.org/BlogPosting"><div class="wrapper"> <header><p class="printable"> <img src="https://api.qrserver.com/v1/create-qr-code/?data=https://www.yegor256.com/2014/09/23/built-in-fake-objects.html&amp;format=svg" style="width:125px;height:125px;" alt="QR code"/></p><p class="printable"> <code itemprop="url">https://www.yegor256.com/2014/09/23/built-in-fake-objects.html</code></p><h1 itemprop="name headline mainEntityOfPage">Built-in Fake Objects</h1><aside class='book'><a href='http://amzn.to/2qFt4Tn'><img src='/images/books/elegant-objects/cover.png' class='book-cover' alt='book cover'/></a>Read more about this subject in <a href='http://amzn.to/2qFt4Tn'>Section&nbsp;2.8</a><br/> of my book<a href='http://amzn.to/2qFt4Tn'><img src='/images/books/amazon-buy-button.png' class='amazon-button' alt='Click to buy'/></a></aside><ul class="subline"> <li> <time itemprop="datePublished" datetime="2014-09-23T00:00:00+00:00"> 23 September 2014 </time> </li> <li class="printable" itemscope="" itemprop="author" itemtype="http://schema.org/Person"> <span itemprop="name">Yegor Bugayenko</span> </li> <li class="unprintable"> <i class="icon icon-comments"></i> <a href="http://www.yegor256.com/2014/09/23/built-in-fake-objects.html#disqus_thread" itemprop="discussionUrl">comments</a> </li></ul><h2 id="object-hierarchy">Object Hierarchy</h2><p>Take the <code>Region</code> interface from <a href="http://dynamo.jcabi.com">jcabi-dynamo</a> as an example (this snippet and all others in this article are simplified, for the sake of brevity):</p><figure class="highlight"><pre><code class="language-java" data-lang="java"><span></span><span class="kd">public</span> <span class="kd">interface</span> <span class="nc">Region</span> <span class="o">{</span>
  <span class="n">Table</span> <span class="nf">table</span><span class="o">(</span><span class="n">String</span> <span class="n">name</span><span class="o">);</span>
<span class="o">}</span></code></pre></figure><p>Its <code>table()</code> method returns an instance of the <code>Table</code> interface, which has its own methods:</p><figure class="highlight"><pre><code class="language-java" data-lang="java"><span></span><span class="kd">public</span> <span class="kd">interface</span> <span class="nc">Table</span> <span class="o">{</span>
  <span class="n">Frame</span> <span class="nf">frame</span><span class="o">();</span>
  <span class="n">Item</span> <span class="nf">put</span><span class="o">(</span><span class="n">Attributes</span> <span class="n">attrs</span><span class="o">);</span>
  <span class="n">Region</span> <span class="nf">region</span><span class="o">();</span>
<span class="o">}</span></code></pre></figure><p>Interface <code>Frame</code>, returned by the <code>frame()</code> method, also has its own methods. And so on. In order to create a properly mocked instance of interface <code>Region</code>, one would normally create a dozen other mock objects. With <a href="http://mockito.org">Mockito</a> it will look like this:</p><figure class="highlight"><pre><code class="language-java" data-lang="java"><span></span><span class="kd">public</span> <span class="kt">void</span> <span class="nf">testMe</span><span class="o">()</span> <span class="o">{</span>
  <span class="c1">// many more lines here...</span>
  <span class="n">Frame</span> <span class="n">frame</span> <span class="o">=</span> <span class="n">Mockito</span><span class="o">.</span><span class="na">mock</span><span class="o">(</span><span class="n">Frame</span><span class="o">.</span><span class="na">class</span><span class="o">);</span>
  <span class="n">Mockito</span><span class="o">.</span><span class="na">doReturn</span><span class="o">(...).</span><span class="na">when</span><span class="o">(</span><span class="n">frame</span><span class="o">).</span><span class="na">iterator</span><span class="o">();</span>
  <span class="n">Table</span> <span class="n">table</span> <span class="o">=</span> <span class="n">Mockito</span><span class="o">.</span><span class="na">mock</span><span class="o">(</span><span class="n">Table</span><span class="o">.</span><span class="na">class</span><span class="o">);</span>
  <span class="n">Mockito</span><span class="o">.</span><span class="na">doReturn</span><span class="o">(</span><span class="n">frame</span><span class="o">).</span><span class="na">when</span><span class="o">(</span><span class="n">table</span><span class="o">).</span><span class="na">frame</span><span class="o">();</span>
  <span class="n">Region</span> <span class="n">region</span> <span class="o">=</span> <span class="n">Mockito</span><span class="o">.</span><span class="na">mock</span><span class="o">(</span><span class="n">Region</span><span class="o">.</span><span class="na">class</span><span class="o">);</span>
  <span class="n">Mockito</span><span class="o">.</span><span class="na">doReturn</span><span class="o">(</span><span class="n">table</span><span class="o">).</span><span class="na">when</span><span class="o">(</span><span class="n">region</span><span class="o">).</span><span class="na">table</span><span class="o">(</span><span class="n">Mockito</span><span class="o">.</span><span class="na">anyString</span><span class="o">());</span>
<span class="o">}</span></code></pre></figure><p>And all of this is just a <a href="/2015/05/25/unit-test-scaffolding.html">scaffolding</a> before the actual testing.</p><h2 id="sample-use-case">Sample Use Case</h2><p>Let&#39;s say, you&#39;re developing a project that uses jcabi-dynamo for managing data in <a href="https://aws.amazon.com/dynamodb/">DynamoDB</a>. Your class may look similar to this:</p><figure class="highlight"><pre><code class="language-java" data-lang="java"><span></span><span class="kd">public</span> <span class="kd">class</span> <span class="nc">Employee</span> <span class="o">{</span>
  <span class="kd">private</span> <span class="kd">final</span> <span class="n">String</span> <span class="n">name</span><span class="o">;</span>
  <span class="kd">private</span> <span class="kd">final</span> <span class="n">Region</span> <span class="n">region</span><span class="o">;</span>
  <span class="kd">public</span> <span class="nf">Employee</span><span class="o">(</span><span class="n">String</span> <span class="n">empl</span><span class="o">,</span> <span class="n">Region</span> <span class="n">dynamo</span><span class="o">)</span> <span class="o">{</span>
    <span class="k">this</span><span class="o">.</span><span class="na">name</span> <span class="o">=</span> <span class="n">empl</span><span class="o">;</span>
    <span class="k">this</span><span class="o">.</span><span class="na">region</span> <span class="o">=</span> <span class="n">dynamo</span><span class="o">;</span>
  <span class="o">}</span>
  <span class="kd">public</span> <span class="n">Integer</span> <span class="nf">salary</span><span class="o">()</span> <span class="o">{</span>
    <span class="k">return</span> <span class="n">Integer</span><span class="o">.</span><span class="na">parseInt</span><span class="o">(</span>
      <span class="k">this</span><span class="o">.</span><span class="na">region</span>
        <span class="o">.</span><span class="na">table</span><span class="o">(</span><span class="s">&quot;employees&quot;</span><span class="o">)</span>
        <span class="o">.</span><span class="na">frame</span><span class="o">()</span>
        <span class="o">.</span><span class="na">where</span><span class="o">(</span><span class="s">&quot;name&quot;</span><span class="o">,</span> <span class="k">this</span><span class="o">.</span><span class="na">name</span><span class="o">)</span>
        <span class="o">.</span><span class="na">iterator</span><span class="o">()</span>
        <span class="o">.</span><span class="na">next</span><span class="o">()</span>
        <span class="o">.</span><span class="na">get</span><span class="o">(</span><span class="s">&quot;salary&quot;</span><span class="o">)</span>
        <span class="o">.</span><span class="na">getN</span><span class="o">()</span>
    <span class="o">);</span>
  <span class="o">}</span>
<span class="o">}</span></code></pre></figure><p>You can imagine how difficult it will be to unit test this class, using Mockito, for example. First, we have to mock the <code>Region</code> interface. Then, we have to mock a <code>Table</code> interface and make sure it is returned by the <code>table()</code> method. Then, we have to mock a <code>Frame</code> interface, etc.</p><aside class='youtube'> <a href='https://www.youtube.com/watch?v=l6MpCBzwDbg'><div class='box'> <img src='https://i.ytimg.com/vi/l6MpCBzwDbg/mqdefault.jpg' alt='YouTube video #l6MpCBzwDbg'/><div class='play'><i class='icon icon-play'></i></div></div></a><div>What Fake Objects Are For? (webinar #8); 4 November 2015.</div></aside><p>The unit test will be much longer than the class itself. Besides that, its real purpose, which is to test the retrieval of an employee&#39;s salary, will not be obvious to the reader.</p><p>Moreover, when we need to test a similar method of a similar class, we will need to restart this mocking from scratch. Again, multiple lines of code, which will look very similar to what we have already written.</p><h2 id="fake-classes">Fake Classes</h2><p>The solution is to create fake classes and ship them together with real classes. This is what <a href="http://dynamo.jcabi.com">jcabi-dynamo</a> is doing. Just look at its <a href="http://dynamo.jcabi.com/apidocs-0.16.1/index.html">JavaDoc</a>. There is a package called <code>com.jcabi.dynamo.mock</code> that contains only fake classes, suitable only for unit testing.</p><p>Even though their sole purpose is to optimize unit testing, we <a href="/2014/08/19/how-to-release-to-maven-central.html">ship them</a> together with production code, in the same JAR package.</p><p>This is what a test will look like, when a fake class <code>MkRegion</code> is used:</p><figure class="highlight"><pre><code class="language-java" data-lang="java"><span></span><span class="kd">public</span> <span class="kd">class</span> <span class="nc">EmployeeTest</span> <span class="o">{</span>
  <span class="kd">public</span> <span class="kt">void</span> <span class="nf">canFetchSalaryFromDynamoDb</span><span class="o">()</span> <span class="o">{</span>
    <span class="n">Region</span> <span class="n">region</span> <span class="o">=</span> <span class="k">new</span> <span class="n">MkRegion</span><span class="o">(</span>
      <span class="k">new</span> <span class="n">H2Data</span><span class="o">().</span><span class="na">with</span><span class="o">(</span>
        <span class="s">&quot;employees&quot;</span><span class="o">,</span> <span class="k">new</span> <span class="n">String</span><span class="o">[]</span> <span class="o">{</span><span class="s">&quot;name&quot;</span><span class="o">},</span>
        <span class="k">new</span> <span class="n">String</span><span class="o">[]</span> <span class="o">{</span><span class="s">&quot;salary&quot;</span><span class="o">}</span>
      <span class="o">)</span>
    <span class="o">);</span>
    <span class="n">region</span><span class="o">.</span><span class="na">table</span><span class="o">(</span><span class="s">&quot;employees&quot;</span><span class="o">).</span><span class="na">put</span><span class="o">(</span>
      <span class="k">new</span> <span class="n">Attributes</span><span class="o">()</span>
        <span class="o">.</span><span class="na">with</span><span class="o">(</span><span class="s">&quot;name&quot;</span><span class="o">,</span> <span class="s">&quot;Jeff&quot;</span><span class="o">)</span>
        <span class="o">.</span><span class="na">with</span><span class="o">(</span><span class="s">&quot;salary&quot;</span><span class="o">,</span> <span class="k">new</span> <span class="n">AttributeValue</span><span class="o">().</span><span class="na">withN</span><span class="o">(</span><span class="mi">50000</span><span class="o">))</span>
    <span class="o">);</span>
    <span class="n">Employee</span> <span class="n">emp</span> <span class="o">=</span> <span class="k">new</span> <span class="n">Employee</span><span class="o">(</span><span class="s">&quot;Jeff&quot;</span><span class="o">,</span> <span class="n">region</span><span class="o">);</span>
    <span class="n">assertThat</span><span class="o">(</span><span class="n">emp</span><span class="o">.</span><span class="na">salary</span><span class="o">(),</span> <span class="n">equalTo</span><span class="o">(</span><span class="mi">50000</span><span class="o">));</span>
  <span class="o">}</span>
<span class="o">}</span></code></pre></figure><p>This test looks obvious to me. First, we create a fake DynamoDB region, which works on top of <code>H2Data</code> storage (in-memory H2 database). The storage will be ready for a single <code>employees</code> table with a hash key <code>name</code> and a single <code>salary</code> attribute.</p><aside class='youtube'> <a href='https://www.youtube.com/watch?v=EDKbYVEInMU'><div class='box'> <img src='https://i.ytimg.com/vi/EDKbYVEInMU/mqdefault.jpg' alt='YouTube video #EDKbYVEInMU'/><div class='play'><i class='icon icon-play'></i></div></div></a><div>Built-in Fake Objects; 10 November 2016.</div></aside><p>Then, we put a record into the table, with a hash <code>Jeff</code> and a salary <code>50000</code>.</p><p>Finally, we create an instance of class <code>Employee</code> and check how it fetches the salary from DynamoDB.</p><p>I&#39;m currently doing the same thing in almost every open source library I&#39;m working with. I&#39;m creating a collection of fake classes, that simplify testing inside the library and for its users.</p><p>BTW, a great article on the same subject: <a href="http://nedbatchelder.com/blog/201206/tldw_stop_mocking_start_testing.html">tl;dw: Stop mocking, start testing</a> by Ned Batchelder.</p><p>PS. Check this out, on a very similar subject: <a href="/2014/04/18/jcabi-http-server-mocking.html">Mocking of HTTP Server in Java</a>.</p></p>--> <nav class="buttons notranslate desktop-only"> <a href="http://www.facebook.com/sharer/sharer.php?u=https://www.yegor256.com/2014/09/23/built-in-fake-objects.html" title="Share on Facebook" class="button" rel="nofollow"> <span class="count count-facebook">0</span> <i class="icon icon-facebook notranslate" aria-hidden="true"></i> </a> <a href="https://twitter.com/share?url=https://www.yegor256.com/2014/09/23/built-in-fake-objects.html&amp;text=Built-in+Fake+Objects" title="Share on Twitter" class="button" rel="nofollow"> <span class="count count-twitter">0</span> <i class="icon icon-twitter notranslate" aria-hidden="true"></i> </a> <a href="https://plus.google.com/share?url=https://www.yegor256.com/2014/09/23/built-in-fake-objects.html" title="Share on Google+" class="button" rel="nofollow"> <span class="count count-googleplus">0</span> <i class="icon icon-googleplus notranslate" aria-hidden="true"></i> </a> <a href="https://www.linkedin.com/cws/share?url=https://www.yegor256.com/2014/09/23/built-in-fake-objects.html" title="Share on LinkedIn" class="button" rel="nofollow"> <span class="count count-linkedin">0</span> <i class="icon icon-linkedin notranslate" aria-hidden="true"></i> </a> <a href="http://reddit.com/submit?url=https://www.yegor256.com/2014/09/23/built-in-fake-objects.html%3F2014-38&amp;title=Built-in+Fake+Objects" title="Share on Reddit" class="button" rel="nofollow"> <span class="count count-reddit">0</span> <i class="icon icon-reddit notranslate" aria-hidden="true"></i> </a> <a href="http://news.ycombinator.com/submitlink?u=https://www.yegor256.com/2014/09/23/built-in-fake-objects.html%3F2014-38&amp;t=Built-in+Fake+Objects" title="Share on Hacker News" class="button" rel="nofollow"> <span class="count count-hackernews">0</span> <i class="icon icon-hackernews notranslate" aria-hidden="true"></i> </a> </nav> </header> <article class="main" itemprop="articleBody"><div ><p>While mock objects are perfect instruments for unit testing, mocking through mock frameworks may turn your unit tests into an unmaintainable mess. Thanks to them we often hear that &quot;mocking is bad&quot; and &quot;mocking is evil.&quot;</p><p>The root cause of this complexity is that our objects are too big. They have many methods and these methods return other objects, which also have methods. When we pass a mock version of such an object as a parameter, we should make sure that all of its methods return valid objects.</p><p>This leads to inevitable complexity, which turns unit tests to <a href="https://news.ycombinator.com/item?id=7353767">waste</a> almost impossible to maintain.</p><h2 id="object-hierarchy">Object Hierarchy</h2><p>Take the <code>Region</code> interface from <a href="http://dynamo.jcabi.com">jcabi-dynamo</a> as an example (this snippet and all others in this article are simplified, for the sake of brevity):</p><figure class="highlight"><pre><code class="language-java" data-lang="java"><span></span><span class="kd">public</span> <span class="kd">interface</span> <span class="nc">Region</span> <span class="o">{</span>
  <span class="n">Table</span> <span class="nf">table</span><span class="o">(</span><span class="n">String</span> <span class="n">name</span><span class="o">);</span>
<span class="o">}</span></code></pre></figure><p>Its <code>table()</code> method returns an instance of the <code>Table</code> interface, which has its own methods:</p><figure class="highlight"><pre><code class="language-java" data-lang="java"><span></span><span class="kd">public</span> <span class="kd">interface</span> <span class="nc">Table</span> <span class="o">{</span>
  <span class="n">Frame</span> <span class="nf">frame</span><span class="o">();</span>
  <span class="n">Item</span> <span class="nf">put</span><span class="o">(</span><span class="n">Attributes</span> <span class="n">attrs</span><span class="o">);</span>
  <span class="n">Region</span> <span class="nf">region</span><span class="o">();</span>
<span class="o">}</span></code></pre></figure><p>Interface <code>Frame</code>, returned by the <code>frame()</code> method, also has its own methods. And so on. In order to create a properly mocked instance of interface <code>Region</code>, one would normally create a dozen other mock objects. With <a href="http://mockito.org">Mockito</a> it will look like this:</p><figure class="highlight"><pre><code class="language-java" data-lang="java"><span></span><span class="kd">public</span> <span class="kt">void</span> <span class="nf">testMe</span><span class="o">()</span> <span class="o">{</span>
  <span class="c1">// many more lines here...</span>
  <span class="n">Frame</span> <span class="n">frame</span> <span class="o">=</span> <span class="n">Mockito</span><span class="o">.</span><span class="na">mock</span><span class="o">(</span><span class="n">Frame</span><span class="o">.</span><span class="na">class</span><span class="o">);</span>
  <span class="n">Mockito</span><span class="o">.</span><span class="na">doReturn</span><span class="o">(...).</span><span class="na">when</span><span class="o">(</span><span class="n">frame</span><span class="o">).</span><span class="na">iterator</span><span class="o">();</span>
  <span class="n">Table</span> <span class="n">table</span> <span class="o">=</span> <span class="n">Mockito</span><span class="o">.</span><span class="na">mock</span><span class="o">(</span><span class="n">Table</span><span class="o">.</span><span class="na">class</span><span class="o">);</span>
  <span class="n">Mockito</span><span class="o">.</span><span class="na">doReturn</span><span class="o">(</span><span class="n">frame</span><span class="o">).</span><span class="na">when</span><span class="o">(</span><span class="n">table</span><span class="o">).</span><span class="na">frame</span><span class="o">();</span>
  <span class="n">Region</span> <span class="n">region</span> <span class="o">=</span> <span class="n">Mockito</span><span class="o">.</span><span class="na">mock</span><span class="o">(</span><span class="n">Region</span><span class="o">.</span><span class="na">class</span><span class="o">);</span>
  <span class="n">Mockito</span><span class="o">.</span><span class="na">doReturn</span><span class="o">(</span><span class="n">table</span><span class="o">).</span><span class="na">when</span><span class="o">(</span><span class="n">region</span><span class="o">).</span><span class="na">table</span><span class="o">(</span><span class="n">Mockito</span><span class="o">.</span><span class="na">anyString</span><span class="o">());</span>
<span class="o">}</span></code></pre></figure><p>And all of this is just a <a href="/2015/05/25/unit-test-scaffolding.html">scaffolding</a> before the actual testing.</p><h2 id="sample-use-case">Sample Use Case</h2><p>Let&#39;s say, you&#39;re developing a project that uses jcabi-dynamo for managing data in <a href="https://aws.amazon.com/dynamodb/">DynamoDB</a>. Your class may look similar to this:</p><figure class="highlight"><pre><code class="language-java" data-lang="java"><span></span><span class="kd">public</span> <span class="kd">class</span> <span class="nc">Employee</span> <span class="o">{</span>
  <span class="kd">private</span> <span class="kd">final</span> <span class="n">String</span> <span class="n">name</span><span class="o">;</span>
  <span class="kd">private</span> <span class="kd">final</span> <span class="n">Region</span> <span class="n">region</span><span class="o">;</span>
  <span class="kd">public</span> <span class="nf">Employee</span><span class="o">(</span><span class="n">String</span> <span class="n">empl</span><span class="o">,</span> <span class="n">Region</span> <span class="n">dynamo</span><span class="o">)</span> <span class="o">{</span>
    <span class="k">this</span><span class="o">.</span><span class="na">name</span> <span class="o">=</span> <span class="n">empl</span><span class="o">;</span>
    <span class="k">this</span><span class="o">.</span><span class="na">region</span> <span class="o">=</span> <span class="n">dynamo</span><span class="o">;</span>
  <span class="o">}</span>
  <span class="kd">public</span> <span class="n">Integer</span> <span class="nf">salary</span><span class="o">()</span> <span class="o">{</span>
    <span class="k">return</span> <span class="n">Integer</span><span class="o">.</span><span class="na">parseInt</span><span class="o">(</span>
      <span class="k">this</span><span class="o">.</span><span class="na">region</span>
        <span class="o">.</span><span class="na">table</span><span class="o">(</span><span class="s">&quot;employees&quot;</span><span class="o">)</span>
        <span class="o">.</span><span class="na">frame</span><span class="o">()</span>
        <span class="o">.</span><span class="na">where</span><span class="o">(</span><span class="s">&quot;name&quot;</span><span class="o">,</span> <span class="k">this</span><span class="o">.</span><span class="na">name</span><span class="o">)</span>
        <span class="o">.</span><span class="na">iterator</span><span class="o">()</span>
        <span class="o">.</span><span class="na">next</span><span class="o">()</span>
        <span class="o">.</span><span class="na">get</span><span class="o">(</span><span class="s">&quot;salary&quot;</span><span class="o">)</span>
        <span class="o">.</span><span class="na">getN</span><span class="o">()</span>
    <span class="o">);</span>
  <span class="o">}</span>
<span class="o">}</span></code></pre></figure><p>You can imagine how difficult it will be to unit test this class, using Mockito, for example. First, we have to mock the <code>Region</code> interface. Then, we have to mock a <code>Table</code> interface and make sure it is returned by the <code>table()</code> method. Then, we have to mock a <code>Frame</code> interface, etc.</p><aside class='youtube'> <a href='https://www.youtube.com/watch?v=l6MpCBzwDbg'><div class='box'> <img src='https://i.ytimg.com/vi/l6MpCBzwDbg/mqdefault.jpg' alt='YouTube video #l6MpCBzwDbg'/><div class='play'><i class='icon icon-play'></i></div></div></a><div>What Fake Objects Are For? (webinar #8); 4 November 2015.</div></aside><p>The unit test will be much longer than the class itself. Besides that, its real purpose, which is to test the retrieval of an employee&#39;s salary, will not be obvious to the reader.</p><p>Moreover, when we need to test a similar method of a similar class, we will need to restart this mocking from scratch. Again, multiple lines of code, which will look very similar to what we have already written.</p><h2 id="fake-classes">Fake Classes</h2><p>The solution is to create fake classes and ship them together with real classes. This is what <a href="http://dynamo.jcabi.com">jcabi-dynamo</a> is doing. Just look at its <a href="http://dynamo.jcabi.com/apidocs-0.16.1/index.html">JavaDoc</a>. There is a package called <code>com.jcabi.dynamo.mock</code> that contains only fake classes, suitable only for unit testing.</p><p>Even though their sole purpose is to optimize unit testing, we <a href="/2014/08/19/how-to-release-to-maven-central.html">ship them</a> together with production code, in the same JAR package.</p><p>This is what a test will look like, when a fake class <code>MkRegion</code> is used:</p><figure class="highlight"><pre><code class="language-java" data-lang="java"><span></span><span class="kd">public</span> <span class="kd">class</span> <span class="nc">EmployeeTest</span> <span class="o">{</span>
  <span class="kd">public</span> <span class="kt">void</span> <span class="nf">canFetchSalaryFromDynamoDb</span><span class="o">()</span> <span class="o">{</span>
    <span class="n">Region</span> <span class="n">region</span> <span class="o">=</span> <span class="k">new</span> <span class="n">MkRegion</span><span class="o">(</span>
      <span class="k">new</span> <span class="n">H2Data</span><span class="o">().</span><span class="na">with</span><span class="o">(</span>
        <span class="s">&quot;employees&quot;</span><span class="o">,</span> <span class="k">new</span> <span class="n">String</span><span class="o">[]</span> <span class="o">{</span><span class="s">&quot;name&quot;</span><span class="o">},</span>
        <span class="k">new</span> <span class="n">String</span><span class="o">[]</span> <span class="o">{</span><span class="s">&quot;salary&quot;</span><span class="o">}</span>
      <span class="o">)</span>
    <span class="o">);</span>
    <span class="n">region</span><span class="o">.</span><span class="na">table</span><span class="o">(</span><span class="s">&quot;employees&quot;</span><span class="o">).</span><span class="na">put</span><span class="o">(</span>
      <span class="k">new</span> <span class="n">Attributes</span><span class="o">()</span>
        <span class="o">.</span><span class="na">with</span><span class="o">(</span><span class="s">&quot;name&quot;</span><span class="o">,</span> <span class="s">&quot;Jeff&quot;</span><span class="o">)</span>
        <span class="o">.</span><span class="na">with</span><span class="o">(</span><span class="s">&quot;salary&quot;</span><span class="o">,</span> <span class="k">new</span> <span class="n">AttributeValue</span><span class="o">().</span><span class="na">withN</span><span class="o">(</span><span class="mi">50000</span><span class="o">))</span>
    <span class="o">);</span>
    <span class="n">Employee</span> <span class="n">emp</span> <span class="o">=</span> <span class="k">new</span> <span class="n">Employee</span><span class="o">(</span><span class="s">&quot;Jeff&quot;</span><span class="o">,</span> <span class="n">region</span><span class="o">);</span>
    <span class="n">assertThat</span><span class="o">(</span><span class="n">emp</span><span class="o">.</span><span class="na">salary</span><span class="o">(),</span> <span class="n">equalTo</span><span class="o">(</span><span class="mi">50000</span><span class="o">));</span>
  <span class="o">}</span>
<span class="o">}</span></code></pre></figure><p>This test looks obvious to me. First, we create a fake DynamoDB region, which works on top of <code>H2Data</code> storage (in-memory H2 database). The storage will be ready for a single <code>employees</code> table with a hash key <code>name</code> and a single <code>salary</code> attribute.</p><aside class='youtube'> <a href='https://www.youtube.com/watch?v=EDKbYVEInMU'><div class='box'> <img src='https://i.ytimg.com/vi/EDKbYVEInMU/mqdefault.jpg' alt='YouTube video #EDKbYVEInMU'/><div class='play'><i class='icon icon-play'></i></div></div></a><div>Built-in Fake Objects; 10 November 2016.</div></aside><p>Then, we put a record into the table, with a hash <code>Jeff</code> and a salary <code>50000</code>.</p><p>Finally, we create an instance of class <code>Employee</code> and check how it fetches the salary from DynamoDB.</p><p>I&#39;m currently doing the same thing in almost every open source library I&#39;m working with. I&#39;m creating a collection of fake classes, that simplify testing inside the library and for its users.</p><p>BTW, a great article on the same subject: <a href="http://nedbatchelder.com/blog/201206/tldw_stop_mocking_start_testing.html">tl;dw: Stop mocking, start testing</a> by Ned Batchelder.</p><p>PS. Check this out, on a very similar subject: <a href="/2014/04/18/jcabi-http-server-mocking.html">Mocking of HTTP Server in Java</a>.</p></div></article></div><div class="wrapper"> <related-posts /></div><div class="disqus" role="complementary"><p class="disqus_hint"> Please, use <a href="https://help.disqus.com/commenting/what-html-tags-are-allowed-within-comments">syntax highlighting</a> in your comments, to make them more readable.</p><div id="disqus_thread" class="disqus-thread"> <a>&nbsp;</a></div><script> var disqus_config = function () { this.page.url = document.location.href.split('?')[0].split('#')[0].replace('https://', 'http://'); this.page.identifier = this.page.url; }; (function() { var d = document, s = d.createElement('script'); s.src = '//yegor256.disqus.com/embed.js'; s.setAttribute('data-timestamp', +new Date()); (d.head || d.body).appendChild(s); })(); </script> <noscript><div><p class="red"> JavaScript is disabled in your browser, that's why you can't see comments under this post.</p></div></noscript></div><div class="wrapper"> <footer class="footer"><p> &copy; <span itemscope="" itemprop="copyrightHolder" itemtype="http://schema.org/Person"> <span itemprop="name">Yegor Bugayenko</span> </span> 2014&ndash;<span itemprop="copyrightYear">2018</span></p></footer></div></section><div class="wrapper unprintable" style="text-align:center;margin-top:2em;"> <a href="http://www.sixnines.io/h/3ba1652f"> <img src="//www.sixnines.io/b/3ba1652f?style=flat" alt="sixnines availability badge"/> </a></div><script src="//code.jquery.com/jquery-1.9.0.min.js"></script> <script src="/js/all.js?4e047f6f42b"></script> <script>var disqus_shortname = 'yegor256';</script> <script id="dsq-count-scr" src="//yegor256.disqus.com/count.js" async="async"></script> <script> (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){ (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o), m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m) })(window,document,'script','//www.google-analytics.com/analytics.js','ga'); ga('create', 'UA-1963507-32', 'auto'); ga('send', 'pageview'); </script> <script> Cd=document;Cr="&"+Math.random();Cp="&s=1"; Cd.cookie="b=b";if(Cd.cookie)Cp+="&c=1"; Cp+="&t="+(new Date()).getTimezoneOffset(); if(self!=top)Cp+="&f=1"; </script> <script> if(navigator.javaEnabled())Cp+="&j=1"; </script> <script> if(typeof(screen)!='undefined')Cp+="&w="+screen.width+"&h="+ screen.height+"&d="+(screen.colorDepth?screen.colorDepth:screen.pixelDepth); </script> <script> Cd.write("<img src='//c.hit.ua/hit?i=95870&g=0&x=2"+Cp+Cr+ "&r="+escape(Cd.referrer)+"&u="+escape(window.location.href)+ "' border='0' wi"+"dth='1' he"+"ight='1'/>"); </script> <script type="application/ld+json"> { "@context": "http://schema.org", "@type": "Person", "name": "Yegor Bugayenko", "url": "http://www.yegor256.com", "sameAs": [ "https://www.facebook.com/yegor256", "https://instagram.com/yegor256", "https://www.linkedin.com/in/yegor256", "https://twitter.com/yegor256", "https://github.com/yegor256", "https://www.pinterest.com/yegor256/" ] } </script> </body> </html> <!DOCTYPE html> <html xmlns="http://www.w3.org/1999/xhtml" lang="en-US" xml:lang="en-US" itemscope="" itemtype="http://schema.org/WebSite"> <head> <meta charset="utf-8"/> <meta name="description" content="This tutorial explains how a Java project can be deployed to Heroku in just one click and zero maintenance efforts, using Rultor.com, DevOps assistant " /> <meta name="keywords" content="deploy java app to heroku, fast release to heroku, heroku java release, how to deploy to heroku, how to release to heroku, release to heroku" /> <meta name="viewport" content="width=device-width,minimum-scale=1,initial-scale=1"/> <meta name="google-site-verification" content="JEj_gQr2CPe2QKGw8XdMz0R7VboQIUbX3FlM-lwTq-8" /> <meta name="author" content="Yegor Bugayenko"> <meta name="article:published_time" content="2014-09-13 00:00:00 +0000"> <meta name="og:site_name" content="Yegor Bugayenko"/> <meta name="og:type" content="article" /> <meta name="og:locale" content="en_US" /> <meta name="twitter:account_id" content="4503599630178231" /> <meta name="twitter:creator" content="@yegor256"/> <meta name="twitter:site" content="@yegor256"/> <meta name="twitter:title" property="og:title" content="Deploying to Heroku, in One Click"/> <meta name="twitter:description" property="og:description" content="This tutorial explains how a Java project can be deployed to Heroku in just one click and zero maintenance efforts, using Rultor.com, DevOps assistant "/> <meta name="twitter:url" property="og:url" content="https://www.yegor256.com/2014/09/13/deploying-to-heroku.html"/> <meta name="telegram:channel" content="AAAAAEJFMRzsRTRxM3ec6A"/> <link rel="search" type="application/opensearchdescription+xml" href="/opensearch.xml" title="yegor256" /> <link rel="shortcut icon" href="/favicon.ico?4e047f6f42b"/> <link rel="apple-touch-icon" href="/favicon.ico?4e047f6f42b"/> <link rel="alternate" type="application/rss+xml" title="RSS for yegor256.com" href="https://www.yegor256.com/rss.xml"/> <link rel="stylesheet" href="/css/layout.css?4e047f6f42b"/> <link rel="stylesheet" href="/css/icons.css?4e047f6f42b"/> <link rel="canonical" href="https://www.yegor256.com/2014/09/13/deploying-to-heroku.html" /> <link rel="amphtml" href="https://www.yegor256.com/2014/09/13/deploying-to-heroku.amp.html" /> <title>Deploying to Heroku, in One Click </title> </head> <body><div class="wrapper"> <aside class="header-toggle unprintable" id="header-toggle" title="Show the menu" onclick="$('#header').show();$('#header-toggle').hide();">&#9776;</aside> <header class="header" id="header"><div class="face"> <a href="/about-me.html#form" class="sub" title="Click to subscribe to my monthly newsletter"><span>Subscribe</span></a> <a href="/about-me.html" style="position:relative;"> <img src="/images/face-256x256.jpg" class="photo" alt="Yegor Bugayenko"/> </a></div><nav><ul class="menu social notranslate"> <li><a href="https://twitter.com/intent/follow?screen_name=yegor256" rel="nofollow" title="Follow me on Twitter"><i class="icon icon-twitter notranslate" aria-hidden="true"></i></a></li> <li><a href="/rss.xml" rel="nofollow" title="Subscribe to my RSS feed"><i class="icon icon-rss notranslate" aria-hidden="true"></i></a></li> <li><a itemprop="sameAs" href="https://github.com/yegor256" rel="nofollow" title="My GitHub profile"><i class="icon icon-github notranslate" aria-hidden="true"></i></a></li> <li><a itemprop="sameAs" href="http://stackoverflow.com/users/187141/yegor256" rel="nofollow" title="My StackOverflow profile"><i class="icon icon-stackoverflow notranslate" aria-hidden="true"></i></a></li> <li><a itemprop="sameAs" href="https://www.facebook.com/yegor256" rel="nofollow" title="Follow me on Facebook"><i class="icon icon-facebook notranslate" aria-hidden="true"></i></a></li> <li><a itemprop="sameAs" href="https://instagram.com/yegor256" rel="nofollow" title="Follow me on Instagram"><i class="icon icon-instagram notranslate" aria-hidden="true"></i></a></li> <li><a itemprop="sameAs" href="https://www.linkedin.com/in/yegor256" rel="nofollow" title="My LinkedIn profile"><i class="icon icon-linkedin notranslate" aria-hidden="true"></i></a></li> <li><a itemprop="sameAs" href="https://www.youtube.com/c/yegor256?sub_confirmation=1" rel="nofollow" title="My Youtube video channel"><i class="icon icon-youtube notranslate" aria-hidden="true"></i></a></li> <li><a itemprop="sameAs" href="https://www.pinterest.com/yegor256/" rel="nofollow" title="My Pinterest boards"><i class="icon icon-pinterest notranslate" aria-hidden="true"></i></a></li> <li><a itemprop="sameAs" href="https://angel.co/yegor256" rel="nofollow" title="My AngelList profile"><i class="icon icon-angellist notranslate" aria-hidden="true"></i></a></li> <li><a href="https://soundcloud.com/yegor256" rel="nofollow" title="My podcast"><i class="icon icon-podcast notranslate" aria-hidden="true"></i></a></li> <li><a href="https://itunes.apple.com/us/podcast/yegor256-podcast/id1150826721" rel="nofollow" title="My iTunes podcast"><i class="icon icon-itunes notranslate" aria-hidden="true"></i></a></li> <li><a href="https://t.me/joinchat/AAAAAEJFMRzsRTRxM3ec6A" rel="nofollow" title="My Telegram public channel"><i class="icon icon-telegram notranslate" aria-hidden="true"></i></a></li> <li><a href="mailto:blog@yegor256.com" rel="nofollow" title="Email me any time"><i class="icon icon-mail notranslate" aria-hidden="true"></i></a></li></ul><ul class="menu"> <li><a href="/" title="Home page">Home</a></li> <li ><a href="/best.html" title="Best articles to read">12&#160;Best</a></li> <li ><a href="/contents.html" title="The contents of the entire blog">All&#160;288</a></li> <li ><a href="/webinars.html" title="My webinars">Webinars</a></li> <li ><a href="/talks.html" title="Future and past conference talks">Talks</a></li> <li ><a href="/books.html" title="The books I wrote">Books</a></li> <li ><a href="/papers.html" title="My academic papers and patents">Papers</a></li> <li ><a href="/pets.html" title="My loved pet projects">Pets</a></li> <li ><a href="/award.html" title="Software quality award">Award</a></li> <li ><a href="/testimonials.html" title="What some people say about me">Testimonials</a></li> <li ><a href="/shift-m.html" title="Audio podcast about project management">Shift-M</a></li> <li ><a href="/paintings.html" title="My paintings for sale">Paintings</a></li> <li><a href="http://ru.yegor256.com/" title="Немного на русском языке">По-русски</a></li></ul></nav><div class="search"> <form method="get" action="https://www.google.com/search" itemprop="potentialAction" itemscope="" itemtype="http://schema.org/SearchAction"> <meta itemprop="target" content="https://www.google.com/search?q={q}"/> <input name="sitesearch" value="yegor256.com" type="hidden"/> <input itemprop="query-input" type="text" id="search-query" class="field field-text" required="required" onfocus="$('.google').css('visibility', 'visible');" name="q" placeholder="Search..." autocomplete="off"/> <input type="image" src="/images/google-search-icon.svg" class="google" title="Search via Google" alt="Search via Google"/> </form></div><div class="hot"><ul> <li> <a href="/code-ahead.html">Code Ahead</a> was published on Amazon just a few days ago! It is my new book, a novel about programmers. It explains in details the majority of ideas that stand behind <a href="https://www.zerocracy.com">Zerocracy</a> and <a href="https://www.xdsd.org">XDSD</a>. </li> <li> At <a href="/webinars.html">Webinar #37</a> we will discuss naming problem in OOP, for objects, methods and attributes; join us on <b>September 12</b>, at 11am PST. </li></ul></div></header></div><section itemscope="" itemtype="http://schema.org/BlogPosting"><div class="wrapper"> <header><p class="printable"> <img src="https://api.qrserver.com/v1/create-qr-code/?data=https://www.yegor256.com/2014/09/13/deploying-to-heroku.html&amp;format=svg" style="width:125px;height:125px;" alt="QR code"/></p><p class="printable"> <code itemprop="url">https://www.yegor256.com/2014/09/13/deploying-to-heroku.html</code></p><h1 itemprop="name headline mainEntityOfPage">Deploying to Heroku, in One Click</h1><ul class="subline"> <li> <time itemprop="datePublished" datetime="2014-09-13T00:00:00+00:00"> 13 September 2014 </time> </li> <li class="printable" itemscope="" itemprop="author" itemtype="http://schema.org/Person"> <span itemprop="name">Yegor Bugayenko</span> </li> <li class="unprintable"> <i class="icon icon-comments"></i> <a href="http://www.yegor256.com/2014/09/13/deploying-to-heroku.html#disqus_thread" itemprop="discussionUrl">comments</a> </li></ul><h2 id="create-heroku-project">Create Heroku Project</h2><p>Create a new project at <a href="http://www.heroku.com">Heroku.com</a>.</p><p>Then install their <a href="https://toolbelt.heroku.com/">command line tool-belt</a>.</p><h2 id="authenticate-at-heroku">Authenticate at Heroku</h2><p>You should authenticate your public SSH key at Heroku, using their command line tool-belt. The process is explained <a href="https://devcenter.heroku.com/articles/authentication">here</a>, but it is not much of a process. You just run <code>heroku login</code> and enter your login credentials. As a result, you will get your existing key (located at <code>~/.ssh/id_rsa.pub</code>) authenticated by Heroku.</p><p>If you didn&#39;t have the key before, it will be created automatically.</p><h2 id="encrypt-ssh-key">Encrypt SSH Key</h2><p>Now, encrypt <code>id_rsa</code> and <code>id_rsa.pub</code> (they are in the <code>~/.ssh</code> directory) with a <a href="https://github.com/yegor256/rultor-remote">rultor remote</a>:</p><figure class="highlight"><pre><code class="language-xml" data-lang="xml"><span></span>$ gem install rultor
$ rultor encrypt -p me/test id_rsa
$ rultor encrypt -p me/test id_rsa.pub</code></pre></figure><p>Instead of <code>me/test</code> use the name of your GitHub project.</p><p>You will get two new files <code>id_rsa.asc</code> and <code>id_rsa.pub.asc</code>. Add them to the root directory of your project, commit and push. These files contain your secret information, but only the Rultor server can decrypt them.</p><h2 id="create-rultor-configuration">Create Rultor Configuration</h2><p>Create a <code>.rultor.yml</code> file in the root directory of your project (<a href="http://doc.rultor.com/reference.html">reference page</a> explains this format in detail):</p><figure class="highlight"><pre><code class="language-text" data-lang="text"><span></span>decrypt:
  id_rsa: &quot;repo/id_rsa.asc&quot;
  id_rsa.pub: &quot;repo/id_rsa.pub.asc&quot;
release:
  script: |
    mvn versions:set &quot;-DnewVersion=${tag}&quot;
    git commit -am &quot;${tag}&quot;
    mvn clean install -Pqulice --errors
    git remote add heroku git@heroku.com:aintshy.git
    mkdir ~/.ssh
    mv ../id_rsa ../id_rsa.pub ~/.ssh
    chmod -R 600 ~/.ssh/*
    echo -e \
      &quot;Host *\n  StrictHostKeyChecking no\n  UserKnownHostsFile=/dev/null&quot; \
      &gt; ~/.ssh/config
    git push -f heroku $(git symbolic-ref --short HEAD):master</code></pre></figure><p>You can compare your file with live Rultor <a href="https://github.com/aintshy/hub/blob/master/.rultor.yml">configuration of aintshy/hub</a>.</p><h2 id="run-it">Run It!</h2><figure class='badge'><a href='http://www.rultor.com'><img src='http://doc.rultor.com/images/logo.svg' style='width:100px;max-width:100%;' alt='badge'/></a></figure><p>Now it&#39;s time to see how it all works. Create a new ticket in the GitHub issue tracker, and post something like this into it (read more about <a href="http://doc.rultor.com/basics.html">Rultor commands</a>):</p><figure class="highlight"><pre><code class="language-text" data-lang="text"><span></span>@rultor release, tag is `0.1`</code></pre></figure><p>You will get a response in a few seconds. The rest will be done by Rultor.</p><p>Enjoy :)</p><p>BTW, if something doesn&#39;t work as I&#39;ve explained, don&#39;t hesitate to submit a ticket to the <a href="https://github.com/yegor256/rultor/issues">Rultor issue tracker</a>. I will try to help you.</p><p>PS. I would also recommend to versionalize artifacts through <code>MANIFEST.MF</code> and use <a href="/2014/07/03/how-to-read-manifest-mf.html">jcabi-manifests</a> to read them later.</p></p>--> <nav class="buttons notranslate desktop-only"> <a href="http://www.facebook.com/sharer/sharer.php?u=https://www.yegor256.com/2014/09/13/deploying-to-heroku.html" title="Share on Facebook" class="button" rel="nofollow"> <span class="count count-facebook">0</span> <i class="icon icon-facebook notranslate" aria-hidden="true"></i> </a> <a href="https://twitter.com/share?url=https://www.yegor256.com/2014/09/13/deploying-to-heroku.html&amp;text=Deploying+to+Heroku%2C+in+One+Click" title="Share on Twitter" class="button" rel="nofollow"> <span class="count count-twitter">0</span> <i class="icon icon-twitter notranslate" aria-hidden="true"></i> </a> <a href="https://plus.google.com/share?url=https://www.yegor256.com/2014/09/13/deploying-to-heroku.html" title="Share on Google+" class="button" rel="nofollow"> <span class="count count-googleplus">0</span> <i class="icon icon-googleplus notranslate" aria-hidden="true"></i> </a> <a href="https://www.linkedin.com/cws/share?url=https://www.yegor256.com/2014/09/13/deploying-to-heroku.html" title="Share on LinkedIn" class="button" rel="nofollow"> <span class="count count-linkedin">0</span> <i class="icon icon-linkedin notranslate" aria-hidden="true"></i> </a> <a href="http://reddit.com/submit?url=https://www.yegor256.com/2014/09/13/deploying-to-heroku.html%3F2014-36&amp;title=Deploying+to+Heroku%2C+in+One+Click" title="Share on Reddit" class="button" rel="nofollow"> <span class="count count-reddit">0</span> <i class="icon icon-reddit notranslate" aria-hidden="true"></i> </a> <a href="http://news.ycombinator.com/submitlink?u=https://www.yegor256.com/2014/09/13/deploying-to-heroku.html%3F2014-36&amp;t=Deploying+to+Heroku%2C+in+One+Click" title="Share on Hacker News" class="button" rel="nofollow"> <span class="count count-hackernews">0</span> <i class="icon icon-hackernews notranslate" aria-hidden="true"></i> </a> </nav> </header> <article class="main" itemprop="articleBody"><div ><p>There were a few articles already about our usage of Rultor for automating continuous delivery cycles of Java and Ruby projects, including <a href="http://www.yegor256.com/2014/08/26/publish-to-rubygems.html">RubyGems</a>, <a href="http://www.yegor256.com/2014/08/25/deploy-to-cloudbees.html">CloudBees</a> and <a href="http://www.yegor256.com/2014/08/19/how-to-release-to-maven-central.html">Maven Central</a>.</p><p>This one describes how Heroku deployment can be automated. When I need to deploy a new version of an Aintshy web application, all I do is create one message in a GitHub ticket. I just say <code>@rultor release 0.1.4</code> and version 0.1.4 gets deployed to Heroku. See GitHub ticket <a href="https://github.com/aintshy/hub/issues/5">#5</a>.</p><p>You can do the same, with the help of <a href="http://www.rultor.com">Rultor.com</a>, a free hosted DevOps assistant.</p><h2 id="create-heroku-project">Create Heroku Project</h2><p>Create a new project at <a href="http://www.heroku.com">Heroku.com</a>.</p><p>Then install their <a href="https://toolbelt.heroku.com/">command line tool-belt</a>.</p><h2 id="authenticate-at-heroku">Authenticate at Heroku</h2><p>You should authenticate your public SSH key at Heroku, using their command line tool-belt. The process is explained <a href="https://devcenter.heroku.com/articles/authentication">here</a>, but it is not much of a process. You just run <code>heroku login</code> and enter your login credentials. As a result, you will get your existing key (located at <code>~/.ssh/id_rsa.pub</code>) authenticated by Heroku.</p><p>If you didn&#39;t have the key before, it will be created automatically.</p><h2 id="encrypt-ssh-key">Encrypt SSH Key</h2><p>Now, encrypt <code>id_rsa</code> and <code>id_rsa.pub</code> (they are in the <code>~/.ssh</code> directory) with a <a href="https://github.com/yegor256/rultor-remote">rultor remote</a>:</p><figure class="highlight"><pre><code class="language-xml" data-lang="xml"><span></span>$ gem install rultor
$ rultor encrypt -p me/test id_rsa
$ rultor encrypt -p me/test id_rsa.pub</code></pre></figure><p>Instead of <code>me/test</code> use the name of your GitHub project.</p><p>You will get two new files <code>id_rsa.asc</code> and <code>id_rsa.pub.asc</code>. Add them to the root directory of your project, commit and push. These files contain your secret information, but only the Rultor server can decrypt them.</p><h2 id="create-rultor-configuration">Create Rultor Configuration</h2><p>Create a <code>.rultor.yml</code> file in the root directory of your project (<a href="http://doc.rultor.com/reference.html">reference page</a> explains this format in detail):</p><figure class="highlight"><pre><code class="language-text" data-lang="text"><span></span>decrypt:
  id_rsa: &quot;repo/id_rsa.asc&quot;
  id_rsa.pub: &quot;repo/id_rsa.pub.asc&quot;
release:
  script: |
    mvn versions:set &quot;-DnewVersion=${tag}&quot;
    git commit -am &quot;${tag}&quot;
    mvn clean install -Pqulice --errors
    git remote add heroku git@heroku.com:aintshy.git
    mkdir ~/.ssh
    mv ../id_rsa ../id_rsa.pub ~/.ssh
    chmod -R 600 ~/.ssh/*
    echo -e \
      &quot;Host *\n  StrictHostKeyChecking no\n  UserKnownHostsFile=/dev/null&quot; \
      &gt; ~/.ssh/config
    git push -f heroku $(git symbolic-ref --short HEAD):master</code></pre></figure><p>You can compare your file with live Rultor <a href="https://github.com/aintshy/hub/blob/master/.rultor.yml">configuration of aintshy/hub</a>.</p><h2 id="run-it">Run It!</h2><figure class='badge'><a href='http://www.rultor.com'><img src='http://doc.rultor.com/images/logo.svg' style='width:100px;max-width:100%;' alt='badge'/></a></figure><p>Now it&#39;s time to see how it all works. Create a new ticket in the GitHub issue tracker, and post something like this into it (read more about <a href="http://doc.rultor.com/basics.html">Rultor commands</a>):</p><figure class="highlight"><pre><code class="language-text" data-lang="text"><span></span>@rultor release, tag is `0.1`</code></pre></figure><p>You will get a response in a few seconds. The rest will be done by Rultor.</p><p>Enjoy :)</p><p>BTW, if something doesn&#39;t work as I&#39;ve explained, don&#39;t hesitate to submit a ticket to the <a href="https://github.com/yegor256/rultor/issues">Rultor issue tracker</a>. I will try to help you.</p><p>PS. I would also recommend to versionalize artifacts through <code>MANIFEST.MF</code> and use <a href="/2014/07/03/how-to-read-manifest-mf.html">jcabi-manifests</a> to read them later.</p></div></article></div><div class="wrapper"> <related-posts /></div><div class="disqus" role="complementary"><p class="disqus_hint"> Please, use <a href="https://help.disqus.com/commenting/what-html-tags-are-allowed-within-comments">syntax highlighting</a> in your comments, to make them more readable.</p><div id="disqus_thread" class="disqus-thread"> <a>&nbsp;</a></div><script> var disqus_config = function () { this.page.url = document.location.href.split('?')[0].split('#')[0].replace('https://', 'http://'); this.page.identifier = this.page.url; }; (function() { var d = document, s = d.createElement('script'); s.src = '//yegor256.disqus.com/embed.js'; s.setAttribute('data-timestamp', +new Date()); (d.head || d.body).appendChild(s); })(); </script> <noscript><div><p class="red"> JavaScript is disabled in your browser, that's why you can't see comments under this post.</p></div></noscript></div><div class="wrapper"> <footer class="footer"><p> &copy; <span itemscope="" itemprop="copyrightHolder" itemtype="http://schema.org/Person"> <span itemprop="name">Yegor Bugayenko</span> </span> 2014&ndash;<span itemprop="copyrightYear">2018</span></p></footer></div></section><div class="wrapper unprintable" style="text-align:center;margin-top:2em;"> <a href="http://www.sixnines.io/h/3ba1652f"> <img src="//www.sixnines.io/b/3ba1652f?style=flat" alt="sixnines availability badge"/> </a></div><script src="//code.jquery.com/jquery-1.9.0.min.js"></script> <script src="/js/all.js?4e047f6f42b"></script> <script>var disqus_shortname = 'yegor256';</script> <script id="dsq-count-scr" src="//yegor256.disqus.com/count.js" async="async"></script> <script> (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){ (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o), m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m) })(window,document,'script','//www.google-analytics.com/analytics.js','ga'); ga('create', 'UA-1963507-32', 'auto'); ga('send', 'pageview'); </script> <script> Cd=document;Cr="&"+Math.random();Cp="&s=1"; Cd.cookie="b=b";if(Cd.cookie)Cp+="&c=1"; Cp+="&t="+(new Date()).getTimezoneOffset(); if(self!=top)Cp+="&f=1"; </script> <script> if(navigator.javaEnabled())Cp+="&j=1"; </script> <script> if(typeof(screen)!='undefined')Cp+="&w="+screen.width+"&h="+ screen.height+"&d="+(screen.colorDepth?screen.colorDepth:screen.pixelDepth); </script> <script> Cd.write("<img src='//c.hit.ua/hit?i=95870&g=0&x=2"+Cp+Cr+ "&r="+escape(Cd.referrer)+"&u="+escape(window.location.href)+ "' border='0' wi"+"dth='1' he"+"ight='1'/>"); </script> <script type="application/ld+json"> { "@context": "http://schema.org", "@type": "Person", "name": "Yegor Bugayenko", "url": "http://www.yegor256.com", "sameAs": [ "https://www.facebook.com/yegor256", "https://instagram.com/yegor256", "https://www.linkedin.com/in/yegor256", "https://twitter.com/yegor256", "https://github.com/yegor256", "https://www.pinterest.com/yegor256/" ] } </script> </body> </html> <!DOCTYPE html> <html xmlns="http://www.w3.org/1999/xhtml" lang="en-US" xml:lang="en-US" itemscope="" itemtype="http://schema.org/WebSite"> <head> <meta charset="utf-8"/> <meta name="description" content="jcabi-ssh is a simple Java SSH client that wraps jsch library and makes its usage more object-oriented and convenient " /> <meta name="keywords" content="java ssh, java ssh client, open source ssh for java, openssh for java, ssh libraries for java, ssh library for java, ssh tunneling for java" /> <meta name="viewport" content="width=device-width,minimum-scale=1,initial-scale=1"/> <meta name="google-site-verification" content="JEj_gQr2CPe2QKGw8XdMz0R7VboQIUbX3FlM-lwTq-8" /> <meta name="author" content="Yegor Bugayenko"> <meta name="article:published_time" content="2014-09-02 00:00:00 +0000"> <meta name="og:site_name" content="Yegor Bugayenko"/> <meta name="og:type" content="article" /> <meta name="og:locale" content="en_US" /> <meta name="twitter:account_id" content="4503599630178231" /> <meta name="twitter:creator" content="@yegor256"/> <meta name="twitter:site" content="@yegor256"/> <meta name="twitter:title" property="og:title" content="Simple Java SSH Client"/> <meta name="twitter:description" property="og:description" content="jcabi-ssh is a simple Java SSH client that wraps jsch library and makes its usage more object-oriented and convenient "/> <meta name="twitter:url" property="og:url" content="https://www.yegor256.com/2014/09/02/java-ssh-client.html"/> <meta name="telegram:channel" content="AAAAAEJFMRzsRTRxM3ec6A"/> <link rel="search" type="application/opensearchdescription+xml" href="/opensearch.xml" title="yegor256" /> <link rel="shortcut icon" href="/favicon.ico?4e047f6f42b"/> <link rel="apple-touch-icon" href="/favicon.ico?4e047f6f42b"/> <link rel="alternate" type="application/rss+xml" title="RSS for yegor256.com" href="https://www.yegor256.com/rss.xml"/> <link rel="stylesheet" href="/css/layout.css?4e047f6f42b"/> <link rel="stylesheet" href="/css/icons.css?4e047f6f42b"/> <link rel="canonical" href="https://www.yegor256.com/2014/09/02/java-ssh-client.html" /> <link rel="amphtml" href="https://www.yegor256.com/2014/09/02/java-ssh-client.amp.html" /> <title>Simple Java SSH Client </title> </head> <body><div class="wrapper"> <aside class="header-toggle unprintable" id="header-toggle" title="Show the menu" onclick="$('#header').show();$('#header-toggle').hide();">&#9776;</aside> <header class="header" id="header"><div class="face"> <a href="/about-me.html#form" class="sub" title="Click to subscribe to my monthly newsletter"><span>Subscribe</span></a> <a href="/about-me.html" style="position:relative;"> <img src="/images/face-256x256.jpg" class="photo" alt="Yegor Bugayenko"/> </a></div><nav><ul class="menu social notranslate"> <li><a href="https://twitter.com/intent/follow?screen_name=yegor256" rel="nofollow" title="Follow me on Twitter"><i class="icon icon-twitter notranslate" aria-hidden="true"></i></a></li> <li><a href="/rss.xml" rel="nofollow" title="Subscribe to my RSS feed"><i class="icon icon-rss notranslate" aria-hidden="true"></i></a></li> <li><a itemprop="sameAs" href="https://github.com/yegor256" rel="nofollow" title="My GitHub profile"><i class="icon icon-github notranslate" aria-hidden="true"></i></a></li> <li><a itemprop="sameAs" href="http://stackoverflow.com/users/187141/yegor256" rel="nofollow" title="My StackOverflow profile"><i class="icon icon-stackoverflow notranslate" aria-hidden="true"></i></a></li> <li><a itemprop="sameAs" href="https://www.facebook.com/yegor256" rel="nofollow" title="Follow me on Facebook"><i class="icon icon-facebook notranslate" aria-hidden="true"></i></a></li> <li><a itemprop="sameAs" href="https://instagram.com/yegor256" rel="nofollow" title="Follow me on Instagram"><i class="icon icon-instagram notranslate" aria-hidden="true"></i></a></li> <li><a itemprop="sameAs" href="https://www.linkedin.com/in/yegor256" rel="nofollow" title="My LinkedIn profile"><i class="icon icon-linkedin notranslate" aria-hidden="true"></i></a></li> <li><a itemprop="sameAs" href="https://www.youtube.com/c/yegor256?sub_confirmation=1" rel="nofollow" title="My Youtube video channel"><i class="icon icon-youtube notranslate" aria-hidden="true"></i></a></li> <li><a itemprop="sameAs" href="https://www.pinterest.com/yegor256/" rel="nofollow" title="My Pinterest boards"><i class="icon icon-pinterest notranslate" aria-hidden="true"></i></a></li> <li><a itemprop="sameAs" href="https://angel.co/yegor256" rel="nofollow" title="My AngelList profile"><i class="icon icon-angellist notranslate" aria-hidden="true"></i></a></li> <li><a href="https://soundcloud.com/yegor256" rel="nofollow" title="My podcast"><i class="icon icon-podcast notranslate" aria-hidden="true"></i></a></li> <li><a href="https://itunes.apple.com/us/podcast/yegor256-podcast/id1150826721" rel="nofollow" title="My iTunes podcast"><i class="icon icon-itunes notranslate" aria-hidden="true"></i></a></li> <li><a href="https://t.me/joinchat/AAAAAEJFMRzsRTRxM3ec6A" rel="nofollow" title="My Telegram public channel"><i class="icon icon-telegram notranslate" aria-hidden="true"></i></a></li> <li><a href="mailto:blog@yegor256.com" rel="nofollow" title="Email me any time"><i class="icon icon-mail notranslate" aria-hidden="true"></i></a></li></ul><ul class="menu"> <li><a href="/" title="Home page">Home</a></li> <li ><a href="/best.html" title="Best articles to read">12&#160;Best</a></li> <li ><a href="/contents.html" title="The contents of the entire blog">All&#160;288</a></li> <li ><a href="/webinars.html" title="My webinars">Webinars</a></li> <li ><a href="/talks.html" title="Future and past conference talks">Talks</a></li> <li ><a href="/books.html" title="The books I wrote">Books</a></li> <li ><a href="/papers.html" title="My academic papers and patents">Papers</a></li> <li ><a href="/pets.html" title="My loved pet projects">Pets</a></li> <li ><a href="/award.html" title="Software quality award">Award</a></li> <li ><a href="/testimonials.html" title="What some people say about me">Testimonials</a></li> <li ><a href="/shift-m.html" title="Audio podcast about project management">Shift-M</a></li> <li ><a href="/paintings.html" title="My paintings for sale">Paintings</a></li> <li><a href="http://ru.yegor256.com/" title="Немного на русском языке">По-русски</a></li></ul></nav><div class="search"> <form method="get" action="https://www.google.com/search" itemprop="potentialAction" itemscope="" itemtype="http://schema.org/SearchAction"> <meta itemprop="target" content="https://www.google.com/search?q={q}"/> <input name="sitesearch" value="yegor256.com" type="hidden"/> <input itemprop="query-input" type="text" id="search-query" class="field field-text" required="required" onfocus="$('.google').css('visibility', 'visible');" name="q" placeholder="Search..." autocomplete="off"/> <input type="image" src="/images/google-search-icon.svg" class="google" title="Search via Google" alt="Search via Google"/> </form></div><div class="hot"><ul> <li> <a href="/code-ahead.html">Code Ahead</a> was published on Amazon just a few days ago! It is my new book, a novel about programmers. It explains in details the majority of ideas that stand behind <a href="https://www.zerocracy.com">Zerocracy</a> and <a href="https://www.xdsd.org">XDSD</a>. </li> <li> At <a href="/webinars.html">Webinar #37</a> we will discuss naming problem in OOP, for objects, methods and attributes; join us on <b>September 12</b>, at 11am PST. </li></ul></div></header></div><section itemscope="" itemtype="http://schema.org/BlogPosting"><div class="wrapper"> <header><p class="printable"> <img src="https://api.qrserver.com/v1/create-qr-code/?data=https://www.yegor256.com/2014/09/02/java-ssh-client.html&amp;format=svg" style="width:125px;height:125px;" alt="QR code"/></p><p class="printable"> <code itemprop="url">https://www.yegor256.com/2014/09/02/java-ssh-client.html</code></p><h1 itemprop="name headline mainEntityOfPage">Simple Java SSH Client</h1><ul class="subline"> <li> <time itemprop="datePublished" datetime="2014-09-02T00:00:00+00:00"> 2 September 2014 </time> </li> <li class="printable" itemscope="" itemprop="author" itemtype="http://schema.org/Person"> <span itemprop="name">Yegor Bugayenko</span> </li> <li class="unprintable"> <i class="icon icon-comments"></i> <a href="http://www.yegor256.com/2014/09/02/java-ssh-client.html#disqus_thread" itemprop="discussionUrl">comments</a> </li></ul><p>Here is a more complex scenario, where I upload a file via SSH and then read back its grepped content:</p><figure class="highlight"><pre><code class="language-xml" data-lang="xml"><span></span>Shell shell = new SSH(
  &quot;ssh.example.com&quot;, 22,
  &quot;yegor&quot;, &quot;-----BEGIN RSA PRIVATE KEY-----...&quot;
);
File file = new File(&quot;/tmp/data.txt&quot;);
new Shell.Safe(shell).exec(
  &quot;cat &gt; d.txt <span class="err">&amp;&amp;</span> grep &#39;some text&#39; d.txt&quot;,
  new FileInputStream(file),
  Logger.stream(Level.INFO, this),
  Logger.stream(Level.WARNING, this)
);</code></pre></figure><p>Class <code>SSH</code>, which implements interface <code>Shell</code>, has only one method, <code>exec</code>. This method accepts four arguments:</p><figure class="highlight"><pre><code class="language-xml" data-lang="xml"><span></span>interface Shell {
  int exec(
    String cmd, InputStream stdin,
    OutputStream stdout, OutputStream stderr
  );
}</code></pre></figure><p>I think it&#39;s obvious what these arguments are about.</p><p>There are also a few convenient decorators that make it easier to operate with simple commands.</p><h2 id="shell-safe">Shell.Safe</h2><p><code>Shell.Safe</code> <a href="/2017/01/31/decorating-envelopes.html">decorates</a> an instance of <code>Shell</code> and <a href="/2015/12/01/rethrow-exceptions.html">throws</a> an exception if the <code>exec</code> exit code is not equal to zero. This may be very useful when you want to make sure that your command executed successfully, but don&#39;t want to duplicate <code>if/throw</code> in many places of your code.</p><figure class="highlight"><pre><code class="language-xml" data-lang="xml"><span></span>Shell ssh = new Shell.Safe(
  new SSH(
    &quot;ssh.example.com&quot;, 22,
    &quot;yegor&quot;, &quot;-----BEGIN RSA PRIVATE KEY-----...&quot;
  )
);</code></pre></figure><h2 id="shell-verbose">Shell.Verbose</h2><p><code>Shell.Verbose</code> decorates an instance of <code>Shell</code> and copies <code>stdout</code> and <code>stderr</code> to the slf4j logging facility (using <a href="http://log.jcabi.com"><code>jcabi-log</code></a>). Of course, you can combine decorators, for example:</p><figure class="highlight"><pre><code class="language-xml" data-lang="xml"><span></span>Shell ssh = new Shell.Verbose(
  new Shell.Safe(
    new SSH(
      &quot;ssh.example.com&quot;, 22,
      &quot;yegor&quot;, &quot;-----BEGIN RSA PRIVATE KEY-----...&quot;
    )
  )
);</code></pre></figure><h2 id="shell-plain">Shell.Plain</h2><p><code>Shell.Plain</code> is a wrapper of <code>Shell</code> that introduces a new <code>exec</code> method with only one argument, a command to execute. It also doesn&#39;t return an exit code, but <code>stdout</code> instead. This should be very convenient when you want to execute a simple command and just get its output (I&#39;m combining it with <code>Shell.Safe</code> for safety):</p><figure class="highlight"><pre><code class="language-xml" data-lang="xml"><span></span>String login = new Shell.Plain(new Shell.Safe(ssh)).exec(&quot;whoami&quot;);</code></pre></figure><h2 id="download">Download</h2><p>You need a single dependency <a href="http://repo1.maven.org/maven2/com/jcabi/jcabi-ssh"><code>jcabi-ssh.jar</code></a> in your Maven project (get its latest version in <a href="http://search.maven.org/">Maven Central</a>):</p><figure class="highlight"><pre><code class="language-xml" data-lang="xml"><span></span><span class="nt">&lt;dependency&gt;</span>
  <span class="nt">&lt;groupId&gt;</span>com.jcabi<span class="nt">&lt;/groupId&gt;</span>
  <span class="nt">&lt;artifactId&gt;</span>jcabi-ssh<span class="nt">&lt;/artifactId&gt;</span>
<span class="nt">&lt;/dependency&gt;</span></code></pre></figure><p>The project is in <a href="https://github.com/jcabi/jcabi-ssh">GitHub</a>. If you have any problems, just submit an issue. I&#39;ll try to help.</p></p>--> <nav class="buttons notranslate desktop-only"> <a href="http://www.facebook.com/sharer/sharer.php?u=https://www.yegor256.com/2014/09/02/java-ssh-client.html" title="Share on Facebook" class="button" rel="nofollow"> <span class="count count-facebook">0</span> <i class="icon icon-facebook notranslate" aria-hidden="true"></i> </a> <a href="https://twitter.com/share?url=https://www.yegor256.com/2014/09/02/java-ssh-client.html&amp;text=Simple+Java+SSH+Client" title="Share on Twitter" class="button" rel="nofollow"> <span class="count count-twitter">0</span> <i class="icon icon-twitter notranslate" aria-hidden="true"></i> </a> <a href="https://plus.google.com/share?url=https://www.yegor256.com/2014/09/02/java-ssh-client.html" title="Share on Google+" class="button" rel="nofollow"> <span class="count count-googleplus">0</span> <i class="icon icon-googleplus notranslate" aria-hidden="true"></i> </a> <a href="https://www.linkedin.com/cws/share?url=https://www.yegor256.com/2014/09/02/java-ssh-client.html" title="Share on LinkedIn" class="button" rel="nofollow"> <span class="count count-linkedin">0</span> <i class="icon icon-linkedin notranslate" aria-hidden="true"></i> </a> <a href="http://reddit.com/submit?url=https://www.yegor256.com/2014/09/02/java-ssh-client.html%3F2014-35&amp;title=Simple+Java+SSH+Client" title="Share on Reddit" class="button" rel="nofollow"> <span class="count count-reddit">0</span> <i class="icon icon-reddit notranslate" aria-hidden="true"></i> </a> <a href="http://news.ycombinator.com/submitlink?u=https://www.yegor256.com/2014/09/02/java-ssh-client.html%3F2014-35&amp;t=Simple+Java+SSH+Client" title="Share on Hacker News" class="button" rel="nofollow"> <span class="count count-hackernews">0</span> <i class="icon icon-hackernews notranslate" aria-hidden="true"></i> </a> </nav> </header> <article class="main" itemprop="articleBody"><div ><p>An execution of a shell command via SSH can be done in Java, in just a few lines, using <a href="http://ssh.jcabi.com"><code>jcabi-ssh</code></a>:</p><figure class="highlight"><pre><code class="language-java" data-lang="java"><span></span><span class="n">String</span> <span class="n">hello</span> <span class="o">=</span> <span class="k">new</span> <span class="n">Shell</span><span class="o">.</span><span class="na">Plain</span><span class="o">(</span>
  <span class="k">new</span> <span class="n">SSH</span><span class="o">(</span>
    <span class="s">&quot;ssh.example.com&quot;</span><span class="o">,</span> <span class="mi">22</span><span class="o">,</span>
    <span class="s">&quot;yegor&quot;</span><span class="o">,</span> <span class="s">&quot;-----BEGIN RSA PRIVATE KEY-----...&quot;</span>
  <span class="o">)</span>
<span class="o">).</span><span class="na">exec</span><span class="o">(</span><span class="s">&quot;echo &#39;Hello, world!&#39;&quot;</span><span class="o">);</span></code></pre></figure><p><a href="http://ssh.jcabi.com"><code>jcabi-ssh</code></a> is a convenient wrapper of <a href="http://www.jcraft.com/jsch/"><code>JSch</code></a>, a well-known pure Java implementation of SSH2.</p><p>Here is a more complex scenario, where I upload a file via SSH and then read back its grepped content:</p><figure class="highlight"><pre><code class="language-xml" data-lang="xml"><span></span>Shell shell = new SSH(
  &quot;ssh.example.com&quot;, 22,
  &quot;yegor&quot;, &quot;-----BEGIN RSA PRIVATE KEY-----...&quot;
);
File file = new File(&quot;/tmp/data.txt&quot;);
new Shell.Safe(shell).exec(
  &quot;cat &gt; d.txt <span class="err">&amp;&amp;</span> grep &#39;some text&#39; d.txt&quot;,
  new FileInputStream(file),
  Logger.stream(Level.INFO, this),
  Logger.stream(Level.WARNING, this)
);</code></pre></figure><p>Class <code>SSH</code>, which implements interface <code>Shell</code>, has only one method, <code>exec</code>. This method accepts four arguments:</p><figure class="highlight"><pre><code class="language-xml" data-lang="xml"><span></span>interface Shell {
  int exec(
    String cmd, InputStream stdin,
    OutputStream stdout, OutputStream stderr
  );
}</code></pre></figure><p>I think it&#39;s obvious what these arguments are about.</p><p>There are also a few convenient decorators that make it easier to operate with simple commands.</p><h2 id="shell-safe">Shell.Safe</h2><p><code>Shell.Safe</code> <a href="/2017/01/31/decorating-envelopes.html">decorates</a> an instance of <code>Shell</code> and <a href="/2015/12/01/rethrow-exceptions.html">throws</a> an exception if the <code>exec</code> exit code is not equal to zero. This may be very useful when you want to make sure that your command executed successfully, but don&#39;t want to duplicate <code>if/throw</code> in many places of your code.</p><figure class="highlight"><pre><code class="language-xml" data-lang="xml"><span></span>Shell ssh = new Shell.Safe(
  new SSH(
    &quot;ssh.example.com&quot;, 22,
    &quot;yegor&quot;, &quot;-----BEGIN RSA PRIVATE KEY-----...&quot;
  )
);</code></pre></figure><h2 id="shell-verbose">Shell.Verbose</h2><p><code>Shell.Verbose</code> decorates an instance of <code>Shell</code> and copies <code>stdout</code> and <code>stderr</code> to the slf4j logging facility (using <a href="http://log.jcabi.com"><code>jcabi-log</code></a>). Of course, you can combine decorators, for example:</p><figure class="highlight"><pre><code class="language-xml" data-lang="xml"><span></span>Shell ssh = new Shell.Verbose(
  new Shell.Safe(
    new SSH(
      &quot;ssh.example.com&quot;, 22,
      &quot;yegor&quot;, &quot;-----BEGIN RSA PRIVATE KEY-----...&quot;
    )
  )
);</code></pre></figure><h2 id="shell-plain">Shell.Plain</h2><p><code>Shell.Plain</code> is a wrapper of <code>Shell</code> that introduces a new <code>exec</code> method with only one argument, a command to execute. It also doesn&#39;t return an exit code, but <code>stdout</code> instead. This should be very convenient when you want to execute a simple command and just get its output (I&#39;m combining it with <code>Shell.Safe</code> for safety):</p><figure class="highlight"><pre><code class="language-xml" data-lang="xml"><span></span>String login = new Shell.Plain(new Shell.Safe(ssh)).exec(&quot;whoami&quot;);</code></pre></figure><h2 id="download">Download</h2><p>You need a single dependency <a href="http://repo1.maven.org/maven2/com/jcabi/jcabi-ssh"><code>jcabi-ssh.jar</code></a> in your Maven project (get its latest version in <a href="http://search.maven.org/">Maven Central</a>):</p><figure class="highlight"><pre><code class="language-xml" data-lang="xml"><span></span><span class="nt">&lt;dependency&gt;</span>
  <span class="nt">&lt;groupId&gt;</span>com.jcabi<span class="nt">&lt;/groupId&gt;</span>
  <span class="nt">&lt;artifactId&gt;</span>jcabi-ssh<span class="nt">&lt;/artifactId&gt;</span>
<span class="nt">&lt;/dependency&gt;</span></code></pre></figure><p>The project is in <a href="https://github.com/jcabi/jcabi-ssh">GitHub</a>. If you have any problems, just submit an issue. I&#39;ll try to help.</p></div></article></div><div class="wrapper"> <related-posts /></div><div class="disqus" role="complementary"><p class="disqus_hint"> Please, use <a href="https://help.disqus.com/commenting/what-html-tags-are-allowed-within-comments">syntax highlighting</a> in your comments, to make them more readable.</p><div id="disqus_thread" class="disqus-thread"> <a>&nbsp;</a></div><script> var disqus_config = function () { this.page.url = document.location.href.split('?')[0].split('#')[0].replace('https://', 'http://'); this.page.identifier = this.page.url; }; (function() { var d = document, s = d.createElement('script'); s.src = '//yegor256.disqus.com/embed.js'; s.setAttribute('data-timestamp', +new Date()); (d.head || d.body).appendChild(s); })(); </script> <noscript><div><p class="red"> JavaScript is disabled in your browser, that's why you can't see comments under this post.</p></div></noscript></div><div class="wrapper"> <footer class="footer"><p> &copy; <span itemscope="" itemprop="copyrightHolder" itemtype="http://schema.org/Person"> <span itemprop="name">Yegor Bugayenko</span> </span> 2014&ndash;<span itemprop="copyrightYear">2018</span></p></footer></div></section><div class="wrapper unprintable" style="text-align:center;margin-top:2em;"> <a href="http://www.sixnines.io/h/3ba1652f"> <img src="//www.sixnines.io/b/3ba1652f?style=flat" alt="sixnines availability badge"/> </a></div><script src="//code.jquery.com/jquery-1.9.0.min.js"></script> <script src="/js/all.js?4e047f6f42b"></script> <script>var disqus_shortname = 'yegor256';</script> <script id="dsq-count-scr" src="//yegor256.disqus.com/count.js" async="async"></script> <script> (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){ (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o), m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m) })(window,document,'script','//www.google-analytics.com/analytics.js','ga'); ga('create', 'UA-1963507-32', 'auto'); ga('send', 'pageview'); </script> <script> Cd=document;Cr="&"+Math.random();Cp="&s=1"; Cd.cookie="b=b";if(Cd.cookie)Cp+="&c=1"; Cp+="&t="+(new Date()).getTimezoneOffset(); if(self!=top)Cp+="&f=1"; </script> <script> if(navigator.javaEnabled())Cp+="&j=1"; </script> <script> if(typeof(screen)!='undefined')Cp+="&w="+screen.width+"&h="+ screen.height+"&d="+(screen.colorDepth?screen.colorDepth:screen.pixelDepth); </script> <script> Cd.write("<img src='//c.hit.ua/hit?i=95870&g=0&x=2"+Cp+Cr+ "&r="+escape(Cd.referrer)+"&u="+escape(window.location.href)+ "' border='0' wi"+"dth='1' he"+"ight='1'/>"); </script> <script type="application/ld+json"> { "@context": "http://schema.org", "@type": "Person", "name": "Yegor Bugayenko", "url": "http://www.yegor256.com", "sameAs": [ "https://www.facebook.com/yegor256", "https://instagram.com/yegor256", "https://www.linkedin.com/in/yegor256", "https://twitter.com/yegor256", "https://github.com/yegor256", "https://www.pinterest.com/yegor256/" ] } </script> </body> </html> <!DOCTYPE html> <html xmlns="http://www.w3.org/1999/xhtml" lang="en-US" xml:lang="en-US" itemscope="" itemtype="http://schema.org/WebSite"> <head> <meta charset="utf-8"/> <meta name="description" content="This tutorial explains how a Java web application can be deployed to CloudBees in just one click and zero maintenance efforts, using Rultor.com, DevOps assistant " /> <meta name="keywords" content="continuous delivery cloudbees, deploy in cloudbees, deploy to cloudbees, deploying to cloudbees, how to deploy a java app to cloudbees, how to host java web app, publish java web app to cloudbees" /> <meta name="viewport" content="width=device-width,minimum-scale=1,initial-scale=1"/> <meta name="google-site-verification" content="JEj_gQr2CPe2QKGw8XdMz0R7VboQIUbX3FlM-lwTq-8" /> <meta name="author" content="Yegor Bugayenko"> <meta name="article:published_time" content="2014-08-25 00:00:00 +0000"> <meta name="og:site_name" content="Yegor Bugayenko"/> <meta name="og:type" content="article" /> <meta name="og:locale" content="en_US" /> <meta name="twitter:account_id" content="4503599630178231" /> <meta name="twitter:creator" content="@yegor256"/> <meta name="twitter:site" content="@yegor256"/> <meta name="twitter:title" property="og:title" content="How to Deploy to CloudBees, in One Click"/> <meta name="twitter:description" property="og:description" content="This tutorial explains how a Java web application can be deployed to CloudBees in just one click and zero maintenance efforts, using Rultor.com, DevOps assistant "/> <meta name="twitter:url" property="og:url" content="https://www.yegor256.com/2014/08/25/deploy-to-cloudbees.html"/> <meta name="telegram:channel" content="AAAAAEJFMRzsRTRxM3ec6A"/> <link rel="search" type="application/opensearchdescription+xml" href="/opensearch.xml" title="yegor256" /> <link rel="shortcut icon" href="/favicon.ico?4e047f6f42b"/> <link rel="apple-touch-icon" href="/favicon.ico?4e047f6f42b"/> <link rel="alternate" type="application/rss+xml" title="RSS for yegor256.com" href="https://www.yegor256.com/rss.xml"/> <link rel="stylesheet" href="/css/layout.css?4e047f6f42b"/> <link rel="stylesheet" href="/css/icons.css?4e047f6f42b"/> <link rel="canonical" href="https://www.yegor256.com/2014/08/25/deploy-to-cloudbees.html" /> <link rel="amphtml" href="https://www.yegor256.com/2014/08/25/deploy-to-cloudbees.amp.html" /> <title>How to Deploy to CloudBees, in One Click </title> </head> <body><div class="wrapper"> <aside class="header-toggle unprintable" id="header-toggle" title="Show the menu" onclick="$('#header').show();$('#header-toggle').hide();">&#9776;</aside> <header class="header" id="header"><div class="face"> <a href="/about-me.html#form" class="sub" title="Click to subscribe to my monthly newsletter"><span>Subscribe</span></a> <a href="/about-me.html" style="position:relative;"> <img src="/images/face-256x256.jpg" class="photo" alt="Yegor Bugayenko"/> </a></div><nav><ul class="menu social notranslate"> <li><a href="https://twitter.com/intent/follow?screen_name=yegor256" rel="nofollow" title="Follow me on Twitter"><i class="icon icon-twitter notranslate" aria-hidden="true"></i></a></li> <li><a href="/rss.xml" rel="nofollow" title="Subscribe to my RSS feed"><i class="icon icon-rss notranslate" aria-hidden="true"></i></a></li> <li><a itemprop="sameAs" href="https://github.com/yegor256" rel="nofollow" title="My GitHub profile"><i class="icon icon-github notranslate" aria-hidden="true"></i></a></li> <li><a itemprop="sameAs" href="http://stackoverflow.com/users/187141/yegor256" rel="nofollow" title="My StackOverflow profile"><i class="icon icon-stackoverflow notranslate" aria-hidden="true"></i></a></li> <li><a itemprop="sameAs" href="https://www.facebook.com/yegor256" rel="nofollow" title="Follow me on Facebook"><i class="icon icon-facebook notranslate" aria-hidden="true"></i></a></li> <li><a itemprop="sameAs" href="https://instagram.com/yegor256" rel="nofollow" title="Follow me on Instagram"><i class="icon icon-instagram notranslate" aria-hidden="true"></i></a></li> <li><a itemprop="sameAs" href="https://www.linkedin.com/in/yegor256" rel="nofollow" title="My LinkedIn profile"><i class="icon icon-linkedin notranslate" aria-hidden="true"></i></a></li> <li><a itemprop="sameAs" href="https://www.youtube.com/c/yegor256?sub_confirmation=1" rel="nofollow" title="My Youtube video channel"><i class="icon icon-youtube notranslate" aria-hidden="true"></i></a></li> <li><a itemprop="sameAs" href="https://www.pinterest.com/yegor256/" rel="nofollow" title="My Pinterest boards"><i class="icon icon-pinterest notranslate" aria-hidden="true"></i></a></li> <li><a itemprop="sameAs" href="https://angel.co/yegor256" rel="nofollow" title="My AngelList profile"><i class="icon icon-angellist notranslate" aria-hidden="true"></i></a></li> <li><a href="https://soundcloud.com/yegor256" rel="nofollow" title="My podcast"><i class="icon icon-podcast notranslate" aria-hidden="true"></i></a></li> <li><a href="https://itunes.apple.com/us/podcast/yegor256-podcast/id1150826721" rel="nofollow" title="My iTunes podcast"><i class="icon icon-itunes notranslate" aria-hidden="true"></i></a></li> <li><a href="https://t.me/joinchat/AAAAAEJFMRzsRTRxM3ec6A" rel="nofollow" title="My Telegram public channel"><i class="icon icon-telegram notranslate" aria-hidden="true"></i></a></li> <li><a href="mailto:blog@yegor256.com" rel="nofollow" title="Email me any time"><i class="icon icon-mail notranslate" aria-hidden="true"></i></a></li></ul><ul class="menu"> <li><a href="/" title="Home page">Home</a></li> <li ><a href="/best.html" title="Best articles to read">12&#160;Best</a></li> <li ><a href="/contents.html" title="The contents of the entire blog">All&#160;288</a></li> <li ><a href="/webinars.html" title="My webinars">Webinars</a></li> <li ><a href="/talks.html" title="Future and past conference talks">Talks</a></li> <li ><a href="/books.html" title="The books I wrote">Books</a></li> <li ><a href="/papers.html" title="My academic papers and patents">Papers</a></li> <li ><a href="/pets.html" title="My loved pet projects">Pets</a></li> <li ><a href="/award.html" title="Software quality award">Award</a></li> <li ><a href="/testimonials.html" title="What some people say about me">Testimonials</a></li> <li ><a href="/shift-m.html" title="Audio podcast about project management">Shift-M</a></li> <li ><a href="/paintings.html" title="My paintings for sale">Paintings</a></li> <li><a href="http://ru.yegor256.com/" title="Немного на русском языке">По-русски</a></li></ul></nav><div class="search"> <form method="get" action="https://www.google.com/search" itemprop="potentialAction" itemscope="" itemtype="http://schema.org/SearchAction"> <meta itemprop="target" content="https://www.google.com/search?q={q}"/> <input name="sitesearch" value="yegor256.com" type="hidden"/> <input itemprop="query-input" type="text" id="search-query" class="field field-text" required="required" onfocus="$('.google').css('visibility', 'visible');" name="q" placeholder="Search..." autocomplete="off"/> <input type="image" src="/images/google-search-icon.svg" class="google" title="Search via Google" alt="Search via Google"/> </form></div><div class="hot"><ul> <li> <a href="/code-ahead.html">Code Ahead</a> was published on Amazon just a few days ago! It is my new book, a novel about programmers. It explains in details the majority of ideas that stand behind <a href="https://www.zerocracy.com">Zerocracy</a> and <a href="https://www.xdsd.org">XDSD</a>. </li> <li> At <a href="/webinars.html">Webinar #37</a> we will discuss naming problem in OOP, for objects, methods and attributes; join us on <b>September 12</b>, at 11am PST. </li></ul></div></header></div><section itemscope="" itemtype="http://schema.org/BlogPosting"><div class="wrapper"> <header><p class="printable"> <img src="https://api.qrserver.com/v1/create-qr-code/?data=https://www.yegor256.com/2014/08/25/deploy-to-cloudbees.html&amp;format=svg" style="width:125px;height:125px;" alt="QR code"/></p><p class="printable"> <code itemprop="url">https://www.yegor256.com/2014/08/25/deploy-to-cloudbees.html</code></p><h1 itemprop="name headline mainEntityOfPage">How to Deploy to CloudBees, in One Click</h1><ul class="subline"> <li> <time itemprop="datePublished" datetime="2014-08-25T00:00:00+00:00"> 25 August 2014 </time> </li> <li class="printable" itemscope="" itemprop="author" itemtype="http://schema.org/Person"> <span itemprop="name">Yegor Bugayenko</span> </li> <li class="unprintable"> <i class="icon icon-comments"></i> <a href="http://www.yegor256.com/2014/08/25/deploy-to-cloudbees.html#disqus_thread" itemprop="discussionUrl">comments</a> </li></ul><p style="border:1px solid red;padding:1em;color:red;"> Since CloudBees is <a href="http://www.cloudbees.com/press/cloudbees-becomes-enterprise-jenkins-company">shutting down its PaaS service</a> by the end of December, 2014, this article will have no sense after that.</p><h2 id="configure-the-cloudbees-maven-plugin">Configure the CloudBees Maven Plugin</h2><p>Add this profile to your <code>pom.xml</code>:</p><figure class="highlight"><pre><code class="language-xml" data-lang="xml"><span></span><span class="nt">&lt;project&gt;</span>
  [..]
  <span class="nt">&lt;profiles&gt;</span>
    <span class="nt">&lt;profile&gt;</span>
      <span class="nt">&lt;id&gt;</span>cloudbees<span class="nt">&lt;/id&gt;</span>
      <span class="nt">&lt;activation&gt;</span>
        <span class="nt">&lt;property&gt;&lt;name&gt;</span>bees.appId<span class="nt">&lt;/name&gt;&lt;/property&gt;</span>
      <span class="nt">&lt;/activation&gt;</span>
      <span class="nt">&lt;pluginRepositories&gt;</span>
        <span class="nt">&lt;pluginRepository&gt;</span>
          <span class="nt">&lt;id&gt;</span>cloudbees-public-release<span class="nt">&lt;/id&gt;</span>
          <span class="nt">&lt;url&gt;</span>
            http://repository-cloudbees.forge.cloudbees.com/public-release
          <span class="nt">&lt;/url&gt;</span>
        <span class="nt">&lt;/pluginRepository&gt;</span>
      <span class="nt">&lt;/pluginRepositories&gt;</span>
      <span class="nt">&lt;build&gt;</span>
        <span class="nt">&lt;pluginManagement&gt;</span>
          <span class="nt">&lt;plugins&gt;</span>
            <span class="nt">&lt;plugin&gt;</span>
              <span class="nt">&lt;artifactId&gt;</span>maven-deploy-plugin<span class="nt">&lt;/artifactId&gt;</span>
              <span class="nt">&lt;configuration&gt;</span>
                  <span class="nt">&lt;skip&gt;</span>true<span class="nt">&lt;/skip&gt;</span>
              <span class="nt">&lt;/configuration&gt;</span>
            <span class="nt">&lt;/plugin&gt;</span>
          <span class="nt">&lt;/plugins&gt;</span>
        <span class="nt">&lt;/pluginManagement&gt;</span>
        <span class="nt">&lt;plugins&gt;</span>
          <span class="nt">&lt;plugin&gt;</span>
            <span class="nt">&lt;groupId&gt;</span>com.cloudbees<span class="nt">&lt;/groupId&gt;</span>
            <span class="nt">&lt;artifactId&gt;</span>bees-maven-plugin<span class="nt">&lt;/artifactId&gt;</span>
            <span class="nt">&lt;version&gt;</span>1.3.2<span class="nt">&lt;/version&gt;</span>
            <span class="nt">&lt;configuration&gt;</span>
              <span class="nt">&lt;appid&gt;</span>${bees.id}<span class="nt">&lt;/appid&gt;</span>
              <span class="nt">&lt;apikey&gt;</span>${bees.key}<span class="nt">&lt;/apikey&gt;</span>
              <span class="nt">&lt;secret&gt;</span>${bees.secret}<span class="nt">&lt;/secret&gt;</span>
            <span class="nt">&lt;/configuration&gt;</span>
            <span class="nt">&lt;executions&gt;</span>
              <span class="nt">&lt;execution&gt;</span>
                <span class="nt">&lt;id&gt;</span>deploy-to-production<span class="nt">&lt;/id&gt;</span>
                <span class="nt">&lt;phase&gt;</span>deploy<span class="nt">&lt;/phase&gt;</span>
                <span class="nt">&lt;goals&gt;</span>
                  <span class="nt">&lt;goal&gt;</span>deploy<span class="nt">&lt;/goal&gt;</span>
                <span class="nt">&lt;/goals&gt;</span>
              <span class="nt">&lt;/execution&gt;</span>
            <span class="nt">&lt;/executions&gt;</span>
          <span class="nt">&lt;/plugin&gt;</span>
        <span class="nt">&lt;/plugins&gt;</span>
      <span class="nt">&lt;/build&gt;</span>
    <span class="nt">&lt;/profile&gt;</span>
  <span class="nt">&lt;/profiles&gt;</span>
<span class="nt">&lt;/project&gt;</span></code></pre></figure><p>This plugin is not in Maven Central (unfortunately). That&#39;s why we have to specify that <code>&lt;pluginRepository&gt;</code>.</p><p>Pay attention to the fact that we&#39;re also disabling <code>maven-deploy-plugin</code>, since it would try to deploy your WAR package to the repository from the <code>&lt;distributionManagement&gt;</code> section. We want to avoid this.</p><p>The profile gets activated only when the <code>bees.id</code> property is defined. This won&#39;t happen during your normal development and testing, but it will occur during the deployment cycle initiated by Rultor, because we will define this property in <code>settings.xml</code> (discussed below).</p><h2 id="secure-access-to-cloudbees">Secure Access to CloudBees</h2><p>Create an account in CloudBees and register your web application there. CloudBees is free, as long as you don&#39;t need too much computing power. I believe that web applications should be light-weight by definition, so CloudBees&#39; free layer is an ideal choice.</p><p>Create a <code>settings.xml</code> file (but don&#39;t commit it to your repo!):</p><figure class="highlight"><pre><code class="language-xml" data-lang="xml"><span></span><span class="nt">&lt;settings&gt;</span>
  <span class="nt">&lt;profiles&gt;</span>
    <span class="nt">&lt;profile&gt;</span>
      <span class="nt">&lt;id&gt;</span>cloudbees<span class="nt">&lt;/id&gt;</span>
      <span class="nt">&lt;properties&gt;</span>
        <span class="nt">&lt;bees.id&gt;</span>stateful/web<span class="nt">&lt;/bees.id&gt;</span>
        <span class="nt">&lt;bees.key&gt;</span><span class="c">&lt;!-- your key --&gt;</span><span class="nt">&lt;/bees.key&gt;</span>
        <span class="nt">&lt;bees.secret&gt;</span><span class="c">&lt;!-- your secret --&gt;</span><span class="nt">&lt;/bees.secret&gt;</span>
      <span class="nt">&lt;/properties&gt;</span>
    <span class="nt">&lt;/profile&gt;</span>
  <span class="nt">&lt;/profiles&gt;</span>
<span class="nt">&lt;/settings&gt;</span></code></pre></figure><p>Encrypt this file using <a href="https://github.com/yegor256/rultor-remote">rultor remote</a>:</p><figure class="highlight"><pre><code class="language-xml" data-lang="xml"><span></span>$ gem install rultor
$ rultor encrypt -p me/test settings.xml</code></pre></figure><p>Instead of <code>me/test</code> use the name of your GitHub project.</p><p>You should get a <code>settings.xml.asc</code> file; add it to the root directory of your project, commit and push. This file contains your CloudBees credentials, but in an encrypted format. Nobody can read it, except the Rultor server.</p><h2 id="configure-versions-plugin">Configure Versions Plugin</h2><p>I recommend using <a href="/2015/02/05/jcabi-parent-maven-pom.html">jcabi-parent</a>. It configures the required plugin out-of-the-box. If you&#39;re using it, skip this step.</p><p>Otherwise, add this plugin to your <code>pom.xml</code>:</p><figure class="highlight"><pre><code class="language-xml" data-lang="xml"><span></span><span class="nt">&lt;project&gt;</span>
  [..]
  <span class="nt">&lt;build&gt;</span>
    [..]
    <span class="nt">&lt;plugins&gt;</span>
      [..]
      <span class="nt">&lt;plugin&gt;</span>
        <span class="nt">&lt;groupId&gt;</span>org.codehaus.mojo<span class="nt">&lt;/groupId&gt;</span>
        <span class="nt">&lt;artifactId&gt;</span>versions-maven-plugin<span class="nt">&lt;/artifactId&gt;</span>
        <span class="nt">&lt;version&gt;</span>2.1<span class="nt">&lt;/version&gt;</span>
        <span class="nt">&lt;configuration&gt;</span>
          <span class="nt">&lt;generateBackupPoms&gt;</span>false<span class="nt">&lt;/generateBackupPoms&gt;</span>
        <span class="nt">&lt;/configuration&gt;</span>
      <span class="nt">&lt;/plugin&gt;</span>
    <span class="nt">&lt;/plugins&gt;</span>
  <span class="nt">&lt;/build&gt;</span>
<span class="nt">&lt;/project&gt;</span></code></pre></figure><h2 id="configure-rultor">Configure Rultor</h2><p>Create a <code>.rultor.yml</code> file in the root directory of your project (this <a href="http://doc.rultor.com/reference.html">reference page</a> explains this format in detail):</p><figure class="highlight"><pre><code class="language-text" data-lang="text"><span></span>decrypt:
  settings.xml: &quot;repo/settings.xml.asc&quot;
release:
  script: |
    mvn versions:set &quot;-DnewVersion=${tag}&quot;
    git commit -am &quot;${tag}&quot;
    mvn clean deploy --settings /home/r/settings.xml</code></pre></figure><p>You can compare your file with live Rultor <a href="https://github.com/sttc/stateful/blob/master/.rultor.yml">configuration of stateful.co</a>.</p><h2 id="run-it">Run It!</h2><figure class='badge'><a href='http://www.rultor.com'><img src='http://doc.rultor.com/images/logo.svg' style='width:100px;max-width:100%;' alt='badge'/></a></figure><p>Now it&#39;s time to see how it all works. Create a new ticket in the GitHub issue tracker, and post something like that into it (read more about <a href="http://doc.rultor.com/basics.html">Rultor commands</a>):</p><figure class="highlight"><pre><code class="language-text" data-lang="text"><span></span>@rultor release, tag is `0.1`</code></pre></figure><p>You will get a response in a few seconds. The rest will be done by Rultor.</p><p>Enjoy :)</p><p>BTW, if something doesn&#39;t work as I&#39;ve explained, don&#39;t hesitate to submit a ticket to the <a href="https://github.com/yegor256/rultor/issues">Rultor issue tracker</a>. I will try to help you.</p><p>Also, a similar configuration can be performed for <a href="/2014/09/13/deploying-to-heroku.html">Heroku</a> (using <a href="http://heroku.jcabi.com">jcabi-heroku-maven-plugin</a>) and for AWS Elastic Beanstalk (using <a href="http://beanstalk.jcabi.com">jcabi-beanstalk-maven-plugin</a>). I&#39;ll probably dedicate individual posts to them, as well.</p></p>--> <nav class="buttons notranslate desktop-only"> <a href="http://www.facebook.com/sharer/sharer.php?u=https://www.yegor256.com/2014/08/25/deploy-to-cloudbees.html" title="Share on Facebook" class="button" rel="nofollow"> <span class="count count-facebook">0</span> <i class="icon icon-facebook notranslate" aria-hidden="true"></i> </a> <a href="https://twitter.com/share?url=https://www.yegor256.com/2014/08/25/deploy-to-cloudbees.html&amp;text=How+to+Deploy+to+CloudBees%2C+in+One+Click" title="Share on Twitter" class="button" rel="nofollow"> <span class="count count-twitter">0</span> <i class="icon icon-twitter notranslate" aria-hidden="true"></i> </a> <a href="https://plus.google.com/share?url=https://www.yegor256.com/2014/08/25/deploy-to-cloudbees.html" title="Share on Google+" class="button" rel="nofollow"> <span class="count count-googleplus">0</span> <i class="icon icon-googleplus notranslate" aria-hidden="true"></i> </a> <a href="https://www.linkedin.com/cws/share?url=https://www.yegor256.com/2014/08/25/deploy-to-cloudbees.html" title="Share on LinkedIn" class="button" rel="nofollow"> <span class="count count-linkedin">0</span> <i class="icon icon-linkedin notranslate" aria-hidden="true"></i> </a> <a href="http://reddit.com/submit?url=https://www.yegor256.com/2014/08/25/deploy-to-cloudbees.html%3F2014-34&amp;title=How+to+Deploy+to+CloudBees%2C+in+One+Click" title="Share on Reddit" class="button" rel="nofollow"> <span class="count count-reddit">0</span> <i class="icon icon-reddit notranslate" aria-hidden="true"></i> </a> <a href="http://news.ycombinator.com/submitlink?u=https://www.yegor256.com/2014/08/25/deploy-to-cloudbees.html%3F2014-34&amp;t=How+to+Deploy+to+CloudBees%2C+in+One+Click" title="Share on Hacker News" class="button" rel="nofollow"> <span class="count count-hackernews">0</span> <i class="icon icon-hackernews notranslate" aria-hidden="true"></i> </a> </nav> </header> <article class="main" itemprop="articleBody"><div ><p>When I deploy a new version of <a href="http://www.stateful.co">stateful.co</a>, a Java web application, to CloudBees, it takes 30 seconds of my time. Maybe even less. Recently, I deployed version 1.6.5. You can see how it all happened, in <a href="https://github.com/sttc/stateful/issues/6">GitHub issue #6</a>:</p><figure class='unprintable'><img src='https://www.yegor256.com/images/2014/08/github-sttc-issue-6.png' itemprop='image' style='width:600px;max-width:100%;' alt='The figure'/></figure><p>As you see, I gave a command to <a href="http://www.rultor.com">Rultor</a>, and it packaged, tested and deployed a new version to CloudBees. I didn&#39;t do anything else.</p><p>Now let&#39;s see how you can do the same. How you can configure your project so that the deployment of its new version to CloudBees takes just a few seconds of your time.</p><p style="border:1px solid red;padding:1em;color:red;"> Since CloudBees is <a href="http://www.cloudbees.com/press/cloudbees-becomes-enterprise-jenkins-company">shutting down its PaaS service</a> by the end of December, 2014, this article will have no sense after that.</p><h2 id="configure-the-cloudbees-maven-plugin">Configure the CloudBees Maven Plugin</h2><p>Add this profile to your <code>pom.xml</code>:</p><figure class="highlight"><pre><code class="language-xml" data-lang="xml"><span></span><span class="nt">&lt;project&gt;</span>
  [..]
  <span class="nt">&lt;profiles&gt;</span>
    <span class="nt">&lt;profile&gt;</span>
      <span class="nt">&lt;id&gt;</span>cloudbees<span class="nt">&lt;/id&gt;</span>
      <span class="nt">&lt;activation&gt;</span>
        <span class="nt">&lt;property&gt;&lt;name&gt;</span>bees.appId<span class="nt">&lt;/name&gt;&lt;/property&gt;</span>
      <span class="nt">&lt;/activation&gt;</span>
      <span class="nt">&lt;pluginRepositories&gt;</span>
        <span class="nt">&lt;pluginRepository&gt;</span>
          <span class="nt">&lt;id&gt;</span>cloudbees-public-release<span class="nt">&lt;/id&gt;</span>
          <span class="nt">&lt;url&gt;</span>
            http://repository-cloudbees.forge.cloudbees.com/public-release
          <span class="nt">&lt;/url&gt;</span>
        <span class="nt">&lt;/pluginRepository&gt;</span>
      <span class="nt">&lt;/pluginRepositories&gt;</span>
      <span class="nt">&lt;build&gt;</span>
        <span class="nt">&lt;pluginManagement&gt;</span>
          <span class="nt">&lt;plugins&gt;</span>
            <span class="nt">&lt;plugin&gt;</span>
              <span class="nt">&lt;artifactId&gt;</span>maven-deploy-plugin<span class="nt">&lt;/artifactId&gt;</span>
              <span class="nt">&lt;configuration&gt;</span>
                  <span class="nt">&lt;skip&gt;</span>true<span class="nt">&lt;/skip&gt;</span>
              <span class="nt">&lt;/configuration&gt;</span>
            <span class="nt">&lt;/plugin&gt;</span>
          <span class="nt">&lt;/plugins&gt;</span>
        <span class="nt">&lt;/pluginManagement&gt;</span>
        <span class="nt">&lt;plugins&gt;</span>
          <span class="nt">&lt;plugin&gt;</span>
            <span class="nt">&lt;groupId&gt;</span>com.cloudbees<span class="nt">&lt;/groupId&gt;</span>
            <span class="nt">&lt;artifactId&gt;</span>bees-maven-plugin<span class="nt">&lt;/artifactId&gt;</span>
            <span class="nt">&lt;version&gt;</span>1.3.2<span class="nt">&lt;/version&gt;</span>
            <span class="nt">&lt;configuration&gt;</span>
              <span class="nt">&lt;appid&gt;</span>${bees.id}<span class="nt">&lt;/appid&gt;</span>
              <span class="nt">&lt;apikey&gt;</span>${bees.key}<span class="nt">&lt;/apikey&gt;</span>
              <span class="nt">&lt;secret&gt;</span>${bees.secret}<span class="nt">&lt;/secret&gt;</span>
            <span class="nt">&lt;/configuration&gt;</span>
            <span class="nt">&lt;executions&gt;</span>
              <span class="nt">&lt;execution&gt;</span>
                <span class="nt">&lt;id&gt;</span>deploy-to-production<span class="nt">&lt;/id&gt;</span>
                <span class="nt">&lt;phase&gt;</span>deploy<span class="nt">&lt;/phase&gt;</span>
                <span class="nt">&lt;goals&gt;</span>
                  <span class="nt">&lt;goal&gt;</span>deploy<span class="nt">&lt;/goal&gt;</span>
                <span class="nt">&lt;/goals&gt;</span>
              <span class="nt">&lt;/execution&gt;</span>
            <span class="nt">&lt;/executions&gt;</span>
          <span class="nt">&lt;/plugin&gt;</span>
        <span class="nt">&lt;/plugins&gt;</span>
      <span class="nt">&lt;/build&gt;</span>
    <span class="nt">&lt;/profile&gt;</span>
  <span class="nt">&lt;/profiles&gt;</span>
<span class="nt">&lt;/project&gt;</span></code></pre></figure><p>This plugin is not in Maven Central (unfortunately). That&#39;s why we have to specify that <code>&lt;pluginRepository&gt;</code>.</p><p>Pay attention to the fact that we&#39;re also disabling <code>maven-deploy-plugin</code>, since it would try to deploy your WAR package to the repository from the <code>&lt;distributionManagement&gt;</code> section. We want to avoid this.</p><p>The profile gets activated only when the <code>bees.id</code> property is defined. This won&#39;t happen during your normal development and testing, but it will occur during the deployment cycle initiated by Rultor, because we will define this property in <code>settings.xml</code> (discussed below).</p><h2 id="secure-access-to-cloudbees">Secure Access to CloudBees</h2><p>Create an account in CloudBees and register your web application there. CloudBees is free, as long as you don&#39;t need too much computing power. I believe that web applications should be light-weight by definition, so CloudBees&#39; free layer is an ideal choice.</p><p>Create a <code>settings.xml</code> file (but don&#39;t commit it to your repo!):</p><figure class="highlight"><pre><code class="language-xml" data-lang="xml"><span></span><span class="nt">&lt;settings&gt;</span>
  <span class="nt">&lt;profiles&gt;</span>
    <span class="nt">&lt;profile&gt;</span>
      <span class="nt">&lt;id&gt;</span>cloudbees<span class="nt">&lt;/id&gt;</span>
      <span class="nt">&lt;properties&gt;</span>
        <span class="nt">&lt;bees.id&gt;</span>stateful/web<span class="nt">&lt;/bees.id&gt;</span>
        <span class="nt">&lt;bees.key&gt;</span><span class="c">&lt;!-- your key --&gt;</span><span class="nt">&lt;/bees.key&gt;</span>
        <span class="nt">&lt;bees.secret&gt;</span><span class="c">&lt;!-- your secret --&gt;</span><span class="nt">&lt;/bees.secret&gt;</span>
      <span class="nt">&lt;/properties&gt;</span>
    <span class="nt">&lt;/profile&gt;</span>
  <span class="nt">&lt;/profiles&gt;</span>
<span class="nt">&lt;/settings&gt;</span></code></pre></figure><p>Encrypt this file using <a href="https://github.com/yegor256/rultor-remote">rultor remote</a>:</p><figure class="highlight"><pre><code class="language-xml" data-lang="xml"><span></span>$ gem install rultor
$ rultor encrypt -p me/test settings.xml</code></pre></figure><p>Instead of <code>me/test</code> use the name of your GitHub project.</p><p>You should get a <code>settings.xml.asc</code> file; add it to the root directory of your project, commit and push. This file contains your CloudBees credentials, but in an encrypted format. Nobody can read it, except the Rultor server.</p><h2 id="configure-versions-plugin">Configure Versions Plugin</h2><p>I recommend using <a href="/2015/02/05/jcabi-parent-maven-pom.html">jcabi-parent</a>. It configures the required plugin out-of-the-box. If you&#39;re using it, skip this step.</p><p>Otherwise, add this plugin to your <code>pom.xml</code>:</p><figure class="highlight"><pre><code class="language-xml" data-lang="xml"><span></span><span class="nt">&lt;project&gt;</span>
  [..]
  <span class="nt">&lt;build&gt;</span>
    [..]
    <span class="nt">&lt;plugins&gt;</span>
      [..]
      <span class="nt">&lt;plugin&gt;</span>
        <span class="nt">&lt;groupId&gt;</span>org.codehaus.mojo<span class="nt">&lt;/groupId&gt;</span>
        <span class="nt">&lt;artifactId&gt;</span>versions-maven-plugin<span class="nt">&lt;/artifactId&gt;</span>
        <span class="nt">&lt;version&gt;</span>2.1<span class="nt">&lt;/version&gt;</span>
        <span class="nt">&lt;configuration&gt;</span>
          <span class="nt">&lt;generateBackupPoms&gt;</span>false<span class="nt">&lt;/generateBackupPoms&gt;</span>
        <span class="nt">&lt;/configuration&gt;</span>
      <span class="nt">&lt;/plugin&gt;</span>
    <span class="nt">&lt;/plugins&gt;</span>
  <span class="nt">&lt;/build&gt;</span>
<span class="nt">&lt;/project&gt;</span></code></pre></figure><h2 id="configure-rultor">Configure Rultor</h2><p>Create a <code>.rultor.yml</code> file in the root directory of your project (this <a href="http://doc.rultor.com/reference.html">reference page</a> explains this format in detail):</p><figure class="highlight"><pre><code class="language-text" data-lang="text"><span></span>decrypt:
  settings.xml: &quot;repo/settings.xml.asc&quot;
release:
  script: |
    mvn versions:set &quot;-DnewVersion=${tag}&quot;
    git commit -am &quot;${tag}&quot;
    mvn clean deploy --settings /home/r/settings.xml</code></pre></figure><p>You can compare your file with live Rultor <a href="https://github.com/sttc/stateful/blob/master/.rultor.yml">configuration of stateful.co</a>.</p><h2 id="run-it">Run It!</h2><figure class='badge'><a href='http://www.rultor.com'><img src='http://doc.rultor.com/images/logo.svg' style='width:100px;max-width:100%;' alt='badge'/></a></figure><p>Now it&#39;s time to see how it all works. Create a new ticket in the GitHub issue tracker, and post something like that into it (read more about <a href="http://doc.rultor.com/basics.html">Rultor commands</a>):</p><figure class="highlight"><pre><code class="language-text" data-lang="text"><span></span>@rultor release, tag is `0.1`</code></pre></figure><p>You will get a response in a few seconds. The rest will be done by Rultor.</p><p>Enjoy :)</p><p>BTW, if something doesn&#39;t work as I&#39;ve explained, don&#39;t hesitate to submit a ticket to the <a href="https://github.com/yegor256/rultor/issues">Rultor issue tracker</a>. I will try to help you.</p><p>Also, a similar configuration can be performed for <a href="/2014/09/13/deploying-to-heroku.html">Heroku</a> (using <a href="http://heroku.jcabi.com">jcabi-heroku-maven-plugin</a>) and for AWS Elastic Beanstalk (using <a href="http://beanstalk.jcabi.com">jcabi-beanstalk-maven-plugin</a>). I&#39;ll probably dedicate individual posts to them, as well.</p></div></article></div><div class="wrapper"> <related-posts /></div><div class="disqus" role="complementary"><p class="disqus_hint"> Please, use <a href="https://help.disqus.com/commenting/what-html-tags-are-allowed-within-comments">syntax highlighting</a> in your comments, to make them more readable.</p><div id="disqus_thread" class="disqus-thread"> <a>&nbsp;</a></div><script> var disqus_config = function () { this.page.url = document.location.href.split('?')[0].split('#')[0].replace('https://', 'http://'); this.page.identifier = this.page.url; }; (function() { var d = document, s = d.createElement('script'); s.src = '//yegor256.disqus.com/embed.js'; s.setAttribute('data-timestamp', +new Date()); (d.head || d.body).appendChild(s); })(); </script> <noscript><div><p class="red"> JavaScript is disabled in your browser, that's why you can't see comments under this post.</p></div></noscript></div><div class="wrapper"> <footer class="footer"><p> &copy; <span itemscope="" itemprop="copyrightHolder" itemtype="http://schema.org/Person"> <span itemprop="name">Yegor Bugayenko</span> </span> 2014&ndash;<span itemprop="copyrightYear">2018</span></p></footer></div></section><div class="wrapper unprintable" style="text-align:center;margin-top:2em;"> <a href="http://www.sixnines.io/h/3ba1652f"> <img src="//www.sixnines.io/b/3ba1652f?style=flat" alt="sixnines availability badge"/> </a></div><script src="//code.jquery.com/jquery-1.9.0.min.js"></script> <script src="/js/all.js?4e047f6f42b"></script> <script>var disqus_shortname = 'yegor256';</script> <script id="dsq-count-scr" src="//yegor256.disqus.com/count.js" async="async"></script> <script> (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){ (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o), m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m) })(window,document,'script','//www.google-analytics.com/analytics.js','ga'); ga('create', 'UA-1963507-32', 'auto'); ga('send', 'pageview'); </script> <script> Cd=document;Cr="&"+Math.random();Cp="&s=1"; Cd.cookie="b=b";if(Cd.cookie)Cp+="&c=1"; Cp+="&t="+(new Date()).getTimezoneOffset(); if(self!=top)Cp+="&f=1"; </script> <script> if(navigator.javaEnabled())Cp+="&j=1"; </script> <script> if(typeof(screen)!='undefined')Cp+="&w="+screen.width+"&h="+ screen.height+"&d="+(screen.colorDepth?screen.colorDepth:screen.pixelDepth); </script> <script> Cd.write("<img src='//c.hit.ua/hit?i=95870&g=0&x=2"+Cp+Cr+ "&r="+escape(Cd.referrer)+"&u="+escape(window.location.href)+ "' border='0' wi"+"dth='1' he"+"ight='1'/>"); </script> <script type="application/ld+json"> { "@context": "http://schema.org", "@type": "Person", "name": "Yegor Bugayenko", "url": "http://www.yegor256.com", "sameAs": [ "https://www.facebook.com/yegor256", "https://instagram.com/yegor256", "https://www.linkedin.com/in/yegor256", "https://twitter.com/yegor256", "https://github.com/yegor256", "https://www.pinterest.com/yegor256/" ] } </script> </body> </html> <!DOCTYPE html> <html xmlns="http://www.w3.org/1999/xhtml" lang="en-US" xml:lang="en-US" itemscope="" itemtype="http://schema.org/WebSite"> <head> <meta charset="utf-8"/> <meta name="description" content="This tutorial explains how a Java project can be released/deployed to Maven Central in just one click and zero maintenance efforts, using Rultor.com, DevOps assistant " /> <meta name="keywords" content="deploy to maven central, fast release to maven central, how to deploy to maven central, how to release to maven central, maven central release, publish from github to maven central, release to maven central" /> <meta name="viewport" content="width=device-width,minimum-scale=1,initial-scale=1"/> <meta name="google-site-verification" content="JEj_gQr2CPe2QKGw8XdMz0R7VboQIUbX3FlM-lwTq-8" /> <meta name="author" content="Yegor Bugayenko"> <meta name="article:published_time" content="2014-08-19 00:00:00 +0000"> <meta name="og:site_name" content="Yegor Bugayenko"/> <meta name="og:type" content="article" /> <meta name="og:locale" content="en_US" /> <meta name="twitter:account_id" content="4503599630178231" /> <meta name="twitter:creator" content="@yegor256"/> <meta name="twitter:site" content="@yegor256"/> <meta name="twitter:title" property="og:title" content="How to Release to Maven Central, in One Click"/> <meta name="twitter:description" property="og:description" content="This tutorial explains how a Java project can be released/deployed to Maven Central in just one click and zero maintenance efforts, using Rultor.com, DevOps assistant "/> <meta name="twitter:url" property="og:url" content="https://www.yegor256.com/2014/08/19/how-to-release-to-maven-central.html"/> <meta name="telegram:channel" content="AAAAAEJFMRzsRTRxM3ec6A"/> <link rel="search" type="application/opensearchdescription+xml" href="/opensearch.xml" title="yegor256" /> <link rel="shortcut icon" href="/favicon.ico?4e047f6f42b"/> <link rel="apple-touch-icon" href="/favicon.ico?4e047f6f42b"/> <link rel="alternate" type="application/rss+xml" title="RSS for yegor256.com" href="https://www.yegor256.com/rss.xml"/> <link rel="stylesheet" href="/css/layout.css?4e047f6f42b"/> <link rel="stylesheet" href="/css/icons.css?4e047f6f42b"/> <link rel="canonical" href="https://www.yegor256.com/2014/08/19/how-to-release-to-maven-central.html" /> <link rel="amphtml" href="https://www.yegor256.com/2014/08/19/how-to-release-to-maven-central.amp.html" /> <title>How to Release to Maven Central, in One Click </title> </head> <body><div class="wrapper"> <aside class="header-toggle unprintable" id="header-toggle" title="Show the menu" onclick="$('#header').show();$('#header-toggle').hide();">&#9776;</aside> <header class="header" id="header"><div class="face"> <a href="/about-me.html#form" class="sub" title="Click to subscribe to my monthly newsletter"><span>Subscribe</span></a> <a href="/about-me.html" style="position:relative;"> <img src="/images/face-256x256.jpg" class="photo" alt="Yegor Bugayenko"/> </a></div><nav><ul class="menu social notranslate"> <li><a href="https://twitter.com/intent/follow?screen_name=yegor256" rel="nofollow" title="Follow me on Twitter"><i class="icon icon-twitter notranslate" aria-hidden="true"></i></a></li> <li><a href="/rss.xml" rel="nofollow" title="Subscribe to my RSS feed"><i class="icon icon-rss notranslate" aria-hidden="true"></i></a></li> <li><a itemprop="sameAs" href="https://github.com/yegor256" rel="nofollow" title="My GitHub profile"><i class="icon icon-github notranslate" aria-hidden="true"></i></a></li> <li><a itemprop="sameAs" href="http://stackoverflow.com/users/187141/yegor256" rel="nofollow" title="My StackOverflow profile"><i class="icon icon-stackoverflow notranslate" aria-hidden="true"></i></a></li> <li><a itemprop="sameAs" href="https://www.facebook.com/yegor256" rel="nofollow" title="Follow me on Facebook"><i class="icon icon-facebook notranslate" aria-hidden="true"></i></a></li> <li><a itemprop="sameAs" href="https://instagram.com/yegor256" rel="nofollow" title="Follow me on Instagram"><i class="icon icon-instagram notranslate" aria-hidden="true"></i></a></li> <li><a itemprop="sameAs" href="https://www.linkedin.com/in/yegor256" rel="nofollow" title="My LinkedIn profile"><i class="icon icon-linkedin notranslate" aria-hidden="true"></i></a></li> <li><a itemprop="sameAs" href="https://www.youtube.com/c/yegor256?sub_confirmation=1" rel="nofollow" title="My Youtube video channel"><i class="icon icon-youtube notranslate" aria-hidden="true"></i></a></li> <li><a itemprop="sameAs" href="https://www.pinterest.com/yegor256/" rel="nofollow" title="My Pinterest boards"><i class="icon icon-pinterest notranslate" aria-hidden="true"></i></a></li> <li><a itemprop="sameAs" href="https://angel.co/yegor256" rel="nofollow" title="My AngelList profile"><i class="icon icon-angellist notranslate" aria-hidden="true"></i></a></li> <li><a href="https://soundcloud.com/yegor256" rel="nofollow" title="My podcast"><i class="icon icon-podcast notranslate" aria-hidden="true"></i></a></li> <li><a href="https://itunes.apple.com/us/podcast/yegor256-podcast/id1150826721" rel="nofollow" title="My iTunes podcast"><i class="icon icon-itunes notranslate" aria-hidden="true"></i></a></li> <li><a href="https://t.me/joinchat/AAAAAEJFMRzsRTRxM3ec6A" rel="nofollow" title="My Telegram public channel"><i class="icon icon-telegram notranslate" aria-hidden="true"></i></a></li> <li><a href="mailto:blog@yegor256.com" rel="nofollow" title="Email me any time"><i class="icon icon-mail notranslate" aria-hidden="true"></i></a></li></ul><ul class="menu"> <li><a href="/" title="Home page">Home</a></li> <li ><a href="/best.html" title="Best articles to read">12&#160;Best</a></li> <li ><a href="/contents.html" title="The contents of the entire blog">All&#160;288</a></li> <li ><a href="/webinars.html" title="My webinars">Webinars</a></li> <li ><a href="/talks.html" title="Future and past conference talks">Talks</a></li> <li ><a href="/books.html" title="The books I wrote">Books</a></li> <li ><a href="/papers.html" title="My academic papers and patents">Papers</a></li> <li ><a href="/pets.html" title="My loved pet projects">Pets</a></li> <li ><a href="/award.html" title="Software quality award">Award</a></li> <li ><a href="/testimonials.html" title="What some people say about me">Testimonials</a></li> <li ><a href="/shift-m.html" title="Audio podcast about project management">Shift-M</a></li> <li ><a href="/paintings.html" title="My paintings for sale">Paintings</a></li> <li><a href="http://ru.yegor256.com/" title="Немного на русском языке">По-русски</a></li></ul></nav><div class="search"> <form method="get" action="https://www.google.com/search" itemprop="potentialAction" itemscope="" itemtype="http://schema.org/SearchAction"> <meta itemprop="target" content="https://www.google.com/search?q={q}"/> <input name="sitesearch" value="yegor256.com" type="hidden"/> <input itemprop="query-input" type="text" id="search-query" class="field field-text" required="required" onfocus="$('.google').css('visibility', 'visible');" name="q" placeholder="Search..." autocomplete="off"/> <input type="image" src="/images/google-search-icon.svg" class="google" title="Search via Google" alt="Search via Google"/> </form></div><div class="hot"><ul> <li> <a href="/code-ahead.html">Code Ahead</a> was published on Amazon just a few days ago! It is my new book, a novel about programmers. It explains in details the majority of ideas that stand behind <a href="https://www.zerocracy.com">Zerocracy</a> and <a href="https://www.xdsd.org">XDSD</a>. </li> <li> At <a href="/webinars.html">Webinar #37</a> we will discuss naming problem in OOP, for objects, methods and attributes; join us on <b>September 12</b>, at 11am PST. </li></ul></div></header></div><section itemscope="" itemtype="http://schema.org/BlogPosting"><div class="wrapper"> <header><p class="printable"> <img src="https://api.qrserver.com/v1/create-qr-code/?data=https://www.yegor256.com/2014/08/19/how-to-release-to-maven-central.html&amp;format=svg" style="width:125px;height:125px;" alt="QR code"/></p><p class="printable"> <code itemprop="url">https://www.yegor256.com/2014/08/19/how-to-release-to-maven-central.html</code></p><h1 itemprop="name headline mainEntityOfPage">How to Release to Maven Central, in One Click</h1><ul class="subline"> <li> <time itemprop="datePublished" datetime="2014-08-19T00:00:00+00:00"> 19 August 2014 </time> </li> <li class="printable" itemscope="" itemprop="author" itemtype="http://schema.org/Person"> <span itemprop="name">Yegor Bugayenko</span> </li> <li class="unprintable"> <i class="icon icon-comments"></i> <a href="http://www.yegor256.com/2014/08/19/how-to-release-to-maven-central.html#disqus_thread" itemprop="discussionUrl">comments</a> </li></ul><p>By the way, I assume that you&#39;re hosting your project in GitHub. If not, this entire tutorial won&#39;t work. If you are still not in GitHub, I would strongly recommend moving there.</p><h2 id="prepare-your-pom">Prepare Your POM</h2><aside class='youtube'> <a href='https://www.youtube.com/watch?v=rEK3Rk2lX3M'><div class='box'> <img src='https://i.ytimg.com/vi/rEK3Rk2lX3M/mqdefault.jpg' alt='YouTube video #rEK3Rk2lX3M'/><div class='play'><i class='icon icon-play'></i></div></div></a><div>Cactoos 0.12 polishing and releasing (webinar #27); 2 August 2017.</div></aside><p>Make sure your <code>pom.xml</code> contains all elements required by Sonatype, explained in <a href="http://central.sonatype.org/pages/requirements.html">Central Sync Requirements</a>. We will deploy to Sonatype, and they will synchronize all JAR (and not only) artifacts to Maven Central.</p><h2 id="register-a-project-with-sonatype">Register a Project With Sonatype</h2><p>Create an account in <a href="https://issues.sonatype.org/">Sonatype JIRA</a> and raise a ticket, asking to approve your <code>groupId</code>. This <a href="http://central.sonatype.org/pages/ossrh-guide.html">OSSRH Guide</a> explains this step in more detail.</p><h2 id="create-and-distribute-a-gpg-key">Create and Distribute a GPG Key</h2><p>Create a GPG key and distribute it, as explained in this <a href="http://central.sonatype.org/pages/working-with-pgp-signatures.html">Working with PGP Signatures</a> article.</p><p>When this step is done, you should have two files: <code>pubring.gpg</code> and <code>secring.gpg</code>.</p><h2 id="create-settings-xml">Create settings.xml</h2><p>Create <code>settings.xml</code>, next to the two <code>.gpg</code> files created in the previous step:</p><figure class="highlight"><pre><code class="language-xml" data-lang="xml"><span></span><span class="nt">&lt;settings&gt;</span>
  <span class="nt">&lt;profiles&gt;</span>
    <span class="nt">&lt;profile&gt;</span>
      <span class="nt">&lt;id&gt;</span>foo<span class="nt">&lt;/id&gt;</span> <span class="c">&lt;!-- give it the name of your project --&gt;</span>
      <span class="nt">&lt;properties&gt;</span>
        <span class="nt">&lt;gpg.homedir&gt;</span>/home/r<span class="nt">&lt;/gpg.homedir&gt;</span>
        <span class="nt">&lt;gpg.keyname&gt;</span>9A105525<span class="nt">&lt;/gpg.keyname&gt;</span>
        <span class="nt">&lt;gpg.passphrase&gt;</span>my-secret<span class="nt">&lt;/gpg.passphrase&gt;</span>
      <span class="nt">&lt;/properties&gt;</span>
    <span class="nt">&lt;/profile&gt;</span>
  <span class="nt">&lt;/profiles&gt;</span>
  <span class="nt">&lt;servers&gt;</span>
    <span class="nt">&lt;server&gt;</span>
      <span class="nt">&lt;id&gt;</span>oss.sonatype.org<span class="nt">&lt;/id&gt;</span>
      <span class="nt">&lt;username&gt;</span><span class="c">&lt;!-- Sonatype JIRA user name --&gt;</span><span class="nt">&lt;/username&gt;</span>
      <span class="nt">&lt;password&gt;</span><span class="c">&lt;!-- Sonatype JIRA pwd --&gt;</span><span class="nt">&lt;/password&gt;</span>
    <span class="nt">&lt;/server&gt;</span>
  <span class="nt">&lt;/servers&gt;</span>
<span class="nt">&lt;/settings&gt;</span></code></pre></figure><p>In this example, <code>9A105525</code> is the ID of your public key, and <code>my-secret</code> is the pass phrase you have used while generating the keys.</p><h2 id="encrypt-security-assets">Encrypt Security Assets</h2><p>Now, encrypt these three files with a <a href="https://github.com/yegor256/rultor-remote">rultor remote</a>:</p><figure class="highlight"><pre><code class="language-xml" data-lang="xml"><span></span>$ gem install rultor
$ rultor encrypt -p me/test pubring.gpg
$ rultor encrypt -p me/test secring.gpg
$ rultor encrypt -p me/test settings.xml</code></pre></figure><p>Instead of <code>me/test</code> you should use the name of your GitHub project.</p><p>You will get three new files: <code>pubring.gpg.asc</code>, <code>secring.gpg.asc</code> and <code>settings.xml.asc</code>. Add them to the root directory of your project, commit and push. The files contain your secret information, but only the Rultor server can decrypt them.</p><h2 id="add-sonatype-repositories">Add Sonatype Repositories</h2><p>I would recommend using <a href="/2015/02/05/jcabi-parent-maven-pom.html">jcabi-parent</a>, as a parent pom for your project. This will make many further steps unnecessary. If you&#39;re using jcabi-parent, skip this step.</p><p>However, if you don&#39;t use jcabi-parent, you should add these two repositories to your <code>pom.xml</code>:</p><figure class="highlight"><pre><code class="language-xml" data-lang="xml"><span></span><span class="nt">&lt;project&gt;</span>
  [...]
  <span class="nt">&lt;distributionManagement&gt;</span>
    <span class="nt">&lt;repository&gt;</span>
      <span class="nt">&lt;id&gt;</span>oss.sonatype.org<span class="nt">&lt;/id&gt;</span>
      <span class="nt">&lt;url&gt;</span>https://oss.sonatype.org/service/local/staging/deploy/maven2/<span class="nt">&lt;/url&gt;</span>
    <span class="nt">&lt;/repository&gt;</span>
    <span class="nt">&lt;snapshotRepository&gt;</span>
      <span class="nt">&lt;id&gt;</span>oss.sonatype.org<span class="nt">&lt;/id&gt;</span>
      <span class="nt">&lt;url&gt;</span>https://oss.sonatype.org/content/repositories/snapshots<span class="nt">&lt;/url&gt;</span>
    <span class="nt">&lt;/snapshotRepository&gt;</span>
  <span class="nt">&lt;/distributionManagement&gt;</span>
<span class="nt">&lt;/project&gt;</span></code></pre></figure><h2 id="configure-gpg-plugin">Configure GPG Plugin</h2><p>Again, I&#39;d recommend using <a href="http://parent.jcabi.com">jcabi-parent</a>, which configures this plugin automatically. If you&#39;re using it, skip this step.</p><p>Otherwise, add this plugin to your <code>pom.xml</code>:</p><figure class="highlight"><pre><code class="language-xml" data-lang="xml"><span></span><span class="nt">&lt;project&gt;</span>
  [..]
  <span class="nt">&lt;build&gt;</span>
    [..]
    <span class="nt">&lt;plugins&gt;</span>
      [..]
      <span class="nt">&lt;plugin&gt;</span>
        <span class="nt">&lt;artifactId&gt;</span>maven-gpg-plugin<span class="nt">&lt;/artifactId&gt;</span>
        <span class="nt">&lt;version&gt;</span>1.5<span class="nt">&lt;/version&gt;</span>
        <span class="nt">&lt;executions&gt;</span>
          <span class="nt">&lt;execution&gt;</span>
            <span class="nt">&lt;id&gt;</span>sign-artifacts<span class="nt">&lt;/id&gt;</span>
            <span class="nt">&lt;phase&gt;</span>verify<span class="nt">&lt;/phase&gt;</span>
            <span class="nt">&lt;goals&gt;</span>
              <span class="nt">&lt;goal&gt;</span>sign<span class="nt">&lt;/goal&gt;</span>
            <span class="nt">&lt;/goals&gt;</span>
          <span class="nt">&lt;/execution&gt;</span>
        <span class="nt">&lt;/executions&gt;</span>
      <span class="nt">&lt;/plugin&gt;</span>
    <span class="nt">&lt;/plugins&gt;</span>
  <span class="nt">&lt;/build&gt;</span>
<span class="nt">&lt;/project&gt;</span></code></pre></figure><h2 id="configure-versions-plugin">Configure Versions Plugin</h2><p>Once again, I recommend using <a href="/2015/02/05/jcabi-parent-maven-pom.html">http://parent.jcabi.com</a>. It configures all required plugins out-of-the-box. If you&#39;re using it, skip this step.</p><p>Otherwise, add this plugin to your <code>pom.xml</code>:</p><figure class="highlight"><pre><code class="language-xml" data-lang="xml"><span></span><span class="nt">&lt;project&gt;</span>
  [..]
  <span class="nt">&lt;build&gt;</span>
    [..]
    <span class="nt">&lt;plugins&gt;</span>
      [..]
      <span class="nt">&lt;plugin&gt;</span>
        <span class="nt">&lt;groupId&gt;</span>org.codehaus.mojo<span class="nt">&lt;/groupId&gt;</span>
        <span class="nt">&lt;artifactId&gt;</span>versions-maven-plugin<span class="nt">&lt;/artifactId&gt;</span>
        <span class="nt">&lt;version&gt;</span>2.1<span class="nt">&lt;/version&gt;</span>
        <span class="nt">&lt;configuration&gt;</span>
          <span class="nt">&lt;generateBackupPoms&gt;</span>false<span class="nt">&lt;/generateBackupPoms&gt;</span>
        <span class="nt">&lt;/configuration&gt;</span>
      <span class="nt">&lt;/plugin&gt;</span>
    <span class="nt">&lt;/plugins&gt;</span>
  <span class="nt">&lt;/build&gt;</span>
<span class="nt">&lt;/project&gt;</span></code></pre></figure><h2 id="configure-sonatype-plugin">Configure Sonatype Plugin</h2><p>Yes, you&#39;re right, <a href="/2015/02/05/jcabi-parent-maven-pom.html">http://parent.jcabi.com</a> will help you here as well. If you&#39;re using it, skip this step too.</p><p>Otherwise, add these four plugins to your <code>pom.xml</code>:</p><figure class="highlight"><pre><code class="language-xml" data-lang="xml"><span></span><span class="nt">&lt;project&gt;</span>
  [..]
  <span class="nt">&lt;build&gt;</span>
    [..]
    <span class="nt">&lt;plugins&gt;</span>
      [..]
      <span class="nt">&lt;plugin&gt;</span>
        <span class="nt">&lt;artifactId&gt;</span>maven-deploy-plugin<span class="nt">&lt;/artifactId&gt;</span>
        <span class="nt">&lt;configuration&gt;</span>
          <span class="nt">&lt;skip&gt;</span>true<span class="nt">&lt;/skip&gt;</span>
        <span class="nt">&lt;/configuration&gt;</span>
      <span class="nt">&lt;/plugin&gt;</span>
      <span class="nt">&lt;plugin&gt;</span>
        <span class="nt">&lt;artifactId&gt;</span>maven-source-plugin<span class="nt">&lt;/artifactId&gt;</span>
        <span class="nt">&lt;executions&gt;</span>
          <span class="nt">&lt;execution&gt;</span>
            <span class="nt">&lt;id&gt;</span>package-sources<span class="nt">&lt;/id&gt;</span>
            <span class="nt">&lt;goals&gt;</span>
              <span class="nt">&lt;goal&gt;</span>jar<span class="nt">&lt;/goal&gt;</span>
            <span class="nt">&lt;/goals&gt;</span>
          <span class="nt">&lt;/execution&gt;</span>
        <span class="nt">&lt;/executions&gt;</span>
      <span class="nt">&lt;/plugin&gt;</span>
      <span class="nt">&lt;plugin&gt;</span>
        <span class="nt">&lt;artifactId&gt;</span>maven-javadoc-plugin<span class="nt">&lt;/artifactId&gt;</span>
        <span class="nt">&lt;executions&gt;</span>
          <span class="nt">&lt;execution&gt;</span>
            <span class="nt">&lt;id&gt;</span>package-javadoc<span class="nt">&lt;/id&gt;</span>
            <span class="nt">&lt;phase&gt;</span>package<span class="nt">&lt;/phase&gt;</span>
            <span class="nt">&lt;goals&gt;</span>
              <span class="nt">&lt;goal&gt;</span>jar<span class="nt">&lt;/goal&gt;</span>
            <span class="nt">&lt;/goals&gt;</span>
          <span class="nt">&lt;/execution&gt;</span>
        <span class="nt">&lt;/executions&gt;</span>
      <span class="nt">&lt;/plugin&gt;</span>
      <span class="nt">&lt;plugin&gt;</span>
        <span class="nt">&lt;groupId&gt;</span>org.sonatype.plugins<span class="nt">&lt;/groupId&gt;</span>
        <span class="nt">&lt;artifactId&gt;</span>nexus-staging-maven-plugin<span class="nt">&lt;/artifactId&gt;</span>
        <span class="nt">&lt;version&gt;</span>1.6<span class="nt">&lt;/version&gt;</span>
        <span class="nt">&lt;extensions&gt;</span>true<span class="nt">&lt;/extensions&gt;</span>
        <span class="nt">&lt;configuration&gt;</span>
          <span class="nt">&lt;serverId&gt;</span>oss.sonatype.org<span class="nt">&lt;/serverId&gt;</span>
          <span class="nt">&lt;nexusUrl&gt;</span>https://oss.sonatype.org/<span class="nt">&lt;/nexusUrl&gt;</span>
          <span class="nt">&lt;description&gt;</span>${project.version}<span class="nt">&lt;/description&gt;</span>
        <span class="nt">&lt;/configuration&gt;</span>
        <span class="nt">&lt;executions&gt;</span>
          <span class="nt">&lt;execution&gt;</span>
            <span class="nt">&lt;id&gt;</span>deploy-to-sonatype<span class="nt">&lt;/id&gt;</span>
            <span class="nt">&lt;phase&gt;</span>deploy<span class="nt">&lt;/phase&gt;</span>
            <span class="nt">&lt;goals&gt;</span>
              <span class="nt">&lt;goal&gt;</span>deploy<span class="nt">&lt;/goal&gt;</span>
              <span class="nt">&lt;goal&gt;</span>release<span class="nt">&lt;/goal&gt;</span>
            <span class="nt">&lt;/goals&gt;</span>
          <span class="nt">&lt;/execution&gt;</span>
        <span class="nt">&lt;/executions&gt;</span>
      <span class="nt">&lt;/plugin&gt;</span>
    <span class="nt">&lt;/plugins&gt;</span>
  <span class="nt">&lt;/build&gt;</span>
<span class="nt">&lt;/project&gt;</span></code></pre></figure><h2 id="create-rultor-configuration">Create Rultor Configuration</h2><p>Create a <code>.rultor.yml</code> file in the root directory of your project (<a href="http://doc.rultor.com/reference.html">reference page</a> explains this format in details):</p><figure class="highlight"><pre><code class="language-text" data-lang="text"><span></span>decrypt:
  settings.xml: &quot;repo/settings.xml.asc&quot;
  pubring.gpg: &quot;repo/pubring.gpg.asc&quot;
  secring.gpg: &quot;repo/secring.gpg.asc&quot;
release:
  script: |
    mvn versions:set &quot;-DnewVersion=${tag}&quot;
    git commit -am &quot;${tag}&quot;
    mvn clean deploy -Pjcabi --settings /home/r/settings.xml</code></pre></figure><p>You can compare your file with live Rultor <a href="https://github.com/jcabi/jcabi-aspects/blob/master/.rultor.yml">configuration of jcabi-aspects</a>.</p><h2 id="run-it">Run It!</h2><figure class='badge'><a href='http://www.rultor.com'><img src='http://doc.rultor.com/images/logo.svg' style='width:100px;max-width:100%;' alt='badge'/></a></figure><p>Now it&#39;s time to see how it all works. Create a new ticket in the GitHub issue tracker, and post something like that into it (read more about <a href="http://doc.rultor.com/basics.html">Rultor commands</a>):</p><figure class="highlight"><pre><code class="language-text" data-lang="text"><span></span>@rultor release, tag is `0.1`</code></pre></figure><p>You will get a response in a few seconds. The rest will be done by Rultor.</p><p>Enjoy :)</p><p>BTW, if something doesn&#39;t work as I&#39;ve explained, don&#39;t hesitate to submit a ticket to <a href="https://github.com/yegor256/rultor/issues">Rultor issue tracker</a>. I will try to help you.</p><p>Yeah, forgot to mention, Rultor is also doing two important things. First, it creates a GitHub release with a proper description. Second, it posts a tweet about the release, which you can retweet, to make an announcement to your followers. Both features are very convenient for me. For example:</p><blockquote class="twitter-tweet" lang="en"><p>DynamoDB Local Maven Plugin, 0.7.1 released <a href="https://t.co/C3KULouuKS">https://t.co/C3KULouuKS</a></p>---rultor.com (@rultors) <a href="https://twitter.com/rultors/statuses/501617747269517312">August 19, 2014</a></blockquote> <script async='' src="http://platform.twitter.com/widgets.js" charset="utf-8"></script></p>--> <nav class="buttons notranslate desktop-only"> <a href="http://www.facebook.com/sharer/sharer.php?u=https://www.yegor256.com/2014/08/19/how-to-release-to-maven-central.html" title="Share on Facebook" class="button" rel="nofollow"> <span class="count count-facebook">0</span> <i class="icon icon-facebook notranslate" aria-hidden="true"></i> </a> <a href="https://twitter.com/share?url=https://www.yegor256.com/2014/08/19/how-to-release-to-maven-central.html&amp;text=How+to+Release+to+Maven+Central%2C+in+One+Click" title="Share on Twitter" class="button" rel="nofollow"> <span class="count count-twitter">0</span> <i class="icon icon-twitter notranslate" aria-hidden="true"></i> </a> <a href="https://plus.google.com/share?url=https://www.yegor256.com/2014/08/19/how-to-release-to-maven-central.html" title="Share on Google+" class="button" rel="nofollow"> <span class="count count-googleplus">0</span> <i class="icon icon-googleplus notranslate" aria-hidden="true"></i> </a> <a href="https://www.linkedin.com/cws/share?url=https://www.yegor256.com/2014/08/19/how-to-release-to-maven-central.html" title="Share on LinkedIn" class="button" rel="nofollow"> <span class="count count-linkedin">0</span> <i class="icon icon-linkedin notranslate" aria-hidden="true"></i> </a> <a href="http://reddit.com/submit?url=https://www.yegor256.com/2014/08/19/how-to-release-to-maven-central.html%3F2014-33&amp;title=How+to+Release+to+Maven+Central%2C+in+One+Click" title="Share on Reddit" class="button" rel="nofollow"> <span class="count count-reddit">0</span> <i class="icon icon-reddit notranslate" aria-hidden="true"></i> </a> <a href="http://news.ycombinator.com/submitlink?u=https://www.yegor256.com/2014/08/19/how-to-release-to-maven-central.html%3F2014-33&amp;t=How+to+Release+to+Maven+Central%2C+in+One+Click" title="Share on Hacker News" class="button" rel="nofollow"> <span class="count count-hackernews">0</span> <i class="icon icon-hackernews notranslate" aria-hidden="true"></i> </a> </nav> </header> <article class="main" itemprop="articleBody"><div ><p>When I release a new version of <a href="http://aspects.jcabi.com">jcabi-aspects</a>, a Java open source library, to Maven Central, it takes 30 seconds of my time. Maybe even less. Recently, I released version 0.17.2. You can see how it all happened, in <a href="https://github.com/jcabi/jcabi-aspects/issues/80">GitHub issue #80</a>:</p><figure class='unprintable'><img src='https://www.yegor256.com/images/2014/08/github-ticket-80.jpg' itemprop='image' style='width:600px;max-width:100%;' alt='The figure'/></figure><p>As you see, I gave a command to <a href="http://www.rultor.com">Rultor</a>, and it released a new version to Maven central. I didn&#39;t do anything else.</p><p>Now let&#39;s see how you can do the same. How you can configure your project so that the release of its new version to Maven Central takes just a few seconds of your time.</p><p>By the way, I assume that you&#39;re hosting your project in GitHub. If not, this entire tutorial won&#39;t work. If you are still not in GitHub, I would strongly recommend moving there.</p><h2 id="prepare-your-pom">Prepare Your POM</h2><aside class='youtube'> <a href='https://www.youtube.com/watch?v=rEK3Rk2lX3M'><div class='box'> <img src='https://i.ytimg.com/vi/rEK3Rk2lX3M/mqdefault.jpg' alt='YouTube video #rEK3Rk2lX3M'/><div class='play'><i class='icon icon-play'></i></div></div></a><div>Cactoos 0.12 polishing and releasing (webinar #27); 2 August 2017.</div></aside><p>Make sure your <code>pom.xml</code> contains all elements required by Sonatype, explained in <a href="http://central.sonatype.org/pages/requirements.html">Central Sync Requirements</a>. We will deploy to Sonatype, and they will synchronize all JAR (and not only) artifacts to Maven Central.</p><h2 id="register-a-project-with-sonatype">Register a Project With Sonatype</h2><p>Create an account in <a href="https://issues.sonatype.org/">Sonatype JIRA</a> and raise a ticket, asking to approve your <code>groupId</code>. This <a href="http://central.sonatype.org/pages/ossrh-guide.html">OSSRH Guide</a> explains this step in more detail.</p><h2 id="create-and-distribute-a-gpg-key">Create and Distribute a GPG Key</h2><p>Create a GPG key and distribute it, as explained in this <a href="http://central.sonatype.org/pages/working-with-pgp-signatures.html">Working with PGP Signatures</a> article.</p><p>When this step is done, you should have two files: <code>pubring.gpg</code> and <code>secring.gpg</code>.</p><h2 id="create-settings-xml">Create settings.xml</h2><p>Create <code>settings.xml</code>, next to the two <code>.gpg</code> files created in the previous step:</p><figure class="highlight"><pre><code class="language-xml" data-lang="xml"><span></span><span class="nt">&lt;settings&gt;</span>
  <span class="nt">&lt;profiles&gt;</span>
    <span class="nt">&lt;profile&gt;</span>
      <span class="nt">&lt;id&gt;</span>foo<span class="nt">&lt;/id&gt;</span> <span class="c">&lt;!-- give it the name of your project --&gt;</span>
      <span class="nt">&lt;properties&gt;</span>
        <span class="nt">&lt;gpg.homedir&gt;</span>/home/r<span class="nt">&lt;/gpg.homedir&gt;</span>
        <span class="nt">&lt;gpg.keyname&gt;</span>9A105525<span class="nt">&lt;/gpg.keyname&gt;</span>
        <span class="nt">&lt;gpg.passphrase&gt;</span>my-secret<span class="nt">&lt;/gpg.passphrase&gt;</span>
      <span class="nt">&lt;/properties&gt;</span>
    <span class="nt">&lt;/profile&gt;</span>
  <span class="nt">&lt;/profiles&gt;</span>
  <span class="nt">&lt;servers&gt;</span>
    <span class="nt">&lt;server&gt;</span>
      <span class="nt">&lt;id&gt;</span>oss.sonatype.org<span class="nt">&lt;/id&gt;</span>
      <span class="nt">&lt;username&gt;</span><span class="c">&lt;!-- Sonatype JIRA user name --&gt;</span><span class="nt">&lt;/username&gt;</span>
      <span class="nt">&lt;password&gt;</span><span class="c">&lt;!-- Sonatype JIRA pwd --&gt;</span><span class="nt">&lt;/password&gt;</span>
    <span class="nt">&lt;/server&gt;</span>
  <span class="nt">&lt;/servers&gt;</span>
<span class="nt">&lt;/settings&gt;</span></code></pre></figure><p>In this example, <code>9A105525</code> is the ID of your public key, and <code>my-secret</code> is the pass phrase you have used while generating the keys.</p><h2 id="encrypt-security-assets">Encrypt Security Assets</h2><p>Now, encrypt these three files with a <a href="https://github.com/yegor256/rultor-remote">rultor remote</a>:</p><figure class="highlight"><pre><code class="language-xml" data-lang="xml"><span></span>$ gem install rultor
$ rultor encrypt -p me/test pubring.gpg
$ rultor encrypt -p me/test secring.gpg
$ rultor encrypt -p me/test settings.xml</code></pre></figure><p>Instead of <code>me/test</code> you should use the name of your GitHub project.</p><p>You will get three new files: <code>pubring.gpg.asc</code>, <code>secring.gpg.asc</code> and <code>settings.xml.asc</code>. Add them to the root directory of your project, commit and push. The files contain your secret information, but only the Rultor server can decrypt them.</p><h2 id="add-sonatype-repositories">Add Sonatype Repositories</h2><p>I would recommend using <a href="/2015/02/05/jcabi-parent-maven-pom.html">jcabi-parent</a>, as a parent pom for your project. This will make many further steps unnecessary. If you&#39;re using jcabi-parent, skip this step.</p><p>However, if you don&#39;t use jcabi-parent, you should add these two repositories to your <code>pom.xml</code>:</p><figure class="highlight"><pre><code class="language-xml" data-lang="xml"><span></span><span class="nt">&lt;project&gt;</span>
  [...]
  <span class="nt">&lt;distributionManagement&gt;</span>
    <span class="nt">&lt;repository&gt;</span>
      <span class="nt">&lt;id&gt;</span>oss.sonatype.org<span class="nt">&lt;/id&gt;</span>
      <span class="nt">&lt;url&gt;</span>https://oss.sonatype.org/service/local/staging/deploy/maven2/<span class="nt">&lt;/url&gt;</span>
    <span class="nt">&lt;/repository&gt;</span>
    <span class="nt">&lt;snapshotRepository&gt;</span>
      <span class="nt">&lt;id&gt;</span>oss.sonatype.org<span class="nt">&lt;/id&gt;</span>
      <span class="nt">&lt;url&gt;</span>https://oss.sonatype.org/content/repositories/snapshots<span class="nt">&lt;/url&gt;</span>
    <span class="nt">&lt;/snapshotRepository&gt;</span>
  <span class="nt">&lt;/distributionManagement&gt;</span>
<span class="nt">&lt;/project&gt;</span></code></pre></figure><h2 id="configure-gpg-plugin">Configure GPG Plugin</h2><p>Again, I&#39;d recommend using <a href="http://parent.jcabi.com">jcabi-parent</a>, which configures this plugin automatically. If you&#39;re using it, skip this step.</p><p>Otherwise, add this plugin to your <code>pom.xml</code>:</p><figure class="highlight"><pre><code class="language-xml" data-lang="xml"><span></span><span class="nt">&lt;project&gt;</span>
  [..]
  <span class="nt">&lt;build&gt;</span>
    [..]
    <span class="nt">&lt;plugins&gt;</span>
      [..]
      <span class="nt">&lt;plugin&gt;</span>
        <span class="nt">&lt;artifactId&gt;</span>maven-gpg-plugin<span class="nt">&lt;/artifactId&gt;</span>
        <span class="nt">&lt;version&gt;</span>1.5<span class="nt">&lt;/version&gt;</span>
        <span class="nt">&lt;executions&gt;</span>
          <span class="nt">&lt;execution&gt;</span>
            <span class="nt">&lt;id&gt;</span>sign-artifacts<span class="nt">&lt;/id&gt;</span>
            <span class="nt">&lt;phase&gt;</span>verify<span class="nt">&lt;/phase&gt;</span>
            <span class="nt">&lt;goals&gt;</span>
              <span class="nt">&lt;goal&gt;</span>sign<span class="nt">&lt;/goal&gt;</span>
            <span class="nt">&lt;/goals&gt;</span>
          <span class="nt">&lt;/execution&gt;</span>
        <span class="nt">&lt;/executions&gt;</span>
      <span class="nt">&lt;/plugin&gt;</span>
    <span class="nt">&lt;/plugins&gt;</span>
  <span class="nt">&lt;/build&gt;</span>
<span class="nt">&lt;/project&gt;</span></code></pre></figure><h2 id="configure-versions-plugin">Configure Versions Plugin</h2><p>Once again, I recommend using <a href="/2015/02/05/jcabi-parent-maven-pom.html">http://parent.jcabi.com</a>. It configures all required plugins out-of-the-box. If you&#39;re using it, skip this step.</p><p>Otherwise, add this plugin to your <code>pom.xml</code>:</p><figure class="highlight"><pre><code class="language-xml" data-lang="xml"><span></span><span class="nt">&lt;project&gt;</span>
  [..]
  <span class="nt">&lt;build&gt;</span>
    [..]
    <span class="nt">&lt;plugins&gt;</span>
      [..]
      <span class="nt">&lt;plugin&gt;</span>
        <span class="nt">&lt;groupId&gt;</span>org.codehaus.mojo<span class="nt">&lt;/groupId&gt;</span>
        <span class="nt">&lt;artifactId&gt;</span>versions-maven-plugin<span class="nt">&lt;/artifactId&gt;</span>
        <span class="nt">&lt;version&gt;</span>2.1<span class="nt">&lt;/version&gt;</span>
        <span class="nt">&lt;configuration&gt;</span>
          <span class="nt">&lt;generateBackupPoms&gt;</span>false<span class="nt">&lt;/generateBackupPoms&gt;</span>
        <span class="nt">&lt;/configuration&gt;</span>
      <span class="nt">&lt;/plugin&gt;</span>
    <span class="nt">&lt;/plugins&gt;</span>
  <span class="nt">&lt;/build&gt;</span>
<span class="nt">&lt;/project&gt;</span></code></pre></figure><h2 id="configure-sonatype-plugin">Configure Sonatype Plugin</h2><p>Yes, you&#39;re right, <a href="/2015/02/05/jcabi-parent-maven-pom.html">http://parent.jcabi.com</a> will help you here as well. If you&#39;re using it, skip this step too.</p><p>Otherwise, add these four plugins to your <code>pom.xml</code>:</p><figure class="highlight"><pre><code class="language-xml" data-lang="xml"><span></span><span class="nt">&lt;project&gt;</span>
  [..]
  <span class="nt">&lt;build&gt;</span>
    [..]
    <span class="nt">&lt;plugins&gt;</span>
      [..]
      <span class="nt">&lt;plugin&gt;</span>
        <span class="nt">&lt;artifactId&gt;</span>maven-deploy-plugin<span class="nt">&lt;/artifactId&gt;</span>
        <span class="nt">&lt;configuration&gt;</span>
          <span class="nt">&lt;skip&gt;</span>true<span class="nt">&lt;/skip&gt;</span>
        <span class="nt">&lt;/configuration&gt;</span>
      <span class="nt">&lt;/plugin&gt;</span>
      <span class="nt">&lt;plugin&gt;</span>
        <span class="nt">&lt;artifactId&gt;</span>maven-source-plugin<span class="nt">&lt;/artifactId&gt;</span>
        <span class="nt">&lt;executions&gt;</span>
          <span class="nt">&lt;execution&gt;</span>
            <span class="nt">&lt;id&gt;</span>package-sources<span class="nt">&lt;/id&gt;</span>
            <span class="nt">&lt;goals&gt;</span>
              <span class="nt">&lt;goal&gt;</span>jar<span class="nt">&lt;/goal&gt;</span>
            <span class="nt">&lt;/goals&gt;</span>
          <span class="nt">&lt;/execution&gt;</span>
        <span class="nt">&lt;/executions&gt;</span>
      <span class="nt">&lt;/plugin&gt;</span>
      <span class="nt">&lt;plugin&gt;</span>
        <span class="nt">&lt;artifactId&gt;</span>maven-javadoc-plugin<span class="nt">&lt;/artifactId&gt;</span>
        <span class="nt">&lt;executions&gt;</span>
          <span class="nt">&lt;execution&gt;</span>
            <span class="nt">&lt;id&gt;</span>package-javadoc<span class="nt">&lt;/id&gt;</span>
            <span class="nt">&lt;phase&gt;</span>package<span class="nt">&lt;/phase&gt;</span>
            <span class="nt">&lt;goals&gt;</span>
              <span class="nt">&lt;goal&gt;</span>jar<span class="nt">&lt;/goal&gt;</span>
            <span class="nt">&lt;/goals&gt;</span>
          <span class="nt">&lt;/execution&gt;</span>
        <span class="nt">&lt;/executions&gt;</span>
      <span class="nt">&lt;/plugin&gt;</span>
      <span class="nt">&lt;plugin&gt;</span>
        <span class="nt">&lt;groupId&gt;</span>org.sonatype.plugins<span class="nt">&lt;/groupId&gt;</span>
        <span class="nt">&lt;artifactId&gt;</span>nexus-staging-maven-plugin<span class="nt">&lt;/artifactId&gt;</span>
        <span class="nt">&lt;version&gt;</span>1.6<span class="nt">&lt;/version&gt;</span>
        <span class="nt">&lt;extensions&gt;</span>true<span class="nt">&lt;/extensions&gt;</span>
        <span class="nt">&lt;configuration&gt;</span>
          <span class="nt">&lt;serverId&gt;</span>oss.sonatype.org<span class="nt">&lt;/serverId&gt;</span>
          <span class="nt">&lt;nexusUrl&gt;</span>https://oss.sonatype.org/<span class="nt">&lt;/nexusUrl&gt;</span>
          <span class="nt">&lt;description&gt;</span>${project.version}<span class="nt">&lt;/description&gt;</span>
        <span class="nt">&lt;/configuration&gt;</span>
        <span class="nt">&lt;executions&gt;</span>
          <span class="nt">&lt;execution&gt;</span>
            <span class="nt">&lt;id&gt;</span>deploy-to-sonatype<span class="nt">&lt;/id&gt;</span>
            <span class="nt">&lt;phase&gt;</span>deploy<span class="nt">&lt;/phase&gt;</span>
            <span class="nt">&lt;goals&gt;</span>
              <span class="nt">&lt;goal&gt;</span>deploy<span class="nt">&lt;/goal&gt;</span>
              <span class="nt">&lt;goal&gt;</span>release<span class="nt">&lt;/goal&gt;</span>
            <span class="nt">&lt;/goals&gt;</span>
          <span class="nt">&lt;/execution&gt;</span>
        <span class="nt">&lt;/executions&gt;</span>
      <span class="nt">&lt;/plugin&gt;</span>
    <span class="nt">&lt;/plugins&gt;</span>
  <span class="nt">&lt;/build&gt;</span>
<span class="nt">&lt;/project&gt;</span></code></pre></figure><h2 id="create-rultor-configuration">Create Rultor Configuration</h2><p>Create a <code>.rultor.yml</code> file in the root directory of your project (<a href="http://doc.rultor.com/reference.html">reference page</a> explains this format in details):</p><figure class="highlight"><pre><code class="language-text" data-lang="text"><span></span>decrypt:
  settings.xml: &quot;repo/settings.xml.asc&quot;
  pubring.gpg: &quot;repo/pubring.gpg.asc&quot;
  secring.gpg: &quot;repo/secring.gpg.asc&quot;
release:
  script: |
    mvn versions:set &quot;-DnewVersion=${tag}&quot;
    git commit -am &quot;${tag}&quot;
    mvn clean deploy -Pjcabi --settings /home/r/settings.xml</code></pre></figure><p>You can compare your file with live Rultor <a href="https://github.com/jcabi/jcabi-aspects/blob/master/.rultor.yml">configuration of jcabi-aspects</a>.</p><h2 id="run-it">Run It!</h2><figure class='badge'><a href='http://www.rultor.com'><img src='http://doc.rultor.com/images/logo.svg' style='width:100px;max-width:100%;' alt='badge'/></a></figure><p>Now it&#39;s time to see how it all works. Create a new ticket in the GitHub issue tracker, and post something like that into it (read more about <a href="http://doc.rultor.com/basics.html">Rultor commands</a>):</p><figure class="highlight"><pre><code class="language-text" data-lang="text"><span></span>@rultor release, tag is `0.1`</code></pre></figure><p>You will get a response in a few seconds. The rest will be done by Rultor.</p><p>Enjoy :)</p><p>BTW, if something doesn&#39;t work as I&#39;ve explained, don&#39;t hesitate to submit a ticket to <a href="https://github.com/yegor256/rultor/issues">Rultor issue tracker</a>. I will try to help you.</p><p>Yeah, forgot to mention, Rultor is also doing two important things. First, it creates a GitHub release with a proper description. Second, it posts a tweet about the release, which you can retweet, to make an announcement to your followers. Both features are very convenient for me. For example:</p><blockquote class="twitter-tweet" lang="en"><p>DynamoDB Local Maven Plugin, 0.7.1 released <a href="https://t.co/C3KULouuKS">https://t.co/C3KULouuKS</a></p>---rultor.com (@rultors) <a href="https://twitter.com/rultors/statuses/501617747269517312">August 19, 2014</a></blockquote> <script async='' src="http://platform.twitter.com/widgets.js" charset="utf-8"></script></div></article></div><div class="wrapper"> <related-posts /></div><div class="disqus" role="complementary"><p class="disqus_hint"> Please, use <a href="https://help.disqus.com/commenting/what-html-tags-are-allowed-within-comments">syntax highlighting</a> in your comments, to make them more readable.</p><div id="disqus_thread" class="disqus-thread"> <a>&nbsp;</a></div><script> var disqus_config = function () { this.page.url = document.location.href.split('?')[0].split('#')[0].replace('https://', 'http://'); this.page.identifier = this.page.url; }; (function() { var d = document, s = d.createElement('script'); s.src = '//yegor256.disqus.com/embed.js'; s.setAttribute('data-timestamp', +new Date()); (d.head || d.body).appendChild(s); })(); </script> <noscript><div><p class="red"> JavaScript is disabled in your browser, that's why you can't see comments under this post.</p></div></noscript></div><div class="wrapper"> <footer class="footer"><p> &copy; <span itemscope="" itemprop="copyrightHolder" itemtype="http://schema.org/Person"> <span itemprop="name">Yegor Bugayenko</span> </span> 2014&ndash;<span itemprop="copyrightYear">2018</span></p></footer></div></section><div class="wrapper unprintable" style="text-align:center;margin-top:2em;"> <a href="http://www.sixnines.io/h/3ba1652f"> <img src="//www.sixnines.io/b/3ba1652f?style=flat" alt="sixnines availability badge"/> </a></div><script src="//code.jquery.com/jquery-1.9.0.min.js"></script> <script src="/js/all.js?4e047f6f42b"></script> <script>var disqus_shortname = 'yegor256';</script> <script id="dsq-count-scr" src="//yegor256.disqus.com/count.js" async="async"></script> <script> (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){ (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o), m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m) })(window,document,'script','//www.google-analytics.com/analytics.js','ga'); ga('create', 'UA-1963507-32', 'auto'); ga('send', 'pageview'); </script> <script> Cd=document;Cr="&"+Math.random();Cp="&s=1"; Cd.cookie="b=b";if(Cd.cookie)Cp+="&c=1"; Cp+="&t="+(new Date()).getTimezoneOffset(); if(self!=top)Cp+="&f=1"; </script> <script> if(navigator.javaEnabled())Cp+="&j=1"; </script> <script> if(typeof(screen)!='undefined')Cp+="&w="+screen.width+"&h="+ screen.height+"&d="+(screen.colorDepth?screen.colorDepth:screen.pixelDepth); </script> <script> Cd.write("<img src='//c.hit.ua/hit?i=95870&g=0&x=2"+Cp+Cr+ "&r="+escape(Cd.referrer)+"&u="+escape(window.location.href)+ "' border='0' wi"+"dth='1' he"+"ight='1'/>"); </script> <script type="application/ld+json"> { "@context": "http://schema.org", "@type": "Person", "name": "Yegor Bugayenko", "url": "http://www.yegor256.com", "sameAs": [ "https://www.facebook.com/yegor256", "https://instagram.com/yegor256", "https://www.linkedin.com/in/yegor256", "https://twitter.com/yegor256", "https://github.com/yegor256", "https://www.pinterest.com/yegor256/" ] } </script> </body> </html> <!DOCTYPE html> <html xmlns="http://www.w3.org/1999/xhtml" lang="en-US" xml:lang="en-US" itemscope="" itemtype="http://schema.org/WebSite"> <head> <meta charset="utf-8"/> <meta name="description" content="jcabi-jdbc is a fluent wrapper of JDBC, making interaction with relational databases easier and much less verbose " /> <meta name="keywords" content="jdbc fluent wrapper, jdbc wrapper, jdbc wrapper library, jdbc wrapper tool, lightweight jdbc wrapper" /> <meta name="viewport" content="width=device-width,minimum-scale=1,initial-scale=1"/> <meta name="google-site-verification" content="JEj_gQr2CPe2QKGw8XdMz0R7VboQIUbX3FlM-lwTq-8" /> <meta name="author" content="Yegor Bugayenko"> <meta name="article:published_time" content="2014-08-18 00:00:00 +0000"> <meta name="og:site_name" content="Yegor Bugayenko"/> <meta name="og:type" content="article" /> <meta name="og:locale" content="en_US" /> <meta name="twitter:account_id" content="4503599630178231" /> <meta name="twitter:creator" content="@yegor256"/> <meta name="twitter:site" content="@yegor256"/> <meta name="twitter:title" property="og:title" content="Fluent JDBC Decorator"/> <meta name="twitter:description" property="og:description" content="jcabi-jdbc is a fluent wrapper of JDBC, making interaction with relational databases easier and much less verbose "/> <meta name="twitter:url" property="og:url" content="https://www.yegor256.com/2014/08/18/fluent-jdbc-decorator.html"/> <meta name="telegram:channel" content="AAAAAEJFMRzsRTRxM3ec6A"/> <link rel="search" type="application/opensearchdescription+xml" href="/opensearch.xml" title="yegor256" /> <link rel="shortcut icon" href="/favicon.ico?4e047f6f42b"/> <link rel="apple-touch-icon" href="/favicon.ico?4e047f6f42b"/> <link rel="alternate" type="application/rss+xml" title="RSS for yegor256.com" href="https://www.yegor256.com/rss.xml"/> <link rel="stylesheet" href="/css/layout.css?4e047f6f42b"/> <link rel="stylesheet" href="/css/icons.css?4e047f6f42b"/> <link rel="canonical" href="https://www.yegor256.com/2014/08/18/fluent-jdbc-decorator.html" /> <link rel="amphtml" href="https://www.yegor256.com/2014/08/18/fluent-jdbc-decorator.amp.html" /> <title>Fluent JDBC Decorator </title> </head> <body><div class="wrapper"> <aside class="header-toggle unprintable" id="header-toggle" title="Show the menu" onclick="$('#header').show();$('#header-toggle').hide();">&#9776;</aside> <header class="header" id="header"><div class="face"> <a href="/about-me.html#form" class="sub" title="Click to subscribe to my monthly newsletter"><span>Subscribe</span></a> <a href="/about-me.html" style="position:relative;"> <img src="/images/face-256x256.jpg" class="photo" alt="Yegor Bugayenko"/> </a></div><nav><ul class="menu social notranslate"> <li><a href="https://twitter.com/intent/follow?screen_name=yegor256" rel="nofollow" title="Follow me on Twitter"><i class="icon icon-twitter notranslate" aria-hidden="true"></i></a></li> <li><a href="/rss.xml" rel="nofollow" title="Subscribe to my RSS feed"><i class="icon icon-rss notranslate" aria-hidden="true"></i></a></li> <li><a itemprop="sameAs" href="https://github.com/yegor256" rel="nofollow" title="My GitHub profile"><i class="icon icon-github notranslate" aria-hidden="true"></i></a></li> <li><a itemprop="sameAs" href="http://stackoverflow.com/users/187141/yegor256" rel="nofollow" title="My StackOverflow profile"><i class="icon icon-stackoverflow notranslate" aria-hidden="true"></i></a></li> <li><a itemprop="sameAs" href="https://www.facebook.com/yegor256" rel="nofollow" title="Follow me on Facebook"><i class="icon icon-facebook notranslate" aria-hidden="true"></i></a></li> <li><a itemprop="sameAs" href="https://instagram.com/yegor256" rel="nofollow" title="Follow me on Instagram"><i class="icon icon-instagram notranslate" aria-hidden="true"></i></a></li> <li><a itemprop="sameAs" href="https://www.linkedin.com/in/yegor256" rel="nofollow" title="My LinkedIn profile"><i class="icon icon-linkedin notranslate" aria-hidden="true"></i></a></li> <li><a itemprop="sameAs" href="https://www.youtube.com/c/yegor256?sub_confirmation=1" rel="nofollow" title="My Youtube video channel"><i class="icon icon-youtube notranslate" aria-hidden="true"></i></a></li> <li><a itemprop="sameAs" href="https://www.pinterest.com/yegor256/" rel="nofollow" title="My Pinterest boards"><i class="icon icon-pinterest notranslate" aria-hidden="true"></i></a></li> <li><a itemprop="sameAs" href="https://angel.co/yegor256" rel="nofollow" title="My AngelList profile"><i class="icon icon-angellist notranslate" aria-hidden="true"></i></a></li> <li><a href="https://soundcloud.com/yegor256" rel="nofollow" title="My podcast"><i class="icon icon-podcast notranslate" aria-hidden="true"></i></a></li> <li><a href="https://itunes.apple.com/us/podcast/yegor256-podcast/id1150826721" rel="nofollow" title="My iTunes podcast"><i class="icon icon-itunes notranslate" aria-hidden="true"></i></a></li> <li><a href="https://t.me/joinchat/AAAAAEJFMRzsRTRxM3ec6A" rel="nofollow" title="My Telegram public channel"><i class="icon icon-telegram notranslate" aria-hidden="true"></i></a></li> <li><a href="mailto:blog@yegor256.com" rel="nofollow" title="Email me any time"><i class="icon icon-mail notranslate" aria-hidden="true"></i></a></li></ul><ul class="menu"> <li><a href="/" title="Home page">Home</a></li> <li ><a href="/best.html" title="Best articles to read">12&#160;Best</a></li> <li ><a href="/contents.html" title="The contents of the entire blog">All&#160;288</a></li> <li ><a href="/webinars.html" title="My webinars">Webinars</a></li> <li ><a href="/talks.html" title="Future and past conference talks">Talks</a></li> <li ><a href="/books.html" title="The books I wrote">Books</a></li> <li ><a href="/papers.html" title="My academic papers and patents">Papers</a></li> <li ><a href="/pets.html" title="My loved pet projects">Pets</a></li> <li ><a href="/award.html" title="Software quality award">Award</a></li> <li ><a href="/testimonials.html" title="What some people say about me">Testimonials</a></li> <li ><a href="/shift-m.html" title="Audio podcast about project management">Shift-M</a></li> <li ><a href="/paintings.html" title="My paintings for sale">Paintings</a></li> <li><a href="http://ru.yegor256.com/" title="Немного на русском языке">По-русски</a></li></ul></nav><div class="search"> <form method="get" action="https://www.google.com/search" itemprop="potentialAction" itemscope="" itemtype="http://schema.org/SearchAction"> <meta itemprop="target" content="https://www.google.com/search?q={q}"/> <input name="sitesearch" value="yegor256.com" type="hidden"/> <input itemprop="query-input" type="text" id="search-query" class="field field-text" required="required" onfocus="$('.google').css('visibility', 'visible');" name="q" placeholder="Search..." autocomplete="off"/> <input type="image" src="/images/google-search-icon.svg" class="google" title="Search via Google" alt="Search via Google"/> </form></div><div class="hot"><ul> <li> <a href="/code-ahead.html">Code Ahead</a> was published on Amazon just a few days ago! It is my new book, a novel about programmers. It explains in details the majority of ideas that stand behind <a href="https://www.zerocracy.com">Zerocracy</a> and <a href="https://www.xdsd.org">XDSD</a>. </li> <li> At <a href="/webinars.html">Webinar #37</a> we will discuss naming problem in OOP, for objects, methods and attributes; join us on <b>September 12</b>, at 11am PST. </li></ul></div></header></div><section itemscope="" itemtype="http://schema.org/BlogPosting"><div class="wrapper"> <header><p class="printable"> <img src="https://api.qrserver.com/v1/create-qr-code/?data=https://www.yegor256.com/2014/08/18/fluent-jdbc-decorator.html&amp;format=svg" style="width:125px;height:125px;" alt="QR code"/></p><p class="printable"> <code itemprop="url">https://www.yegor256.com/2014/08/18/fluent-jdbc-decorator.html</code></p><h1 itemprop="name headline mainEntityOfPage">Fluent JDBC Decorator</h1><ul class="subline"> <li> <time itemprop="datePublished" datetime="2014-08-18T00:00:00+00:00"> 18 August 2014 </time> </li> <li class="printable" itemscope="" itemprop="author" itemtype="http://schema.org/Person"> <span itemprop="name">Yegor Bugayenko</span> </li> <li class="unprintable"> <i class="icon icon-comments"></i> <a href="http://www.yegor256.com/2014/08/18/fluent-jdbc-decorator.html#disqus_thread" itemprop="discussionUrl">comments</a> </li></ul><p><a href="http://jdbc.jcabi.com">jcabi-jdbc</a> is a lightweight wrapper of <a href="http://www.oracle.com/technetwork/java/javase/jdbc/index.html">JDBC</a>. It is very convenient to use when you don&#39;t need a full-scale <a href="/2014/12/01/orm-offensive-anti-pattern.html">ORM</a> (like Hibernate), but want just to select, insert, or update a few rows in a relational database.</p><p>Every instance of <code>JdbcSession</code> is a &quot;transaction&quot; in a database. You start it by instantiating the class with a single parameter---data source.</p><p>You can obtain the data source from your connection pool. There are many implementations of connection pools. I would recommend that you use <a href="http://www.jolbox.com/">BoneCP</a>. Below is an example of how you would connect to PostgreSQL:</p><figure class="highlight"><pre><code class="language-java" data-lang="java"><span></span><span class="nd">@Cacheable</span><span class="o">(</span><span class="n">forever</span> <span class="o">=</span> <span class="kc">true</span><span class="o">)</span>
<span class="kd">private</span> <span class="kd">static</span> <span class="n">DataSource</span> <span class="nf">source</span><span class="o">()</span> <span class="o">{</span>
  <span class="n">BoneCPDataSource</span> <span class="n">src</span> <span class="o">=</span> <span class="k">new</span> <span class="n">BoneCPDataSource</span><span class="o">();</span>
  <span class="n">src</span><span class="o">.</span><span class="na">setDriverClass</span><span class="o">(</span><span class="s">&quot;org.postgresql.Driver&quot;</span><span class="o">);</span>
  <span class="n">src</span><span class="o">.</span><span class="na">setJdbcUrl</span><span class="o">(</span><span class="s">&quot;jdbc:postgresql://localhost/db_name&quot;</span><span class="o">);</span>
  <span class="n">src</span><span class="o">.</span><span class="na">setUser</span><span class="o">(</span><span class="s">&quot;jeff&quot;</span><span class="o">);</span>
  <span class="n">src</span><span class="o">.</span><span class="na">setPassword</span><span class="o">(</span><span class="s">&quot;secret&quot;</span><span class="o">);</span>
  <span class="k">return</span> <span class="n">src</span><span class="o">;</span>
<span class="o">}</span></code></pre></figure><p>Be sure to pay attention to the <code>@Cacheable</code> annotation. <a href="/2014/08/03/cacheable-java-annotation.html">This post</a> explains how it can help you to cache Java method results for some time. Setting the <code>forever</code> attribute to <code>true</code> means that we don&#39;t want this method to be called more than once. Instead, we want the connection pool to be created just once, and every second call should return its existing instance (kind of like a <a href="/2016/02/03/design-patterns-and-anti-patterns.html">Singleton pattern</a>).</p><p><a href="http://jdbc.jcabi.com">jcabi-jdbc</a> website explains how you can <a href="http://jdbc.jcabi.com/example-insert.html">insert</a>, <a href="http://jdbc.jcabi.com/example-update.html">update</a>, or delete a row. You can also <a href="http://jdbc.jcabi.com/example-execute.html">execute any SQL statement</a>.</p><p>By default, <code>JdbcSession</code> closes the JDBC connection right after the first select/update/insert operation. Simply put, it is designed to be used mainly for single atomic transactions. However, it is possible to leave the connection open and continue, for example:</p><figure class="highlight"><pre><code class="language-java" data-lang="java"><span></span><span class="k">new</span> <span class="n">JdbcSession</span><span class="o">(</span><span class="n">source</span><span class="o">)</span>
  <span class="o">.</span><span class="na">autocommit</span><span class="o">(</span><span class="kc">false</span><span class="o">)</span>
  <span class="o">.</span><span class="na">sql</span><span class="o">(</span><span class="s">&quot;START TRANSACTION&quot;</span><span class="o">)</span>
  <span class="o">.</span><span class="na">update</span><span class="o">()</span>
  <span class="o">.</span><span class="na">sql</span><span class="o">(</span><span class="s">&quot;DELETE FROM employee WHERE name = ?&quot;</span><span class="o">)</span>
  <span class="o">.</span><span class="na">set</span><span class="o">(</span><span class="s">&quot;Jeff Lebowski&quot;</span><span class="o">)</span>
  <span class="o">.</span><span class="na">update</span><span class="o">()</span>
  <span class="o">.</span><span class="na">sql</span><span class="o">(</span><span class="s">&quot;INSERT INTO employee VALUES (?)&quot;</span><span class="o">)</span>
  <span class="o">.</span><span class="na">set</span><span class="o">(</span><span class="s">&quot;Walter Sobchak&quot;</span><span class="o">)</span>
  <span class="o">.</span><span class="na">insert</span><span class="o">(</span><span class="n">Outcome</span><span class="o">.</span><span class="na">VOID</span><span class="o">)</span>
  <span class="o">.</span><span class="na">commit</span><span class="o">();</span></code></pre></figure><p>In this example we&#39;re executing three SQL statements one by one, leaving connection (and transaction) open until <code>commit()</code> is called.</p></p>--> <nav class="buttons notranslate desktop-only"> <a href="http://www.facebook.com/sharer/sharer.php?u=https://www.yegor256.com/2014/08/18/fluent-jdbc-decorator.html" title="Share on Facebook" class="button" rel="nofollow"> <span class="count count-facebook">0</span> <i class="icon icon-facebook notranslate" aria-hidden="true"></i> </a> <a href="https://twitter.com/share?url=https://www.yegor256.com/2014/08/18/fluent-jdbc-decorator.html&amp;text=Fluent+JDBC+Decorator" title="Share on Twitter" class="button" rel="nofollow"> <span class="count count-twitter">0</span> <i class="icon icon-twitter notranslate" aria-hidden="true"></i> </a> <a href="https://plus.google.com/share?url=https://www.yegor256.com/2014/08/18/fluent-jdbc-decorator.html" title="Share on Google+" class="button" rel="nofollow"> <span class="count count-googleplus">0</span> <i class="icon icon-googleplus notranslate" aria-hidden="true"></i> </a> <a href="https://www.linkedin.com/cws/share?url=https://www.yegor256.com/2014/08/18/fluent-jdbc-decorator.html" title="Share on LinkedIn" class="button" rel="nofollow"> <span class="count count-linkedin">0</span> <i class="icon icon-linkedin notranslate" aria-hidden="true"></i> </a> <a href="http://reddit.com/submit?url=https://www.yegor256.com/2014/08/18/fluent-jdbc-decorator.html%3F2014-33&amp;title=Fluent+JDBC+Decorator" title="Share on Reddit" class="button" rel="nofollow"> <span class="count count-reddit">0</span> <i class="icon icon-reddit notranslate" aria-hidden="true"></i> </a> <a href="http://news.ycombinator.com/submitlink?u=https://www.yegor256.com/2014/08/18/fluent-jdbc-decorator.html%3F2014-33&amp;t=Fluent+JDBC+Decorator" title="Share on Hacker News" class="button" rel="nofollow"> <span class="count count-hackernews">0</span> <i class="icon icon-hackernews notranslate" aria-hidden="true"></i> </a> </nav> </header> <article class="main" itemprop="articleBody"><div > <figure class='badge'><a href='http://aspects.jcabi.com'><img src='http://img.jcabi.com/logo-square.svg' style='width:64px;max-width:100%;' alt='badge'/></a></figure><p>This is how you fetch text from a SQL table with <a href="http://jdbc.jcabi.com">jcabi-jdbc</a>:</p><figure class="highlight"><pre><code class="language-java" data-lang="java"><span></span><span class="n">String</span> <span class="n">name</span> <span class="o">=</span> <span class="k">new</span> <span class="n">JdbcSession</span><span class="o">(</span><span class="n">source</span><span class="o">)</span>
  <span class="o">.</span><span class="na">sql</span><span class="o">(</span><span class="s">&quot;SELECT name FROM employee WHERE id = ?&quot;</span><span class="o">)</span>
  <span class="o">.</span><span class="na">set</span><span class="o">(</span><span class="mi">1234</span><span class="o">)</span>
  <span class="o">.</span><span class="na">select</span><span class="o">(</span><span class="k">new</span> <span class="n">SingleOutcome</span><span class="o">&lt;</span><span class="n">String</span><span class="o">&gt;(</span><span class="n">String</span><span class="o">.</span><span class="na">class</span><span class="o">));</span></code></pre></figure><p>Simple and straight forward, isn&#39;t it? The library simplifies interaction with relational databases via JDBC, avoiding the need to use <a href="/2014/12/01/orm-offensive-anti-pattern.html">ORM</a>.</p><p><a href="http://jdbc.jcabi.com">jcabi-jdbc</a> is a lightweight wrapper of <a href="http://www.oracle.com/technetwork/java/javase/jdbc/index.html">JDBC</a>. It is very convenient to use when you don&#39;t need a full-scale <a href="/2014/12/01/orm-offensive-anti-pattern.html">ORM</a> (like Hibernate), but want just to select, insert, or update a few rows in a relational database.</p><p>Every instance of <code>JdbcSession</code> is a &quot;transaction&quot; in a database. You start it by instantiating the class with a single parameter---data source.</p><p>You can obtain the data source from your connection pool. There are many implementations of connection pools. I would recommend that you use <a href="http://www.jolbox.com/">BoneCP</a>. Below is an example of how you would connect to PostgreSQL:</p><figure class="highlight"><pre><code class="language-java" data-lang="java"><span></span><span class="nd">@Cacheable</span><span class="o">(</span><span class="n">forever</span> <span class="o">=</span> <span class="kc">true</span><span class="o">)</span>
<span class="kd">private</span> <span class="kd">static</span> <span class="n">DataSource</span> <span class="nf">source</span><span class="o">()</span> <span class="o">{</span>
  <span class="n">BoneCPDataSource</span> <span class="n">src</span> <span class="o">=</span> <span class="k">new</span> <span class="n">BoneCPDataSource</span><span class="o">();</span>
  <span class="n">src</span><span class="o">.</span><span class="na">setDriverClass</span><span class="o">(</span><span class="s">&quot;org.postgresql.Driver&quot;</span><span class="o">);</span>
  <span class="n">src</span><span class="o">.</span><span class="na">setJdbcUrl</span><span class="o">(</span><span class="s">&quot;jdbc:postgresql://localhost/db_name&quot;</span><span class="o">);</span>
  <span class="n">src</span><span class="o">.</span><span class="na">setUser</span><span class="o">(</span><span class="s">&quot;jeff&quot;</span><span class="o">);</span>
  <span class="n">src</span><span class="o">.</span><span class="na">setPassword</span><span class="o">(</span><span class="s">&quot;secret&quot;</span><span class="o">);</span>
  <span class="k">return</span> <span class="n">src</span><span class="o">;</span>
<span class="o">}</span></code></pre></figure><p>Be sure to pay attention to the <code>@Cacheable</code> annotation. <a href="/2014/08/03/cacheable-java-annotation.html">This post</a> explains how it can help you to cache Java method results for some time. Setting the <code>forever</code> attribute to <code>true</code> means that we don&#39;t want this method to be called more than once. Instead, we want the connection pool to be created just once, and every second call should return its existing instance (kind of like a <a href="/2016/02/03/design-patterns-and-anti-patterns.html">Singleton pattern</a>).</p><p><a href="http://jdbc.jcabi.com">jcabi-jdbc</a> website explains how you can <a href="http://jdbc.jcabi.com/example-insert.html">insert</a>, <a href="http://jdbc.jcabi.com/example-update.html">update</a>, or delete a row. You can also <a href="http://jdbc.jcabi.com/example-execute.html">execute any SQL statement</a>.</p><p>By default, <code>JdbcSession</code> closes the JDBC connection right after the first select/update/insert operation. Simply put, it is designed to be used mainly for single atomic transactions. However, it is possible to leave the connection open and continue, for example:</p><figure class="highlight"><pre><code class="language-java" data-lang="java"><span></span><span class="k">new</span> <span class="n">JdbcSession</span><span class="o">(</span><span class="n">source</span><span class="o">)</span>
  <span class="o">.</span><span class="na">autocommit</span><span class="o">(</span><span class="kc">false</span><span class="o">)</span>
  <span class="o">.</span><span class="na">sql</span><span class="o">(</span><span class="s">&quot;START TRANSACTION&quot;</span><span class="o">)</span>
  <span class="o">.</span><span class="na">update</span><span class="o">()</span>
  <span class="o">.</span><span class="na">sql</span><span class="o">(</span><span class="s">&quot;DELETE FROM employee WHERE name = ?&quot;</span><span class="o">)</span>
  <span class="o">.</span><span class="na">set</span><span class="o">(</span><span class="s">&quot;Jeff Lebowski&quot;</span><span class="o">)</span>
  <span class="o">.</span><span class="na">update</span><span class="o">()</span>
  <span class="o">.</span><span class="na">sql</span><span class="o">(</span><span class="s">&quot;INSERT INTO employee VALUES (?)&quot;</span><span class="o">)</span>
  <span class="o">.</span><span class="na">set</span><span class="o">(</span><span class="s">&quot;Walter Sobchak&quot;</span><span class="o">)</span>
  <span class="o">.</span><span class="na">insert</span><span class="o">(</span><span class="n">Outcome</span><span class="o">.</span><span class="na">VOID</span><span class="o">)</span>
  <span class="o">.</span><span class="na">commit</span><span class="o">();</span></code></pre></figure><p>In this example we&#39;re executing three SQL statements one by one, leaving connection (and transaction) open until <code>commit()</code> is called.</p></div></article></div><div class="wrapper"> <related-posts /></div><div class="disqus" role="complementary"><p class="disqus_hint"> Please, use <a href="https://help.disqus.com/commenting/what-html-tags-are-allowed-within-comments">syntax highlighting</a> in your comments, to make them more readable.</p><div id="disqus_thread" class="disqus-thread"> <a>&nbsp;</a></div><script> var disqus_config = function () { this.page.url = document.location.href.split('?')[0].split('#')[0].replace('https://', 'http://'); this.page.identifier = this.page.url; }; (function() { var d = document, s = d.createElement('script'); s.src = '//yegor256.disqus.com/embed.js'; s.setAttribute('data-timestamp', +new Date()); (d.head || d.body).appendChild(s); })(); </script> <noscript><div><p class="red"> JavaScript is disabled in your browser, that's why you can't see comments under this post.</p></div></noscript></div><div class="wrapper"> <footer class="footer"><p> &copy; <span itemscope="" itemprop="copyrightHolder" itemtype="http://schema.org/Person"> <span itemprop="name">Yegor Bugayenko</span> </span> 2014&ndash;<span itemprop="copyrightYear">2018</span></p></footer></div></section><div class="wrapper unprintable" style="text-align:center;margin-top:2em;"> <a href="http://www.sixnines.io/h/3ba1652f"> <img src="//www.sixnines.io/b/3ba1652f?style=flat" alt="sixnines availability badge"/> </a></div><script src="//code.jquery.com/jquery-1.9.0.min.js"></script> <script src="/js/all.js?4e047f6f42b"></script> <script>var disqus_shortname = 'yegor256';</script> <script id="dsq-count-scr" src="//yegor256.disqus.com/count.js" async="async"></script> <script> (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){ (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o), m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m) })(window,document,'script','//www.google-analytics.com/analytics.js','ga'); ga('create', 'UA-1963507-32', 'auto'); ga('send', 'pageview'); </script> <script> Cd=document;Cr="&"+Math.random();Cp="&s=1"; Cd.cookie="b=b";if(Cd.cookie)Cp+="&c=1"; Cp+="&t="+(new Date()).getTimezoneOffset(); if(self!=top)Cp+="&f=1"; </script> <script> if(navigator.javaEnabled())Cp+="&j=1"; </script> <script> if(typeof(screen)!='undefined')Cp+="&w="+screen.width+"&h="+ screen.height+"&d="+(screen.colorDepth?screen.colorDepth:screen.pixelDepth); </script> <script> Cd.write("<img src='//c.hit.ua/hit?i=95870&g=0&x=2"+Cp+Cr+ "&r="+escape(Cd.referrer)+"&u="+escape(window.location.href)+ "' border='0' wi"+"dth='1' he"+"ight='1'/>"); </script> <script type="application/ld+json"> { "@context": "http://schema.org", "@type": "Person", "name": "Yegor Bugayenko", "url": "http://www.yegor256.com", "sameAs": [ "https://www.facebook.com/yegor256", "https://instagram.com/yegor256", "https://www.linkedin.com/in/yegor256", "https://twitter.com/yegor256", "https://github.com/yegor256", "https://www.pinterest.com/yegor256/" ] } </script> </body> </html> <!DOCTYPE html> <html xmlns="http://www.w3.org/1999/xhtml" lang="en-US" xml:lang="en-US" itemscope="" itemtype="http://schema.org/WebSite"> <head> <meta charset="utf-8"/> <meta name="description" content="@RetryOnFailure annotation from jcabi-aspects allows you to retry a Java method call a few times before throwing an exception " /> <meta name="keywords" content="aop retry method call, aspectjs retry method call, java method re-run, java retry method call, retry method call in java" /> <meta name="viewport" content="width=device-width,minimum-scale=1,initial-scale=1"/> <meta name="google-site-verification" content="JEj_gQr2CPe2QKGw8XdMz0R7VboQIUbX3FlM-lwTq-8" /> <meta name="author" content="Yegor Bugayenko"> <meta name="article:published_time" content="2014-08-15 00:00:00 +0000"> <meta name="og:site_name" content="Yegor Bugayenko"/> <meta name="og:type" content="article" /> <meta name="og:locale" content="en_US" /> <meta name="twitter:account_id" content="4503599630178231" /> <meta name="twitter:creator" content="@yegor256"/> <meta name="twitter:site" content="@yegor256"/> <meta name="twitter:title" property="og:title" content="How to Retry Java Method Call on Exception"/> <meta name="twitter:description" property="og:description" content="@RetryOnFailure annotation from jcabi-aspects allows you to retry a Java method call a few times before throwing an exception "/> <meta name="twitter:url" property="og:url" content="https://www.yegor256.com/2014/08/15/retry-java-method-on-exception.html"/> <meta name="telegram:channel" content="AAAAAEJFMRzsRTRxM3ec6A"/> <link rel="search" type="application/opensearchdescription+xml" href="/opensearch.xml" title="yegor256" /> <link rel="shortcut icon" href="/favicon.ico?4e047f6f42b"/> <link rel="apple-touch-icon" href="/favicon.ico?4e047f6f42b"/> <link rel="alternate" type="application/rss+xml" title="RSS for yegor256.com" href="https://www.yegor256.com/rss.xml"/> <link rel="stylesheet" href="/css/layout.css?4e047f6f42b"/> <link rel="stylesheet" href="/css/icons.css?4e047f6f42b"/> <link rel="canonical" href="https://www.yegor256.com/2014/08/15/retry-java-method-on-exception.html" /> <link rel="amphtml" href="https://www.yegor256.com/2014/08/15/retry-java-method-on-exception.amp.html" /> <title>How to Retry Java Method Call on Exception </title> </head> <body><div class="wrapper"> <aside class="header-toggle unprintable" id="header-toggle" title="Show the menu" onclick="$('#header').show();$('#header-toggle').hide();">&#9776;</aside> <header class="header" id="header"><div class="face"> <a href="/about-me.html#form" class="sub" title="Click to subscribe to my monthly newsletter"><span>Subscribe</span></a> <a href="/about-me.html" style="position:relative;"> <img src="/images/face-256x256.jpg" class="photo" alt="Yegor Bugayenko"/> </a></div><nav><ul class="menu social notranslate"> <li><a href="https://twitter.com/intent/follow?screen_name=yegor256" rel="nofollow" title="Follow me on Twitter"><i class="icon icon-twitter notranslate" aria-hidden="true"></i></a></li> <li><a href="/rss.xml" rel="nofollow" title="Subscribe to my RSS feed"><i class="icon icon-rss notranslate" aria-hidden="true"></i></a></li> <li><a itemprop="sameAs" href="https://github.com/yegor256" rel="nofollow" title="My GitHub profile"><i class="icon icon-github notranslate" aria-hidden="true"></i></a></li> <li><a itemprop="sameAs" href="http://stackoverflow.com/users/187141/yegor256" rel="nofollow" title="My StackOverflow profile"><i class="icon icon-stackoverflow notranslate" aria-hidden="true"></i></a></li> <li><a itemprop="sameAs" href="https://www.facebook.com/yegor256" rel="nofollow" title="Follow me on Facebook"><i class="icon icon-facebook notranslate" aria-hidden="true"></i></a></li> <li><a itemprop="sameAs" href="https://instagram.com/yegor256" rel="nofollow" title="Follow me on Instagram"><i class="icon icon-instagram notranslate" aria-hidden="true"></i></a></li> <li><a itemprop="sameAs" href="https://www.linkedin.com/in/yegor256" rel="nofollow" title="My LinkedIn profile"><i class="icon icon-linkedin notranslate" aria-hidden="true"></i></a></li> <li><a itemprop="sameAs" href="https://www.youtube.com/c/yegor256?sub_confirmation=1" rel="nofollow" title="My Youtube video channel"><i class="icon icon-youtube notranslate" aria-hidden="true"></i></a></li> <li><a itemprop="sameAs" href="https://www.pinterest.com/yegor256/" rel="nofollow" title="My Pinterest boards"><i class="icon icon-pinterest notranslate" aria-hidden="true"></i></a></li> <li><a itemprop="sameAs" href="https://angel.co/yegor256" rel="nofollow" title="My AngelList profile"><i class="icon icon-angellist notranslate" aria-hidden="true"></i></a></li> <li><a href="https://soundcloud.com/yegor256" rel="nofollow" title="My podcast"><i class="icon icon-podcast notranslate" aria-hidden="true"></i></a></li> <li><a href="https://itunes.apple.com/us/podcast/yegor256-podcast/id1150826721" rel="nofollow" title="My iTunes podcast"><i class="icon icon-itunes notranslate" aria-hidden="true"></i></a></li> <li><a href="https://t.me/joinchat/AAAAAEJFMRzsRTRxM3ec6A" rel="nofollow" title="My Telegram public channel"><i class="icon icon-telegram notranslate" aria-hidden="true"></i></a></li> <li><a href="mailto:blog@yegor256.com" rel="nofollow" title="Email me any time"><i class="icon icon-mail notranslate" aria-hidden="true"></i></a></li></ul><ul class="menu"> <li><a href="/" title="Home page">Home</a></li> <li ><a href="/best.html" title="Best articles to read">12&#160;Best</a></li> <li ><a href="/contents.html" title="The contents of the entire blog">All&#160;288</a></li> <li ><a href="/webinars.html" title="My webinars">Webinars</a></li> <li ><a href="/talks.html" title="Future and past conference talks">Talks</a></li> <li ><a href="/books.html" title="The books I wrote">Books</a></li> <li ><a href="/papers.html" title="My academic papers and patents">Papers</a></li> <li ><a href="/pets.html" title="My loved pet projects">Pets</a></li> <li ><a href="/award.html" title="Software quality award">Award</a></li> <li ><a href="/testimonials.html" title="What some people say about me">Testimonials</a></li> <li ><a href="/shift-m.html" title="Audio podcast about project management">Shift-M</a></li> <li ><a href="/paintings.html" title="My paintings for sale">Paintings</a></li> <li><a href="http://ru.yegor256.com/" title="Немного на русском языке">По-русски</a></li></ul></nav><div class="search"> <form method="get" action="https://www.google.com/search" itemprop="potentialAction" itemscope="" itemtype="http://schema.org/SearchAction"> <meta itemprop="target" content="https://www.google.com/search?q={q}"/> <input name="sitesearch" value="yegor256.com" type="hidden"/> <input itemprop="query-input" type="text" id="search-query" class="field field-text" required="required" onfocus="$('.google').css('visibility', 'visible');" name="q" placeholder="Search..." autocomplete="off"/> <input type="image" src="/images/google-search-icon.svg" class="google" title="Search via Google" alt="Search via Google"/> </form></div><div class="hot"><ul> <li> <a href="/code-ahead.html">Code Ahead</a> was published on Amazon just a few days ago! It is my new book, a novel about programmers. It explains in details the majority of ideas that stand behind <a href="https://www.zerocracy.com">Zerocracy</a> and <a href="https://www.xdsd.org">XDSD</a>. </li> <li> At <a href="/webinars.html">Webinar #37</a> we will discuss naming problem in OOP, for objects, methods and attributes; join us on <b>September 12</b>, at 11am PST. </li></ul></div></header></div><section itemscope="" itemtype="http://schema.org/BlogPosting"><div class="wrapper"> <header><p class="printable"> <img src="https://api.qrserver.com/v1/create-qr-code/?data=https://www.yegor256.com/2014/08/15/retry-java-method-on-exception.html&amp;format=svg" style="width:125px;height:125px;" alt="QR code"/></p><p class="printable"> <code itemprop="url">https://www.yegor256.com/2014/08/15/retry-java-method-on-exception.html</code></p><h1 itemprop="name headline mainEntityOfPage">How to Retry Java Method Call on Exception</h1><ul class="subline"> <li> <time itemprop="datePublished" datetime="2014-08-15T00:00:00+00:00"> 15 August 2014 </time> </li> <li class="printable" itemscope="" itemprop="author" itemtype="http://schema.org/Person"> <span itemprop="name">Yegor Bugayenko</span> </li> <li class="unprintable"> <i class="icon icon-comments"></i> <a href="http://www.yegor256.com/2014/08/15/retry-java-method-on-exception.html#disqus_thread" itemprop="discussionUrl">comments</a> </li></ul><p><a href="/2014/06/01/aop-aspectj-java-method-logging.html">This post</a> explains how <a href="http://aspects.jcabi.com">jcabi-aspects</a> works with binary weaving. This mechanism integrates AspectJ with your code.</p><p>When method <code>load()</code> from the example above is called, this is what is happening behind the scene (pseudo-code):</p><figure class="highlight"><pre><code class="language-java" data-lang="java"><span></span><span class="k">while</span> <span class="o">(</span><span class="n">attempts</span><span class="o">++</span> <span class="o">&lt;</span> <span class="mi">3</span><span class="o">)</span> <span class="o">{</span>
  <span class="k">try</span> <span class="o">{</span>
    <span class="k">return</span> <span class="n">original_load</span><span class="o">(</span><span class="n">url</span><span class="o">);</span>
  <span class="o">}</span> <span class="k">catch</span> <span class="o">(</span><span class="n">Throwable</span> <span class="n">ex</span><span class="o">)</span> <span class="o">{</span>
    <span class="n">log</span><span class="o">(</span><span class="s">&quot;we failed, will try again in 10 seconds&quot;</span><span class="o">);</span>
    <span class="n">sleep</span><span class="o">(</span><span class="mi">10</span><span class="o">);</span>
  <span class="o">}</span>
<span class="o">}</span></code></pre></figure><p>This approach may be very useful in the following situations (based on my experience):</p><ul> <li><p>Executing <a href="/2014/08/18/fluent-jdbc-decorator.html">JDBC</a> <code>SELECT</code> statements</p></li> <li><p>Loading data from HTTP, <a href="/2014/05/26/amazon-s3-java-oop-adapter.html">S3</a>, FTP, etc resources</p></li> <li><p>Uploading data over the network</p></li> <li><p>Fetching data through RESTful stateless API-s</p></li></ul><p>The project is in <a href="https://github.com/jcabi/jcabi-aspects">GitHub</a>.</p></p>--> <nav class="buttons notranslate desktop-only"> <a href="http://www.facebook.com/sharer/sharer.php?u=https://www.yegor256.com/2014/08/15/retry-java-method-on-exception.html" title="Share on Facebook" class="button" rel="nofollow"> <span class="count count-facebook">0</span> <i class="icon icon-facebook notranslate" aria-hidden="true"></i> </a> <a href="https://twitter.com/share?url=https://www.yegor256.com/2014/08/15/retry-java-method-on-exception.html&amp;text=How+to+Retry+Java+Method+Call+on+Exception" title="Share on Twitter" class="button" rel="nofollow"> <span class="count count-twitter">0</span> <i class="icon icon-twitter notranslate" aria-hidden="true"></i> </a> <a href="https://plus.google.com/share?url=https://www.yegor256.com/2014/08/15/retry-java-method-on-exception.html" title="Share on Google+" class="button" rel="nofollow"> <span class="count count-googleplus">0</span> <i class="icon icon-googleplus notranslate" aria-hidden="true"></i> </a> <a href="https://www.linkedin.com/cws/share?url=https://www.yegor256.com/2014/08/15/retry-java-method-on-exception.html" title="Share on LinkedIn" class="button" rel="nofollow"> <span class="count count-linkedin">0</span> <i class="icon icon-linkedin notranslate" aria-hidden="true"></i> </a> <a href="http://reddit.com/submit?url=https://www.yegor256.com/2014/08/15/retry-java-method-on-exception.html%3F2014-32&amp;title=How+to+Retry+Java+Method+Call+on+Exception" title="Share on Reddit" class="button" rel="nofollow"> <span class="count count-reddit">0</span> <i class="icon icon-reddit notranslate" aria-hidden="true"></i> </a> <a href="http://news.ycombinator.com/submitlink?u=https://www.yegor256.com/2014/08/15/retry-java-method-on-exception.html%3F2014-32&amp;t=How+to+Retry+Java+Method+Call+on+Exception" title="Share on Hacker News" class="button" rel="nofollow"> <span class="count count-hackernews">0</span> <i class="icon icon-hackernews notranslate" aria-hidden="true"></i> </a> </nav> </header> <article class="main" itemprop="articleBody"><div > <figure class='badge'><a href='http://aspects.jcabi.com'><img src='http://img.jcabi.com/logo-square.svg' style='width:64px;max-width:100%;' alt='badge'/></a></figure><p>If you have a method that fails occasionally and you want to retry it a few times before <a href="/2015/12/01/rethrow-exceptions.html">throwing</a> an exception. <a href="http://aspects.jcabi.com/annotation-retryonfailure.html"><code>@RetryOnFailure</code></a> from <a href="http://aspects.jcabi.com">jcabi-aspects</a> can help. For example, if you&#39;re downloading the following web page:</p><figure class="highlight"><pre><code class="language-java" data-lang="java"><span></span><span class="nd">@RetryOnFailure</span><span class="o">(</span>
  <span class="n">attempts</span> <span class="o">=</span> <span class="mi">3</span><span class="o">,</span>
  <span class="n">delay</span> <span class="o">=</span> <span class="mi">10</span><span class="o">,</span>
  <span class="n">unit</span> <span class="o">=</span> <span class="n">TimeUnit</span><span class="o">.</span><span class="na">SECONDS</span>
<span class="o">)</span>
<span class="kd">public</span> <span class="n">String</span> <span class="nf">load</span><span class="o">(</span><span class="n">URL</span> <span class="n">url</span><span class="o">)</span> <span class="o">{</span>
  <span class="k">return</span> <span class="n">url</span><span class="o">.</span><span class="na">openConnection</span><span class="o">().</span><span class="na">getContent</span><span class="o">();</span>
<span class="o">}</span></code></pre></figure><p>This method call will throw an exception only after three failed executions with a ten seconds interval between them.</p><p><a href="/2014/06/01/aop-aspectj-java-method-logging.html">This post</a> explains how <a href="http://aspects.jcabi.com">jcabi-aspects</a> works with binary weaving. This mechanism integrates AspectJ with your code.</p><p>When method <code>load()</code> from the example above is called, this is what is happening behind the scene (pseudo-code):</p><figure class="highlight"><pre><code class="language-java" data-lang="java"><span></span><span class="k">while</span> <span class="o">(</span><span class="n">attempts</span><span class="o">++</span> <span class="o">&lt;</span> <span class="mi">3</span><span class="o">)</span> <span class="o">{</span>
  <span class="k">try</span> <span class="o">{</span>
    <span class="k">return</span> <span class="n">original_load</span><span class="o">(</span><span class="n">url</span><span class="o">);</span>
  <span class="o">}</span> <span class="k">catch</span> <span class="o">(</span><span class="n">Throwable</span> <span class="n">ex</span><span class="o">)</span> <span class="o">{</span>
    <span class="n">log</span><span class="o">(</span><span class="s">&quot;we failed, will try again in 10 seconds&quot;</span><span class="o">);</span>
    <span class="n">sleep</span><span class="o">(</span><span class="mi">10</span><span class="o">);</span>
  <span class="o">}</span>
<span class="o">}</span></code></pre></figure><p>This approach may be very useful in the following situations (based on my experience):</p><ul> <li><p>Executing <a href="/2014/08/18/fluent-jdbc-decorator.html">JDBC</a> <code>SELECT</code> statements</p></li> <li><p>Loading data from HTTP, <a href="/2014/05/26/amazon-s3-java-oop-adapter.html">S3</a>, FTP, etc resources</p></li> <li><p>Uploading data over the network</p></li> <li><p>Fetching data through RESTful stateless API-s</p></li></ul><p>The project is in <a href="https://github.com/jcabi/jcabi-aspects">GitHub</a>.</p></div></article></div><div class="wrapper"> <related-posts /></div><div class="disqus" role="complementary"><p class="disqus_hint"> Please, use <a href="https://help.disqus.com/commenting/what-html-tags-are-allowed-within-comments">syntax highlighting</a> in your comments, to make them more readable.</p><div id="disqus_thread" class="disqus-thread"> <a>&nbsp;</a></div><script> var disqus_config = function () { this.page.url = document.location.href.split('?')[0].split('#')[0].replace('https://', 'http://'); this.page.identifier = this.page.url; }; (function() { var d = document, s = d.createElement('script'); s.src = '//yegor256.disqus.com/embed.js'; s.setAttribute('data-timestamp', +new Date()); (d.head || d.body).appendChild(s); })(); </script> <noscript><div><p class="red"> JavaScript is disabled in your browser, that's why you can't see comments under this post.</p></div></noscript></div><div class="wrapper"> <footer class="footer"><p> &copy; <span itemscope="" itemprop="copyrightHolder" itemtype="http://schema.org/Person"> <span itemprop="name">Yegor Bugayenko</span> </span> 2014&ndash;<span itemprop="copyrightYear">2018</span></p></footer></div></section><div class="wrapper unprintable" style="text-align:center;margin-top:2em;"> <a href="http://www.sixnines.io/h/3ba1652f"> <img src="//www.sixnines.io/b/3ba1652f?style=flat" alt="sixnines availability badge"/> </a></div><script src="//code.jquery.com/jquery-1.9.0.min.js"></script> <script src="/js/all.js?4e047f6f42b"></script> <script>var disqus_shortname = 'yegor256';</script> <script id="dsq-count-scr" src="//yegor256.disqus.com/count.js" async="async"></script> <script> (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){ (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o), m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m) })(window,document,'script','//www.google-analytics.com/analytics.js','ga'); ga('create', 'UA-1963507-32', 'auto'); ga('send', 'pageview'); </script> <script> Cd=document;Cr="&"+Math.random();Cp="&s=1"; Cd.cookie="b=b";if(Cd.cookie)Cp+="&c=1"; Cp+="&t="+(new Date()).getTimezoneOffset(); if(self!=top)Cp+="&f=1"; </script> <script> if(navigator.javaEnabled())Cp+="&j=1"; </script> <script> if(typeof(screen)!='undefined')Cp+="&w="+screen.width+"&h="+ screen.height+"&d="+(screen.colorDepth?screen.colorDepth:screen.pixelDepth); </script> <script> Cd.write("<img src='//c.hit.ua/hit?i=95870&g=0&x=2"+Cp+Cr+ "&r="+escape(Cd.referrer)+"&u="+escape(window.location.href)+ "' border='0' wi"+"dth='1' he"+"ight='1'/>"); </script> <script type="application/ld+json"> { "@context": "http://schema.org", "@type": "Person", "name": "Yegor Bugayenko", "url": "http://www.yegor256.com", "sameAs": [ "https://www.facebook.com/yegor256", "https://instagram.com/yegor256", "https://www.linkedin.com/in/yegor256", "https://twitter.com/yegor256", "https://github.com/yegor256", "https://www.pinterest.com/yegor256/" ] } </script> </body> </html> <!DOCTYPE html> <html xmlns="http://www.w3.org/1999/xhtml" lang="en-US" xml:lang="en-US" itemscope="" itemtype="http://schema.org/WebSite"> <head> <meta charset="utf-8"/> <meta name="description" content="Qulice.com is a Java Maven plugin that aggregates Checkstyle, PMD, FindBugs, Cobertura and a few other plugins to strictly check the quality of your code " /> <meta name="keywords" content="java checkstyle config, java findbugs config, java pmd config, java static analysis, java strict quality, quality of java code" /> <meta name="viewport" content="width=device-width,minimum-scale=1,initial-scale=1"/> <meta name="google-site-verification" content="JEj_gQr2CPe2QKGw8XdMz0R7VboQIUbX3FlM-lwTq-8" /> <meta name="author" content="Yegor Bugayenko"> <meta name="article:published_time" content="2014-08-13 00:00:00 +0000"> <meta name="og:site_name" content="Yegor Bugayenko"/> <meta name="og:type" content="article" /> <meta name="og:locale" content="en_US" /> <meta name="twitter:account_id" content="4503599630178231" /> <meta name="twitter:creator" content="@yegor256"/> <meta name="twitter:site" content="@yegor256"/> <meta name="twitter:title" property="og:title" content="Strict Control of Java Code Quality"/> <meta name="twitter:description" property="og:description" content="Qulice.com is a Java Maven plugin that aggregates Checkstyle, PMD, FindBugs, Cobertura and a few other plugins to strictly check the quality of your code "/> <meta name="twitter:url" property="og:url" content="https://www.yegor256.com/2014/08/13/strict-code-quality-control.html"/> <meta name="telegram:channel" content="AAAAAEJFMRzsRTRxM3ec6A"/> <link rel="search" type="application/opensearchdescription+xml" href="/opensearch.xml" title="yegor256" /> <link rel="shortcut icon" href="/favicon.ico?4e047f6f42b"/> <link rel="apple-touch-icon" href="/favicon.ico?4e047f6f42b"/> <link rel="alternate" type="application/rss+xml" title="RSS for yegor256.com" href="https://www.yegor256.com/rss.xml"/> <link rel="stylesheet" href="/css/layout.css?4e047f6f42b"/> <link rel="stylesheet" href="/css/icons.css?4e047f6f42b"/> <link rel="canonical" href="https://www.yegor256.com/2014/08/13/strict-code-quality-control.html" /> <link rel="amphtml" href="https://www.yegor256.com/2014/08/13/strict-code-quality-control.amp.html" /> <title>Strict Control of Java Code Quality </title> <meta name='og:image' content='https://www.yegor256.com/images/2014/09/ratatouille.png'/><meta name='twitter:image' content='https://www.yegor256.com/images/2014/09/ratatouille.png'/><meta name='og:image:width' content='1200'/> <meta name='twitter:image:width' content='1200'/><meta name='og:image:height' content='478'/> <meta name='twitter:image:height' content='478'/><meta name='twitter:card' content='summary'/><meta name='twitter:image:alt' content='Ratatouille (2007) by Brad Bird and Jan Pinkava'/> </head> <body><div class="wrapper"> <aside class="header-toggle unprintable" id="header-toggle" title="Show the menu" onclick="$('#header').show();$('#header-toggle').hide();">&#9776;</aside> <header class="header" id="header"><div class="face"> <a href="/about-me.html#form" class="sub" title="Click to subscribe to my monthly newsletter"><span>Subscribe</span></a> <a href="/about-me.html" style="position:relative;"> <img src="/images/face-256x256.jpg" class="photo" alt="Yegor Bugayenko"/> </a></div><nav><ul class="menu social notranslate"> <li><a href="https://twitter.com/intent/follow?screen_name=yegor256" rel="nofollow" title="Follow me on Twitter"><i class="icon icon-twitter notranslate" aria-hidden="true"></i></a></li> <li><a href="/rss.xml" rel="nofollow" title="Subscribe to my RSS feed"><i class="icon icon-rss notranslate" aria-hidden="true"></i></a></li> <li><a itemprop="sameAs" href="https://github.com/yegor256" rel="nofollow" title="My GitHub profile"><i class="icon icon-github notranslate" aria-hidden="true"></i></a></li> <li><a itemprop="sameAs" href="http://stackoverflow.com/users/187141/yegor256" rel="nofollow" title="My StackOverflow profile"><i class="icon icon-stackoverflow notranslate" aria-hidden="true"></i></a></li> <li><a itemprop="sameAs" href="https://www.facebook.com/yegor256" rel="nofollow" title="Follow me on Facebook"><i class="icon icon-facebook notranslate" aria-hidden="true"></i></a></li> <li><a itemprop="sameAs" href="https://instagram.com/yegor256" rel="nofollow" title="Follow me on Instagram"><i class="icon icon-instagram notranslate" aria-hidden="true"></i></a></li> <li><a itemprop="sameAs" href="https://www.linkedin.com/in/yegor256" rel="nofollow" title="My LinkedIn profile"><i class="icon icon-linkedin notranslate" aria-hidden="true"></i></a></li> <li><a itemprop="sameAs" href="https://www.youtube.com/c/yegor256?sub_confirmation=1" rel="nofollow" title="My Youtube video channel"><i class="icon icon-youtube notranslate" aria-hidden="true"></i></a></li> <li><a itemprop="sameAs" href="https://www.pinterest.com/yegor256/" rel="nofollow" title="My Pinterest boards"><i class="icon icon-pinterest notranslate" aria-hidden="true"></i></a></li> <li><a itemprop="sameAs" href="https://angel.co/yegor256" rel="nofollow" title="My AngelList profile"><i class="icon icon-angellist notranslate" aria-hidden="true"></i></a></li> <li><a href="https://soundcloud.com/yegor256" rel="nofollow" title="My podcast"><i class="icon icon-podcast notranslate" aria-hidden="true"></i></a></li> <li><a href="https://itunes.apple.com/us/podcast/yegor256-podcast/id1150826721" rel="nofollow" title="My iTunes podcast"><i class="icon icon-itunes notranslate" aria-hidden="true"></i></a></li> <li><a href="https://t.me/joinchat/AAAAAEJFMRzsRTRxM3ec6A" rel="nofollow" title="My Telegram public channel"><i class="icon icon-telegram notranslate" aria-hidden="true"></i></a></li> <li><a href="mailto:blog@yegor256.com" rel="nofollow" title="Email me any time"><i class="icon icon-mail notranslate" aria-hidden="true"></i></a></li></ul><ul class="menu"> <li><a href="/" title="Home page">Home</a></li> <li ><a href="/best.html" title="Best articles to read">12&#160;Best</a></li> <li ><a href="/contents.html" title="The contents of the entire blog">All&#160;288</a></li> <li ><a href="/webinars.html" title="My webinars">Webinars</a></li> <li ><a href="/talks.html" title="Future and past conference talks">Talks</a></li> <li ><a href="/books.html" title="The books I wrote">Books</a></li> <li ><a href="/papers.html" title="My academic papers and patents">Papers</a></li> <li ><a href="/pets.html" title="My loved pet projects">Pets</a></li> <li ><a href="/award.html" title="Software quality award">Award</a></li> <li ><a href="/testimonials.html" title="What some people say about me">Testimonials</a></li> <li ><a href="/shift-m.html" title="Audio podcast about project management">Shift-M</a></li> <li ><a href="/paintings.html" title="My paintings for sale">Paintings</a></li> <li><a href="http://ru.yegor256.com/" title="Немного на русском языке">По-русски</a></li></ul></nav><div class="search"> <form method="get" action="https://www.google.com/search" itemprop="potentialAction" itemscope="" itemtype="http://schema.org/SearchAction"> <meta itemprop="target" content="https://www.google.com/search?q={q}"/> <input name="sitesearch" value="yegor256.com" type="hidden"/> <input itemprop="query-input" type="text" id="search-query" class="field field-text" required="required" onfocus="$('.google').css('visibility', 'visible');" name="q" placeholder="Search..." autocomplete="off"/> <input type="image" src="/images/google-search-icon.svg" class="google" title="Search via Google" alt="Search via Google"/> </form></div><div class="hot"><ul> <li> <a href="/code-ahead.html">Code Ahead</a> was published on Amazon just a few days ago! It is my new book, a novel about programmers. It explains in details the majority of ideas that stand behind <a href="https://www.zerocracy.com">Zerocracy</a> and <a href="https://www.xdsd.org">XDSD</a>. </li> <li> At <a href="/webinars.html">Webinar #37</a> we will discuss naming problem in OOP, for objects, methods and attributes; join us on <b>September 12</b>, at 11am PST. </li></ul></div></header></div><section itemscope="" itemtype="http://schema.org/BlogPosting"><div class="wrapper"> <header><p class="printable"> <img src="https://api.qrserver.com/v1/create-qr-code/?data=https://www.yegor256.com/2014/08/13/strict-code-quality-control.html&amp;format=svg" style="width:125px;height:125px;" alt="QR code"/></p><p class="printable"> <code itemprop="url">https://www.yegor256.com/2014/08/13/strict-code-quality-control.html</code></p><h1 itemprop="name headline mainEntityOfPage">Strict Control of Java Code Quality</h1><ul class="subline"> <li> <time itemprop="datePublished" datetime="2014-08-13T00:00:00+00:00"> 13 August 2014 </time> </li> <li class="printable" itemscope="" itemprop="author" itemtype="http://schema.org/Person"> <span itemprop="name">Yegor Bugayenko</span> </li> <li class="unprintable"> <i class="icon icon-comments"></i> <a href="http://www.yegor256.com/2014/08/13/strict-code-quality-control.html#disqus_thread" itemprop="discussionUrl">comments</a> </li></ul><figure class='jb_picture'><img itemprop='image' alt='Ratatouille (2007) by Brad Bird and Jan Pinkava' src='/images/2014/09/ratatouille.png' longdesc='#763c0dc0'/><figcaption id='763c0dc0'>Ratatouille (2007) by Brad Bird and Jan Pinkava</figcaption></figure><p><a href="http://www.qulice.com">Qulice</a> takes things one step further. It aggregates a few quality checkers, configures them to a maximum strict mode, and breaks your build if any of them fail.</p><figure class='badge'><a href='http://www.qulice.com'><img src='http://img.qulice.com/logo.svg' style='width:128px;max-width:100%;' alt='badge'/></a></figure><p>Seriously. There are <a href="http://checkstyle.sourceforge.net/checks.html">over 130 checks</a> in Checkstyle, <a href="http://pmd.sourceforge.net/pmd-5.1.2/rules/index.html">over 400 rules</a> in PMD, and <a href="http://findbugs.sourceforge.net/bugDescriptions.html">over 400 bugs</a> in FindBugs. All of them should say: &quot;Yes, we like your code.&quot; Otherwise, your build shouldn&#39;t pass.</p><p>What do you think? Would it be convenient for you---to have your code rejected every time it breaks just one of 900 checks? Would it be productive for the team---to force developers to focus so much on code quality?</p><h2 id="first-reaction">First Reaction</h2><p>If you join one of our teams as a Java developer, you will develop your code <a href="/2014/07/21/read-only-master-branch.html">in branches</a> and, then, <a href="/2014/07/24/rultor-automated-merging.html">Rultor will merge</a> your changes into <code>master</code>. Before actually merging, though, <a href="http://www.rultor.com">Rultor</a> will run an automated build script to make sure that your branch doesn&#39;t break it.</p><aside class='quote'>If your changes break any of Qulice's rules, your entire branch gets rejected</aside><p>As a static analysis tool, Qulice is just one of the steps in the automated build script. It is actually a Maven plugin and we automate Java builds with Maven 3x. Thus, if your changes break any of Qulice&#39;s rules, your entire branch gets rejected.</p><p>Your first reaction---I&#39;ve seen it hundreds of times---will be negative. You may actually become frustrated enough to leave the project immediately. You may say something like this (I&#39;m quoting real life stories):</p><ul> <li><p>&quot;These quality rules entirely ruin my creativity!&quot;</p></li> <li><p>&quot;Instead of wasting time on these misplaced commas and braces, we&#39;d be better off developing new features!&quot;</p></li> <li><p>&quot;I&#39;ve done many successful projects in my life, never heard about this ridiculous quality checking...&quot;</p></li></ul><p>This first reaction is only logical. I&#39;ve seen many people say things like this, in both <a href="/2015/12/22/why-dont-you-contribute-to-open-source.html">open source</a> and commercial projects. Not only in Java, but also in PHP (with <a href="http://pear.php.net/package/PHP_CodeSniffer/">phpcs</a> and <a href="http://phpmd.org/">phpmd</a>) and Ruby (with <a href="https://github.com/bbatsov/rubocop">rubocop</a> and <a href="https://github.com/colszowka/simplecov">simplecov</a>).</p><p>How do I answer? Read on.</p><h2 id="on-second-thought">On Second Thought</h2><p>My experience tells me that the sooner someone can get used to the strict quality control of Qulice, the faster he/she can learn and grow; the better programmer he/she is; and the further he/she can go with us and our projects.</p><p>Having this experience in mind, I recommend that all new project members be patient and try to get used to this new approach to <a href="/2017/04/11/flexibility-equates-lower-quality.html">quality</a>. In a few weeks, those who stick with it start to understand why this approach is good for the project and for them, as Java engineers.</p><p>Why is it good? Read on.</p><h2 id="what-do-projects-get-from-qulice">What Do Projects Get From Qulice?</h2><p>Let&#39;s take one simple rule as an example. Here is a piece of Java code that Qulice would complain about (due to the <a href="http://checkstyle.sourceforge.net/config_design.html#DesignForExtension"><code>DesignForExtension</code></a> rule from Checkstyle):</p><figure class="highlight"><pre><code class="language-java" data-lang="java"><span></span><span class="kd">public</span> <span class="kd">class</span> <span class="nc">Employee</span> <span class="o">{</span>
  <span class="kd">public</span> <span class="n">String</span> <span class="nf">name</span><span class="o">()</span> <span class="o">{</span>
    <span class="k">return</span> <span class="s">&quot;Jeff&quot;</span><span class="o">;</span>
  <span class="o">}</span>
<span class="o">}</span></code></pre></figure><p>What is wrong with this code? Method <code>name()</code> is not final and can be overridden by a class that extends <code>Employee</code>. Design-wise this is wrong, since a child class is allowed to break a super class, overriding its method.</p><p>What is the right design? This one:</p><figure class="highlight"><pre><code class="language-java" data-lang="java"><span></span><span class="kd">public</span> <span class="kd">class</span> <span class="nc">Employee</span> <span class="o">{</span>
  <span class="kd">public</span> <span class="kd">final</span> <span class="n">String</span> <span class="nf">name</span><span class="o">()</span> <span class="o">{</span>
    <span class="k">return</span> <span class="s">&quot;Jeff&quot;</span><span class="o">;</span>
  <span class="o">}</span>
<span class="o">}</span></code></pre></figure><p>Now, the method is final and can&#39;t be overridden by child classes. It is a much safer design (according to Checkstyle, and I agree).</p><p>So, let&#39;s say we make this rule mandatory for all classes in the project. What does the project gain from this? It can promise its members (programmers) a <strong>higher quality</strong> of work, compared to other projects that don&#39;t have this restriction, mostly because of:</p><ul> <li><p><strong>Predictability of Design</strong>---I don&#39;t have to scroll through the entire class to make sure it doesn&#39;t have methods that can be accidentally overridden. I know for sure that this can&#39;t happen in this project. In other words, I know what to expect.</p></li> <li><p><strong>Less Hidden Tricks</strong>---Higher predictability of design leads to better visibility of mistakes and tricks. Standardization of source code makes it uniform. This means that it&#39;s easier to read and spot problems.</p></li> <li><p><strong>Industry Standards</strong>---The decision to use this design is made by Checkstyle, not by a project architect. For me, as a project developer, this means that I&#39;m following industry standards. That makes the project (and its leaders) more respectable.</p></li> <li><p><strong>Learning</strong>---I&#39;ll bet that most of you who read this post didn&#39;t know about the design rule explained above. Just by reading this article, you learned something new. Imagine how much you could learn after making your code compliant to all 900 rules of Qulice (Checkstyle + PMD + FindBugs).</p></li></ul><p>The point about learning brings us to the last, and the most important, thought to discuss.</p><h2 id="what-do-i-get-from-qulice">What Do I Get from Qulice?</h2><p>As a programmer, I hope you already realize what you get from working in a project that raises its quality bar as high as Qulice asks. Yes, you&#39;ll learn <a href="/2015/01/21/if-then-throw-else.html">a lot</a> of <a href="/2014/11/03/empty-line-code-smell.html">new things</a> about writing quality Java code.</p><aside class='quote'>You are getting free lessons with every new line of code you write</aside><p>On top of that though, I would actually say that you are getting free lessons with every new line of code you write. And the teacher is a software, written by hundreds of Java developers, for the last ten years. Qulice just integrates those software tools together. Truthfully, it is the developers who are the real authors of quality checks and rules.</p><p>So, what do I tell those who complain about quality rules being too strict? I say this: &quot;Do you want to learn and improve, or do you just want to get paid and get away with it?&quot;</p><p>ps. You can use my <a href="http://img.teamed.io/settings.jar">settings.jar</a> for IntelliJ, they are rather strict and will help you clean your code even before Qulice starts to complain.</p></p>--> <nav class="buttons notranslate desktop-only"> <a href="http://www.facebook.com/sharer/sharer.php?u=https://www.yegor256.com/2014/08/13/strict-code-quality-control.html" title="Share on Facebook" class="button" rel="nofollow"> <span class="count count-facebook">0</span> <i class="icon icon-facebook notranslate" aria-hidden="true"></i> </a> <a href="https://twitter.com/share?url=https://www.yegor256.com/2014/08/13/strict-code-quality-control.html&amp;text=Strict+Control+of+Java+Code+Quality" title="Share on Twitter" class="button" rel="nofollow"> <span class="count count-twitter">0</span> <i class="icon icon-twitter notranslate" aria-hidden="true"></i> </a> <a href="https://plus.google.com/share?url=https://www.yegor256.com/2014/08/13/strict-code-quality-control.html" title="Share on Google+" class="button" rel="nofollow"> <span class="count count-googleplus">0</span> <i class="icon icon-googleplus notranslate" aria-hidden="true"></i> </a> <a href="https://www.linkedin.com/cws/share?url=https://www.yegor256.com/2014/08/13/strict-code-quality-control.html" title="Share on LinkedIn" class="button" rel="nofollow"> <span class="count count-linkedin">0</span> <i class="icon icon-linkedin notranslate" aria-hidden="true"></i> </a> <a href="http://reddit.com/submit?url=https://www.yegor256.com/2014/08/13/strict-code-quality-control.html%3F2014-32&amp;title=Strict+Control+of+Java+Code+Quality" title="Share on Reddit" class="button" rel="nofollow"> <span class="count count-reddit">0</span> <i class="icon icon-reddit notranslate" aria-hidden="true"></i> </a> <a href="http://news.ycombinator.com/submitlink?u=https://www.yegor256.com/2014/08/13/strict-code-quality-control.html%3F2014-32&amp;t=Strict+Control+of+Java+Code+Quality" title="Share on Hacker News" class="button" rel="nofollow"> <span class="count count-hackernews">0</span> <i class="icon icon-hackernews notranslate" aria-hidden="true"></i> </a> </nav> </header> <article class="main" itemprop="articleBody"><div ><p>There are many tools that control the quality of Java code, including <a href="http://checkstyle.sourceforge.net/">Checkstyle</a>, <a href="http://pmd.sourceforge.net/">PMD</a>, <a href="http://findbugs.sourceforge.net/">FindBugs</a>, <a href="http://cobertura.github.io/cobertura/">Cobertura</a>, etc. All of them are usually used to analyze quality and build some fancy reports. Very often, those reports are published by <a href="/2014/10/08/continuous-integration-is-dead.html">continuous integration</a> servers, like Jenkins.</p><figure class='jb_picture'><img itemprop='image' alt='Ratatouille (2007) by Brad Bird and Jan Pinkava' src='/images/2014/09/ratatouille.png' longdesc='#763c0dc0'/><figcaption id='763c0dc0'>Ratatouille (2007) by Brad Bird and Jan Pinkava</figcaption></figure><p><a href="http://www.qulice.com">Qulice</a> takes things one step further. It aggregates a few quality checkers, configures them to a maximum strict mode, and breaks your build if any of them fail.</p><figure class='badge'><a href='http://www.qulice.com'><img src='http://img.qulice.com/logo.svg' style='width:128px;max-width:100%;' alt='badge'/></a></figure><p>Seriously. There are <a href="http://checkstyle.sourceforge.net/checks.html">over 130 checks</a> in Checkstyle, <a href="http://pmd.sourceforge.net/pmd-5.1.2/rules/index.html">over 400 rules</a> in PMD, and <a href="http://findbugs.sourceforge.net/bugDescriptions.html">over 400 bugs</a> in FindBugs. All of them should say: &quot;Yes, we like your code.&quot; Otherwise, your build shouldn&#39;t pass.</p><p>What do you think? Would it be convenient for you---to have your code rejected every time it breaks just one of 900 checks? Would it be productive for the team---to force developers to focus so much on code quality?</p><h2 id="first-reaction">First Reaction</h2><p>If you join one of our teams as a Java developer, you will develop your code <a href="/2014/07/21/read-only-master-branch.html">in branches</a> and, then, <a href="/2014/07/24/rultor-automated-merging.html">Rultor will merge</a> your changes into <code>master</code>. Before actually merging, though, <a href="http://www.rultor.com">Rultor</a> will run an automated build script to make sure that your branch doesn&#39;t break it.</p><aside class='quote'>If your changes break any of Qulice's rules, your entire branch gets rejected</aside><p>As a static analysis tool, Qulice is just one of the steps in the automated build script. It is actually a Maven plugin and we automate Java builds with Maven 3x. Thus, if your changes break any of Qulice&#39;s rules, your entire branch gets rejected.</p><p>Your first reaction---I&#39;ve seen it hundreds of times---will be negative. You may actually become frustrated enough to leave the project immediately. You may say something like this (I&#39;m quoting real life stories):</p><ul> <li><p>&quot;These quality rules entirely ruin my creativity!&quot;</p></li> <li><p>&quot;Instead of wasting time on these misplaced commas and braces, we&#39;d be better off developing new features!&quot;</p></li> <li><p>&quot;I&#39;ve done many successful projects in my life, never heard about this ridiculous quality checking...&quot;</p></li></ul><p>This first reaction is only logical. I&#39;ve seen many people say things like this, in both <a href="/2015/12/22/why-dont-you-contribute-to-open-source.html">open source</a> and commercial projects. Not only in Java, but also in PHP (with <a href="http://pear.php.net/package/PHP_CodeSniffer/">phpcs</a> and <a href="http://phpmd.org/">phpmd</a>) and Ruby (with <a href="https://github.com/bbatsov/rubocop">rubocop</a> and <a href="https://github.com/colszowka/simplecov">simplecov</a>).</p><p>How do I answer? Read on.</p><h2 id="on-second-thought">On Second Thought</h2><p>My experience tells me that the sooner someone can get used to the strict quality control of Qulice, the faster he/she can learn and grow; the better programmer he/she is; and the further he/she can go with us and our projects.</p><p>Having this experience in mind, I recommend that all new project members be patient and try to get used to this new approach to <a href="/2017/04/11/flexibility-equates-lower-quality.html">quality</a>. In a few weeks, those who stick with it start to understand why this approach is good for the project and for them, as Java engineers.</p><p>Why is it good? Read on.</p><h2 id="what-do-projects-get-from-qulice">What Do Projects Get From Qulice?</h2><p>Let&#39;s take one simple rule as an example. Here is a piece of Java code that Qulice would complain about (due to the <a href="http://checkstyle.sourceforge.net/config_design.html#DesignForExtension"><code>DesignForExtension</code></a> rule from Checkstyle):</p><figure class="highlight"><pre><code class="language-java" data-lang="java"><span></span><span class="kd">public</span> <span class="kd">class</span> <span class="nc">Employee</span> <span class="o">{</span>
  <span class="kd">public</span> <span class="n">String</span> <span class="nf">name</span><span class="o">()</span> <span class="o">{</span>
    <span class="k">return</span> <span class="s">&quot;Jeff&quot;</span><span class="o">;</span>
  <span class="o">}</span>
<span class="o">}</span></code></pre></figure><p>What is wrong with this code? Method <code>name()</code> is not final and can be overridden by a class that extends <code>Employee</code>. Design-wise this is wrong, since a child class is allowed to break a super class, overriding its method.</p><p>What is the right design? This one:</p><figure class="highlight"><pre><code class="language-java" data-lang="java"><span></span><span class="kd">public</span> <span class="kd">class</span> <span class="nc">Employee</span> <span class="o">{</span>
  <span class="kd">public</span> <span class="kd">final</span> <span class="n">String</span> <span class="nf">name</span><span class="o">()</span> <span class="o">{</span>
    <span class="k">return</span> <span class="s">&quot;Jeff&quot;</span><span class="o">;</span>
  <span class="o">}</span>
<span class="o">}</span></code></pre></figure><p>Now, the method is final and can&#39;t be overridden by child classes. It is a much safer design (according to Checkstyle, and I agree).</p><p>So, let&#39;s say we make this rule mandatory for all classes in the project. What does the project gain from this? It can promise its members (programmers) a <strong>higher quality</strong> of work, compared to other projects that don&#39;t have this restriction, mostly because of:</p><ul> <li><p><strong>Predictability of Design</strong>---I don&#39;t have to scroll through the entire class to make sure it doesn&#39;t have methods that can be accidentally overridden. I know for sure that this can&#39;t happen in this project. In other words, I know what to expect.</p></li> <li><p><strong>Less Hidden Tricks</strong>---Higher predictability of design leads to better visibility of mistakes and tricks. Standardization of source code makes it uniform. This means that it&#39;s easier to read and spot problems.</p></li> <li><p><strong>Industry Standards</strong>---The decision to use this design is made by Checkstyle, not by a project architect. For me, as a project developer, this means that I&#39;m following industry standards. That makes the project (and its leaders) more respectable.</p></li> <li><p><strong>Learning</strong>---I&#39;ll bet that most of you who read this post didn&#39;t know about the design rule explained above. Just by reading this article, you learned something new. Imagine how much you could learn after making your code compliant to all 900 rules of Qulice (Checkstyle + PMD + FindBugs).</p></li></ul><p>The point about learning brings us to the last, and the most important, thought to discuss.</p><h2 id="what-do-i-get-from-qulice">What Do I Get from Qulice?</h2><p>As a programmer, I hope you already realize what you get from working in a project that raises its quality bar as high as Qulice asks. Yes, you&#39;ll learn <a href="/2015/01/21/if-then-throw-else.html">a lot</a> of <a href="/2014/11/03/empty-line-code-smell.html">new things</a> about writing quality Java code.</p><aside class='quote'>You are getting free lessons with every new line of code you write</aside><p>On top of that though, I would actually say that you are getting free lessons with every new line of code you write. And the teacher is a software, written by hundreds of Java developers, for the last ten years. Qulice just integrates those software tools together. Truthfully, it is the developers who are the real authors of quality checks and rules.</p><p>So, what do I tell those who complain about quality rules being too strict? I say this: &quot;Do you want to learn and improve, or do you just want to get paid and get away with it?&quot;</p><p>ps. You can use my <a href="http://img.teamed.io/settings.jar">settings.jar</a> for IntelliJ, they are rather strict and will help you clean your code even before Qulice starts to complain.</p></div></article></div><div class="wrapper"> <related-posts /></div><div class="disqus" role="complementary"><p class="disqus_hint"> Please, use <a href="https://help.disqus.com/commenting/what-html-tags-are-allowed-within-comments">syntax highlighting</a> in your comments, to make them more readable.</p><div id="disqus_thread" class="disqus-thread"> <a>&nbsp;</a></div><script> var disqus_config = function () { this.page.url = document.location.href.split('?')[0].split('#')[0].replace('https://', 'http://'); this.page.identifier = this.page.url; }; (function() { var d = document, s = d.createElement('script'); s.src = '//yegor256.disqus.com/embed.js'; s.setAttribute('data-timestamp', +new Date()); (d.head || d.body).appendChild(s); })(); </script> <noscript><div><p class="red"> JavaScript is disabled in your browser, that's why you can't see comments under this post.</p></div></noscript></div><div class="wrapper"> <footer class="footer"><p> &copy; <span itemscope="" itemprop="copyrightHolder" itemtype="http://schema.org/Person"> <span itemprop="name">Yegor Bugayenko</span> </span> 2014&ndash;<span itemprop="copyrightYear">2018</span></p></footer></div></section><div class="wrapper unprintable" style="text-align:center;margin-top:2em;"> <a href="http://www.sixnines.io/h/3ba1652f"> <img src="//www.sixnines.io/b/3ba1652f?style=flat" alt="sixnines availability badge"/> </a></div><script src="//code.jquery.com/jquery-1.9.0.min.js"></script> <script src="/js/all.js?4e047f6f42b"></script> <script>var disqus_shortname = 'yegor256';</script> <script id="dsq-count-scr" src="//yegor256.disqus.com/count.js" async="async"></script> <script> (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){ (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o), m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m) })(window,document,'script','//www.google-analytics.com/analytics.js','ga'); ga('create', 'UA-1963507-32', 'auto'); ga('send', 'pageview'); </script> <script> Cd=document;Cr="&"+Math.random();Cp="&s=1"; Cd.cookie="b=b";if(Cd.cookie)Cp+="&c=1"; Cp+="&t="+(new Date()).getTimezoneOffset(); if(self!=top)Cp+="&f=1"; </script> <script> if(navigator.javaEnabled())Cp+="&j=1"; </script> <script> if(typeof(screen)!='undefined')Cp+="&w="+screen.width+"&h="+ screen.height+"&d="+(screen.colorDepth?screen.colorDepth:screen.pixelDepth); </script> <script> Cd.write("<img src='//c.hit.ua/hit?i=95870&g=0&x=2"+Cp+Cr+ "&r="+escape(Cd.referrer)+"&u="+escape(window.location.href)+ "' border='0' wi"+"dth='1' he"+"ight='1'/>"); </script> <script type="application/ld+json"> { "@context": "http://schema.org", "@type": "Person", "name": "Yegor Bugayenko", "url": "http://www.yegor256.com", "sameAs": [ "https://www.facebook.com/yegor256", "https://instagram.com/yegor256", "https://www.linkedin.com/in/yegor256", "https://twitter.com/yegor256", "https://github.com/yegor256", "https://www.pinterest.com/yegor256/" ] } </script> </body> </html> <!DOCTYPE html> <html xmlns="http://www.w3.org/1999/xhtml" lang="en-US" xml:lang="en-US" itemscope="" itemtype="http://schema.org/WebSite"> <head> <meta charset="utf-8"/> <meta name="description" content="Caching Java method results is easy with jcabi-aspects, a small library that uses AspectJ and Java annotations " /> <meta name="keywords" content="@Cacheable, aop caching, cache java method, cache result of java method, java aop cache, java cache method results, java method cache annotation, java method caching" /> <meta name="viewport" content="width=device-width,minimum-scale=1,initial-scale=1"/> <meta name="google-site-verification" content="JEj_gQr2CPe2QKGw8XdMz0R7VboQIUbX3FlM-lwTq-8" /> <meta name="author" content="Yegor Bugayenko"> <meta name="article:published_time" content="2014-08-03 00:00:00 +0000"> <meta name="og:site_name" content="Yegor Bugayenko"/> <meta name="og:type" content="article" /> <meta name="og:locale" content="en_US" /> <meta name="twitter:account_id" content="4503599630178231" /> <meta name="twitter:creator" content="@yegor256"/> <meta name="twitter:site" content="@yegor256"/> <meta name="twitter:title" property="og:title" content="Cache Java Method Results"/> <meta name="twitter:description" property="og:description" content="Caching Java method results is easy with jcabi-aspects, a small library that uses AspectJ and Java annotations "/> <meta name="twitter:url" property="og:url" content="https://www.yegor256.com/2014/08/03/cacheable-java-annotation.html"/> <meta name="telegram:channel" content="AAAAAEJFMRzsRTRxM3ec6A"/> <link rel="search" type="application/opensearchdescription+xml" href="/opensearch.xml" title="yegor256" /> <link rel="shortcut icon" href="/favicon.ico?4e047f6f42b"/> <link rel="apple-touch-icon" href="/favicon.ico?4e047f6f42b"/> <link rel="alternate" type="application/rss+xml" title="RSS for yegor256.com" href="https://www.yegor256.com/rss.xml"/> <link rel="stylesheet" href="/css/layout.css?4e047f6f42b"/> <link rel="stylesheet" href="/css/icons.css?4e047f6f42b"/> <link rel="canonical" href="https://www.yegor256.com/2014/08/03/cacheable-java-annotation.html" /> <link rel="amphtml" href="https://www.yegor256.com/2014/08/03/cacheable-java-annotation.amp.html" /> <title>Cache Java Method Results </title> </head> <body><div class="wrapper"> <aside class="header-toggle unprintable" id="header-toggle" title="Show the menu" onclick="$('#header').show();$('#header-toggle').hide();">&#9776;</aside> <header class="header" id="header"><div class="face"> <a href="/about-me.html#form" class="sub" title="Click to subscribe to my monthly newsletter"><span>Subscribe</span></a> <a href="/about-me.html" style="position:relative;"> <img src="/images/face-256x256.jpg" class="photo" alt="Yegor Bugayenko"/> </a></div><nav><ul class="menu social notranslate"> <li><a href="https://twitter.com/intent/follow?screen_name=yegor256" rel="nofollow" title="Follow me on Twitter"><i class="icon icon-twitter notranslate" aria-hidden="true"></i></a></li> <li><a href="/rss.xml" rel="nofollow" title="Subscribe to my RSS feed"><i class="icon icon-rss notranslate" aria-hidden="true"></i></a></li> <li><a itemprop="sameAs" href="https://github.com/yegor256" rel="nofollow" title="My GitHub profile"><i class="icon icon-github notranslate" aria-hidden="true"></i></a></li> <li><a itemprop="sameAs" href="http://stackoverflow.com/users/187141/yegor256" rel="nofollow" title="My StackOverflow profile"><i class="icon icon-stackoverflow notranslate" aria-hidden="true"></i></a></li> <li><a itemprop="sameAs" href="https://www.facebook.com/yegor256" rel="nofollow" title="Follow me on Facebook"><i class="icon icon-facebook notranslate" aria-hidden="true"></i></a></li> <li><a itemprop="sameAs" href="https://instagram.com/yegor256" rel="nofollow" title="Follow me on Instagram"><i class="icon icon-instagram notranslate" aria-hidden="true"></i></a></li> <li><a itemprop="sameAs" href="https://www.linkedin.com/in/yegor256" rel="nofollow" title="My LinkedIn profile"><i class="icon icon-linkedin notranslate" aria-hidden="true"></i></a></li> <li><a itemprop="sameAs" href="https://www.youtube.com/c/yegor256?sub_confirmation=1" rel="nofollow" title="My Youtube video channel"><i class="icon icon-youtube notranslate" aria-hidden="true"></i></a></li> <li><a itemprop="sameAs" href="https://www.pinterest.com/yegor256/" rel="nofollow" title="My Pinterest boards"><i class="icon icon-pinterest notranslate" aria-hidden="true"></i></a></li> <li><a itemprop="sameAs" href="https://angel.co/yegor256" rel="nofollow" title="My AngelList profile"><i class="icon icon-angellist notranslate" aria-hidden="true"></i></a></li> <li><a href="https://soundcloud.com/yegor256" rel="nofollow" title="My podcast"><i class="icon icon-podcast notranslate" aria-hidden="true"></i></a></li> <li><a href="https://itunes.apple.com/us/podcast/yegor256-podcast/id1150826721" rel="nofollow" title="My iTunes podcast"><i class="icon icon-itunes notranslate" aria-hidden="true"></i></a></li> <li><a href="https://t.me/joinchat/AAAAAEJFMRzsRTRxM3ec6A" rel="nofollow" title="My Telegram public channel"><i class="icon icon-telegram notranslate" aria-hidden="true"></i></a></li> <li><a href="mailto:blog@yegor256.com" rel="nofollow" title="Email me any time"><i class="icon icon-mail notranslate" aria-hidden="true"></i></a></li></ul><ul class="menu"> <li><a href="/" title="Home page">Home</a></li> <li ><a href="/best.html" title="Best articles to read">12&#160;Best</a></li> <li ><a href="/contents.html" title="The contents of the entire blog">All&#160;288</a></li> <li ><a href="/webinars.html" title="My webinars">Webinars</a></li> <li ><a href="/talks.html" title="Future and past conference talks">Talks</a></li> <li ><a href="/books.html" title="The books I wrote">Books</a></li> <li ><a href="/papers.html" title="My academic papers and patents">Papers</a></li> <li ><a href="/pets.html" title="My loved pet projects">Pets</a></li> <li ><a href="/award.html" title="Software quality award">Award</a></li> <li ><a href="/testimonials.html" title="What some people say about me">Testimonials</a></li> <li ><a href="/shift-m.html" title="Audio podcast about project management">Shift-M</a></li> <li ><a href="/paintings.html" title="My paintings for sale">Paintings</a></li> <li><a href="http://ru.yegor256.com/" title="Немного на русском языке">По-русски</a></li></ul></nav><div class="search"> <form method="get" action="https://www.google.com/search" itemprop="potentialAction" itemscope="" itemtype="http://schema.org/SearchAction"> <meta itemprop="target" content="https://www.google.com/search?q={q}"/> <input name="sitesearch" value="yegor256.com" type="hidden"/> <input itemprop="query-input" type="text" id="search-query" class="field field-text" required="required" onfocus="$('.google').css('visibility', 'visible');" name="q" placeholder="Search..." autocomplete="off"/> <input type="image" src="/images/google-search-icon.svg" class="google" title="Search via Google" alt="Search via Google"/> </form></div><div class="hot"><ul> <li> <a href="/code-ahead.html">Code Ahead</a> was published on Amazon just a few days ago! It is my new book, a novel about programmers. It explains in details the majority of ideas that stand behind <a href="https://www.zerocracy.com">Zerocracy</a> and <a href="https://www.xdsd.org">XDSD</a>. </li> <li> At <a href="/webinars.html">Webinar #37</a> we will discuss naming problem in OOP, for objects, methods and attributes; join us on <b>September 12</b>, at 11am PST. </li></ul></div></header></div><section itemscope="" itemtype="http://schema.org/BlogPosting"><div class="wrapper"> <header><p class="printable"> <img src="https://api.qrserver.com/v1/create-qr-code/?data=https://www.yegor256.com/2014/08/03/cacheable-java-annotation.html&amp;format=svg" style="width:125px;height:125px;" alt="QR code"/></p><p class="printable"> <code itemprop="url">https://www.yegor256.com/2014/08/03/cacheable-java-annotation.html</code></p><h1 itemprop="name headline mainEntityOfPage">Cache Java Method Results</h1><ul class="subline"> <li> <time itemprop="datePublished" datetime="2014-08-03T00:00:00+00:00"> 3 August 2014 </time> </li> <li class="printable" itemscope="" itemprop="author" itemtype="http://schema.org/Person"> <span itemprop="name">Yegor Bugayenko</span> </li> <li class="unprintable"> <i class="icon icon-comments"></i> <a href="http://www.yegor256.com/2014/08/03/cacheable-java-annotation.html#disqus_thread" itemprop="discussionUrl">comments</a> </li></ul><h2 id="how-it-works">How It Works?</h2><p>This post about <a href="/2014/06/01/aop-aspectj-java-method-logging.html">AOP, AspectJ and method logging</a> explains how &quot;aspect weaving&quot; works (I highly recommend that you read it first).</p><p>Here I&#39;ll explain how caching works.</p><p>The approach is very straight forward. There is a static hash map with keys as &quot;method coordinates&quot; and values as their results. Method coordinates consist of the object, an owner of the method and a method name with parameter types.</p><p>In the example above, right after the method <code>load()</code> finishes, the map gets a new entry (simplified example, of course):</p><figure class="highlight"><pre><code class="language-text" data-lang="text"><span></span>key: [page, &quot;load()&quot;]
value: &quot;&lt;html&gt;...&lt;/html&gt;&quot;</code></pre></figure><p>Every consecutive call to <code>load()</code> will be intercepted by the aspect from <a href="http://aspects.jcabi.com">jcabi-aspects</a> and resolved immediately with a value from the cache map. The method will not get any control until the end of its lifetime, which is five minutes in the example above.</p><h2 id="what-about-cache-flushing">What About Cache Flushing?</h2><p>Sometimes it&#39;s necessary to have the ability to flush cache before the end of its lifetime. Here is a practical example:</p><figure class="highlight"><pre><code class="language-java" data-lang="java"><span></span><span class="kn">import</span> <span class="nn">com.jcabi.aspects.Cacheable</span><span class="o">;</span>
<span class="kd">public</span> <span class="kd">class</span> <span class="nc">Employees</span> <span class="o">{</span>
  <span class="nd">@Cacheable</span><span class="o">(</span><span class="n">lifetime</span> <span class="o">=</span> <span class="mi">1</span><span class="o">,</span> <span class="n">unit</span> <span class="o">=</span> <span class="n">TimeUnit</span><span class="o">.</span><span class="na">HOURS</span><span class="o">)</span>
  <span class="kt">int</span> <span class="nf">size</span><span class="o">()</span> <span class="o">{</span>
    <span class="c1">// calculate their amount in MySQL</span>
  <span class="o">}</span>
  <span class="nd">@Cacheable.FlushBefore</span>
  <span class="kt">void</span> <span class="nf">add</span><span class="o">(</span><span class="n">Employee</span> <span class="n">employee</span><span class="o">)</span> <span class="o">{</span>
    <span class="c1">// add a new one to MySQL</span>
  <span class="o">}</span>
<span class="o">}</span></code></pre></figure><p>It&#39;s obvious that the number of employees in the database will be different after <code>add()</code> method execution and the result of <code>size()</code> should be invalidated in cache. This invalidation operation is called &quot;flushing&quot; and <code>@Cacheable.FlushBefore</code> triggers it.</p><p>Actually, every call to <code>add()</code> invalidates all cached methods in this class, not only <code>size()</code>.</p><p>There is also <code>@Cacheable.FlushAfter</code>. The difference is that <code>FlushBefore</code> guarantees that cache is already invalidated when the method <code>add()</code> starts. <code>FlushAfter</code> invalidates cache after method <code>add()</code> finishes. This small difference makes a big one, sometimes.</p><p>This article explains <a href="http://aspects.jcabi.com/example-weaving.html">how to add jcabi-aspects to your project</a>.</p></p>--> <nav class="buttons notranslate desktop-only"> <a href="http://www.facebook.com/sharer/sharer.php?u=https://www.yegor256.com/2014/08/03/cacheable-java-annotation.html" title="Share on Facebook" class="button" rel="nofollow"> <span class="count count-facebook">0</span> <i class="icon icon-facebook notranslate" aria-hidden="true"></i> </a> <a href="https://twitter.com/share?url=https://www.yegor256.com/2014/08/03/cacheable-java-annotation.html&amp;text=Cache+Java+Method+Results" title="Share on Twitter" class="button" rel="nofollow"> <span class="count count-twitter">0</span> <i class="icon icon-twitter notranslate" aria-hidden="true"></i> </a> <a href="https://plus.google.com/share?url=https://www.yegor256.com/2014/08/03/cacheable-java-annotation.html" title="Share on Google+" class="button" rel="nofollow"> <span class="count count-googleplus">0</span> <i class="icon icon-googleplus notranslate" aria-hidden="true"></i> </a> <a href="https://www.linkedin.com/cws/share?url=https://www.yegor256.com/2014/08/03/cacheable-java-annotation.html" title="Share on LinkedIn" class="button" rel="nofollow"> <span class="count count-linkedin">0</span> <i class="icon icon-linkedin notranslate" aria-hidden="true"></i> </a> <a href="http://reddit.com/submit?url=https://www.yegor256.com/2014/08/03/cacheable-java-annotation.html%3F2014-31&amp;title=Cache+Java+Method+Results" title="Share on Reddit" class="button" rel="nofollow"> <span class="count count-reddit">0</span> <i class="icon icon-reddit notranslate" aria-hidden="true"></i> </a> <a href="http://news.ycombinator.com/submitlink?u=https://www.yegor256.com/2014/08/03/cacheable-java-annotation.html%3F2014-31&amp;t=Cache+Java+Method+Results" title="Share on Hacker News" class="button" rel="nofollow"> <span class="count count-hackernews">0</span> <i class="icon icon-hackernews notranslate" aria-hidden="true"></i> </a> </nav> </header> <article class="main" itemprop="articleBody"><div > <figure class='badge'><a href='http://aspects.jcabi.com'><img src='http://img.jcabi.com/logo-square.svg' style='width:64px;max-width:100%;' alt='badge'/></a></figure><p>Say, you have a method that takes time to execute and you want its result to be cached. There are <a href="http://www.coderanch.com/how-to/java/CachingStrategies">many solutions</a>, including <a href="http://commons.apache.org/proper/commons-jcs/">Apache Commons JCS</a>, <a href="http://www.ehcache.org">Ehcache</a>, <a href="https://jcp.org/en/jsr/detail?id=107">JSR 107</a>, <a href="https://code.google.com/p/guava-libraries/wiki/CachesExplained">Guava Caching</a> and many others.</p><p><a href="http://aspects.jcabi.com/annotation-cacheable.html">jcabi-aspects</a> offers a very simple one, based on AOP aspects and Java6 <a href="/2016/04/12/java-annotations-are-evil.html">annotations</a>:</p><figure class="highlight"><pre><code class="language-java" data-lang="java"><span></span><span class="kn">import</span> <span class="nn">com.jcabi.aspects.Cacheable</span><span class="o">;</span>
<span class="kd">public</span> <span class="kd">class</span> <span class="nc">Page</span> <span class="o">{</span>
  <span class="nd">@Cacheable</span><span class="o">(</span><span class="n">lifetime</span> <span class="o">=</span> <span class="mi">5</span><span class="o">,</span> <span class="n">unit</span> <span class="o">=</span> <span class="n">TimeUnit</span><span class="o">.</span><span class="na">MINUTES</span><span class="o">)</span>
  <span class="n">String</span> <span class="nf">load</span><span class="o">()</span> <span class="o">{</span>
    <span class="k">return</span> <span class="k">new</span> <span class="n">URL</span><span class="o">(</span><span class="s">&quot;http://google.com&quot;</span><span class="o">).</span><span class="na">getContent</span><span class="o">().</span><span class="na">toString</span><span class="o">();</span>
  <span class="o">}</span>
<span class="o">}</span></code></pre></figure><p>The result of <code>load()</code> method will be cached in memory for five minutes.</p><h2 id="how-it-works">How It Works?</h2><p>This post about <a href="/2014/06/01/aop-aspectj-java-method-logging.html">AOP, AspectJ and method logging</a> explains how &quot;aspect weaving&quot; works (I highly recommend that you read it first).</p><p>Here I&#39;ll explain how caching works.</p><p>The approach is very straight forward. There is a static hash map with keys as &quot;method coordinates&quot; and values as their results. Method coordinates consist of the object, an owner of the method and a method name with parameter types.</p><p>In the example above, right after the method <code>load()</code> finishes, the map gets a new entry (simplified example, of course):</p><figure class="highlight"><pre><code class="language-text" data-lang="text"><span></span>key: [page, &quot;load()&quot;]
value: &quot;&lt;html&gt;...&lt;/html&gt;&quot;</code></pre></figure><p>Every consecutive call to <code>load()</code> will be intercepted by the aspect from <a href="http://aspects.jcabi.com">jcabi-aspects</a> and resolved immediately with a value from the cache map. The method will not get any control until the end of its lifetime, which is five minutes in the example above.</p><h2 id="what-about-cache-flushing">What About Cache Flushing?</h2><p>Sometimes it&#39;s necessary to have the ability to flush cache before the end of its lifetime. Here is a practical example:</p><figure class="highlight"><pre><code class="language-java" data-lang="java"><span></span><span class="kn">import</span> <span class="nn">com.jcabi.aspects.Cacheable</span><span class="o">;</span>
<span class="kd">public</span> <span class="kd">class</span> <span class="nc">Employees</span> <span class="o">{</span>
  <span class="nd">@Cacheable</span><span class="o">(</span><span class="n">lifetime</span> <span class="o">=</span> <span class="mi">1</span><span class="o">,</span> <span class="n">unit</span> <span class="o">=</span> <span class="n">TimeUnit</span><span class="o">.</span><span class="na">HOURS</span><span class="o">)</span>
  <span class="kt">int</span> <span class="nf">size</span><span class="o">()</span> <span class="o">{</span>
    <span class="c1">// calculate their amount in MySQL</span>
  <span class="o">}</span>
  <span class="nd">@Cacheable.FlushBefore</span>
  <span class="kt">void</span> <span class="nf">add</span><span class="o">(</span><span class="n">Employee</span> <span class="n">employee</span><span class="o">)</span> <span class="o">{</span>
    <span class="c1">// add a new one to MySQL</span>
  <span class="o">}</span>
<span class="o">}</span></code></pre></figure><p>It&#39;s obvious that the number of employees in the database will be different after <code>add()</code> method execution and the result of <code>size()</code> should be invalidated in cache. This invalidation operation is called &quot;flushing&quot; and <code>@Cacheable.FlushBefore</code> triggers it.</p><p>Actually, every call to <code>add()</code> invalidates all cached methods in this class, not only <code>size()</code>.</p><p>There is also <code>@Cacheable.FlushAfter</code>. The difference is that <code>FlushBefore</code> guarantees that cache is already invalidated when the method <code>add()</code> starts. <code>FlushAfter</code> invalidates cache after method <code>add()</code> finishes. This small difference makes a big one, sometimes.</p><p>This article explains <a href="http://aspects.jcabi.com/example-weaving.html">how to add jcabi-aspects to your project</a>.</p></div></article></div><div class="wrapper"> <related-posts /></div><div class="disqus" role="complementary"><p class="disqus_hint"> Please, use <a href="https://help.disqus.com/commenting/what-html-tags-are-allowed-within-comments">syntax highlighting</a> in your comments, to make them more readable.</p><div id="disqus_thread" class="disqus-thread"> <a>&nbsp;</a></div><script> var disqus_config = function () { this.page.url = document.location.href.split('?')[0].split('#')[0].replace('https://', 'http://'); this.page.identifier = this.page.url; }; (function() { var d = document, s = d.createElement('script'); s.src = '//yegor256.disqus.com/embed.js'; s.setAttribute('data-timestamp', +new Date()); (d.head || d.body).appendChild(s); })(); </script> <noscript><div><p class="red"> JavaScript is disabled in your browser, that's why you can't see comments under this post.</p></div></noscript></div><div class="wrapper"> <footer class="footer"><p> &copy; <span itemscope="" itemprop="copyrightHolder" itemtype="http://schema.org/Person"> <span itemprop="name">Yegor Bugayenko</span> </span> 2014&ndash;<span itemprop="copyrightYear">2018</span></p></footer></div></section><div class="wrapper unprintable" style="text-align:center;margin-top:2em;"> <a href="http://www.sixnines.io/h/3ba1652f"> <img src="//www.sixnines.io/b/3ba1652f?style=flat" alt="sixnines availability badge"/> </a></div><script src="//code.jquery.com/jquery-1.9.0.min.js"></script> <script src="/js/all.js?4e047f6f42b"></script> <script>var disqus_shortname = 'yegor256';</script> <script id="dsq-count-scr" src="//yegor256.disqus.com/count.js" async="async"></script> <script> (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){ (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o), m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m) })(window,document,'script','//www.google-analytics.com/analytics.js','ga'); ga('create', 'UA-1963507-32', 'auto'); ga('send', 'pageview'); </script> <script> Cd=document;Cr="&"+Math.random();Cp="&s=1"; Cd.cookie="b=b";if(Cd.cookie)Cp+="&c=1"; Cp+="&t="+(new Date()).getTimezoneOffset(); if(self!=top)Cp+="&f=1"; </script> <script> if(navigator.javaEnabled())Cp+="&j=1"; </script> <script> if(typeof(screen)!='undefined')Cp+="&w="+screen.width+"&h="+ screen.height+"&d="+(screen.colorDepth?screen.colorDepth:screen.pixelDepth); </script> <script> Cd.write("<img src='//c.hit.ua/hit?i=95870&g=0&x=2"+Cp+Cr+ "&r="+escape(Cd.referrer)+"&u="+escape(window.location.href)+ "' border='0' wi"+"dth='1' he"+"ight='1'/>"); </script> <script type="application/ld+json"> { "@context": "http://schema.org", "@type": "Person", "name": "Yegor Bugayenko", "url": "http://www.yegor256.com", "sameAs": [ "https://www.facebook.com/yegor256", "https://instagram.com/yegor256", "https://www.linkedin.com/in/yegor256", "https://twitter.com/yegor256", "https://github.com/yegor256", "https://www.pinterest.com/yegor256/" ] } </script> </body> </html> <!DOCTYPE html> <html xmlns="http://www.w3.org/1999/xhtml" lang="en-US" xml:lang="en-US" itemscope="" itemtype="http://schema.org/WebSite"> <head> <meta charset="utf-8"/> <meta name="description" content="Liquibase is a convenient tool for database migration management. Here, I explain how to use it with Maven projects. " /> <meta name="keywords" content="liquibase integration testing java, liquibase java mysql, liquibase java postgresql, liquibase java test, liquibase maven example, liquibase maven integration test, liquibase maven mysql" /> <meta name="viewport" content="width=device-width,minimum-scale=1,initial-scale=1"/> <meta name="google-site-verification" content="JEj_gQr2CPe2QKGw8XdMz0R7VboQIUbX3FlM-lwTq-8" /> <meta name="author" content="Yegor Bugayenko"> <meta name="article:published_time" content="2014-07-20 00:00:00 +0000"> <meta name="og:site_name" content="Yegor Bugayenko"/> <meta name="og:type" content="article" /> <meta name="og:locale" content="en_US" /> <meta name="twitter:account_id" content="4503599630178231" /> <meta name="twitter:creator" content="@yegor256"/> <meta name="twitter:site" content="@yegor256"/> <meta name="twitter:title" property="og:title" content="Liquibase with Maven"/> <meta name="twitter:description" property="og:description" content="Liquibase is a convenient tool for database migration management. Here, I explain how to use it with Maven projects. "/> <meta name="twitter:url" property="og:url" content="https://www.yegor256.com/2014/07/20/liquibase-in-maven.html"/> <meta name="telegram:channel" content="AAAAAEJFMRzsRTRxM3ec6A"/> <link rel="search" type="application/opensearchdescription+xml" href="/opensearch.xml" title="yegor256" /> <link rel="shortcut icon" href="/favicon.ico?4e047f6f42b"/> <link rel="apple-touch-icon" href="/favicon.ico?4e047f6f42b"/> <link rel="alternate" type="application/rss+xml" title="RSS for yegor256.com" href="https://www.yegor256.com/rss.xml"/> <link rel="stylesheet" href="/css/layout.css?4e047f6f42b"/> <link rel="stylesheet" href="/css/icons.css?4e047f6f42b"/> <link rel="canonical" href="https://www.yegor256.com/2014/07/20/liquibase-in-maven.html" /> <link rel="amphtml" href="https://www.yegor256.com/2014/07/20/liquibase-in-maven.amp.html" /> <title>Liquibase with Maven </title> </head> <body><div class="wrapper"> <aside class="header-toggle unprintable" id="header-toggle" title="Show the menu" onclick="$('#header').show();$('#header-toggle').hide();">&#9776;</aside> <header class="header" id="header"><div class="face"> <a href="/about-me.html#form" class="sub" title="Click to subscribe to my monthly newsletter"><span>Subscribe</span></a> <a href="/about-me.html" style="position:relative;"> <img src="/images/face-256x256.jpg" class="photo" alt="Yegor Bugayenko"/> </a></div><nav><ul class="menu social notranslate"> <li><a href="https://twitter.com/intent/follow?screen_name=yegor256" rel="nofollow" title="Follow me on Twitter"><i class="icon icon-twitter notranslate" aria-hidden="true"></i></a></li> <li><a href="/rss.xml" rel="nofollow" title="Subscribe to my RSS feed"><i class="icon icon-rss notranslate" aria-hidden="true"></i></a></li> <li><a itemprop="sameAs" href="https://github.com/yegor256" rel="nofollow" title="My GitHub profile"><i class="icon icon-github notranslate" aria-hidden="true"></i></a></li> <li><a itemprop="sameAs" href="http://stackoverflow.com/users/187141/yegor256" rel="nofollow" title="My StackOverflow profile"><i class="icon icon-stackoverflow notranslate" aria-hidden="true"></i></a></li> <li><a itemprop="sameAs" href="https://www.facebook.com/yegor256" rel="nofollow" title="Follow me on Facebook"><i class="icon icon-facebook notranslate" aria-hidden="true"></i></a></li> <li><a itemprop="sameAs" href="https://instagram.com/yegor256" rel="nofollow" title="Follow me on Instagram"><i class="icon icon-instagram notranslate" aria-hidden="true"></i></a></li> <li><a itemprop="sameAs" href="https://www.linkedin.com/in/yegor256" rel="nofollow" title="My LinkedIn profile"><i class="icon icon-linkedin notranslate" aria-hidden="true"></i></a></li> <li><a itemprop="sameAs" href="https://www.youtube.com/c/yegor256?sub_confirmation=1" rel="nofollow" title="My Youtube video channel"><i class="icon icon-youtube notranslate" aria-hidden="true"></i></a></li> <li><a itemprop="sameAs" href="https://www.pinterest.com/yegor256/" rel="nofollow" title="My Pinterest boards"><i class="icon icon-pinterest notranslate" aria-hidden="true"></i></a></li> <li><a itemprop="sameAs" href="https://angel.co/yegor256" rel="nofollow" title="My AngelList profile"><i class="icon icon-angellist notranslate" aria-hidden="true"></i></a></li> <li><a href="https://soundcloud.com/yegor256" rel="nofollow" title="My podcast"><i class="icon icon-podcast notranslate" aria-hidden="true"></i></a></li> <li><a href="https://itunes.apple.com/us/podcast/yegor256-podcast/id1150826721" rel="nofollow" title="My iTunes podcast"><i class="icon icon-itunes notranslate" aria-hidden="true"></i></a></li> <li><a href="https://t.me/joinchat/AAAAAEJFMRzsRTRxM3ec6A" rel="nofollow" title="My Telegram public channel"><i class="icon icon-telegram notranslate" aria-hidden="true"></i></a></li> <li><a href="mailto:blog@yegor256.com" rel="nofollow" title="Email me any time"><i class="icon icon-mail notranslate" aria-hidden="true"></i></a></li></ul><ul class="menu"> <li><a href="/" title="Home page">Home</a></li> <li ><a href="/best.html" title="Best articles to read">12&#160;Best</a></li> <li ><a href="/contents.html" title="The contents of the entire blog">All&#160;288</a></li> <li ><a href="/webinars.html" title="My webinars">Webinars</a></li> <li ><a href="/talks.html" title="Future and past conference talks">Talks</a></li> <li ><a href="/books.html" title="The books I wrote">Books</a></li> <li ><a href="/papers.html" title="My academic papers and patents">Papers</a></li> <li ><a href="/pets.html" title="My loved pet projects">Pets</a></li> <li ><a href="/award.html" title="Software quality award">Award</a></li> <li ><a href="/testimonials.html" title="What some people say about me">Testimonials</a></li> <li ><a href="/shift-m.html" title="Audio podcast about project management">Shift-M</a></li> <li ><a href="/paintings.html" title="My paintings for sale">Paintings</a></li> <li><a href="http://ru.yegor256.com/" title="Немного на русском языке">По-русски</a></li></ul></nav><div class="search"> <form method="get" action="https://www.google.com/search" itemprop="potentialAction" itemscope="" itemtype="http://schema.org/SearchAction"> <meta itemprop="target" content="https://www.google.com/search?q={q}"/> <input name="sitesearch" value="yegor256.com" type="hidden"/> <input itemprop="query-input" type="text" id="search-query" class="field field-text" required="required" onfocus="$('.google').css('visibility', 'visible');" name="q" placeholder="Search..." autocomplete="off"/> <input type="image" src="/images/google-search-icon.svg" class="google" title="Search via Google" alt="Search via Google"/> </form></div><div class="hot"><ul> <li> <a href="/code-ahead.html">Code Ahead</a> was published on Amazon just a few days ago! It is my new book, a novel about programmers. It explains in details the majority of ideas that stand behind <a href="https://www.zerocracy.com">Zerocracy</a> and <a href="https://www.xdsd.org">XDSD</a>. </li> <li> At <a href="/webinars.html">Webinar #37</a> we will discuss naming problem in OOP, for objects, methods and attributes; join us on <b>September 12</b>, at 11am PST. </li></ul></div></header></div><section itemscope="" itemtype="http://schema.org/BlogPosting"><div class="wrapper"> <header><p class="printable"> <img src="https://api.qrserver.com/v1/create-qr-code/?data=https://www.yegor256.com/2014/07/20/liquibase-in-maven.html&amp;format=svg" style="width:125px;height:125px;" alt="QR code"/></p><p class="printable"> <code itemprop="url">https://www.yegor256.com/2014/07/20/liquibase-in-maven.html</code></p><h1 itemprop="name headline mainEntityOfPage">Liquibase with Maven</h1><ul class="subline"> <li> <time itemprop="datePublished" datetime="2014-07-20T00:00:00+00:00"> 20 July 2014 </time> </li> <li class="printable" itemscope="" itemprop="author" itemtype="http://schema.org/Person"> <span itemprop="name">Yegor Bugayenko</span> </li> <li class="unprintable"> <i class="icon icon-comments"></i> <a href="http://www.yegor256.com/2014/07/20/liquibase-in-maven.html#disqus_thread" itemprop="discussionUrl">comments</a> </li></ul><h2 id="maven-plugin">Maven Plugin</h2><p>Let&#39;s assume you&#39;re using MySQL (PostgreSQL or any other database configuration will be very similar.)</p><p>Add <code>liquibase-maven-plugin</code> to your <a href="http://maven.apache.org/pom.html"><code>pom.xml</code></a> (get its latest version in <a href="http://search.maven.org/">Maven Central</a>):</p><figure class="highlight"><pre><code class="language-xml" data-lang="xml"><span></span><span class="nt">&lt;project&gt;</span>
  [...]
  <span class="nt">&lt;build&gt;</span>
    [...]
    <span class="nt">&lt;plugins&gt;</span>
      <span class="nt">&lt;plugin&gt;</span>
        <span class="nt">&lt;groupId&gt;</span>org.liquibase<span class="nt">&lt;/groupId&gt;</span>
        <span class="nt">&lt;artifactId&gt;</span>liquibase-maven-plugin<span class="nt">&lt;/artifactId&gt;</span>
        <span class="nt">&lt;configuration&gt;</span>
          <span class="nt">&lt;changeLogFile&gt;</span>
            ${basedir}/src/main/liquibase/master.xml
          <span class="nt">&lt;/changeLogFile&gt;</span>
          <span class="nt">&lt;driver&gt;</span>com.mysql.jdbc.Driver<span class="nt">&lt;/driver&gt;</span>
          <span class="nt">&lt;url&gt;</span>jdbc:mysql://${mysql.host}:${mysql.port}/${mysql.db}<span class="nt">&lt;/url&gt;</span>
          <span class="nt">&lt;username&gt;</span>${mysql.login}<span class="nt">&lt;/username&gt;</span>
          <span class="nt">&lt;password&gt;</span>${mysql.password}<span class="nt">&lt;/password&gt;</span>
        <span class="nt">&lt;/configuration&gt;</span>
      <span class="nt">&lt;/plugin&gt;</span>
    <span class="nt">&lt;/plugins&gt;</span>
  <span class="nt">&lt;/build&gt;</span>
<span class="nt">&lt;/project&gt;</span></code></pre></figure><p>To check that it works, run <code>mvn liquibase:help</code>.</p><p>I would recommend you keep database credentials in <a href="http://maven.apache.org/settings.html"><code>settings.xml</code></a> and in their respective profiles. For example:</p><figure class="highlight"><pre><code class="language-xml" data-lang="xml"><span></span><span class="nt">&lt;settings&gt;</span>
  <span class="nt">&lt;profiles&gt;</span>
    <span class="nt">&lt;profile&gt;</span>
      <span class="nt">&lt;id&gt;</span>production<span class="nt">&lt;/id&gt;</span>
      <span class="nt">&lt;properties&gt;</span>
        <span class="nt">&lt;mysql.host&gt;</span>db.example.com<span class="nt">&lt;/mysql.host&gt;</span>
        <span class="nt">&lt;mysql.port&gt;</span>3306<span class="nt">&lt;/mysql.port&gt;</span>
        <span class="nt">&lt;mysql.db&gt;</span>example<span class="nt">&lt;/mysql.db&gt;</span>
      <span class="nt">&lt;/properties&gt;</span>
    <span class="nt">&lt;/profile&gt;</span>
    <span class="nt">&lt;profile&gt;</span>
      <span class="nt">&lt;id&gt;</span>test<span class="nt">&lt;/id&gt;</span>
      <span class="nt">&lt;properties&gt;</span>
        <span class="nt">&lt;mysql.host&gt;</span>test-db.example.com<span class="nt">&lt;/mysql.host&gt;</span>
        <span class="nt">&lt;mysql.port&gt;</span>3306<span class="nt">&lt;/mysql.port&gt;</span>
        <span class="nt">&lt;mysql.db&gt;</span>example-db<span class="nt">&lt;/mysql.db&gt;</span>
      <span class="nt">&lt;/properties&gt;</span>
    <span class="nt">&lt;/profile&gt;</span>
  <span class="nt">&lt;/profiles&gt;</span>
<span class="nt">&lt;/settings&gt;</span></code></pre></figure><p>When you run Maven, don&#39;t forget to turn on one of the profiles. For example: <code>mvn -Pproduction</code>.</p><h2 id="initial-schema">Initial Schema</h2><p>I assume you already have a database with a schema (tables, triggers, views, etc.) and some data. You should &quot;reverse engineer&quot; it and create an initial schema file for Liquibase. In other words, we should inform Liquibase where we are at the moment, so that it starts to apply changes from this point.</p><p>Maven plugin doesn&#39;t support it, so you will have to run Liquibase directly. But, it&#39;s not that difficult. First, run <code>mvn liquibase:help</code> in order to download all artifacts. Then, replace placeholders with your actual credentials:</p><figure class="highlight"><pre><code class="language-bash" data-lang="bash"><span></span>$ java -jar <span class="se">\</span>
  ~/.m2/repository/org/liquibase/liquibase-core/3.1.1/liquibase-core-3.1.1.jar <span class="se">\</span>
  --driver<span class="o">=</span>com.mysql.jdbc.Driver <span class="se">\</span>
  --url<span class="o">=</span>jdbc:mysql://db.example.com:3306/example <span class="se">\</span>
  --username<span class="o">=</span>example --password<span class="o">=</span>example <span class="se">\</span>
  generateChangeLog &gt; src/main/liquibase/2014/000-initial-schema.xml</code></pre></figure><p>Liquibase will analyze your current database schema and copy its own schema into <code>src/main/liquibase/2014/000-initial-schema.xml</code>.</p><h2 id="master-changeset">Master Changeset</h2><p>Now, create XML master changeset and save it to <code>src/main/liquibase/master.xml</code>:</p><figure class="highlight"><pre><code class="language-xml" data-lang="xml"><span></span><span class="nt">&lt;databaseChangeLog</span>
  <span class="na">xmlns=</span><span class="s">&quot;http://www.liquibase.org/xml/ns/dbchangelog&quot;</span>
  <span class="na">xmlns:xsi=</span><span class="s">&quot;http://www.w3.org/2001/XMLSchema-instance&quot;</span>
  <span class="na">xsi:schemaLocation=</span><span class="s">&quot;http://www.liquibase.org/xml/ns/dbchangelog</span>
<span class="s">    http://www.liquibase.org/xml/ns/dbchangelog/dbchangelog-2.0.xsd&quot;</span><span class="nt">&gt;</span>
  <span class="nt">&lt;includeAll</span> <span class="na">path=</span><span class="s">&quot;src/main/liquibase/2014&quot;</span> <span class="nt">/&gt;</span>
<span class="nt">&lt;/databaseChangeLog&gt;</span></code></pre></figure><p>It is an entry point for Liquibase. It starts from this file and loads all other changesets available in <code>src/main/liquibase/2014</code>. They should be either <code>.xml</code> or <code>.sql</code>. I recommend that you use XML mostly because it is easier to maintain and works faster.</p><h2 id="incremental-changesets">Incremental Changesets</h2><p>Let&#39;s create a simple changeset, which adds a new column to an existing table:</p><figure class="highlight"><pre><code class="language-xml" data-lang="xml"><span></span><span class="nt">&lt;databaseChangeLog</span> <span class="na">xmlns=</span><span class="s">&#39;http://www.liquibase.org/xml/ns/dbchangelog&#39;</span>
  <span class="na">xmlns:xsi=</span><span class="s">&#39;http://www.w3.org/2001/XMLSchema-instance&#39;</span>
  <span class="na">xsi:schemaLocation=</span><span class="s">&#39;http://www.liquibase.org/xml/ns/dbchangelog</span>
<span class="s">    http://www.liquibase.org/xml/ns/dbchangelog/dbchangelog-2.0.xsd&#39;</span><span class="nt">&gt;</span>
  <span class="nt">&lt;changeSet</span> <span class="na">id=</span><span class="s">&quot;002&quot;</span> <span class="na">author=</span><span class="s">&quot;Yegor&quot;</span><span class="nt">&gt;</span>
    <span class="nt">&lt;sql&gt;</span>
      ALTER TABLE user ADD COLUMN address VARCHAR(1024);
    <span class="nt">&lt;/sql&gt;</span>
  <span class="nt">&lt;/changeSet&gt;</span>
<span class="nt">&lt;/databaseChangeLog&gt;</span></code></pre></figure><p>We save this file in <code>src/main/liquibase/2014/002-add-user-address.xml</code>. In big projects, you can name your files by the names of the tickets they are produced in. For example, <code>045-3432.xml</code>, which means changeset number 45 coming from ticket #3432.</p><p>The important thing is to have this numeric prefix in front of file names, in order to sort them correctly. We want changes to be applied in their correct chronological order.</p><p>That&#39;s it. We&#39;re ready to run <code>mvn liquibase:update -Pproduction</code> and our production database will be updated---a new column will be added to the <code>user</code> table.</p><p>Also, see how <a href="/2014/05/21/mysql-maven-plugin.html">MySQL Maven Plugin</a> can help you to automate integration testing of database-connected classes.</p></p>--> <nav class="buttons notranslate desktop-only"> <a href="http://www.facebook.com/sharer/sharer.php?u=https://www.yegor256.com/2014/07/20/liquibase-in-maven.html" title="Share on Facebook" class="button" rel="nofollow"> <span class="count count-facebook">0</span> <i class="icon icon-facebook notranslate" aria-hidden="true"></i> </a> <a href="https://twitter.com/share?url=https://www.yegor256.com/2014/07/20/liquibase-in-maven.html&amp;text=Liquibase+with+Maven" title="Share on Twitter" class="button" rel="nofollow"> <span class="count count-twitter">0</span> <i class="icon icon-twitter notranslate" aria-hidden="true"></i> </a> <a href="https://plus.google.com/share?url=https://www.yegor256.com/2014/07/20/liquibase-in-maven.html" title="Share on Google+" class="button" rel="nofollow"> <span class="count count-googleplus">0</span> <i class="icon icon-googleplus notranslate" aria-hidden="true"></i> </a> <a href="https://www.linkedin.com/cws/share?url=https://www.yegor256.com/2014/07/20/liquibase-in-maven.html" title="Share on LinkedIn" class="button" rel="nofollow"> <span class="count count-linkedin">0</span> <i class="icon icon-linkedin notranslate" aria-hidden="true"></i> </a> <a href="http://reddit.com/submit?url=https://www.yegor256.com/2014/07/20/liquibase-in-maven.html%3F2014-29&amp;title=Liquibase+with+Maven" title="Share on Reddit" class="button" rel="nofollow"> <span class="count count-reddit">0</span> <i class="icon icon-reddit notranslate" aria-hidden="true"></i> </a> <a href="http://news.ycombinator.com/submitlink?u=https://www.yegor256.com/2014/07/20/liquibase-in-maven.html%3F2014-29&amp;t=Liquibase+with+Maven" title="Share on Hacker News" class="button" rel="nofollow"> <span class="count count-hackernews">0</span> <i class="icon icon-hackernews notranslate" aria-hidden="true"></i> </a> </nav> </header> <article class="main" itemprop="articleBody"><div ><p><a href="http://www.liquibase.org">Liquibase</a> is a migration management tool for relational databases. It versionalizes schema and data changes in a database; similar to the way Git or SVN works for source code. Thanks to their <a href="http://www.liquibase.org/documentation/maven/">Maven plugin</a>, Liquibase can be used as a part of a build automation scenario.</p><h2 id="maven-plugin">Maven Plugin</h2><p>Let&#39;s assume you&#39;re using MySQL (PostgreSQL or any other database configuration will be very similar.)</p><p>Add <code>liquibase-maven-plugin</code> to your <a href="http://maven.apache.org/pom.html"><code>pom.xml</code></a> (get its latest version in <a href="http://search.maven.org/">Maven Central</a>):</p><figure class="highlight"><pre><code class="language-xml" data-lang="xml"><span></span><span class="nt">&lt;project&gt;</span>
  [...]
  <span class="nt">&lt;build&gt;</span>
    [...]
    <span class="nt">&lt;plugins&gt;</span>
      <span class="nt">&lt;plugin&gt;</span>
        <span class="nt">&lt;groupId&gt;</span>org.liquibase<span class="nt">&lt;/groupId&gt;</span>
        <span class="nt">&lt;artifactId&gt;</span>liquibase-maven-plugin<span class="nt">&lt;/artifactId&gt;</span>
        <span class="nt">&lt;configuration&gt;</span>
          <span class="nt">&lt;changeLogFile&gt;</span>
            ${basedir}/src/main/liquibase/master.xml
          <span class="nt">&lt;/changeLogFile&gt;</span>
          <span class="nt">&lt;driver&gt;</span>com.mysql.jdbc.Driver<span class="nt">&lt;/driver&gt;</span>
          <span class="nt">&lt;url&gt;</span>jdbc:mysql://${mysql.host}:${mysql.port}/${mysql.db}<span class="nt">&lt;/url&gt;</span>
          <span class="nt">&lt;username&gt;</span>${mysql.login}<span class="nt">&lt;/username&gt;</span>
          <span class="nt">&lt;password&gt;</span>${mysql.password}<span class="nt">&lt;/password&gt;</span>
        <span class="nt">&lt;/configuration&gt;</span>
      <span class="nt">&lt;/plugin&gt;</span>
    <span class="nt">&lt;/plugins&gt;</span>
  <span class="nt">&lt;/build&gt;</span>
<span class="nt">&lt;/project&gt;</span></code></pre></figure><p>To check that it works, run <code>mvn liquibase:help</code>.</p><p>I would recommend you keep database credentials in <a href="http://maven.apache.org/settings.html"><code>settings.xml</code></a> and in their respective profiles. For example:</p><figure class="highlight"><pre><code class="language-xml" data-lang="xml"><span></span><span class="nt">&lt;settings&gt;</span>
  <span class="nt">&lt;profiles&gt;</span>
    <span class="nt">&lt;profile&gt;</span>
      <span class="nt">&lt;id&gt;</span>production<span class="nt">&lt;/id&gt;</span>
      <span class="nt">&lt;properties&gt;</span>
        <span class="nt">&lt;mysql.host&gt;</span>db.example.com<span class="nt">&lt;/mysql.host&gt;</span>
        <span class="nt">&lt;mysql.port&gt;</span>3306<span class="nt">&lt;/mysql.port&gt;</span>
        <span class="nt">&lt;mysql.db&gt;</span>example<span class="nt">&lt;/mysql.db&gt;</span>
      <span class="nt">&lt;/properties&gt;</span>
    <span class="nt">&lt;/profile&gt;</span>
    <span class="nt">&lt;profile&gt;</span>
      <span class="nt">&lt;id&gt;</span>test<span class="nt">&lt;/id&gt;</span>
      <span class="nt">&lt;properties&gt;</span>
        <span class="nt">&lt;mysql.host&gt;</span>test-db.example.com<span class="nt">&lt;/mysql.host&gt;</span>
        <span class="nt">&lt;mysql.port&gt;</span>3306<span class="nt">&lt;/mysql.port&gt;</span>
        <span class="nt">&lt;mysql.db&gt;</span>example-db<span class="nt">&lt;/mysql.db&gt;</span>
      <span class="nt">&lt;/properties&gt;</span>
    <span class="nt">&lt;/profile&gt;</span>
  <span class="nt">&lt;/profiles&gt;</span>
<span class="nt">&lt;/settings&gt;</span></code></pre></figure><p>When you run Maven, don&#39;t forget to turn on one of the profiles. For example: <code>mvn -Pproduction</code>.</p><h2 id="initial-schema">Initial Schema</h2><p>I assume you already have a database with a schema (tables, triggers, views, etc.) and some data. You should &quot;reverse engineer&quot; it and create an initial schema file for Liquibase. In other words, we should inform Liquibase where we are at the moment, so that it starts to apply changes from this point.</p><p>Maven plugin doesn&#39;t support it, so you will have to run Liquibase directly. But, it&#39;s not that difficult. First, run <code>mvn liquibase:help</code> in order to download all artifacts. Then, replace placeholders with your actual credentials:</p><figure class="highlight"><pre><code class="language-bash" data-lang="bash"><span></span>$ java -jar <span class="se">\</span>
  ~/.m2/repository/org/liquibase/liquibase-core/3.1.1/liquibase-core-3.1.1.jar <span class="se">\</span>
  --driver<span class="o">=</span>com.mysql.jdbc.Driver <span class="se">\</span>
  --url<span class="o">=</span>jdbc:mysql://db.example.com:3306/example <span class="se">\</span>
  --username<span class="o">=</span>example --password<span class="o">=</span>example <span class="se">\</span>
  generateChangeLog &gt; src/main/liquibase/2014/000-initial-schema.xml</code></pre></figure><p>Liquibase will analyze your current database schema and copy its own schema into <code>src/main/liquibase/2014/000-initial-schema.xml</code>.</p><h2 id="master-changeset">Master Changeset</h2><p>Now, create XML master changeset and save it to <code>src/main/liquibase/master.xml</code>:</p><figure class="highlight"><pre><code class="language-xml" data-lang="xml"><span></span><span class="nt">&lt;databaseChangeLog</span>
  <span class="na">xmlns=</span><span class="s">&quot;http://www.liquibase.org/xml/ns/dbchangelog&quot;</span>
  <span class="na">xmlns:xsi=</span><span class="s">&quot;http://www.w3.org/2001/XMLSchema-instance&quot;</span>
  <span class="na">xsi:schemaLocation=</span><span class="s">&quot;http://www.liquibase.org/xml/ns/dbchangelog</span>
<span class="s">    http://www.liquibase.org/xml/ns/dbchangelog/dbchangelog-2.0.xsd&quot;</span><span class="nt">&gt;</span>
  <span class="nt">&lt;includeAll</span> <span class="na">path=</span><span class="s">&quot;src/main/liquibase/2014&quot;</span> <span class="nt">/&gt;</span>
<span class="nt">&lt;/databaseChangeLog&gt;</span></code></pre></figure><p>It is an entry point for Liquibase. It starts from this file and loads all other changesets available in <code>src/main/liquibase/2014</code>. They should be either <code>.xml</code> or <code>.sql</code>. I recommend that you use XML mostly because it is easier to maintain and works faster.</p><h2 id="incremental-changesets">Incremental Changesets</h2><p>Let&#39;s create a simple changeset, which adds a new column to an existing table:</p><figure class="highlight"><pre><code class="language-xml" data-lang="xml"><span></span><span class="nt">&lt;databaseChangeLog</span> <span class="na">xmlns=</span><span class="s">&#39;http://www.liquibase.org/xml/ns/dbchangelog&#39;</span>
  <span class="na">xmlns:xsi=</span><span class="s">&#39;http://www.w3.org/2001/XMLSchema-instance&#39;</span>
  <span class="na">xsi:schemaLocation=</span><span class="s">&#39;http://www.liquibase.org/xml/ns/dbchangelog</span>
<span class="s">    http://www.liquibase.org/xml/ns/dbchangelog/dbchangelog-2.0.xsd&#39;</span><span class="nt">&gt;</span>
  <span class="nt">&lt;changeSet</span> <span class="na">id=</span><span class="s">&quot;002&quot;</span> <span class="na">author=</span><span class="s">&quot;Yegor&quot;</span><span class="nt">&gt;</span>
    <span class="nt">&lt;sql&gt;</span>
      ALTER TABLE user ADD COLUMN address VARCHAR(1024);
    <span class="nt">&lt;/sql&gt;</span>
  <span class="nt">&lt;/changeSet&gt;</span>
<span class="nt">&lt;/databaseChangeLog&gt;</span></code></pre></figure><p>We save this file in <code>src/main/liquibase/2014/002-add-user-address.xml</code>. In big projects, you can name your files by the names of the tickets they are produced in. For example, <code>045-3432.xml</code>, which means changeset number 45 coming from ticket #3432.</p><p>The important thing is to have this numeric prefix in front of file names, in order to sort them correctly. We want changes to be applied in their correct chronological order.</p><p>That&#39;s it. We&#39;re ready to run <code>mvn liquibase:update -Pproduction</code> and our production database will be updated---a new column will be added to the <code>user</code> table.</p><p>Also, see how <a href="/2014/05/21/mysql-maven-plugin.html">MySQL Maven Plugin</a> can help you to automate integration testing of database-connected classes.</p></div></article></div><div class="wrapper"> <related-posts /></div><div class="disqus" role="complementary"><p class="disqus_hint"> Please, use <a href="https://help.disqus.com/commenting/what-html-tags-are-allowed-within-comments">syntax highlighting</a> in your comments, to make them more readable.</p><div id="disqus_thread" class="disqus-thread"> <a>&nbsp;</a></div><script> var disqus_config = function () { this.page.url = document.location.href.split('?')[0].split('#')[0].replace('https://', 'http://'); this.page.identifier = this.page.url; }; (function() { var d = document, s = d.createElement('script'); s.src = '//yegor256.disqus.com/embed.js'; s.setAttribute('data-timestamp', +new Date()); (d.head || d.body).appendChild(s); })(); </script> <noscript><div><p class="red"> JavaScript is disabled in your browser, that's why you can't see comments under this post.</p></div></noscript></div><div class="wrapper"> <footer class="footer"><p> &copy; <span itemscope="" itemprop="copyrightHolder" itemtype="http://schema.org/Person"> <span itemprop="name">Yegor Bugayenko</span> </span> 2014&ndash;<span itemprop="copyrightYear">2018</span></p></footer></div></section><div class="wrapper unprintable" style="text-align:center;margin-top:2em;"> <a href="http://www.sixnines.io/h/3ba1652f"> <img src="//www.sixnines.io/b/3ba1652f?style=flat" alt="sixnines availability badge"/> </a></div><script src="//code.jquery.com/jquery-1.9.0.min.js"></script> <script src="/js/all.js?4e047f6f42b"></script> <script>var disqus_shortname = 'yegor256';</script> <script id="dsq-count-scr" src="//yegor256.disqus.com/count.js" async="async"></script> <script> (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){ (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o), m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m) })(window,document,'script','//www.google-analytics.com/analytics.js','ga'); ga('create', 'UA-1963507-32', 'auto'); ga('send', 'pageview'); </script> <script> Cd=document;Cr="&"+Math.random();Cp="&s=1"; Cd.cookie="b=b";if(Cd.cookie)Cp+="&c=1"; Cp+="&t="+(new Date()).getTimezoneOffset(); if(self!=top)Cp+="&f=1"; </script> <script> if(navigator.javaEnabled())Cp+="&j=1"; </script> <script> if(typeof(screen)!='undefined')Cp+="&w="+screen.width+"&h="+ screen.height+"&d="+(screen.colorDepth?screen.colorDepth:screen.pixelDepth); </script> <script> Cd.write("<img src='//c.hit.ua/hit?i=95870&g=0&x=2"+Cp+Cr+ "&r="+escape(Cd.referrer)+"&u="+escape(window.location.href)+ "' border='0' wi"+"dth='1' he"+"ight='1'/>"); </script> <script type="application/ld+json"> { "@context": "http://schema.org", "@type": "Person", "name": "Yegor Bugayenko", "url": "http://www.yegor256.com", "sameAs": [ "https://www.facebook.com/yegor256", "https://instagram.com/yegor256", "https://www.linkedin.com/in/yegor256", "https://twitter.com/yegor256", "https://github.com/yegor256", "https://www.pinterest.com/yegor256/" ] } </script> </body> </html> <!DOCTYPE html> <html xmlns="http://www.w3.org/1999/xhtml" lang="en-US" xml:lang="en-US" itemscope="" itemtype="http://schema.org/WebSite"> <head> <meta charset="utf-8"/> <meta name="description" content="When there are many of them, then reading of MANIFEST.MF files can be a complex task, and their attributes may overlap; jcabi-manifests library makes this process easier. " /> <meta name="keywords" content="how to read manifest.mf, java manifest.mf, java read manifest.mf, manifest files java, manifest.mf classpath, manifest.mf example, manifest.mf maven" /> <meta name="viewport" content="width=device-width,minimum-scale=1,initial-scale=1"/> <meta name="google-site-verification" content="JEj_gQr2CPe2QKGw8XdMz0R7VboQIUbX3FlM-lwTq-8" /> <meta name="author" content="Yegor Bugayenko"> <meta name="article:published_time" content="2014-07-03 00:00:00 +0000"> <meta name="og:site_name" content="Yegor Bugayenko"/> <meta name="og:type" content="article" /> <meta name="og:locale" content="en_US" /> <meta name="twitter:account_id" content="4503599630178231" /> <meta name="twitter:creator" content="@yegor256"/> <meta name="twitter:site" content="@yegor256"/> <meta name="twitter:title" property="og:title" content="How to Read MANIFEST.MF Files"/> <meta name="twitter:description" property="og:description" content="When there are many of them, then reading of MANIFEST.MF files can be a complex task, and their attributes may overlap; jcabi-manifests library makes this process easier. "/> <meta name="twitter:url" property="og:url" content="https://www.yegor256.com/2014/07/03/how-to-read-manifest-mf.html"/> <meta name="telegram:channel" content="AAAAAEJFMRzsRTRxM3ec6A"/> <link rel="search" type="application/opensearchdescription+xml" href="/opensearch.xml" title="yegor256" /> <link rel="shortcut icon" href="/favicon.ico?4e047f6f42b"/> <link rel="apple-touch-icon" href="/favicon.ico?4e047f6f42b"/> <link rel="alternate" type="application/rss+xml" title="RSS for yegor256.com" href="https://www.yegor256.com/rss.xml"/> <link rel="stylesheet" href="/css/layout.css?4e047f6f42b"/> <link rel="stylesheet" href="/css/icons.css?4e047f6f42b"/> <link rel="canonical" href="https://www.yegor256.com/2014/07/03/how-to-read-manifest-mf.html" /> <link rel="amphtml" href="https://www.yegor256.com/2014/07/03/how-to-read-manifest-mf.amp.html" /> <title>How to Read MANIFEST.MF Files </title> </head> <body><div class="wrapper"> <aside class="header-toggle unprintable" id="header-toggle" title="Show the menu" onclick="$('#header').show();$('#header-toggle').hide();">&#9776;</aside> <header class="header" id="header"><div class="face"> <a href="/about-me.html#form" class="sub" title="Click to subscribe to my monthly newsletter"><span>Subscribe</span></a> <a href="/about-me.html" style="position:relative;"> <img src="/images/face-256x256.jpg" class="photo" alt="Yegor Bugayenko"/> </a></div><nav><ul class="menu social notranslate"> <li><a href="https://twitter.com/intent/follow?screen_name=yegor256" rel="nofollow" title="Follow me on Twitter"><i class="icon icon-twitter notranslate" aria-hidden="true"></i></a></li> <li><a href="/rss.xml" rel="nofollow" title="Subscribe to my RSS feed"><i class="icon icon-rss notranslate" aria-hidden="true"></i></a></li> <li><a itemprop="sameAs" href="https://github.com/yegor256" rel="nofollow" title="My GitHub profile"><i class="icon icon-github notranslate" aria-hidden="true"></i></a></li> <li><a itemprop="sameAs" href="http://stackoverflow.com/users/187141/yegor256" rel="nofollow" title="My StackOverflow profile"><i class="icon icon-stackoverflow notranslate" aria-hidden="true"></i></a></li> <li><a itemprop="sameAs" href="https://www.facebook.com/yegor256" rel="nofollow" title="Follow me on Facebook"><i class="icon icon-facebook notranslate" aria-hidden="true"></i></a></li> <li><a itemprop="sameAs" href="https://instagram.com/yegor256" rel="nofollow" title="Follow me on Instagram"><i class="icon icon-instagram notranslate" aria-hidden="true"></i></a></li> <li><a itemprop="sameAs" href="https://www.linkedin.com/in/yegor256" rel="nofollow" title="My LinkedIn profile"><i class="icon icon-linkedin notranslate" aria-hidden="true"></i></a></li> <li><a itemprop="sameAs" href="https://www.youtube.com/c/yegor256?sub_confirmation=1" rel="nofollow" title="My Youtube video channel"><i class="icon icon-youtube notranslate" aria-hidden="true"></i></a></li> <li><a itemprop="sameAs" href="https://www.pinterest.com/yegor256/" rel="nofollow" title="My Pinterest boards"><i class="icon icon-pinterest notranslate" aria-hidden="true"></i></a></li> <li><a itemprop="sameAs" href="https://angel.co/yegor256" rel="nofollow" title="My AngelList profile"><i class="icon icon-angellist notranslate" aria-hidden="true"></i></a></li> <li><a href="https://soundcloud.com/yegor256" rel="nofollow" title="My podcast"><i class="icon icon-podcast notranslate" aria-hidden="true"></i></a></li> <li><a href="https://itunes.apple.com/us/podcast/yegor256-podcast/id1150826721" rel="nofollow" title="My iTunes podcast"><i class="icon icon-itunes notranslate" aria-hidden="true"></i></a></li> <li><a href="https://t.me/joinchat/AAAAAEJFMRzsRTRxM3ec6A" rel="nofollow" title="My Telegram public channel"><i class="icon icon-telegram notranslate" aria-hidden="true"></i></a></li> <li><a href="mailto:blog@yegor256.com" rel="nofollow" title="Email me any time"><i class="icon icon-mail notranslate" aria-hidden="true"></i></a></li></ul><ul class="menu"> <li><a href="/" title="Home page">Home</a></li> <li ><a href="/best.html" title="Best articles to read">12&#160;Best</a></li> <li ><a href="/contents.html" title="The contents of the entire blog">All&#160;288</a></li> <li ><a href="/webinars.html" title="My webinars">Webinars</a></li> <li ><a href="/talks.html" title="Future and past conference talks">Talks</a></li> <li ><a href="/books.html" title="The books I wrote">Books</a></li> <li ><a href="/papers.html" title="My academic papers and patents">Papers</a></li> <li ><a href="/pets.html" title="My loved pet projects">Pets</a></li> <li ><a href="/award.html" title="Software quality award">Award</a></li> <li ><a href="/testimonials.html" title="What some people say about me">Testimonials</a></li> <li ><a href="/shift-m.html" title="Audio podcast about project management">Shift-M</a></li> <li ><a href="/paintings.html" title="My paintings for sale">Paintings</a></li> <li><a href="http://ru.yegor256.com/" title="Немного на русском языке">По-русски</a></li></ul></nav><div class="search"> <form method="get" action="https://www.google.com/search" itemprop="potentialAction" itemscope="" itemtype="http://schema.org/SearchAction"> <meta itemprop="target" content="https://www.google.com/search?q={q}"/> <input name="sitesearch" value="yegor256.com" type="hidden"/> <input itemprop="query-input" type="text" id="search-query" class="field field-text" required="required" onfocus="$('.google').css('visibility', 'visible');" name="q" placeholder="Search..." autocomplete="off"/> <input type="image" src="/images/google-search-icon.svg" class="google" title="Search via Google" alt="Search via Google"/> </form></div><div class="hot"><ul> <li> <a href="/code-ahead.html">Code Ahead</a> was published on Amazon just a few days ago! It is my new book, a novel about programmers. It explains in details the majority of ideas that stand behind <a href="https://www.zerocracy.com">Zerocracy</a> and <a href="https://www.xdsd.org">XDSD</a>. </li> <li> At <a href="/webinars.html">Webinar #37</a> we will discuss naming problem in OOP, for objects, methods and attributes; join us on <b>September 12</b>, at 11am PST. </li></ul></div></header></div><section itemscope="" itemtype="http://schema.org/BlogPosting"><div class="wrapper"> <header><p class="printable"> <img src="https://api.qrserver.com/v1/create-qr-code/?data=https://www.yegor256.com/2014/07/03/how-to-read-manifest-mf.html&amp;format=svg" style="width:125px;height:125px;" alt="QR code"/></p><p class="printable"> <code itemprop="url">https://www.yegor256.com/2014/07/03/how-to-read-manifest-mf.html</code></p><h1 itemprop="name headline mainEntityOfPage">How to Read MANIFEST.MF Files</h1><ul class="subline"> <li> <time itemprop="datePublished" datetime="2014-07-03T00:00:00+00:00"> 3 July 2014 </time> </li> <li class="printable" itemscope="" itemprop="author" itemtype="http://schema.org/Person"> <span itemprop="name">Yegor Bugayenko</span> </li> <li class="unprintable"> <i class="icon icon-comments"></i> <a href="http://www.yegor256.com/2014/07/03/how-to-read-manifest-mf.html#disqus_thread" itemprop="discussionUrl">comments</a> </li></ul><p>Let&#39;s see why you would want to read attributes from manifest files, and how it works on a low level.</p><h2 id="package-versioning">Package Versioning</h2><p>When you package a library or even a web application, it is a good practice to add an attribute to its <code>MANIFEST.MF</code> with the package version name and build number. In Maven, <a href="http://maven.apache.org/plugins/maven-jar-plugin/"><code>maven-jar-plugin</code></a> can help you (almost the same configuration for <a href="http://maven.apache.org/plugins/maven-war-plugin/"><code>maven-war-plugin</code></a>):</p><figure class="highlight"><pre><code class="language-xml" data-lang="xml"><span></span><span class="nt">&lt;plugin&gt;</span>
  <span class="nt">&lt;artifactId&gt;</span>maven-jar-plugin<span class="nt">&lt;/artifactId&gt;</span>
  <span class="nt">&lt;configuration&gt;</span>
    <span class="nt">&lt;archive&gt;</span>
      <span class="nt">&lt;manifestEntries&gt;</span>
        <span class="nt">&lt;Foo-Version&gt;</span>${project.version}<span class="nt">&lt;/Foo-Version&gt;</span>
        <span class="nt">&lt;Foo-Hash&gt;</span>${buildNumber}<span class="nt">&lt;/Foo-Hash&gt;</span>
      <span class="nt">&lt;/manifestEntries&gt;</span>
    <span class="nt">&lt;/archive&gt;</span>
  <span class="nt">&lt;/configuration&gt;</span>
<span class="nt">&lt;/plugin&gt;</span></code></pre></figure><p><code>buildnumber-maven-plugin</code> will help you to get <code>${buildNumber}</code> from Git, SVN or Mercurial:</p><figure class="highlight"><pre><code class="language-xml" data-lang="xml"><span></span><span class="nt">&lt;plugin&gt;</span>
  <span class="nt">&lt;groupId&gt;</span>org.codehaus.mojo<span class="nt">&lt;/groupId&gt;</span>
  <span class="nt">&lt;artifactId&gt;</span>buildnumber-maven-plugin<span class="nt">&lt;/artifactId&gt;</span>
  <span class="nt">&lt;executions&gt;</span>
    <span class="nt">&lt;execution&gt;</span>
      <span class="nt">&lt;goals&gt;</span>
        <span class="nt">&lt;goal&gt;</span>create<span class="nt">&lt;/goal&gt;</span>
      <span class="nt">&lt;/goals&gt;</span>
    <span class="nt">&lt;/execution&gt;</span>
  <span class="nt">&lt;/executions&gt;</span>
<span class="nt">&lt;/plugin&gt;</span></code></pre></figure><p>After all these manipulations, <code>MANIFEST.MF</code>, in your JAR will contain these two extra lines (on top of all others added there by Maven by default):</p><figure class="highlight"><pre><code class="language-text" data-lang="text"><span></span>Foo-Version: 1.0-SNAPSHOT
Foo-Hash: 7ef4ac3</code></pre></figure><p>In runtime, you can show these values to the user to help him understand which version of the product he is working with at any given moment.</p><p>Look at <a href="http://www.stateful.co">stateful.co</a>, for example. At the bottom of its front page, you see the version number and Git hash. They are retrieved from <code>MANIFEST.MF</code> of the deployed WAR package, on every page click.</p><h2 id="credentials">Credentials</h2><p>Although this may be considered as a bad practice (see <a href="http://amzn.to/2bQVmlb">Continuous Delivery: Reliable Software Releases through Build, Test, and Deployment Automation</a> by Jez Humble and David Farley), sometimes it is convenient to package production credentials right into the JAR/WAR archive during the <a href="/2014/10/08/continuous-integration-is-dead.html">continuous integration</a>/delivery cycle.</p><p>For example, you can encode your PostgreSQL connection details right into <code>MANIFEST.MF</code>:</p><figure class="highlight"><pre><code class="language-xml" data-lang="xml"><span></span><span class="nt">&lt;plugin&gt;</span>
  <span class="nt">&lt;artifactId&gt;</span>maven-war-plugin<span class="nt">&lt;/artifactId&gt;</span>
  <span class="nt">&lt;configuration&gt;</span>
    <span class="nt">&lt;archive&gt;</span>
      <span class="nt">&lt;manifestEntries&gt;</span>
        <span class="nt">&lt;Pgsql&gt;</span>jdbc:postgresql://${pg.host}:${pg.port}/${pg.db}<span class="nt">&lt;/Pgsql&gt;</span>
      <span class="nt">&lt;/manifestEntries&gt;</span>
    <span class="nt">&lt;/archive&gt;</span>
  <span class="nt">&lt;/configuration&gt;</span>
<span class="nt">&lt;/plugin&gt;</span></code></pre></figure><p>Afterwards, you can retrieve them in runtime using <a href="http://manifests.jcabi.com"><code>jcabi-manifests</code></a>:</p><figure class="highlight"><pre><code class="language-java" data-lang="java"><span></span><span class="n">String</span> <span class="n">url</span> <span class="o">=</span> <span class="n">Manifests</span><span class="o">.</span><span class="na">read</span><span class="o">(</span><span class="s">&quot;Pgsql&quot;</span><span class="o">);</span></code></pre></figure><p>If you know of any other useful purposes for <code>MANIFEST.MF</code>, let me know :)</p></p>--> <nav class="buttons notranslate desktop-only"> <a href="http://www.facebook.com/sharer/sharer.php?u=https://www.yegor256.com/2014/07/03/how-to-read-manifest-mf.html" title="Share on Facebook" class="button" rel="nofollow"> <span class="count count-facebook">0</span> <i class="icon icon-facebook notranslate" aria-hidden="true"></i> </a> <a href="https://twitter.com/share?url=https://www.yegor256.com/2014/07/03/how-to-read-manifest-mf.html&amp;text=How+to+Read+MANIFEST.MF+Files" title="Share on Twitter" class="button" rel="nofollow"> <span class="count count-twitter">0</span> <i class="icon icon-twitter notranslate" aria-hidden="true"></i> </a> <a href="https://plus.google.com/share?url=https://www.yegor256.com/2014/07/03/how-to-read-manifest-mf.html" title="Share on Google+" class="button" rel="nofollow"> <span class="count count-googleplus">0</span> <i class="icon icon-googleplus notranslate" aria-hidden="true"></i> </a> <a href="https://www.linkedin.com/cws/share?url=https://www.yegor256.com/2014/07/03/how-to-read-manifest-mf.html" title="Share on LinkedIn" class="button" rel="nofollow"> <span class="count count-linkedin">0</span> <i class="icon icon-linkedin notranslate" aria-hidden="true"></i> </a> <a href="http://reddit.com/submit?url=https://www.yegor256.com/2014/07/03/how-to-read-manifest-mf.html%3F2014-26&amp;title=How+to+Read+MANIFEST.MF+Files" title="Share on Reddit" class="button" rel="nofollow"> <span class="count count-reddit">0</span> <i class="icon icon-reddit notranslate" aria-hidden="true"></i> </a> <a href="http://news.ycombinator.com/submitlink?u=https://www.yegor256.com/2014/07/03/how-to-read-manifest-mf.html%3F2014-26&amp;t=How+to+Read+MANIFEST.MF+Files" title="Share on Hacker News" class="button" rel="nofollow"> <span class="count count-hackernews">0</span> <i class="icon icon-hackernews notranslate" aria-hidden="true"></i> </a> </nav> </header> <article class="main" itemprop="articleBody"><div > <figure class='badge'><a href='http://manifests.jcabi.com'><img src='http://img.jcabi.com/logo-square.svg' style='width:64px;max-width:100%;' alt='badge'/></a></figure><p>Every Java package (JAR, WAR, EAR, etc.) has a <a href="http://docs.oracle.com/javase/tutorial/deployment/jar/manifestindex.html"><code>MANIFEST.MF</code></a> file in the <code>META-INF</code> directory. The file contains a list of attributes, which describe this particular package. For example:</p><figure class="highlight"><pre><code class="language-text" data-lang="text"><span></span>Manifest-Version: 1.0
Created-By: 1.7.0_06 (Oracle Corporation)
Main-Class: MyPackage.MyClass</code></pre></figure><p>When your application has multiple JAR dependencies, you have multiple <code>MANIFEST.MF</code> files in your class path. All of them have the same location: <code>META-INF/MANIFEST.MF</code>. Very often it is necessary to go through all of them in runtime and find the attribute by its name.</p><p><a href="http://manifests.jcabi.com">jcabi-manifests</a> makes it possible with a one-liner:</p><figure class="highlight"><pre><code class="language-java" data-lang="java"><span></span><span class="kn">import</span> <span class="nn">com.jcabi.manifests.Manifests</span><span class="o">;</span>
<span class="n">String</span> <span class="n">created</span> <span class="o">=</span> <span class="n">Manifests</span><span class="o">.</span><span class="na">read</span><span class="o">(</span><span class="s">&quot;Created-By&quot;</span><span class="o">);</span></code></pre></figure><p>Let&#39;s see why you would want to read attributes from manifest files, and how it works on a low level.</p><h2 id="package-versioning">Package Versioning</h2><p>When you package a library or even a web application, it is a good practice to add an attribute to its <code>MANIFEST.MF</code> with the package version name and build number. In Maven, <a href="http://maven.apache.org/plugins/maven-jar-plugin/"><code>maven-jar-plugin</code></a> can help you (almost the same configuration for <a href="http://maven.apache.org/plugins/maven-war-plugin/"><code>maven-war-plugin</code></a>):</p><figure class="highlight"><pre><code class="language-xml" data-lang="xml"><span></span><span class="nt">&lt;plugin&gt;</span>
  <span class="nt">&lt;artifactId&gt;</span>maven-jar-plugin<span class="nt">&lt;/artifactId&gt;</span>
  <span class="nt">&lt;configuration&gt;</span>
    <span class="nt">&lt;archive&gt;</span>
      <span class="nt">&lt;manifestEntries&gt;</span>
        <span class="nt">&lt;Foo-Version&gt;</span>${project.version}<span class="nt">&lt;/Foo-Version&gt;</span>
        <span class="nt">&lt;Foo-Hash&gt;</span>${buildNumber}<span class="nt">&lt;/Foo-Hash&gt;</span>
      <span class="nt">&lt;/manifestEntries&gt;</span>
    <span class="nt">&lt;/archive&gt;</span>
  <span class="nt">&lt;/configuration&gt;</span>
<span class="nt">&lt;/plugin&gt;</span></code></pre></figure><p><code>buildnumber-maven-plugin</code> will help you to get <code>${buildNumber}</code> from Git, SVN or Mercurial:</p><figure class="highlight"><pre><code class="language-xml" data-lang="xml"><span></span><span class="nt">&lt;plugin&gt;</span>
  <span class="nt">&lt;groupId&gt;</span>org.codehaus.mojo<span class="nt">&lt;/groupId&gt;</span>
  <span class="nt">&lt;artifactId&gt;</span>buildnumber-maven-plugin<span class="nt">&lt;/artifactId&gt;</span>
  <span class="nt">&lt;executions&gt;</span>
    <span class="nt">&lt;execution&gt;</span>
      <span class="nt">&lt;goals&gt;</span>
        <span class="nt">&lt;goal&gt;</span>create<span class="nt">&lt;/goal&gt;</span>
      <span class="nt">&lt;/goals&gt;</span>
    <span class="nt">&lt;/execution&gt;</span>
  <span class="nt">&lt;/executions&gt;</span>
<span class="nt">&lt;/plugin&gt;</span></code></pre></figure><p>After all these manipulations, <code>MANIFEST.MF</code>, in your JAR will contain these two extra lines (on top of all others added there by Maven by default):</p><figure class="highlight"><pre><code class="language-text" data-lang="text"><span></span>Foo-Version: 1.0-SNAPSHOT
Foo-Hash: 7ef4ac3</code></pre></figure><p>In runtime, you can show these values to the user to help him understand which version of the product he is working with at any given moment.</p><p>Look at <a href="http://www.stateful.co">stateful.co</a>, for example. At the bottom of its front page, you see the version number and Git hash. They are retrieved from <code>MANIFEST.MF</code> of the deployed WAR package, on every page click.</p><h2 id="credentials">Credentials</h2><p>Although this may be considered as a bad practice (see <a href="http://amzn.to/2bQVmlb">Continuous Delivery: Reliable Software Releases through Build, Test, and Deployment Automation</a> by Jez Humble and David Farley), sometimes it is convenient to package production credentials right into the JAR/WAR archive during the <a href="/2014/10/08/continuous-integration-is-dead.html">continuous integration</a>/delivery cycle.</p><p>For example, you can encode your PostgreSQL connection details right into <code>MANIFEST.MF</code>:</p><figure class="highlight"><pre><code class="language-xml" data-lang="xml"><span></span><span class="nt">&lt;plugin&gt;</span>
  <span class="nt">&lt;artifactId&gt;</span>maven-war-plugin<span class="nt">&lt;/artifactId&gt;</span>
  <span class="nt">&lt;configuration&gt;</span>
    <span class="nt">&lt;archive&gt;</span>
      <span class="nt">&lt;manifestEntries&gt;</span>
        <span class="nt">&lt;Pgsql&gt;</span>jdbc:postgresql://${pg.host}:${pg.port}/${pg.db}<span class="nt">&lt;/Pgsql&gt;</span>
      <span class="nt">&lt;/manifestEntries&gt;</span>
    <span class="nt">&lt;/archive&gt;</span>
  <span class="nt">&lt;/configuration&gt;</span>
<span class="nt">&lt;/plugin&gt;</span></code></pre></figure><p>Afterwards, you can retrieve them in runtime using <a href="http://manifests.jcabi.com"><code>jcabi-manifests</code></a>:</p><figure class="highlight"><pre><code class="language-java" data-lang="java"><span></span><span class="n">String</span> <span class="n">url</span> <span class="o">=</span> <span class="n">Manifests</span><span class="o">.</span><span class="na">read</span><span class="o">(</span><span class="s">&quot;Pgsql&quot;</span><span class="o">);</span></code></pre></figure><p>If you know of any other useful purposes for <code>MANIFEST.MF</code>, let me know :)</p></div></article></div><div class="wrapper"> <related-posts /></div><div class="disqus" role="complementary"><p class="disqus_hint"> Please, use <a href="https://help.disqus.com/commenting/what-html-tags-are-allowed-within-comments">syntax highlighting</a> in your comments, to make them more readable.</p><div id="disqus_thread" class="disqus-thread"> <a>&nbsp;</a></div><script> var disqus_config = function () { this.page.url = document.location.href.split('?')[0].split('#')[0].replace('https://', 'http://'); this.page.identifier = this.page.url; }; (function() { var d = document, s = d.createElement('script'); s.src = '//yegor256.disqus.com/embed.js'; s.setAttribute('data-timestamp', +new Date()); (d.head || d.body).appendChild(s); })(); </script> <noscript><div><p class="red"> JavaScript is disabled in your browser, that's why you can't see comments under this post.</p></div></noscript></div><div class="wrapper"> <footer class="footer"><p> &copy; <span itemscope="" itemprop="copyrightHolder" itemtype="http://schema.org/Person"> <span itemprop="name">Yegor Bugayenko</span> </span> 2014&ndash;<span itemprop="copyrightYear">2018</span></p></footer></div></section><div class="wrapper unprintable" style="text-align:center;margin-top:2em;"> <a href="http://www.sixnines.io/h/3ba1652f"> <img src="//www.sixnines.io/b/3ba1652f?style=flat" alt="sixnines availability badge"/> </a></div><script src="//code.jquery.com/jquery-1.9.0.min.js"></script> <script src="/js/all.js?4e047f6f42b"></script> <script>var disqus_shortname = 'yegor256';</script> <script id="dsq-count-scr" src="//yegor256.disqus.com/count.js" async="async"></script> <script> (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){ (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o), m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m) })(window,document,'script','//www.google-analytics.com/analytics.js','ga'); ga('create', 'UA-1963507-32', 'auto'); ga('send', 'pageview'); </script> <script> Cd=document;Cr="&"+Math.random();Cp="&s=1"; Cd.cookie="b=b";if(Cd.cookie)Cp+="&c=1"; Cp+="&t="+(new Date()).getTimezoneOffset(); if(self!=top)Cp+="&f=1"; </script> <script> if(navigator.javaEnabled())Cp+="&j=1"; </script> <script> if(typeof(screen)!='undefined')Cp+="&w="+screen.width+"&h="+ screen.height+"&d="+(screen.colorDepth?screen.colorDepth:screen.pixelDepth); </script> <script> Cd.write("<img src='//c.hit.ua/hit?i=95870&g=0&x=2"+Cp+Cr+ "&r="+escape(Cd.referrer)+"&u="+escape(window.location.href)+ "' border='0' wi"+"dth='1' he"+"ight='1'/>"); </script> <script type="application/ld+json"> { "@context": "http://schema.org", "@type": "Person", "name": "Yegor Bugayenko", "url": "http://www.yegor256.com", "sameAs": [ "https://www.facebook.com/yegor256", "https://instagram.com/yegor256", "https://www.linkedin.com/in/yegor256", "https://twitter.com/yegor256", "https://github.com/yegor256", "https://www.pinterest.com/yegor256/" ] } </script> </body> </html> <!DOCTYPE html> <html xmlns="http://www.w3.org/1999/xhtml" lang="en-US" xml:lang="en-US" itemscope="" itemtype="http://schema.org/WebSite"> <head> <meta charset="utf-8"/> <meta name="description" content="SASS, as a CSS programming language, can be used effectively in a Java web application. Read how below. " /> <meta name="keywords" content="sass java, sass java tomcat, sass java web app, sass maven, sass maven java, scss in java webapp, scss java web app tomcat" /> <meta name="viewport" content="width=device-width,minimum-scale=1,initial-scale=1"/> <meta name="google-site-verification" content="JEj_gQr2CPe2QKGw8XdMz0R7VboQIUbX3FlM-lwTq-8" /> <meta name="author" content="Yegor Bugayenko"> <meta name="article:published_time" content="2014-06-26 00:00:00 +0000"> <meta name="og:site_name" content="Yegor Bugayenko"/> <meta name="og:type" content="article" /> <meta name="og:locale" content="en_US" /> <meta name="twitter:account_id" content="4503599630178231" /> <meta name="twitter:creator" content="@yegor256"/> <meta name="twitter:site" content="@yegor256"/> <meta name="twitter:title" property="og:title" content="SASS in Java Webapp"/> <meta name="twitter:description" property="og:description" content="SASS, as a CSS programming language, can be used effectively in a Java web application. Read how below. "/> <meta name="twitter:url" property="og:url" content="https://www.yegor256.com/2014/06/26/sass-in-java-webapp.html"/> <meta name="telegram:channel" content="AAAAAEJFMRzsRTRxM3ec6A"/> <link rel="search" type="application/opensearchdescription+xml" href="/opensearch.xml" title="yegor256" /> <link rel="shortcut icon" href="/favicon.ico?4e047f6f42b"/> <link rel="apple-touch-icon" href="/favicon.ico?4e047f6f42b"/> <link rel="alternate" type="application/rss+xml" title="RSS for yegor256.com" href="https://www.yegor256.com/rss.xml"/> <link rel="stylesheet" href="/css/layout.css?4e047f6f42b"/> <link rel="stylesheet" href="/css/icons.css?4e047f6f42b"/> <link rel="canonical" href="https://www.yegor256.com/2014/06/26/sass-in-java-webapp.html" /> <link rel="amphtml" href="https://www.yegor256.com/2014/06/26/sass-in-java-webapp.amp.html" /> <title>SASS in Java Webapp </title> </head> <body><div class="wrapper"> <aside class="header-toggle unprintable" id="header-toggle" title="Show the menu" onclick="$('#header').show();$('#header-toggle').hide();">&#9776;</aside> <header class="header" id="header"><div class="face"> <a href="/about-me.html#form" class="sub" title="Click to subscribe to my monthly newsletter"><span>Subscribe</span></a> <a href="/about-me.html" style="position:relative;"> <img src="/images/face-256x256.jpg" class="photo" alt="Yegor Bugayenko"/> </a></div><nav><ul class="menu social notranslate"> <li><a href="https://twitter.com/intent/follow?screen_name=yegor256" rel="nofollow" title="Follow me on Twitter"><i class="icon icon-twitter notranslate" aria-hidden="true"></i></a></li> <li><a href="/rss.xml" rel="nofollow" title="Subscribe to my RSS feed"><i class="icon icon-rss notranslate" aria-hidden="true"></i></a></li> <li><a itemprop="sameAs" href="https://github.com/yegor256" rel="nofollow" title="My GitHub profile"><i class="icon icon-github notranslate" aria-hidden="true"></i></a></li> <li><a itemprop="sameAs" href="http://stackoverflow.com/users/187141/yegor256" rel="nofollow" title="My StackOverflow profile"><i class="icon icon-stackoverflow notranslate" aria-hidden="true"></i></a></li> <li><a itemprop="sameAs" href="https://www.facebook.com/yegor256" rel="nofollow" title="Follow me on Facebook"><i class="icon icon-facebook notranslate" aria-hidden="true"></i></a></li> <li><a itemprop="sameAs" href="https://instagram.com/yegor256" rel="nofollow" title="Follow me on Instagram"><i class="icon icon-instagram notranslate" aria-hidden="true"></i></a></li> <li><a itemprop="sameAs" href="https://www.linkedin.com/in/yegor256" rel="nofollow" title="My LinkedIn profile"><i class="icon icon-linkedin notranslate" aria-hidden="true"></i></a></li> <li><a itemprop="sameAs" href="https://www.youtube.com/c/yegor256?sub_confirmation=1" rel="nofollow" title="My Youtube video channel"><i class="icon icon-youtube notranslate" aria-hidden="true"></i></a></li> <li><a itemprop="sameAs" href="https://www.pinterest.com/yegor256/" rel="nofollow" title="My Pinterest boards"><i class="icon icon-pinterest notranslate" aria-hidden="true"></i></a></li> <li><a itemprop="sameAs" href="https://angel.co/yegor256" rel="nofollow" title="My AngelList profile"><i class="icon icon-angellist notranslate" aria-hidden="true"></i></a></li> <li><a href="https://soundcloud.com/yegor256" rel="nofollow" title="My podcast"><i class="icon icon-podcast notranslate" aria-hidden="true"></i></a></li> <li><a href="https://itunes.apple.com/us/podcast/yegor256-podcast/id1150826721" rel="nofollow" title="My iTunes podcast"><i class="icon icon-itunes notranslate" aria-hidden="true"></i></a></li> <li><a href="https://t.me/joinchat/AAAAAEJFMRzsRTRxM3ec6A" rel="nofollow" title="My Telegram public channel"><i class="icon icon-telegram notranslate" aria-hidden="true"></i></a></li> <li><a href="mailto:blog@yegor256.com" rel="nofollow" title="Email me any time"><i class="icon icon-mail notranslate" aria-hidden="true"></i></a></li></ul><ul class="menu"> <li><a href="/" title="Home page">Home</a></li> <li ><a href="/best.html" title="Best articles to read">12&#160;Best</a></li> <li ><a href="/contents.html" title="The contents of the entire blog">All&#160;288</a></li> <li ><a href="/webinars.html" title="My webinars">Webinars</a></li> <li ><a href="/talks.html" title="Future and past conference talks">Talks</a></li> <li ><a href="/books.html" title="The books I wrote">Books</a></li> <li ><a href="/papers.html" title="My academic papers and patents">Papers</a></li> <li ><a href="/pets.html" title="My loved pet projects">Pets</a></li> <li ><a href="/award.html" title="Software quality award">Award</a></li> <li ><a href="/testimonials.html" title="What some people say about me">Testimonials</a></li> <li ><a href="/shift-m.html" title="Audio podcast about project management">Shift-M</a></li> <li ><a href="/paintings.html" title="My paintings for sale">Paintings</a></li> <li><a href="http://ru.yegor256.com/" title="Немного на русском языке">По-русски</a></li></ul></nav><div class="search"> <form method="get" action="https://www.google.com/search" itemprop="potentialAction" itemscope="" itemtype="http://schema.org/SearchAction"> <meta itemprop="target" content="https://www.google.com/search?q={q}"/> <input name="sitesearch" value="yegor256.com" type="hidden"/> <input itemprop="query-input" type="text" id="search-query" class="field field-text" required="required" onfocus="$('.google').css('visibility', 'visible');" name="q" placeholder="Search..." autocomplete="off"/> <input type="image" src="/images/google-search-icon.svg" class="google" title="Search via Google" alt="Search via Google"/> </form></div><div class="hot"><ul> <li> <a href="/code-ahead.html">Code Ahead</a> was published on Amazon just a few days ago! It is my new book, a novel about programmers. It explains in details the majority of ideas that stand behind <a href="https://www.zerocracy.com">Zerocracy</a> and <a href="https://www.xdsd.org">XDSD</a>. </li> <li> At <a href="/webinars.html">Webinar #37</a> we will discuss naming problem in OOP, for objects, methods and attributes; join us on <b>September 12</b>, at 11am PST. </li></ul></div></header></div><section itemscope="" itemtype="http://schema.org/BlogPosting"><div class="wrapper"> <header><p class="printable"> <img src="https://api.qrserver.com/v1/create-qr-code/?data=https://www.yegor256.com/2014/06/26/sass-in-java-webapp.html&amp;format=svg" style="width:125px;height:125px;" alt="QR code"/></p><p class="printable"> <code itemprop="url">https://www.yegor256.com/2014/06/26/sass-in-java-webapp.html</code></p><h1 itemprop="name headline mainEntityOfPage">SASS in Java Webapp</h1><ul class="subline"> <li> <time itemprop="datePublished" datetime="2014-06-26T00:00:00+00:00"> 26 June 2014 </time> </li> <li class="printable" itemscope="" itemprop="author" itemtype="http://schema.org/Person"> <span itemprop="name">Yegor Bugayenko</span> </li> <li class="unprintable"> <i class="icon icon-comments"></i> <a href="http://www.yegor256.com/2014/06/26/sass-in-java-webapp.html#disqus_thread" itemprop="discussionUrl">comments</a> </li></ul><p>The SASS compiler will compile <code>.scss</code> files from <code>src/main/scss</code> and place <code>.css</code> files into <code>target/css</code>.</p><p>Then, I configure the <a href="https://github.com/samaxes/minify-maven-plugin">minify-maven-plugin</a> to compress/minify the style sheets produced by the SASS compiler:</p><figure class="highlight"><pre><code class="language-xml" data-lang="xml"><span></span><span class="nt">&lt;plugin&gt;</span>
  <span class="nt">&lt;groupId&gt;</span>com.samaxes.maven<span class="nt">&lt;/groupId&gt;</span>
  <span class="nt">&lt;artifactId&gt;</span>minify-maven-plugin<span class="nt">&lt;/artifactId&gt;</span>
  <span class="nt">&lt;configuration&gt;</span>
    <span class="nt">&lt;charset&gt;</span>UTF-8<span class="nt">&lt;/charset&gt;</span>
    <span class="nt">&lt;nosuffix&gt;</span>true<span class="nt">&lt;/nosuffix&gt;</span>
    <span class="nt">&lt;webappTargetDir&gt;</span>${project.build.directory}/css-min<span class="nt">&lt;/webappTargetDir&gt;</span>
  <span class="nt">&lt;/configuration&gt;</span>
  <span class="nt">&lt;executions&gt;</span>
    <span class="nt">&lt;execution&gt;</span>
      <span class="nt">&lt;id&gt;</span>minify-css<span class="nt">&lt;/id&gt;</span>
      <span class="nt">&lt;goals&gt;</span>
        <span class="nt">&lt;goal&gt;</span>minify<span class="nt">&lt;/goal&gt;</span>
      <span class="nt">&lt;/goals&gt;</span>
      <span class="nt">&lt;configuration&gt;</span>
        <span class="nt">&lt;webappSourceDir&gt;</span>${project.build.directory}<span class="nt">&lt;/webappSourceDir&gt;</span>
        <span class="nt">&lt;cssSourceDir&gt;</span>css<span class="nt">&lt;/cssSourceDir&gt;</span>
        <span class="nt">&lt;cssSourceIncludes&gt;</span>
          <span class="nt">&lt;include&gt;</span>*.css<span class="nt">&lt;/include&gt;</span>
        <span class="nt">&lt;/cssSourceIncludes&gt;</span>
        <span class="nt">&lt;skipMerge&gt;</span>true<span class="nt">&lt;/skipMerge&gt;</span>
      <span class="nt">&lt;/configuration&gt;</span>
    <span class="nt">&lt;/execution&gt;</span>
  <span class="nt">&lt;/executions&gt;</span>
<span class="nt">&lt;/plugin&gt;</span></code></pre></figure><p>Minified <code>.css</code> files will be placed into <code>target/css-min</code>.</p><p>The final step is to configure the <a href="http://maven.apache.org/plugins/maven-war-plugin/">maven-war-plugin</a> to pick up <code>.css</code> files and package them into the final WAR archive:</p><figure class="highlight"><pre><code class="language-xml" data-lang="xml"><span></span><span class="nt">&lt;plugin&gt;</span>
  <span class="nt">&lt;artifactId&gt;</span>maven-war-plugin<span class="nt">&lt;/artifactId&gt;</span>
  <span class="nt">&lt;configuration&gt;</span>
    [..other configuration options..]
    <span class="nt">&lt;webResources</span> <span class="na">combine.children=</span><span class="s">&quot;append&quot;</span><span class="nt">&gt;</span>
      <span class="nt">&lt;resource&gt;</span>
        <span class="nt">&lt;directory&gt;</span>${project.build.directory}/css-min<span class="nt">&lt;/directory&gt;</span>
      <span class="nt">&lt;/resource&gt;</span>
    <span class="nt">&lt;/webResources&gt;</span>
  <span class="nt">&lt;/configuration&gt;</span>
<span class="nt">&lt;/plugin&gt;</span></code></pre></figure><p>That&#39;s it.</p></p>--> <nav class="buttons notranslate desktop-only"> <a href="http://www.facebook.com/sharer/sharer.php?u=https://www.yegor256.com/2014/06/26/sass-in-java-webapp.html" title="Share on Facebook" class="button" rel="nofollow"> <span class="count count-facebook">0</span> <i class="icon icon-facebook notranslate" aria-hidden="true"></i> </a> <a href="https://twitter.com/share?url=https://www.yegor256.com/2014/06/26/sass-in-java-webapp.html&amp;text=SASS+in+Java+Webapp" title="Share on Twitter" class="button" rel="nofollow"> <span class="count count-twitter">0</span> <i class="icon icon-twitter notranslate" aria-hidden="true"></i> </a> <a href="https://plus.google.com/share?url=https://www.yegor256.com/2014/06/26/sass-in-java-webapp.html" title="Share on Google+" class="button" rel="nofollow"> <span class="count count-googleplus">0</span> <i class="icon icon-googleplus notranslate" aria-hidden="true"></i> </a> <a href="https://www.linkedin.com/cws/share?url=https://www.yegor256.com/2014/06/26/sass-in-java-webapp.html" title="Share on LinkedIn" class="button" rel="nofollow"> <span class="count count-linkedin">0</span> <i class="icon icon-linkedin notranslate" aria-hidden="true"></i> </a> <a href="http://reddit.com/submit?url=https://www.yegor256.com/2014/06/26/sass-in-java-webapp.html%3F2014-25&amp;title=SASS+in+Java+Webapp" title="Share on Reddit" class="button" rel="nofollow"> <span class="count count-reddit">0</span> <i class="icon icon-reddit notranslate" aria-hidden="true"></i> </a> <a href="http://news.ycombinator.com/submitlink?u=https://www.yegor256.com/2014/06/26/sass-in-java-webapp.html%3F2014-25&amp;t=SASS+in+Java+Webapp" title="Share on Hacker News" class="button" rel="nofollow"> <span class="count count-hackernews">0</span> <i class="icon icon-hackernews notranslate" aria-hidden="true"></i> </a> </nav> </header> <article class="main" itemprop="articleBody"><div ><p><a href="http://sass-lang.com/">SASS</a> is a powerful and very popular language for writing <a href="http://www.w3.org/Style/CSS/Overview.en.html">CSS</a> style sheets. This is how I&#39;m using SASS in my Maven projects.</p><p>First, I change the extensions of <code>.css</code> files to <code>.scss</code> and move them from <code>src/main/webapp/css</code> to <code>src/main/scss</code>.</p><p>Then, I configure the <a href="https://github.com/Jasig/sass-maven-plugin">sass-maven-plugin</a> (get its latest versions in <a href="http://search.maven.org/">Maven Central</a>):</p><figure class="highlight"><pre><code class="language-xml" data-lang="xml"><span></span><span class="nt">&lt;plugin&gt;</span>
  <span class="nt">&lt;groupId&gt;</span>nl.geodienstencentrum.maven<span class="nt">&lt;/groupId&gt;</span>
  <span class="nt">&lt;artifactId&gt;</span>sass-maven-plugin<span class="nt">&lt;/artifactId&gt;</span>
  <span class="nt">&lt;executions&gt;</span>
    <span class="nt">&lt;execution&gt;</span>
      <span class="nt">&lt;id&gt;</span>generate-css<span class="nt">&lt;/id&gt;</span>
      <span class="nt">&lt;phase&gt;</span>generate-resources<span class="nt">&lt;/phase&gt;</span>
      <span class="nt">&lt;goals&gt;</span>
        <span class="nt">&lt;goal&gt;</span>update-stylesheets<span class="nt">&lt;/goal&gt;</span>
      <span class="nt">&lt;/goals&gt;</span>
      <span class="nt">&lt;configuration&gt;</span>
        <span class="nt">&lt;sassSourceDirectory&gt;</span>${basedir}/src/main/scss<span class="nt">&lt;/sassSourceDirectory&gt;</span>
        <span class="nt">&lt;destination&gt;</span>${project.build.directory}/css<span class="nt">&lt;/destination&gt;</span>
      <span class="nt">&lt;/configuration&gt;</span>
    <span class="nt">&lt;/execution&gt;</span>
  <span class="nt">&lt;/executions&gt;</span>
<span class="nt">&lt;/plugin&gt;</span></code></pre></figure><p>The SASS compiler will compile <code>.scss</code> files from <code>src/main/scss</code> and place <code>.css</code> files into <code>target/css</code>.</p><p>Then, I configure the <a href="https://github.com/samaxes/minify-maven-plugin">minify-maven-plugin</a> to compress/minify the style sheets produced by the SASS compiler:</p><figure class="highlight"><pre><code class="language-xml" data-lang="xml"><span></span><span class="nt">&lt;plugin&gt;</span>
  <span class="nt">&lt;groupId&gt;</span>com.samaxes.maven<span class="nt">&lt;/groupId&gt;</span>
  <span class="nt">&lt;artifactId&gt;</span>minify-maven-plugin<span class="nt">&lt;/artifactId&gt;</span>
  <span class="nt">&lt;configuration&gt;</span>
    <span class="nt">&lt;charset&gt;</span>UTF-8<span class="nt">&lt;/charset&gt;</span>
    <span class="nt">&lt;nosuffix&gt;</span>true<span class="nt">&lt;/nosuffix&gt;</span>
    <span class="nt">&lt;webappTargetDir&gt;</span>${project.build.directory}/css-min<span class="nt">&lt;/webappTargetDir&gt;</span>
  <span class="nt">&lt;/configuration&gt;</span>
  <span class="nt">&lt;executions&gt;</span>
    <span class="nt">&lt;execution&gt;</span>
      <span class="nt">&lt;id&gt;</span>minify-css<span class="nt">&lt;/id&gt;</span>
      <span class="nt">&lt;goals&gt;</span>
        <span class="nt">&lt;goal&gt;</span>minify<span class="nt">&lt;/goal&gt;</span>
      <span class="nt">&lt;/goals&gt;</span>
      <span class="nt">&lt;configuration&gt;</span>
        <span class="nt">&lt;webappSourceDir&gt;</span>${project.build.directory}<span class="nt">&lt;/webappSourceDir&gt;</span>
        <span class="nt">&lt;cssSourceDir&gt;</span>css<span class="nt">&lt;/cssSourceDir&gt;</span>
        <span class="nt">&lt;cssSourceIncludes&gt;</span>
          <span class="nt">&lt;include&gt;</span>*.css<span class="nt">&lt;/include&gt;</span>
        <span class="nt">&lt;/cssSourceIncludes&gt;</span>
        <span class="nt">&lt;skipMerge&gt;</span>true<span class="nt">&lt;/skipMerge&gt;</span>
      <span class="nt">&lt;/configuration&gt;</span>
    <span class="nt">&lt;/execution&gt;</span>
  <span class="nt">&lt;/executions&gt;</span>
<span class="nt">&lt;/plugin&gt;</span></code></pre></figure><p>Minified <code>.css</code> files will be placed into <code>target/css-min</code>.</p><p>The final step is to configure the <a href="http://maven.apache.org/plugins/maven-war-plugin/">maven-war-plugin</a> to pick up <code>.css</code> files and package them into the final WAR archive:</p><figure class="highlight"><pre><code class="language-xml" data-lang="xml"><span></span><span class="nt">&lt;plugin&gt;</span>
  <span class="nt">&lt;artifactId&gt;</span>maven-war-plugin<span class="nt">&lt;/artifactId&gt;</span>
  <span class="nt">&lt;configuration&gt;</span>
    [..other configuration options..]
    <span class="nt">&lt;webResources</span> <span class="na">combine.children=</span><span class="s">&quot;append&quot;</span><span class="nt">&gt;</span>
      <span class="nt">&lt;resource&gt;</span>
        <span class="nt">&lt;directory&gt;</span>${project.build.directory}/css-min<span class="nt">&lt;/directory&gt;</span>
      <span class="nt">&lt;/resource&gt;</span>
    <span class="nt">&lt;/webResources&gt;</span>
  <span class="nt">&lt;/configuration&gt;</span>
<span class="nt">&lt;/plugin&gt;</span></code></pre></figure><p>That&#39;s it.</p></div></article></div><div class="wrapper"> <related-posts /></div><div class="disqus" role="complementary"><p class="disqus_hint"> Please, use <a href="https://help.disqus.com/commenting/what-html-tags-are-allowed-within-comments">syntax highlighting</a> in your comments, to make them more readable.</p><div id="disqus_thread" class="disqus-thread"> <a>&nbsp;</a></div><script> var disqus_config = function () { this.page.url = document.location.href.split('?')[0].split('#')[0].replace('https://', 'http://'); this.page.identifier = this.page.url; }; (function() { var d = document, s = d.createElement('script'); s.src = '//yegor256.disqus.com/embed.js'; s.setAttribute('data-timestamp', +new Date()); (d.head || d.body).appendChild(s); })(); </script> <noscript><div><p class="red"> JavaScript is disabled in your browser, that's why you can't see comments under this post.</p></div></noscript></div><div class="wrapper"> <footer class="footer"><p> &copy; <span itemscope="" itemprop="copyrightHolder" itemtype="http://schema.org/Person"> <span itemprop="name">Yegor Bugayenko</span> </span> 2014&ndash;<span itemprop="copyrightYear">2018</span></p></footer></div></section><div class="wrapper unprintable" style="text-align:center;margin-top:2em;"> <a href="http://www.sixnines.io/h/3ba1652f"> <img src="//www.sixnines.io/b/3ba1652f?style=flat" alt="sixnines availability badge"/> </a></div><script src="//code.jquery.com/jquery-1.9.0.min.js"></script> <script src="/js/all.js?4e047f6f42b"></script> <script>var disqus_shortname = 'yegor256';</script> <script id="dsq-count-scr" src="//yegor256.disqus.com/count.js" async="async"></script> <script> (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){ (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o), m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m) })(window,document,'script','//www.google-analytics.com/analytics.js','ga'); ga('create', 'UA-1963507-32', 'auto'); ga('send', 'pageview'); </script> <script> Cd=document;Cr="&"+Math.random();Cp="&s=1"; Cd.cookie="b=b";if(Cd.cookie)Cp+="&c=1"; Cp+="&t="+(new Date()).getTimezoneOffset(); if(self!=top)Cp+="&f=1"; </script> <script> if(navigator.javaEnabled())Cp+="&j=1"; </script> <script> if(typeof(screen)!='undefined')Cp+="&w="+screen.width+"&h="+ screen.height+"&d="+(screen.colorDepth?screen.colorDepth:screen.pixelDepth); </script> <script> Cd.write("<img src='//c.hit.ua/hit?i=95870&g=0&x=2"+Cp+Cr+ "&r="+escape(Cd.referrer)+"&u="+escape(window.location.href)+ "' border='0' wi"+"dth='1' he"+"ight='1'/>"); </script> <script type="application/ld+json"> { "@context": "http://schema.org", "@type": "Person", "name": "Yegor Bugayenko", "url": "http://www.yegor256.com", "sameAs": [ "https://www.facebook.com/yegor256", "https://instagram.com/yegor256", "https://www.linkedin.com/in/yegor256", "https://twitter.com/yegor256", "https://github.com/yegor256", "https://www.pinterest.com/yegor256/" ] } </script> </body> </html> <!DOCTYPE html> <html xmlns="http://www.w3.org/1999/xhtml" lang="en-US" xml:lang="en-US" itemscope="" itemtype="http://schema.org/WebSite"> <head> <meta charset="utf-8"/> <meta name="description" content="XML+XSLT is a useful combination for web interfaces and RESTful API-s at the same time. This article explains how it works and argues in favor of its use. " /> <meta name="keywords" content="java web framework, rexsl framework, web framework, xml xsl html web, xml xsl web page, xml xslt java web framework, xml xslt web framework, xslt java web framework" /> <meta name="viewport" content="width=device-width,minimum-scale=1,initial-scale=1"/> <meta name="google-site-verification" content="JEj_gQr2CPe2QKGw8XdMz0R7VboQIUbX3FlM-lwTq-8" /> <meta name="author" content="Yegor Bugayenko"> <meta name="article:published_time" content="2014-06-25 00:00:00 +0000"> <meta name="og:site_name" content="Yegor Bugayenko"/> <meta name="og:type" content="article" /> <meta name="og:locale" content="en_US" /> <meta name="twitter:account_id" content="4503599630178231" /> <meta name="twitter:creator" content="@yegor256"/> <meta name="twitter:site" content="@yegor256"/> <meta name="twitter:title" property="og:title" content="XML+XSLT in a Browser"/> <meta name="twitter:description" property="og:description" content="XML+XSLT is a useful combination for web interfaces and RESTful API-s at the same time. This article explains how it works and argues in favor of its use. "/> <meta name="twitter:url" property="og:url" content="https://www.yegor256.com/2014/06/25/xml-and-xslt-in-browser.html"/> <meta name="telegram:channel" content="AAAAAEJFMRzsRTRxM3ec6A"/> <link rel="search" type="application/opensearchdescription+xml" href="/opensearch.xml" title="yegor256" /> <link rel="shortcut icon" href="/favicon.ico?4e047f6f42b"/> <link rel="apple-touch-icon" href="/favicon.ico?4e047f6f42b"/> <link rel="alternate" type="application/rss+xml" title="RSS for yegor256.com" href="https://www.yegor256.com/rss.xml"/> <link rel="stylesheet" href="/css/layout.css?4e047f6f42b"/> <link rel="stylesheet" href="/css/icons.css?4e047f6f42b"/> <link rel="canonical" href="https://www.yegor256.com/2014/06/25/xml-and-xslt-in-browser.html" /> <link rel="amphtml" href="https://www.yegor256.com/2014/06/25/xml-and-xslt-in-browser.amp.html" /> <title>XML+XSLT in a Browser </title> </head> <body><div class="wrapper"> <aside class="header-toggle unprintable" id="header-toggle" title="Show the menu" onclick="$('#header').show();$('#header-toggle').hide();">&#9776;</aside> <header class="header" id="header"><div class="face"> <a href="/about-me.html#form" class="sub" title="Click to subscribe to my monthly newsletter"><span>Subscribe</span></a> <a href="/about-me.html" style="position:relative;"> <img src="/images/face-256x256.jpg" class="photo" alt="Yegor Bugayenko"/> </a></div><nav><ul class="menu social notranslate"> <li><a href="https://twitter.com/intent/follow?screen_name=yegor256" rel="nofollow" title="Follow me on Twitter"><i class="icon icon-twitter notranslate" aria-hidden="true"></i></a></li> <li><a href="/rss.xml" rel="nofollow" title="Subscribe to my RSS feed"><i class="icon icon-rss notranslate" aria-hidden="true"></i></a></li> <li><a itemprop="sameAs" href="https://github.com/yegor256" rel="nofollow" title="My GitHub profile"><i class="icon icon-github notranslate" aria-hidden="true"></i></a></li> <li><a itemprop="sameAs" href="http://stackoverflow.com/users/187141/yegor256" rel="nofollow" title="My StackOverflow profile"><i class="icon icon-stackoverflow notranslate" aria-hidden="true"></i></a></li> <li><a itemprop="sameAs" href="https://www.facebook.com/yegor256" rel="nofollow" title="Follow me on Facebook"><i class="icon icon-facebook notranslate" aria-hidden="true"></i></a></li> <li><a itemprop="sameAs" href="https://instagram.com/yegor256" rel="nofollow" title="Follow me on Instagram"><i class="icon icon-instagram notranslate" aria-hidden="true"></i></a></li> <li><a itemprop="sameAs" href="https://www.linkedin.com/in/yegor256" rel="nofollow" title="My LinkedIn profile"><i class="icon icon-linkedin notranslate" aria-hidden="true"></i></a></li> <li><a itemprop="sameAs" href="https://www.youtube.com/c/yegor256?sub_confirmation=1" rel="nofollow" title="My Youtube video channel"><i class="icon icon-youtube notranslate" aria-hidden="true"></i></a></li> <li><a itemprop="sameAs" href="https://www.pinterest.com/yegor256/" rel="nofollow" title="My Pinterest boards"><i class="icon icon-pinterest notranslate" aria-hidden="true"></i></a></li> <li><a itemprop="sameAs" href="https://angel.co/yegor256" rel="nofollow" title="My AngelList profile"><i class="icon icon-angellist notranslate" aria-hidden="true"></i></a></li> <li><a href="https://soundcloud.com/yegor256" rel="nofollow" title="My podcast"><i class="icon icon-podcast notranslate" aria-hidden="true"></i></a></li> <li><a href="https://itunes.apple.com/us/podcast/yegor256-podcast/id1150826721" rel="nofollow" title="My iTunes podcast"><i class="icon icon-itunes notranslate" aria-hidden="true"></i></a></li> <li><a href="https://t.me/joinchat/AAAAAEJFMRzsRTRxM3ec6A" rel="nofollow" title="My Telegram public channel"><i class="icon icon-telegram notranslate" aria-hidden="true"></i></a></li> <li><a href="mailto:blog@yegor256.com" rel="nofollow" title="Email me any time"><i class="icon icon-mail notranslate" aria-hidden="true"></i></a></li></ul><ul class="menu"> <li><a href="/" title="Home page">Home</a></li> <li ><a href="/best.html" title="Best articles to read">12&#160;Best</a></li> <li ><a href="/contents.html" title="The contents of the entire blog">All&#160;288</a></li> <li ><a href="/webinars.html" title="My webinars">Webinars</a></li> <li ><a href="/talks.html" title="Future and past conference talks">Talks</a></li> <li ><a href="/books.html" title="The books I wrote">Books</a></li> <li ><a href="/papers.html" title="My academic papers and patents">Papers</a></li> <li ><a href="/pets.html" title="My loved pet projects">Pets</a></li> <li ><a href="/award.html" title="Software quality award">Award</a></li> <li ><a href="/testimonials.html" title="What some people say about me">Testimonials</a></li> <li ><a href="/shift-m.html" title="Audio podcast about project management">Shift-M</a></li> <li ><a href="/paintings.html" title="My paintings for sale">Paintings</a></li> <li><a href="http://ru.yegor256.com/" title="Немного на русском языке">По-русски</a></li></ul></nav><div class="search"> <form method="get" action="https://www.google.com/search" itemprop="potentialAction" itemscope="" itemtype="http://schema.org/SearchAction"> <meta itemprop="target" content="https://www.google.com/search?q={q}"/> <input name="sitesearch" value="yegor256.com" type="hidden"/> <input itemprop="query-input" type="text" id="search-query" class="field field-text" required="required" onfocus="$('.google').css('visibility', 'visible');" name="q" placeholder="Search..." autocomplete="off"/> <input type="image" src="/images/google-search-icon.svg" class="google" title="Search via Google" alt="Search via Google"/> </form></div><div class="hot"><ul> <li> <a href="/code-ahead.html">Code Ahead</a> was published on Amazon just a few days ago! It is my new book, a novel about programmers. It explains in details the majority of ideas that stand behind <a href="https://www.zerocracy.com">Zerocracy</a> and <a href="https://www.xdsd.org">XDSD</a>. </li> <li> At <a href="/webinars.html">Webinar #37</a> we will discuss naming problem in OOP, for objects, methods and attributes; join us on <b>September 12</b>, at 11am PST. </li></ul></div></header></div><section itemscope="" itemtype="http://schema.org/BlogPosting"><div class="wrapper"> <header><p class="printable"> <img src="https://api.qrserver.com/v1/create-qr-code/?data=https://www.yegor256.com/2014/06/25/xml-and-xslt-in-browser.html&amp;format=svg" style="width:125px;height:125px;" alt="QR code"/></p><p class="printable"> <code itemprop="url">https://www.yegor256.com/2014/06/25/xml-and-xslt-in-browser.html</code></p><h1 itemprop="name headline mainEntityOfPage">XML+XSLT in a Browser</h1><ul class="subline"> <li> <time itemprop="datePublished" datetime="2014-06-25T00:00:00+00:00"> 25 June 2014 </time> </li> <li class="printable" itemscope="" itemprop="author" itemtype="http://schema.org/Person"> <span itemprop="name">Yegor Bugayenko</span> </li> <li class="unprintable"> <i class="icon icon-comments"></i> <a href="http://www.yegor256.com/2014/06/25/xml-and-xslt-in-browser.html#disqus_thread" itemprop="discussionUrl">comments</a> </li></ul><h2 id="working-example">Working Example</h2><p>Let&#39;s review a simple Java web application that works this way. It is using <a href="http://www.takes.org">Takes Framework</a> that makes this mechanism possible. In the next post, I&#39;ll explain how ReXSL works. For now, though, let&#39;s focus on the idea of delivering bare data in XML and formatting it with an XSL stylesheet.</p><p>Open <a href="http://www.stateful.co">http://www.stateful.co</a>---it is a collection of stateful web primitives, explained in the <a href="/2014/05/18/cloud-autoincrement-counters.html">Atomic Counters at Stateful.co</a> article.</p><p>Open it in Chrome or Safari. When you do, you should see a normal web page with a logo, some text, some links, a footer, etc. Now check its sources (I assume you know how to do this).</p><p>This is approximately what you will see (I assume you understand XML, if not, start learning it immediately):</p><figure class="highlight"><pre><code class="language-xml" data-lang="xml"><span></span><span class="cp">&lt;?xml-stylesheet type=&#39;text/xsl&#39; href=&#39;/xsl/index.xsl&#39;?&gt;</span>
<span class="nt">&lt;page</span> <span class="na">date=</span><span class="s">&quot;2014-06-15T15:30:49.521Z&quot;</span> <span class="na">ip=</span><span class="s">&quot;10.168.29.135&quot;</span><span class="nt">&gt;</span>
  <span class="nt">&lt;menu&gt;</span>home<span class="nt">&lt;/menu&gt;</span>
  <span class="nt">&lt;documentation&gt;</span>.. some text here ..<span class="nt">&lt;/documentation&gt;</span>
  <span class="nt">&lt;version&gt;</span>
    <span class="nt">&lt;name&gt;</span>1.4<span class="nt">&lt;/name&gt;</span>
    <span class="nt">&lt;revision&gt;</span>5c7b5af<span class="nt">&lt;/revision&gt;</span>
    <span class="nt">&lt;date&gt;</span>2014-05-29 07:58<span class="nt">&lt;/date&gt;</span>
  <span class="nt">&lt;/version&gt;</span>
  <span class="nt">&lt;links&gt;</span>
    <span class="nt">&lt;link</span> <span class="na">href=</span><span class="s">&quot;...&quot;</span> <span class="na">rel=</span><span class="s">&quot;rexsl:google&quot;</span> <span class="na">type=</span><span class="s">&quot;text/xml&quot;</span><span class="nt">/&gt;</span>
    <span class="nt">&lt;link</span> <span class="na">href=</span><span class="s">&quot;...&quot;</span> <span class="na">rel=</span><span class="s">&quot;rexsl:github&quot;</span> <span class="na">type=</span><span class="s">&quot;text/xml&quot;</span><span class="nt">/&gt;</span>
    <span class="nt">&lt;link</span> <span class="na">href=</span><span class="s">&quot;...&quot;</span> <span class="na">rel=</span><span class="s">&quot;rexsl:facebook&quot;</span> <span class="na">type=</span><span class="s">&quot;text/xml&quot;</span><span class="nt">/&gt;</span>
  <span class="nt">&lt;/links&gt;</span>
  <span class="nt">&lt;millis&gt;</span>70<span class="nt">&lt;/millis&gt;</span>
<span class="nt">&lt;/page&gt;</span></code></pre></figure><p>As you see, it is a proper XML document with attributes, elements and data. It contains absolutely no information about how its elements have to be presented to an end-user. Actually, this document is more suitable for machine parsing instead of reading by a human.</p><p>The document contains data, which is important for its requester. It&#39;s up to the requester on how to render the data or to not render it at all.</p><p>Its second line <a href="http://www.w3.org/TR/xml-stylesheet/">associates</a> the document with the XSL stylesheet <code>/xsl/index.xsl</code> that is loaded by the browser separately:</p><figure class="highlight"><pre><code class="language-xml" data-lang="xml"><span></span><span class="cp">&lt;?xml-stylesheet type=&#39;text/xsl&#39; href=&#39;/xsl/index.xsl&#39;?&gt;</span></code></pre></figure><p>Open developer tools in Chrome and you will see that right after the page is loaded, the browser loads the XSL stylesheet and then all other resources including a few CSS stylesheets, jQuery and an SVG logo:</p><figure class='unprintable'><img src='https://www.yegor256.com/images/2014/06/xslt-loading-order-in-chrome.png' itemprop='image' style='width:600px;max-width:100%;' alt='The figure'/></figure><p><code>index.xsl</code> includes <code>layout.xsl</code>, that&#39;s why it is loaded right after.</p><p>Let&#39;s consider an example of <code>index.xsl</code> (in reality it is much more complex, check <a href="https://github.com/sttc/stateful/blob/master/src/main/webapp/xsl/layout.xsl"><code>layout.xsl</code></a>. For example:</p><figure class="highlight"><pre><code class="language-xml" data-lang="xml"><span></span><span class="nt">&lt;xsl:stylesheet</span> <span class="na">version=</span><span class="s">&quot;2.0&quot;</span>
  <span class="na">xmlns:xsl=</span><span class="s">&quot;http://www.w3.org/1999/XSL/Transform&quot;</span>
  <span class="na">xmlns=</span><span class="s">&quot;http://www.w3.org/1999/xhtml&quot;</span><span class="nt">&gt;</span>
  <span class="nt">&lt;xsl:template</span> <span class="na">match=</span><span class="s">&quot;page&quot;</span><span class="nt">&gt;</span>
    <span class="nt">&lt;html&gt;</span>
      <span class="nt">&lt;body&gt;</span>
        <span class="nt">&lt;p&gt;</span>
          Current version of the application is
          <span class="nt">&lt;xsl:value-of</span> <span class="na">select=</span><span class="s">&quot;version/name&quot;</span><span class="nt">/&gt;</span>
        <span class="nt">&lt;/p&gt;</span>
      <span class="nt">&lt;/body&gt;</span>
    <span class="nt">&lt;/html&gt;</span>
  <span class="nt">&lt;/xsl:template&gt;</span>
<span class="nt">&lt;/xsl:stylesheet&gt;</span></code></pre></figure><p>I think it&#39;s obvious how the HTML page will look like after applying this XSL stylesheet to our XML document.</p><p>For me, this XSL looks clean and easy to understand. However, I often hear people say that XSLT is a hard-to-understand programming language. I don&#39;t find it hard to understand at all. Of course, I&#39;m not using all of its features. But, for simple page rendering, all I need to know are a few simple commands and the principle of XML transformation.</p><h2 id="why-not-a-templating-engine">Why Not a Templating Engine?</h2><p>Now, why is this approach better than all that widely use Java templating engines, including <a href="http://en.wikipedia.org/wiki/JavaServer_Pages">JSP</a>, <a href="http://en.wikipedia.org/wiki/JavaServer_Faces">JSF</a>, <a href="http://velocity.apache.org/engine/devel/">Velocity</a>, <a href="http://freemarker.org/">FreeMarker</a>, <a href="http://tiles.apache.org/">Tiles</a>, etc?</p><p>Well, I see a number of reasons. But, the most important are:</p><ol> <li><p><strong>Web UI and API are same pages</strong>. There is no need to develop separate pages for RESTful API---Web user interface, being accessed by a computer, is an API. In my experience, this leads to massive avoidance of code duplication.</p></li> <li><p><strong>XSL is testable by itself without a server</strong>. In order to test how our web site will look with certain data, we just create a new XML document with necessary test data, associate it with an XSL and open it in a browser. We can also modify XML and refresh the page in browser. This makes the work of HTML/CSS designer much easier and independent of programmers.</p></li> <li><p><strong>XSL is a powerful functional language</strong>. Compared with all other templating engines, which look mostly like workarounds, XSL is a complete and well-designed environment. Writing XSL (after you get used to its syntax and programming concepts) is a pleasure in itself. You&#39;re not injecting instructions into a HTML document (like in JSP and all others). Instead, you are programming transformation of data into presentation---a different mindset and much better feeling.</p></li> <li><p><strong>XML output is perfectly testable</strong>. A controller in MVC that generates an XML document with all data required for the XSL stylesheet can easily be tested in a single unit test using simple XPath expressions. Testing of a controller that injects data into a templating engine is a much more complex operation---even impossible sometimes. I&#39;m also writing in PHP and Ruby. They have exactly the same problems---even though their templating engines are much more powerful due to the interpretation nature of the languages.</p></li> </ol><h2 id="is-it-fully-supported">Is It Fully Supported?</h2><p>Everything would be great if all browsers would support XML+XSL rendering. However, this is far from being true. Only the latest versions of modern browsers support XSL. Check <a href="http://greenbytes.de/tech/tc/xslt/">this comparison</a> done by Julian Reschke. Besides that, XSLT 2.0 is <a href="http://stackoverflow.com/questions/6282340/which-browsers-support-xslt-2-0-already">not supported</a> at all.</p><p>There is a workaround, though. We can understand which browser is making a request (via its <a href="http://en.wikipedia.org/wiki/User_agent"><code>User-Agent</code></a> HTTP header) and transform XML into HTML on the server side. Thus, for modern browsers that support XSL, we will deliver XML and for all others---HTML.</p><p>This is exactly how <a href="https://github.com/yegor256/rexsl">ReXSL framework</a> works. Open <a href="http://www.stateful.co">http://www.stateful.co</a> in Internet Explorer and you will see an HTML document, not an XML document as is the case with Chrome.</p><p>BTW, see how all this is implemented: <a href="/2015/06/25/xml-data-xsl-views-takes-framework.html">XML Data and XSL Views in Takes Framework</a>.</p><p>Read this one, it continues the discussion of this subject: <a href="/2014/09/09/restful-web-sites.html">RESTful API and a Web Site in the Same URL</a></p></p>--> <nav class="buttons notranslate desktop-only"> <a href="http://www.facebook.com/sharer/sharer.php?u=https://www.yegor256.com/2014/06/25/xml-and-xslt-in-browser.html" title="Share on Facebook" class="button" rel="nofollow"> <span class="count count-facebook">0</span> <i class="icon icon-facebook notranslate" aria-hidden="true"></i> </a> <a href="https://twitter.com/share?url=https://www.yegor256.com/2014/06/25/xml-and-xslt-in-browser.html&amp;text=XML%2BXSLT+in+a+Browser" title="Share on Twitter" class="button" rel="nofollow"> <span class="count count-twitter">0</span> <i class="icon icon-twitter notranslate" aria-hidden="true"></i> </a> <a href="https://plus.google.com/share?url=https://www.yegor256.com/2014/06/25/xml-and-xslt-in-browser.html" title="Share on Google+" class="button" rel="nofollow"> <span class="count count-googleplus">0</span> <i class="icon icon-googleplus notranslate" aria-hidden="true"></i> </a> <a href="https://www.linkedin.com/cws/share?url=https://www.yegor256.com/2014/06/25/xml-and-xslt-in-browser.html" title="Share on LinkedIn" class="button" rel="nofollow"> <span class="count count-linkedin">0</span> <i class="icon icon-linkedin notranslate" aria-hidden="true"></i> </a> <a href="http://reddit.com/submit?url=https://www.yegor256.com/2014/06/25/xml-and-xslt-in-browser.html%3F2014-25&amp;title=XML%2BXSLT+in+a+Browser" title="Share on Reddit" class="button" rel="nofollow"> <span class="count count-reddit">0</span> <i class="icon icon-reddit notranslate" aria-hidden="true"></i> </a> <a href="http://news.ycombinator.com/submitlink?u=https://www.yegor256.com/2014/06/25/xml-and-xslt-in-browser.html%3F2014-25&amp;t=XML%2BXSLT+in+a+Browser" title="Share on Hacker News" class="button" rel="nofollow"> <span class="count count-hackernews">0</span> <i class="icon icon-hackernews notranslate" aria-hidden="true"></i> </a> </nav> </header> <article class="main" itemprop="articleBody"><div ><p><a href="http://en.wikipedia.org/wiki/Separation_of_presentation_and_content">Separating data and their presentation</a> is a great concept. Take HTML and CSS for example. HTML is supposed to have pure data and CSS is supposed to format that data in order to make it readable by a human. Years ago, that was probably the intention of HTML/CSS, but in reality it doesn&#39;t work like that. Mostly because CSS is not powerful enough.</p><p>We still have to format our data using HTML tags, while <a href="/2014/06/26/sass-in-java-webapp.html">CSS</a> can help slightly with positioning and decorating.</p><p>On the other hand, XML with <a href="http://en.wikipedia.org/wiki/XSLT">XSLT</a> implements perfectly the idea of separating data and presentation. XML documents, like HTML, are supposed to contain data only without any information about positioning or formatting. XSL stylesheets position and decorate the data. XSL is a much more powerful language. That&#39;s why it&#39;s possible to avoid any formatting inside XML.</p><p>The latest versions of Chrome, Safari, Firefox and IE all support this mechanism. When a browser retrieves an XML document from a server, and the document has an XSL stylesheet <a href="http://www.w3.org/TR/xml-stylesheet/">associated</a> with it---the browser transforms XML into HTML on-fly.</p><h2 id="working-example">Working Example</h2><p>Let&#39;s review a simple Java web application that works this way. It is using <a href="http://www.takes.org">Takes Framework</a> that makes this mechanism possible. In the next post, I&#39;ll explain how ReXSL works. For now, though, let&#39;s focus on the idea of delivering bare data in XML and formatting it with an XSL stylesheet.</p><p>Open <a href="http://www.stateful.co">http://www.stateful.co</a>---it is a collection of stateful web primitives, explained in the <a href="/2014/05/18/cloud-autoincrement-counters.html">Atomic Counters at Stateful.co</a> article.</p><p>Open it in Chrome or Safari. When you do, you should see a normal web page with a logo, some text, some links, a footer, etc. Now check its sources (I assume you know how to do this).</p><p>This is approximately what you will see (I assume you understand XML, if not, start learning it immediately):</p><figure class="highlight"><pre><code class="language-xml" data-lang="xml"><span></span><span class="cp">&lt;?xml-stylesheet type=&#39;text/xsl&#39; href=&#39;/xsl/index.xsl&#39;?&gt;</span>
<span class="nt">&lt;page</span> <span class="na">date=</span><span class="s">&quot;2014-06-15T15:30:49.521Z&quot;</span> <span class="na">ip=</span><span class="s">&quot;10.168.29.135&quot;</span><span class="nt">&gt;</span>
  <span class="nt">&lt;menu&gt;</span>home<span class="nt">&lt;/menu&gt;</span>
  <span class="nt">&lt;documentation&gt;</span>.. some text here ..<span class="nt">&lt;/documentation&gt;</span>
  <span class="nt">&lt;version&gt;</span>
    <span class="nt">&lt;name&gt;</span>1.4<span class="nt">&lt;/name&gt;</span>
    <span class="nt">&lt;revision&gt;</span>5c7b5af<span class="nt">&lt;/revision&gt;</span>
    <span class="nt">&lt;date&gt;</span>2014-05-29 07:58<span class="nt">&lt;/date&gt;</span>
  <span class="nt">&lt;/version&gt;</span>
  <span class="nt">&lt;links&gt;</span>
    <span class="nt">&lt;link</span> <span class="na">href=</span><span class="s">&quot;...&quot;</span> <span class="na">rel=</span><span class="s">&quot;rexsl:google&quot;</span> <span class="na">type=</span><span class="s">&quot;text/xml&quot;</span><span class="nt">/&gt;</span>
    <span class="nt">&lt;link</span> <span class="na">href=</span><span class="s">&quot;...&quot;</span> <span class="na">rel=</span><span class="s">&quot;rexsl:github&quot;</span> <span class="na">type=</span><span class="s">&quot;text/xml&quot;</span><span class="nt">/&gt;</span>
    <span class="nt">&lt;link</span> <span class="na">href=</span><span class="s">&quot;...&quot;</span> <span class="na">rel=</span><span class="s">&quot;rexsl:facebook&quot;</span> <span class="na">type=</span><span class="s">&quot;text/xml&quot;</span><span class="nt">/&gt;</span>
  <span class="nt">&lt;/links&gt;</span>
  <span class="nt">&lt;millis&gt;</span>70<span class="nt">&lt;/millis&gt;</span>
<span class="nt">&lt;/page&gt;</span></code></pre></figure><p>As you see, it is a proper XML document with attributes, elements and data. It contains absolutely no information about how its elements have to be presented to an end-user. Actually, this document is more suitable for machine parsing instead of reading by a human.</p><p>The document contains data, which is important for its requester. It&#39;s up to the requester on how to render the data or to not render it at all.</p><p>Its second line <a href="http://www.w3.org/TR/xml-stylesheet/">associates</a> the document with the XSL stylesheet <code>/xsl/index.xsl</code> that is loaded by the browser separately:</p><figure class="highlight"><pre><code class="language-xml" data-lang="xml"><span></span><span class="cp">&lt;?xml-stylesheet type=&#39;text/xsl&#39; href=&#39;/xsl/index.xsl&#39;?&gt;</span></code></pre></figure><p>Open developer tools in Chrome and you will see that right after the page is loaded, the browser loads the XSL stylesheet and then all other resources including a few CSS stylesheets, jQuery and an SVG logo:</p><figure class='unprintable'><img src='https://www.yegor256.com/images/2014/06/xslt-loading-order-in-chrome.png' itemprop='image' style='width:600px;max-width:100%;' alt='The figure'/></figure><p><code>index.xsl</code> includes <code>layout.xsl</code>, that&#39;s why it is loaded right after.</p><p>Let&#39;s consider an example of <code>index.xsl</code> (in reality it is much more complex, check <a href="https://github.com/sttc/stateful/blob/master/src/main/webapp/xsl/layout.xsl"><code>layout.xsl</code></a>. For example:</p><figure class="highlight"><pre><code class="language-xml" data-lang="xml"><span></span><span class="nt">&lt;xsl:stylesheet</span> <span class="na">version=</span><span class="s">&quot;2.0&quot;</span>
  <span class="na">xmlns:xsl=</span><span class="s">&quot;http://www.w3.org/1999/XSL/Transform&quot;</span>
  <span class="na">xmlns=</span><span class="s">&quot;http://www.w3.org/1999/xhtml&quot;</span><span class="nt">&gt;</span>
  <span class="nt">&lt;xsl:template</span> <span class="na">match=</span><span class="s">&quot;page&quot;</span><span class="nt">&gt;</span>
    <span class="nt">&lt;html&gt;</span>
      <span class="nt">&lt;body&gt;</span>
        <span class="nt">&lt;p&gt;</span>
          Current version of the application is
          <span class="nt">&lt;xsl:value-of</span> <span class="na">select=</span><span class="s">&quot;version/name&quot;</span><span class="nt">/&gt;</span>
        <span class="nt">&lt;/p&gt;</span>
      <span class="nt">&lt;/body&gt;</span>
    <span class="nt">&lt;/html&gt;</span>
  <span class="nt">&lt;/xsl:template&gt;</span>
<span class="nt">&lt;/xsl:stylesheet&gt;</span></code></pre></figure><p>I think it&#39;s obvious how the HTML page will look like after applying this XSL stylesheet to our XML document.</p><p>For me, this XSL looks clean and easy to understand. However, I often hear people say that XSLT is a hard-to-understand programming language. I don&#39;t find it hard to understand at all. Of course, I&#39;m not using all of its features. But, for simple page rendering, all I need to know are a few simple commands and the principle of XML transformation.</p><h2 id="why-not-a-templating-engine">Why Not a Templating Engine?</h2><p>Now, why is this approach better than all that widely use Java templating engines, including <a href="http://en.wikipedia.org/wiki/JavaServer_Pages">JSP</a>, <a href="http://en.wikipedia.org/wiki/JavaServer_Faces">JSF</a>, <a href="http://velocity.apache.org/engine/devel/">Velocity</a>, <a href="http://freemarker.org/">FreeMarker</a>, <a href="http://tiles.apache.org/">Tiles</a>, etc?</p><p>Well, I see a number of reasons. But, the most important are:</p><ol> <li><p><strong>Web UI and API are same pages</strong>. There is no need to develop separate pages for RESTful API---Web user interface, being accessed by a computer, is an API. In my experience, this leads to massive avoidance of code duplication.</p></li> <li><p><strong>XSL is testable by itself without a server</strong>. In order to test how our web site will look with certain data, we just create a new XML document with necessary test data, associate it with an XSL and open it in a browser. We can also modify XML and refresh the page in browser. This makes the work of HTML/CSS designer much easier and independent of programmers.</p></li> <li><p><strong>XSL is a powerful functional language</strong>. Compared with all other templating engines, which look mostly like workarounds, XSL is a complete and well-designed environment. Writing XSL (after you get used to its syntax and programming concepts) is a pleasure in itself. You&#39;re not injecting instructions into a HTML document (like in JSP and all others). Instead, you are programming transformation of data into presentation---a different mindset and much better feeling.</p></li> <li><p><strong>XML output is perfectly testable</strong>. A controller in MVC that generates an XML document with all data required for the XSL stylesheet can easily be tested in a single unit test using simple XPath expressions. Testing of a controller that injects data into a templating engine is a much more complex operation---even impossible sometimes. I&#39;m also writing in PHP and Ruby. They have exactly the same problems---even though their templating engines are much more powerful due to the interpretation nature of the languages.</p></li> </ol><h2 id="is-it-fully-supported">Is It Fully Supported?</h2><p>Everything would be great if all browsers would support XML+XSL rendering. However, this is far from being true. Only the latest versions of modern browsers support XSL. Check <a href="http://greenbytes.de/tech/tc/xslt/">this comparison</a> done by Julian Reschke. Besides that, XSLT 2.0 is <a href="http://stackoverflow.com/questions/6282340/which-browsers-support-xslt-2-0-already">not supported</a> at all.</p><p>There is a workaround, though. We can understand which browser is making a request (via its <a href="http://en.wikipedia.org/wiki/User_agent"><code>User-Agent</code></a> HTTP header) and transform XML into HTML on the server side. Thus, for modern browsers that support XSL, we will deliver XML and for all others---HTML.</p><p>This is exactly how <a href="https://github.com/yegor256/rexsl">ReXSL framework</a> works. Open <a href="http://www.stateful.co">http://www.stateful.co</a> in Internet Explorer and you will see an HTML document, not an XML document as is the case with Chrome.</p><p>BTW, see how all this is implemented: <a href="/2015/06/25/xml-data-xsl-views-takes-framework.html">XML Data and XSL Views in Takes Framework</a>.</p><p>Read this one, it continues the discussion of this subject: <a href="/2014/09/09/restful-web-sites.html">RESTful API and a Web Site in the Same URL</a></p></div></article></div><div class="wrapper"> <related-posts /></div><div class="disqus" role="complementary"><p class="disqus_hint"> Please, use <a href="https://help.disqus.com/commenting/what-html-tags-are-allowed-within-comments">syntax highlighting</a> in your comments, to make them more readable.</p><div id="disqus_thread" class="disqus-thread"> <a>&nbsp;</a></div><script> var disqus_config = function () { this.page.url = document.location.href.split('?')[0].split('#')[0].replace('https://', 'http://'); this.page.identifier = this.page.url; }; (function() { var d = document, s = d.createElement('script'); s.src = '//yegor256.disqus.com/embed.js'; s.setAttribute('data-timestamp', +new Date()); (d.head || d.body).appendChild(s); })(); </script> <noscript><div><p class="red"> JavaScript is disabled in your browser, that's why you can't see comments under this post.</p></div></noscript></div><div class="wrapper"> <footer class="footer"><p> &copy; <span itemscope="" itemprop="copyrightHolder" itemtype="http://schema.org/Person"> <span itemprop="name">Yegor Bugayenko</span> </span> 2014&ndash;<span itemprop="copyrightYear">2018</span></p></footer></div></section><div class="wrapper unprintable" style="text-align:center;margin-top:2em;"> <a href="http://www.sixnines.io/h/3ba1652f"> <img src="//www.sixnines.io/b/3ba1652f?style=flat" alt="sixnines availability badge"/> </a></div><script src="//code.jquery.com/jquery-1.9.0.min.js"></script> <script src="/js/all.js?4e047f6f42b"></script> <script>var disqus_shortname = 'yegor256';</script> <script id="dsq-count-scr" src="//yegor256.disqus.com/count.js" async="async"></script> <script> (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){ (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o), m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m) })(window,document,'script','//www.google-analytics.com/analytics.js','ga'); ga('create', 'UA-1963507-32', 'auto'); ga('send', 'pageview'); </script> <script> Cd=document;Cr="&"+Math.random();Cp="&s=1"; Cd.cookie="b=b";if(Cd.cookie)Cp+="&c=1"; Cp+="&t="+(new Date()).getTimezoneOffset(); if(self!=top)Cp+="&f=1"; </script> <script> if(navigator.javaEnabled())Cp+="&j=1"; </script> <script> if(typeof(screen)!='undefined')Cp+="&w="+screen.width+"&h="+ screen.height+"&d="+(screen.colorDepth?screen.colorDepth:screen.pixelDepth); </script> <script> Cd.write("<img src='//c.hit.ua/hit?i=95870&g=0&x=2"+Cp+Cr+ "&r="+escape(Cd.referrer)+"&u="+escape(window.location.href)+ "' border='0' wi"+"dth='1' he"+"ight='1'/>"); </script> <script type="application/ld+json"> { "@context": "http://schema.org", "@type": "Person", "name": "Yegor Bugayenko", "url": "http://www.yegor256.com", "sameAs": [ "https://www.facebook.com/yegor256", "https://instagram.com/yegor256", "https://www.linkedin.com/in/yegor256", "https://twitter.com/yegor256", "https://github.com/yegor256", "https://www.pinterest.com/yegor256/" ] } </script> </body> </html> <!DOCTYPE html> <html xmlns="http://www.w3.org/1999/xhtml" lang="en-US" xml:lang="en-US" itemscope="" itemtype="http://schema.org/WebSite"> <head> <meta charset="utf-8"/> <meta name="description" content="Aspect oriented programming with AspectJ and jcabi-aspects can help you to control maximum execution time for any single Java method " /> <meta name="keywords" content="aop annotations Timeable, aop java, aop method time annotations, aspect oriented programming java, aspectj timing, aspectj weaving annotations, java limit method execution time, limit method execution time java" /> <meta name="viewport" content="width=device-width,minimum-scale=1,initial-scale=1"/> <meta name="google-site-verification" content="JEj_gQr2CPe2QKGw8XdMz0R7VboQIUbX3FlM-lwTq-8" /> <meta name="author" content="Yegor Bugayenko"> <meta name="article:published_time" content="2014-06-20 00:00:00 +0000"> <meta name="og:site_name" content="Yegor Bugayenko"/> <meta name="og:type" content="article" /> <meta name="og:locale" content="en_US" /> <meta name="twitter:account_id" content="4503599630178231" /> <meta name="twitter:creator" content="@yegor256"/> <meta name="twitter:site" content="@yegor256"/> <meta name="twitter:title" property="og:title" content="Limit Java Method Execution Time"/> <meta name="twitter:description" property="og:description" content="Aspect oriented programming with AspectJ and jcabi-aspects can help you to control maximum execution time for any single Java method "/> <meta name="twitter:url" property="og:url" content="https://www.yegor256.com/2014/06/20/limit-method-execution-time.html"/> <meta name="telegram:channel" content="AAAAAEJFMRzsRTRxM3ec6A"/> <link rel="search" type="application/opensearchdescription+xml" href="/opensearch.xml" title="yegor256" /> <link rel="shortcut icon" href="/favicon.ico?4e047f6f42b"/> <link rel="apple-touch-icon" href="/favicon.ico?4e047f6f42b"/> <link rel="alternate" type="application/rss+xml" title="RSS for yegor256.com" href="https://www.yegor256.com/rss.xml"/> <link rel="stylesheet" href="/css/layout.css?4e047f6f42b"/> <link rel="stylesheet" href="/css/icons.css?4e047f6f42b"/> <link rel="canonical" href="https://www.yegor256.com/2014/06/20/limit-method-execution-time.html" /> <link rel="amphtml" href="https://www.yegor256.com/2014/06/20/limit-method-execution-time.amp.html" /> <title>Limit Java Method Execution Time </title> </head> <body><div class="wrapper"> <aside class="header-toggle unprintable" id="header-toggle" title="Show the menu" onclick="$('#header').show();$('#header-toggle').hide();">&#9776;</aside> <header class="header" id="header"><div class="face"> <a href="/about-me.html#form" class="sub" title="Click to subscribe to my monthly newsletter"><span>Subscribe</span></a> <a href="/about-me.html" style="position:relative;"> <img src="/images/face-256x256.jpg" class="photo" alt="Yegor Bugayenko"/> </a></div><nav><ul class="menu social notranslate"> <li><a href="https://twitter.com/intent/follow?screen_name=yegor256" rel="nofollow" title="Follow me on Twitter"><i class="icon icon-twitter notranslate" aria-hidden="true"></i></a></li> <li><a href="/rss.xml" rel="nofollow" title="Subscribe to my RSS feed"><i class="icon icon-rss notranslate" aria-hidden="true"></i></a></li> <li><a itemprop="sameAs" href="https://github.com/yegor256" rel="nofollow" title="My GitHub profile"><i class="icon icon-github notranslate" aria-hidden="true"></i></a></li> <li><a itemprop="sameAs" href="http://stackoverflow.com/users/187141/yegor256" rel="nofollow" title="My StackOverflow profile"><i class="icon icon-stackoverflow notranslate" aria-hidden="true"></i></a></li> <li><a itemprop="sameAs" href="https://www.facebook.com/yegor256" rel="nofollow" title="Follow me on Facebook"><i class="icon icon-facebook notranslate" aria-hidden="true"></i></a></li> <li><a itemprop="sameAs" href="https://instagram.com/yegor256" rel="nofollow" title="Follow me on Instagram"><i class="icon icon-instagram notranslate" aria-hidden="true"></i></a></li> <li><a itemprop="sameAs" href="https://www.linkedin.com/in/yegor256" rel="nofollow" title="My LinkedIn profile"><i class="icon icon-linkedin notranslate" aria-hidden="true"></i></a></li> <li><a itemprop="sameAs" href="https://www.youtube.com/c/yegor256?sub_confirmation=1" rel="nofollow" title="My Youtube video channel"><i class="icon icon-youtube notranslate" aria-hidden="true"></i></a></li> <li><a itemprop="sameAs" href="https://www.pinterest.com/yegor256/" rel="nofollow" title="My Pinterest boards"><i class="icon icon-pinterest notranslate" aria-hidden="true"></i></a></li> <li><a itemprop="sameAs" href="https://angel.co/yegor256" rel="nofollow" title="My AngelList profile"><i class="icon icon-angellist notranslate" aria-hidden="true"></i></a></li> <li><a href="https://soundcloud.com/yegor256" rel="nofollow" title="My podcast"><i class="icon icon-podcast notranslate" aria-hidden="true"></i></a></li> <li><a href="https://itunes.apple.com/us/podcast/yegor256-podcast/id1150826721" rel="nofollow" title="My iTunes podcast"><i class="icon icon-itunes notranslate" aria-hidden="true"></i></a></li> <li><a href="https://t.me/joinchat/AAAAAEJFMRzsRTRxM3ec6A" rel="nofollow" title="My Telegram public channel"><i class="icon icon-telegram notranslate" aria-hidden="true"></i></a></li> <li><a href="mailto:blog@yegor256.com" rel="nofollow" title="Email me any time"><i class="icon icon-mail notranslate" aria-hidden="true"></i></a></li></ul><ul class="menu"> <li><a href="/" title="Home page">Home</a></li> <li ><a href="/best.html" title="Best articles to read">12&#160;Best</a></li> <li ><a href="/contents.html" title="The contents of the entire blog">All&#160;288</a></li> <li ><a href="/webinars.html" title="My webinars">Webinars</a></li> <li ><a href="/talks.html" title="Future and past conference talks">Talks</a></li> <li ><a href="/books.html" title="The books I wrote">Books</a></li> <li ><a href="/papers.html" title="My academic papers and patents">Papers</a></li> <li ><a href="/pets.html" title="My loved pet projects">Pets</a></li> <li ><a href="/award.html" title="Software quality award">Award</a></li> <li ><a href="/testimonials.html" title="What some people say about me">Testimonials</a></li> <li ><a href="/shift-m.html" title="Audio podcast about project management">Shift-M</a></li> <li ><a href="/paintings.html" title="My paintings for sale">Paintings</a></li> <li><a href="http://ru.yegor256.com/" title="Немного на русском языке">По-русски</a></li></ul></nav><div class="search"> <form method="get" action="https://www.google.com/search" itemprop="potentialAction" itemscope="" itemtype="http://schema.org/SearchAction"> <meta itemprop="target" content="https://www.google.com/search?q={q}"/> <input name="sitesearch" value="yegor256.com" type="hidden"/> <input itemprop="query-input" type="text" id="search-query" class="field field-text" required="required" onfocus="$('.google').css('visibility', 'visible');" name="q" placeholder="Search..." autocomplete="off"/> <input type="image" src="/images/google-search-icon.svg" class="google" title="Search via Google" alt="Search via Google"/> </form></div><div class="hot"><ul> <li> <a href="/code-ahead.html">Code Ahead</a> was published on Amazon just a few days ago! It is my new book, a novel about programmers. It explains in details the majority of ideas that stand behind <a href="https://www.zerocracy.com">Zerocracy</a> and <a href="https://www.xdsd.org">XDSD</a>. </li> <li> At <a href="/webinars.html">Webinar #37</a> we will discuss naming problem in OOP, for objects, methods and attributes; join us on <b>September 12</b>, at 11am PST. </li></ul></div></header></div><section itemscope="" itemtype="http://schema.org/BlogPosting"><div class="wrapper"> <header><p class="printable"> <img src="https://api.qrserver.com/v1/create-qr-code/?data=https://www.yegor256.com/2014/06/20/limit-method-execution-time.html&amp;format=svg" style="width:125px;height:125px;" alt="QR code"/></p><p class="printable"> <code itemprop="url">https://www.yegor256.com/2014/06/20/limit-method-execution-time.html</code></p><h1 itemprop="name headline mainEntityOfPage">Limit Java Method Execution Time</h1><ul class="subline"> <li> <time itemprop="datePublished" datetime="2014-06-20T00:00:00+00:00"> 20 June 2014 </time> </li> <li class="printable" itemscope="" itemprop="author" itemtype="http://schema.org/Person"> <span itemprop="name">Yegor Bugayenko</span> </li> <li class="unprintable"> <i class="icon icon-comments"></i> <a href="http://www.yegor256.com/2014/06/20/limit-method-execution-time.html#disqus_thread" itemprop="discussionUrl">comments</a> </li></ul><p>Keep in mind that you should weave your classes after compilation, as explained <a href="http://aspects.jcabi.com/example-weaving.html">here</a>.</p><p>Let&#39;s discuss how this actually works, but first, I recommend you read <a href="/2014/06/01/aop-aspectj-java-method-logging.html">this post</a>, which explains how AOP aspects work together with <a href="/2016/04/12/java-annotations-are-evil.html">Java annotations</a>.</p><p>Due to <a href="http://aspects.jcabi.com/annotation-timeable.html"><code>@Timeable</code></a> annotation and class weaving, every call to a method <code>load()</code> is intercepted by an aspect from <a href="http://aspects.jcabi.com">jcabi-aspects</a>. That aspect starts a new thread that monitors the execution of a method every second, checking whether it is still running.</p><p>If the method runs for over five seconds, the thread calls <a href="http://docs.oracle.com/javase/7/docs/api/java/lang/Thread.html#interrupt%28%29"><code>interrupt()</code></a> on the method&#39;s thread.</p><p>Despite a very common expectation that a thread should be terminated immediately on that call, it is not happening at all. <a href="http://docs.oracle.com/javase/1.5.0/docs/guide/misc/threadPrimitiveDeprecation.html">This article</a> explains the mechanism in more detail. Let&#39;s discuss it briefly:</p><ol> <li><p><a href="http://docs.oracle.com/javase/7/docs/api/java/lang/Thread.html#interrupt%28%29"><code>interrupt()</code></a> sets a marker in a thread;</p></li> <li><p>The thread checks <a href="http://docs.oracle.com/javase/7/docs/api/java/lang/Thread.html#interrupt%28%29"><code>interrupted()</code></a> as often as it can;</p></li> <li><p>If the marker is set, the thread stops and throws <a href="http://docs.oracle.com/javase/7/docs/api/java/lang/InterruptedException.html"><code>InterruptedException</code></a></p></li> </ol><p>This method will <strong>not</strong> react to <code>interrupt()</code> call and will work until JVM is killed (very bad design):</p><figure class="highlight"><pre><code class="language-java" data-lang="java"><span></span><span class="kd">public</span> <span class="kt">void</span> <span class="nf">work</span><span class="o">()</span> <span class="o">{</span>
  <span class="k">while</span> <span class="o">(</span><span class="kc">true</span><span class="o">)</span> <span class="o">{</span>
    <span class="c1">// do something</span>
  <span class="o">}</span>
<span class="o">}</span></code></pre></figure><p>This is how we should refactor it in order to make sensitive to interruption requests:</p><figure class="highlight"><pre><code class="language-java" data-lang="java"><span></span><span class="kd">public</span> <span class="kt">void</span> <span class="nf">work</span><span class="o">()</span> <span class="o">{</span>
  <span class="k">while</span> <span class="o">(</span><span class="kc">true</span><span class="o">)</span> <span class="o">{</span>
    <span class="k">if</span> <span class="o">(</span><span class="n">Thread</span><span class="o">.</span><span class="na">interruped</span><span class="o">())</span> <span class="o">{</span>
      <span class="k">throw</span> <span class="k">new</span> <span class="n">InterruptedException</span><span class="o">();</span>
    <span class="o">}</span>
    <span class="c1">// do something</span>
  <span class="o">}</span>
<span class="o">}</span></code></pre></figure><p>In other words, your method can only stop itself. Nothing else can do it. The thread it is running in can&#39;t be terminated by another thread. The best thing that the other thread can do is to send your thread a &quot;message&quot; (through <code>interrupt()</code> method) that it&#39;s time to stop. If your thread ignores the message, nobody can do anything.</p><p>Most I/O operations in JDK are designed this way. They check the interruption status of their threads while waiting for I/O resources.</p><p>Thus, use <code>@Timeable</code> annotation, but keep in mind that there could be situations when a thread can&#39;t be interrupted.</p></p>--> <nav class="buttons notranslate desktop-only"> <a href="http://www.facebook.com/sharer/sharer.php?u=https://www.yegor256.com/2014/06/20/limit-method-execution-time.html" title="Share on Facebook" class="button" rel="nofollow"> <span class="count count-facebook">0</span> <i class="icon icon-facebook notranslate" aria-hidden="true"></i> </a> <a href="https://twitter.com/share?url=https://www.yegor256.com/2014/06/20/limit-method-execution-time.html&amp;text=Limit+Java+Method+Execution+Time" title="Share on Twitter" class="button" rel="nofollow"> <span class="count count-twitter">0</span> <i class="icon icon-twitter notranslate" aria-hidden="true"></i> </a> <a href="https://plus.google.com/share?url=https://www.yegor256.com/2014/06/20/limit-method-execution-time.html" title="Share on Google+" class="button" rel="nofollow"> <span class="count count-googleplus">0</span> <i class="icon icon-googleplus notranslate" aria-hidden="true"></i> </a> <a href="https://www.linkedin.com/cws/share?url=https://www.yegor256.com/2014/06/20/limit-method-execution-time.html" title="Share on LinkedIn" class="button" rel="nofollow"> <span class="count count-linkedin">0</span> <i class="icon icon-linkedin notranslate" aria-hidden="true"></i> </a> <a href="http://reddit.com/submit?url=https://www.yegor256.com/2014/06/20/limit-method-execution-time.html%3F2014-24&amp;title=Limit+Java+Method+Execution+Time" title="Share on Reddit" class="button" rel="nofollow"> <span class="count count-reddit">0</span> <i class="icon icon-reddit notranslate" aria-hidden="true"></i> </a> <a href="http://news.ycombinator.com/submitlink?u=https://www.yegor256.com/2014/06/20/limit-method-execution-time.html%3F2014-24&amp;t=Limit+Java+Method+Execution+Time" title="Share on Hacker News" class="button" rel="nofollow"> <span class="count count-hackernews">0</span> <i class="icon icon-hackernews notranslate" aria-hidden="true"></i> </a> </nav> </header> <article class="main" itemprop="articleBody"><div > <figure class='badge'><a href='http://aspects.jcabi.com'><img src='http://img.jcabi.com/logo-square.svg' style='width:64px;max-width:100%;' alt='badge'/></a></figure><p>Say, you want to allow a Java method to work for a maximum of five seconds and want an exception to be thrown if the timeframe is exceeded. Here is how you can do it with <a href="http://aspects.jcabi.com">jcabi-aspects</a> and <a href="http://eclipse.org/aspectj/">AspectJ</a>:</p><figure class="highlight"><pre><code class="language-java" data-lang="java"><span></span><span class="kd">public</span> <span class="kd">class</span> <span class="nc">Resource</span> <span class="o">{</span>
  <span class="nd">@Timeable</span><span class="o">(</span><span class="n">limit</span> <span class="o">=</span> <span class="mi">5</span><span class="o">,</span> <span class="n">unit</span> <span class="o">=</span> <span class="n">TimeUnit</span><span class="o">.</span><span class="na">SECONDS</span><span class="o">)</span>
  <span class="kd">public</span> <span class="n">String</span> <span class="nf">load</span><span class="o">(</span><span class="n">URL</span> <span class="n">url</span><span class="o">)</span> <span class="o">{</span>
    <span class="k">return</span> <span class="n">url</span><span class="o">.</span><span class="na">openConnection</span><span class="o">().</span><span class="na">getContent</span><span class="o">();</span>
  <span class="o">}</span>
<span class="o">}</span></code></pre></figure><p>Keep in mind that you should weave your classes after compilation, as explained <a href="http://aspects.jcabi.com/example-weaving.html">here</a>.</p><p>Let&#39;s discuss how this actually works, but first, I recommend you read <a href="/2014/06/01/aop-aspectj-java-method-logging.html">this post</a>, which explains how AOP aspects work together with <a href="/2016/04/12/java-annotations-are-evil.html">Java annotations</a>.</p><p>Due to <a href="http://aspects.jcabi.com/annotation-timeable.html"><code>@Timeable</code></a> annotation and class weaving, every call to a method <code>load()</code> is intercepted by an aspect from <a href="http://aspects.jcabi.com">jcabi-aspects</a>. That aspect starts a new thread that monitors the execution of a method every second, checking whether it is still running.</p><p>If the method runs for over five seconds, the thread calls <a href="http://docs.oracle.com/javase/7/docs/api/java/lang/Thread.html#interrupt%28%29"><code>interrupt()</code></a> on the method&#39;s thread.</p><p>Despite a very common expectation that a thread should be terminated immediately on that call, it is not happening at all. <a href="http://docs.oracle.com/javase/1.5.0/docs/guide/misc/threadPrimitiveDeprecation.html">This article</a> explains the mechanism in more detail. Let&#39;s discuss it briefly:</p><ol> <li><p><a href="http://docs.oracle.com/javase/7/docs/api/java/lang/Thread.html#interrupt%28%29"><code>interrupt()</code></a> sets a marker in a thread;</p></li> <li><p>The thread checks <a href="http://docs.oracle.com/javase/7/docs/api/java/lang/Thread.html#interrupt%28%29"><code>interrupted()</code></a> as often as it can;</p></li> <li><p>If the marker is set, the thread stops and throws <a href="http://docs.oracle.com/javase/7/docs/api/java/lang/InterruptedException.html"><code>InterruptedException</code></a></p></li> </ol><p>This method will <strong>not</strong> react to <code>interrupt()</code> call and will work until JVM is killed (very bad design):</p><figure class="highlight"><pre><code class="language-java" data-lang="java"><span></span><span class="kd">public</span> <span class="kt">void</span> <span class="nf">work</span><span class="o">()</span> <span class="o">{</span>
  <span class="k">while</span> <span class="o">(</span><span class="kc">true</span><span class="o">)</span> <span class="o">{</span>
    <span class="c1">// do something</span>
  <span class="o">}</span>
<span class="o">}</span></code></pre></figure><p>This is how we should refactor it in order to make sensitive to interruption requests:</p><figure class="highlight"><pre><code class="language-java" data-lang="java"><span></span><span class="kd">public</span> <span class="kt">void</span> <span class="nf">work</span><span class="o">()</span> <span class="o">{</span>
  <span class="k">while</span> <span class="o">(</span><span class="kc">true</span><span class="o">)</span> <span class="o">{</span>
    <span class="k">if</span> <span class="o">(</span><span class="n">Thread</span><span class="o">.</span><span class="na">interruped</span><span class="o">())</span> <span class="o">{</span>
      <span class="k">throw</span> <span class="k">new</span> <span class="n">InterruptedException</span><span class="o">();</span>
    <span class="o">}</span>
    <span class="c1">// do something</span>
  <span class="o">}</span>
<span class="o">}</span></code></pre></figure><p>In other words, your method can only stop itself. Nothing else can do it. The thread it is running in can&#39;t be terminated by another thread. The best thing that the other thread can do is to send your thread a &quot;message&quot; (through <code>interrupt()</code> method) that it&#39;s time to stop. If your thread ignores the message, nobody can do anything.</p><p>Most I/O operations in JDK are designed this way. They check the interruption status of their threads while waiting for I/O resources.</p><p>Thus, use <code>@Timeable</code> annotation, but keep in mind that there could be situations when a thread can&#39;t be interrupted.</p></div></article></div><div class="wrapper"> <related-posts /></div><div class="disqus" role="complementary"><p class="disqus_hint"> Please, use <a href="https://help.disqus.com/commenting/what-html-tags-are-allowed-within-comments">syntax highlighting</a> in your comments, to make them more readable.</p><div id="disqus_thread" class="disqus-thread"> <a>&nbsp;</a></div><script> var disqus_config = function () { this.page.url = document.location.href.split('?')[0].split('#')[0].replace('https://', 'http://'); this.page.identifier = this.page.url; }; (function() { var d = document, s = d.createElement('script'); s.src = '//yegor256.disqus.com/embed.js'; s.setAttribute('data-timestamp', +new Date()); (d.head || d.body).appendChild(s); })(); </script> <noscript><div><p class="red"> JavaScript is disabled in your browser, that's why you can't see comments under this post.</p></div></noscript></div><div class="wrapper"> <footer class="footer"><p> &copy; <span itemscope="" itemprop="copyrightHolder" itemtype="http://schema.org/Person"> <span itemprop="name">Yegor Bugayenko</span> </span> 2014&ndash;<span itemprop="copyrightYear">2018</span></p></footer></div></section><div class="wrapper unprintable" style="text-align:center;margin-top:2em;"> <a href="http://www.sixnines.io/h/3ba1652f"> <img src="//www.sixnines.io/b/3ba1652f?style=flat" alt="sixnines availability badge"/> </a></div><script src="//code.jquery.com/jquery-1.9.0.min.js"></script> <script src="/js/all.js?4e047f6f42b"></script> <script>var disqus_shortname = 'yegor256';</script> <script id="dsq-count-scr" src="//yegor256.disqus.com/count.js" async="async"></script> <script> (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){ (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o), m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m) })(window,document,'script','//www.google-analytics.com/analytics.js','ga'); ga('create', 'UA-1963507-32', 'auto'); ga('send', 'pageview'); </script> <script> Cd=document;Cr="&"+Math.random();Cp="&s=1"; Cd.cookie="b=b";if(Cd.cookie)Cp+="&c=1"; Cp+="&t="+(new Date()).getTimezoneOffset(); if(self!=top)Cp+="&f=1"; </script> <script> if(navigator.javaEnabled())Cp+="&j=1"; </script> <script> if(typeof(screen)!='undefined')Cp+="&w="+screen.width+"&h="+ screen.height+"&d="+(screen.colorDepth?screen.colorDepth:screen.pixelDepth); </script> <script> Cd.write("<img src='//c.hit.ua/hit?i=95870&g=0&x=2"+Cp+Cr+ "&r="+escape(Cd.referrer)+"&u="+escape(window.location.href)+ "' border='0' wi"+"dth='1' he"+"ight='1'/>"); </script> <script type="application/ld+json"> { "@context": "http://schema.org", "@type": "Person", "name": "Yegor Bugayenko", "url": "http://www.yegor256.com", "sameAs": [ "https://www.facebook.com/yegor256", "https://instagram.com/yegor256", "https://www.linkedin.com/in/yegor256", "https://twitter.com/yegor256", "https://github.com/yegor256", "https://www.pinterest.com/yegor256/" ] } </script> </body> </html> <!DOCTYPE html> <html xmlns="http://www.w3.org/1999/xhtml" lang="en-US" xml:lang="en-US" itemscope="" itemtype="http://schema.org/WebSite"> <head> <meta charset="utf-8"/> <meta name="description" content="String concatenation in Java is a bad practice; this article explains why and how to avoid it to create cleaner code " /> <meta name="keywords" content="avoid string concatenation, bad practice java, best practice string concatenation, how to avoid string concatenation, java string concatenation, replacement of string concatenation" /> <meta name="viewport" content="width=device-width,minimum-scale=1,initial-scale=1"/> <meta name="google-site-verification" content="JEj_gQr2CPe2QKGw8XdMz0R7VboQIUbX3FlM-lwTq-8" /> <meta name="author" content="Yegor Bugayenko"> <meta name="article:published_time" content="2014-06-19 00:00:00 +0000"> <meta name="og:site_name" content="Yegor Bugayenko"/> <meta name="og:type" content="article" /> <meta name="og:locale" content="en_US" /> <meta name="twitter:account_id" content="4503599630178231" /> <meta name="twitter:creator" content="@yegor256"/> <meta name="twitter:site" content="@yegor256"/> <meta name="twitter:title" property="og:title" content="Avoid String Concatenation"/> <meta name="twitter:description" property="og:description" content="String concatenation in Java is a bad practice; this article explains why and how to avoid it to create cleaner code "/> <meta name="twitter:url" property="og:url" content="https://www.yegor256.com/2014/06/19/avoid-string-concatenation.html"/> <meta name="telegram:channel" content="AAAAAEJFMRzsRTRxM3ec6A"/> <link rel="search" type="application/opensearchdescription+xml" href="/opensearch.xml" title="yegor256" /> <link rel="shortcut icon" href="/favicon.ico?4e047f6f42b"/> <link rel="apple-touch-icon" href="/favicon.ico?4e047f6f42b"/> <link rel="alternate" type="application/rss+xml" title="RSS for yegor256.com" href="https://www.yegor256.com/rss.xml"/> <link rel="stylesheet" href="/css/layout.css?4e047f6f42b"/> <link rel="stylesheet" href="/css/icons.css?4e047f6f42b"/> <link rel="canonical" href="https://www.yegor256.com/2014/06/19/avoid-string-concatenation.html" /> <link rel="amphtml" href="https://www.yegor256.com/2014/06/19/avoid-string-concatenation.amp.html" /> <title>Avoid String Concatenation </title> </head> <body><div class="wrapper"> <aside class="header-toggle unprintable" id="header-toggle" title="Show the menu" onclick="$('#header').show();$('#header-toggle').hide();">&#9776;</aside> <header class="header" id="header"><div class="face"> <a href="/about-me.html#form" class="sub" title="Click to subscribe to my monthly newsletter"><span>Subscribe</span></a> <a href="/about-me.html" style="position:relative;"> <img src="/images/face-256x256.jpg" class="photo" alt="Yegor Bugayenko"/> </a></div><nav><ul class="menu social notranslate"> <li><a href="https://twitter.com/intent/follow?screen_name=yegor256" rel="nofollow" title="Follow me on Twitter"><i class="icon icon-twitter notranslate" aria-hidden="true"></i></a></li> <li><a href="/rss.xml" rel="nofollow" title="Subscribe to my RSS feed"><i class="icon icon-rss notranslate" aria-hidden="true"></i></a></li> <li><a itemprop="sameAs" href="https://github.com/yegor256" rel="nofollow" title="My GitHub profile"><i class="icon icon-github notranslate" aria-hidden="true"></i></a></li> <li><a itemprop="sameAs" href="http://stackoverflow.com/users/187141/yegor256" rel="nofollow" title="My StackOverflow profile"><i class="icon icon-stackoverflow notranslate" aria-hidden="true"></i></a></li> <li><a itemprop="sameAs" href="https://www.facebook.com/yegor256" rel="nofollow" title="Follow me on Facebook"><i class="icon icon-facebook notranslate" aria-hidden="true"></i></a></li> <li><a itemprop="sameAs" href="https://instagram.com/yegor256" rel="nofollow" title="Follow me on Instagram"><i class="icon icon-instagram notranslate" aria-hidden="true"></i></a></li> <li><a itemprop="sameAs" href="https://www.linkedin.com/in/yegor256" rel="nofollow" title="My LinkedIn profile"><i class="icon icon-linkedin notranslate" aria-hidden="true"></i></a></li> <li><a itemprop="sameAs" href="https://www.youtube.com/c/yegor256?sub_confirmation=1" rel="nofollow" title="My Youtube video channel"><i class="icon icon-youtube notranslate" aria-hidden="true"></i></a></li> <li><a itemprop="sameAs" href="https://www.pinterest.com/yegor256/" rel="nofollow" title="My Pinterest boards"><i class="icon icon-pinterest notranslate" aria-hidden="true"></i></a></li> <li><a itemprop="sameAs" href="https://angel.co/yegor256" rel="nofollow" title="My AngelList profile"><i class="icon icon-angellist notranslate" aria-hidden="true"></i></a></li> <li><a href="https://soundcloud.com/yegor256" rel="nofollow" title="My podcast"><i class="icon icon-podcast notranslate" aria-hidden="true"></i></a></li> <li><a href="https://itunes.apple.com/us/podcast/yegor256-podcast/id1150826721" rel="nofollow" title="My iTunes podcast"><i class="icon icon-itunes notranslate" aria-hidden="true"></i></a></li> <li><a href="https://t.me/joinchat/AAAAAEJFMRzsRTRxM3ec6A" rel="nofollow" title="My Telegram public channel"><i class="icon icon-telegram notranslate" aria-hidden="true"></i></a></li> <li><a href="mailto:blog@yegor256.com" rel="nofollow" title="Email me any time"><i class="icon icon-mail notranslate" aria-hidden="true"></i></a></li></ul><ul class="menu"> <li><a href="/" title="Home page">Home</a></li> <li ><a href="/best.html" title="Best articles to read">12&#160;Best</a></li> <li ><a href="/contents.html" title="The contents of the entire blog">All&#160;288</a></li> <li ><a href="/webinars.html" title="My webinars">Webinars</a></li> <li ><a href="/talks.html" title="Future and past conference talks">Talks</a></li> <li ><a href="/books.html" title="The books I wrote">Books</a></li> <li ><a href="/papers.html" title="My academic papers and patents">Papers</a></li> <li ><a href="/pets.html" title="My loved pet projects">Pets</a></li> <li ><a href="/award.html" title="Software quality award">Award</a></li> <li ><a href="/testimonials.html" title="What some people say about me">Testimonials</a></li> <li ><a href="/shift-m.html" title="Audio podcast about project management">Shift-M</a></li> <li ><a href="/paintings.html" title="My paintings for sale">Paintings</a></li> <li><a href="http://ru.yegor256.com/" title="Немного на русском языке">По-русски</a></li></ul></nav><div class="search"> <form method="get" action="https://www.google.com/search" itemprop="potentialAction" itemscope="" itemtype="http://schema.org/SearchAction"> <meta itemprop="target" content="https://www.google.com/search?q={q}"/> <input name="sitesearch" value="yegor256.com" type="hidden"/> <input itemprop="query-input" type="text" id="search-query" class="field field-text" required="required" onfocus="$('.google').css('visibility', 'visible');" name="q" placeholder="Search..." autocomplete="off"/> <input type="image" src="/images/google-search-icon.svg" class="google" title="Search via Google" alt="Search via Google"/> </form></div><div class="hot"><ul> <li> <a href="/code-ahead.html">Code Ahead</a> was published on Amazon just a few days ago! It is my new book, a novel about programmers. It explains in details the majority of ideas that stand behind <a href="https://www.zerocracy.com">Zerocracy</a> and <a href="https://www.xdsd.org">XDSD</a>. </li> <li> At <a href="/webinars.html">Webinar #37</a> we will discuss naming problem in OOP, for objects, methods and attributes; join us on <b>September 12</b>, at 11am PST. </li></ul></div></header></div><section itemscope="" itemtype="http://schema.org/BlogPosting"><div class="wrapper"> <header><p class="printable"> <img src="https://api.qrserver.com/v1/create-qr-code/?data=https://www.yegor256.com/2014/06/19/avoid-string-concatenation.html&amp;format=svg" style="width:125px;height:125px;" alt="QR code"/></p><p class="printable"> <code itemprop="url">https://www.yegor256.com/2014/06/19/avoid-string-concatenation.html</code></p><h1 itemprop="name headline mainEntityOfPage">Avoid String Concatenation</h1><ul class="subline"> <li> <time itemprop="datePublished" datetime="2014-06-19T00:00:00+00:00"> 19 June 2014 </time> </li> <li class="printable" itemscope="" itemprop="author" itemtype="http://schema.org/Person"> <span itemprop="name">Yegor Bugayenko</span> </li> <li class="unprintable"> <i class="icon icon-comments"></i> <a href="http://www.yegor256.com/2014/06/19/avoid-string-concatenation.html#disqus_thread" itemprop="discussionUrl">comments</a> </li></ul><p>Actually, I don&#39;t think performance in this case is a big issue. Moreover, there were <a href="http://stackoverflow.com/questions/925423">multiple experiments</a> showing that concatenation is not that slow when compared to other string building methods and sometimes is even faster.</p><p>Some say that concatenated strings are not localizable because in different languages text blocks in a phrase may be positioned in a different order. The example above can&#39;t be translated to, say, Russian, where we would want to put a name in front of &quot;привет.&quot; We will need to localize the entire block of code, instead of just translating a phrase.</p><p>However, my point here is different. I strongly recommend avoiding string concatenation because it is <strong>less readable</strong> than other methods of joining texts together.</p><p>Let&#39;s see these alternative methods. I&#39;d recommend three of them (in order of preference): <code>String.format()</code>, Apache <code>StringUtils</code> and Guava <code>Joiner</code>.</p><p>There is also a <a href="http://docs.oracle.com/javase/7/docs/api/java/lang/StringBuilder.html"><code>StringBuilder</code></a>, but I don&#39;t find it as attractive as <code>StringUtils</code>. It is a useful builder of strings, but not a proper replacer or string concatenation tool when readability is important.</p><h2 id="string-format">String.format()</h2><p><a href="http://docs.oracle.com/javase/7/docs/api/java/lang/String.html#format%28java.lang.String,%20java.lang.Object...%29"><code>String.format()</code></a> is my favorite option. It makes text phrases easy to understand and modify. It is a static utility method that mirrors <a href="http://www.cplusplus.com/reference/cstdio/sprintf/"><code>sprintf()</code></a> from C. It allows you to build a string using a pattern and substitutors:</p><figure class="highlight"><pre><code class="language-java" data-lang="java"><span></span><span class="n">String</span> <span class="n">text</span> <span class="o">=</span> <span class="n">String</span><span class="o">.</span><span class="na">format</span><span class="o">(</span><span class="s">&quot;Hello, %s!&quot;</span><span class="o">,</span> <span class="n">name</span><span class="o">);</span></code></pre></figure><p>When the text is longer, the advantages of the formatter become much more obvious. Look at this ugly code:</p><figure class="highlight"><pre><code class="language-java" data-lang="java"><span></span><span class="n">String</span> <span class="n">msg</span> <span class="o">=</span> <span class="s">&quot;Dear &quot;</span> <span class="o">+</span> <span class="n">customer</span><span class="o">.</span><span class="na">name</span><span class="o">()</span>
  <span class="o">+</span> <span class="s">&quot;, your order #&quot;</span> <span class="o">+</span> <span class="n">order</span><span class="o">.</span><span class="na">number</span><span class="o">()</span>
  <span class="o">+</span> <span class="s">&quot; has been shipped at &quot;</span> <span class="o">+</span> <span class="n">shipment</span><span class="o">.</span><span class="na">date</span><span class="o">()</span>
  <span class="o">+</span> <span class="s">&quot;!&quot;</span><span class="o">;</span></code></pre></figure><p>This one looks much more beautiful doesn&#39;t it:</p><figure class="highlight"><pre><code class="language-java" data-lang="java"><span></span><span class="n">String</span> <span class="n">msg</span> <span class="o">=</span> <span class="n">String</span><span class="o">.</span><span class="na">format</span><span class="o">(</span>
  <span class="s">&quot;Dear %1$s, your order #%2$d has been shipped at %3$tR!&quot;</span><span class="o">,</span>
  <span class="n">customer</span><span class="o">.</span><span class="na">name</span><span class="o">(),</span> <span class="n">order</span><span class="o">.</span><span class="na">number</span><span class="o">(),</span> <span class="n">shipment</span><span class="o">.</span><span class="na">date</span><span class="o">()</span>
<span class="o">);</span></code></pre></figure><p>Please note that I&#39;m using argument indexes in order to make the pattern even more localizable. Let&#39;s say, I want to translate it to Greek. This is how will it look:</p><figure class="highlight"><pre><code class="language-text" data-lang="text"><span></span>Αγαπητέ %1$s, στις %3$tR στείλαμε την παραγγελία σου με αριθμό #%2$d!</code></pre></figure><p>I&#39;m changing the order of substitutions in the pattern, but not in the actual list of methods arguments.</p><h2 id="apache-stringutils-join">Apache <code>StringUtils.join()</code></h2><p>When the text is rather long (longer than your screen width), I would recommend that you use the utility class <a href="http://commons.apache.org/proper/commons-lang/javadocs/api-2.6/org/apache/commons/lang/StringUtils.html"><code>StringUtils</code></a> from Apache <a href="http://commons.apache.org/proper/commons-lang/">commons-lang3</a>:</p><figure class="highlight"><pre><code class="language-java" data-lang="java"><span></span><span class="kn">import</span> <span class="nn">org.apache.commons.lang3.StringUtils</span><span class="o">;</span>
<span class="n">String</span> <span class="n">xml</span> <span class="o">=</span> <span class="n">StringUtils</span><span class="o">.</span><span class="na">join</span><span class="o">(</span>
  <span class="s">&quot;&lt;?xml version=&#39;1.0&#39;?&gt;&quot;</span><span class="o">,</span>
  <span class="s">&quot;&lt;html&gt;&lt;body&gt;&quot;</span><span class="o">,</span>
  <span class="s">&quot;&lt;p&gt;This is a test XHTML document,&quot;</span><span class="o">,</span>
  <span class="s">&quot; which would look ugly,&quot;</span><span class="o">,</span>
  <span class="s">&quot; if we would use a single line,&quot;</span>
  <span class="s">&quot; or string concatenation or String format().&lt;/p&gt;&quot;</span>
  <span class="s">&quot;&lt;/body&gt;&lt;/html&gt;&quot;</span>
<span class="o">);</span></code></pre></figure><p>The need to include an additional JAR dependency to your classpath may be considered a downside with this method (get its latest versions in <a href="http://search.maven.org/">Maven Central</a>):</p><figure class="highlight"><pre><code class="language-xml" data-lang="xml"><span></span><span class="nt">&lt;dependency&gt;</span>
  <span class="nt">&lt;groupId&gt;</span>org.apache.commons<span class="nt">&lt;/groupId&gt;</span>
  <span class="nt">&lt;artifactId&gt;</span>commons-lang3<span class="nt">&lt;/artifactId&gt;</span>
<span class="nt">&lt;/dependency&gt;</span></code></pre></figure><h2 id="guava-joiner">Guava Joiner</h2><p>Similar functionality is provided by <a href="http://google.github.io/guava/releases/16.0/api/docs/com/google/common/base/Joiner.html"><code>Joiner</code></a> from Google <a href="https://code.google.com/p/guava-libraries/">Guava</a>:</p><figure class="highlight"><pre><code class="language-java" data-lang="java"><span></span><span class="kn">import</span> <span class="nn">com.google.common.base.Joiner</span><span class="o">;</span>
<span class="n">String</span> <span class="n">text</span> <span class="o">=</span> <span class="n">Joiner</span><span class="o">.</span><span class="na">on</span><span class="o">(</span><span class="err">&#39;&#39;</span><span class="o">).</span><span class="na">join</span><span class="o">(</span>
  <span class="s">&quot;WE HAVE BUNNY.\n&quot;</span><span class="o">,</span>
  <span class="s">&quot;GATHER ONE MILLION DOLLARS IN UNMARKED &quot;</span><span class="o">,</span>
  <span class="s">&quot;NON-CONSECUTIVE TWENTIES.\n&quot;</span><span class="o">,</span>
  <span class="s">&quot;AWAIT INSTRUCTIONS.\n&quot;</span><span class="o">,</span>
  <span class="s">&quot;NO FUNNY STUFF&quot;</span>
<span class="o">);</span></code></pre></figure><p>It is a bit less convenient than <code>StringUtils</code> since you always have to provide a joiner (character or a string placed between text blocks).</p><p>Again, a dependency is required in this case:</p><figure class="highlight"><pre><code class="language-xml" data-lang="xml"><span></span><span class="nt">&lt;dependency&gt;</span>
  <span class="nt">&lt;groupId&gt;</span>com.google.guava<span class="nt">&lt;/groupId&gt;</span>
  <span class="nt">&lt;artifactId&gt;</span>guava<span class="nt">&lt;/artifactId&gt;</span>
<span class="nt">&lt;/dependency&gt;</span></code></pre></figure><p>Yes, in most cases, all of these methods work slower than a plain simple concatenation. However, I strongly believe that <strong>computers are cheaper than people</strong>. What I mean is that the time spent by programmers understanding and modifying ugly code is much more expensive than a cost of an additional server that will make beautifully written code work faster.</p><p>If you know any other methods of avoiding string concatenation, please comment below.</p></p>--> <nav class="buttons notranslate desktop-only"> <a href="http://www.facebook.com/sharer/sharer.php?u=https://www.yegor256.com/2014/06/19/avoid-string-concatenation.html" title="Share on Facebook" class="button" rel="nofollow"> <span class="count count-facebook">0</span> <i class="icon icon-facebook notranslate" aria-hidden="true"></i> </a> <a href="https://twitter.com/share?url=https://www.yegor256.com/2014/06/19/avoid-string-concatenation.html&amp;text=Avoid+String+Concatenation" title="Share on Twitter" class="button" rel="nofollow"> <span class="count count-twitter">0</span> <i class="icon icon-twitter notranslate" aria-hidden="true"></i> </a> <a href="https://plus.google.com/share?url=https://www.yegor256.com/2014/06/19/avoid-string-concatenation.html" title="Share on Google+" class="button" rel="nofollow"> <span class="count count-googleplus">0</span> <i class="icon icon-googleplus notranslate" aria-hidden="true"></i> </a> <a href="https://www.linkedin.com/cws/share?url=https://www.yegor256.com/2014/06/19/avoid-string-concatenation.html" title="Share on LinkedIn" class="button" rel="nofollow"> <span class="count count-linkedin">0</span> <i class="icon icon-linkedin notranslate" aria-hidden="true"></i> </a> <a href="http://reddit.com/submit?url=https://www.yegor256.com/2014/06/19/avoid-string-concatenation.html%3F2014-24&amp;title=Avoid+String+Concatenation" title="Share on Reddit" class="button" rel="nofollow"> <span class="count count-reddit">0</span> <i class="icon icon-reddit notranslate" aria-hidden="true"></i> </a> <a href="http://news.ycombinator.com/submitlink?u=https://www.yegor256.com/2014/06/19/avoid-string-concatenation.html%3F2014-24&amp;t=Avoid+String+Concatenation" title="Share on Hacker News" class="button" rel="nofollow"> <span class="count count-hackernews">0</span> <i class="icon icon-hackernews notranslate" aria-hidden="true"></i> </a> </nav> </header> <article class="main" itemprop="articleBody"><div ><p>This is &quot;string concatenation,&quot; and it is a bad practice:</p><figure class="highlight"><pre><code class="language-java" data-lang="java"><span></span><span class="c1">// bad practice, don&#39;t reuse!</span>
<span class="n">String</span> <span class="n">text</span> <span class="o">=</span> <span class="s">&quot;Hello, &quot;</span> <span class="o">+</span> <span class="n">name</span> <span class="o">+</span> <span class="s">&quot;!&quot;</span><span class="o">;</span></code></pre></figure><p>Why? Some may say that it is slow, mostly because parts of the resulting string are copied multiple times. Indeed, on every <code>+</code> operator, <code>String</code> class allocates a new block in memory and copies everything it has into it; plus a suffix being concatenated. This is true, but this is not the point here.</p><p>Actually, I don&#39;t think performance in this case is a big issue. Moreover, there were <a href="http://stackoverflow.com/questions/925423">multiple experiments</a> showing that concatenation is not that slow when compared to other string building methods and sometimes is even faster.</p><p>Some say that concatenated strings are not localizable because in different languages text blocks in a phrase may be positioned in a different order. The example above can&#39;t be translated to, say, Russian, where we would want to put a name in front of &quot;привет.&quot; We will need to localize the entire block of code, instead of just translating a phrase.</p><p>However, my point here is different. I strongly recommend avoiding string concatenation because it is <strong>less readable</strong> than other methods of joining texts together.</p><p>Let&#39;s see these alternative methods. I&#39;d recommend three of them (in order of preference): <code>String.format()</code>, Apache <code>StringUtils</code> and Guava <code>Joiner</code>.</p><p>There is also a <a href="http://docs.oracle.com/javase/7/docs/api/java/lang/StringBuilder.html"><code>StringBuilder</code></a>, but I don&#39;t find it as attractive as <code>StringUtils</code>. It is a useful builder of strings, but not a proper replacer or string concatenation tool when readability is important.</p><h2 id="string-format">String.format()</h2><p><a href="http://docs.oracle.com/javase/7/docs/api/java/lang/String.html#format%28java.lang.String,%20java.lang.Object...%29"><code>String.format()</code></a> is my favorite option. It makes text phrases easy to understand and modify. It is a static utility method that mirrors <a href="http://www.cplusplus.com/reference/cstdio/sprintf/"><code>sprintf()</code></a> from C. It allows you to build a string using a pattern and substitutors:</p><figure class="highlight"><pre><code class="language-java" data-lang="java"><span></span><span class="n">String</span> <span class="n">text</span> <span class="o">=</span> <span class="n">String</span><span class="o">.</span><span class="na">format</span><span class="o">(</span><span class="s">&quot;Hello, %s!&quot;</span><span class="o">,</span> <span class="n">name</span><span class="o">);</span></code></pre></figure><p>When the text is longer, the advantages of the formatter become much more obvious. Look at this ugly code:</p><figure class="highlight"><pre><code class="language-java" data-lang="java"><span></span><span class="n">String</span> <span class="n">msg</span> <span class="o">=</span> <span class="s">&quot;Dear &quot;</span> <span class="o">+</span> <span class="n">customer</span><span class="o">.</span><span class="na">name</span><span class="o">()</span>
  <span class="o">+</span> <span class="s">&quot;, your order #&quot;</span> <span class="o">+</span> <span class="n">order</span><span class="o">.</span><span class="na">number</span><span class="o">()</span>
  <span class="o">+</span> <span class="s">&quot; has been shipped at &quot;</span> <span class="o">+</span> <span class="n">shipment</span><span class="o">.</span><span class="na">date</span><span class="o">()</span>
  <span class="o">+</span> <span class="s">&quot;!&quot;</span><span class="o">;</span></code></pre></figure><p>This one looks much more beautiful doesn&#39;t it:</p><figure class="highlight"><pre><code class="language-java" data-lang="java"><span></span><span class="n">String</span> <span class="n">msg</span> <span class="o">=</span> <span class="n">String</span><span class="o">.</span><span class="na">format</span><span class="o">(</span>
  <span class="s">&quot;Dear %1$s, your order #%2$d has been shipped at %3$tR!&quot;</span><span class="o">,</span>
  <span class="n">customer</span><span class="o">.</span><span class="na">name</span><span class="o">(),</span> <span class="n">order</span><span class="o">.</span><span class="na">number</span><span class="o">(),</span> <span class="n">shipment</span><span class="o">.</span><span class="na">date</span><span class="o">()</span>
<span class="o">);</span></code></pre></figure><p>Please note that I&#39;m using argument indexes in order to make the pattern even more localizable. Let&#39;s say, I want to translate it to Greek. This is how will it look:</p><figure class="highlight"><pre><code class="language-text" data-lang="text"><span></span>Αγαπητέ %1$s, στις %3$tR στείλαμε την παραγγελία σου με αριθμό #%2$d!</code></pre></figure><p>I&#39;m changing the order of substitutions in the pattern, but not in the actual list of methods arguments.</p><h2 id="apache-stringutils-join">Apache <code>StringUtils.join()</code></h2><p>When the text is rather long (longer than your screen width), I would recommend that you use the utility class <a href="http://commons.apache.org/proper/commons-lang/javadocs/api-2.6/org/apache/commons/lang/StringUtils.html"><code>StringUtils</code></a> from Apache <a href="http://commons.apache.org/proper/commons-lang/">commons-lang3</a>:</p><figure class="highlight"><pre><code class="language-java" data-lang="java"><span></span><span class="kn">import</span> <span class="nn">org.apache.commons.lang3.StringUtils</span><span class="o">;</span>
<span class="n">String</span> <span class="n">xml</span> <span class="o">=</span> <span class="n">StringUtils</span><span class="o">.</span><span class="na">join</span><span class="o">(</span>
  <span class="s">&quot;&lt;?xml version=&#39;1.0&#39;?&gt;&quot;</span><span class="o">,</span>
  <span class="s">&quot;&lt;html&gt;&lt;body&gt;&quot;</span><span class="o">,</span>
  <span class="s">&quot;&lt;p&gt;This is a test XHTML document,&quot;</span><span class="o">,</span>
  <span class="s">&quot; which would look ugly,&quot;</span><span class="o">,</span>
  <span class="s">&quot; if we would use a single line,&quot;</span>
  <span class="s">&quot; or string concatenation or String format().&lt;/p&gt;&quot;</span>
  <span class="s">&quot;&lt;/body&gt;&lt;/html&gt;&quot;</span>
<span class="o">);</span></code></pre></figure><p>The need to include an additional JAR dependency to your classpath may be considered a downside with this method (get its latest versions in <a href="http://search.maven.org/">Maven Central</a>):</p><figure class="highlight"><pre><code class="language-xml" data-lang="xml"><span></span><span class="nt">&lt;dependency&gt;</span>
  <span class="nt">&lt;groupId&gt;</span>org.apache.commons<span class="nt">&lt;/groupId&gt;</span>
  <span class="nt">&lt;artifactId&gt;</span>commons-lang3<span class="nt">&lt;/artifactId&gt;</span>
<span class="nt">&lt;/dependency&gt;</span></code></pre></figure><h2 id="guava-joiner">Guava Joiner</h2><p>Similar functionality is provided by <a href="http://google.github.io/guava/releases/16.0/api/docs/com/google/common/base/Joiner.html"><code>Joiner</code></a> from Google <a href="https://code.google.com/p/guava-libraries/">Guava</a>:</p><figure class="highlight"><pre><code class="language-java" data-lang="java"><span></span><span class="kn">import</span> <span class="nn">com.google.common.base.Joiner</span><span class="o">;</span>
<span class="n">String</span> <span class="n">text</span> <span class="o">=</span> <span class="n">Joiner</span><span class="o">.</span><span class="na">on</span><span class="o">(</span><span class="err">&#39;&#39;</span><span class="o">).</span><span class="na">join</span><span class="o">(</span>
  <span class="s">&quot;WE HAVE BUNNY.\n&quot;</span><span class="o">,</span>
  <span class="s">&quot;GATHER ONE MILLION DOLLARS IN UNMARKED &quot;</span><span class="o">,</span>
  <span class="s">&quot;NON-CONSECUTIVE TWENTIES.\n&quot;</span><span class="o">,</span>
  <span class="s">&quot;AWAIT INSTRUCTIONS.\n&quot;</span><span class="o">,</span>
  <span class="s">&quot;NO FUNNY STUFF&quot;</span>
<span class="o">);</span></code></pre></figure><p>It is a bit less convenient than <code>StringUtils</code> since you always have to provide a joiner (character or a string placed between text blocks).</p><p>Again, a dependency is required in this case:</p><figure class="highlight"><pre><code class="language-xml" data-lang="xml"><span></span><span class="nt">&lt;dependency&gt;</span>
  <span class="nt">&lt;groupId&gt;</span>com.google.guava<span class="nt">&lt;/groupId&gt;</span>
  <span class="nt">&lt;artifactId&gt;</span>guava<span class="nt">&lt;/artifactId&gt;</span>
<span class="nt">&lt;/dependency&gt;</span></code></pre></figure><p>Yes, in most cases, all of these methods work slower than a plain simple concatenation. However, I strongly believe that <strong>computers are cheaper than people</strong>. What I mean is that the time spent by programmers understanding and modifying ugly code is much more expensive than a cost of an additional server that will make beautifully written code work faster.</p><p>If you know any other methods of avoiding string concatenation, please comment below.</p></div></article></div><div class="wrapper"> <related-posts /></div><div class="disqus" role="complementary"><p class="disqus_hint"> Please, use <a href="https://help.disqus.com/commenting/what-html-tags-are-allowed-within-comments">syntax highlighting</a> in your comments, to make them more readable.</p><div id="disqus_thread" class="disqus-thread"> <a>&nbsp;</a></div><script> var disqus_config = function () { this.page.url = document.location.href.split('?')[0].split('#')[0].replace('https://', 'http://'); this.page.identifier = this.page.url; }; (function() { var d = document, s = d.createElement('script'); s.src = '//yegor256.disqus.com/embed.js'; s.setAttribute('data-timestamp', +new Date()); (d.head || d.body).appendChild(s); })(); </script> <noscript><div><p class="red"> JavaScript is disabled in your browser, that's why you can't see comments under this post.</p></div></noscript></div><div class="wrapper"> <footer class="footer"><p> &copy; <span itemscope="" itemprop="copyrightHolder" itemtype="http://schema.org/Person"> <span itemprop="name">Yegor Bugayenko</span> </span> 2014&ndash;<span itemprop="copyrightYear">2018</span></p></footer></div></section><div class="wrapper unprintable" style="text-align:center;margin-top:2em;"> <a href="http://www.sixnines.io/h/3ba1652f"> <img src="//www.sixnines.io/b/3ba1652f?style=flat" alt="sixnines availability badge"/> </a></div><script src="//code.jquery.com/jquery-1.9.0.min.js"></script> <script src="/js/all.js?4e047f6f42b"></script> <script>var disqus_shortname = 'yegor256';</script> <script id="dsq-count-scr" src="//yegor256.disqus.com/count.js" async="async"></script> <script> (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){ (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o), m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m) })(window,document,'script','//www.google-analytics.com/analytics.js','ga'); ga('create', 'UA-1963507-32', 'auto'); ga('send', 'pageview'); </script> <script> Cd=document;Cr="&"+Math.random();Cp="&s=1"; Cd.cookie="b=b";if(Cd.cookie)Cp+="&c=1"; Cp+="&t="+(new Date()).getTimezoneOffset(); if(self!=top)Cp+="&f=1"; </script> <script> if(navigator.javaEnabled())Cp+="&j=1"; </script> <script> if(typeof(screen)!='undefined')Cp+="&w="+screen.width+"&h="+ screen.height+"&d="+(screen.colorDepth?screen.colorDepth:screen.pixelDepth); </script> <script> Cd.write("<img src='//c.hit.ua/hit?i=95870&g=0&x=2"+Cp+Cr+ "&r="+escape(Cd.referrer)+"&u="+escape(window.location.href)+ "' border='0' wi"+"dth='1' he"+"ight='1'/>"); </script> <script type="application/ld+json"> { "@context": "http://schema.org", "@type": "Person", "name": "Yegor Bugayenko", "url": "http://www.yegor256.com", "sameAs": [ "https://www.facebook.com/yegor256", "https://instagram.com/yegor256", "https://www.linkedin.com/in/yegor256", "https://twitter.com/yegor256", "https://github.com/yegor256", "https://www.pinterest.com/yegor256/" ] } </script> </body> </html> <!DOCTYPE html> <html xmlns="http://www.w3.org/1999/xhtml" lang="en-US" xml:lang="en-US" itemscope="" itemtype="http://schema.org/WebSite"> <head> <meta charset="utf-8"/> <meta name="description" content="For traceability and debugging purposes, it can be very convenient to log execution details of every method. This article explains how this can be done with AspectJ and Java annotations. " /> <meta name="keywords" content="aop annotations, aop java logging, aop logging annotations, aop logging java, aspect oriented programming java, aspectj logging, aspectj weaving annotations" /> <meta name="viewport" content="width=device-width,minimum-scale=1,initial-scale=1"/> <meta name="google-site-verification" content="JEj_gQr2CPe2QKGw8XdMz0R7VboQIUbX3FlM-lwTq-8" /> <meta name="author" content="Yegor Bugayenko"> <meta name="article:published_time" content="2014-06-01 00:00:00 +0000"> <meta name="og:site_name" content="Yegor Bugayenko"/> <meta name="og:type" content="article" /> <meta name="og:locale" content="en_US" /> <meta name="twitter:account_id" content="4503599630178231" /> <meta name="twitter:creator" content="@yegor256"/> <meta name="twitter:site" content="@yegor256"/> <meta name="twitter:title" property="og:title" content="Java Method Logging with AOP and Annotations"/> <meta name="twitter:description" property="og:description" content="For traceability and debugging purposes, it can be very convenient to log execution details of every method. This article explains how this can be done with AspectJ and Java annotations. "/> <meta name="twitter:url" property="og:url" content="https://www.yegor256.com/2014/06/01/aop-aspectj-java-method-logging.html"/> <meta name="telegram:channel" content="AAAAAEJFMRzsRTRxM3ec6A"/> <link rel="search" type="application/opensearchdescription+xml" href="/opensearch.xml" title="yegor256" /> <link rel="shortcut icon" href="/favicon.ico?4e047f6f42b"/> <link rel="apple-touch-icon" href="/favicon.ico?4e047f6f42b"/> <link rel="alternate" type="application/rss+xml" title="RSS for yegor256.com" href="https://www.yegor256.com/rss.xml"/> <link rel="stylesheet" href="/css/layout.css?4e047f6f42b"/> <link rel="stylesheet" href="/css/icons.css?4e047f6f42b"/> <link rel="canonical" href="https://www.yegor256.com/2014/06/01/aop-aspectj-java-method-logging.html" /> <link rel="amphtml" href="https://www.yegor256.com/2014/06/01/aop-aspectj-java-method-logging.amp.html" /> <title>Java Method Logging with AOP and Annotations </title> </head> <body><div class="wrapper"> <aside class="header-toggle unprintable" id="header-toggle" title="Show the menu" onclick="$('#header').show();$('#header-toggle').hide();">&#9776;</aside> <header class="header" id="header"><div class="face"> <a href="/about-me.html#form" class="sub" title="Click to subscribe to my monthly newsletter"><span>Subscribe</span></a> <a href="/about-me.html" style="position:relative;"> <img src="/images/face-256x256.jpg" class="photo" alt="Yegor Bugayenko"/> </a></div><nav><ul class="menu social notranslate"> <li><a href="https://twitter.com/intent/follow?screen_name=yegor256" rel="nofollow" title="Follow me on Twitter"><i class="icon icon-twitter notranslate" aria-hidden="true"></i></a></li> <li><a href="/rss.xml" rel="nofollow" title="Subscribe to my RSS feed"><i class="icon icon-rss notranslate" aria-hidden="true"></i></a></li> <li><a itemprop="sameAs" href="https://github.com/yegor256" rel="nofollow" title="My GitHub profile"><i class="icon icon-github notranslate" aria-hidden="true"></i></a></li> <li><a itemprop="sameAs" href="http://stackoverflow.com/users/187141/yegor256" rel="nofollow" title="My StackOverflow profile"><i class="icon icon-stackoverflow notranslate" aria-hidden="true"></i></a></li> <li><a itemprop="sameAs" href="https://www.facebook.com/yegor256" rel="nofollow" title="Follow me on Facebook"><i class="icon icon-facebook notranslate" aria-hidden="true"></i></a></li> <li><a itemprop="sameAs" href="https://instagram.com/yegor256" rel="nofollow" title="Follow me on Instagram"><i class="icon icon-instagram notranslate" aria-hidden="true"></i></a></li> <li><a itemprop="sameAs" href="https://www.linkedin.com/in/yegor256" rel="nofollow" title="My LinkedIn profile"><i class="icon icon-linkedin notranslate" aria-hidden="true"></i></a></li> <li><a itemprop="sameAs" href="https://www.youtube.com/c/yegor256?sub_confirmation=1" rel="nofollow" title="My Youtube video channel"><i class="icon icon-youtube notranslate" aria-hidden="true"></i></a></li> <li><a itemprop="sameAs" href="https://www.pinterest.com/yegor256/" rel="nofollow" title="My Pinterest boards"><i class="icon icon-pinterest notranslate" aria-hidden="true"></i></a></li> <li><a itemprop="sameAs" href="https://angel.co/yegor256" rel="nofollow" title="My AngelList profile"><i class="icon icon-angellist notranslate" aria-hidden="true"></i></a></li> <li><a href="https://soundcloud.com/yegor256" rel="nofollow" title="My podcast"><i class="icon icon-podcast notranslate" aria-hidden="true"></i></a></li> <li><a href="https://itunes.apple.com/us/podcast/yegor256-podcast/id1150826721" rel="nofollow" title="My iTunes podcast"><i class="icon icon-itunes notranslate" aria-hidden="true"></i></a></li> <li><a href="https://t.me/joinchat/AAAAAEJFMRzsRTRxM3ec6A" rel="nofollow" title="My Telegram public channel"><i class="icon icon-telegram notranslate" aria-hidden="true"></i></a></li> <li><a href="mailto:blog@yegor256.com" rel="nofollow" title="Email me any time"><i class="icon icon-mail notranslate" aria-hidden="true"></i></a></li></ul><ul class="menu"> <li><a href="/" title="Home page">Home</a></li> <li ><a href="/best.html" title="Best articles to read">12&#160;Best</a></li> <li ><a href="/contents.html" title="The contents of the entire blog">All&#160;288</a></li> <li ><a href="/webinars.html" title="My webinars">Webinars</a></li> <li ><a href="/talks.html" title="Future and past conference talks">Talks</a></li> <li ><a href="/books.html" title="The books I wrote">Books</a></li> <li ><a href="/papers.html" title="My academic papers and patents">Papers</a></li> <li ><a href="/pets.html" title="My loved pet projects">Pets</a></li> <li ><a href="/award.html" title="Software quality award">Award</a></li> <li ><a href="/testimonials.html" title="What some people say about me">Testimonials</a></li> <li ><a href="/shift-m.html" title="Audio podcast about project management">Shift-M</a></li> <li ><a href="/paintings.html" title="My paintings for sale">Paintings</a></li> <li><a href="http://ru.yegor256.com/" title="Немного на русском языке">По-русски</a></li></ul></nav><div class="search"> <form method="get" action="https://www.google.com/search" itemprop="potentialAction" itemscope="" itemtype="http://schema.org/SearchAction"> <meta itemprop="target" content="https://www.google.com/search?q={q}"/> <input name="sitesearch" value="yegor256.com" type="hidden"/> <input itemprop="query-input" type="text" id="search-query" class="field field-text" required="required" onfocus="$('.google').css('visibility', 'visible');" name="q" placeholder="Search..." autocomplete="off"/> <input type="image" src="/images/google-search-icon.svg" class="google" title="Search via Google" alt="Search via Google"/> </form></div><div class="hot"><ul> <li> <a href="/code-ahead.html">Code Ahead</a> was published on Amazon just a few days ago! It is my new book, a novel about programmers. It explains in details the majority of ideas that stand behind <a href="https://www.zerocracy.com">Zerocracy</a> and <a href="https://www.xdsd.org">XDSD</a>. </li> <li> At <a href="/webinars.html">Webinar #37</a> we will discuss naming problem in OOP, for objects, methods and attributes; join us on <b>September 12</b>, at 11am PST. </li></ul></div></header></div><section itemscope="" itemtype="http://schema.org/BlogPosting"><div class="wrapper"> <header><p class="printable"> <img src="https://api.qrserver.com/v1/create-qr-code/?data=https://www.yegor256.com/2014/06/01/aop-aspectj-java-method-logging.html&amp;format=svg" style="width:125px;height:125px;" alt="QR code"/></p><p class="printable"> <code itemprop="url">https://www.yegor256.com/2014/06/01/aop-aspectj-java-method-logging.html</code></p><h1 itemprop="name headline mainEntityOfPage">Java Method Logging with AOP and Annotations</h1><ul class="subline"> <li> <time itemprop="datePublished" datetime="2014-06-01T00:00:00+00:00"> 1 June 2014 </time> </li> <li class="printable" itemscope="" itemprop="author" itemtype="http://schema.org/Person"> <span itemprop="name">Yegor Bugayenko</span> </li> <li class="unprintable"> <i class="icon icon-comments"></i> <a href="http://www.yegor256.com/2014/06/01/aop-aspectj-java-method-logging.html#disqus_thread" itemprop="discussionUrl">comments</a> </li></ul><h2 id="annotation-with-runtime-retention">Annotation with Runtime Retention</h2><p><a href="http://en.wikipedia.org/wiki/Java_annotation">Annotations</a> is a technique introduced in Java 6. It is a meta-programming instrument that doesn&#39;t change the way code works, but gives marks to certain elements (methods, classes or variables). In other words, annotations are just markers attached to the code that can be seen and read. Some annotations are designed to be seen at compile time only---they don&#39;t exist in <code>.class</code> files after compilation. Others remain visible after compilation and can be accessed in runtime.</p><aside class='youtube'> <a href='https://www.youtube.com/watch?v=4SRoLYxvIQ8'><div class='box'> <img src='https://i.ytimg.com/vi/4SRoLYxvIQ8/mqdefault.jpg' alt='YouTube video #4SRoLYxvIQ8'/><div class='play'><i class='icon icon-play'></i></div></div></a><div>Practical Example of AOP with AspectJ (in Russian with English subtitles); 28 October 2016.</div></aside><p>For example, <a href="http://docs.oracle.com/javase/7/docs/api/java/lang/Override.html"><code>@Override</code></a> is of the first type (its retention type is <a href="http://docs.oracle.com/javase/7/docs/api/java/lang/annotation/RetentionPolicy.html#SOURCE"><code>SOURCE</code></a>), while <a href="http://junit.sourceforge.net/javadoc/org/junit/Test.html"><code>@Test</code></a> from JUnit is of the second type (retention type is <a href="http://docs.oracle.com/javase/7/docs/api/java/lang/annotation/RetentionPolicy.html#RUNTIME"><code>RUNTIME</code></a>). <a href="http://aspects.jcabi.com/apidocs-0.15.1/com/jcabi/aspects/Loggable.html"><code>@Loggable</code></a>---the one I&#39;m using in the script above---is an annotation of the second type, from <a href="http://aspects.jcabi.com">jcabi-aspects</a>. It stays with the byte-code in the <code>.class</code> file after compilation.</p><p>Again, it is important to understand that even though method <code>power()</code> is annotated and compiled, it doesn&#39;t send anything to slf4j so far. It just contains a marker saying &quot;please, log my execution.&quot;</p><h2 id="aspect-oriented-programming-aop">Aspect Oriented Programming (AOP)</h2><p><a href="http://en.wikipedia.org/wiki/Aspect-oriented_programming">AOP</a> is a useful technique that enables adding executable blocks to the source code without explicitly changing it. In our example, we don&#39;t want to log method execution inside the class. Instead, we want some other class to intercept every call to method <code>power()</code>, measure its execution time and send this information to slf4j.</p><p>We want that interceptor to understand our <code>@Loggable</code> annotation and log every call to that specific method <code>power()</code>. And, of course, the same interceptor should be used for other methods where we&#39;ll place the same annotation in the future.</p><p>This case perfectly fits the original intent of AOP---to avoid re-implementation of some common behavior in multiple classes.</p><p>Logging is a supplementary feature to our main functionality, and we don&#39;t want to pollute our code with multiple logging instructions. Instead, we want <a href="/2014/05/23/avoid-java-static-logger.html">logging</a> to happen behind the scenes.</p><p>In terms of AOP, our solution can be explained as creating an <strong>aspect</strong> that <strong>cross-cuts</strong> the code at certain <strong>join points</strong> and applies an <strong>around advice</strong> that implements the desired functionality.</p><h2 id="aspectj">AspectJ</h2><p>Let&#39;s see what these magic words mean. But, first, let&#39;s see how <a href="http://aspects.jcabi.com">jcabi-aspects</a> implements them using <a href="http://eclipse.org/aspectj/">AspectJ</a> (it&#39;s a simplified example, full code you can find in <a href="https://github.com/jcabi/jcabi-aspects/blob/jcabi-0.15.2/src/main/java/com/jcabi/aspects/aj/MethodLogger.java"><code>MethodLogger.java</code></a>):</p><figure class="highlight"><pre><code class="language-java" data-lang="java"><span></span><span class="nd">@Aspect</span>
<span class="kd">public</span> <span class="kd">class</span> <span class="nc">MethodLogger</span> <span class="o">{</span>
  <span class="nd">@Around</span><span class="o">(</span><span class="s">&quot;execution(* *(..)) &amp;&amp; @annotation(Loggable)&quot;</span><span class="o">)</span>
  <span class="kd">public</span> <span class="n">Object</span> <span class="nf">around</span><span class="o">(</span><span class="n">ProceedingJoinPoint</span> <span class="n">point</span><span class="o">)</span> <span class="o">{</span>
    <span class="kt">long</span> <span class="n">start</span> <span class="o">=</span> <span class="n">System</span><span class="o">.</span><span class="na">currentTimeMillis</span><span class="o">();</span>
    <span class="n">Object</span> <span class="n">result</span> <span class="o">=</span> <span class="n">point</span><span class="o">.</span><span class="na">proceed</span><span class="o">();</span>
    <span class="n">Logger</span><span class="o">.</span><span class="na">info</span><span class="o">(</span>
      <span class="s">&quot;#%s(%s): %s in %[msec]s&quot;</span><span class="o">,</span>
      <span class="n">MethodSignature</span><span class="o">.</span><span class="na">class</span><span class="o">.</span><span class="na">cast</span><span class="o">(</span><span class="n">point</span><span class="o">.</span><span class="na">getSignature</span><span class="o">()).</span><span class="na">getMethod</span><span class="o">().</span><span class="na">getName</span><span class="o">(),</span>
      <span class="n">point</span><span class="o">.</span><span class="na">getArgs</span><span class="o">(),</span>
      <span class="n">result</span><span class="o">,</span>
      <span class="n">System</span><span class="o">.</span><span class="na">currentTimeMillis</span><span class="o">()</span> <span class="o">-</span> <span class="n">start</span>
    <span class="o">);</span>
    <span class="k">return</span> <span class="n">result</span><span class="o">;</span>
  <span class="o">}</span>
<span class="o">}</span></code></pre></figure><p>This is an <strong>aspect</strong> with a single <strong>around advice</strong> <code>around()</code> inside. The aspect is annotated with <code>@Aspect</code> and advice is annotated with <code>@Around</code>. As discussed above, these annotations are just markers in <code>.class</code> files. They don&#39;t do anything except provide some meta-information to those who are interested in runtime.</p><p>Annotation <code>@Around</code> has one parameter, which---in this case---says that the advice should be applied to a method if:</p><ol> <li><p>its visibility modifier is <code>*</code> (<code>public</code>, <code>protected</code> or <code>private</code>);</p></li> <li><p>its name is name <code>*</code> (any name);</p></li> <li><p>its arguments are <code>..</code> (any arguments); and</p></li> <li><p>it is annotated with <code>@Loggable</code></p></li> </ol><p>When a call to an annotated method is to be intercepted, method <code>around()</code> executes before executing the actual method. When a call to method <code>power()</code> is to be intercepted, method <code>around()</code> receives an instance of class <code>ProceedingJoinPoint</code> and must return an object, which will be used as a result of method <code>power()</code>.</p><p>In order to call the original method, <code>power()</code>, the advice has to call <code>proceed()</code> of the <strong>join point</strong> object.</p><p>We compile this aspect and make it available in classpath together with our main file <code>Foo.class</code>. So far so good, but we need to take one last step in order to put our aspect into action---we should <strong>apply</strong> our advice.</p><h2 id="binary-aspect-weaving">Binary Aspect Weaving</h2><p>Aspect weaving is the name of the advice applying process. Aspect weaver modifies original code by injecting calls to aspects. AspectJ does exactly that. We give it two binary Java classes <code>Foo.class</code> and <code>MethodLogger.class</code>; it gives back three---modified <code>Foo.class</code>, <code>Foo$AjcClosure1.class</code> and unmodified <code>MethodLogger.class</code>.</p><aside class='quote'>Without weaving, both classes and aspects are just compiled Java binaries with attached annotations</aside><p>In order to understand which advice should be applied to which methods, AspectJ weaver is using annotations from <code>.class</code> files. Also, it uses <a href="http://docs.oracle.com/javase/tutorial/reflect/">reflection</a> to browse all classes on classpath. It analyzes which methods satisfy the conditions from the <code>@Around</code> annotation. Of course, it finds our method <code>power()</code>.</p><p>So, there are two steps. First, we compile our <code>.java</code> files using <code>javac</code> and get two files. Then, AspectJ weaves/modifies them and creates its own extra class. Our <code>Foo</code> class looks something like this after weaving:</p><figure class="highlight"><pre><code class="language-java" data-lang="java"><span></span><span class="kd">public</span> <span class="kd">class</span> <span class="nc">Foo</span> <span class="o">{</span>
  <span class="kd">private</span> <span class="kd">final</span> <span class="n">MethodLogger</span> <span class="n">logger</span><span class="o">;</span>
  <span class="nd">@Loggable</span>
  <span class="kd">public</span> <span class="kt">int</span> <span class="nf">power</span><span class="o">(</span><span class="kt">int</span> <span class="n">x</span><span class="o">,</span> <span class="kt">int</span> <span class="n">p</span><span class="o">)</span> <span class="o">{</span>
    <span class="k">return</span> <span class="k">this</span><span class="o">.</span><span class="na">logger</span><span class="o">.</span><span class="na">around</span><span class="o">(</span><span class="n">point</span><span class="o">);</span>
  <span class="o">}</span>
  <span class="kd">private</span> <span class="kt">int</span> <span class="nf">power_aroundBody</span><span class="o">(</span><span class="kt">int</span> <span class="n">x</span><span class="o">,</span> <span class="kt">int</span> <span class="n">p</span><span class="o">)</span> <span class="o">{</span>
    <span class="k">return</span> <span class="n">Math</span><span class="o">.</span><span class="na">pow</span><span class="o">(</span><span class="n">x</span><span class="o">,</span> <span class="n">p</span><span class="o">);</span>
  <span class="o">}</span>
<span class="o">}</span></code></pre></figure><p>AspectJ weaver moves our original functionality to a new method, <code>power_aroundBody()</code>, and redirects all <code>power()</code> calls to the aspect class <code>MethodLogger</code>.</p><p>Instead of one method <code>power()</code> in class <code>Foo</code> now we have four classes working together. From now on, this is what happens behind the scenes on every call to <code>power()</code>:</p><p><img src='/uml/52d3d016f2264bbf660a23d5bbe84203.svg' alt='PlantUML SVG diagram' class='plantuml'/></p><p>Original functionality of method <code>power()</code> is indicated by the small green lifeline on the diagram.</p><p>As you see, the aspect weaving process connects together classes and aspects, transferring calls between them through join points. Without weaving, both classes and aspects are just compiled Java binaries with attached annotations.</p><h1 id="jcabi-aspects">jcabi-aspects</h1><p><a href="http://aspects.jcabi.com">jcabi-aspects</a> is a JAR library that contains <code>Loggable</code> annotation and <code>MethodLogger</code> aspect (btw, there are <a href="http://aspects.jcabi.com">many more</a> aspects and annotations). You don&#39;t need to write your own aspect for method logging. Just add a few dependencies to your classpath and configure <a href="http://plugin.jcabi.com">jcabi-maven-plugin</a> for aspect weaving (get their latest versions in <a href="http://search.maven.org/">Maven Central</a>):</p><figure class="highlight"><pre><code class="language-xml" data-lang="xml"><span></span><span class="nt">&lt;project&gt;</span>
  <span class="nt">&lt;dependencies&gt;</span>
    <span class="nt">&lt;dependency&gt;</span>
      <span class="nt">&lt;groupId&gt;</span>com.jcabi<span class="nt">&lt;/groupId&gt;</span>
      <span class="nt">&lt;artifactId&gt;</span>jcabi-aspects<span class="nt">&lt;/artifactId&gt;</span>
    <span class="nt">&lt;/dependency&gt;</span>
    <span class="nt">&lt;dependency&gt;</span>
      <span class="nt">&lt;groupId&gt;</span>org.aspectj<span class="nt">&lt;/groupId&gt;</span>
      <span class="nt">&lt;artifactId&gt;</span>aspectjrt<span class="nt">&lt;/artifactId&gt;</span>
    <span class="nt">&lt;/dependency&gt;</span>
  <span class="nt">&lt;/dependencies&gt;</span>
  <span class="nt">&lt;build&gt;</span>
    <span class="nt">&lt;plugins&gt;</span>
      <span class="nt">&lt;plugin&gt;</span>
        <span class="nt">&lt;groupId&gt;</span>com.jcabi<span class="nt">&lt;/groupId&gt;</span>
        <span class="nt">&lt;artifactId&gt;</span>jcabi-maven-plugin<span class="nt">&lt;/artifactId&gt;</span>
        <span class="nt">&lt;executions&gt;</span>
          <span class="nt">&lt;execution&gt;</span>
            <span class="nt">&lt;goals&gt;</span>
              <span class="nt">&lt;goal&gt;</span>ajc<span class="nt">&lt;/goal&gt;</span>
            <span class="nt">&lt;/goals&gt;</span>
          <span class="nt">&lt;/execution&gt;</span>
        <span class="nt">&lt;/executions&gt;</span>
      <span class="nt">&lt;/plugin&gt;</span>
    <span class="nt">&lt;/plugins&gt;</span>
  <span class="nt">&lt;/build&gt;</span>
<span class="nt">&lt;/project&gt;</span></code></pre></figure><p>Since this weaving procedure takes a lot of configuration effort, I created a convenient Maven plugin with an <code>ajc</code> goal, which does the entire aspect weaving job. You can use AspectJ directly, but I recommend that you use <a href="http://plugin.jcabi.com">jcabi-maven-plugin</a>.</p><p>That&#39;s it. Now you can use <a href="http://aspects.jcabi.com/apidocs-0.15.1/com/jcabi/aspects/Loggable.html"><code>@com.jcabi.aspects.Loggable</code></a> annotation and your methods will be logged through slf4j.</p><p>If something doesn&#39;t work as explained, don&#39;t hesitate to submit a <a href="https://github.com/jcabi/jcabi-aspects/issues">GitHub issue</a>.</p></p>--> <nav class="buttons notranslate desktop-only"> <a href="http://www.facebook.com/sharer/sharer.php?u=https://www.yegor256.com/2014/06/01/aop-aspectj-java-method-logging.html" title="Share on Facebook" class="button" rel="nofollow"> <span class="count count-facebook">0</span> <i class="icon icon-facebook notranslate" aria-hidden="true"></i> </a> <a href="https://twitter.com/share?url=https://www.yegor256.com/2014/06/01/aop-aspectj-java-method-logging.html&amp;text=Java+Method+Logging+with+AOP+and+Annotations" title="Share on Twitter" class="button" rel="nofollow"> <span class="count count-twitter">0</span> <i class="icon icon-twitter notranslate" aria-hidden="true"></i> </a> <a href="https://plus.google.com/share?url=https://www.yegor256.com/2014/06/01/aop-aspectj-java-method-logging.html" title="Share on Google+" class="button" rel="nofollow"> <span class="count count-googleplus">0</span> <i class="icon icon-googleplus notranslate" aria-hidden="true"></i> </a> <a href="https://www.linkedin.com/cws/share?url=https://www.yegor256.com/2014/06/01/aop-aspectj-java-method-logging.html" title="Share on LinkedIn" class="button" rel="nofollow"> <span class="count count-linkedin">0</span> <i class="icon icon-linkedin notranslate" aria-hidden="true"></i> </a> <a href="http://reddit.com/submit?url=https://www.yegor256.com/2014/06/01/aop-aspectj-java-method-logging.html%3F2014-22&amp;title=Java+Method+Logging+with+AOP+and+Annotations" title="Share on Reddit" class="button" rel="nofollow"> <span class="count count-reddit">0</span> <i class="icon icon-reddit notranslate" aria-hidden="true"></i> </a> <a href="http://news.ycombinator.com/submitlink?u=https://www.yegor256.com/2014/06/01/aop-aspectj-java-method-logging.html%3F2014-22&amp;t=Java+Method+Logging+with+AOP+and+Annotations" title="Share on Hacker News" class="button" rel="nofollow"> <span class="count count-hackernews">0</span> <i class="icon icon-hackernews notranslate" aria-hidden="true"></i> </a> </nav> </header> <article class="main" itemprop="articleBody"><div ><p>Sometimes, I want to log (through <a href="http://www.slf4j.org">slf4j</a> and <a href="http://logging.apache.org/log4j/2.x/">log4j</a>) every execution of a method, seeing what arguments it receives, what it returns and how much time every execution takes. This is how I&#39;m doing it, with help of <a href="http://eclipse.org/aspectj/">AspectJ</a>, <a href="http://aspects.jcabi.com">jcabi-aspects</a> and Java 6 <a href="/2016/04/12/java-annotations-are-evil.html">annotations</a>:</p><figure class="highlight"><pre><code class="language-java" data-lang="java"><span></span><span class="kd">public</span> <span class="kd">class</span> <span class="nc">Foo</span> <span class="o">{</span>
  <span class="nd">@Loggable</span>
  <span class="kd">public</span> <span class="kt">int</span> <span class="nf">power</span><span class="o">(</span><span class="kt">int</span> <span class="n">x</span><span class="o">,</span> <span class="kt">int</span> <span class="n">p</span><span class="o">)</span> <span class="o">{</span>
    <span class="k">return</span> <span class="n">Math</span><span class="o">.</span><span class="na">pow</span><span class="o">(</span><span class="n">x</span><span class="o">,</span> <span class="n">p</span><span class="o">);</span>
  <span class="o">}</span>
<span class="o">}</span></code></pre></figure><p>This is what I see in log4j output:</p><figure class="highlight"><pre><code class="language-text" data-lang="text"><span></span>[INFO] com.example.Foo #power(2, 10): 1024 in 12μs
[INFO] com.example.Foo #power(3, 3): 27 in 4μs</code></pre></figure><p>Nice, isn&#39;t it? Now, let&#39;s see how it works.</p><h2 id="annotation-with-runtime-retention">Annotation with Runtime Retention</h2><p><a href="http://en.wikipedia.org/wiki/Java_annotation">Annotations</a> is a technique introduced in Java 6. It is a meta-programming instrument that doesn&#39;t change the way code works, but gives marks to certain elements (methods, classes or variables). In other words, annotations are just markers attached to the code that can be seen and read. Some annotations are designed to be seen at compile time only---they don&#39;t exist in <code>.class</code> files after compilation. Others remain visible after compilation and can be accessed in runtime.</p><aside class='youtube'> <a href='https://www.youtube.com/watch?v=4SRoLYxvIQ8'><div class='box'> <img src='https://i.ytimg.com/vi/4SRoLYxvIQ8/mqdefault.jpg' alt='YouTube video #4SRoLYxvIQ8'/><div class='play'><i class='icon icon-play'></i></div></div></a><div>Practical Example of AOP with AspectJ (in Russian with English subtitles); 28 October 2016.</div></aside><p>For example, <a href="http://docs.oracle.com/javase/7/docs/api/java/lang/Override.html"><code>@Override</code></a> is of the first type (its retention type is <a href="http://docs.oracle.com/javase/7/docs/api/java/lang/annotation/RetentionPolicy.html#SOURCE"><code>SOURCE</code></a>), while <a href="http://junit.sourceforge.net/javadoc/org/junit/Test.html"><code>@Test</code></a> from JUnit is of the second type (retention type is <a href="http://docs.oracle.com/javase/7/docs/api/java/lang/annotation/RetentionPolicy.html#RUNTIME"><code>RUNTIME</code></a>). <a href="http://aspects.jcabi.com/apidocs-0.15.1/com/jcabi/aspects/Loggable.html"><code>@Loggable</code></a>---the one I&#39;m using in the script above---is an annotation of the second type, from <a href="http://aspects.jcabi.com">jcabi-aspects</a>. It stays with the byte-code in the <code>.class</code> file after compilation.</p><p>Again, it is important to understand that even though method <code>power()</code> is annotated and compiled, it doesn&#39;t send anything to slf4j so far. It just contains a marker saying &quot;please, log my execution.&quot;</p><h2 id="aspect-oriented-programming-aop">Aspect Oriented Programming (AOP)</h2><p><a href="http://en.wikipedia.org/wiki/Aspect-oriented_programming">AOP</a> is a useful technique that enables adding executable blocks to the source code without explicitly changing it. In our example, we don&#39;t want to log method execution inside the class. Instead, we want some other class to intercept every call to method <code>power()</code>, measure its execution time and send this information to slf4j.</p><p>We want that interceptor to understand our <code>@Loggable</code> annotation and log every call to that specific method <code>power()</code>. And, of course, the same interceptor should be used for other methods where we&#39;ll place the same annotation in the future.</p><p>This case perfectly fits the original intent of AOP---to avoid re-implementation of some common behavior in multiple classes.</p><p>Logging is a supplementary feature to our main functionality, and we don&#39;t want to pollute our code with multiple logging instructions. Instead, we want <a href="/2014/05/23/avoid-java-static-logger.html">logging</a> to happen behind the scenes.</p><p>In terms of AOP, our solution can be explained as creating an <strong>aspect</strong> that <strong>cross-cuts</strong> the code at certain <strong>join points</strong> and applies an <strong>around advice</strong> that implements the desired functionality.</p><h2 id="aspectj">AspectJ</h2><p>Let&#39;s see what these magic words mean. But, first, let&#39;s see how <a href="http://aspects.jcabi.com">jcabi-aspects</a> implements them using <a href="http://eclipse.org/aspectj/">AspectJ</a> (it&#39;s a simplified example, full code you can find in <a href="https://github.com/jcabi/jcabi-aspects/blob/jcabi-0.15.2/src/main/java/com/jcabi/aspects/aj/MethodLogger.java"><code>MethodLogger.java</code></a>):</p><figure class="highlight"><pre><code class="language-java" data-lang="java"><span></span><span class="nd">@Aspect</span>
<span class="kd">public</span> <span class="kd">class</span> <span class="nc">MethodLogger</span> <span class="o">{</span>
  <span class="nd">@Around</span><span class="o">(</span><span class="s">&quot;execution(* *(..)) &amp;&amp; @annotation(Loggable)&quot;</span><span class="o">)</span>
  <span class="kd">public</span> <span class="n">Object</span> <span class="nf">around</span><span class="o">(</span><span class="n">ProceedingJoinPoint</span> <span class="n">point</span><span class="o">)</span> <span class="o">{</span>
    <span class="kt">long</span> <span class="n">start</span> <span class="o">=</span> <span class="n">System</span><span class="o">.</span><span class="na">currentTimeMillis</span><span class="o">();</span>
    <span class="n">Object</span> <span class="n">result</span> <span class="o">=</span> <span class="n">point</span><span class="o">.</span><span class="na">proceed</span><span class="o">();</span>
    <span class="n">Logger</span><span class="o">.</span><span class="na">info</span><span class="o">(</span>
      <span class="s">&quot;#%s(%s): %s in %[msec]s&quot;</span><span class="o">,</span>
      <span class="n">MethodSignature</span><span class="o">.</span><span class="na">class</span><span class="o">.</span><span class="na">cast</span><span class="o">(</span><span class="n">point</span><span class="o">.</span><span class="na">getSignature</span><span class="o">()).</span><span class="na">getMethod</span><span class="o">().</span><span class="na">getName</span><span class="o">(),</span>
      <span class="n">point</span><span class="o">.</span><span class="na">getArgs</span><span class="o">(),</span>
      <span class="n">result</span><span class="o">,</span>
      <span class="n">System</span><span class="o">.</span><span class="na">currentTimeMillis</span><span class="o">()</span> <span class="o">-</span> <span class="n">start</span>
    <span class="o">);</span>
    <span class="k">return</span> <span class="n">result</span><span class="o">;</span>
  <span class="o">}</span>
<span class="o">}</span></code></pre></figure><p>This is an <strong>aspect</strong> with a single <strong>around advice</strong> <code>around()</code> inside. The aspect is annotated with <code>@Aspect</code> and advice is annotated with <code>@Around</code>. As discussed above, these annotations are just markers in <code>.class</code> files. They don&#39;t do anything except provide some meta-information to those who are interested in runtime.</p><p>Annotation <code>@Around</code> has one parameter, which---in this case---says that the advice should be applied to a method if:</p><ol> <li><p>its visibility modifier is <code>*</code> (<code>public</code>, <code>protected</code> or <code>private</code>);</p></li> <li><p>its name is name <code>*</code> (any name);</p></li> <li><p>its arguments are <code>..</code> (any arguments); and</p></li> <li><p>it is annotated with <code>@Loggable</code></p></li> </ol><p>When a call to an annotated method is to be intercepted, method <code>around()</code> executes before executing the actual method. When a call to method <code>power()</code> is to be intercepted, method <code>around()</code> receives an instance of class <code>ProceedingJoinPoint</code> and must return an object, which will be used as a result of method <code>power()</code>.</p><p>In order to call the original method, <code>power()</code>, the advice has to call <code>proceed()</code> of the <strong>join point</strong> object.</p><p>We compile this aspect and make it available in classpath together with our main file <code>Foo.class</code>. So far so good, but we need to take one last step in order to put our aspect into action---we should <strong>apply</strong> our advice.</p><h2 id="binary-aspect-weaving">Binary Aspect Weaving</h2><p>Aspect weaving is the name of the advice applying process. Aspect weaver modifies original code by injecting calls to aspects. AspectJ does exactly that. We give it two binary Java classes <code>Foo.class</code> and <code>MethodLogger.class</code>; it gives back three---modified <code>Foo.class</code>, <code>Foo$AjcClosure1.class</code> and unmodified <code>MethodLogger.class</code>.</p><aside class='quote'>Without weaving, both classes and aspects are just compiled Java binaries with attached annotations</aside><p>In order to understand which advice should be applied to which methods, AspectJ weaver is using annotations from <code>.class</code> files. Also, it uses <a href="http://docs.oracle.com/javase/tutorial/reflect/">reflection</a> to browse all classes on classpath. It analyzes which methods satisfy the conditions from the <code>@Around</code> annotation. Of course, it finds our method <code>power()</code>.</p><p>So, there are two steps. First, we compile our <code>.java</code> files using <code>javac</code> and get two files. Then, AspectJ weaves/modifies them and creates its own extra class. Our <code>Foo</code> class looks something like this after weaving:</p><figure class="highlight"><pre><code class="language-java" data-lang="java"><span></span><span class="kd">public</span> <span class="kd">class</span> <span class="nc">Foo</span> <span class="o">{</span>
  <span class="kd">private</span> <span class="kd">final</span> <span class="n">MethodLogger</span> <span class="n">logger</span><span class="o">;</span>
  <span class="nd">@Loggable</span>
  <span class="kd">public</span> <span class="kt">int</span> <span class="nf">power</span><span class="o">(</span><span class="kt">int</span> <span class="n">x</span><span class="o">,</span> <span class="kt">int</span> <span class="n">p</span><span class="o">)</span> <span class="o">{</span>
    <span class="k">return</span> <span class="k">this</span><span class="o">.</span><span class="na">logger</span><span class="o">.</span><span class="na">around</span><span class="o">(</span><span class="n">point</span><span class="o">);</span>
  <span class="o">}</span>
  <span class="kd">private</span> <span class="kt">int</span> <span class="nf">power_aroundBody</span><span class="o">(</span><span class="kt">int</span> <span class="n">x</span><span class="o">,</span> <span class="kt">int</span> <span class="n">p</span><span class="o">)</span> <span class="o">{</span>
    <span class="k">return</span> <span class="n">Math</span><span class="o">.</span><span class="na">pow</span><span class="o">(</span><span class="n">x</span><span class="o">,</span> <span class="n">p</span><span class="o">);</span>
  <span class="o">}</span>
<span class="o">}</span></code></pre></figure><p>AspectJ weaver moves our original functionality to a new method, <code>power_aroundBody()</code>, and redirects all <code>power()</code> calls to the aspect class <code>MethodLogger</code>.</p><p>Instead of one method <code>power()</code> in class <code>Foo</code> now we have four classes working together. From now on, this is what happens behind the scenes on every call to <code>power()</code>:</p><p><img src='/uml/52d3d016f2264bbf660a23d5bbe84203.svg' alt='PlantUML SVG diagram' class='plantuml'/></p><p>Original functionality of method <code>power()</code> is indicated by the small green lifeline on the diagram.</p><p>As you see, the aspect weaving process connects together classes and aspects, transferring calls between them through join points. Without weaving, both classes and aspects are just compiled Java binaries with attached annotations.</p><h1 id="jcabi-aspects">jcabi-aspects</h1><p><a href="http://aspects.jcabi.com">jcabi-aspects</a> is a JAR library that contains <code>Loggable</code> annotation and <code>MethodLogger</code> aspect (btw, there are <a href="http://aspects.jcabi.com">many more</a> aspects and annotations). You don&#39;t need to write your own aspect for method logging. Just add a few dependencies to your classpath and configure <a href="http://plugin.jcabi.com">jcabi-maven-plugin</a> for aspect weaving (get their latest versions in <a href="http://search.maven.org/">Maven Central</a>):</p><figure class="highlight"><pre><code class="language-xml" data-lang="xml"><span></span><span class="nt">&lt;project&gt;</span>
  <span class="nt">&lt;dependencies&gt;</span>
    <span class="nt">&lt;dependency&gt;</span>
      <span class="nt">&lt;groupId&gt;</span>com.jcabi<span class="nt">&lt;/groupId&gt;</span>
      <span class="nt">&lt;artifactId&gt;</span>jcabi-aspects<span class="nt">&lt;/artifactId&gt;</span>
    <span class="nt">&lt;/dependency&gt;</span>
    <span class="nt">&lt;dependency&gt;</span>
      <span class="nt">&lt;groupId&gt;</span>org.aspectj<span class="nt">&lt;/groupId&gt;</span>
      <span class="nt">&lt;artifactId&gt;</span>aspectjrt<span class="nt">&lt;/artifactId&gt;</span>
    <span class="nt">&lt;/dependency&gt;</span>
  <span class="nt">&lt;/dependencies&gt;</span>
  <span class="nt">&lt;build&gt;</span>
    <span class="nt">&lt;plugins&gt;</span>
      <span class="nt">&lt;plugin&gt;</span>
        <span class="nt">&lt;groupId&gt;</span>com.jcabi<span class="nt">&lt;/groupId&gt;</span>
        <span class="nt">&lt;artifactId&gt;</span>jcabi-maven-plugin<span class="nt">&lt;/artifactId&gt;</span>
        <span class="nt">&lt;executions&gt;</span>
          <span class="nt">&lt;execution&gt;</span>
            <span class="nt">&lt;goals&gt;</span>
              <span class="nt">&lt;goal&gt;</span>ajc<span class="nt">&lt;/goal&gt;</span>
            <span class="nt">&lt;/goals&gt;</span>
          <span class="nt">&lt;/execution&gt;</span>
        <span class="nt">&lt;/executions&gt;</span>
      <span class="nt">&lt;/plugin&gt;</span>
    <span class="nt">&lt;/plugins&gt;</span>
  <span class="nt">&lt;/build&gt;</span>
<span class="nt">&lt;/project&gt;</span></code></pre></figure><p>Since this weaving procedure takes a lot of configuration effort, I created a convenient Maven plugin with an <code>ajc</code> goal, which does the entire aspect weaving job. You can use AspectJ directly, but I recommend that you use <a href="http://plugin.jcabi.com">jcabi-maven-plugin</a>.</p><p>That&#39;s it. Now you can use <a href="http://aspects.jcabi.com/apidocs-0.15.1/com/jcabi/aspects/Loggable.html"><code>@com.jcabi.aspects.Loggable</code></a> annotation and your methods will be logged through slf4j.</p><p>If something doesn&#39;t work as explained, don&#39;t hesitate to submit a <a href="https://github.com/jcabi/jcabi-aspects/issues">GitHub issue</a>.</p></div></article></div><div class="wrapper"> <related-posts /></div><div class="disqus" role="complementary"><p class="disqus_hint"> Please, use <a href="https://help.disqus.com/commenting/what-html-tags-are-allowed-within-comments">syntax highlighting</a> in your comments, to make them more readable.</p><div id="disqus_thread" class="disqus-thread"> <a>&nbsp;</a></div><script> var disqus_config = function () { this.page.url = document.location.href.split('?')[0].split('#')[0].replace('https://', 'http://'); this.page.identifier = this.page.url; }; (function() { var d = document, s = d.createElement('script'); s.src = '//yegor256.disqus.com/embed.js'; s.setAttribute('data-timestamp', +new Date()); (d.head || d.body).appendChild(s); })(); </script> <noscript><div><p class="red"> JavaScript is disabled in your browser, that's why you can't see comments under this post.</p></div></noscript></div><div class="wrapper"> <footer class="footer"><p> &copy; <span itemscope="" itemprop="copyrightHolder" itemtype="http://schema.org/Person"> <span itemprop="name">Yegor Bugayenko</span> </span> 2014&ndash;<span itemprop="copyrightYear">2018</span></p></footer></div></section><div class="wrapper unprintable" style="text-align:center;margin-top:2em;"> <a href="http://www.sixnines.io/h/3ba1652f"> <img src="//www.sixnines.io/b/3ba1652f?style=flat" alt="sixnines availability badge"/> </a></div><script src="//code.jquery.com/jquery-1.9.0.min.js"></script> <script src="/js/all.js?4e047f6f42b"></script> <script>var disqus_shortname = 'yegor256';</script> <script id="dsq-count-scr" src="//yegor256.disqus.com/count.js" async="async"></script> <script> (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){ (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o), m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m) })(window,document,'script','//www.google-analytics.com/analytics.js','ga'); ga('create', 'UA-1963507-32', 'auto'); ga('send', 'pageview'); </script> <script> Cd=document;Cr="&"+Math.random();Cp="&s=1"; Cd.cookie="b=b";if(Cd.cookie)Cp+="&c=1"; Cp+="&t="+(new Date()).getTimezoneOffset(); if(self!=top)Cp+="&f=1"; </script> <script> if(navigator.javaEnabled())Cp+="&j=1"; </script> <script> if(typeof(screen)!='undefined')Cp+="&w="+screen.width+"&h="+ screen.height+"&d="+(screen.colorDepth?screen.colorDepth:screen.pixelDepth); </script> <script> Cd.write("<img src='//c.hit.ua/hit?i=95870&g=0&x=2"+Cp+Cr+ "&r="+escape(Cd.referrer)+"&u="+escape(window.location.href)+ "' border='0' wi"+"dth='1' he"+"ight='1'/>"); </script> <script type="application/ld+json"> { "@context": "http://schema.org", "@type": "Person", "name": "Yegor Bugayenko", "url": "http://www.yegor256.com", "sameAs": [ "https://www.facebook.com/yegor256", "https://instagram.com/yegor256", "https://www.linkedin.com/in/yegor256", "https://twitter.com/yegor256", "https://github.com/yegor256", "https://www.pinterest.com/yegor256/" ] } </script> </body> </html> <!DOCTYPE html> <html xmlns="http://www.w3.org/1999/xhtml" lang="en-US" xml:lang="en-US" itemscope="" itemtype="http://schema.org/WebSite"> <head> <meta charset="utf-8"/> <meta name="description" content="jcabi-s3 is an object-oriented Java adapter for Amazon S3 that simplifies basic read and write operations and makes them truly object-oriented " /> <meta name="keywords" content="amazon s3 java, s3 java, s3 java adapter, s3 java api, s3 java api example, s3 java client, s3 java example, s3 java object-oriented" /> <meta name="viewport" content="width=device-width,minimum-scale=1,initial-scale=1"/> <meta name="google-site-verification" content="JEj_gQr2CPe2QKGw8XdMz0R7VboQIUbX3FlM-lwTq-8" /> <meta name="author" content="Yegor Bugayenko"> <meta name="article:published_time" content="2014-05-26 00:00:00 +0000"> <meta name="og:site_name" content="Yegor Bugayenko"/> <meta name="og:type" content="article" /> <meta name="og:locale" content="en_US" /> <meta name="twitter:account_id" content="4503599630178231" /> <meta name="twitter:creator" content="@yegor256"/> <meta name="twitter:site" content="@yegor256"/> <meta name="twitter:title" property="og:title" content="Object-Oriented Java Adapter of Amazon S3 SDK"/> <meta name="twitter:description" property="og:description" content="jcabi-s3 is an object-oriented Java adapter for Amazon S3 that simplifies basic read and write operations and makes them truly object-oriented "/> <meta name="twitter:url" property="og:url" content="https://www.yegor256.com/2014/05/26/amazon-s3-java-oop-adapter.html"/> <meta name="telegram:channel" content="AAAAAEJFMRzsRTRxM3ec6A"/> <link rel="search" type="application/opensearchdescription+xml" href="/opensearch.xml" title="yegor256" /> <link rel="shortcut icon" href="/favicon.ico?4e047f6f42b"/> <link rel="apple-touch-icon" href="/favicon.ico?4e047f6f42b"/> <link rel="alternate" type="application/rss+xml" title="RSS for yegor256.com" href="https://www.yegor256.com/rss.xml"/> <link rel="stylesheet" href="/css/layout.css?4e047f6f42b"/> <link rel="stylesheet" href="/css/icons.css?4e047f6f42b"/> <link rel="canonical" href="https://www.yegor256.com/2014/05/26/amazon-s3-java-oop-adapter.html" /> <link rel="amphtml" href="https://www.yegor256.com/2014/05/26/amazon-s3-java-oop-adapter.amp.html" /> <title>Object-Oriented Java Adapter of Amazon S3 SDK </title> </head> <body><div class="wrapper"> <aside class="header-toggle unprintable" id="header-toggle" title="Show the menu" onclick="$('#header').show();$('#header-toggle').hide();">&#9776;</aside> <header class="header" id="header"><div class="face"> <a href="/about-me.html#form" class="sub" title="Click to subscribe to my monthly newsletter"><span>Subscribe</span></a> <a href="/about-me.html" style="position:relative;"> <img src="/images/face-256x256.jpg" class="photo" alt="Yegor Bugayenko"/> </a></div><nav><ul class="menu social notranslate"> <li><a href="https://twitter.com/intent/follow?screen_name=yegor256" rel="nofollow" title="Follow me on Twitter"><i class="icon icon-twitter notranslate" aria-hidden="true"></i></a></li> <li><a href="/rss.xml" rel="nofollow" title="Subscribe to my RSS feed"><i class="icon icon-rss notranslate" aria-hidden="true"></i></a></li> <li><a itemprop="sameAs" href="https://github.com/yegor256" rel="nofollow" title="My GitHub profile"><i class="icon icon-github notranslate" aria-hidden="true"></i></a></li> <li><a itemprop="sameAs" href="http://stackoverflow.com/users/187141/yegor256" rel="nofollow" title="My StackOverflow profile"><i class="icon icon-stackoverflow notranslate" aria-hidden="true"></i></a></li> <li><a itemprop="sameAs" href="https://www.facebook.com/yegor256" rel="nofollow" title="Follow me on Facebook"><i class="icon icon-facebook notranslate" aria-hidden="true"></i></a></li> <li><a itemprop="sameAs" href="https://instagram.com/yegor256" rel="nofollow" title="Follow me on Instagram"><i class="icon icon-instagram notranslate" aria-hidden="true"></i></a></li> <li><a itemprop="sameAs" href="https://www.linkedin.com/in/yegor256" rel="nofollow" title="My LinkedIn profile"><i class="icon icon-linkedin notranslate" aria-hidden="true"></i></a></li> <li><a itemprop="sameAs" href="https://www.youtube.com/c/yegor256?sub_confirmation=1" rel="nofollow" title="My Youtube video channel"><i class="icon icon-youtube notranslate" aria-hidden="true"></i></a></li> <li><a itemprop="sameAs" href="https://www.pinterest.com/yegor256/" rel="nofollow" title="My Pinterest boards"><i class="icon icon-pinterest notranslate" aria-hidden="true"></i></a></li> <li><a itemprop="sameAs" href="https://angel.co/yegor256" rel="nofollow" title="My AngelList profile"><i class="icon icon-angellist notranslate" aria-hidden="true"></i></a></li> <li><a href="https://soundcloud.com/yegor256" rel="nofollow" title="My podcast"><i class="icon icon-podcast notranslate" aria-hidden="true"></i></a></li> <li><a href="https://itunes.apple.com/us/podcast/yegor256-podcast/id1150826721" rel="nofollow" title="My iTunes podcast"><i class="icon icon-itunes notranslate" aria-hidden="true"></i></a></li> <li><a href="https://t.me/joinchat/AAAAAEJFMRzsRTRxM3ec6A" rel="nofollow" title="My Telegram public channel"><i class="icon icon-telegram notranslate" aria-hidden="true"></i></a></li> <li><a href="mailto:blog@yegor256.com" rel="nofollow" title="Email me any time"><i class="icon icon-mail notranslate" aria-hidden="true"></i></a></li></ul><ul class="menu"> <li><a href="/" title="Home page">Home</a></li> <li ><a href="/best.html" title="Best articles to read">12&#160;Best</a></li> <li ><a href="/contents.html" title="The contents of the entire blog">All&#160;288</a></li> <li ><a href="/webinars.html" title="My webinars">Webinars</a></li> <li ><a href="/talks.html" title="Future and past conference talks">Talks</a></li> <li ><a href="/books.html" title="The books I wrote">Books</a></li> <li ><a href="/papers.html" title="My academic papers and patents">Papers</a></li> <li ><a href="/pets.html" title="My loved pet projects">Pets</a></li> <li ><a href="/award.html" title="Software quality award">Award</a></li> <li ><a href="/testimonials.html" title="What some people say about me">Testimonials</a></li> <li ><a href="/shift-m.html" title="Audio podcast about project management">Shift-M</a></li> <li ><a href="/paintings.html" title="My paintings for sale">Paintings</a></li> <li><a href="http://ru.yegor256.com/" title="Немного на русском языке">По-русски</a></li></ul></nav><div class="search"> <form method="get" action="https://www.google.com/search" itemprop="potentialAction" itemscope="" itemtype="http://schema.org/SearchAction"> <meta itemprop="target" content="https://www.google.com/search?q={q}"/> <input name="sitesearch" value="yegor256.com" type="hidden"/> <input itemprop="query-input" type="text" id="search-query" class="field field-text" required="required" onfocus="$('.google').css('visibility', 'visible');" name="q" placeholder="Search..." autocomplete="off"/> <input type="image" src="/images/google-search-icon.svg" class="google" title="Search via Google" alt="Search via Google"/> </form></div><div class="hot"><ul> <li> <a href="/code-ahead.html">Code Ahead</a> was published on Amazon just a few days ago! It is my new book, a novel about programmers. It explains in details the majority of ideas that stand behind <a href="https://www.zerocracy.com">Zerocracy</a> and <a href="https://www.xdsd.org">XDSD</a>. </li> <li> At <a href="/webinars.html">Webinar #37</a> we will discuss naming problem in OOP, for objects, methods and attributes; join us on <b>September 12</b>, at 11am PST. </li></ul></div></header></div><section itemscope="" itemtype="http://schema.org/BlogPosting"><div class="wrapper"> <header><p class="printable"> <img src="https://api.qrserver.com/v1/create-qr-code/?data=https://www.yegor256.com/2014/05/26/amazon-s3-java-oop-adapter.html&amp;format=svg" style="width:125px;height:125px;" alt="QR code"/></p><p class="printable"> <code itemprop="url">https://www.yegor256.com/2014/05/26/amazon-s3-java-oop-adapter.html</code></p><h1 itemprop="name headline mainEntityOfPage">Object-Oriented Java Adapter of Amazon S3 SDK</h1><ul class="subline"> <li> <time itemprop="datePublished" datetime="2014-05-26T00:00:00+00:00"> 26 May 2014 </time> </li> <li class="printable" itemscope="" itemprop="author" itemtype="http://schema.org/Person"> <span itemprop="name">Yegor Bugayenko</span> </li> <li class="unprintable"> <i class="icon icon-comments"></i> <a href="http://www.yegor256.com/2014/05/26/amazon-s3-java-oop-adapter.html#disqus_thread" itemprop="discussionUrl">comments</a> </li></ul><h2 id="s3-object-is-an-object-in-java">S3 Object is an Object in Java</h2><p>S3 object get its representative in Java. It is not a collection of procedures to be called in order to get its properties (as with AWS SDK). Rather, it is a Java object with certain behaviors. I called them &quot;ockets&quot; (similar to &quot;buckets&quot;), in order to avoid clashes with <code>java.lang.Object</code>.</p><p><a href="http://s3.jcabi.com/apidocs-0.5/com/jcabi/s3/Ocket.html"><code>Ocket</code></a> is an interface, that exposes the behavior of a real AWS S3 object: read, write, check existence. There is also a convenient decorator <code>Ocket.Text</code> that simplifies working with binary objects:</p><figure class="highlight"><pre><code class="language-java" data-lang="java"><span></span><span class="n">Ocket</span><span class="o">.</span><span class="na">Text</span> <span class="n">ocket</span> <span class="o">=</span> <span class="k">new</span> <span class="n">Ocket</span><span class="o">.</span><span class="na">Text</span><span class="o">(</span><span class="n">ocket_from_s3</span><span class="o">);</span>
<span class="k">if</span> <span class="o">(</span><span class="n">ocket</span><span class="o">.</span><span class="na">exists</span><span class="o">())</span> <span class="o">{</span>
  <span class="n">System</span><span class="o">.</span><span class="na">out</span><span class="o">.</span><span class="na">print</span><span class="o">(</span><span class="n">ocket</span><span class="o">.</span><span class="na">read</span><span class="o">());</span>
<span class="o">}</span> <span class="k">else</span> <span class="o">{</span>
  <span class="n">ocket</span><span class="o">.</span><span class="na">write</span><span class="o">(</span><span class="s">&quot;Hello, world!&quot;</span><span class="o">);</span>
<span class="o">}</span></code></pre></figure><p>Now, you can pass an object to another class, instead of giving it your AWS credentials, bucket name, and object name. You simply pass a Java object, which encapsulates all AWS interaction details.</p><h2 id="extendability-through-decoration">Extendability Through Decoration</h2><p>Since <a href="http://s3.jcabi.com">jcabi-s3</a> exposes all entities as interfaces, they can easily be extended through encapsulation (<a href="http://en.wikipedia.org/wiki/Decorator_pattern">Decorator Pattern</a>).</p><p>For example, you want your code to retry S3 object read operations a few times before giving up and <a href="/2015/12/01/rethrow-exceptions.html">throwing</a> an <code>IOException</code> (by the way, this is a very good practice when working with web services). So, you want all your S3 reading operations to be redone a few times if first attempts fail.</p><p>You define a new decorator class, say, <code>RetryingOcket</code>, which encapsulates an original <code>Ocket</code>:</p><figure class="highlight"><pre><code class="language-java" data-lang="java"><span></span><span class="kd">public</span> <span class="n">RetryingOcket</span> <span class="kd">implements</span> <span class="n">Ocket</span> <span class="o">{</span>
  <span class="kd">private</span> <span class="kd">final</span> <span class="n">Ocket</span> <span class="n">origin</span><span class="o">;</span>
  <span class="kd">public</span> <span class="nf">RetryingOcket</span><span class="o">(</span><span class="n">Ocket</span> <span class="n">ocket</span><span class="o">)</span> <span class="o">{</span>
    <span class="k">this</span><span class="o">.</span><span class="na">origin</span> <span class="o">=</span> <span class="n">ocket</span><span class="o">;</span>
  <span class="o">}</span>
  <span class="nd">@Override</span>
  <span class="kd">public</span> <span class="kt">void</span> <span class="nf">read</span><span class="o">(</span><span class="n">OutputStream</span> <span class="n">stream</span><span class="o">)</span> <span class="kd">throws</span> <span class="n">IOException</span> <span class="o">{</span>
    <span class="kt">int</span> <span class="n">attempt</span> <span class="o">=</span> <span class="mi">0</span><span class="o">;</span>
    <span class="k">while</span> <span class="o">(</span><span class="kc">true</span><span class="o">)</span> <span class="o">{</span>
      <span class="k">try</span> <span class="o">{</span>
        <span class="k">this</span><span class="o">.</span><span class="na">origin</span><span class="o">.</span><span class="na">read</span><span class="o">(</span><span class="n">stream</span><span class="o">);</span>
      <span class="o">}</span> <span class="k">catch</span> <span class="o">(</span><span class="n">IOException</span> <span class="n">ex</span><span class="o">)</span> <span class="o">{</span>
        <span class="k">if</span> <span class="o">(</span><span class="n">attempt</span><span class="o">++</span> <span class="o">&gt;</span> <span class="mi">3</span><span class="o">)</span> <span class="o">{</span>
          <span class="k">throw</span> <span class="n">ex</span><span class="o">;</span>
        <span class="o">}</span>
      <span class="o">}</span>
    <span class="o">}</span>
  <span class="o">}</span>
  <span class="c1">// same for other methods</span>
<span class="o">}</span></code></pre></figure><p>Now, everywhere where <code>Ocket</code> is expected you send an instance of <code>RetryingOcket</code> that wraps your original object:</p><figure class="highlight"><pre><code class="language-java" data-lang="java"><span></span><span class="n">foo</span><span class="o">.</span><span class="na">process</span><span class="o">(</span><span class="k">new</span> <span class="n">RetryingOcket</span><span class="o">(</span><span class="n">ocket</span><span class="o">));</span></code></pre></figure><p>Method <code>foo.process()</code> won&#39;t see a difference, since it is the same <code>Ocket</code> interface it is expecting.</p><p>By the way, this retry functionality is implemented out-of-the-box in <a href="http://s3.jcabi.com">jcabi-s3</a>, in <a href="http://s3.jcabi.com/apidocs-0.5/com/jcabi/s3/retry/package-summary.html"><code>com.jcabi.s3.retry</code></a> package.</p><h2 id="easy-mocking">Easy Mocking</h2><p>Again, due to the fact that all entities in <a href="http://s3.jcabi.com">jcabi-s3</a> are interfaces, they are very easy to mock. For example, your class expects an S3 object, reads its data and calculates the MD5 hash (I&#39;m using <a href="http://commons.apache.org/proper/commons-codec/apidocs/org/apache/commons/codec/digest/DigestUtils.html"><code>DigestUtils</code></a> from <a href="http://commons.apache.org/proper/commons-codec/">commons-codec</a>):</p><figure class="highlight"><pre><code class="language-java" data-lang="java"><span></span><span class="kn">import</span> <span class="nn">com.jcabi.s3.Ocket</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">org.apache.commons.codec.digest.DigestUtils</span><span class="o">;</span>
<span class="kd">public</span> <span class="kd">class</span> <span class="nc">S3Md5Hash</span> <span class="o">{</span>
  <span class="kd">private</span> <span class="kd">final</span> <span class="n">Ocket</span> <span class="n">ocket</span><span class="o">;</span>
  <span class="kd">public</span> <span class="nf">S3Md5Hash</span><span class="o">(</span><span class="n">Ocket</span> <span class="n">okt</span><span class="o">)</span> <span class="o">{</span>
    <span class="k">this</span><span class="o">.</span><span class="na">ocket</span> <span class="o">=</span> <span class="n">okt</span><span class="o">;</span>
  <span class="o">}</span>
  <span class="kd">public</span> <span class="nf">hash</span><span class="o">()</span> <span class="kd">throws</span> <span class="n">IOException</span> <span class="o">{</span>
    <span class="n">ByteArrayOutputStream</span> <span class="n">baos</span> <span class="o">=</span> <span class="k">new</span> <span class="n">ByteArrayOutputStream</span><span class="o">();</span>
    <span class="k">this</span><span class="o">.</span><span class="na">ocket</span><span class="o">.</span><span class="na">read</span><span class="o">(</span><span class="n">baos</span><span class="o">);</span>
    <span class="k">return</span> <span class="n">DigestUtils</span><span class="o">.</span><span class="na">md5hex</span><span class="o">(</span><span class="n">baos</span><span class="o">.</span><span class="na">toByteArray</span><span class="o">());</span>
  <span class="o">}</span>
<span class="o">}</span></code></pre></figure><p>Here is how simple a unit test will look (try to create a unit test for a class using AWS SDK and you will see the difference):</p><figure class="highlight"><pre><code class="language-java" data-lang="java"><span></span><span class="kn">import</span> <span class="nn">com.jcabi.s3.Ocket</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">org.junit.Test</span><span class="o">;</span>
<span class="kd">public</span> <span class="kd">class</span> <span class="nc">S3Md5HashTest</span> <span class="o">{</span>
  <span class="nd">@Test</span>
  <span class="kd">public</span> <span class="kt">void</span> <span class="nf">generatesHash</span><span class="o">()</span> <span class="o">{</span>
    <span class="n">Ocket</span> <span class="n">ocket</span> <span class="o">=</span> <span class="n">Mockito</span><span class="o">.</span><span class="na">mock</span><span class="o">(</span><span class="n">Ocket</span><span class="o">.</span><span class="na">class</span><span class="o">);</span>
    <span class="n">Mockito</span><span class="o">.</span><span class="na">doAnswer</span><span class="o">(</span>
      <span class="k">new</span> <span class="n">Answer</span><span class="o">&lt;</span><span class="n">Void</span><span class="o">&gt;()</span> <span class="o">{</span>
        <span class="kd">public</span> <span class="n">Void</span> <span class="nf">answer</span><span class="o">(</span><span class="kd">final</span> <span class="n">InvocationOnMock</span> <span class="n">inv</span><span class="o">)</span> <span class="kd">throws</span> <span class="n">IOException</span> <span class="o">{</span>
          <span class="n">OutputStream</span><span class="o">.</span><span class="na">class</span><span class="o">.</span><span class="na">cast</span><span class="o">(</span><span class="n">inv</span><span class="o">.</span><span class="na">getArguments</span><span class="o">()[</span><span class="mi">0</span><span class="o">]).</span><span class="na">write</span><span class="o">(</span><span class="sc">&#39; &#39;</span><span class="o">);</span>
        <span class="o">}</span>
      <span class="o">}</span>
    <span class="o">).</span><span class="na">when</span><span class="o">(</span><span class="n">ocket</span><span class="o">).</span><span class="na">read</span><span class="o">(</span><span class="n">Mockito</span><span class="o">.</span><span class="na">any</span><span class="o">(</span><span class="n">OutputStream</span><span class="o">.</span><span class="na">class</span><span class="o">));</span>
    <span class="n">String</span> <span class="n">hash</span> <span class="o">=</span> <span class="k">new</span> <span class="n">S5Md5Hash</span><span class="o">(</span><span class="n">ocket</span><span class="o">);</span>
    <span class="n">Assert</span><span class="o">.</span><span class="na">assertEquals</span><span class="o">(</span><span class="n">hash</span><span class="o">,</span> <span class="s">&quot;7215ee9c7d9dc229d2921a40e899ec5f&quot;</span><span class="o">);</span>
  <span class="o">}</span>
<span class="o">}</span></code></pre></figure><p>I&#39;m using <a href="http://junit.org/">JUnit</a> and <a href="https://code.google.com/p/mockito/">Mockito</a> in this test.</p><h2 id="immutability">Immutability</h2><p>All classes in <a href="http://s3.jcabi.com">jcabi-s3</a> are annotated with <a href="http://aspects.jcabi.com/annotation-immutable.html"><code>@Immutable</code></a> and are truly immutable.</p><p>The library ships as a JAR dependency in <a href="http://repo1.maven.org/maven2/com/jcabi/jcabi-s3">Maven Central</a> (get its latest versions in <a href="http://search.maven.org/">Maven Central</a>):</p><figure class="highlight"><pre><code class="language-xml" data-lang="xml"><span></span><span class="nt">&lt;dependency&gt;</span>
  <span class="nt">&lt;groupId&gt;</span>com.jcabi<span class="nt">&lt;/groupId&gt;</span>
  <span class="nt">&lt;artifactId&gt;</span>jcabi-s3<span class="nt">&lt;/artifactId&gt;</span>
<span class="nt">&lt;/dependency&gt;</span></code></pre></figure><p>As always, your comments and criticism are welcome as <a href="https://github.com/jcabi/jcabi-s3/issues">GitHub issues</a>.</p></p>--> <nav class="buttons notranslate desktop-only"> <a href="http://www.facebook.com/sharer/sharer.php?u=https://www.yegor256.com/2014/05/26/amazon-s3-java-oop-adapter.html" title="Share on Facebook" class="button" rel="nofollow"> <span class="count count-facebook">0</span> <i class="icon icon-facebook notranslate" aria-hidden="true"></i> </a> <a href="https://twitter.com/share?url=https://www.yegor256.com/2014/05/26/amazon-s3-java-oop-adapter.html&amp;text=Object-Oriented+Java+Adapter+of+Amazon+S3+SDK" title="Share on Twitter" class="button" rel="nofollow"> <span class="count count-twitter">0</span> <i class="icon icon-twitter notranslate" aria-hidden="true"></i> </a> <a href="https://plus.google.com/share?url=https://www.yegor256.com/2014/05/26/amazon-s3-java-oop-adapter.html" title="Share on Google+" class="button" rel="nofollow"> <span class="count count-googleplus">0</span> <i class="icon icon-googleplus notranslate" aria-hidden="true"></i> </a> <a href="https://www.linkedin.com/cws/share?url=https://www.yegor256.com/2014/05/26/amazon-s3-java-oop-adapter.html" title="Share on LinkedIn" class="button" rel="nofollow"> <span class="count count-linkedin">0</span> <i class="icon icon-linkedin notranslate" aria-hidden="true"></i> </a> <a href="http://reddit.com/submit?url=https://www.yegor256.com/2014/05/26/amazon-s3-java-oop-adapter.html%3F2014-21&amp;title=Object-Oriented+Java+Adapter+of+Amazon+S3+SDK" title="Share on Reddit" class="button" rel="nofollow"> <span class="count count-reddit">0</span> <i class="icon icon-reddit notranslate" aria-hidden="true"></i> </a> <a href="http://news.ycombinator.com/submitlink?u=https://www.yegor256.com/2014/05/26/amazon-s3-java-oop-adapter.html%3F2014-21&amp;t=Object-Oriented+Java+Adapter+of+Amazon+S3+SDK" title="Share on Hacker News" class="button" rel="nofollow"> <span class="count count-hackernews">0</span> <i class="icon icon-hackernews notranslate" aria-hidden="true"></i> </a> </nav> </header> <article class="main" itemprop="articleBody"><div > <figure class='badge'><img src='https://www.yegor256.com/images/2014/05/s3-logo.png' style='width:150px;max-width:100%;' alt='badge'/></figure><p>I&#39;m a big fan of Amazon Web Services (AWS). I&#39;m using them in almost all of my projects. One of their most popular services is <a href="http://aws.amazon.com/s3/">Simple Storage Service (S3)</a>. It is a storage for binary objects (files) with unique names, accessible through HTTP or RESTful API.</p><p>Using S3 is very simple. You create a &quot;bucket&quot; with a unique name, upload your &quot;object&quot; into the bucket through their web interface or through RESTful API, and then download it again (either through HTTP or the API.)</p><p>Amazon ships the <a href="https://aws.amazon.com/sdkforjava/">Java SDK</a> that wraps their RESTful API. However, this SDK is not object-oriented at all. It is purely imperative and procedural---it just mirrors the API.</p><p>For example, in order to download an existing object <code>doc.txt</code> from bucket <code>test-1</code>, you have to do something like this:</p><figure class="highlight"><pre><code class="language-java" data-lang="java"><span></span><span class="n">AWSCredentials</span> <span class="n">creds</span> <span class="o">=</span> <span class="k">new</span> <span class="n">BasicAWSCredentials</span><span class="o">(</span><span class="n">key</span><span class="o">,</span> <span class="n">secret</span><span class="o">);</span>
<span class="n">AmazonS3</span> <span class="n">aws</span> <span class="o">=</span> <span class="k">new</span> <span class="n">AmazonS3Client</span><span class="o">(</span><span class="n">creds</span><span class="o">);</span>
<span class="n">S3Object</span> <span class="n">obj</span> <span class="o">=</span> <span class="n">aws</span><span class="o">.</span><span class="na">getObject</span><span class="o">(</span>
  <span class="k">new</span> <span class="n">GetObjectRequest</span><span class="o">(</span><span class="s">&quot;test-1&quot;</span><span class="o">,</span> <span class="s">&quot;doc.txt&quot;</span><span class="o">)</span>
<span class="o">);</span>
<span class="n">InputStream</span> <span class="n">input</span> <span class="o">=</span> <span class="n">obj</span><span class="o">.</span><span class="na">getObjectContent</span><span class="o">();</span>
<span class="n">String</span> <span class="n">content</span> <span class="o">=</span> <span class="n">IOUtils</span><span class="o">.</span><span class="na">toString</span><span class="o">(</span><span class="n">input</span><span class="o">,</span> <span class="s">&quot;UTF-8&quot;</span><span class="o">);</span>
<span class="n">input</span><span class="o">.</span><span class="na">close</span><span class="o">();</span></code></pre></figure> <figure class='badge'><img src='http://img.jcabi.com/logo-square.svg' style='width:64px;max-width:100%;' alt='badge'/></figure><p>As always, procedural programming has its inevitable disadvantages. To overcome them all, I designed <a href="http://s3.jcabi.com">jcabi-s3</a>, which is a small object-oriented adapter for Amazon SDK. This is how the same object-reading task can be accomplished with <a href="http://s3.jcabi.com">jcabi-s3</a>:</p><figure class="highlight"><pre><code class="language-java" data-lang="java"><span></span><span class="n">Region</span> <span class="n">region</span> <span class="o">=</span> <span class="k">new</span> <span class="n">Region</span><span class="o">.</span><span class="na">Simple</span><span class="o">(</span><span class="n">key</span><span class="o">,</span> <span class="n">secret</span><span class="o">);</span>
<span class="n">Bucket</span> <span class="n">bucket</span> <span class="o">=</span> <span class="n">region</span><span class="o">.</span><span class="na">bucket</span><span class="o">(</span><span class="s">&quot;test-1&quot;</span><span class="o">);</span>
<span class="n">Ocket</span> <span class="n">ocket</span> <span class="o">=</span> <span class="n">bucket</span><span class="o">.</span><span class="na">ocket</span><span class="o">(</span><span class="s">&quot;doc.txt&quot;</span><span class="o">);</span>
<span class="n">String</span> <span class="n">content</span> <span class="o">=</span> <span class="k">new</span> <span class="n">Ocket</span><span class="o">.</span><span class="na">Text</span><span class="o">(</span><span class="n">ocket</span><span class="o">).</span><span class="na">read</span><span class="o">();</span></code></pre></figure><p>Why is this approach better? Well, there are a number of obvious advantages.</p><h2 id="s3-object-is-an-object-in-java">S3 Object is an Object in Java</h2><p>S3 object get its representative in Java. It is not a collection of procedures to be called in order to get its properties (as with AWS SDK). Rather, it is a Java object with certain behaviors. I called them &quot;ockets&quot; (similar to &quot;buckets&quot;), in order to avoid clashes with <code>java.lang.Object</code>.</p><p><a href="http://s3.jcabi.com/apidocs-0.5/com/jcabi/s3/Ocket.html"><code>Ocket</code></a> is an interface, that exposes the behavior of a real AWS S3 object: read, write, check existence. There is also a convenient decorator <code>Ocket.Text</code> that simplifies working with binary objects:</p><figure class="highlight"><pre><code class="language-java" data-lang="java"><span></span><span class="n">Ocket</span><span class="o">.</span><span class="na">Text</span> <span class="n">ocket</span> <span class="o">=</span> <span class="k">new</span> <span class="n">Ocket</span><span class="o">.</span><span class="na">Text</span><span class="o">(</span><span class="n">ocket_from_s3</span><span class="o">);</span>
<span class="k">if</span> <span class="o">(</span><span class="n">ocket</span><span class="o">.</span><span class="na">exists</span><span class="o">())</span> <span class="o">{</span>
  <span class="n">System</span><span class="o">.</span><span class="na">out</span><span class="o">.</span><span class="na">print</span><span class="o">(</span><span class="n">ocket</span><span class="o">.</span><span class="na">read</span><span class="o">());</span>
<span class="o">}</span> <span class="k">else</span> <span class="o">{</span>
  <span class="n">ocket</span><span class="o">.</span><span class="na">write</span><span class="o">(</span><span class="s">&quot;Hello, world!&quot;</span><span class="o">);</span>
<span class="o">}</span></code></pre></figure><p>Now, you can pass an object to another class, instead of giving it your AWS credentials, bucket name, and object name. You simply pass a Java object, which encapsulates all AWS interaction details.</p><h2 id="extendability-through-decoration">Extendability Through Decoration</h2><p>Since <a href="http://s3.jcabi.com">jcabi-s3</a> exposes all entities as interfaces, they can easily be extended through encapsulation (<a href="http://en.wikipedia.org/wiki/Decorator_pattern">Decorator Pattern</a>).</p><p>For example, you want your code to retry S3 object read operations a few times before giving up and <a href="/2015/12/01/rethrow-exceptions.html">throwing</a> an <code>IOException</code> (by the way, this is a very good practice when working with web services). So, you want all your S3 reading operations to be redone a few times if first attempts fail.</p><p>You define a new decorator class, say, <code>RetryingOcket</code>, which encapsulates an original <code>Ocket</code>:</p><figure class="highlight"><pre><code class="language-java" data-lang="java"><span></span><span class="kd">public</span> <span class="n">RetryingOcket</span> <span class="kd">implements</span> <span class="n">Ocket</span> <span class="o">{</span>
  <span class="kd">private</span> <span class="kd">final</span> <span class="n">Ocket</span> <span class="n">origin</span><span class="o">;</span>
  <span class="kd">public</span> <span class="nf">RetryingOcket</span><span class="o">(</span><span class="n">Ocket</span> <span class="n">ocket</span><span class="o">)</span> <span class="o">{</span>
    <span class="k">this</span><span class="o">.</span><span class="na">origin</span> <span class="o">=</span> <span class="n">ocket</span><span class="o">;</span>
  <span class="o">}</span>
  <span class="nd">@Override</span>
  <span class="kd">public</span> <span class="kt">void</span> <span class="nf">read</span><span class="o">(</span><span class="n">OutputStream</span> <span class="n">stream</span><span class="o">)</span> <span class="kd">throws</span> <span class="n">IOException</span> <span class="o">{</span>
    <span class="kt">int</span> <span class="n">attempt</span> <span class="o">=</span> <span class="mi">0</span><span class="o">;</span>
    <span class="k">while</span> <span class="o">(</span><span class="kc">true</span><span class="o">)</span> <span class="o">{</span>
      <span class="k">try</span> <span class="o">{</span>
        <span class="k">this</span><span class="o">.</span><span class="na">origin</span><span class="o">.</span><span class="na">read</span><span class="o">(</span><span class="n">stream</span><span class="o">);</span>
      <span class="o">}</span> <span class="k">catch</span> <span class="o">(</span><span class="n">IOException</span> <span class="n">ex</span><span class="o">)</span> <span class="o">{</span>
        <span class="k">if</span> <span class="o">(</span><span class="n">attempt</span><span class="o">++</span> <span class="o">&gt;</span> <span class="mi">3</span><span class="o">)</span> <span class="o">{</span>
          <span class="k">throw</span> <span class="n">ex</span><span class="o">;</span>
        <span class="o">}</span>
      <span class="o">}</span>
    <span class="o">}</span>
  <span class="o">}</span>
  <span class="c1">// same for other methods</span>
<span class="o">}</span></code></pre></figure><p>Now, everywhere where <code>Ocket</code> is expected you send an instance of <code>RetryingOcket</code> that wraps your original object:</p><figure class="highlight"><pre><code class="language-java" data-lang="java"><span></span><span class="n">foo</span><span class="o">.</span><span class="na">process</span><span class="o">(</span><span class="k">new</span> <span class="n">RetryingOcket</span><span class="o">(</span><span class="n">ocket</span><span class="o">));</span></code></pre></figure><p>Method <code>foo.process()</code> won&#39;t see a difference, since it is the same <code>Ocket</code> interface it is expecting.</p><p>By the way, this retry functionality is implemented out-of-the-box in <a href="http://s3.jcabi.com">jcabi-s3</a>, in <a href="http://s3.jcabi.com/apidocs-0.5/com/jcabi/s3/retry/package-summary.html"><code>com.jcabi.s3.retry</code></a> package.</p><h2 id="easy-mocking">Easy Mocking</h2><p>Again, due to the fact that all entities in <a href="http://s3.jcabi.com">jcabi-s3</a> are interfaces, they are very easy to mock. For example, your class expects an S3 object, reads its data and calculates the MD5 hash (I&#39;m using <a href="http://commons.apache.org/proper/commons-codec/apidocs/org/apache/commons/codec/digest/DigestUtils.html"><code>DigestUtils</code></a> from <a href="http://commons.apache.org/proper/commons-codec/">commons-codec</a>):</p><figure class="highlight"><pre><code class="language-java" data-lang="java"><span></span><span class="kn">import</span> <span class="nn">com.jcabi.s3.Ocket</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">org.apache.commons.codec.digest.DigestUtils</span><span class="o">;</span>
<span class="kd">public</span> <span class="kd">class</span> <span class="nc">S3Md5Hash</span> <span class="o">{</span>
  <span class="kd">private</span> <span class="kd">final</span> <span class="n">Ocket</span> <span class="n">ocket</span><span class="o">;</span>
  <span class="kd">public</span> <span class="nf">S3Md5Hash</span><span class="o">(</span><span class="n">Ocket</span> <span class="n">okt</span><span class="o">)</span> <span class="o">{</span>
    <span class="k">this</span><span class="o">.</span><span class="na">ocket</span> <span class="o">=</span> <span class="n">okt</span><span class="o">;</span>
  <span class="o">}</span>
  <span class="kd">public</span> <span class="nf">hash</span><span class="o">()</span> <span class="kd">throws</span> <span class="n">IOException</span> <span class="o">{</span>
    <span class="n">ByteArrayOutputStream</span> <span class="n">baos</span> <span class="o">=</span> <span class="k">new</span> <span class="n">ByteArrayOutputStream</span><span class="o">();</span>
    <span class="k">this</span><span class="o">.</span><span class="na">ocket</span><span class="o">.</span><span class="na">read</span><span class="o">(</span><span class="n">baos</span><span class="o">);</span>
    <span class="k">return</span> <span class="n">DigestUtils</span><span class="o">.</span><span class="na">md5hex</span><span class="o">(</span><span class="n">baos</span><span class="o">.</span><span class="na">toByteArray</span><span class="o">());</span>
  <span class="o">}</span>
<span class="o">}</span></code></pre></figure><p>Here is how simple a unit test will look (try to create a unit test for a class using AWS SDK and you will see the difference):</p><figure class="highlight"><pre><code class="language-java" data-lang="java"><span></span><span class="kn">import</span> <span class="nn">com.jcabi.s3.Ocket</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">org.junit.Test</span><span class="o">;</span>
<span class="kd">public</span> <span class="kd">class</span> <span class="nc">S3Md5HashTest</span> <span class="o">{</span>
  <span class="nd">@Test</span>
  <span class="kd">public</span> <span class="kt">void</span> <span class="nf">generatesHash</span><span class="o">()</span> <span class="o">{</span>
    <span class="n">Ocket</span> <span class="n">ocket</span> <span class="o">=</span> <span class="n">Mockito</span><span class="o">.</span><span class="na">mock</span><span class="o">(</span><span class="n">Ocket</span><span class="o">.</span><span class="na">class</span><span class="o">);</span>
    <span class="n">Mockito</span><span class="o">.</span><span class="na">doAnswer</span><span class="o">(</span>
      <span class="k">new</span> <span class="n">Answer</span><span class="o">&lt;</span><span class="n">Void</span><span class="o">&gt;()</span> <span class="o">{</span>
        <span class="kd">public</span> <span class="n">Void</span> <span class="nf">answer</span><span class="o">(</span><span class="kd">final</span> <span class="n">InvocationOnMock</span> <span class="n">inv</span><span class="o">)</span> <span class="kd">throws</span> <span class="n">IOException</span> <span class="o">{</span>
          <span class="n">OutputStream</span><span class="o">.</span><span class="na">class</span><span class="o">.</span><span class="na">cast</span><span class="o">(</span><span class="n">inv</span><span class="o">.</span><span class="na">getArguments</span><span class="o">()[</span><span class="mi">0</span><span class="o">]).</span><span class="na">write</span><span class="o">(</span><span class="sc">&#39; &#39;</span><span class="o">);</span>
        <span class="o">}</span>
      <span class="o">}</span>
    <span class="o">).</span><span class="na">when</span><span class="o">(</span><span class="n">ocket</span><span class="o">).</span><span class="na">read</span><span class="o">(</span><span class="n">Mockito</span><span class="o">.</span><span class="na">any</span><span class="o">(</span><span class="n">OutputStream</span><span class="o">.</span><span class="na">class</span><span class="o">));</span>
    <span class="n">String</span> <span class="n">hash</span> <span class="o">=</span> <span class="k">new</span> <span class="n">S5Md5Hash</span><span class="o">(</span><span class="n">ocket</span><span class="o">);</span>
    <span class="n">Assert</span><span class="o">.</span><span class="na">assertEquals</span><span class="o">(</span><span class="n">hash</span><span class="o">,</span> <span class="s">&quot;7215ee9c7d9dc229d2921a40e899ec5f&quot;</span><span class="o">);</span>
  <span class="o">}</span>
<span class="o">}</span></code></pre></figure><p>I&#39;m using <a href="http://junit.org/">JUnit</a> and <a href="https://code.google.com/p/mockito/">Mockito</a> in this test.</p><h2 id="immutability">Immutability</h2><p>All classes in <a href="http://s3.jcabi.com">jcabi-s3</a> are annotated with <a href="http://aspects.jcabi.com/annotation-immutable.html"><code>@Immutable</code></a> and are truly immutable.</p><p>The library ships as a JAR dependency in <a href="http://repo1.maven.org/maven2/com/jcabi/jcabi-s3">Maven Central</a> (get its latest versions in <a href="http://search.maven.org/">Maven Central</a>):</p><figure class="highlight"><pre><code class="language-xml" data-lang="xml"><span></span><span class="nt">&lt;dependency&gt;</span>
  <span class="nt">&lt;groupId&gt;</span>com.jcabi<span class="nt">&lt;/groupId&gt;</span>
  <span class="nt">&lt;artifactId&gt;</span>jcabi-s3<span class="nt">&lt;/artifactId&gt;</span>
<span class="nt">&lt;/dependency&gt;</span></code></pre></figure><p>As always, your comments and criticism are welcome as <a href="https://github.com/jcabi/jcabi-s3/issues">GitHub issues</a>.</p></div></article></div><div class="wrapper"> <related-posts /></div><div class="disqus" role="complementary"><p class="disqus_hint"> Please, use <a href="https://help.disqus.com/commenting/what-html-tags-are-allowed-within-comments">syntax highlighting</a> in your comments, to make them more readable.</p><div id="disqus_thread" class="disqus-thread"> <a>&nbsp;</a></div><script> var disqus_config = function () { this.page.url = document.location.href.split('?')[0].split('#')[0].replace('https://', 'http://'); this.page.identifier = this.page.url; }; (function() { var d = document, s = d.createElement('script'); s.src = '//yegor256.disqus.com/embed.js'; s.setAttribute('data-timestamp', +new Date()); (d.head || d.body).appendChild(s); })(); </script> <noscript><div><p class="red"> JavaScript is disabled in your browser, that's why you can't see comments under this post.</p></div></noscript></div><div class="wrapper"> <footer class="footer"><p> &copy; <span itemscope="" itemprop="copyrightHolder" itemtype="http://schema.org/Person"> <span itemprop="name">Yegor Bugayenko</span> </span> 2014&ndash;<span itemprop="copyrightYear">2018</span></p></footer></div></section><div class="wrapper unprintable" style="text-align:center;margin-top:2em;"> <a href="http://www.sixnines.io/h/3ba1652f"> <img src="//www.sixnines.io/b/3ba1652f?style=flat" alt="sixnines availability badge"/> </a></div><script src="//code.jquery.com/jquery-1.9.0.min.js"></script> <script src="/js/all.js?4e047f6f42b"></script> <script>var disqus_shortname = 'yegor256';</script> <script id="dsq-count-scr" src="//yegor256.disqus.com/count.js" async="async"></script> <script> (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){ (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o), m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m) })(window,document,'script','//www.google-analytics.com/analytics.js','ga'); ga('create', 'UA-1963507-32', 'auto'); ga('send', 'pageview'); </script> <script> Cd=document;Cr="&"+Math.random();Cp="&s=1"; Cd.cookie="b=b";if(Cd.cookie)Cp+="&c=1"; Cp+="&t="+(new Date()).getTimezoneOffset(); if(self!=top)Cp+="&f=1"; </script> <script> if(navigator.javaEnabled())Cp+="&j=1"; </script> <script> if(typeof(screen)!='undefined')Cp+="&w="+screen.width+"&h="+ screen.height+"&d="+(screen.colorDepth?screen.colorDepth:screen.pixelDepth); </script> <script> Cd.write("<img src='//c.hit.ua/hit?i=95870&g=0&x=2"+Cp+Cr+ "&r="+escape(Cd.referrer)+"&u="+escape(window.location.href)+ "' border='0' wi"+"dth='1' he"+"ight='1'/>"); </script> <script type="application/ld+json"> { "@context": "http://schema.org", "@type": "Person", "name": "Yegor Bugayenko", "url": "http://www.yegor256.com", "sameAs": [ "https://www.facebook.com/yegor256", "https://instagram.com/yegor256", "https://www.linkedin.com/in/yegor256", "https://twitter.com/yegor256", "https://github.com/yegor256", "https://www.pinterest.com/yegor256/" ] } </script> </body> </html> <!DOCTYPE html> <html xmlns="http://www.w3.org/1999/xhtml" lang="en-US" xml:lang="en-US" itemscope="" itemtype="http://schema.org/WebSite"> <head> <meta charset="utf-8"/> <meta name="description" content="Using static logger is a very common practice in Java, which pollutes the code and is a noise, which can easily be eliminated by using jcabi-log " /> <meta name="keywords" content="java log4j, java logging, java slf4j, java static logger, java static logger property, java util logging, simple logging java" /> <meta name="viewport" content="width=device-width,minimum-scale=1,initial-scale=1"/> <meta name="google-site-verification" content="JEj_gQr2CPe2QKGw8XdMz0R7VboQIUbX3FlM-lwTq-8" /> <meta name="author" content="Yegor Bugayenko"> <meta name="article:published_time" content="2014-05-23 00:00:00 +0000"> <meta name="og:site_name" content="Yegor Bugayenko"/> <meta name="og:type" content="article" /> <meta name="og:locale" content="en_US" /> <meta name="twitter:account_id" content="4503599630178231" /> <meta name="twitter:creator" content="@yegor256"/> <meta name="twitter:site" content="@yegor256"/> <meta name="twitter:title" property="og:title" content="Get Rid of Java Static Loggers"/> <meta name="twitter:description" property="og:description" content="Using static logger is a very common practice in Java, which pollutes the code and is a noise, which can easily be eliminated by using jcabi-log "/> <meta name="twitter:url" property="og:url" content="https://www.yegor256.com/2014/05/23/avoid-java-static-logger.html"/> <meta name="telegram:channel" content="AAAAAEJFMRzsRTRxM3ec6A"/> <link rel="search" type="application/opensearchdescription+xml" href="/opensearch.xml" title="yegor256" /> <link rel="shortcut icon" href="/favicon.ico?4e047f6f42b"/> <link rel="apple-touch-icon" href="/favicon.ico?4e047f6f42b"/> <link rel="alternate" type="application/rss+xml" title="RSS for yegor256.com" href="https://www.yegor256.com/rss.xml"/> <link rel="stylesheet" href="/css/layout.css?4e047f6f42b"/> <link rel="stylesheet" href="/css/icons.css?4e047f6f42b"/> <link rel="canonical" href="https://www.yegor256.com/2014/05/23/avoid-java-static-logger.html" /> <link rel="amphtml" href="https://www.yegor256.com/2014/05/23/avoid-java-static-logger.amp.html" /> <title>Get Rid of Java Static Loggers </title> </head> <body><div class="wrapper"> <aside class="header-toggle unprintable" id="header-toggle" title="Show the menu" onclick="$('#header').show();$('#header-toggle').hide();">&#9776;</aside> <header class="header" id="header"><div class="face"> <a href="/about-me.html#form" class="sub" title="Click to subscribe to my monthly newsletter"><span>Subscribe</span></a> <a href="/about-me.html" style="position:relative;"> <img src="/images/face-256x256.jpg" class="photo" alt="Yegor Bugayenko"/> </a></div><nav><ul class="menu social notranslate"> <li><a href="https://twitter.com/intent/follow?screen_name=yegor256" rel="nofollow" title="Follow me on Twitter"><i class="icon icon-twitter notranslate" aria-hidden="true"></i></a></li> <li><a href="/rss.xml" rel="nofollow" title="Subscribe to my RSS feed"><i class="icon icon-rss notranslate" aria-hidden="true"></i></a></li> <li><a itemprop="sameAs" href="https://github.com/yegor256" rel="nofollow" title="My GitHub profile"><i class="icon icon-github notranslate" aria-hidden="true"></i></a></li> <li><a itemprop="sameAs" href="http://stackoverflow.com/users/187141/yegor256" rel="nofollow" title="My StackOverflow profile"><i class="icon icon-stackoverflow notranslate" aria-hidden="true"></i></a></li> <li><a itemprop="sameAs" href="https://www.facebook.com/yegor256" rel="nofollow" title="Follow me on Facebook"><i class="icon icon-facebook notranslate" aria-hidden="true"></i></a></li> <li><a itemprop="sameAs" href="https://instagram.com/yegor256" rel="nofollow" title="Follow me on Instagram"><i class="icon icon-instagram notranslate" aria-hidden="true"></i></a></li> <li><a itemprop="sameAs" href="https://www.linkedin.com/in/yegor256" rel="nofollow" title="My LinkedIn profile"><i class="icon icon-linkedin notranslate" aria-hidden="true"></i></a></li> <li><a itemprop="sameAs" href="https://www.youtube.com/c/yegor256?sub_confirmation=1" rel="nofollow" title="My Youtube video channel"><i class="icon icon-youtube notranslate" aria-hidden="true"></i></a></li> <li><a itemprop="sameAs" href="https://www.pinterest.com/yegor256/" rel="nofollow" title="My Pinterest boards"><i class="icon icon-pinterest notranslate" aria-hidden="true"></i></a></li> <li><a itemprop="sameAs" href="https://angel.co/yegor256" rel="nofollow" title="My AngelList profile"><i class="icon icon-angellist notranslate" aria-hidden="true"></i></a></li> <li><a href="https://soundcloud.com/yegor256" rel="nofollow" title="My podcast"><i class="icon icon-podcast notranslate" aria-hidden="true"></i></a></li> <li><a href="https://itunes.apple.com/us/podcast/yegor256-podcast/id1150826721" rel="nofollow" title="My iTunes podcast"><i class="icon icon-itunes notranslate" aria-hidden="true"></i></a></li> <li><a href="https://t.me/joinchat/AAAAAEJFMRzsRTRxM3ec6A" rel="nofollow" title="My Telegram public channel"><i class="icon icon-telegram notranslate" aria-hidden="true"></i></a></li> <li><a href="mailto:blog@yegor256.com" rel="nofollow" title="Email me any time"><i class="icon icon-mail notranslate" aria-hidden="true"></i></a></li></ul><ul class="menu"> <li><a href="/" title="Home page">Home</a></li> <li ><a href="/best.html" title="Best articles to read">12&#160;Best</a></li> <li ><a href="/contents.html" title="The contents of the entire blog">All&#160;288</a></li> <li ><a href="/webinars.html" title="My webinars">Webinars</a></li> <li ><a href="/talks.html" title="Future and past conference talks">Talks</a></li> <li ><a href="/books.html" title="The books I wrote">Books</a></li> <li ><a href="/papers.html" title="My academic papers and patents">Papers</a></li> <li ><a href="/pets.html" title="My loved pet projects">Pets</a></li> <li ><a href="/award.html" title="Software quality award">Award</a></li> <li ><a href="/testimonials.html" title="What some people say about me">Testimonials</a></li> <li ><a href="/shift-m.html" title="Audio podcast about project management">Shift-M</a></li> <li ><a href="/paintings.html" title="My paintings for sale">Paintings</a></li> <li><a href="http://ru.yegor256.com/" title="Немного на русском языке">По-русски</a></li></ul></nav><div class="search"> <form method="get" action="https://www.google.com/search" itemprop="potentialAction" itemscope="" itemtype="http://schema.org/SearchAction"> <meta itemprop="target" content="https://www.google.com/search?q={q}"/> <input name="sitesearch" value="yegor256.com" type="hidden"/> <input itemprop="query-input" type="text" id="search-query" class="field field-text" required="required" onfocus="$('.google').css('visibility', 'visible');" name="q" placeholder="Search..." autocomplete="off"/> <input type="image" src="/images/google-search-icon.svg" class="google" title="Search via Google" alt="Search via Google"/> </form></div><div class="hot"><ul> <li> <a href="/code-ahead.html">Code Ahead</a> was published on Amazon just a few days ago! It is my new book, a novel about programmers. It explains in details the majority of ideas that stand behind <a href="https://www.zerocracy.com">Zerocracy</a> and <a href="https://www.xdsd.org">XDSD</a>. </li> <li> At <a href="/webinars.html">Webinar #37</a> we will discuss naming problem in OOP, for objects, methods and attributes; join us on <b>September 12</b>, at 11am PST. </li></ul></div></header></div><section itemscope="" itemtype="http://schema.org/BlogPosting"><div class="wrapper"> <header><p class="printable"> <img src="https://api.qrserver.com/v1/create-qr-code/?data=https://www.yegor256.com/2014/05/23/avoid-java-static-logger.html&amp;format=svg" style="width:125px;height:125px;" alt="QR code"/></p><p class="printable"> <code itemprop="url">https://www.yegor256.com/2014/05/23/avoid-java-static-logger.html</code></p><h1 itemprop="name headline mainEntityOfPage">Get Rid of Java Static Loggers</h1><ul class="subline"> <li> <time itemprop="datePublished" datetime="2014-05-23T00:00:00+00:00"> 23 May 2014 </time> </li> <li class="printable" itemscope="" itemprop="author" itemtype="http://schema.org/Person"> <span itemprop="name">Yegor Bugayenko</span> </li> <li class="unprintable"> <i class="icon icon-comments"></i> <a href="http://www.yegor256.com/2014/05/23/avoid-java-static-logger.html#disqus_thread" itemprop="discussionUrl">comments</a> </li></ul><p>This static <code>LOGGER</code> property has to be declared in every class where logging is required. Just a few lines of code, but this is pure noise, as I see it.</p><figure class='badge'><a href='http://log.jcabi.com'><img src='http://img.jcabi.com/logo-square.svg' style='width:64px;max-width:100%;' alt='badge'/></a></figure><p>To make life easier, I created a library about two years ago, <a href="http://log.jcabi.com">jcabi-log</a>, which has a convenient utility class <a href="http://log.jcabi.com/apidocs-0.12.2/com/jcabi/log/Logger.html"><code>Logger</code></a> (yes, I know that <a href="/2014/05/05/oop-alternative-to-utility-classes.html">utility classes are evil</a>).</p><figure class="highlight"><pre><code class="language-java" data-lang="java"><span></span><span class="kn">import</span> <span class="nn">com.jcabi.log.Logger</span><span class="o">;</span>
<span class="kd">public</span> <span class="kd">class</span> <span class="nc">Foo</span> <span class="o">{</span>
  <span class="kd">public</span> <span class="kt">void</span> <span class="nf">save</span><span class="o">(</span><span class="n">String</span> <span class="n">file</span><span class="o">)</span> <span class="o">{</span>
    <span class="c1">// save the file</span>
    <span class="n">Logger</span><span class="o">.</span><span class="na">info</span><span class="o">(</span><span class="k">this</span><span class="o">,</span> <span class="s">&quot;file %s saved successfuly&quot;</span><span class="o">,</span> <span class="n">file</span><span class="o">);</span>
  <span class="o">}</span>
<span class="o">}</span></code></pre></figure><p>This looks much cleaner to me and does exactly the same---sends a single log line to the SLF4J logging facility. Besides, it check automatically whether a given logging level is enabled (for performance optimization) and formats the given string using <a href="http://docs.oracle.com/javase/7/docs/api/java/util/Formatter.html"><code>Formatter</code></a> (same as <a href="http://docs.oracle.com/javase/7/docs/api/java/lang/String.html#format%28java.lang.String,+java.lang.Object...%29"><code>String.format()</code></a>).</p><p>For convenience, there are also a number of &quot;<a href="http://log.jcabi.com/decors.html">decors</a>&quot; implemented in the library.</p><p>The library ships as a JAR dependency in <a href="http://repo1.maven.org/maven2/com/jcabi/jcabi-log">Maven Central</a> (get its latest versions in <a href="http://search.maven.org/">Maven Central</a>):</p><figure class="highlight"><pre><code class="language-xml" data-lang="xml"><span></span><span class="nt">&lt;dependency&gt;</span>
  <span class="nt">&lt;groupId&gt;</span>com.jcabi<span class="nt">&lt;/groupId&gt;</span>
  <span class="nt">&lt;artifactId&gt;</span>jcabi-log<span class="nt">&lt;/artifactId&gt;</span>
<span class="nt">&lt;/dependency&gt;</span></code></pre></figure></p>--> <nav class="buttons notranslate desktop-only"> <a href="http://www.facebook.com/sharer/sharer.php?u=https://www.yegor256.com/2014/05/23/avoid-java-static-logger.html" title="Share on Facebook" class="button" rel="nofollow"> <span class="count count-facebook">0</span> <i class="icon icon-facebook notranslate" aria-hidden="true"></i> </a> <a href="https://twitter.com/share?url=https://www.yegor256.com/2014/05/23/avoid-java-static-logger.html&amp;text=Get+Rid+of+Java+Static+Loggers" title="Share on Twitter" class="button" rel="nofollow"> <span class="count count-twitter">0</span> <i class="icon icon-twitter notranslate" aria-hidden="true"></i> </a> <a href="https://plus.google.com/share?url=https://www.yegor256.com/2014/05/23/avoid-java-static-logger.html" title="Share on Google+" class="button" rel="nofollow"> <span class="count count-googleplus">0</span> <i class="icon icon-googleplus notranslate" aria-hidden="true"></i> </a> <a href="https://www.linkedin.com/cws/share?url=https://www.yegor256.com/2014/05/23/avoid-java-static-logger.html" title="Share on LinkedIn" class="button" rel="nofollow"> <span class="count count-linkedin">0</span> <i class="icon icon-linkedin notranslate" aria-hidden="true"></i> </a> <a href="http://reddit.com/submit?url=https://www.yegor256.com/2014/05/23/avoid-java-static-logger.html%3F2014-20&amp;title=Get+Rid+of+Java+Static+Loggers" title="Share on Reddit" class="button" rel="nofollow"> <span class="count count-reddit">0</span> <i class="icon icon-reddit notranslate" aria-hidden="true"></i> </a> <a href="http://news.ycombinator.com/submitlink?u=https://www.yegor256.com/2014/05/23/avoid-java-static-logger.html%3F2014-20&amp;t=Get+Rid+of+Java+Static+Loggers" title="Share on Hacker News" class="button" rel="nofollow"> <span class="count count-hackernews">0</span> <i class="icon icon-hackernews notranslate" aria-hidden="true"></i> </a> </nav> </header> <article class="main" itemprop="articleBody"><div ><p>This is a very common practice in Java (using <a href="http://www.slf4j.org/apidocs/org/slf4j/LoggerFactory.html"><code>LoggerFactory</code></a> from <a href="http://www.slf4j.org/">slf4j</a>):</p><figure class="highlight"><pre><code class="language-java" data-lang="java"><span></span><span class="kn">import</span> <span class="nn">org.slf4j.LoggerFactory</span><span class="o">;</span>
<span class="kd">public</span> <span class="kd">class</span> <span class="nc">Foo</span> <span class="o">{</span>
  <span class="kd">private</span> <span class="kd">static</span> <span class="kd">final</span> <span class="n">Logger</span> <span class="n">LOGGER</span> <span class="o">=</span>
    <span class="n">LoggerFactory</span><span class="o">.</span><span class="na">getLogger</span><span class="o">(</span><span class="n">Foo</span><span class="o">.</span><span class="na">class</span><span class="o">);</span>
  <span class="kd">public</span> <span class="kt">void</span> <span class="nf">save</span><span class="o">(</span><span class="n">String</span> <span class="n">file</span><span class="o">)</span> <span class="o">{</span>
    <span class="c1">// save the file</span>
    <span class="k">if</span> <span class="o">(</span><span class="n">Foo</span><span class="o">.</span><span class="na">LOGGER</span><span class="o">.</span><span class="na">isInfoEnabled</span><span class="o">())</span> <span class="o">{</span>
      <span class="n">Foo</span><span class="o">.</span><span class="na">LOGGER</span><span class="o">.</span><span class="na">info</span><span class="o">(</span><span class="s">&quot;file {} saved successfuly&quot;</span><span class="o">,</span> <span class="n">file</span><span class="o">);</span>
    <span class="o">}</span>
  <span class="o">}</span>
<span class="o">}</span></code></pre></figure><p>What&#39;s wrong with it? Code duplication.</p><p>This static <code>LOGGER</code> property has to be declared in every class where logging is required. Just a few lines of code, but this is pure noise, as I see it.</p><figure class='badge'><a href='http://log.jcabi.com'><img src='http://img.jcabi.com/logo-square.svg' style='width:64px;max-width:100%;' alt='badge'/></a></figure><p>To make life easier, I created a library about two years ago, <a href="http://log.jcabi.com">jcabi-log</a>, which has a convenient utility class <a href="http://log.jcabi.com/apidocs-0.12.2/com/jcabi/log/Logger.html"><code>Logger</code></a> (yes, I know that <a href="/2014/05/05/oop-alternative-to-utility-classes.html">utility classes are evil</a>).</p><figure class="highlight"><pre><code class="language-java" data-lang="java"><span></span><span class="kn">import</span> <span class="nn">com.jcabi.log.Logger</span><span class="o">;</span>
<span class="kd">public</span> <span class="kd">class</span> <span class="nc">Foo</span> <span class="o">{</span>
  <span class="kd">public</span> <span class="kt">void</span> <span class="nf">save</span><span class="o">(</span><span class="n">String</span> <span class="n">file</span><span class="o">)</span> <span class="o">{</span>
    <span class="c1">// save the file</span>
    <span class="n">Logger</span><span class="o">.</span><span class="na">info</span><span class="o">(</span><span class="k">this</span><span class="o">,</span> <span class="s">&quot;file %s saved successfuly&quot;</span><span class="o">,</span> <span class="n">file</span><span class="o">);</span>
  <span class="o">}</span>
<span class="o">}</span></code></pre></figure><p>This looks much cleaner to me and does exactly the same---sends a single log line to the SLF4J logging facility. Besides, it check automatically whether a given logging level is enabled (for performance optimization) and formats the given string using <a href="http://docs.oracle.com/javase/7/docs/api/java/util/Formatter.html"><code>Formatter</code></a> (same as <a href="http://docs.oracle.com/javase/7/docs/api/java/lang/String.html#format%28java.lang.String,+java.lang.Object...%29"><code>String.format()</code></a>).</p><p>For convenience, there are also a number of &quot;<a href="http://log.jcabi.com/decors.html">decors</a>&quot; implemented in the library.</p><p>The library ships as a JAR dependency in <a href="http://repo1.maven.org/maven2/com/jcabi/jcabi-log">Maven Central</a> (get its latest versions in <a href="http://search.maven.org/">Maven Central</a>):</p><figure class="highlight"><pre><code class="language-xml" data-lang="xml"><span></span><span class="nt">&lt;dependency&gt;</span>
  <span class="nt">&lt;groupId&gt;</span>com.jcabi<span class="nt">&lt;/groupId&gt;</span>
  <span class="nt">&lt;artifactId&gt;</span>jcabi-log<span class="nt">&lt;/artifactId&gt;</span>
<span class="nt">&lt;/dependency&gt;</span></code></pre></figure></div></article></div><div class="wrapper"> <related-posts /></div><div class="disqus" role="complementary"><p class="disqus_hint"> Please, use <a href="https://help.disqus.com/commenting/what-html-tags-are-allowed-within-comments">syntax highlighting</a> in your comments, to make them more readable.</p><div id="disqus_thread" class="disqus-thread"> <a>&nbsp;</a></div><script> var disqus_config = function () { this.page.url = document.location.href.split('?')[0].split('#')[0].replace('https://', 'http://'); this.page.identifier = this.page.url; }; (function() { var d = document, s = d.createElement('script'); s.src = '//yegor256.disqus.com/embed.js'; s.setAttribute('data-timestamp', +new Date()); (d.head || d.body).appendChild(s); })(); </script> <noscript><div><p class="red"> JavaScript is disabled in your browser, that's why you can't see comments under this post.</p></div></noscript></div><div class="wrapper"> <footer class="footer"><p> &copy; <span itemscope="" itemprop="copyrightHolder" itemtype="http://schema.org/Person"> <span itemprop="name">Yegor Bugayenko</span> </span> 2014&ndash;<span itemprop="copyrightYear">2018</span></p></footer></div></section><div class="wrapper unprintable" style="text-align:center;margin-top:2em;"> <a href="http://www.sixnines.io/h/3ba1652f"> <img src="//www.sixnines.io/b/3ba1652f?style=flat" alt="sixnines availability badge"/> </a></div><script src="//code.jquery.com/jquery-1.9.0.min.js"></script> <script src="/js/all.js?4e047f6f42b"></script> <script>var disqus_shortname = 'yegor256';</script> <script id="dsq-count-scr" src="//yegor256.disqus.com/count.js" async="async"></script> <script> (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){ (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o), m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m) })(window,document,'script','//www.google-analytics.com/analytics.js','ga'); ga('create', 'UA-1963507-32', 'auto'); ga('send', 'pageview'); </script> <script> Cd=document;Cr="&"+Math.random();Cp="&s=1"; Cd.cookie="b=b";if(Cd.cookie)Cp+="&c=1"; Cp+="&t="+(new Date()).getTimezoneOffset(); if(self!=top)Cp+="&f=1"; </script> <script> if(navigator.javaEnabled())Cp+="&j=1"; </script> <script> if(typeof(screen)!='undefined')Cp+="&w="+screen.width+"&h="+ screen.height+"&d="+(screen.colorDepth?screen.colorDepth:screen.pixelDepth); </script> <script> Cd.write("<img src='//c.hit.ua/hit?i=95870&g=0&x=2"+Cp+Cr+ "&r="+escape(Cd.referrer)+"&u="+escape(window.location.href)+ "' border='0' wi"+"dth='1' he"+"ight='1'/>"); </script> <script type="application/ld+json"> { "@context": "http://schema.org", "@type": "Person", "name": "Yegor Bugayenko", "url": "http://www.yegor256.com", "sameAs": [ "https://www.facebook.com/yegor256", "https://instagram.com/yegor256", "https://www.linkedin.com/in/yegor256", "https://twitter.com/yegor256", "https://github.com/yegor256", "https://www.pinterest.com/yegor256/" ] } </script> </body> </html> <!DOCTYPE html> <html xmlns="http://www.w3.org/1999/xhtml" lang="en-US" xml:lang="en-US" itemscope="" itemtype="http://schema.org/WebSite"> <head> <meta charset="utf-8"/> <meta name="description" content="jcabi-mysql-maven-plugin starts a fresh instance of MySQL server before integration tests and shuts it down when tests are finished. " /> <meta name="keywords" content="mariadb maven plugin, maven linux mysql, maven mysql java test, maven plugin for mysql, mysql integration testing java, mysql java test, mysql maven, mysql maven plugin" /> <meta name="viewport" content="width=device-width,minimum-scale=1,initial-scale=1"/> <meta name="google-site-verification" content="JEj_gQr2CPe2QKGw8XdMz0R7VboQIUbX3FlM-lwTq-8" /> <meta name="author" content="Yegor Bugayenko"> <meta name="article:published_time" content="2014-05-21 00:00:00 +0000"> <meta name="og:site_name" content="Yegor Bugayenko"/> <meta name="og:type" content="article" /> <meta name="og:locale" content="en_US" /> <meta name="twitter:account_id" content="4503599630178231" /> <meta name="twitter:creator" content="@yegor256"/> <meta name="twitter:site" content="@yegor256"/> <meta name="twitter:title" property="og:title" content="MySQL Maven Plugin"/> <meta name="twitter:description" property="og:description" content="jcabi-mysql-maven-plugin starts a fresh instance of MySQL server before integration tests and shuts it down when tests are finished. "/> <meta name="twitter:url" property="og:url" content="https://www.yegor256.com/2014/05/21/mysql-maven-plugin.html"/> <meta name="telegram:channel" content="AAAAAEJFMRzsRTRxM3ec6A"/> <link rel="search" type="application/opensearchdescription+xml" href="/opensearch.xml" title="yegor256" /> <link rel="shortcut icon" href="/favicon.ico?4e047f6f42b"/> <link rel="apple-touch-icon" href="/favicon.ico?4e047f6f42b"/> <link rel="alternate" type="application/rss+xml" title="RSS for yegor256.com" href="https://www.yegor256.com/rss.xml"/> <link rel="stylesheet" href="/css/layout.css?4e047f6f42b"/> <link rel="stylesheet" href="/css/icons.css?4e047f6f42b"/> <link rel="canonical" href="https://www.yegor256.com/2014/05/21/mysql-maven-plugin.html" /> <link rel="amphtml" href="https://www.yegor256.com/2014/05/21/mysql-maven-plugin.amp.html" /> <title>MySQL Maven Plugin </title> </head> <body><div class="wrapper"> <aside class="header-toggle unprintable" id="header-toggle" title="Show the menu" onclick="$('#header').show();$('#header-toggle').hide();">&#9776;</aside> <header class="header" id="header"><div class="face"> <a href="/about-me.html#form" class="sub" title="Click to subscribe to my monthly newsletter"><span>Subscribe</span></a> <a href="/about-me.html" style="position:relative;"> <img src="/images/face-256x256.jpg" class="photo" alt="Yegor Bugayenko"/> </a></div><nav><ul class="menu social notranslate"> <li><a href="https://twitter.com/intent/follow?screen_name=yegor256" rel="nofollow" title="Follow me on Twitter"><i class="icon icon-twitter notranslate" aria-hidden="true"></i></a></li> <li><a href="/rss.xml" rel="nofollow" title="Subscribe to my RSS feed"><i class="icon icon-rss notranslate" aria-hidden="true"></i></a></li> <li><a itemprop="sameAs" href="https://github.com/yegor256" rel="nofollow" title="My GitHub profile"><i class="icon icon-github notranslate" aria-hidden="true"></i></a></li> <li><a itemprop="sameAs" href="http://stackoverflow.com/users/187141/yegor256" rel="nofollow" title="My StackOverflow profile"><i class="icon icon-stackoverflow notranslate" aria-hidden="true"></i></a></li> <li><a itemprop="sameAs" href="https://www.facebook.com/yegor256" rel="nofollow" title="Follow me on Facebook"><i class="icon icon-facebook notranslate" aria-hidden="true"></i></a></li> <li><a itemprop="sameAs" href="https://instagram.com/yegor256" rel="nofollow" title="Follow me on Instagram"><i class="icon icon-instagram notranslate" aria-hidden="true"></i></a></li> <li><a itemprop="sameAs" href="https://www.linkedin.com/in/yegor256" rel="nofollow" title="My LinkedIn profile"><i class="icon icon-linkedin notranslate" aria-hidden="true"></i></a></li> <li><a itemprop="sameAs" href="https://www.youtube.com/c/yegor256?sub_confirmation=1" rel="nofollow" title="My Youtube video channel"><i class="icon icon-youtube notranslate" aria-hidden="true"></i></a></li> <li><a itemprop="sameAs" href="https://www.pinterest.com/yegor256/" rel="nofollow" title="My Pinterest boards"><i class="icon icon-pinterest notranslate" aria-hidden="true"></i></a></li> <li><a itemprop="sameAs" href="https://angel.co/yegor256" rel="nofollow" title="My AngelList profile"><i class="icon icon-angellist notranslate" aria-hidden="true"></i></a></li> <li><a href="https://soundcloud.com/yegor256" rel="nofollow" title="My podcast"><i class="icon icon-podcast notranslate" aria-hidden="true"></i></a></li> <li><a href="https://itunes.apple.com/us/podcast/yegor256-podcast/id1150826721" rel="nofollow" title="My iTunes podcast"><i class="icon icon-itunes notranslate" aria-hidden="true"></i></a></li> <li><a href="https://t.me/joinchat/AAAAAEJFMRzsRTRxM3ec6A" rel="nofollow" title="My Telegram public channel"><i class="icon icon-telegram notranslate" aria-hidden="true"></i></a></li> <li><a href="mailto:blog@yegor256.com" rel="nofollow" title="Email me any time"><i class="icon icon-mail notranslate" aria-hidden="true"></i></a></li></ul><ul class="menu"> <li><a href="/" title="Home page">Home</a></li> <li ><a href="/best.html" title="Best articles to read">12&#160;Best</a></li> <li ><a href="/contents.html" title="The contents of the entire blog">All&#160;288</a></li> <li ><a href="/webinars.html" title="My webinars">Webinars</a></li> <li ><a href="/talks.html" title="Future and past conference talks">Talks</a></li> <li ><a href="/books.html" title="The books I wrote">Books</a></li> <li ><a href="/papers.html" title="My academic papers and patents">Papers</a></li> <li ><a href="/pets.html" title="My loved pet projects">Pets</a></li> <li ><a href="/award.html" title="Software quality award">Award</a></li> <li ><a href="/testimonials.html" title="What some people say about me">Testimonials</a></li> <li ><a href="/shift-m.html" title="Audio podcast about project management">Shift-M</a></li> <li ><a href="/paintings.html" title="My paintings for sale">Paintings</a></li> <li><a href="http://ru.yegor256.com/" title="Немного на русском языке">По-русски</a></li></ul></nav><div class="search"> <form method="get" action="https://www.google.com/search" itemprop="potentialAction" itemscope="" itemtype="http://schema.org/SearchAction"> <meta itemprop="target" content="https://www.google.com/search?q={q}"/> <input name="sitesearch" value="yegor256.com" type="hidden"/> <input itemprop="query-input" type="text" id="search-query" class="field field-text" required="required" onfocus="$('.google').css('visibility', 'visible');" name="q" placeholder="Search..." autocomplete="off"/> <input type="image" src="/images/google-search-icon.svg" class="google" title="Search via Google" alt="Search via Google"/> </form></div><div class="hot"><ul> <li> <a href="/code-ahead.html">Code Ahead</a> was published on Amazon just a few days ago! It is my new book, a novel about programmers. It explains in details the majority of ideas that stand behind <a href="https://www.zerocracy.com">Zerocracy</a> and <a href="https://www.xdsd.org">XDSD</a>. </li> <li> At <a href="/webinars.html">Webinar #37</a> we will discuss naming problem in OOP, for objects, methods and attributes; join us on <b>September 12</b>, at 11am PST. </li></ul></div></header></div><section itemscope="" itemtype="http://schema.org/BlogPosting"><div class="wrapper"> <header><p class="printable"> <img src="https://api.qrserver.com/v1/create-qr-code/?data=https://www.yegor256.com/2014/05/21/mysql-maven-plugin.html&amp;format=svg" style="width:125px;height:125px;" alt="QR code"/></p><p class="printable"> <code itemprop="url">https://www.yegor256.com/2014/05/21/mysql-maven-plugin.html</code></p><h1 itemprop="name headline mainEntityOfPage">MySQL Maven Plugin</h1><ul class="subline"> <li> <time itemprop="datePublished" datetime="2014-05-21T00:00:00+00:00"> 21 May 2014 </time> </li> <li class="printable" itemscope="" itemprop="author" itemtype="http://schema.org/Person"> <span itemprop="name">Yegor Bugayenko</span> </li> <li class="unprintable"> <i class="icon icon-comments"></i> <a href="http://www.yegor256.com/2014/05/21/mysql-maven-plugin.html#disqus_thread" itemprop="discussionUrl">comments</a> </li></ul><p>This is how you configure it in <code>pom.xml</code> (see also its full <a href="http://mysql.jcabi.com/usage.html">usage instructions</a>):</p><figure class="highlight"><pre><code class="language-xml" data-lang="xml"><span></span><span class="nt">&lt;project&gt;</span>
  <span class="nt">&lt;build&gt;</span>
    <span class="nt">&lt;plugins&gt;</span>
      <span class="nt">&lt;plugin&gt;</span>
        <span class="nt">&lt;groupId&gt;</span>org.codehaus.mojo<span class="nt">&lt;/groupId&gt;</span>
        <span class="nt">&lt;artifactId&gt;</span>build-helper-maven-plugin<span class="nt">&lt;/artifactId&gt;</span>
        <span class="nt">&lt;executions&gt;</span>
          <span class="nt">&lt;execution&gt;</span>
            <span class="nt">&lt;goals&gt;</span>
              <span class="nt">&lt;goal&gt;</span>reserve-network-port<span class="nt">&lt;/goal&gt;</span>
            <span class="nt">&lt;/goals&gt;</span>
            <span class="nt">&lt;configuration&gt;</span>
              <span class="nt">&lt;portNames&gt;</span>
                <span class="nt">&lt;portName&gt;</span>mysql.port<span class="nt">&lt;/portName&gt;</span>
              <span class="nt">&lt;/portNames&gt;</span>
            <span class="nt">&lt;/configuration&gt;</span>
          <span class="nt">&lt;/execution&gt;</span>
        <span class="nt">&lt;/executions&gt;</span>
      <span class="nt">&lt;/plugin&gt;</span>
      <span class="nt">&lt;plugin&gt;</span>
        <span class="nt">&lt;artifactId&gt;</span>maven-dependency-plugin<span class="nt">&lt;/artifactId&gt;</span>
        <span class="nt">&lt;executions&gt;</span>
          <span class="nt">&lt;execution&gt;</span>
            <span class="nt">&lt;goals&gt;</span>
              <span class="nt">&lt;goal&gt;</span>unpack<span class="nt">&lt;/goal&gt;</span>
            <span class="nt">&lt;/goals&gt;</span>
            <span class="nt">&lt;configuration&gt;</span>
              <span class="nt">&lt;artifactItems&gt;</span>
                <span class="nt">&lt;artifactItem&gt;</span>
                  <span class="nt">&lt;groupId&gt;</span>com.jcabi<span class="nt">&lt;/groupId&gt;</span>
                  <span class="nt">&lt;artifactId&gt;</span>mysql-dist<span class="nt">&lt;/artifactId&gt;</span>
                  <span class="nt">&lt;version&gt;</span>5.6.14<span class="nt">&lt;/version&gt;</span>
                  <span class="nt">&lt;classifier&gt;</span>${mysql.classifier}<span class="nt">&lt;/classifier&gt;</span>
                  <span class="nt">&lt;type&gt;</span>zip<span class="nt">&lt;/type&gt;</span>
                  <span class="nt">&lt;overWrite&gt;</span>false<span class="nt">&lt;/overWrite&gt;</span>
                  <span class="nt">&lt;outputDirectory&gt;</span>
                    ${project.build.directory}/mysql-dist
                  <span class="nt">&lt;/outputDirectory&gt;</span>
                <span class="nt">&lt;/artifactItem&gt;</span>
              <span class="nt">&lt;/artifactItems&gt;</span>
            <span class="nt">&lt;/configuration&gt;</span>
          <span class="nt">&lt;/execution&gt;</span>
        <span class="nt">&lt;/executions&gt;</span>
      <span class="nt">&lt;/plugin&gt;</span>
      <span class="nt">&lt;plugin&gt;</span>
        <span class="nt">&lt;groupId&gt;</span>com.jcabi<span class="nt">&lt;/groupId&gt;</span>
        <span class="nt">&lt;artifactId&gt;</span>jcabi-mysql-maven-plugin<span class="nt">&lt;/artifactId&gt;</span>
        <span class="nt">&lt;executions&gt;</span>
          <span class="nt">&lt;execution&gt;</span>
            <span class="nt">&lt;id&gt;</span>mysql-test<span class="nt">&lt;/id&gt;</span>
            <span class="nt">&lt;goals&gt;</span>
              <span class="nt">&lt;goal&gt;</span>classify<span class="nt">&lt;/goal&gt;</span>
              <span class="nt">&lt;goal&gt;</span>start<span class="nt">&lt;/goal&gt;</span>
              <span class="nt">&lt;goal&gt;</span>stop<span class="nt">&lt;/goal&gt;</span>
            <span class="nt">&lt;/goals&gt;</span>
            <span class="nt">&lt;configuration&gt;</span>
              <span class="nt">&lt;port&gt;</span>${mysql.port}<span class="nt">&lt;/port&gt;</span>
              <span class="nt">&lt;data&gt;</span>${project.build.directory}/mysql-data<span class="nt">&lt;/data&gt;</span>
            <span class="nt">&lt;/configuration&gt;</span>
          <span class="nt">&lt;/execution&gt;</span>
        <span class="nt">&lt;/executions&gt;</span>
      <span class="nt">&lt;/plugin&gt;</span>
      <span class="nt">&lt;plugin&gt;</span>
        <span class="nt">&lt;artifactId&gt;</span>maven-failsafe-plugin<span class="nt">&lt;/artifactId&gt;</span>
        <span class="nt">&lt;configuration&gt;</span>
          <span class="nt">&lt;systemPropertyVariables&gt;</span>
            <span class="nt">&lt;mysql.port&gt;</span>${mysql.port}<span class="nt">&lt;/mysql.port&gt;</span>
          <span class="nt">&lt;/systemPropertyVariables&gt;</span>
        <span class="nt">&lt;/configuration&gt;</span>
        <span class="nt">&lt;executions&gt;</span>
          <span class="nt">&lt;execution&gt;</span>
            <span class="nt">&lt;goals&gt;</span>
              <span class="nt">&lt;goal&gt;</span>integration-test<span class="nt">&lt;/goal&gt;</span>
              <span class="nt">&lt;goal&gt;</span>verify<span class="nt">&lt;/goal&gt;</span>
            <span class="nt">&lt;/goals&gt;</span>
          <span class="nt">&lt;/execution&gt;</span>
        <span class="nt">&lt;/executions&gt;</span>
      <span class="nt">&lt;/plugin&gt;</span>
    <span class="nt">&lt;/plugins&gt;</span>
  <span class="nt">&lt;/build&gt;</span>
  [...]
<span class="nt">&lt;/project&gt;</span></code></pre></figure><p>There are two plugins configured above. Let&#39;s take a look at what each does.</p><ol> <li><p><strong><code>build-helper-maven-plugin</code></strong> is reserving a temporary random TCP port, which will be used by MySQL server. We don&#39;t want to start a server on its default 3306 port, because there could be another server already running there. Besides that, if we use a hard-coded TCP port, we won&#39;t be able to run multiple builds in parallel. Maybe not a big deal when you&#39;re developing locally, but in <a href="/2014/10/08/continuous-integration-is-dead.html">continuous integration</a> environment this can be a problem. That&#39;s why we&#39;re reserving a TCP port first.</p></li> <li><p><a href="http://maven.apache.org/plugins/maven-dependency-plugin/unpack-mojo.html"><strong><code>maven-dependency-plugin</code></strong></a> is downloading a MySQL distribution in a zip archive (rather big file, over 300Mb for Linux), and unpacks it. This archive contains exactly the same files as you would use for a traditional MySQL installation. When the archive is unpacked, it is ready to start serving SQL requests as a normal MySQL server.</p></li> <li><p><a href="http://mysql.jcabi.com"><strong><code>jcabi-mysql-maven-plugin</code></strong></a> starts a server, binding it to a TCP port reserved randomly. The main responsibility of my Maven plugin is to make sure that MySQL server starts correctly on every platform (Mac OS, Linux, Windows) and stops when it&#39;s not needed any more. All the rest is done by the MySQL distribution itself.</p></li> <li><p><strong><code>maven-failsafe-plugin</code></strong> is running unit tests on <code>integration-test</code> phase. Its main difference from maven-surefire-plugin is that it doesn&#39;t fail a build when some tests fail. Instead, it saves all failures into supplementary files in <code>target</code> directory and allows the build continue. Later, when we call its <code>verify</code> goal, it will fail a build if there were any errors during its <code>integration-test</code> goal execution.</p></li> </ol><p>To be precise, this is the order in which Maven will execute configured goals:</p><figure class="highlight"><pre><code class="language-text" data-lang="text"><span></span>jcabi-mysql-maven-plugin:classify
maven-dependency-plugin:unpack
build-helper-maven-plugin:reserve-network-port
jcabi-mysql-maven-plugin:start
maven-failsafe-plugin:integration-test
jcabi-mysql-maven-plugin:stop
maven-failsafe-plugin:verify</code></pre></figure><p>Run <code>mvn clean install</code> and see how it works. If it doesn&#39;t work for some reason, don&#39;t hesitate <a href="https://github.com/jcabi/jcabi-mysql-maven-plugin/issues">to report an issue to GitHub</a>.</p><p>Now it&#39;s time to create an integration test, which will connect to the temporary MySQL server, create a table there and insert some data into it. This is just an example to show that MySQL server is running and is capable of serving transactions (I&#39;m using <a href="http://jdbc.jcabi.com">jcabi-jdbc</a>):</p><figure class="highlight"><pre><code class="language-java" data-lang="java"><span></span><span class="kd">public</span> <span class="kd">class</span> <span class="nc">FooITCase</span> <span class="o">{</span>
  <span class="kd">private</span> <span class="kd">static</span> <span class="kd">final</span> <span class="n">String</span> <span class="n">PORT</span> <span class="o">=</span> <span class="n">System</span><span class="o">.</span><span class="na">getProperty</span><span class="o">(</span><span class="s">&quot;mysql.port&quot;</span><span class="o">);</span>
  <span class="nd">@Test</span>
  <span class="kd">public</span> <span class="kt">void</span> <span class="nf">worksWithMysqlServer</span><span class="o">()</span> <span class="o">{</span>
    <span class="n">Connection</span> <span class="n">conn</span> <span class="o">=</span> <span class="n">DriverManager</span><span class="o">.</span><span class="na">getConnection</span><span class="o">(</span>
      <span class="n">String</span><span class="o">.</span><span class="na">format</span><span class="o">(</span>
        <span class="s">&quot;jdbc:mysql://localhost:%s/root?user=root&amp;password=root&quot;</span><span class="o">,</span>
        <span class="n">FooITCase</span><span class="o">.</span><span class="na">PORT</span>
      <span class="o">)</span>
    <span class="o">);</span>
    <span class="k">new</span> <span class="n">JdbcSession</span><span class="o">(</span><span class="n">conn</span><span class="o">)</span>
      <span class="o">.</span><span class="na">sql</span><span class="o">(</span><span class="s">&quot;CREATE TABLE foo (id INT PRIMARY KEY)&quot;</span><span class="o">)</span>
      <span class="o">.</span><span class="na">execute</span><span class="o">();</span>
  <span class="o">}</span>
<span class="o">}</span></code></pre></figure><p>If you&#39;re using Hibernate, just create a <code>db.properties</code> file in <code>src/test/resources</code> directory. In that file you would do something like:</p><figure class="highlight"><pre><code class="language-properties" data-lang="properties"><span></span><span class="na">hibernate.connection.url</span><span class="o">=</span><span class="s">jdbc:mysql://localhost:${mysql.port}/root</span>
<span class="na">hibernate.connection.username</span><span class="o">=</span><span class="s">root</span>
<span class="na">hibernate.connection.password</span><span class="o">=</span><span class="s">root</span></code></pre></figure><p>Maven will replace that <code>${mysql.port}</code> with the number of reserved TCP port, during resources copying. This operation is called &quot;resources filtering,&quot; and you can read about it <a href="http://maven.apache.org/plugins/maven-resources-plugin/examples/filter.html">here</a>.</p><p>That&#39;s pretty much it. I&#39;m using <a href="http://mysql.jcabi.com">jcabi-mysql-maven-plugin</a> in a few projects, and it helps me to stay confident that my code works with a real MySQL server. I&#39;m also using the <a href="http://www.liquibase.org/">Liquibase</a> Maven <a href="http://www.liquibase.org/documentation/maven/">plugin</a> in order to populate an empty server with tables required for the application. Nevertheless, that is a story for the <a href="/2014/07/20/liquibase-in-maven.html">next post</a> :)</p></p>--> <nav class="buttons notranslate desktop-only"> <a href="http://www.facebook.com/sharer/sharer.php?u=https://www.yegor256.com/2014/05/21/mysql-maven-plugin.html" title="Share on Facebook" class="button" rel="nofollow"> <span class="count count-facebook">0</span> <i class="icon icon-facebook notranslate" aria-hidden="true"></i> </a> <a href="https://twitter.com/share?url=https://www.yegor256.com/2014/05/21/mysql-maven-plugin.html&amp;text=MySQL+Maven+Plugin" title="Share on Twitter" class="button" rel="nofollow"> <span class="count count-twitter">0</span> <i class="icon icon-twitter notranslate" aria-hidden="true"></i> </a> <a href="https://plus.google.com/share?url=https://www.yegor256.com/2014/05/21/mysql-maven-plugin.html" title="Share on Google+" class="button" rel="nofollow"> <span class="count count-googleplus">0</span> <i class="icon icon-googleplus notranslate" aria-hidden="true"></i> </a> <a href="https://www.linkedin.com/cws/share?url=https://www.yegor256.com/2014/05/21/mysql-maven-plugin.html" title="Share on LinkedIn" class="button" rel="nofollow"> <span class="count count-linkedin">0</span> <i class="icon icon-linkedin notranslate" aria-hidden="true"></i> </a> <a href="http://reddit.com/submit?url=https://www.yegor256.com/2014/05/21/mysql-maven-plugin.html%3F2014-20&amp;title=MySQL+Maven+Plugin" title="Share on Reddit" class="button" rel="nofollow"> <span class="count count-reddit">0</span> <i class="icon icon-reddit notranslate" aria-hidden="true"></i> </a> <a href="http://news.ycombinator.com/submitlink?u=https://www.yegor256.com/2014/05/21/mysql-maven-plugin.html%3F2014-20&amp;t=MySQL+Maven+Plugin" title="Share on Hacker News" class="button" rel="nofollow"> <span class="count count-hackernews">0</span> <i class="icon icon-hackernews notranslate" aria-hidden="true"></i> </a> </nav> </header> <article class="main" itemprop="articleBody"><div ><p>I was using MySQL in a few Java web projects and found out there was no Maven plugin that would help me to test my <a href="/2017/12/05/data-access-object.html">DAOs</a> against a real MySQL server. There are plenty of mechanisms to mock a database persistence layer both in memory and on disc. However, it is always good to make sure that your classes are tested against a database identical to the one you have in production environment.</p><figure class='badge'><a href='http://mysql.jcabi.com'><img src='http://img.jcabi.com/logo-square.svg' style='width:64px;max-width:100%;' alt='badge'/></a></figure><p>I&#39;ve created my own Maven plugin, <a href="http://mysql.jcabi.com">jcabi-mysql-maven-plugin</a>, that does exactly two things: starts a MySQL server on <code>pre-integration-test</code> phase and shuts it down on <code>post-integration-test</code>.</p><p>This is how you configure it in <code>pom.xml</code> (see also its full <a href="http://mysql.jcabi.com/usage.html">usage instructions</a>):</p><figure class="highlight"><pre><code class="language-xml" data-lang="xml"><span></span><span class="nt">&lt;project&gt;</span>
  <span class="nt">&lt;build&gt;</span>
    <span class="nt">&lt;plugins&gt;</span>
      <span class="nt">&lt;plugin&gt;</span>
        <span class="nt">&lt;groupId&gt;</span>org.codehaus.mojo<span class="nt">&lt;/groupId&gt;</span>
        <span class="nt">&lt;artifactId&gt;</span>build-helper-maven-plugin<span class="nt">&lt;/artifactId&gt;</span>
        <span class="nt">&lt;executions&gt;</span>
          <span class="nt">&lt;execution&gt;</span>
            <span class="nt">&lt;goals&gt;</span>
              <span class="nt">&lt;goal&gt;</span>reserve-network-port<span class="nt">&lt;/goal&gt;</span>
            <span class="nt">&lt;/goals&gt;</span>
            <span class="nt">&lt;configuration&gt;</span>
              <span class="nt">&lt;portNames&gt;</span>
                <span class="nt">&lt;portName&gt;</span>mysql.port<span class="nt">&lt;/portName&gt;</span>
              <span class="nt">&lt;/portNames&gt;</span>
            <span class="nt">&lt;/configuration&gt;</span>
          <span class="nt">&lt;/execution&gt;</span>
        <span class="nt">&lt;/executions&gt;</span>
      <span class="nt">&lt;/plugin&gt;</span>
      <span class="nt">&lt;plugin&gt;</span>
        <span class="nt">&lt;artifactId&gt;</span>maven-dependency-plugin<span class="nt">&lt;/artifactId&gt;</span>
        <span class="nt">&lt;executions&gt;</span>
          <span class="nt">&lt;execution&gt;</span>
            <span class="nt">&lt;goals&gt;</span>
              <span class="nt">&lt;goal&gt;</span>unpack<span class="nt">&lt;/goal&gt;</span>
            <span class="nt">&lt;/goals&gt;</span>
            <span class="nt">&lt;configuration&gt;</span>
              <span class="nt">&lt;artifactItems&gt;</span>
                <span class="nt">&lt;artifactItem&gt;</span>
                  <span class="nt">&lt;groupId&gt;</span>com.jcabi<span class="nt">&lt;/groupId&gt;</span>
                  <span class="nt">&lt;artifactId&gt;</span>mysql-dist<span class="nt">&lt;/artifactId&gt;</span>
                  <span class="nt">&lt;version&gt;</span>5.6.14<span class="nt">&lt;/version&gt;</span>
                  <span class="nt">&lt;classifier&gt;</span>${mysql.classifier}<span class="nt">&lt;/classifier&gt;</span>
                  <span class="nt">&lt;type&gt;</span>zip<span class="nt">&lt;/type&gt;</span>
                  <span class="nt">&lt;overWrite&gt;</span>false<span class="nt">&lt;/overWrite&gt;</span>
                  <span class="nt">&lt;outputDirectory&gt;</span>
                    ${project.build.directory}/mysql-dist
                  <span class="nt">&lt;/outputDirectory&gt;</span>
                <span class="nt">&lt;/artifactItem&gt;</span>
              <span class="nt">&lt;/artifactItems&gt;</span>
            <span class="nt">&lt;/configuration&gt;</span>
          <span class="nt">&lt;/execution&gt;</span>
        <span class="nt">&lt;/executions&gt;</span>
      <span class="nt">&lt;/plugin&gt;</span>
      <span class="nt">&lt;plugin&gt;</span>
        <span class="nt">&lt;groupId&gt;</span>com.jcabi<span class="nt">&lt;/groupId&gt;</span>
        <span class="nt">&lt;artifactId&gt;</span>jcabi-mysql-maven-plugin<span class="nt">&lt;/artifactId&gt;</span>
        <span class="nt">&lt;executions&gt;</span>
          <span class="nt">&lt;execution&gt;</span>
            <span class="nt">&lt;id&gt;</span>mysql-test<span class="nt">&lt;/id&gt;</span>
            <span class="nt">&lt;goals&gt;</span>
              <span class="nt">&lt;goal&gt;</span>classify<span class="nt">&lt;/goal&gt;</span>
              <span class="nt">&lt;goal&gt;</span>start<span class="nt">&lt;/goal&gt;</span>
              <span class="nt">&lt;goal&gt;</span>stop<span class="nt">&lt;/goal&gt;</span>
            <span class="nt">&lt;/goals&gt;</span>
            <span class="nt">&lt;configuration&gt;</span>
              <span class="nt">&lt;port&gt;</span>${mysql.port}<span class="nt">&lt;/port&gt;</span>
              <span class="nt">&lt;data&gt;</span>${project.build.directory}/mysql-data<span class="nt">&lt;/data&gt;</span>
            <span class="nt">&lt;/configuration&gt;</span>
          <span class="nt">&lt;/execution&gt;</span>
        <span class="nt">&lt;/executions&gt;</span>
      <span class="nt">&lt;/plugin&gt;</span>
      <span class="nt">&lt;plugin&gt;</span>
        <span class="nt">&lt;artifactId&gt;</span>maven-failsafe-plugin<span class="nt">&lt;/artifactId&gt;</span>
        <span class="nt">&lt;configuration&gt;</span>
          <span class="nt">&lt;systemPropertyVariables&gt;</span>
            <span class="nt">&lt;mysql.port&gt;</span>${mysql.port}<span class="nt">&lt;/mysql.port&gt;</span>
          <span class="nt">&lt;/systemPropertyVariables&gt;</span>
        <span class="nt">&lt;/configuration&gt;</span>
        <span class="nt">&lt;executions&gt;</span>
          <span class="nt">&lt;execution&gt;</span>
            <span class="nt">&lt;goals&gt;</span>
              <span class="nt">&lt;goal&gt;</span>integration-test<span class="nt">&lt;/goal&gt;</span>
              <span class="nt">&lt;goal&gt;</span>verify<span class="nt">&lt;/goal&gt;</span>
            <span class="nt">&lt;/goals&gt;</span>
          <span class="nt">&lt;/execution&gt;</span>
        <span class="nt">&lt;/executions&gt;</span>
      <span class="nt">&lt;/plugin&gt;</span>
    <span class="nt">&lt;/plugins&gt;</span>
  <span class="nt">&lt;/build&gt;</span>
  [...]
<span class="nt">&lt;/project&gt;</span></code></pre></figure><p>There are two plugins configured above. Let&#39;s take a look at what each does.</p><ol> <li><p><strong><code>build-helper-maven-plugin</code></strong> is reserving a temporary random TCP port, which will be used by MySQL server. We don&#39;t want to start a server on its default 3306 port, because there could be another server already running there. Besides that, if we use a hard-coded TCP port, we won&#39;t be able to run multiple builds in parallel. Maybe not a big deal when you&#39;re developing locally, but in <a href="/2014/10/08/continuous-integration-is-dead.html">continuous integration</a> environment this can be a problem. That&#39;s why we&#39;re reserving a TCP port first.</p></li> <li><p><a href="http://maven.apache.org/plugins/maven-dependency-plugin/unpack-mojo.html"><strong><code>maven-dependency-plugin</code></strong></a> is downloading a MySQL distribution in a zip archive (rather big file, over 300Mb for Linux), and unpacks it. This archive contains exactly the same files as you would use for a traditional MySQL installation. When the archive is unpacked, it is ready to start serving SQL requests as a normal MySQL server.</p></li> <li><p><a href="http://mysql.jcabi.com"><strong><code>jcabi-mysql-maven-plugin</code></strong></a> starts a server, binding it to a TCP port reserved randomly. The main responsibility of my Maven plugin is to make sure that MySQL server starts correctly on every platform (Mac OS, Linux, Windows) and stops when it&#39;s not needed any more. All the rest is done by the MySQL distribution itself.</p></li> <li><p><strong><code>maven-failsafe-plugin</code></strong> is running unit tests on <code>integration-test</code> phase. Its main difference from maven-surefire-plugin is that it doesn&#39;t fail a build when some tests fail. Instead, it saves all failures into supplementary files in <code>target</code> directory and allows the build continue. Later, when we call its <code>verify</code> goal, it will fail a build if there were any errors during its <code>integration-test</code> goal execution.</p></li> </ol><p>To be precise, this is the order in which Maven will execute configured goals:</p><figure class="highlight"><pre><code class="language-text" data-lang="text"><span></span>jcabi-mysql-maven-plugin:classify
maven-dependency-plugin:unpack
build-helper-maven-plugin:reserve-network-port
jcabi-mysql-maven-plugin:start
maven-failsafe-plugin:integration-test
jcabi-mysql-maven-plugin:stop
maven-failsafe-plugin:verify</code></pre></figure><p>Run <code>mvn clean install</code> and see how it works. If it doesn&#39;t work for some reason, don&#39;t hesitate <a href="https://github.com/jcabi/jcabi-mysql-maven-plugin/issues">to report an issue to GitHub</a>.</p><p>Now it&#39;s time to create an integration test, which will connect to the temporary MySQL server, create a table there and insert some data into it. This is just an example to show that MySQL server is running and is capable of serving transactions (I&#39;m using <a href="http://jdbc.jcabi.com">jcabi-jdbc</a>):</p><figure class="highlight"><pre><code class="language-java" data-lang="java"><span></span><span class="kd">public</span> <span class="kd">class</span> <span class="nc">FooITCase</span> <span class="o">{</span>
  <span class="kd">private</span> <span class="kd">static</span> <span class="kd">final</span> <span class="n">String</span> <span class="n">PORT</span> <span class="o">=</span> <span class="n">System</span><span class="o">.</span><span class="na">getProperty</span><span class="o">(</span><span class="s">&quot;mysql.port&quot;</span><span class="o">);</span>
  <span class="nd">@Test</span>
  <span class="kd">public</span> <span class="kt">void</span> <span class="nf">worksWithMysqlServer</span><span class="o">()</span> <span class="o">{</span>
    <span class="n">Connection</span> <span class="n">conn</span> <span class="o">=</span> <span class="n">DriverManager</span><span class="o">.</span><span class="na">getConnection</span><span class="o">(</span>
      <span class="n">String</span><span class="o">.</span><span class="na">format</span><span class="o">(</span>
        <span class="s">&quot;jdbc:mysql://localhost:%s/root?user=root&amp;password=root&quot;</span><span class="o">,</span>
        <span class="n">FooITCase</span><span class="o">.</span><span class="na">PORT</span>
      <span class="o">)</span>
    <span class="o">);</span>
    <span class="k">new</span> <span class="n">JdbcSession</span><span class="o">(</span><span class="n">conn</span><span class="o">)</span>
      <span class="o">.</span><span class="na">sql</span><span class="o">(</span><span class="s">&quot;CREATE TABLE foo (id INT PRIMARY KEY)&quot;</span><span class="o">)</span>
      <span class="o">.</span><span class="na">execute</span><span class="o">();</span>
  <span class="o">}</span>
<span class="o">}</span></code></pre></figure><p>If you&#39;re using Hibernate, just create a <code>db.properties</code> file in <code>src/test/resources</code> directory. In that file you would do something like:</p><figure class="highlight"><pre><code class="language-properties" data-lang="properties"><span></span><span class="na">hibernate.connection.url</span><span class="o">=</span><span class="s">jdbc:mysql://localhost:${mysql.port}/root</span>
<span class="na">hibernate.connection.username</span><span class="o">=</span><span class="s">root</span>
<span class="na">hibernate.connection.password</span><span class="o">=</span><span class="s">root</span></code></pre></figure><p>Maven will replace that <code>${mysql.port}</code> with the number of reserved TCP port, during resources copying. This operation is called &quot;resources filtering,&quot; and you can read about it <a href="http://maven.apache.org/plugins/maven-resources-plugin/examples/filter.html">here</a>.</p><p>That&#39;s pretty much it. I&#39;m using <a href="http://mysql.jcabi.com">jcabi-mysql-maven-plugin</a> in a few projects, and it helps me to stay confident that my code works with a real MySQL server. I&#39;m also using the <a href="http://www.liquibase.org/">Liquibase</a> Maven <a href="http://www.liquibase.org/documentation/maven/">plugin</a> in order to populate an empty server with tables required for the application. Nevertheless, that is a story for the <a href="/2014/07/20/liquibase-in-maven.html">next post</a> :)</p></div></article></div><div class="wrapper"> <related-posts /></div><div class="disqus" role="complementary"><p class="disqus_hint"> Please, use <a href="https://help.disqus.com/commenting/what-html-tags-are-allowed-within-comments">syntax highlighting</a> in your comments, to make them more readable.</p><div id="disqus_thread" class="disqus-thread"> <a>&nbsp;</a></div><script> var disqus_config = function () { this.page.url = document.location.href.split('?')[0].split('#')[0].replace('https://', 'http://'); this.page.identifier = this.page.url; }; (function() { var d = document, s = d.createElement('script'); s.src = '//yegor256.disqus.com/embed.js'; s.setAttribute('data-timestamp', +new Date()); (d.head || d.body).appendChild(s); })(); </script> <noscript><div><p class="red"> JavaScript is disabled in your browser, that's why you can't see comments under this post.</p></div></noscript></div><div class="wrapper"> <footer class="footer"><p> &copy; <span itemscope="" itemprop="copyrightHolder" itemtype="http://schema.org/Person"> <span itemprop="name">Yegor Bugayenko</span> </span> 2014&ndash;<span itemprop="copyrightYear">2018</span></p></footer></div></section><div class="wrapper unprintable" style="text-align:center;margin-top:2em;"> <a href="http://www.sixnines.io/h/3ba1652f"> <img src="//www.sixnines.io/b/3ba1652f?style=flat" alt="sixnines availability badge"/> </a></div><script src="//code.jquery.com/jquery-1.9.0.min.js"></script> <script src="/js/all.js?4e047f6f42b"></script> <script>var disqus_shortname = 'yegor256';</script> <script id="dsq-count-scr" src="//yegor256.disqus.com/count.js" async="async"></script> <script> (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){ (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o), m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m) })(window,document,'script','//www.google-analytics.com/analytics.js','ga'); ga('create', 'UA-1963507-32', 'auto'); ga('send', 'pageview'); </script> <script> Cd=document;Cr="&"+Math.random();Cp="&s=1"; Cd.cookie="b=b";if(Cd.cookie)Cp+="&c=1"; Cp+="&t="+(new Date()).getTimezoneOffset(); if(self!=top)Cp+="&f=1"; </script> <script> if(navigator.javaEnabled())Cp+="&j=1"; </script> <script> if(typeof(screen)!='undefined')Cp+="&w="+screen.width+"&h="+ screen.height+"&d="+(screen.colorDepth?screen.colorDepth:screen.pixelDepth); </script> <script> Cd.write("<img src='//c.hit.ua/hit?i=95870&g=0&x=2"+Cp+Cr+ "&r="+escape(Cd.referrer)+"&u="+escape(window.location.href)+ "' border='0' wi"+"dth='1' he"+"ight='1'/>"); </script> <script type="application/ld+json"> { "@context": "http://schema.org", "@type": "Person", "name": "Yegor Bugayenko", "url": "http://www.yegor256.com", "sameAs": [ "https://www.facebook.com/yegor256", "https://instagram.com/yegor256", "https://www.linkedin.com/in/yegor256", "https://twitter.com/yegor256", "https://github.com/yegor256", "https://www.pinterest.com/yegor256/" ] } </script> </body> </html> <!DOCTYPE html> <html xmlns="http://www.w3.org/1999/xhtml" lang="en-US" xml:lang="en-US" itemscope="" itemtype="http://schema.org/WebSite"> <head> <meta charset="utf-8"/> <meta name="description" content="jcabi-dynamodb-maven-plugin is a Maven plugin for DynamoDB Local running locally and acting as a stub of DynamoDB server, which is very useful for integration testing " /> <meta name="keywords" content="amazon dynamodb maven plugin, aws dynamodb maven, dynamodb, dynamodb maven plugin, dynamodblocal, maven plugin, maven plugin for dynamodb local" /> <meta name="viewport" content="width=device-width,minimum-scale=1,initial-scale=1"/> <meta name="google-site-verification" content="JEj_gQr2CPe2QKGw8XdMz0R7VboQIUbX3FlM-lwTq-8" /> <meta name="author" content="Yegor Bugayenko"> <meta name="article:published_time" content="2014-05-01 00:00:00 +0000"> <meta name="og:site_name" content="Yegor Bugayenko"/> <meta name="og:type" content="article" /> <meta name="og:locale" content="en_US" /> <meta name="twitter:account_id" content="4503599630178231" /> <meta name="twitter:creator" content="@yegor256"/> <meta name="twitter:site" content="@yegor256"/> <meta name="twitter:title" property="og:title" content="DynamoDB Local Maven Plugin"/> <meta name="twitter:description" property="og:description" content="jcabi-dynamodb-maven-plugin is a Maven plugin for DynamoDB Local running locally and acting as a stub of DynamoDB server, which is very useful for integration testing "/> <meta name="twitter:url" property="og:url" content="https://www.yegor256.com/2014/05/01/dynamodb-local-maven-plugin.html"/> <meta name="telegram:channel" content="AAAAAEJFMRzsRTRxM3ec6A"/> <link rel="search" type="application/opensearchdescription+xml" href="/opensearch.xml" title="yegor256" /> <link rel="shortcut icon" href="/favicon.ico?4e047f6f42b"/> <link rel="apple-touch-icon" href="/favicon.ico?4e047f6f42b"/> <link rel="alternate" type="application/rss+xml" title="RSS for yegor256.com" href="https://www.yegor256.com/rss.xml"/> <link rel="stylesheet" href="/css/layout.css?4e047f6f42b"/> <link rel="stylesheet" href="/css/icons.css?4e047f6f42b"/> <link rel="canonical" href="https://www.yegor256.com/2014/05/01/dynamodb-local-maven-plugin.html" /> <link rel="amphtml" href="https://www.yegor256.com/2014/05/01/dynamodb-local-maven-plugin.amp.html" /> <title>DynamoDB Local Maven Plugin </title> </head> <body><div class="wrapper"> <aside class="header-toggle unprintable" id="header-toggle" title="Show the menu" onclick="$('#header').show();$('#header-toggle').hide();">&#9776;</aside> <header class="header" id="header"><div class="face"> <a href="/about-me.html#form" class="sub" title="Click to subscribe to my monthly newsletter"><span>Subscribe</span></a> <a href="/about-me.html" style="position:relative;"> <img src="/images/face-256x256.jpg" class="photo" alt="Yegor Bugayenko"/> </a></div><nav><ul class="menu social notranslate"> <li><a href="https://twitter.com/intent/follow?screen_name=yegor256" rel="nofollow" title="Follow me on Twitter"><i class="icon icon-twitter notranslate" aria-hidden="true"></i></a></li> <li><a href="/rss.xml" rel="nofollow" title="Subscribe to my RSS feed"><i class="icon icon-rss notranslate" aria-hidden="true"></i></a></li> <li><a itemprop="sameAs" href="https://github.com/yegor256" rel="nofollow" title="My GitHub profile"><i class="icon icon-github notranslate" aria-hidden="true"></i></a></li> <li><a itemprop="sameAs" href="http://stackoverflow.com/users/187141/yegor256" rel="nofollow" title="My StackOverflow profile"><i class="icon icon-stackoverflow notranslate" aria-hidden="true"></i></a></li> <li><a itemprop="sameAs" href="https://www.facebook.com/yegor256" rel="nofollow" title="Follow me on Facebook"><i class="icon icon-facebook notranslate" aria-hidden="true"></i></a></li> <li><a itemprop="sameAs" href="https://instagram.com/yegor256" rel="nofollow" title="Follow me on Instagram"><i class="icon icon-instagram notranslate" aria-hidden="true"></i></a></li> <li><a itemprop="sameAs" href="https://www.linkedin.com/in/yegor256" rel="nofollow" title="My LinkedIn profile"><i class="icon icon-linkedin notranslate" aria-hidden="true"></i></a></li> <li><a itemprop="sameAs" href="https://www.youtube.com/c/yegor256?sub_confirmation=1" rel="nofollow" title="My Youtube video channel"><i class="icon icon-youtube notranslate" aria-hidden="true"></i></a></li> <li><a itemprop="sameAs" href="https://www.pinterest.com/yegor256/" rel="nofollow" title="My Pinterest boards"><i class="icon icon-pinterest notranslate" aria-hidden="true"></i></a></li> <li><a itemprop="sameAs" href="https://angel.co/yegor256" rel="nofollow" title="My AngelList profile"><i class="icon icon-angellist notranslate" aria-hidden="true"></i></a></li> <li><a href="https://soundcloud.com/yegor256" rel="nofollow" title="My podcast"><i class="icon icon-podcast notranslate" aria-hidden="true"></i></a></li> <li><a href="https://itunes.apple.com/us/podcast/yegor256-podcast/id1150826721" rel="nofollow" title="My iTunes podcast"><i class="icon icon-itunes notranslate" aria-hidden="true"></i></a></li> <li><a href="https://t.me/joinchat/AAAAAEJFMRzsRTRxM3ec6A" rel="nofollow" title="My Telegram public channel"><i class="icon icon-telegram notranslate" aria-hidden="true"></i></a></li> <li><a href="mailto:blog@yegor256.com" rel="nofollow" title="Email me any time"><i class="icon icon-mail notranslate" aria-hidden="true"></i></a></li></ul><ul class="menu"> <li><a href="/" title="Home page">Home</a></li> <li ><a href="/best.html" title="Best articles to read">12&#160;Best</a></li> <li ><a href="/contents.html" title="The contents of the entire blog">All&#160;288</a></li> <li ><a href="/webinars.html" title="My webinars">Webinars</a></li> <li ><a href="/talks.html" title="Future and past conference talks">Talks</a></li> <li ><a href="/books.html" title="The books I wrote">Books</a></li> <li ><a href="/papers.html" title="My academic papers and patents">Papers</a></li> <li ><a href="/pets.html" title="My loved pet projects">Pets</a></li> <li ><a href="/award.html" title="Software quality award">Award</a></li> <li ><a href="/testimonials.html" title="What some people say about me">Testimonials</a></li> <li ><a href="/shift-m.html" title="Audio podcast about project management">Shift-M</a></li> <li ><a href="/paintings.html" title="My paintings for sale">Paintings</a></li> <li><a href="http://ru.yegor256.com/" title="Немного на русском языке">По-русски</a></li></ul></nav><div class="search"> <form method="get" action="https://www.google.com/search" itemprop="potentialAction" itemscope="" itemtype="http://schema.org/SearchAction"> <meta itemprop="target" content="https://www.google.com/search?q={q}"/> <input name="sitesearch" value="yegor256.com" type="hidden"/> <input itemprop="query-input" type="text" id="search-query" class="field field-text" required="required" onfocus="$('.google').css('visibility', 'visible');" name="q" placeholder="Search..." autocomplete="off"/> <input type="image" src="/images/google-search-icon.svg" class="google" title="Search via Google" alt="Search via Google"/> </form></div><div class="hot"><ul> <li> <a href="/code-ahead.html">Code Ahead</a> was published on Amazon just a few days ago! It is my new book, a novel about programmers. It explains in details the majority of ideas that stand behind <a href="https://www.zerocracy.com">Zerocracy</a> and <a href="https://www.xdsd.org">XDSD</a>. </li> <li> At <a href="/webinars.html">Webinar #37</a> we will discuss naming problem in OOP, for objects, methods and attributes; join us on <b>September 12</b>, at 11am PST. </li></ul></div></header></div><section itemscope="" itemtype="http://schema.org/BlogPosting"><div class="wrapper"> <header><p class="printable"> <img src="https://api.qrserver.com/v1/create-qr-code/?data=https://www.yegor256.com/2014/05/01/dynamodb-local-maven-plugin.html&amp;format=svg" style="width:125px;height:125px;" alt="QR code"/></p><p class="printable"> <code itemprop="url">https://www.yegor256.com/2014/05/01/dynamodb-local-maven-plugin.html</code></p><h1 itemprop="name headline mainEntityOfPage">DynamoDB Local Maven Plugin</h1><ul class="subline"> <li> <time itemprop="datePublished" datetime="2014-05-01T00:00:00+00:00"> 1 May 2014 </time> </li> <li class="printable" itemscope="" itemprop="author" itemtype="http://schema.org/Person"> <span itemprop="name">Yegor Bugayenko</span> </li> <li class="unprintable"> <i class="icon icon-comments"></i> <a href="http://www.yegor256.com/2014/05/01/dynamodb-local-maven-plugin.html#disqus_thread" itemprop="discussionUrl">comments</a> </li></ul><p>Full usage details for the plugin are explained on <a href="http://dynamodb.jcabi.com">its website</a>. However, here is a simple example (get its latest versions in <a href="http://search.maven.org/">Maven Central</a>):</p><figure class="highlight"><pre><code class="language-xml" data-lang="xml"><span></span><span class="nt">&lt;plugin&gt;</span>
  <span class="nt">&lt;groupId&gt;</span>com.jcabi<span class="nt">&lt;/groupId&gt;</span>
  <span class="nt">&lt;artifactId&gt;</span>jcabi-dynamodb-maven-plugin<span class="nt">&lt;/artifactId&gt;</span>
  <span class="nt">&lt;executions&gt;</span>
    <span class="nt">&lt;execution&gt;</span>
      <span class="nt">&lt;goals&gt;</span>
        <span class="nt">&lt;goal&gt;</span>start<span class="nt">&lt;/goal&gt;</span>
        <span class="nt">&lt;goal&gt;</span>stop<span class="nt">&lt;/goal&gt;</span>
      <span class="nt">&lt;/goals&gt;</span>
      <span class="nt">&lt;configuration&gt;</span>
        <span class="nt">&lt;port&gt;</span>10500<span class="nt">&lt;/port&gt;</span>
        <span class="nt">&lt;dist&gt;</span>${project.build.directory}/dynamodb-dist<span class="nt">&lt;/dist&gt;</span>
      <span class="nt">&lt;/configuration&gt;</span>
    <span class="nt">&lt;/execution&gt;</span>
  <span class="nt">&lt;/executions&gt;</span>
<span class="nt">&lt;/plugin&gt;</span></code></pre></figure><p>The above configuration will start DynamoDB Local right before running integration tests, and then stop it immediately afterwards. The server will listen at TCP port 10500. While the number is used in the example, you&#39;re supposed to use a randomly allocated port instead.</p><p>When the DynamoDB Local server is up and running, we can create an integration test for it:</p><figure class="highlight"><pre><code class="language-java" data-lang="java"><span></span><span class="kn">import</span> <span class="nn">com.amazonaws.auth.BasicAWSCredentials</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">com.amazonaws.services.dynamodbv2.AmazonDynamoDB</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">com.amazonaws.services.dynamodbv2.AmazonDynamoDBClient</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">com.amazonaws.services.dynamodbv2.model.ListTablesResult</span><span class="o">;</span>
<span class="kd">public</span> <span class="kd">class</span> <span class="nc">FooITCase</span> <span class="o">{</span>
  <span class="nd">@Test</span>
  <span class="kd">public</span> <span class="kt">void</span> <span class="nf">worksWithAwsDynamoDb</span><span class="o">()</span> <span class="o">{</span>
    <span class="n">AmazonDynamoDB</span> <span class="n">aws</span> <span class="o">=</span> <span class="k">new</span> <span class="n">AmazonDynamoDBClient</span><span class="o">(</span>
      <span class="k">new</span> <span class="n">BasicAWSCredentials</span><span class="o">(</span><span class="s">&quot;&quot;</span><span class="o">,</span> <span class="s">&quot;&quot;</span><span class="o">)</span>
    <span class="o">);</span>
    <span class="n">aws</span><span class="o">.</span><span class="na">setEndpoint</span><span class="o">(</span><span class="s">&quot;http://localhost:10500&quot;</span><span class="o">);</span>
    <span class="n">ListTablesResult</span> <span class="n">list</span> <span class="o">=</span> <span class="n">aws</span><span class="o">.</span><span class="na">listTables</span><span class="o">();</span>
    <span class="k">for</span> <span class="o">(</span><span class="n">String</span> <span class="n">name</span> <span class="o">:</span> <span class="n">list</span><span class="o">.</span><span class="na">getTableNames</span><span class="o">())</span> <span class="o">{</span>
      <span class="n">System</span><span class="o">.</span><span class="na">out</span><span class="o">.</span><span class="na">println</span><span class="o">(</span><span class="s">&quot;table found: &quot;</span> <span class="o">+</span> <span class="n">name</span><span class="o">);</span>
    <span class="o">}</span>
  <span class="o">}</span>
<span class="o">}</span></code></pre></figure><p>Of course, there won&#39;t be any output because the server starts without any tables. Since the server is empty, you should create tables before every integration test, using <code>createTable()</code> from <a href="http://docs.aws.amazon.com/AWSJavaSDK/latest/javadoc/com/amazonaws/services/dynamodbv2/package-summary.html">DynamoDB SDK</a>.</p><p>To avoid this type of extra hassle, in the latest version 0.6 of <a href="http://dynamodb.jcabi.com">jcabi-dynamodb-maven-plugin</a> <a href="https://github.com/jcabi/jcabi-dynamodb-maven-plugin/issues/16">we introduced</a> a new goal <a href="http://dynamodb.jcabi.com/example-create-tables.html"><code>create-tables</code></a>:</p><figure class="highlight"><pre><code class="language-xml" data-lang="xml"><span></span><span class="nt">&lt;plugin&gt;</span>
  <span class="nt">&lt;groupId&gt;</span>com.jcabi<span class="nt">&lt;/groupId&gt;</span>
  <span class="nt">&lt;artifactId&gt;</span>jcabi-dynamodb-maven-plugin<span class="nt">&lt;/artifactId&gt;</span>
  <span class="nt">&lt;executions&gt;</span>
    <span class="nt">&lt;execution&gt;</span>
      <span class="nt">&lt;goals&gt;</span>
        <span class="nt">&lt;goal&gt;</span>create-tables<span class="nt">&lt;/goal&gt;</span>
      <span class="nt">&lt;/goals&gt;</span>
      <span class="nt">&lt;configuration&gt;</span>
        <span class="nt">&lt;tables&gt;</span>
          <span class="nt">&lt;table&gt;</span>${basedir}/src/test/dynamodb/foo.json<span class="nt">&lt;/table&gt;</span>
        <span class="nt">&lt;/tables&gt;</span>
      <span class="nt">&lt;/configuration&gt;</span>
    <span class="nt">&lt;/execution&gt;</span>
  <span class="nt">&lt;/executions&gt;</span>
<span class="nt">&lt;/plugin&gt;</span></code></pre></figure><p>The <code>foo.json</code> file used above should contain a JSON request that is sent to DynamoDB Local right after it is up and running. The request should comply with the specification of <a href="http://docs.aws.amazon.com/amazondynamodb/latest/APIReference/API_CreateTable.html"><code>CreateTable</code></a> request. For example:</p><figure class="highlight"><pre><code class="language-json" data-lang="json"><span></span><span class="p">{</span>
  <span class="nt">&quot;AttributeDefinitions&quot;</span><span class="p">:</span> <span class="p">[</span>
    <span class="p">{</span>
      <span class="nt">&quot;AttributeName&quot;</span><span class="p">:</span> <span class="s2">&quot;id&quot;</span><span class="p">,</span>
      <span class="nt">&quot;AttributeType&quot;</span><span class="p">:</span> <span class="s2">&quot;N&quot;</span>
    <span class="p">}</span>
  <span class="p">],</span>
  <span class="nt">&quot;KeySchema&quot;</span><span class="p">:</span> <span class="p">[</span>
    <span class="p">{</span>
      <span class="nt">&quot;AttributeName&quot;</span><span class="p">:</span> <span class="s2">&quot;id&quot;</span><span class="p">,</span>
      <span class="nt">&quot;KeyType&quot;</span><span class="p">:</span> <span class="s2">&quot;HASH&quot;</span>
    <span class="p">}</span>
  <span class="p">],</span>
  <span class="nt">&quot;ProvisionedThroughput&quot;</span><span class="p">:</span> <span class="p">{</span>
    <span class="nt">&quot;ReadCapacityUnits&quot;</span><span class="p">:</span> <span class="s2">&quot;1&quot;</span><span class="p">,</span>
    <span class="nt">&quot;WriteCapacityUnits&quot;</span><span class="p">:</span> <span class="s2">&quot;1&quot;</span>
  <span class="p">},</span>
  <span class="nt">&quot;TableName&quot;</span><span class="p">:</span> <span class="s2">&quot;foo&quot;</span>
<span class="p">}</span></code></pre></figure><p>The table will be created during the <code>pre-integration-test</code> phase and dropped at the <code>post-integration-test</code> phase. Now, we can make our integration test much more meaningful with the help of <a href="http://dynamo.jcabi.com">jcabi-dynamo</a>:</p><figure class="highlight"><pre><code class="language-java" data-lang="java"><span></span><span class="kn">import</span> <span class="nn">com.jcabi.dynamo.Attributes</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">com.jcabi.dynamo.Conditions</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">com.jcabi.dynamo.Credentials</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">com.jcabi.dynamo.Region</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">com.jcabi.dynamo.Table</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">org.hamcrest.MatcherAssert</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">org.hamcrest.Matchers</span><span class="o">;</span>
<span class="kd">public</span> <span class="kd">class</span> <span class="nc">FooITCase</span> <span class="o">{</span>
  <span class="nd">@Test</span>
  <span class="kd">public</span> <span class="kt">void</span> <span class="nf">worksWithAwsDynamoDb</span><span class="o">()</span> <span class="o">{</span>
    <span class="n">Region</span> <span class="n">region</span> <span class="o">=</span> <span class="k">new</span> <span class="n">Region</span><span class="o">.</span><span class="na">Simple</span><span class="o">(</span><span class="k">new</span> <span class="n">Credentials</span><span class="o">.</span><span class="na">Simple</span><span class="o">(</span><span class="s">&quot;&quot;</span><span class="o">,</span> <span class="s">&quot;&quot;</span><span class="o">));</span>
    <span class="n">Table</span> <span class="n">table</span> <span class="o">=</span> <span class="n">region</span><span class="o">.</span><span class="na">table</span><span class="o">(</span><span class="s">&quot;foo&quot;</span><span class="o">);</span>
    <span class="n">table</span><span class="o">.</span><span class="na">put</span><span class="o">(</span>
      <span class="k">new</span> <span class="n">Attributes</span><span class="o">()</span>
        <span class="o">.</span><span class="na">with</span><span class="o">(</span><span class="s">&quot;id&quot;</span><span class="o">,</span> <span class="mi">123</span><span class="o">)</span>
        <span class="o">.</span><span class="na">with</span><span class="o">(</span><span class="s">&quot;name&quot;</span><span class="o">,</span> <span class="s">&quot;Robert DeNiro&quot;</span><span class="o">)</span>
    <span class="o">);</span>
    <span class="n">MatcherAssert</span><span class="o">.</span><span class="na">assertThat</span><span class="o">(</span>
      <span class="n">table</span><span class="o">.</span><span class="na">frame</span><span class="o">().</span><span class="na">where</span><span class="o">(</span><span class="s">&quot;id&quot;</span><span class="o">,</span> <span class="n">Conditions</span><span class="o">.</span><span class="na">equalTo</span><span class="o">(</span><span class="mi">123</span><span class="o">)),</span>
      <span class="n">Matchers</span><span class="o">.</span><span class="na">notEmpty</span><span class="o">()</span>
    <span class="o">);</span>
  <span class="o">}</span>
<span class="o">}</span></code></pre></figure><p>The above test will put a new item into the table and then assert that the item is there.</p><p>The plugin was tested with three operating systems, and proved to work without problems: Mac OS X 10.8.5, Windows 7 SP1 and Ubuntu Linux 12.04 Desktop.</p></p>--> <nav class="buttons notranslate desktop-only"> <a href="http://www.facebook.com/sharer/sharer.php?u=https://www.yegor256.com/2014/05/01/dynamodb-local-maven-plugin.html" title="Share on Facebook" class="button" rel="nofollow"> <span class="count count-facebook">0</span> <i class="icon icon-facebook notranslate" aria-hidden="true"></i> </a> <a href="https://twitter.com/share?url=https://www.yegor256.com/2014/05/01/dynamodb-local-maven-plugin.html&amp;text=DynamoDB+Local+Maven+Plugin" title="Share on Twitter" class="button" rel="nofollow"> <span class="count count-twitter">0</span> <i class="icon icon-twitter notranslate" aria-hidden="true"></i> </a> <a href="https://plus.google.com/share?url=https://www.yegor256.com/2014/05/01/dynamodb-local-maven-plugin.html" title="Share on Google+" class="button" rel="nofollow"> <span class="count count-googleplus">0</span> <i class="icon icon-googleplus notranslate" aria-hidden="true"></i> </a> <a href="https://www.linkedin.com/cws/share?url=https://www.yegor256.com/2014/05/01/dynamodb-local-maven-plugin.html" title="Share on LinkedIn" class="button" rel="nofollow"> <span class="count count-linkedin">0</span> <i class="icon icon-linkedin notranslate" aria-hidden="true"></i> </a> <a href="http://reddit.com/submit?url=https://www.yegor256.com/2014/05/01/dynamodb-local-maven-plugin.html%3F2014-17&amp;title=DynamoDB+Local+Maven+Plugin" title="Share on Reddit" class="button" rel="nofollow"> <span class="count count-reddit">0</span> <i class="icon icon-reddit notranslate" aria-hidden="true"></i> </a> <a href="http://news.ycombinator.com/submitlink?u=https://www.yegor256.com/2014/05/01/dynamodb-local-maven-plugin.html%3F2014-17&amp;t=DynamoDB+Local+Maven+Plugin" title="Share on Hacker News" class="button" rel="nofollow"> <span class="count count-hackernews">0</span> <i class="icon icon-hackernews notranslate" aria-hidden="true"></i> </a> </nav> </header> <article class="main" itemprop="articleBody"><div > <figure class='badge'><a href='http://aws.amazon.com/dynamodb'><img src='https://www.yegor256.com/images/2014/04/dynamodb-logo.png' style='width:150px;max-width:100%;' alt='badge'/></a></figure><p><a href="http://docs.aws.amazon.com/amazondynamodb/latest/developerguide/Tools.html">DynamoDB Local</a> is a locally running copy of Amazon DynamoDB server. Amazon developed the tool and based it on SQLite. It acts as a real DynamoDB service through the RESTful API.</p><p>I guess, DynamoDB Local is meant to be used in integration testing and this is how we&#39;re going to use it below.</p><p>I use Maven to run all of my Java integration testing using <a href="http://maven.apache.org/surefire/maven-failsafe-plugin/"><code>maven-failsafe-plugin</code></a>. The philosophy of integration testing with Maven is that you start all your supplementary test stubs during the <code>pre-integration-test</code> phase, run your tests in the <code>integration-test</code> phase and then shutdown all stubs during the <code>post-integration-test</code>.</p><figure class='badge'><a href='http://dynamodb.jcabi.com'><img src='http://img.jcabi.com/logo-square.svg' style='width:64px;max-width:100%;' alt='badge'/></a></figure><p>It would be great if it were possible to use DynamoDB Local that way. I didn&#39;t find any Maven plugins for that purpose, so I decided to create my own---<a href="https://github.com/jcabi/jcabi-dynamodb-maven-plugin">jcabi-dynamodb-maven-plugin</a>.</p><p>Full usage details for the plugin are explained on <a href="http://dynamodb.jcabi.com">its website</a>. However, here is a simple example (get its latest versions in <a href="http://search.maven.org/">Maven Central</a>):</p><figure class="highlight"><pre><code class="language-xml" data-lang="xml"><span></span><span class="nt">&lt;plugin&gt;</span>
  <span class="nt">&lt;groupId&gt;</span>com.jcabi<span class="nt">&lt;/groupId&gt;</span>
  <span class="nt">&lt;artifactId&gt;</span>jcabi-dynamodb-maven-plugin<span class="nt">&lt;/artifactId&gt;</span>
  <span class="nt">&lt;executions&gt;</span>
    <span class="nt">&lt;execution&gt;</span>
      <span class="nt">&lt;goals&gt;</span>
        <span class="nt">&lt;goal&gt;</span>start<span class="nt">&lt;/goal&gt;</span>
        <span class="nt">&lt;goal&gt;</span>stop<span class="nt">&lt;/goal&gt;</span>
      <span class="nt">&lt;/goals&gt;</span>
      <span class="nt">&lt;configuration&gt;</span>
        <span class="nt">&lt;port&gt;</span>10500<span class="nt">&lt;/port&gt;</span>
        <span class="nt">&lt;dist&gt;</span>${project.build.directory}/dynamodb-dist<span class="nt">&lt;/dist&gt;</span>
      <span class="nt">&lt;/configuration&gt;</span>
    <span class="nt">&lt;/execution&gt;</span>
  <span class="nt">&lt;/executions&gt;</span>
<span class="nt">&lt;/plugin&gt;</span></code></pre></figure><p>The above configuration will start DynamoDB Local right before running integration tests, and then stop it immediately afterwards. The server will listen at TCP port 10500. While the number is used in the example, you&#39;re supposed to use a randomly allocated port instead.</p><p>When the DynamoDB Local server is up and running, we can create an integration test for it:</p><figure class="highlight"><pre><code class="language-java" data-lang="java"><span></span><span class="kn">import</span> <span class="nn">com.amazonaws.auth.BasicAWSCredentials</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">com.amazonaws.services.dynamodbv2.AmazonDynamoDB</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">com.amazonaws.services.dynamodbv2.AmazonDynamoDBClient</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">com.amazonaws.services.dynamodbv2.model.ListTablesResult</span><span class="o">;</span>
<span class="kd">public</span> <span class="kd">class</span> <span class="nc">FooITCase</span> <span class="o">{</span>
  <span class="nd">@Test</span>
  <span class="kd">public</span> <span class="kt">void</span> <span class="nf">worksWithAwsDynamoDb</span><span class="o">()</span> <span class="o">{</span>
    <span class="n">AmazonDynamoDB</span> <span class="n">aws</span> <span class="o">=</span> <span class="k">new</span> <span class="n">AmazonDynamoDBClient</span><span class="o">(</span>
      <span class="k">new</span> <span class="n">BasicAWSCredentials</span><span class="o">(</span><span class="s">&quot;&quot;</span><span class="o">,</span> <span class="s">&quot;&quot;</span><span class="o">)</span>
    <span class="o">);</span>
    <span class="n">aws</span><span class="o">.</span><span class="na">setEndpoint</span><span class="o">(</span><span class="s">&quot;http://localhost:10500&quot;</span><span class="o">);</span>
    <span class="n">ListTablesResult</span> <span class="n">list</span> <span class="o">=</span> <span class="n">aws</span><span class="o">.</span><span class="na">listTables</span><span class="o">();</span>
    <span class="k">for</span> <span class="o">(</span><span class="n">String</span> <span class="n">name</span> <span class="o">:</span> <span class="n">list</span><span class="o">.</span><span class="na">getTableNames</span><span class="o">())</span> <span class="o">{</span>
      <span class="n">System</span><span class="o">.</span><span class="na">out</span><span class="o">.</span><span class="na">println</span><span class="o">(</span><span class="s">&quot;table found: &quot;</span> <span class="o">+</span> <span class="n">name</span><span class="o">);</span>
    <span class="o">}</span>
  <span class="o">}</span>
<span class="o">}</span></code></pre></figure><p>Of course, there won&#39;t be any output because the server starts without any tables. Since the server is empty, you should create tables before every integration test, using <code>createTable()</code> from <a href="http://docs.aws.amazon.com/AWSJavaSDK/latest/javadoc/com/amazonaws/services/dynamodbv2/package-summary.html">DynamoDB SDK</a>.</p><p>To avoid this type of extra hassle, in the latest version 0.6 of <a href="http://dynamodb.jcabi.com">jcabi-dynamodb-maven-plugin</a> <a href="https://github.com/jcabi/jcabi-dynamodb-maven-plugin/issues/16">we introduced</a> a new goal <a href="http://dynamodb.jcabi.com/example-create-tables.html"><code>create-tables</code></a>:</p><figure class="highlight"><pre><code class="language-xml" data-lang="xml"><span></span><span class="nt">&lt;plugin&gt;</span>
  <span class="nt">&lt;groupId&gt;</span>com.jcabi<span class="nt">&lt;/groupId&gt;</span>
  <span class="nt">&lt;artifactId&gt;</span>jcabi-dynamodb-maven-plugin<span class="nt">&lt;/artifactId&gt;</span>
  <span class="nt">&lt;executions&gt;</span>
    <span class="nt">&lt;execution&gt;</span>
      <span class="nt">&lt;goals&gt;</span>
        <span class="nt">&lt;goal&gt;</span>create-tables<span class="nt">&lt;/goal&gt;</span>
      <span class="nt">&lt;/goals&gt;</span>
      <span class="nt">&lt;configuration&gt;</span>
        <span class="nt">&lt;tables&gt;</span>
          <span class="nt">&lt;table&gt;</span>${basedir}/src/test/dynamodb/foo.json<span class="nt">&lt;/table&gt;</span>
        <span class="nt">&lt;/tables&gt;</span>
      <span class="nt">&lt;/configuration&gt;</span>
    <span class="nt">&lt;/execution&gt;</span>
  <span class="nt">&lt;/executions&gt;</span>
<span class="nt">&lt;/plugin&gt;</span></code></pre></figure><p>The <code>foo.json</code> file used above should contain a JSON request that is sent to DynamoDB Local right after it is up and running. The request should comply with the specification of <a href="http://docs.aws.amazon.com/amazondynamodb/latest/APIReference/API_CreateTable.html"><code>CreateTable</code></a> request. For example:</p><figure class="highlight"><pre><code class="language-json" data-lang="json"><span></span><span class="p">{</span>
  <span class="nt">&quot;AttributeDefinitions&quot;</span><span class="p">:</span> <span class="p">[</span>
    <span class="p">{</span>
      <span class="nt">&quot;AttributeName&quot;</span><span class="p">:</span> <span class="s2">&quot;id&quot;</span><span class="p">,</span>
      <span class="nt">&quot;AttributeType&quot;</span><span class="p">:</span> <span class="s2">&quot;N&quot;</span>
    <span class="p">}</span>
  <span class="p">],</span>
  <span class="nt">&quot;KeySchema&quot;</span><span class="p">:</span> <span class="p">[</span>
    <span class="p">{</span>
      <span class="nt">&quot;AttributeName&quot;</span><span class="p">:</span> <span class="s2">&quot;id&quot;</span><span class="p">,</span>
      <span class="nt">&quot;KeyType&quot;</span><span class="p">:</span> <span class="s2">&quot;HASH&quot;</span>
    <span class="p">}</span>
  <span class="p">],</span>
  <span class="nt">&quot;ProvisionedThroughput&quot;</span><span class="p">:</span> <span class="p">{</span>
    <span class="nt">&quot;ReadCapacityUnits&quot;</span><span class="p">:</span> <span class="s2">&quot;1&quot;</span><span class="p">,</span>
    <span class="nt">&quot;WriteCapacityUnits&quot;</span><span class="p">:</span> <span class="s2">&quot;1&quot;</span>
  <span class="p">},</span>
  <span class="nt">&quot;TableName&quot;</span><span class="p">:</span> <span class="s2">&quot;foo&quot;</span>
<span class="p">}</span></code></pre></figure><p>The table will be created during the <code>pre-integration-test</code> phase and dropped at the <code>post-integration-test</code> phase. Now, we can make our integration test much more meaningful with the help of <a href="http://dynamo.jcabi.com">jcabi-dynamo</a>:</p><figure class="highlight"><pre><code class="language-java" data-lang="java"><span></span><span class="kn">import</span> <span class="nn">com.jcabi.dynamo.Attributes</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">com.jcabi.dynamo.Conditions</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">com.jcabi.dynamo.Credentials</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">com.jcabi.dynamo.Region</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">com.jcabi.dynamo.Table</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">org.hamcrest.MatcherAssert</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">org.hamcrest.Matchers</span><span class="o">;</span>
<span class="kd">public</span> <span class="kd">class</span> <span class="nc">FooITCase</span> <span class="o">{</span>
  <span class="nd">@Test</span>
  <span class="kd">public</span> <span class="kt">void</span> <span class="nf">worksWithAwsDynamoDb</span><span class="o">()</span> <span class="o">{</span>
    <span class="n">Region</span> <span class="n">region</span> <span class="o">=</span> <span class="k">new</span> <span class="n">Region</span><span class="o">.</span><span class="na">Simple</span><span class="o">(</span><span class="k">new</span> <span class="n">Credentials</span><span class="o">.</span><span class="na">Simple</span><span class="o">(</span><span class="s">&quot;&quot;</span><span class="o">,</span> <span class="s">&quot;&quot;</span><span class="o">));</span>
    <span class="n">Table</span> <span class="n">table</span> <span class="o">=</span> <span class="n">region</span><span class="o">.</span><span class="na">table</span><span class="o">(</span><span class="s">&quot;foo&quot;</span><span class="o">);</span>
    <span class="n">table</span><span class="o">.</span><span class="na">put</span><span class="o">(</span>
      <span class="k">new</span> <span class="n">Attributes</span><span class="o">()</span>
        <span class="o">.</span><span class="na">with</span><span class="o">(</span><span class="s">&quot;id&quot;</span><span class="o">,</span> <span class="mi">123</span><span class="o">)</span>
        <span class="o">.</span><span class="na">with</span><span class="o">(</span><span class="s">&quot;name&quot;</span><span class="o">,</span> <span class="s">&quot;Robert DeNiro&quot;</span><span class="o">)</span>
    <span class="o">);</span>
    <span class="n">MatcherAssert</span><span class="o">.</span><span class="na">assertThat</span><span class="o">(</span>
      <span class="n">table</span><span class="o">.</span><span class="na">frame</span><span class="o">().</span><span class="na">where</span><span class="o">(</span><span class="s">&quot;id&quot;</span><span class="o">,</span> <span class="n">Conditions</span><span class="o">.</span><span class="na">equalTo</span><span class="o">(</span><span class="mi">123</span><span class="o">)),</span>
      <span class="n">Matchers</span><span class="o">.</span><span class="na">notEmpty</span><span class="o">()</span>
    <span class="o">);</span>
  <span class="o">}</span>
<span class="o">}</span></code></pre></figure><p>The above test will put a new item into the table and then assert that the item is there.</p><p>The plugin was tested with three operating systems, and proved to work without problems: Mac OS X 10.8.5, Windows 7 SP1 and Ubuntu Linux 12.04 Desktop.</p></div></article></div><div class="wrapper"> <related-posts /></div><div class="disqus" role="complementary"><p class="disqus_hint"> Please, use <a href="https://help.disqus.com/commenting/what-html-tags-are-allowed-within-comments">syntax highlighting</a> in your comments, to make them more readable.</p><div id="disqus_thread" class="disqus-thread"> <a>&nbsp;</a></div><script> var disqus_config = function () { this.page.url = document.location.href.split('?')[0].split('#')[0].replace('https://', 'http://'); this.page.identifier = this.page.url; }; (function() { var d = document, s = d.createElement('script'); s.src = '//yegor256.disqus.com/embed.js'; s.setAttribute('data-timestamp', +new Date()); (d.head || d.body).appendChild(s); })(); </script> <noscript><div><p class="red"> JavaScript is disabled in your browser, that's why you can't see comments under this post.</p></div></noscript></div><div class="wrapper"> <footer class="footer"><p> &copy; <span itemscope="" itemprop="copyrightHolder" itemtype="http://schema.org/Person"> <span itemprop="name">Yegor Bugayenko</span> </span> 2014&ndash;<span itemprop="copyrightYear">2018</span></p></footer></div></section><div class="wrapper unprintable" style="text-align:center;margin-top:2em;"> <a href="http://www.sixnines.io/h/3ba1652f"> <img src="//www.sixnines.io/b/3ba1652f?style=flat" alt="sixnines availability badge"/> </a></div><script src="//code.jquery.com/jquery-1.9.0.min.js"></script> <script src="/js/all.js?4e047f6f42b"></script> <script>var disqus_shortname = 'yegor256';</script> <script id="dsq-count-scr" src="//yegor256.disqus.com/count.js" async="async"></script> <script> (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){ (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o), m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m) })(window,document,'script','//www.google-analytics.com/analytics.js','ga'); ga('create', 'UA-1963507-32', 'auto'); ga('send', 'pageview'); </script> <script> Cd=document;Cr="&"+Math.random();Cp="&s=1"; Cd.cookie="b=b";if(Cd.cookie)Cp+="&c=1"; Cp+="&t="+(new Date()).getTimezoneOffset(); if(self!=top)Cp+="&f=1"; </script> <script> if(navigator.javaEnabled())Cp+="&j=1"; </script> <script> if(typeof(screen)!='undefined')Cp+="&w="+screen.width+"&h="+ screen.height+"&d="+(screen.colorDepth?screen.colorDepth:screen.pixelDepth); </script> <script> Cd.write("<img src='//c.hit.ua/hit?i=95870&g=0&x=2"+Cp+Cr+ "&r="+escape(Cd.referrer)+"&u="+escape(window.location.href)+ "' border='0' wi"+"dth='1' he"+"ight='1'/>"); </script> <script type="application/ld+json"> { "@context": "http://schema.org", "@type": "Person", "name": "Yegor Bugayenko", "url": "http://www.yegor256.com", "sameAs": [ "https://www.facebook.com/yegor256", "https://instagram.com/yegor256", "https://www.linkedin.com/in/yegor256", "https://twitter.com/yegor256", "https://github.com/yegor256", "https://www.pinterest.com/yegor256/" ] } </script> </body> </html> <!DOCTYPE html> <html xmlns="http://www.w3.org/1999/xhtml" lang="en-US" xml:lang="en-US" itemscope="" itemtype="http://schema.org/WebSite"> <head> <meta charset="utf-8"/> <meta name="description" content="The article explains how to use jcabi-w3c, which is a Java adapter of W3C online validators, for HTML and CSS " /> <meta name="keywords" content="java w3c jigsaw, java w3c validator, jigsaw css w3c validator, w3c java validator, w3c jigsaw java css validator, w3c validator, w3c validator java example, w3c validator java library" /> <meta name="viewport" content="width=device-width,minimum-scale=1,initial-scale=1"/> <meta name="google-site-verification" content="JEj_gQr2CPe2QKGw8XdMz0R7VboQIUbX3FlM-lwTq-8" /> <meta name="author" content="Yegor Bugayenko"> <meta name="article:published_time" content="2014-04-29 00:00:00 +0000"> <meta name="og:site_name" content="Yegor Bugayenko"/> <meta name="og:type" content="article" /> <meta name="og:locale" content="en_US" /> <meta name="twitter:account_id" content="4503599630178231" /> <meta name="twitter:creator" content="@yegor256"/> <meta name="twitter:site" content="@yegor256"/> <meta name="twitter:title" property="og:title" content="W3C Java Validators"/> <meta name="twitter:description" property="og:description" content="The article explains how to use jcabi-w3c, which is a Java adapter of W3C online validators, for HTML and CSS "/> <meta name="twitter:url" property="og:url" content="https://www.yegor256.com/2014/04/29/w3c-java-validators.html"/> <meta name="telegram:channel" content="AAAAAEJFMRzsRTRxM3ec6A"/> <link rel="search" type="application/opensearchdescription+xml" href="/opensearch.xml" title="yegor256" /> <link rel="shortcut icon" href="/favicon.ico?4e047f6f42b"/> <link rel="apple-touch-icon" href="/favicon.ico?4e047f6f42b"/> <link rel="alternate" type="application/rss+xml" title="RSS for yegor256.com" href="https://www.yegor256.com/rss.xml"/> <link rel="stylesheet" href="/css/layout.css?4e047f6f42b"/> <link rel="stylesheet" href="/css/icons.css?4e047f6f42b"/> <link rel="canonical" href="https://www.yegor256.com/2014/04/29/w3c-java-validators.html" /> <link rel="amphtml" href="https://www.yegor256.com/2014/04/29/w3c-java-validators.amp.html" /> <title>W3C Java Validators </title> </head> <body><div class="wrapper"> <aside class="header-toggle unprintable" id="header-toggle" title="Show the menu" onclick="$('#header').show();$('#header-toggle').hide();">&#9776;</aside> <header class="header" id="header"><div class="face"> <a href="/about-me.html#form" class="sub" title="Click to subscribe to my monthly newsletter"><span>Subscribe</span></a> <a href="/about-me.html" style="position:relative;"> <img src="/images/face-256x256.jpg" class="photo" alt="Yegor Bugayenko"/> </a></div><nav><ul class="menu social notranslate"> <li><a href="https://twitter.com/intent/follow?screen_name=yegor256" rel="nofollow" title="Follow me on Twitter"><i class="icon icon-twitter notranslate" aria-hidden="true"></i></a></li> <li><a href="/rss.xml" rel="nofollow" title="Subscribe to my RSS feed"><i class="icon icon-rss notranslate" aria-hidden="true"></i></a></li> <li><a itemprop="sameAs" href="https://github.com/yegor256" rel="nofollow" title="My GitHub profile"><i class="icon icon-github notranslate" aria-hidden="true"></i></a></li> <li><a itemprop="sameAs" href="http://stackoverflow.com/users/187141/yegor256" rel="nofollow" title="My StackOverflow profile"><i class="icon icon-stackoverflow notranslate" aria-hidden="true"></i></a></li> <li><a itemprop="sameAs" href="https://www.facebook.com/yegor256" rel="nofollow" title="Follow me on Facebook"><i class="icon icon-facebook notranslate" aria-hidden="true"></i></a></li> <li><a itemprop="sameAs" href="https://instagram.com/yegor256" rel="nofollow" title="Follow me on Instagram"><i class="icon icon-instagram notranslate" aria-hidden="true"></i></a></li> <li><a itemprop="sameAs" href="https://www.linkedin.com/in/yegor256" rel="nofollow" title="My LinkedIn profile"><i class="icon icon-linkedin notranslate" aria-hidden="true"></i></a></li> <li><a itemprop="sameAs" href="https://www.youtube.com/c/yegor256?sub_confirmation=1" rel="nofollow" title="My Youtube video channel"><i class="icon icon-youtube notranslate" aria-hidden="true"></i></a></li> <li><a itemprop="sameAs" href="https://www.pinterest.com/yegor256/" rel="nofollow" title="My Pinterest boards"><i class="icon icon-pinterest notranslate" aria-hidden="true"></i></a></li> <li><a itemprop="sameAs" href="https://angel.co/yegor256" rel="nofollow" title="My AngelList profile"><i class="icon icon-angellist notranslate" aria-hidden="true"></i></a></li> <li><a href="https://soundcloud.com/yegor256" rel="nofollow" title="My podcast"><i class="icon icon-podcast notranslate" aria-hidden="true"></i></a></li> <li><a href="https://itunes.apple.com/us/podcast/yegor256-podcast/id1150826721" rel="nofollow" title="My iTunes podcast"><i class="icon icon-itunes notranslate" aria-hidden="true"></i></a></li> <li><a href="https://t.me/joinchat/AAAAAEJFMRzsRTRxM3ec6A" rel="nofollow" title="My Telegram public channel"><i class="icon icon-telegram notranslate" aria-hidden="true"></i></a></li> <li><a href="mailto:blog@yegor256.com" rel="nofollow" title="Email me any time"><i class="icon icon-mail notranslate" aria-hidden="true"></i></a></li></ul><ul class="menu"> <li><a href="/" title="Home page">Home</a></li> <li ><a href="/best.html" title="Best articles to read">12&#160;Best</a></li> <li ><a href="/contents.html" title="The contents of the entire blog">All&#160;288</a></li> <li ><a href="/webinars.html" title="My webinars">Webinars</a></li> <li ><a href="/talks.html" title="Future and past conference talks">Talks</a></li> <li ><a href="/books.html" title="The books I wrote">Books</a></li> <li ><a href="/papers.html" title="My academic papers and patents">Papers</a></li> <li ><a href="/pets.html" title="My loved pet projects">Pets</a></li> <li ><a href="/award.html" title="Software quality award">Award</a></li> <li ><a href="/testimonials.html" title="What some people say about me">Testimonials</a></li> <li ><a href="/shift-m.html" title="Audio podcast about project management">Shift-M</a></li> <li ><a href="/paintings.html" title="My paintings for sale">Paintings</a></li> <li><a href="http://ru.yegor256.com/" title="Немного на русском языке">По-русски</a></li></ul></nav><div class="search"> <form method="get" action="https://www.google.com/search" itemprop="potentialAction" itemscope="" itemtype="http://schema.org/SearchAction"> <meta itemprop="target" content="https://www.google.com/search?q={q}"/> <input name="sitesearch" value="yegor256.com" type="hidden"/> <input itemprop="query-input" type="text" id="search-query" class="field field-text" required="required" onfocus="$('.google').css('visibility', 'visible');" name="q" placeholder="Search..." autocomplete="off"/> <input type="image" src="/images/google-search-icon.svg" class="google" title="Search via Google" alt="Search via Google"/> </form></div><div class="hot"><ul> <li> <a href="/code-ahead.html">Code Ahead</a> was published on Amazon just a few days ago! It is my new book, a novel about programmers. It explains in details the majority of ideas that stand behind <a href="https://www.zerocracy.com">Zerocracy</a> and <a href="https://www.xdsd.org">XDSD</a>. </li> <li> At <a href="/webinars.html">Webinar #37</a> we will discuss naming problem in OOP, for objects, methods and attributes; join us on <b>September 12</b>, at 11am PST. </li></ul></div></header></div><section itemscope="" itemtype="http://schema.org/BlogPosting"><div class="wrapper"> <header><p class="printable"> <img src="https://api.qrserver.com/v1/create-qr-code/?data=https://www.yegor256.com/2014/04/29/w3c-java-validators.html&amp;format=svg" style="width:125px;height:125px;" alt="QR code"/></p><p class="printable"> <code itemprop="url">https://www.yegor256.com/2014/04/29/w3c-java-validators.html</code></p><h1 itemprop="name headline mainEntityOfPage">W3C Java Validators</h1><ul class="subline"> <li> <time itemprop="datePublished" datetime="2014-04-29T00:00:00+00:00"> 29 April 2014 </time> </li> <li class="printable" itemscope="" itemprop="author" itemtype="http://schema.org/Person"> <span itemprop="name">Yegor Bugayenko</span> </li> <li class="unprintable"> <i class="icon icon-comments"></i> <a href="http://www.yegor256.com/2014/04/29/w3c-java-validators.html#disqus_thread" itemprop="discussionUrl">comments</a> </li></ul><p>The <code>valid()</code> method is a black or white indicator that returns <code>false</code> when the document is not valid. Additionally, you can obtain more information through a list of &quot;defects&quot; returned by the W3C server:</p><figure class="highlight"><pre><code class="language-java" data-lang="java"><span></span><span class="n">Collection</span><span class="o">&lt;</span><span class="n">Defect</span><span class="o">&gt;</span> <span class="n">defects</span> <span class="o">=</span> <span class="n">ValidatorBuilder</span><span class="o">.</span><span class="na">html</span><span class="o">()</span>
  <span class="o">.</span><span class="na">validate</span><span class="o">(</span><span class="s">&quot;&lt;html&gt;hello, world!&lt;/html&gt;&quot;</span><span class="o">)</span>
  <span class="o">.</span><span class="na">errors</span><span class="o">();</span></code></pre></figure><p>The same can be done with CSS:</p><figure class="highlight"><pre><code class="language-java" data-lang="java"><span></span><span class="n">Collection</span><span class="o">&lt;</span><span class="n">Defect</span><span class="o">&gt;</span> <span class="n">defects</span> <span class="o">=</span> <span class="n">ValidatorBuilder</span><span class="o">.</span><span class="na">css</span><span class="o">()</span>
  <span class="o">.</span><span class="na">validate</span><span class="o">(</span><span class="s">&quot;body { font-family: Arial; }&quot;</span><span class="o">)</span>
  <span class="o">.</span><span class="na">errors</span><span class="o">();</span></code></pre></figure><p>Personally, I think it is a good practice to validate all of HTML pages produced by your application against W3C during integration testing. It&#39;s not a matter of seeking perfection, but rather of preventing bigger problems later.</p><p>These dependencies are mandatory when using jcabi-w3c (get their latest versions in <a href="http://search.maven.org/">Maven Central</a>):</p><figure class="highlight"><pre><code class="language-xml" data-lang="xml"><span></span><span class="nt">&lt;dependency&gt;</span>
  <span class="nt">&lt;groupId&gt;</span>com.jcabi<span class="nt">&lt;/groupId&gt;</span>
  <span class="nt">&lt;artifactId&gt;</span>jcabi-w3c<span class="nt">&lt;/artifactId&gt;</span>
<span class="nt">&lt;/dependency&gt;</span>
<span class="nt">&lt;dependency&gt;</span>
  <span class="nt">&lt;groupId&gt;</span>org.glassfish<span class="nt">&lt;/groupId&gt;</span>
  <span class="nt">&lt;artifactId&gt;</span>javax.json<span class="nt">&lt;/artifactId&gt;</span>
<span class="nt">&lt;/dependency&gt;</span>
<span class="nt">&lt;dependency&gt;</span>
  <span class="nt">&lt;groupId&gt;</span>com.sun.jersey<span class="nt">&lt;/groupId&gt;</span>
  <span class="nt">&lt;artifactId&gt;</span>jersey-client<span class="nt">&lt;/artifactId&gt;</span>
<span class="nt">&lt;/dependency&gt;</span>
<span class="nt">&lt;dependency&gt;</span>
  <span class="nt">&lt;groupId&gt;</span>org.hamcrest<span class="nt">&lt;/groupId&gt;</span>
  <span class="nt">&lt;artifactId&gt;</span>hamcrest-core<span class="nt">&lt;/artifactId&gt;</span>
<span class="nt">&lt;/dependency&gt;</span></code></pre></figure></p>--> <nav class="buttons notranslate desktop-only"> <a href="http://www.facebook.com/sharer/sharer.php?u=https://www.yegor256.com/2014/04/29/w3c-java-validators.html" title="Share on Facebook" class="button" rel="nofollow"> <span class="count count-facebook">0</span> <i class="icon icon-facebook notranslate" aria-hidden="true"></i> </a> <a href="https://twitter.com/share?url=https://www.yegor256.com/2014/04/29/w3c-java-validators.html&amp;text=W3C+Java+Validators" title="Share on Twitter" class="button" rel="nofollow"> <span class="count count-twitter">0</span> <i class="icon icon-twitter notranslate" aria-hidden="true"></i> </a> <a href="https://plus.google.com/share?url=https://www.yegor256.com/2014/04/29/w3c-java-validators.html" title="Share on Google+" class="button" rel="nofollow"> <span class="count count-googleplus">0</span> <i class="icon icon-googleplus notranslate" aria-hidden="true"></i> </a> <a href="https://www.linkedin.com/cws/share?url=https://www.yegor256.com/2014/04/29/w3c-java-validators.html" title="Share on LinkedIn" class="button" rel="nofollow"> <span class="count count-linkedin">0</span> <i class="icon icon-linkedin notranslate" aria-hidden="true"></i> </a> <a href="http://reddit.com/submit?url=https://www.yegor256.com/2014/04/29/w3c-java-validators.html%3F2014-17&amp;title=W3C+Java+Validators" title="Share on Reddit" class="button" rel="nofollow"> <span class="count count-reddit">0</span> <i class="icon icon-reddit notranslate" aria-hidden="true"></i> </a> <a href="http://news.ycombinator.com/submitlink?u=https://www.yegor256.com/2014/04/29/w3c-java-validators.html%3F2014-17&amp;t=W3C+Java+Validators" title="Share on Hacker News" class="button" rel="nofollow"> <span class="count count-hackernews">0</span> <i class="icon icon-hackernews notranslate" aria-hidden="true"></i> </a> </nav> </header> <article class="main" itemprop="articleBody"><div > <figure class='badge'><a href='http://w3c.jcabi.com'><img src='http://img.jcabi.com/logo-square.svg' style='width:64px;max-width:100%;' alt='badge'/></a></figure><p>A few years ago, I created two Java wrappers for W3C validators: (<a href="http://validator.w3.org/">HTML</a> and <a href="http://jigsaw.w3.org/css-validator/">CSS</a>). Both wrappers seemed to be working fine and were even listed by W3C on <a href="http://validator.w3.org/docs/api.html">their website</a> in the API section. Until recently, these wrappers have always been part of <a href="https://github.com/yegor256/rexsl">ReXSL</a> library.</p><p>A few days ago, though, I took the wrappers out of ReXSL and published them as a standalone library---<a href="http://w3c.jcabi.com">jcabi-w3c</a>. Consequently, now seems to be a good time to write a few words about them.</p><p>Below is an example that demonstrates how you can validate an HTML document against W3C compliance rules:</p><figure class="highlight"><pre><code class="language-java" data-lang="java"><span></span><span class="kn">import</span> <span class="nn">com.jcabi.w3c.ValidatorBuilder</span><span class="o">;</span>
<span class="k">assert</span> <span class="n">ValidatorBuilder</span><span class="o">.</span><span class="na">html</span><span class="o">()</span>
  <span class="o">.</span><span class="na">validate</span><span class="o">(</span><span class="s">&quot;&lt;html&gt;hello, world!&lt;/html&gt;&quot;</span><span class="o">)</span>
  <span class="o">.</span><span class="na">valid</span><span class="o">();</span></code></pre></figure><p>The <code>valid()</code> method is a black or white indicator that returns <code>false</code> when the document is not valid. Additionally, you can obtain more information through a list of &quot;defects&quot; returned by the W3C server:</p><figure class="highlight"><pre><code class="language-java" data-lang="java"><span></span><span class="n">Collection</span><span class="o">&lt;</span><span class="n">Defect</span><span class="o">&gt;</span> <span class="n">defects</span> <span class="o">=</span> <span class="n">ValidatorBuilder</span><span class="o">.</span><span class="na">html</span><span class="o">()</span>
  <span class="o">.</span><span class="na">validate</span><span class="o">(</span><span class="s">&quot;&lt;html&gt;hello, world!&lt;/html&gt;&quot;</span><span class="o">)</span>
  <span class="o">.</span><span class="na">errors</span><span class="o">();</span></code></pre></figure><p>The same can be done with CSS:</p><figure class="highlight"><pre><code class="language-java" data-lang="java"><span></span><span class="n">Collection</span><span class="o">&lt;</span><span class="n">Defect</span><span class="o">&gt;</span> <span class="n">defects</span> <span class="o">=</span> <span class="n">ValidatorBuilder</span><span class="o">.</span><span class="na">css</span><span class="o">()</span>
  <span class="o">.</span><span class="na">validate</span><span class="o">(</span><span class="s">&quot;body { font-family: Arial; }&quot;</span><span class="o">)</span>
  <span class="o">.</span><span class="na">errors</span><span class="o">();</span></code></pre></figure><p>Personally, I think it is a good practice to validate all of HTML pages produced by your application against W3C during integration testing. It&#39;s not a matter of seeking perfection, but rather of preventing bigger problems later.</p><p>These dependencies are mandatory when using jcabi-w3c (get their latest versions in <a href="http://search.maven.org/">Maven Central</a>):</p><figure class="highlight"><pre><code class="language-xml" data-lang="xml"><span></span><span class="nt">&lt;dependency&gt;</span>
  <span class="nt">&lt;groupId&gt;</span>com.jcabi<span class="nt">&lt;/groupId&gt;</span>
  <span class="nt">&lt;artifactId&gt;</span>jcabi-w3c<span class="nt">&lt;/artifactId&gt;</span>
<span class="nt">&lt;/dependency&gt;</span>
<span class="nt">&lt;dependency&gt;</span>
  <span class="nt">&lt;groupId&gt;</span>org.glassfish<span class="nt">&lt;/groupId&gt;</span>
  <span class="nt">&lt;artifactId&gt;</span>javax.json<span class="nt">&lt;/artifactId&gt;</span>
<span class="nt">&lt;/dependency&gt;</span>
<span class="nt">&lt;dependency&gt;</span>
  <span class="nt">&lt;groupId&gt;</span>com.sun.jersey<span class="nt">&lt;/groupId&gt;</span>
  <span class="nt">&lt;artifactId&gt;</span>jersey-client<span class="nt">&lt;/artifactId&gt;</span>
<span class="nt">&lt;/dependency&gt;</span>
<span class="nt">&lt;dependency&gt;</span>
  <span class="nt">&lt;groupId&gt;</span>org.hamcrest<span class="nt">&lt;/groupId&gt;</span>
  <span class="nt">&lt;artifactId&gt;</span>hamcrest-core<span class="nt">&lt;/artifactId&gt;</span>
<span class="nt">&lt;/dependency&gt;</span></code></pre></figure></div></article></div><div class="wrapper"> <related-posts /></div><div class="disqus" role="complementary"><p class="disqus_hint"> Please, use <a href="https://help.disqus.com/commenting/what-html-tags-are-allowed-within-comments">syntax highlighting</a> in your comments, to make them more readable.</p><div id="disqus_thread" class="disqus-thread"> <a>&nbsp;</a></div><script> var disqus_config = function () { this.page.url = document.location.href.split('?')[0].split('#')[0].replace('https://', 'http://'); this.page.identifier = this.page.url; }; (function() { var d = document, s = d.createElement('script'); s.src = '//yegor256.disqus.com/embed.js'; s.setAttribute('data-timestamp', +new Date()); (d.head || d.body).appendChild(s); })(); </script> <noscript><div><p class="red"> JavaScript is disabled in your browser, that's why you can't see comments under this post.</p></div></noscript></div><div class="wrapper"> <footer class="footer"><p> &copy; <span itemscope="" itemprop="copyrightHolder" itemtype="http://schema.org/Person"> <span itemprop="name">Yegor Bugayenko</span> </span> 2014&ndash;<span itemprop="copyrightYear">2018</span></p></footer></div></section><div class="wrapper unprintable" style="text-align:center;margin-top:2em;"> <a href="http://www.sixnines.io/h/3ba1652f"> <img src="//www.sixnines.io/b/3ba1652f?style=flat" alt="sixnines availability badge"/> </a></div><script src="//code.jquery.com/jquery-1.9.0.min.js"></script> <script src="/js/all.js?4e047f6f42b"></script> <script>var disqus_shortname = 'yegor256';</script> <script id="dsq-count-scr" src="//yegor256.disqus.com/count.js" async="async"></script> <script> (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){ (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o), m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m) })(window,document,'script','//www.google-analytics.com/analytics.js','ga'); ga('create', 'UA-1963507-32', 'auto'); ga('send', 'pageview'); </script> <script> Cd=document;Cr="&"+Math.random();Cp="&s=1"; Cd.cookie="b=b";if(Cd.cookie)Cp+="&c=1"; Cp+="&t="+(new Date()).getTimezoneOffset(); if(self!=top)Cp+="&f=1"; </script> <script> if(navigator.javaEnabled())Cp+="&j=1"; </script> <script> if(typeof(screen)!='undefined')Cp+="&w="+screen.width+"&h="+ screen.height+"&d="+(screen.colorDepth?screen.colorDepth:screen.pixelDepth); </script> <script> Cd.write("<img src='//c.hit.ua/hit?i=95870&g=0&x=2"+Cp+Cr+ "&r="+escape(Cd.referrer)+"&u="+escape(window.location.href)+ "' border='0' wi"+"dth='1' he"+"ight='1'/>"); </script> <script type="application/ld+json"> { "@context": "http://schema.org", "@type": "Person", "name": "Yegor Bugayenko", "url": "http://www.yegor256.com", "sameAs": [ "https://www.facebook.com/yegor256", "https://instagram.com/yegor256", "https://www.linkedin.com/in/yegor256", "https://twitter.com/yegor256", "https://github.com/yegor256", "https://www.pinterest.com/yegor256/" ] } </script> </body> </html> <!DOCTYPE html> <html xmlns="http://www.w3.org/1999/xhtml" lang="en-US" xml:lang="en-US" itemscope="" itemtype="http://schema.org/WebSite"> <head> <meta charset="utf-8"/> <meta name="description" content="The article lists the most common programming mistakes I catch during code reviews, which can&apos;t be caught by static analysis " /> <meta name="keywords" content="bad practices, bad practices in java, bad practices in programming, good practices in programming, java programming good practices, mistakes in OOP, object oriented typical mistakes" /> <meta name="viewport" content="width=device-width,minimum-scale=1,initial-scale=1"/> <meta name="google-site-verification" content="JEj_gQr2CPe2QKGw8XdMz0R7VboQIUbX3FlM-lwTq-8" /> <meta name="author" content="Yegor Bugayenko"> <meta name="article:published_time" content="2014-04-27 00:00:00 +0000"> <meta name="og:site_name" content="Yegor Bugayenko"/> <meta name="og:type" content="article" /> <meta name="og:locale" content="en_US" /> <meta name="twitter:account_id" content="4503599630178231" /> <meta name="twitter:creator" content="@yegor256"/> <meta name="twitter:site" content="@yegor256"/> <meta name="twitter:title" property="og:title" content="Typical Mistakes in Java Code"/> <meta name="twitter:description" property="og:description" content="The article lists the most common programming mistakes I catch during code reviews, which can&apos;t be caught by static analysis "/> <meta name="twitter:url" property="og:url" content="https://www.yegor256.com/2014/04/27/typical-mistakes-in-java-code.html"/> <meta name="telegram:channel" content="AAAAAEJFMRzsRTRxM3ec6A"/> <link rel="search" type="application/opensearchdescription+xml" href="/opensearch.xml" title="yegor256" /> <link rel="shortcut icon" href="/favicon.ico?4e047f6f42b"/> <link rel="apple-touch-icon" href="/favicon.ico?4e047f6f42b"/> <link rel="alternate" type="application/rss+xml" title="RSS for yegor256.com" href="https://www.yegor256.com/rss.xml"/> <link rel="stylesheet" href="/css/layout.css?4e047f6f42b"/> <link rel="stylesheet" href="/css/icons.css?4e047f6f42b"/> <link rel="canonical" href="https://www.yegor256.com/2014/04/27/typical-mistakes-in-java-code.html" /> <link rel="amphtml" href="https://www.yegor256.com/2014/04/27/typical-mistakes-in-java-code.amp.html" /> <title>Typical Mistakes in Java Code </title> </head> <body><div class="wrapper"> <aside class="header-toggle unprintable" id="header-toggle" title="Show the menu" onclick="$('#header').show();$('#header-toggle').hide();">&#9776;</aside> <header class="header" id="header"><div class="face"> <a href="/about-me.html#form" class="sub" title="Click to subscribe to my monthly newsletter"><span>Subscribe</span></a> <a href="/about-me.html" style="position:relative;"> <img src="/images/face-256x256.jpg" class="photo" alt="Yegor Bugayenko"/> </a></div><nav><ul class="menu social notranslate"> <li><a href="https://twitter.com/intent/follow?screen_name=yegor256" rel="nofollow" title="Follow me on Twitter"><i class="icon icon-twitter notranslate" aria-hidden="true"></i></a></li> <li><a href="/rss.xml" rel="nofollow" title="Subscribe to my RSS feed"><i class="icon icon-rss notranslate" aria-hidden="true"></i></a></li> <li><a itemprop="sameAs" href="https://github.com/yegor256" rel="nofollow" title="My GitHub profile"><i class="icon icon-github notranslate" aria-hidden="true"></i></a></li> <li><a itemprop="sameAs" href="http://stackoverflow.com/users/187141/yegor256" rel="nofollow" title="My StackOverflow profile"><i class="icon icon-stackoverflow notranslate" aria-hidden="true"></i></a></li> <li><a itemprop="sameAs" href="https://www.facebook.com/yegor256" rel="nofollow" title="Follow me on Facebook"><i class="icon icon-facebook notranslate" aria-hidden="true"></i></a></li> <li><a itemprop="sameAs" href="https://instagram.com/yegor256" rel="nofollow" title="Follow me on Instagram"><i class="icon icon-instagram notranslate" aria-hidden="true"></i></a></li> <li><a itemprop="sameAs" href="https://www.linkedin.com/in/yegor256" rel="nofollow" title="My LinkedIn profile"><i class="icon icon-linkedin notranslate" aria-hidden="true"></i></a></li> <li><a itemprop="sameAs" href="https://www.youtube.com/c/yegor256?sub_confirmation=1" rel="nofollow" title="My Youtube video channel"><i class="icon icon-youtube notranslate" aria-hidden="true"></i></a></li> <li><a itemprop="sameAs" href="https://www.pinterest.com/yegor256/" rel="nofollow" title="My Pinterest boards"><i class="icon icon-pinterest notranslate" aria-hidden="true"></i></a></li> <li><a itemprop="sameAs" href="https://angel.co/yegor256" rel="nofollow" title="My AngelList profile"><i class="icon icon-angellist notranslate" aria-hidden="true"></i></a></li> <li><a href="https://soundcloud.com/yegor256" rel="nofollow" title="My podcast"><i class="icon icon-podcast notranslate" aria-hidden="true"></i></a></li> <li><a href="https://itunes.apple.com/us/podcast/yegor256-podcast/id1150826721" rel="nofollow" title="My iTunes podcast"><i class="icon icon-itunes notranslate" aria-hidden="true"></i></a></li> <li><a href="https://t.me/joinchat/AAAAAEJFMRzsRTRxM3ec6A" rel="nofollow" title="My Telegram public channel"><i class="icon icon-telegram notranslate" aria-hidden="true"></i></a></li> <li><a href="mailto:blog@yegor256.com" rel="nofollow" title="Email me any time"><i class="icon icon-mail notranslate" aria-hidden="true"></i></a></li></ul><ul class="menu"> <li><a href="/" title="Home page">Home</a></li> <li ><a href="/best.html" title="Best articles to read">12&#160;Best</a></li> <li ><a href="/contents.html" title="The contents of the entire blog">All&#160;288</a></li> <li ><a href="/webinars.html" title="My webinars">Webinars</a></li> <li ><a href="/talks.html" title="Future and past conference talks">Talks</a></li> <li ><a href="/books.html" title="The books I wrote">Books</a></li> <li ><a href="/papers.html" title="My academic papers and patents">Papers</a></li> <li ><a href="/pets.html" title="My loved pet projects">Pets</a></li> <li ><a href="/award.html" title="Software quality award">Award</a></li> <li ><a href="/testimonials.html" title="What some people say about me">Testimonials</a></li> <li ><a href="/shift-m.html" title="Audio podcast about project management">Shift-M</a></li> <li ><a href="/paintings.html" title="My paintings for sale">Paintings</a></li> <li><a href="http://ru.yegor256.com/" title="Немного на русском языке">По-русски</a></li></ul></nav><div class="search"> <form method="get" action="https://www.google.com/search" itemprop="potentialAction" itemscope="" itemtype="http://schema.org/SearchAction"> <meta itemprop="target" content="https://www.google.com/search?q={q}"/> <input name="sitesearch" value="yegor256.com" type="hidden"/> <input itemprop="query-input" type="text" id="search-query" class="field field-text" required="required" onfocus="$('.google').css('visibility', 'visible');" name="q" placeholder="Search..." autocomplete="off"/> <input type="image" src="/images/google-search-icon.svg" class="google" title="Search via Google" alt="Search via Google"/> </form></div><div class="hot"><ul> <li> <a href="/code-ahead.html">Code Ahead</a> was published on Amazon just a few days ago! It is my new book, a novel about programmers. It explains in details the majority of ideas that stand behind <a href="https://www.zerocracy.com">Zerocracy</a> and <a href="https://www.xdsd.org">XDSD</a>. </li> <li> At <a href="/webinars.html">Webinar #37</a> we will discuss naming problem in OOP, for objects, methods and attributes; join us on <b>September 12</b>, at 11am PST. </li></ul></div></header></div><section itemscope="" itemtype="http://schema.org/BlogPosting"><div class="wrapper"> <header><p class="printable"> <img src="https://api.qrserver.com/v1/create-qr-code/?data=https://www.yegor256.com/2014/04/27/typical-mistakes-in-java-code.html&amp;format=svg" style="width:125px;height:125px;" alt="QR code"/></p><p class="printable"> <code itemprop="url">https://www.yegor256.com/2014/04/27/typical-mistakes-in-java-code.html</code></p><h1 itemprop="name headline mainEntityOfPage">Typical Mistakes in Java Code</h1><ul class="subline"> <li> <time itemprop="datePublished" datetime="2014-04-27T00:00:00+00:00"> 27 April 2014 </time> </li> <li class="printable" itemscope="" itemprop="author" itemtype="http://schema.org/Person"> <span itemprop="name">Yegor Bugayenko</span> </li> <li class="unprintable"> <i class="icon icon-comments"></i> <a href="http://www.yegor256.com/2014/04/27/typical-mistakes-in-java-code.html#disqus_thread" itemprop="discussionUrl">comments</a> </li></ul><ul class="unprintable subline"> <li>Translated:</li> <li><a href="http://blog.csdn.net/lvshuilantian/article/details/52303290">Chinese</a></li> <li><a href="mailto:translate@yegor256.com">add yours!</a></li></ul><p>Let me know if you want to see something else added here, and I&#39;ll be happy to oblige.</p><aside class='youtube'> <a href='https://www.youtube.com/watch?v=9yjtsCK6Wdk'><div class='box'> <img src='https://i.ytimg.com/vi/9yjtsCK6Wdk/mqdefault.jpg' alt='YouTube video #9yjtsCK6Wdk'/><div class='play'><i class='icon icon-play'></i></div></div></a><div>A Few Thoughts About Constructors in OOP (webinar #7); 7 October 2015.</div></aside><p>All of the listed mistakes are related to object-oriented programming in general and to Java in particular.</p><h2 id="class-names">Class Names</h2><p>Your class should be an abstraction of a real life entity with no &quot;validators,&quot; &quot;controllers,&quot; &quot;managers,&quot; etc. If your class name ends with an &quot;-er&quot;---it&#39;s <a href="http://c2.com/cgi/wiki?DontNameClassesObjectManagerHandlerOrData">a bad design</a>. BTW, here are my <a href="/2014/11/20/seven-virtues-of-good-object.html">seven virtues</a> of a good object. Also, this post explains this idea in more details: <a href="/2015/03/09/objects-end-with-er.html">Don&#39;t Create Objects That End With -ER</a>.</p><p>And, of course, utility classes are anti-patterns, like <a href="http://commons.apache.org/proper/commons-lang/javadocs/api-2.6/org/apache/commons/lang/StringUtils.html"><code>StringUtils</code></a>, <a href="http://commons.apache.org/proper/commons-io/javadocs/api-2.5/org/apache/commons/io/FileUtils.html"><code>FileUtils</code></a>, and <a href="https://commons.apache.org/proper/commons-io/javadocs/api-2.5/org/apache/commons/io/IOUtils.html"><code>IOUtils</code></a> from Apache. The above are perfect examples of terrible designs. Read this follow up post: <a href="/2014/05/05/oop-alternative-to-utility-classes.html">OOP Alternative to Utility Classes</a></p><p>Of course, never add suffixes or prefixes to distinguish between <a href="http://c2.com/cgi/wiki?DontDistinguishBetweenClassesAndInterfaces">interfaces and classes</a>. For example, all of these names are terribly wrong: <code>IRecord</code>, <code>IfaceEmployee</code>, or <code>RecordInterface</code>. Usually, interface name is the name of a real-life entity, while class name should explain its implementation details. If there is nothing specific to say about an implementation, name it <code>Default,</code> <code>Simple</code>, or something similar. For example:</p><div class="highlight"><pre><code class="language-java" data-lang="java"><span></span><span class="kd">class</span> <span class="nc">SimpleUser</span> <span class="kd">implements</span> <span class="n">User</span> <span class="o">{};</span>
<span class="kd">class</span> <span class="nc">DefaultRecord</span> <span class="kd">implements</span> <span class="n">Record</span> <span class="o">{};</span>
<span class="kd">class</span> <span class="nc">Suffixed</span> <span class="kd">implements</span> <span class="n">Name</span> <span class="o">{};</span>
<span class="kd">class</span> <span class="nc">Validated</span> <span class="kd">implements</span> <span class="n">Content</span> <span class="o">{};</span>
</code></pre></div><h2 id="method-names">Method Names</h2><p>Methods can either return something or return <code>void</code>. If a method returns something, then its name should explain <em>what it returns</em>, for example (don&#39;t use the <code>get</code> prefix <a href="/2014/09/16/getters-and-setters-are-evil.html">ever</a>):</p><div class="highlight"><pre><code class="language-java" data-lang="java"><span></span><span class="kt">boolean</span> <span class="nf">isValid</span><span class="o">(</span><span class="n">String</span> <span class="n">name</span><span class="o">);</span>
<span class="n">String</span> <span class="nf">content</span><span class="o">();</span>
<span class="kt">int</span> <span class="nf">ageOf</span><span class="o">(</span><span class="n">File</span> <span class="n">file</span><span class="o">);</span>
</code></pre></div><p>If it returns <code>void,</code> then its name should explain <em>what it does</em>. For example:</p><div class="highlight"><pre><code class="language-java" data-lang="java"><span></span><span class="kt">void</span> <span class="nf">save</span><span class="o">(</span><span class="n">File</span> <span class="n">file</span><span class="o">);</span>
<span class="kt">void</span> <span class="nf">process</span><span class="o">(</span><span class="n">Work</span> <span class="n">work</span><span class="o">);</span>
<span class="kt">void</span> <span class="nf">append</span><span class="o">(</span><span class="n">File</span> <span class="n">file</span><span class="o">,</span> <span class="n">String</span> <span class="n">line</span><span class="o">);</span>
</code></pre></div><p>You can read more about this idea in <a href="/elegant-objects.html">Elegant Objects</a> book, section <a href="/images/books/elegant-objects/contents.pdf">2.4</a>. There is only one exception to the rule just mentioned---test methods for JUnit. They are explained below.</p><h2 id="test-method-names">Test Method Names</h2><p>Method names in JUnit tests should be created as English sentences without spaces. It&#39;s easier to explain by example:</p><div class="highlight"><pre><code class="language-java" data-lang="java"><span></span><span class="cm">/**</span>
<span class="cm"> * HttpRequest can return its content in Unicode.</span>
<span class="cm"> * @throws Exception If test fails</span>
<span class="cm"> */</span>
<span class="nd">@Test</span>
<span class="kd">public</span> <span class="kt">void</span> <span class="nf">returnsItsContentInUnicode</span><span class="o">()</span> <span class="kd">throws</span> <span class="n">Exception</span> <span class="o">{</span>
<span class="o">}</span>
</code></pre></div><p>It&#39;s important to start the first sentence of your Javadoc with the name of the class you&#39;re testing followed by <code>can</code> (or <code>cannot</code>). So, your first sentence should always be similar to &quot;somebody <em>can</em> do something.&quot;</p><p>The method name will state exactly the same, but without the subject. If I add a subject at the beginning of the method name, I should get a complete English sentence, as in above example: &quot;<code>HttpRequest</code> returns its content in Unicode.&quot;</p><p>Pay attention that the test method doesn&#39;t start with <code>can</code>. Only Javadoc comments use &#39;can.&#39;</p><p>It&#39;s a good practice to always declare test methods as throwing <code>Exception</code>.</p><h2 id="variable-names">Variable Names</h2><p>Avoid composite names of variables, like <code>timeOfDay</code>, <code>firstItem</code>, or <code>httpRequest</code>. I mean with both---class variables and in-method ones. A variable name should be long enough to avoid ambiguity in its scope of visibility, but not too long if possible. A name should be a noun in singular or plural form, or an appropriate abbreviation. More about it in this post: <a href="/2015/01/12/compound-name-is-code-smell.html">A Compound Name Is a Code Smell</a>. For example:</p><div class="highlight"><pre><code class="language-java" data-lang="java"><span></span><span class="n">List</span><span class="o">&lt;</span><span class="n">String</span><span class="o">&gt;</span> <span class="n">names</span><span class="o">;</span>
<span class="kt">void</span> <span class="nf">sendThroughProxy</span><span class="o">(</span><span class="n">File</span> <span class="n">file</span><span class="o">,</span> <span class="n">Protocol</span> <span class="n">proto</span><span class="o">);</span>
<span class="kd">private</span> <span class="n">File</span> <span class="n">content</span><span class="o">;</span>
<span class="kd">public</span> <span class="n">HttpRequest</span> <span class="n">request</span><span class="o">;</span>
</code></pre></div><p>Sometimes, you may have collisions between <a href="/2015/05/07/ctors-must-be-code-free.html">constructor</a> parameters and in-class properties if the constructor saves incoming data in an instantiated object. In this case, I recommend to create abbreviations by removing vowels (see how <a href="http://pe.usps.gov/text/pub28/28apc_002.htm">USPS abbreviates street names</a>).</p><p>Another example:</p><div class="highlight"><pre><code class="language-java" data-lang="java"><span></span><span class="kd">public</span> <span class="kd">class</span> <span class="nc">Message</span> <span class="o">{</span>
  <span class="kd">private</span> <span class="n">String</span> <span class="n">recipient</span><span class="o">;</span>
  <span class="kd">public</span> <span class="nf">Message</span><span class="o">(</span><span class="n">String</span> <span class="n">rcpt</span><span class="o">)</span> <span class="o">{</span>
    <span class="k">this</span><span class="o">.</span><span class="na">recipient</span> <span class="o">=</span> <span class="n">rcpt</span><span class="o">;</span>
  <span class="o">}</span>
<span class="o">}</span>
</code></pre></div><p>In many cases, the best hint for a name of a variable can ascertained by reading its class name. Just write it with a small letter, and you should be good:</p><div class="highlight"><pre><code class="language-java" data-lang="java"><span></span><span class="n">File</span> <span class="n">file</span><span class="o">;</span>
<span class="n">User</span> <span class="n">user</span><span class="o">;</span>
<span class="n">Branch</span> <span class="n">branch</span><span class="o">;</span>
</code></pre></div><p>However, <em>never</em> do the same for primitive types, like <code>Integer number</code> or <code>String string</code>.</p><p>You can also use an adjective, when there are multiple variables with different characteristics. For instance:</p><div class="highlight"><pre><code class="language-text" data-lang="text"><span></span>String contact(String left, String right);
</code></pre></div><h2 id="constructors">Constructors</h2><p>Without <a href="/2016/06/17/dont-use-java-assertions.html">exceptions</a>, there should be only <em>one</em> constructor that stores data in object variables. All other constructors should call this one with different arguments. For example:</p><div class="highlight"><pre><code class="language-java" data-lang="java"><span></span><span class="kd">public</span> <span class="kd">class</span> <span class="nc">Server</span> <span class="o">{</span>
  <span class="kd">private</span> <span class="n">String</span> <span class="n">address</span><span class="o">;</span>
  <span class="kd">public</span> <span class="nf">Server</span><span class="o">(</span><span class="n">String</span> <span class="n">uri</span><span class="o">)</span> <span class="o">{</span>
    <span class="k">this</span><span class="o">.</span><span class="na">address</span> <span class="o">=</span> <span class="n">uri</span><span class="o">;</span>
  <span class="o">}</span>
  <span class="kd">public</span> <span class="nf">Server</span><span class="o">(</span><span class="n">URI</span> <span class="n">uri</span><span class="o">)</span> <span class="o">{</span>
    <span class="k">this</span><span class="o">(</span><span class="n">uri</span><span class="o">.</span><span class="na">toString</span><span class="o">());</span>
  <span class="o">}</span>
<span class="o">}</span>
</code></pre></div><p>More about it in <a href="/2015/05/28/one-primary-constructor.html">There Can Be Only One Primary Constructor</a>.</p><h2 id="one-time-variables">One-time Variables</h2><p>Avoid one-time variables at all costs. By &quot;one-time&quot; I mean variables that are used only once. Like in this example:</p><div class="highlight"><pre><code class="language-java" data-lang="java"><span></span><span class="n">String</span> <span class="n">name</span> <span class="o">=</span> <span class="s">&quot;data.txt&quot;</span><span class="o">;</span>
<span class="k">return</span> <span class="k">new</span> <span class="n">File</span><span class="o">(</span><span class="n">name</span><span class="o">);</span>
</code></pre></div><p>This above variable is used only once and the code should be refactored to:</p><div class="highlight"><pre><code class="language-java" data-lang="java"><span></span><span class="k">return</span> <span class="k">new</span> <span class="n">File</span><span class="o">(</span><span class="s">&quot;data.txt&quot;</span><span class="o">);</span>
</code></pre></div><p>Sometimes, in very rare cases---mostly because of better formatting---one-time variables may be used. Nevertheless, try to avoid such situations at all costs.</p><h2 id="exceptions">Exceptions</h2><p>Needless to say, you should <strong>never</strong> swallow exceptions, but rather let them bubble up as high as possible. Private methods should always let checked exceptions go out.</p><p>Never use exceptions for flow control. For example this code is wrong:</p><div class="highlight"><pre><code class="language-java" data-lang="java"><span></span><span class="kt">int</span> <span class="n">size</span><span class="o">;</span>
<span class="k">try</span> <span class="o">{</span>
  <span class="n">size</span> <span class="o">=</span> <span class="k">this</span><span class="o">.</span><span class="na">fileSize</span><span class="o">();</span>
<span class="o">}</span> <span class="k">catch</span> <span class="o">(</span><span class="n">IOException</span> <span class="n">ex</span><span class="o">)</span> <span class="o">{</span>
  <span class="n">size</span> <span class="o">=</span> <span class="mi">0</span><span class="o">;</span>
<span class="o">}</span>
</code></pre></div><p>Seriously, what if that <code>IOException</code> says &quot;disk is full?&quot; Will you still assume that the size of the file is zero and move on?</p><h2 id="indentation">Indentation</h2><p>For indentation, the <a href="/2014/10/23/paired-brackets-notation.html">main rule</a> is that a bracket should either end a line or be closed on the same line (reverse rule applies to a closing bracket). For example, the following is not correct because the first bracket is not closed on the same line and there are symbols after it. The second bracket is also in trouble because there are symbols in front of it and it is not opened on the same line:</p><div class="highlight"><pre><code class="language-text" data-lang="text"><span></span>final File file = new File(directory,
  &quot;file.txt&quot;);
</code></pre></div><p>Correct indentation should look like:</p><div class="highlight"><pre><code class="language-text" data-lang="text"><span></span>StringUtils.join(
  Arrays.asList(
    &quot;first line&quot;,
    &quot;second line&quot;,
    StringUtils.join(
      Arrays.asList(&quot;a&quot;, &quot;b&quot;)
    )
  ),
  &quot;separator&quot;
);
</code></pre></div><p>The second important rule of indentation says that you should put as much as possible on one line - within the limit of 80 characters. The example above is not valid since it can be compacted:</p><div class="highlight"><pre><code class="language-text" data-lang="text"><span></span>StringUtils.join(
  Arrays.asList(
    &quot;first line&quot;, &quot;second line&quot;,
    StringUtils.join(Arrays.asList(&quot;a&quot;, &quot;b&quot;))
  ),
  &quot;separator&quot;
);
</code></pre></div><h2 id="redundant-constants">Redundant Constants</h2><p>Class constants should be used when you want to share information between class methods, and this information is a characteristic (!) of your class. Don&#39;t use constants as a replacement of string or numeric literals---very bad practice that leads to code pollution. Constants (as with any <a href="/2016/07/14/who-is-object.html">object</a> in <a href="/2016/08/15/what-is-wrong-object-oriented-programming.html">OOP</a>) should have a meaning in a real world. What meaning do these constants have in the real world:</p><div class="highlight"><pre><code class="language-java" data-lang="java"><span></span><span class="kd">class</span> <span class="nc">Document</span> <span class="o">{</span>
  <span class="kd">private</span> <span class="kd">static</span> <span class="kd">final</span> <span class="n">String</span> <span class="n">D_LETTER</span> <span class="o">=</span> <span class="s">&quot;D&quot;</span><span class="o">;</span> <span class="c1">// bad practice</span>
  <span class="kd">private</span> <span class="kd">static</span> <span class="kd">final</span> <span class="n">String</span> <span class="n">EXTENSION</span> <span class="o">=</span> <span class="s">&quot;.doc&quot;</span><span class="o">;</span> <span class="c1">// good practice</span>
<span class="o">}</span>
</code></pre></div><p>Another typical mistake is to use constants in <a href="/2017/05/17/single-statement-unit-tests.html">unit tests</a> to avoid duplicate string/numeric literals in test methods. <a href="/2016/05/03/test-methods-must-share-nothing.html">Don&#39;t do this</a>! Every test method should work with its own set of input values.</p><p>Use new texts and numbers in every new test method. They are independent. So, why do they have to share the same input constants?</p><h2 id="test-data-coupling">Test Data Coupling</h2><p>This is an example of <a href="http://en.wikipedia.org/wiki/Coupling_%28computer_programming%29">data coupling</a> in a test method:</p><div class="highlight"><pre><code class="language-java" data-lang="java"><span></span><span class="n">User</span> <span class="n">user</span> <span class="o">=</span> <span class="k">new</span> <span class="n">User</span><span class="o">(</span><span class="s">&quot;Jeff&quot;</span><span class="o">);</span>
<span class="c1">// maybe some other code here</span>
<span class="n">MatcherAssert</span><span class="o">.</span><span class="na">assertThat</span><span class="o">(</span><span class="n">user</span><span class="o">.</span><span class="na">name</span><span class="o">(),</span> <span class="n">Matchers</span><span class="o">.</span><span class="na">equalTo</span><span class="o">(</span><span class="s">&quot;Jeff&quot;</span><span class="o">));</span>
</code></pre></div><p>On the last line, we couple <code>&quot;Jeff&quot;</code> with the same string literal from the first line. If, a few months later, someone wants to change the value on the third line, he/she has to spend extra time finding where else <code>&quot;Jeff&quot;</code> is used in the same method.</p><p>To avoid this data coupling, you should introduce a variable. More about it here: <a href="/2015/05/25/unit-test-scaffolding.html">A Few Thoughts on Unit Test Scaffolding</a>.</p></p>--> <nav class="buttons notranslate desktop-only"> <a href="http://www.facebook.com/sharer/sharer.php?u=https://www.yegor256.com/2014/04/27/typical-mistakes-in-java-code.html" title="Share on Facebook" class="button" rel="nofollow"> <span class="count count-facebook">0</span> <i class="icon icon-facebook notranslate" aria-hidden="true"></i> </a> <a href="https://twitter.com/share?url=https://www.yegor256.com/2014/04/27/typical-mistakes-in-java-code.html&amp;text=Typical+Mistakes+in+Java+Code" title="Share on Twitter" class="button" rel="nofollow"> <span class="count count-twitter">0</span> <i class="icon icon-twitter notranslate" aria-hidden="true"></i> </a> <a href="https://plus.google.com/share?url=https://www.yegor256.com/2014/04/27/typical-mistakes-in-java-code.html" title="Share on Google+" class="button" rel="nofollow"> <span class="count count-googleplus">0</span> <i class="icon icon-googleplus notranslate" aria-hidden="true"></i> </a> <a href="https://www.linkedin.com/cws/share?url=https://www.yegor256.com/2014/04/27/typical-mistakes-in-java-code.html" title="Share on LinkedIn" class="button" rel="nofollow"> <span class="count count-linkedin">0</span> <i class="icon icon-linkedin notranslate" aria-hidden="true"></i> </a> <a href="http://reddit.com/submit?url=https://www.yegor256.com/2014/04/27/typical-mistakes-in-java-code.html%3F2014-17&amp;title=Typical+Mistakes+in+Java+Code" title="Share on Reddit" class="button" rel="nofollow"> <span class="count count-reddit">0</span> <i class="icon icon-reddit notranslate" aria-hidden="true"></i> </a> <a href="http://news.ycombinator.com/submitlink?u=https://www.yegor256.com/2014/04/27/typical-mistakes-in-java-code.html%3F2014-17&amp;t=Typical+Mistakes+in+Java+Code" title="Share on Hacker News" class="button" rel="nofollow"> <span class="count count-hackernews">0</span> <i class="icon icon-hackernews notranslate" aria-hidden="true"></i> </a> </nav> </header> <article class="main" itemprop="articleBody"><div ><p>This page contains most typical mistakes I see in the Java code of people working with me. Static analysis (we&#39;re using <a href="http://www.qulice.com">qulice</a> can&#39;t catch all of the mistakes for obvious reasons, and that&#39;s why I decided to list them all here.</p><p>Let me know if you want to see something else added here, and I&#39;ll be happy to oblige.</p><aside class='youtube'> <a href='https://www.youtube.com/watch?v=9yjtsCK6Wdk'><div class='box'> <img src='https://i.ytimg.com/vi/9yjtsCK6Wdk/mqdefault.jpg' alt='YouTube video #9yjtsCK6Wdk'/><div class='play'><i class='icon icon-play'></i></div></div></a><div>A Few Thoughts About Constructors in OOP (webinar #7); 7 October 2015.</div></aside><p>All of the listed mistakes are related to object-oriented programming in general and to Java in particular.</p><h2 id="class-names">Class Names</h2><p>Your class should be an abstraction of a real life entity with no &quot;validators,&quot; &quot;controllers,&quot; &quot;managers,&quot; etc. If your class name ends with an &quot;-er&quot;---it&#39;s <a href="http://c2.com/cgi/wiki?DontNameClassesObjectManagerHandlerOrData">a bad design</a>. BTW, here are my <a href="/2014/11/20/seven-virtues-of-good-object.html">seven virtues</a> of a good object. Also, this post explains this idea in more details: <a href="/2015/03/09/objects-end-with-er.html">Don&#39;t Create Objects That End With -ER</a>.</p><p>And, of course, utility classes are anti-patterns, like <a href="http://commons.apache.org/proper/commons-lang/javadocs/api-2.6/org/apache/commons/lang/StringUtils.html"><code>StringUtils</code></a>, <a href="http://commons.apache.org/proper/commons-io/javadocs/api-2.5/org/apache/commons/io/FileUtils.html"><code>FileUtils</code></a>, and <a href="https://commons.apache.org/proper/commons-io/javadocs/api-2.5/org/apache/commons/io/IOUtils.html"><code>IOUtils</code></a> from Apache. The above are perfect examples of terrible designs. Read this follow up post: <a href="/2014/05/05/oop-alternative-to-utility-classes.html">OOP Alternative to Utility Classes</a></p><p>Of course, never add suffixes or prefixes to distinguish between <a href="http://c2.com/cgi/wiki?DontDistinguishBetweenClassesAndInterfaces">interfaces and classes</a>. For example, all of these names are terribly wrong: <code>IRecord</code>, <code>IfaceEmployee</code>, or <code>RecordInterface</code>. Usually, interface name is the name of a real-life entity, while class name should explain its implementation details. If there is nothing specific to say about an implementation, name it <code>Default,</code> <code>Simple</code>, or something similar. For example:</p><div class="highlight"><pre><code class="language-java" data-lang="java"><span></span><span class="kd">class</span> <span class="nc">SimpleUser</span> <span class="kd">implements</span> <span class="n">User</span> <span class="o">{};</span>
<span class="kd">class</span> <span class="nc">DefaultRecord</span> <span class="kd">implements</span> <span class="n">Record</span> <span class="o">{};</span>
<span class="kd">class</span> <span class="nc">Suffixed</span> <span class="kd">implements</span> <span class="n">Name</span> <span class="o">{};</span>
<span class="kd">class</span> <span class="nc">Validated</span> <span class="kd">implements</span> <span class="n">Content</span> <span class="o">{};</span>
</code></pre></div><h2 id="method-names">Method Names</h2><p>Methods can either return something or return <code>void</code>. If a method returns something, then its name should explain <em>what it returns</em>, for example (don&#39;t use the <code>get</code> prefix <a href="/2014/09/16/getters-and-setters-are-evil.html">ever</a>):</p><div class="highlight"><pre><code class="language-java" data-lang="java"><span></span><span class="kt">boolean</span> <span class="nf">isValid</span><span class="o">(</span><span class="n">String</span> <span class="n">name</span><span class="o">);</span>
<span class="n">String</span> <span class="nf">content</span><span class="o">();</span>
<span class="kt">int</span> <span class="nf">ageOf</span><span class="o">(</span><span class="n">File</span> <span class="n">file</span><span class="o">);</span>
</code></pre></div><p>If it returns <code>void,</code> then its name should explain <em>what it does</em>. For example:</p><div class="highlight"><pre><code class="language-java" data-lang="java"><span></span><span class="kt">void</span> <span class="nf">save</span><span class="o">(</span><span class="n">File</span> <span class="n">file</span><span class="o">);</span>
<span class="kt">void</span> <span class="nf">process</span><span class="o">(</span><span class="n">Work</span> <span class="n">work</span><span class="o">);</span>
<span class="kt">void</span> <span class="nf">append</span><span class="o">(</span><span class="n">File</span> <span class="n">file</span><span class="o">,</span> <span class="n">String</span> <span class="n">line</span><span class="o">);</span>
</code></pre></div><p>You can read more about this idea in <a href="/elegant-objects.html">Elegant Objects</a> book, section <a href="/images/books/elegant-objects/contents.pdf">2.4</a>. There is only one exception to the rule just mentioned---test methods for JUnit. They are explained below.</p><h2 id="test-method-names">Test Method Names</h2><p>Method names in JUnit tests should be created as English sentences without spaces. It&#39;s easier to explain by example:</p><div class="highlight"><pre><code class="language-java" data-lang="java"><span></span><span class="cm">/**</span>
<span class="cm"> * HttpRequest can return its content in Unicode.</span>
<span class="cm"> * @throws Exception If test fails</span>
<span class="cm"> */</span>
<span class="nd">@Test</span>
<span class="kd">public</span> <span class="kt">void</span> <span class="nf">returnsItsContentInUnicode</span><span class="o">()</span> <span class="kd">throws</span> <span class="n">Exception</span> <span class="o">{</span>
<span class="o">}</span>
</code></pre></div><p>It&#39;s important to start the first sentence of your Javadoc with the name of the class you&#39;re testing followed by <code>can</code> (or <code>cannot</code>). So, your first sentence should always be similar to &quot;somebody <em>can</em> do something.&quot;</p><p>The method name will state exactly the same, but without the subject. If I add a subject at the beginning of the method name, I should get a complete English sentence, as in above example: &quot;<code>HttpRequest</code> returns its content in Unicode.&quot;</p><p>Pay attention that the test method doesn&#39;t start with <code>can</code>. Only Javadoc comments use &#39;can.&#39;</p><p>It&#39;s a good practice to always declare test methods as throwing <code>Exception</code>.</p><h2 id="variable-names">Variable Names</h2><p>Avoid composite names of variables, like <code>timeOfDay</code>, <code>firstItem</code>, or <code>httpRequest</code>. I mean with both---class variables and in-method ones. A variable name should be long enough to avoid ambiguity in its scope of visibility, but not too long if possible. A name should be a noun in singular or plural form, or an appropriate abbreviation. More about it in this post: <a href="/2015/01/12/compound-name-is-code-smell.html">A Compound Name Is a Code Smell</a>. For example:</p><div class="highlight"><pre><code class="language-java" data-lang="java"><span></span><span class="n">List</span><span class="o">&lt;</span><span class="n">String</span><span class="o">&gt;</span> <span class="n">names</span><span class="o">;</span>
<span class="kt">void</span> <span class="nf">sendThroughProxy</span><span class="o">(</span><span class="n">File</span> <span class="n">file</span><span class="o">,</span> <span class="n">Protocol</span> <span class="n">proto</span><span class="o">);</span>
<span class="kd">private</span> <span class="n">File</span> <span class="n">content</span><span class="o">;</span>
<span class="kd">public</span> <span class="n">HttpRequest</span> <span class="n">request</span><span class="o">;</span>
</code></pre></div><p>Sometimes, you may have collisions between <a href="/2015/05/07/ctors-must-be-code-free.html">constructor</a> parameters and in-class properties if the constructor saves incoming data in an instantiated object. In this case, I recommend to create abbreviations by removing vowels (see how <a href="http://pe.usps.gov/text/pub28/28apc_002.htm">USPS abbreviates street names</a>).</p><p>Another example:</p><div class="highlight"><pre><code class="language-java" data-lang="java"><span></span><span class="kd">public</span> <span class="kd">class</span> <span class="nc">Message</span> <span class="o">{</span>
  <span class="kd">private</span> <span class="n">String</span> <span class="n">recipient</span><span class="o">;</span>
  <span class="kd">public</span> <span class="nf">Message</span><span class="o">(</span><span class="n">String</span> <span class="n">rcpt</span><span class="o">)</span> <span class="o">{</span>
    <span class="k">this</span><span class="o">.</span><span class="na">recipient</span> <span class="o">=</span> <span class="n">rcpt</span><span class="o">;</span>
  <span class="o">}</span>
<span class="o">}</span>
</code></pre></div><p>In many cases, the best hint for a name of a variable can ascertained by reading its class name. Just write it with a small letter, and you should be good:</p><div class="highlight"><pre><code class="language-java" data-lang="java"><span></span><span class="n">File</span> <span class="n">file</span><span class="o">;</span>
<span class="n">User</span> <span class="n">user</span><span class="o">;</span>
<span class="n">Branch</span> <span class="n">branch</span><span class="o">;</span>
</code></pre></div><p>However, <em>never</em> do the same for primitive types, like <code>Integer number</code> or <code>String string</code>.</p><p>You can also use an adjective, when there are multiple variables with different characteristics. For instance:</p><div class="highlight"><pre><code class="language-text" data-lang="text"><span></span>String contact(String left, String right);
</code></pre></div><h2 id="constructors">Constructors</h2><p>Without <a href="/2016/06/17/dont-use-java-assertions.html">exceptions</a>, there should be only <em>one</em> constructor that stores data in object variables. All other constructors should call this one with different arguments. For example:</p><div class="highlight"><pre><code class="language-java" data-lang="java"><span></span><span class="kd">public</span> <span class="kd">class</span> <span class="nc">Server</span> <span class="o">{</span>
  <span class="kd">private</span> <span class="n">String</span> <span class="n">address</span><span class="o">;</span>
  <span class="kd">public</span> <span class="nf">Server</span><span class="o">(</span><span class="n">String</span> <span class="n">uri</span><span class="o">)</span> <span class="o">{</span>
    <span class="k">this</span><span class="o">.</span><span class="na">address</span> <span class="o">=</span> <span class="n">uri</span><span class="o">;</span>
  <span class="o">}</span>
  <span class="kd">public</span> <span class="nf">Server</span><span class="o">(</span><span class="n">URI</span> <span class="n">uri</span><span class="o">)</span> <span class="o">{</span>
    <span class="k">this</span><span class="o">(</span><span class="n">uri</span><span class="o">.</span><span class="na">toString</span><span class="o">());</span>
  <span class="o">}</span>
<span class="o">}</span>
</code></pre></div><p>More about it in <a href="/2015/05/28/one-primary-constructor.html">There Can Be Only One Primary Constructor</a>.</p><h2 id="one-time-variables">One-time Variables</h2><p>Avoid one-time variables at all costs. By &quot;one-time&quot; I mean variables that are used only once. Like in this example:</p><div class="highlight"><pre><code class="language-java" data-lang="java"><span></span><span class="n">String</span> <span class="n">name</span> <span class="o">=</span> <span class="s">&quot;data.txt&quot;</span><span class="o">;</span>
<span class="k">return</span> <span class="k">new</span> <span class="n">File</span><span class="o">(</span><span class="n">name</span><span class="o">);</span>
</code></pre></div><p>This above variable is used only once and the code should be refactored to:</p><div class="highlight"><pre><code class="language-java" data-lang="java"><span></span><span class="k">return</span> <span class="k">new</span> <span class="n">File</span><span class="o">(</span><span class="s">&quot;data.txt&quot;</span><span class="o">);</span>
</code></pre></div><p>Sometimes, in very rare cases---mostly because of better formatting---one-time variables may be used. Nevertheless, try to avoid such situations at all costs.</p><h2 id="exceptions">Exceptions</h2><p>Needless to say, you should <strong>never</strong> swallow exceptions, but rather let them bubble up as high as possible. Private methods should always let checked exceptions go out.</p><p>Never use exceptions for flow control. For example this code is wrong:</p><div class="highlight"><pre><code class="language-java" data-lang="java"><span></span><span class="kt">int</span> <span class="n">size</span><span class="o">;</span>
<span class="k">try</span> <span class="o">{</span>
  <span class="n">size</span> <span class="o">=</span> <span class="k">this</span><span class="o">.</span><span class="na">fileSize</span><span class="o">();</span>
<span class="o">}</span> <span class="k">catch</span> <span class="o">(</span><span class="n">IOException</span> <span class="n">ex</span><span class="o">)</span> <span class="o">{</span>
  <span class="n">size</span> <span class="o">=</span> <span class="mi">0</span><span class="o">;</span>
<span class="o">}</span>
</code></pre></div><p>Seriously, what if that <code>IOException</code> says &quot;disk is full?&quot; Will you still assume that the size of the file is zero and move on?</p><h2 id="indentation">Indentation</h2><p>For indentation, the <a href="/2014/10/23/paired-brackets-notation.html">main rule</a> is that a bracket should either end a line or be closed on the same line (reverse rule applies to a closing bracket). For example, the following is not correct because the first bracket is not closed on the same line and there are symbols after it. The second bracket is also in trouble because there are symbols in front of it and it is not opened on the same line:</p><div class="highlight"><pre><code class="language-text" data-lang="text"><span></span>final File file = new File(directory,
  &quot;file.txt&quot;);
</code></pre></div><p>Correct indentation should look like:</p><div class="highlight"><pre><code class="language-text" data-lang="text"><span></span>StringUtils.join(
  Arrays.asList(
    &quot;first line&quot;,
    &quot;second line&quot;,
    StringUtils.join(
      Arrays.asList(&quot;a&quot;, &quot;b&quot;)
    )
  ),
  &quot;separator&quot;
);
</code></pre></div><p>The second important rule of indentation says that you should put as much as possible on one line - within the limit of 80 characters. The example above is not valid since it can be compacted:</p><div class="highlight"><pre><code class="language-text" data-lang="text"><span></span>StringUtils.join(
  Arrays.asList(
    &quot;first line&quot;, &quot;second line&quot;,
    StringUtils.join(Arrays.asList(&quot;a&quot;, &quot;b&quot;))
  ),
  &quot;separator&quot;
);
</code></pre></div><h2 id="redundant-constants">Redundant Constants</h2><p>Class constants should be used when you want to share information between class methods, and this information is a characteristic (!) of your class. Don&#39;t use constants as a replacement of string or numeric literals---very bad practice that leads to code pollution. Constants (as with any <a href="/2016/07/14/who-is-object.html">object</a> in <a href="/2016/08/15/what-is-wrong-object-oriented-programming.html">OOP</a>) should have a meaning in a real world. What meaning do these constants have in the real world:</p><div class="highlight"><pre><code class="language-java" data-lang="java"><span></span><span class="kd">class</span> <span class="nc">Document</span> <span class="o">{</span>
  <span class="kd">private</span> <span class="kd">static</span> <span class="kd">final</span> <span class="n">String</span> <span class="n">D_LETTER</span> <span class="o">=</span> <span class="s">&quot;D&quot;</span><span class="o">;</span> <span class="c1">// bad practice</span>
  <span class="kd">private</span> <span class="kd">static</span> <span class="kd">final</span> <span class="n">String</span> <span class="n">EXTENSION</span> <span class="o">=</span> <span class="s">&quot;.doc&quot;</span><span class="o">;</span> <span class="c1">// good practice</span>
<span class="o">}</span>
</code></pre></div><p>Another typical mistake is to use constants in <a href="/2017/05/17/single-statement-unit-tests.html">unit tests</a> to avoid duplicate string/numeric literals in test methods. <a href="/2016/05/03/test-methods-must-share-nothing.html">Don&#39;t do this</a>! Every test method should work with its own set of input values.</p><p>Use new texts and numbers in every new test method. They are independent. So, why do they have to share the same input constants?</p><h2 id="test-data-coupling">Test Data Coupling</h2><p>This is an example of <a href="http://en.wikipedia.org/wiki/Coupling_%28computer_programming%29">data coupling</a> in a test method:</p><div class="highlight"><pre><code class="language-java" data-lang="java"><span></span><span class="n">User</span> <span class="n">user</span> <span class="o">=</span> <span class="k">new</span> <span class="n">User</span><span class="o">(</span><span class="s">&quot;Jeff&quot;</span><span class="o">);</span>
<span class="c1">// maybe some other code here</span>
<span class="n">MatcherAssert</span><span class="o">.</span><span class="na">assertThat</span><span class="o">(</span><span class="n">user</span><span class="o">.</span><span class="na">name</span><span class="o">(),</span> <span class="n">Matchers</span><span class="o">.</span><span class="na">equalTo</span><span class="o">(</span><span class="s">&quot;Jeff&quot;</span><span class="o">));</span>
</code></pre></div><p>On the last line, we couple <code>&quot;Jeff&quot;</code> with the same string literal from the first line. If, a few months later, someone wants to change the value on the third line, he/she has to spend extra time finding where else <code>&quot;Jeff&quot;</code> is used in the same method.</p><p>To avoid this data coupling, you should introduce a variable. More about it here: <a href="/2015/05/25/unit-test-scaffolding.html">A Few Thoughts on Unit Test Scaffolding</a>.</p></div></article></div><div class="wrapper"> <related-posts /></div><div class="disqus" role="complementary"><p class="disqus_hint"> Please, use <a href="https://help.disqus.com/commenting/what-html-tags-are-allowed-within-comments">syntax highlighting</a> in your comments, to make them more readable.</p><div id="disqus_thread" class="disqus-thread"> <a>&nbsp;</a></div><script> var disqus_config = function () { this.page.url = document.location.href.split('?')[0].split('#')[0].replace('https://', 'http://'); this.page.identifier = this.page.url; }; (function() { var d = document, s = d.createElement('script'); s.src = '//yegor256.disqus.com/embed.js'; s.setAttribute('data-timestamp', +new Date()); (d.head || d.body).appendChild(s); })(); </script> <noscript><div><p class="red"> JavaScript is disabled in your browser, that's why you can't see comments under this post.</p></div></noscript></div><div class="wrapper"> <footer class="footer"><p> &copy; <span itemscope="" itemprop="copyrightHolder" itemtype="http://schema.org/Person"> <span itemprop="name">Yegor Bugayenko</span> </span> 2014&ndash;<span itemprop="copyrightYear">2018</span></p></footer></div></section><div class="wrapper unprintable" style="text-align:center;margin-top:2em;"> <a href="http://www.sixnines.io/h/3ba1652f"> <img src="//www.sixnines.io/b/3ba1652f?style=flat" alt="sixnines availability badge"/> </a></div><script src="//code.jquery.com/jquery-1.9.0.min.js"></script> <script src="/js/all.js?4e047f6f42b"></script> <script>var disqus_shortname = 'yegor256';</script> <script id="dsq-count-scr" src="//yegor256.disqus.com/count.js" async="async"></script> <script> (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){ (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o), m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m) })(window,document,'script','//www.google-analytics.com/analytics.js','ga'); ga('create', 'UA-1963507-32', 'auto'); ga('send', 'pageview'); </script> <script> Cd=document;Cr="&"+Math.random();Cp="&s=1"; Cd.cookie="b=b";if(Cd.cookie)Cp+="&c=1"; Cp+="&t="+(new Date()).getTimezoneOffset(); if(self!=top)Cp+="&f=1"; </script> <script> if(navigator.javaEnabled())Cp+="&j=1"; </script> <script> if(typeof(screen)!='undefined')Cp+="&w="+screen.width+"&h="+ screen.height+"&d="+(screen.colorDepth?screen.colorDepth:screen.pixelDepth); </script> <script> Cd.write("<img src='//c.hit.ua/hit?i=95870&g=0&x=2"+Cp+Cr+ "&r="+escape(Cd.referrer)+"&u="+escape(window.location.href)+ "' border='0' wi"+"dth='1' he"+"ight='1'/>"); </script> <script type="application/ld+json"> { "@context": "http://schema.org", "@type": "Person", "name": "Yegor Bugayenko", "url": "http://www.yegor256.com", "sameAs": [ "https://www.facebook.com/yegor256", "https://instagram.com/yegor256", "https://www.linkedin.com/in/yegor256", "https://twitter.com/yegor256", "https://github.com/yegor256", "https://www.pinterest.com/yegor256/" ] } </script> </body> </html> <!DOCTYPE html> <html xmlns="http://www.w3.org/1999/xhtml" lang="en-US" xml:lang="en-US" itemscope="" itemtype="http://schema.org/WebSite"> <head> <meta charset="utf-8"/> <meta name="description" content="Parsing and traversing of XML documents as a very common and verbose operation is made easy with jcabi-xml " /> <meta name="keywords" content="how to parse xml in java, java xml parsing best practices, java xml parsing example, java xml parsing library, java xml parsing library example, parse xml java, xml parsing java" /> <meta name="viewport" content="width=device-width,minimum-scale=1,initial-scale=1"/> <meta name="google-site-verification" content="JEj_gQr2CPe2QKGw8XdMz0R7VboQIUbX3FlM-lwTq-8" /> <meta name="author" content="Yegor Bugayenko"> <meta name="article:published_time" content="2014-04-24 00:00:00 +0000"> <meta name="og:site_name" content="Yegor Bugayenko"/> <meta name="og:type" content="article" /> <meta name="og:locale" content="en_US" /> <meta name="twitter:account_id" content="4503599630178231" /> <meta name="twitter:creator" content="@yegor256"/> <meta name="twitter:site" content="@yegor256"/> <meta name="twitter:title" property="og:title" content="Java XML Parsing Made Easy"/> <meta name="twitter:description" property="og:description" content="Parsing and traversing of XML documents as a very common and verbose operation is made easy with jcabi-xml "/> <meta name="twitter:url" property="og:url" content="https://www.yegor256.com/2014/04/24/java-xml-parsing-and-traversing.html"/> <meta name="telegram:channel" content="AAAAAEJFMRzsRTRxM3ec6A"/> <link rel="search" type="application/opensearchdescription+xml" href="/opensearch.xml" title="yegor256" /> <link rel="shortcut icon" href="/favicon.ico?4e047f6f42b"/> <link rel="apple-touch-icon" href="/favicon.ico?4e047f6f42b"/> <link rel="alternate" type="application/rss+xml" title="RSS for yegor256.com" href="https://www.yegor256.com/rss.xml"/> <link rel="stylesheet" href="/css/layout.css?4e047f6f42b"/> <link rel="stylesheet" href="/css/icons.css?4e047f6f42b"/> <link rel="canonical" href="https://www.yegor256.com/2014/04/24/java-xml-parsing-and-traversing.html" /> <link rel="amphtml" href="https://www.yegor256.com/2014/04/24/java-xml-parsing-and-traversing.amp.html" /> <title>Java XML Parsing Made Easy </title> </head> <body><div class="wrapper"> <aside class="header-toggle unprintable" id="header-toggle" title="Show the menu" onclick="$('#header').show();$('#header-toggle').hide();">&#9776;</aside> <header class="header" id="header"><div class="face"> <a href="/about-me.html#form" class="sub" title="Click to subscribe to my monthly newsletter"><span>Subscribe</span></a> <a href="/about-me.html" style="position:relative;"> <img src="/images/face-256x256.jpg" class="photo" alt="Yegor Bugayenko"/> </a></div><nav><ul class="menu social notranslate"> <li><a href="https://twitter.com/intent/follow?screen_name=yegor256" rel="nofollow" title="Follow me on Twitter"><i class="icon icon-twitter notranslate" aria-hidden="true"></i></a></li> <li><a href="/rss.xml" rel="nofollow" title="Subscribe to my RSS feed"><i class="icon icon-rss notranslate" aria-hidden="true"></i></a></li> <li><a itemprop="sameAs" href="https://github.com/yegor256" rel="nofollow" title="My GitHub profile"><i class="icon icon-github notranslate" aria-hidden="true"></i></a></li> <li><a itemprop="sameAs" href="http://stackoverflow.com/users/187141/yegor256" rel="nofollow" title="My StackOverflow profile"><i class="icon icon-stackoverflow notranslate" aria-hidden="true"></i></a></li> <li><a itemprop="sameAs" href="https://www.facebook.com/yegor256" rel="nofollow" title="Follow me on Facebook"><i class="icon icon-facebook notranslate" aria-hidden="true"></i></a></li> <li><a itemprop="sameAs" href="https://instagram.com/yegor256" rel="nofollow" title="Follow me on Instagram"><i class="icon icon-instagram notranslate" aria-hidden="true"></i></a></li> <li><a itemprop="sameAs" href="https://www.linkedin.com/in/yegor256" rel="nofollow" title="My LinkedIn profile"><i class="icon icon-linkedin notranslate" aria-hidden="true"></i></a></li> <li><a itemprop="sameAs" href="https://www.youtube.com/c/yegor256?sub_confirmation=1" rel="nofollow" title="My Youtube video channel"><i class="icon icon-youtube notranslate" aria-hidden="true"></i></a></li> <li><a itemprop="sameAs" href="https://www.pinterest.com/yegor256/" rel="nofollow" title="My Pinterest boards"><i class="icon icon-pinterest notranslate" aria-hidden="true"></i></a></li> <li><a itemprop="sameAs" href="https://angel.co/yegor256" rel="nofollow" title="My AngelList profile"><i class="icon icon-angellist notranslate" aria-hidden="true"></i></a></li> <li><a href="https://soundcloud.com/yegor256" rel="nofollow" title="My podcast"><i class="icon icon-podcast notranslate" aria-hidden="true"></i></a></li> <li><a href="https://itunes.apple.com/us/podcast/yegor256-podcast/id1150826721" rel="nofollow" title="My iTunes podcast"><i class="icon icon-itunes notranslate" aria-hidden="true"></i></a></li> <li><a href="https://t.me/joinchat/AAAAAEJFMRzsRTRxM3ec6A" rel="nofollow" title="My Telegram public channel"><i class="icon icon-telegram notranslate" aria-hidden="true"></i></a></li> <li><a href="mailto:blog@yegor256.com" rel="nofollow" title="Email me any time"><i class="icon icon-mail notranslate" aria-hidden="true"></i></a></li></ul><ul class="menu"> <li><a href="/" title="Home page">Home</a></li> <li ><a href="/best.html" title="Best articles to read">12&#160;Best</a></li> <li ><a href="/contents.html" title="The contents of the entire blog">All&#160;288</a></li> <li ><a href="/webinars.html" title="My webinars">Webinars</a></li> <li ><a href="/talks.html" title="Future and past conference talks">Talks</a></li> <li ><a href="/books.html" title="The books I wrote">Books</a></li> <li ><a href="/papers.html" title="My academic papers and patents">Papers</a></li> <li ><a href="/pets.html" title="My loved pet projects">Pets</a></li> <li ><a href="/award.html" title="Software quality award">Award</a></li> <li ><a href="/testimonials.html" title="What some people say about me">Testimonials</a></li> <li ><a href="/shift-m.html" title="Audio podcast about project management">Shift-M</a></li> <li ><a href="/paintings.html" title="My paintings for sale">Paintings</a></li> <li><a href="http://ru.yegor256.com/" title="Немного на русском языке">По-русски</a></li></ul></nav><div class="search"> <form method="get" action="https://www.google.com/search" itemprop="potentialAction" itemscope="" itemtype="http://schema.org/SearchAction"> <meta itemprop="target" content="https://www.google.com/search?q={q}"/> <input name="sitesearch" value="yegor256.com" type="hidden"/> <input itemprop="query-input" type="text" id="search-query" class="field field-text" required="required" onfocus="$('.google').css('visibility', 'visible');" name="q" placeholder="Search..." autocomplete="off"/> <input type="image" src="/images/google-search-icon.svg" class="google" title="Search via Google" alt="Search via Google"/> </form></div><div class="hot"><ul> <li> <a href="/code-ahead.html">Code Ahead</a> was published on Amazon just a few days ago! It is my new book, a novel about programmers. It explains in details the majority of ideas that stand behind <a href="https://www.zerocracy.com">Zerocracy</a> and <a href="https://www.xdsd.org">XDSD</a>. </li> <li> At <a href="/webinars.html">Webinar #37</a> we will discuss naming problem in OOP, for objects, methods and attributes; join us on <b>September 12</b>, at 11am PST. </li></ul></div></header></div><section itemscope="" itemtype="http://schema.org/BlogPosting"><div class="wrapper"> <header><p class="printable"> <img src="https://api.qrserver.com/v1/create-qr-code/?data=https://www.yegor256.com/2014/04/24/java-xml-parsing-and-traversing.html&amp;format=svg" style="width:125px;height:125px;" alt="QR code"/></p><p class="printable"> <code itemprop="url">https://www.yegor256.com/2014/04/24/java-xml-parsing-and-traversing.html</code></p><h1 itemprop="name headline mainEntityOfPage">Java XML Parsing Made Easy</h1><ul class="subline"> <li> <time itemprop="datePublished" datetime="2014-04-24T00:00:00+00:00"> 24 April 2014 </time> </li> <li class="printable" itemscope="" itemprop="author" itemtype="http://schema.org/Person"> <span itemprop="name">Yegor Bugayenko</span> </li> <li class="unprintable"> <i class="icon icon-comments"></i> <a href="http://www.yegor256.com/2014/04/24/java-xml-parsing-and-traversing.html#disqus_thread" itemprop="discussionUrl">comments</a> </li></ul><p>Now, we have an object of interface <a href="http://xml.jcabi.com/apidocs-0.7.7/com/jcabi/xml/XML.html"><code>XML</code></a> that can traverse the XML tree and convert it back to text.</p><p>For example:</p><figure class="highlight"><pre><code class="language-java" data-lang="java"><span></span><span class="c1">// outputs &quot;hello&quot;</span>
<span class="n">System</span><span class="o">.</span><span class="na">out</span><span class="o">.</span><span class="na">println</span><span class="o">(</span><span class="n">xml</span><span class="o">.</span><span class="na">xpath</span><span class="o">(</span><span class="s">&quot;/root/a/text()&quot;</span><span class="o">).</span><span class="na">get</span><span class="o">(</span><span class="mi">0</span><span class="o">));</span>
<span class="c1">// outputs the entire XML document</span>
<span class="n">System</span><span class="o">.</span><span class="na">out</span><span class="o">.</span><span class="na">println</span><span class="o">(</span><span class="n">xml</span><span class="o">.</span><span class="na">toString</span><span class="o">());</span></code></pre></figure><p>Method <code>xpath()</code> allows you to find a collection of text nodes or attributes in the document, and then convert them to a collection of strings, using <a href="http://en.wikipedia.org/wiki/XPath">XPath query</a>:</p><figure class="highlight"><pre><code class="language-java" data-lang="java"><span></span><span class="c1">// outputs &quot;hello&quot; and &quot;world&quot;</span>
<span class="k">for</span> <span class="o">(</span><span class="n">String</span> <span class="n">text</span> <span class="o">:</span> <span class="n">xml</span><span class="o">.</span><span class="na">xpath</span><span class="o">(</span><span class="s">&quot;/root/*/text()&quot;</span><span class="o">))</span> <span class="o">{</span>
  <span class="n">System</span><span class="o">.</span><span class="na">out</span><span class="o">.</span><span class="na">println</span><span class="o">(</span><span class="n">text</span><span class="o">);</span>
<span class="o">}</span></code></pre></figure><p>Method <code>nodes()</code> enables the same XPath search operation, but instead returns a collection of instances of <code>XML</code> interface:</p><figure class="highlight"><pre><code class="language-java" data-lang="java"><span></span><span class="c1">// outputs &quot;&lt;a&gt;hello&lt;/a&gt;&quot; and &quot;&lt;b&gt;world&lt;/b&gt;&quot;</span>
<span class="k">for</span> <span class="o">(</span><span class="n">XML</span> <span class="n">node</span> <span class="o">:</span> <span class="n">xml</span><span class="o">.</span><span class="na">nodes</span><span class="o">(</span><span class="s">&quot;/root/*&quot;</span><span class="o">))</span>
  <span class="n">System</span><span class="o">.</span><span class="na">out</span><span class="o">.</span><span class="na">println</span><span class="o">(</span><span class="n">node</span><span class="o">);</span>
<span class="o">}</span></code></pre></figure><p>Besides XML parsing, printing and XPath traversing, <a href="/2014/04/24/java-xml-parsing-and-traversing.html">jcabi-xml</a> also provides XSD validation and XSL transformations. I&#39;ll write about those features in the next post :)</p><p>PS. Also, check this: <a href="/2014/04/28/xml-xpath-hamcrest-matchers.html">XML/XPath Matchers for Hamcrest</a>.</p></p>--> <nav class="buttons notranslate desktop-only"> <a href="http://www.facebook.com/sharer/sharer.php?u=https://www.yegor256.com/2014/04/24/java-xml-parsing-and-traversing.html" title="Share on Facebook" class="button" rel="nofollow"> <span class="count count-facebook">0</span> <i class="icon icon-facebook notranslate" aria-hidden="true"></i> </a> <a href="https://twitter.com/share?url=https://www.yegor256.com/2014/04/24/java-xml-parsing-and-traversing.html&amp;text=Java+XML+Parsing+Made+Easy" title="Share on Twitter" class="button" rel="nofollow"> <span class="count count-twitter">0</span> <i class="icon icon-twitter notranslate" aria-hidden="true"></i> </a> <a href="https://plus.google.com/share?url=https://www.yegor256.com/2014/04/24/java-xml-parsing-and-traversing.html" title="Share on Google+" class="button" rel="nofollow"> <span class="count count-googleplus">0</span> <i class="icon icon-googleplus notranslate" aria-hidden="true"></i> </a> <a href="https://www.linkedin.com/cws/share?url=https://www.yegor256.com/2014/04/24/java-xml-parsing-and-traversing.html" title="Share on LinkedIn" class="button" rel="nofollow"> <span class="count count-linkedin">0</span> <i class="icon icon-linkedin notranslate" aria-hidden="true"></i> </a> <a href="http://reddit.com/submit?url=https://www.yegor256.com/2014/04/24/java-xml-parsing-and-traversing.html%3F2014-16&amp;title=Java+XML+Parsing+Made+Easy" title="Share on Reddit" class="button" rel="nofollow"> <span class="count count-reddit">0</span> <i class="icon icon-reddit notranslate" aria-hidden="true"></i> </a> <a href="http://news.ycombinator.com/submitlink?u=https://www.yegor256.com/2014/04/24/java-xml-parsing-and-traversing.html%3F2014-16&amp;t=Java+XML+Parsing+Made+Easy" title="Share on Hacker News" class="button" rel="nofollow"> <span class="count count-hackernews">0</span> <i class="icon icon-hackernews notranslate" aria-hidden="true"></i> </a> </nav> </header> <article class="main" itemprop="articleBody"><div > <figure class='badge'><a href='http://xml.jcabi.com'><img src='http://img.jcabi.com/logo-square.svg' style='width:64px;max-width:100%;' alt='badge'/></a></figure><p>Unlike with many other modern languages, parsing XML in Java requires more than one line of code. XML traversing using XPath takes even more code, and I find this is unfair and annoying.</p><p>I&#39;m a big fan of XML and use it it in almost every Java application. Some time ago, I decided to put all of that XML-to-DOM parsing code into a small library---<a href="/2014/04/24/java-xml-parsing-and-traversing.html">jcabi-xml</a>.</p><p>Put simply, the library is a convenient wrapper for JDK-native DOM manipulations. That&#39;s why it is small and dependency-free. With the following example, you can see just how simple XML parsing can be:</p><figure class="highlight"><pre><code class="language-java" data-lang="java"><span></span><span class="kn">import</span> <span class="nn">com.jcabi.xml.XML</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">com.jcabi.xml.XMLDocument</span><span class="o">;</span>
<span class="n">XML</span> <span class="n">xml</span> <span class="o">=</span> <span class="k">new</span> <span class="n">XMLDocument</span><span class="o">(</span>
  <span class="s">&quot;&lt;root&gt;&lt;a&gt;hello&lt;/a&gt;&lt;b&gt;world!&lt;/b&gt;&lt;/root&gt;&quot;</span>
<span class="o">);</span></code></pre></figure><p>Now, we have an object of interface <a href="http://xml.jcabi.com/apidocs-0.7.7/com/jcabi/xml/XML.html"><code>XML</code></a> that can traverse the XML tree and convert it back to text.</p><p>For example:</p><figure class="highlight"><pre><code class="language-java" data-lang="java"><span></span><span class="c1">// outputs &quot;hello&quot;</span>
<span class="n">System</span><span class="o">.</span><span class="na">out</span><span class="o">.</span><span class="na">println</span><span class="o">(</span><span class="n">xml</span><span class="o">.</span><span class="na">xpath</span><span class="o">(</span><span class="s">&quot;/root/a/text()&quot;</span><span class="o">).</span><span class="na">get</span><span class="o">(</span><span class="mi">0</span><span class="o">));</span>
<span class="c1">// outputs the entire XML document</span>
<span class="n">System</span><span class="o">.</span><span class="na">out</span><span class="o">.</span><span class="na">println</span><span class="o">(</span><span class="n">xml</span><span class="o">.</span><span class="na">toString</span><span class="o">());</span></code></pre></figure><p>Method <code>xpath()</code> allows you to find a collection of text nodes or attributes in the document, and then convert them to a collection of strings, using <a href="http://en.wikipedia.org/wiki/XPath">XPath query</a>:</p><figure class="highlight"><pre><code class="language-java" data-lang="java"><span></span><span class="c1">// outputs &quot;hello&quot; and &quot;world&quot;</span>
<span class="k">for</span> <span class="o">(</span><span class="n">String</span> <span class="n">text</span> <span class="o">:</span> <span class="n">xml</span><span class="o">.</span><span class="na">xpath</span><span class="o">(</span><span class="s">&quot;/root/*/text()&quot;</span><span class="o">))</span> <span class="o">{</span>
  <span class="n">System</span><span class="o">.</span><span class="na">out</span><span class="o">.</span><span class="na">println</span><span class="o">(</span><span class="n">text</span><span class="o">);</span>
<span class="o">}</span></code></pre></figure><p>Method <code>nodes()</code> enables the same XPath search operation, but instead returns a collection of instances of <code>XML</code> interface:</p><figure class="highlight"><pre><code class="language-java" data-lang="java"><span></span><span class="c1">// outputs &quot;&lt;a&gt;hello&lt;/a&gt;&quot; and &quot;&lt;b&gt;world&lt;/b&gt;&quot;</span>
<span class="k">for</span> <span class="o">(</span><span class="n">XML</span> <span class="n">node</span> <span class="o">:</span> <span class="n">xml</span><span class="o">.</span><span class="na">nodes</span><span class="o">(</span><span class="s">&quot;/root/*&quot;</span><span class="o">))</span>
  <span class="n">System</span><span class="o">.</span><span class="na">out</span><span class="o">.</span><span class="na">println</span><span class="o">(</span><span class="n">node</span><span class="o">);</span>
<span class="o">}</span></code></pre></figure><p>Besides XML parsing, printing and XPath traversing, <a href="/2014/04/24/java-xml-parsing-and-traversing.html">jcabi-xml</a> also provides XSD validation and XSL transformations. I&#39;ll write about those features in the next post :)</p><p>PS. Also, check this: <a href="/2014/04/28/xml-xpath-hamcrest-matchers.html">XML/XPath Matchers for Hamcrest</a>.</p></div></article></div><div class="wrapper"> <related-posts /></div><div class="disqus" role="complementary"><p class="disqus_hint"> Please, use <a href="https://help.disqus.com/commenting/what-html-tags-are-allowed-within-comments">syntax highlighting</a> in your comments, to make them more readable.</p><div id="disqus_thread" class="disqus-thread"> <a>&nbsp;</a></div><script> var disqus_config = function () { this.page.url = document.location.href.split('?')[0].split('#')[0].replace('https://', 'http://'); this.page.identifier = this.page.url; }; (function() { var d = document, s = d.createElement('script'); s.src = '//yegor256.disqus.com/embed.js'; s.setAttribute('data-timestamp', +new Date()); (d.head || d.body).appendChild(s); })(); </script> <noscript><div><p class="red"> JavaScript is disabled in your browser, that's why you can't see comments under this post.</p></div></noscript></div><div class="wrapper"> <footer class="footer"><p> &copy; <span itemscope="" itemprop="copyrightHolder" itemtype="http://schema.org/Person"> <span itemprop="name">Yegor Bugayenko</span> </span> 2014&ndash;<span itemprop="copyrightYear">2018</span></p></footer></div></section><div class="wrapper unprintable" style="text-align:center;margin-top:2em;"> <a href="http://www.sixnines.io/h/3ba1652f"> <img src="//www.sixnines.io/b/3ba1652f?style=flat" alt="sixnines availability badge"/> </a></div><script src="//code.jquery.com/jquery-1.9.0.min.js"></script> <script src="/js/all.js?4e047f6f42b"></script> <script>var disqus_shortname = 'yegor256';</script> <script id="dsq-count-scr" src="//yegor256.disqus.com/count.js" async="async"></script> <script> (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){ (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o), m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m) })(window,document,'script','//www.google-analytics.com/analytics.js','ga'); ga('create', 'UA-1963507-32', 'auto'); ga('send', 'pageview'); </script> <script> Cd=document;Cr="&"+Math.random();Cp="&s=1"; Cd.cookie="b=b";if(Cd.cookie)Cp+="&c=1"; Cp+="&t="+(new Date()).getTimezoneOffset(); if(self!=top)Cp+="&f=1"; </script> <script> if(navigator.javaEnabled())Cp+="&j=1"; </script> <script> if(typeof(screen)!='undefined')Cp+="&w="+screen.width+"&h="+ screen.height+"&d="+(screen.colorDepth?screen.colorDepth:screen.pixelDepth); </script> <script> Cd.write("<img src='//c.hit.ua/hit?i=95870&g=0&x=2"+Cp+Cr+ "&r="+escape(Cd.referrer)+"&u="+escape(window.location.href)+ "' border='0' wi"+"dth='1' he"+"ight='1'/>"); </script> <script type="application/ld+json"> { "@context": "http://schema.org", "@type": "Person", "name": "Yegor Bugayenko", "url": "http://www.yegor256.com", "sameAs": [ "https://www.facebook.com/yegor256", "https://instagram.com/yegor256", "https://www.linkedin.com/in/yegor256", "https://twitter.com/yegor256", "https://github.com/yegor256", "https://www.pinterest.com/yegor256/" ] } </script> </body> </html> <!DOCTYPE html> <html xmlns="http://www.w3.org/1999/xhtml" lang="en-US" xml:lang="en-US" itemscope="" itemtype="http://schema.org/WebSite"> <head> <meta charset="utf-8"/> <meta name="description" content="I created jcabi-dynamo a few months ago to make AWS SDK more object oriented; the article explains why jcabi-dynamo is better than bare Amazon SDK " /> <meta name="keywords" content="dynamodb, dynamodb java, java dynamodb client, java dynamodb example, java dynamodb query, java dynamodb query example" /> <meta name="viewport" content="width=device-width,minimum-scale=1,initial-scale=1"/> <meta name="google-site-verification" content="JEj_gQr2CPe2QKGw8XdMz0R7VboQIUbX3FlM-lwTq-8" /> <meta name="author" content="Yegor Bugayenko"> <meta name="article:published_time" content="2014-04-14 00:00:00 +0000"> <meta name="og:site_name" content="Yegor Bugayenko"/> <meta name="og:type" content="article" /> <meta name="og:locale" content="en_US" /> <meta name="twitter:account_id" content="4503599630178231" /> <meta name="twitter:creator" content="@yegor256"/> <meta name="twitter:site" content="@yegor256"/> <meta name="twitter:title" property="og:title" content="Object-Oriented DynamoDB API"/> <meta name="twitter:description" property="og:description" content="I created jcabi-dynamo a few months ago to make AWS SDK more object oriented; the article explains why jcabi-dynamo is better than bare Amazon SDK "/> <meta name="twitter:url" property="og:url" content="https://www.yegor256.com/2014/04/14/jcabi-dynamo-java-api-of-aws-dynamodb.html"/> <meta name="telegram:channel" content="AAAAAEJFMRzsRTRxM3ec6A"/> <link rel="search" type="application/opensearchdescription+xml" href="/opensearch.xml" title="yegor256" /> <link rel="shortcut icon" href="/favicon.ico?4e047f6f42b"/> <link rel="apple-touch-icon" href="/favicon.ico?4e047f6f42b"/> <link rel="alternate" type="application/rss+xml" title="RSS for yegor256.com" href="https://www.yegor256.com/rss.xml"/> <link rel="stylesheet" href="/css/layout.css?4e047f6f42b"/> <link rel="stylesheet" href="/css/icons.css?4e047f6f42b"/> <link rel="canonical" href="https://www.yegor256.com/2014/04/14/jcabi-dynamo-java-api-of-aws-dynamodb.html" /> <link rel="amphtml" href="https://www.yegor256.com/2014/04/14/jcabi-dynamo-java-api-of-aws-dynamodb.amp.html" /> <title>Object-Oriented DynamoDB API </title> </head> <body><div class="wrapper"> <aside class="header-toggle unprintable" id="header-toggle" title="Show the menu" onclick="$('#header').show();$('#header-toggle').hide();">&#9776;</aside> <header class="header" id="header"><div class="face"> <a href="/about-me.html#form" class="sub" title="Click to subscribe to my monthly newsletter"><span>Subscribe</span></a> <a href="/about-me.html" style="position:relative;"> <img src="/images/face-256x256.jpg" class="photo" alt="Yegor Bugayenko"/> </a></div><nav><ul class="menu social notranslate"> <li><a href="https://twitter.com/intent/follow?screen_name=yegor256" rel="nofollow" title="Follow me on Twitter"><i class="icon icon-twitter notranslate" aria-hidden="true"></i></a></li> <li><a href="/rss.xml" rel="nofollow" title="Subscribe to my RSS feed"><i class="icon icon-rss notranslate" aria-hidden="true"></i></a></li> <li><a itemprop="sameAs" href="https://github.com/yegor256" rel="nofollow" title="My GitHub profile"><i class="icon icon-github notranslate" aria-hidden="true"></i></a></li> <li><a itemprop="sameAs" href="http://stackoverflow.com/users/187141/yegor256" rel="nofollow" title="My StackOverflow profile"><i class="icon icon-stackoverflow notranslate" aria-hidden="true"></i></a></li> <li><a itemprop="sameAs" href="https://www.facebook.com/yegor256" rel="nofollow" title="Follow me on Facebook"><i class="icon icon-facebook notranslate" aria-hidden="true"></i></a></li> <li><a itemprop="sameAs" href="https://instagram.com/yegor256" rel="nofollow" title="Follow me on Instagram"><i class="icon icon-instagram notranslate" aria-hidden="true"></i></a></li> <li><a itemprop="sameAs" href="https://www.linkedin.com/in/yegor256" rel="nofollow" title="My LinkedIn profile"><i class="icon icon-linkedin notranslate" aria-hidden="true"></i></a></li> <li><a itemprop="sameAs" href="https://www.youtube.com/c/yegor256?sub_confirmation=1" rel="nofollow" title="My Youtube video channel"><i class="icon icon-youtube notranslate" aria-hidden="true"></i></a></li> <li><a itemprop="sameAs" href="https://www.pinterest.com/yegor256/" rel="nofollow" title="My Pinterest boards"><i class="icon icon-pinterest notranslate" aria-hidden="true"></i></a></li> <li><a itemprop="sameAs" href="https://angel.co/yegor256" rel="nofollow" title="My AngelList profile"><i class="icon icon-angellist notranslate" aria-hidden="true"></i></a></li> <li><a href="https://soundcloud.com/yegor256" rel="nofollow" title="My podcast"><i class="icon icon-podcast notranslate" aria-hidden="true"></i></a></li> <li><a href="https://itunes.apple.com/us/podcast/yegor256-podcast/id1150826721" rel="nofollow" title="My iTunes podcast"><i class="icon icon-itunes notranslate" aria-hidden="true"></i></a></li> <li><a href="https://t.me/joinchat/AAAAAEJFMRzsRTRxM3ec6A" rel="nofollow" title="My Telegram public channel"><i class="icon icon-telegram notranslate" aria-hidden="true"></i></a></li> <li><a href="mailto:blog@yegor256.com" rel="nofollow" title="Email me any time"><i class="icon icon-mail notranslate" aria-hidden="true"></i></a></li></ul><ul class="menu"> <li><a href="/" title="Home page">Home</a></li> <li ><a href="/best.html" title="Best articles to read">12&#160;Best</a></li> <li ><a href="/contents.html" title="The contents of the entire blog">All&#160;288</a></li> <li ><a href="/webinars.html" title="My webinars">Webinars</a></li> <li ><a href="/talks.html" title="Future and past conference talks">Talks</a></li> <li ><a href="/books.html" title="The books I wrote">Books</a></li> <li ><a href="/papers.html" title="My academic papers and patents">Papers</a></li> <li ><a href="/pets.html" title="My loved pet projects">Pets</a></li> <li ><a href="/award.html" title="Software quality award">Award</a></li> <li ><a href="/testimonials.html" title="What some people say about me">Testimonials</a></li> <li ><a href="/shift-m.html" title="Audio podcast about project management">Shift-M</a></li> <li ><a href="/paintings.html" title="My paintings for sale">Paintings</a></li> <li><a href="http://ru.yegor256.com/" title="Немного на русском языке">По-русски</a></li></ul></nav><div class="search"> <form method="get" action="https://www.google.com/search" itemprop="potentialAction" itemscope="" itemtype="http://schema.org/SearchAction"> <meta itemprop="target" content="https://www.google.com/search?q={q}"/> <input name="sitesearch" value="yegor256.com" type="hidden"/> <input itemprop="query-input" type="text" id="search-query" class="field field-text" required="required" onfocus="$('.google').css('visibility', 'visible');" name="q" placeholder="Search..." autocomplete="off"/> <input type="image" src="/images/google-search-icon.svg" class="google" title="Search via Google" alt="Search via Google"/> </form></div><div class="hot"><ul> <li> <a href="/code-ahead.html">Code Ahead</a> was published on Amazon just a few days ago! It is my new book, a novel about programmers. It explains in details the majority of ideas that stand behind <a href="https://www.zerocracy.com">Zerocracy</a> and <a href="https://www.xdsd.org">XDSD</a>. </li> <li> At <a href="/webinars.html">Webinar #37</a> we will discuss naming problem in OOP, for objects, methods and attributes; join us on <b>September 12</b>, at 11am PST. </li></ul></div></header></div><section itemscope="" itemtype="http://schema.org/BlogPosting"><div class="wrapper"> <header><p class="printable"> <img src="https://api.qrserver.com/v1/create-qr-code/?data=https://www.yegor256.com/2014/04/14/jcabi-dynamo-java-api-of-aws-dynamodb.html&amp;format=svg" style="width:125px;height:125px;" alt="QR code"/></p><p class="printable"> <code itemprop="url">https://www.yegor256.com/2014/04/14/jcabi-dynamo-java-api-of-aws-dynamodb.html</code></p><h1 itemprop="name headline mainEntityOfPage">Object-Oriented DynamoDB API</h1><ul class="subline"> <li> <time itemprop="datePublished" datetime="2014-04-14T00:00:00+00:00"> 14 April 2014 </time> </li> <li class="printable" itemscope="" itemprop="author" itemtype="http://schema.org/Person"> <span itemprop="name">Yegor Bugayenko</span> </li> <li class="unprintable"> <i class="icon icon-comments"></i> <a href="http://www.yegor256.com/2014/04/14/jcabi-dynamo-java-api-of-aws-dynamodb.html#disqus_thread" itemprop="discussionUrl">comments</a> </li></ul><p>DynamoDB is a <a href="http://en.wikipedia.org/wiki/NoSQL">NoSQL</a> database accessible through <a href="http://en.wikipedia.org/wiki/Representational_state_transfer">RESTful</a> JSON API. Its design is relatively simple. There are tables, which basically are collections of data structures, or in AWS terminology, &quot;items.&quot;</p><p>Every item has a mandatory &quot;hash,&quot; an optional &quot;range&quot; and a number of other optional attributes. For instance, take the example table <code>depts</code>:</p><figure class="highlight"><pre><code class="language-text" data-lang="text"><span></span>+------+--------+---------------------------+
| dept | worker | Attributes                |
+------+--------+---------------------------+
| 205  | Jeff   | job=&quot;manager&quot;, sex=&quot;male&quot; |
| 205  | Bob    | age=43, city=&quot;Chicago&quot;    |
| 398  | Alice  | age=27, job=&quot;architect&quot;   |
+------+--------+---------------------------+</code></pre></figure><p>For Java, Amazon provides an <a href="https://aws.amazon.com/documentation/sdkforjava/">SDK</a>, which mirrors all RESTful calls to Java methods. The SDK works fine, but is designed in a pure <a href="http://en.wikipedia.org/wiki/Procedural_programming">procedural</a> style.</p><p>Let&#39;s say we want to add a new item to the table above. RESTful call <a href="http://docs.aws.amazon.com/amazondynamodb/latest/APIReference/API_PutItem.html"><code>putItem</code></a> looks like (in essence):</p><figure class="highlight"><pre><code class="language-text" data-lang="text"><span></span>putItem:
  tableName: depts
  item:
    dept: 435
    worker: &quot;William&quot;
    job: &quot;programmer&quot;</code></pre></figure><p>This is what the Amazon server needs to know in order to create a new item in the table. This is how you&#39;re supposed to make this call through the AWS Java SDK:</p><figure class="highlight"><pre><code class="language-java" data-lang="java"><span></span><span class="n">PutItemRequest</span> <span class="n">request</span> <span class="o">=</span> <span class="k">new</span> <span class="n">PutItemRequest</span><span class="o">();</span>
<span class="n">request</span><span class="o">.</span><span class="na">setTableName</span><span class="o">(</span><span class="s">&quot;depts&quot;</span><span class="o">);</span>
<span class="n">Map</span><span class="o">&lt;</span><span class="n">String</span><span class="o">,</span> <span class="n">AttributeValue</span><span class="o">&gt;</span> <span class="n">attributes</span> <span class="o">=</span> <span class="k">new</span> <span class="n">HashMap</span><span class="o">&lt;&gt;();</span>
<span class="n">attributes</span><span class="o">.</span><span class="na">put</span><span class="o">(</span><span class="s">&quot;dept&quot;</span><span class="o">,</span> <span class="k">new</span> <span class="n">AttributeValue</span><span class="o">(</span><span class="mi">435</span><span class="o">));</span>
<span class="n">attributes</span><span class="o">.</span><span class="na">put</span><span class="o">(</span><span class="s">&quot;worker&quot;</span><span class="o">,</span> <span class="k">new</span> <span class="n">AttributeValue</span><span class="o">(</span><span class="s">&quot;William&quot;</span><span class="o">));</span>
<span class="n">attributes</span><span class="o">.</span><span class="na">put</span><span class="o">(</span><span class="s">&quot;job&quot;</span><span class="o">,</span> <span class="k">new</span> <span class="n">AttributeValue</span><span class="o">(</span><span class="err">&quot;</span><span class="n">programmer</span><span class="o">));</span>
<span class="n">request</span><span class="o">.</span><span class="na">setItem</span><span class="o">(</span><span class="n">attributes</span><span class="o">);</span>
<span class="n">AmazonDynamoDB</span> <span class="n">aws</span> <span class="o">=</span> <span class="c1">// instantiate it with credentials</span>
<span class="k">try</span> <span class="o">{</span>
  <span class="n">aws</span><span class="o">.</span><span class="na">putItem</span><span class="o">(</span><span class="n">request</span><span class="o">);</span>
<span class="o">}</span> <span class="k">finally</span> <span class="o">{</span>
  <span class="n">aws</span><span class="o">.</span><span class="na">shutdown</span><span class="o">();</span>
<span class="o">}</span></code></pre></figure><p>The above script works fine, but there is one major drawback---it is not object oriented. It is a perfect example of an imperative <a href="http://en.wikipedia.org/wiki/Procedural_programming">procedural programming</a>.</p><p>To allow you to compare, let me show what I&#39;ve done with <a href="http://dynamo.jcabi.com">jcabi-dynamo</a>. Here is my code, which does exactly the same thing, but in an <a href="http://en.wikipedia.org/wiki/Object-oriented_programming">object-oriented</a> way:</p><figure class="highlight"><pre><code class="language-java" data-lang="java"><span></span><span class="n">Region</span> <span class="n">region</span> <span class="o">=</span> <span class="c1">// instantiate it with credentials</span>
<span class="n">Table</span> <span class="n">table</span> <span class="o">=</span> <span class="n">region</span><span class="o">.</span><span class="na">table</span><span class="o">(</span><span class="s">&quot;depts&quot;</span><span class="o">);</span>
<span class="n">Item</span> <span class="n">item</span> <span class="o">=</span> <span class="n">table</span><span class="o">.</span><span class="na">put</span><span class="o">(</span>
  <span class="k">new</span> <span class="n">Attributes</span><span class="o">()</span>
    <span class="o">.</span><span class="na">with</span><span class="o">(</span><span class="s">&quot;dept&quot;</span><span class="o">,</span> <span class="mi">435</span><span class="o">)</span>
    <span class="o">.</span><span class="na">with</span><span class="o">(</span><span class="s">&quot;worker&quot;</span><span class="o">,</span> <span class="s">&quot;William&quot;</span><span class="o">)</span>
    <span class="o">.</span><span class="na">with</span><span class="o">(</span><span class="s">&quot;job&quot;</span><span class="o">,</span> <span class="s">&quot;programmer&quot;</span><span class="o">)</span>
<span class="o">);</span></code></pre></figure><p>My code is not only shorter, but it also employs <a href="/2016/11/21/naked-data.html">encapsulation</a> and separates responsibilities of classes. <a href="http://dynamo.jcabi.com/apidocs-0.10/com/jcabi/dynamo/Table.html"><code>Table</code></a> class (actually it is an interface internally implemented by a class) encapsulates information about the table, while <a href="http://dynamo.jcabi.com/apidocs-0.10/com/jcabi/dynamo/Item.html"><code>Item</code></a> encapsulates item details.</p><p>We can pass an <code>item</code> as an argument to another method and all DynamoDB related implementation details will be hidden from it. For example, somewhere later in the code:</p><figure class="highlight"><pre><code class="language-java" data-lang="java"><span></span><span class="kt">void</span> <span class="nf">sayHello</span><span class="o">(</span><span class="n">Item</span> <span class="n">item</span><span class="o">)</span> <span class="o">{</span>
  <span class="n">System</span><span class="o">.</span><span class="na">out</span><span class="o">.</span><span class="na">println</span><span class="o">(</span><span class="s">&quot;Hello, &quot;</span> <span class="o">+</span> <span class="n">item</span><span class="o">.</span><span class="na">get</span><span class="o">(</span><span class="s">&quot;worker&quot;</span><span class="o">));</span>
<span class="o">}</span></code></pre></figure><p>In this script, we don&#39;t know anything about DynamoDB or how to deal with its RESTful API. We interact solely with an instance of <a href="http://dynamo.jcabi.com/apidocs-0.10/com/jcabi/dynamo/Item.html"><code>Item</code></a> class.</p><p>By the way, all public entities in <a href="http://dynamo.jcabi.com">jcabi-dynamo</a> are Java interfaces. Thanks to that, you can test and mock the library completely (but I would recommend to use <a href="/2014/05/01/dynamodb-local-maven-plugin.html">DynamoDB Local</a> and create integration tests).</p><p>Let&#39;s consider a more complex example, which would take a page of code if we were to use a bare AWS SDK. Let&#39;s say that we want to remove all workers from our table who work as architects:</p><figure class="highlight"><pre><code class="language-java" data-lang="java"><span></span><span class="n">Region</span> <span class="n">region</span> <span class="o">=</span> <span class="c1">// instantiate it with credentials</span>
<span class="n">Iterator</span><span class="o">&lt;</span><span class="n">Item</span><span class="o">&gt;</span> <span class="n">workers</span> <span class="o">=</span> <span class="n">region</span><span class="o">.</span><span class="na">table</span><span class="o">(</span><span class="s">&quot;depts&quot;</span><span class="o">).</span><span class="na">frame</span><span class="o">()</span>
  <span class="o">.</span><span class="na">where</span><span class="o">(</span><span class="s">&quot;job&quot;</span><span class="o">,</span> <span class="n">Condition</span><span class="o">.</span><span class="na">equalTo</span><span class="o">(</span><span class="s">&quot;architect&quot;</span><span class="o">));</span>
<span class="k">while</span> <span class="o">(</span><span class="n">workers</span><span class="o">.</span><span class="na">hasNext</span><span class="o">())</span> <span class="o">{</span>
  <span class="n">workers</span><span class="o">.</span><span class="na">remove</span><span class="o">();</span>
<span class="o">}</span></code></pre></figure><p><a href="http://dynamo.jcabi.com">jcabi-dynamo</a> has saved a lot of code lines in a few of my projects. You can see it in action at <a href="https://github.com/rultor/rultor/tree/rultor-0.2/rultor-users/src/main/java/com/rultor/users">rultor-users</a>.</p><p>The library ships as a JAR dependency in <a href="http://repo1.maven.org/maven2/com/jcabi/jcabi-dynamo">Maven Central</a> (get its latest versions from <a href="http://search.maven.org/">Maven Central</a>):</p><figure class="highlight"><pre><code class="language-xml" data-lang="xml"><span></span><span class="nt">&lt;dependency&gt;</span>
  <span class="nt">&lt;groupId&gt;</span>com.jcabi<span class="nt">&lt;/groupId&gt;</span>
  <span class="nt">&lt;artifactId&gt;</span>jcabi-dynamo<span class="nt">&lt;/artifactId&gt;</span>
<span class="nt">&lt;/dependency&gt;</span></code></pre></figure></p>--> <nav class="buttons notranslate desktop-only"> <a href="http://www.facebook.com/sharer/sharer.php?u=https://www.yegor256.com/2014/04/14/jcabi-dynamo-java-api-of-aws-dynamodb.html" title="Share on Facebook" class="button" rel="nofollow"> <span class="count count-facebook">0</span> <i class="icon icon-facebook notranslate" aria-hidden="true"></i> </a> <a href="https://twitter.com/share?url=https://www.yegor256.com/2014/04/14/jcabi-dynamo-java-api-of-aws-dynamodb.html&amp;text=Object-Oriented+DynamoDB+API" title="Share on Twitter" class="button" rel="nofollow"> <span class="count count-twitter">0</span> <i class="icon icon-twitter notranslate" aria-hidden="true"></i> </a> <a href="https://plus.google.com/share?url=https://www.yegor256.com/2014/04/14/jcabi-dynamo-java-api-of-aws-dynamodb.html" title="Share on Google+" class="button" rel="nofollow"> <span class="count count-googleplus">0</span> <i class="icon icon-googleplus notranslate" aria-hidden="true"></i> </a> <a href="https://www.linkedin.com/cws/share?url=https://www.yegor256.com/2014/04/14/jcabi-dynamo-java-api-of-aws-dynamodb.html" title="Share on LinkedIn" class="button" rel="nofollow"> <span class="count count-linkedin">0</span> <i class="icon icon-linkedin notranslate" aria-hidden="true"></i> </a> <a href="http://reddit.com/submit?url=https://www.yegor256.com/2014/04/14/jcabi-dynamo-java-api-of-aws-dynamodb.html%3F2014-15&amp;title=Object-Oriented+DynamoDB+API" title="Share on Reddit" class="button" rel="nofollow"> <span class="count count-reddit">0</span> <i class="icon icon-reddit notranslate" aria-hidden="true"></i> </a> <a href="http://news.ycombinator.com/submitlink?u=https://www.yegor256.com/2014/04/14/jcabi-dynamo-java-api-of-aws-dynamodb.html%3F2014-15&amp;t=Object-Oriented+DynamoDB+API" title="Share on Hacker News" class="button" rel="nofollow"> <span class="count count-hackernews">0</span> <i class="icon icon-hackernews notranslate" aria-hidden="true"></i> </a> </nav> </header> <article class="main" itemprop="articleBody"><div > <figure class='badge'><a href='http://dynamo.jcabi.com'><img src='http://img.jcabi.com/logo-square.svg' style='width:64px;max-width:100%;' alt='badge'/></a></figure><p>I&#39;m a big fan of cloud computing in general and of <a href="http://aws.amazon.com/">Amazon Web Services</a> in particular. I honestly believe that in a few years big providers will host all, or almost all, computing and storage resources. When this is the case, we won&#39;t have to worry too much anymore about downtime, backups and system administrators. <a href="http://aws.amazon.com/dynamodb/">DynamoDB</a> is one of the steps towards this future.</p><blockquote class="twitter-tweet" lang="en"><p>This looks cool - jcabi-dynamo - a <a href="https://twitter.com/search?q=%23Java&amp;src=hash">#Java</a> Object layer atop the <a href="https://twitter.com/search?q=%23DynamoDB&amp;src=hash">#DynamoDB</a> SDK - <a href="http://t.co/khRFR2joKX">http://t.co/khRFR2joKX</a> <a href="https://twitter.com/search?q=%23aws&amp;src=hash">#aws</a></p>---Jeff Barr (@jeffbarr) <a href="https://twitter.com/jeffbarr/statuses/380813867971915777">September 19, 2013</a></blockquote> <script async='' src="http://platform.twitter.com/widgets.js" charset="utf-8"></script><p>DynamoDB is a <a href="http://en.wikipedia.org/wiki/NoSQL">NoSQL</a> database accessible through <a href="http://en.wikipedia.org/wiki/Representational_state_transfer">RESTful</a> JSON API. Its design is relatively simple. There are tables, which basically are collections of data structures, or in AWS terminology, &quot;items.&quot;</p><p>Every item has a mandatory &quot;hash,&quot; an optional &quot;range&quot; and a number of other optional attributes. For instance, take the example table <code>depts</code>:</p><figure class="highlight"><pre><code class="language-text" data-lang="text"><span></span>+------+--------+---------------------------+
| dept | worker | Attributes                |
+------+--------+---------------------------+
| 205  | Jeff   | job=&quot;manager&quot;, sex=&quot;male&quot; |
| 205  | Bob    | age=43, city=&quot;Chicago&quot;    |
| 398  | Alice  | age=27, job=&quot;architect&quot;   |
+------+--------+---------------------------+</code></pre></figure><p>For Java, Amazon provides an <a href="https://aws.amazon.com/documentation/sdkforjava/">SDK</a>, which mirrors all RESTful calls to Java methods. The SDK works fine, but is designed in a pure <a href="http://en.wikipedia.org/wiki/Procedural_programming">procedural</a> style.</p><p>Let&#39;s say we want to add a new item to the table above. RESTful call <a href="http://docs.aws.amazon.com/amazondynamodb/latest/APIReference/API_PutItem.html"><code>putItem</code></a> looks like (in essence):</p><figure class="highlight"><pre><code class="language-text" data-lang="text"><span></span>putItem:
  tableName: depts
  item:
    dept: 435
    worker: &quot;William&quot;
    job: &quot;programmer&quot;</code></pre></figure><p>This is what the Amazon server needs to know in order to create a new item in the table. This is how you&#39;re supposed to make this call through the AWS Java SDK:</p><figure class="highlight"><pre><code class="language-java" data-lang="java"><span></span><span class="n">PutItemRequest</span> <span class="n">request</span> <span class="o">=</span> <span class="k">new</span> <span class="n">PutItemRequest</span><span class="o">();</span>
<span class="n">request</span><span class="o">.</span><span class="na">setTableName</span><span class="o">(</span><span class="s">&quot;depts&quot;</span><span class="o">);</span>
<span class="n">Map</span><span class="o">&lt;</span><span class="n">String</span><span class="o">,</span> <span class="n">AttributeValue</span><span class="o">&gt;</span> <span class="n">attributes</span> <span class="o">=</span> <span class="k">new</span> <span class="n">HashMap</span><span class="o">&lt;&gt;();</span>
<span class="n">attributes</span><span class="o">.</span><span class="na">put</span><span class="o">(</span><span class="s">&quot;dept&quot;</span><span class="o">,</span> <span class="k">new</span> <span class="n">AttributeValue</span><span class="o">(</span><span class="mi">435</span><span class="o">));</span>
<span class="n">attributes</span><span class="o">.</span><span class="na">put</span><span class="o">(</span><span class="s">&quot;worker&quot;</span><span class="o">,</span> <span class="k">new</span> <span class="n">AttributeValue</span><span class="o">(</span><span class="s">&quot;William&quot;</span><span class="o">));</span>
<span class="n">attributes</span><span class="o">.</span><span class="na">put</span><span class="o">(</span><span class="s">&quot;job&quot;</span><span class="o">,</span> <span class="k">new</span> <span class="n">AttributeValue</span><span class="o">(</span><span class="err">&quot;</span><span class="n">programmer</span><span class="o">));</span>
<span class="n">request</span><span class="o">.</span><span class="na">setItem</span><span class="o">(</span><span class="n">attributes</span><span class="o">);</span>
<span class="n">AmazonDynamoDB</span> <span class="n">aws</span> <span class="o">=</span> <span class="c1">// instantiate it with credentials</span>
<span class="k">try</span> <span class="o">{</span>
  <span class="n">aws</span><span class="o">.</span><span class="na">putItem</span><span class="o">(</span><span class="n">request</span><span class="o">);</span>
<span class="o">}</span> <span class="k">finally</span> <span class="o">{</span>
  <span class="n">aws</span><span class="o">.</span><span class="na">shutdown</span><span class="o">();</span>
<span class="o">}</span></code></pre></figure><p>The above script works fine, but there is one major drawback---it is not object oriented. It is a perfect example of an imperative <a href="http://en.wikipedia.org/wiki/Procedural_programming">procedural programming</a>.</p><p>To allow you to compare, let me show what I&#39;ve done with <a href="http://dynamo.jcabi.com">jcabi-dynamo</a>. Here is my code, which does exactly the same thing, but in an <a href="http://en.wikipedia.org/wiki/Object-oriented_programming">object-oriented</a> way:</p><figure class="highlight"><pre><code class="language-java" data-lang="java"><span></span><span class="n">Region</span> <span class="n">region</span> <span class="o">=</span> <span class="c1">// instantiate it with credentials</span>
<span class="n">Table</span> <span class="n">table</span> <span class="o">=</span> <span class="n">region</span><span class="o">.</span><span class="na">table</span><span class="o">(</span><span class="s">&quot;depts&quot;</span><span class="o">);</span>
<span class="n">Item</span> <span class="n">item</span> <span class="o">=</span> <span class="n">table</span><span class="o">.</span><span class="na">put</span><span class="o">(</span>
  <span class="k">new</span> <span class="n">Attributes</span><span class="o">()</span>
    <span class="o">.</span><span class="na">with</span><span class="o">(</span><span class="s">&quot;dept&quot;</span><span class="o">,</span> <span class="mi">435</span><span class="o">)</span>
    <span class="o">.</span><span class="na">with</span><span class="o">(</span><span class="s">&quot;worker&quot;</span><span class="o">,</span> <span class="s">&quot;William&quot;</span><span class="o">)</span>
    <span class="o">.</span><span class="na">with</span><span class="o">(</span><span class="s">&quot;job&quot;</span><span class="o">,</span> <span class="s">&quot;programmer&quot;</span><span class="o">)</span>
<span class="o">);</span></code></pre></figure><p>My code is not only shorter, but it also employs <a href="/2016/11/21/naked-data.html">encapsulation</a> and separates responsibilities of classes. <a href="http://dynamo.jcabi.com/apidocs-0.10/com/jcabi/dynamo/Table.html"><code>Table</code></a> class (actually it is an interface internally implemented by a class) encapsulates information about the table, while <a href="http://dynamo.jcabi.com/apidocs-0.10/com/jcabi/dynamo/Item.html"><code>Item</code></a> encapsulates item details.</p><p>We can pass an <code>item</code> as an argument to another method and all DynamoDB related implementation details will be hidden from it. For example, somewhere later in the code:</p><figure class="highlight"><pre><code class="language-java" data-lang="java"><span></span><span class="kt">void</span> <span class="nf">sayHello</span><span class="o">(</span><span class="n">Item</span> <span class="n">item</span><span class="o">)</span> <span class="o">{</span>
  <span class="n">System</span><span class="o">.</span><span class="na">out</span><span class="o">.</span><span class="na">println</span><span class="o">(</span><span class="s">&quot;Hello, &quot;</span> <span class="o">+</span> <span class="n">item</span><span class="o">.</span><span class="na">get</span><span class="o">(</span><span class="s">&quot;worker&quot;</span><span class="o">));</span>
<span class="o">}</span></code></pre></figure><p>In this script, we don&#39;t know anything about DynamoDB or how to deal with its RESTful API. We interact solely with an instance of <a href="http://dynamo.jcabi.com/apidocs-0.10/com/jcabi/dynamo/Item.html"><code>Item</code></a> class.</p><p>By the way, all public entities in <a href="http://dynamo.jcabi.com">jcabi-dynamo</a> are Java interfaces. Thanks to that, you can test and mock the library completely (but I would recommend to use <a href="/2014/05/01/dynamodb-local-maven-plugin.html">DynamoDB Local</a> and create integration tests).</p><p>Let&#39;s consider a more complex example, which would take a page of code if we were to use a bare AWS SDK. Let&#39;s say that we want to remove all workers from our table who work as architects:</p><figure class="highlight"><pre><code class="language-java" data-lang="java"><span></span><span class="n">Region</span> <span class="n">region</span> <span class="o">=</span> <span class="c1">// instantiate it with credentials</span>
<span class="n">Iterator</span><span class="o">&lt;</span><span class="n">Item</span><span class="o">&gt;</span> <span class="n">workers</span> <span class="o">=</span> <span class="n">region</span><span class="o">.</span><span class="na">table</span><span class="o">(</span><span class="s">&quot;depts&quot;</span><span class="o">).</span><span class="na">frame</span><span class="o">()</span>
  <span class="o">.</span><span class="na">where</span><span class="o">(</span><span class="s">&quot;job&quot;</span><span class="o">,</span> <span class="n">Condition</span><span class="o">.</span><span class="na">equalTo</span><span class="o">(</span><span class="s">&quot;architect&quot;</span><span class="o">));</span>
<span class="k">while</span> <span class="o">(</span><span class="n">workers</span><span class="o">.</span><span class="na">hasNext</span><span class="o">())</span> <span class="o">{</span>
  <span class="n">workers</span><span class="o">.</span><span class="na">remove</span><span class="o">();</span>
<span class="o">}</span></code></pre></figure><p><a href="http://dynamo.jcabi.com">jcabi-dynamo</a> has saved a lot of code lines in a few of my projects. You can see it in action at <a href="https://github.com/rultor/rultor/tree/rultor-0.2/rultor-users/src/main/java/com/rultor/users">rultor-users</a>.</p><p>The library ships as a JAR dependency in <a href="http://repo1.maven.org/maven2/com/jcabi/jcabi-dynamo">Maven Central</a> (get its latest versions from <a href="http://search.maven.org/">Maven Central</a>):</p><figure class="highlight"><pre><code class="language-xml" data-lang="xml"><span></span><span class="nt">&lt;dependency&gt;</span>
  <span class="nt">&lt;groupId&gt;</span>com.jcabi<span class="nt">&lt;/groupId&gt;</span>
  <span class="nt">&lt;artifactId&gt;</span>jcabi-dynamo<span class="nt">&lt;/artifactId&gt;</span>
<span class="nt">&lt;/dependency&gt;</span></code></pre></figure></div></article></div><div class="wrapper"> <related-posts /></div><div class="disqus" role="complementary"><p class="disqus_hint"> Please, use <a href="https://help.disqus.com/commenting/what-html-tags-are-allowed-within-comments">syntax highlighting</a> in your comments, to make them more readable.</p><div id="disqus_thread" class="disqus-thread"> <a>&nbsp;</a></div><script> var disqus_config = function () { this.page.url = document.location.href.split('?')[0].split('#')[0].replace('https://', 'http://'); this.page.identifier = this.page.url; }; (function() { var d = document, s = d.createElement('script'); s.src = '//yegor256.disqus.com/embed.js'; s.setAttribute('data-timestamp', +new Date()); (d.head || d.body).appendChild(s); })(); </script> <noscript><div><p class="red"> JavaScript is disabled in your browser, that's why you can't see comments under this post.</p></div></noscript></div><div class="wrapper"> <footer class="footer"><p> &copy; <span itemscope="" itemprop="copyrightHolder" itemtype="http://schema.org/Person"> <span itemprop="name">Yegor Bugayenko</span> </span> 2014&ndash;<span itemprop="copyrightYear">2018</span></p></footer></div></section><div class="wrapper unprintable" style="text-align:center;margin-top:2em;"> <a href="http://www.sixnines.io/h/3ba1652f"> <img src="//www.sixnines.io/b/3ba1652f?style=flat" alt="sixnines availability badge"/> </a></div><script src="//code.jquery.com/jquery-1.9.0.min.js"></script> <script src="/js/all.js?4e047f6f42b"></script> <script>var disqus_shortname = 'yegor256';</script> <script id="dsq-count-scr" src="//yegor256.disqus.com/count.js" async="async"></script> <script> (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){ (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o), m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m) })(window,document,'script','//www.google-analytics.com/analytics.js','ga'); ga('create', 'UA-1963507-32', 'auto'); ga('send', 'pageview'); </script> <script> Cd=document;Cr="&"+Math.random();Cp="&s=1"; Cd.cookie="b=b";if(Cd.cookie)Cp+="&c=1"; Cp+="&t="+(new Date()).getTimezoneOffset(); if(self!=top)Cp+="&f=1"; </script> <script> if(navigator.javaEnabled())Cp+="&j=1"; </script> <script> if(typeof(screen)!='undefined')Cp+="&w="+screen.width+"&h="+ screen.height+"&d="+(screen.colorDepth?screen.colorDepth:screen.pixelDepth); </script> <script> Cd.write("<img src='//c.hit.ua/hit?i=95870&g=0&x=2"+Cp+Cr+ "&r="+escape(Cd.referrer)+"&u="+escape(window.location.href)+ "' border='0' wi"+"dth='1' he"+"ight='1'/>"); </script> <script type="application/ld+json"> { "@context": "http://schema.org", "@type": "Person", "name": "Yegor Bugayenko", "url": "http://www.yegor256.com", "sameAs": [ "https://www.facebook.com/yegor256", "https://instagram.com/yegor256", "https://www.linkedin.com/in/yegor256", "https://twitter.com/yegor256", "https://github.com/yegor256", "https://www.pinterest.com/yegor256/" ] } </script> </body> </html> <!DOCTYPE html> <html xmlns="http://www.w3.org/1999/xhtml" lang="en-US" xml:lang="en-US" itemscope="" itemtype="http://schema.org/WebSite"> <head> <meta charset="utf-8"/> <meta name="description" content="I created a simple fluent Java HTTP client to make things easier with HTTP interactions; the article explains its benefits comparing with native Java and Apache HttpClient " /> <meta name="keywords" content="alternative to apache http client, best java http client library, http client java, httpclient fluent, httpclient java, java http client" /> <meta name="viewport" content="width=device-width,minimum-scale=1,initial-scale=1"/> <meta name="google-site-verification" content="JEj_gQr2CPe2QKGw8XdMz0R7VboQIUbX3FlM-lwTq-8" /> <meta name="author" content="Yegor Bugayenko"> <meta name="article:published_time" content="2014-04-11 00:00:00 +0000"> <meta name="og:site_name" content="Yegor Bugayenko"/> <meta name="og:type" content="article" /> <meta name="og:locale" content="en_US" /> <meta name="twitter:account_id" content="4503599630178231" /> <meta name="twitter:creator" content="@yegor256"/> <meta name="twitter:site" content="@yegor256"/> <meta name="twitter:title" property="og:title" content="Fluent Java HTTP Client"/> <meta name="twitter:description" property="og:description" content="I created a simple fluent Java HTTP client to make things easier with HTTP interactions; the article explains its benefits comparing with native Java and Apache HttpClient "/> <meta name="twitter:url" property="og:url" content="https://www.yegor256.com/2014/04/11/jcabi-http-intro.html"/> <meta name="telegram:channel" content="AAAAAEJFMRzsRTRxM3ec6A"/> <link rel="search" type="application/opensearchdescription+xml" href="/opensearch.xml" title="yegor256" /> <link rel="shortcut icon" href="/favicon.ico?4e047f6f42b"/> <link rel="apple-touch-icon" href="/favicon.ico?4e047f6f42b"/> <link rel="alternate" type="application/rss+xml" title="RSS for yegor256.com" href="https://www.yegor256.com/rss.xml"/> <link rel="stylesheet" href="/css/layout.css?4e047f6f42b"/> <link rel="stylesheet" href="/css/icons.css?4e047f6f42b"/> <link rel="canonical" href="https://www.yegor256.com/2014/04/11/jcabi-http-intro.html" /> <link rel="amphtml" href="https://www.yegor256.com/2014/04/11/jcabi-http-intro.amp.html" /> <title>Fluent Java HTTP Client </title> </head> <body><div class="wrapper"> <aside class="header-toggle unprintable" id="header-toggle" title="Show the menu" onclick="$('#header').show();$('#header-toggle').hide();">&#9776;</aside> <header class="header" id="header"><div class="face"> <a href="/about-me.html#form" class="sub" title="Click to subscribe to my monthly newsletter"><span>Subscribe</span></a> <a href="/about-me.html" style="position:relative;"> <img src="/images/face-256x256.jpg" class="photo" alt="Yegor Bugayenko"/> </a></div><nav><ul class="menu social notranslate"> <li><a href="https://twitter.com/intent/follow?screen_name=yegor256" rel="nofollow" title="Follow me on Twitter"><i class="icon icon-twitter notranslate" aria-hidden="true"></i></a></li> <li><a href="/rss.xml" rel="nofollow" title="Subscribe to my RSS feed"><i class="icon icon-rss notranslate" aria-hidden="true"></i></a></li> <li><a itemprop="sameAs" href="https://github.com/yegor256" rel="nofollow" title="My GitHub profile"><i class="icon icon-github notranslate" aria-hidden="true"></i></a></li> <li><a itemprop="sameAs" href="http://stackoverflow.com/users/187141/yegor256" rel="nofollow" title="My StackOverflow profile"><i class="icon icon-stackoverflow notranslate" aria-hidden="true"></i></a></li> <li><a itemprop="sameAs" href="https://www.facebook.com/yegor256" rel="nofollow" title="Follow me on Facebook"><i class="icon icon-facebook notranslate" aria-hidden="true"></i></a></li> <li><a itemprop="sameAs" href="https://instagram.com/yegor256" rel="nofollow" title="Follow me on Instagram"><i class="icon icon-instagram notranslate" aria-hidden="true"></i></a></li> <li><a itemprop="sameAs" href="https://www.linkedin.com/in/yegor256" rel="nofollow" title="My LinkedIn profile"><i class="icon icon-linkedin notranslate" aria-hidden="true"></i></a></li> <li><a itemprop="sameAs" href="https://www.youtube.com/c/yegor256?sub_confirmation=1" rel="nofollow" title="My Youtube video channel"><i class="icon icon-youtube notranslate" aria-hidden="true"></i></a></li> <li><a itemprop="sameAs" href="https://www.pinterest.com/yegor256/" rel="nofollow" title="My Pinterest boards"><i class="icon icon-pinterest notranslate" aria-hidden="true"></i></a></li> <li><a itemprop="sameAs" href="https://angel.co/yegor256" rel="nofollow" title="My AngelList profile"><i class="icon icon-angellist notranslate" aria-hidden="true"></i></a></li> <li><a href="https://soundcloud.com/yegor256" rel="nofollow" title="My podcast"><i class="icon icon-podcast notranslate" aria-hidden="true"></i></a></li> <li><a href="https://itunes.apple.com/us/podcast/yegor256-podcast/id1150826721" rel="nofollow" title="My iTunes podcast"><i class="icon icon-itunes notranslate" aria-hidden="true"></i></a></li> <li><a href="https://t.me/joinchat/AAAAAEJFMRzsRTRxM3ec6A" rel="nofollow" title="My Telegram public channel"><i class="icon icon-telegram notranslate" aria-hidden="true"></i></a></li> <li><a href="mailto:blog@yegor256.com" rel="nofollow" title="Email me any time"><i class="icon icon-mail notranslate" aria-hidden="true"></i></a></li></ul><ul class="menu"> <li><a href="/" title="Home page">Home</a></li> <li ><a href="/best.html" title="Best articles to read">12&#160;Best</a></li> <li ><a href="/contents.html" title="The contents of the entire blog">All&#160;288</a></li> <li ><a href="/webinars.html" title="My webinars">Webinars</a></li> <li ><a href="/talks.html" title="Future and past conference talks">Talks</a></li> <li ><a href="/books.html" title="The books I wrote">Books</a></li> <li ><a href="/papers.html" title="My academic papers and patents">Papers</a></li> <li ><a href="/pets.html" title="My loved pet projects">Pets</a></li> <li ><a href="/award.html" title="Software quality award">Award</a></li> <li ><a href="/testimonials.html" title="What some people say about me">Testimonials</a></li> <li ><a href="/shift-m.html" title="Audio podcast about project management">Shift-M</a></li> <li ><a href="/paintings.html" title="My paintings for sale">Paintings</a></li> <li><a href="http://ru.yegor256.com/" title="Немного на русском языке">По-русски</a></li></ul></nav><div class="search"> <form method="get" action="https://www.google.com/search" itemprop="potentialAction" itemscope="" itemtype="http://schema.org/SearchAction"> <meta itemprop="target" content="https://www.google.com/search?q={q}"/> <input name="sitesearch" value="yegor256.com" type="hidden"/> <input itemprop="query-input" type="text" id="search-query" class="field field-text" required="required" onfocus="$('.google').css('visibility', 'visible');" name="q" placeholder="Search..." autocomplete="off"/> <input type="image" src="/images/google-search-icon.svg" class="google" title="Search via Google" alt="Search via Google"/> </form></div><div class="hot"><ul> <li> <a href="/code-ahead.html">Code Ahead</a> was published on Amazon just a few days ago! It is my new book, a novel about programmers. It explains in details the majority of ideas that stand behind <a href="https://www.zerocracy.com">Zerocracy</a> and <a href="https://www.xdsd.org">XDSD</a>. </li> <li> At <a href="/webinars.html">Webinar #37</a> we will discuss naming problem in OOP, for objects, methods and attributes; join us on <b>September 12</b>, at 11am PST. </li></ul></div></header></div><section itemscope="" itemtype="http://schema.org/BlogPosting"><div class="wrapper"> <header><p class="printable"> <img src="https://api.qrserver.com/v1/create-qr-code/?data=https://www.yegor256.com/2014/04/11/jcabi-http-intro.html&amp;format=svg" style="width:125px;height:125px;" alt="QR code"/></p><p class="printable"> <code itemprop="url">https://www.yegor256.com/2014/04/11/jcabi-http-intro.html</code></p><h1 itemprop="name headline mainEntityOfPage">Fluent Java HTTP Client</h1><ul class="subline"> <li> <time itemprop="datePublished" datetime="2014-04-11T00:00:00+00:00"> 11 April 2014 </time> </li> <li class="printable" itemscope="" itemprop="author" itemtype="http://schema.org/Person"> <span itemprop="name">Yegor Bugayenko</span> </li> <li class="unprintable"> <i class="icon icon-comments"></i> <a href="http://www.yegor256.com/2014/04/11/jcabi-http-intro.html#disqus_thread" itemprop="discussionUrl">comments</a> </li></ul><h2 id="simplicity">Simplicity</h2><p>For me, this was the most important requirement. The client must be simple and easy to use. In most cases, I need only to make an HTTP request and parse the JSON response to return a value. For example, this is how I use the new client to return a current EUR rate:</p><figure class="highlight"><pre><code class="language-java" data-lang="java"><span></span><span class="n">String</span> <span class="n">uri</span> <span class="o">=</span> <span class="s">&quot;http://www.getexchangerates.com/api/latest.json&quot;</span><span class="o">;</span>
<span class="n">String</span> <span class="n">rate</span> <span class="o">=</span> <span class="k">new</span> <span class="n">JdkRequest</span><span class="o">(</span><span class="n">uri</span><span class="o">)</span>
  <span class="o">.</span><span class="na">header</span><span class="o">(</span><span class="s">&quot;Accept&quot;</span><span class="o">,</span> <span class="s">&quot;application/json&quot;</span><span class="o">)</span>
  <span class="o">.</span><span class="na">fetch</span><span class="o">()</span>
  <span class="o">.</span><span class="na">as</span><span class="o">(</span><span class="n">JsonResponse</span><span class="o">.</span><span class="na">class</span><span class="o">)</span>
  <span class="o">.</span><span class="na">json</span><span class="o">().</span><span class="na">readArray</span><span class="o">().</span><span class="na">getJsonObject</span><span class="o">(</span><span class="mi">0</span><span class="o">)</span>
  <span class="o">.</span><span class="na">getString</span><span class="o">(</span><span class="s">&quot;EUR&quot;</span><span class="o">);</span></code></pre></figure><p>I assume that the above is easy to understand and maintain.</p><h2 id="fluent-interface">Fluent Interface</h2><aside class='youtube'> <a href='https://www.youtube.com/watch?v=REj8pJesMVI'><div class='box'> <img src='https://i.ytimg.com/vi/REj8pJesMVI/mqdefault.jpg' alt='YouTube video #REj8pJesMVI'/><div class='play'><i class='icon icon-play'></i></div></div></a><div>The Alternative to Fluent Interfaces in Java (webinar #33); 4 April 2018.</div></aside><p>The new client has to be <a href="/2018/03/13/fluent-interfaces.html">fluent</a>, which means that the entire server interaction fits into one Java statement. Why is this important? I think that <a href="http://martinfowler.com/bliki/FluentInterface.html">fluent interface</a> is the most compact and expressive way to perform multiple imperative calls. To my knowledge, none of the existing libraries enable this type of fluency.</p><h2 id="testable-and-extensible">Testable and Extensible</h2><p>I&#39;m a big fan of interfaces, mostly because they make your designs both cleaner and highly extensible at the same time. In <a href="http://http.jcabi.com/">jcabi-http</a>, there are five interfaces extended by 20 classes.</p><p><a href="http://http.jcabi.com/apidocs-1.3/com/jcabi/http/Request.html"><code>Request</code></a> is an interface, as well as <a href="http://http.jcabi.com/apidocs-1.3/com/jcabi/http/Response.html"><code>Response</code></a>, <a href="http://http.jcabi.com/apidocs-1.3/com/jcabi/http/RequestURI.html"><code>RequestURI</code></a>, and <a href="http://http.jcabi.com/apidocs-1.3/com/jcabi/http/RequestBody.html"><code>RequestBody</code></a> exposed by it.</p><p>Use of interfaces makes the library highly extensible. For example, we have <a href="http://http.jcabi.com/apidocs-1.3/com/jcabi/http/request/JdkRequest.html"><code>JdkRequest</code></a> and <a href="http://http.jcabi.com/apidocs-1.3/com/jcabi/http/request/ApacheRequest.html"><code>ApacheRequest</code></a>, which make actual HTTP calls to the server using two completely different technologies: (JDK <code>HttpURLConnection</code> and Apache HTTP Client, respectively). In the future, it will be possible to introduce new implementations without breaking existing code.</p><p>Say, for instance, I want to fetch a page and then do something with it. These two calls perform the task differently, but the end results are the same:</p><figure class="highlight"><pre><code class="language-java" data-lang="java"><span></span><span class="n">String</span> <span class="n">uri</span> <span class="o">=</span> <span class="s">&quot;http://www.google.com&quot;</span><span class="o">;</span>
<span class="n">Response</span> <span class="n">page</span><span class="o">;</span>
<span class="n">page</span> <span class="o">=</span> <span class="k">new</span> <span class="n">JdkRequest</span><span class="o">(</span><span class="n">uri</span><span class="o">).</span><span class="na">fetch</span><span class="o">();</span>
<span class="n">page</span> <span class="o">=</span> <span class="k">new</span> <span class="n">ApacheRequest</span><span class="o">(</span><span class="n">uri</span><span class="o">).</span><span class="na">fetch</span><span class="o">();</span></code></pre></figure><h2 id="xml-and-json-out-of-the-box">XML and JSON Out-of-the-Box</h2><p>There are two common standards that I wanted the library to support right out of the box. In most cases, the response retrieved from a server is in either XML or <a href="/2015/11/16/json-vs-xml.html">JSON</a> format. It has always been a hassle, and extra work, for me to parse the output to take care of formatting issues.</p><p><a href="http://http.jcabi.com/">jcabi-http</a> client supports them both out of the box, and it&#39;s possible to add more formats in the future as needed. For example, you can fetch XML and retrieve a string value from its element:</p><figure class="highlight"><pre><code class="language-java" data-lang="java"><span></span><span class="n">String</span> <span class="n">name</span> <span class="o">=</span> <span class="k">new</span> <span class="n">JdkRequest</span><span class="o">(</span><span class="s">&quot;http://my-api.example.com&quot;</span><span class="o">)</span>
  <span class="o">.</span><span class="na">header</span><span class="o">(</span><span class="s">&quot;Accept&quot;</span><span class="o">,</span> <span class="s">&quot;text/xml&quot;</span><span class="o">)</span>
  <span class="o">.</span><span class="na">fetch</span><span class="o">()</span>
  <span class="o">.</span><span class="na">as</span><span class="o">(</span><span class="n">XmlResponse</span><span class="o">.</span><span class="na">class</span><span class="o">)</span>
  <span class="o">.</span><span class="na">xml</span><span class="o">().</span><span class="na">xpath</span><span class="o">(</span><span class="s">&quot;/root/name/text()&quot;</span><span class="o">).</span><span class="na">get</span><span class="o">(</span><span class="mi">0</span><span class="o">);</span></code></pre></figure><p>Basically, the response produced by <code>fetch()</code> is decorated by <code>XmlResponse</code>. This then exposes the <code>xml()</code> method that returns an instance of the <a href="http://xml.jcabi.com/apidocs-0.7.7/com/jcabi/xml/XML.html"><code>XML</code></a> interface.</p><p>The same can be done with JSON through the Java JSON API (<a href="https://jcp.org/en/jsr/detail?id=353">JSR-353</a>).</p><p>None of the libraries that I&#39;m aware of or worked with offer this feature.</p><h2 id="immutable">Immutable</h2><p>The last requirement, but certainly not the least important, is that I need all interfaces of the library to be annotated with <a href="http://aspects.jcabi.com/annotation-immutable.html"><code>@Immutable</code></a>. This is important because I need to be able to encapsulate an instance of <code>Request</code> in other immutable classes.</p><p>ps. A short summary of this article was published at <a href="http://java.dzone.com/articles/jcabi-http-fluent-java-http">JavaLobby</a></p></p>--> <nav class="buttons notranslate desktop-only"> <a href="http://www.facebook.com/sharer/sharer.php?u=https://www.yegor256.com/2014/04/11/jcabi-http-intro.html" title="Share on Facebook" class="button" rel="nofollow"> <span class="count count-facebook">0</span> <i class="icon icon-facebook notranslate" aria-hidden="true"></i> </a> <a href="https://twitter.com/share?url=https://www.yegor256.com/2014/04/11/jcabi-http-intro.html&amp;text=Fluent+Java+HTTP+Client" title="Share on Twitter" class="button" rel="nofollow"> <span class="count count-twitter">0</span> <i class="icon icon-twitter notranslate" aria-hidden="true"></i> </a> <a href="https://plus.google.com/share?url=https://www.yegor256.com/2014/04/11/jcabi-http-intro.html" title="Share on Google+" class="button" rel="nofollow"> <span class="count count-googleplus">0</span> <i class="icon icon-googleplus notranslate" aria-hidden="true"></i> </a> <a href="https://www.linkedin.com/cws/share?url=https://www.yegor256.com/2014/04/11/jcabi-http-intro.html" title="Share on LinkedIn" class="button" rel="nofollow"> <span class="count count-linkedin">0</span> <i class="icon icon-linkedin notranslate" aria-hidden="true"></i> </a> <a href="http://reddit.com/submit?url=https://www.yegor256.com/2014/04/11/jcabi-http-intro.html%3F2014-14&amp;title=Fluent+Java+HTTP+Client" title="Share on Reddit" class="button" rel="nofollow"> <span class="count count-reddit">0</span> <i class="icon icon-reddit notranslate" aria-hidden="true"></i> </a> <a href="http://news.ycombinator.com/submitlink?u=https://www.yegor256.com/2014/04/11/jcabi-http-intro.html%3F2014-14&amp;t=Fluent+Java+HTTP+Client" title="Share on Hacker News" class="button" rel="nofollow"> <span class="count count-hackernews">0</span> <i class="icon icon-hackernews notranslate" aria-hidden="true"></i> </a> </nav> </header> <article class="main" itemprop="articleBody"><div > <figure class='badge'><a href='http://http.jcabi.com'><img src='http://img.jcabi.com/logo-square.svg' style='width:64px;max-width:100%;' alt='badge'/></a></figure><p>In the world of Java, there are plenty of HTTP clients from which to choose. Nevertheless, I decided to create a new one because none of the other clients satisfied fully all of my requirements. Maybe, I&#39;m too demanding. Still, this is how my <a href="http://http.jcabi.com/">jcabi-http</a> client interacts when you make an HTTP request and expect a successful HTML page in return:</p><figure class="highlight"><pre><code class="language-java" data-lang="java"><span></span><span class="n">String</span> <span class="n">html</span> <span class="o">=</span> <span class="k">new</span> <span class="n">JdkRequest</span><span class="o">(</span><span class="s">&quot;https://www.google.com&quot;</span><span class="o">)</span>
  <span class="o">.</span><span class="na">uri</span><span class="o">().</span><span class="na">path</span><span class="o">(</span><span class="s">&quot;/users&quot;</span><span class="o">).</span><span class="na">queryParam</span><span class="o">(</span><span class="s">&quot;id&quot;</span><span class="o">,</span> <span class="mi">333</span><span class="o">).</span><span class="na">back</span><span class="o">()</span>
  <span class="o">.</span><span class="na">method</span><span class="o">(</span><span class="n">Request</span><span class="o">.</span><span class="na">GET</span><span class="o">)</span>
  <span class="o">.</span><span class="na">header</span><span class="o">(</span><span class="s">&quot;Accept&quot;</span><span class="o">,</span> <span class="s">&quot;text/html&quot;</span><span class="o">)</span>
  <span class="o">.</span><span class="na">fetch</span><span class="o">()</span>
  <span class="o">.</span><span class="na">as</span><span class="o">(</span><span class="n">RestResponse</span><span class="o">.</span><span class="na">class</span><span class="o">)</span>
  <span class="o">.</span><span class="na">assertStatus</span><span class="o">(</span><span class="n">HttpURLConnection</span><span class="o">.</span><span class="na">HTTP_OK</span><span class="o">)</span>
  <span class="o">.</span><span class="na">body</span><span class="o">();</span></code></pre></figure><p>I designed this new client with the following requirements in mind:</p><h2 id="simplicity">Simplicity</h2><p>For me, this was the most important requirement. The client must be simple and easy to use. In most cases, I need only to make an HTTP request and parse the JSON response to return a value. For example, this is how I use the new client to return a current EUR rate:</p><figure class="highlight"><pre><code class="language-java" data-lang="java"><span></span><span class="n">String</span> <span class="n">uri</span> <span class="o">=</span> <span class="s">&quot;http://www.getexchangerates.com/api/latest.json&quot;</span><span class="o">;</span>
<span class="n">String</span> <span class="n">rate</span> <span class="o">=</span> <span class="k">new</span> <span class="n">JdkRequest</span><span class="o">(</span><span class="n">uri</span><span class="o">)</span>
  <span class="o">.</span><span class="na">header</span><span class="o">(</span><span class="s">&quot;Accept&quot;</span><span class="o">,</span> <span class="s">&quot;application/json&quot;</span><span class="o">)</span>
  <span class="o">.</span><span class="na">fetch</span><span class="o">()</span>
  <span class="o">.</span><span class="na">as</span><span class="o">(</span><span class="n">JsonResponse</span><span class="o">.</span><span class="na">class</span><span class="o">)</span>
  <span class="o">.</span><span class="na">json</span><span class="o">().</span><span class="na">readArray</span><span class="o">().</span><span class="na">getJsonObject</span><span class="o">(</span><span class="mi">0</span><span class="o">)</span>
  <span class="o">.</span><span class="na">getString</span><span class="o">(</span><span class="s">&quot;EUR&quot;</span><span class="o">);</span></code></pre></figure><p>I assume that the above is easy to understand and maintain.</p><h2 id="fluent-interface">Fluent Interface</h2><aside class='youtube'> <a href='https://www.youtube.com/watch?v=REj8pJesMVI'><div class='box'> <img src='https://i.ytimg.com/vi/REj8pJesMVI/mqdefault.jpg' alt='YouTube video #REj8pJesMVI'/><div class='play'><i class='icon icon-play'></i></div></div></a><div>The Alternative to Fluent Interfaces in Java (webinar #33); 4 April 2018.</div></aside><p>The new client has to be <a href="/2018/03/13/fluent-interfaces.html">fluent</a>, which means that the entire server interaction fits into one Java statement. Why is this important? I think that <a href="http://martinfowler.com/bliki/FluentInterface.html">fluent interface</a> is the most compact and expressive way to perform multiple imperative calls. To my knowledge, none of the existing libraries enable this type of fluency.</p><h2 id="testable-and-extensible">Testable and Extensible</h2><p>I&#39;m a big fan of interfaces, mostly because they make your designs both cleaner and highly extensible at the same time. In <a href="http://http.jcabi.com/">jcabi-http</a>, there are five interfaces extended by 20 classes.</p><p><a href="http://http.jcabi.com/apidocs-1.3/com/jcabi/http/Request.html"><code>Request</code></a> is an interface, as well as <a href="http://http.jcabi.com/apidocs-1.3/com/jcabi/http/Response.html"><code>Response</code></a>, <a href="http://http.jcabi.com/apidocs-1.3/com/jcabi/http/RequestURI.html"><code>RequestURI</code></a>, and <a href="http://http.jcabi.com/apidocs-1.3/com/jcabi/http/RequestBody.html"><code>RequestBody</code></a> exposed by it.</p><p>Use of interfaces makes the library highly extensible. For example, we have <a href="http://http.jcabi.com/apidocs-1.3/com/jcabi/http/request/JdkRequest.html"><code>JdkRequest</code></a> and <a href="http://http.jcabi.com/apidocs-1.3/com/jcabi/http/request/ApacheRequest.html"><code>ApacheRequest</code></a>, which make actual HTTP calls to the server using two completely different technologies: (JDK <code>HttpURLConnection</code> and Apache HTTP Client, respectively). In the future, it will be possible to introduce new implementations without breaking existing code.</p><p>Say, for instance, I want to fetch a page and then do something with it. These two calls perform the task differently, but the end results are the same:</p><figure class="highlight"><pre><code class="language-java" data-lang="java"><span></span><span class="n">String</span> <span class="n">uri</span> <span class="o">=</span> <span class="s">&quot;http://www.google.com&quot;</span><span class="o">;</span>
<span class="n">Response</span> <span class="n">page</span><span class="o">;</span>
<span class="n">page</span> <span class="o">=</span> <span class="k">new</span> <span class="n">JdkRequest</span><span class="o">(</span><span class="n">uri</span><span class="o">).</span><span class="na">fetch</span><span class="o">();</span>
<span class="n">page</span> <span class="o">=</span> <span class="k">new</span> <span class="n">ApacheRequest</span><span class="o">(</span><span class="n">uri</span><span class="o">).</span><span class="na">fetch</span><span class="o">();</span></code></pre></figure><h2 id="xml-and-json-out-of-the-box">XML and JSON Out-of-the-Box</h2><p>There are two common standards that I wanted the library to support right out of the box. In most cases, the response retrieved from a server is in either XML or <a href="/2015/11/16/json-vs-xml.html">JSON</a> format. It has always been a hassle, and extra work, for me to parse the output to take care of formatting issues.</p><p><a href="http://http.jcabi.com/">jcabi-http</a> client supports them both out of the box, and it&#39;s possible to add more formats in the future as needed. For example, you can fetch XML and retrieve a string value from its element:</p><figure class="highlight"><pre><code class="language-java" data-lang="java"><span></span><span class="n">String</span> <span class="n">name</span> <span class="o">=</span> <span class="k">new</span> <span class="n">JdkRequest</span><span class="o">(</span><span class="s">&quot;http://my-api.example.com&quot;</span><span class="o">)</span>
  <span class="o">.</span><span class="na">header</span><span class="o">(</span><span class="s">&quot;Accept&quot;</span><span class="o">,</span> <span class="s">&quot;text/xml&quot;</span><span class="o">)</span>
  <span class="o">.</span><span class="na">fetch</span><span class="o">()</span>
  <span class="o">.</span><span class="na">as</span><span class="o">(</span><span class="n">XmlResponse</span><span class="o">.</span><span class="na">class</span><span class="o">)</span>
  <span class="o">.</span><span class="na">xml</span><span class="o">().</span><span class="na">xpath</span><span class="o">(</span><span class="s">&quot;/root/name/text()&quot;</span><span class="o">).</span><span class="na">get</span><span class="o">(</span><span class="mi">0</span><span class="o">);</span></code></pre></figure><p>Basically, the response produced by <code>fetch()</code> is decorated by <code>XmlResponse</code>. This then exposes the <code>xml()</code> method that returns an instance of the <a href="http://xml.jcabi.com/apidocs-0.7.7/com/jcabi/xml/XML.html"><code>XML</code></a> interface.</p><p>The same can be done with JSON through the Java JSON API (<a href="https://jcp.org/en/jsr/detail?id=353">JSR-353</a>).</p><p>None of the libraries that I&#39;m aware of or worked with offer this feature.</p><h2 id="immutable">Immutable</h2><p>The last requirement, but certainly not the least important, is that I need all interfaces of the library to be annotated with <a href="http://aspects.jcabi.com/annotation-immutable.html"><code>@Immutable</code></a>. This is important because I need to be able to encapsulate an instance of <code>Request</code> in other immutable classes.</p><p>ps. A short summary of this article was published at <a href="http://java.dzone.com/articles/jcabi-http-fluent-java-http">JavaLobby</a></p></div></article></div><div class="wrapper"> <related-posts /></div><div class="disqus" role="complementary"><p class="disqus_hint"> Please, use <a href="https://help.disqus.com/commenting/what-html-tags-are-allowed-within-comments">syntax highlighting</a> in your comments, to make them more readable.</p><div id="disqus_thread" class="disqus-thread"> <a>&nbsp;</a></div><script> var disqus_config = function () { this.page.url = document.location.href.split('?')[0].split('#')[0].replace('https://', 'http://'); this.page.identifier = this.page.url; }; (function() { var d = document, s = d.createElement('script'); s.src = '//yegor256.disqus.com/embed.js'; s.setAttribute('data-timestamp', +new Date()); (d.head || d.body).appendChild(s); })(); </script> <noscript><div><p class="red"> JavaScript is disabled in your browser, that's why you can't see comments under this post.</p></div></noscript></div><div class="wrapper"> <footer class="footer"><p> &copy; <span itemscope="" itemprop="copyrightHolder" itemtype="http://schema.org/Person"> <span itemprop="name">Yegor Bugayenko</span> </span> 2014&ndash;<span itemprop="copyrightYear">2018</span></p></footer></div></section><div class="wrapper unprintable" style="text-align:center;margin-top:2em;"> <a href="http://www.sixnines.io/h/3ba1652f"> <img src="//www.sixnines.io/b/3ba1652f?style=flat" alt="sixnines availability badge"/> </a></div><script src="//code.jquery.com/jquery-1.9.0.min.js"></script> <script src="/js/all.js?4e047f6f42b"></script> <script>var disqus_shortname = 'yegor256';</script> <script id="dsq-count-scr" src="//yegor256.disqus.com/count.js" async="async"></script> <script> (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){ (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o), m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m) })(window,document,'script','//www.google-analytics.com/analytics.js','ga'); ga('create', 'UA-1963507-32', 'auto'); ga('send', 'pageview'); </script> <script> Cd=document;Cr="&"+Math.random();Cp="&s=1"; Cd.cookie="b=b";if(Cd.cookie)Cp+="&c=1"; Cp+="&t="+(new Date()).getTimezoneOffset(); if(self!=top)Cp+="&f=1"; </script> <script> if(navigator.javaEnabled())Cp+="&j=1"; </script> <script> if(typeof(screen)!='undefined')Cp+="&w="+screen.width+"&h="+ screen.height+"&d="+(screen.colorDepth?screen.colorDepth:screen.pixelDepth); </script> <script> Cd.write("<img src='//c.hit.ua/hit?i=95870&g=0&x=2"+Cp+Cr+ "&r="+escape(Cd.referrer)+"&u="+escape(window.location.href)+ "' border='0' wi"+"dth='1' he"+"ight='1'/>"); </script> <script type="application/ld+json"> { "@context": "http://schema.org", "@type": "Person", "name": "Yegor Bugayenko", "url": "http://www.yegor256.com", "sameAs": [ "https://www.facebook.com/yegor256", "https://instagram.com/yegor256", "https://www.linkedin.com/in/yegor256", "https://twitter.com/yegor256", "https://github.com/yegor256", "https://www.pinterest.com/yegor256/" ] } </script> </body> </html> </article></div></section><div class="wrapper unprintable" style="text-align:center;margin-top:2em;"> <a href="http://www.sixnines.io/h/3ba1652f"> <img src="//www.sixnines.io/b/3ba1652f?style=flat" alt="sixnines availability badge"/> </a></div><script src="//code.jquery.com/jquery-1.9.0.min.js"></script> <script src="/js/all.js?4e047f6f42b"></script> <script>var disqus_shortname = 'yegor256';</script> <script id="dsq-count-scr" src="//yegor256.disqus.com/count.js" async="async"></script> <script> (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){ (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o), m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m) })(window,document,'script','//www.google-analytics.com/analytics.js','ga'); ga('create', 'UA-1963507-32', 'auto'); ga('send', 'pageview'); </script> <script> Cd=document;Cr="&"+Math.random();Cp="&s=1"; Cd.cookie="b=b";if(Cd.cookie)Cp+="&c=1"; Cp+="&t="+(new Date()).getTimezoneOffset(); if(self!=top)Cp+="&f=1"; </script> <script> if(navigator.javaEnabled())Cp+="&j=1"; </script> <script> if(typeof(screen)!='undefined')Cp+="&w="+screen.width+"&h="+ screen.height+"&d="+(screen.colorDepth?screen.colorDepth:screen.pixelDepth); </script> <script> Cd.write("<img src='//c.hit.ua/hit?i=95870&g=0&x=2"+Cp+Cr+ "&r="+escape(Cd.referrer)+"&u="+escape(window.location.href)+ "' border='0' wi"+"dth='1' he"+"ight='1'/>"); </script> <script type="application/ld+json"> { "@context": "http://schema.org", "@type": "Person", "name": "Yegor Bugayenko", "url": "http://www.yegor256.com", "sameAs": [ "https://www.facebook.com/yegor256", "https://instagram.com/yegor256", "https://www.linkedin.com/in/yegor256", "https://twitter.com/yegor256", "https://github.com/yegor256", "https://www.pinterest.com/yegor256/" ] } </script> </body> </html>
