<!DOCTYPE html> <html xmlns="http://www.w3.org/1999/xhtml" lang="en-US" xml:lang="en-US" itemscope="" itemtype="http://schema.org/WebSite"> <head> <meta charset="utf-8"/> <meta name="description" content="{"layout"=>"tag-index", "posts"=>[#<Jekyll::Document _posts/2018/jun/2018-06-19-glogin.md collection=posts>, #<Jekyll::Document _posts/2017/jun/2017-06-13-dynamodb-rack-maven.md collection=posts>, #<Jekyll::Document _posts/2014/aug/2014-08-26-publish-to-rubygems.md collection=posts>, #<Jekyll::Document _posts/2014/jun/2014-06-24-jekyll-github-deploy.md collection=posts>], "tag"=>"ruby", "content"=>"", "dir"=>"/tag/", "name"=>"ruby.html", "path"=>"tag/ruby.html", "url"=>"/tag/ruby", "title"=>"ruby", "description"=>"ruby: more about ruby in this collection of recently published articles... the list is updated every few weeks."}" /> <meta name="keywords" content="{&quot;layout&quot;=&gt;&quot;tag-index&quot;, &quot;posts&quot;=&gt;[#&lt;Jekyll::Document _posts/2018/jun/2018-06-19-glogin.md collection=posts&gt;, #&lt;Jekyll::Document _posts/2017/jun/2017-06-13-dynamodb-rack-maven.md collection=posts&gt;, #&lt;Jekyll::Document _posts/2014/aug/2014-08-26-publish-to-rubygems.md collection=posts&gt;, #&lt;Jekyll::Document _posts/2014/jun/2014-06-24-jekyll-github-deploy.md collection=posts&gt;], &quot;tag&quot;=&gt;&quot;ruby&quot;, &quot;content&quot;=&gt;&quot;&quot;, &quot;dir&quot;=&gt;&quot;/tag/&quot;, &quot;name&quot;=&gt;&quot;ruby.html&quot;, &quot;path&quot;=&gt;&quot;tag/ruby.html&quot;, &quot;url&quot;=&gt;&quot;/tag/ruby&quot;, &quot;title&quot;=&gt;&quot;ruby&quot;, &quot;description&quot;=&gt;&quot;ruby: more about ruby in this collection of recently published articles... the list is updated every few weeks.&quot;}" /> <meta name="viewport" content="width=device-width,minimum-scale=1,initial-scale=1"/> <meta name="google-site-verification" content="JEj_gQr2CPe2QKGw8XdMz0R7VboQIUbX3FlM-lwTq-8" /> <meta name="author" content="Yegor Bugayenko"> <meta name="og:site_name" content="Yegor Bugayenko"/> <meta name="og:type" content="article" /> <meta name="og:locale" content="en_US" /> <meta name="twitter:account_id" content="4503599630178231" /> <meta name="twitter:creator" content="@yegor256"/> <meta name="twitter:site" content="@yegor256"/> <meta name="twitter:title" property="og:title" content="ruby"/> <meta name="twitter:description" property="og:description" content="{"layout"=>"tag-index", "posts"=>[#<Jekyll::Document _posts/2018/jun/2018-06-19-glogin.md collection=posts>, #<Jekyll::Document _posts/2017/jun/2017-06-13-dynamodb-rack-maven.md collection=posts>, #<Jekyll::Document _posts/2014/aug/2014-08-26-publish-to-rubygems.md collection=posts>, #<Jekyll::Document _posts/2014/jun/2014-06-24-jekyll-github-deploy.md collection=posts>], "tag"=>"ruby", "content"=>"", "dir"=>"/tag/", "name"=>"ruby.html", "path"=>"tag/ruby.html", "url"=>"/tag/ruby", "title"=>"ruby", "description"=>"ruby: more about ruby in this collection of recently published articles... the list is updated every few weeks."}"/> <meta name="twitter:url" property="og:url" content="https://www.yegor256.com/tag/ruby"/> <meta name="telegram:channel" content="AAAAAEJFMRzsRTRxM3ec6A"/> <link rel="search" type="application/opensearchdescription+xml" href="/opensearch.xml" title="yegor256" /> <link rel="shortcut icon" href="/favicon.ico?ddf57a1cee0"/> <link rel="apple-touch-icon" href="/favicon.ico?ddf57a1cee0"/> <link rel="alternate" type="application/rss+xml" title="RSS for yegor256.com" href="https://www.yegor256.com/rss.xml"/> <link rel="stylesheet" href="/css/layout.css?ddf57a1cee0"/> <link rel="stylesheet" href="/css/icons.css?ddf57a1cee0"/> <link rel="canonical" href="https://www.yegor256.com/tag/ruby" /> <link rel="amphtml" href="https://www.yegor256.com/tag/ruby" /> <title>ruby </title> </head> <body><div class="wrapper"> <aside class="header-toggle unprintable" id="header-toggle" title="Show the menu" onclick="$('#header').show();$('#header-toggle').hide();">&#9776;</aside> <header class="header" id="header"><div class="face"> <a href="/about-me.html#form" class="sub" title="Click to subscribe to my monthly newsletter"><span>Subscribe</span></a> <a href="/about-me.html" style="position:relative;"> <img src="/images/face-256x256.jpg" class="photo" alt="Yegor Bugayenko"/> </a></div><nav><ul class="menu social notranslate"> <li><a href="https://twitter.com/intent/follow?screen_name=yegor256" rel="nofollow" title="Follow me on Twitter"><i class="icon icon-twitter notranslate" aria-hidden="true"></i></a></li> <li><a href="/rss.xml" rel="nofollow" title="Subscribe to my RSS feed"><i class="icon icon-rss notranslate" aria-hidden="true"></i></a></li> <li><a itemprop="sameAs" href="https://github.com/yegor256" rel="nofollow" title="My GitHub profile"><i class="icon icon-github notranslate" aria-hidden="true"></i></a></li> <li><a itemprop="sameAs" href="http://stackoverflow.com/users/187141/yegor256" rel="nofollow" title="My StackOverflow profile"><i class="icon icon-stackoverflow notranslate" aria-hidden="true"></i></a></li> <li><a itemprop="sameAs" href="https://www.facebook.com/yegor256" rel="nofollow" title="Follow me on Facebook"><i class="icon icon-facebook notranslate" aria-hidden="true"></i></a></li> <li><a itemprop="sameAs" href="https://instagram.com/yegor256" rel="nofollow" title="Follow me on Instagram"><i class="icon icon-instagram notranslate" aria-hidden="true"></i></a></li> <li><a itemprop="sameAs" href="https://www.linkedin.com/in/yegor256" rel="nofollow" title="My LinkedIn profile"><i class="icon icon-linkedin notranslate" aria-hidden="true"></i></a></li> <li><a itemprop="sameAs" href="https://www.youtube.com/c/yegor256?sub_confirmation=1" rel="nofollow" title="My Youtube video channel"><i class="icon icon-youtube notranslate" aria-hidden="true"></i></a></li> <li><a itemprop="sameAs" href="https://www.pinterest.com/yegor256/" rel="nofollow" title="My Pinterest boards"><i class="icon icon-pinterest notranslate" aria-hidden="true"></i></a></li> <li><a itemprop="sameAs" href="https://angel.co/yegor256" rel="nofollow" title="My AngelList profile"><i class="icon icon-angellist notranslate" aria-hidden="true"></i></a></li> <li><a href="https://soundcloud.com/yegor256" rel="nofollow" title="My podcast"><i class="icon icon-podcast notranslate" aria-hidden="true"></i></a></li> <li><a href="https://itunes.apple.com/us/podcast/yegor256-podcast/id1150826721" rel="nofollow" title="My iTunes podcast"><i class="icon icon-itunes notranslate" aria-hidden="true"></i></a></li> <li><a href="https://t.me/yegor256news" rel="nofollow" title="My Telegram public channel"><i class="icon icon-telegram notranslate" aria-hidden="true"></i></a></li> <li><a href="mailto:blog@yegor256.com" rel="nofollow" title="Email me any time"><i class="icon icon-mail notranslate" aria-hidden="true"></i></a></li></ul><ul class="menu"> <li><a href="/" title="Home page">Home</a></li> <li /tag/ruby><a href="/best.html" title="Best articles to read">12&#160;Best</a></li> <li /tag/ruby><a href="/contents.html" title="The contents of the entire blog">All&#160;292</a></li> <li /tag/ruby><a href="/webinars.html" title="My webinars">Webinars</a></li> <li /tag/ruby><a href="/talks.html" title="Future and past conference talks">Talks</a></li> <li /tag/ruby><a href="/books.html" title="The books I wrote">Books</a></li> <li /tag/ruby><a href="/papers.html" title="My academic papers and patents">Papers</a></li> <li /tag/ruby><a href="/pets.html" title="My loved pet projects">Pets</a></li> <li /tag/ruby class="highlighted"><a href="/trainings.html" title="On-site trainings">Trainings</a></li> <li /tag/ruby><a href="/award.html" title="Software quality award">Award</a></li> <li /tag/ruby><a href="/testimonials.html" title="What some people say about me">Testimonials</a></li> <li /tag/ruby><a href="/shift-m.html" title="Audio podcast about project management">Shift-M</a></li> <li /tag/ruby><a href="/paintings.html" title="My paintings for sale">Paintings</a></li> <li><a href="https://ru.yegor256.com/" title="Немного на русском языке">По-русски</a></li></ul></nav><div class="search"> <form method="get" action="https://www.google.com/search" itemprop="potentialAction" itemscope="" itemtype="http://schema.org/SearchAction"> <meta itemprop="target" content="https://www.google.com/search?q={q}"/> <input name="sitesearch" value="yegor256.com" type="hidden"/> <input itemprop="query-input" type="text" id="search-query" class="field field-text" required="required" onfocus="$('.google').css('visibility', 'visible');" name="q" placeholder="Search..." autocomplete="off"/> <input type="image" src="/images/google-search-icon.svg" class="google" title="Search via Google" alt="Search via Google"/> </form></div><div class="hot"><ul></ul></div></header></div><section itemscope="" itemtype="http://schema.org/BlogPosting"><div class="wrapper"> <header itemprop="name"><h1>4 posts about ruby</h1></header> <article itemprop="articleBody"> <!DOCTYPE html> <html xmlns="http://www.w3.org/1999/xhtml" lang="en-US" xml:lang="en-US" itemscope="" itemtype="http://schema.org/WebSite"> <head> <meta charset="utf-8"/> <meta name="description" content="<p>You know what <a href="https://en.wikipedia.org/wiki/OAuth">OAuth</a> login is, right? It’s when your users click “login” and get redirected to Facebook, Twitter, Google, or some other website which then identifies them. Then they go back to your website and you know who they are. It’s very convenient for them. It’s convenient for you too, since you don’t need to implement the login functionality and don’t need to keep their credentials in a database. I created a simple <a href="https://github.com/yegor256/glogin">Ruby gem</a> to simplify this operation for GitHub only. Here is how it works.</p><figure class="jb_picture"><img itemprop="image" alt="The Savages (2007) by Tamara Jenkins" src="/images/2018/06/savages.jpg" longdesc="#0d3acec9" /><figcaption id="0d3acec9">The Savages (2007) by Tamara Jenkins</figcaption></figure><p>First, you will have to register your application in GitHub, as <a href="https://developer.github.com/apps/building-integrations/setting-up-and-registering-oauth-apps/">this page</a> explains. This is how it works with <a href="http://www.sinatrarb.com/">Sinatra</a>, but you can do something similar in any framework.</p><p>First, somewhere in the global space, before the app starts:</p><pre><code class="language-ruby">require 'glogin'
configure do
  set :glogin, GLogin::Auth.new(
    # You get this from GitHub, when you register your
    # web application:
    client_id,
    # Make sure this value is coming from a secure
    # place and is NOT visible in the source code:
    client_secret,
    # This is what you will register in GitHub as an
    # authorization callback URL:
    'http://www.example.com/github-callback'
  )
end
</code></pre><p>Next, for all web pages we need to parse a cookie, if it exists, and convert it into a user:</p><pre><code class="language-ruby">require 'sinatra/cookies'
before '/*' do
  if cookies[:glogin]
    begin
      @user = GLogin::Cookie::Closed.new(
        cookies[:glogin],
        # This must be some long text to be used to
        # encrypt the value in the cookie:
        encryption_secret
      ).to_user
    rescue OpenSSL::Cipher::CipherError =&gt; _
      # Nothing happens here, the user is not logged in.
      cookies.delete(:glogin)
    end
  end
end
</code></pre><p>If the <code>glogin</code> cookie comes in and contains valid data, a local variable <code>@user</code> will be set to something like this:</p><pre><code class="language-ruby">{ login: 'yegor256', avatar: 'http://...' }
</code></pre><p>Next, we need a URL for GitHub OAuth callback:</p><pre><code class="language-ruby">get '/github-callback' do
  cookies[:glogin] = GLogin::Cookie::Open.new(
    settings.glogin.user(params[:code]),
    # The same encryption secret that we were using above:
    encryption_secret
  ).to_s
  redirect to('/')
end
</code></pre><p>Finally, we need a logout URL:</p><pre><code class="language-ruby">get '/logout' do
  cookies.delete(:glogin)
  redirect to('/')
end
</code></pre><p>One more thing is the login URL you will need for your front page. Here it is:</p><pre><code class="language-ruby">settings.glogin.login_uri
</code></pre><p>For unit testing you can just provide an empty string as a <code>secret</code> for <code>GLogin::Cookie::Open</code> and <code>GLogin::Cookie::Closed</code> and the encryption will be disabled: whatever comes from the cookie will be trusted. For testing it will be convenient to provide a user name in a query string, like this:</p><pre><code>http://localhost:9292/?glogin=tester
</code></pre><p>To enable that, it’s recommended you add this line (see how it works in <a href="https://github.com/zold-io/wts.zold.io">zold-io/wts.zold.io</a>):</p><pre><code class="language-ruby">require 'sinatra/cookies'
before '/*' do
  cookies[:glogin] = params[:glogin] if params[:glogin]
  if cookies[:glogin]
    # same as above
  end
end
</code></pre><p>I use this gem in <a href="https://github.com/yegor256/sixnines">sixnines</a>, <a href="https://github.com/yegor256/0pdd">0pdd</a>, and <a href="https://github.com/zold-io/wts.zold.io">Zold</a> web apps on top of Sinatra (all open source).</p>" /> <meta name="keywords" content="next, path, output, content, previous, url, relative_path, id, collection, excerpt, draft, categories, layout, title, date, place, tags, description, keywords, image, jb_picture, slug, ext" /> <meta name="viewport" content="width=device-width,minimum-scale=1,initial-scale=1"/> <meta name="google-site-verification" content="JEj_gQr2CPe2QKGw8XdMz0R7VboQIUbX3FlM-lwTq-8" /> <meta name="author" content="Yegor Bugayenko"> <meta name="article:published_time" content="2018-06-19 00:00:00 +0000"> <meta name="og:site_name" content="Yegor Bugayenko"/> <meta name="og:type" content="article" /> <meta name="og:locale" content="en_US" /> <meta name="twitter:account_id" content="4503599630178231" /> <meta name="twitter:creator" content="@yegor256"/> <meta name="twitter:site" content="@yegor256"/> <meta name="twitter:title" property="og:title" content="Simplified GitHub Login for a Ruby Web App"/> <meta name="twitter:description" property="og:description" content="<p>You know what <a href="https://en.wikipedia.org/wiki/OAuth">OAuth</a> login is, right? It’s when your users click “login” and get redirected to Facebook, Twitter, Google, or some other website which then identifies them. Then they go back to your website and you know who they are. It’s very convenient for them. It’s convenient for you too, since you don’t need to implement the login functionality and don’t need to keep their credentials in a database. I created a simple <a href="https://github.com/yegor256/glogin">Ruby gem</a> to simplify this operation for GitHub only. Here is how it works.</p><figure class="jb_picture"><img itemprop="image" alt="The Savages (2007) by Tamara Jenkins" src="/images/2018/06/savages.jpg" longdesc="#0d3acec9" /><figcaption id="0d3acec9">The Savages (2007) by Tamara Jenkins</figcaption></figure><p>First, you will have to register your application in GitHub, as <a href="https://developer.github.com/apps/building-integrations/setting-up-and-registering-oauth-apps/">this page</a> explains. This is how it works with <a href="http://www.sinatrarb.com/">Sinatra</a>, but you can do something similar in any framework.</p><p>First, somewhere in the global space, before the app starts:</p><pre><code class="language-ruby">require 'glogin'
configure do
  set :glogin, GLogin::Auth.new(
    # You get this from GitHub, when you register your
    # web application:
    client_id,
    # Make sure this value is coming from a secure
    # place and is NOT visible in the source code:
    client_secret,
    # This is what you will register in GitHub as an
    # authorization callback URL:
    'http://www.example.com/github-callback'
  )
end
</code></pre><p>Next, for all web pages we need to parse a cookie, if it exists, and convert it into a user:</p><pre><code class="language-ruby">require 'sinatra/cookies'
before '/*' do
  if cookies[:glogin]
    begin
      @user = GLogin::Cookie::Closed.new(
        cookies[:glogin],
        # This must be some long text to be used to
        # encrypt the value in the cookie:
        encryption_secret
      ).to_user
    rescue OpenSSL::Cipher::CipherError =&gt; _
      # Nothing happens here, the user is not logged in.
      cookies.delete(:glogin)
    end
  end
end
</code></pre><p>If the <code>glogin</code> cookie comes in and contains valid data, a local variable <code>@user</code> will be set to something like this:</p><pre><code class="language-ruby">{ login: 'yegor256', avatar: 'http://...' }
</code></pre><p>Next, we need a URL for GitHub OAuth callback:</p><pre><code class="language-ruby">get '/github-callback' do
  cookies[:glogin] = GLogin::Cookie::Open.new(
    settings.glogin.user(params[:code]),
    # The same encryption secret that we were using above:
    encryption_secret
  ).to_s
  redirect to('/')
end
</code></pre><p>Finally, we need a logout URL:</p><pre><code class="language-ruby">get '/logout' do
  cookies.delete(:glogin)
  redirect to('/')
end
</code></pre><p>One more thing is the login URL you will need for your front page. Here it is:</p><pre><code class="language-ruby">settings.glogin.login_uri
</code></pre><p>For unit testing you can just provide an empty string as a <code>secret</code> for <code>GLogin::Cookie::Open</code> and <code>GLogin::Cookie::Closed</code> and the encryption will be disabled: whatever comes from the cookie will be trusted. For testing it will be convenient to provide a user name in a query string, like this:</p><pre><code>http://localhost:9292/?glogin=tester
</code></pre><p>To enable that, it’s recommended you add this line (see how it works in <a href="https://github.com/zold-io/wts.zold.io">zold-io/wts.zold.io</a>):</p><pre><code class="language-ruby">require 'sinatra/cookies'
before '/*' do
  cookies[:glogin] = params[:glogin] if params[:glogin]
  if cookies[:glogin]
    # same as above
  end
end
</code></pre><p>I use this gem in <a href="https://github.com/yegor256/sixnines">sixnines</a>, <a href="https://github.com/yegor256/0pdd">0pdd</a>, and <a href="https://github.com/zold-io/wts.zold.io">Zold</a> web apps on top of Sinatra (all open source).</p>"/> <meta name="twitter:url" property="og:url" content="https://www.yegor256.com/2018/06/19/glogin.html"/> <meta name="telegram:channel" content="AAAAAEJFMRzsRTRxM3ec6A"/> <link rel="search" type="application/opensearchdescription+xml" href="/opensearch.xml" title="yegor256" /> <link rel="shortcut icon" href="/favicon.ico?ddf57a1cee0"/> <link rel="apple-touch-icon" href="/favicon.ico?ddf57a1cee0"/> <link rel="alternate" type="application/rss+xml" title="RSS for yegor256.com" href="https://www.yegor256.com/rss.xml"/> <link rel="stylesheet" href="/css/layout.css?ddf57a1cee0"/> <link rel="stylesheet" href="/css/icons.css?ddf57a1cee0"/> <link rel="canonical" href="https://www.yegor256.com/2018/06/19/glogin.html" /> <link rel="amphtml" href="https://www.yegor256.com/2018/06/19/glogin.amp.html" /> <title>Simplified GitHub Login for a Ruby Web App </title> <meta name='og:image' content='https://www.yegor256.com/images/2018/06/savages.jpg'/><meta name='twitter:image' content='https://www.yegor256.com/images/2018/06/savages.jpg'/><meta name='og:image:width' content='1463'/> <meta name='twitter:image:width' content='1463'/><meta name='og:image:height' content='955'/> <meta name='twitter:image:height' content='955'/><meta name='twitter:card' content='summary_large_image'/><meta name='twitter:image:alt' content='The Savages (2007) by Tamara Jenkins'/> </head> <body><div class="wrapper"> <aside class="header-toggle unprintable" id="header-toggle" title="Show the menu" onclick="$('#header').show();$('#header-toggle').hide();">&#9776;</aside> <header class="header" id="header"><div class="face"> <a href="/about-me.html#form" class="sub" title="Click to subscribe to my monthly newsletter"><span>Subscribe</span></a> <a href="/about-me.html" style="position:relative;"> <img src="/images/face-256x256.jpg" class="photo" alt="Yegor Bugayenko"/> </a></div><nav><ul class="menu social notranslate"> <li><a href="https://twitter.com/intent/follow?screen_name=yegor256" rel="nofollow" title="Follow me on Twitter"><i class="icon icon-twitter notranslate" aria-hidden="true"></i></a></li> <li><a href="/rss.xml" rel="nofollow" title="Subscribe to my RSS feed"><i class="icon icon-rss notranslate" aria-hidden="true"></i></a></li> <li><a itemprop="sameAs" href="https://github.com/yegor256" rel="nofollow" title="My GitHub profile"><i class="icon icon-github notranslate" aria-hidden="true"></i></a></li> <li><a itemprop="sameAs" href="http://stackoverflow.com/users/187141/yegor256" rel="nofollow" title="My StackOverflow profile"><i class="icon icon-stackoverflow notranslate" aria-hidden="true"></i></a></li> <li><a itemprop="sameAs" href="https://www.facebook.com/yegor256" rel="nofollow" title="Follow me on Facebook"><i class="icon icon-facebook notranslate" aria-hidden="true"></i></a></li> <li><a itemprop="sameAs" href="https://instagram.com/yegor256" rel="nofollow" title="Follow me on Instagram"><i class="icon icon-instagram notranslate" aria-hidden="true"></i></a></li> <li><a itemprop="sameAs" href="https://www.linkedin.com/in/yegor256" rel="nofollow" title="My LinkedIn profile"><i class="icon icon-linkedin notranslate" aria-hidden="true"></i></a></li> <li><a itemprop="sameAs" href="https://www.youtube.com/c/yegor256?sub_confirmation=1" rel="nofollow" title="My Youtube video channel"><i class="icon icon-youtube notranslate" aria-hidden="true"></i></a></li> <li><a itemprop="sameAs" href="https://www.pinterest.com/yegor256/" rel="nofollow" title="My Pinterest boards"><i class="icon icon-pinterest notranslate" aria-hidden="true"></i></a></li> <li><a itemprop="sameAs" href="https://angel.co/yegor256" rel="nofollow" title="My AngelList profile"><i class="icon icon-angellist notranslate" aria-hidden="true"></i></a></li> <li><a href="https://soundcloud.com/yegor256" rel="nofollow" title="My podcast"><i class="icon icon-podcast notranslate" aria-hidden="true"></i></a></li> <li><a href="https://itunes.apple.com/us/podcast/yegor256-podcast/id1150826721" rel="nofollow" title="My iTunes podcast"><i class="icon icon-itunes notranslate" aria-hidden="true"></i></a></li> <li><a href="https://t.me/yegor256news" rel="nofollow" title="My Telegram public channel"><i class="icon icon-telegram notranslate" aria-hidden="true"></i></a></li> <li><a href="mailto:blog@yegor256.com" rel="nofollow" title="Email me any time"><i class="icon icon-mail notranslate" aria-hidden="true"></i></a></li></ul><ul class="menu"> <li><a href="/" title="Home page">Home</a></li> <li /2018/06/19/glogin.html><a href="/best.html" title="Best articles to read">12&#160;Best</a></li> <li /2018/06/19/glogin.html><a href="/contents.html" title="The contents of the entire blog">All&#160;292</a></li> <li /2018/06/19/glogin.html><a href="/webinars.html" title="My webinars">Webinars</a></li> <li /2018/06/19/glogin.html><a href="/talks.html" title="Future and past conference talks">Talks</a></li> <li /2018/06/19/glogin.html><a href="/books.html" title="The books I wrote">Books</a></li> <li /2018/06/19/glogin.html><a href="/papers.html" title="My academic papers and patents">Papers</a></li> <li /2018/06/19/glogin.html><a href="/pets.html" title="My loved pet projects">Pets</a></li> <li /2018/06/19/glogin.html class="highlighted"><a href="/trainings.html" title="On-site trainings">Trainings</a></li> <li /2018/06/19/glogin.html><a href="/award.html" title="Software quality award">Award</a></li> <li /2018/06/19/glogin.html><a href="/testimonials.html" title="What some people say about me">Testimonials</a></li> <li /2018/06/19/glogin.html><a href="/shift-m.html" title="Audio podcast about project management">Shift-M</a></li> <li /2018/06/19/glogin.html><a href="/paintings.html" title="My paintings for sale">Paintings</a></li> <li><a href="https://ru.yegor256.com/" title="Немного на русском языке">По-русски</a></li></ul></nav><div class="search"> <form method="get" action="https://www.google.com/search" itemprop="potentialAction" itemscope="" itemtype="http://schema.org/SearchAction"> <meta itemprop="target" content="https://www.google.com/search?q={q}"/> <input name="sitesearch" value="yegor256.com" type="hidden"/> <input itemprop="query-input" type="text" id="search-query" class="field field-text" required="required" onfocus="$('.google').css('visibility', 'visible');" name="q" placeholder="Search..." autocomplete="off"/> <input type="image" src="/images/google-search-icon.svg" class="google" title="Search via Google" alt="Search via Google"/> </form></div><div class="hot"><ul></ul></div></header></div><section itemscope="" itemtype="http://schema.org/BlogPosting"><div class="wrapper"> <header><p class="printable"> <img src="https://api.qrserver.com/v1/create-qr-code/?data=https://www.yegor256.com/2018/06/19/glogin.html&amp;format=svg" style="width:125px;height:125px;" alt="QR code"/></p><p class="printable"> <code itemprop="url">https://www.yegor256.com/2018/06/19/glogin.html</code></p><h1 itemprop="name headline mainEntityOfPage">Simplified GitHub Login for a Ruby Web App</h1><ul class="subline"> <li> <time itemprop="datePublished" datetime="2018-06-19T00:00:00+00:00"> 19 June 2018 </time> </li> <li class="desktop-only" itemprop="locationCreated">Moscow, Russia</li> <li class="printable" itemscope="" itemprop="author" itemtype="http://schema.org/Person"> <span itemprop="name">Yegor Bugayenko</span> </li> <li class="unprintable"> <i class="icon icon-comments"></i> <a href="https://www.yegor256.com/2018/06/19/glogin.html#disqus_thread" itemprop="discussionUrl">comments</a> </li></ul><p class="unprintable"><p>You know what <a href="https://en.wikipedia.org/wiki/OAuth">OAuth</a> login is, right? It’s when your users click “login” and get redirected to Facebook, Twitter, Google, or some other website which then identifies them. Then they go back to your website and you know who they are. It’s very convenient for them. It’s convenient for you too, since you don’t need to implement the login functionality and don’t need to keep their credentials in a database. I created a simple <a href="https://github.com/yegor256/glogin">Ruby gem</a> to simplify this operation for GitHub only. Here is how it works.</p><figure class="jb_picture"><img itemprop="image" alt="The Savages (2007) by Tamara Jenkins" src="/images/2018/06/savages.jpg" longdesc="#0d3acec9" /><figcaption id="0d3acec9">The Savages (2007) by Tamara Jenkins</figcaption></figure><p>First, you will have to register your application in GitHub, as <a href="https://developer.github.com/apps/building-integrations/setting-up-and-registering-oauth-apps/">this page</a> explains. This is how it works with <a href="http://www.sinatrarb.com/">Sinatra</a>, but you can do something similar in any framework.</p><p>First, somewhere in the global space, before the app starts:</p><pre><code class="language-ruby">require 'glogin'
configure do
  set :glogin, GLogin::Auth.new(
    # You get this from GitHub, when you register your
    # web application:
    client_id,
    # Make sure this value is coming from a secure
    # place and is NOT visible in the source code:
    client_secret,
    # This is what you will register in GitHub as an
    # authorization callback URL:
    'http://www.example.com/github-callback'
  )
end
</code></pre><p>Next, for all web pages we need to parse a cookie, if it exists, and convert it into a user:</p><pre><code class="language-ruby">require 'sinatra/cookies'
before '/*' do
  if cookies[:glogin]
    begin
      @user = GLogin::Cookie::Closed.new(
        cookies[:glogin],
        # This must be some long text to be used to
        # encrypt the value in the cookie:
        encryption_secret
      ).to_user
    rescue OpenSSL::Cipher::CipherError =&gt; _
      # Nothing happens here, the user is not logged in.
      cookies.delete(:glogin)
    end
  end
end
</code></pre><p>If the <code>glogin</code> cookie comes in and contains valid data, a local variable <code>@user</code> will be set to something like this:</p><pre><code class="language-ruby">{ login: 'yegor256', avatar: 'http://...' }
</code></pre><p>Next, we need a URL for GitHub OAuth callback:</p><pre><code class="language-ruby">get '/github-callback' do
  cookies[:glogin] = GLogin::Cookie::Open.new(
    settings.glogin.user(params[:code]),
    # The same encryption secret that we were using above:
    encryption_secret
  ).to_s
  redirect to('/')
end
</code></pre><p>Finally, we need a logout URL:</p><pre><code class="language-ruby">get '/logout' do
  cookies.delete(:glogin)
  redirect to('/')
end
</code></pre><p>One more thing is the login URL you will need for your front page. Here it is:</p><pre><code class="language-ruby">settings.glogin.login_uri
</code></pre><p>For unit testing you can just provide an empty string as a <code>secret</code> for <code>GLogin::Cookie::Open</code> and <code>GLogin::Cookie::Closed</code> and the encryption will be disabled: whatever comes from the cookie will be trusted. For testing it will be convenient to provide a user name in a query string, like this:</p><pre><code>http://localhost:9292/?glogin=tester
</code></pre><p>To enable that, it’s recommended you add this line (see how it works in <a href="https://github.com/zold-io/wts.zold.io">zold-io/wts.zold.io</a>):</p><pre><code class="language-ruby">require 'sinatra/cookies'
before '/*' do
  cookies[:glogin] = params[:glogin] if params[:glogin]
  if cookies[:glogin]
    # same as above
  end
end
</code></pre><p>I use this gem in <a href="https://github.com/yegor256/sixnines">sixnines</a>, <a href="https://github.com/yegor256/0pdd">0pdd</a>, and <a href="https://github.com/zold-io/wts.zold.io">Zold</a> web apps on top of Sinatra (all open source).</p></p><nav class="buttons notranslate desktop-only"> <a href="http://www.facebook.com/sharer/sharer.php?u=https://www.yegor256.com/2018/06/19/glogin.html" title="Share on Facebook" class="button" rel="nofollow"> <span class="count count-facebook">0</span> <i class="icon icon-facebook notranslate" aria-hidden="true"></i> </a> <a href="https://twitter.com/share?url=https://www.yegor256.com/2018/06/19/glogin.html&amp;text=Simplified+GitHub+Login+for+a+Ruby+Web+App" title="Share on Twitter" class="button" rel="nofollow"> <span class="count count-twitter">0</span> <i class="icon icon-twitter notranslate" aria-hidden="true"></i> </a> <a href="https://plus.google.com/share?url=https://www.yegor256.com/2018/06/19/glogin.html" title="Share on Google+" class="button" rel="nofollow"> <span class="count count-googleplus">0</span> <i class="icon icon-googleplus notranslate" aria-hidden="true"></i> </a> <a href="https://www.linkedin.com/cws/share?url=https://www.yegor256.com/2018/06/19/glogin.html" title="Share on LinkedIn" class="button" rel="nofollow"> <span class="count count-linkedin">0</span> <i class="icon icon-linkedin notranslate" aria-hidden="true"></i> </a> <a href="http://reddit.com/submit?url=https://www.yegor256.com/2018/06/19/glogin.html%3F2018-24&amp;title=Simplified+GitHub+Login+for+a+Ruby+Web+App" title="Share on Reddit" class="button" rel="nofollow"> <span class="count count-reddit">0</span> <i class="icon icon-reddit notranslate" aria-hidden="true"></i> </a> <a href="http://news.ycombinator.com/submitlink?u=https://www.yegor256.com/2018/06/19/glogin.html%3F2018-24&amp;t=Simplified+GitHub+Login+for+a+Ruby+Web+App" title="Share on Hacker News" class="button" rel="nofollow"> <span class="count count-hackernews">0</span> <i class="icon icon-hackernews notranslate" aria-hidden="true"></i> </a> </nav> </header> <article class="main" itemprop="articleBody"><div ><p>You know what <a href="https://en.wikipedia.org/wiki/OAuth">OAuth</a> login is, right? It’s when your users click “login” and get redirected to Facebook, Twitter, Google, or some other website which then identifies them. Then they go back to your website and you know who they are. It’s very convenient for them. It’s convenient for you too, since you don’t need to implement the login functionality and don’t need to keep their credentials in a database. I created a simple <a href="https://github.com/yegor256/glogin">Ruby gem</a> to simplify this operation for GitHub only. Here is how it works.</p><figure class="jb_picture"><img itemprop="image" alt="The Savages (2007) by Tamara Jenkins" src="/images/2018/06/savages.jpg" longdesc="#0d3acec9" /><figcaption id="0d3acec9">The Savages (2007) by Tamara Jenkins</figcaption></figure><p>First, you will have to register your application in GitHub, as <a href="https://developer.github.com/apps/building-integrations/setting-up-and-registering-oauth-apps/">this page</a> explains. This is how it works with <a href="http://www.sinatrarb.com/">Sinatra</a>, but you can do something similar in any framework.</p><p>First, somewhere in the global space, before the app starts:</p><pre><code class="language-ruby">require 'glogin'
configure do
  set :glogin, GLogin::Auth.new(
    # You get this from GitHub, when you register your
    # web application:
    client_id,
    # Make sure this value is coming from a secure
    # place and is NOT visible in the source code:
    client_secret,
    # This is what you will register in GitHub as an
    # authorization callback URL:
    'http://www.example.com/github-callback'
  )
end
</code></pre><p>Next, for all web pages we need to parse a cookie, if it exists, and convert it into a user:</p><pre><code class="language-ruby">require 'sinatra/cookies'
before '/*' do
  if cookies[:glogin]
    begin
      @user = GLogin::Cookie::Closed.new(
        cookies[:glogin],
        # This must be some long text to be used to
        # encrypt the value in the cookie:
        encryption_secret
      ).to_user
    rescue OpenSSL::Cipher::CipherError =&gt; _
      # Nothing happens here, the user is not logged in.
      cookies.delete(:glogin)
    end
  end
end
</code></pre><p>If the <code>glogin</code> cookie comes in and contains valid data, a local variable <code>@user</code> will be set to something like this:</p><pre><code class="language-ruby">{ login: 'yegor256', avatar: 'http://...' }
</code></pre><p>Next, we need a URL for GitHub OAuth callback:</p><pre><code class="language-ruby">get '/github-callback' do
  cookies[:glogin] = GLogin::Cookie::Open.new(
    settings.glogin.user(params[:code]),
    # The same encryption secret that we were using above:
    encryption_secret
  ).to_s
  redirect to('/')
end
</code></pre><p>Finally, we need a logout URL:</p><pre><code class="language-ruby">get '/logout' do
  cookies.delete(:glogin)
  redirect to('/')
end
</code></pre><p>One more thing is the login URL you will need for your front page. Here it is:</p><pre><code class="language-ruby">settings.glogin.login_uri
</code></pre><p>For unit testing you can just provide an empty string as a <code>secret</code> for <code>GLogin::Cookie::Open</code> and <code>GLogin::Cookie::Closed</code> and the encryption will be disabled: whatever comes from the cookie will be trusted. For testing it will be convenient to provide a user name in a query string, like this:</p><pre><code>http://localhost:9292/?glogin=tester
</code></pre><p>To enable that, it’s recommended you add this line (see how it works in <a href="https://github.com/zold-io/wts.zold.io">zold-io/wts.zold.io</a>):</p><pre><code class="language-ruby">require 'sinatra/cookies'
before '/*' do
  cookies[:glogin] = params[:glogin] if params[:glogin]
  if cookies[:glogin]
    # same as above
  end
end
</code></pre><p>I use this gem in <a href="https://github.com/yegor256/sixnines">sixnines</a>, <a href="https://github.com/yegor256/0pdd">0pdd</a>, and <a href="https://github.com/zold-io/wts.zold.io">Zold</a> web apps on top of Sinatra (all open source).</p></div></article></div><div class="wrapper"> <related-posts /></div><div class="disqus" role="complementary"><p class="disqus_hint"> Please, use <a href="https://help.disqus.com/commenting/what-html-tags-are-allowed-within-comments">syntax highlighting</a> in your comments, to make them more readable.</p><div id="disqus_thread" class="disqus-thread"> <a>&nbsp;</a></div><script> var disqus_config = function () { this.page.url = document.location.href.split('?')[0].split('#')[0].replace('https://', 'http://'); this.page.identifier = this.page.url; }; (function() { var d = document, s = d.createElement('script'); s.src = '//yegor256.disqus.com/embed.js'; s.setAttribute('data-timestamp', +new Date()); (d.head || d.body).appendChild(s); })(); </script> <noscript><div><p class="red"> JavaScript is disabled in your browser, that's why you can't see comments under this post.</p></div></noscript></div><div class="wrapper"> <footer class="footer"><p> &copy; <span itemscope="" itemprop="copyrightHolder" itemtype="http://schema.org/Person"> <span itemprop="name">Yegor Bugayenko</span> </span> 2014&ndash;<span itemprop="copyrightYear">2018</span></p></footer></div></section><div class="wrapper unprintable" style="text-align:center;margin-top:2em;"> <a href="http://www.sixnines.io/h/3ba1652f"> <img src="//www.sixnines.io/b/3ba1652f?style=flat" alt="sixnines availability badge"/> </a></div><script src="//code.jquery.com/jquery-1.9.0.min.js"></script> <script src="/js/all.js?ddf57a1cee0"></script> <script>var disqus_shortname = 'yegor256';</script> <script id="dsq-count-scr" src="//yegor256.disqus.com/count.js" async="async"></script> <script> (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){ (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o), m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m) })(window,document,'script','//www.google-analytics.com/analytics.js','ga'); ga('create', 'UA-1963507-32', 'auto'); ga('send', 'pageview'); </script> <script> Cd=document;Cr="&"+Math.random();Cp="&s=1"; Cd.cookie="b=b";if(Cd.cookie)Cp+="&c=1"; Cp+="&t="+(new Date()).getTimezoneOffset(); if(self!=top)Cp+="&f=1"; </script> <script> if(navigator.javaEnabled())Cp+="&j=1"; </script> <script> if(typeof(screen)!='undefined')Cp+="&w="+screen.width+"&h="+ screen.height+"&d="+(screen.colorDepth?screen.colorDepth:screen.pixelDepth); </script> <script> Cd.write("<img src='//c.hit.ua/hit?i=95870&g=0&x=2"+Cp+Cr+ "&r="+escape(Cd.referrer)+"&u="+escape(window.location.href)+ "' border='0' wi"+"dth='1' he"+"ight='1'/>"); </script> <script type="application/ld+json"> { "@context": "http://schema.org", "@type": "Person", "name": "Yegor Bugayenko", "url": "https://www.yegor256.com", "sameAs": [ "https://www.facebook.com/yegor256", "https://instagram.com/yegor256", "https://www.linkedin.com/in/yegor256", "https://twitter.com/yegor256", "https://github.com/yegor256", "https://www.pinterest.com/yegor256/" ] } </script> </body> </html> <!DOCTYPE html> <html xmlns="http://www.w3.org/1999/xhtml" lang="en-US" xml:lang="en-US" itemscope="" itemtype="http://schema.org/WebSite"> <head> <meta charset="utf-8"/> <meta name="description" content="<p>In <a href="/2017/04/25/sixnines.html">SixNines.io</a>, one of my Ruby pet web apps, I’m using <a href="https://aws.amazon.com/dynamodb/">DynamoDB</a>, a NoSQL cloud database by <a href="https://aws.amazon.com/">AWS</a>. It works like a charm, but the problem is that it’s not so easy to create an integration test, to make sure my code works together with the “real” DynamoDB server and tables. Let me show you how it was solved. The code is open source and you can see it in the <a href="https://github.com/yegor256/sixnines">yegor256/sixnines</a> GitHub repo.</p><h2 id="how-to-bootstrap-dynamodb-local">How to bootstrap DynamoDB Local</h2><p>First, you need to use <a href="https://aws.amazon.com/blogs/aws/dynamodb-local-for-desktop-development/">DynamoDB Local</a>, a command line tool created by AWS exactly for the purposes of testing. You need to start it before your integration tests and stop it afterwards.</p><p>To make things simpler I suggest you use <a href="http://dynamodb.jcabi.com/"><code>jcabi-dynamodb-maven-plugin</code></a>, a <a href="https://maven.apache.org/">Maven</a> plugin that I <a href="/2014/05/01/dynamodb-local-maven-plugin.html">made</a> a few years ago. You will need to add <a href="https://github.com/yegor256/sixnines/blob/0.17/dynamodb-local/pom.xml"><code>pom.xml</code></a> to your repository and start/stop Maven from a <a href="https://github.com/yegor256/sixnines/blob/0.17/Rakefile"><code>Rakefile</code></a>, just like I’m doing <a href="https://github.com/yegor256/sixnines/blob/0.17/Rakefile#L50-L67">here</a>:</p><figure class="highlight"><pre><code class="language-ruby" data-lang="ruby"><span></span><span class="n">task</span> <span class="ss">:dynamo</span> <span class="k">do</span>
  <span class="no">FileUtils</span><span class="o">.</span><span class="n">rm_rf</span><span class="p">(</span><span class="s1">&#39;dynamodb-local/target&#39;</span><span class="p">)</span>
  <span class="n">pid</span> <span class="o">=</span> <span class="no">Process</span><span class="o">.</span><span class="n">spawn</span><span class="p">(</span><span class="s1">&#39;mvn&#39;</span><span class="p">,</span> <span class="s1">&#39;install&#39;</span><span class="p">,</span> <span class="ss">chdir</span><span class="p">:</span> <span class="s1">&#39;dynamodb-local&#39;</span><span class="p">)</span>
  <span class="nb">at_exit</span> <span class="k">do</span>
    <span class="sb">`kill -TERM </span><span class="si">#{</span><span class="n">pid</span><span class="si">}</span><span class="sb">`</span>
  <span class="k">end</span>
  <span class="k">begin</span>
    <span class="no">Dynamo</span><span class="o">.</span><span class="n">new</span><span class="o">.</span><span class="n">aws</span><span class="o">.</span><span class="n">describe_table</span><span class="p">(</span><span class="ss">table_name</span><span class="p">:</span> <span class="s1">&#39;sn-endpoints&#39;</span><span class="p">)</span>
  <span class="k">rescue</span> <span class="no">Exception</span> <span class="o">=&gt;</span> <span class="n">e</span>
    <span class="nb">sleep</span><span class="p">(</span><span class="mi">5</span><span class="p">)</span>
    <span class="k">retry</span>
  <span class="k">end</span>
<span class="k">end</span></code></pre></figure><p>First, I’m removing <code>dynamodb-local/target</code>, the directory where Maven keeps its temporary files, to make sure we always start from scratch.</p><p>Then, I’m starting <code>mvn install</code>, using <code>Process.spawn</code>, as a background process with <code>pid</code> as its process ID (this won’t work in Windows, only Linux/Mac). Then I immediately register an <a href="https://ruby-doc.org/core-2.2.3/Kernel.html#method-i-at_exit"><code>at_exit</code></a> Ruby hook, which will be executed if Ruby dies for any reason. I’m sure it’s obvious why I have to do that—in order to avoid garbage running in the background after Rake is finished or terminated.</p><p>Pay attention, I’m using <code>kill -TERM</code> instead of <code>kill -KILL</code>, in order to give Maven a chance to wrap everything up, terminate DynamoDB Local correctly, close its TCP port and exit.</p><h2 id="how-to-check-that-its-running">How to check that it’s running</h2><p>Next I’m checking the status of <code>sn-endpoints</code>, one of the tables in the DynamoDB Local. It has to be there if the server is up and running. It will be created by <code>jcabi-dynamodb-maven-plugin</code> according to <a href="https://github.com/yegor256/sixnines/blob/0.17/dynamodb-local/tables/sn-endpoints.json"><code>sn-endpoints.json</code></a>, its JSON configuration.</p><p>Most probably the table won’t be ready immediately though, since it takes time to bootstrap Maven, start the server, and create tables there. That’s why, if the exception is thrown, I catch it, wait for 5 seconds and try again. I keep trying many times, until the server is ready. Eventually it will be. It takes about 12-15 seconds on my MacBook, which means 2-3 attempts/exceptions.</p><h2 id="how-to-connect-to-dynamodb-local">How to connect to DynamoDB Local</h2><p>My classes need to know how to connect to the server during integration tests. In production they need to connect to AWS, in testing they have to know about the DynamoDB Local instance I just started. This is what I have in my class <a href="https://github.com/yegor256/sixnines/blob/0.17/objects/dynamo.rb"><code>Dynamo</code></a>, which is responsible for the very connection with DynamoDB. Its decision on where to connect is based on the environment variable <code>RACK_ENV</code>, which is set to <code>"test"</code> in <a href="https://github.com/yegor256/sixnines/blob/0.17/test/test__helper.rb#L25"><code>test__helper.rb</code></a>, which is included by <a href="https://github.com/yegor256/sixnines/blob/0.17/Rakefile#L39"><code>rake/testtask</code></a> in front of all other tests, thanks to the double underscore in its name.</p><p>If the environment variable is set to <code>"test"</code>, <code>Dynamo</code> takes the connectivity parameters from the YAML file <a href="https://github.com/yegor256/sixnines/blob/0.17/objects/dynamo.rb#L37"><code>dynamodb-local/target/dynamo.yml</code></a> created by <a href="https://github.com/yegor256/sixnines/blob/0.17/dynamodb-local/pom.xml#L79-L100"><code>maven-resources-plugin:copy-resources</code></a>. The TCP port of the DynamoDB Local database will be <a href="https://github.com/yegor256/sixnines/blob/0.17/dynamodb-local/config/dynamo.yml">there</a>, as well as the DynamoDB authentication key and secret.</p><h2 id="how-to-run-the-integration-tests">How to run the integration tests</h2><p>This is the easiest part. I just use my objects the way they are supposed to be used in production and they connect to DynamoDB Local instead of AWS.</p><p>I’m using Rack::Test in order to test the entire application, via a set of HTTP calls. For example, <a href="https://github.com/yegor256/sixnines/blob/0.17/test/test_sixnines.rb#L143-L147">here</a> I’m trying to render Jeff’s user account page. Its HTTP response code is supposed to be 200:</p><figure class="highlight"><pre><code class="language-java" data-lang="java"><span></span><span class="n">require</span> <span class="err">&#39;</span><span class="n">test</span><span class="o">/</span><span class="n">unit</span><span class="err">&#39;</span>
<span class="n">require</span> <span class="err">&#39;</span><span class="n">rack</span><span class="o">/</span><span class="n">test</span><span class="err">&#39;</span>
<span class="kd">class</span> <span class="nc">AppTest</span> <span class="o">&lt;</span> <span class="n">Test</span><span class="o">::</span><span class="n">Unit</span><span class="o">::</span><span class="n">TestCase</span>
  <span class="n">include</span> <span class="n">Rack</span><span class="o">::</span><span class="n">Test</span><span class="o">::</span><span class="n">Methods</span>
  <span class="n">def</span> <span class="n">app</span>
    <span class="n">Sinatra</span><span class="o">::</span><span class="n">Application</span>
  <span class="n">end</span>
  <span class="n">def</span> <span class="n">test_user_account</span>
    <span class="nf">header</span><span class="o">(</span><span class="err">&#39;</span><span class="n">Cookie</span><span class="err">&#39;</span><span class="o">,</span> <span class="err">&#39;</span><span class="n">sixnines</span><span class="o">=</span><span class="n">jeff</span><span class="err">&#39;</span><span class="o">)</span>
    <span class="n">get</span><span class="o">(</span><span class="err">&#39;</span><span class="o">/</span><span class="n">a</span><span class="err">&#39;</span><span class="o">)</span>
    <span class="n">assert_equal</span><span class="o">(</span><span class="mi">200</span><span class="o">,</span> <span class="n">last_response</span><span class="o">.</span><span class="na">status</span><span class="o">)</span>
  <span class="n">end</span></code></pre></figure><p>##</p><p>Now you can run the entire test from the command line. You can see how <a href="/2014/09/11/deployment-script-vs-rultor.html">Rultor</a> runs it while releasing a new version: <a href="http://www.rultor.com/t/11705-302080694">full log</a>. Also, see how it works <a href="https://travis-ci.org/yegor256/sixnines">in Travis</a>. In a nutshell:</p><ul> <li>You call <code>rake</code> in the command line and Rake starts;</li> <li>Rake attempts to run the <a href="https://github.com/yegor256/sixnines/blob/0.17/Rakefile#L32"><code>default</code></a> task, which depends on <a href="https://github.com/yegor256/sixnines/blob/0.17/Rakefile#L36"><code>test</code></a>;</li> <li>Rake attempts to run <code>test</code>, which depends on <a href="https://github.com/yegor256/sixnines/blob/0.17/Rakefile#L50"><code>dynamo</code></a>;</li> <li>Rake, inside <code>test</code> task, runs <code>mvn install</code> in the background with this <a href="https://github.com/yegor256/sixnines/blob/0.17/dynamodb-local/pom.xml"><code>pom.xml</code></a>;</li> <li>Maven <a href="https://github.com/yegor256/sixnines/blob/0.17/dynamodb-local/pom.xml#L38-L60">unpacks</a> DynamoDB Local installation package;</li> <li>Maven <a href="https://github.com/yegor256/sixnines/blob/0.17/dynamodb-local/pom.xml#L61-L78">reserves</a> a random TCP port and stores its value into <code>${dynamo.port}</code>;</li> <li>Maven <a href="https://github.com/yegor256/sixnines/blob/0.17/dynamodb-local/pom.xml#L79-L100">saves</a> <code>${dynamo.port}</code> and key/secret pair info;</li> <li>Maven <a href="https://github.com/yegor256/sixnines/blob/0.17/dynamodb-local/pom.xml#L101-L128">starts</a> DynamoDB Local, binding it to the reserved TCP port;</li> <li>Rake <a href="https://github.com/yegor256/sixnines/blob/0.17/Rakefile#L57-L65">waits</a> for DynamoDB Local availability on the reserved port;</li> <li>Rake <a href="https://github.com/yegor256/sixnines/blob/0.17/Rakefile#L38-L39">imports</a> all <a href="https://github.com/yegor256/sixnines/tree/0.17/test">test classes</a> starting from <a href="https://github.com/yegor256/sixnines/blob/0.17/test/test__helper.rb">test__helper.rb</a>;</li> <li>Environment variable <code>RACK_ENV</code> is <a href="https://github.com/yegor256/sixnines/blob/0.17/test/test__helper.rb#L25">set</a> to <code>"test"</code>;</li> <li>Rack::Test <a href="https://github.com/yegor256/sixnines/blob/0.17/test/test_sixnines.rb#L145">attempts</a> to dispatch a web page;</li> <li><a href="https://github.com/yegor256/sixnines/blob/0.17/objects/dynamo.rb"><code>Dynamo</code></a> <a href="https://github.com/yegor256/sixnines/blob/0.17/objects/dynamo.rb#L37-L39">loads</a> YAML config from <a href="https://github.com/yegor256/sixnines/blob/0.17/dynamodb-local/config/dynamo.yml"><code>dynamo.yml</code></a> and connects to DynamoDB Local;</li> <li>Rake stops;</li> <li>Ruby <a href="https://github.com/yegor256/sixnines/blob/0.17/Rakefile#L53-L56">terminates</a> Maven and it stops DynamoDB Local.</li></ul><p>That’s it.</p>" /> <meta name="keywords" content="next, path, output, content, previous, url, relative_path, id, collection, excerpt, draft, categories, layout, title, date, place, tags, description, keywords, slug, ext" /> <meta name="viewport" content="width=device-width,minimum-scale=1,initial-scale=1"/> <meta name="google-site-verification" content="JEj_gQr2CPe2QKGw8XdMz0R7VboQIUbX3FlM-lwTq-8" /> <meta name="author" content="Yegor Bugayenko"> <meta name="article:published_time" content="2017-06-13 00:00:00 +0000"> <meta name="og:site_name" content="Yegor Bugayenko"/> <meta name="og:type" content="article" /> <meta name="og:locale" content="en_US" /> <meta name="twitter:account_id" content="4503599630178231" /> <meta name="twitter:creator" content="@yegor256"/> <meta name="twitter:site" content="@yegor256"/> <meta name="twitter:title" property="og:title" content="DynamoDB + Rake + Maven + Rack::Test"/> <meta name="twitter:description" property="og:description" content="<p>In <a href="/2017/04/25/sixnines.html">SixNines.io</a>, one of my Ruby pet web apps, I’m using <a href="https://aws.amazon.com/dynamodb/">DynamoDB</a>, a NoSQL cloud database by <a href="https://aws.amazon.com/">AWS</a>. It works like a charm, but the problem is that it’s not so easy to create an integration test, to make sure my code works together with the “real” DynamoDB server and tables. Let me show you how it was solved. The code is open source and you can see it in the <a href="https://github.com/yegor256/sixnines">yegor256/sixnines</a> GitHub repo.</p><h2 id="how-to-bootstrap-dynamodb-local">How to bootstrap DynamoDB Local</h2><p>First, you need to use <a href="https://aws.amazon.com/blogs/aws/dynamodb-local-for-desktop-development/">DynamoDB Local</a>, a command line tool created by AWS exactly for the purposes of testing. You need to start it before your integration tests and stop it afterwards.</p><p>To make things simpler I suggest you use <a href="http://dynamodb.jcabi.com/"><code>jcabi-dynamodb-maven-plugin</code></a>, a <a href="https://maven.apache.org/">Maven</a> plugin that I <a href="/2014/05/01/dynamodb-local-maven-plugin.html">made</a> a few years ago. You will need to add <a href="https://github.com/yegor256/sixnines/blob/0.17/dynamodb-local/pom.xml"><code>pom.xml</code></a> to your repository and start/stop Maven from a <a href="https://github.com/yegor256/sixnines/blob/0.17/Rakefile"><code>Rakefile</code></a>, just like I’m doing <a href="https://github.com/yegor256/sixnines/blob/0.17/Rakefile#L50-L67">here</a>:</p><figure class="highlight"><pre><code class="language-ruby" data-lang="ruby"><span></span><span class="n">task</span> <span class="ss">:dynamo</span> <span class="k">do</span>
  <span class="no">FileUtils</span><span class="o">.</span><span class="n">rm_rf</span><span class="p">(</span><span class="s1">&#39;dynamodb-local/target&#39;</span><span class="p">)</span>
  <span class="n">pid</span> <span class="o">=</span> <span class="no">Process</span><span class="o">.</span><span class="n">spawn</span><span class="p">(</span><span class="s1">&#39;mvn&#39;</span><span class="p">,</span> <span class="s1">&#39;install&#39;</span><span class="p">,</span> <span class="ss">chdir</span><span class="p">:</span> <span class="s1">&#39;dynamodb-local&#39;</span><span class="p">)</span>
  <span class="nb">at_exit</span> <span class="k">do</span>
    <span class="sb">`kill -TERM </span><span class="si">#{</span><span class="n">pid</span><span class="si">}</span><span class="sb">`</span>
  <span class="k">end</span>
  <span class="k">begin</span>
    <span class="no">Dynamo</span><span class="o">.</span><span class="n">new</span><span class="o">.</span><span class="n">aws</span><span class="o">.</span><span class="n">describe_table</span><span class="p">(</span><span class="ss">table_name</span><span class="p">:</span> <span class="s1">&#39;sn-endpoints&#39;</span><span class="p">)</span>
  <span class="k">rescue</span> <span class="no">Exception</span> <span class="o">=&gt;</span> <span class="n">e</span>
    <span class="nb">sleep</span><span class="p">(</span><span class="mi">5</span><span class="p">)</span>
    <span class="k">retry</span>
  <span class="k">end</span>
<span class="k">end</span></code></pre></figure><p>First, I’m removing <code>dynamodb-local/target</code>, the directory where Maven keeps its temporary files, to make sure we always start from scratch.</p><p>Then, I’m starting <code>mvn install</code>, using <code>Process.spawn</code>, as a background process with <code>pid</code> as its process ID (this won’t work in Windows, only Linux/Mac). Then I immediately register an <a href="https://ruby-doc.org/core-2.2.3/Kernel.html#method-i-at_exit"><code>at_exit</code></a> Ruby hook, which will be executed if Ruby dies for any reason. I’m sure it’s obvious why I have to do that—in order to avoid garbage running in the background after Rake is finished or terminated.</p><p>Pay attention, I’m using <code>kill -TERM</code> instead of <code>kill -KILL</code>, in order to give Maven a chance to wrap everything up, terminate DynamoDB Local correctly, close its TCP port and exit.</p><h2 id="how-to-check-that-its-running">How to check that it’s running</h2><p>Next I’m checking the status of <code>sn-endpoints</code>, one of the tables in the DynamoDB Local. It has to be there if the server is up and running. It will be created by <code>jcabi-dynamodb-maven-plugin</code> according to <a href="https://github.com/yegor256/sixnines/blob/0.17/dynamodb-local/tables/sn-endpoints.json"><code>sn-endpoints.json</code></a>, its JSON configuration.</p><p>Most probably the table won’t be ready immediately though, since it takes time to bootstrap Maven, start the server, and create tables there. That’s why, if the exception is thrown, I catch it, wait for 5 seconds and try again. I keep trying many times, until the server is ready. Eventually it will be. It takes about 12-15 seconds on my MacBook, which means 2-3 attempts/exceptions.</p><h2 id="how-to-connect-to-dynamodb-local">How to connect to DynamoDB Local</h2><p>My classes need to know how to connect to the server during integration tests. In production they need to connect to AWS, in testing they have to know about the DynamoDB Local instance I just started. This is what I have in my class <a href="https://github.com/yegor256/sixnines/blob/0.17/objects/dynamo.rb"><code>Dynamo</code></a>, which is responsible for the very connection with DynamoDB. Its decision on where to connect is based on the environment variable <code>RACK_ENV</code>, which is set to <code>"test"</code> in <a href="https://github.com/yegor256/sixnines/blob/0.17/test/test__helper.rb#L25"><code>test__helper.rb</code></a>, which is included by <a href="https://github.com/yegor256/sixnines/blob/0.17/Rakefile#L39"><code>rake/testtask</code></a> in front of all other tests, thanks to the double underscore in its name.</p><p>If the environment variable is set to <code>"test"</code>, <code>Dynamo</code> takes the connectivity parameters from the YAML file <a href="https://github.com/yegor256/sixnines/blob/0.17/objects/dynamo.rb#L37"><code>dynamodb-local/target/dynamo.yml</code></a> created by <a href="https://github.com/yegor256/sixnines/blob/0.17/dynamodb-local/pom.xml#L79-L100"><code>maven-resources-plugin:copy-resources</code></a>. The TCP port of the DynamoDB Local database will be <a href="https://github.com/yegor256/sixnines/blob/0.17/dynamodb-local/config/dynamo.yml">there</a>, as well as the DynamoDB authentication key and secret.</p><h2 id="how-to-run-the-integration-tests">How to run the integration tests</h2><p>This is the easiest part. I just use my objects the way they are supposed to be used in production and they connect to DynamoDB Local instead of AWS.</p><p>I’m using Rack::Test in order to test the entire application, via a set of HTTP calls. For example, <a href="https://github.com/yegor256/sixnines/blob/0.17/test/test_sixnines.rb#L143-L147">here</a> I’m trying to render Jeff’s user account page. Its HTTP response code is supposed to be 200:</p><figure class="highlight"><pre><code class="language-java" data-lang="java"><span></span><span class="n">require</span> <span class="err">&#39;</span><span class="n">test</span><span class="o">/</span><span class="n">unit</span><span class="err">&#39;</span>
<span class="n">require</span> <span class="err">&#39;</span><span class="n">rack</span><span class="o">/</span><span class="n">test</span><span class="err">&#39;</span>
<span class="kd">class</span> <span class="nc">AppTest</span> <span class="o">&lt;</span> <span class="n">Test</span><span class="o">::</span><span class="n">Unit</span><span class="o">::</span><span class="n">TestCase</span>
  <span class="n">include</span> <span class="n">Rack</span><span class="o">::</span><span class="n">Test</span><span class="o">::</span><span class="n">Methods</span>
  <span class="n">def</span> <span class="n">app</span>
    <span class="n">Sinatra</span><span class="o">::</span><span class="n">Application</span>
  <span class="n">end</span>
  <span class="n">def</span> <span class="n">test_user_account</span>
    <span class="nf">header</span><span class="o">(</span><span class="err">&#39;</span><span class="n">Cookie</span><span class="err">&#39;</span><span class="o">,</span> <span class="err">&#39;</span><span class="n">sixnines</span><span class="o">=</span><span class="n">jeff</span><span class="err">&#39;</span><span class="o">)</span>
    <span class="n">get</span><span class="o">(</span><span class="err">&#39;</span><span class="o">/</span><span class="n">a</span><span class="err">&#39;</span><span class="o">)</span>
    <span class="n">assert_equal</span><span class="o">(</span><span class="mi">200</span><span class="o">,</span> <span class="n">last_response</span><span class="o">.</span><span class="na">status</span><span class="o">)</span>
  <span class="n">end</span></code></pre></figure><p>##</p><p>Now you can run the entire test from the command line. You can see how <a href="/2014/09/11/deployment-script-vs-rultor.html">Rultor</a> runs it while releasing a new version: <a href="http://www.rultor.com/t/11705-302080694">full log</a>. Also, see how it works <a href="https://travis-ci.org/yegor256/sixnines">in Travis</a>. In a nutshell:</p><ul> <li>You call <code>rake</code> in the command line and Rake starts;</li> <li>Rake attempts to run the <a href="https://github.com/yegor256/sixnines/blob/0.17/Rakefile#L32"><code>default</code></a> task, which depends on <a href="https://github.com/yegor256/sixnines/blob/0.17/Rakefile#L36"><code>test</code></a>;</li> <li>Rake attempts to run <code>test</code>, which depends on <a href="https://github.com/yegor256/sixnines/blob/0.17/Rakefile#L50"><code>dynamo</code></a>;</li> <li>Rake, inside <code>test</code> task, runs <code>mvn install</code> in the background with this <a href="https://github.com/yegor256/sixnines/blob/0.17/dynamodb-local/pom.xml"><code>pom.xml</code></a>;</li> <li>Maven <a href="https://github.com/yegor256/sixnines/blob/0.17/dynamodb-local/pom.xml#L38-L60">unpacks</a> DynamoDB Local installation package;</li> <li>Maven <a href="https://github.com/yegor256/sixnines/blob/0.17/dynamodb-local/pom.xml#L61-L78">reserves</a> a random TCP port and stores its value into <code>${dynamo.port}</code>;</li> <li>Maven <a href="https://github.com/yegor256/sixnines/blob/0.17/dynamodb-local/pom.xml#L79-L100">saves</a> <code>${dynamo.port}</code> and key/secret pair info;</li> <li>Maven <a href="https://github.com/yegor256/sixnines/blob/0.17/dynamodb-local/pom.xml#L101-L128">starts</a> DynamoDB Local, binding it to the reserved TCP port;</li> <li>Rake <a href="https://github.com/yegor256/sixnines/blob/0.17/Rakefile#L57-L65">waits</a> for DynamoDB Local availability on the reserved port;</li> <li>Rake <a href="https://github.com/yegor256/sixnines/blob/0.17/Rakefile#L38-L39">imports</a> all <a href="https://github.com/yegor256/sixnines/tree/0.17/test">test classes</a> starting from <a href="https://github.com/yegor256/sixnines/blob/0.17/test/test__helper.rb">test__helper.rb</a>;</li> <li>Environment variable <code>RACK_ENV</code> is <a href="https://github.com/yegor256/sixnines/blob/0.17/test/test__helper.rb#L25">set</a> to <code>"test"</code>;</li> <li>Rack::Test <a href="https://github.com/yegor256/sixnines/blob/0.17/test/test_sixnines.rb#L145">attempts</a> to dispatch a web page;</li> <li><a href="https://github.com/yegor256/sixnines/blob/0.17/objects/dynamo.rb"><code>Dynamo</code></a> <a href="https://github.com/yegor256/sixnines/blob/0.17/objects/dynamo.rb#L37-L39">loads</a> YAML config from <a href="https://github.com/yegor256/sixnines/blob/0.17/dynamodb-local/config/dynamo.yml"><code>dynamo.yml</code></a> and connects to DynamoDB Local;</li> <li>Rake stops;</li> <li>Ruby <a href="https://github.com/yegor256/sixnines/blob/0.17/Rakefile#L53-L56">terminates</a> Maven and it stops DynamoDB Local.</li></ul><p>That’s it.</p>"/> <meta name="twitter:url" property="og:url" content="https://www.yegor256.com/2017/06/13/dynamodb-rack-maven.html"/> <meta name="telegram:channel" content="AAAAAEJFMRzsRTRxM3ec6A"/> <link rel="search" type="application/opensearchdescription+xml" href="/opensearch.xml" title="yegor256" /> <link rel="shortcut icon" href="/favicon.ico?ddf57a1cee0"/> <link rel="apple-touch-icon" href="/favicon.ico?ddf57a1cee0"/> <link rel="alternate" type="application/rss+xml" title="RSS for yegor256.com" href="https://www.yegor256.com/rss.xml"/> <link rel="stylesheet" href="/css/layout.css?ddf57a1cee0"/> <link rel="stylesheet" href="/css/icons.css?ddf57a1cee0"/> <link rel="canonical" href="https://www.yegor256.com/2017/06/13/dynamodb-rack-maven.html" /> <link rel="amphtml" href="https://www.yegor256.com/2017/06/13/dynamodb-rack-maven.amp.html" /> <title>DynamoDB + Rake + Maven + Rack::Test </title> </head> <body><div class="wrapper"> <aside class="header-toggle unprintable" id="header-toggle" title="Show the menu" onclick="$('#header').show();$('#header-toggle').hide();">&#9776;</aside> <header class="header" id="header"><div class="face"> <a href="/about-me.html#form" class="sub" title="Click to subscribe to my monthly newsletter"><span>Subscribe</span></a> <a href="/about-me.html" style="position:relative;"> <img src="/images/face-256x256.jpg" class="photo" alt="Yegor Bugayenko"/> </a></div><nav><ul class="menu social notranslate"> <li><a href="https://twitter.com/intent/follow?screen_name=yegor256" rel="nofollow" title="Follow me on Twitter"><i class="icon icon-twitter notranslate" aria-hidden="true"></i></a></li> <li><a href="/rss.xml" rel="nofollow" title="Subscribe to my RSS feed"><i class="icon icon-rss notranslate" aria-hidden="true"></i></a></li> <li><a itemprop="sameAs" href="https://github.com/yegor256" rel="nofollow" title="My GitHub profile"><i class="icon icon-github notranslate" aria-hidden="true"></i></a></li> <li><a itemprop="sameAs" href="http://stackoverflow.com/users/187141/yegor256" rel="nofollow" title="My StackOverflow profile"><i class="icon icon-stackoverflow notranslate" aria-hidden="true"></i></a></li> <li><a itemprop="sameAs" href="https://www.facebook.com/yegor256" rel="nofollow" title="Follow me on Facebook"><i class="icon icon-facebook notranslate" aria-hidden="true"></i></a></li> <li><a itemprop="sameAs" href="https://instagram.com/yegor256" rel="nofollow" title="Follow me on Instagram"><i class="icon icon-instagram notranslate" aria-hidden="true"></i></a></li> <li><a itemprop="sameAs" href="https://www.linkedin.com/in/yegor256" rel="nofollow" title="My LinkedIn profile"><i class="icon icon-linkedin notranslate" aria-hidden="true"></i></a></li> <li><a itemprop="sameAs" href="https://www.youtube.com/c/yegor256?sub_confirmation=1" rel="nofollow" title="My Youtube video channel"><i class="icon icon-youtube notranslate" aria-hidden="true"></i></a></li> <li><a itemprop="sameAs" href="https://www.pinterest.com/yegor256/" rel="nofollow" title="My Pinterest boards"><i class="icon icon-pinterest notranslate" aria-hidden="true"></i></a></li> <li><a itemprop="sameAs" href="https://angel.co/yegor256" rel="nofollow" title="My AngelList profile"><i class="icon icon-angellist notranslate" aria-hidden="true"></i></a></li> <li><a href="https://soundcloud.com/yegor256" rel="nofollow" title="My podcast"><i class="icon icon-podcast notranslate" aria-hidden="true"></i></a></li> <li><a href="https://itunes.apple.com/us/podcast/yegor256-podcast/id1150826721" rel="nofollow" title="My iTunes podcast"><i class="icon icon-itunes notranslate" aria-hidden="true"></i></a></li> <li><a href="https://t.me/yegor256news" rel="nofollow" title="My Telegram public channel"><i class="icon icon-telegram notranslate" aria-hidden="true"></i></a></li> <li><a href="mailto:blog@yegor256.com" rel="nofollow" title="Email me any time"><i class="icon icon-mail notranslate" aria-hidden="true"></i></a></li></ul><ul class="menu"> <li><a href="/" title="Home page">Home</a></li> <li /2017/06/13/dynamodb-rack-maven.html><a href="/best.html" title="Best articles to read">12&#160;Best</a></li> <li /2017/06/13/dynamodb-rack-maven.html><a href="/contents.html" title="The contents of the entire blog">All&#160;292</a></li> <li /2017/06/13/dynamodb-rack-maven.html><a href="/webinars.html" title="My webinars">Webinars</a></li> <li /2017/06/13/dynamodb-rack-maven.html><a href="/talks.html" title="Future and past conference talks">Talks</a></li> <li /2017/06/13/dynamodb-rack-maven.html><a href="/books.html" title="The books I wrote">Books</a></li> <li /2017/06/13/dynamodb-rack-maven.html><a href="/papers.html" title="My academic papers and patents">Papers</a></li> <li /2017/06/13/dynamodb-rack-maven.html><a href="/pets.html" title="My loved pet projects">Pets</a></li> <li /2017/06/13/dynamodb-rack-maven.html class="highlighted"><a href="/trainings.html" title="On-site trainings">Trainings</a></li> <li /2017/06/13/dynamodb-rack-maven.html><a href="/award.html" title="Software quality award">Award</a></li> <li /2017/06/13/dynamodb-rack-maven.html><a href="/testimonials.html" title="What some people say about me">Testimonials</a></li> <li /2017/06/13/dynamodb-rack-maven.html><a href="/shift-m.html" title="Audio podcast about project management">Shift-M</a></li> <li /2017/06/13/dynamodb-rack-maven.html><a href="/paintings.html" title="My paintings for sale">Paintings</a></li> <li><a href="https://ru.yegor256.com/" title="Немного на русском языке">По-русски</a></li></ul></nav><div class="search"> <form method="get" action="https://www.google.com/search" itemprop="potentialAction" itemscope="" itemtype="http://schema.org/SearchAction"> <meta itemprop="target" content="https://www.google.com/search?q={q}"/> <input name="sitesearch" value="yegor256.com" type="hidden"/> <input itemprop="query-input" type="text" id="search-query" class="field field-text" required="required" onfocus="$('.google').css('visibility', 'visible');" name="q" placeholder="Search..." autocomplete="off"/> <input type="image" src="/images/google-search-icon.svg" class="google" title="Search via Google" alt="Search via Google"/> </form></div><div class="hot"><ul></ul></div></header></div><section itemscope="" itemtype="http://schema.org/BlogPosting"><div class="wrapper"> <header><p class="printable"> <img src="https://api.qrserver.com/v1/create-qr-code/?data=https://www.yegor256.com/2017/06/13/dynamodb-rack-maven.html&amp;format=svg" style="width:125px;height:125px;" alt="QR code"/></p><p class="printable"> <code itemprop="url">https://www.yegor256.com/2017/06/13/dynamodb-rack-maven.html</code></p><h1 itemprop="name headline mainEntityOfPage">DynamoDB + Rake + Maven + Rack::Test</h1><ul class="subline"> <li> <time itemprop="datePublished" datetime="2017-06-13T00:00:00+00:00"> 13 June 2017 </time> </li> <li class="desktop-only" itemprop="locationCreated">Odessa, Ukraine</li> <li class="printable" itemscope="" itemprop="author" itemtype="http://schema.org/Person"> <span itemprop="name">Yegor Bugayenko</span> </li> <li class="unprintable"> <i class="icon icon-comments"></i> <a href="https://www.yegor256.com/2017/06/13/dynamodb-rack-maven.html#disqus_thread" itemprop="discussionUrl">comments</a> </li></ul><p class="unprintable"><p>In <a href="/2017/04/25/sixnines.html">SixNines.io</a>, one of my Ruby pet web apps, I’m using <a href="https://aws.amazon.com/dynamodb/">DynamoDB</a>, a NoSQL cloud database by <a href="https://aws.amazon.com/">AWS</a>. It works like a charm, but the problem is that it’s not so easy to create an integration test, to make sure my code works together with the “real” DynamoDB server and tables. Let me show you how it was solved. The code is open source and you can see it in the <a href="https://github.com/yegor256/sixnines">yegor256/sixnines</a> GitHub repo.</p><h2 id="how-to-bootstrap-dynamodb-local">How to bootstrap DynamoDB Local</h2><p>First, you need to use <a href="https://aws.amazon.com/blogs/aws/dynamodb-local-for-desktop-development/">DynamoDB Local</a>, a command line tool created by AWS exactly for the purposes of testing. You need to start it before your integration tests and stop it afterwards.</p><p>To make things simpler I suggest you use <a href="http://dynamodb.jcabi.com/"><code>jcabi-dynamodb-maven-plugin</code></a>, a <a href="https://maven.apache.org/">Maven</a> plugin that I <a href="/2014/05/01/dynamodb-local-maven-plugin.html">made</a> a few years ago. You will need to add <a href="https://github.com/yegor256/sixnines/blob/0.17/dynamodb-local/pom.xml"><code>pom.xml</code></a> to your repository and start/stop Maven from a <a href="https://github.com/yegor256/sixnines/blob/0.17/Rakefile"><code>Rakefile</code></a>, just like I’m doing <a href="https://github.com/yegor256/sixnines/blob/0.17/Rakefile#L50-L67">here</a>:</p><figure class="highlight"><pre><code class="language-ruby" data-lang="ruby"><span></span><span class="n">task</span> <span class="ss">:dynamo</span> <span class="k">do</span>
  <span class="no">FileUtils</span><span class="o">.</span><span class="n">rm_rf</span><span class="p">(</span><span class="s1">&#39;dynamodb-local/target&#39;</span><span class="p">)</span>
  <span class="n">pid</span> <span class="o">=</span> <span class="no">Process</span><span class="o">.</span><span class="n">spawn</span><span class="p">(</span><span class="s1">&#39;mvn&#39;</span><span class="p">,</span> <span class="s1">&#39;install&#39;</span><span class="p">,</span> <span class="ss">chdir</span><span class="p">:</span> <span class="s1">&#39;dynamodb-local&#39;</span><span class="p">)</span>
  <span class="nb">at_exit</span> <span class="k">do</span>
    <span class="sb">`kill -TERM </span><span class="si">#{</span><span class="n">pid</span><span class="si">}</span><span class="sb">`</span>
  <span class="k">end</span>
  <span class="k">begin</span>
    <span class="no">Dynamo</span><span class="o">.</span><span class="n">new</span><span class="o">.</span><span class="n">aws</span><span class="o">.</span><span class="n">describe_table</span><span class="p">(</span><span class="ss">table_name</span><span class="p">:</span> <span class="s1">&#39;sn-endpoints&#39;</span><span class="p">)</span>
  <span class="k">rescue</span> <span class="no">Exception</span> <span class="o">=&gt;</span> <span class="n">e</span>
    <span class="nb">sleep</span><span class="p">(</span><span class="mi">5</span><span class="p">)</span>
    <span class="k">retry</span>
  <span class="k">end</span>
<span class="k">end</span></code></pre></figure><p>First, I’m removing <code>dynamodb-local/target</code>, the directory where Maven keeps its temporary files, to make sure we always start from scratch.</p><p>Then, I’m starting <code>mvn install</code>, using <code>Process.spawn</code>, as a background process with <code>pid</code> as its process ID (this won’t work in Windows, only Linux/Mac). Then I immediately register an <a href="https://ruby-doc.org/core-2.2.3/Kernel.html#method-i-at_exit"><code>at_exit</code></a> Ruby hook, which will be executed if Ruby dies for any reason. I’m sure it’s obvious why I have to do that—in order to avoid garbage running in the background after Rake is finished or terminated.</p><p>Pay attention, I’m using <code>kill -TERM</code> instead of <code>kill -KILL</code>, in order to give Maven a chance to wrap everything up, terminate DynamoDB Local correctly, close its TCP port and exit.</p><h2 id="how-to-check-that-its-running">How to check that it’s running</h2><p>Next I’m checking the status of <code>sn-endpoints</code>, one of the tables in the DynamoDB Local. It has to be there if the server is up and running. It will be created by <code>jcabi-dynamodb-maven-plugin</code> according to <a href="https://github.com/yegor256/sixnines/blob/0.17/dynamodb-local/tables/sn-endpoints.json"><code>sn-endpoints.json</code></a>, its JSON configuration.</p><p>Most probably the table won’t be ready immediately though, since it takes time to bootstrap Maven, start the server, and create tables there. That’s why, if the exception is thrown, I catch it, wait for 5 seconds and try again. I keep trying many times, until the server is ready. Eventually it will be. It takes about 12-15 seconds on my MacBook, which means 2-3 attempts/exceptions.</p><h2 id="how-to-connect-to-dynamodb-local">How to connect to DynamoDB Local</h2><p>My classes need to know how to connect to the server during integration tests. In production they need to connect to AWS, in testing they have to know about the DynamoDB Local instance I just started. This is what I have in my class <a href="https://github.com/yegor256/sixnines/blob/0.17/objects/dynamo.rb"><code>Dynamo</code></a>, which is responsible for the very connection with DynamoDB. Its decision on where to connect is based on the environment variable <code>RACK_ENV</code>, which is set to <code>"test"</code> in <a href="https://github.com/yegor256/sixnines/blob/0.17/test/test__helper.rb#L25"><code>test__helper.rb</code></a>, which is included by <a href="https://github.com/yegor256/sixnines/blob/0.17/Rakefile#L39"><code>rake/testtask</code></a> in front of all other tests, thanks to the double underscore in its name.</p><p>If the environment variable is set to <code>"test"</code>, <code>Dynamo</code> takes the connectivity parameters from the YAML file <a href="https://github.com/yegor256/sixnines/blob/0.17/objects/dynamo.rb#L37"><code>dynamodb-local/target/dynamo.yml</code></a> created by <a href="https://github.com/yegor256/sixnines/blob/0.17/dynamodb-local/pom.xml#L79-L100"><code>maven-resources-plugin:copy-resources</code></a>. The TCP port of the DynamoDB Local database will be <a href="https://github.com/yegor256/sixnines/blob/0.17/dynamodb-local/config/dynamo.yml">there</a>, as well as the DynamoDB authentication key and secret.</p><h2 id="how-to-run-the-integration-tests">How to run the integration tests</h2><p>This is the easiest part. I just use my objects the way they are supposed to be used in production and they connect to DynamoDB Local instead of AWS.</p><p>I’m using Rack::Test in order to test the entire application, via a set of HTTP calls. For example, <a href="https://github.com/yegor256/sixnines/blob/0.17/test/test_sixnines.rb#L143-L147">here</a> I’m trying to render Jeff’s user account page. Its HTTP response code is supposed to be 200:</p><figure class="highlight"><pre><code class="language-java" data-lang="java"><span></span><span class="n">require</span> <span class="err">&#39;</span><span class="n">test</span><span class="o">/</span><span class="n">unit</span><span class="err">&#39;</span>
<span class="n">require</span> <span class="err">&#39;</span><span class="n">rack</span><span class="o">/</span><span class="n">test</span><span class="err">&#39;</span>
<span class="kd">class</span> <span class="nc">AppTest</span> <span class="o">&lt;</span> <span class="n">Test</span><span class="o">::</span><span class="n">Unit</span><span class="o">::</span><span class="n">TestCase</span>
  <span class="n">include</span> <span class="n">Rack</span><span class="o">::</span><span class="n">Test</span><span class="o">::</span><span class="n">Methods</span>
  <span class="n">def</span> <span class="n">app</span>
    <span class="n">Sinatra</span><span class="o">::</span><span class="n">Application</span>
  <span class="n">end</span>
  <span class="n">def</span> <span class="n">test_user_account</span>
    <span class="nf">header</span><span class="o">(</span><span class="err">&#39;</span><span class="n">Cookie</span><span class="err">&#39;</span><span class="o">,</span> <span class="err">&#39;</span><span class="n">sixnines</span><span class="o">=</span><span class="n">jeff</span><span class="err">&#39;</span><span class="o">)</span>
    <span class="n">get</span><span class="o">(</span><span class="err">&#39;</span><span class="o">/</span><span class="n">a</span><span class="err">&#39;</span><span class="o">)</span>
    <span class="n">assert_equal</span><span class="o">(</span><span class="mi">200</span><span class="o">,</span> <span class="n">last_response</span><span class="o">.</span><span class="na">status</span><span class="o">)</span>
  <span class="n">end</span></code></pre></figure><p>##</p><p>Now you can run the entire test from the command line. You can see how <a href="/2014/09/11/deployment-script-vs-rultor.html">Rultor</a> runs it while releasing a new version: <a href="http://www.rultor.com/t/11705-302080694">full log</a>. Also, see how it works <a href="https://travis-ci.org/yegor256/sixnines">in Travis</a>. In a nutshell:</p><ul> <li>You call <code>rake</code> in the command line and Rake starts;</li> <li>Rake attempts to run the <a href="https://github.com/yegor256/sixnines/blob/0.17/Rakefile#L32"><code>default</code></a> task, which depends on <a href="https://github.com/yegor256/sixnines/blob/0.17/Rakefile#L36"><code>test</code></a>;</li> <li>Rake attempts to run <code>test</code>, which depends on <a href="https://github.com/yegor256/sixnines/blob/0.17/Rakefile#L50"><code>dynamo</code></a>;</li> <li>Rake, inside <code>test</code> task, runs <code>mvn install</code> in the background with this <a href="https://github.com/yegor256/sixnines/blob/0.17/dynamodb-local/pom.xml"><code>pom.xml</code></a>;</li> <li>Maven <a href="https://github.com/yegor256/sixnines/blob/0.17/dynamodb-local/pom.xml#L38-L60">unpacks</a> DynamoDB Local installation package;</li> <li>Maven <a href="https://github.com/yegor256/sixnines/blob/0.17/dynamodb-local/pom.xml#L61-L78">reserves</a> a random TCP port and stores its value into <code>${dynamo.port}</code>;</li> <li>Maven <a href="https://github.com/yegor256/sixnines/blob/0.17/dynamodb-local/pom.xml#L79-L100">saves</a> <code>${dynamo.port}</code> and key/secret pair info;</li> <li>Maven <a href="https://github.com/yegor256/sixnines/blob/0.17/dynamodb-local/pom.xml#L101-L128">starts</a> DynamoDB Local, binding it to the reserved TCP port;</li> <li>Rake <a href="https://github.com/yegor256/sixnines/blob/0.17/Rakefile#L57-L65">waits</a> for DynamoDB Local availability on the reserved port;</li> <li>Rake <a href="https://github.com/yegor256/sixnines/blob/0.17/Rakefile#L38-L39">imports</a> all <a href="https://github.com/yegor256/sixnines/tree/0.17/test">test classes</a> starting from <a href="https://github.com/yegor256/sixnines/blob/0.17/test/test__helper.rb">test__helper.rb</a>;</li> <li>Environment variable <code>RACK_ENV</code> is <a href="https://github.com/yegor256/sixnines/blob/0.17/test/test__helper.rb#L25">set</a> to <code>"test"</code>;</li> <li>Rack::Test <a href="https://github.com/yegor256/sixnines/blob/0.17/test/test_sixnines.rb#L145">attempts</a> to dispatch a web page;</li> <li><a href="https://github.com/yegor256/sixnines/blob/0.17/objects/dynamo.rb"><code>Dynamo</code></a> <a href="https://github.com/yegor256/sixnines/blob/0.17/objects/dynamo.rb#L37-L39">loads</a> YAML config from <a href="https://github.com/yegor256/sixnines/blob/0.17/dynamodb-local/config/dynamo.yml"><code>dynamo.yml</code></a> and connects to DynamoDB Local;</li> <li>Rake stops;</li> <li>Ruby <a href="https://github.com/yegor256/sixnines/blob/0.17/Rakefile#L53-L56">terminates</a> Maven and it stops DynamoDB Local.</li></ul><p>That’s it.</p></p><nav class="buttons notranslate desktop-only"> <a href="http://www.facebook.com/sharer/sharer.php?u=https://www.yegor256.com/2017/06/13/dynamodb-rack-maven.html" title="Share on Facebook" class="button" rel="nofollow"> <span class="count count-facebook">0</span> <i class="icon icon-facebook notranslate" aria-hidden="true"></i> </a> <a href="https://twitter.com/share?url=https://www.yegor256.com/2017/06/13/dynamodb-rack-maven.html&amp;text=DynamoDB+%2B+Rake+%2B+Maven+%2B+Rack%3A%3ATest" title="Share on Twitter" class="button" rel="nofollow"> <span class="count count-twitter">0</span> <i class="icon icon-twitter notranslate" aria-hidden="true"></i> </a> <a href="https://plus.google.com/share?url=https://www.yegor256.com/2017/06/13/dynamodb-rack-maven.html" title="Share on Google+" class="button" rel="nofollow"> <span class="count count-googleplus">0</span> <i class="icon icon-googleplus notranslate" aria-hidden="true"></i> </a> <a href="https://www.linkedin.com/cws/share?url=https://www.yegor256.com/2017/06/13/dynamodb-rack-maven.html" title="Share on LinkedIn" class="button" rel="nofollow"> <span class="count count-linkedin">0</span> <i class="icon icon-linkedin notranslate" aria-hidden="true"></i> </a> <a href="http://reddit.com/submit?url=https://www.yegor256.com/2017/06/13/dynamodb-rack-maven.html%3F2017-24&amp;title=DynamoDB+%2B+Rake+%2B+Maven+%2B+Rack%3A%3ATest" title="Share on Reddit" class="button" rel="nofollow"> <span class="count count-reddit">0</span> <i class="icon icon-reddit notranslate" aria-hidden="true"></i> </a> <a href="http://news.ycombinator.com/submitlink?u=https://www.yegor256.com/2017/06/13/dynamodb-rack-maven.html%3F2017-24&amp;t=DynamoDB+%2B+Rake+%2B+Maven+%2B+Rack%3A%3ATest" title="Share on Hacker News" class="button" rel="nofollow"> <span class="count count-hackernews">0</span> <i class="icon icon-hackernews notranslate" aria-hidden="true"></i> </a> </nav> </header> <article class="main" itemprop="articleBody"><div ><p>In <a href="/2017/04/25/sixnines.html">SixNines.io</a>, one of my Ruby pet web apps, I’m using <a href="https://aws.amazon.com/dynamodb/">DynamoDB</a>, a NoSQL cloud database by <a href="https://aws.amazon.com/">AWS</a>. It works like a charm, but the problem is that it’s not so easy to create an integration test, to make sure my code works together with the “real” DynamoDB server and tables. Let me show you how it was solved. The code is open source and you can see it in the <a href="https://github.com/yegor256/sixnines">yegor256/sixnines</a> GitHub repo.</p><h2 id="how-to-bootstrap-dynamodb-local">How to bootstrap DynamoDB Local</h2><p>First, you need to use <a href="https://aws.amazon.com/blogs/aws/dynamodb-local-for-desktop-development/">DynamoDB Local</a>, a command line tool created by AWS exactly for the purposes of testing. You need to start it before your integration tests and stop it afterwards.</p><p>To make things simpler I suggest you use <a href="http://dynamodb.jcabi.com/"><code>jcabi-dynamodb-maven-plugin</code></a>, a <a href="https://maven.apache.org/">Maven</a> plugin that I <a href="/2014/05/01/dynamodb-local-maven-plugin.html">made</a> a few years ago. You will need to add <a href="https://github.com/yegor256/sixnines/blob/0.17/dynamodb-local/pom.xml"><code>pom.xml</code></a> to your repository and start/stop Maven from a <a href="https://github.com/yegor256/sixnines/blob/0.17/Rakefile"><code>Rakefile</code></a>, just like I’m doing <a href="https://github.com/yegor256/sixnines/blob/0.17/Rakefile#L50-L67">here</a>:</p><figure class="highlight"><pre><code class="language-ruby" data-lang="ruby"><span></span><span class="n">task</span> <span class="ss">:dynamo</span> <span class="k">do</span>
  <span class="no">FileUtils</span><span class="o">.</span><span class="n">rm_rf</span><span class="p">(</span><span class="s1">&#39;dynamodb-local/target&#39;</span><span class="p">)</span>
  <span class="n">pid</span> <span class="o">=</span> <span class="no">Process</span><span class="o">.</span><span class="n">spawn</span><span class="p">(</span><span class="s1">&#39;mvn&#39;</span><span class="p">,</span> <span class="s1">&#39;install&#39;</span><span class="p">,</span> <span class="ss">chdir</span><span class="p">:</span> <span class="s1">&#39;dynamodb-local&#39;</span><span class="p">)</span>
  <span class="nb">at_exit</span> <span class="k">do</span>
    <span class="sb">`kill -TERM </span><span class="si">#{</span><span class="n">pid</span><span class="si">}</span><span class="sb">`</span>
  <span class="k">end</span>
  <span class="k">begin</span>
    <span class="no">Dynamo</span><span class="o">.</span><span class="n">new</span><span class="o">.</span><span class="n">aws</span><span class="o">.</span><span class="n">describe_table</span><span class="p">(</span><span class="ss">table_name</span><span class="p">:</span> <span class="s1">&#39;sn-endpoints&#39;</span><span class="p">)</span>
  <span class="k">rescue</span> <span class="no">Exception</span> <span class="o">=&gt;</span> <span class="n">e</span>
    <span class="nb">sleep</span><span class="p">(</span><span class="mi">5</span><span class="p">)</span>
    <span class="k">retry</span>
  <span class="k">end</span>
<span class="k">end</span></code></pre></figure><p>First, I’m removing <code>dynamodb-local/target</code>, the directory where Maven keeps its temporary files, to make sure we always start from scratch.</p><p>Then, I’m starting <code>mvn install</code>, using <code>Process.spawn</code>, as a background process with <code>pid</code> as its process ID (this won’t work in Windows, only Linux/Mac). Then I immediately register an <a href="https://ruby-doc.org/core-2.2.3/Kernel.html#method-i-at_exit"><code>at_exit</code></a> Ruby hook, which will be executed if Ruby dies for any reason. I’m sure it’s obvious why I have to do that—in order to avoid garbage running in the background after Rake is finished or terminated.</p><p>Pay attention, I’m using <code>kill -TERM</code> instead of <code>kill -KILL</code>, in order to give Maven a chance to wrap everything up, terminate DynamoDB Local correctly, close its TCP port and exit.</p><h2 id="how-to-check-that-its-running">How to check that it’s running</h2><p>Next I’m checking the status of <code>sn-endpoints</code>, one of the tables in the DynamoDB Local. It has to be there if the server is up and running. It will be created by <code>jcabi-dynamodb-maven-plugin</code> according to <a href="https://github.com/yegor256/sixnines/blob/0.17/dynamodb-local/tables/sn-endpoints.json"><code>sn-endpoints.json</code></a>, its JSON configuration.</p><p>Most probably the table won’t be ready immediately though, since it takes time to bootstrap Maven, start the server, and create tables there. That’s why, if the exception is thrown, I catch it, wait for 5 seconds and try again. I keep trying many times, until the server is ready. Eventually it will be. It takes about 12-15 seconds on my MacBook, which means 2-3 attempts/exceptions.</p><h2 id="how-to-connect-to-dynamodb-local">How to connect to DynamoDB Local</h2><p>My classes need to know how to connect to the server during integration tests. In production they need to connect to AWS, in testing they have to know about the DynamoDB Local instance I just started. This is what I have in my class <a href="https://github.com/yegor256/sixnines/blob/0.17/objects/dynamo.rb"><code>Dynamo</code></a>, which is responsible for the very connection with DynamoDB. Its decision on where to connect is based on the environment variable <code>RACK_ENV</code>, which is set to <code>"test"</code> in <a href="https://github.com/yegor256/sixnines/blob/0.17/test/test__helper.rb#L25"><code>test__helper.rb</code></a>, which is included by <a href="https://github.com/yegor256/sixnines/blob/0.17/Rakefile#L39"><code>rake/testtask</code></a> in front of all other tests, thanks to the double underscore in its name.</p><p>If the environment variable is set to <code>"test"</code>, <code>Dynamo</code> takes the connectivity parameters from the YAML file <a href="https://github.com/yegor256/sixnines/blob/0.17/objects/dynamo.rb#L37"><code>dynamodb-local/target/dynamo.yml</code></a> created by <a href="https://github.com/yegor256/sixnines/blob/0.17/dynamodb-local/pom.xml#L79-L100"><code>maven-resources-plugin:copy-resources</code></a>. The TCP port of the DynamoDB Local database will be <a href="https://github.com/yegor256/sixnines/blob/0.17/dynamodb-local/config/dynamo.yml">there</a>, as well as the DynamoDB authentication key and secret.</p><h2 id="how-to-run-the-integration-tests">How to run the integration tests</h2><p>This is the easiest part. I just use my objects the way they are supposed to be used in production and they connect to DynamoDB Local instead of AWS.</p><p>I’m using Rack::Test in order to test the entire application, via a set of HTTP calls. For example, <a href="https://github.com/yegor256/sixnines/blob/0.17/test/test_sixnines.rb#L143-L147">here</a> I’m trying to render Jeff’s user account page. Its HTTP response code is supposed to be 200:</p><figure class="highlight"><pre><code class="language-java" data-lang="java"><span></span><span class="n">require</span> <span class="err">&#39;</span><span class="n">test</span><span class="o">/</span><span class="n">unit</span><span class="err">&#39;</span>
<span class="n">require</span> <span class="err">&#39;</span><span class="n">rack</span><span class="o">/</span><span class="n">test</span><span class="err">&#39;</span>
<span class="kd">class</span> <span class="nc">AppTest</span> <span class="o">&lt;</span> <span class="n">Test</span><span class="o">::</span><span class="n">Unit</span><span class="o">::</span><span class="n">TestCase</span>
  <span class="n">include</span> <span class="n">Rack</span><span class="o">::</span><span class="n">Test</span><span class="o">::</span><span class="n">Methods</span>
  <span class="n">def</span> <span class="n">app</span>
    <span class="n">Sinatra</span><span class="o">::</span><span class="n">Application</span>
  <span class="n">end</span>
  <span class="n">def</span> <span class="n">test_user_account</span>
    <span class="nf">header</span><span class="o">(</span><span class="err">&#39;</span><span class="n">Cookie</span><span class="err">&#39;</span><span class="o">,</span> <span class="err">&#39;</span><span class="n">sixnines</span><span class="o">=</span><span class="n">jeff</span><span class="err">&#39;</span><span class="o">)</span>
    <span class="n">get</span><span class="o">(</span><span class="err">&#39;</span><span class="o">/</span><span class="n">a</span><span class="err">&#39;</span><span class="o">)</span>
    <span class="n">assert_equal</span><span class="o">(</span><span class="mi">200</span><span class="o">,</span> <span class="n">last_response</span><span class="o">.</span><span class="na">status</span><span class="o">)</span>
  <span class="n">end</span></code></pre></figure><p>##</p><p>Now you can run the entire test from the command line. You can see how <a href="/2014/09/11/deployment-script-vs-rultor.html">Rultor</a> runs it while releasing a new version: <a href="http://www.rultor.com/t/11705-302080694">full log</a>. Also, see how it works <a href="https://travis-ci.org/yegor256/sixnines">in Travis</a>. In a nutshell:</p><ul> <li>You call <code>rake</code> in the command line and Rake starts;</li> <li>Rake attempts to run the <a href="https://github.com/yegor256/sixnines/blob/0.17/Rakefile#L32"><code>default</code></a> task, which depends on <a href="https://github.com/yegor256/sixnines/blob/0.17/Rakefile#L36"><code>test</code></a>;</li> <li>Rake attempts to run <code>test</code>, which depends on <a href="https://github.com/yegor256/sixnines/blob/0.17/Rakefile#L50"><code>dynamo</code></a>;</li> <li>Rake, inside <code>test</code> task, runs <code>mvn install</code> in the background with this <a href="https://github.com/yegor256/sixnines/blob/0.17/dynamodb-local/pom.xml"><code>pom.xml</code></a>;</li> <li>Maven <a href="https://github.com/yegor256/sixnines/blob/0.17/dynamodb-local/pom.xml#L38-L60">unpacks</a> DynamoDB Local installation package;</li> <li>Maven <a href="https://github.com/yegor256/sixnines/blob/0.17/dynamodb-local/pom.xml#L61-L78">reserves</a> a random TCP port and stores its value into <code>${dynamo.port}</code>;</li> <li>Maven <a href="https://github.com/yegor256/sixnines/blob/0.17/dynamodb-local/pom.xml#L79-L100">saves</a> <code>${dynamo.port}</code> and key/secret pair info;</li> <li>Maven <a href="https://github.com/yegor256/sixnines/blob/0.17/dynamodb-local/pom.xml#L101-L128">starts</a> DynamoDB Local, binding it to the reserved TCP port;</li> <li>Rake <a href="https://github.com/yegor256/sixnines/blob/0.17/Rakefile#L57-L65">waits</a> for DynamoDB Local availability on the reserved port;</li> <li>Rake <a href="https://github.com/yegor256/sixnines/blob/0.17/Rakefile#L38-L39">imports</a> all <a href="https://github.com/yegor256/sixnines/tree/0.17/test">test classes</a> starting from <a href="https://github.com/yegor256/sixnines/blob/0.17/test/test__helper.rb">test__helper.rb</a>;</li> <li>Environment variable <code>RACK_ENV</code> is <a href="https://github.com/yegor256/sixnines/blob/0.17/test/test__helper.rb#L25">set</a> to <code>"test"</code>;</li> <li>Rack::Test <a href="https://github.com/yegor256/sixnines/blob/0.17/test/test_sixnines.rb#L145">attempts</a> to dispatch a web page;</li> <li><a href="https://github.com/yegor256/sixnines/blob/0.17/objects/dynamo.rb"><code>Dynamo</code></a> <a href="https://github.com/yegor256/sixnines/blob/0.17/objects/dynamo.rb#L37-L39">loads</a> YAML config from <a href="https://github.com/yegor256/sixnines/blob/0.17/dynamodb-local/config/dynamo.yml"><code>dynamo.yml</code></a> and connects to DynamoDB Local;</li> <li>Rake stops;</li> <li>Ruby <a href="https://github.com/yegor256/sixnines/blob/0.17/Rakefile#L53-L56">terminates</a> Maven and it stops DynamoDB Local.</li></ul><p>That’s it.</p></div></article></div><div class="wrapper"> <related-posts /></div><div class="disqus" role="complementary"><p class="disqus_hint"> Please, use <a href="https://help.disqus.com/commenting/what-html-tags-are-allowed-within-comments">syntax highlighting</a> in your comments, to make them more readable.</p><div id="disqus_thread" class="disqus-thread"> <a>&nbsp;</a></div><script> var disqus_config = function () { this.page.url = document.location.href.split('?')[0].split('#')[0].replace('https://', 'http://'); this.page.identifier = this.page.url; }; (function() { var d = document, s = d.createElement('script'); s.src = '//yegor256.disqus.com/embed.js'; s.setAttribute('data-timestamp', +new Date()); (d.head || d.body).appendChild(s); })(); </script> <noscript><div><p class="red"> JavaScript is disabled in your browser, that's why you can't see comments under this post.</p></div></noscript></div><div class="wrapper"> <footer class="footer"><p> &copy; <span itemscope="" itemprop="copyrightHolder" itemtype="http://schema.org/Person"> <span itemprop="name">Yegor Bugayenko</span> </span> 2014&ndash;<span itemprop="copyrightYear">2018</span></p></footer></div></section><div class="wrapper unprintable" style="text-align:center;margin-top:2em;"> <a href="http://www.sixnines.io/h/3ba1652f"> <img src="//www.sixnines.io/b/3ba1652f?style=flat" alt="sixnines availability badge"/> </a></div><script src="//code.jquery.com/jquery-1.9.0.min.js"></script> <script src="/js/all.js?ddf57a1cee0"></script> <script>var disqus_shortname = 'yegor256';</script> <script id="dsq-count-scr" src="//yegor256.disqus.com/count.js" async="async"></script> <script> (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){ (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o), m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m) })(window,document,'script','//www.google-analytics.com/analytics.js','ga'); ga('create', 'UA-1963507-32', 'auto'); ga('send', 'pageview'); </script> <script> Cd=document;Cr="&"+Math.random();Cp="&s=1"; Cd.cookie="b=b";if(Cd.cookie)Cp+="&c=1"; Cp+="&t="+(new Date()).getTimezoneOffset(); if(self!=top)Cp+="&f=1"; </script> <script> if(navigator.javaEnabled())Cp+="&j=1"; </script> <script> if(typeof(screen)!='undefined')Cp+="&w="+screen.width+"&h="+ screen.height+"&d="+(screen.colorDepth?screen.colorDepth:screen.pixelDepth); </script> <script> Cd.write("<img src='//c.hit.ua/hit?i=95870&g=0&x=2"+Cp+Cr+ "&r="+escape(Cd.referrer)+"&u="+escape(window.location.href)+ "' border='0' wi"+"dth='1' he"+"ight='1'/>"); </script> <script type="application/ld+json"> { "@context": "http://schema.org", "@type": "Person", "name": "Yegor Bugayenko", "url": "https://www.yegor256.com", "sameAs": [ "https://www.facebook.com/yegor256", "https://instagram.com/yegor256", "https://www.linkedin.com/in/yegor256", "https://twitter.com/yegor256", "https://github.com/yegor256", "https://www.pinterest.com/yegor256/" ] } </script> </body> </html> <!DOCTYPE html> <html xmlns="http://www.w3.org/1999/xhtml" lang="en-US" xml:lang="en-US" itemscope="" itemtype="http://schema.org/WebSite"> <head> <meta charset="utf-8"/> <meta name="description" content="<p>When I release a new version of <a href="https://github.com/yegor256/jekyll-github-deploy">jgd</a>, a Ruby gem, to RubyGems.org, it takes 30 seconds of my time. Here is how I released a bug fix for version 1.5.1, in <a href="https://github.com/yegor256/jekyll-github-deploy/issues/6">GitHub issue #6</a>:</p><figure class="unprintable"><img src="https://www.yegor256.com/images/2014/08/github-ticket-6.jpg" itemprop="image" style="width:600px;max-width:100%;" alt="The figure" /></figure><p>As you see, I gave a command to <a href="http://www.rultor.com">Rultor</a>, and it released a new version to RubyGems. I didn’t do anything else.</p><p>Now let’s see how you can do the same. How you can configure your project so that the release of its new version to RubyGems.org takes just a few seconds of your time.</p><p>By the way, I assume that you’re hosting your project in GitHub. If not, this entire tutorial won’t work. If you are still not in GitHub, I would strongly recommend moving there.</p><h2 id="create-rubygems-account">Create RubyGems Account</h2><p>Create an account in <a href="http://www.rubygems.org">RubyGems.org</a>.</p><h2 id="create-rubygemsyml">Create <code>rubygems.yml</code></h2><p>Create a <code>rubygems.yml</code> file (you may already have it as <code>~/.gem/credentials</code>):</p><figure class="highlight"><pre><code class="language-text" data-lang="text"><span></span>:rubygems_api_key: d355d8940bb031bfe9acf03ed3da4c0d</code></pre></figure><p>You should get this API key from RubyGems. To find your API key, click on your user name when logged in to RubyGems.org and then click on “Edit Profile.”</p><h2 id="encrypt-rubygemsyml">Encrypt <code>rubygems.yml</code></h2><p>Now, encrypt <code>rubygems.yml</code> with a <a href="https://github.com/yegor256/rultor-remote">rultor remote</a>:</p><figure class="highlight"><pre><code class="language-xml" data-lang="xml"><span></span>$ gem install rultor
$ rultor encrypt -p me/test rubygems.yml</code></pre></figure><p>Instead of <code>me/test</code> use the name of your GitHub project.</p><p>You will get a new file <code>rubygems.yml.asc</code>. Add this file to the root directory of your project, commit and push. The file contains your secret information, but only the Rultor server can decrypt it.</p><h2 id="prepare-gemspec">Prepare Gemspec</h2><p>In your <code>gemspec</code> file, make sure you use <code>1.0.snapshot</code> as a version number:</p><figure class="highlight"><pre><code class="language-ruby" data-lang="ruby"><span></span><span class="c1"># coding: utf-8</span>
<span class="no">Gem</span><span class="o">::</span><span class="no">Specification</span><span class="o">.</span><span class="n">new</span> <span class="k">do</span> <span class="o">|</span><span class="n">s</span><span class="o">|</span>
  <span class="c1"># ...</span>
  <span class="n">s</span><span class="o">.</span><span class="n">version</span> <span class="o">=</span> <span class="s1">&#39;1.0.snapshot&#39;</span>
  <span class="c1"># ...</span>
<span class="k">end</span></code></pre></figure><p>This version name will be replaced by Rultor during deployment.</p><h2 id="configure-rultor">Configure Rultor</h2><p>Create a <code>.rultor.yml</code> file in the root directory of your project:</p><figure class="highlight"><pre><code class="language-text" data-lang="text"><span></span>decrypt:
  rubygems.yml: &quot;repo/rubygems.yml.asc&quot;
release:
  script: |
    rm -rf *.gem
    sed -i &quot;s/1.0.snapshot/${tag}/g&quot; foo.gemspec
    gem build foo.gemspec
    chmod 0600 /home/r/rubygems.yml
    gem push *.gem --config-file /home/r/rubygems.yml</code></pre></figure><p>In this example, replace <code>foo</code> with the name of your gem.</p><h2 id="run-it">Run It!</h2><figure class="badge"><a href="http://www.rultor.com"><img src="http://doc.rultor.com/images/logo.svg" style="width:100px;max-width:100%;" alt="badge" /></a></figure><p>Now it’s time to see how it all works. Create a new ticket in the GitHub issue tracker, and post something like that into it (read more about <a href="http://doc.rultor.com/basics.html">Rultor commands</a>):</p><figure class="highlight"><pre><code class="language-text" data-lang="text"><span></span>@rultor release, tag is `0.1`</code></pre></figure><p>You will get a response in a few seconds. The rest will be done by Rultor.</p><p>Enjoy :)</p><p>BTW, if something doesn’t work as I’ve explained, don’t hesitate to submit a ticket to <a href="https://github.com/yegor256/rultor/issues">Rultor issue tracker</a>. I will try to help you.</p>" /> <meta name="keywords" content="next, path, output, content, previous, url, relative_path, id, collection, excerpt, draft, categories, layout, title, date, tags, description, keywords, slug, ext" /> <meta name="viewport" content="width=device-width,minimum-scale=1,initial-scale=1"/> <meta name="google-site-verification" content="JEj_gQr2CPe2QKGw8XdMz0R7VboQIUbX3FlM-lwTq-8" /> <meta name="author" content="Yegor Bugayenko"> <meta name="article:published_time" content="2014-08-26 00:00:00 +0000"> <meta name="og:site_name" content="Yegor Bugayenko"/> <meta name="og:type" content="article" /> <meta name="og:locale" content="en_US" /> <meta name="twitter:account_id" content="4503599630178231" /> <meta name="twitter:creator" content="@yegor256"/> <meta name="twitter:site" content="@yegor256"/> <meta name="twitter:title" property="og:title" content="How to Publish to RubyGems, in One Click"/> <meta name="twitter:description" property="og:description" content="<p>When I release a new version of <a href="https://github.com/yegor256/jekyll-github-deploy">jgd</a>, a Ruby gem, to RubyGems.org, it takes 30 seconds of my time. Here is how I released a bug fix for version 1.5.1, in <a href="https://github.com/yegor256/jekyll-github-deploy/issues/6">GitHub issue #6</a>:</p><figure class="unprintable"><img src="https://www.yegor256.com/images/2014/08/github-ticket-6.jpg" itemprop="image" style="width:600px;max-width:100%;" alt="The figure" /></figure><p>As you see, I gave a command to <a href="http://www.rultor.com">Rultor</a>, and it released a new version to RubyGems. I didn’t do anything else.</p><p>Now let’s see how you can do the same. How you can configure your project so that the release of its new version to RubyGems.org takes just a few seconds of your time.</p><p>By the way, I assume that you’re hosting your project in GitHub. If not, this entire tutorial won’t work. If you are still not in GitHub, I would strongly recommend moving there.</p><h2 id="create-rubygems-account">Create RubyGems Account</h2><p>Create an account in <a href="http://www.rubygems.org">RubyGems.org</a>.</p><h2 id="create-rubygemsyml">Create <code>rubygems.yml</code></h2><p>Create a <code>rubygems.yml</code> file (you may already have it as <code>~/.gem/credentials</code>):</p><figure class="highlight"><pre><code class="language-text" data-lang="text"><span></span>:rubygems_api_key: d355d8940bb031bfe9acf03ed3da4c0d</code></pre></figure><p>You should get this API key from RubyGems. To find your API key, click on your user name when logged in to RubyGems.org and then click on “Edit Profile.”</p><h2 id="encrypt-rubygemsyml">Encrypt <code>rubygems.yml</code></h2><p>Now, encrypt <code>rubygems.yml</code> with a <a href="https://github.com/yegor256/rultor-remote">rultor remote</a>:</p><figure class="highlight"><pre><code class="language-xml" data-lang="xml"><span></span>$ gem install rultor
$ rultor encrypt -p me/test rubygems.yml</code></pre></figure><p>Instead of <code>me/test</code> use the name of your GitHub project.</p><p>You will get a new file <code>rubygems.yml.asc</code>. Add this file to the root directory of your project, commit and push. The file contains your secret information, but only the Rultor server can decrypt it.</p><h2 id="prepare-gemspec">Prepare Gemspec</h2><p>In your <code>gemspec</code> file, make sure you use <code>1.0.snapshot</code> as a version number:</p><figure class="highlight"><pre><code class="language-ruby" data-lang="ruby"><span></span><span class="c1"># coding: utf-8</span>
<span class="no">Gem</span><span class="o">::</span><span class="no">Specification</span><span class="o">.</span><span class="n">new</span> <span class="k">do</span> <span class="o">|</span><span class="n">s</span><span class="o">|</span>
  <span class="c1"># ...</span>
  <span class="n">s</span><span class="o">.</span><span class="n">version</span> <span class="o">=</span> <span class="s1">&#39;1.0.snapshot&#39;</span>
  <span class="c1"># ...</span>
<span class="k">end</span></code></pre></figure><p>This version name will be replaced by Rultor during deployment.</p><h2 id="configure-rultor">Configure Rultor</h2><p>Create a <code>.rultor.yml</code> file in the root directory of your project:</p><figure class="highlight"><pre><code class="language-text" data-lang="text"><span></span>decrypt:
  rubygems.yml: &quot;repo/rubygems.yml.asc&quot;
release:
  script: |
    rm -rf *.gem
    sed -i &quot;s/1.0.snapshot/${tag}/g&quot; foo.gemspec
    gem build foo.gemspec
    chmod 0600 /home/r/rubygems.yml
    gem push *.gem --config-file /home/r/rubygems.yml</code></pre></figure><p>In this example, replace <code>foo</code> with the name of your gem.</p><h2 id="run-it">Run It!</h2><figure class="badge"><a href="http://www.rultor.com"><img src="http://doc.rultor.com/images/logo.svg" style="width:100px;max-width:100%;" alt="badge" /></a></figure><p>Now it’s time to see how it all works. Create a new ticket in the GitHub issue tracker, and post something like that into it (read more about <a href="http://doc.rultor.com/basics.html">Rultor commands</a>):</p><figure class="highlight"><pre><code class="language-text" data-lang="text"><span></span>@rultor release, tag is `0.1`</code></pre></figure><p>You will get a response in a few seconds. The rest will be done by Rultor.</p><p>Enjoy :)</p><p>BTW, if something doesn’t work as I’ve explained, don’t hesitate to submit a ticket to <a href="https://github.com/yegor256/rultor/issues">Rultor issue tracker</a>. I will try to help you.</p>"/> <meta name="twitter:url" property="og:url" content="https://www.yegor256.com/2014/08/26/publish-to-rubygems.html"/> <meta name="telegram:channel" content="AAAAAEJFMRzsRTRxM3ec6A"/> <link rel="search" type="application/opensearchdescription+xml" href="/opensearch.xml" title="yegor256" /> <link rel="shortcut icon" href="/favicon.ico?ddf57a1cee0"/> <link rel="apple-touch-icon" href="/favicon.ico?ddf57a1cee0"/> <link rel="alternate" type="application/rss+xml" title="RSS for yegor256.com" href="https://www.yegor256.com/rss.xml"/> <link rel="stylesheet" href="/css/layout.css?ddf57a1cee0"/> <link rel="stylesheet" href="/css/icons.css?ddf57a1cee0"/> <link rel="canonical" href="https://www.yegor256.com/2014/08/26/publish-to-rubygems.html" /> <link rel="amphtml" href="https://www.yegor256.com/2014/08/26/publish-to-rubygems.amp.html" /> <title>How to Publish to RubyGems, in One Click </title> </head> <body><div class="wrapper"> <aside class="header-toggle unprintable" id="header-toggle" title="Show the menu" onclick="$('#header').show();$('#header-toggle').hide();">&#9776;</aside> <header class="header" id="header"><div class="face"> <a href="/about-me.html#form" class="sub" title="Click to subscribe to my monthly newsletter"><span>Subscribe</span></a> <a href="/about-me.html" style="position:relative;"> <img src="/images/face-256x256.jpg" class="photo" alt="Yegor Bugayenko"/> </a></div><nav><ul class="menu social notranslate"> <li><a href="https://twitter.com/intent/follow?screen_name=yegor256" rel="nofollow" title="Follow me on Twitter"><i class="icon icon-twitter notranslate" aria-hidden="true"></i></a></li> <li><a href="/rss.xml" rel="nofollow" title="Subscribe to my RSS feed"><i class="icon icon-rss notranslate" aria-hidden="true"></i></a></li> <li><a itemprop="sameAs" href="https://github.com/yegor256" rel="nofollow" title="My GitHub profile"><i class="icon icon-github notranslate" aria-hidden="true"></i></a></li> <li><a itemprop="sameAs" href="http://stackoverflow.com/users/187141/yegor256" rel="nofollow" title="My StackOverflow profile"><i class="icon icon-stackoverflow notranslate" aria-hidden="true"></i></a></li> <li><a itemprop="sameAs" href="https://www.facebook.com/yegor256" rel="nofollow" title="Follow me on Facebook"><i class="icon icon-facebook notranslate" aria-hidden="true"></i></a></li> <li><a itemprop="sameAs" href="https://instagram.com/yegor256" rel="nofollow" title="Follow me on Instagram"><i class="icon icon-instagram notranslate" aria-hidden="true"></i></a></li> <li><a itemprop="sameAs" href="https://www.linkedin.com/in/yegor256" rel="nofollow" title="My LinkedIn profile"><i class="icon icon-linkedin notranslate" aria-hidden="true"></i></a></li> <li><a itemprop="sameAs" href="https://www.youtube.com/c/yegor256?sub_confirmation=1" rel="nofollow" title="My Youtube video channel"><i class="icon icon-youtube notranslate" aria-hidden="true"></i></a></li> <li><a itemprop="sameAs" href="https://www.pinterest.com/yegor256/" rel="nofollow" title="My Pinterest boards"><i class="icon icon-pinterest notranslate" aria-hidden="true"></i></a></li> <li><a itemprop="sameAs" href="https://angel.co/yegor256" rel="nofollow" title="My AngelList profile"><i class="icon icon-angellist notranslate" aria-hidden="true"></i></a></li> <li><a href="https://soundcloud.com/yegor256" rel="nofollow" title="My podcast"><i class="icon icon-podcast notranslate" aria-hidden="true"></i></a></li> <li><a href="https://itunes.apple.com/us/podcast/yegor256-podcast/id1150826721" rel="nofollow" title="My iTunes podcast"><i class="icon icon-itunes notranslate" aria-hidden="true"></i></a></li> <li><a href="https://t.me/yegor256news" rel="nofollow" title="My Telegram public channel"><i class="icon icon-telegram notranslate" aria-hidden="true"></i></a></li> <li><a href="mailto:blog@yegor256.com" rel="nofollow" title="Email me any time"><i class="icon icon-mail notranslate" aria-hidden="true"></i></a></li></ul><ul class="menu"> <li><a href="/" title="Home page">Home</a></li> <li /2014/08/26/publish-to-rubygems.html><a href="/best.html" title="Best articles to read">12&#160;Best</a></li> <li /2014/08/26/publish-to-rubygems.html><a href="/contents.html" title="The contents of the entire blog">All&#160;292</a></li> <li /2014/08/26/publish-to-rubygems.html><a href="/webinars.html" title="My webinars">Webinars</a></li> <li /2014/08/26/publish-to-rubygems.html><a href="/talks.html" title="Future and past conference talks">Talks</a></li> <li /2014/08/26/publish-to-rubygems.html><a href="/books.html" title="The books I wrote">Books</a></li> <li /2014/08/26/publish-to-rubygems.html><a href="/papers.html" title="My academic papers and patents">Papers</a></li> <li /2014/08/26/publish-to-rubygems.html><a href="/pets.html" title="My loved pet projects">Pets</a></li> <li /2014/08/26/publish-to-rubygems.html class="highlighted"><a href="/trainings.html" title="On-site trainings">Trainings</a></li> <li /2014/08/26/publish-to-rubygems.html><a href="/award.html" title="Software quality award">Award</a></li> <li /2014/08/26/publish-to-rubygems.html><a href="/testimonials.html" title="What some people say about me">Testimonials</a></li> <li /2014/08/26/publish-to-rubygems.html><a href="/shift-m.html" title="Audio podcast about project management">Shift-M</a></li> <li /2014/08/26/publish-to-rubygems.html><a href="/paintings.html" title="My paintings for sale">Paintings</a></li> <li><a href="https://ru.yegor256.com/" title="Немного на русском языке">По-русски</a></li></ul></nav><div class="search"> <form method="get" action="https://www.google.com/search" itemprop="potentialAction" itemscope="" itemtype="http://schema.org/SearchAction"> <meta itemprop="target" content="https://www.google.com/search?q={q}"/> <input name="sitesearch" value="yegor256.com" type="hidden"/> <input itemprop="query-input" type="text" id="search-query" class="field field-text" required="required" onfocus="$('.google').css('visibility', 'visible');" name="q" placeholder="Search..." autocomplete="off"/> <input type="image" src="/images/google-search-icon.svg" class="google" title="Search via Google" alt="Search via Google"/> </form></div><div class="hot"><ul></ul></div></header></div><section itemscope="" itemtype="http://schema.org/BlogPosting"><div class="wrapper"> <header><p class="printable"> <img src="https://api.qrserver.com/v1/create-qr-code/?data=https://www.yegor256.com/2014/08/26/publish-to-rubygems.html&amp;format=svg" style="width:125px;height:125px;" alt="QR code"/></p><p class="printable"> <code itemprop="url">https://www.yegor256.com/2014/08/26/publish-to-rubygems.html</code></p><h1 itemprop="name headline mainEntityOfPage">How to Publish to RubyGems, in One Click</h1><ul class="subline"> <li> <time itemprop="datePublished" datetime="2014-08-26T00:00:00+00:00"> 26 August 2014 </time> </li> <li class="printable" itemscope="" itemprop="author" itemtype="http://schema.org/Person"> <span itemprop="name">Yegor Bugayenko</span> </li> <li class="unprintable"> <i class="icon icon-comments"></i> <a href="https://www.yegor256.com/2014/08/26/publish-to-rubygems.html#disqus_thread" itemprop="discussionUrl">comments</a> </li></ul><p class="unprintable"><p>When I release a new version of <a href="https://github.com/yegor256/jekyll-github-deploy">jgd</a>, a Ruby gem, to RubyGems.org, it takes 30 seconds of my time. Here is how I released a bug fix for version 1.5.1, in <a href="https://github.com/yegor256/jekyll-github-deploy/issues/6">GitHub issue #6</a>:</p><figure class="unprintable"><img src="https://www.yegor256.com/images/2014/08/github-ticket-6.jpg" itemprop="image" style="width:600px;max-width:100%;" alt="The figure" /></figure><p>As you see, I gave a command to <a href="http://www.rultor.com">Rultor</a>, and it released a new version to RubyGems. I didn’t do anything else.</p><p>Now let’s see how you can do the same. How you can configure your project so that the release of its new version to RubyGems.org takes just a few seconds of your time.</p><p>By the way, I assume that you’re hosting your project in GitHub. If not, this entire tutorial won’t work. If you are still not in GitHub, I would strongly recommend moving there.</p><h2 id="create-rubygems-account">Create RubyGems Account</h2><p>Create an account in <a href="http://www.rubygems.org">RubyGems.org</a>.</p><h2 id="create-rubygemsyml">Create <code>rubygems.yml</code></h2><p>Create a <code>rubygems.yml</code> file (you may already have it as <code>~/.gem/credentials</code>):</p><figure class="highlight"><pre><code class="language-text" data-lang="text"><span></span>:rubygems_api_key: d355d8940bb031bfe9acf03ed3da4c0d</code></pre></figure><p>You should get this API key from RubyGems. To find your API key, click on your user name when logged in to RubyGems.org and then click on “Edit Profile.”</p><h2 id="encrypt-rubygemsyml">Encrypt <code>rubygems.yml</code></h2><p>Now, encrypt <code>rubygems.yml</code> with a <a href="https://github.com/yegor256/rultor-remote">rultor remote</a>:</p><figure class="highlight"><pre><code class="language-xml" data-lang="xml"><span></span>$ gem install rultor
$ rultor encrypt -p me/test rubygems.yml</code></pre></figure><p>Instead of <code>me/test</code> use the name of your GitHub project.</p><p>You will get a new file <code>rubygems.yml.asc</code>. Add this file to the root directory of your project, commit and push. The file contains your secret information, but only the Rultor server can decrypt it.</p><h2 id="prepare-gemspec">Prepare Gemspec</h2><p>In your <code>gemspec</code> file, make sure you use <code>1.0.snapshot</code> as a version number:</p><figure class="highlight"><pre><code class="language-ruby" data-lang="ruby"><span></span><span class="c1"># coding: utf-8</span>
<span class="no">Gem</span><span class="o">::</span><span class="no">Specification</span><span class="o">.</span><span class="n">new</span> <span class="k">do</span> <span class="o">|</span><span class="n">s</span><span class="o">|</span>
  <span class="c1"># ...</span>
  <span class="n">s</span><span class="o">.</span><span class="n">version</span> <span class="o">=</span> <span class="s1">&#39;1.0.snapshot&#39;</span>
  <span class="c1"># ...</span>
<span class="k">end</span></code></pre></figure><p>This version name will be replaced by Rultor during deployment.</p><h2 id="configure-rultor">Configure Rultor</h2><p>Create a <code>.rultor.yml</code> file in the root directory of your project:</p><figure class="highlight"><pre><code class="language-text" data-lang="text"><span></span>decrypt:
  rubygems.yml: &quot;repo/rubygems.yml.asc&quot;
release:
  script: |
    rm -rf *.gem
    sed -i &quot;s/1.0.snapshot/${tag}/g&quot; foo.gemspec
    gem build foo.gemspec
    chmod 0600 /home/r/rubygems.yml
    gem push *.gem --config-file /home/r/rubygems.yml</code></pre></figure><p>In this example, replace <code>foo</code> with the name of your gem.</p><h2 id="run-it">Run It!</h2><figure class="badge"><a href="http://www.rultor.com"><img src="http://doc.rultor.com/images/logo.svg" style="width:100px;max-width:100%;" alt="badge" /></a></figure><p>Now it’s time to see how it all works. Create a new ticket in the GitHub issue tracker, and post something like that into it (read more about <a href="http://doc.rultor.com/basics.html">Rultor commands</a>):</p><figure class="highlight"><pre><code class="language-text" data-lang="text"><span></span>@rultor release, tag is `0.1`</code></pre></figure><p>You will get a response in a few seconds. The rest will be done by Rultor.</p><p>Enjoy :)</p><p>BTW, if something doesn’t work as I’ve explained, don’t hesitate to submit a ticket to <a href="https://github.com/yegor256/rultor/issues">Rultor issue tracker</a>. I will try to help you.</p></p><nav class="buttons notranslate desktop-only"> <a href="http://www.facebook.com/sharer/sharer.php?u=https://www.yegor256.com/2014/08/26/publish-to-rubygems.html" title="Share on Facebook" class="button" rel="nofollow"> <span class="count count-facebook">0</span> <i class="icon icon-facebook notranslate" aria-hidden="true"></i> </a> <a href="https://twitter.com/share?url=https://www.yegor256.com/2014/08/26/publish-to-rubygems.html&amp;text=How+to+Publish+to+RubyGems%2C+in+One+Click" title="Share on Twitter" class="button" rel="nofollow"> <span class="count count-twitter">0</span> <i class="icon icon-twitter notranslate" aria-hidden="true"></i> </a> <a href="https://plus.google.com/share?url=https://www.yegor256.com/2014/08/26/publish-to-rubygems.html" title="Share on Google+" class="button" rel="nofollow"> <span class="count count-googleplus">0</span> <i class="icon icon-googleplus notranslate" aria-hidden="true"></i> </a> <a href="https://www.linkedin.com/cws/share?url=https://www.yegor256.com/2014/08/26/publish-to-rubygems.html" title="Share on LinkedIn" class="button" rel="nofollow"> <span class="count count-linkedin">0</span> <i class="icon icon-linkedin notranslate" aria-hidden="true"></i> </a> <a href="http://reddit.com/submit?url=https://www.yegor256.com/2014/08/26/publish-to-rubygems.html%3F2014-34&amp;title=How+to+Publish+to+RubyGems%2C+in+One+Click" title="Share on Reddit" class="button" rel="nofollow"> <span class="count count-reddit">0</span> <i class="icon icon-reddit notranslate" aria-hidden="true"></i> </a> <a href="http://news.ycombinator.com/submitlink?u=https://www.yegor256.com/2014/08/26/publish-to-rubygems.html%3F2014-34&amp;t=How+to+Publish+to+RubyGems%2C+in+One+Click" title="Share on Hacker News" class="button" rel="nofollow"> <span class="count count-hackernews">0</span> <i class="icon icon-hackernews notranslate" aria-hidden="true"></i> </a> </nav> </header> <article class="main" itemprop="articleBody"><div ><p>When I release a new version of <a href="https://github.com/yegor256/jekyll-github-deploy">jgd</a>, a Ruby gem, to RubyGems.org, it takes 30 seconds of my time. Here is how I released a bug fix for version 1.5.1, in <a href="https://github.com/yegor256/jekyll-github-deploy/issues/6">GitHub issue #6</a>:</p><figure class="unprintable"><img src="https://www.yegor256.com/images/2014/08/github-ticket-6.jpg" itemprop="image" style="width:600px;max-width:100%;" alt="The figure" /></figure><p>As you see, I gave a command to <a href="http://www.rultor.com">Rultor</a>, and it released a new version to RubyGems. I didn’t do anything else.</p><p>Now let’s see how you can do the same. How you can configure your project so that the release of its new version to RubyGems.org takes just a few seconds of your time.</p><p>By the way, I assume that you’re hosting your project in GitHub. If not, this entire tutorial won’t work. If you are still not in GitHub, I would strongly recommend moving there.</p><h2 id="create-rubygems-account">Create RubyGems Account</h2><p>Create an account in <a href="http://www.rubygems.org">RubyGems.org</a>.</p><h2 id="create-rubygemsyml">Create <code>rubygems.yml</code></h2><p>Create a <code>rubygems.yml</code> file (you may already have it as <code>~/.gem/credentials</code>):</p><figure class="highlight"><pre><code class="language-text" data-lang="text"><span></span>:rubygems_api_key: d355d8940bb031bfe9acf03ed3da4c0d</code></pre></figure><p>You should get this API key from RubyGems. To find your API key, click on your user name when logged in to RubyGems.org and then click on “Edit Profile.”</p><h2 id="encrypt-rubygemsyml">Encrypt <code>rubygems.yml</code></h2><p>Now, encrypt <code>rubygems.yml</code> with a <a href="https://github.com/yegor256/rultor-remote">rultor remote</a>:</p><figure class="highlight"><pre><code class="language-xml" data-lang="xml"><span></span>$ gem install rultor
$ rultor encrypt -p me/test rubygems.yml</code></pre></figure><p>Instead of <code>me/test</code> use the name of your GitHub project.</p><p>You will get a new file <code>rubygems.yml.asc</code>. Add this file to the root directory of your project, commit and push. The file contains your secret information, but only the Rultor server can decrypt it.</p><h2 id="prepare-gemspec">Prepare Gemspec</h2><p>In your <code>gemspec</code> file, make sure you use <code>1.0.snapshot</code> as a version number:</p><figure class="highlight"><pre><code class="language-ruby" data-lang="ruby"><span></span><span class="c1"># coding: utf-8</span>
<span class="no">Gem</span><span class="o">::</span><span class="no">Specification</span><span class="o">.</span><span class="n">new</span> <span class="k">do</span> <span class="o">|</span><span class="n">s</span><span class="o">|</span>
  <span class="c1"># ...</span>
  <span class="n">s</span><span class="o">.</span><span class="n">version</span> <span class="o">=</span> <span class="s1">&#39;1.0.snapshot&#39;</span>
  <span class="c1"># ...</span>
<span class="k">end</span></code></pre></figure><p>This version name will be replaced by Rultor during deployment.</p><h2 id="configure-rultor">Configure Rultor</h2><p>Create a <code>.rultor.yml</code> file in the root directory of your project:</p><figure class="highlight"><pre><code class="language-text" data-lang="text"><span></span>decrypt:
  rubygems.yml: &quot;repo/rubygems.yml.asc&quot;
release:
  script: |
    rm -rf *.gem
    sed -i &quot;s/1.0.snapshot/${tag}/g&quot; foo.gemspec
    gem build foo.gemspec
    chmod 0600 /home/r/rubygems.yml
    gem push *.gem --config-file /home/r/rubygems.yml</code></pre></figure><p>In this example, replace <code>foo</code> with the name of your gem.</p><h2 id="run-it">Run It!</h2><figure class="badge"><a href="http://www.rultor.com"><img src="http://doc.rultor.com/images/logo.svg" style="width:100px;max-width:100%;" alt="badge" /></a></figure><p>Now it’s time to see how it all works. Create a new ticket in the GitHub issue tracker, and post something like that into it (read more about <a href="http://doc.rultor.com/basics.html">Rultor commands</a>):</p><figure class="highlight"><pre><code class="language-text" data-lang="text"><span></span>@rultor release, tag is `0.1`</code></pre></figure><p>You will get a response in a few seconds. The rest will be done by Rultor.</p><p>Enjoy :)</p><p>BTW, if something doesn’t work as I’ve explained, don’t hesitate to submit a ticket to <a href="https://github.com/yegor256/rultor/issues">Rultor issue tracker</a>. I will try to help you.</p></div></article></div><div class="wrapper"> <related-posts /></div><div class="disqus" role="complementary"><p class="disqus_hint"> Please, use <a href="https://help.disqus.com/commenting/what-html-tags-are-allowed-within-comments">syntax highlighting</a> in your comments, to make them more readable.</p><div id="disqus_thread" class="disqus-thread"> <a>&nbsp;</a></div><script> var disqus_config = function () { this.page.url = document.location.href.split('?')[0].split('#')[0].replace('https://', 'http://'); this.page.identifier = this.page.url; }; (function() { var d = document, s = d.createElement('script'); s.src = '//yegor256.disqus.com/embed.js'; s.setAttribute('data-timestamp', +new Date()); (d.head || d.body).appendChild(s); })(); </script> <noscript><div><p class="red"> JavaScript is disabled in your browser, that's why you can't see comments under this post.</p></div></noscript></div><div class="wrapper"> <footer class="footer"><p> &copy; <span itemscope="" itemprop="copyrightHolder" itemtype="http://schema.org/Person"> <span itemprop="name">Yegor Bugayenko</span> </span> 2014&ndash;<span itemprop="copyrightYear">2018</span></p></footer></div></section><div class="wrapper unprintable" style="text-align:center;margin-top:2em;"> <a href="http://www.sixnines.io/h/3ba1652f"> <img src="//www.sixnines.io/b/3ba1652f?style=flat" alt="sixnines availability badge"/> </a></div><script src="//code.jquery.com/jquery-1.9.0.min.js"></script> <script src="/js/all.js?ddf57a1cee0"></script> <script>var disqus_shortname = 'yegor256';</script> <script id="dsq-count-scr" src="//yegor256.disqus.com/count.js" async="async"></script> <script> (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){ (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o), m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m) })(window,document,'script','//www.google-analytics.com/analytics.js','ga'); ga('create', 'UA-1963507-32', 'auto'); ga('send', 'pageview'); </script> <script> Cd=document;Cr="&"+Math.random();Cp="&s=1"; Cd.cookie="b=b";if(Cd.cookie)Cp+="&c=1"; Cp+="&t="+(new Date()).getTimezoneOffset(); if(self!=top)Cp+="&f=1"; </script> <script> if(navigator.javaEnabled())Cp+="&j=1"; </script> <script> if(typeof(screen)!='undefined')Cp+="&w="+screen.width+"&h="+ screen.height+"&d="+(screen.colorDepth?screen.colorDepth:screen.pixelDepth); </script> <script> Cd.write("<img src='//c.hit.ua/hit?i=95870&g=0&x=2"+Cp+Cr+ "&r="+escape(Cd.referrer)+"&u="+escape(window.location.href)+ "' border='0' wi"+"dth='1' he"+"ight='1'/>"); </script> <script type="application/ld+json"> { "@context": "http://schema.org", "@type": "Person", "name": "Yegor Bugayenko", "url": "https://www.yegor256.com", "sameAs": [ "https://www.facebook.com/yegor256", "https://instagram.com/yegor256", "https://www.linkedin.com/in/yegor256", "https://twitter.com/yegor256", "https://github.com/yegor256", "https://www.pinterest.com/yegor256/" ] } </script> </body> </html> <!DOCTYPE html> <html xmlns="http://www.w3.org/1999/xhtml" lang="en-US" xml:lang="en-US" itemscope="" itemtype="http://schema.org/WebSite"> <head> <meta charset="utf-8"/> <meta name="description" content="<p>This blog is written in <a href="http://jekyllrb.com/">Jekyll</a> and is hosted at <a href="https://pages.github.com/">GitHub Pages</a>. It uses half a dozen custom plugins, which <a href="https://help.github.com/articles/using-jekyll-plugins-with-github-pages">are not allowed there</a>.</p><p>Here is how I deploy it:</p><figure class="highlight"><pre><code class="language-bash" data-lang="bash"><span></span>$ jgd</code></pre></figure><p>That’s it. <a href="http://rubygems.org/gems/jgd">jgd</a> is my Ruby gem (stands for “Jekyll GitHub Deploy”), which does the trick. Here is <a href="https://github.com/yegor256/jekyll-github-deploy/blob/master/bash/deploy.sh">what it does</a>:</p><ol> <li><p>It clones your existing repository from the current directory to a temporary one (guessing the URL of the repo from <code>.git/config</code> file).</p></li> <li><p>Runs <code>jekyll build</code> in that temporary directory, which saves the output in another temporary directory.</p></li> <li><p>Checks out <code>gh-pages</code> branch or creates one if it doesn’t exist.</p></li> <li><p>Copies the content of the site built by <code>jekyll build</code> into the branch, thus overwriting existing files, commits and pushes to GitHub.</p></li> <li><p>Cleans up all temporary directories.</p></li> </ol><p>Using this gem is very easy. Just install it with <code>gem install jgd</code> and then run in the root directory of your Jekyll blog.</p><p>What is important is that your Jekyll site files be located in the root directory of the repository. Just as they do on <a href="/2014/04/06/introduction.html">this blog</a>; see <a href="https://github.com/yegor256/blog">its sources in GitHub</a>.</p><p>You can easily integrate <code>jgd</code> with Travis. See <a href="https://github.com/yegor256/blog/blob/master/.travis.yml"><code>.travis.yml</code></a> of this blog.</p><p>Full documentation about the gem is located <a href="https://github.com/yegor256/jekyll-github-deploy">here</a>.</p>" /> <meta name="keywords" content="next, path, output, content, previous, url, relative_path, id, collection, excerpt, draft, categories, layout, title, date, tags, description, keywords, slug, ext" /> <meta name="viewport" content="width=device-width,minimum-scale=1,initial-scale=1"/> <meta name="google-site-verification" content="JEj_gQr2CPe2QKGw8XdMz0R7VboQIUbX3FlM-lwTq-8" /> <meta name="author" content="Yegor Bugayenko"> <meta name="article:published_time" content="2014-06-24 00:00:00 +0000"> <meta name="og:site_name" content="Yegor Bugayenko"/> <meta name="og:type" content="article" /> <meta name="og:locale" content="en_US" /> <meta name="twitter:account_id" content="4503599630178231" /> <meta name="twitter:creator" content="@yegor256"/> <meta name="twitter:site" content="@yegor256"/> <meta name="twitter:title" property="og:title" content="Deploy Jekyll to GitHub Pages"/> <meta name="twitter:description" property="og:description" content="<p>This blog is written in <a href="http://jekyllrb.com/">Jekyll</a> and is hosted at <a href="https://pages.github.com/">GitHub Pages</a>. It uses half a dozen custom plugins, which <a href="https://help.github.com/articles/using-jekyll-plugins-with-github-pages">are not allowed there</a>.</p><p>Here is how I deploy it:</p><figure class="highlight"><pre><code class="language-bash" data-lang="bash"><span></span>$ jgd</code></pre></figure><p>That’s it. <a href="http://rubygems.org/gems/jgd">jgd</a> is my Ruby gem (stands for “Jekyll GitHub Deploy”), which does the trick. Here is <a href="https://github.com/yegor256/jekyll-github-deploy/blob/master/bash/deploy.sh">what it does</a>:</p><ol> <li><p>It clones your existing repository from the current directory to a temporary one (guessing the URL of the repo from <code>.git/config</code> file).</p></li> <li><p>Runs <code>jekyll build</code> in that temporary directory, which saves the output in another temporary directory.</p></li> <li><p>Checks out <code>gh-pages</code> branch or creates one if it doesn’t exist.</p></li> <li><p>Copies the content of the site built by <code>jekyll build</code> into the branch, thus overwriting existing files, commits and pushes to GitHub.</p></li> <li><p>Cleans up all temporary directories.</p></li> </ol><p>Using this gem is very easy. Just install it with <code>gem install jgd</code> and then run in the root directory of your Jekyll blog.</p><p>What is important is that your Jekyll site files be located in the root directory of the repository. Just as they do on <a href="/2014/04/06/introduction.html">this blog</a>; see <a href="https://github.com/yegor256/blog">its sources in GitHub</a>.</p><p>You can easily integrate <code>jgd</code> with Travis. See <a href="https://github.com/yegor256/blog/blob/master/.travis.yml"><code>.travis.yml</code></a> of this blog.</p><p>Full documentation about the gem is located <a href="https://github.com/yegor256/jekyll-github-deploy">here</a>.</p>"/> <meta name="twitter:url" property="og:url" content="https://www.yegor256.com/2014/06/24/jekyll-github-deploy.html"/> <meta name="telegram:channel" content="AAAAAEJFMRzsRTRxM3ec6A"/> <link rel="search" type="application/opensearchdescription+xml" href="/opensearch.xml" title="yegor256" /> <link rel="shortcut icon" href="/favicon.ico?ddf57a1cee0"/> <link rel="apple-touch-icon" href="/favicon.ico?ddf57a1cee0"/> <link rel="alternate" type="application/rss+xml" title="RSS for yegor256.com" href="https://www.yegor256.com/rss.xml"/> <link rel="stylesheet" href="/css/layout.css?ddf57a1cee0"/> <link rel="stylesheet" href="/css/icons.css?ddf57a1cee0"/> <link rel="canonical" href="https://www.yegor256.com/2014/06/24/jekyll-github-deploy.html" /> <link rel="amphtml" href="https://www.yegor256.com/2014/06/24/jekyll-github-deploy.amp.html" /> <title>Deploy Jekyll to GitHub Pages </title> </head> <body><div class="wrapper"> <aside class="header-toggle unprintable" id="header-toggle" title="Show the menu" onclick="$('#header').show();$('#header-toggle').hide();">&#9776;</aside> <header class="header" id="header"><div class="face"> <a href="/about-me.html#form" class="sub" title="Click to subscribe to my monthly newsletter"><span>Subscribe</span></a> <a href="/about-me.html" style="position:relative;"> <img src="/images/face-256x256.jpg" class="photo" alt="Yegor Bugayenko"/> </a></div><nav><ul class="menu social notranslate"> <li><a href="https://twitter.com/intent/follow?screen_name=yegor256" rel="nofollow" title="Follow me on Twitter"><i class="icon icon-twitter notranslate" aria-hidden="true"></i></a></li> <li><a href="/rss.xml" rel="nofollow" title="Subscribe to my RSS feed"><i class="icon icon-rss notranslate" aria-hidden="true"></i></a></li> <li><a itemprop="sameAs" href="https://github.com/yegor256" rel="nofollow" title="My GitHub profile"><i class="icon icon-github notranslate" aria-hidden="true"></i></a></li> <li><a itemprop="sameAs" href="http://stackoverflow.com/users/187141/yegor256" rel="nofollow" title="My StackOverflow profile"><i class="icon icon-stackoverflow notranslate" aria-hidden="true"></i></a></li> <li><a itemprop="sameAs" href="https://www.facebook.com/yegor256" rel="nofollow" title="Follow me on Facebook"><i class="icon icon-facebook notranslate" aria-hidden="true"></i></a></li> <li><a itemprop="sameAs" href="https://instagram.com/yegor256" rel="nofollow" title="Follow me on Instagram"><i class="icon icon-instagram notranslate" aria-hidden="true"></i></a></li> <li><a itemprop="sameAs" href="https://www.linkedin.com/in/yegor256" rel="nofollow" title="My LinkedIn profile"><i class="icon icon-linkedin notranslate" aria-hidden="true"></i></a></li> <li><a itemprop="sameAs" href="https://www.youtube.com/c/yegor256?sub_confirmation=1" rel="nofollow" title="My Youtube video channel"><i class="icon icon-youtube notranslate" aria-hidden="true"></i></a></li> <li><a itemprop="sameAs" href="https://www.pinterest.com/yegor256/" rel="nofollow" title="My Pinterest boards"><i class="icon icon-pinterest notranslate" aria-hidden="true"></i></a></li> <li><a itemprop="sameAs" href="https://angel.co/yegor256" rel="nofollow" title="My AngelList profile"><i class="icon icon-angellist notranslate" aria-hidden="true"></i></a></li> <li><a href="https://soundcloud.com/yegor256" rel="nofollow" title="My podcast"><i class="icon icon-podcast notranslate" aria-hidden="true"></i></a></li> <li><a href="https://itunes.apple.com/us/podcast/yegor256-podcast/id1150826721" rel="nofollow" title="My iTunes podcast"><i class="icon icon-itunes notranslate" aria-hidden="true"></i></a></li> <li><a href="https://t.me/yegor256news" rel="nofollow" title="My Telegram public channel"><i class="icon icon-telegram notranslate" aria-hidden="true"></i></a></li> <li><a href="mailto:blog@yegor256.com" rel="nofollow" title="Email me any time"><i class="icon icon-mail notranslate" aria-hidden="true"></i></a></li></ul><ul class="menu"> <li><a href="/" title="Home page">Home</a></li> <li /2014/06/24/jekyll-github-deploy.html><a href="/best.html" title="Best articles to read">12&#160;Best</a></li> <li /2014/06/24/jekyll-github-deploy.html><a href="/contents.html" title="The contents of the entire blog">All&#160;292</a></li> <li /2014/06/24/jekyll-github-deploy.html><a href="/webinars.html" title="My webinars">Webinars</a></li> <li /2014/06/24/jekyll-github-deploy.html><a href="/talks.html" title="Future and past conference talks">Talks</a></li> <li /2014/06/24/jekyll-github-deploy.html><a href="/books.html" title="The books I wrote">Books</a></li> <li /2014/06/24/jekyll-github-deploy.html><a href="/papers.html" title="My academic papers and patents">Papers</a></li> <li /2014/06/24/jekyll-github-deploy.html><a href="/pets.html" title="My loved pet projects">Pets</a></li> <li /2014/06/24/jekyll-github-deploy.html class="highlighted"><a href="/trainings.html" title="On-site trainings">Trainings</a></li> <li /2014/06/24/jekyll-github-deploy.html><a href="/award.html" title="Software quality award">Award</a></li> <li /2014/06/24/jekyll-github-deploy.html><a href="/testimonials.html" title="What some people say about me">Testimonials</a></li> <li /2014/06/24/jekyll-github-deploy.html><a href="/shift-m.html" title="Audio podcast about project management">Shift-M</a></li> <li /2014/06/24/jekyll-github-deploy.html><a href="/paintings.html" title="My paintings for sale">Paintings</a></li> <li><a href="https://ru.yegor256.com/" title="Немного на русском языке">По-русски</a></li></ul></nav><div class="search"> <form method="get" action="https://www.google.com/search" itemprop="potentialAction" itemscope="" itemtype="http://schema.org/SearchAction"> <meta itemprop="target" content="https://www.google.com/search?q={q}"/> <input name="sitesearch" value="yegor256.com" type="hidden"/> <input itemprop="query-input" type="text" id="search-query" class="field field-text" required="required" onfocus="$('.google').css('visibility', 'visible');" name="q" placeholder="Search..." autocomplete="off"/> <input type="image" src="/images/google-search-icon.svg" class="google" title="Search via Google" alt="Search via Google"/> </form></div><div class="hot"><ul></ul></div></header></div><section itemscope="" itemtype="http://schema.org/BlogPosting"><div class="wrapper"> <header><p class="printable"> <img src="https://api.qrserver.com/v1/create-qr-code/?data=https://www.yegor256.com/2014/06/24/jekyll-github-deploy.html&amp;format=svg" style="width:125px;height:125px;" alt="QR code"/></p><p class="printable"> <code itemprop="url">https://www.yegor256.com/2014/06/24/jekyll-github-deploy.html</code></p><h1 itemprop="name headline mainEntityOfPage">Deploy Jekyll to GitHub Pages</h1><ul class="subline"> <li> <time itemprop="datePublished" datetime="2014-06-24T00:00:00+00:00"> 24 June 2014 </time> </li> <li class="printable" itemscope="" itemprop="author" itemtype="http://schema.org/Person"> <span itemprop="name">Yegor Bugayenko</span> </li> <li class="unprintable"> <i class="icon icon-comments"></i> <a href="https://www.yegor256.com/2014/06/24/jekyll-github-deploy.html#disqus_thread" itemprop="discussionUrl">comments</a> </li></ul><p class="unprintable"><p>This blog is written in <a href="http://jekyllrb.com/">Jekyll</a> and is hosted at <a href="https://pages.github.com/">GitHub Pages</a>. It uses half a dozen custom plugins, which <a href="https://help.github.com/articles/using-jekyll-plugins-with-github-pages">are not allowed there</a>.</p><p>Here is how I deploy it:</p><figure class="highlight"><pre><code class="language-bash" data-lang="bash"><span></span>$ jgd</code></pre></figure><p>That’s it. <a href="http://rubygems.org/gems/jgd">jgd</a> is my Ruby gem (stands for “Jekyll GitHub Deploy”), which does the trick. Here is <a href="https://github.com/yegor256/jekyll-github-deploy/blob/master/bash/deploy.sh">what it does</a>:</p><ol> <li><p>It clones your existing repository from the current directory to a temporary one (guessing the URL of the repo from <code>.git/config</code> file).</p></li> <li><p>Runs <code>jekyll build</code> in that temporary directory, which saves the output in another temporary directory.</p></li> <li><p>Checks out <code>gh-pages</code> branch or creates one if it doesn’t exist.</p></li> <li><p>Copies the content of the site built by <code>jekyll build</code> into the branch, thus overwriting existing files, commits and pushes to GitHub.</p></li> <li><p>Cleans up all temporary directories.</p></li> </ol><p>Using this gem is very easy. Just install it with <code>gem install jgd</code> and then run in the root directory of your Jekyll blog.</p><p>What is important is that your Jekyll site files be located in the root directory of the repository. Just as they do on <a href="/2014/04/06/introduction.html">this blog</a>; see <a href="https://github.com/yegor256/blog">its sources in GitHub</a>.</p><p>You can easily integrate <code>jgd</code> with Travis. See <a href="https://github.com/yegor256/blog/blob/master/.travis.yml"><code>.travis.yml</code></a> of this blog.</p><p>Full documentation about the gem is located <a href="https://github.com/yegor256/jekyll-github-deploy">here</a>.</p></p><nav class="buttons notranslate desktop-only"> <a href="http://www.facebook.com/sharer/sharer.php?u=https://www.yegor256.com/2014/06/24/jekyll-github-deploy.html" title="Share on Facebook" class="button" rel="nofollow"> <span class="count count-facebook">0</span> <i class="icon icon-facebook notranslate" aria-hidden="true"></i> </a> <a href="https://twitter.com/share?url=https://www.yegor256.com/2014/06/24/jekyll-github-deploy.html&amp;text=Deploy+Jekyll+to+GitHub+Pages" title="Share on Twitter" class="button" rel="nofollow"> <span class="count count-twitter">0</span> <i class="icon icon-twitter notranslate" aria-hidden="true"></i> </a> <a href="https://plus.google.com/share?url=https://www.yegor256.com/2014/06/24/jekyll-github-deploy.html" title="Share on Google+" class="button" rel="nofollow"> <span class="count count-googleplus">0</span> <i class="icon icon-googleplus notranslate" aria-hidden="true"></i> </a> <a href="https://www.linkedin.com/cws/share?url=https://www.yegor256.com/2014/06/24/jekyll-github-deploy.html" title="Share on LinkedIn" class="button" rel="nofollow"> <span class="count count-linkedin">0</span> <i class="icon icon-linkedin notranslate" aria-hidden="true"></i> </a> <a href="http://reddit.com/submit?url=https://www.yegor256.com/2014/06/24/jekyll-github-deploy.html%3F2014-25&amp;title=Deploy+Jekyll+to+GitHub+Pages" title="Share on Reddit" class="button" rel="nofollow"> <span class="count count-reddit">0</span> <i class="icon icon-reddit notranslate" aria-hidden="true"></i> </a> <a href="http://news.ycombinator.com/submitlink?u=https://www.yegor256.com/2014/06/24/jekyll-github-deploy.html%3F2014-25&amp;t=Deploy+Jekyll+to+GitHub+Pages" title="Share on Hacker News" class="button" rel="nofollow"> <span class="count count-hackernews">0</span> <i class="icon icon-hackernews notranslate" aria-hidden="true"></i> </a> </nav> </header> <article class="main" itemprop="articleBody"><div ><p>This blog is written in <a href="http://jekyllrb.com/">Jekyll</a> and is hosted at <a href="https://pages.github.com/">GitHub Pages</a>. It uses half a dozen custom plugins, which <a href="https://help.github.com/articles/using-jekyll-plugins-with-github-pages">are not allowed there</a>.</p><p>Here is how I deploy it:</p><figure class="highlight"><pre><code class="language-bash" data-lang="bash"><span></span>$ jgd</code></pre></figure><p>That’s it. <a href="http://rubygems.org/gems/jgd">jgd</a> is my Ruby gem (stands for “Jekyll GitHub Deploy”), which does the trick. Here is <a href="https://github.com/yegor256/jekyll-github-deploy/blob/master/bash/deploy.sh">what it does</a>:</p><ol> <li><p>It clones your existing repository from the current directory to a temporary one (guessing the URL of the repo from <code>.git/config</code> file).</p></li> <li><p>Runs <code>jekyll build</code> in that temporary directory, which saves the output in another temporary directory.</p></li> <li><p>Checks out <code>gh-pages</code> branch or creates one if it doesn’t exist.</p></li> <li><p>Copies the content of the site built by <code>jekyll build</code> into the branch, thus overwriting existing files, commits and pushes to GitHub.</p></li> <li><p>Cleans up all temporary directories.</p></li> </ol><p>Using this gem is very easy. Just install it with <code>gem install jgd</code> and then run in the root directory of your Jekyll blog.</p><p>What is important is that your Jekyll site files be located in the root directory of the repository. Just as they do on <a href="/2014/04/06/introduction.html">this blog</a>; see <a href="https://github.com/yegor256/blog">its sources in GitHub</a>.</p><p>You can easily integrate <code>jgd</code> with Travis. See <a href="https://github.com/yegor256/blog/blob/master/.travis.yml"><code>.travis.yml</code></a> of this blog.</p><p>Full documentation about the gem is located <a href="https://github.com/yegor256/jekyll-github-deploy">here</a>.</p></div></article></div><div class="wrapper"> <related-posts /></div><div class="disqus" role="complementary"><p class="disqus_hint"> Please, use <a href="https://help.disqus.com/commenting/what-html-tags-are-allowed-within-comments">syntax highlighting</a> in your comments, to make them more readable.</p><div id="disqus_thread" class="disqus-thread"> <a>&nbsp;</a></div><script> var disqus_config = function () { this.page.url = document.location.href.split('?')[0].split('#')[0].replace('https://', 'http://'); this.page.identifier = this.page.url; }; (function() { var d = document, s = d.createElement('script'); s.src = '//yegor256.disqus.com/embed.js'; s.setAttribute('data-timestamp', +new Date()); (d.head || d.body).appendChild(s); })(); </script> <noscript><div><p class="red"> JavaScript is disabled in your browser, that's why you can't see comments under this post.</p></div></noscript></div><div class="wrapper"> <footer class="footer"><p> &copy; <span itemscope="" itemprop="copyrightHolder" itemtype="http://schema.org/Person"> <span itemprop="name">Yegor Bugayenko</span> </span> 2014&ndash;<span itemprop="copyrightYear">2018</span></p></footer></div></section><div class="wrapper unprintable" style="text-align:center;margin-top:2em;"> <a href="http://www.sixnines.io/h/3ba1652f"> <img src="//www.sixnines.io/b/3ba1652f?style=flat" alt="sixnines availability badge"/> </a></div><script src="//code.jquery.com/jquery-1.9.0.min.js"></script> <script src="/js/all.js?ddf57a1cee0"></script> <script>var disqus_shortname = 'yegor256';</script> <script id="dsq-count-scr" src="//yegor256.disqus.com/count.js" async="async"></script> <script> (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){ (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o), m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m) })(window,document,'script','//www.google-analytics.com/analytics.js','ga'); ga('create', 'UA-1963507-32', 'auto'); ga('send', 'pageview'); </script> <script> Cd=document;Cr="&"+Math.random();Cp="&s=1"; Cd.cookie="b=b";if(Cd.cookie)Cp+="&c=1"; Cp+="&t="+(new Date()).getTimezoneOffset(); if(self!=top)Cp+="&f=1"; </script> <script> if(navigator.javaEnabled())Cp+="&j=1"; </script> <script> if(typeof(screen)!='undefined')Cp+="&w="+screen.width+"&h="+ screen.height+"&d="+(screen.colorDepth?screen.colorDepth:screen.pixelDepth); </script> <script> Cd.write("<img src='//c.hit.ua/hit?i=95870&g=0&x=2"+Cp+Cr+ "&r="+escape(Cd.referrer)+"&u="+escape(window.location.href)+ "' border='0' wi"+"dth='1' he"+"ight='1'/>"); </script> <script type="application/ld+json"> { "@context": "http://schema.org", "@type": "Person", "name": "Yegor Bugayenko", "url": "https://www.yegor256.com", "sameAs": [ "https://www.facebook.com/yegor256", "https://instagram.com/yegor256", "https://www.linkedin.com/in/yegor256", "https://twitter.com/yegor256", "https://github.com/yegor256", "https://www.pinterest.com/yegor256/" ] } </script> </body> </html> </article></div></section><div class="wrapper unprintable" style="text-align:center;margin-top:2em;"> <a href="http://www.sixnines.io/h/3ba1652f"> <img src="//www.sixnines.io/b/3ba1652f?style=flat" alt="sixnines availability badge"/> </a></div><script src="//code.jquery.com/jquery-1.9.0.min.js"></script> <script src="/js/all.js?ddf57a1cee0"></script> <script>var disqus_shortname = 'yegor256';</script> <script id="dsq-count-scr" src="//yegor256.disqus.com/count.js" async="async"></script> <script> (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){ (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o), m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m) })(window,document,'script','//www.google-analytics.com/analytics.js','ga'); ga('create', 'UA-1963507-32', 'auto'); ga('send', 'pageview'); </script> <script> Cd=document;Cr="&"+Math.random();Cp="&s=1"; Cd.cookie="b=b";if(Cd.cookie)Cp+="&c=1"; Cp+="&t="+(new Date()).getTimezoneOffset(); if(self!=top)Cp+="&f=1"; </script> <script> if(navigator.javaEnabled())Cp+="&j=1"; </script> <script> if(typeof(screen)!='undefined')Cp+="&w="+screen.width+"&h="+ screen.height+"&d="+(screen.colorDepth?screen.colorDepth:screen.pixelDepth); </script> <script> Cd.write("<img src='//c.hit.ua/hit?i=95870&g=0&x=2"+Cp+Cr+ "&r="+escape(Cd.referrer)+"&u="+escape(window.location.href)+ "' border='0' wi"+"dth='1' he"+"ight='1'/>"); </script> <script type="application/ld+json"> { "@context": "http://schema.org", "@type": "Person", "name": "Yegor Bugayenko", "url": "https://www.yegor256.com", "sameAs": [ "https://www.facebook.com/yegor256", "https://instagram.com/yegor256", "https://www.linkedin.com/in/yegor256", "https://twitter.com/yegor256", "https://github.com/yegor256", "https://www.pinterest.com/yegor256/" ] } </script> </body> </html>
