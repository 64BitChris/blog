<!DOCTYPE html> <html xmlns="http://www.w3.org/1999/xhtml" lang="en-US" xml:lang="en-US" itemscope="" itemtype="http://schema.org/WebSite"> <head> <meta charset="utf-8"/> <meta name="description" content="{"layout"=>"tag-index", "posts"=>[#<Jekyll::Document _posts/2014/may/2014-05-26-amazon-s3-java-oop-adapter.md collection=posts>, #<Jekyll::Document _posts/2014/may/2014-05-18-cloud-autoincrement-counters.md collection=posts>, #<Jekyll::Document _posts/2014/may/2014-05-01-dynamodb-local-maven-plugin.md collection=posts>, #<Jekyll::Document _posts/2014/apr/2014-04-21-s3-http-basic-auth.md collection=posts>, #<Jekyll::Document _posts/2014/apr/2014-04-14-jcabi-dynamo-java-api-of-aws-dynamodb.md collection=posts>], "tag"=>"aws", "content"=>"", "dir"=>"/tag/", "name"=>"aws.html", "path"=>"tag/aws.html", "url"=>"/tag/aws", "title"=>"aws", "description"=>"aws: more about aws in this collection of recently published articles... the list is updated every few weeks."}" /> <meta name="keywords" content="{&quot;layout&quot;=&gt;&quot;tag-index&quot;, &quot;posts&quot;=&gt;[#&lt;Jekyll::Document _posts/2014/may/2014-05-26-amazon-s3-java-oop-adapter.md collection=posts&gt;, #&lt;Jekyll::Document _posts/2014/may/2014-05-18-cloud-autoincrement-counters.md collection=posts&gt;, #&lt;Jekyll::Document _posts/2014/may/2014-05-01-dynamodb-local-maven-plugin.md collection=posts&gt;, #&lt;Jekyll::Document _posts/2014/apr/2014-04-21-s3-http-basic-auth.md collection=posts&gt;, #&lt;Jekyll::Document _posts/2014/apr/2014-04-14-jcabi-dynamo-java-api-of-aws-dynamodb.md collection=posts&gt;], &quot;tag&quot;=&gt;&quot;aws&quot;, &quot;content&quot;=&gt;&quot;&quot;, &quot;dir&quot;=&gt;&quot;/tag/&quot;, &quot;name&quot;=&gt;&quot;aws.html&quot;, &quot;path&quot;=&gt;&quot;tag/aws.html&quot;, &quot;url&quot;=&gt;&quot;/tag/aws&quot;, &quot;title&quot;=&gt;&quot;aws&quot;, &quot;description&quot;=&gt;&quot;aws: more about aws in this collection of recently published articles... the list is updated every few weeks.&quot;}" /> <meta name="viewport" content="width=device-width,minimum-scale=1,initial-scale=1"/> <meta name="google-site-verification" content="JEj_gQr2CPe2QKGw8XdMz0R7VboQIUbX3FlM-lwTq-8" /> <meta name="author" content="Yegor Bugayenko"> <meta name="og:site_name" content="Yegor Bugayenko"/> <meta name="og:type" content="article" /> <meta name="og:locale" content="en_US" /> <meta name="twitter:account_id" content="4503599630178231" /> <meta name="twitter:creator" content="@yegor256"/> <meta name="twitter:site" content="@yegor256"/> <meta name="twitter:title" property="og:title" content="aws"/> <meta name="twitter:description" property="og:description" content="{"layout"=>"tag-index", "posts"=>[#<Jekyll::Document _posts/2014/may/2014-05-26-amazon-s3-java-oop-adapter.md collection=posts>, #<Jekyll::Document _posts/2014/may/2014-05-18-cloud-autoincrement-counters.md collection=posts>, #<Jekyll::Document _posts/2014/may/2014-05-01-dynamodb-local-maven-plugin.md collection=posts>, #<Jekyll::Document _posts/2014/apr/2014-04-21-s3-http-basic-auth.md collection=posts>, #<Jekyll::Document _posts/2014/apr/2014-04-14-jcabi-dynamo-java-api-of-aws-dynamodb.md collection=posts>], "tag"=>"aws", "content"=>"", "dir"=>"/tag/", "name"=>"aws.html", "path"=>"tag/aws.html", "url"=>"/tag/aws", "title"=>"aws", "description"=>"aws: more about aws in this collection of recently published articles... the list is updated every few weeks."}"/> <meta name="twitter:url" property="og:url" content="https://www.yegor256.com/tag/aws"/> <meta name="telegram:channel" content="AAAAAEJFMRzsRTRxM3ec6A"/> <link rel="search" type="application/opensearchdescription+xml" href="/opensearch.xml" title="yegor256" /> <link rel="shortcut icon" href="/favicon.ico?ddf57a1cee0"/> <link rel="apple-touch-icon" href="/favicon.ico?ddf57a1cee0"/> <link rel="alternate" type="application/rss+xml" title="RSS for yegor256.com" href="https://www.yegor256.com/rss.xml"/> <link rel="stylesheet" href="/css/layout.css?ddf57a1cee0"/> <link rel="stylesheet" href="/css/icons.css?ddf57a1cee0"/> <link rel="canonical" href="https://www.yegor256.com/tag/aws" /> <link rel="amphtml" href="https://www.yegor256.com/tag/aws" /> <title>aws </title> </head> <body><div class="wrapper"> <aside class="header-toggle unprintable" id="header-toggle" title="Show the menu" onclick="$('#header').show();$('#header-toggle').hide();">&#9776;</aside> <header class="header" id="header"><div class="face"> <a href="/about-me.html#form" class="sub" title="Click to subscribe to my monthly newsletter"><span>Subscribe</span></a> <a href="/about-me.html" style="position:relative;"> <img src="/images/face-256x256.jpg" class="photo" alt="Yegor Bugayenko"/> </a></div><nav><ul class="menu social notranslate"> <li><a href="https://twitter.com/intent/follow?screen_name=yegor256" rel="nofollow" title="Follow me on Twitter"><i class="icon icon-twitter notranslate" aria-hidden="true"></i></a></li> <li><a href="/rss.xml" rel="nofollow" title="Subscribe to my RSS feed"><i class="icon icon-rss notranslate" aria-hidden="true"></i></a></li> <li><a itemprop="sameAs" href="https://github.com/yegor256" rel="nofollow" title="My GitHub profile"><i class="icon icon-github notranslate" aria-hidden="true"></i></a></li> <li><a itemprop="sameAs" href="http://stackoverflow.com/users/187141/yegor256" rel="nofollow" title="My StackOverflow profile"><i class="icon icon-stackoverflow notranslate" aria-hidden="true"></i></a></li> <li><a itemprop="sameAs" href="https://www.facebook.com/yegor256" rel="nofollow" title="Follow me on Facebook"><i class="icon icon-facebook notranslate" aria-hidden="true"></i></a></li> <li><a itemprop="sameAs" href="https://instagram.com/yegor256" rel="nofollow" title="Follow me on Instagram"><i class="icon icon-instagram notranslate" aria-hidden="true"></i></a></li> <li><a itemprop="sameAs" href="https://www.linkedin.com/in/yegor256" rel="nofollow" title="My LinkedIn profile"><i class="icon icon-linkedin notranslate" aria-hidden="true"></i></a></li> <li><a itemprop="sameAs" href="https://www.youtube.com/c/yegor256?sub_confirmation=1" rel="nofollow" title="My Youtube video channel"><i class="icon icon-youtube notranslate" aria-hidden="true"></i></a></li> <li><a itemprop="sameAs" href="https://www.pinterest.com/yegor256/" rel="nofollow" title="My Pinterest boards"><i class="icon icon-pinterest notranslate" aria-hidden="true"></i></a></li> <li><a itemprop="sameAs" href="https://angel.co/yegor256" rel="nofollow" title="My AngelList profile"><i class="icon icon-angellist notranslate" aria-hidden="true"></i></a></li> <li><a href="https://soundcloud.com/yegor256" rel="nofollow" title="My podcast"><i class="icon icon-podcast notranslate" aria-hidden="true"></i></a></li> <li><a href="https://itunes.apple.com/us/podcast/yegor256-podcast/id1150826721" rel="nofollow" title="My iTunes podcast"><i class="icon icon-itunes notranslate" aria-hidden="true"></i></a></li> <li><a href="https://t.me/yegor256news" rel="nofollow" title="My Telegram public channel"><i class="icon icon-telegram notranslate" aria-hidden="true"></i></a></li> <li><a href="mailto:blog@yegor256.com" rel="nofollow" title="Email me any time"><i class="icon icon-mail notranslate" aria-hidden="true"></i></a></li></ul><ul class="menu"> <li><a href="/" title="Home page">Home</a></li> <li /tag/aws><a href="/best.html" title="Best articles to read">12&#160;Best</a></li> <li /tag/aws><a href="/contents.html" title="The contents of the entire blog">All&#160;292</a></li> <li /tag/aws><a href="/webinars.html" title="My webinars">Webinars</a></li> <li /tag/aws><a href="/talks.html" title="Future and past conference talks">Talks</a></li> <li /tag/aws><a href="/books.html" title="The books I wrote">Books</a></li> <li /tag/aws><a href="/papers.html" title="My academic papers and patents">Papers</a></li> <li /tag/aws><a href="/pets.html" title="My loved pet projects">Pets</a></li> <li /tag/aws class="highlighted"><a href="/trainings.html" title="On-site trainings">Trainings</a></li> <li /tag/aws><a href="/award.html" title="Software quality award">Award</a></li> <li /tag/aws><a href="/testimonials.html" title="What some people say about me">Testimonials</a></li> <li /tag/aws><a href="/shift-m.html" title="Audio podcast about project management">Shift-M</a></li> <li /tag/aws><a href="/paintings.html" title="My paintings for sale">Paintings</a></li> <li><a href="https://ru.yegor256.com/" title="Немного на русском языке">По-русски</a></li></ul></nav><div class="search"> <form method="get" action="https://www.google.com/search" itemprop="potentialAction" itemscope="" itemtype="http://schema.org/SearchAction"> <meta itemprop="target" content="https://www.google.com/search?q={q}"/> <input name="sitesearch" value="yegor256.com" type="hidden"/> <input itemprop="query-input" type="text" id="search-query" class="field field-text" required="required" onfocus="$('.google').css('visibility', 'visible');" name="q" placeholder="Search..." autocomplete="off"/> <input type="image" src="/images/google-search-icon.svg" class="google" title="Search via Google" alt="Search via Google"/> </form></div><div class="hot"><ul></ul></div></header></div><section itemscope="" itemtype="http://schema.org/BlogPosting"><div class="wrapper"> <header itemprop="name"><h1>5 posts about aws</h1></header> <article itemprop="articleBody"> <!DOCTYPE html> <html xmlns="http://www.w3.org/1999/xhtml" lang="en-US" xml:lang="en-US" itemscope="" itemtype="http://schema.org/WebSite"> <head> <meta charset="utf-8"/> <meta name="description" content="<figure class="badge"><img src="https://www.yegor256.com/images/2014/05/s3-logo.png" style="width:150px;max-width:100%;" alt="badge" /></figure><p>I’m a big fan of Amazon Web Services (AWS). I’m using them in almost all of my projects. One of their most popular services is <a href="http://aws.amazon.com/s3/">Simple Storage Service (S3)</a>. It is a storage for binary objects (files) with unique names, accessible through HTTP or RESTful API.</p><p>Using S3 is very simple. You create a “bucket” with a unique name, upload your “object” into the bucket through their web interface or through RESTful API, and then download it again (either through HTTP or the API.)</p><p>Amazon ships the <a href="https://aws.amazon.com/sdkforjava/">Java SDK</a> that wraps their RESTful API. However, this SDK is not object-oriented at all. It is purely imperative and procedural—it just mirrors the API.</p><p>For example, in order to download an existing object <code>doc.txt</code> from bucket <code>test-1</code>, you have to do something like this:</p><figure class="highlight"><pre><code class="language-java" data-lang="java"><span></span><span class="n">AWSCredentials</span> <span class="n">creds</span> <span class="o">=</span> <span class="k">new</span> <span class="n">BasicAWSCredentials</span><span class="o">(</span><span class="n">key</span><span class="o">,</span> <span class="n">secret</span><span class="o">);</span>
<span class="n">AmazonS3</span> <span class="n">aws</span> <span class="o">=</span> <span class="k">new</span> <span class="n">AmazonS3Client</span><span class="o">(</span><span class="n">creds</span><span class="o">);</span>
<span class="n">S3Object</span> <span class="n">obj</span> <span class="o">=</span> <span class="n">aws</span><span class="o">.</span><span class="na">getObject</span><span class="o">(</span>
  <span class="k">new</span> <span class="n">GetObjectRequest</span><span class="o">(</span><span class="s">&quot;test-1&quot;</span><span class="o">,</span> <span class="s">&quot;doc.txt&quot;</span><span class="o">)</span>
<span class="o">);</span>
<span class="n">InputStream</span> <span class="n">input</span> <span class="o">=</span> <span class="n">obj</span><span class="o">.</span><span class="na">getObjectContent</span><span class="o">();</span>
<span class="n">String</span> <span class="n">content</span> <span class="o">=</span> <span class="n">IOUtils</span><span class="o">.</span><span class="na">toString</span><span class="o">(</span><span class="n">input</span><span class="o">,</span> <span class="s">&quot;UTF-8&quot;</span><span class="o">);</span>
<span class="n">input</span><span class="o">.</span><span class="na">close</span><span class="o">();</span></code></pre></figure> <figure class="badge"><img src="http://img.jcabi.com/logo-square.svg" style="width:64px;max-width:100%;" alt="badge" /></figure><p>As always, procedural programming has its inevitable disadvantages. To overcome them all, I designed <a href="http://s3.jcabi.com">jcabi-s3</a>, which is a small object-oriented adapter for Amazon SDK. This is how the same object-reading task can be accomplished with <a href="http://s3.jcabi.com">jcabi-s3</a>:</p><figure class="highlight"><pre><code class="language-java" data-lang="java"><span></span><span class="n">Region</span> <span class="n">region</span> <span class="o">=</span> <span class="k">new</span> <span class="n">Region</span><span class="o">.</span><span class="na">Simple</span><span class="o">(</span><span class="n">key</span><span class="o">,</span> <span class="n">secret</span><span class="o">);</span>
<span class="n">Bucket</span> <span class="n">bucket</span> <span class="o">=</span> <span class="n">region</span><span class="o">.</span><span class="na">bucket</span><span class="o">(</span><span class="s">&quot;test-1&quot;</span><span class="o">);</span>
<span class="n">Ocket</span> <span class="n">ocket</span> <span class="o">=</span> <span class="n">bucket</span><span class="o">.</span><span class="na">ocket</span><span class="o">(</span><span class="s">&quot;doc.txt&quot;</span><span class="o">);</span>
<span class="n">String</span> <span class="n">content</span> <span class="o">=</span> <span class="k">new</span> <span class="n">Ocket</span><span class="o">.</span><span class="na">Text</span><span class="o">(</span><span class="n">ocket</span><span class="o">).</span><span class="na">read</span><span class="o">();</span></code></pre></figure><p>Why is this approach better? Well, there are a number of obvious advantages.</p><h2 id="s3-object-is-an-object-in-java">S3 Object is an Object in Java</h2><p>S3 object get its representative in Java. It is not a collection of procedures to be called in order to get its properties (as with AWS SDK). Rather, it is a Java object with certain behaviors. I called them “ockets” (similar to “buckets”), in order to avoid clashes with <code>java.lang.Object</code>.</p><p><a href="http://s3.jcabi.com/apidocs-0.5/com/jcabi/s3/Ocket.html"><code>Ocket</code></a> is an interface, that exposes the behavior of a real AWS S3 object: read, write, check existence. There is also a convenient decorator <code>Ocket.Text</code> that simplifies working with binary objects:</p><figure class="highlight"><pre><code class="language-java" data-lang="java"><span></span><span class="n">Ocket</span><span class="o">.</span><span class="na">Text</span> <span class="n">ocket</span> <span class="o">=</span> <span class="k">new</span> <span class="n">Ocket</span><span class="o">.</span><span class="na">Text</span><span class="o">(</span><span class="n">ocket_from_s3</span><span class="o">);</span>
<span class="k">if</span> <span class="o">(</span><span class="n">ocket</span><span class="o">.</span><span class="na">exists</span><span class="o">())</span> <span class="o">{</span>
  <span class="n">System</span><span class="o">.</span><span class="na">out</span><span class="o">.</span><span class="na">print</span><span class="o">(</span><span class="n">ocket</span><span class="o">.</span><span class="na">read</span><span class="o">());</span>
<span class="o">}</span> <span class="k">else</span> <span class="o">{</span>
  <span class="n">ocket</span><span class="o">.</span><span class="na">write</span><span class="o">(</span><span class="s">&quot;Hello, world!&quot;</span><span class="o">);</span>
<span class="o">}</span></code></pre></figure><p>Now, you can pass an object to another class, instead of giving it your AWS credentials, bucket name, and object name. You simply pass a Java object, which encapsulates all AWS interaction details.</p><h2 id="extendability-through-decoration">Extendability Through Decoration</h2><p>Since <a href="http://s3.jcabi.com">jcabi-s3</a> exposes all entities as interfaces, they can easily be extended through encapsulation (<a href="http://en.wikipedia.org/wiki/Decorator_pattern">Decorator Pattern</a>).</p><p>For example, you want your code to retry S3 object read operations a few times before giving up and <a href="/2015/12/01/rethrow-exceptions.html">throwing</a> an <code>IOException</code> (by the way, this is a very good practice when working with web services). So, you want all your S3 reading operations to be redone a few times if first attempts fail.</p><p>You define a new decorator class, say, <code>RetryingOcket</code>, which encapsulates an original <code>Ocket</code>:</p><figure class="highlight"><pre><code class="language-java" data-lang="java"><span></span><span class="kd">public</span> <span class="n">RetryingOcket</span> <span class="kd">implements</span> <span class="n">Ocket</span> <span class="o">{</span>
  <span class="kd">private</span> <span class="kd">final</span> <span class="n">Ocket</span> <span class="n">origin</span><span class="o">;</span>
  <span class="kd">public</span> <span class="nf">RetryingOcket</span><span class="o">(</span><span class="n">Ocket</span> <span class="n">ocket</span><span class="o">)</span> <span class="o">{</span>
    <span class="k">this</span><span class="o">.</span><span class="na">origin</span> <span class="o">=</span> <span class="n">ocket</span><span class="o">;</span>
  <span class="o">}</span>
  <span class="nd">@Override</span>
  <span class="kd">public</span> <span class="kt">void</span> <span class="nf">read</span><span class="o">(</span><span class="n">OutputStream</span> <span class="n">stream</span><span class="o">)</span> <span class="kd">throws</span> <span class="n">IOException</span> <span class="o">{</span>
    <span class="kt">int</span> <span class="n">attempt</span> <span class="o">=</span> <span class="mi">0</span><span class="o">;</span>
    <span class="k">while</span> <span class="o">(</span><span class="kc">true</span><span class="o">)</span> <span class="o">{</span>
      <span class="k">try</span> <span class="o">{</span>
        <span class="k">this</span><span class="o">.</span><span class="na">origin</span><span class="o">.</span><span class="na">read</span><span class="o">(</span><span class="n">stream</span><span class="o">);</span>
      <span class="o">}</span> <span class="k">catch</span> <span class="o">(</span><span class="n">IOException</span> <span class="n">ex</span><span class="o">)</span> <span class="o">{</span>
        <span class="k">if</span> <span class="o">(</span><span class="n">attempt</span><span class="o">++</span> <span class="o">&gt;</span> <span class="mi">3</span><span class="o">)</span> <span class="o">{</span>
          <span class="k">throw</span> <span class="n">ex</span><span class="o">;</span>
        <span class="o">}</span>
      <span class="o">}</span>
    <span class="o">}</span>
  <span class="o">}</span>
  <span class="c1">// same for other methods</span>
<span class="o">}</span></code></pre></figure><p>Now, everywhere where <code>Ocket</code> is expected you send an instance of <code>RetryingOcket</code> that wraps your original object:</p><figure class="highlight"><pre><code class="language-java" data-lang="java"><span></span><span class="n">foo</span><span class="o">.</span><span class="na">process</span><span class="o">(</span><span class="k">new</span> <span class="n">RetryingOcket</span><span class="o">(</span><span class="n">ocket</span><span class="o">));</span></code></pre></figure><p>Method <code>foo.process()</code> won’t see a difference, since it is the same <code>Ocket</code> interface it is expecting.</p><p>By the way, this retry functionality is implemented out-of-the-box in <a href="http://s3.jcabi.com">jcabi-s3</a>, in <a href="http://s3.jcabi.com/apidocs-0.5/com/jcabi/s3/retry/package-summary.html"><code>com.jcabi.s3.retry</code></a> package.</p><h2 id="easy-mocking">Easy Mocking</h2><p>Again, due to the fact that all entities in <a href="http://s3.jcabi.com">jcabi-s3</a> are interfaces, they are very easy to mock. For example, your class expects an S3 object, reads its data and calculates the MD5 hash (I’m using <a href="http://commons.apache.org/proper/commons-codec/apidocs/org/apache/commons/codec/digest/DigestUtils.html"><code>DigestUtils</code></a> from <a href="http://commons.apache.org/proper/commons-codec/">commons-codec</a>):</p><figure class="highlight"><pre><code class="language-java" data-lang="java"><span></span><span class="kn">import</span> <span class="nn">com.jcabi.s3.Ocket</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">org.apache.commons.codec.digest.DigestUtils</span><span class="o">;</span>
<span class="kd">public</span> <span class="kd">class</span> <span class="nc">S3Md5Hash</span> <span class="o">{</span>
  <span class="kd">private</span> <span class="kd">final</span> <span class="n">Ocket</span> <span class="n">ocket</span><span class="o">;</span>
  <span class="kd">public</span> <span class="nf">S3Md5Hash</span><span class="o">(</span><span class="n">Ocket</span> <span class="n">okt</span><span class="o">)</span> <span class="o">{</span>
    <span class="k">this</span><span class="o">.</span><span class="na">ocket</span> <span class="o">=</span> <span class="n">okt</span><span class="o">;</span>
  <span class="o">}</span>
  <span class="kd">public</span> <span class="nf">hash</span><span class="o">()</span> <span class="kd">throws</span> <span class="n">IOException</span> <span class="o">{</span>
    <span class="n">ByteArrayOutputStream</span> <span class="n">baos</span> <span class="o">=</span> <span class="k">new</span> <span class="n">ByteArrayOutputStream</span><span class="o">();</span>
    <span class="k">this</span><span class="o">.</span><span class="na">ocket</span><span class="o">.</span><span class="na">read</span><span class="o">(</span><span class="n">baos</span><span class="o">);</span>
    <span class="k">return</span> <span class="n">DigestUtils</span><span class="o">.</span><span class="na">md5hex</span><span class="o">(</span><span class="n">baos</span><span class="o">.</span><span class="na">toByteArray</span><span class="o">());</span>
  <span class="o">}</span>
<span class="o">}</span></code></pre></figure><p>Here is how simple a unit test will look (try to create a unit test for a class using AWS SDK and you will see the difference):</p><figure class="highlight"><pre><code class="language-java" data-lang="java"><span></span><span class="kn">import</span> <span class="nn">com.jcabi.s3.Ocket</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">org.junit.Test</span><span class="o">;</span>
<span class="kd">public</span> <span class="kd">class</span> <span class="nc">S3Md5HashTest</span> <span class="o">{</span>
  <span class="nd">@Test</span>
  <span class="kd">public</span> <span class="kt">void</span> <span class="nf">generatesHash</span><span class="o">()</span> <span class="o">{</span>
    <span class="n">Ocket</span> <span class="n">ocket</span> <span class="o">=</span> <span class="n">Mockito</span><span class="o">.</span><span class="na">mock</span><span class="o">(</span><span class="n">Ocket</span><span class="o">.</span><span class="na">class</span><span class="o">);</span>
    <span class="n">Mockito</span><span class="o">.</span><span class="na">doAnswer</span><span class="o">(</span>
      <span class="k">new</span> <span class="n">Answer</span><span class="o">&lt;</span><span class="n">Void</span><span class="o">&gt;()</span> <span class="o">{</span>
        <span class="kd">public</span> <span class="n">Void</span> <span class="nf">answer</span><span class="o">(</span><span class="kd">final</span> <span class="n">InvocationOnMock</span> <span class="n">inv</span><span class="o">)</span> <span class="kd">throws</span> <span class="n">IOException</span> <span class="o">{</span>
          <span class="n">OutputStream</span><span class="o">.</span><span class="na">class</span><span class="o">.</span><span class="na">cast</span><span class="o">(</span><span class="n">inv</span><span class="o">.</span><span class="na">getArguments</span><span class="o">()[</span><span class="mi">0</span><span class="o">]).</span><span class="na">write</span><span class="o">(</span><span class="sc">&#39; &#39;</span><span class="o">);</span>
        <span class="o">}</span>
      <span class="o">}</span>
    <span class="o">).</span><span class="na">when</span><span class="o">(</span><span class="n">ocket</span><span class="o">).</span><span class="na">read</span><span class="o">(</span><span class="n">Mockito</span><span class="o">.</span><span class="na">any</span><span class="o">(</span><span class="n">OutputStream</span><span class="o">.</span><span class="na">class</span><span class="o">));</span>
    <span class="n">String</span> <span class="n">hash</span> <span class="o">=</span> <span class="k">new</span> <span class="n">S5Md5Hash</span><span class="o">(</span><span class="n">ocket</span><span class="o">);</span>
    <span class="n">Assert</span><span class="o">.</span><span class="na">assertEquals</span><span class="o">(</span><span class="n">hash</span><span class="o">,</span> <span class="s">&quot;7215ee9c7d9dc229d2921a40e899ec5f&quot;</span><span class="o">);</span>
  <span class="o">}</span>
<span class="o">}</span></code></pre></figure><p>I’m using <a href="http://junit.org/">JUnit</a> and <a href="https://code.google.com/p/mockito/">Mockito</a> in this test.</p><h2 id="immutability">Immutability</h2><p>All classes in <a href="http://s3.jcabi.com">jcabi-s3</a> are annotated with <a href="http://aspects.jcabi.com/annotation-immutable.html"><code>@Immutable</code></a> and are truly immutable.</p><p>The library ships as a JAR dependency in <a href="http://repo1.maven.org/maven2/com/jcabi/jcabi-s3">Maven Central</a> (get its latest versions in <a href="http://search.maven.org/">Maven Central</a>):</p><figure class="highlight"><pre><code class="language-xml" data-lang="xml"><span></span><span class="nt">&lt;dependency&gt;</span>
  <span class="nt">&lt;groupId&gt;</span>com.jcabi<span class="nt">&lt;/groupId&gt;</span>
  <span class="nt">&lt;artifactId&gt;</span>jcabi-s3<span class="nt">&lt;/artifactId&gt;</span>
<span class="nt">&lt;/dependency&gt;</span></code></pre></figure><p>As always, your comments and criticism are welcome as <a href="https://github.com/jcabi/jcabi-s3/issues">GitHub issues</a>.</p>" /> <meta name="keywords" content="next, path, output, content, previous, url, relative_path, id, collection, excerpt, draft, categories, layout, title, date, tags, description, keywords, slug, ext" /> <meta name="viewport" content="width=device-width,minimum-scale=1,initial-scale=1"/> <meta name="google-site-verification" content="JEj_gQr2CPe2QKGw8XdMz0R7VboQIUbX3FlM-lwTq-8" /> <meta name="author" content="Yegor Bugayenko"> <meta name="article:published_time" content="2014-05-26 00:00:00 +0000"> <meta name="og:site_name" content="Yegor Bugayenko"/> <meta name="og:type" content="article" /> <meta name="og:locale" content="en_US" /> <meta name="twitter:account_id" content="4503599630178231" /> <meta name="twitter:creator" content="@yegor256"/> <meta name="twitter:site" content="@yegor256"/> <meta name="twitter:title" property="og:title" content="Object-Oriented Java Adapter of Amazon S3 SDK"/> <meta name="twitter:description" property="og:description" content="<figure class="badge"><img src="https://www.yegor256.com/images/2014/05/s3-logo.png" style="width:150px;max-width:100%;" alt="badge" /></figure><p>I’m a big fan of Amazon Web Services (AWS). I’m using them in almost all of my projects. One of their most popular services is <a href="http://aws.amazon.com/s3/">Simple Storage Service (S3)</a>. It is a storage for binary objects (files) with unique names, accessible through HTTP or RESTful API.</p><p>Using S3 is very simple. You create a “bucket” with a unique name, upload your “object” into the bucket through their web interface or through RESTful API, and then download it again (either through HTTP or the API.)</p><p>Amazon ships the <a href="https://aws.amazon.com/sdkforjava/">Java SDK</a> that wraps their RESTful API. However, this SDK is not object-oriented at all. It is purely imperative and procedural—it just mirrors the API.</p><p>For example, in order to download an existing object <code>doc.txt</code> from bucket <code>test-1</code>, you have to do something like this:</p><figure class="highlight"><pre><code class="language-java" data-lang="java"><span></span><span class="n">AWSCredentials</span> <span class="n">creds</span> <span class="o">=</span> <span class="k">new</span> <span class="n">BasicAWSCredentials</span><span class="o">(</span><span class="n">key</span><span class="o">,</span> <span class="n">secret</span><span class="o">);</span>
<span class="n">AmazonS3</span> <span class="n">aws</span> <span class="o">=</span> <span class="k">new</span> <span class="n">AmazonS3Client</span><span class="o">(</span><span class="n">creds</span><span class="o">);</span>
<span class="n">S3Object</span> <span class="n">obj</span> <span class="o">=</span> <span class="n">aws</span><span class="o">.</span><span class="na">getObject</span><span class="o">(</span>
  <span class="k">new</span> <span class="n">GetObjectRequest</span><span class="o">(</span><span class="s">&quot;test-1&quot;</span><span class="o">,</span> <span class="s">&quot;doc.txt&quot;</span><span class="o">)</span>
<span class="o">);</span>
<span class="n">InputStream</span> <span class="n">input</span> <span class="o">=</span> <span class="n">obj</span><span class="o">.</span><span class="na">getObjectContent</span><span class="o">();</span>
<span class="n">String</span> <span class="n">content</span> <span class="o">=</span> <span class="n">IOUtils</span><span class="o">.</span><span class="na">toString</span><span class="o">(</span><span class="n">input</span><span class="o">,</span> <span class="s">&quot;UTF-8&quot;</span><span class="o">);</span>
<span class="n">input</span><span class="o">.</span><span class="na">close</span><span class="o">();</span></code></pre></figure> <figure class="badge"><img src="http://img.jcabi.com/logo-square.svg" style="width:64px;max-width:100%;" alt="badge" /></figure><p>As always, procedural programming has its inevitable disadvantages. To overcome them all, I designed <a href="http://s3.jcabi.com">jcabi-s3</a>, which is a small object-oriented adapter for Amazon SDK. This is how the same object-reading task can be accomplished with <a href="http://s3.jcabi.com">jcabi-s3</a>:</p><figure class="highlight"><pre><code class="language-java" data-lang="java"><span></span><span class="n">Region</span> <span class="n">region</span> <span class="o">=</span> <span class="k">new</span> <span class="n">Region</span><span class="o">.</span><span class="na">Simple</span><span class="o">(</span><span class="n">key</span><span class="o">,</span> <span class="n">secret</span><span class="o">);</span>
<span class="n">Bucket</span> <span class="n">bucket</span> <span class="o">=</span> <span class="n">region</span><span class="o">.</span><span class="na">bucket</span><span class="o">(</span><span class="s">&quot;test-1&quot;</span><span class="o">);</span>
<span class="n">Ocket</span> <span class="n">ocket</span> <span class="o">=</span> <span class="n">bucket</span><span class="o">.</span><span class="na">ocket</span><span class="o">(</span><span class="s">&quot;doc.txt&quot;</span><span class="o">);</span>
<span class="n">String</span> <span class="n">content</span> <span class="o">=</span> <span class="k">new</span> <span class="n">Ocket</span><span class="o">.</span><span class="na">Text</span><span class="o">(</span><span class="n">ocket</span><span class="o">).</span><span class="na">read</span><span class="o">();</span></code></pre></figure><p>Why is this approach better? Well, there are a number of obvious advantages.</p><h2 id="s3-object-is-an-object-in-java">S3 Object is an Object in Java</h2><p>S3 object get its representative in Java. It is not a collection of procedures to be called in order to get its properties (as with AWS SDK). Rather, it is a Java object with certain behaviors. I called them “ockets” (similar to “buckets”), in order to avoid clashes with <code>java.lang.Object</code>.</p><p><a href="http://s3.jcabi.com/apidocs-0.5/com/jcabi/s3/Ocket.html"><code>Ocket</code></a> is an interface, that exposes the behavior of a real AWS S3 object: read, write, check existence. There is also a convenient decorator <code>Ocket.Text</code> that simplifies working with binary objects:</p><figure class="highlight"><pre><code class="language-java" data-lang="java"><span></span><span class="n">Ocket</span><span class="o">.</span><span class="na">Text</span> <span class="n">ocket</span> <span class="o">=</span> <span class="k">new</span> <span class="n">Ocket</span><span class="o">.</span><span class="na">Text</span><span class="o">(</span><span class="n">ocket_from_s3</span><span class="o">);</span>
<span class="k">if</span> <span class="o">(</span><span class="n">ocket</span><span class="o">.</span><span class="na">exists</span><span class="o">())</span> <span class="o">{</span>
  <span class="n">System</span><span class="o">.</span><span class="na">out</span><span class="o">.</span><span class="na">print</span><span class="o">(</span><span class="n">ocket</span><span class="o">.</span><span class="na">read</span><span class="o">());</span>
<span class="o">}</span> <span class="k">else</span> <span class="o">{</span>
  <span class="n">ocket</span><span class="o">.</span><span class="na">write</span><span class="o">(</span><span class="s">&quot;Hello, world!&quot;</span><span class="o">);</span>
<span class="o">}</span></code></pre></figure><p>Now, you can pass an object to another class, instead of giving it your AWS credentials, bucket name, and object name. You simply pass a Java object, which encapsulates all AWS interaction details.</p><h2 id="extendability-through-decoration">Extendability Through Decoration</h2><p>Since <a href="http://s3.jcabi.com">jcabi-s3</a> exposes all entities as interfaces, they can easily be extended through encapsulation (<a href="http://en.wikipedia.org/wiki/Decorator_pattern">Decorator Pattern</a>).</p><p>For example, you want your code to retry S3 object read operations a few times before giving up and <a href="/2015/12/01/rethrow-exceptions.html">throwing</a> an <code>IOException</code> (by the way, this is a very good practice when working with web services). So, you want all your S3 reading operations to be redone a few times if first attempts fail.</p><p>You define a new decorator class, say, <code>RetryingOcket</code>, which encapsulates an original <code>Ocket</code>:</p><figure class="highlight"><pre><code class="language-java" data-lang="java"><span></span><span class="kd">public</span> <span class="n">RetryingOcket</span> <span class="kd">implements</span> <span class="n">Ocket</span> <span class="o">{</span>
  <span class="kd">private</span> <span class="kd">final</span> <span class="n">Ocket</span> <span class="n">origin</span><span class="o">;</span>
  <span class="kd">public</span> <span class="nf">RetryingOcket</span><span class="o">(</span><span class="n">Ocket</span> <span class="n">ocket</span><span class="o">)</span> <span class="o">{</span>
    <span class="k">this</span><span class="o">.</span><span class="na">origin</span> <span class="o">=</span> <span class="n">ocket</span><span class="o">;</span>
  <span class="o">}</span>
  <span class="nd">@Override</span>
  <span class="kd">public</span> <span class="kt">void</span> <span class="nf">read</span><span class="o">(</span><span class="n">OutputStream</span> <span class="n">stream</span><span class="o">)</span> <span class="kd">throws</span> <span class="n">IOException</span> <span class="o">{</span>
    <span class="kt">int</span> <span class="n">attempt</span> <span class="o">=</span> <span class="mi">0</span><span class="o">;</span>
    <span class="k">while</span> <span class="o">(</span><span class="kc">true</span><span class="o">)</span> <span class="o">{</span>
      <span class="k">try</span> <span class="o">{</span>
        <span class="k">this</span><span class="o">.</span><span class="na">origin</span><span class="o">.</span><span class="na">read</span><span class="o">(</span><span class="n">stream</span><span class="o">);</span>
      <span class="o">}</span> <span class="k">catch</span> <span class="o">(</span><span class="n">IOException</span> <span class="n">ex</span><span class="o">)</span> <span class="o">{</span>
        <span class="k">if</span> <span class="o">(</span><span class="n">attempt</span><span class="o">++</span> <span class="o">&gt;</span> <span class="mi">3</span><span class="o">)</span> <span class="o">{</span>
          <span class="k">throw</span> <span class="n">ex</span><span class="o">;</span>
        <span class="o">}</span>
      <span class="o">}</span>
    <span class="o">}</span>
  <span class="o">}</span>
  <span class="c1">// same for other methods</span>
<span class="o">}</span></code></pre></figure><p>Now, everywhere where <code>Ocket</code> is expected you send an instance of <code>RetryingOcket</code> that wraps your original object:</p><figure class="highlight"><pre><code class="language-java" data-lang="java"><span></span><span class="n">foo</span><span class="o">.</span><span class="na">process</span><span class="o">(</span><span class="k">new</span> <span class="n">RetryingOcket</span><span class="o">(</span><span class="n">ocket</span><span class="o">));</span></code></pre></figure><p>Method <code>foo.process()</code> won’t see a difference, since it is the same <code>Ocket</code> interface it is expecting.</p><p>By the way, this retry functionality is implemented out-of-the-box in <a href="http://s3.jcabi.com">jcabi-s3</a>, in <a href="http://s3.jcabi.com/apidocs-0.5/com/jcabi/s3/retry/package-summary.html"><code>com.jcabi.s3.retry</code></a> package.</p><h2 id="easy-mocking">Easy Mocking</h2><p>Again, due to the fact that all entities in <a href="http://s3.jcabi.com">jcabi-s3</a> are interfaces, they are very easy to mock. For example, your class expects an S3 object, reads its data and calculates the MD5 hash (I’m using <a href="http://commons.apache.org/proper/commons-codec/apidocs/org/apache/commons/codec/digest/DigestUtils.html"><code>DigestUtils</code></a> from <a href="http://commons.apache.org/proper/commons-codec/">commons-codec</a>):</p><figure class="highlight"><pre><code class="language-java" data-lang="java"><span></span><span class="kn">import</span> <span class="nn">com.jcabi.s3.Ocket</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">org.apache.commons.codec.digest.DigestUtils</span><span class="o">;</span>
<span class="kd">public</span> <span class="kd">class</span> <span class="nc">S3Md5Hash</span> <span class="o">{</span>
  <span class="kd">private</span> <span class="kd">final</span> <span class="n">Ocket</span> <span class="n">ocket</span><span class="o">;</span>
  <span class="kd">public</span> <span class="nf">S3Md5Hash</span><span class="o">(</span><span class="n">Ocket</span> <span class="n">okt</span><span class="o">)</span> <span class="o">{</span>
    <span class="k">this</span><span class="o">.</span><span class="na">ocket</span> <span class="o">=</span> <span class="n">okt</span><span class="o">;</span>
  <span class="o">}</span>
  <span class="kd">public</span> <span class="nf">hash</span><span class="o">()</span> <span class="kd">throws</span> <span class="n">IOException</span> <span class="o">{</span>
    <span class="n">ByteArrayOutputStream</span> <span class="n">baos</span> <span class="o">=</span> <span class="k">new</span> <span class="n">ByteArrayOutputStream</span><span class="o">();</span>
    <span class="k">this</span><span class="o">.</span><span class="na">ocket</span><span class="o">.</span><span class="na">read</span><span class="o">(</span><span class="n">baos</span><span class="o">);</span>
    <span class="k">return</span> <span class="n">DigestUtils</span><span class="o">.</span><span class="na">md5hex</span><span class="o">(</span><span class="n">baos</span><span class="o">.</span><span class="na">toByteArray</span><span class="o">());</span>
  <span class="o">}</span>
<span class="o">}</span></code></pre></figure><p>Here is how simple a unit test will look (try to create a unit test for a class using AWS SDK and you will see the difference):</p><figure class="highlight"><pre><code class="language-java" data-lang="java"><span></span><span class="kn">import</span> <span class="nn">com.jcabi.s3.Ocket</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">org.junit.Test</span><span class="o">;</span>
<span class="kd">public</span> <span class="kd">class</span> <span class="nc">S3Md5HashTest</span> <span class="o">{</span>
  <span class="nd">@Test</span>
  <span class="kd">public</span> <span class="kt">void</span> <span class="nf">generatesHash</span><span class="o">()</span> <span class="o">{</span>
    <span class="n">Ocket</span> <span class="n">ocket</span> <span class="o">=</span> <span class="n">Mockito</span><span class="o">.</span><span class="na">mock</span><span class="o">(</span><span class="n">Ocket</span><span class="o">.</span><span class="na">class</span><span class="o">);</span>
    <span class="n">Mockito</span><span class="o">.</span><span class="na">doAnswer</span><span class="o">(</span>
      <span class="k">new</span> <span class="n">Answer</span><span class="o">&lt;</span><span class="n">Void</span><span class="o">&gt;()</span> <span class="o">{</span>
        <span class="kd">public</span> <span class="n">Void</span> <span class="nf">answer</span><span class="o">(</span><span class="kd">final</span> <span class="n">InvocationOnMock</span> <span class="n">inv</span><span class="o">)</span> <span class="kd">throws</span> <span class="n">IOException</span> <span class="o">{</span>
          <span class="n">OutputStream</span><span class="o">.</span><span class="na">class</span><span class="o">.</span><span class="na">cast</span><span class="o">(</span><span class="n">inv</span><span class="o">.</span><span class="na">getArguments</span><span class="o">()[</span><span class="mi">0</span><span class="o">]).</span><span class="na">write</span><span class="o">(</span><span class="sc">&#39; &#39;</span><span class="o">);</span>
        <span class="o">}</span>
      <span class="o">}</span>
    <span class="o">).</span><span class="na">when</span><span class="o">(</span><span class="n">ocket</span><span class="o">).</span><span class="na">read</span><span class="o">(</span><span class="n">Mockito</span><span class="o">.</span><span class="na">any</span><span class="o">(</span><span class="n">OutputStream</span><span class="o">.</span><span class="na">class</span><span class="o">));</span>
    <span class="n">String</span> <span class="n">hash</span> <span class="o">=</span> <span class="k">new</span> <span class="n">S5Md5Hash</span><span class="o">(</span><span class="n">ocket</span><span class="o">);</span>
    <span class="n">Assert</span><span class="o">.</span><span class="na">assertEquals</span><span class="o">(</span><span class="n">hash</span><span class="o">,</span> <span class="s">&quot;7215ee9c7d9dc229d2921a40e899ec5f&quot;</span><span class="o">);</span>
  <span class="o">}</span>
<span class="o">}</span></code></pre></figure><p>I’m using <a href="http://junit.org/">JUnit</a> and <a href="https://code.google.com/p/mockito/">Mockito</a> in this test.</p><h2 id="immutability">Immutability</h2><p>All classes in <a href="http://s3.jcabi.com">jcabi-s3</a> are annotated with <a href="http://aspects.jcabi.com/annotation-immutable.html"><code>@Immutable</code></a> and are truly immutable.</p><p>The library ships as a JAR dependency in <a href="http://repo1.maven.org/maven2/com/jcabi/jcabi-s3">Maven Central</a> (get its latest versions in <a href="http://search.maven.org/">Maven Central</a>):</p><figure class="highlight"><pre><code class="language-xml" data-lang="xml"><span></span><span class="nt">&lt;dependency&gt;</span>
  <span class="nt">&lt;groupId&gt;</span>com.jcabi<span class="nt">&lt;/groupId&gt;</span>
  <span class="nt">&lt;artifactId&gt;</span>jcabi-s3<span class="nt">&lt;/artifactId&gt;</span>
<span class="nt">&lt;/dependency&gt;</span></code></pre></figure><p>As always, your comments and criticism are welcome as <a href="https://github.com/jcabi/jcabi-s3/issues">GitHub issues</a>.</p>"/> <meta name="twitter:url" property="og:url" content="https://www.yegor256.com/2014/05/26/amazon-s3-java-oop-adapter.html"/> <meta name="telegram:channel" content="AAAAAEJFMRzsRTRxM3ec6A"/> <link rel="search" type="application/opensearchdescription+xml" href="/opensearch.xml" title="yegor256" /> <link rel="shortcut icon" href="/favicon.ico?ddf57a1cee0"/> <link rel="apple-touch-icon" href="/favicon.ico?ddf57a1cee0"/> <link rel="alternate" type="application/rss+xml" title="RSS for yegor256.com" href="https://www.yegor256.com/rss.xml"/> <link rel="stylesheet" href="/css/layout.css?ddf57a1cee0"/> <link rel="stylesheet" href="/css/icons.css?ddf57a1cee0"/> <link rel="canonical" href="https://www.yegor256.com/2014/05/26/amazon-s3-java-oop-adapter.html" /> <link rel="amphtml" href="https://www.yegor256.com/2014/05/26/amazon-s3-java-oop-adapter.amp.html" /> <title>Object-Oriented Java Adapter of Amazon S3 SDK </title> </head> <body><div class="wrapper"> <aside class="header-toggle unprintable" id="header-toggle" title="Show the menu" onclick="$('#header').show();$('#header-toggle').hide();">&#9776;</aside> <header class="header" id="header"><div class="face"> <a href="/about-me.html#form" class="sub" title="Click to subscribe to my monthly newsletter"><span>Subscribe</span></a> <a href="/about-me.html" style="position:relative;"> <img src="/images/face-256x256.jpg" class="photo" alt="Yegor Bugayenko"/> </a></div><nav><ul class="menu social notranslate"> <li><a href="https://twitter.com/intent/follow?screen_name=yegor256" rel="nofollow" title="Follow me on Twitter"><i class="icon icon-twitter notranslate" aria-hidden="true"></i></a></li> <li><a href="/rss.xml" rel="nofollow" title="Subscribe to my RSS feed"><i class="icon icon-rss notranslate" aria-hidden="true"></i></a></li> <li><a itemprop="sameAs" href="https://github.com/yegor256" rel="nofollow" title="My GitHub profile"><i class="icon icon-github notranslate" aria-hidden="true"></i></a></li> <li><a itemprop="sameAs" href="http://stackoverflow.com/users/187141/yegor256" rel="nofollow" title="My StackOverflow profile"><i class="icon icon-stackoverflow notranslate" aria-hidden="true"></i></a></li> <li><a itemprop="sameAs" href="https://www.facebook.com/yegor256" rel="nofollow" title="Follow me on Facebook"><i class="icon icon-facebook notranslate" aria-hidden="true"></i></a></li> <li><a itemprop="sameAs" href="https://instagram.com/yegor256" rel="nofollow" title="Follow me on Instagram"><i class="icon icon-instagram notranslate" aria-hidden="true"></i></a></li> <li><a itemprop="sameAs" href="https://www.linkedin.com/in/yegor256" rel="nofollow" title="My LinkedIn profile"><i class="icon icon-linkedin notranslate" aria-hidden="true"></i></a></li> <li><a itemprop="sameAs" href="https://www.youtube.com/c/yegor256?sub_confirmation=1" rel="nofollow" title="My Youtube video channel"><i class="icon icon-youtube notranslate" aria-hidden="true"></i></a></li> <li><a itemprop="sameAs" href="https://www.pinterest.com/yegor256/" rel="nofollow" title="My Pinterest boards"><i class="icon icon-pinterest notranslate" aria-hidden="true"></i></a></li> <li><a itemprop="sameAs" href="https://angel.co/yegor256" rel="nofollow" title="My AngelList profile"><i class="icon icon-angellist notranslate" aria-hidden="true"></i></a></li> <li><a href="https://soundcloud.com/yegor256" rel="nofollow" title="My podcast"><i class="icon icon-podcast notranslate" aria-hidden="true"></i></a></li> <li><a href="https://itunes.apple.com/us/podcast/yegor256-podcast/id1150826721" rel="nofollow" title="My iTunes podcast"><i class="icon icon-itunes notranslate" aria-hidden="true"></i></a></li> <li><a href="https://t.me/yegor256news" rel="nofollow" title="My Telegram public channel"><i class="icon icon-telegram notranslate" aria-hidden="true"></i></a></li> <li><a href="mailto:blog@yegor256.com" rel="nofollow" title="Email me any time"><i class="icon icon-mail notranslate" aria-hidden="true"></i></a></li></ul><ul class="menu"> <li><a href="/" title="Home page">Home</a></li> <li /2014/05/26/amazon-s3-java-oop-adapter.html><a href="/best.html" title="Best articles to read">12&#160;Best</a></li> <li /2014/05/26/amazon-s3-java-oop-adapter.html><a href="/contents.html" title="The contents of the entire blog">All&#160;292</a></li> <li /2014/05/26/amazon-s3-java-oop-adapter.html><a href="/webinars.html" title="My webinars">Webinars</a></li> <li /2014/05/26/amazon-s3-java-oop-adapter.html><a href="/talks.html" title="Future and past conference talks">Talks</a></li> <li /2014/05/26/amazon-s3-java-oop-adapter.html><a href="/books.html" title="The books I wrote">Books</a></li> <li /2014/05/26/amazon-s3-java-oop-adapter.html><a href="/papers.html" title="My academic papers and patents">Papers</a></li> <li /2014/05/26/amazon-s3-java-oop-adapter.html><a href="/pets.html" title="My loved pet projects">Pets</a></li> <li /2014/05/26/amazon-s3-java-oop-adapter.html class="highlighted"><a href="/trainings.html" title="On-site trainings">Trainings</a></li> <li /2014/05/26/amazon-s3-java-oop-adapter.html><a href="/award.html" title="Software quality award">Award</a></li> <li /2014/05/26/amazon-s3-java-oop-adapter.html><a href="/testimonials.html" title="What some people say about me">Testimonials</a></li> <li /2014/05/26/amazon-s3-java-oop-adapter.html><a href="/shift-m.html" title="Audio podcast about project management">Shift-M</a></li> <li /2014/05/26/amazon-s3-java-oop-adapter.html><a href="/paintings.html" title="My paintings for sale">Paintings</a></li> <li><a href="https://ru.yegor256.com/" title="Немного на русском языке">По-русски</a></li></ul></nav><div class="search"> <form method="get" action="https://www.google.com/search" itemprop="potentialAction" itemscope="" itemtype="http://schema.org/SearchAction"> <meta itemprop="target" content="https://www.google.com/search?q={q}"/> <input name="sitesearch" value="yegor256.com" type="hidden"/> <input itemprop="query-input" type="text" id="search-query" class="field field-text" required="required" onfocus="$('.google').css('visibility', 'visible');" name="q" placeholder="Search..." autocomplete="off"/> <input type="image" src="/images/google-search-icon.svg" class="google" title="Search via Google" alt="Search via Google"/> </form></div><div class="hot"><ul></ul></div></header></div><section itemscope="" itemtype="http://schema.org/BlogPosting"><div class="wrapper"> <header><p class="printable"> <img src="https://api.qrserver.com/v1/create-qr-code/?data=https://www.yegor256.com/2014/05/26/amazon-s3-java-oop-adapter.html&amp;format=svg" style="width:125px;height:125px;" alt="QR code"/></p><p class="printable"> <code itemprop="url">https://www.yegor256.com/2014/05/26/amazon-s3-java-oop-adapter.html</code></p><h1 itemprop="name headline mainEntityOfPage">Object-Oriented Java Adapter of Amazon S3 SDK</h1><ul class="subline"> <li> <time itemprop="datePublished" datetime="2014-05-26T00:00:00+00:00"> 26 May 2014 </time> </li> <li class="printable" itemscope="" itemprop="author" itemtype="http://schema.org/Person"> <span itemprop="name">Yegor Bugayenko</span> </li> <li class="unprintable"> <i class="icon icon-comments"></i> <a href="https://www.yegor256.com/2014/05/26/amazon-s3-java-oop-adapter.html#disqus_thread" itemprop="discussionUrl">comments</a> </li></ul><p class="unprintable"><figure class="badge"><img src="https://www.yegor256.com/images/2014/05/s3-logo.png" style="width:150px;max-width:100%;" alt="badge" /></figure><p>I’m a big fan of Amazon Web Services (AWS). I’m using them in almost all of my projects. One of their most popular services is <a href="http://aws.amazon.com/s3/">Simple Storage Service (S3)</a>. It is a storage for binary objects (files) with unique names, accessible through HTTP or RESTful API.</p><p>Using S3 is very simple. You create a “bucket” with a unique name, upload your “object” into the bucket through their web interface or through RESTful API, and then download it again (either through HTTP or the API.)</p><p>Amazon ships the <a href="https://aws.amazon.com/sdkforjava/">Java SDK</a> that wraps their RESTful API. However, this SDK is not object-oriented at all. It is purely imperative and procedural—it just mirrors the API.</p><p>For example, in order to download an existing object <code>doc.txt</code> from bucket <code>test-1</code>, you have to do something like this:</p><figure class="highlight"><pre><code class="language-java" data-lang="java"><span></span><span class="n">AWSCredentials</span> <span class="n">creds</span> <span class="o">=</span> <span class="k">new</span> <span class="n">BasicAWSCredentials</span><span class="o">(</span><span class="n">key</span><span class="o">,</span> <span class="n">secret</span><span class="o">);</span>
<span class="n">AmazonS3</span> <span class="n">aws</span> <span class="o">=</span> <span class="k">new</span> <span class="n">AmazonS3Client</span><span class="o">(</span><span class="n">creds</span><span class="o">);</span>
<span class="n">S3Object</span> <span class="n">obj</span> <span class="o">=</span> <span class="n">aws</span><span class="o">.</span><span class="na">getObject</span><span class="o">(</span>
  <span class="k">new</span> <span class="n">GetObjectRequest</span><span class="o">(</span><span class="s">&quot;test-1&quot;</span><span class="o">,</span> <span class="s">&quot;doc.txt&quot;</span><span class="o">)</span>
<span class="o">);</span>
<span class="n">InputStream</span> <span class="n">input</span> <span class="o">=</span> <span class="n">obj</span><span class="o">.</span><span class="na">getObjectContent</span><span class="o">();</span>
<span class="n">String</span> <span class="n">content</span> <span class="o">=</span> <span class="n">IOUtils</span><span class="o">.</span><span class="na">toString</span><span class="o">(</span><span class="n">input</span><span class="o">,</span> <span class="s">&quot;UTF-8&quot;</span><span class="o">);</span>
<span class="n">input</span><span class="o">.</span><span class="na">close</span><span class="o">();</span></code></pre></figure> <figure class="badge"><img src="http://img.jcabi.com/logo-square.svg" style="width:64px;max-width:100%;" alt="badge" /></figure><p>As always, procedural programming has its inevitable disadvantages. To overcome them all, I designed <a href="http://s3.jcabi.com">jcabi-s3</a>, which is a small object-oriented adapter for Amazon SDK. This is how the same object-reading task can be accomplished with <a href="http://s3.jcabi.com">jcabi-s3</a>:</p><figure class="highlight"><pre><code class="language-java" data-lang="java"><span></span><span class="n">Region</span> <span class="n">region</span> <span class="o">=</span> <span class="k">new</span> <span class="n">Region</span><span class="o">.</span><span class="na">Simple</span><span class="o">(</span><span class="n">key</span><span class="o">,</span> <span class="n">secret</span><span class="o">);</span>
<span class="n">Bucket</span> <span class="n">bucket</span> <span class="o">=</span> <span class="n">region</span><span class="o">.</span><span class="na">bucket</span><span class="o">(</span><span class="s">&quot;test-1&quot;</span><span class="o">);</span>
<span class="n">Ocket</span> <span class="n">ocket</span> <span class="o">=</span> <span class="n">bucket</span><span class="o">.</span><span class="na">ocket</span><span class="o">(</span><span class="s">&quot;doc.txt&quot;</span><span class="o">);</span>
<span class="n">String</span> <span class="n">content</span> <span class="o">=</span> <span class="k">new</span> <span class="n">Ocket</span><span class="o">.</span><span class="na">Text</span><span class="o">(</span><span class="n">ocket</span><span class="o">).</span><span class="na">read</span><span class="o">();</span></code></pre></figure><p>Why is this approach better? Well, there are a number of obvious advantages.</p><h2 id="s3-object-is-an-object-in-java">S3 Object is an Object in Java</h2><p>S3 object get its representative in Java. It is not a collection of procedures to be called in order to get its properties (as with AWS SDK). Rather, it is a Java object with certain behaviors. I called them “ockets” (similar to “buckets”), in order to avoid clashes with <code>java.lang.Object</code>.</p><p><a href="http://s3.jcabi.com/apidocs-0.5/com/jcabi/s3/Ocket.html"><code>Ocket</code></a> is an interface, that exposes the behavior of a real AWS S3 object: read, write, check existence. There is also a convenient decorator <code>Ocket.Text</code> that simplifies working with binary objects:</p><figure class="highlight"><pre><code class="language-java" data-lang="java"><span></span><span class="n">Ocket</span><span class="o">.</span><span class="na">Text</span> <span class="n">ocket</span> <span class="o">=</span> <span class="k">new</span> <span class="n">Ocket</span><span class="o">.</span><span class="na">Text</span><span class="o">(</span><span class="n">ocket_from_s3</span><span class="o">);</span>
<span class="k">if</span> <span class="o">(</span><span class="n">ocket</span><span class="o">.</span><span class="na">exists</span><span class="o">())</span> <span class="o">{</span>
  <span class="n">System</span><span class="o">.</span><span class="na">out</span><span class="o">.</span><span class="na">print</span><span class="o">(</span><span class="n">ocket</span><span class="o">.</span><span class="na">read</span><span class="o">());</span>
<span class="o">}</span> <span class="k">else</span> <span class="o">{</span>
  <span class="n">ocket</span><span class="o">.</span><span class="na">write</span><span class="o">(</span><span class="s">&quot;Hello, world!&quot;</span><span class="o">);</span>
<span class="o">}</span></code></pre></figure><p>Now, you can pass an object to another class, instead of giving it your AWS credentials, bucket name, and object name. You simply pass a Java object, which encapsulates all AWS interaction details.</p><h2 id="extendability-through-decoration">Extendability Through Decoration</h2><p>Since <a href="http://s3.jcabi.com">jcabi-s3</a> exposes all entities as interfaces, they can easily be extended through encapsulation (<a href="http://en.wikipedia.org/wiki/Decorator_pattern">Decorator Pattern</a>).</p><p>For example, you want your code to retry S3 object read operations a few times before giving up and <a href="/2015/12/01/rethrow-exceptions.html">throwing</a> an <code>IOException</code> (by the way, this is a very good practice when working with web services). So, you want all your S3 reading operations to be redone a few times if first attempts fail.</p><p>You define a new decorator class, say, <code>RetryingOcket</code>, which encapsulates an original <code>Ocket</code>:</p><figure class="highlight"><pre><code class="language-java" data-lang="java"><span></span><span class="kd">public</span> <span class="n">RetryingOcket</span> <span class="kd">implements</span> <span class="n">Ocket</span> <span class="o">{</span>
  <span class="kd">private</span> <span class="kd">final</span> <span class="n">Ocket</span> <span class="n">origin</span><span class="o">;</span>
  <span class="kd">public</span> <span class="nf">RetryingOcket</span><span class="o">(</span><span class="n">Ocket</span> <span class="n">ocket</span><span class="o">)</span> <span class="o">{</span>
    <span class="k">this</span><span class="o">.</span><span class="na">origin</span> <span class="o">=</span> <span class="n">ocket</span><span class="o">;</span>
  <span class="o">}</span>
  <span class="nd">@Override</span>
  <span class="kd">public</span> <span class="kt">void</span> <span class="nf">read</span><span class="o">(</span><span class="n">OutputStream</span> <span class="n">stream</span><span class="o">)</span> <span class="kd">throws</span> <span class="n">IOException</span> <span class="o">{</span>
    <span class="kt">int</span> <span class="n">attempt</span> <span class="o">=</span> <span class="mi">0</span><span class="o">;</span>
    <span class="k">while</span> <span class="o">(</span><span class="kc">true</span><span class="o">)</span> <span class="o">{</span>
      <span class="k">try</span> <span class="o">{</span>
        <span class="k">this</span><span class="o">.</span><span class="na">origin</span><span class="o">.</span><span class="na">read</span><span class="o">(</span><span class="n">stream</span><span class="o">);</span>
      <span class="o">}</span> <span class="k">catch</span> <span class="o">(</span><span class="n">IOException</span> <span class="n">ex</span><span class="o">)</span> <span class="o">{</span>
        <span class="k">if</span> <span class="o">(</span><span class="n">attempt</span><span class="o">++</span> <span class="o">&gt;</span> <span class="mi">3</span><span class="o">)</span> <span class="o">{</span>
          <span class="k">throw</span> <span class="n">ex</span><span class="o">;</span>
        <span class="o">}</span>
      <span class="o">}</span>
    <span class="o">}</span>
  <span class="o">}</span>
  <span class="c1">// same for other methods</span>
<span class="o">}</span></code></pre></figure><p>Now, everywhere where <code>Ocket</code> is expected you send an instance of <code>RetryingOcket</code> that wraps your original object:</p><figure class="highlight"><pre><code class="language-java" data-lang="java"><span></span><span class="n">foo</span><span class="o">.</span><span class="na">process</span><span class="o">(</span><span class="k">new</span> <span class="n">RetryingOcket</span><span class="o">(</span><span class="n">ocket</span><span class="o">));</span></code></pre></figure><p>Method <code>foo.process()</code> won’t see a difference, since it is the same <code>Ocket</code> interface it is expecting.</p><p>By the way, this retry functionality is implemented out-of-the-box in <a href="http://s3.jcabi.com">jcabi-s3</a>, in <a href="http://s3.jcabi.com/apidocs-0.5/com/jcabi/s3/retry/package-summary.html"><code>com.jcabi.s3.retry</code></a> package.</p><h2 id="easy-mocking">Easy Mocking</h2><p>Again, due to the fact that all entities in <a href="http://s3.jcabi.com">jcabi-s3</a> are interfaces, they are very easy to mock. For example, your class expects an S3 object, reads its data and calculates the MD5 hash (I’m using <a href="http://commons.apache.org/proper/commons-codec/apidocs/org/apache/commons/codec/digest/DigestUtils.html"><code>DigestUtils</code></a> from <a href="http://commons.apache.org/proper/commons-codec/">commons-codec</a>):</p><figure class="highlight"><pre><code class="language-java" data-lang="java"><span></span><span class="kn">import</span> <span class="nn">com.jcabi.s3.Ocket</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">org.apache.commons.codec.digest.DigestUtils</span><span class="o">;</span>
<span class="kd">public</span> <span class="kd">class</span> <span class="nc">S3Md5Hash</span> <span class="o">{</span>
  <span class="kd">private</span> <span class="kd">final</span> <span class="n">Ocket</span> <span class="n">ocket</span><span class="o">;</span>
  <span class="kd">public</span> <span class="nf">S3Md5Hash</span><span class="o">(</span><span class="n">Ocket</span> <span class="n">okt</span><span class="o">)</span> <span class="o">{</span>
    <span class="k">this</span><span class="o">.</span><span class="na">ocket</span> <span class="o">=</span> <span class="n">okt</span><span class="o">;</span>
  <span class="o">}</span>
  <span class="kd">public</span> <span class="nf">hash</span><span class="o">()</span> <span class="kd">throws</span> <span class="n">IOException</span> <span class="o">{</span>
    <span class="n">ByteArrayOutputStream</span> <span class="n">baos</span> <span class="o">=</span> <span class="k">new</span> <span class="n">ByteArrayOutputStream</span><span class="o">();</span>
    <span class="k">this</span><span class="o">.</span><span class="na">ocket</span><span class="o">.</span><span class="na">read</span><span class="o">(</span><span class="n">baos</span><span class="o">);</span>
    <span class="k">return</span> <span class="n">DigestUtils</span><span class="o">.</span><span class="na">md5hex</span><span class="o">(</span><span class="n">baos</span><span class="o">.</span><span class="na">toByteArray</span><span class="o">());</span>
  <span class="o">}</span>
<span class="o">}</span></code></pre></figure><p>Here is how simple a unit test will look (try to create a unit test for a class using AWS SDK and you will see the difference):</p><figure class="highlight"><pre><code class="language-java" data-lang="java"><span></span><span class="kn">import</span> <span class="nn">com.jcabi.s3.Ocket</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">org.junit.Test</span><span class="o">;</span>
<span class="kd">public</span> <span class="kd">class</span> <span class="nc">S3Md5HashTest</span> <span class="o">{</span>
  <span class="nd">@Test</span>
  <span class="kd">public</span> <span class="kt">void</span> <span class="nf">generatesHash</span><span class="o">()</span> <span class="o">{</span>
    <span class="n">Ocket</span> <span class="n">ocket</span> <span class="o">=</span> <span class="n">Mockito</span><span class="o">.</span><span class="na">mock</span><span class="o">(</span><span class="n">Ocket</span><span class="o">.</span><span class="na">class</span><span class="o">);</span>
    <span class="n">Mockito</span><span class="o">.</span><span class="na">doAnswer</span><span class="o">(</span>
      <span class="k">new</span> <span class="n">Answer</span><span class="o">&lt;</span><span class="n">Void</span><span class="o">&gt;()</span> <span class="o">{</span>
        <span class="kd">public</span> <span class="n">Void</span> <span class="nf">answer</span><span class="o">(</span><span class="kd">final</span> <span class="n">InvocationOnMock</span> <span class="n">inv</span><span class="o">)</span> <span class="kd">throws</span> <span class="n">IOException</span> <span class="o">{</span>
          <span class="n">OutputStream</span><span class="o">.</span><span class="na">class</span><span class="o">.</span><span class="na">cast</span><span class="o">(</span><span class="n">inv</span><span class="o">.</span><span class="na">getArguments</span><span class="o">()[</span><span class="mi">0</span><span class="o">]).</span><span class="na">write</span><span class="o">(</span><span class="sc">&#39; &#39;</span><span class="o">);</span>
        <span class="o">}</span>
      <span class="o">}</span>
    <span class="o">).</span><span class="na">when</span><span class="o">(</span><span class="n">ocket</span><span class="o">).</span><span class="na">read</span><span class="o">(</span><span class="n">Mockito</span><span class="o">.</span><span class="na">any</span><span class="o">(</span><span class="n">OutputStream</span><span class="o">.</span><span class="na">class</span><span class="o">));</span>
    <span class="n">String</span> <span class="n">hash</span> <span class="o">=</span> <span class="k">new</span> <span class="n">S5Md5Hash</span><span class="o">(</span><span class="n">ocket</span><span class="o">);</span>
    <span class="n">Assert</span><span class="o">.</span><span class="na">assertEquals</span><span class="o">(</span><span class="n">hash</span><span class="o">,</span> <span class="s">&quot;7215ee9c7d9dc229d2921a40e899ec5f&quot;</span><span class="o">);</span>
  <span class="o">}</span>
<span class="o">}</span></code></pre></figure><p>I’m using <a href="http://junit.org/">JUnit</a> and <a href="https://code.google.com/p/mockito/">Mockito</a> in this test.</p><h2 id="immutability">Immutability</h2><p>All classes in <a href="http://s3.jcabi.com">jcabi-s3</a> are annotated with <a href="http://aspects.jcabi.com/annotation-immutable.html"><code>@Immutable</code></a> and are truly immutable.</p><p>The library ships as a JAR dependency in <a href="http://repo1.maven.org/maven2/com/jcabi/jcabi-s3">Maven Central</a> (get its latest versions in <a href="http://search.maven.org/">Maven Central</a>):</p><figure class="highlight"><pre><code class="language-xml" data-lang="xml"><span></span><span class="nt">&lt;dependency&gt;</span>
  <span class="nt">&lt;groupId&gt;</span>com.jcabi<span class="nt">&lt;/groupId&gt;</span>
  <span class="nt">&lt;artifactId&gt;</span>jcabi-s3<span class="nt">&lt;/artifactId&gt;</span>
<span class="nt">&lt;/dependency&gt;</span></code></pre></figure><p>As always, your comments and criticism are welcome as <a href="https://github.com/jcabi/jcabi-s3/issues">GitHub issues</a>.</p></p><nav class="buttons notranslate desktop-only"> <a href="http://www.facebook.com/sharer/sharer.php?u=https://www.yegor256.com/2014/05/26/amazon-s3-java-oop-adapter.html" title="Share on Facebook" class="button" rel="nofollow"> <span class="count count-facebook">0</span> <i class="icon icon-facebook notranslate" aria-hidden="true"></i> </a> <a href="https://twitter.com/share?url=https://www.yegor256.com/2014/05/26/amazon-s3-java-oop-adapter.html&amp;text=Object-Oriented+Java+Adapter+of+Amazon+S3+SDK" title="Share on Twitter" class="button" rel="nofollow"> <span class="count count-twitter">0</span> <i class="icon icon-twitter notranslate" aria-hidden="true"></i> </a> <a href="https://plus.google.com/share?url=https://www.yegor256.com/2014/05/26/amazon-s3-java-oop-adapter.html" title="Share on Google+" class="button" rel="nofollow"> <span class="count count-googleplus">0</span> <i class="icon icon-googleplus notranslate" aria-hidden="true"></i> </a> <a href="https://www.linkedin.com/cws/share?url=https://www.yegor256.com/2014/05/26/amazon-s3-java-oop-adapter.html" title="Share on LinkedIn" class="button" rel="nofollow"> <span class="count count-linkedin">0</span> <i class="icon icon-linkedin notranslate" aria-hidden="true"></i> </a> <a href="http://reddit.com/submit?url=https://www.yegor256.com/2014/05/26/amazon-s3-java-oop-adapter.html%3F2014-21&amp;title=Object-Oriented+Java+Adapter+of+Amazon+S3+SDK" title="Share on Reddit" class="button" rel="nofollow"> <span class="count count-reddit">0</span> <i class="icon icon-reddit notranslate" aria-hidden="true"></i> </a> <a href="http://news.ycombinator.com/submitlink?u=https://www.yegor256.com/2014/05/26/amazon-s3-java-oop-adapter.html%3F2014-21&amp;t=Object-Oriented+Java+Adapter+of+Amazon+S3+SDK" title="Share on Hacker News" class="button" rel="nofollow"> <span class="count count-hackernews">0</span> <i class="icon icon-hackernews notranslate" aria-hidden="true"></i> </a> </nav> </header> <article class="main" itemprop="articleBody"><div > <figure class="badge"><img src="https://www.yegor256.com/images/2014/05/s3-logo.png" style="width:150px;max-width:100%;" alt="badge" /></figure><p>I’m a big fan of Amazon Web Services (AWS). I’m using them in almost all of my projects. One of their most popular services is <a href="http://aws.amazon.com/s3/">Simple Storage Service (S3)</a>. It is a storage for binary objects (files) with unique names, accessible through HTTP or RESTful API.</p><p>Using S3 is very simple. You create a “bucket” with a unique name, upload your “object” into the bucket through their web interface or through RESTful API, and then download it again (either through HTTP or the API.)</p><p>Amazon ships the <a href="https://aws.amazon.com/sdkforjava/">Java SDK</a> that wraps their RESTful API. However, this SDK is not object-oriented at all. It is purely imperative and procedural—it just mirrors the API.</p><p>For example, in order to download an existing object <code>doc.txt</code> from bucket <code>test-1</code>, you have to do something like this:</p><figure class="highlight"><pre><code class="language-java" data-lang="java"><span></span><span class="n">AWSCredentials</span> <span class="n">creds</span> <span class="o">=</span> <span class="k">new</span> <span class="n">BasicAWSCredentials</span><span class="o">(</span><span class="n">key</span><span class="o">,</span> <span class="n">secret</span><span class="o">);</span>
<span class="n">AmazonS3</span> <span class="n">aws</span> <span class="o">=</span> <span class="k">new</span> <span class="n">AmazonS3Client</span><span class="o">(</span><span class="n">creds</span><span class="o">);</span>
<span class="n">S3Object</span> <span class="n">obj</span> <span class="o">=</span> <span class="n">aws</span><span class="o">.</span><span class="na">getObject</span><span class="o">(</span>
  <span class="k">new</span> <span class="n">GetObjectRequest</span><span class="o">(</span><span class="s">&quot;test-1&quot;</span><span class="o">,</span> <span class="s">&quot;doc.txt&quot;</span><span class="o">)</span>
<span class="o">);</span>
<span class="n">InputStream</span> <span class="n">input</span> <span class="o">=</span> <span class="n">obj</span><span class="o">.</span><span class="na">getObjectContent</span><span class="o">();</span>
<span class="n">String</span> <span class="n">content</span> <span class="o">=</span> <span class="n">IOUtils</span><span class="o">.</span><span class="na">toString</span><span class="o">(</span><span class="n">input</span><span class="o">,</span> <span class="s">&quot;UTF-8&quot;</span><span class="o">);</span>
<span class="n">input</span><span class="o">.</span><span class="na">close</span><span class="o">();</span></code></pre></figure> <figure class="badge"><img src="http://img.jcabi.com/logo-square.svg" style="width:64px;max-width:100%;" alt="badge" /></figure><p>As always, procedural programming has its inevitable disadvantages. To overcome them all, I designed <a href="http://s3.jcabi.com">jcabi-s3</a>, which is a small object-oriented adapter for Amazon SDK. This is how the same object-reading task can be accomplished with <a href="http://s3.jcabi.com">jcabi-s3</a>:</p><figure class="highlight"><pre><code class="language-java" data-lang="java"><span></span><span class="n">Region</span> <span class="n">region</span> <span class="o">=</span> <span class="k">new</span> <span class="n">Region</span><span class="o">.</span><span class="na">Simple</span><span class="o">(</span><span class="n">key</span><span class="o">,</span> <span class="n">secret</span><span class="o">);</span>
<span class="n">Bucket</span> <span class="n">bucket</span> <span class="o">=</span> <span class="n">region</span><span class="o">.</span><span class="na">bucket</span><span class="o">(</span><span class="s">&quot;test-1&quot;</span><span class="o">);</span>
<span class="n">Ocket</span> <span class="n">ocket</span> <span class="o">=</span> <span class="n">bucket</span><span class="o">.</span><span class="na">ocket</span><span class="o">(</span><span class="s">&quot;doc.txt&quot;</span><span class="o">);</span>
<span class="n">String</span> <span class="n">content</span> <span class="o">=</span> <span class="k">new</span> <span class="n">Ocket</span><span class="o">.</span><span class="na">Text</span><span class="o">(</span><span class="n">ocket</span><span class="o">).</span><span class="na">read</span><span class="o">();</span></code></pre></figure><p>Why is this approach better? Well, there are a number of obvious advantages.</p><h2 id="s3-object-is-an-object-in-java">S3 Object is an Object in Java</h2><p>S3 object get its representative in Java. It is not a collection of procedures to be called in order to get its properties (as with AWS SDK). Rather, it is a Java object with certain behaviors. I called them “ockets” (similar to “buckets”), in order to avoid clashes with <code>java.lang.Object</code>.</p><p><a href="http://s3.jcabi.com/apidocs-0.5/com/jcabi/s3/Ocket.html"><code>Ocket</code></a> is an interface, that exposes the behavior of a real AWS S3 object: read, write, check existence. There is also a convenient decorator <code>Ocket.Text</code> that simplifies working with binary objects:</p><figure class="highlight"><pre><code class="language-java" data-lang="java"><span></span><span class="n">Ocket</span><span class="o">.</span><span class="na">Text</span> <span class="n">ocket</span> <span class="o">=</span> <span class="k">new</span> <span class="n">Ocket</span><span class="o">.</span><span class="na">Text</span><span class="o">(</span><span class="n">ocket_from_s3</span><span class="o">);</span>
<span class="k">if</span> <span class="o">(</span><span class="n">ocket</span><span class="o">.</span><span class="na">exists</span><span class="o">())</span> <span class="o">{</span>
  <span class="n">System</span><span class="o">.</span><span class="na">out</span><span class="o">.</span><span class="na">print</span><span class="o">(</span><span class="n">ocket</span><span class="o">.</span><span class="na">read</span><span class="o">());</span>
<span class="o">}</span> <span class="k">else</span> <span class="o">{</span>
  <span class="n">ocket</span><span class="o">.</span><span class="na">write</span><span class="o">(</span><span class="s">&quot;Hello, world!&quot;</span><span class="o">);</span>
<span class="o">}</span></code></pre></figure><p>Now, you can pass an object to another class, instead of giving it your AWS credentials, bucket name, and object name. You simply pass a Java object, which encapsulates all AWS interaction details.</p><h2 id="extendability-through-decoration">Extendability Through Decoration</h2><p>Since <a href="http://s3.jcabi.com">jcabi-s3</a> exposes all entities as interfaces, they can easily be extended through encapsulation (<a href="http://en.wikipedia.org/wiki/Decorator_pattern">Decorator Pattern</a>).</p><p>For example, you want your code to retry S3 object read operations a few times before giving up and <a href="/2015/12/01/rethrow-exceptions.html">throwing</a> an <code>IOException</code> (by the way, this is a very good practice when working with web services). So, you want all your S3 reading operations to be redone a few times if first attempts fail.</p><p>You define a new decorator class, say, <code>RetryingOcket</code>, which encapsulates an original <code>Ocket</code>:</p><figure class="highlight"><pre><code class="language-java" data-lang="java"><span></span><span class="kd">public</span> <span class="n">RetryingOcket</span> <span class="kd">implements</span> <span class="n">Ocket</span> <span class="o">{</span>
  <span class="kd">private</span> <span class="kd">final</span> <span class="n">Ocket</span> <span class="n">origin</span><span class="o">;</span>
  <span class="kd">public</span> <span class="nf">RetryingOcket</span><span class="o">(</span><span class="n">Ocket</span> <span class="n">ocket</span><span class="o">)</span> <span class="o">{</span>
    <span class="k">this</span><span class="o">.</span><span class="na">origin</span> <span class="o">=</span> <span class="n">ocket</span><span class="o">;</span>
  <span class="o">}</span>
  <span class="nd">@Override</span>
  <span class="kd">public</span> <span class="kt">void</span> <span class="nf">read</span><span class="o">(</span><span class="n">OutputStream</span> <span class="n">stream</span><span class="o">)</span> <span class="kd">throws</span> <span class="n">IOException</span> <span class="o">{</span>
    <span class="kt">int</span> <span class="n">attempt</span> <span class="o">=</span> <span class="mi">0</span><span class="o">;</span>
    <span class="k">while</span> <span class="o">(</span><span class="kc">true</span><span class="o">)</span> <span class="o">{</span>
      <span class="k">try</span> <span class="o">{</span>
        <span class="k">this</span><span class="o">.</span><span class="na">origin</span><span class="o">.</span><span class="na">read</span><span class="o">(</span><span class="n">stream</span><span class="o">);</span>
      <span class="o">}</span> <span class="k">catch</span> <span class="o">(</span><span class="n">IOException</span> <span class="n">ex</span><span class="o">)</span> <span class="o">{</span>
        <span class="k">if</span> <span class="o">(</span><span class="n">attempt</span><span class="o">++</span> <span class="o">&gt;</span> <span class="mi">3</span><span class="o">)</span> <span class="o">{</span>
          <span class="k">throw</span> <span class="n">ex</span><span class="o">;</span>
        <span class="o">}</span>
      <span class="o">}</span>
    <span class="o">}</span>
  <span class="o">}</span>
  <span class="c1">// same for other methods</span>
<span class="o">}</span></code></pre></figure><p>Now, everywhere where <code>Ocket</code> is expected you send an instance of <code>RetryingOcket</code> that wraps your original object:</p><figure class="highlight"><pre><code class="language-java" data-lang="java"><span></span><span class="n">foo</span><span class="o">.</span><span class="na">process</span><span class="o">(</span><span class="k">new</span> <span class="n">RetryingOcket</span><span class="o">(</span><span class="n">ocket</span><span class="o">));</span></code></pre></figure><p>Method <code>foo.process()</code> won’t see a difference, since it is the same <code>Ocket</code> interface it is expecting.</p><p>By the way, this retry functionality is implemented out-of-the-box in <a href="http://s3.jcabi.com">jcabi-s3</a>, in <a href="http://s3.jcabi.com/apidocs-0.5/com/jcabi/s3/retry/package-summary.html"><code>com.jcabi.s3.retry</code></a> package.</p><h2 id="easy-mocking">Easy Mocking</h2><p>Again, due to the fact that all entities in <a href="http://s3.jcabi.com">jcabi-s3</a> are interfaces, they are very easy to mock. For example, your class expects an S3 object, reads its data and calculates the MD5 hash (I’m using <a href="http://commons.apache.org/proper/commons-codec/apidocs/org/apache/commons/codec/digest/DigestUtils.html"><code>DigestUtils</code></a> from <a href="http://commons.apache.org/proper/commons-codec/">commons-codec</a>):</p><figure class="highlight"><pre><code class="language-java" data-lang="java"><span></span><span class="kn">import</span> <span class="nn">com.jcabi.s3.Ocket</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">org.apache.commons.codec.digest.DigestUtils</span><span class="o">;</span>
<span class="kd">public</span> <span class="kd">class</span> <span class="nc">S3Md5Hash</span> <span class="o">{</span>
  <span class="kd">private</span> <span class="kd">final</span> <span class="n">Ocket</span> <span class="n">ocket</span><span class="o">;</span>
  <span class="kd">public</span> <span class="nf">S3Md5Hash</span><span class="o">(</span><span class="n">Ocket</span> <span class="n">okt</span><span class="o">)</span> <span class="o">{</span>
    <span class="k">this</span><span class="o">.</span><span class="na">ocket</span> <span class="o">=</span> <span class="n">okt</span><span class="o">;</span>
  <span class="o">}</span>
  <span class="kd">public</span> <span class="nf">hash</span><span class="o">()</span> <span class="kd">throws</span> <span class="n">IOException</span> <span class="o">{</span>
    <span class="n">ByteArrayOutputStream</span> <span class="n">baos</span> <span class="o">=</span> <span class="k">new</span> <span class="n">ByteArrayOutputStream</span><span class="o">();</span>
    <span class="k">this</span><span class="o">.</span><span class="na">ocket</span><span class="o">.</span><span class="na">read</span><span class="o">(</span><span class="n">baos</span><span class="o">);</span>
    <span class="k">return</span> <span class="n">DigestUtils</span><span class="o">.</span><span class="na">md5hex</span><span class="o">(</span><span class="n">baos</span><span class="o">.</span><span class="na">toByteArray</span><span class="o">());</span>
  <span class="o">}</span>
<span class="o">}</span></code></pre></figure><p>Here is how simple a unit test will look (try to create a unit test for a class using AWS SDK and you will see the difference):</p><figure class="highlight"><pre><code class="language-java" data-lang="java"><span></span><span class="kn">import</span> <span class="nn">com.jcabi.s3.Ocket</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">org.junit.Test</span><span class="o">;</span>
<span class="kd">public</span> <span class="kd">class</span> <span class="nc">S3Md5HashTest</span> <span class="o">{</span>
  <span class="nd">@Test</span>
  <span class="kd">public</span> <span class="kt">void</span> <span class="nf">generatesHash</span><span class="o">()</span> <span class="o">{</span>
    <span class="n">Ocket</span> <span class="n">ocket</span> <span class="o">=</span> <span class="n">Mockito</span><span class="o">.</span><span class="na">mock</span><span class="o">(</span><span class="n">Ocket</span><span class="o">.</span><span class="na">class</span><span class="o">);</span>
    <span class="n">Mockito</span><span class="o">.</span><span class="na">doAnswer</span><span class="o">(</span>
      <span class="k">new</span> <span class="n">Answer</span><span class="o">&lt;</span><span class="n">Void</span><span class="o">&gt;()</span> <span class="o">{</span>
        <span class="kd">public</span> <span class="n">Void</span> <span class="nf">answer</span><span class="o">(</span><span class="kd">final</span> <span class="n">InvocationOnMock</span> <span class="n">inv</span><span class="o">)</span> <span class="kd">throws</span> <span class="n">IOException</span> <span class="o">{</span>
          <span class="n">OutputStream</span><span class="o">.</span><span class="na">class</span><span class="o">.</span><span class="na">cast</span><span class="o">(</span><span class="n">inv</span><span class="o">.</span><span class="na">getArguments</span><span class="o">()[</span><span class="mi">0</span><span class="o">]).</span><span class="na">write</span><span class="o">(</span><span class="sc">&#39; &#39;</span><span class="o">);</span>
        <span class="o">}</span>
      <span class="o">}</span>
    <span class="o">).</span><span class="na">when</span><span class="o">(</span><span class="n">ocket</span><span class="o">).</span><span class="na">read</span><span class="o">(</span><span class="n">Mockito</span><span class="o">.</span><span class="na">any</span><span class="o">(</span><span class="n">OutputStream</span><span class="o">.</span><span class="na">class</span><span class="o">));</span>
    <span class="n">String</span> <span class="n">hash</span> <span class="o">=</span> <span class="k">new</span> <span class="n">S5Md5Hash</span><span class="o">(</span><span class="n">ocket</span><span class="o">);</span>
    <span class="n">Assert</span><span class="o">.</span><span class="na">assertEquals</span><span class="o">(</span><span class="n">hash</span><span class="o">,</span> <span class="s">&quot;7215ee9c7d9dc229d2921a40e899ec5f&quot;</span><span class="o">);</span>
  <span class="o">}</span>
<span class="o">}</span></code></pre></figure><p>I’m using <a href="http://junit.org/">JUnit</a> and <a href="https://code.google.com/p/mockito/">Mockito</a> in this test.</p><h2 id="immutability">Immutability</h2><p>All classes in <a href="http://s3.jcabi.com">jcabi-s3</a> are annotated with <a href="http://aspects.jcabi.com/annotation-immutable.html"><code>@Immutable</code></a> and are truly immutable.</p><p>The library ships as a JAR dependency in <a href="http://repo1.maven.org/maven2/com/jcabi/jcabi-s3">Maven Central</a> (get its latest versions in <a href="http://search.maven.org/">Maven Central</a>):</p><figure class="highlight"><pre><code class="language-xml" data-lang="xml"><span></span><span class="nt">&lt;dependency&gt;</span>
  <span class="nt">&lt;groupId&gt;</span>com.jcabi<span class="nt">&lt;/groupId&gt;</span>
  <span class="nt">&lt;artifactId&gt;</span>jcabi-s3<span class="nt">&lt;/artifactId&gt;</span>
<span class="nt">&lt;/dependency&gt;</span></code></pre></figure><p>As always, your comments and criticism are welcome as <a href="https://github.com/jcabi/jcabi-s3/issues">GitHub issues</a>.</p></div></article></div><div class="wrapper"> <related-posts /></div><div class="disqus" role="complementary"><p class="disqus_hint"> Please, use <a href="https://help.disqus.com/commenting/what-html-tags-are-allowed-within-comments">syntax highlighting</a> in your comments, to make them more readable.</p><div id="disqus_thread" class="disqus-thread"> <a>&nbsp;</a></div><script> var disqus_config = function () { this.page.url = document.location.href.split('?')[0].split('#')[0].replace('https://', 'http://'); this.page.identifier = this.page.url; }; (function() { var d = document, s = d.createElement('script'); s.src = '//yegor256.disqus.com/embed.js'; s.setAttribute('data-timestamp', +new Date()); (d.head || d.body).appendChild(s); })(); </script> <noscript><div><p class="red"> JavaScript is disabled in your browser, that's why you can't see comments under this post.</p></div></noscript></div><div class="wrapper"> <footer class="footer"><p> &copy; <span itemscope="" itemprop="copyrightHolder" itemtype="http://schema.org/Person"> <span itemprop="name">Yegor Bugayenko</span> </span> 2014&ndash;<span itemprop="copyrightYear">2018</span></p></footer></div></section><div class="wrapper unprintable" style="text-align:center;margin-top:2em;"> <a href="http://www.sixnines.io/h/3ba1652f"> <img src="//www.sixnines.io/b/3ba1652f?style=flat" alt="sixnines availability badge"/> </a></div><script src="//code.jquery.com/jquery-1.9.0.min.js"></script> <script src="/js/all.js?ddf57a1cee0"></script> <script>var disqus_shortname = 'yegor256';</script> <script id="dsq-count-scr" src="//yegor256.disqus.com/count.js" async="async"></script> <script> (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){ (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o), m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m) })(window,document,'script','//www.google-analytics.com/analytics.js','ga'); ga('create', 'UA-1963507-32', 'auto'); ga('send', 'pageview'); </script> <script> Cd=document;Cr="&"+Math.random();Cp="&s=1"; Cd.cookie="b=b";if(Cd.cookie)Cp+="&c=1"; Cp+="&t="+(new Date()).getTimezoneOffset(); if(self!=top)Cp+="&f=1"; </script> <script> if(navigator.javaEnabled())Cp+="&j=1"; </script> <script> if(typeof(screen)!='undefined')Cp+="&w="+screen.width+"&h="+ screen.height+"&d="+(screen.colorDepth?screen.colorDepth:screen.pixelDepth); </script> <script> Cd.write("<img src='//c.hit.ua/hit?i=95870&g=0&x=2"+Cp+Cr+ "&r="+escape(Cd.referrer)+"&u="+escape(window.location.href)+ "' border='0' wi"+"dth='1' he"+"ight='1'/>"); </script> <script type="application/ld+json"> { "@context": "http://schema.org", "@type": "Person", "name": "Yegor Bugayenko", "url": "https://www.yegor256.com", "sameAs": [ "https://www.facebook.com/yegor256", "https://instagram.com/yegor256", "https://www.linkedin.com/in/yegor256", "https://twitter.com/yegor256", "https://github.com/yegor256", "https://www.pinterest.com/yegor256/" ] } </script> </body> </html> <!DOCTYPE html> <html xmlns="http://www.w3.org/1999/xhtml" lang="en-US" xml:lang="en-US" itemscope="" itemtype="http://schema.org/WebSite"> <head> <meta charset="utf-8"/> <meta name="description" content="<figure class="badge"><img src="https://www.yegor256.com/images/2014/04/dynamodb-logo.png" style="width:150px;max-width:100%;" alt="badge" /></figure><p>Amazon DynamoDB is a great NoSQL cloud database. It is cheap, highly reliable and rather powerful. I’m using it in many web systems.</p><p>There is one feature that it lacks, though—auto-increment attributes.</p><p>Say that you have a table with a list of messages:</p><figure class="highlight"><pre><code class="language-text" data-lang="text"><span></span>+------+----------------------------+
| id   | Attributes                 |
+------+----------------------------+
| 205  | author=&quot;jeff&quot;, text=&quot;...&quot;  |
| 206  | author=&quot;bob&quot;, text=&quot;...&quot;   |
| 207  | author=&quot;alice&quot;, text=&quot;...&quot; |
+------+----------------------------+</code></pre></figure><p>Every time you add a new item to the table, a new value of <code>id</code> has to be set. And this has to be done with concurrency in mind. SQL databases like PostgreSQL, Oracle, MySQL and others support auto-increment features. When you add a new record to the table, the value of the primary key is omitted and the server retrieves the next one automatically. If a number of <code>INSERT</code> requests arrive at the same time the server guarantees that the numbers won’t be duplicated.</p><p>However, DynamoDB doesn’t have this feature. Instead, DynamoDB has <a href="http://docs.aws.amazon.com/amazondynamodb/latest/developerguide/WorkingWithItems.html#WorkingWithItems.AtomicCounters">Atomic Counters</a> and <a href="http://docs.aws.amazon.com/amazondynamodb/latest/developerguide/WorkingWithItems.html#WorkingWithItems.ConditionalUpdate">Conditional Updates</a>, which are very similar features. Still, they’re not exactly the same.</p><p>In case of an atomic counter, you should create a supplementary table and keep the latest value of <code>id</code> in it.</p><p>In case of conditional updates, you should <a href="/2014/08/15/retry-java-method-on-exception.html">retry</a> a few times in case of collisions.</p><figure class="badge"><img src="http://img.stateful.co/pomegranate.svg" style="width:128px;max-width:100%;" alt="badge" /></figure><p>To make life easier in a few of my applications, I created a simple web service—<a href="http://www.stateful.co">stateful.co</a>. It provides a simple atomic counter feature through its RESTful API.</p><p>First, you create a counter with a unique name. Then, you set its initial value (it is zero by default). And, that’s it. Every time you need to obtain a new value for <code>id</code> column in DynamoDB table, you make an HTTP request to <a href="http://www.stateful.co">stateful.co</a> asking to increment your counter by one and return its next value.</p><p><a href="http://www.stateful.co">stateful.co</a> guarantees that values returned will never duplicate each other—no matter how many clients are using a counter or how fast they request increments simultaneously.</p><p>Moreover, I designed a small <a href="https://github.com/sttc/java-sdk">Java SDK</a> for <a href="http://www.stateful.co">stateful.co</a>. All you need to do is add this <a href="http://repo1.maven.org/maven2/co/stateful/java-sdk/">java-sdk.jar</a> Maven dependency to your project:</p><figure class="highlight"><pre><code class="language-xml" data-lang="xml"><span></span><span class="nt">&lt;dependency&gt;</span>
  <span class="nt">&lt;groupId&gt;</span>co.stateful<span class="nt">&lt;/groupId&gt;</span>
  <span class="nt">&lt;artifactId&gt;</span>java-sdk<span class="nt">&lt;/artifactId&gt;</span>
  <span class="nt">&lt;version&gt;</span>0.6<span class="nt">&lt;/version&gt;</span>
<span class="nt">&lt;/dependency&gt;</span></code></pre></figure><p>And, you can use <a href="http://www.stateful.co">stateful.co</a> counters from Java code:</p><figure class="highlight"><pre><code class="language-java" data-lang="java"><span></span><span class="n">Sttc</span> <span class="n">sttc</span> <span class="o">=</span> <span class="k">new</span> <span class="n">RtSttc</span><span class="o">(</span>
  <span class="k">new</span> <span class="n">URN</span><span class="o">(</span><span class="s">&quot;urn:github:526301&quot;</span><span class="o">),</span>
  <span class="s">&quot;9FF3-41E0-73FB-F900&quot;</span>
<span class="o">);</span>
<span class="n">Counters</span> <span class="n">counters</span> <span class="o">=</span> <span class="n">sttc</span><span class="o">.</span><span class="na">counters</span><span class="o">();</span>
<span class="n">Counter</span> <span class="n">counter</span> <span class="o">=</span> <span class="n">counters</span><span class="o">.</span><span class="na">get</span><span class="o">(</span><span class="s">&quot;foo&quot;</span><span class="o">);</span>
<span class="kt">long</span> <span class="n">value</span> <span class="o">=</span> <span class="n">counter</span><span class="o">.</span><span class="na">incrementAndGet</span><span class="o">(</span><span class="mi">1L</span><span class="o">);</span>
<span class="n">System</span><span class="o">.</span><span class="na">out</span><span class="o">.</span><span class="na">println</span><span class="o">(</span><span class="s">&quot;new value: &quot;</span> <span class="o">+</span> <span class="n">value</span><span class="o">);</span></code></pre></figure><p>You can review authentication parameters for <code>RtSttc</code> constructor at <a href="http://www.stateful.co">stateful.co</a>.</p><p>The service is absolutely free of charge.</p>" /> <meta name="keywords" content="next, path, output, content, previous, url, relative_path, id, collection, excerpt, draft, categories, layout, title, date, tags, description, keywords, slug, ext" /> <meta name="viewport" content="width=device-width,minimum-scale=1,initial-scale=1"/> <meta name="google-site-verification" content="JEj_gQr2CPe2QKGw8XdMz0R7VboQIUbX3FlM-lwTq-8" /> <meta name="author" content="Yegor Bugayenko"> <meta name="article:published_time" content="2014-05-18 00:00:00 +0000"> <meta name="og:site_name" content="Yegor Bugayenko"/> <meta name="og:type" content="article" /> <meta name="og:locale" content="en_US" /> <meta name="twitter:account_id" content="4503599630178231" /> <meta name="twitter:creator" content="@yegor256"/> <meta name="twitter:site" content="@yegor256"/> <meta name="twitter:title" property="og:title" content="Atomic Counters at Stateful.co"/> <meta name="twitter:description" property="og:description" content="<figure class="badge"><img src="https://www.yegor256.com/images/2014/04/dynamodb-logo.png" style="width:150px;max-width:100%;" alt="badge" /></figure><p>Amazon DynamoDB is a great NoSQL cloud database. It is cheap, highly reliable and rather powerful. I’m using it in many web systems.</p><p>There is one feature that it lacks, though—auto-increment attributes.</p><p>Say that you have a table with a list of messages:</p><figure class="highlight"><pre><code class="language-text" data-lang="text"><span></span>+------+----------------------------+
| id   | Attributes                 |
+------+----------------------------+
| 205  | author=&quot;jeff&quot;, text=&quot;...&quot;  |
| 206  | author=&quot;bob&quot;, text=&quot;...&quot;   |
| 207  | author=&quot;alice&quot;, text=&quot;...&quot; |
+------+----------------------------+</code></pre></figure><p>Every time you add a new item to the table, a new value of <code>id</code> has to be set. And this has to be done with concurrency in mind. SQL databases like PostgreSQL, Oracle, MySQL and others support auto-increment features. When you add a new record to the table, the value of the primary key is omitted and the server retrieves the next one automatically. If a number of <code>INSERT</code> requests arrive at the same time the server guarantees that the numbers won’t be duplicated.</p><p>However, DynamoDB doesn’t have this feature. Instead, DynamoDB has <a href="http://docs.aws.amazon.com/amazondynamodb/latest/developerguide/WorkingWithItems.html#WorkingWithItems.AtomicCounters">Atomic Counters</a> and <a href="http://docs.aws.amazon.com/amazondynamodb/latest/developerguide/WorkingWithItems.html#WorkingWithItems.ConditionalUpdate">Conditional Updates</a>, which are very similar features. Still, they’re not exactly the same.</p><p>In case of an atomic counter, you should create a supplementary table and keep the latest value of <code>id</code> in it.</p><p>In case of conditional updates, you should <a href="/2014/08/15/retry-java-method-on-exception.html">retry</a> a few times in case of collisions.</p><figure class="badge"><img src="http://img.stateful.co/pomegranate.svg" style="width:128px;max-width:100%;" alt="badge" /></figure><p>To make life easier in a few of my applications, I created a simple web service—<a href="http://www.stateful.co">stateful.co</a>. It provides a simple atomic counter feature through its RESTful API.</p><p>First, you create a counter with a unique name. Then, you set its initial value (it is zero by default). And, that’s it. Every time you need to obtain a new value for <code>id</code> column in DynamoDB table, you make an HTTP request to <a href="http://www.stateful.co">stateful.co</a> asking to increment your counter by one and return its next value.</p><p><a href="http://www.stateful.co">stateful.co</a> guarantees that values returned will never duplicate each other—no matter how many clients are using a counter or how fast they request increments simultaneously.</p><p>Moreover, I designed a small <a href="https://github.com/sttc/java-sdk">Java SDK</a> for <a href="http://www.stateful.co">stateful.co</a>. All you need to do is add this <a href="http://repo1.maven.org/maven2/co/stateful/java-sdk/">java-sdk.jar</a> Maven dependency to your project:</p><figure class="highlight"><pre><code class="language-xml" data-lang="xml"><span></span><span class="nt">&lt;dependency&gt;</span>
  <span class="nt">&lt;groupId&gt;</span>co.stateful<span class="nt">&lt;/groupId&gt;</span>
  <span class="nt">&lt;artifactId&gt;</span>java-sdk<span class="nt">&lt;/artifactId&gt;</span>
  <span class="nt">&lt;version&gt;</span>0.6<span class="nt">&lt;/version&gt;</span>
<span class="nt">&lt;/dependency&gt;</span></code></pre></figure><p>And, you can use <a href="http://www.stateful.co">stateful.co</a> counters from Java code:</p><figure class="highlight"><pre><code class="language-java" data-lang="java"><span></span><span class="n">Sttc</span> <span class="n">sttc</span> <span class="o">=</span> <span class="k">new</span> <span class="n">RtSttc</span><span class="o">(</span>
  <span class="k">new</span> <span class="n">URN</span><span class="o">(</span><span class="s">&quot;urn:github:526301&quot;</span><span class="o">),</span>
  <span class="s">&quot;9FF3-41E0-73FB-F900&quot;</span>
<span class="o">);</span>
<span class="n">Counters</span> <span class="n">counters</span> <span class="o">=</span> <span class="n">sttc</span><span class="o">.</span><span class="na">counters</span><span class="o">();</span>
<span class="n">Counter</span> <span class="n">counter</span> <span class="o">=</span> <span class="n">counters</span><span class="o">.</span><span class="na">get</span><span class="o">(</span><span class="s">&quot;foo&quot;</span><span class="o">);</span>
<span class="kt">long</span> <span class="n">value</span> <span class="o">=</span> <span class="n">counter</span><span class="o">.</span><span class="na">incrementAndGet</span><span class="o">(</span><span class="mi">1L</span><span class="o">);</span>
<span class="n">System</span><span class="o">.</span><span class="na">out</span><span class="o">.</span><span class="na">println</span><span class="o">(</span><span class="s">&quot;new value: &quot;</span> <span class="o">+</span> <span class="n">value</span><span class="o">);</span></code></pre></figure><p>You can review authentication parameters for <code>RtSttc</code> constructor at <a href="http://www.stateful.co">stateful.co</a>.</p><p>The service is absolutely free of charge.</p>"/> <meta name="twitter:url" property="og:url" content="https://www.yegor256.com/2014/05/18/cloud-autoincrement-counters.html"/> <meta name="telegram:channel" content="AAAAAEJFMRzsRTRxM3ec6A"/> <link rel="search" type="application/opensearchdescription+xml" href="/opensearch.xml" title="yegor256" /> <link rel="shortcut icon" href="/favicon.ico?ddf57a1cee0"/> <link rel="apple-touch-icon" href="/favicon.ico?ddf57a1cee0"/> <link rel="alternate" type="application/rss+xml" title="RSS for yegor256.com" href="https://www.yegor256.com/rss.xml"/> <link rel="stylesheet" href="/css/layout.css?ddf57a1cee0"/> <link rel="stylesheet" href="/css/icons.css?ddf57a1cee0"/> <link rel="canonical" href="https://www.yegor256.com/2014/05/18/cloud-autoincrement-counters.html" /> <link rel="amphtml" href="https://www.yegor256.com/2014/05/18/cloud-autoincrement-counters.amp.html" /> <title>Atomic Counters at Stateful.co </title> </head> <body><div class="wrapper"> <aside class="header-toggle unprintable" id="header-toggle" title="Show the menu" onclick="$('#header').show();$('#header-toggle').hide();">&#9776;</aside> <header class="header" id="header"><div class="face"> <a href="/about-me.html#form" class="sub" title="Click to subscribe to my monthly newsletter"><span>Subscribe</span></a> <a href="/about-me.html" style="position:relative;"> <img src="/images/face-256x256.jpg" class="photo" alt="Yegor Bugayenko"/> </a></div><nav><ul class="menu social notranslate"> <li><a href="https://twitter.com/intent/follow?screen_name=yegor256" rel="nofollow" title="Follow me on Twitter"><i class="icon icon-twitter notranslate" aria-hidden="true"></i></a></li> <li><a href="/rss.xml" rel="nofollow" title="Subscribe to my RSS feed"><i class="icon icon-rss notranslate" aria-hidden="true"></i></a></li> <li><a itemprop="sameAs" href="https://github.com/yegor256" rel="nofollow" title="My GitHub profile"><i class="icon icon-github notranslate" aria-hidden="true"></i></a></li> <li><a itemprop="sameAs" href="http://stackoverflow.com/users/187141/yegor256" rel="nofollow" title="My StackOverflow profile"><i class="icon icon-stackoverflow notranslate" aria-hidden="true"></i></a></li> <li><a itemprop="sameAs" href="https://www.facebook.com/yegor256" rel="nofollow" title="Follow me on Facebook"><i class="icon icon-facebook notranslate" aria-hidden="true"></i></a></li> <li><a itemprop="sameAs" href="https://instagram.com/yegor256" rel="nofollow" title="Follow me on Instagram"><i class="icon icon-instagram notranslate" aria-hidden="true"></i></a></li> <li><a itemprop="sameAs" href="https://www.linkedin.com/in/yegor256" rel="nofollow" title="My LinkedIn profile"><i class="icon icon-linkedin notranslate" aria-hidden="true"></i></a></li> <li><a itemprop="sameAs" href="https://www.youtube.com/c/yegor256?sub_confirmation=1" rel="nofollow" title="My Youtube video channel"><i class="icon icon-youtube notranslate" aria-hidden="true"></i></a></li> <li><a itemprop="sameAs" href="https://www.pinterest.com/yegor256/" rel="nofollow" title="My Pinterest boards"><i class="icon icon-pinterest notranslate" aria-hidden="true"></i></a></li> <li><a itemprop="sameAs" href="https://angel.co/yegor256" rel="nofollow" title="My AngelList profile"><i class="icon icon-angellist notranslate" aria-hidden="true"></i></a></li> <li><a href="https://soundcloud.com/yegor256" rel="nofollow" title="My podcast"><i class="icon icon-podcast notranslate" aria-hidden="true"></i></a></li> <li><a href="https://itunes.apple.com/us/podcast/yegor256-podcast/id1150826721" rel="nofollow" title="My iTunes podcast"><i class="icon icon-itunes notranslate" aria-hidden="true"></i></a></li> <li><a href="https://t.me/yegor256news" rel="nofollow" title="My Telegram public channel"><i class="icon icon-telegram notranslate" aria-hidden="true"></i></a></li> <li><a href="mailto:blog@yegor256.com" rel="nofollow" title="Email me any time"><i class="icon icon-mail notranslate" aria-hidden="true"></i></a></li></ul><ul class="menu"> <li><a href="/" title="Home page">Home</a></li> <li /2014/05/18/cloud-autoincrement-counters.html><a href="/best.html" title="Best articles to read">12&#160;Best</a></li> <li /2014/05/18/cloud-autoincrement-counters.html><a href="/contents.html" title="The contents of the entire blog">All&#160;292</a></li> <li /2014/05/18/cloud-autoincrement-counters.html><a href="/webinars.html" title="My webinars">Webinars</a></li> <li /2014/05/18/cloud-autoincrement-counters.html><a href="/talks.html" title="Future and past conference talks">Talks</a></li> <li /2014/05/18/cloud-autoincrement-counters.html><a href="/books.html" title="The books I wrote">Books</a></li> <li /2014/05/18/cloud-autoincrement-counters.html><a href="/papers.html" title="My academic papers and patents">Papers</a></li> <li /2014/05/18/cloud-autoincrement-counters.html><a href="/pets.html" title="My loved pet projects">Pets</a></li> <li /2014/05/18/cloud-autoincrement-counters.html class="highlighted"><a href="/trainings.html" title="On-site trainings">Trainings</a></li> <li /2014/05/18/cloud-autoincrement-counters.html><a href="/award.html" title="Software quality award">Award</a></li> <li /2014/05/18/cloud-autoincrement-counters.html><a href="/testimonials.html" title="What some people say about me">Testimonials</a></li> <li /2014/05/18/cloud-autoincrement-counters.html><a href="/shift-m.html" title="Audio podcast about project management">Shift-M</a></li> <li /2014/05/18/cloud-autoincrement-counters.html><a href="/paintings.html" title="My paintings for sale">Paintings</a></li> <li><a href="https://ru.yegor256.com/" title="Немного на русском языке">По-русски</a></li></ul></nav><div class="search"> <form method="get" action="https://www.google.com/search" itemprop="potentialAction" itemscope="" itemtype="http://schema.org/SearchAction"> <meta itemprop="target" content="https://www.google.com/search?q={q}"/> <input name="sitesearch" value="yegor256.com" type="hidden"/> <input itemprop="query-input" type="text" id="search-query" class="field field-text" required="required" onfocus="$('.google').css('visibility', 'visible');" name="q" placeholder="Search..." autocomplete="off"/> <input type="image" src="/images/google-search-icon.svg" class="google" title="Search via Google" alt="Search via Google"/> </form></div><div class="hot"><ul></ul></div></header></div><section itemscope="" itemtype="http://schema.org/BlogPosting"><div class="wrapper"> <header><p class="printable"> <img src="https://api.qrserver.com/v1/create-qr-code/?data=https://www.yegor256.com/2014/05/18/cloud-autoincrement-counters.html&amp;format=svg" style="width:125px;height:125px;" alt="QR code"/></p><p class="printable"> <code itemprop="url">https://www.yegor256.com/2014/05/18/cloud-autoincrement-counters.html</code></p><h1 itemprop="name headline mainEntityOfPage">Atomic Counters at Stateful.co</h1><ul class="subline"> <li> <time itemprop="datePublished" datetime="2014-05-18T00:00:00+00:00"> 18 May 2014 </time> </li> <li class="printable" itemscope="" itemprop="author" itemtype="http://schema.org/Person"> <span itemprop="name">Yegor Bugayenko</span> </li> <li class="unprintable"> <i class="icon icon-comments"></i> <a href="https://www.yegor256.com/2014/05/18/cloud-autoincrement-counters.html#disqus_thread" itemprop="discussionUrl">comments</a> </li></ul><p class="unprintable"><figure class="badge"><img src="https://www.yegor256.com/images/2014/04/dynamodb-logo.png" style="width:150px;max-width:100%;" alt="badge" /></figure><p>Amazon DynamoDB is a great NoSQL cloud database. It is cheap, highly reliable and rather powerful. I’m using it in many web systems.</p><p>There is one feature that it lacks, though—auto-increment attributes.</p><p>Say that you have a table with a list of messages:</p><figure class="highlight"><pre><code class="language-text" data-lang="text"><span></span>+------+----------------------------+
| id   | Attributes                 |
+------+----------------------------+
| 205  | author=&quot;jeff&quot;, text=&quot;...&quot;  |
| 206  | author=&quot;bob&quot;, text=&quot;...&quot;   |
| 207  | author=&quot;alice&quot;, text=&quot;...&quot; |
+------+----------------------------+</code></pre></figure><p>Every time you add a new item to the table, a new value of <code>id</code> has to be set. And this has to be done with concurrency in mind. SQL databases like PostgreSQL, Oracle, MySQL and others support auto-increment features. When you add a new record to the table, the value of the primary key is omitted and the server retrieves the next one automatically. If a number of <code>INSERT</code> requests arrive at the same time the server guarantees that the numbers won’t be duplicated.</p><p>However, DynamoDB doesn’t have this feature. Instead, DynamoDB has <a href="http://docs.aws.amazon.com/amazondynamodb/latest/developerguide/WorkingWithItems.html#WorkingWithItems.AtomicCounters">Atomic Counters</a> and <a href="http://docs.aws.amazon.com/amazondynamodb/latest/developerguide/WorkingWithItems.html#WorkingWithItems.ConditionalUpdate">Conditional Updates</a>, which are very similar features. Still, they’re not exactly the same.</p><p>In case of an atomic counter, you should create a supplementary table and keep the latest value of <code>id</code> in it.</p><p>In case of conditional updates, you should <a href="/2014/08/15/retry-java-method-on-exception.html">retry</a> a few times in case of collisions.</p><figure class="badge"><img src="http://img.stateful.co/pomegranate.svg" style="width:128px;max-width:100%;" alt="badge" /></figure><p>To make life easier in a few of my applications, I created a simple web service—<a href="http://www.stateful.co">stateful.co</a>. It provides a simple atomic counter feature through its RESTful API.</p><p>First, you create a counter with a unique name. Then, you set its initial value (it is zero by default). And, that’s it. Every time you need to obtain a new value for <code>id</code> column in DynamoDB table, you make an HTTP request to <a href="http://www.stateful.co">stateful.co</a> asking to increment your counter by one and return its next value.</p><p><a href="http://www.stateful.co">stateful.co</a> guarantees that values returned will never duplicate each other—no matter how many clients are using a counter or how fast they request increments simultaneously.</p><p>Moreover, I designed a small <a href="https://github.com/sttc/java-sdk">Java SDK</a> for <a href="http://www.stateful.co">stateful.co</a>. All you need to do is add this <a href="http://repo1.maven.org/maven2/co/stateful/java-sdk/">java-sdk.jar</a> Maven dependency to your project:</p><figure class="highlight"><pre><code class="language-xml" data-lang="xml"><span></span><span class="nt">&lt;dependency&gt;</span>
  <span class="nt">&lt;groupId&gt;</span>co.stateful<span class="nt">&lt;/groupId&gt;</span>
  <span class="nt">&lt;artifactId&gt;</span>java-sdk<span class="nt">&lt;/artifactId&gt;</span>
  <span class="nt">&lt;version&gt;</span>0.6<span class="nt">&lt;/version&gt;</span>
<span class="nt">&lt;/dependency&gt;</span></code></pre></figure><p>And, you can use <a href="http://www.stateful.co">stateful.co</a> counters from Java code:</p><figure class="highlight"><pre><code class="language-java" data-lang="java"><span></span><span class="n">Sttc</span> <span class="n">sttc</span> <span class="o">=</span> <span class="k">new</span> <span class="n">RtSttc</span><span class="o">(</span>
  <span class="k">new</span> <span class="n">URN</span><span class="o">(</span><span class="s">&quot;urn:github:526301&quot;</span><span class="o">),</span>
  <span class="s">&quot;9FF3-41E0-73FB-F900&quot;</span>
<span class="o">);</span>
<span class="n">Counters</span> <span class="n">counters</span> <span class="o">=</span> <span class="n">sttc</span><span class="o">.</span><span class="na">counters</span><span class="o">();</span>
<span class="n">Counter</span> <span class="n">counter</span> <span class="o">=</span> <span class="n">counters</span><span class="o">.</span><span class="na">get</span><span class="o">(</span><span class="s">&quot;foo&quot;</span><span class="o">);</span>
<span class="kt">long</span> <span class="n">value</span> <span class="o">=</span> <span class="n">counter</span><span class="o">.</span><span class="na">incrementAndGet</span><span class="o">(</span><span class="mi">1L</span><span class="o">);</span>
<span class="n">System</span><span class="o">.</span><span class="na">out</span><span class="o">.</span><span class="na">println</span><span class="o">(</span><span class="s">&quot;new value: &quot;</span> <span class="o">+</span> <span class="n">value</span><span class="o">);</span></code></pre></figure><p>You can review authentication parameters for <code>RtSttc</code> constructor at <a href="http://www.stateful.co">stateful.co</a>.</p><p>The service is absolutely free of charge.</p></p><nav class="buttons notranslate desktop-only"> <a href="http://www.facebook.com/sharer/sharer.php?u=https://www.yegor256.com/2014/05/18/cloud-autoincrement-counters.html" title="Share on Facebook" class="button" rel="nofollow"> <span class="count count-facebook">0</span> <i class="icon icon-facebook notranslate" aria-hidden="true"></i> </a> <a href="https://twitter.com/share?url=https://www.yegor256.com/2014/05/18/cloud-autoincrement-counters.html&amp;text=Atomic+Counters+at+Stateful.co" title="Share on Twitter" class="button" rel="nofollow"> <span class="count count-twitter">0</span> <i class="icon icon-twitter notranslate" aria-hidden="true"></i> </a> <a href="https://plus.google.com/share?url=https://www.yegor256.com/2014/05/18/cloud-autoincrement-counters.html" title="Share on Google+" class="button" rel="nofollow"> <span class="count count-googleplus">0</span> <i class="icon icon-googleplus notranslate" aria-hidden="true"></i> </a> <a href="https://www.linkedin.com/cws/share?url=https://www.yegor256.com/2014/05/18/cloud-autoincrement-counters.html" title="Share on LinkedIn" class="button" rel="nofollow"> <span class="count count-linkedin">0</span> <i class="icon icon-linkedin notranslate" aria-hidden="true"></i> </a> <a href="http://reddit.com/submit?url=https://www.yegor256.com/2014/05/18/cloud-autoincrement-counters.html%3F2014-20&amp;title=Atomic+Counters+at+Stateful.co" title="Share on Reddit" class="button" rel="nofollow"> <span class="count count-reddit">0</span> <i class="icon icon-reddit notranslate" aria-hidden="true"></i> </a> <a href="http://news.ycombinator.com/submitlink?u=https://www.yegor256.com/2014/05/18/cloud-autoincrement-counters.html%3F2014-20&amp;t=Atomic+Counters+at+Stateful.co" title="Share on Hacker News" class="button" rel="nofollow"> <span class="count count-hackernews">0</span> <i class="icon icon-hackernews notranslate" aria-hidden="true"></i> </a> </nav> </header> <article class="main" itemprop="articleBody"><div > <figure class="badge"><img src="https://www.yegor256.com/images/2014/04/dynamodb-logo.png" style="width:150px;max-width:100%;" alt="badge" /></figure><p>Amazon DynamoDB is a great NoSQL cloud database. It is cheap, highly reliable and rather powerful. I’m using it in many web systems.</p><p>There is one feature that it lacks, though—auto-increment attributes.</p><p>Say that you have a table with a list of messages:</p><figure class="highlight"><pre><code class="language-text" data-lang="text"><span></span>+------+----------------------------+
| id   | Attributes                 |
+------+----------------------------+
| 205  | author=&quot;jeff&quot;, text=&quot;...&quot;  |
| 206  | author=&quot;bob&quot;, text=&quot;...&quot;   |
| 207  | author=&quot;alice&quot;, text=&quot;...&quot; |
+------+----------------------------+</code></pre></figure><p>Every time you add a new item to the table, a new value of <code>id</code> has to be set. And this has to be done with concurrency in mind. SQL databases like PostgreSQL, Oracle, MySQL and others support auto-increment features. When you add a new record to the table, the value of the primary key is omitted and the server retrieves the next one automatically. If a number of <code>INSERT</code> requests arrive at the same time the server guarantees that the numbers won’t be duplicated.</p><p>However, DynamoDB doesn’t have this feature. Instead, DynamoDB has <a href="http://docs.aws.amazon.com/amazondynamodb/latest/developerguide/WorkingWithItems.html#WorkingWithItems.AtomicCounters">Atomic Counters</a> and <a href="http://docs.aws.amazon.com/amazondynamodb/latest/developerguide/WorkingWithItems.html#WorkingWithItems.ConditionalUpdate">Conditional Updates</a>, which are very similar features. Still, they’re not exactly the same.</p><p>In case of an atomic counter, you should create a supplementary table and keep the latest value of <code>id</code> in it.</p><p>In case of conditional updates, you should <a href="/2014/08/15/retry-java-method-on-exception.html">retry</a> a few times in case of collisions.</p><figure class="badge"><img src="http://img.stateful.co/pomegranate.svg" style="width:128px;max-width:100%;" alt="badge" /></figure><p>To make life easier in a few of my applications, I created a simple web service—<a href="http://www.stateful.co">stateful.co</a>. It provides a simple atomic counter feature through its RESTful API.</p><p>First, you create a counter with a unique name. Then, you set its initial value (it is zero by default). And, that’s it. Every time you need to obtain a new value for <code>id</code> column in DynamoDB table, you make an HTTP request to <a href="http://www.stateful.co">stateful.co</a> asking to increment your counter by one and return its next value.</p><p><a href="http://www.stateful.co">stateful.co</a> guarantees that values returned will never duplicate each other—no matter how many clients are using a counter or how fast they request increments simultaneously.</p><p>Moreover, I designed a small <a href="https://github.com/sttc/java-sdk">Java SDK</a> for <a href="http://www.stateful.co">stateful.co</a>. All you need to do is add this <a href="http://repo1.maven.org/maven2/co/stateful/java-sdk/">java-sdk.jar</a> Maven dependency to your project:</p><figure class="highlight"><pre><code class="language-xml" data-lang="xml"><span></span><span class="nt">&lt;dependency&gt;</span>
  <span class="nt">&lt;groupId&gt;</span>co.stateful<span class="nt">&lt;/groupId&gt;</span>
  <span class="nt">&lt;artifactId&gt;</span>java-sdk<span class="nt">&lt;/artifactId&gt;</span>
  <span class="nt">&lt;version&gt;</span>0.6<span class="nt">&lt;/version&gt;</span>
<span class="nt">&lt;/dependency&gt;</span></code></pre></figure><p>And, you can use <a href="http://www.stateful.co">stateful.co</a> counters from Java code:</p><figure class="highlight"><pre><code class="language-java" data-lang="java"><span></span><span class="n">Sttc</span> <span class="n">sttc</span> <span class="o">=</span> <span class="k">new</span> <span class="n">RtSttc</span><span class="o">(</span>
  <span class="k">new</span> <span class="n">URN</span><span class="o">(</span><span class="s">&quot;urn:github:526301&quot;</span><span class="o">),</span>
  <span class="s">&quot;9FF3-41E0-73FB-F900&quot;</span>
<span class="o">);</span>
<span class="n">Counters</span> <span class="n">counters</span> <span class="o">=</span> <span class="n">sttc</span><span class="o">.</span><span class="na">counters</span><span class="o">();</span>
<span class="n">Counter</span> <span class="n">counter</span> <span class="o">=</span> <span class="n">counters</span><span class="o">.</span><span class="na">get</span><span class="o">(</span><span class="s">&quot;foo&quot;</span><span class="o">);</span>
<span class="kt">long</span> <span class="n">value</span> <span class="o">=</span> <span class="n">counter</span><span class="o">.</span><span class="na">incrementAndGet</span><span class="o">(</span><span class="mi">1L</span><span class="o">);</span>
<span class="n">System</span><span class="o">.</span><span class="na">out</span><span class="o">.</span><span class="na">println</span><span class="o">(</span><span class="s">&quot;new value: &quot;</span> <span class="o">+</span> <span class="n">value</span><span class="o">);</span></code></pre></figure><p>You can review authentication parameters for <code>RtSttc</code> constructor at <a href="http://www.stateful.co">stateful.co</a>.</p><p>The service is absolutely free of charge.</p></div></article></div><div class="wrapper"> <related-posts /></div><div class="disqus" role="complementary"><p class="disqus_hint"> Please, use <a href="https://help.disqus.com/commenting/what-html-tags-are-allowed-within-comments">syntax highlighting</a> in your comments, to make them more readable.</p><div id="disqus_thread" class="disqus-thread"> <a>&nbsp;</a></div><script> var disqus_config = function () { this.page.url = document.location.href.split('?')[0].split('#')[0].replace('https://', 'http://'); this.page.identifier = this.page.url; }; (function() { var d = document, s = d.createElement('script'); s.src = '//yegor256.disqus.com/embed.js'; s.setAttribute('data-timestamp', +new Date()); (d.head || d.body).appendChild(s); })(); </script> <noscript><div><p class="red"> JavaScript is disabled in your browser, that's why you can't see comments under this post.</p></div></noscript></div><div class="wrapper"> <footer class="footer"><p> &copy; <span itemscope="" itemprop="copyrightHolder" itemtype="http://schema.org/Person"> <span itemprop="name">Yegor Bugayenko</span> </span> 2014&ndash;<span itemprop="copyrightYear">2018</span></p></footer></div></section><div class="wrapper unprintable" style="text-align:center;margin-top:2em;"> <a href="http://www.sixnines.io/h/3ba1652f"> <img src="//www.sixnines.io/b/3ba1652f?style=flat" alt="sixnines availability badge"/> </a></div><script src="//code.jquery.com/jquery-1.9.0.min.js"></script> <script src="/js/all.js?ddf57a1cee0"></script> <script>var disqus_shortname = 'yegor256';</script> <script id="dsq-count-scr" src="//yegor256.disqus.com/count.js" async="async"></script> <script> (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){ (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o), m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m) })(window,document,'script','//www.google-analytics.com/analytics.js','ga'); ga('create', 'UA-1963507-32', 'auto'); ga('send', 'pageview'); </script> <script> Cd=document;Cr="&"+Math.random();Cp="&s=1"; Cd.cookie="b=b";if(Cd.cookie)Cp+="&c=1"; Cp+="&t="+(new Date()).getTimezoneOffset(); if(self!=top)Cp+="&f=1"; </script> <script> if(navigator.javaEnabled())Cp+="&j=1"; </script> <script> if(typeof(screen)!='undefined')Cp+="&w="+screen.width+"&h="+ screen.height+"&d="+(screen.colorDepth?screen.colorDepth:screen.pixelDepth); </script> <script> Cd.write("<img src='//c.hit.ua/hit?i=95870&g=0&x=2"+Cp+Cr+ "&r="+escape(Cd.referrer)+"&u="+escape(window.location.href)+ "' border='0' wi"+"dth='1' he"+"ight='1'/>"); </script> <script type="application/ld+json"> { "@context": "http://schema.org", "@type": "Person", "name": "Yegor Bugayenko", "url": "https://www.yegor256.com", "sameAs": [ "https://www.facebook.com/yegor256", "https://instagram.com/yegor256", "https://www.linkedin.com/in/yegor256", "https://twitter.com/yegor256", "https://github.com/yegor256", "https://www.pinterest.com/yegor256/" ] } </script> </body> </html> <!DOCTYPE html> <html xmlns="http://www.w3.org/1999/xhtml" lang="en-US" xml:lang="en-US" itemscope="" itemtype="http://schema.org/WebSite"> <head> <meta charset="utf-8"/> <meta name="description" content="<figure class="badge"><a href="http://aws.amazon.com/dynamodb"><img src="https://www.yegor256.com/images/2014/04/dynamodb-logo.png" style="width:150px;max-width:100%;" alt="badge" /></a></figure><p><a href="http://docs.aws.amazon.com/amazondynamodb/latest/developerguide/Tools.html">DynamoDB Local</a> is a locally running copy of Amazon DynamoDB server. Amazon developed the tool and based it on SQLite. It acts as a real DynamoDB service through the RESTful API.</p><p>I guess, DynamoDB Local is meant to be used in integration testing and this is how we’re going to use it below.</p><p>I use Maven to run all of my Java integration testing using <a href="http://maven.apache.org/surefire/maven-failsafe-plugin/"><code>maven-failsafe-plugin</code></a>. The philosophy of integration testing with Maven is that you start all your supplementary test stubs during the <code>pre-integration-test</code> phase, run your tests in the <code>integration-test</code> phase and then shutdown all stubs during the <code>post-integration-test</code>.</p><figure class="badge"><a href="http://dynamodb.jcabi.com"><img src="http://img.jcabi.com/logo-square.svg" style="width:64px;max-width:100%;" alt="badge" /></a></figure><p>It would be great if it were possible to use DynamoDB Local that way. I didn’t find any Maven plugins for that purpose, so I decided to create my own—<a href="https://github.com/jcabi/jcabi-dynamodb-maven-plugin">jcabi-dynamodb-maven-plugin</a>.</p><p>Full usage details for the plugin are explained on <a href="http://dynamodb.jcabi.com">its website</a>. However, here is a simple example (get its latest versions in <a href="http://search.maven.org/">Maven Central</a>):</p><figure class="highlight"><pre><code class="language-xml" data-lang="xml"><span></span><span class="nt">&lt;plugin&gt;</span>
  <span class="nt">&lt;groupId&gt;</span>com.jcabi<span class="nt">&lt;/groupId&gt;</span>
  <span class="nt">&lt;artifactId&gt;</span>jcabi-dynamodb-maven-plugin<span class="nt">&lt;/artifactId&gt;</span>
  <span class="nt">&lt;executions&gt;</span>
    <span class="nt">&lt;execution&gt;</span>
      <span class="nt">&lt;goals&gt;</span>
        <span class="nt">&lt;goal&gt;</span>start<span class="nt">&lt;/goal&gt;</span>
        <span class="nt">&lt;goal&gt;</span>stop<span class="nt">&lt;/goal&gt;</span>
      <span class="nt">&lt;/goals&gt;</span>
      <span class="nt">&lt;configuration&gt;</span>
        <span class="nt">&lt;port&gt;</span>10500<span class="nt">&lt;/port&gt;</span>
        <span class="nt">&lt;dist&gt;</span>${project.build.directory}/dynamodb-dist<span class="nt">&lt;/dist&gt;</span>
      <span class="nt">&lt;/configuration&gt;</span>
    <span class="nt">&lt;/execution&gt;</span>
  <span class="nt">&lt;/executions&gt;</span>
<span class="nt">&lt;/plugin&gt;</span></code></pre></figure><p>The above configuration will start DynamoDB Local right before running integration tests, and then stop it immediately afterwards. The server will listen at TCP port 10500. While the number is used in the example, you’re supposed to use a randomly allocated port instead.</p><p>When the DynamoDB Local server is up and running, we can create an integration test for it:</p><figure class="highlight"><pre><code class="language-java" data-lang="java"><span></span><span class="kn">import</span> <span class="nn">com.amazonaws.auth.BasicAWSCredentials</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">com.amazonaws.services.dynamodbv2.AmazonDynamoDB</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">com.amazonaws.services.dynamodbv2.AmazonDynamoDBClient</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">com.amazonaws.services.dynamodbv2.model.ListTablesResult</span><span class="o">;</span>
<span class="kd">public</span> <span class="kd">class</span> <span class="nc">FooITCase</span> <span class="o">{</span>
  <span class="nd">@Test</span>
  <span class="kd">public</span> <span class="kt">void</span> <span class="nf">worksWithAwsDynamoDb</span><span class="o">()</span> <span class="o">{</span>
    <span class="n">AmazonDynamoDB</span> <span class="n">aws</span> <span class="o">=</span> <span class="k">new</span> <span class="n">AmazonDynamoDBClient</span><span class="o">(</span>
      <span class="k">new</span> <span class="n">BasicAWSCredentials</span><span class="o">(</span><span class="s">&quot;&quot;</span><span class="o">,</span> <span class="s">&quot;&quot;</span><span class="o">)</span>
    <span class="o">);</span>
    <span class="n">aws</span><span class="o">.</span><span class="na">setEndpoint</span><span class="o">(</span><span class="s">&quot;http://localhost:10500&quot;</span><span class="o">);</span>
    <span class="n">ListTablesResult</span> <span class="n">list</span> <span class="o">=</span> <span class="n">aws</span><span class="o">.</span><span class="na">listTables</span><span class="o">();</span>
    <span class="k">for</span> <span class="o">(</span><span class="n">String</span> <span class="n">name</span> <span class="o">:</span> <span class="n">list</span><span class="o">.</span><span class="na">getTableNames</span><span class="o">())</span> <span class="o">{</span>
      <span class="n">System</span><span class="o">.</span><span class="na">out</span><span class="o">.</span><span class="na">println</span><span class="o">(</span><span class="s">&quot;table found: &quot;</span> <span class="o">+</span> <span class="n">name</span><span class="o">);</span>
    <span class="o">}</span>
  <span class="o">}</span>
<span class="o">}</span></code></pre></figure><p>Of course, there won’t be any output because the server starts without any tables. Since the server is empty, you should create tables before every integration test, using <code>createTable()</code> from <a href="http://docs.aws.amazon.com/AWSJavaSDK/latest/javadoc/com/amazonaws/services/dynamodbv2/package-summary.html">DynamoDB SDK</a>.</p><p>To avoid this type of extra hassle, in the latest version 0.6 of <a href="http://dynamodb.jcabi.com">jcabi-dynamodb-maven-plugin</a> <a href="https://github.com/jcabi/jcabi-dynamodb-maven-plugin/issues/16">we introduced</a> a new goal <a href="http://dynamodb.jcabi.com/example-create-tables.html"><code>create-tables</code></a>:</p><figure class="highlight"><pre><code class="language-xml" data-lang="xml"><span></span><span class="nt">&lt;plugin&gt;</span>
  <span class="nt">&lt;groupId&gt;</span>com.jcabi<span class="nt">&lt;/groupId&gt;</span>
  <span class="nt">&lt;artifactId&gt;</span>jcabi-dynamodb-maven-plugin<span class="nt">&lt;/artifactId&gt;</span>
  <span class="nt">&lt;executions&gt;</span>
    <span class="nt">&lt;execution&gt;</span>
      <span class="nt">&lt;goals&gt;</span>
        <span class="nt">&lt;goal&gt;</span>create-tables<span class="nt">&lt;/goal&gt;</span>
      <span class="nt">&lt;/goals&gt;</span>
      <span class="nt">&lt;configuration&gt;</span>
        <span class="nt">&lt;tables&gt;</span>
          <span class="nt">&lt;table&gt;</span>${basedir}/src/test/dynamodb/foo.json<span class="nt">&lt;/table&gt;</span>
        <span class="nt">&lt;/tables&gt;</span>
      <span class="nt">&lt;/configuration&gt;</span>
    <span class="nt">&lt;/execution&gt;</span>
  <span class="nt">&lt;/executions&gt;</span>
<span class="nt">&lt;/plugin&gt;</span></code></pre></figure><p>The <code>foo.json</code> file used above should contain a JSON request that is sent to DynamoDB Local right after it is up and running. The request should comply with the specification of <a href="http://docs.aws.amazon.com/amazondynamodb/latest/APIReference/API_CreateTable.html"><code>CreateTable</code></a> request. For example:</p><figure class="highlight"><pre><code class="language-json" data-lang="json"><span></span><span class="p">{</span>
  <span class="nt">&quot;AttributeDefinitions&quot;</span><span class="p">:</span> <span class="p">[</span>
    <span class="p">{</span>
      <span class="nt">&quot;AttributeName&quot;</span><span class="p">:</span> <span class="s2">&quot;id&quot;</span><span class="p">,</span>
      <span class="nt">&quot;AttributeType&quot;</span><span class="p">:</span> <span class="s2">&quot;N&quot;</span>
    <span class="p">}</span>
  <span class="p">],</span>
  <span class="nt">&quot;KeySchema&quot;</span><span class="p">:</span> <span class="p">[</span>
    <span class="p">{</span>
      <span class="nt">&quot;AttributeName&quot;</span><span class="p">:</span> <span class="s2">&quot;id&quot;</span><span class="p">,</span>
      <span class="nt">&quot;KeyType&quot;</span><span class="p">:</span> <span class="s2">&quot;HASH&quot;</span>
    <span class="p">}</span>
  <span class="p">],</span>
  <span class="nt">&quot;ProvisionedThroughput&quot;</span><span class="p">:</span> <span class="p">{</span>
    <span class="nt">&quot;ReadCapacityUnits&quot;</span><span class="p">:</span> <span class="s2">&quot;1&quot;</span><span class="p">,</span>
    <span class="nt">&quot;WriteCapacityUnits&quot;</span><span class="p">:</span> <span class="s2">&quot;1&quot;</span>
  <span class="p">},</span>
  <span class="nt">&quot;TableName&quot;</span><span class="p">:</span> <span class="s2">&quot;foo&quot;</span>
<span class="p">}</span></code></pre></figure><p>The table will be created during the <code>pre-integration-test</code> phase and dropped at the <code>post-integration-test</code> phase. Now, we can make our integration test much more meaningful with the help of <a href="http://dynamo.jcabi.com">jcabi-dynamo</a>:</p><figure class="highlight"><pre><code class="language-java" data-lang="java"><span></span><span class="kn">import</span> <span class="nn">com.jcabi.dynamo.Attributes</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">com.jcabi.dynamo.Conditions</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">com.jcabi.dynamo.Credentials</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">com.jcabi.dynamo.Region</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">com.jcabi.dynamo.Table</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">org.hamcrest.MatcherAssert</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">org.hamcrest.Matchers</span><span class="o">;</span>
<span class="kd">public</span> <span class="kd">class</span> <span class="nc">FooITCase</span> <span class="o">{</span>
  <span class="nd">@Test</span>
  <span class="kd">public</span> <span class="kt">void</span> <span class="nf">worksWithAwsDynamoDb</span><span class="o">()</span> <span class="o">{</span>
    <span class="n">Region</span> <span class="n">region</span> <span class="o">=</span> <span class="k">new</span> <span class="n">Region</span><span class="o">.</span><span class="na">Simple</span><span class="o">(</span><span class="k">new</span> <span class="n">Credentials</span><span class="o">.</span><span class="na">Simple</span><span class="o">(</span><span class="s">&quot;&quot;</span><span class="o">,</span> <span class="s">&quot;&quot;</span><span class="o">));</span>
    <span class="n">Table</span> <span class="n">table</span> <span class="o">=</span> <span class="n">region</span><span class="o">.</span><span class="na">table</span><span class="o">(</span><span class="s">&quot;foo&quot;</span><span class="o">);</span>
    <span class="n">table</span><span class="o">.</span><span class="na">put</span><span class="o">(</span>
      <span class="k">new</span> <span class="n">Attributes</span><span class="o">()</span>
        <span class="o">.</span><span class="na">with</span><span class="o">(</span><span class="s">&quot;id&quot;</span><span class="o">,</span> <span class="mi">123</span><span class="o">)</span>
        <span class="o">.</span><span class="na">with</span><span class="o">(</span><span class="s">&quot;name&quot;</span><span class="o">,</span> <span class="s">&quot;Robert DeNiro&quot;</span><span class="o">)</span>
    <span class="o">);</span>
    <span class="n">MatcherAssert</span><span class="o">.</span><span class="na">assertThat</span><span class="o">(</span>
      <span class="n">table</span><span class="o">.</span><span class="na">frame</span><span class="o">().</span><span class="na">where</span><span class="o">(</span><span class="s">&quot;id&quot;</span><span class="o">,</span> <span class="n">Conditions</span><span class="o">.</span><span class="na">equalTo</span><span class="o">(</span><span class="mi">123</span><span class="o">)),</span>
      <span class="n">Matchers</span><span class="o">.</span><span class="na">notEmpty</span><span class="o">()</span>
    <span class="o">);</span>
  <span class="o">}</span>
<span class="o">}</span></code></pre></figure><p>The above test will put a new item into the table and then assert that the item is there.</p><p>The plugin was tested with three operating systems, and proved to work without problems: Mac OS X 10.8.5, Windows 7 SP1 and Ubuntu Linux 12.04 Desktop.</p>" /> <meta name="keywords" content="next, path, output, content, previous, url, relative_path, id, collection, excerpt, draft, categories, layout, title, date, tags, description, keywords, slug, ext" /> <meta name="viewport" content="width=device-width,minimum-scale=1,initial-scale=1"/> <meta name="google-site-verification" content="JEj_gQr2CPe2QKGw8XdMz0R7VboQIUbX3FlM-lwTq-8" /> <meta name="author" content="Yegor Bugayenko"> <meta name="article:published_time" content="2014-05-01 00:00:00 +0000"> <meta name="og:site_name" content="Yegor Bugayenko"/> <meta name="og:type" content="article" /> <meta name="og:locale" content="en_US" /> <meta name="twitter:account_id" content="4503599630178231" /> <meta name="twitter:creator" content="@yegor256"/> <meta name="twitter:site" content="@yegor256"/> <meta name="twitter:title" property="og:title" content="DynamoDB Local Maven Plugin"/> <meta name="twitter:description" property="og:description" content="<figure class="badge"><a href="http://aws.amazon.com/dynamodb"><img src="https://www.yegor256.com/images/2014/04/dynamodb-logo.png" style="width:150px;max-width:100%;" alt="badge" /></a></figure><p><a href="http://docs.aws.amazon.com/amazondynamodb/latest/developerguide/Tools.html">DynamoDB Local</a> is a locally running copy of Amazon DynamoDB server. Amazon developed the tool and based it on SQLite. It acts as a real DynamoDB service through the RESTful API.</p><p>I guess, DynamoDB Local is meant to be used in integration testing and this is how we’re going to use it below.</p><p>I use Maven to run all of my Java integration testing using <a href="http://maven.apache.org/surefire/maven-failsafe-plugin/"><code>maven-failsafe-plugin</code></a>. The philosophy of integration testing with Maven is that you start all your supplementary test stubs during the <code>pre-integration-test</code> phase, run your tests in the <code>integration-test</code> phase and then shutdown all stubs during the <code>post-integration-test</code>.</p><figure class="badge"><a href="http://dynamodb.jcabi.com"><img src="http://img.jcabi.com/logo-square.svg" style="width:64px;max-width:100%;" alt="badge" /></a></figure><p>It would be great if it were possible to use DynamoDB Local that way. I didn’t find any Maven plugins for that purpose, so I decided to create my own—<a href="https://github.com/jcabi/jcabi-dynamodb-maven-plugin">jcabi-dynamodb-maven-plugin</a>.</p><p>Full usage details for the plugin are explained on <a href="http://dynamodb.jcabi.com">its website</a>. However, here is a simple example (get its latest versions in <a href="http://search.maven.org/">Maven Central</a>):</p><figure class="highlight"><pre><code class="language-xml" data-lang="xml"><span></span><span class="nt">&lt;plugin&gt;</span>
  <span class="nt">&lt;groupId&gt;</span>com.jcabi<span class="nt">&lt;/groupId&gt;</span>
  <span class="nt">&lt;artifactId&gt;</span>jcabi-dynamodb-maven-plugin<span class="nt">&lt;/artifactId&gt;</span>
  <span class="nt">&lt;executions&gt;</span>
    <span class="nt">&lt;execution&gt;</span>
      <span class="nt">&lt;goals&gt;</span>
        <span class="nt">&lt;goal&gt;</span>start<span class="nt">&lt;/goal&gt;</span>
        <span class="nt">&lt;goal&gt;</span>stop<span class="nt">&lt;/goal&gt;</span>
      <span class="nt">&lt;/goals&gt;</span>
      <span class="nt">&lt;configuration&gt;</span>
        <span class="nt">&lt;port&gt;</span>10500<span class="nt">&lt;/port&gt;</span>
        <span class="nt">&lt;dist&gt;</span>${project.build.directory}/dynamodb-dist<span class="nt">&lt;/dist&gt;</span>
      <span class="nt">&lt;/configuration&gt;</span>
    <span class="nt">&lt;/execution&gt;</span>
  <span class="nt">&lt;/executions&gt;</span>
<span class="nt">&lt;/plugin&gt;</span></code></pre></figure><p>The above configuration will start DynamoDB Local right before running integration tests, and then stop it immediately afterwards. The server will listen at TCP port 10500. While the number is used in the example, you’re supposed to use a randomly allocated port instead.</p><p>When the DynamoDB Local server is up and running, we can create an integration test for it:</p><figure class="highlight"><pre><code class="language-java" data-lang="java"><span></span><span class="kn">import</span> <span class="nn">com.amazonaws.auth.BasicAWSCredentials</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">com.amazonaws.services.dynamodbv2.AmazonDynamoDB</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">com.amazonaws.services.dynamodbv2.AmazonDynamoDBClient</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">com.amazonaws.services.dynamodbv2.model.ListTablesResult</span><span class="o">;</span>
<span class="kd">public</span> <span class="kd">class</span> <span class="nc">FooITCase</span> <span class="o">{</span>
  <span class="nd">@Test</span>
  <span class="kd">public</span> <span class="kt">void</span> <span class="nf">worksWithAwsDynamoDb</span><span class="o">()</span> <span class="o">{</span>
    <span class="n">AmazonDynamoDB</span> <span class="n">aws</span> <span class="o">=</span> <span class="k">new</span> <span class="n">AmazonDynamoDBClient</span><span class="o">(</span>
      <span class="k">new</span> <span class="n">BasicAWSCredentials</span><span class="o">(</span><span class="s">&quot;&quot;</span><span class="o">,</span> <span class="s">&quot;&quot;</span><span class="o">)</span>
    <span class="o">);</span>
    <span class="n">aws</span><span class="o">.</span><span class="na">setEndpoint</span><span class="o">(</span><span class="s">&quot;http://localhost:10500&quot;</span><span class="o">);</span>
    <span class="n">ListTablesResult</span> <span class="n">list</span> <span class="o">=</span> <span class="n">aws</span><span class="o">.</span><span class="na">listTables</span><span class="o">();</span>
    <span class="k">for</span> <span class="o">(</span><span class="n">String</span> <span class="n">name</span> <span class="o">:</span> <span class="n">list</span><span class="o">.</span><span class="na">getTableNames</span><span class="o">())</span> <span class="o">{</span>
      <span class="n">System</span><span class="o">.</span><span class="na">out</span><span class="o">.</span><span class="na">println</span><span class="o">(</span><span class="s">&quot;table found: &quot;</span> <span class="o">+</span> <span class="n">name</span><span class="o">);</span>
    <span class="o">}</span>
  <span class="o">}</span>
<span class="o">}</span></code></pre></figure><p>Of course, there won’t be any output because the server starts without any tables. Since the server is empty, you should create tables before every integration test, using <code>createTable()</code> from <a href="http://docs.aws.amazon.com/AWSJavaSDK/latest/javadoc/com/amazonaws/services/dynamodbv2/package-summary.html">DynamoDB SDK</a>.</p><p>To avoid this type of extra hassle, in the latest version 0.6 of <a href="http://dynamodb.jcabi.com">jcabi-dynamodb-maven-plugin</a> <a href="https://github.com/jcabi/jcabi-dynamodb-maven-plugin/issues/16">we introduced</a> a new goal <a href="http://dynamodb.jcabi.com/example-create-tables.html"><code>create-tables</code></a>:</p><figure class="highlight"><pre><code class="language-xml" data-lang="xml"><span></span><span class="nt">&lt;plugin&gt;</span>
  <span class="nt">&lt;groupId&gt;</span>com.jcabi<span class="nt">&lt;/groupId&gt;</span>
  <span class="nt">&lt;artifactId&gt;</span>jcabi-dynamodb-maven-plugin<span class="nt">&lt;/artifactId&gt;</span>
  <span class="nt">&lt;executions&gt;</span>
    <span class="nt">&lt;execution&gt;</span>
      <span class="nt">&lt;goals&gt;</span>
        <span class="nt">&lt;goal&gt;</span>create-tables<span class="nt">&lt;/goal&gt;</span>
      <span class="nt">&lt;/goals&gt;</span>
      <span class="nt">&lt;configuration&gt;</span>
        <span class="nt">&lt;tables&gt;</span>
          <span class="nt">&lt;table&gt;</span>${basedir}/src/test/dynamodb/foo.json<span class="nt">&lt;/table&gt;</span>
        <span class="nt">&lt;/tables&gt;</span>
      <span class="nt">&lt;/configuration&gt;</span>
    <span class="nt">&lt;/execution&gt;</span>
  <span class="nt">&lt;/executions&gt;</span>
<span class="nt">&lt;/plugin&gt;</span></code></pre></figure><p>The <code>foo.json</code> file used above should contain a JSON request that is sent to DynamoDB Local right after it is up and running. The request should comply with the specification of <a href="http://docs.aws.amazon.com/amazondynamodb/latest/APIReference/API_CreateTable.html"><code>CreateTable</code></a> request. For example:</p><figure class="highlight"><pre><code class="language-json" data-lang="json"><span></span><span class="p">{</span>
  <span class="nt">&quot;AttributeDefinitions&quot;</span><span class="p">:</span> <span class="p">[</span>
    <span class="p">{</span>
      <span class="nt">&quot;AttributeName&quot;</span><span class="p">:</span> <span class="s2">&quot;id&quot;</span><span class="p">,</span>
      <span class="nt">&quot;AttributeType&quot;</span><span class="p">:</span> <span class="s2">&quot;N&quot;</span>
    <span class="p">}</span>
  <span class="p">],</span>
  <span class="nt">&quot;KeySchema&quot;</span><span class="p">:</span> <span class="p">[</span>
    <span class="p">{</span>
      <span class="nt">&quot;AttributeName&quot;</span><span class="p">:</span> <span class="s2">&quot;id&quot;</span><span class="p">,</span>
      <span class="nt">&quot;KeyType&quot;</span><span class="p">:</span> <span class="s2">&quot;HASH&quot;</span>
    <span class="p">}</span>
  <span class="p">],</span>
  <span class="nt">&quot;ProvisionedThroughput&quot;</span><span class="p">:</span> <span class="p">{</span>
    <span class="nt">&quot;ReadCapacityUnits&quot;</span><span class="p">:</span> <span class="s2">&quot;1&quot;</span><span class="p">,</span>
    <span class="nt">&quot;WriteCapacityUnits&quot;</span><span class="p">:</span> <span class="s2">&quot;1&quot;</span>
  <span class="p">},</span>
  <span class="nt">&quot;TableName&quot;</span><span class="p">:</span> <span class="s2">&quot;foo&quot;</span>
<span class="p">}</span></code></pre></figure><p>The table will be created during the <code>pre-integration-test</code> phase and dropped at the <code>post-integration-test</code> phase. Now, we can make our integration test much more meaningful with the help of <a href="http://dynamo.jcabi.com">jcabi-dynamo</a>:</p><figure class="highlight"><pre><code class="language-java" data-lang="java"><span></span><span class="kn">import</span> <span class="nn">com.jcabi.dynamo.Attributes</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">com.jcabi.dynamo.Conditions</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">com.jcabi.dynamo.Credentials</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">com.jcabi.dynamo.Region</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">com.jcabi.dynamo.Table</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">org.hamcrest.MatcherAssert</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">org.hamcrest.Matchers</span><span class="o">;</span>
<span class="kd">public</span> <span class="kd">class</span> <span class="nc">FooITCase</span> <span class="o">{</span>
  <span class="nd">@Test</span>
  <span class="kd">public</span> <span class="kt">void</span> <span class="nf">worksWithAwsDynamoDb</span><span class="o">()</span> <span class="o">{</span>
    <span class="n">Region</span> <span class="n">region</span> <span class="o">=</span> <span class="k">new</span> <span class="n">Region</span><span class="o">.</span><span class="na">Simple</span><span class="o">(</span><span class="k">new</span> <span class="n">Credentials</span><span class="o">.</span><span class="na">Simple</span><span class="o">(</span><span class="s">&quot;&quot;</span><span class="o">,</span> <span class="s">&quot;&quot;</span><span class="o">));</span>
    <span class="n">Table</span> <span class="n">table</span> <span class="o">=</span> <span class="n">region</span><span class="o">.</span><span class="na">table</span><span class="o">(</span><span class="s">&quot;foo&quot;</span><span class="o">);</span>
    <span class="n">table</span><span class="o">.</span><span class="na">put</span><span class="o">(</span>
      <span class="k">new</span> <span class="n">Attributes</span><span class="o">()</span>
        <span class="o">.</span><span class="na">with</span><span class="o">(</span><span class="s">&quot;id&quot;</span><span class="o">,</span> <span class="mi">123</span><span class="o">)</span>
        <span class="o">.</span><span class="na">with</span><span class="o">(</span><span class="s">&quot;name&quot;</span><span class="o">,</span> <span class="s">&quot;Robert DeNiro&quot;</span><span class="o">)</span>
    <span class="o">);</span>
    <span class="n">MatcherAssert</span><span class="o">.</span><span class="na">assertThat</span><span class="o">(</span>
      <span class="n">table</span><span class="o">.</span><span class="na">frame</span><span class="o">().</span><span class="na">where</span><span class="o">(</span><span class="s">&quot;id&quot;</span><span class="o">,</span> <span class="n">Conditions</span><span class="o">.</span><span class="na">equalTo</span><span class="o">(</span><span class="mi">123</span><span class="o">)),</span>
      <span class="n">Matchers</span><span class="o">.</span><span class="na">notEmpty</span><span class="o">()</span>
    <span class="o">);</span>
  <span class="o">}</span>
<span class="o">}</span></code></pre></figure><p>The above test will put a new item into the table and then assert that the item is there.</p><p>The plugin was tested with three operating systems, and proved to work without problems: Mac OS X 10.8.5, Windows 7 SP1 and Ubuntu Linux 12.04 Desktop.</p>"/> <meta name="twitter:url" property="og:url" content="https://www.yegor256.com/2014/05/01/dynamodb-local-maven-plugin.html"/> <meta name="telegram:channel" content="AAAAAEJFMRzsRTRxM3ec6A"/> <link rel="search" type="application/opensearchdescription+xml" href="/opensearch.xml" title="yegor256" /> <link rel="shortcut icon" href="/favicon.ico?ddf57a1cee0"/> <link rel="apple-touch-icon" href="/favicon.ico?ddf57a1cee0"/> <link rel="alternate" type="application/rss+xml" title="RSS for yegor256.com" href="https://www.yegor256.com/rss.xml"/> <link rel="stylesheet" href="/css/layout.css?ddf57a1cee0"/> <link rel="stylesheet" href="/css/icons.css?ddf57a1cee0"/> <link rel="canonical" href="https://www.yegor256.com/2014/05/01/dynamodb-local-maven-plugin.html" /> <link rel="amphtml" href="https://www.yegor256.com/2014/05/01/dynamodb-local-maven-plugin.amp.html" /> <title>DynamoDB Local Maven Plugin </title> </head> <body><div class="wrapper"> <aside class="header-toggle unprintable" id="header-toggle" title="Show the menu" onclick="$('#header').show();$('#header-toggle').hide();">&#9776;</aside> <header class="header" id="header"><div class="face"> <a href="/about-me.html#form" class="sub" title="Click to subscribe to my monthly newsletter"><span>Subscribe</span></a> <a href="/about-me.html" style="position:relative;"> <img src="/images/face-256x256.jpg" class="photo" alt="Yegor Bugayenko"/> </a></div><nav><ul class="menu social notranslate"> <li><a href="https://twitter.com/intent/follow?screen_name=yegor256" rel="nofollow" title="Follow me on Twitter"><i class="icon icon-twitter notranslate" aria-hidden="true"></i></a></li> <li><a href="/rss.xml" rel="nofollow" title="Subscribe to my RSS feed"><i class="icon icon-rss notranslate" aria-hidden="true"></i></a></li> <li><a itemprop="sameAs" href="https://github.com/yegor256" rel="nofollow" title="My GitHub profile"><i class="icon icon-github notranslate" aria-hidden="true"></i></a></li> <li><a itemprop="sameAs" href="http://stackoverflow.com/users/187141/yegor256" rel="nofollow" title="My StackOverflow profile"><i class="icon icon-stackoverflow notranslate" aria-hidden="true"></i></a></li> <li><a itemprop="sameAs" href="https://www.facebook.com/yegor256" rel="nofollow" title="Follow me on Facebook"><i class="icon icon-facebook notranslate" aria-hidden="true"></i></a></li> <li><a itemprop="sameAs" href="https://instagram.com/yegor256" rel="nofollow" title="Follow me on Instagram"><i class="icon icon-instagram notranslate" aria-hidden="true"></i></a></li> <li><a itemprop="sameAs" href="https://www.linkedin.com/in/yegor256" rel="nofollow" title="My LinkedIn profile"><i class="icon icon-linkedin notranslate" aria-hidden="true"></i></a></li> <li><a itemprop="sameAs" href="https://www.youtube.com/c/yegor256?sub_confirmation=1" rel="nofollow" title="My Youtube video channel"><i class="icon icon-youtube notranslate" aria-hidden="true"></i></a></li> <li><a itemprop="sameAs" href="https://www.pinterest.com/yegor256/" rel="nofollow" title="My Pinterest boards"><i class="icon icon-pinterest notranslate" aria-hidden="true"></i></a></li> <li><a itemprop="sameAs" href="https://angel.co/yegor256" rel="nofollow" title="My AngelList profile"><i class="icon icon-angellist notranslate" aria-hidden="true"></i></a></li> <li><a href="https://soundcloud.com/yegor256" rel="nofollow" title="My podcast"><i class="icon icon-podcast notranslate" aria-hidden="true"></i></a></li> <li><a href="https://itunes.apple.com/us/podcast/yegor256-podcast/id1150826721" rel="nofollow" title="My iTunes podcast"><i class="icon icon-itunes notranslate" aria-hidden="true"></i></a></li> <li><a href="https://t.me/yegor256news" rel="nofollow" title="My Telegram public channel"><i class="icon icon-telegram notranslate" aria-hidden="true"></i></a></li> <li><a href="mailto:blog@yegor256.com" rel="nofollow" title="Email me any time"><i class="icon icon-mail notranslate" aria-hidden="true"></i></a></li></ul><ul class="menu"> <li><a href="/" title="Home page">Home</a></li> <li /2014/05/01/dynamodb-local-maven-plugin.html><a href="/best.html" title="Best articles to read">12&#160;Best</a></li> <li /2014/05/01/dynamodb-local-maven-plugin.html><a href="/contents.html" title="The contents of the entire blog">All&#160;292</a></li> <li /2014/05/01/dynamodb-local-maven-plugin.html><a href="/webinars.html" title="My webinars">Webinars</a></li> <li /2014/05/01/dynamodb-local-maven-plugin.html><a href="/talks.html" title="Future and past conference talks">Talks</a></li> <li /2014/05/01/dynamodb-local-maven-plugin.html><a href="/books.html" title="The books I wrote">Books</a></li> <li /2014/05/01/dynamodb-local-maven-plugin.html><a href="/papers.html" title="My academic papers and patents">Papers</a></li> <li /2014/05/01/dynamodb-local-maven-plugin.html><a href="/pets.html" title="My loved pet projects">Pets</a></li> <li /2014/05/01/dynamodb-local-maven-plugin.html class="highlighted"><a href="/trainings.html" title="On-site trainings">Trainings</a></li> <li /2014/05/01/dynamodb-local-maven-plugin.html><a href="/award.html" title="Software quality award">Award</a></li> <li /2014/05/01/dynamodb-local-maven-plugin.html><a href="/testimonials.html" title="What some people say about me">Testimonials</a></li> <li /2014/05/01/dynamodb-local-maven-plugin.html><a href="/shift-m.html" title="Audio podcast about project management">Shift-M</a></li> <li /2014/05/01/dynamodb-local-maven-plugin.html><a href="/paintings.html" title="My paintings for sale">Paintings</a></li> <li><a href="https://ru.yegor256.com/" title="Немного на русском языке">По-русски</a></li></ul></nav><div class="search"> <form method="get" action="https://www.google.com/search" itemprop="potentialAction" itemscope="" itemtype="http://schema.org/SearchAction"> <meta itemprop="target" content="https://www.google.com/search?q={q}"/> <input name="sitesearch" value="yegor256.com" type="hidden"/> <input itemprop="query-input" type="text" id="search-query" class="field field-text" required="required" onfocus="$('.google').css('visibility', 'visible');" name="q" placeholder="Search..." autocomplete="off"/> <input type="image" src="/images/google-search-icon.svg" class="google" title="Search via Google" alt="Search via Google"/> </form></div><div class="hot"><ul></ul></div></header></div><section itemscope="" itemtype="http://schema.org/BlogPosting"><div class="wrapper"> <header><p class="printable"> <img src="https://api.qrserver.com/v1/create-qr-code/?data=https://www.yegor256.com/2014/05/01/dynamodb-local-maven-plugin.html&amp;format=svg" style="width:125px;height:125px;" alt="QR code"/></p><p class="printable"> <code itemprop="url">https://www.yegor256.com/2014/05/01/dynamodb-local-maven-plugin.html</code></p><h1 itemprop="name headline mainEntityOfPage">DynamoDB Local Maven Plugin</h1><ul class="subline"> <li> <time itemprop="datePublished" datetime="2014-05-01T00:00:00+00:00"> 1 May 2014 </time> </li> <li class="printable" itemscope="" itemprop="author" itemtype="http://schema.org/Person"> <span itemprop="name">Yegor Bugayenko</span> </li> <li class="unprintable"> <i class="icon icon-comments"></i> <a href="https://www.yegor256.com/2014/05/01/dynamodb-local-maven-plugin.html#disqus_thread" itemprop="discussionUrl">comments</a> </li></ul><p class="unprintable"><figure class="badge"><a href="http://aws.amazon.com/dynamodb"><img src="https://www.yegor256.com/images/2014/04/dynamodb-logo.png" style="width:150px;max-width:100%;" alt="badge" /></a></figure><p><a href="http://docs.aws.amazon.com/amazondynamodb/latest/developerguide/Tools.html">DynamoDB Local</a> is a locally running copy of Amazon DynamoDB server. Amazon developed the tool and based it on SQLite. It acts as a real DynamoDB service through the RESTful API.</p><p>I guess, DynamoDB Local is meant to be used in integration testing and this is how we’re going to use it below.</p><p>I use Maven to run all of my Java integration testing using <a href="http://maven.apache.org/surefire/maven-failsafe-plugin/"><code>maven-failsafe-plugin</code></a>. The philosophy of integration testing with Maven is that you start all your supplementary test stubs during the <code>pre-integration-test</code> phase, run your tests in the <code>integration-test</code> phase and then shutdown all stubs during the <code>post-integration-test</code>.</p><figure class="badge"><a href="http://dynamodb.jcabi.com"><img src="http://img.jcabi.com/logo-square.svg" style="width:64px;max-width:100%;" alt="badge" /></a></figure><p>It would be great if it were possible to use DynamoDB Local that way. I didn’t find any Maven plugins for that purpose, so I decided to create my own—<a href="https://github.com/jcabi/jcabi-dynamodb-maven-plugin">jcabi-dynamodb-maven-plugin</a>.</p><p>Full usage details for the plugin are explained on <a href="http://dynamodb.jcabi.com">its website</a>. However, here is a simple example (get its latest versions in <a href="http://search.maven.org/">Maven Central</a>):</p><figure class="highlight"><pre><code class="language-xml" data-lang="xml"><span></span><span class="nt">&lt;plugin&gt;</span>
  <span class="nt">&lt;groupId&gt;</span>com.jcabi<span class="nt">&lt;/groupId&gt;</span>
  <span class="nt">&lt;artifactId&gt;</span>jcabi-dynamodb-maven-plugin<span class="nt">&lt;/artifactId&gt;</span>
  <span class="nt">&lt;executions&gt;</span>
    <span class="nt">&lt;execution&gt;</span>
      <span class="nt">&lt;goals&gt;</span>
        <span class="nt">&lt;goal&gt;</span>start<span class="nt">&lt;/goal&gt;</span>
        <span class="nt">&lt;goal&gt;</span>stop<span class="nt">&lt;/goal&gt;</span>
      <span class="nt">&lt;/goals&gt;</span>
      <span class="nt">&lt;configuration&gt;</span>
        <span class="nt">&lt;port&gt;</span>10500<span class="nt">&lt;/port&gt;</span>
        <span class="nt">&lt;dist&gt;</span>${project.build.directory}/dynamodb-dist<span class="nt">&lt;/dist&gt;</span>
      <span class="nt">&lt;/configuration&gt;</span>
    <span class="nt">&lt;/execution&gt;</span>
  <span class="nt">&lt;/executions&gt;</span>
<span class="nt">&lt;/plugin&gt;</span></code></pre></figure><p>The above configuration will start DynamoDB Local right before running integration tests, and then stop it immediately afterwards. The server will listen at TCP port 10500. While the number is used in the example, you’re supposed to use a randomly allocated port instead.</p><p>When the DynamoDB Local server is up and running, we can create an integration test for it:</p><figure class="highlight"><pre><code class="language-java" data-lang="java"><span></span><span class="kn">import</span> <span class="nn">com.amazonaws.auth.BasicAWSCredentials</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">com.amazonaws.services.dynamodbv2.AmazonDynamoDB</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">com.amazonaws.services.dynamodbv2.AmazonDynamoDBClient</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">com.amazonaws.services.dynamodbv2.model.ListTablesResult</span><span class="o">;</span>
<span class="kd">public</span> <span class="kd">class</span> <span class="nc">FooITCase</span> <span class="o">{</span>
  <span class="nd">@Test</span>
  <span class="kd">public</span> <span class="kt">void</span> <span class="nf">worksWithAwsDynamoDb</span><span class="o">()</span> <span class="o">{</span>
    <span class="n">AmazonDynamoDB</span> <span class="n">aws</span> <span class="o">=</span> <span class="k">new</span> <span class="n">AmazonDynamoDBClient</span><span class="o">(</span>
      <span class="k">new</span> <span class="n">BasicAWSCredentials</span><span class="o">(</span><span class="s">&quot;&quot;</span><span class="o">,</span> <span class="s">&quot;&quot;</span><span class="o">)</span>
    <span class="o">);</span>
    <span class="n">aws</span><span class="o">.</span><span class="na">setEndpoint</span><span class="o">(</span><span class="s">&quot;http://localhost:10500&quot;</span><span class="o">);</span>
    <span class="n">ListTablesResult</span> <span class="n">list</span> <span class="o">=</span> <span class="n">aws</span><span class="o">.</span><span class="na">listTables</span><span class="o">();</span>
    <span class="k">for</span> <span class="o">(</span><span class="n">String</span> <span class="n">name</span> <span class="o">:</span> <span class="n">list</span><span class="o">.</span><span class="na">getTableNames</span><span class="o">())</span> <span class="o">{</span>
      <span class="n">System</span><span class="o">.</span><span class="na">out</span><span class="o">.</span><span class="na">println</span><span class="o">(</span><span class="s">&quot;table found: &quot;</span> <span class="o">+</span> <span class="n">name</span><span class="o">);</span>
    <span class="o">}</span>
  <span class="o">}</span>
<span class="o">}</span></code></pre></figure><p>Of course, there won’t be any output because the server starts without any tables. Since the server is empty, you should create tables before every integration test, using <code>createTable()</code> from <a href="http://docs.aws.amazon.com/AWSJavaSDK/latest/javadoc/com/amazonaws/services/dynamodbv2/package-summary.html">DynamoDB SDK</a>.</p><p>To avoid this type of extra hassle, in the latest version 0.6 of <a href="http://dynamodb.jcabi.com">jcabi-dynamodb-maven-plugin</a> <a href="https://github.com/jcabi/jcabi-dynamodb-maven-plugin/issues/16">we introduced</a> a new goal <a href="http://dynamodb.jcabi.com/example-create-tables.html"><code>create-tables</code></a>:</p><figure class="highlight"><pre><code class="language-xml" data-lang="xml"><span></span><span class="nt">&lt;plugin&gt;</span>
  <span class="nt">&lt;groupId&gt;</span>com.jcabi<span class="nt">&lt;/groupId&gt;</span>
  <span class="nt">&lt;artifactId&gt;</span>jcabi-dynamodb-maven-plugin<span class="nt">&lt;/artifactId&gt;</span>
  <span class="nt">&lt;executions&gt;</span>
    <span class="nt">&lt;execution&gt;</span>
      <span class="nt">&lt;goals&gt;</span>
        <span class="nt">&lt;goal&gt;</span>create-tables<span class="nt">&lt;/goal&gt;</span>
      <span class="nt">&lt;/goals&gt;</span>
      <span class="nt">&lt;configuration&gt;</span>
        <span class="nt">&lt;tables&gt;</span>
          <span class="nt">&lt;table&gt;</span>${basedir}/src/test/dynamodb/foo.json<span class="nt">&lt;/table&gt;</span>
        <span class="nt">&lt;/tables&gt;</span>
      <span class="nt">&lt;/configuration&gt;</span>
    <span class="nt">&lt;/execution&gt;</span>
  <span class="nt">&lt;/executions&gt;</span>
<span class="nt">&lt;/plugin&gt;</span></code></pre></figure><p>The <code>foo.json</code> file used above should contain a JSON request that is sent to DynamoDB Local right after it is up and running. The request should comply with the specification of <a href="http://docs.aws.amazon.com/amazondynamodb/latest/APIReference/API_CreateTable.html"><code>CreateTable</code></a> request. For example:</p><figure class="highlight"><pre><code class="language-json" data-lang="json"><span></span><span class="p">{</span>
  <span class="nt">&quot;AttributeDefinitions&quot;</span><span class="p">:</span> <span class="p">[</span>
    <span class="p">{</span>
      <span class="nt">&quot;AttributeName&quot;</span><span class="p">:</span> <span class="s2">&quot;id&quot;</span><span class="p">,</span>
      <span class="nt">&quot;AttributeType&quot;</span><span class="p">:</span> <span class="s2">&quot;N&quot;</span>
    <span class="p">}</span>
  <span class="p">],</span>
  <span class="nt">&quot;KeySchema&quot;</span><span class="p">:</span> <span class="p">[</span>
    <span class="p">{</span>
      <span class="nt">&quot;AttributeName&quot;</span><span class="p">:</span> <span class="s2">&quot;id&quot;</span><span class="p">,</span>
      <span class="nt">&quot;KeyType&quot;</span><span class="p">:</span> <span class="s2">&quot;HASH&quot;</span>
    <span class="p">}</span>
  <span class="p">],</span>
  <span class="nt">&quot;ProvisionedThroughput&quot;</span><span class="p">:</span> <span class="p">{</span>
    <span class="nt">&quot;ReadCapacityUnits&quot;</span><span class="p">:</span> <span class="s2">&quot;1&quot;</span><span class="p">,</span>
    <span class="nt">&quot;WriteCapacityUnits&quot;</span><span class="p">:</span> <span class="s2">&quot;1&quot;</span>
  <span class="p">},</span>
  <span class="nt">&quot;TableName&quot;</span><span class="p">:</span> <span class="s2">&quot;foo&quot;</span>
<span class="p">}</span></code></pre></figure><p>The table will be created during the <code>pre-integration-test</code> phase and dropped at the <code>post-integration-test</code> phase. Now, we can make our integration test much more meaningful with the help of <a href="http://dynamo.jcabi.com">jcabi-dynamo</a>:</p><figure class="highlight"><pre><code class="language-java" data-lang="java"><span></span><span class="kn">import</span> <span class="nn">com.jcabi.dynamo.Attributes</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">com.jcabi.dynamo.Conditions</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">com.jcabi.dynamo.Credentials</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">com.jcabi.dynamo.Region</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">com.jcabi.dynamo.Table</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">org.hamcrest.MatcherAssert</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">org.hamcrest.Matchers</span><span class="o">;</span>
<span class="kd">public</span> <span class="kd">class</span> <span class="nc">FooITCase</span> <span class="o">{</span>
  <span class="nd">@Test</span>
  <span class="kd">public</span> <span class="kt">void</span> <span class="nf">worksWithAwsDynamoDb</span><span class="o">()</span> <span class="o">{</span>
    <span class="n">Region</span> <span class="n">region</span> <span class="o">=</span> <span class="k">new</span> <span class="n">Region</span><span class="o">.</span><span class="na">Simple</span><span class="o">(</span><span class="k">new</span> <span class="n">Credentials</span><span class="o">.</span><span class="na">Simple</span><span class="o">(</span><span class="s">&quot;&quot;</span><span class="o">,</span> <span class="s">&quot;&quot;</span><span class="o">));</span>
    <span class="n">Table</span> <span class="n">table</span> <span class="o">=</span> <span class="n">region</span><span class="o">.</span><span class="na">table</span><span class="o">(</span><span class="s">&quot;foo&quot;</span><span class="o">);</span>
    <span class="n">table</span><span class="o">.</span><span class="na">put</span><span class="o">(</span>
      <span class="k">new</span> <span class="n">Attributes</span><span class="o">()</span>
        <span class="o">.</span><span class="na">with</span><span class="o">(</span><span class="s">&quot;id&quot;</span><span class="o">,</span> <span class="mi">123</span><span class="o">)</span>
        <span class="o">.</span><span class="na">with</span><span class="o">(</span><span class="s">&quot;name&quot;</span><span class="o">,</span> <span class="s">&quot;Robert DeNiro&quot;</span><span class="o">)</span>
    <span class="o">);</span>
    <span class="n">MatcherAssert</span><span class="o">.</span><span class="na">assertThat</span><span class="o">(</span>
      <span class="n">table</span><span class="o">.</span><span class="na">frame</span><span class="o">().</span><span class="na">where</span><span class="o">(</span><span class="s">&quot;id&quot;</span><span class="o">,</span> <span class="n">Conditions</span><span class="o">.</span><span class="na">equalTo</span><span class="o">(</span><span class="mi">123</span><span class="o">)),</span>
      <span class="n">Matchers</span><span class="o">.</span><span class="na">notEmpty</span><span class="o">()</span>
    <span class="o">);</span>
  <span class="o">}</span>
<span class="o">}</span></code></pre></figure><p>The above test will put a new item into the table and then assert that the item is there.</p><p>The plugin was tested with three operating systems, and proved to work without problems: Mac OS X 10.8.5, Windows 7 SP1 and Ubuntu Linux 12.04 Desktop.</p></p><nav class="buttons notranslate desktop-only"> <a href="http://www.facebook.com/sharer/sharer.php?u=https://www.yegor256.com/2014/05/01/dynamodb-local-maven-plugin.html" title="Share on Facebook" class="button" rel="nofollow"> <span class="count count-facebook">0</span> <i class="icon icon-facebook notranslate" aria-hidden="true"></i> </a> <a href="https://twitter.com/share?url=https://www.yegor256.com/2014/05/01/dynamodb-local-maven-plugin.html&amp;text=DynamoDB+Local+Maven+Plugin" title="Share on Twitter" class="button" rel="nofollow"> <span class="count count-twitter">0</span> <i class="icon icon-twitter notranslate" aria-hidden="true"></i> </a> <a href="https://plus.google.com/share?url=https://www.yegor256.com/2014/05/01/dynamodb-local-maven-plugin.html" title="Share on Google+" class="button" rel="nofollow"> <span class="count count-googleplus">0</span> <i class="icon icon-googleplus notranslate" aria-hidden="true"></i> </a> <a href="https://www.linkedin.com/cws/share?url=https://www.yegor256.com/2014/05/01/dynamodb-local-maven-plugin.html" title="Share on LinkedIn" class="button" rel="nofollow"> <span class="count count-linkedin">0</span> <i class="icon icon-linkedin notranslate" aria-hidden="true"></i> </a> <a href="http://reddit.com/submit?url=https://www.yegor256.com/2014/05/01/dynamodb-local-maven-plugin.html%3F2014-17&amp;title=DynamoDB+Local+Maven+Plugin" title="Share on Reddit" class="button" rel="nofollow"> <span class="count count-reddit">0</span> <i class="icon icon-reddit notranslate" aria-hidden="true"></i> </a> <a href="http://news.ycombinator.com/submitlink?u=https://www.yegor256.com/2014/05/01/dynamodb-local-maven-plugin.html%3F2014-17&amp;t=DynamoDB+Local+Maven+Plugin" title="Share on Hacker News" class="button" rel="nofollow"> <span class="count count-hackernews">0</span> <i class="icon icon-hackernews notranslate" aria-hidden="true"></i> </a> </nav> </header> <article class="main" itemprop="articleBody"><div > <figure class="badge"><a href="http://aws.amazon.com/dynamodb"><img src="https://www.yegor256.com/images/2014/04/dynamodb-logo.png" style="width:150px;max-width:100%;" alt="badge" /></a></figure><p><a href="http://docs.aws.amazon.com/amazondynamodb/latest/developerguide/Tools.html">DynamoDB Local</a> is a locally running copy of Amazon DynamoDB server. Amazon developed the tool and based it on SQLite. It acts as a real DynamoDB service through the RESTful API.</p><p>I guess, DynamoDB Local is meant to be used in integration testing and this is how we’re going to use it below.</p><p>I use Maven to run all of my Java integration testing using <a href="http://maven.apache.org/surefire/maven-failsafe-plugin/"><code>maven-failsafe-plugin</code></a>. The philosophy of integration testing with Maven is that you start all your supplementary test stubs during the <code>pre-integration-test</code> phase, run your tests in the <code>integration-test</code> phase and then shutdown all stubs during the <code>post-integration-test</code>.</p><figure class="badge"><a href="http://dynamodb.jcabi.com"><img src="http://img.jcabi.com/logo-square.svg" style="width:64px;max-width:100%;" alt="badge" /></a></figure><p>It would be great if it were possible to use DynamoDB Local that way. I didn’t find any Maven plugins for that purpose, so I decided to create my own—<a href="https://github.com/jcabi/jcabi-dynamodb-maven-plugin">jcabi-dynamodb-maven-plugin</a>.</p><p>Full usage details for the plugin are explained on <a href="http://dynamodb.jcabi.com">its website</a>. However, here is a simple example (get its latest versions in <a href="http://search.maven.org/">Maven Central</a>):</p><figure class="highlight"><pre><code class="language-xml" data-lang="xml"><span></span><span class="nt">&lt;plugin&gt;</span>
  <span class="nt">&lt;groupId&gt;</span>com.jcabi<span class="nt">&lt;/groupId&gt;</span>
  <span class="nt">&lt;artifactId&gt;</span>jcabi-dynamodb-maven-plugin<span class="nt">&lt;/artifactId&gt;</span>
  <span class="nt">&lt;executions&gt;</span>
    <span class="nt">&lt;execution&gt;</span>
      <span class="nt">&lt;goals&gt;</span>
        <span class="nt">&lt;goal&gt;</span>start<span class="nt">&lt;/goal&gt;</span>
        <span class="nt">&lt;goal&gt;</span>stop<span class="nt">&lt;/goal&gt;</span>
      <span class="nt">&lt;/goals&gt;</span>
      <span class="nt">&lt;configuration&gt;</span>
        <span class="nt">&lt;port&gt;</span>10500<span class="nt">&lt;/port&gt;</span>
        <span class="nt">&lt;dist&gt;</span>${project.build.directory}/dynamodb-dist<span class="nt">&lt;/dist&gt;</span>
      <span class="nt">&lt;/configuration&gt;</span>
    <span class="nt">&lt;/execution&gt;</span>
  <span class="nt">&lt;/executions&gt;</span>
<span class="nt">&lt;/plugin&gt;</span></code></pre></figure><p>The above configuration will start DynamoDB Local right before running integration tests, and then stop it immediately afterwards. The server will listen at TCP port 10500. While the number is used in the example, you’re supposed to use a randomly allocated port instead.</p><p>When the DynamoDB Local server is up and running, we can create an integration test for it:</p><figure class="highlight"><pre><code class="language-java" data-lang="java"><span></span><span class="kn">import</span> <span class="nn">com.amazonaws.auth.BasicAWSCredentials</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">com.amazonaws.services.dynamodbv2.AmazonDynamoDB</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">com.amazonaws.services.dynamodbv2.AmazonDynamoDBClient</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">com.amazonaws.services.dynamodbv2.model.ListTablesResult</span><span class="o">;</span>
<span class="kd">public</span> <span class="kd">class</span> <span class="nc">FooITCase</span> <span class="o">{</span>
  <span class="nd">@Test</span>
  <span class="kd">public</span> <span class="kt">void</span> <span class="nf">worksWithAwsDynamoDb</span><span class="o">()</span> <span class="o">{</span>
    <span class="n">AmazonDynamoDB</span> <span class="n">aws</span> <span class="o">=</span> <span class="k">new</span> <span class="n">AmazonDynamoDBClient</span><span class="o">(</span>
      <span class="k">new</span> <span class="n">BasicAWSCredentials</span><span class="o">(</span><span class="s">&quot;&quot;</span><span class="o">,</span> <span class="s">&quot;&quot;</span><span class="o">)</span>
    <span class="o">);</span>
    <span class="n">aws</span><span class="o">.</span><span class="na">setEndpoint</span><span class="o">(</span><span class="s">&quot;http://localhost:10500&quot;</span><span class="o">);</span>
    <span class="n">ListTablesResult</span> <span class="n">list</span> <span class="o">=</span> <span class="n">aws</span><span class="o">.</span><span class="na">listTables</span><span class="o">();</span>
    <span class="k">for</span> <span class="o">(</span><span class="n">String</span> <span class="n">name</span> <span class="o">:</span> <span class="n">list</span><span class="o">.</span><span class="na">getTableNames</span><span class="o">())</span> <span class="o">{</span>
      <span class="n">System</span><span class="o">.</span><span class="na">out</span><span class="o">.</span><span class="na">println</span><span class="o">(</span><span class="s">&quot;table found: &quot;</span> <span class="o">+</span> <span class="n">name</span><span class="o">);</span>
    <span class="o">}</span>
  <span class="o">}</span>
<span class="o">}</span></code></pre></figure><p>Of course, there won’t be any output because the server starts without any tables. Since the server is empty, you should create tables before every integration test, using <code>createTable()</code> from <a href="http://docs.aws.amazon.com/AWSJavaSDK/latest/javadoc/com/amazonaws/services/dynamodbv2/package-summary.html">DynamoDB SDK</a>.</p><p>To avoid this type of extra hassle, in the latest version 0.6 of <a href="http://dynamodb.jcabi.com">jcabi-dynamodb-maven-plugin</a> <a href="https://github.com/jcabi/jcabi-dynamodb-maven-plugin/issues/16">we introduced</a> a new goal <a href="http://dynamodb.jcabi.com/example-create-tables.html"><code>create-tables</code></a>:</p><figure class="highlight"><pre><code class="language-xml" data-lang="xml"><span></span><span class="nt">&lt;plugin&gt;</span>
  <span class="nt">&lt;groupId&gt;</span>com.jcabi<span class="nt">&lt;/groupId&gt;</span>
  <span class="nt">&lt;artifactId&gt;</span>jcabi-dynamodb-maven-plugin<span class="nt">&lt;/artifactId&gt;</span>
  <span class="nt">&lt;executions&gt;</span>
    <span class="nt">&lt;execution&gt;</span>
      <span class="nt">&lt;goals&gt;</span>
        <span class="nt">&lt;goal&gt;</span>create-tables<span class="nt">&lt;/goal&gt;</span>
      <span class="nt">&lt;/goals&gt;</span>
      <span class="nt">&lt;configuration&gt;</span>
        <span class="nt">&lt;tables&gt;</span>
          <span class="nt">&lt;table&gt;</span>${basedir}/src/test/dynamodb/foo.json<span class="nt">&lt;/table&gt;</span>
        <span class="nt">&lt;/tables&gt;</span>
      <span class="nt">&lt;/configuration&gt;</span>
    <span class="nt">&lt;/execution&gt;</span>
  <span class="nt">&lt;/executions&gt;</span>
<span class="nt">&lt;/plugin&gt;</span></code></pre></figure><p>The <code>foo.json</code> file used above should contain a JSON request that is sent to DynamoDB Local right after it is up and running. The request should comply with the specification of <a href="http://docs.aws.amazon.com/amazondynamodb/latest/APIReference/API_CreateTable.html"><code>CreateTable</code></a> request. For example:</p><figure class="highlight"><pre><code class="language-json" data-lang="json"><span></span><span class="p">{</span>
  <span class="nt">&quot;AttributeDefinitions&quot;</span><span class="p">:</span> <span class="p">[</span>
    <span class="p">{</span>
      <span class="nt">&quot;AttributeName&quot;</span><span class="p">:</span> <span class="s2">&quot;id&quot;</span><span class="p">,</span>
      <span class="nt">&quot;AttributeType&quot;</span><span class="p">:</span> <span class="s2">&quot;N&quot;</span>
    <span class="p">}</span>
  <span class="p">],</span>
  <span class="nt">&quot;KeySchema&quot;</span><span class="p">:</span> <span class="p">[</span>
    <span class="p">{</span>
      <span class="nt">&quot;AttributeName&quot;</span><span class="p">:</span> <span class="s2">&quot;id&quot;</span><span class="p">,</span>
      <span class="nt">&quot;KeyType&quot;</span><span class="p">:</span> <span class="s2">&quot;HASH&quot;</span>
    <span class="p">}</span>
  <span class="p">],</span>
  <span class="nt">&quot;ProvisionedThroughput&quot;</span><span class="p">:</span> <span class="p">{</span>
    <span class="nt">&quot;ReadCapacityUnits&quot;</span><span class="p">:</span> <span class="s2">&quot;1&quot;</span><span class="p">,</span>
    <span class="nt">&quot;WriteCapacityUnits&quot;</span><span class="p">:</span> <span class="s2">&quot;1&quot;</span>
  <span class="p">},</span>
  <span class="nt">&quot;TableName&quot;</span><span class="p">:</span> <span class="s2">&quot;foo&quot;</span>
<span class="p">}</span></code></pre></figure><p>The table will be created during the <code>pre-integration-test</code> phase and dropped at the <code>post-integration-test</code> phase. Now, we can make our integration test much more meaningful with the help of <a href="http://dynamo.jcabi.com">jcabi-dynamo</a>:</p><figure class="highlight"><pre><code class="language-java" data-lang="java"><span></span><span class="kn">import</span> <span class="nn">com.jcabi.dynamo.Attributes</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">com.jcabi.dynamo.Conditions</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">com.jcabi.dynamo.Credentials</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">com.jcabi.dynamo.Region</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">com.jcabi.dynamo.Table</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">org.hamcrest.MatcherAssert</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">org.hamcrest.Matchers</span><span class="o">;</span>
<span class="kd">public</span> <span class="kd">class</span> <span class="nc">FooITCase</span> <span class="o">{</span>
  <span class="nd">@Test</span>
  <span class="kd">public</span> <span class="kt">void</span> <span class="nf">worksWithAwsDynamoDb</span><span class="o">()</span> <span class="o">{</span>
    <span class="n">Region</span> <span class="n">region</span> <span class="o">=</span> <span class="k">new</span> <span class="n">Region</span><span class="o">.</span><span class="na">Simple</span><span class="o">(</span><span class="k">new</span> <span class="n">Credentials</span><span class="o">.</span><span class="na">Simple</span><span class="o">(</span><span class="s">&quot;&quot;</span><span class="o">,</span> <span class="s">&quot;&quot;</span><span class="o">));</span>
    <span class="n">Table</span> <span class="n">table</span> <span class="o">=</span> <span class="n">region</span><span class="o">.</span><span class="na">table</span><span class="o">(</span><span class="s">&quot;foo&quot;</span><span class="o">);</span>
    <span class="n">table</span><span class="o">.</span><span class="na">put</span><span class="o">(</span>
      <span class="k">new</span> <span class="n">Attributes</span><span class="o">()</span>
        <span class="o">.</span><span class="na">with</span><span class="o">(</span><span class="s">&quot;id&quot;</span><span class="o">,</span> <span class="mi">123</span><span class="o">)</span>
        <span class="o">.</span><span class="na">with</span><span class="o">(</span><span class="s">&quot;name&quot;</span><span class="o">,</span> <span class="s">&quot;Robert DeNiro&quot;</span><span class="o">)</span>
    <span class="o">);</span>
    <span class="n">MatcherAssert</span><span class="o">.</span><span class="na">assertThat</span><span class="o">(</span>
      <span class="n">table</span><span class="o">.</span><span class="na">frame</span><span class="o">().</span><span class="na">where</span><span class="o">(</span><span class="s">&quot;id&quot;</span><span class="o">,</span> <span class="n">Conditions</span><span class="o">.</span><span class="na">equalTo</span><span class="o">(</span><span class="mi">123</span><span class="o">)),</span>
      <span class="n">Matchers</span><span class="o">.</span><span class="na">notEmpty</span><span class="o">()</span>
    <span class="o">);</span>
  <span class="o">}</span>
<span class="o">}</span></code></pre></figure><p>The above test will put a new item into the table and then assert that the item is there.</p><p>The plugin was tested with three operating systems, and proved to work without problems: Mac OS X 10.8.5, Windows 7 SP1 and Ubuntu Linux 12.04 Desktop.</p></div></article></div><div class="wrapper"> <related-posts /></div><div class="disqus" role="complementary"><p class="disqus_hint"> Please, use <a href="https://help.disqus.com/commenting/what-html-tags-are-allowed-within-comments">syntax highlighting</a> in your comments, to make them more readable.</p><div id="disqus_thread" class="disqus-thread"> <a>&nbsp;</a></div><script> var disqus_config = function () { this.page.url = document.location.href.split('?')[0].split('#')[0].replace('https://', 'http://'); this.page.identifier = this.page.url; }; (function() { var d = document, s = d.createElement('script'); s.src = '//yegor256.disqus.com/embed.js'; s.setAttribute('data-timestamp', +new Date()); (d.head || d.body).appendChild(s); })(); </script> <noscript><div><p class="red"> JavaScript is disabled in your browser, that's why you can't see comments under this post.</p></div></noscript></div><div class="wrapper"> <footer class="footer"><p> &copy; <span itemscope="" itemprop="copyrightHolder" itemtype="http://schema.org/Person"> <span itemprop="name">Yegor Bugayenko</span> </span> 2014&ndash;<span itemprop="copyrightYear">2018</span></p></footer></div></section><div class="wrapper unprintable" style="text-align:center;margin-top:2em;"> <a href="http://www.sixnines.io/h/3ba1652f"> <img src="//www.sixnines.io/b/3ba1652f?style=flat" alt="sixnines availability badge"/> </a></div><script src="//code.jquery.com/jquery-1.9.0.min.js"></script> <script src="/js/all.js?ddf57a1cee0"></script> <script>var disqus_shortname = 'yegor256';</script> <script id="dsq-count-scr" src="//yegor256.disqus.com/count.js" async="async"></script> <script> (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){ (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o), m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m) })(window,document,'script','//www.google-analytics.com/analytics.js','ga'); ga('create', 'UA-1963507-32', 'auto'); ga('send', 'pageview'); </script> <script> Cd=document;Cr="&"+Math.random();Cp="&s=1"; Cd.cookie="b=b";if(Cd.cookie)Cp+="&c=1"; Cp+="&t="+(new Date()).getTimezoneOffset(); if(self!=top)Cp+="&f=1"; </script> <script> if(navigator.javaEnabled())Cp+="&j=1"; </script> <script> if(typeof(screen)!='undefined')Cp+="&w="+screen.width+"&h="+ screen.height+"&d="+(screen.colorDepth?screen.colorDepth:screen.pixelDepth); </script> <script> Cd.write("<img src='//c.hit.ua/hit?i=95870&g=0&x=2"+Cp+Cr+ "&r="+escape(Cd.referrer)+"&u="+escape(window.location.href)+ "' border='0' wi"+"dth='1' he"+"ight='1'/>"); </script> <script type="application/ld+json"> { "@context": "http://schema.org", "@type": "Person", "name": "Yegor Bugayenko", "url": "https://www.yegor256.com", "sameAs": [ "https://www.facebook.com/yegor256", "https://instagram.com/yegor256", "https://www.linkedin.com/in/yegor256", "https://twitter.com/yegor256", "https://github.com/yegor256", "https://www.pinterest.com/yegor256/" ] } </script> </body> </html> <!DOCTYPE html> <html xmlns="http://www.w3.org/1999/xhtml" lang="en-US" xml:lang="en-US" itemscope="" itemtype="http://schema.org/WebSite"> <head> <meta charset="utf-8"/> <meta name="description" content="<figure class="badge"><a href="http://www.s3auth.com"><img src="http://img.s3auth.com/logo.png" style="width:200px;max-width:100%;" alt="badge" /></a></figure><p><a href="http://aws.amazon.com/s3/">Amazon S3</a> is a simple and very useful storage of binary objects (aka “files”). To use it, you create a “bucket” there with a unique name and upload your objects.</p><p>Afterwards, AWS guarantees your object will be available for download through their <a href="http://docs.aws.amazon.com/AmazonS3/latest/API/APIRest.html">RESTful API</a>.</p><p>A few years ago, AWS introduced a S3 feature called <a href="http://docs.aws.amazon.com/AmazonS3/latest/dev/WebsiteHosting.html">static website hosting</a>.</p><p>With static website hosting, you simply turn on the feature and all objects in your bucket become available through public HTTP. This is an awesome feature for hosting static content, such as images, JavaScript files, video and audio content.</p><p>When using the hosting, you need to change the CNAME record in your DNS so that it points to <code>www.example.com.aws.amazon.com</code>. After changing the DNS entry, your static website is available at <code>www.example.com</code> just as it would be normally.</p><p>When using Amazon S3, though, it is not possible to protect your website because the content is purely static. This means you can’t have a login page on the front end. With the service, you can either make your objects either absolutely public—so that anyone can see them online—or assign access rights to them—but only for users connected through RESTful API.</p><p>My use case with the service was a bit more complex, though. I wanted to host my static content as S3 objects. However, I wanted to do this while ensuring only a few people had access to the content using their Web browsers.</p><h2 id="http-basic-authentication">HTTP Basic Authentication</h2><p>The HTTP protocol offers a nice <a href="http://en.wikipedia.org/wiki/Basic_access_authentication">“basic access authentication”</a> feature that doesn’t require any extra site pages.</p><p>When an HTTP request arrives at the server, it doesn’t deliver the content but replies with a 401 status response. This response means literally “I don’t know who you are, please authenticate yourself.”</p><p>The browser shows its native login screen and prompts for a user name and password. After entering the login credentials, they are concatenated, <a href="http://en.wikipedia.org/wiki/Base64">Base64</a> encoded, and added to the next request in <code>Authorization</code> HTTP header.</p><figure class="unprintable"><img src="https://www.yegor256.com/images/2014/04/s3auth-authentication-dialog.png" itemprop="image" style="width:600px;max-width:100%;" alt="The figure" /></figure><p>Now, the browser tries to make another attempt to fetch the same webpage. But, this time, the HTTP request contains a header:</p><figure class="highlight"><pre><code class="language-text" data-lang="text"><span></span>Authorization: Basic am9lOnNlY3JldA==</code></pre></figure><p>The above is just an example. In the example, the Base64 encoded part means <code>joe:secret</code>, where <code>joe</code> is the user name and <code>secret</code> the password entered by the user.</p><p>This time the server has authentication information and can make a decision whether this user is authenticated (his password matches the server’s records) and authorized (he has permission to access the request webpage).</p><h2 id="s3authcom"><code>s3auth.com</code></h2><p>Since Amazon doesn’t provide this feature, I decided to create a simple web service, <a href="http://www.s3auth.com">s3auth.com</a>, which stays in front of my Amazon S3 buckets and implements the HTTP-native authentication and authorization mechanism.</p><p>Instead of making my objects public, though, I make them private and point my CNAME record to <code>relay.s3auth.com</code>. HTTP requests from Web browsers then arrive at my server, connect to Amazon S3, retrieve my objects and deliver them back in HTTP responses.</p><p>The server implements authentication and authorization using a special file <code>.htpasswd</code> in the root of my bucket. The format of the <code>.htpasswd</code> file is identical to the one used by <a href="http://httpd.apache.org/docs/2.2/programs/htpasswd.html">Apache HTTP Server</a>—one user per line. Every line has the name of a user and a hash version of his password.</p><h2 id="implementation">Implementation</h2><p>I made this software open source mostly to guarantee to my users that the server doesn’t store their private data anywhere, but rather acts only as a pass-through service. As a result, the software is on <a href="https://github.com/yegor256/s3auth">GitHub</a>.</p><p>For the sake of privacy and convenience, I use only OAuth2 for user accounts. This means that I don’t know who my users are. I don’t possess their names or emails, but only their account numbers in Facebook, Google Plus or GitHub. Of course, I can find their names using these numbers, but this information is public anyway.</p><p>The server is implemented in Java6. For its hosting, I’m using a single Amazon EC2 <a href="http://aws.amazon.com/ec2/instance-types/">m1.small</a> Ubuntu server. These days, the server seems to work properly and is stable.</p><h2 id="extra-features">Extra Features</h2><p>Besides authentication and authorization, the <a href="http://www.s3auth.com">s3auth.com</a> server can render lists of pages—just like Apache HTTP Server. If you have a collection of objects in your bucket—but the <code>index.html</code> file is missing—Amazon S3 delivers a “page not found” result. Conversely, my server displays a list of objects in the bucket, when no <code>index.html</code> is present, and makes it possible to navigate up or down one folder.</p><p>When your bucket has the versioning feature turned on, you are able to list all versions of any object in the browser. To do this, just add <code>?all-versions</code> to the end of the URL to display the list. Next, click a version to have <a href="http://www.s3auth.com">s3auth.com</a> retrieve and render it.</p><h2 id="traction">Traction</h2><p>I created this service mostly for myself, but apparently I’m not the only with the problems described above. At the moment, <a href="http://www.s3auth.com">s3auth.com</a> hosts over 300 domains and sends through more than 10Mb of data each hour.</p><p>PS. This post explains how <a href="http://www.s3auth.com">s3auth.com</a> can be used as a front-end to your Maven repository: <a href="/2015/09/07/maven-repository-amazon-s3.html">How to Set Up a Private Maven Repository in Amazon S3</a>.</p>" /> <meta name="keywords" content="next, path, output, content, previous, url, relative_path, id, collection, excerpt, draft, categories, layout, title, date, tags, description, keywords, slug, ext" /> <meta name="viewport" content="width=device-width,minimum-scale=1,initial-scale=1"/> <meta name="google-site-verification" content="JEj_gQr2CPe2QKGw8XdMz0R7VboQIUbX3FlM-lwTq-8" /> <meta name="author" content="Yegor Bugayenko"> <meta name="article:published_time" content="2014-04-21 00:00:00 +0000"> <meta name="og:site_name" content="Yegor Bugayenko"/> <meta name="og:type" content="article" /> <meta name="og:locale" content="en_US" /> <meta name="twitter:account_id" content="4503599630178231" /> <meta name="twitter:creator" content="@yegor256"/> <meta name="twitter:site" content="@yegor256"/> <meta name="twitter:title" property="og:title" content="Basic HTTP Auth for S3 Buckets"/> <meta name="twitter:description" property="og:description" content="<figure class="badge"><a href="http://www.s3auth.com"><img src="http://img.s3auth.com/logo.png" style="width:200px;max-width:100%;" alt="badge" /></a></figure><p><a href="http://aws.amazon.com/s3/">Amazon S3</a> is a simple and very useful storage of binary objects (aka “files”). To use it, you create a “bucket” there with a unique name and upload your objects.</p><p>Afterwards, AWS guarantees your object will be available for download through their <a href="http://docs.aws.amazon.com/AmazonS3/latest/API/APIRest.html">RESTful API</a>.</p><p>A few years ago, AWS introduced a S3 feature called <a href="http://docs.aws.amazon.com/AmazonS3/latest/dev/WebsiteHosting.html">static website hosting</a>.</p><p>With static website hosting, you simply turn on the feature and all objects in your bucket become available through public HTTP. This is an awesome feature for hosting static content, such as images, JavaScript files, video and audio content.</p><p>When using the hosting, you need to change the CNAME record in your DNS so that it points to <code>www.example.com.aws.amazon.com</code>. After changing the DNS entry, your static website is available at <code>www.example.com</code> just as it would be normally.</p><p>When using Amazon S3, though, it is not possible to protect your website because the content is purely static. This means you can’t have a login page on the front end. With the service, you can either make your objects either absolutely public—so that anyone can see them online—or assign access rights to them—but only for users connected through RESTful API.</p><p>My use case with the service was a bit more complex, though. I wanted to host my static content as S3 objects. However, I wanted to do this while ensuring only a few people had access to the content using their Web browsers.</p><h2 id="http-basic-authentication">HTTP Basic Authentication</h2><p>The HTTP protocol offers a nice <a href="http://en.wikipedia.org/wiki/Basic_access_authentication">“basic access authentication”</a> feature that doesn’t require any extra site pages.</p><p>When an HTTP request arrives at the server, it doesn’t deliver the content but replies with a 401 status response. This response means literally “I don’t know who you are, please authenticate yourself.”</p><p>The browser shows its native login screen and prompts for a user name and password. After entering the login credentials, they are concatenated, <a href="http://en.wikipedia.org/wiki/Base64">Base64</a> encoded, and added to the next request in <code>Authorization</code> HTTP header.</p><figure class="unprintable"><img src="https://www.yegor256.com/images/2014/04/s3auth-authentication-dialog.png" itemprop="image" style="width:600px;max-width:100%;" alt="The figure" /></figure><p>Now, the browser tries to make another attempt to fetch the same webpage. But, this time, the HTTP request contains a header:</p><figure class="highlight"><pre><code class="language-text" data-lang="text"><span></span>Authorization: Basic am9lOnNlY3JldA==</code></pre></figure><p>The above is just an example. In the example, the Base64 encoded part means <code>joe:secret</code>, where <code>joe</code> is the user name and <code>secret</code> the password entered by the user.</p><p>This time the server has authentication information and can make a decision whether this user is authenticated (his password matches the server’s records) and authorized (he has permission to access the request webpage).</p><h2 id="s3authcom"><code>s3auth.com</code></h2><p>Since Amazon doesn’t provide this feature, I decided to create a simple web service, <a href="http://www.s3auth.com">s3auth.com</a>, which stays in front of my Amazon S3 buckets and implements the HTTP-native authentication and authorization mechanism.</p><p>Instead of making my objects public, though, I make them private and point my CNAME record to <code>relay.s3auth.com</code>. HTTP requests from Web browsers then arrive at my server, connect to Amazon S3, retrieve my objects and deliver them back in HTTP responses.</p><p>The server implements authentication and authorization using a special file <code>.htpasswd</code> in the root of my bucket. The format of the <code>.htpasswd</code> file is identical to the one used by <a href="http://httpd.apache.org/docs/2.2/programs/htpasswd.html">Apache HTTP Server</a>—one user per line. Every line has the name of a user and a hash version of his password.</p><h2 id="implementation">Implementation</h2><p>I made this software open source mostly to guarantee to my users that the server doesn’t store their private data anywhere, but rather acts only as a pass-through service. As a result, the software is on <a href="https://github.com/yegor256/s3auth">GitHub</a>.</p><p>For the sake of privacy and convenience, I use only OAuth2 for user accounts. This means that I don’t know who my users are. I don’t possess their names or emails, but only their account numbers in Facebook, Google Plus or GitHub. Of course, I can find their names using these numbers, but this information is public anyway.</p><p>The server is implemented in Java6. For its hosting, I’m using a single Amazon EC2 <a href="http://aws.amazon.com/ec2/instance-types/">m1.small</a> Ubuntu server. These days, the server seems to work properly and is stable.</p><h2 id="extra-features">Extra Features</h2><p>Besides authentication and authorization, the <a href="http://www.s3auth.com">s3auth.com</a> server can render lists of pages—just like Apache HTTP Server. If you have a collection of objects in your bucket—but the <code>index.html</code> file is missing—Amazon S3 delivers a “page not found” result. Conversely, my server displays a list of objects in the bucket, when no <code>index.html</code> is present, and makes it possible to navigate up or down one folder.</p><p>When your bucket has the versioning feature turned on, you are able to list all versions of any object in the browser. To do this, just add <code>?all-versions</code> to the end of the URL to display the list. Next, click a version to have <a href="http://www.s3auth.com">s3auth.com</a> retrieve and render it.</p><h2 id="traction">Traction</h2><p>I created this service mostly for myself, but apparently I’m not the only with the problems described above. At the moment, <a href="http://www.s3auth.com">s3auth.com</a> hosts over 300 domains and sends through more than 10Mb of data each hour.</p><p>PS. This post explains how <a href="http://www.s3auth.com">s3auth.com</a> can be used as a front-end to your Maven repository: <a href="/2015/09/07/maven-repository-amazon-s3.html">How to Set Up a Private Maven Repository in Amazon S3</a>.</p>"/> <meta name="twitter:url" property="og:url" content="https://www.yegor256.com/2014/04/21/s3-http-basic-auth.html"/> <meta name="telegram:channel" content="AAAAAEJFMRzsRTRxM3ec6A"/> <link rel="search" type="application/opensearchdescription+xml" href="/opensearch.xml" title="yegor256" /> <link rel="shortcut icon" href="/favicon.ico?ddf57a1cee0"/> <link rel="apple-touch-icon" href="/favicon.ico?ddf57a1cee0"/> <link rel="alternate" type="application/rss+xml" title="RSS for yegor256.com" href="https://www.yegor256.com/rss.xml"/> <link rel="stylesheet" href="/css/layout.css?ddf57a1cee0"/> <link rel="stylesheet" href="/css/icons.css?ddf57a1cee0"/> <link rel="canonical" href="https://www.yegor256.com/2014/04/21/s3-http-basic-auth.html" /> <link rel="amphtml" href="https://www.yegor256.com/2014/04/21/s3-http-basic-auth.amp.html" /> <title>Basic HTTP Auth for S3 Buckets </title> </head> <body><div class="wrapper"> <aside class="header-toggle unprintable" id="header-toggle" title="Show the menu" onclick="$('#header').show();$('#header-toggle').hide();">&#9776;</aside> <header class="header" id="header"><div class="face"> <a href="/about-me.html#form" class="sub" title="Click to subscribe to my monthly newsletter"><span>Subscribe</span></a> <a href="/about-me.html" style="position:relative;"> <img src="/images/face-256x256.jpg" class="photo" alt="Yegor Bugayenko"/> </a></div><nav><ul class="menu social notranslate"> <li><a href="https://twitter.com/intent/follow?screen_name=yegor256" rel="nofollow" title="Follow me on Twitter"><i class="icon icon-twitter notranslate" aria-hidden="true"></i></a></li> <li><a href="/rss.xml" rel="nofollow" title="Subscribe to my RSS feed"><i class="icon icon-rss notranslate" aria-hidden="true"></i></a></li> <li><a itemprop="sameAs" href="https://github.com/yegor256" rel="nofollow" title="My GitHub profile"><i class="icon icon-github notranslate" aria-hidden="true"></i></a></li> <li><a itemprop="sameAs" href="http://stackoverflow.com/users/187141/yegor256" rel="nofollow" title="My StackOverflow profile"><i class="icon icon-stackoverflow notranslate" aria-hidden="true"></i></a></li> <li><a itemprop="sameAs" href="https://www.facebook.com/yegor256" rel="nofollow" title="Follow me on Facebook"><i class="icon icon-facebook notranslate" aria-hidden="true"></i></a></li> <li><a itemprop="sameAs" href="https://instagram.com/yegor256" rel="nofollow" title="Follow me on Instagram"><i class="icon icon-instagram notranslate" aria-hidden="true"></i></a></li> <li><a itemprop="sameAs" href="https://www.linkedin.com/in/yegor256" rel="nofollow" title="My LinkedIn profile"><i class="icon icon-linkedin notranslate" aria-hidden="true"></i></a></li> <li><a itemprop="sameAs" href="https://www.youtube.com/c/yegor256?sub_confirmation=1" rel="nofollow" title="My Youtube video channel"><i class="icon icon-youtube notranslate" aria-hidden="true"></i></a></li> <li><a itemprop="sameAs" href="https://www.pinterest.com/yegor256/" rel="nofollow" title="My Pinterest boards"><i class="icon icon-pinterest notranslate" aria-hidden="true"></i></a></li> <li><a itemprop="sameAs" href="https://angel.co/yegor256" rel="nofollow" title="My AngelList profile"><i class="icon icon-angellist notranslate" aria-hidden="true"></i></a></li> <li><a href="https://soundcloud.com/yegor256" rel="nofollow" title="My podcast"><i class="icon icon-podcast notranslate" aria-hidden="true"></i></a></li> <li><a href="https://itunes.apple.com/us/podcast/yegor256-podcast/id1150826721" rel="nofollow" title="My iTunes podcast"><i class="icon icon-itunes notranslate" aria-hidden="true"></i></a></li> <li><a href="https://t.me/yegor256news" rel="nofollow" title="My Telegram public channel"><i class="icon icon-telegram notranslate" aria-hidden="true"></i></a></li> <li><a href="mailto:blog@yegor256.com" rel="nofollow" title="Email me any time"><i class="icon icon-mail notranslate" aria-hidden="true"></i></a></li></ul><ul class="menu"> <li><a href="/" title="Home page">Home</a></li> <li /2014/04/21/s3-http-basic-auth.html><a href="/best.html" title="Best articles to read">12&#160;Best</a></li> <li /2014/04/21/s3-http-basic-auth.html><a href="/contents.html" title="The contents of the entire blog">All&#160;292</a></li> <li /2014/04/21/s3-http-basic-auth.html><a href="/webinars.html" title="My webinars">Webinars</a></li> <li /2014/04/21/s3-http-basic-auth.html><a href="/talks.html" title="Future and past conference talks">Talks</a></li> <li /2014/04/21/s3-http-basic-auth.html><a href="/books.html" title="The books I wrote">Books</a></li> <li /2014/04/21/s3-http-basic-auth.html><a href="/papers.html" title="My academic papers and patents">Papers</a></li> <li /2014/04/21/s3-http-basic-auth.html><a href="/pets.html" title="My loved pet projects">Pets</a></li> <li /2014/04/21/s3-http-basic-auth.html class="highlighted"><a href="/trainings.html" title="On-site trainings">Trainings</a></li> <li /2014/04/21/s3-http-basic-auth.html><a href="/award.html" title="Software quality award">Award</a></li> <li /2014/04/21/s3-http-basic-auth.html><a href="/testimonials.html" title="What some people say about me">Testimonials</a></li> <li /2014/04/21/s3-http-basic-auth.html><a href="/shift-m.html" title="Audio podcast about project management">Shift-M</a></li> <li /2014/04/21/s3-http-basic-auth.html><a href="/paintings.html" title="My paintings for sale">Paintings</a></li> <li><a href="https://ru.yegor256.com/" title="Немного на русском языке">По-русски</a></li></ul></nav><div class="search"> <form method="get" action="https://www.google.com/search" itemprop="potentialAction" itemscope="" itemtype="http://schema.org/SearchAction"> <meta itemprop="target" content="https://www.google.com/search?q={q}"/> <input name="sitesearch" value="yegor256.com" type="hidden"/> <input itemprop="query-input" type="text" id="search-query" class="field field-text" required="required" onfocus="$('.google').css('visibility', 'visible');" name="q" placeholder="Search..." autocomplete="off"/> <input type="image" src="/images/google-search-icon.svg" class="google" title="Search via Google" alt="Search via Google"/> </form></div><div class="hot"><ul></ul></div></header></div><section itemscope="" itemtype="http://schema.org/BlogPosting"><div class="wrapper"> <header><p class="printable"> <img src="https://api.qrserver.com/v1/create-qr-code/?data=https://www.yegor256.com/2014/04/21/s3-http-basic-auth.html&amp;format=svg" style="width:125px;height:125px;" alt="QR code"/></p><p class="printable"> <code itemprop="url">https://www.yegor256.com/2014/04/21/s3-http-basic-auth.html</code></p><h1 itemprop="name headline mainEntityOfPage">Basic HTTP Auth for S3 Buckets</h1><ul class="subline"> <li> <time itemprop="datePublished" datetime="2014-04-21T00:00:00+00:00"> 21 April 2014 </time> </li> <li class="printable" itemscope="" itemprop="author" itemtype="http://schema.org/Person"> <span itemprop="name">Yegor Bugayenko</span> </li> <li class="unprintable"> <i class="icon icon-comments"></i> <a href="https://www.yegor256.com/2014/04/21/s3-http-basic-auth.html#disqus_thread" itemprop="discussionUrl">comments</a> </li></ul><p class="unprintable"><figure class="badge"><a href="http://www.s3auth.com"><img src="http://img.s3auth.com/logo.png" style="width:200px;max-width:100%;" alt="badge" /></a></figure><p><a href="http://aws.amazon.com/s3/">Amazon S3</a> is a simple and very useful storage of binary objects (aka “files”). To use it, you create a “bucket” there with a unique name and upload your objects.</p><p>Afterwards, AWS guarantees your object will be available for download through their <a href="http://docs.aws.amazon.com/AmazonS3/latest/API/APIRest.html">RESTful API</a>.</p><p>A few years ago, AWS introduced a S3 feature called <a href="http://docs.aws.amazon.com/AmazonS3/latest/dev/WebsiteHosting.html">static website hosting</a>.</p><p>With static website hosting, you simply turn on the feature and all objects in your bucket become available through public HTTP. This is an awesome feature for hosting static content, such as images, JavaScript files, video and audio content.</p><p>When using the hosting, you need to change the CNAME record in your DNS so that it points to <code>www.example.com.aws.amazon.com</code>. After changing the DNS entry, your static website is available at <code>www.example.com</code> just as it would be normally.</p><p>When using Amazon S3, though, it is not possible to protect your website because the content is purely static. This means you can’t have a login page on the front end. With the service, you can either make your objects either absolutely public—so that anyone can see them online—or assign access rights to them—but only for users connected through RESTful API.</p><p>My use case with the service was a bit more complex, though. I wanted to host my static content as S3 objects. However, I wanted to do this while ensuring only a few people had access to the content using their Web browsers.</p><h2 id="http-basic-authentication">HTTP Basic Authentication</h2><p>The HTTP protocol offers a nice <a href="http://en.wikipedia.org/wiki/Basic_access_authentication">“basic access authentication”</a> feature that doesn’t require any extra site pages.</p><p>When an HTTP request arrives at the server, it doesn’t deliver the content but replies with a 401 status response. This response means literally “I don’t know who you are, please authenticate yourself.”</p><p>The browser shows its native login screen and prompts for a user name and password. After entering the login credentials, they are concatenated, <a href="http://en.wikipedia.org/wiki/Base64">Base64</a> encoded, and added to the next request in <code>Authorization</code> HTTP header.</p><figure class="unprintable"><img src="https://www.yegor256.com/images/2014/04/s3auth-authentication-dialog.png" itemprop="image" style="width:600px;max-width:100%;" alt="The figure" /></figure><p>Now, the browser tries to make another attempt to fetch the same webpage. But, this time, the HTTP request contains a header:</p><figure class="highlight"><pre><code class="language-text" data-lang="text"><span></span>Authorization: Basic am9lOnNlY3JldA==</code></pre></figure><p>The above is just an example. In the example, the Base64 encoded part means <code>joe:secret</code>, where <code>joe</code> is the user name and <code>secret</code> the password entered by the user.</p><p>This time the server has authentication information and can make a decision whether this user is authenticated (his password matches the server’s records) and authorized (he has permission to access the request webpage).</p><h2 id="s3authcom"><code>s3auth.com</code></h2><p>Since Amazon doesn’t provide this feature, I decided to create a simple web service, <a href="http://www.s3auth.com">s3auth.com</a>, which stays in front of my Amazon S3 buckets and implements the HTTP-native authentication and authorization mechanism.</p><p>Instead of making my objects public, though, I make them private and point my CNAME record to <code>relay.s3auth.com</code>. HTTP requests from Web browsers then arrive at my server, connect to Amazon S3, retrieve my objects and deliver them back in HTTP responses.</p><p>The server implements authentication and authorization using a special file <code>.htpasswd</code> in the root of my bucket. The format of the <code>.htpasswd</code> file is identical to the one used by <a href="http://httpd.apache.org/docs/2.2/programs/htpasswd.html">Apache HTTP Server</a>—one user per line. Every line has the name of a user and a hash version of his password.</p><h2 id="implementation">Implementation</h2><p>I made this software open source mostly to guarantee to my users that the server doesn’t store their private data anywhere, but rather acts only as a pass-through service. As a result, the software is on <a href="https://github.com/yegor256/s3auth">GitHub</a>.</p><p>For the sake of privacy and convenience, I use only OAuth2 for user accounts. This means that I don’t know who my users are. I don’t possess their names or emails, but only their account numbers in Facebook, Google Plus or GitHub. Of course, I can find their names using these numbers, but this information is public anyway.</p><p>The server is implemented in Java6. For its hosting, I’m using a single Amazon EC2 <a href="http://aws.amazon.com/ec2/instance-types/">m1.small</a> Ubuntu server. These days, the server seems to work properly and is stable.</p><h2 id="extra-features">Extra Features</h2><p>Besides authentication and authorization, the <a href="http://www.s3auth.com">s3auth.com</a> server can render lists of pages—just like Apache HTTP Server. If you have a collection of objects in your bucket—but the <code>index.html</code> file is missing—Amazon S3 delivers a “page not found” result. Conversely, my server displays a list of objects in the bucket, when no <code>index.html</code> is present, and makes it possible to navigate up or down one folder.</p><p>When your bucket has the versioning feature turned on, you are able to list all versions of any object in the browser. To do this, just add <code>?all-versions</code> to the end of the URL to display the list. Next, click a version to have <a href="http://www.s3auth.com">s3auth.com</a> retrieve and render it.</p><h2 id="traction">Traction</h2><p>I created this service mostly for myself, but apparently I’m not the only with the problems described above. At the moment, <a href="http://www.s3auth.com">s3auth.com</a> hosts over 300 domains and sends through more than 10Mb of data each hour.</p><p>PS. This post explains how <a href="http://www.s3auth.com">s3auth.com</a> can be used as a front-end to your Maven repository: <a href="/2015/09/07/maven-repository-amazon-s3.html">How to Set Up a Private Maven Repository in Amazon S3</a>.</p></p><nav class="buttons notranslate desktop-only"> <a href="http://www.facebook.com/sharer/sharer.php?u=https://www.yegor256.com/2014/04/21/s3-http-basic-auth.html" title="Share on Facebook" class="button" rel="nofollow"> <span class="count count-facebook">0</span> <i class="icon icon-facebook notranslate" aria-hidden="true"></i> </a> <a href="https://twitter.com/share?url=https://www.yegor256.com/2014/04/21/s3-http-basic-auth.html&amp;text=Basic+HTTP+Auth+for+S3+Buckets" title="Share on Twitter" class="button" rel="nofollow"> <span class="count count-twitter">0</span> <i class="icon icon-twitter notranslate" aria-hidden="true"></i> </a> <a href="https://plus.google.com/share?url=https://www.yegor256.com/2014/04/21/s3-http-basic-auth.html" title="Share on Google+" class="button" rel="nofollow"> <span class="count count-googleplus">0</span> <i class="icon icon-googleplus notranslate" aria-hidden="true"></i> </a> <a href="https://www.linkedin.com/cws/share?url=https://www.yegor256.com/2014/04/21/s3-http-basic-auth.html" title="Share on LinkedIn" class="button" rel="nofollow"> <span class="count count-linkedin">0</span> <i class="icon icon-linkedin notranslate" aria-hidden="true"></i> </a> <a href="http://reddit.com/submit?url=https://www.yegor256.com/2014/04/21/s3-http-basic-auth.html%3F2014-16&amp;title=Basic+HTTP+Auth+for+S3+Buckets" title="Share on Reddit" class="button" rel="nofollow"> <span class="count count-reddit">0</span> <i class="icon icon-reddit notranslate" aria-hidden="true"></i> </a> <a href="http://news.ycombinator.com/submitlink?u=https://www.yegor256.com/2014/04/21/s3-http-basic-auth.html%3F2014-16&amp;t=Basic+HTTP+Auth+for+S3+Buckets" title="Share on Hacker News" class="button" rel="nofollow"> <span class="count count-hackernews">0</span> <i class="icon icon-hackernews notranslate" aria-hidden="true"></i> </a> </nav> </header> <article class="main" itemprop="articleBody"><div > <figure class="badge"><a href="http://www.s3auth.com"><img src="http://img.s3auth.com/logo.png" style="width:200px;max-width:100%;" alt="badge" /></a></figure><p><a href="http://aws.amazon.com/s3/">Amazon S3</a> is a simple and very useful storage of binary objects (aka “files”). To use it, you create a “bucket” there with a unique name and upload your objects.</p><p>Afterwards, AWS guarantees your object will be available for download through their <a href="http://docs.aws.amazon.com/AmazonS3/latest/API/APIRest.html">RESTful API</a>.</p><p>A few years ago, AWS introduced a S3 feature called <a href="http://docs.aws.amazon.com/AmazonS3/latest/dev/WebsiteHosting.html">static website hosting</a>.</p><p>With static website hosting, you simply turn on the feature and all objects in your bucket become available through public HTTP. This is an awesome feature for hosting static content, such as images, JavaScript files, video and audio content.</p><p>When using the hosting, you need to change the CNAME record in your DNS so that it points to <code>www.example.com.aws.amazon.com</code>. After changing the DNS entry, your static website is available at <code>www.example.com</code> just as it would be normally.</p><p>When using Amazon S3, though, it is not possible to protect your website because the content is purely static. This means you can’t have a login page on the front end. With the service, you can either make your objects either absolutely public—so that anyone can see them online—or assign access rights to them—but only for users connected through RESTful API.</p><p>My use case with the service was a bit more complex, though. I wanted to host my static content as S3 objects. However, I wanted to do this while ensuring only a few people had access to the content using their Web browsers.</p><h2 id="http-basic-authentication">HTTP Basic Authentication</h2><p>The HTTP protocol offers a nice <a href="http://en.wikipedia.org/wiki/Basic_access_authentication">“basic access authentication”</a> feature that doesn’t require any extra site pages.</p><p>When an HTTP request arrives at the server, it doesn’t deliver the content but replies with a 401 status response. This response means literally “I don’t know who you are, please authenticate yourself.”</p><p>The browser shows its native login screen and prompts for a user name and password. After entering the login credentials, they are concatenated, <a href="http://en.wikipedia.org/wiki/Base64">Base64</a> encoded, and added to the next request in <code>Authorization</code> HTTP header.</p><figure class="unprintable"><img src="https://www.yegor256.com/images/2014/04/s3auth-authentication-dialog.png" itemprop="image" style="width:600px;max-width:100%;" alt="The figure" /></figure><p>Now, the browser tries to make another attempt to fetch the same webpage. But, this time, the HTTP request contains a header:</p><figure class="highlight"><pre><code class="language-text" data-lang="text"><span></span>Authorization: Basic am9lOnNlY3JldA==</code></pre></figure><p>The above is just an example. In the example, the Base64 encoded part means <code>joe:secret</code>, where <code>joe</code> is the user name and <code>secret</code> the password entered by the user.</p><p>This time the server has authentication information and can make a decision whether this user is authenticated (his password matches the server’s records) and authorized (he has permission to access the request webpage).</p><h2 id="s3authcom"><code>s3auth.com</code></h2><p>Since Amazon doesn’t provide this feature, I decided to create a simple web service, <a href="http://www.s3auth.com">s3auth.com</a>, which stays in front of my Amazon S3 buckets and implements the HTTP-native authentication and authorization mechanism.</p><p>Instead of making my objects public, though, I make them private and point my CNAME record to <code>relay.s3auth.com</code>. HTTP requests from Web browsers then arrive at my server, connect to Amazon S3, retrieve my objects and deliver them back in HTTP responses.</p><p>The server implements authentication and authorization using a special file <code>.htpasswd</code> in the root of my bucket. The format of the <code>.htpasswd</code> file is identical to the one used by <a href="http://httpd.apache.org/docs/2.2/programs/htpasswd.html">Apache HTTP Server</a>—one user per line. Every line has the name of a user and a hash version of his password.</p><h2 id="implementation">Implementation</h2><p>I made this software open source mostly to guarantee to my users that the server doesn’t store their private data anywhere, but rather acts only as a pass-through service. As a result, the software is on <a href="https://github.com/yegor256/s3auth">GitHub</a>.</p><p>For the sake of privacy and convenience, I use only OAuth2 for user accounts. This means that I don’t know who my users are. I don’t possess their names or emails, but only their account numbers in Facebook, Google Plus or GitHub. Of course, I can find their names using these numbers, but this information is public anyway.</p><p>The server is implemented in Java6. For its hosting, I’m using a single Amazon EC2 <a href="http://aws.amazon.com/ec2/instance-types/">m1.small</a> Ubuntu server. These days, the server seems to work properly and is stable.</p><h2 id="extra-features">Extra Features</h2><p>Besides authentication and authorization, the <a href="http://www.s3auth.com">s3auth.com</a> server can render lists of pages—just like Apache HTTP Server. If you have a collection of objects in your bucket—but the <code>index.html</code> file is missing—Amazon S3 delivers a “page not found” result. Conversely, my server displays a list of objects in the bucket, when no <code>index.html</code> is present, and makes it possible to navigate up or down one folder.</p><p>When your bucket has the versioning feature turned on, you are able to list all versions of any object in the browser. To do this, just add <code>?all-versions</code> to the end of the URL to display the list. Next, click a version to have <a href="http://www.s3auth.com">s3auth.com</a> retrieve and render it.</p><h2 id="traction">Traction</h2><p>I created this service mostly for myself, but apparently I’m not the only with the problems described above. At the moment, <a href="http://www.s3auth.com">s3auth.com</a> hosts over 300 domains and sends through more than 10Mb of data each hour.</p><p>PS. This post explains how <a href="http://www.s3auth.com">s3auth.com</a> can be used as a front-end to your Maven repository: <a href="/2015/09/07/maven-repository-amazon-s3.html">How to Set Up a Private Maven Repository in Amazon S3</a>.</p></div></article></div><div class="wrapper"> <related-posts /></div><div class="disqus" role="complementary"><p class="disqus_hint"> Please, use <a href="https://help.disqus.com/commenting/what-html-tags-are-allowed-within-comments">syntax highlighting</a> in your comments, to make them more readable.</p><div id="disqus_thread" class="disqus-thread"> <a>&nbsp;</a></div><script> var disqus_config = function () { this.page.url = document.location.href.split('?')[0].split('#')[0].replace('https://', 'http://'); this.page.identifier = this.page.url; }; (function() { var d = document, s = d.createElement('script'); s.src = '//yegor256.disqus.com/embed.js'; s.setAttribute('data-timestamp', +new Date()); (d.head || d.body).appendChild(s); })(); </script> <noscript><div><p class="red"> JavaScript is disabled in your browser, that's why you can't see comments under this post.</p></div></noscript></div><div class="wrapper"> <footer class="footer"><p> &copy; <span itemscope="" itemprop="copyrightHolder" itemtype="http://schema.org/Person"> <span itemprop="name">Yegor Bugayenko</span> </span> 2014&ndash;<span itemprop="copyrightYear">2018</span></p></footer></div></section><div class="wrapper unprintable" style="text-align:center;margin-top:2em;"> <a href="http://www.sixnines.io/h/3ba1652f"> <img src="//www.sixnines.io/b/3ba1652f?style=flat" alt="sixnines availability badge"/> </a></div><script src="//code.jquery.com/jquery-1.9.0.min.js"></script> <script src="/js/all.js?ddf57a1cee0"></script> <script>var disqus_shortname = 'yegor256';</script> <script id="dsq-count-scr" src="//yegor256.disqus.com/count.js" async="async"></script> <script> (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){ (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o), m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m) })(window,document,'script','//www.google-analytics.com/analytics.js','ga'); ga('create', 'UA-1963507-32', 'auto'); ga('send', 'pageview'); </script> <script> Cd=document;Cr="&"+Math.random();Cp="&s=1"; Cd.cookie="b=b";if(Cd.cookie)Cp+="&c=1"; Cp+="&t="+(new Date()).getTimezoneOffset(); if(self!=top)Cp+="&f=1"; </script> <script> if(navigator.javaEnabled())Cp+="&j=1"; </script> <script> if(typeof(screen)!='undefined')Cp+="&w="+screen.width+"&h="+ screen.height+"&d="+(screen.colorDepth?screen.colorDepth:screen.pixelDepth); </script> <script> Cd.write("<img src='//c.hit.ua/hit?i=95870&g=0&x=2"+Cp+Cr+ "&r="+escape(Cd.referrer)+"&u="+escape(window.location.href)+ "' border='0' wi"+"dth='1' he"+"ight='1'/>"); </script> <script type="application/ld+json"> { "@context": "http://schema.org", "@type": "Person", "name": "Yegor Bugayenko", "url": "https://www.yegor256.com", "sameAs": [ "https://www.facebook.com/yegor256", "https://instagram.com/yegor256", "https://www.linkedin.com/in/yegor256", "https://twitter.com/yegor256", "https://github.com/yegor256", "https://www.pinterest.com/yegor256/" ] } </script> </body> </html> <!DOCTYPE html> <html xmlns="http://www.w3.org/1999/xhtml" lang="en-US" xml:lang="en-US" itemscope="" itemtype="http://schema.org/WebSite"> <head> <meta charset="utf-8"/> <meta name="description" content="<figure class="badge"><a href="http://dynamo.jcabi.com"><img src="http://img.jcabi.com/logo-square.svg" style="width:64px;max-width:100%;" alt="badge" /></a></figure><p>I’m a big fan of cloud computing in general and of <a href="http://aws.amazon.com/">Amazon Web Services</a> in particular. I honestly believe that in a few years big providers will host all, or almost all, computing and storage resources. When this is the case, we won’t have to worry too much anymore about downtime, backups and system administrators. <a href="http://aws.amazon.com/dynamodb/">DynamoDB</a> is one of the steps towards this future.</p><blockquote class="twitter-tweet" lang="en"><p>This looks cool - jcabi-dynamo - a <a href="https://twitter.com/search?q=%23Java&amp;src=hash">#Java</a> Object layer atop the <a href="https://twitter.com/search?q=%23DynamoDB&amp;src=hash">#DynamoDB</a> SDK - <a href="http://t.co/khRFR2joKX">http://t.co/khRFR2joKX</a> <a href="https://twitter.com/search?q=%23aws&amp;src=hash">#aws</a></p>---Jeff Barr (@jeffbarr) <a href="https://twitter.com/jeffbarr/statuses/380813867971915777">September 19, 2013</a></blockquote> <script async="" src="http://platform.twitter.com/widgets.js" charset="utf-8"></script><p>DynamoDB is a <a href="http://en.wikipedia.org/wiki/NoSQL">NoSQL</a> database accessible through <a href="http://en.wikipedia.org/wiki/Representational_state_transfer">RESTful</a> JSON API. Its design is relatively simple. There are tables, which basically are collections of data structures, or in AWS terminology, “items.”</p><p>Every item has a mandatory “hash,” an optional “range” and a number of other optional attributes. For instance, take the example table <code>depts</code>:</p><figure class="highlight"><pre><code class="language-text" data-lang="text"><span></span>+------+--------+---------------------------+
| dept | worker | Attributes                |
+------+--------+---------------------------+
| 205  | Jeff   | job=&quot;manager&quot;, sex=&quot;male&quot; |
| 205  | Bob    | age=43, city=&quot;Chicago&quot;    |
| 398  | Alice  | age=27, job=&quot;architect&quot;   |
+------+--------+---------------------------+</code></pre></figure><p>For Java, Amazon provides an <a href="https://aws.amazon.com/documentation/sdkforjava/">SDK</a>, which mirrors all RESTful calls to Java methods. The SDK works fine, but is designed in a pure <a href="http://en.wikipedia.org/wiki/Procedural_programming">procedural</a> style.</p><p>Let’s say we want to add a new item to the table above. RESTful call <a href="http://docs.aws.amazon.com/amazondynamodb/latest/APIReference/API_PutItem.html"><code>putItem</code></a> looks like (in essence):</p><figure class="highlight"><pre><code class="language-text" data-lang="text"><span></span>putItem:
  tableName: depts
  item:
    dept: 435
    worker: &quot;William&quot;
    job: &quot;programmer&quot;</code></pre></figure><p>This is what the Amazon server needs to know in order to create a new item in the table. This is how you’re supposed to make this call through the AWS Java SDK:</p><figure class="highlight"><pre><code class="language-java" data-lang="java"><span></span><span class="n">PutItemRequest</span> <span class="n">request</span> <span class="o">=</span> <span class="k">new</span> <span class="n">PutItemRequest</span><span class="o">();</span>
<span class="n">request</span><span class="o">.</span><span class="na">setTableName</span><span class="o">(</span><span class="s">&quot;depts&quot;</span><span class="o">);</span>
<span class="n">Map</span><span class="o">&lt;</span><span class="n">String</span><span class="o">,</span> <span class="n">AttributeValue</span><span class="o">&gt;</span> <span class="n">attributes</span> <span class="o">=</span> <span class="k">new</span> <span class="n">HashMap</span><span class="o">&lt;&gt;();</span>
<span class="n">attributes</span><span class="o">.</span><span class="na">put</span><span class="o">(</span><span class="s">&quot;dept&quot;</span><span class="o">,</span> <span class="k">new</span> <span class="n">AttributeValue</span><span class="o">(</span><span class="mi">435</span><span class="o">));</span>
<span class="n">attributes</span><span class="o">.</span><span class="na">put</span><span class="o">(</span><span class="s">&quot;worker&quot;</span><span class="o">,</span> <span class="k">new</span> <span class="n">AttributeValue</span><span class="o">(</span><span class="s">&quot;William&quot;</span><span class="o">));</span>
<span class="n">attributes</span><span class="o">.</span><span class="na">put</span><span class="o">(</span><span class="s">&quot;job&quot;</span><span class="o">,</span> <span class="k">new</span> <span class="n">AttributeValue</span><span class="o">(</span><span class="err">&quot;</span><span class="n">programmer</span><span class="o">));</span>
<span class="n">request</span><span class="o">.</span><span class="na">setItem</span><span class="o">(</span><span class="n">attributes</span><span class="o">);</span>
<span class="n">AmazonDynamoDB</span> <span class="n">aws</span> <span class="o">=</span> <span class="c1">// instantiate it with credentials</span>
<span class="k">try</span> <span class="o">{</span>
  <span class="n">aws</span><span class="o">.</span><span class="na">putItem</span><span class="o">(</span><span class="n">request</span><span class="o">);</span>
<span class="o">}</span> <span class="k">finally</span> <span class="o">{</span>
  <span class="n">aws</span><span class="o">.</span><span class="na">shutdown</span><span class="o">();</span>
<span class="o">}</span></code></pre></figure><p>The above script works fine, but there is one major drawback—it is not object oriented. It is a perfect example of an imperative <a href="http://en.wikipedia.org/wiki/Procedural_programming">procedural programming</a>.</p><p>To allow you to compare, let me show what I’ve done with <a href="http://dynamo.jcabi.com">jcabi-dynamo</a>. Here is my code, which does exactly the same thing, but in an <a href="http://en.wikipedia.org/wiki/Object-oriented_programming">object-oriented</a> way:</p><figure class="highlight"><pre><code class="language-java" data-lang="java"><span></span><span class="n">Region</span> <span class="n">region</span> <span class="o">=</span> <span class="c1">// instantiate it with credentials</span>
<span class="n">Table</span> <span class="n">table</span> <span class="o">=</span> <span class="n">region</span><span class="o">.</span><span class="na">table</span><span class="o">(</span><span class="s">&quot;depts&quot;</span><span class="o">);</span>
<span class="n">Item</span> <span class="n">item</span> <span class="o">=</span> <span class="n">table</span><span class="o">.</span><span class="na">put</span><span class="o">(</span>
  <span class="k">new</span> <span class="n">Attributes</span><span class="o">()</span>
    <span class="o">.</span><span class="na">with</span><span class="o">(</span><span class="s">&quot;dept&quot;</span><span class="o">,</span> <span class="mi">435</span><span class="o">)</span>
    <span class="o">.</span><span class="na">with</span><span class="o">(</span><span class="s">&quot;worker&quot;</span><span class="o">,</span> <span class="s">&quot;William&quot;</span><span class="o">)</span>
    <span class="o">.</span><span class="na">with</span><span class="o">(</span><span class="s">&quot;job&quot;</span><span class="o">,</span> <span class="s">&quot;programmer&quot;</span><span class="o">)</span>
<span class="o">);</span></code></pre></figure><p>My code is not only shorter, but it also employs <a href="/2016/11/21/naked-data.html">encapsulation</a> and separates responsibilities of classes. <a href="http://dynamo.jcabi.com/apidocs-0.10/com/jcabi/dynamo/Table.html"><code>Table</code></a> class (actually it is an interface internally implemented by a class) encapsulates information about the table, while <a href="http://dynamo.jcabi.com/apidocs-0.10/com/jcabi/dynamo/Item.html"><code>Item</code></a> encapsulates item details.</p><p>We can pass an <code>item</code> as an argument to another method and all DynamoDB related implementation details will be hidden from it. For example, somewhere later in the code:</p><figure class="highlight"><pre><code class="language-java" data-lang="java"><span></span><span class="kt">void</span> <span class="nf">sayHello</span><span class="o">(</span><span class="n">Item</span> <span class="n">item</span><span class="o">)</span> <span class="o">{</span>
  <span class="n">System</span><span class="o">.</span><span class="na">out</span><span class="o">.</span><span class="na">println</span><span class="o">(</span><span class="s">&quot;Hello, &quot;</span> <span class="o">+</span> <span class="n">item</span><span class="o">.</span><span class="na">get</span><span class="o">(</span><span class="s">&quot;worker&quot;</span><span class="o">));</span>
<span class="o">}</span></code></pre></figure><p>In this script, we don’t know anything about DynamoDB or how to deal with its RESTful API. We interact solely with an instance of <a href="http://dynamo.jcabi.com/apidocs-0.10/com/jcabi/dynamo/Item.html"><code>Item</code></a> class.</p><p>By the way, all public entities in <a href="http://dynamo.jcabi.com">jcabi-dynamo</a> are Java interfaces. Thanks to that, you can test and mock the library completely (but I would recommend to use <a href="/2014/05/01/dynamodb-local-maven-plugin.html">DynamoDB Local</a> and create integration tests).</p><p>Let’s consider a more complex example, which would take a page of code if we were to use a bare AWS SDK. Let’s say that we want to remove all workers from our table who work as architects:</p><figure class="highlight"><pre><code class="language-java" data-lang="java"><span></span><span class="n">Region</span> <span class="n">region</span> <span class="o">=</span> <span class="c1">// instantiate it with credentials</span>
<span class="n">Iterator</span><span class="o">&lt;</span><span class="n">Item</span><span class="o">&gt;</span> <span class="n">workers</span> <span class="o">=</span> <span class="n">region</span><span class="o">.</span><span class="na">table</span><span class="o">(</span><span class="s">&quot;depts&quot;</span><span class="o">).</span><span class="na">frame</span><span class="o">()</span>
  <span class="o">.</span><span class="na">where</span><span class="o">(</span><span class="s">&quot;job&quot;</span><span class="o">,</span> <span class="n">Condition</span><span class="o">.</span><span class="na">equalTo</span><span class="o">(</span><span class="s">&quot;architect&quot;</span><span class="o">));</span>
<span class="k">while</span> <span class="o">(</span><span class="n">workers</span><span class="o">.</span><span class="na">hasNext</span><span class="o">())</span> <span class="o">{</span>
  <span class="n">workers</span><span class="o">.</span><span class="na">remove</span><span class="o">();</span>
<span class="o">}</span></code></pre></figure><p><a href="http://dynamo.jcabi.com">jcabi-dynamo</a> has saved a lot of code lines in a few of my projects. You can see it in action at <a href="https://github.com/rultor/rultor/tree/rultor-0.2/rultor-users/src/main/java/com/rultor/users">rultor-users</a>.</p><p>The library ships as a JAR dependency in <a href="http://repo1.maven.org/maven2/com/jcabi/jcabi-dynamo">Maven Central</a> (get its latest versions from <a href="http://search.maven.org/">Maven Central</a>):</p><figure class="highlight"><pre><code class="language-xml" data-lang="xml"><span></span><span class="nt">&lt;dependency&gt;</span>
  <span class="nt">&lt;groupId&gt;</span>com.jcabi<span class="nt">&lt;/groupId&gt;</span>
  <span class="nt">&lt;artifactId&gt;</span>jcabi-dynamo<span class="nt">&lt;/artifactId&gt;</span>
<span class="nt">&lt;/dependency&gt;</span></code></pre></figure> " /> <meta name="keywords" content="next, path, output, content, previous, url, relative_path, id, collection, excerpt, draft, categories, layout, title, date, tags, description, keywords, slug, ext" /> <meta name="viewport" content="width=device-width,minimum-scale=1,initial-scale=1"/> <meta name="google-site-verification" content="JEj_gQr2CPe2QKGw8XdMz0R7VboQIUbX3FlM-lwTq-8" /> <meta name="author" content="Yegor Bugayenko"> <meta name="article:published_time" content="2014-04-14 00:00:00 +0000"> <meta name="og:site_name" content="Yegor Bugayenko"/> <meta name="og:type" content="article" /> <meta name="og:locale" content="en_US" /> <meta name="twitter:account_id" content="4503599630178231" /> <meta name="twitter:creator" content="@yegor256"/> <meta name="twitter:site" content="@yegor256"/> <meta name="twitter:title" property="og:title" content="Object-Oriented DynamoDB API"/> <meta name="twitter:description" property="og:description" content="<figure class="badge"><a href="http://dynamo.jcabi.com"><img src="http://img.jcabi.com/logo-square.svg" style="width:64px;max-width:100%;" alt="badge" /></a></figure><p>I’m a big fan of cloud computing in general and of <a href="http://aws.amazon.com/">Amazon Web Services</a> in particular. I honestly believe that in a few years big providers will host all, or almost all, computing and storage resources. When this is the case, we won’t have to worry too much anymore about downtime, backups and system administrators. <a href="http://aws.amazon.com/dynamodb/">DynamoDB</a> is one of the steps towards this future.</p><blockquote class="twitter-tweet" lang="en"><p>This looks cool - jcabi-dynamo - a <a href="https://twitter.com/search?q=%23Java&amp;src=hash">#Java</a> Object layer atop the <a href="https://twitter.com/search?q=%23DynamoDB&amp;src=hash">#DynamoDB</a> SDK - <a href="http://t.co/khRFR2joKX">http://t.co/khRFR2joKX</a> <a href="https://twitter.com/search?q=%23aws&amp;src=hash">#aws</a></p>---Jeff Barr (@jeffbarr) <a href="https://twitter.com/jeffbarr/statuses/380813867971915777">September 19, 2013</a></blockquote> <script async="" src="http://platform.twitter.com/widgets.js" charset="utf-8"></script><p>DynamoDB is a <a href="http://en.wikipedia.org/wiki/NoSQL">NoSQL</a> database accessible through <a href="http://en.wikipedia.org/wiki/Representational_state_transfer">RESTful</a> JSON API. Its design is relatively simple. There are tables, which basically are collections of data structures, or in AWS terminology, “items.”</p><p>Every item has a mandatory “hash,” an optional “range” and a number of other optional attributes. For instance, take the example table <code>depts</code>:</p><figure class="highlight"><pre><code class="language-text" data-lang="text"><span></span>+------+--------+---------------------------+
| dept | worker | Attributes                |
+------+--------+---------------------------+
| 205  | Jeff   | job=&quot;manager&quot;, sex=&quot;male&quot; |
| 205  | Bob    | age=43, city=&quot;Chicago&quot;    |
| 398  | Alice  | age=27, job=&quot;architect&quot;   |
+------+--------+---------------------------+</code></pre></figure><p>For Java, Amazon provides an <a href="https://aws.amazon.com/documentation/sdkforjava/">SDK</a>, which mirrors all RESTful calls to Java methods. The SDK works fine, but is designed in a pure <a href="http://en.wikipedia.org/wiki/Procedural_programming">procedural</a> style.</p><p>Let’s say we want to add a new item to the table above. RESTful call <a href="http://docs.aws.amazon.com/amazondynamodb/latest/APIReference/API_PutItem.html"><code>putItem</code></a> looks like (in essence):</p><figure class="highlight"><pre><code class="language-text" data-lang="text"><span></span>putItem:
  tableName: depts
  item:
    dept: 435
    worker: &quot;William&quot;
    job: &quot;programmer&quot;</code></pre></figure><p>This is what the Amazon server needs to know in order to create a new item in the table. This is how you’re supposed to make this call through the AWS Java SDK:</p><figure class="highlight"><pre><code class="language-java" data-lang="java"><span></span><span class="n">PutItemRequest</span> <span class="n">request</span> <span class="o">=</span> <span class="k">new</span> <span class="n">PutItemRequest</span><span class="o">();</span>
<span class="n">request</span><span class="o">.</span><span class="na">setTableName</span><span class="o">(</span><span class="s">&quot;depts&quot;</span><span class="o">);</span>
<span class="n">Map</span><span class="o">&lt;</span><span class="n">String</span><span class="o">,</span> <span class="n">AttributeValue</span><span class="o">&gt;</span> <span class="n">attributes</span> <span class="o">=</span> <span class="k">new</span> <span class="n">HashMap</span><span class="o">&lt;&gt;();</span>
<span class="n">attributes</span><span class="o">.</span><span class="na">put</span><span class="o">(</span><span class="s">&quot;dept&quot;</span><span class="o">,</span> <span class="k">new</span> <span class="n">AttributeValue</span><span class="o">(</span><span class="mi">435</span><span class="o">));</span>
<span class="n">attributes</span><span class="o">.</span><span class="na">put</span><span class="o">(</span><span class="s">&quot;worker&quot;</span><span class="o">,</span> <span class="k">new</span> <span class="n">AttributeValue</span><span class="o">(</span><span class="s">&quot;William&quot;</span><span class="o">));</span>
<span class="n">attributes</span><span class="o">.</span><span class="na">put</span><span class="o">(</span><span class="s">&quot;job&quot;</span><span class="o">,</span> <span class="k">new</span> <span class="n">AttributeValue</span><span class="o">(</span><span class="err">&quot;</span><span class="n">programmer</span><span class="o">));</span>
<span class="n">request</span><span class="o">.</span><span class="na">setItem</span><span class="o">(</span><span class="n">attributes</span><span class="o">);</span>
<span class="n">AmazonDynamoDB</span> <span class="n">aws</span> <span class="o">=</span> <span class="c1">// instantiate it with credentials</span>
<span class="k">try</span> <span class="o">{</span>
  <span class="n">aws</span><span class="o">.</span><span class="na">putItem</span><span class="o">(</span><span class="n">request</span><span class="o">);</span>
<span class="o">}</span> <span class="k">finally</span> <span class="o">{</span>
  <span class="n">aws</span><span class="o">.</span><span class="na">shutdown</span><span class="o">();</span>
<span class="o">}</span></code></pre></figure><p>The above script works fine, but there is one major drawback—it is not object oriented. It is a perfect example of an imperative <a href="http://en.wikipedia.org/wiki/Procedural_programming">procedural programming</a>.</p><p>To allow you to compare, let me show what I’ve done with <a href="http://dynamo.jcabi.com">jcabi-dynamo</a>. Here is my code, which does exactly the same thing, but in an <a href="http://en.wikipedia.org/wiki/Object-oriented_programming">object-oriented</a> way:</p><figure class="highlight"><pre><code class="language-java" data-lang="java"><span></span><span class="n">Region</span> <span class="n">region</span> <span class="o">=</span> <span class="c1">// instantiate it with credentials</span>
<span class="n">Table</span> <span class="n">table</span> <span class="o">=</span> <span class="n">region</span><span class="o">.</span><span class="na">table</span><span class="o">(</span><span class="s">&quot;depts&quot;</span><span class="o">);</span>
<span class="n">Item</span> <span class="n">item</span> <span class="o">=</span> <span class="n">table</span><span class="o">.</span><span class="na">put</span><span class="o">(</span>
  <span class="k">new</span> <span class="n">Attributes</span><span class="o">()</span>
    <span class="o">.</span><span class="na">with</span><span class="o">(</span><span class="s">&quot;dept&quot;</span><span class="o">,</span> <span class="mi">435</span><span class="o">)</span>
    <span class="o">.</span><span class="na">with</span><span class="o">(</span><span class="s">&quot;worker&quot;</span><span class="o">,</span> <span class="s">&quot;William&quot;</span><span class="o">)</span>
    <span class="o">.</span><span class="na">with</span><span class="o">(</span><span class="s">&quot;job&quot;</span><span class="o">,</span> <span class="s">&quot;programmer&quot;</span><span class="o">)</span>
<span class="o">);</span></code></pre></figure><p>My code is not only shorter, but it also employs <a href="/2016/11/21/naked-data.html">encapsulation</a> and separates responsibilities of classes. <a href="http://dynamo.jcabi.com/apidocs-0.10/com/jcabi/dynamo/Table.html"><code>Table</code></a> class (actually it is an interface internally implemented by a class) encapsulates information about the table, while <a href="http://dynamo.jcabi.com/apidocs-0.10/com/jcabi/dynamo/Item.html"><code>Item</code></a> encapsulates item details.</p><p>We can pass an <code>item</code> as an argument to another method and all DynamoDB related implementation details will be hidden from it. For example, somewhere later in the code:</p><figure class="highlight"><pre><code class="language-java" data-lang="java"><span></span><span class="kt">void</span> <span class="nf">sayHello</span><span class="o">(</span><span class="n">Item</span> <span class="n">item</span><span class="o">)</span> <span class="o">{</span>
  <span class="n">System</span><span class="o">.</span><span class="na">out</span><span class="o">.</span><span class="na">println</span><span class="o">(</span><span class="s">&quot;Hello, &quot;</span> <span class="o">+</span> <span class="n">item</span><span class="o">.</span><span class="na">get</span><span class="o">(</span><span class="s">&quot;worker&quot;</span><span class="o">));</span>
<span class="o">}</span></code></pre></figure><p>In this script, we don’t know anything about DynamoDB or how to deal with its RESTful API. We interact solely with an instance of <a href="http://dynamo.jcabi.com/apidocs-0.10/com/jcabi/dynamo/Item.html"><code>Item</code></a> class.</p><p>By the way, all public entities in <a href="http://dynamo.jcabi.com">jcabi-dynamo</a> are Java interfaces. Thanks to that, you can test and mock the library completely (but I would recommend to use <a href="/2014/05/01/dynamodb-local-maven-plugin.html">DynamoDB Local</a> and create integration tests).</p><p>Let’s consider a more complex example, which would take a page of code if we were to use a bare AWS SDK. Let’s say that we want to remove all workers from our table who work as architects:</p><figure class="highlight"><pre><code class="language-java" data-lang="java"><span></span><span class="n">Region</span> <span class="n">region</span> <span class="o">=</span> <span class="c1">// instantiate it with credentials</span>
<span class="n">Iterator</span><span class="o">&lt;</span><span class="n">Item</span><span class="o">&gt;</span> <span class="n">workers</span> <span class="o">=</span> <span class="n">region</span><span class="o">.</span><span class="na">table</span><span class="o">(</span><span class="s">&quot;depts&quot;</span><span class="o">).</span><span class="na">frame</span><span class="o">()</span>
  <span class="o">.</span><span class="na">where</span><span class="o">(</span><span class="s">&quot;job&quot;</span><span class="o">,</span> <span class="n">Condition</span><span class="o">.</span><span class="na">equalTo</span><span class="o">(</span><span class="s">&quot;architect&quot;</span><span class="o">));</span>
<span class="k">while</span> <span class="o">(</span><span class="n">workers</span><span class="o">.</span><span class="na">hasNext</span><span class="o">())</span> <span class="o">{</span>
  <span class="n">workers</span><span class="o">.</span><span class="na">remove</span><span class="o">();</span>
<span class="o">}</span></code></pre></figure><p><a href="http://dynamo.jcabi.com">jcabi-dynamo</a> has saved a lot of code lines in a few of my projects. You can see it in action at <a href="https://github.com/rultor/rultor/tree/rultor-0.2/rultor-users/src/main/java/com/rultor/users">rultor-users</a>.</p><p>The library ships as a JAR dependency in <a href="http://repo1.maven.org/maven2/com/jcabi/jcabi-dynamo">Maven Central</a> (get its latest versions from <a href="http://search.maven.org/">Maven Central</a>):</p><figure class="highlight"><pre><code class="language-xml" data-lang="xml"><span></span><span class="nt">&lt;dependency&gt;</span>
  <span class="nt">&lt;groupId&gt;</span>com.jcabi<span class="nt">&lt;/groupId&gt;</span>
  <span class="nt">&lt;artifactId&gt;</span>jcabi-dynamo<span class="nt">&lt;/artifactId&gt;</span>
<span class="nt">&lt;/dependency&gt;</span></code></pre></figure> "/> <meta name="twitter:url" property="og:url" content="https://www.yegor256.com/2014/04/14/jcabi-dynamo-java-api-of-aws-dynamodb.html"/> <meta name="telegram:channel" content="AAAAAEJFMRzsRTRxM3ec6A"/> <link rel="search" type="application/opensearchdescription+xml" href="/opensearch.xml" title="yegor256" /> <link rel="shortcut icon" href="/favicon.ico?ddf57a1cee0"/> <link rel="apple-touch-icon" href="/favicon.ico?ddf57a1cee0"/> <link rel="alternate" type="application/rss+xml" title="RSS for yegor256.com" href="https://www.yegor256.com/rss.xml"/> <link rel="stylesheet" href="/css/layout.css?ddf57a1cee0"/> <link rel="stylesheet" href="/css/icons.css?ddf57a1cee0"/> <link rel="canonical" href="https://www.yegor256.com/2014/04/14/jcabi-dynamo-java-api-of-aws-dynamodb.html" /> <link rel="amphtml" href="https://www.yegor256.com/2014/04/14/jcabi-dynamo-java-api-of-aws-dynamodb.amp.html" /> <title>Object-Oriented DynamoDB API </title> </head> <body><div class="wrapper"> <aside class="header-toggle unprintable" id="header-toggle" title="Show the menu" onclick="$('#header').show();$('#header-toggle').hide();">&#9776;</aside> <header class="header" id="header"><div class="face"> <a href="/about-me.html#form" class="sub" title="Click to subscribe to my monthly newsletter"><span>Subscribe</span></a> <a href="/about-me.html" style="position:relative;"> <img src="/images/face-256x256.jpg" class="photo" alt="Yegor Bugayenko"/> </a></div><nav><ul class="menu social notranslate"> <li><a href="https://twitter.com/intent/follow?screen_name=yegor256" rel="nofollow" title="Follow me on Twitter"><i class="icon icon-twitter notranslate" aria-hidden="true"></i></a></li> <li><a href="/rss.xml" rel="nofollow" title="Subscribe to my RSS feed"><i class="icon icon-rss notranslate" aria-hidden="true"></i></a></li> <li><a itemprop="sameAs" href="https://github.com/yegor256" rel="nofollow" title="My GitHub profile"><i class="icon icon-github notranslate" aria-hidden="true"></i></a></li> <li><a itemprop="sameAs" href="http://stackoverflow.com/users/187141/yegor256" rel="nofollow" title="My StackOverflow profile"><i class="icon icon-stackoverflow notranslate" aria-hidden="true"></i></a></li> <li><a itemprop="sameAs" href="https://www.facebook.com/yegor256" rel="nofollow" title="Follow me on Facebook"><i class="icon icon-facebook notranslate" aria-hidden="true"></i></a></li> <li><a itemprop="sameAs" href="https://instagram.com/yegor256" rel="nofollow" title="Follow me on Instagram"><i class="icon icon-instagram notranslate" aria-hidden="true"></i></a></li> <li><a itemprop="sameAs" href="https://www.linkedin.com/in/yegor256" rel="nofollow" title="My LinkedIn profile"><i class="icon icon-linkedin notranslate" aria-hidden="true"></i></a></li> <li><a itemprop="sameAs" href="https://www.youtube.com/c/yegor256?sub_confirmation=1" rel="nofollow" title="My Youtube video channel"><i class="icon icon-youtube notranslate" aria-hidden="true"></i></a></li> <li><a itemprop="sameAs" href="https://www.pinterest.com/yegor256/" rel="nofollow" title="My Pinterest boards"><i class="icon icon-pinterest notranslate" aria-hidden="true"></i></a></li> <li><a itemprop="sameAs" href="https://angel.co/yegor256" rel="nofollow" title="My AngelList profile"><i class="icon icon-angellist notranslate" aria-hidden="true"></i></a></li> <li><a href="https://soundcloud.com/yegor256" rel="nofollow" title="My podcast"><i class="icon icon-podcast notranslate" aria-hidden="true"></i></a></li> <li><a href="https://itunes.apple.com/us/podcast/yegor256-podcast/id1150826721" rel="nofollow" title="My iTunes podcast"><i class="icon icon-itunes notranslate" aria-hidden="true"></i></a></li> <li><a href="https://t.me/yegor256news" rel="nofollow" title="My Telegram public channel"><i class="icon icon-telegram notranslate" aria-hidden="true"></i></a></li> <li><a href="mailto:blog@yegor256.com" rel="nofollow" title="Email me any time"><i class="icon icon-mail notranslate" aria-hidden="true"></i></a></li></ul><ul class="menu"> <li><a href="/" title="Home page">Home</a></li> <li /2014/04/14/jcabi-dynamo-java-api-of-aws-dynamodb.html><a href="/best.html" title="Best articles to read">12&#160;Best</a></li> <li /2014/04/14/jcabi-dynamo-java-api-of-aws-dynamodb.html><a href="/contents.html" title="The contents of the entire blog">All&#160;292</a></li> <li /2014/04/14/jcabi-dynamo-java-api-of-aws-dynamodb.html><a href="/webinars.html" title="My webinars">Webinars</a></li> <li /2014/04/14/jcabi-dynamo-java-api-of-aws-dynamodb.html><a href="/talks.html" title="Future and past conference talks">Talks</a></li> <li /2014/04/14/jcabi-dynamo-java-api-of-aws-dynamodb.html><a href="/books.html" title="The books I wrote">Books</a></li> <li /2014/04/14/jcabi-dynamo-java-api-of-aws-dynamodb.html><a href="/papers.html" title="My academic papers and patents">Papers</a></li> <li /2014/04/14/jcabi-dynamo-java-api-of-aws-dynamodb.html><a href="/pets.html" title="My loved pet projects">Pets</a></li> <li /2014/04/14/jcabi-dynamo-java-api-of-aws-dynamodb.html class="highlighted"><a href="/trainings.html" title="On-site trainings">Trainings</a></li> <li /2014/04/14/jcabi-dynamo-java-api-of-aws-dynamodb.html><a href="/award.html" title="Software quality award">Award</a></li> <li /2014/04/14/jcabi-dynamo-java-api-of-aws-dynamodb.html><a href="/testimonials.html" title="What some people say about me">Testimonials</a></li> <li /2014/04/14/jcabi-dynamo-java-api-of-aws-dynamodb.html><a href="/shift-m.html" title="Audio podcast about project management">Shift-M</a></li> <li /2014/04/14/jcabi-dynamo-java-api-of-aws-dynamodb.html><a href="/paintings.html" title="My paintings for sale">Paintings</a></li> <li><a href="https://ru.yegor256.com/" title="Немного на русском языке">По-русски</a></li></ul></nav><div class="search"> <form method="get" action="https://www.google.com/search" itemprop="potentialAction" itemscope="" itemtype="http://schema.org/SearchAction"> <meta itemprop="target" content="https://www.google.com/search?q={q}"/> <input name="sitesearch" value="yegor256.com" type="hidden"/> <input itemprop="query-input" type="text" id="search-query" class="field field-text" required="required" onfocus="$('.google').css('visibility', 'visible');" name="q" placeholder="Search..." autocomplete="off"/> <input type="image" src="/images/google-search-icon.svg" class="google" title="Search via Google" alt="Search via Google"/> </form></div><div class="hot"><ul></ul></div></header></div><section itemscope="" itemtype="http://schema.org/BlogPosting"><div class="wrapper"> <header><p class="printable"> <img src="https://api.qrserver.com/v1/create-qr-code/?data=https://www.yegor256.com/2014/04/14/jcabi-dynamo-java-api-of-aws-dynamodb.html&amp;format=svg" style="width:125px;height:125px;" alt="QR code"/></p><p class="printable"> <code itemprop="url">https://www.yegor256.com/2014/04/14/jcabi-dynamo-java-api-of-aws-dynamodb.html</code></p><h1 itemprop="name headline mainEntityOfPage">Object-Oriented DynamoDB API</h1><ul class="subline"> <li> <time itemprop="datePublished" datetime="2014-04-14T00:00:00+00:00"> 14 April 2014 </time> </li> <li class="printable" itemscope="" itemprop="author" itemtype="http://schema.org/Person"> <span itemprop="name">Yegor Bugayenko</span> </li> <li class="unprintable"> <i class="icon icon-comments"></i> <a href="https://www.yegor256.com/2014/04/14/jcabi-dynamo-java-api-of-aws-dynamodb.html#disqus_thread" itemprop="discussionUrl">comments</a> </li></ul><p class="unprintable"><figure class="badge"><a href="http://dynamo.jcabi.com"><img src="http://img.jcabi.com/logo-square.svg" style="width:64px;max-width:100%;" alt="badge" /></a></figure><p>I’m a big fan of cloud computing in general and of <a href="http://aws.amazon.com/">Amazon Web Services</a> in particular. I honestly believe that in a few years big providers will host all, or almost all, computing and storage resources. When this is the case, we won’t have to worry too much anymore about downtime, backups and system administrators. <a href="http://aws.amazon.com/dynamodb/">DynamoDB</a> is one of the steps towards this future.</p><blockquote class="twitter-tweet" lang="en"><p>This looks cool - jcabi-dynamo - a <a href="https://twitter.com/search?q=%23Java&amp;src=hash">#Java</a> Object layer atop the <a href="https://twitter.com/search?q=%23DynamoDB&amp;src=hash">#DynamoDB</a> SDK - <a href="http://t.co/khRFR2joKX">http://t.co/khRFR2joKX</a> <a href="https://twitter.com/search?q=%23aws&amp;src=hash">#aws</a></p>---Jeff Barr (@jeffbarr) <a href="https://twitter.com/jeffbarr/statuses/380813867971915777">September 19, 2013</a></blockquote> <script async="" src="http://platform.twitter.com/widgets.js" charset="utf-8"></script><p>DynamoDB is a <a href="http://en.wikipedia.org/wiki/NoSQL">NoSQL</a> database accessible through <a href="http://en.wikipedia.org/wiki/Representational_state_transfer">RESTful</a> JSON API. Its design is relatively simple. There are tables, which basically are collections of data structures, or in AWS terminology, “items.”</p><p>Every item has a mandatory “hash,” an optional “range” and a number of other optional attributes. For instance, take the example table <code>depts</code>:</p><figure class="highlight"><pre><code class="language-text" data-lang="text"><span></span>+------+--------+---------------------------+
| dept | worker | Attributes                |
+------+--------+---------------------------+
| 205  | Jeff   | job=&quot;manager&quot;, sex=&quot;male&quot; |
| 205  | Bob    | age=43, city=&quot;Chicago&quot;    |
| 398  | Alice  | age=27, job=&quot;architect&quot;   |
+------+--------+---------------------------+</code></pre></figure><p>For Java, Amazon provides an <a href="https://aws.amazon.com/documentation/sdkforjava/">SDK</a>, which mirrors all RESTful calls to Java methods. The SDK works fine, but is designed in a pure <a href="http://en.wikipedia.org/wiki/Procedural_programming">procedural</a> style.</p><p>Let’s say we want to add a new item to the table above. RESTful call <a href="http://docs.aws.amazon.com/amazondynamodb/latest/APIReference/API_PutItem.html"><code>putItem</code></a> looks like (in essence):</p><figure class="highlight"><pre><code class="language-text" data-lang="text"><span></span>putItem:
  tableName: depts
  item:
    dept: 435
    worker: &quot;William&quot;
    job: &quot;programmer&quot;</code></pre></figure><p>This is what the Amazon server needs to know in order to create a new item in the table. This is how you’re supposed to make this call through the AWS Java SDK:</p><figure class="highlight"><pre><code class="language-java" data-lang="java"><span></span><span class="n">PutItemRequest</span> <span class="n">request</span> <span class="o">=</span> <span class="k">new</span> <span class="n">PutItemRequest</span><span class="o">();</span>
<span class="n">request</span><span class="o">.</span><span class="na">setTableName</span><span class="o">(</span><span class="s">&quot;depts&quot;</span><span class="o">);</span>
<span class="n">Map</span><span class="o">&lt;</span><span class="n">String</span><span class="o">,</span> <span class="n">AttributeValue</span><span class="o">&gt;</span> <span class="n">attributes</span> <span class="o">=</span> <span class="k">new</span> <span class="n">HashMap</span><span class="o">&lt;&gt;();</span>
<span class="n">attributes</span><span class="o">.</span><span class="na">put</span><span class="o">(</span><span class="s">&quot;dept&quot;</span><span class="o">,</span> <span class="k">new</span> <span class="n">AttributeValue</span><span class="o">(</span><span class="mi">435</span><span class="o">));</span>
<span class="n">attributes</span><span class="o">.</span><span class="na">put</span><span class="o">(</span><span class="s">&quot;worker&quot;</span><span class="o">,</span> <span class="k">new</span> <span class="n">AttributeValue</span><span class="o">(</span><span class="s">&quot;William&quot;</span><span class="o">));</span>
<span class="n">attributes</span><span class="o">.</span><span class="na">put</span><span class="o">(</span><span class="s">&quot;job&quot;</span><span class="o">,</span> <span class="k">new</span> <span class="n">AttributeValue</span><span class="o">(</span><span class="err">&quot;</span><span class="n">programmer</span><span class="o">));</span>
<span class="n">request</span><span class="o">.</span><span class="na">setItem</span><span class="o">(</span><span class="n">attributes</span><span class="o">);</span>
<span class="n">AmazonDynamoDB</span> <span class="n">aws</span> <span class="o">=</span> <span class="c1">// instantiate it with credentials</span>
<span class="k">try</span> <span class="o">{</span>
  <span class="n">aws</span><span class="o">.</span><span class="na">putItem</span><span class="o">(</span><span class="n">request</span><span class="o">);</span>
<span class="o">}</span> <span class="k">finally</span> <span class="o">{</span>
  <span class="n">aws</span><span class="o">.</span><span class="na">shutdown</span><span class="o">();</span>
<span class="o">}</span></code></pre></figure><p>The above script works fine, but there is one major drawback—it is not object oriented. It is a perfect example of an imperative <a href="http://en.wikipedia.org/wiki/Procedural_programming">procedural programming</a>.</p><p>To allow you to compare, let me show what I’ve done with <a href="http://dynamo.jcabi.com">jcabi-dynamo</a>. Here is my code, which does exactly the same thing, but in an <a href="http://en.wikipedia.org/wiki/Object-oriented_programming">object-oriented</a> way:</p><figure class="highlight"><pre><code class="language-java" data-lang="java"><span></span><span class="n">Region</span> <span class="n">region</span> <span class="o">=</span> <span class="c1">// instantiate it with credentials</span>
<span class="n">Table</span> <span class="n">table</span> <span class="o">=</span> <span class="n">region</span><span class="o">.</span><span class="na">table</span><span class="o">(</span><span class="s">&quot;depts&quot;</span><span class="o">);</span>
<span class="n">Item</span> <span class="n">item</span> <span class="o">=</span> <span class="n">table</span><span class="o">.</span><span class="na">put</span><span class="o">(</span>
  <span class="k">new</span> <span class="n">Attributes</span><span class="o">()</span>
    <span class="o">.</span><span class="na">with</span><span class="o">(</span><span class="s">&quot;dept&quot;</span><span class="o">,</span> <span class="mi">435</span><span class="o">)</span>
    <span class="o">.</span><span class="na">with</span><span class="o">(</span><span class="s">&quot;worker&quot;</span><span class="o">,</span> <span class="s">&quot;William&quot;</span><span class="o">)</span>
    <span class="o">.</span><span class="na">with</span><span class="o">(</span><span class="s">&quot;job&quot;</span><span class="o">,</span> <span class="s">&quot;programmer&quot;</span><span class="o">)</span>
<span class="o">);</span></code></pre></figure><p>My code is not only shorter, but it also employs <a href="/2016/11/21/naked-data.html">encapsulation</a> and separates responsibilities of classes. <a href="http://dynamo.jcabi.com/apidocs-0.10/com/jcabi/dynamo/Table.html"><code>Table</code></a> class (actually it is an interface internally implemented by a class) encapsulates information about the table, while <a href="http://dynamo.jcabi.com/apidocs-0.10/com/jcabi/dynamo/Item.html"><code>Item</code></a> encapsulates item details.</p><p>We can pass an <code>item</code> as an argument to another method and all DynamoDB related implementation details will be hidden from it. For example, somewhere later in the code:</p><figure class="highlight"><pre><code class="language-java" data-lang="java"><span></span><span class="kt">void</span> <span class="nf">sayHello</span><span class="o">(</span><span class="n">Item</span> <span class="n">item</span><span class="o">)</span> <span class="o">{</span>
  <span class="n">System</span><span class="o">.</span><span class="na">out</span><span class="o">.</span><span class="na">println</span><span class="o">(</span><span class="s">&quot;Hello, &quot;</span> <span class="o">+</span> <span class="n">item</span><span class="o">.</span><span class="na">get</span><span class="o">(</span><span class="s">&quot;worker&quot;</span><span class="o">));</span>
<span class="o">}</span></code></pre></figure><p>In this script, we don’t know anything about DynamoDB or how to deal with its RESTful API. We interact solely with an instance of <a href="http://dynamo.jcabi.com/apidocs-0.10/com/jcabi/dynamo/Item.html"><code>Item</code></a> class.</p><p>By the way, all public entities in <a href="http://dynamo.jcabi.com">jcabi-dynamo</a> are Java interfaces. Thanks to that, you can test and mock the library completely (but I would recommend to use <a href="/2014/05/01/dynamodb-local-maven-plugin.html">DynamoDB Local</a> and create integration tests).</p><p>Let’s consider a more complex example, which would take a page of code if we were to use a bare AWS SDK. Let’s say that we want to remove all workers from our table who work as architects:</p><figure class="highlight"><pre><code class="language-java" data-lang="java"><span></span><span class="n">Region</span> <span class="n">region</span> <span class="o">=</span> <span class="c1">// instantiate it with credentials</span>
<span class="n">Iterator</span><span class="o">&lt;</span><span class="n">Item</span><span class="o">&gt;</span> <span class="n">workers</span> <span class="o">=</span> <span class="n">region</span><span class="o">.</span><span class="na">table</span><span class="o">(</span><span class="s">&quot;depts&quot;</span><span class="o">).</span><span class="na">frame</span><span class="o">()</span>
  <span class="o">.</span><span class="na">where</span><span class="o">(</span><span class="s">&quot;job&quot;</span><span class="o">,</span> <span class="n">Condition</span><span class="o">.</span><span class="na">equalTo</span><span class="o">(</span><span class="s">&quot;architect&quot;</span><span class="o">));</span>
<span class="k">while</span> <span class="o">(</span><span class="n">workers</span><span class="o">.</span><span class="na">hasNext</span><span class="o">())</span> <span class="o">{</span>
  <span class="n">workers</span><span class="o">.</span><span class="na">remove</span><span class="o">();</span>
<span class="o">}</span></code></pre></figure><p><a href="http://dynamo.jcabi.com">jcabi-dynamo</a> has saved a lot of code lines in a few of my projects. You can see it in action at <a href="https://github.com/rultor/rultor/tree/rultor-0.2/rultor-users/src/main/java/com/rultor/users">rultor-users</a>.</p><p>The library ships as a JAR dependency in <a href="http://repo1.maven.org/maven2/com/jcabi/jcabi-dynamo">Maven Central</a> (get its latest versions from <a href="http://search.maven.org/">Maven Central</a>):</p><figure class="highlight"><pre><code class="language-xml" data-lang="xml"><span></span><span class="nt">&lt;dependency&gt;</span>
  <span class="nt">&lt;groupId&gt;</span>com.jcabi<span class="nt">&lt;/groupId&gt;</span>
  <span class="nt">&lt;artifactId&gt;</span>jcabi-dynamo<span class="nt">&lt;/artifactId&gt;</span>
<span class="nt">&lt;/dependency&gt;</span></code></pre></figure></p><nav class="buttons notranslate desktop-only"> <a href="http://www.facebook.com/sharer/sharer.php?u=https://www.yegor256.com/2014/04/14/jcabi-dynamo-java-api-of-aws-dynamodb.html" title="Share on Facebook" class="button" rel="nofollow"> <span class="count count-facebook">0</span> <i class="icon icon-facebook notranslate" aria-hidden="true"></i> </a> <a href="https://twitter.com/share?url=https://www.yegor256.com/2014/04/14/jcabi-dynamo-java-api-of-aws-dynamodb.html&amp;text=Object-Oriented+DynamoDB+API" title="Share on Twitter" class="button" rel="nofollow"> <span class="count count-twitter">0</span> <i class="icon icon-twitter notranslate" aria-hidden="true"></i> </a> <a href="https://plus.google.com/share?url=https://www.yegor256.com/2014/04/14/jcabi-dynamo-java-api-of-aws-dynamodb.html" title="Share on Google+" class="button" rel="nofollow"> <span class="count count-googleplus">0</span> <i class="icon icon-googleplus notranslate" aria-hidden="true"></i> </a> <a href="https://www.linkedin.com/cws/share?url=https://www.yegor256.com/2014/04/14/jcabi-dynamo-java-api-of-aws-dynamodb.html" title="Share on LinkedIn" class="button" rel="nofollow"> <span class="count count-linkedin">0</span> <i class="icon icon-linkedin notranslate" aria-hidden="true"></i> </a> <a href="http://reddit.com/submit?url=https://www.yegor256.com/2014/04/14/jcabi-dynamo-java-api-of-aws-dynamodb.html%3F2014-15&amp;title=Object-Oriented+DynamoDB+API" title="Share on Reddit" class="button" rel="nofollow"> <span class="count count-reddit">0</span> <i class="icon icon-reddit notranslate" aria-hidden="true"></i> </a> <a href="http://news.ycombinator.com/submitlink?u=https://www.yegor256.com/2014/04/14/jcabi-dynamo-java-api-of-aws-dynamodb.html%3F2014-15&amp;t=Object-Oriented+DynamoDB+API" title="Share on Hacker News" class="button" rel="nofollow"> <span class="count count-hackernews">0</span> <i class="icon icon-hackernews notranslate" aria-hidden="true"></i> </a> </nav> </header> <article class="main" itemprop="articleBody"><div > <figure class="badge"><a href="http://dynamo.jcabi.com"><img src="http://img.jcabi.com/logo-square.svg" style="width:64px;max-width:100%;" alt="badge" /></a></figure><p>I’m a big fan of cloud computing in general and of <a href="http://aws.amazon.com/">Amazon Web Services</a> in particular. I honestly believe that in a few years big providers will host all, or almost all, computing and storage resources. When this is the case, we won’t have to worry too much anymore about downtime, backups and system administrators. <a href="http://aws.amazon.com/dynamodb/">DynamoDB</a> is one of the steps towards this future.</p><blockquote class="twitter-tweet" lang="en"><p>This looks cool - jcabi-dynamo - a <a href="https://twitter.com/search?q=%23Java&amp;src=hash">#Java</a> Object layer atop the <a href="https://twitter.com/search?q=%23DynamoDB&amp;src=hash">#DynamoDB</a> SDK - <a href="http://t.co/khRFR2joKX">http://t.co/khRFR2joKX</a> <a href="https://twitter.com/search?q=%23aws&amp;src=hash">#aws</a></p>---Jeff Barr (@jeffbarr) <a href="https://twitter.com/jeffbarr/statuses/380813867971915777">September 19, 2013</a></blockquote> <script async="" src="http://platform.twitter.com/widgets.js" charset="utf-8"></script><p>DynamoDB is a <a href="http://en.wikipedia.org/wiki/NoSQL">NoSQL</a> database accessible through <a href="http://en.wikipedia.org/wiki/Representational_state_transfer">RESTful</a> JSON API. Its design is relatively simple. There are tables, which basically are collections of data structures, or in AWS terminology, “items.”</p><p>Every item has a mandatory “hash,” an optional “range” and a number of other optional attributes. For instance, take the example table <code>depts</code>:</p><figure class="highlight"><pre><code class="language-text" data-lang="text"><span></span>+------+--------+---------------------------+
| dept | worker | Attributes                |
+------+--------+---------------------------+
| 205  | Jeff   | job=&quot;manager&quot;, sex=&quot;male&quot; |
| 205  | Bob    | age=43, city=&quot;Chicago&quot;    |
| 398  | Alice  | age=27, job=&quot;architect&quot;   |
+------+--------+---------------------------+</code></pre></figure><p>For Java, Amazon provides an <a href="https://aws.amazon.com/documentation/sdkforjava/">SDK</a>, which mirrors all RESTful calls to Java methods. The SDK works fine, but is designed in a pure <a href="http://en.wikipedia.org/wiki/Procedural_programming">procedural</a> style.</p><p>Let’s say we want to add a new item to the table above. RESTful call <a href="http://docs.aws.amazon.com/amazondynamodb/latest/APIReference/API_PutItem.html"><code>putItem</code></a> looks like (in essence):</p><figure class="highlight"><pre><code class="language-text" data-lang="text"><span></span>putItem:
  tableName: depts
  item:
    dept: 435
    worker: &quot;William&quot;
    job: &quot;programmer&quot;</code></pre></figure><p>This is what the Amazon server needs to know in order to create a new item in the table. This is how you’re supposed to make this call through the AWS Java SDK:</p><figure class="highlight"><pre><code class="language-java" data-lang="java"><span></span><span class="n">PutItemRequest</span> <span class="n">request</span> <span class="o">=</span> <span class="k">new</span> <span class="n">PutItemRequest</span><span class="o">();</span>
<span class="n">request</span><span class="o">.</span><span class="na">setTableName</span><span class="o">(</span><span class="s">&quot;depts&quot;</span><span class="o">);</span>
<span class="n">Map</span><span class="o">&lt;</span><span class="n">String</span><span class="o">,</span> <span class="n">AttributeValue</span><span class="o">&gt;</span> <span class="n">attributes</span> <span class="o">=</span> <span class="k">new</span> <span class="n">HashMap</span><span class="o">&lt;&gt;();</span>
<span class="n">attributes</span><span class="o">.</span><span class="na">put</span><span class="o">(</span><span class="s">&quot;dept&quot;</span><span class="o">,</span> <span class="k">new</span> <span class="n">AttributeValue</span><span class="o">(</span><span class="mi">435</span><span class="o">));</span>
<span class="n">attributes</span><span class="o">.</span><span class="na">put</span><span class="o">(</span><span class="s">&quot;worker&quot;</span><span class="o">,</span> <span class="k">new</span> <span class="n">AttributeValue</span><span class="o">(</span><span class="s">&quot;William&quot;</span><span class="o">));</span>
<span class="n">attributes</span><span class="o">.</span><span class="na">put</span><span class="o">(</span><span class="s">&quot;job&quot;</span><span class="o">,</span> <span class="k">new</span> <span class="n">AttributeValue</span><span class="o">(</span><span class="err">&quot;</span><span class="n">programmer</span><span class="o">));</span>
<span class="n">request</span><span class="o">.</span><span class="na">setItem</span><span class="o">(</span><span class="n">attributes</span><span class="o">);</span>
<span class="n">AmazonDynamoDB</span> <span class="n">aws</span> <span class="o">=</span> <span class="c1">// instantiate it with credentials</span>
<span class="k">try</span> <span class="o">{</span>
  <span class="n">aws</span><span class="o">.</span><span class="na">putItem</span><span class="o">(</span><span class="n">request</span><span class="o">);</span>
<span class="o">}</span> <span class="k">finally</span> <span class="o">{</span>
  <span class="n">aws</span><span class="o">.</span><span class="na">shutdown</span><span class="o">();</span>
<span class="o">}</span></code></pre></figure><p>The above script works fine, but there is one major drawback—it is not object oriented. It is a perfect example of an imperative <a href="http://en.wikipedia.org/wiki/Procedural_programming">procedural programming</a>.</p><p>To allow you to compare, let me show what I’ve done with <a href="http://dynamo.jcabi.com">jcabi-dynamo</a>. Here is my code, which does exactly the same thing, but in an <a href="http://en.wikipedia.org/wiki/Object-oriented_programming">object-oriented</a> way:</p><figure class="highlight"><pre><code class="language-java" data-lang="java"><span></span><span class="n">Region</span> <span class="n">region</span> <span class="o">=</span> <span class="c1">// instantiate it with credentials</span>
<span class="n">Table</span> <span class="n">table</span> <span class="o">=</span> <span class="n">region</span><span class="o">.</span><span class="na">table</span><span class="o">(</span><span class="s">&quot;depts&quot;</span><span class="o">);</span>
<span class="n">Item</span> <span class="n">item</span> <span class="o">=</span> <span class="n">table</span><span class="o">.</span><span class="na">put</span><span class="o">(</span>
  <span class="k">new</span> <span class="n">Attributes</span><span class="o">()</span>
    <span class="o">.</span><span class="na">with</span><span class="o">(</span><span class="s">&quot;dept&quot;</span><span class="o">,</span> <span class="mi">435</span><span class="o">)</span>
    <span class="o">.</span><span class="na">with</span><span class="o">(</span><span class="s">&quot;worker&quot;</span><span class="o">,</span> <span class="s">&quot;William&quot;</span><span class="o">)</span>
    <span class="o">.</span><span class="na">with</span><span class="o">(</span><span class="s">&quot;job&quot;</span><span class="o">,</span> <span class="s">&quot;programmer&quot;</span><span class="o">)</span>
<span class="o">);</span></code></pre></figure><p>My code is not only shorter, but it also employs <a href="/2016/11/21/naked-data.html">encapsulation</a> and separates responsibilities of classes. <a href="http://dynamo.jcabi.com/apidocs-0.10/com/jcabi/dynamo/Table.html"><code>Table</code></a> class (actually it is an interface internally implemented by a class) encapsulates information about the table, while <a href="http://dynamo.jcabi.com/apidocs-0.10/com/jcabi/dynamo/Item.html"><code>Item</code></a> encapsulates item details.</p><p>We can pass an <code>item</code> as an argument to another method and all DynamoDB related implementation details will be hidden from it. For example, somewhere later in the code:</p><figure class="highlight"><pre><code class="language-java" data-lang="java"><span></span><span class="kt">void</span> <span class="nf">sayHello</span><span class="o">(</span><span class="n">Item</span> <span class="n">item</span><span class="o">)</span> <span class="o">{</span>
  <span class="n">System</span><span class="o">.</span><span class="na">out</span><span class="o">.</span><span class="na">println</span><span class="o">(</span><span class="s">&quot;Hello, &quot;</span> <span class="o">+</span> <span class="n">item</span><span class="o">.</span><span class="na">get</span><span class="o">(</span><span class="s">&quot;worker&quot;</span><span class="o">));</span>
<span class="o">}</span></code></pre></figure><p>In this script, we don’t know anything about DynamoDB or how to deal with its RESTful API. We interact solely with an instance of <a href="http://dynamo.jcabi.com/apidocs-0.10/com/jcabi/dynamo/Item.html"><code>Item</code></a> class.</p><p>By the way, all public entities in <a href="http://dynamo.jcabi.com">jcabi-dynamo</a> are Java interfaces. Thanks to that, you can test and mock the library completely (but I would recommend to use <a href="/2014/05/01/dynamodb-local-maven-plugin.html">DynamoDB Local</a> and create integration tests).</p><p>Let’s consider a more complex example, which would take a page of code if we were to use a bare AWS SDK. Let’s say that we want to remove all workers from our table who work as architects:</p><figure class="highlight"><pre><code class="language-java" data-lang="java"><span></span><span class="n">Region</span> <span class="n">region</span> <span class="o">=</span> <span class="c1">// instantiate it with credentials</span>
<span class="n">Iterator</span><span class="o">&lt;</span><span class="n">Item</span><span class="o">&gt;</span> <span class="n">workers</span> <span class="o">=</span> <span class="n">region</span><span class="o">.</span><span class="na">table</span><span class="o">(</span><span class="s">&quot;depts&quot;</span><span class="o">).</span><span class="na">frame</span><span class="o">()</span>
  <span class="o">.</span><span class="na">where</span><span class="o">(</span><span class="s">&quot;job&quot;</span><span class="o">,</span> <span class="n">Condition</span><span class="o">.</span><span class="na">equalTo</span><span class="o">(</span><span class="s">&quot;architect&quot;</span><span class="o">));</span>
<span class="k">while</span> <span class="o">(</span><span class="n">workers</span><span class="o">.</span><span class="na">hasNext</span><span class="o">())</span> <span class="o">{</span>
  <span class="n">workers</span><span class="o">.</span><span class="na">remove</span><span class="o">();</span>
<span class="o">}</span></code></pre></figure><p><a href="http://dynamo.jcabi.com">jcabi-dynamo</a> has saved a lot of code lines in a few of my projects. You can see it in action at <a href="https://github.com/rultor/rultor/tree/rultor-0.2/rultor-users/src/main/java/com/rultor/users">rultor-users</a>.</p><p>The library ships as a JAR dependency in <a href="http://repo1.maven.org/maven2/com/jcabi/jcabi-dynamo">Maven Central</a> (get its latest versions from <a href="http://search.maven.org/">Maven Central</a>):</p><figure class="highlight"><pre><code class="language-xml" data-lang="xml"><span></span><span class="nt">&lt;dependency&gt;</span>
  <span class="nt">&lt;groupId&gt;</span>com.jcabi<span class="nt">&lt;/groupId&gt;</span>
  <span class="nt">&lt;artifactId&gt;</span>jcabi-dynamo<span class="nt">&lt;/artifactId&gt;</span>
<span class="nt">&lt;/dependency&gt;</span></code></pre></figure></div></article></div><div class="wrapper"> <related-posts /></div><div class="disqus" role="complementary"><p class="disqus_hint"> Please, use <a href="https://help.disqus.com/commenting/what-html-tags-are-allowed-within-comments">syntax highlighting</a> in your comments, to make them more readable.</p><div id="disqus_thread" class="disqus-thread"> <a>&nbsp;</a></div><script> var disqus_config = function () { this.page.url = document.location.href.split('?')[0].split('#')[0].replace('https://', 'http://'); this.page.identifier = this.page.url; }; (function() { var d = document, s = d.createElement('script'); s.src = '//yegor256.disqus.com/embed.js'; s.setAttribute('data-timestamp', +new Date()); (d.head || d.body).appendChild(s); })(); </script> <noscript><div><p class="red"> JavaScript is disabled in your browser, that's why you can't see comments under this post.</p></div></noscript></div><div class="wrapper"> <footer class="footer"><p> &copy; <span itemscope="" itemprop="copyrightHolder" itemtype="http://schema.org/Person"> <span itemprop="name">Yegor Bugayenko</span> </span> 2014&ndash;<span itemprop="copyrightYear">2018</span></p></footer></div></section><div class="wrapper unprintable" style="text-align:center;margin-top:2em;"> <a href="http://www.sixnines.io/h/3ba1652f"> <img src="//www.sixnines.io/b/3ba1652f?style=flat" alt="sixnines availability badge"/> </a></div><script src="//code.jquery.com/jquery-1.9.0.min.js"></script> <script src="/js/all.js?ddf57a1cee0"></script> <script>var disqus_shortname = 'yegor256';</script> <script id="dsq-count-scr" src="//yegor256.disqus.com/count.js" async="async"></script> <script> (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){ (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o), m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m) })(window,document,'script','//www.google-analytics.com/analytics.js','ga'); ga('create', 'UA-1963507-32', 'auto'); ga('send', 'pageview'); </script> <script> Cd=document;Cr="&"+Math.random();Cp="&s=1"; Cd.cookie="b=b";if(Cd.cookie)Cp+="&c=1"; Cp+="&t="+(new Date()).getTimezoneOffset(); if(self!=top)Cp+="&f=1"; </script> <script> if(navigator.javaEnabled())Cp+="&j=1"; </script> <script> if(typeof(screen)!='undefined')Cp+="&w="+screen.width+"&h="+ screen.height+"&d="+(screen.colorDepth?screen.colorDepth:screen.pixelDepth); </script> <script> Cd.write("<img src='//c.hit.ua/hit?i=95870&g=0&x=2"+Cp+Cr+ "&r="+escape(Cd.referrer)+"&u="+escape(window.location.href)+ "' border='0' wi"+"dth='1' he"+"ight='1'/>"); </script> <script type="application/ld+json"> { "@context": "http://schema.org", "@type": "Person", "name": "Yegor Bugayenko", "url": "https://www.yegor256.com", "sameAs": [ "https://www.facebook.com/yegor256", "https://instagram.com/yegor256", "https://www.linkedin.com/in/yegor256", "https://twitter.com/yegor256", "https://github.com/yegor256", "https://www.pinterest.com/yegor256/" ] } </script> </body> </html> </article></div></section><div class="wrapper unprintable" style="text-align:center;margin-top:2em;"> <a href="http://www.sixnines.io/h/3ba1652f"> <img src="//www.sixnines.io/b/3ba1652f?style=flat" alt="sixnines availability badge"/> </a></div><script src="//code.jquery.com/jquery-1.9.0.min.js"></script> <script src="/js/all.js?ddf57a1cee0"></script> <script>var disqus_shortname = 'yegor256';</script> <script id="dsq-count-scr" src="//yegor256.disqus.com/count.js" async="async"></script> <script> (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){ (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o), m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m) })(window,document,'script','//www.google-analytics.com/analytics.js','ga'); ga('create', 'UA-1963507-32', 'auto'); ga('send', 'pageview'); </script> <script> Cd=document;Cr="&"+Math.random();Cp="&s=1"; Cd.cookie="b=b";if(Cd.cookie)Cp+="&c=1"; Cp+="&t="+(new Date()).getTimezoneOffset(); if(self!=top)Cp+="&f=1"; </script> <script> if(navigator.javaEnabled())Cp+="&j=1"; </script> <script> if(typeof(screen)!='undefined')Cp+="&w="+screen.width+"&h="+ screen.height+"&d="+(screen.colorDepth?screen.colorDepth:screen.pixelDepth); </script> <script> Cd.write("<img src='//c.hit.ua/hit?i=95870&g=0&x=2"+Cp+Cr+ "&r="+escape(Cd.referrer)+"&u="+escape(window.location.href)+ "' border='0' wi"+"dth='1' he"+"ight='1'/>"); </script> <script type="application/ld+json"> { "@context": "http://schema.org", "@type": "Person", "name": "Yegor Bugayenko", "url": "https://www.yegor256.com", "sameAs": [ "https://www.facebook.com/yegor256", "https://instagram.com/yegor256", "https://www.linkedin.com/in/yegor256", "https://twitter.com/yegor256", "https://github.com/yegor256", "https://www.pinterest.com/yegor256/" ] } </script> </body> </html>
