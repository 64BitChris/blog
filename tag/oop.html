<!DOCTYPE html> <html xmlns="http://www.w3.org/1999/xhtml" lang="en-US" xml:lang="en-US" itemscope="" itemtype="http://schema.org/WebSite"> <head> <meta charset="utf-8"/> <meta name="description" content="oop: more about oop in this collection of recently published articles... the list is updated every few weeks." /> <meta name="keywords" content="" /> <meta name="viewport" content="width=device-width,minimum-scale=1,initial-scale=1"/> <meta name="google-site-verification" content="JEj_gQr2CPe2QKGw8XdMz0R7VboQIUbX3FlM-lwTq-8" /> <meta name="author" content="Yegor Bugayenko"> <meta name="og:site_name" content="Yegor Bugayenko"/> <meta name="og:type" content="article" /> <meta name="og:locale" content="en_US" /> <meta name="twitter:account_id" content="4503599630178231" /> <meta name="twitter:creator" content="@yegor256"/> <meta name="twitter:site" content="@yegor256"/> <meta name="twitter:title" property="og:title" content="oop"/> <meta name="twitter:description" property="og:description" content="oop: more about oop in this collection of recently published articles... the list is updated every few weeks."/> <meta name="twitter:url" property="og:url" content="https://www.yegor256.com/tag/oop"/> <meta name="telegram:channel" content="AAAAAEJFMRzsRTRxM3ec6A"/> <link rel="search" type="application/opensearchdescription+xml" href="/opensearch.xml" title="yegor256" /> <link rel="shortcut icon" href="/favicon.ico?a0e0d018c07"/> <link rel="apple-touch-icon" href="/favicon.ico?a0e0d018c07"/> <link rel="alternate" type="application/rss+xml" title="RSS for yegor256.com" href="https://www.yegor256.com/rss.xml"/> <link rel="stylesheet" href="/css/layout.css?a0e0d018c07"/> <link rel="stylesheet" href="/css/icons.css?a0e0d018c07"/> <link rel="canonical" href="https://www.yegor256.com/tag/oop" /> <link rel="amphtml" href="https://www.yegor256.com/tag/oop" /> <title>oop </title> </head> <body><div class="wrapper"> <aside class="header-toggle unprintable" id="header-toggle" title="Show the menu" onclick="$('#header').show();$('#header-toggle').hide();">&#9776;</aside> <header class="header" id="header"><div class="face"> <a href="/about-me.html#form" class="sub" title="Click to subscribe to my monthly newsletter"><span>Subscribe</span></a> <a href="/about-me.html" style="position:relative;"> <img src="/images/face-256x256.jpg" class="photo" alt="Yegor Bugayenko"/> </a></div><nav><ul class="menu social notranslate"> <li><a href="https://twitter.com/intent/follow?screen_name=yegor256" rel="nofollow" title="Follow me on Twitter"><i class="icon icon-twitter notranslate" aria-hidden="true"></i></a></li> <li><a href="/rss.xml" rel="nofollow" title="Subscribe to my RSS feed"><i class="icon icon-rss notranslate" aria-hidden="true"></i></a></li> <li><a itemprop="sameAs" href="https://github.com/yegor256" rel="nofollow" title="My GitHub profile"><i class="icon icon-github notranslate" aria-hidden="true"></i></a></li> <li><a itemprop="sameAs" href="http://stackoverflow.com/users/187141/yegor256" rel="nofollow" title="My StackOverflow profile"><i class="icon icon-stackoverflow notranslate" aria-hidden="true"></i></a></li> <li><a itemprop="sameAs" href="https://www.facebook.com/yegor256" rel="nofollow" title="Follow me on Facebook"><i class="icon icon-facebook notranslate" aria-hidden="true"></i></a></li> <li><a itemprop="sameAs" href="https://instagram.com/yegor256" rel="nofollow" title="Follow me on Instagram"><i class="icon icon-instagram notranslate" aria-hidden="true"></i></a></li> <li><a itemprop="sameAs" href="https://www.linkedin.com/in/yegor256" rel="nofollow" title="My LinkedIn profile"><i class="icon icon-linkedin notranslate" aria-hidden="true"></i></a></li> <li><a itemprop="sameAs" href="https://www.youtube.com/c/yegor256?sub_confirmation=1" rel="nofollow" title="My Youtube video channel"><i class="icon icon-youtube notranslate" aria-hidden="true"></i></a></li> <li><a itemprop="sameAs" href="https://www.pinterest.com/yegor256/" rel="nofollow" title="My Pinterest boards"><i class="icon icon-pinterest notranslate" aria-hidden="true"></i></a></li> <li><a itemprop="sameAs" href="https://angel.co/yegor256" rel="nofollow" title="My AngelList profile"><i class="icon icon-angellist notranslate" aria-hidden="true"></i></a></li> <li><a href="https://soundcloud.com/yegor256" rel="nofollow" title="My podcast"><i class="icon icon-podcast notranslate" aria-hidden="true"></i></a></li> <li><a href="https://itunes.apple.com/us/podcast/yegor256-podcast/id1150826721" rel="nofollow" title="My iTunes podcast"><i class="icon icon-itunes notranslate" aria-hidden="true"></i></a></li> <li><a href="https://t.me/joinchat/AAAAAEJFMRzsRTRxM3ec6A" rel="nofollow" title="My Telegram public channel"><i class="icon icon-telegram notranslate" aria-hidden="true"></i></a></li> <li><a href="mailto:blog@yegor256.com" rel="nofollow" title="Email me any time"><i class="icon icon-mail notranslate" aria-hidden="true"></i></a></li></ul><ul class="menu"> <li><a href="/" title="Home page">Home</a></li> <li ><a href="/best.html" title="Best articles to read">12&#160;Best</a></li> <li ><a href="/contents.html" title="The contents of the entire blog">All&#160;288</a></li> <li ><a href="/webinars.html" title="My webinars">Webinars</a></li> <li ><a href="/talks.html" title="Future and past conference talks">Talks</a></li> <li ><a href="/books.html" title="The books I wrote">Books</a></li> <li ><a href="/papers.html" title="My academic papers and patents">Papers</a></li> <li ><a href="/pets.html" title="My loved pet projects">Pets</a></li> <li ><a href="/award.html" title="Software quality award">Award</a></li> <li ><a href="/testimonials.html" title="What some people say about me">Testimonials</a></li> <li ><a href="/shift-m.html" title="Audio podcast about project management">Shift-M</a></li> <li ><a href="/paintings.html" title="My paintings for sale">Paintings</a></li> <li><a href="http://ru.yegor256.com/" title="Немного на русском языке">По-русски</a></li></ul></nav><div class="search"> <form method="get" action="https://www.google.com/search" itemprop="potentialAction" itemscope="" itemtype="http://schema.org/SearchAction"> <meta itemprop="target" content="https://www.google.com/search?q={q}"/> <input name="sitesearch" value="yegor256.com" type="hidden"/> <input itemprop="query-input" type="text" id="search-query" class="field field-text" required="required" onfocus="$('.google').css('visibility', 'visible');" name="q" placeholder="Search..." autocomplete="off"/> <input type="image" src="/images/google-search-icon.svg" class="google" title="Search via Google" alt="Search via Google"/> </form></div><div class="hot"><ul> <li> <a href="/code-ahead.html">Code Ahead</a> was published on Amazon just a few days ago! It is my new book, a novel about programmers. It explains in details the majority of ideas that stand behind <a href="https://www.zerocracy.com">Zerocracy</a> and <a href="https://www.xdsd.org">XDSD</a>. </li> <li> At <a href="/webinars.html">Webinar #37</a> we will discuss naming problem in OOP, for objects, methods and attributes; join us on <b>September 12</b>, at 11am PST. </li></ul></div></header></div><section itemscope="" itemtype="http://schema.org/BlogPosting"><div class="wrapper"> <header itemprop="name"><h1>73 Posts About Object-Oriented Programming (OOP)</h1><p> <a href="https://gitter.im/yegor256/elegantobjects"><img alt="Elegant Objects logo" src="/images/books/elegant-objects/cactus.svg" style="height:150px;float:right;margin-left:1em"/></a> You can learn more about OOP from my recently published book <a href="/elegant-objects.html">Elegant Objects</a> too.</p></header> <article itemprop="articleBody"> <!DOCTYPE html> <html xmlns="http://www.w3.org/1999/xhtml" lang="en-US" xml:lang="en-US" itemscope="" itemtype="http://schema.org/WebSite"> <head> <meta charset="utf-8"/> <meta name="description" content="Giving good names to methods in object-oriented programming is a tough job, which can be done right if you follow this simple principle. " /> <meta name="keywords" content="good name for a method, java method name, method name in oop, method naming, method naming best practices" /> <meta name="viewport" content="width=device-width,minimum-scale=1,initial-scale=1"/> <meta name="google-site-verification" content="JEj_gQr2CPe2QKGw8XdMz0R7VboQIUbX3FlM-lwTq-8" /> <meta name="author" content="Yegor Bugayenko"> <meta name="article:published_time" content="2018-08-22 00:00:00 +0000"> <meta name="og:site_name" content="Yegor Bugayenko"/> <meta name="og:type" content="article" /> <meta name="og:locale" content="en_US" /> <meta name="twitter:account_id" content="4503599630178231" /> <meta name="twitter:creator" content="@yegor256"/> <meta name="twitter:site" content="@yegor256"/> <meta name="twitter:title" property="og:title" content="Builders and Manipulators"/> <meta name="twitter:description" property="og:description" content="Giving good names to methods in object-oriented programming is a tough job, which can be done right if you follow this simple principle. "/> <meta name="twitter:url" property="og:url" content="https://www.yegor256.com/2018/08/22/builders-and-manipulators.html"/> <meta name="telegram:channel" content="AAAAAEJFMRzsRTRxM3ec6A"/> <link rel="search" type="application/opensearchdescription+xml" href="/opensearch.xml" title="yegor256" /> <link rel="shortcut icon" href="/favicon.ico?a0e0d018c07"/> <link rel="apple-touch-icon" href="/favicon.ico?a0e0d018c07"/> <link rel="alternate" type="application/rss+xml" title="RSS for yegor256.com" href="https://www.yegor256.com/rss.xml"/> <link rel="stylesheet" href="/css/layout.css?a0e0d018c07"/> <link rel="stylesheet" href="/css/icons.css?a0e0d018c07"/> <link rel="canonical" href="https://www.yegor256.com/2018/08/22/builders-and-manipulators.html" /> <link rel="amphtml" href="https://www.yegor256.com/2018/08/22/builders-and-manipulators.amp.html" /> <title>Builders and Manipulators </title> <meta name='og:image' content='https://www.yegor256.com/images/2018/08/the-night-of.jpg'/><meta name='twitter:image' content='https://www.yegor256.com/images/2018/08/the-night-of.jpg'/><meta name='og:image:width' content='1600'/> <meta name='twitter:image:width' content='1600'/><meta name='og:image:height' content='898'/> <meta name='twitter:image:height' content='898'/><meta name='twitter:card' content='summary_large_image'/><meta name='twitter:image:alt' content='The Night Of (2016) by Richard Price et al.'/> </head> <body><div class="wrapper"> <aside class="header-toggle unprintable" id="header-toggle" title="Show the menu" onclick="$('#header').show();$('#header-toggle').hide();">&#9776;</aside> <header class="header" id="header"><div class="face"> <a href="/about-me.html#form" class="sub" title="Click to subscribe to my monthly newsletter"><span>Subscribe</span></a> <a href="/about-me.html" style="position:relative;"> <img src="/images/face-256x256.jpg" class="photo" alt="Yegor Bugayenko"/> </a></div><nav><ul class="menu social notranslate"> <li><a href="https://twitter.com/intent/follow?screen_name=yegor256" rel="nofollow" title="Follow me on Twitter"><i class="icon icon-twitter notranslate" aria-hidden="true"></i></a></li> <li><a href="/rss.xml" rel="nofollow" title="Subscribe to my RSS feed"><i class="icon icon-rss notranslate" aria-hidden="true"></i></a></li> <li><a itemprop="sameAs" href="https://github.com/yegor256" rel="nofollow" title="My GitHub profile"><i class="icon icon-github notranslate" aria-hidden="true"></i></a></li> <li><a itemprop="sameAs" href="http://stackoverflow.com/users/187141/yegor256" rel="nofollow" title="My StackOverflow profile"><i class="icon icon-stackoverflow notranslate" aria-hidden="true"></i></a></li> <li><a itemprop="sameAs" href="https://www.facebook.com/yegor256" rel="nofollow" title="Follow me on Facebook"><i class="icon icon-facebook notranslate" aria-hidden="true"></i></a></li> <li><a itemprop="sameAs" href="https://instagram.com/yegor256" rel="nofollow" title="Follow me on Instagram"><i class="icon icon-instagram notranslate" aria-hidden="true"></i></a></li> <li><a itemprop="sameAs" href="https://www.linkedin.com/in/yegor256" rel="nofollow" title="My LinkedIn profile"><i class="icon icon-linkedin notranslate" aria-hidden="true"></i></a></li> <li><a itemprop="sameAs" href="https://www.youtube.com/c/yegor256?sub_confirmation=1" rel="nofollow" title="My Youtube video channel"><i class="icon icon-youtube notranslate" aria-hidden="true"></i></a></li> <li><a itemprop="sameAs" href="https://www.pinterest.com/yegor256/" rel="nofollow" title="My Pinterest boards"><i class="icon icon-pinterest notranslate" aria-hidden="true"></i></a></li> <li><a itemprop="sameAs" href="https://angel.co/yegor256" rel="nofollow" title="My AngelList profile"><i class="icon icon-angellist notranslate" aria-hidden="true"></i></a></li> <li><a href="https://soundcloud.com/yegor256" rel="nofollow" title="My podcast"><i class="icon icon-podcast notranslate" aria-hidden="true"></i></a></li> <li><a href="https://itunes.apple.com/us/podcast/yegor256-podcast/id1150826721" rel="nofollow" title="My iTunes podcast"><i class="icon icon-itunes notranslate" aria-hidden="true"></i></a></li> <li><a href="https://t.me/joinchat/AAAAAEJFMRzsRTRxM3ec6A" rel="nofollow" title="My Telegram public channel"><i class="icon icon-telegram notranslate" aria-hidden="true"></i></a></li> <li><a href="mailto:blog@yegor256.com" rel="nofollow" title="Email me any time"><i class="icon icon-mail notranslate" aria-hidden="true"></i></a></li></ul><ul class="menu"> <li><a href="/" title="Home page">Home</a></li> <li ><a href="/best.html" title="Best articles to read">12&#160;Best</a></li> <li ><a href="/contents.html" title="The contents of the entire blog">All&#160;288</a></li> <li ><a href="/webinars.html" title="My webinars">Webinars</a></li> <li ><a href="/talks.html" title="Future and past conference talks">Talks</a></li> <li ><a href="/books.html" title="The books I wrote">Books</a></li> <li ><a href="/papers.html" title="My academic papers and patents">Papers</a></li> <li ><a href="/pets.html" title="My loved pet projects">Pets</a></li> <li ><a href="/award.html" title="Software quality award">Award</a></li> <li ><a href="/testimonials.html" title="What some people say about me">Testimonials</a></li> <li ><a href="/shift-m.html" title="Audio podcast about project management">Shift-M</a></li> <li ><a href="/paintings.html" title="My paintings for sale">Paintings</a></li> <li><a href="http://ru.yegor256.com/" title="Немного на русском языке">По-русски</a></li></ul></nav><div class="search"> <form method="get" action="https://www.google.com/search" itemprop="potentialAction" itemscope="" itemtype="http://schema.org/SearchAction"> <meta itemprop="target" content="https://www.google.com/search?q={q}"/> <input name="sitesearch" value="yegor256.com" type="hidden"/> <input itemprop="query-input" type="text" id="search-query" class="field field-text" required="required" onfocus="$('.google').css('visibility', 'visible');" name="q" placeholder="Search..." autocomplete="off"/> <input type="image" src="/images/google-search-icon.svg" class="google" title="Search via Google" alt="Search via Google"/> </form></div><div class="hot"><ul> <li> <a href="/code-ahead.html">Code Ahead</a> was published on Amazon just a few days ago! It is my new book, a novel about programmers. It explains in details the majority of ideas that stand behind <a href="https://www.zerocracy.com">Zerocracy</a> and <a href="https://www.xdsd.org">XDSD</a>. </li> <li> At <a href="/webinars.html">Webinar #37</a> we will discuss naming problem in OOP, for objects, methods and attributes; join us on <b>September 12</b>, at 11am PST. </li></ul></div></header></div><section itemscope="" itemtype="http://schema.org/BlogPosting"><div class="wrapper"> <header><p class="printable"> <img src="https://api.qrserver.com/v1/create-qr-code/?data=https://www.yegor256.com/2018/08/22/builders-and-manipulators.html&amp;format=svg" style="width:125px;height:125px;" alt="QR code"/></p><p class="printable"> <code itemprop="url">https://www.yegor256.com/2018/08/22/builders-and-manipulators.html</code></p><h1 itemprop="name headline mainEntityOfPage">Builders and Manipulators</h1><aside class='book'><a href='http://amzn.to/2qFt4Tn'><img src='/images/books/elegant-objects/cover.png' class='book-cover' alt='book cover'/></a>Read more about this subject in <a href='http://amzn.to/2qFt4Tn'>Section&nbsp;2.4</a><br/> of my book<a href='http://amzn.to/2qFt4Tn'><img src='/images/books/amazon-buy-button.png' class='amazon-button' alt='Click to buy'/></a></aside><ul class="subline"> <li> <time itemprop="datePublished" datetime="2018-08-22T00:00:00+00:00"> 22 August 2018 </time> </li> <li class="desktop-only" itemprop="locationCreated">Palo Alto, CA</li> <li class="printable" itemscope="" itemprop="author" itemtype="http://schema.org/Person"> <span itemprop="name">Yegor Bugayenko</span> </li> <li class="unprintable"> <i class="icon icon-comments"></i> <a href="http://www.yegor256.com/2018/08/22/builders-and-manipulators.html#disqus_thread" itemprop="discussionUrl">comments</a> </li></ul><p class="unprintable"><p>Here is a simple principle for naming methods in OOP, which I&#39;m trying to follow in my code: it&#39;s a <em>verb</em> if it <em>manipulates</em>, it&#39;s a <em>noun</em> if it <em>builds</em>. That&#39;s it. Nothing in between. Methods like <code>saveFile()</code> or <code>getTitle()</code> don&#39;t fit and must be renamed and refactored. Moreover, methods that &quot;manipulate&quot; must always return <code>void</code>, for example <code>print()</code> or <code>save()</code>. Let me explain.</p><figure class='jb_picture'><img itemprop='image' alt='The Night Of (2016) by Richard Price et al.' src='/images/2018/08/the-night-of.jpg' longdesc='#e86c0384'/><figcaption id='e86c0384'>The Night Of (2016) by Richard Price et al.</figcaption></figure><p>First, I have to say that this idea is very similar to the one suggested by <a href="https://en.wikipedia.org/wiki/Bertrand_Meyer">Bertrand Meyer</a> in his book <a href="https://amzn.to/2MWEuJP">Object Oriented Software Construction</a>, where he proposes we divide an object&#39;s methods into two sharply separated categories: queries and commands.</p><p>The idea behind this principle is rather philosophical. Let&#39;s start with builders, which are supposed to create or find an object and then return it. Suppose I have a store of books and I ask it to give me a book by name:</p><figure class="highlight"><pre><code class="language-java" data-lang="java"><span></span><span class="kd">interface</span> <span class="nc">Bookshelf</span> <span class="o">{</span>
  <span class="n">Book</span> <span class="nf">find</span><span class="o">(</span><span class="n">String</span> <span class="n">title</span><span class="o">);</span>
<span class="o">}</span></code></pre></figure><p>It&#39;s obviously a &quot;builder&quot; (or a &quot;query&quot; in Meyer&#39;s terms). I ask for a book and it&#39;s given to me. The problem, though, is with the name of the method. It&#39;s called &quot;find,&quot; which implies that I know how the book will be dealt with. It will be found.</p><p>However, this is not how we should treat our objects. We must not tell them how to do the job we want them to do. Instead, we must let <em>them</em> decide whether the book will be found, constructed, or maybe taken from a memory cache. When we query, we have to say what result we are looking for and let the object make the decision about the way this result is going to be built. A much more appropriate name for this method would be <code>book()</code>:</p><figure class="highlight"><pre><code class="language-java" data-lang="java"><span></span><span class="kd">interface</span> <span class="nc">Bookshelf</span> <span class="o">{</span>
  <span class="n">Book</span> <span class="nf">book</span><span class="o">(</span><span class="n">String</span> <span class="n">title</span><span class="o">);</span>
<span class="o">}</span></code></pre></figure><p>The rule of thumb is: a builder is always a noun. If the method returns something, it has to be a noun. Preferably its name should explain what the method returns. If it&#39;s a book, name it <code>book()</code>. If it&#39;s a file, call the method <code>file()</code>, etc. Here are a few good builder examples:</p><figure class="highlight"><pre><code class="language-java" data-lang="java"><span></span><span class="kd">interface</span> <span class="nc">Foo</span> <span class="o">{</span>
  <span class="kt">float</span> <span class="nf">speed</span><span class="o">(</span><span class="n">Actor</span> <span class="n">actor</span><span class="o">);</span>
  <span class="n">Money</span> <span class="nf">salary</span><span class="o">(</span><span class="n">User</span> <span class="n">user</span><span class="o">);</span>
  <span class="n">File</span> <span class="nf">database</span><span class="o">();</span>
  <span class="n">Date</span> <span class="nf">deadline</span><span class="o">(</span><span class="n">Project</span> <span class="n">project</span><span class="o">,</span> <span class="n">User</span> <span class="n">user</span><span class="o">);</span>
<span class="o">}</span></code></pre></figure><p>Here, on the contrary, are a few examples of badly named builders:</p><figure class="highlight"><pre><code class="language-java" data-lang="java"><span></span><span class="kd">interface</span> <span class="nc">Foo</span> <span class="o">{</span>
  <span class="kt">float</span> <span class="nf">calculateSpeed</span><span class="o">(</span><span class="n">Actor</span> <span class="n">actor</span><span class="o">);</span>
  <span class="n">Money</span> <span class="nf">getSalary</span><span class="o">(</span><span class="n">User</span> <span class="n">user</span><span class="o">);</span>
  <span class="n">File</span> <span class="nf">openDatabase</span><span class="o">();</span>
  <span class="n">Date</span> <span class="nf">readDeadline</span><span class="o">(</span><span class="n">Project</span> <span class="n">project</span><span class="o">,</span> <span class="n">User</span> <span class="n">user</span><span class="o">);</span>
<span class="o">}</span></code></pre></figure><p>There is no place for a verb in a builder&#39;s name!</p><p>It&#39;s not only about the name, by the way. A builder, since its name doesn&#39;t contain a verb, should not do any modifications to the encapsulated entities. It may only create or find something and return it. Just like a <a href="https://en.wikipedia.org/wiki/Pure_function">pure function</a>, it must not have any side-effects.</p><p>Next, there are &quot;manipulators&quot; (or &quot;commands&quot; in Meyer&#39;s terms). They do some work for us, modifying the entities, which the object encapsulates. They are the opposite to builders, because they actually make changes to the world abstracted by the object. For example, we ask the <code>Bookshelf</code> to add a new book to itself:</p><figure class="highlight"><pre><code class="language-java" data-lang="java"><span></span><span class="kd">interface</span> <span class="nc">Bookshelf</span> <span class="o">{</span>
  <span class="kt">void</span> <span class="nf">add</span><span class="o">(</span><span class="n">Book</span> <span class="n">book</span><span class="o">);</span>
<span class="o">}</span></code></pre></figure><p>The method adds the book to the storage. How exactly the storage will be modified, we don&#39;t know. But we know that since the name of the method is a verb, there will be modifications.</p><p>Also, manipulators must not return anything. It&#39;s always <code>void</code> that we see as the type of their response. This is needed mostly in order to separate the imperative part of the code from the declarative part. We either receive objects or tell them what to do. We must not mix those activities in one method.</p><p>The purpose of these rules is to make the code simpler. If you follow them, and all your builders only return objects and your manipulators only modify the world, the entire design will become easier to understand. Methods will be smaller and their names shorter.</p><p>Of course, very often you will have a hard time finding those names. From time to time you will want to return something from a manipulator or make your builder make some changes, say to the cache. Try to resist this temptation and stay with the principle: a method is either a builder or a manipulator, nothing in the middle. The examples above are rather primitive, the code in real life is much more complicated. But that&#39;s what the principle is going to help us with---making the code simpler.</p><p>I&#39;m also aware of the <a href="http://steve-yegge.blogspot.com/2006/03/execution-in-kingdom-of-nouns.html">noun/verb</a> principle, which suggests always naming classes as nouns and their methods as verbs. I believe it&#39;s a wrong idea, since it doesn&#39;t differentiate builders from manipulators and encourages us to always think in terms of imperative instructions. I believe that OOP must be much more about declarative composition of objects, even if we have to sometimes get them from other objects instead of instantiating them via constructors. That&#39;s why we do need builders in most situations and we also have to see an obvious difference between them and the other methods, manipulators.</p><p>You can find a more detailed discussion of this problem in <a href="http://goo.gl/W2WVMk">Elegant Objects</a>, Volume 1, Section 2.4.</p><blockquote class="twitter-tweet" data-lang="en"><p lang="en" dir="ltr">How would you name a method of a class Document that reads and returns its content? <a href="https://twitter.com/hashtag/elegantobjects?src=hash&amp;ref_src=twsrc%5Etfw">#elegantobjects</a></p>&mdash; Yegor Bugayenko (@yegor256) <a href="https://twitter.com/yegor256/status/1033605343274840064?ref_src=twsrc%5Etfw">August 26, 2018</a></blockquote> <script async src="https://platform.twitter.com/widgets.js" charset="utf-8"></script></p><nav class="buttons notranslate desktop-only"> <a href="http://www.facebook.com/sharer/sharer.php?u=https://www.yegor256.com/2018/08/22/builders-and-manipulators.html" title="Share on Facebook" class="button" rel="nofollow"> <span class="count count-facebook">0</span> <i class="icon icon-facebook notranslate" aria-hidden="true"></i> </a> <a href="https://twitter.com/share?url=https://www.yegor256.com/2018/08/22/builders-and-manipulators.html&amp;text=Builders+and+Manipulators" title="Share on Twitter" class="button" rel="nofollow"> <span class="count count-twitter">0</span> <i class="icon icon-twitter notranslate" aria-hidden="true"></i> </a> <a href="https://plus.google.com/share?url=https://www.yegor256.com/2018/08/22/builders-and-manipulators.html" title="Share on Google+" class="button" rel="nofollow"> <span class="count count-googleplus">0</span> <i class="icon icon-googleplus notranslate" aria-hidden="true"></i> </a> <a href="https://www.linkedin.com/cws/share?url=https://www.yegor256.com/2018/08/22/builders-and-manipulators.html" title="Share on LinkedIn" class="button" rel="nofollow"> <span class="count count-linkedin">0</span> <i class="icon icon-linkedin notranslate" aria-hidden="true"></i> </a> <a href="http://reddit.com/submit?url=https://www.yegor256.com/2018/08/22/builders-and-manipulators.html%3F2018-33&amp;title=Builders+and+Manipulators" title="Share on Reddit" class="button" rel="nofollow"> <span class="count count-reddit">0</span> <i class="icon icon-reddit notranslate" aria-hidden="true"></i> </a> <a href="http://news.ycombinator.com/submitlink?u=https://www.yegor256.com/2018/08/22/builders-and-manipulators.html%3F2018-33&amp;t=Builders+and+Manipulators" title="Share on Hacker News" class="button" rel="nofollow"> <span class="count count-hackernews">0</span> <i class="icon icon-hackernews notranslate" aria-hidden="true"></i> </a> </nav> </header> <article class="main" itemprop="articleBody"><div ><p>Here is a simple principle for naming methods in OOP, which I&#39;m trying to follow in my code: it&#39;s a <em>verb</em> if it <em>manipulates</em>, it&#39;s a <em>noun</em> if it <em>builds</em>. That&#39;s it. Nothing in between. Methods like <code>saveFile()</code> or <code>getTitle()</code> don&#39;t fit and must be renamed and refactored. Moreover, methods that &quot;manipulate&quot; must always return <code>void</code>, for example <code>print()</code> or <code>save()</code>. Let me explain.</p><figure class='jb_picture'><img itemprop='image' alt='The Night Of (2016) by Richard Price et al.' src='/images/2018/08/the-night-of.jpg' longdesc='#e86c0384'/><figcaption id='e86c0384'>The Night Of (2016) by Richard Price et al.</figcaption></figure><p>First, I have to say that this idea is very similar to the one suggested by <a href="https://en.wikipedia.org/wiki/Bertrand_Meyer">Bertrand Meyer</a> in his book <a href="https://amzn.to/2MWEuJP">Object Oriented Software Construction</a>, where he proposes we divide an object&#39;s methods into two sharply separated categories: queries and commands.</p><p>The idea behind this principle is rather philosophical. Let&#39;s start with builders, which are supposed to create or find an object and then return it. Suppose I have a store of books and I ask it to give me a book by name:</p><figure class="highlight"><pre><code class="language-java" data-lang="java"><span></span><span class="kd">interface</span> <span class="nc">Bookshelf</span> <span class="o">{</span>
  <span class="n">Book</span> <span class="nf">find</span><span class="o">(</span><span class="n">String</span> <span class="n">title</span><span class="o">);</span>
<span class="o">}</span></code></pre></figure><p>It&#39;s obviously a &quot;builder&quot; (or a &quot;query&quot; in Meyer&#39;s terms). I ask for a book and it&#39;s given to me. The problem, though, is with the name of the method. It&#39;s called &quot;find,&quot; which implies that I know how the book will be dealt with. It will be found.</p><p>However, this is not how we should treat our objects. We must not tell them how to do the job we want them to do. Instead, we must let <em>them</em> decide whether the book will be found, constructed, or maybe taken from a memory cache. When we query, we have to say what result we are looking for and let the object make the decision about the way this result is going to be built. A much more appropriate name for this method would be <code>book()</code>:</p><figure class="highlight"><pre><code class="language-java" data-lang="java"><span></span><span class="kd">interface</span> <span class="nc">Bookshelf</span> <span class="o">{</span>
  <span class="n">Book</span> <span class="nf">book</span><span class="o">(</span><span class="n">String</span> <span class="n">title</span><span class="o">);</span>
<span class="o">}</span></code></pre></figure><p>The rule of thumb is: a builder is always a noun. If the method returns something, it has to be a noun. Preferably its name should explain what the method returns. If it&#39;s a book, name it <code>book()</code>. If it&#39;s a file, call the method <code>file()</code>, etc. Here are a few good builder examples:</p><figure class="highlight"><pre><code class="language-java" data-lang="java"><span></span><span class="kd">interface</span> <span class="nc">Foo</span> <span class="o">{</span>
  <span class="kt">float</span> <span class="nf">speed</span><span class="o">(</span><span class="n">Actor</span> <span class="n">actor</span><span class="o">);</span>
  <span class="n">Money</span> <span class="nf">salary</span><span class="o">(</span><span class="n">User</span> <span class="n">user</span><span class="o">);</span>
  <span class="n">File</span> <span class="nf">database</span><span class="o">();</span>
  <span class="n">Date</span> <span class="nf">deadline</span><span class="o">(</span><span class="n">Project</span> <span class="n">project</span><span class="o">,</span> <span class="n">User</span> <span class="n">user</span><span class="o">);</span>
<span class="o">}</span></code></pre></figure><p>Here, on the contrary, are a few examples of badly named builders:</p><figure class="highlight"><pre><code class="language-java" data-lang="java"><span></span><span class="kd">interface</span> <span class="nc">Foo</span> <span class="o">{</span>
  <span class="kt">float</span> <span class="nf">calculateSpeed</span><span class="o">(</span><span class="n">Actor</span> <span class="n">actor</span><span class="o">);</span>
  <span class="n">Money</span> <span class="nf">getSalary</span><span class="o">(</span><span class="n">User</span> <span class="n">user</span><span class="o">);</span>
  <span class="n">File</span> <span class="nf">openDatabase</span><span class="o">();</span>
  <span class="n">Date</span> <span class="nf">readDeadline</span><span class="o">(</span><span class="n">Project</span> <span class="n">project</span><span class="o">,</span> <span class="n">User</span> <span class="n">user</span><span class="o">);</span>
<span class="o">}</span></code></pre></figure><p>There is no place for a verb in a builder&#39;s name!</p><p>It&#39;s not only about the name, by the way. A builder, since its name doesn&#39;t contain a verb, should not do any modifications to the encapsulated entities. It may only create or find something and return it. Just like a <a href="https://en.wikipedia.org/wiki/Pure_function">pure function</a>, it must not have any side-effects.</p><p>Next, there are &quot;manipulators&quot; (or &quot;commands&quot; in Meyer&#39;s terms). They do some work for us, modifying the entities, which the object encapsulates. They are the opposite to builders, because they actually make changes to the world abstracted by the object. For example, we ask the <code>Bookshelf</code> to add a new book to itself:</p><figure class="highlight"><pre><code class="language-java" data-lang="java"><span></span><span class="kd">interface</span> <span class="nc">Bookshelf</span> <span class="o">{</span>
  <span class="kt">void</span> <span class="nf">add</span><span class="o">(</span><span class="n">Book</span> <span class="n">book</span><span class="o">);</span>
<span class="o">}</span></code></pre></figure><p>The method adds the book to the storage. How exactly the storage will be modified, we don&#39;t know. But we know that since the name of the method is a verb, there will be modifications.</p><p>Also, manipulators must not return anything. It&#39;s always <code>void</code> that we see as the type of their response. This is needed mostly in order to separate the imperative part of the code from the declarative part. We either receive objects or tell them what to do. We must not mix those activities in one method.</p><p>The purpose of these rules is to make the code simpler. If you follow them, and all your builders only return objects and your manipulators only modify the world, the entire design will become easier to understand. Methods will be smaller and their names shorter.</p><p>Of course, very often you will have a hard time finding those names. From time to time you will want to return something from a manipulator or make your builder make some changes, say to the cache. Try to resist this temptation and stay with the principle: a method is either a builder or a manipulator, nothing in the middle. The examples above are rather primitive, the code in real life is much more complicated. But that&#39;s what the principle is going to help us with---making the code simpler.</p><p>I&#39;m also aware of the <a href="http://steve-yegge.blogspot.com/2006/03/execution-in-kingdom-of-nouns.html">noun/verb</a> principle, which suggests always naming classes as nouns and their methods as verbs. I believe it&#39;s a wrong idea, since it doesn&#39;t differentiate builders from manipulators and encourages us to always think in terms of imperative instructions. I believe that OOP must be much more about declarative composition of objects, even if we have to sometimes get them from other objects instead of instantiating them via constructors. That&#39;s why we do need builders in most situations and we also have to see an obvious difference between them and the other methods, manipulators.</p><p>You can find a more detailed discussion of this problem in <a href="http://goo.gl/W2WVMk">Elegant Objects</a>, Volume 1, Section 2.4.</p><blockquote class="twitter-tweet" data-lang="en"><p lang="en" dir="ltr">How would you name a method of a class Document that reads and returns its content? <a href="https://twitter.com/hashtag/elegantobjects?src=hash&amp;ref_src=twsrc%5Etfw">#elegantobjects</a></p>&mdash; Yegor Bugayenko (@yegor256) <a href="https://twitter.com/yegor256/status/1033605343274840064?ref_src=twsrc%5Etfw">August 26, 2018</a></blockquote> <script async src="https://platform.twitter.com/widgets.js" charset="utf-8"></script></div></article></div><div class="wrapper"> <related-posts /></div><div class="disqus" role="complementary"><p class="disqus_hint"> Please, use <a href="https://help.disqus.com/commenting/what-html-tags-are-allowed-within-comments">syntax highlighting</a> in your comments, to make them more readable.</p><div id="disqus_thread" class="disqus-thread"> <a>&nbsp;</a></div><script> var disqus_config = function () { this.page.url = document.location.href.split('?')[0].split('#')[0].replace('https://', 'http://'); this.page.identifier = this.page.url; }; (function() { var d = document, s = d.createElement('script'); s.src = '//yegor256.disqus.com/embed.js'; s.setAttribute('data-timestamp', +new Date()); (d.head || d.body).appendChild(s); })(); </script> <noscript><div><p class="red"> JavaScript is disabled in your browser, that's why you can't see comments under this post.</p></div></noscript></div><div class="wrapper"> <footer class="footer"><p> &copy; <span itemscope="" itemprop="copyrightHolder" itemtype="http://schema.org/Person"> <span itemprop="name">Yegor Bugayenko</span> </span> 2014&ndash;<span itemprop="copyrightYear">2018</span></p></footer></div></section><div class="wrapper unprintable" style="text-align:center;margin-top:2em;"> <a href="http://www.sixnines.io/h/3ba1652f"> <img src="//www.sixnines.io/b/3ba1652f?style=flat" alt="sixnines availability badge"/> </a></div><script src="//code.jquery.com/jquery-1.9.0.min.js"></script> <script src="/js/all.js?a0e0d018c07"></script> <script>var disqus_shortname = 'yegor256';</script> <script id="dsq-count-scr" src="//yegor256.disqus.com/count.js" async="async"></script> <script> (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){ (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o), m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m) })(window,document,'script','//www.google-analytics.com/analytics.js','ga'); ga('create', 'UA-1963507-32', 'auto'); ga('send', 'pageview'); </script> <script> Cd=document;Cr="&"+Math.random();Cp="&s=1"; Cd.cookie="b=b";if(Cd.cookie)Cp+="&c=1"; Cp+="&t="+(new Date()).getTimezoneOffset(); if(self!=top)Cp+="&f=1"; </script> <script> if(navigator.javaEnabled())Cp+="&j=1"; </script> <script> if(typeof(screen)!='undefined')Cp+="&w="+screen.width+"&h="+ screen.height+"&d="+(screen.colorDepth?screen.colorDepth:screen.pixelDepth); </script> <script> Cd.write("<img src='//c.hit.ua/hit?i=95870&g=0&x=2"+Cp+Cr+ "&r="+escape(Cd.referrer)+"&u="+escape(window.location.href)+ "' border='0' wi"+"dth='1' he"+"ight='1'/>"); </script> <script type="application/ld+json"> { "@context": "http://schema.org", "@type": "Person", "name": "Yegor Bugayenko", "url": "http://www.yegor256.com", "sameAs": [ "https://www.facebook.com/yegor256", "https://instagram.com/yegor256", "https://www.linkedin.com/in/yegor256", "https://twitter.com/yegor256", "https://github.com/yegor256", "https://www.pinterest.com/yegor256/" ] } </script> </body> </html> <!DOCTYPE html> <html xmlns="http://www.w3.org/1999/xhtml" lang="en-US" xml:lang="en-US" itemscope="" itemtype="http://schema.org/WebSite"> <head> <meta charset="utf-8"/> <meta name="description" content="There are many reasons why global variables are evil and must be avoided in an object-oriented context; here is yet another one from me. " /> <meta name="keywords" content="global variables, global variables bad, global variables evil, global variables wrong, oop global variables" /> <meta name="viewport" content="width=device-width,minimum-scale=1,initial-scale=1"/> <meta name="google-site-verification" content="JEj_gQr2CPe2QKGw8XdMz0R7VboQIUbX3FlM-lwTq-8" /> <meta name="author" content="Yegor Bugayenko"> <meta name="article:published_time" content="2018-07-03 00:00:00 +0000"> <meta name="og:site_name" content="Yegor Bugayenko"/> <meta name="og:type" content="article" /> <meta name="og:locale" content="en_US" /> <meta name="twitter:account_id" content="4503599630178231" /> <meta name="twitter:creator" content="@yegor256"/> <meta name="twitter:site" content="@yegor256"/> <meta name="twitter:title" property="og:title" content="What's Wrong With Global Variables?"/> <meta name="twitter:description" property="og:description" content="There are many reasons why global variables are evil and must be avoided in an object-oriented context; here is yet another one from me. "/> <meta name="twitter:url" property="og:url" content="https://www.yegor256.com/2018/07/03/global-variables.html"/> <meta name="telegram:channel" content="AAAAAEJFMRzsRTRxM3ec6A"/> <link rel="search" type="application/opensearchdescription+xml" href="/opensearch.xml" title="yegor256" /> <link rel="shortcut icon" href="/favicon.ico?a0e0d018c07"/> <link rel="apple-touch-icon" href="/favicon.ico?a0e0d018c07"/> <link rel="alternate" type="application/rss+xml" title="RSS for yegor256.com" href="https://www.yegor256.com/rss.xml"/> <link rel="stylesheet" href="/css/layout.css?a0e0d018c07"/> <link rel="stylesheet" href="/css/icons.css?a0e0d018c07"/> <link rel="canonical" href="https://www.yegor256.com/2018/07/03/global-variables.html" /> <link rel="amphtml" href="https://www.yegor256.com/2018/07/03/global-variables.amp.html" /> <title>What's Wrong With Global Variables? </title> <meta name='og:image' content='https://www.yegor256.com/images/2018/07/el-chapo.jpg'/><meta name='twitter:image' content='https://www.yegor256.com/images/2018/07/el-chapo.jpg'/><meta name='og:image:width' content='1240'/> <meta name='twitter:image:width' content='1240'/><meta name='og:image:height' content='698'/> <meta name='twitter:image:height' content='698'/><meta name='twitter:card' content='summary_large_image'/><meta name='twitter:image:alt' content='El Chapo, Season 1 (2017) by Silvana Aguirre et al.'/> </head> <body><div class="wrapper"> <aside class="header-toggle unprintable" id="header-toggle" title="Show the menu" onclick="$('#header').show();$('#header-toggle').hide();">&#9776;</aside> <header class="header" id="header"><div class="face"> <a href="/about-me.html#form" class="sub" title="Click to subscribe to my monthly newsletter"><span>Subscribe</span></a> <a href="/about-me.html" style="position:relative;"> <img src="/images/face-256x256.jpg" class="photo" alt="Yegor Bugayenko"/> </a></div><nav><ul class="menu social notranslate"> <li><a href="https://twitter.com/intent/follow?screen_name=yegor256" rel="nofollow" title="Follow me on Twitter"><i class="icon icon-twitter notranslate" aria-hidden="true"></i></a></li> <li><a href="/rss.xml" rel="nofollow" title="Subscribe to my RSS feed"><i class="icon icon-rss notranslate" aria-hidden="true"></i></a></li> <li><a itemprop="sameAs" href="https://github.com/yegor256" rel="nofollow" title="My GitHub profile"><i class="icon icon-github notranslate" aria-hidden="true"></i></a></li> <li><a itemprop="sameAs" href="http://stackoverflow.com/users/187141/yegor256" rel="nofollow" title="My StackOverflow profile"><i class="icon icon-stackoverflow notranslate" aria-hidden="true"></i></a></li> <li><a itemprop="sameAs" href="https://www.facebook.com/yegor256" rel="nofollow" title="Follow me on Facebook"><i class="icon icon-facebook notranslate" aria-hidden="true"></i></a></li> <li><a itemprop="sameAs" href="https://instagram.com/yegor256" rel="nofollow" title="Follow me on Instagram"><i class="icon icon-instagram notranslate" aria-hidden="true"></i></a></li> <li><a itemprop="sameAs" href="https://www.linkedin.com/in/yegor256" rel="nofollow" title="My LinkedIn profile"><i class="icon icon-linkedin notranslate" aria-hidden="true"></i></a></li> <li><a itemprop="sameAs" href="https://www.youtube.com/c/yegor256?sub_confirmation=1" rel="nofollow" title="My Youtube video channel"><i class="icon icon-youtube notranslate" aria-hidden="true"></i></a></li> <li><a itemprop="sameAs" href="https://www.pinterest.com/yegor256/" rel="nofollow" title="My Pinterest boards"><i class="icon icon-pinterest notranslate" aria-hidden="true"></i></a></li> <li><a itemprop="sameAs" href="https://angel.co/yegor256" rel="nofollow" title="My AngelList profile"><i class="icon icon-angellist notranslate" aria-hidden="true"></i></a></li> <li><a href="https://soundcloud.com/yegor256" rel="nofollow" title="My podcast"><i class="icon icon-podcast notranslate" aria-hidden="true"></i></a></li> <li><a href="https://itunes.apple.com/us/podcast/yegor256-podcast/id1150826721" rel="nofollow" title="My iTunes podcast"><i class="icon icon-itunes notranslate" aria-hidden="true"></i></a></li> <li><a href="https://t.me/joinchat/AAAAAEJFMRzsRTRxM3ec6A" rel="nofollow" title="My Telegram public channel"><i class="icon icon-telegram notranslate" aria-hidden="true"></i></a></li> <li><a href="mailto:blog@yegor256.com" rel="nofollow" title="Email me any time"><i class="icon icon-mail notranslate" aria-hidden="true"></i></a></li></ul><ul class="menu"> <li><a href="/" title="Home page">Home</a></li> <li ><a href="/best.html" title="Best articles to read">12&#160;Best</a></li> <li ><a href="/contents.html" title="The contents of the entire blog">All&#160;288</a></li> <li ><a href="/webinars.html" title="My webinars">Webinars</a></li> <li ><a href="/talks.html" title="Future and past conference talks">Talks</a></li> <li ><a href="/books.html" title="The books I wrote">Books</a></li> <li ><a href="/papers.html" title="My academic papers and patents">Papers</a></li> <li ><a href="/pets.html" title="My loved pet projects">Pets</a></li> <li ><a href="/award.html" title="Software quality award">Award</a></li> <li ><a href="/testimonials.html" title="What some people say about me">Testimonials</a></li> <li ><a href="/shift-m.html" title="Audio podcast about project management">Shift-M</a></li> <li ><a href="/paintings.html" title="My paintings for sale">Paintings</a></li> <li><a href="http://ru.yegor256.com/" title="Немного на русском языке">По-русски</a></li></ul></nav><div class="search"> <form method="get" action="https://www.google.com/search" itemprop="potentialAction" itemscope="" itemtype="http://schema.org/SearchAction"> <meta itemprop="target" content="https://www.google.com/search?q={q}"/> <input name="sitesearch" value="yegor256.com" type="hidden"/> <input itemprop="query-input" type="text" id="search-query" class="field field-text" required="required" onfocus="$('.google').css('visibility', 'visible');" name="q" placeholder="Search..." autocomplete="off"/> <input type="image" src="/images/google-search-icon.svg" class="google" title="Search via Google" alt="Search via Google"/> </form></div><div class="hot"><ul> <li> <a href="/code-ahead.html">Code Ahead</a> was published on Amazon just a few days ago! It is my new book, a novel about programmers. It explains in details the majority of ideas that stand behind <a href="https://www.zerocracy.com">Zerocracy</a> and <a href="https://www.xdsd.org">XDSD</a>. </li> <li> At <a href="/webinars.html">Webinar #37</a> we will discuss naming problem in OOP, for objects, methods and attributes; join us on <b>September 12</b>, at 11am PST. </li></ul></div></header></div><section itemscope="" itemtype="http://schema.org/BlogPosting"><div class="wrapper"> <header><p class="printable"> <img src="https://api.qrserver.com/v1/create-qr-code/?data=https://www.yegor256.com/2018/07/03/global-variables.html&amp;format=svg" style="width:125px;height:125px;" alt="QR code"/></p><p class="printable"> <code itemprop="url">https://www.yegor256.com/2018/07/03/global-variables.html</code></p><h1 itemprop="name headline mainEntityOfPage">What's Wrong With Global Variables?</h1><ul class="subline"> <li> <time itemprop="datePublished" datetime="2018-07-03T00:00:00+00:00"> 3 July 2018 </time> </li> <li class="desktop-only" itemprop="locationCreated">Moscow, Russia</li> <li class="printable" itemscope="" itemprop="author" itemtype="http://schema.org/Person"> <span itemprop="name">Yegor Bugayenko</span> </li> <li class="unprintable"> <i class="icon icon-comments"></i> <a href="http://www.yegor256.com/2018/07/03/global-variables.html#disqus_thread" itemprop="discussionUrl">comments</a> </li></ul><p class="unprintable"><p>Only lazy people haven&#39;t written already about how <a href="https://en.wikipedia.org/wiki/Global_variable">global variables</a> are evil. It started in 1973 when W.&nbsp;Wulf et al. <a href="https://dl.acm.org/citation.cfm?id=953355">claimed</a> that &quot;the non-local variable is a major contributing factor in programs which are difficult to understand.&quot; Since then, <a href="http://wiki.c2.com/?GlobalVariablesAreBad">many other reasons</a> where suggested to convince programmers to stop using global variables. I think <a href="https://softwareengineering.stackexchange.com/questions/148108/why-is-global-state-so-evil">I read them all</a>, but didn&#39;t find the one that bothers me most of all: composability. In a nutshell, global variables make code difficult or impossible to compose in ways which are different from what its original author expected.</p><figure class='jb_picture'><img itemprop='image' alt='El Chapo, Season 1 (2017) by Silvana Aguirre et al.' src='/images/2018/07/el-chapo.jpg' longdesc='#9e10a0df'/><figcaption id='9e10a0df'>El Chapo, Season 1 (2017) by Silvana Aguirre et al.</figcaption></figure><p>I was recently writing a web front for <a href="https://www.zold.io">Zold</a> in Ruby, on top of <a href="http://sinatrarb.com/">Sinatra</a>. This is how a web server starts according to <a href="http://sinatrarb.com/intro.html">their documentation</a>:</p><figure class="highlight"><pre><code class="language-ruby" data-lang="ruby"><span></span><span class="no">App</span><span class="o">.</span><span class="n">start!</span></code></pre></figure><p>Here <code>start!</code> is a static method of the <code>App</code> class, which you have to declare as a child of their default parent <a href="https://github.com/sinatra/sinatra/blob/v2.0.3/lib/sinatra/base.rb#L893-L1896"><code>Sinatra::Base</code></a>. To tell the app which TCP port to listen to you have to preconfigure it:</p><figure class="highlight"><pre><code class="language-ruby" data-lang="ruby"><span></span><span class="nb">require</span> <span class="s1">&#39;sinatra/base&#39;</span>
<span class="k">class</span> <span class="nc">App</span> <span class="o">&lt;</span> <span class="no">Sinatra</span><span class="o">::</span><span class="no">Base</span>
  <span class="n">get</span> <span class="s1">&#39;/&#39;</span> <span class="k">do</span>
    <span class="s1">&#39;Hello, world!&#39;</span>
  <span class="k">end</span>
<span class="k">end</span>
<span class="no">App</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="ss">:port</span><span class="p">,</span> <span class="mi">8080</span><span class="p">)</span>
<span class="no">App</span><span class="o">.</span><span class="n">start!</span></code></pre></figure><p>What do you do if you want to start two web servers? For the purpose of testing this may be a pretty logical requirement. For example, since Zold is a distributed network, it is necessary to test how a number of servers communicate to each other. I can&#39;t do that! There is absolutely no way. Because Sinatra is designed with the assumption that only one server may exist in the entire application scope.</p><aside class='youtube'> <a href='https://www.youtube.com/watch?v=FNWyN_Q10TI'><div class='box'> <img src='https://i.ytimg.com/vi/FNWyN_Q10TI/mqdefault.jpg' alt='YouTube video #FNWyN_Q10TI'/><div class='play'><i class='icon icon-play'></i></div></div></a><div>What's wrong with global variables?; 8 August 2018.</div></aside><p>Can this really be fixed? Let&#39;s take a look at <a href="https://github.com/sinatra/sinatra/">their code</a>. Class <code>Sinatra::Base</code> is essentially a <a href="/2016/06/27/singletons-must-die.html">Singleton</a>, which is not supposed to have more than one instance. When we call <code>App.set(:port, 8080)</code>, the value <code>8080</code> is saved into an attribute of a single instance. The number <code>8080</code> becomes available for all methods of <code>Sinatra::Base</code>, no matter what instance they are called from.</p><p>They are not using <a href="https://ruby-doc.org/docs/ruby-doc-bundle/UsersGuide/rg/globalvars.html">true</a> Ruby global variables, I believe, because they know that they are bad. Why exactly they are bad and what the <a href="/2014/05/05/oop-alternative-to-utility-classes.html">alternatives</a> are---slipped through their fingers.</p><aside class='quote'>While the application is small and its test coverage is low, global variables may not hurt.</aside><p>Technically speaking, their design is &quot;globally scoped.&quot; <code>Sinatra::Base</code> treats the entire application as its scope of visibility. No matter who calls it, everything is visible, including what was created in previous calls and in previously instantiated objects. This &quot;class&quot; is a giant bag of global variables.</p><p>Every global variable is a troublemaker of that kind. While the application is small and its test coverage is low, global variables may not hurt. But the bigger the app and the more sophisticated its automated testing scenarios, the more difficult it will be to compose objects which depend on global variables, singletons, or class variables.</p><p>My recommendation? Under no circumstances even think about any global variables.</p><blockquote class="twitter-tweet" data-lang="en"><p lang="en" dir="ltr">What do you think about global variables? <a href="https://twitter.com/hashtag/elegantobjects?src=hash&amp;ref_src=twsrc%5Etfw">#elegantobjects</a> <a href="https://twitter.com/hashtag/oop?src=hash&amp;ref_src=twsrc%5Etfw">#oop</a></p>--- Yegor Bugayenko (@yegor256) <a href="https://twitter.com/yegor256/status/1018400337324118016?ref_src=twsrc%5Etfw">July 15, 2018</a></blockquote> <script async src="https://platform.twitter.com/widgets.js" charset="utf-8"></script></p><nav class="buttons notranslate desktop-only"> <a href="http://www.facebook.com/sharer/sharer.php?u=https://www.yegor256.com/2018/07/03/global-variables.html" title="Share on Facebook" class="button" rel="nofollow"> <span class="count count-facebook">0</span> <i class="icon icon-facebook notranslate" aria-hidden="true"></i> </a> <a href="https://twitter.com/share?url=https://www.yegor256.com/2018/07/03/global-variables.html&amp;text=What%27s+Wrong+With+Global+Variables%3F" title="Share on Twitter" class="button" rel="nofollow"> <span class="count count-twitter">0</span> <i class="icon icon-twitter notranslate" aria-hidden="true"></i> </a> <a href="https://plus.google.com/share?url=https://www.yegor256.com/2018/07/03/global-variables.html" title="Share on Google+" class="button" rel="nofollow"> <span class="count count-googleplus">0</span> <i class="icon icon-googleplus notranslate" aria-hidden="true"></i> </a> <a href="https://www.linkedin.com/cws/share?url=https://www.yegor256.com/2018/07/03/global-variables.html" title="Share on LinkedIn" class="button" rel="nofollow"> <span class="count count-linkedin">0</span> <i class="icon icon-linkedin notranslate" aria-hidden="true"></i> </a> <a href="http://reddit.com/submit?url=https://www.yegor256.com/2018/07/03/global-variables.html%3F2018-26&amp;title=What%27s+Wrong+With+Global+Variables%3F" title="Share on Reddit" class="button" rel="nofollow"> <span class="count count-reddit">0</span> <i class="icon icon-reddit notranslate" aria-hidden="true"></i> </a> <a href="http://news.ycombinator.com/submitlink?u=https://www.yegor256.com/2018/07/03/global-variables.html%3F2018-26&amp;t=What%27s+Wrong+With+Global+Variables%3F" title="Share on Hacker News" class="button" rel="nofollow"> <span class="count count-hackernews">0</span> <i class="icon icon-hackernews notranslate" aria-hidden="true"></i> </a> </nav> </header> <article class="main" itemprop="articleBody"><div ><p>Only lazy people haven&#39;t written already about how <a href="https://en.wikipedia.org/wiki/Global_variable">global variables</a> are evil. It started in 1973 when W.&nbsp;Wulf et al. <a href="https://dl.acm.org/citation.cfm?id=953355">claimed</a> that &quot;the non-local variable is a major contributing factor in programs which are difficult to understand.&quot; Since then, <a href="http://wiki.c2.com/?GlobalVariablesAreBad">many other reasons</a> where suggested to convince programmers to stop using global variables. I think <a href="https://softwareengineering.stackexchange.com/questions/148108/why-is-global-state-so-evil">I read them all</a>, but didn&#39;t find the one that bothers me most of all: composability. In a nutshell, global variables make code difficult or impossible to compose in ways which are different from what its original author expected.</p><figure class='jb_picture'><img itemprop='image' alt='El Chapo, Season 1 (2017) by Silvana Aguirre et al.' src='/images/2018/07/el-chapo.jpg' longdesc='#9e10a0df'/><figcaption id='9e10a0df'>El Chapo, Season 1 (2017) by Silvana Aguirre et al.</figcaption></figure><p>I was recently writing a web front for <a href="https://www.zold.io">Zold</a> in Ruby, on top of <a href="http://sinatrarb.com/">Sinatra</a>. This is how a web server starts according to <a href="http://sinatrarb.com/intro.html">their documentation</a>:</p><figure class="highlight"><pre><code class="language-ruby" data-lang="ruby"><span></span><span class="no">App</span><span class="o">.</span><span class="n">start!</span></code></pre></figure><p>Here <code>start!</code> is a static method of the <code>App</code> class, which you have to declare as a child of their default parent <a href="https://github.com/sinatra/sinatra/blob/v2.0.3/lib/sinatra/base.rb#L893-L1896"><code>Sinatra::Base</code></a>. To tell the app which TCP port to listen to you have to preconfigure it:</p><figure class="highlight"><pre><code class="language-ruby" data-lang="ruby"><span></span><span class="nb">require</span> <span class="s1">&#39;sinatra/base&#39;</span>
<span class="k">class</span> <span class="nc">App</span> <span class="o">&lt;</span> <span class="no">Sinatra</span><span class="o">::</span><span class="no">Base</span>
  <span class="n">get</span> <span class="s1">&#39;/&#39;</span> <span class="k">do</span>
    <span class="s1">&#39;Hello, world!&#39;</span>
  <span class="k">end</span>
<span class="k">end</span>
<span class="no">App</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="ss">:port</span><span class="p">,</span> <span class="mi">8080</span><span class="p">)</span>
<span class="no">App</span><span class="o">.</span><span class="n">start!</span></code></pre></figure><p>What do you do if you want to start two web servers? For the purpose of testing this may be a pretty logical requirement. For example, since Zold is a distributed network, it is necessary to test how a number of servers communicate to each other. I can&#39;t do that! There is absolutely no way. Because Sinatra is designed with the assumption that only one server may exist in the entire application scope.</p><aside class='youtube'> <a href='https://www.youtube.com/watch?v=FNWyN_Q10TI'><div class='box'> <img src='https://i.ytimg.com/vi/FNWyN_Q10TI/mqdefault.jpg' alt='YouTube video #FNWyN_Q10TI'/><div class='play'><i class='icon icon-play'></i></div></div></a><div>What's wrong with global variables?; 8 August 2018.</div></aside><p>Can this really be fixed? Let&#39;s take a look at <a href="https://github.com/sinatra/sinatra/">their code</a>. Class <code>Sinatra::Base</code> is essentially a <a href="/2016/06/27/singletons-must-die.html">Singleton</a>, which is not supposed to have more than one instance. When we call <code>App.set(:port, 8080)</code>, the value <code>8080</code> is saved into an attribute of a single instance. The number <code>8080</code> becomes available for all methods of <code>Sinatra::Base</code>, no matter what instance they are called from.</p><p>They are not using <a href="https://ruby-doc.org/docs/ruby-doc-bundle/UsersGuide/rg/globalvars.html">true</a> Ruby global variables, I believe, because they know that they are bad. Why exactly they are bad and what the <a href="/2014/05/05/oop-alternative-to-utility-classes.html">alternatives</a> are---slipped through their fingers.</p><aside class='quote'>While the application is small and its test coverage is low, global variables may not hurt.</aside><p>Technically speaking, their design is &quot;globally scoped.&quot; <code>Sinatra::Base</code> treats the entire application as its scope of visibility. No matter who calls it, everything is visible, including what was created in previous calls and in previously instantiated objects. This &quot;class&quot; is a giant bag of global variables.</p><p>Every global variable is a troublemaker of that kind. While the application is small and its test coverage is low, global variables may not hurt. But the bigger the app and the more sophisticated its automated testing scenarios, the more difficult it will be to compose objects which depend on global variables, singletons, or class variables.</p><p>My recommendation? Under no circumstances even think about any global variables.</p><blockquote class="twitter-tweet" data-lang="en"><p lang="en" dir="ltr">What do you think about global variables? <a href="https://twitter.com/hashtag/elegantobjects?src=hash&amp;ref_src=twsrc%5Etfw">#elegantobjects</a> <a href="https://twitter.com/hashtag/oop?src=hash&amp;ref_src=twsrc%5Etfw">#oop</a></p>--- Yegor Bugayenko (@yegor256) <a href="https://twitter.com/yegor256/status/1018400337324118016?ref_src=twsrc%5Etfw">July 15, 2018</a></blockquote> <script async src="https://platform.twitter.com/widgets.js" charset="utf-8"></script></div></article></div><div class="wrapper"> <related-posts /></div><div class="disqus" role="complementary"><p class="disqus_hint"> Please, use <a href="https://help.disqus.com/commenting/what-html-tags-are-allowed-within-comments">syntax highlighting</a> in your comments, to make them more readable.</p><div id="disqus_thread" class="disqus-thread"> <a>&nbsp;</a></div><script> var disqus_config = function () { this.page.url = document.location.href.split('?')[0].split('#')[0].replace('https://', 'http://'); this.page.identifier = this.page.url; }; (function() { var d = document, s = d.createElement('script'); s.src = '//yegor256.disqus.com/embed.js'; s.setAttribute('data-timestamp', +new Date()); (d.head || d.body).appendChild(s); })(); </script> <noscript><div><p class="red"> JavaScript is disabled in your browser, that's why you can't see comments under this post.</p></div></noscript></div><div class="wrapper"> <footer class="footer"><p> &copy; <span itemscope="" itemprop="copyrightHolder" itemtype="http://schema.org/Person"> <span itemprop="name">Yegor Bugayenko</span> </span> 2014&ndash;<span itemprop="copyrightYear">2018</span></p></footer></div></section><div class="wrapper unprintable" style="text-align:center;margin-top:2em;"> <a href="http://www.sixnines.io/h/3ba1652f"> <img src="//www.sixnines.io/b/3ba1652f?style=flat" alt="sixnines availability badge"/> </a></div><script src="//code.jquery.com/jquery-1.9.0.min.js"></script> <script src="/js/all.js?a0e0d018c07"></script> <script>var disqus_shortname = 'yegor256';</script> <script id="dsq-count-scr" src="//yegor256.disqus.com/count.js" async="async"></script> <script> (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){ (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o), m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m) })(window,document,'script','//www.google-analytics.com/analytics.js','ga'); ga('create', 'UA-1963507-32', 'auto'); ga('send', 'pageview'); </script> <script> Cd=document;Cr="&"+Math.random();Cp="&s=1"; Cd.cookie="b=b";if(Cd.cookie)Cp+="&c=1"; Cp+="&t="+(new Date()).getTimezoneOffset(); if(self!=top)Cp+="&f=1"; </script> <script> if(navigator.javaEnabled())Cp+="&j=1"; </script> <script> if(typeof(screen)!='undefined')Cp+="&w="+screen.width+"&h="+ screen.height+"&d="+(screen.colorDepth?screen.colorDepth:screen.pixelDepth); </script> <script> Cd.write("<img src='//c.hit.ua/hit?i=95870&g=0&x=2"+Cp+Cr+ "&r="+escape(Cd.referrer)+"&u="+escape(window.location.href)+ "' border='0' wi"+"dth='1' he"+"ight='1'/>"); </script> <script type="application/ld+json"> { "@context": "http://schema.org", "@type": "Person", "name": "Yegor Bugayenko", "url": "http://www.yegor256.com", "sameAs": [ "https://www.facebook.com/yegor256", "https://instagram.com/yegor256", "https://www.linkedin.com/in/yegor256", "https://twitter.com/yegor256", "https://github.com/yegor256", "https://www.pinterest.com/yegor256/" ] } </script> </body> </html> <!DOCTYPE html> <html xmlns="http://www.w3.org/1999/xhtml" lang="en-US" xml:lang="en-US" itemscope="" itemtype="http://schema.org/WebSite"> <head> <meta charset="utf-8"/> <meta name="description" content="There must be no code in object constructors, but what about validation of incoming parameters? They may be validated, on certain terms. " /> <meta name="keywords" content="oop constructor, oop validation, validation in constructor, validation in oop, when validate objects" /> <meta name="viewport" content="width=device-width,minimum-scale=1,initial-scale=1"/> <meta name="google-site-verification" content="JEj_gQr2CPe2QKGw8XdMz0R7VboQIUbX3FlM-lwTq-8" /> <meta name="author" content="Yegor Bugayenko"> <meta name="article:published_time" content="2018-05-29 00:00:00 +0000"> <meta name="og:site_name" content="Yegor Bugayenko"/> <meta name="og:type" content="article" /> <meta name="og:locale" content="en_US" /> <meta name="twitter:account_id" content="4503599630178231" /> <meta name="twitter:creator" content="@yegor256"/> <meta name="twitter:site" content="@yegor256"/> <meta name="twitter:title" property="og:title" content="Object Validation: to Defer or Not?"/> <meta name="twitter:description" property="og:description" content="There must be no code in object constructors, but what about validation of incoming parameters? They may be validated, on certain terms. "/> <meta name="twitter:url" property="og:url" content="https://www.yegor256.com/2018/05/29/object-validation.html"/> <meta name="telegram:channel" content="AAAAAEJFMRzsRTRxM3ec6A"/> <link rel="search" type="application/opensearchdescription+xml" href="/opensearch.xml" title="yegor256" /> <link rel="shortcut icon" href="/favicon.ico?a0e0d018c07"/> <link rel="apple-touch-icon" href="/favicon.ico?a0e0d018c07"/> <link rel="alternate" type="application/rss+xml" title="RSS for yegor256.com" href="https://www.yegor256.com/rss.xml"/> <link rel="stylesheet" href="/css/layout.css?a0e0d018c07"/> <link rel="stylesheet" href="/css/icons.css?a0e0d018c07"/> <link rel="canonical" href="https://www.yegor256.com/2018/05/29/object-validation.html" /> <link rel="amphtml" href="https://www.yegor256.com/2018/05/29/object-validation.amp.html" /> <title>Object Validation: to Defer or Not? </title> <meta name='og:image' content='https://www.yegor256.com/images/2018/05/punching-the-clown.jpg'/><meta name='twitter:image' content='https://www.yegor256.com/images/2018/05/punching-the-clown.jpg'/><meta name='og:image:width' content='1274'/> <meta name='twitter:image:width' content='1274'/><meta name='og:image:height' content='720'/> <meta name='twitter:image:height' content='720'/><meta name='twitter:card' content='summary_large_image'/><meta name='twitter:image:alt' content='Punching the Clown (2009) by Gregori Viens'/> </head> <body><div class="wrapper"> <aside class="header-toggle unprintable" id="header-toggle" title="Show the menu" onclick="$('#header').show();$('#header-toggle').hide();">&#9776;</aside> <header class="header" id="header"><div class="face"> <a href="/about-me.html#form" class="sub" title="Click to subscribe to my monthly newsletter"><span>Subscribe</span></a> <a href="/about-me.html" style="position:relative;"> <img src="/images/face-256x256.jpg" class="photo" alt="Yegor Bugayenko"/> </a></div><nav><ul class="menu social notranslate"> <li><a href="https://twitter.com/intent/follow?screen_name=yegor256" rel="nofollow" title="Follow me on Twitter"><i class="icon icon-twitter notranslate" aria-hidden="true"></i></a></li> <li><a href="/rss.xml" rel="nofollow" title="Subscribe to my RSS feed"><i class="icon icon-rss notranslate" aria-hidden="true"></i></a></li> <li><a itemprop="sameAs" href="https://github.com/yegor256" rel="nofollow" title="My GitHub profile"><i class="icon icon-github notranslate" aria-hidden="true"></i></a></li> <li><a itemprop="sameAs" href="http://stackoverflow.com/users/187141/yegor256" rel="nofollow" title="My StackOverflow profile"><i class="icon icon-stackoverflow notranslate" aria-hidden="true"></i></a></li> <li><a itemprop="sameAs" href="https://www.facebook.com/yegor256" rel="nofollow" title="Follow me on Facebook"><i class="icon icon-facebook notranslate" aria-hidden="true"></i></a></li> <li><a itemprop="sameAs" href="https://instagram.com/yegor256" rel="nofollow" title="Follow me on Instagram"><i class="icon icon-instagram notranslate" aria-hidden="true"></i></a></li> <li><a itemprop="sameAs" href="https://www.linkedin.com/in/yegor256" rel="nofollow" title="My LinkedIn profile"><i class="icon icon-linkedin notranslate" aria-hidden="true"></i></a></li> <li><a itemprop="sameAs" href="https://www.youtube.com/c/yegor256?sub_confirmation=1" rel="nofollow" title="My Youtube video channel"><i class="icon icon-youtube notranslate" aria-hidden="true"></i></a></li> <li><a itemprop="sameAs" href="https://www.pinterest.com/yegor256/" rel="nofollow" title="My Pinterest boards"><i class="icon icon-pinterest notranslate" aria-hidden="true"></i></a></li> <li><a itemprop="sameAs" href="https://angel.co/yegor256" rel="nofollow" title="My AngelList profile"><i class="icon icon-angellist notranslate" aria-hidden="true"></i></a></li> <li><a href="https://soundcloud.com/yegor256" rel="nofollow" title="My podcast"><i class="icon icon-podcast notranslate" aria-hidden="true"></i></a></li> <li><a href="https://itunes.apple.com/us/podcast/yegor256-podcast/id1150826721" rel="nofollow" title="My iTunes podcast"><i class="icon icon-itunes notranslate" aria-hidden="true"></i></a></li> <li><a href="https://t.me/joinchat/AAAAAEJFMRzsRTRxM3ec6A" rel="nofollow" title="My Telegram public channel"><i class="icon icon-telegram notranslate" aria-hidden="true"></i></a></li> <li><a href="mailto:blog@yegor256.com" rel="nofollow" title="Email me any time"><i class="icon icon-mail notranslate" aria-hidden="true"></i></a></li></ul><ul class="menu"> <li><a href="/" title="Home page">Home</a></li> <li ><a href="/best.html" title="Best articles to read">12&#160;Best</a></li> <li ><a href="/contents.html" title="The contents of the entire blog">All&#160;288</a></li> <li ><a href="/webinars.html" title="My webinars">Webinars</a></li> <li ><a href="/talks.html" title="Future and past conference talks">Talks</a></li> <li ><a href="/books.html" title="The books I wrote">Books</a></li> <li ><a href="/papers.html" title="My academic papers and patents">Papers</a></li> <li ><a href="/pets.html" title="My loved pet projects">Pets</a></li> <li ><a href="/award.html" title="Software quality award">Award</a></li> <li ><a href="/testimonials.html" title="What some people say about me">Testimonials</a></li> <li ><a href="/shift-m.html" title="Audio podcast about project management">Shift-M</a></li> <li ><a href="/paintings.html" title="My paintings for sale">Paintings</a></li> <li><a href="http://ru.yegor256.com/" title="Немного на русском языке">По-русски</a></li></ul></nav><div class="search"> <form method="get" action="https://www.google.com/search" itemprop="potentialAction" itemscope="" itemtype="http://schema.org/SearchAction"> <meta itemprop="target" content="https://www.google.com/search?q={q}"/> <input name="sitesearch" value="yegor256.com" type="hidden"/> <input itemprop="query-input" type="text" id="search-query" class="field field-text" required="required" onfocus="$('.google').css('visibility', 'visible');" name="q" placeholder="Search..." autocomplete="off"/> <input type="image" src="/images/google-search-icon.svg" class="google" title="Search via Google" alt="Search via Google"/> </form></div><div class="hot"><ul> <li> <a href="/code-ahead.html">Code Ahead</a> was published on Amazon just a few days ago! It is my new book, a novel about programmers. It explains in details the majority of ideas that stand behind <a href="https://www.zerocracy.com">Zerocracy</a> and <a href="https://www.xdsd.org">XDSD</a>. </li> <li> At <a href="/webinars.html">Webinar #37</a> we will discuss naming problem in OOP, for objects, methods and attributes; join us on <b>September 12</b>, at 11am PST. </li></ul></div></header></div><section itemscope="" itemtype="http://schema.org/BlogPosting"><div class="wrapper"> <header><p class="printable"> <img src="https://api.qrserver.com/v1/create-qr-code/?data=https://www.yegor256.com/2018/05/29/object-validation.html&amp;format=svg" style="width:125px;height:125px;" alt="QR code"/></p><p class="printable"> <code itemprop="url">https://www.yegor256.com/2018/05/29/object-validation.html</code></p><h1 itemprop="name headline mainEntityOfPage">Object Validation: to Defer or Not?</h1><ul class="subline"> <li> <time itemprop="datePublished" datetime="2018-05-29T00:00:00+00:00"> 29 May 2018 </time> </li> <li class="desktop-only" itemprop="locationCreated">Moscow, Russia</li> <li class="printable" itemscope="" itemprop="author" itemtype="http://schema.org/Person"> <span itemprop="name">Yegor Bugayenko</span> </li> <li class="unprintable"> <i class="icon icon-comments"></i> <a href="http://www.yegor256.com/2018/05/29/object-validation.html#disqus_thread" itemprop="discussionUrl">comments</a> </li></ul><p class="unprintable"><p>I <a href="/2015/05/07/ctors-must-be-code-free.html">said earlier</a> that constructors must be code-free and do nothing aside from attribute initialization. Since then, the most frequently asked <a href="https://www.yegor256.com/2015/05/07/ctors-must-be-code-free.html#comment-3903379622">question</a> is: What about validation of arguments? If they are &quot;broken,&quot; what is the point of creating an object in an &quot;invalid&quot; state? Such an object will fail later, at an unexpected moment. Isn&#39;t it better to throw an exception at the very moment of instantiation? To fail fast, so to speak? Here is what I think.</p><figure class='jb_picture'><img itemprop='image' alt='Punching the Clown (2009) by Gregori Viens' src='/images/2018/05/punching-the-clown.jpg' longdesc='#ec207931'/><figcaption id='ec207931'>Punching the Clown (2009) by Gregori Viens</figcaption></figure><p>Let&#39;s start with this Ruby code:</p><figure class="highlight"><pre><code class="language-java" data-lang="java"><span></span><span class="kd">class</span> <span class="nc">Users</span> <span class="o">{</span>
  <span class="n">def</span> <span class="nf">initialize</span><span class="o">(</span><span class="n">file</span><span class="o">)</span>
    <span class="nd">@file</span> <span class="o">=</span> <span class="n">file</span>
  <span class="n">end</span>
  <span class="n">def</span> <span class="n">names</span>
    <span class="n">File</span><span class="o">.</span><span class="na">readlines</span><span class="o">(</span><span class="nd">@file</span><span class="o">).</span><span class="na">reject</span><span class="o">(&amp;:</span><span class="n">empty</span><span class="o">?)</span>
  <span class="n">end</span>
<span class="o">}</span></code></pre></figure><p>We can use it to read a list of users from a file:</p><figure class="highlight"><pre><code class="language-java" data-lang="java"><span></span><span class="n">Users</span><span class="o">.</span><span class="na">new</span><span class="o">(</span><span class="err">&#39;</span><span class="n">all</span><span class="o">-</span><span class="n">users</span><span class="o">.</span><span class="na">txt</span><span class="err">&#39;</span><span class="o">).</span><span class="na">names</span></code></pre></figure><p>There are a number of ways to abuse this class:</p><ul> <li><p>Pass <code>nil</code> to the ctor instead of a file name;</p></li> <li><p>Pass something else, which is not <code>String</code>;</p></li> <li><p>Pass a file that doesn&#39;t exist;</p></li> <li><p>Pass a directory instead of a file.</p></li></ul><p>Do you see the difference between these four mistakes we can make? Let&#39;s see how our class can protect itself from each of them:</p><figure class="highlight"><pre><code class="language-java" data-lang="java"><span></span><span class="kd">class</span> <span class="nc">Users</span> <span class="o">{</span>
  <span class="n">def</span> <span class="nf">initialize</span><span class="o">(</span><span class="n">file</span><span class="o">)</span>
    <span class="n">raise</span> <span class="s">&quot;File name can&#39;t be nil&quot;</span> <span class="k">if</span> <span class="n">file</span><span class="o">.</span><span class="na">nil</span><span class="o">?</span>
    <span class="n">raise</span> <span class="err">&#39;</span><span class="n">Name</span> <span class="n">must</span> <span class="n">be</span> <span class="n">a</span> <span class="n">String</span><span class="err">&#39;</span> <span class="n">unless</span> <span class="n">file</span><span class="o">.</span><span class="na">is_a</span><span class="o">?(</span><span class="n">String</span><span class="o">)</span>
    <span class="nd">@file</span> <span class="o">=</span> <span class="n">file</span>
  <span class="n">end</span>
  <span class="n">def</span> <span class="n">names</span>
    <span class="n">raise</span> <span class="s">&quot;#{@file} is absent&quot;</span> <span class="n">unless</span> <span class="n">File</span><span class="o">.</span><span class="na">exist</span><span class="o">?(</span><span class="nd">@file</span><span class="o">)</span>
    <span class="n">raise</span> <span class="s">&quot;#{@file} is not a file&quot;</span> <span class="n">unless</span> <span class="n">File</span><span class="o">.</span><span class="na">file</span><span class="o">?(</span><span class="nd">@file</span><span class="o">)</span>
    <span class="n">File</span><span class="o">.</span><span class="na">readlines</span><span class="o">(</span><span class="nd">@file</span><span class="o">).</span><span class="na">reject</span><span class="o">(&amp;:</span><span class="n">empty</span><span class="o">?)</span>
  <span class="n">end</span>
<span class="o">}</span></code></pre></figure><p>The first two potential mistakes were filtered out in the constructor, while the other two---later, in the method. Why did I do it this way? Why not put all of them into the constructor?</p><p>Because the first two compromise <a href="/2014/12/09/immutable-object-state-and-behavior.html">object state</a>, while with the other two---its runtime behavior. You remember that an <a href="/2016/07/14/who-is-object.html">object</a> is a representative of a set of other objects it encapsulates, called attributes. The object of class <code>Users</code> can&#39;t <em>represent</em> <code>nil</code> or a number. It can only represent a file with a name of type <code>String</code>. On the other hand, what that file contains and whether it really is a file---doesn&#39;t make the state invalid. It only causes trouble for the behavior.</p><p>Even though the difference may look subtle, it&#39;s obvious. There are two phases of interaction with the encapsulated object: <em>connecting</em> and <em>talking</em>.</p><aside class='youtube'> <a href='https://www.youtube.com/watch?v=-drZbHxydMc'><div class='box'> <img src='https://i.ytimg.com/vi/-drZbHxydMc/mqdefault.jpg' alt='YouTube video #-drZbHxydMc'/><div class='play'><i class='icon icon-play'></i></div></div></a><div>When do you validate your objects?; 4 July 2018.</div></aside><p>First, we encapsulate the <code>file</code> and want to be sure that it really is a file. We are not yet talking to it, we don&#39;t want it to work for us yet, we just want to make sure it really <em>is</em> an object that we will be able to talk to in the near future. If it&#39;s <code>nil</code> or a <code>float</code>, we will have problems in the future, for sure. That&#39;s why we raise an exception from the constructor.</p><p>Then the second phase is talking, where we delegate control to the object and expect it to behave correctly. At this phase we may have other validation procedures, in order to make sure our interaction will go smoothly. It&#39;s important to mention that these validations are very situational. We may call <code>names()</code> multiple times and every time have a different situation with the file on disc. To begin with it may not exist, while in a few seconds it will be ready and available for reading.</p><p>Ideally, a programming language should provide instruments for the first type of validations, for example with <a href="https://en.wikipedia.org/wiki/Strong_and_weak_typing">strict typing</a>. In Java, for example, we would not need to check the type of <code>file</code>, the compiler would catch that error earlier. In Kotlin we would be able to get rid of the NULL check, thanks to their <a href="https://kotlinlang.org/docs/reference/null-safety.html">Null Safety</a> feature. Ruby is less powerful than those languages, that&#39;s why we have to validate &quot;manually.&quot;</p><p>Thus, to summarize, validating in constructors is <em>not</em> a bad idea, provided the validations are <em>not touching the objects</em> but only confirm that they are good enough to work with later.</p></p><nav class="buttons notranslate desktop-only"> <a href="http://www.facebook.com/sharer/sharer.php?u=https://www.yegor256.com/2018/05/29/object-validation.html" title="Share on Facebook" class="button" rel="nofollow"> <span class="count count-facebook">0</span> <i class="icon icon-facebook notranslate" aria-hidden="true"></i> </a> <a href="https://twitter.com/share?url=https://www.yegor256.com/2018/05/29/object-validation.html&amp;text=Object+Validation%3A+to+Defer+or+Not%3F" title="Share on Twitter" class="button" rel="nofollow"> <span class="count count-twitter">0</span> <i class="icon icon-twitter notranslate" aria-hidden="true"></i> </a> <a href="https://plus.google.com/share?url=https://www.yegor256.com/2018/05/29/object-validation.html" title="Share on Google+" class="button" rel="nofollow"> <span class="count count-googleplus">0</span> <i class="icon icon-googleplus notranslate" aria-hidden="true"></i> </a> <a href="https://www.linkedin.com/cws/share?url=https://www.yegor256.com/2018/05/29/object-validation.html" title="Share on LinkedIn" class="button" rel="nofollow"> <span class="count count-linkedin">0</span> <i class="icon icon-linkedin notranslate" aria-hidden="true"></i> </a> <a href="http://reddit.com/submit?url=https://www.yegor256.com/2018/05/29/object-validation.html%3F2018-21&amp;title=Object+Validation%3A+to+Defer+or+Not%3F" title="Share on Reddit" class="button" rel="nofollow"> <span class="count count-reddit">0</span> <i class="icon icon-reddit notranslate" aria-hidden="true"></i> </a> <a href="http://news.ycombinator.com/submitlink?u=https://www.yegor256.com/2018/05/29/object-validation.html%3F2018-21&amp;t=Object+Validation%3A+to+Defer+or+Not%3F" title="Share on Hacker News" class="button" rel="nofollow"> <span class="count count-hackernews">0</span> <i class="icon icon-hackernews notranslate" aria-hidden="true"></i> </a> </nav> </header> <article class="main" itemprop="articleBody"><div ><p>I <a href="/2015/05/07/ctors-must-be-code-free.html">said earlier</a> that constructors must be code-free and do nothing aside from attribute initialization. Since then, the most frequently asked <a href="https://www.yegor256.com/2015/05/07/ctors-must-be-code-free.html#comment-3903379622">question</a> is: What about validation of arguments? If they are &quot;broken,&quot; what is the point of creating an object in an &quot;invalid&quot; state? Such an object will fail later, at an unexpected moment. Isn&#39;t it better to throw an exception at the very moment of instantiation? To fail fast, so to speak? Here is what I think.</p><figure class='jb_picture'><img itemprop='image' alt='Punching the Clown (2009) by Gregori Viens' src='/images/2018/05/punching-the-clown.jpg' longdesc='#ec207931'/><figcaption id='ec207931'>Punching the Clown (2009) by Gregori Viens</figcaption></figure><p>Let&#39;s start with this Ruby code:</p><figure class="highlight"><pre><code class="language-java" data-lang="java"><span></span><span class="kd">class</span> <span class="nc">Users</span> <span class="o">{</span>
  <span class="n">def</span> <span class="nf">initialize</span><span class="o">(</span><span class="n">file</span><span class="o">)</span>
    <span class="nd">@file</span> <span class="o">=</span> <span class="n">file</span>
  <span class="n">end</span>
  <span class="n">def</span> <span class="n">names</span>
    <span class="n">File</span><span class="o">.</span><span class="na">readlines</span><span class="o">(</span><span class="nd">@file</span><span class="o">).</span><span class="na">reject</span><span class="o">(&amp;:</span><span class="n">empty</span><span class="o">?)</span>
  <span class="n">end</span>
<span class="o">}</span></code></pre></figure><p>We can use it to read a list of users from a file:</p><figure class="highlight"><pre><code class="language-java" data-lang="java"><span></span><span class="n">Users</span><span class="o">.</span><span class="na">new</span><span class="o">(</span><span class="err">&#39;</span><span class="n">all</span><span class="o">-</span><span class="n">users</span><span class="o">.</span><span class="na">txt</span><span class="err">&#39;</span><span class="o">).</span><span class="na">names</span></code></pre></figure><p>There are a number of ways to abuse this class:</p><ul> <li><p>Pass <code>nil</code> to the ctor instead of a file name;</p></li> <li><p>Pass something else, which is not <code>String</code>;</p></li> <li><p>Pass a file that doesn&#39;t exist;</p></li> <li><p>Pass a directory instead of a file.</p></li></ul><p>Do you see the difference between these four mistakes we can make? Let&#39;s see how our class can protect itself from each of them:</p><figure class="highlight"><pre><code class="language-java" data-lang="java"><span></span><span class="kd">class</span> <span class="nc">Users</span> <span class="o">{</span>
  <span class="n">def</span> <span class="nf">initialize</span><span class="o">(</span><span class="n">file</span><span class="o">)</span>
    <span class="n">raise</span> <span class="s">&quot;File name can&#39;t be nil&quot;</span> <span class="k">if</span> <span class="n">file</span><span class="o">.</span><span class="na">nil</span><span class="o">?</span>
    <span class="n">raise</span> <span class="err">&#39;</span><span class="n">Name</span> <span class="n">must</span> <span class="n">be</span> <span class="n">a</span> <span class="n">String</span><span class="err">&#39;</span> <span class="n">unless</span> <span class="n">file</span><span class="o">.</span><span class="na">is_a</span><span class="o">?(</span><span class="n">String</span><span class="o">)</span>
    <span class="nd">@file</span> <span class="o">=</span> <span class="n">file</span>
  <span class="n">end</span>
  <span class="n">def</span> <span class="n">names</span>
    <span class="n">raise</span> <span class="s">&quot;#{@file} is absent&quot;</span> <span class="n">unless</span> <span class="n">File</span><span class="o">.</span><span class="na">exist</span><span class="o">?(</span><span class="nd">@file</span><span class="o">)</span>
    <span class="n">raise</span> <span class="s">&quot;#{@file} is not a file&quot;</span> <span class="n">unless</span> <span class="n">File</span><span class="o">.</span><span class="na">file</span><span class="o">?(</span><span class="nd">@file</span><span class="o">)</span>
    <span class="n">File</span><span class="o">.</span><span class="na">readlines</span><span class="o">(</span><span class="nd">@file</span><span class="o">).</span><span class="na">reject</span><span class="o">(&amp;:</span><span class="n">empty</span><span class="o">?)</span>
  <span class="n">end</span>
<span class="o">}</span></code></pre></figure><p>The first two potential mistakes were filtered out in the constructor, while the other two---later, in the method. Why did I do it this way? Why not put all of them into the constructor?</p><p>Because the first two compromise <a href="/2014/12/09/immutable-object-state-and-behavior.html">object state</a>, while with the other two---its runtime behavior. You remember that an <a href="/2016/07/14/who-is-object.html">object</a> is a representative of a set of other objects it encapsulates, called attributes. The object of class <code>Users</code> can&#39;t <em>represent</em> <code>nil</code> or a number. It can only represent a file with a name of type <code>String</code>. On the other hand, what that file contains and whether it really is a file---doesn&#39;t make the state invalid. It only causes trouble for the behavior.</p><p>Even though the difference may look subtle, it&#39;s obvious. There are two phases of interaction with the encapsulated object: <em>connecting</em> and <em>talking</em>.</p><aside class='youtube'> <a href='https://www.youtube.com/watch?v=-drZbHxydMc'><div class='box'> <img src='https://i.ytimg.com/vi/-drZbHxydMc/mqdefault.jpg' alt='YouTube video #-drZbHxydMc'/><div class='play'><i class='icon icon-play'></i></div></div></a><div>When do you validate your objects?; 4 July 2018.</div></aside><p>First, we encapsulate the <code>file</code> and want to be sure that it really is a file. We are not yet talking to it, we don&#39;t want it to work for us yet, we just want to make sure it really <em>is</em> an object that we will be able to talk to in the near future. If it&#39;s <code>nil</code> or a <code>float</code>, we will have problems in the future, for sure. That&#39;s why we raise an exception from the constructor.</p><p>Then the second phase is talking, where we delegate control to the object and expect it to behave correctly. At this phase we may have other validation procedures, in order to make sure our interaction will go smoothly. It&#39;s important to mention that these validations are very situational. We may call <code>names()</code> multiple times and every time have a different situation with the file on disc. To begin with it may not exist, while in a few seconds it will be ready and available for reading.</p><p>Ideally, a programming language should provide instruments for the first type of validations, for example with <a href="https://en.wikipedia.org/wiki/Strong_and_weak_typing">strict typing</a>. In Java, for example, we would not need to check the type of <code>file</code>, the compiler would catch that error earlier. In Kotlin we would be able to get rid of the NULL check, thanks to their <a href="https://kotlinlang.org/docs/reference/null-safety.html">Null Safety</a> feature. Ruby is less powerful than those languages, that&#39;s why we have to validate &quot;manually.&quot;</p><p>Thus, to summarize, validating in constructors is <em>not</em> a bad idea, provided the validations are <em>not touching the objects</em> but only confirm that they are good enough to work with later.</p></div></article></div><div class="wrapper"> <related-posts /></div><div class="disqus" role="complementary"><p class="disqus_hint"> Please, use <a href="https://help.disqus.com/commenting/what-html-tags-are-allowed-within-comments">syntax highlighting</a> in your comments, to make them more readable.</p><div id="disqus_thread" class="disqus-thread"> <a>&nbsp;</a></div><script> var disqus_config = function () { this.page.url = document.location.href.split('?')[0].split('#')[0].replace('https://', 'http://'); this.page.identifier = this.page.url; }; (function() { var d = document, s = d.createElement('script'); s.src = '//yegor256.disqus.com/embed.js'; s.setAttribute('data-timestamp', +new Date()); (d.head || d.body).appendChild(s); })(); </script> <noscript><div><p class="red"> JavaScript is disabled in your browser, that's why you can't see comments under this post.</p></div></noscript></div><div class="wrapper"> <footer class="footer"><p> &copy; <span itemscope="" itemprop="copyrightHolder" itemtype="http://schema.org/Person"> <span itemprop="name">Yegor Bugayenko</span> </span> 2014&ndash;<span itemprop="copyrightYear">2018</span></p></footer></div></section><div class="wrapper unprintable" style="text-align:center;margin-top:2em;"> <a href="http://www.sixnines.io/h/3ba1652f"> <img src="//www.sixnines.io/b/3ba1652f?style=flat" alt="sixnines availability badge"/> </a></div><script src="//code.jquery.com/jquery-1.9.0.min.js"></script> <script src="/js/all.js?a0e0d018c07"></script> <script>var disqus_shortname = 'yegor256';</script> <script id="dsq-count-scr" src="//yegor256.disqus.com/count.js" async="async"></script> <script> (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){ (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o), m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m) })(window,document,'script','//www.google-analytics.com/analytics.js','ga'); ga('create', 'UA-1963507-32', 'auto'); ga('send', 'pageview'); </script> <script> Cd=document;Cr="&"+Math.random();Cp="&s=1"; Cd.cookie="b=b";if(Cd.cookie)Cp+="&c=1"; Cp+="&t="+(new Date()).getTimezoneOffset(); if(self!=top)Cp+="&f=1"; </script> <script> if(navigator.javaEnabled())Cp+="&j=1"; </script> <script> if(typeof(screen)!='undefined')Cp+="&w="+screen.width+"&h="+ screen.height+"&d="+(screen.colorDepth?screen.colorDepth:screen.pixelDepth); </script> <script> Cd.write("<img src='//c.hit.ua/hit?i=95870&g=0&x=2"+Cp+Cr+ "&r="+escape(Cd.referrer)+"&u="+escape(window.location.href)+ "' border='0' wi"+"dth='1' he"+"ight='1'/>"); </script> <script type="application/ld+json"> { "@context": "http://schema.org", "@type": "Person", "name": "Yegor Bugayenko", "url": "http://www.yegor256.com", "sameAs": [ "https://www.facebook.com/yegor256", "https://instagram.com/yegor256", "https://www.linkedin.com/in/yegor256", "https://twitter.com/yegor256", "https://github.com/yegor256", "https://www.pinterest.com/yegor256/" ] } </script> </body> </html> <!DOCTYPE html> <html xmlns="http://www.w3.org/1999/xhtml" lang="en-US" xml:lang="en-US" itemscope="" itemtype="http://schema.org/WebSite"> <head> <meta charset="utf-8"/> <meta name="description" content="Returning NULL when a method can&apos;t calculate the result is widely considered a bad practice; there are a number of alternatives. " /> <meta name="keywords" content="null in oop, null is bad, null is evil, oop null, return null" /> <meta name="viewport" content="width=device-width,minimum-scale=1,initial-scale=1"/> <meta name="google-site-verification" content="JEj_gQr2CPe2QKGw8XdMz0R7VboQIUbX3FlM-lwTq-8" /> <meta name="author" content="Yegor Bugayenko"> <meta name="article:published_time" content="2018-05-22 00:00:00 +0000"> <meta name="og:site_name" content="Yegor Bugayenko"/> <meta name="og:type" content="article" /> <meta name="og:locale" content="en_US" /> <meta name="twitter:account_id" content="4503599630178231" /> <meta name="twitter:creator" content="@yegor256"/> <meta name="twitter:site" content="@yegor256"/> <meta name="twitter:title" property="og:title" content="One More Recipe Against NULL"/> <meta name="twitter:description" property="og:description" content="Returning NULL when a method can&apos;t calculate the result is widely considered a bad practice; there are a number of alternatives. "/> <meta name="twitter:url" property="og:url" content="https://www.yegor256.com/2018/05/22/default-arguments-against-null.html"/> <meta name="telegram:channel" content="AAAAAEJFMRzsRTRxM3ec6A"/> <link rel="search" type="application/opensearchdescription+xml" href="/opensearch.xml" title="yegor256" /> <link rel="shortcut icon" href="/favicon.ico?a0e0d018c07"/> <link rel="apple-touch-icon" href="/favicon.ico?a0e0d018c07"/> <link rel="alternate" type="application/rss+xml" title="RSS for yegor256.com" href="https://www.yegor256.com/rss.xml"/> <link rel="stylesheet" href="/css/layout.css?a0e0d018c07"/> <link rel="stylesheet" href="/css/icons.css?a0e0d018c07"/> <link rel="canonical" href="https://www.yegor256.com/2018/05/22/default-arguments-against-null.html" /> <link rel="amphtml" href="https://www.yegor256.com/2018/05/22/default-arguments-against-null.amp.html" /> <title>One More Recipe Against NULL </title> <meta name='og:image' content='https://www.yegor256.com/images/2018/05/snatch.jpg'/><meta name='twitter:image' content='https://www.yegor256.com/images/2018/05/snatch.jpg'/><meta name='og:image:width' content='1280'/> <meta name='twitter:image:width' content='1280'/><meta name='og:image:height' content='688'/> <meta name='twitter:image:height' content='688'/><meta name='twitter:card' content='summary_large_image'/><meta name='twitter:image:alt' content='Snatch (2000) by Guy Ritchie'/> </head> <body><div class="wrapper"> <aside class="header-toggle unprintable" id="header-toggle" title="Show the menu" onclick="$('#header').show();$('#header-toggle').hide();">&#9776;</aside> <header class="header" id="header"><div class="face"> <a href="/about-me.html#form" class="sub" title="Click to subscribe to my monthly newsletter"><span>Subscribe</span></a> <a href="/about-me.html" style="position:relative;"> <img src="/images/face-256x256.jpg" class="photo" alt="Yegor Bugayenko"/> </a></div><nav><ul class="menu social notranslate"> <li><a href="https://twitter.com/intent/follow?screen_name=yegor256" rel="nofollow" title="Follow me on Twitter"><i class="icon icon-twitter notranslate" aria-hidden="true"></i></a></li> <li><a href="/rss.xml" rel="nofollow" title="Subscribe to my RSS feed"><i class="icon icon-rss notranslate" aria-hidden="true"></i></a></li> <li><a itemprop="sameAs" href="https://github.com/yegor256" rel="nofollow" title="My GitHub profile"><i class="icon icon-github notranslate" aria-hidden="true"></i></a></li> <li><a itemprop="sameAs" href="http://stackoverflow.com/users/187141/yegor256" rel="nofollow" title="My StackOverflow profile"><i class="icon icon-stackoverflow notranslate" aria-hidden="true"></i></a></li> <li><a itemprop="sameAs" href="https://www.facebook.com/yegor256" rel="nofollow" title="Follow me on Facebook"><i class="icon icon-facebook notranslate" aria-hidden="true"></i></a></li> <li><a itemprop="sameAs" href="https://instagram.com/yegor256" rel="nofollow" title="Follow me on Instagram"><i class="icon icon-instagram notranslate" aria-hidden="true"></i></a></li> <li><a itemprop="sameAs" href="https://www.linkedin.com/in/yegor256" rel="nofollow" title="My LinkedIn profile"><i class="icon icon-linkedin notranslate" aria-hidden="true"></i></a></li> <li><a itemprop="sameAs" href="https://www.youtube.com/c/yegor256?sub_confirmation=1" rel="nofollow" title="My Youtube video channel"><i class="icon icon-youtube notranslate" aria-hidden="true"></i></a></li> <li><a itemprop="sameAs" href="https://www.pinterest.com/yegor256/" rel="nofollow" title="My Pinterest boards"><i class="icon icon-pinterest notranslate" aria-hidden="true"></i></a></li> <li><a itemprop="sameAs" href="https://angel.co/yegor256" rel="nofollow" title="My AngelList profile"><i class="icon icon-angellist notranslate" aria-hidden="true"></i></a></li> <li><a href="https://soundcloud.com/yegor256" rel="nofollow" title="My podcast"><i class="icon icon-podcast notranslate" aria-hidden="true"></i></a></li> <li><a href="https://itunes.apple.com/us/podcast/yegor256-podcast/id1150826721" rel="nofollow" title="My iTunes podcast"><i class="icon icon-itunes notranslate" aria-hidden="true"></i></a></li> <li><a href="https://t.me/joinchat/AAAAAEJFMRzsRTRxM3ec6A" rel="nofollow" title="My Telegram public channel"><i class="icon icon-telegram notranslate" aria-hidden="true"></i></a></li> <li><a href="mailto:blog@yegor256.com" rel="nofollow" title="Email me any time"><i class="icon icon-mail notranslate" aria-hidden="true"></i></a></li></ul><ul class="menu"> <li><a href="/" title="Home page">Home</a></li> <li ><a href="/best.html" title="Best articles to read">12&#160;Best</a></li> <li ><a href="/contents.html" title="The contents of the entire blog">All&#160;288</a></li> <li ><a href="/webinars.html" title="My webinars">Webinars</a></li> <li ><a href="/talks.html" title="Future and past conference talks">Talks</a></li> <li ><a href="/books.html" title="The books I wrote">Books</a></li> <li ><a href="/papers.html" title="My academic papers and patents">Papers</a></li> <li ><a href="/pets.html" title="My loved pet projects">Pets</a></li> <li ><a href="/award.html" title="Software quality award">Award</a></li> <li ><a href="/testimonials.html" title="What some people say about me">Testimonials</a></li> <li ><a href="/shift-m.html" title="Audio podcast about project management">Shift-M</a></li> <li ><a href="/paintings.html" title="My paintings for sale">Paintings</a></li> <li><a href="http://ru.yegor256.com/" title="Немного на русском языке">По-русски</a></li></ul></nav><div class="search"> <form method="get" action="https://www.google.com/search" itemprop="potentialAction" itemscope="" itemtype="http://schema.org/SearchAction"> <meta itemprop="target" content="https://www.google.com/search?q={q}"/> <input name="sitesearch" value="yegor256.com" type="hidden"/> <input itemprop="query-input" type="text" id="search-query" class="field field-text" required="required" onfocus="$('.google').css('visibility', 'visible');" name="q" placeholder="Search..." autocomplete="off"/> <input type="image" src="/images/google-search-icon.svg" class="google" title="Search via Google" alt="Search via Google"/> </form></div><div class="hot"><ul> <li> <a href="/code-ahead.html">Code Ahead</a> was published on Amazon just a few days ago! It is my new book, a novel about programmers. It explains in details the majority of ideas that stand behind <a href="https://www.zerocracy.com">Zerocracy</a> and <a href="https://www.xdsd.org">XDSD</a>. </li> <li> At <a href="/webinars.html">Webinar #37</a> we will discuss naming problem in OOP, for objects, methods and attributes; join us on <b>September 12</b>, at 11am PST. </li></ul></div></header></div><section itemscope="" itemtype="http://schema.org/BlogPosting"><div class="wrapper"> <header><p class="printable"> <img src="https://api.qrserver.com/v1/create-qr-code/?data=https://www.yegor256.com/2018/05/22/default-arguments-against-null.html&amp;format=svg" style="width:125px;height:125px;" alt="QR code"/></p><p class="printable"> <code itemprop="url">https://www.yegor256.com/2018/05/22/default-arguments-against-null.html</code></p><h1 itemprop="name headline mainEntityOfPage">One More Recipe Against NULL</h1><ul class="subline"> <li> <time itemprop="datePublished" datetime="2018-05-22T00:00:00+00:00"> 22 May 2018 </time> </li> <li class="desktop-only" itemprop="locationCreated">Moscow, Russia</li> <li class="printable" itemscope="" itemprop="author" itemtype="http://schema.org/Person"> <span itemprop="name">Yegor Bugayenko</span> </li> <li class="unprintable"> <i class="icon icon-comments"></i> <a href="http://www.yegor256.com/2018/05/22/default-arguments-against-null.html#disqus_thread" itemprop="discussionUrl">comments</a> </li></ul><p class="unprintable"><p>You know what NULL is, right? It&#39;s <a href="https://www.infoq.com/presentations/Null-References-The-Billion-Dollar-Mistake-Tony-Hoare">evil</a>. In OOP, your method can return NULL, it can accept NULL as an argument, your object can encapsulate it as an attribute, or you can assign it to a variable. All four scenarios are bad for the maintainability of your code---there are no doubts about that. The question is what to do instead. Let&#39;s discuss the &quot;return it&quot; part and I will suggest one more &quot;best practice&quot; on top of what <a href="/2014/05/13/why-null-is-bad.html">was discussed</a> a few years ago.</p><figure class='jb_picture'><img itemprop='image' alt='Snatch (2000) by Guy Ritchie' src='/images/2018/05/snatch.jpg' longdesc='#7fe602d0'/><figcaption id='7fe602d0'>Snatch (2000) by Guy Ritchie</figcaption></figure><p>Look at this code:</p><figure class="highlight"><pre><code class="language-java" data-lang="java"><span></span><span class="n">Integer</span> <span class="nf">max</span><span class="o">(</span><span class="n">List</span><span class="o">&lt;</span><span class="n">Integer</span><span class="o">&gt;</span> <span class="n">items</span><span class="o">)</span> <span class="o">{</span>
  <span class="c1">// Calculate the maximum of all</span>
  <span class="c1">// items and return it.</span>
<span class="o">}</span></code></pre></figure><p>What should this method do if the list is empty? Java&#39;s <a href="https://docs.oracle.com/javase/8/docs/api/java/util/Collections.html#max-java.util.Collection-"><code>Collections.max()</code></a> throws an exception. Ruby&#39;s <a href="https://ruby-doc.org/core-2.5.1/Enumerable.html#method-i-max"><code>Enumerable.max()</code></a> returns <code>nil</code>. PHP&#39;s <a href="http://php.net/manual/en/function.max.php"><code>max()</code></a> returns <code>FALSE</code>. Python&#39;s <a href="https://docs.python.org/3/library/functions.html#max"><code>max()</code></a> raises an exception. C#&#39;s <a href="https://msdn.microsoft.com/en-us/library/bb335614(v=vs.110).aspx"><code>Enumerable.Max()</code></a> also throws an exception. JavaScript&#39;s <a href="https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/Math/max"><code>Math.max()</code></a> returns <code>NaN</code>.</p><p>Which is the right way, huh? An exception, NULL, false or NaN?</p><p>An exception, if you ask me.</p><p>But there is yet another approach, which is better than an exception. This one:</p><figure class="highlight"><pre><code class="language-java" data-lang="java"><span></span><span class="n">Integer</span> <span class="nf">max</span><span class="o">(</span><span class="n">List</span><span class="o">&lt;</span><span class="n">Integer</span><span class="o">&gt;</span> <span class="n">items</span><span class="o">,</span> <span class="n">Integer</span> <span class="n">def</span><span class="o">)</span> <span class="o">{</span>
  <span class="c1">// Calculate the maximum of all</span>
  <span class="c1">// items and return it. Returns &#39;def&#39; if the</span>
  <span class="c1">// list is empty.</span>
<span class="o">}</span></code></pre></figure><p>The &quot;default&quot; object will be returned if the list is empty. This feature is implemented in Python&#39;s <a href="https://docs.python.org/3/library/functions.html#max"><code>max()</code></a> function: it&#39;s possible to pass both a list and a default element to return in case the list is empty. If the default element is not provided, the exception will be raised.</p><blockquote class="twitter-tweet" data-lang="en"><p lang="en" dir="ltr">Say, you are designing a method findUserByName(), which has to find a user in the database. What would you return if nothing is found? <a href="https://twitter.com/hashtag/elegantobjects?src=hash&amp;ref_src=twsrc%5Etfw">#elegantobjects</a></p>--- Yegor Bugayenko (@yegor256) <a href="https://twitter.com/yegor256/status/990459955818979329?ref_src=twsrc%5Etfw">April 29, 2018</a></blockquote> <script async src="https://platform.twitter.com/widgets.js" charset="utf-8"></script></p><nav class="buttons notranslate desktop-only"> <a href="http://www.facebook.com/sharer/sharer.php?u=https://www.yegor256.com/2018/05/22/default-arguments-against-null.html" title="Share on Facebook" class="button" rel="nofollow"> <span class="count count-facebook">0</span> <i class="icon icon-facebook notranslate" aria-hidden="true"></i> </a> <a href="https://twitter.com/share?url=https://www.yegor256.com/2018/05/22/default-arguments-against-null.html&amp;text=One+More+Recipe+Against+NULL" title="Share on Twitter" class="button" rel="nofollow"> <span class="count count-twitter">0</span> <i class="icon icon-twitter notranslate" aria-hidden="true"></i> </a> <a href="https://plus.google.com/share?url=https://www.yegor256.com/2018/05/22/default-arguments-against-null.html" title="Share on Google+" class="button" rel="nofollow"> <span class="count count-googleplus">0</span> <i class="icon icon-googleplus notranslate" aria-hidden="true"></i> </a> <a href="https://www.linkedin.com/cws/share?url=https://www.yegor256.com/2018/05/22/default-arguments-against-null.html" title="Share on LinkedIn" class="button" rel="nofollow"> <span class="count count-linkedin">0</span> <i class="icon icon-linkedin notranslate" aria-hidden="true"></i> </a> <a href="http://reddit.com/submit?url=https://www.yegor256.com/2018/05/22/default-arguments-against-null.html%3F2018-20&amp;title=One+More+Recipe+Against+NULL" title="Share on Reddit" class="button" rel="nofollow"> <span class="count count-reddit">0</span> <i class="icon icon-reddit notranslate" aria-hidden="true"></i> </a> <a href="http://news.ycombinator.com/submitlink?u=https://www.yegor256.com/2018/05/22/default-arguments-against-null.html%3F2018-20&amp;t=One+More+Recipe+Against+NULL" title="Share on Hacker News" class="button" rel="nofollow"> <span class="count count-hackernews">0</span> <i class="icon icon-hackernews notranslate" aria-hidden="true"></i> </a> </nav> </header> <article class="main" itemprop="articleBody"><div ><p>You know what NULL is, right? It&#39;s <a href="https://www.infoq.com/presentations/Null-References-The-Billion-Dollar-Mistake-Tony-Hoare">evil</a>. In OOP, your method can return NULL, it can accept NULL as an argument, your object can encapsulate it as an attribute, or you can assign it to a variable. All four scenarios are bad for the maintainability of your code---there are no doubts about that. The question is what to do instead. Let&#39;s discuss the &quot;return it&quot; part and I will suggest one more &quot;best practice&quot; on top of what <a href="/2014/05/13/why-null-is-bad.html">was discussed</a> a few years ago.</p><figure class='jb_picture'><img itemprop='image' alt='Snatch (2000) by Guy Ritchie' src='/images/2018/05/snatch.jpg' longdesc='#7fe602d0'/><figcaption id='7fe602d0'>Snatch (2000) by Guy Ritchie</figcaption></figure><p>Look at this code:</p><figure class="highlight"><pre><code class="language-java" data-lang="java"><span></span><span class="n">Integer</span> <span class="nf">max</span><span class="o">(</span><span class="n">List</span><span class="o">&lt;</span><span class="n">Integer</span><span class="o">&gt;</span> <span class="n">items</span><span class="o">)</span> <span class="o">{</span>
  <span class="c1">// Calculate the maximum of all</span>
  <span class="c1">// items and return it.</span>
<span class="o">}</span></code></pre></figure><p>What should this method do if the list is empty? Java&#39;s <a href="https://docs.oracle.com/javase/8/docs/api/java/util/Collections.html#max-java.util.Collection-"><code>Collections.max()</code></a> throws an exception. Ruby&#39;s <a href="https://ruby-doc.org/core-2.5.1/Enumerable.html#method-i-max"><code>Enumerable.max()</code></a> returns <code>nil</code>. PHP&#39;s <a href="http://php.net/manual/en/function.max.php"><code>max()</code></a> returns <code>FALSE</code>. Python&#39;s <a href="https://docs.python.org/3/library/functions.html#max"><code>max()</code></a> raises an exception. C#&#39;s <a href="https://msdn.microsoft.com/en-us/library/bb335614(v=vs.110).aspx"><code>Enumerable.Max()</code></a> also throws an exception. JavaScript&#39;s <a href="https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/Math/max"><code>Math.max()</code></a> returns <code>NaN</code>.</p><p>Which is the right way, huh? An exception, NULL, false or NaN?</p><p>An exception, if you ask me.</p><p>But there is yet another approach, which is better than an exception. This one:</p><figure class="highlight"><pre><code class="language-java" data-lang="java"><span></span><span class="n">Integer</span> <span class="nf">max</span><span class="o">(</span><span class="n">List</span><span class="o">&lt;</span><span class="n">Integer</span><span class="o">&gt;</span> <span class="n">items</span><span class="o">,</span> <span class="n">Integer</span> <span class="n">def</span><span class="o">)</span> <span class="o">{</span>
  <span class="c1">// Calculate the maximum of all</span>
  <span class="c1">// items and return it. Returns &#39;def&#39; if the</span>
  <span class="c1">// list is empty.</span>
<span class="o">}</span></code></pre></figure><p>The &quot;default&quot; object will be returned if the list is empty. This feature is implemented in Python&#39;s <a href="https://docs.python.org/3/library/functions.html#max"><code>max()</code></a> function: it&#39;s possible to pass both a list and a default element to return in case the list is empty. If the default element is not provided, the exception will be raised.</p><blockquote class="twitter-tweet" data-lang="en"><p lang="en" dir="ltr">Say, you are designing a method findUserByName(), which has to find a user in the database. What would you return if nothing is found? <a href="https://twitter.com/hashtag/elegantobjects?src=hash&amp;ref_src=twsrc%5Etfw">#elegantobjects</a></p>--- Yegor Bugayenko (@yegor256) <a href="https://twitter.com/yegor256/status/990459955818979329?ref_src=twsrc%5Etfw">April 29, 2018</a></blockquote> <script async src="https://platform.twitter.com/widgets.js" charset="utf-8"></script></div></article></div><div class="wrapper"> <related-posts /></div><div class="disqus" role="complementary"><p class="disqus_hint"> Please, use <a href="https://help.disqus.com/commenting/what-html-tags-are-allowed-within-comments">syntax highlighting</a> in your comments, to make them more readable.</p><div id="disqus_thread" class="disqus-thread"> <a>&nbsp;</a></div><script> var disqus_config = function () { this.page.url = document.location.href.split('?')[0].split('#')[0].replace('https://', 'http://'); this.page.identifier = this.page.url; }; (function() { var d = document, s = d.createElement('script'); s.src = '//yegor256.disqus.com/embed.js'; s.setAttribute('data-timestamp', +new Date()); (d.head || d.body).appendChild(s); })(); </script> <noscript><div><p class="red"> JavaScript is disabled in your browser, that's why you can't see comments under this post.</p></div></noscript></div><div class="wrapper"> <footer class="footer"><p> &copy; <span itemscope="" itemprop="copyrightHolder" itemtype="http://schema.org/Person"> <span itemprop="name">Yegor Bugayenko</span> </span> 2014&ndash;<span itemprop="copyrightYear">2018</span></p></footer></div></section><div class="wrapper unprintable" style="text-align:center;margin-top:2em;"> <a href="http://www.sixnines.io/h/3ba1652f"> <img src="//www.sixnines.io/b/3ba1652f?style=flat" alt="sixnines availability badge"/> </a></div><script src="//code.jquery.com/jquery-1.9.0.min.js"></script> <script src="/js/all.js?a0e0d018c07"></script> <script>var disqus_shortname = 'yegor256';</script> <script id="dsq-count-scr" src="//yegor256.disqus.com/count.js" async="async"></script> <script> (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){ (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o), m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m) })(window,document,'script','//www.google-analytics.com/analytics.js','ga'); ga('create', 'UA-1963507-32', 'auto'); ga('send', 'pageview'); </script> <script> Cd=document;Cr="&"+Math.random();Cp="&s=1"; Cd.cookie="b=b";if(Cd.cookie)Cp+="&c=1"; Cp+="&t="+(new Date()).getTimezoneOffset(); if(self!=top)Cp+="&f=1"; </script> <script> if(navigator.javaEnabled())Cp+="&j=1"; </script> <script> if(typeof(screen)!='undefined')Cp+="&w="+screen.width+"&h="+ screen.height+"&d="+(screen.colorDepth?screen.colorDepth:screen.pixelDepth); </script> <script> Cd.write("<img src='//c.hit.ua/hit?i=95870&g=0&x=2"+Cp+Cr+ "&r="+escape(Cd.referrer)+"&u="+escape(window.location.href)+ "' border='0' wi"+"dth='1' he"+"ight='1'/>"); </script> <script type="application/ld+json"> { "@context": "http://schema.org", "@type": "Person", "name": "Yegor Bugayenko", "url": "http://www.yegor256.com", "sameAs": [ "https://www.facebook.com/yegor256", "https://instagram.com/yegor256", "https://www.linkedin.com/in/yegor256", "https://twitter.com/yegor256", "https://github.com/yegor256", "https://www.pinterest.com/yegor256/" ] } </script> </body> </html> <!DOCTYPE html> <html xmlns="http://www.w3.org/1999/xhtml" lang="en-US" xml:lang="en-US" itemscope="" itemtype="http://schema.org/WebSite"> <head> <meta charset="utf-8"/> <meta name="description" content="Fluent interface is a very popular and convenient design pattern, which, however, makes objects larger and less maintainable. " /> <meta name="keywords" content="fluent interface, fluent interface is evil, fluent interface java, fluent interfaces are evil, oop fluent interface" /> <meta name="viewport" content="width=device-width,minimum-scale=1,initial-scale=1"/> <meta name="google-site-verification" content="JEj_gQr2CPe2QKGw8XdMz0R7VboQIUbX3FlM-lwTq-8" /> <meta name="author" content="Yegor Bugayenko"> <meta name="article:published_time" content="2018-03-13 00:00:00 +0000"> <meta name="og:site_name" content="Yegor Bugayenko"/> <meta name="og:type" content="article" /> <meta name="og:locale" content="en_US" /> <meta name="twitter:account_id" content="4503599630178231" /> <meta name="twitter:creator" content="@yegor256"/> <meta name="twitter:site" content="@yegor256"/> <meta name="twitter:title" property="og:title" content="Fluent Interfaces Are Bad for Maintainability"/> <meta name="twitter:description" property="og:description" content="Fluent interface is a very popular and convenient design pattern, which, however, makes objects larger and less maintainable. "/> <meta name="twitter:url" property="og:url" content="https://www.yegor256.com/2018/03/13/fluent-interfaces.html"/> <meta name="telegram:channel" content="AAAAAEJFMRzsRTRxM3ec6A"/> <link rel="search" type="application/opensearchdescription+xml" href="/opensearch.xml" title="yegor256" /> <link rel="shortcut icon" href="/favicon.ico?a0e0d018c07"/> <link rel="apple-touch-icon" href="/favicon.ico?a0e0d018c07"/> <link rel="alternate" type="application/rss+xml" title="RSS for yegor256.com" href="https://www.yegor256.com/rss.xml"/> <link rel="stylesheet" href="/css/layout.css?a0e0d018c07"/> <link rel="stylesheet" href="/css/icons.css?a0e0d018c07"/> <link rel="canonical" href="https://www.yegor256.com/2018/03/13/fluent-interfaces.html" /> <link rel="amphtml" href="https://www.yegor256.com/2018/03/13/fluent-interfaces.amp.html" /> <title>Fluent Interfaces Are Bad for Maintainability </title> <meta name='og:image' content='https://www.yegor256.com/images/2018/03/donnie-brasco.jpg'/><meta name='twitter:image' content='https://www.yegor256.com/images/2018/03/donnie-brasco.jpg'/><meta name='og:image:width' content='1280'/> <meta name='twitter:image:width' content='1280'/><meta name='og:image:height' content='720'/> <meta name='twitter:image:height' content='720'/><meta name='twitter:card' content='summary_large_image'/><meta name='twitter:image:alt' content='Donnie Brasco (1997) by Mike Newell'/> </head> <body><div class="wrapper"> <aside class="header-toggle unprintable" id="header-toggle" title="Show the menu" onclick="$('#header').show();$('#header-toggle').hide();">&#9776;</aside> <header class="header" id="header"><div class="face"> <a href="/about-me.html#form" class="sub" title="Click to subscribe to my monthly newsletter"><span>Subscribe</span></a> <a href="/about-me.html" style="position:relative;"> <img src="/images/face-256x256.jpg" class="photo" alt="Yegor Bugayenko"/> </a></div><nav><ul class="menu social notranslate"> <li><a href="https://twitter.com/intent/follow?screen_name=yegor256" rel="nofollow" title="Follow me on Twitter"><i class="icon icon-twitter notranslate" aria-hidden="true"></i></a></li> <li><a href="/rss.xml" rel="nofollow" title="Subscribe to my RSS feed"><i class="icon icon-rss notranslate" aria-hidden="true"></i></a></li> <li><a itemprop="sameAs" href="https://github.com/yegor256" rel="nofollow" title="My GitHub profile"><i class="icon icon-github notranslate" aria-hidden="true"></i></a></li> <li><a itemprop="sameAs" href="http://stackoverflow.com/users/187141/yegor256" rel="nofollow" title="My StackOverflow profile"><i class="icon icon-stackoverflow notranslate" aria-hidden="true"></i></a></li> <li><a itemprop="sameAs" href="https://www.facebook.com/yegor256" rel="nofollow" title="Follow me on Facebook"><i class="icon icon-facebook notranslate" aria-hidden="true"></i></a></li> <li><a itemprop="sameAs" href="https://instagram.com/yegor256" rel="nofollow" title="Follow me on Instagram"><i class="icon icon-instagram notranslate" aria-hidden="true"></i></a></li> <li><a itemprop="sameAs" href="https://www.linkedin.com/in/yegor256" rel="nofollow" title="My LinkedIn profile"><i class="icon icon-linkedin notranslate" aria-hidden="true"></i></a></li> <li><a itemprop="sameAs" href="https://www.youtube.com/c/yegor256?sub_confirmation=1" rel="nofollow" title="My Youtube video channel"><i class="icon icon-youtube notranslate" aria-hidden="true"></i></a></li> <li><a itemprop="sameAs" href="https://www.pinterest.com/yegor256/" rel="nofollow" title="My Pinterest boards"><i class="icon icon-pinterest notranslate" aria-hidden="true"></i></a></li> <li><a itemprop="sameAs" href="https://angel.co/yegor256" rel="nofollow" title="My AngelList profile"><i class="icon icon-angellist notranslate" aria-hidden="true"></i></a></li> <li><a href="https://soundcloud.com/yegor256" rel="nofollow" title="My podcast"><i class="icon icon-podcast notranslate" aria-hidden="true"></i></a></li> <li><a href="https://itunes.apple.com/us/podcast/yegor256-podcast/id1150826721" rel="nofollow" title="My iTunes podcast"><i class="icon icon-itunes notranslate" aria-hidden="true"></i></a></li> <li><a href="https://t.me/joinchat/AAAAAEJFMRzsRTRxM3ec6A" rel="nofollow" title="My Telegram public channel"><i class="icon icon-telegram notranslate" aria-hidden="true"></i></a></li> <li><a href="mailto:blog@yegor256.com" rel="nofollow" title="Email me any time"><i class="icon icon-mail notranslate" aria-hidden="true"></i></a></li></ul><ul class="menu"> <li><a href="/" title="Home page">Home</a></li> <li ><a href="/best.html" title="Best articles to read">12&#160;Best</a></li> <li ><a href="/contents.html" title="The contents of the entire blog">All&#160;288</a></li> <li ><a href="/webinars.html" title="My webinars">Webinars</a></li> <li ><a href="/talks.html" title="Future and past conference talks">Talks</a></li> <li ><a href="/books.html" title="The books I wrote">Books</a></li> <li ><a href="/papers.html" title="My academic papers and patents">Papers</a></li> <li ><a href="/pets.html" title="My loved pet projects">Pets</a></li> <li ><a href="/award.html" title="Software quality award">Award</a></li> <li ><a href="/testimonials.html" title="What some people say about me">Testimonials</a></li> <li ><a href="/shift-m.html" title="Audio podcast about project management">Shift-M</a></li> <li ><a href="/paintings.html" title="My paintings for sale">Paintings</a></li> <li><a href="http://ru.yegor256.com/" title="Немного на русском языке">По-русски</a></li></ul></nav><div class="search"> <form method="get" action="https://www.google.com/search" itemprop="potentialAction" itemscope="" itemtype="http://schema.org/SearchAction"> <meta itemprop="target" content="https://www.google.com/search?q={q}"/> <input name="sitesearch" value="yegor256.com" type="hidden"/> <input itemprop="query-input" type="text" id="search-query" class="field field-text" required="required" onfocus="$('.google').css('visibility', 'visible');" name="q" placeholder="Search..." autocomplete="off"/> <input type="image" src="/images/google-search-icon.svg" class="google" title="Search via Google" alt="Search via Google"/> </form></div><div class="hot"><ul> <li> <a href="/code-ahead.html">Code Ahead</a> was published on Amazon just a few days ago! It is my new book, a novel about programmers. It explains in details the majority of ideas that stand behind <a href="https://www.zerocracy.com">Zerocracy</a> and <a href="https://www.xdsd.org">XDSD</a>. </li> <li> At <a href="/webinars.html">Webinar #37</a> we will discuss naming problem in OOP, for objects, methods and attributes; join us on <b>September 12</b>, at 11am PST. </li></ul></div></header></div><section itemscope="" itemtype="http://schema.org/BlogPosting"><div class="wrapper"> <header><p class="printable"> <img src="https://api.qrserver.com/v1/create-qr-code/?data=https://www.yegor256.com/2018/03/13/fluent-interfaces.html&amp;format=svg" style="width:125px;height:125px;" alt="QR code"/></p><p class="printable"> <code itemprop="url">https://www.yegor256.com/2018/03/13/fluent-interfaces.html</code></p><h1 itemprop="name headline mainEntityOfPage">Fluent Interfaces Are Bad for Maintainability</h1><ul class="subline"> <li> <time itemprop="datePublished" datetime="2018-03-13T00:00:00+00:00"> 13 March 2018 </time> </li> <li class="desktop-only" itemprop="locationCreated">Moscow, Russia</li> <li class="printable" itemscope="" itemprop="author" itemtype="http://schema.org/Person"> <span itemprop="name">Yegor Bugayenko</span> </li> <li class="unprintable"> <i class="icon icon-comments"></i> <a href="http://www.yegor256.com/2018/03/13/fluent-interfaces.html#disqus_thread" itemprop="discussionUrl">comments</a> </li></ul><ul class="subline"> <li>Discussed at:</li> <li><a href="https://news.ycombinator.com/item?id=16619171">hackernews</a></li></ul><p class="unprintable"><p><a href="https://en.wikipedia.org/wiki/Fluent_interface">Fluent interface</a>, first <a href="https://martinfowler.com/bliki/FluentInterface.html">coined</a> as a term by Martin Fowler, is a very convenient way of communicating with objects in OOP. It makes their facades easier to use and understand. However, it ruins their internal design, making them more difficult to maintain. A few words were said about that by Marco Pivetta in his blog post <a href="https://ocramius.github.io/blog/fluent-interfaces-are-evil/">Fluent Interfaces are Evil</a>; now I will add my few cents.</p><figure class='jb_picture'><img itemprop='image' alt='Donnie Brasco (1997) by Mike Newell' src='/images/2018/03/donnie-brasco.jpg' longdesc='#bda17a6d'/><figcaption id='bda17a6d'>Donnie Brasco (1997) by Mike Newell</figcaption></figure><p>Let&#39;s take my own library <a href="http://http.jcabi.com/">jcabi-http</a>, which I created a few years ago, when I thought that fluent interfaces were a good thing. Here is how you use the library to make an HTTP request and validate its output:</p><figure class="highlight"><pre><code class="language-java" data-lang="java"><span></span><span class="n">String</span> <span class="n">html</span> <span class="o">=</span> <span class="k">new</span> <span class="n">JdkRequest</span><span class="o">(</span><span class="s">&quot;https://www.google.com&quot;</span><span class="o">)</span>
  <span class="o">.</span><span class="na">method</span><span class="o">(</span><span class="s">&quot;GET&quot;</span><span class="o">)</span>
  <span class="o">.</span><span class="na">fetch</span><span class="o">()</span>
  <span class="o">.</span><span class="na">as</span><span class="o">(</span><span class="n">RestResponse</span><span class="o">.</span><span class="na">class</span><span class="o">)</span>
  <span class="o">.</span><span class="na">assertStatus</span><span class="o">(</span><span class="mi">200</span><span class="o">)</span>
  <span class="o">.</span><span class="na">body</span><span class="o">();</span></code></pre></figure><p>This convenient <a href="https://en.wikipedia.org/wiki/Method_chaining">method chaining</a> makes the code short and obvious, right? Yes, it does, on the surface. But the <em>internal</em> design of the library&#39;s classes, including <a href="http://static.javadoc.io/com.jcabi/jcabi-http/1.17.2/com/jcabi/http/request/JdkRequest.html"><code>JdkRequest</code></a>, which is the one you see, is very far from being elegant. The biggest problem is that they are rather big and it&#39;s <del>difficult</del> impossible to extend them without making them even bigger.</p><aside class='youtube'> <a href='https://www.youtube.com/watch?v=REj8pJesMVI'><div class='box'> <img src='https://i.ytimg.com/vi/REj8pJesMVI/mqdefault.jpg' alt='YouTube video #REj8pJesMVI'/><div class='play'><i class='icon icon-play'></i></div></div></a><div>The Alternative to Fluent Interfaces in Java (webinar #33); 4 April 2018.</div></aside><p>For example, right now <a href="http://static.javadoc.io/com.jcabi/jcabi-http/1.17.2/com/jcabi/http/request/JdkRequest.html"><code>JdkRequest</code></a> has the methods <a href="http://static.javadoc.io/com.jcabi/jcabi-http/1.17.2/com/jcabi/http/Request.html#method%28java.lang.String%29"><code>method()</code></a>, <a href="http://static.javadoc.io/com.jcabi/jcabi-http/1.17.2/com/jcabi/http/Request.html#fetch%28%29"><code>fetch()</code></a>, and a few others. What happens when new functionality is required? The only way to add to it would be to make the class bigger, by adding new methods, which is how we jeopardize its maintainability. <a href="https://github.com/jcabi/jcabi-http/pull/142/files">Here</a>, for example, we added <a href="http://static.javadoc.io/com.jcabi/jcabi-http/1.17.2/com/jcabi/http/Request.html#multipartBody%28%29"><code>multipartBody()</code></a> and <a href="https://github.com/jcabi/jcabi-http/pull/99/files">here</a> we added <a href="http://static.javadoc.io/com.jcabi/jcabi-http/1.17.2/com/jcabi/http/Request.html#timeout%28int,%20int%29">timeout()</a>.</p><p>I always feel scared when I get a new feature request in jcabi-http. I understand that it most probably means adding new methods to <a href="http://static.javadoc.io/com.jcabi/jcabi-http/1.17.2/com/jcabi/http/Request.html"><code>Request</code></a>, <a href="http://static.javadoc.io/com.jcabi/jcabi-http/1.17.2/com/jcabi/http/Response.html"><code>Response</code></a>, and other already bloated interfaces and classes.</p><p>I actually tried to do something in the library in order to solve this problem but it wasn&#39;t easy. Look at this <a href="http://static.javadoc.io/com.jcabi/jcabi-http/1.17.2/com/jcabi/http/Response.html#as%28java.lang.Class%29"><code>.as(RestResponse.class)</code></a> method call. What it does is decorate a <code>Response</code> with <a href="http://static.javadoc.io/com.jcabi/jcabi-http/1.17.2/com/jcabi/http/response/RestResponse.html"><code>RestResponse</code></a>, in order to make it method-richer. I just didn&#39;t want to make <a href="http://static.javadoc.io/com.jcabi/jcabi-http/1.17.2/com/jcabi/http/Response.html"><code>Response</code></a> contain 50+ methods, like many other libraries do. Here is what it does (this is pseudo-code):</p><figure class="highlight"><pre><code class="language-text" data-lang="text"><span></span>class Response {
  RestResponse as() {
    return new RestResponse(this);
  }
  // Seven methods
}
class RestResponse implements Response {
  private final Response origin;
  // Original seven methods from Response
  // Additional 14 methods
}</code></pre></figure><p>As you see, instead of adding all possible methods to <code>Response</code> I placed them in supplementary decorators <a href="http://static.javadoc.io/com.jcabi/jcabi-http/1.17.2/com/jcabi/http/response/RestResponse.html"><code>RestResponse</code></a>, <a href="http://static.javadoc.io/com.jcabi/jcabi-http/1.17.2/com/jcabi/http/response/JsonResponse.html"><code>JsonResponse</code></a>, <a href="http://static.javadoc.io/com.jcabi/jcabi-http/1.17.2/com/jcabi/http/response/JsonResponse.html"><code>XmlResponse</code></a>, and <a href="http://static.javadoc.io/com.jcabi/jcabi-http/1.17.2/com/jcabi/http/response/package-frame.html">others</a>. It helps, but in order to write these decorators with the central object of type <code>Response</code> we have to use that &quot;ugly&quot; method <a href="http://static.javadoc.io/com.jcabi/jcabi-http/1.17.2/com/jcabi/http/Response.html#as%28java.lang.Class%29"><code>as()</code></a>, which depends heavily on Reflection and <a href="/2015/04/02/class-casting-is-anti-pattern.html">type casting</a>.</p><aside class='quote'>Fluent interfaces mean large classes or some ugly workarounds.</aside><p>In other words, fluent interfaces mean large classes or some ugly workarounds. I mentioned this problem earlier, when I <a href="/2017/10/10/streams-vs-decorators.html">wrote</a> about <a href="http://www.oracle.com/technetwork/articles/java/ma14-java-se-8-streams-2177646.html">Streams API</a> and the interface <a href="https://docs.oracle.com/javase/8/docs/api/java/util/stream/Stream.html">Stream</a>, which is perfectly fluent. There are 43 methods!</p><p>That is the biggest problem with fluent interfaces---they <em>force</em> objects to be huge.</p><p>Fluent interfaces are perfect for their users, since all methods are in one place and the amount of classes is very small. It is easy to use them, especially with <a href="https://www.jetbrains.com/help/idea/auto-completing-code.html">code auto-completion</a> in most IDEs. They also make client code more readable, since &quot;fluent&quot; constructs look similar to plain English (aka <a href="https://en.wikipedia.org/wiki/Domain-specific_language">DSL</a>).</p><p>That is all true! However, the damage they cause to object design is the price, which is too high.</p><p>What is the alternative?</p><p>I would recommend you use decorators and <a href="/2016/04/26/why-inputstream-design-is-wrong.html">smart objects</a> instead. Here is how I would design jcabi-http, if I could do it now:</p><figure class="highlight"><pre><code class="language-java" data-lang="java"><span></span><span class="n">String</span> <span class="n">html</span> <span class="o">=</span> <span class="k">new</span> <span class="n">BodyOfResponse</span><span class="o">(</span>
  <span class="k">new</span> <span class="n">ResponseAssertStatus</span><span class="o">(</span>
    <span class="k">new</span> <span class="n">RequestWithMethod</span><span class="o">(</span>
      <span class="k">new</span> <span class="n">JdkRequest</span><span class="o">(</span><span class="s">&quot;https://www.google.com&quot;</span><span class="o">),</span>
      <span class="s">&quot;GET&quot;</span>
    <span class="o">),</span>
    <span class="mi">200</span>
  <span class="o">)</span>
<span class="o">).</span><span class="na">toString</span><span class="o">();</span></code></pre></figure><p>This is the same code as in the first snippet above, but it is much more object-oriented. The obvious problem with this code, of course, is that the IDE won&#39;t be able to auto-complete almost anything. Also, we will have to remember many of the names of the classes. And the construct looks rather difficult to read for those who are used to fluent interfaces. In addition, it&#39;s very far away from the DSL idea.</p><aside class='quote'>Fluent interfaces are good for users, but bad for developers. Small objects are good for developers, but difficult to use.</aside><p>But here is the list of benefits. First, each object is small, very cohesive and they are all loosely coupled---which are obvious merits in OOP. Second, adding new functionality to the library is as easy as creating a new class; no need to touch existing classes. Third, unit testing is simplified, since classes are small. Fourth, all classes can be immutable, which is also an <a href="/2014/06/09/objects-should-be-immutable.html">obvious merit</a> in OOP.</p><p>Thus, there seems to be a conflict between usefulness and maintainability. Fluent interfaces are good for users, but bad for library developers. Small objects are good for developers, but difficult to understand and use.</p><p>It seems to be so, but only if you are used to large classes and procedural programming. To me, a large amount of small classes seems to be an <a href="/2017/02/28/too-many-classes.html">advantage</a>, not a drawback. Libraries that are clear, simple, and readable inside are much easier to use, even when I don&#39;t know exactly which classes out there are the most suitable for me. Even without the code-auto-complete I can figure it out myself, because the code is clean.</p><p>Also, I very often find myself interested in extending existing functionality either inside my code base or via a pull request to the library. I am much more <a href="/2015/12/22/why-dont-you-contribute-to-open-source.html">interested</a> to do that if I know that the changes I introduce are isolated and easy to test.</p><p>Thus, no fluent interfaces anymore from me, only objects and decorators.</p></p><nav class="buttons notranslate desktop-only"> <a href="http://www.facebook.com/sharer/sharer.php?u=https://www.yegor256.com/2018/03/13/fluent-interfaces.html" title="Share on Facebook" class="button" rel="nofollow"> <span class="count count-facebook">0</span> <i class="icon icon-facebook notranslate" aria-hidden="true"></i> </a> <a href="https://twitter.com/share?url=https://www.yegor256.com/2018/03/13/fluent-interfaces.html&amp;text=Fluent+Interfaces+Are+Bad+for+Maintainability" title="Share on Twitter" class="button" rel="nofollow"> <span class="count count-twitter">0</span> <i class="icon icon-twitter notranslate" aria-hidden="true"></i> </a> <a href="https://plus.google.com/share?url=https://www.yegor256.com/2018/03/13/fluent-interfaces.html" title="Share on Google+" class="button" rel="nofollow"> <span class="count count-googleplus">0</span> <i class="icon icon-googleplus notranslate" aria-hidden="true"></i> </a> <a href="https://www.linkedin.com/cws/share?url=https://www.yegor256.com/2018/03/13/fluent-interfaces.html" title="Share on LinkedIn" class="button" rel="nofollow"> <span class="count count-linkedin">0</span> <i class="icon icon-linkedin notranslate" aria-hidden="true"></i> </a> <a href="http://reddit.com/submit?url=https://www.yegor256.com/2018/03/13/fluent-interfaces.html%3F2018-10&amp;title=Fluent+Interfaces+Are+Bad+for+Maintainability" title="Share on Reddit" class="button" rel="nofollow"> <span class="count count-reddit">0</span> <i class="icon icon-reddit notranslate" aria-hidden="true"></i> </a> <a href="http://news.ycombinator.com/submitlink?u=https://www.yegor256.com/2018/03/13/fluent-interfaces.html%3F2018-10&amp;t=Fluent+Interfaces+Are+Bad+for+Maintainability" title="Share on Hacker News" class="button" rel="nofollow"> <span class="count count-hackernews">0</span> <i class="icon icon-hackernews notranslate" aria-hidden="true"></i> </a> </nav> </header> <article class="main" itemprop="articleBody"><div ><p><a href="https://en.wikipedia.org/wiki/Fluent_interface">Fluent interface</a>, first <a href="https://martinfowler.com/bliki/FluentInterface.html">coined</a> as a term by Martin Fowler, is a very convenient way of communicating with objects in OOP. It makes their facades easier to use and understand. However, it ruins their internal design, making them more difficult to maintain. A few words were said about that by Marco Pivetta in his blog post <a href="https://ocramius.github.io/blog/fluent-interfaces-are-evil/">Fluent Interfaces are Evil</a>; now I will add my few cents.</p><figure class='jb_picture'><img itemprop='image' alt='Donnie Brasco (1997) by Mike Newell' src='/images/2018/03/donnie-brasco.jpg' longdesc='#bda17a6d'/><figcaption id='bda17a6d'>Donnie Brasco (1997) by Mike Newell</figcaption></figure><p>Let&#39;s take my own library <a href="http://http.jcabi.com/">jcabi-http</a>, which I created a few years ago, when I thought that fluent interfaces were a good thing. Here is how you use the library to make an HTTP request and validate its output:</p><figure class="highlight"><pre><code class="language-java" data-lang="java"><span></span><span class="n">String</span> <span class="n">html</span> <span class="o">=</span> <span class="k">new</span> <span class="n">JdkRequest</span><span class="o">(</span><span class="s">&quot;https://www.google.com&quot;</span><span class="o">)</span>
  <span class="o">.</span><span class="na">method</span><span class="o">(</span><span class="s">&quot;GET&quot;</span><span class="o">)</span>
  <span class="o">.</span><span class="na">fetch</span><span class="o">()</span>
  <span class="o">.</span><span class="na">as</span><span class="o">(</span><span class="n">RestResponse</span><span class="o">.</span><span class="na">class</span><span class="o">)</span>
  <span class="o">.</span><span class="na">assertStatus</span><span class="o">(</span><span class="mi">200</span><span class="o">)</span>
  <span class="o">.</span><span class="na">body</span><span class="o">();</span></code></pre></figure><p>This convenient <a href="https://en.wikipedia.org/wiki/Method_chaining">method chaining</a> makes the code short and obvious, right? Yes, it does, on the surface. But the <em>internal</em> design of the library&#39;s classes, including <a href="http://static.javadoc.io/com.jcabi/jcabi-http/1.17.2/com/jcabi/http/request/JdkRequest.html"><code>JdkRequest</code></a>, which is the one you see, is very far from being elegant. The biggest problem is that they are rather big and it&#39;s <del>difficult</del> impossible to extend them without making them even bigger.</p><aside class='youtube'> <a href='https://www.youtube.com/watch?v=REj8pJesMVI'><div class='box'> <img src='https://i.ytimg.com/vi/REj8pJesMVI/mqdefault.jpg' alt='YouTube video #REj8pJesMVI'/><div class='play'><i class='icon icon-play'></i></div></div></a><div>The Alternative to Fluent Interfaces in Java (webinar #33); 4 April 2018.</div></aside><p>For example, right now <a href="http://static.javadoc.io/com.jcabi/jcabi-http/1.17.2/com/jcabi/http/request/JdkRequest.html"><code>JdkRequest</code></a> has the methods <a href="http://static.javadoc.io/com.jcabi/jcabi-http/1.17.2/com/jcabi/http/Request.html#method%28java.lang.String%29"><code>method()</code></a>, <a href="http://static.javadoc.io/com.jcabi/jcabi-http/1.17.2/com/jcabi/http/Request.html#fetch%28%29"><code>fetch()</code></a>, and a few others. What happens when new functionality is required? The only way to add to it would be to make the class bigger, by adding new methods, which is how we jeopardize its maintainability. <a href="https://github.com/jcabi/jcabi-http/pull/142/files">Here</a>, for example, we added <a href="http://static.javadoc.io/com.jcabi/jcabi-http/1.17.2/com/jcabi/http/Request.html#multipartBody%28%29"><code>multipartBody()</code></a> and <a href="https://github.com/jcabi/jcabi-http/pull/99/files">here</a> we added <a href="http://static.javadoc.io/com.jcabi/jcabi-http/1.17.2/com/jcabi/http/Request.html#timeout%28int,%20int%29">timeout()</a>.</p><p>I always feel scared when I get a new feature request in jcabi-http. I understand that it most probably means adding new methods to <a href="http://static.javadoc.io/com.jcabi/jcabi-http/1.17.2/com/jcabi/http/Request.html"><code>Request</code></a>, <a href="http://static.javadoc.io/com.jcabi/jcabi-http/1.17.2/com/jcabi/http/Response.html"><code>Response</code></a>, and other already bloated interfaces and classes.</p><p>I actually tried to do something in the library in order to solve this problem but it wasn&#39;t easy. Look at this <a href="http://static.javadoc.io/com.jcabi/jcabi-http/1.17.2/com/jcabi/http/Response.html#as%28java.lang.Class%29"><code>.as(RestResponse.class)</code></a> method call. What it does is decorate a <code>Response</code> with <a href="http://static.javadoc.io/com.jcabi/jcabi-http/1.17.2/com/jcabi/http/response/RestResponse.html"><code>RestResponse</code></a>, in order to make it method-richer. I just didn&#39;t want to make <a href="http://static.javadoc.io/com.jcabi/jcabi-http/1.17.2/com/jcabi/http/Response.html"><code>Response</code></a> contain 50+ methods, like many other libraries do. Here is what it does (this is pseudo-code):</p><figure class="highlight"><pre><code class="language-text" data-lang="text"><span></span>class Response {
  RestResponse as() {
    return new RestResponse(this);
  }
  // Seven methods
}
class RestResponse implements Response {
  private final Response origin;
  // Original seven methods from Response
  // Additional 14 methods
}</code></pre></figure><p>As you see, instead of adding all possible methods to <code>Response</code> I placed them in supplementary decorators <a href="http://static.javadoc.io/com.jcabi/jcabi-http/1.17.2/com/jcabi/http/response/RestResponse.html"><code>RestResponse</code></a>, <a href="http://static.javadoc.io/com.jcabi/jcabi-http/1.17.2/com/jcabi/http/response/JsonResponse.html"><code>JsonResponse</code></a>, <a href="http://static.javadoc.io/com.jcabi/jcabi-http/1.17.2/com/jcabi/http/response/JsonResponse.html"><code>XmlResponse</code></a>, and <a href="http://static.javadoc.io/com.jcabi/jcabi-http/1.17.2/com/jcabi/http/response/package-frame.html">others</a>. It helps, but in order to write these decorators with the central object of type <code>Response</code> we have to use that &quot;ugly&quot; method <a href="http://static.javadoc.io/com.jcabi/jcabi-http/1.17.2/com/jcabi/http/Response.html#as%28java.lang.Class%29"><code>as()</code></a>, which depends heavily on Reflection and <a href="/2015/04/02/class-casting-is-anti-pattern.html">type casting</a>.</p><aside class='quote'>Fluent interfaces mean large classes or some ugly workarounds.</aside><p>In other words, fluent interfaces mean large classes or some ugly workarounds. I mentioned this problem earlier, when I <a href="/2017/10/10/streams-vs-decorators.html">wrote</a> about <a href="http://www.oracle.com/technetwork/articles/java/ma14-java-se-8-streams-2177646.html">Streams API</a> and the interface <a href="https://docs.oracle.com/javase/8/docs/api/java/util/stream/Stream.html">Stream</a>, which is perfectly fluent. There are 43 methods!</p><p>That is the biggest problem with fluent interfaces---they <em>force</em> objects to be huge.</p><p>Fluent interfaces are perfect for their users, since all methods are in one place and the amount of classes is very small. It is easy to use them, especially with <a href="https://www.jetbrains.com/help/idea/auto-completing-code.html">code auto-completion</a> in most IDEs. They also make client code more readable, since &quot;fluent&quot; constructs look similar to plain English (aka <a href="https://en.wikipedia.org/wiki/Domain-specific_language">DSL</a>).</p><p>That is all true! However, the damage they cause to object design is the price, which is too high.</p><p>What is the alternative?</p><p>I would recommend you use decorators and <a href="/2016/04/26/why-inputstream-design-is-wrong.html">smart objects</a> instead. Here is how I would design jcabi-http, if I could do it now:</p><figure class="highlight"><pre><code class="language-java" data-lang="java"><span></span><span class="n">String</span> <span class="n">html</span> <span class="o">=</span> <span class="k">new</span> <span class="n">BodyOfResponse</span><span class="o">(</span>
  <span class="k">new</span> <span class="n">ResponseAssertStatus</span><span class="o">(</span>
    <span class="k">new</span> <span class="n">RequestWithMethod</span><span class="o">(</span>
      <span class="k">new</span> <span class="n">JdkRequest</span><span class="o">(</span><span class="s">&quot;https://www.google.com&quot;</span><span class="o">),</span>
      <span class="s">&quot;GET&quot;</span>
    <span class="o">),</span>
    <span class="mi">200</span>
  <span class="o">)</span>
<span class="o">).</span><span class="na">toString</span><span class="o">();</span></code></pre></figure><p>This is the same code as in the first snippet above, but it is much more object-oriented. The obvious problem with this code, of course, is that the IDE won&#39;t be able to auto-complete almost anything. Also, we will have to remember many of the names of the classes. And the construct looks rather difficult to read for those who are used to fluent interfaces. In addition, it&#39;s very far away from the DSL idea.</p><aside class='quote'>Fluent interfaces are good for users, but bad for developers. Small objects are good for developers, but difficult to use.</aside><p>But here is the list of benefits. First, each object is small, very cohesive and they are all loosely coupled---which are obvious merits in OOP. Second, adding new functionality to the library is as easy as creating a new class; no need to touch existing classes. Third, unit testing is simplified, since classes are small. Fourth, all classes can be immutable, which is also an <a href="/2014/06/09/objects-should-be-immutable.html">obvious merit</a> in OOP.</p><p>Thus, there seems to be a conflict between usefulness and maintainability. Fluent interfaces are good for users, but bad for library developers. Small objects are good for developers, but difficult to understand and use.</p><p>It seems to be so, but only if you are used to large classes and procedural programming. To me, a large amount of small classes seems to be an <a href="/2017/02/28/too-many-classes.html">advantage</a>, not a drawback. Libraries that are clear, simple, and readable inside are much easier to use, even when I don&#39;t know exactly which classes out there are the most suitable for me. Even without the code-auto-complete I can figure it out myself, because the code is clean.</p><p>Also, I very often find myself interested in extending existing functionality either inside my code base or via a pull request to the library. I am much more <a href="/2015/12/22/why-dont-you-contribute-to-open-source.html">interested</a> to do that if I know that the changes I introduce are isolated and easy to test.</p><p>Thus, no fluent interfaces anymore from me, only objects and decorators.</p></div></article></div><div class="wrapper"> <related-posts /></div><div class="disqus" role="complementary"><p class="disqus_hint"> Please, use <a href="https://help.disqus.com/commenting/what-html-tags-are-allowed-within-comments">syntax highlighting</a> in your comments, to make them more readable.</p><div id="disqus_thread" class="disqus-thread"> <a>&nbsp;</a></div><script> var disqus_config = function () { this.page.url = document.location.href.split('?')[0].split('#')[0].replace('https://', 'http://'); this.page.identifier = this.page.url; }; (function() { var d = document, s = d.createElement('script'); s.src = '//yegor256.disqus.com/embed.js'; s.setAttribute('data-timestamp', +new Date()); (d.head || d.body).appendChild(s); })(); </script> <noscript><div><p class="red"> JavaScript is disabled in your browser, that's why you can't see comments under this post.</p></div></noscript></div><div class="wrapper"> <footer class="footer"><p> &copy; <span itemscope="" itemprop="copyrightHolder" itemtype="http://schema.org/Person"> <span itemprop="name">Yegor Bugayenko</span> </span> 2014&ndash;<span itemprop="copyrightYear">2018</span></p></footer></div></section><div class="wrapper unprintable" style="text-align:center;margin-top:2em;"> <a href="http://www.sixnines.io/h/3ba1652f"> <img src="//www.sixnines.io/b/3ba1652f?style=flat" alt="sixnines availability badge"/> </a></div><script src="//code.jquery.com/jquery-1.9.0.min.js"></script> <script src="/js/all.js?a0e0d018c07"></script> <script>var disqus_shortname = 'yegor256';</script> <script id="dsq-count-scr" src="//yegor256.disqus.com/count.js" async="async"></script> <script> (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){ (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o), m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m) })(window,document,'script','//www.google-analytics.com/analytics.js','ga'); ga('create', 'UA-1963507-32', 'auto'); ga('send', 'pageview'); </script> <script> Cd=document;Cr="&"+Math.random();Cp="&s=1"; Cd.cookie="b=b";if(Cd.cookie)Cp+="&c=1"; Cp+="&t="+(new Date()).getTimezoneOffset(); if(self!=top)Cp+="&f=1"; </script> <script> if(navigator.javaEnabled())Cp+="&j=1"; </script> <script> if(typeof(screen)!='undefined')Cp+="&w="+screen.width+"&h="+ screen.height+"&d="+(screen.colorDepth?screen.colorDepth:screen.pixelDepth); </script> <script> Cd.write("<img src='//c.hit.ua/hit?i=95870&g=0&x=2"+Cp+Cr+ "&r="+escape(Cd.referrer)+"&u="+escape(window.location.href)+ "' border='0' wi"+"dth='1' he"+"ight='1'/>"); </script> <script type="application/ld+json"> { "@context": "http://schema.org", "@type": "Person", "name": "Yegor Bugayenko", "url": "http://www.yegor256.com", "sameAs": [ "https://www.facebook.com/yegor256", "https://instagram.com/yegor256", "https://www.linkedin.com/in/yegor256", "https://twitter.com/yegor256", "https://github.com/yegor256", "https://www.pinterest.com/yegor256/" ] } </script> </body> </html> <!DOCTYPE html> <html xmlns="http://www.w3.org/1999/xhtml" lang="en-US" xml:lang="en-US" itemscope="" itemtype="http://schema.org/WebSite"> <head> <meta charset="utf-8"/> <meta name="description" content="When project scope is perfectly decomposed and management rules are clear and strict, the speed of delivery is a virtue, not the quality. " /> <meta name="keywords" content="perfection vs speed, quality vs speed, speed is king, speed or perfection, speed vs quality" /> <meta name="viewport" content="width=device-width,minimum-scale=1,initial-scale=1"/> <meta name="google-site-verification" content="JEj_gQr2CPe2QKGw8XdMz0R7VboQIUbX3FlM-lwTq-8" /> <meta name="author" content="Yegor Bugayenko"> <meta name="article:published_time" content="2018-02-27 00:00:00 +0000"> <meta name="og:site_name" content="Yegor Bugayenko"/> <meta name="og:type" content="article" /> <meta name="og:locale" content="en_US" /> <meta name="twitter:account_id" content="4503599630178231" /> <meta name="twitter:creator" content="@yegor256"/> <meta name="twitter:site" content="@yegor256"/> <meta name="twitter:title" property="og:title" content="Don't Parse, Use Parsing Objects"/> <meta name="twitter:description" property="og:description" content="When project scope is perfectly decomposed and management rules are clear and strict, the speed of delivery is a virtue, not the quality. "/> <meta name="twitter:url" property="og:url" content="https://www.yegor256.com/2018/02/27/parsing-objects.html"/> <meta name="telegram:channel" content="AAAAAEJFMRzsRTRxM3ec6A"/> <link rel="search" type="application/opensearchdescription+xml" href="/opensearch.xml" title="yegor256" /> <link rel="shortcut icon" href="/favicon.ico?a0e0d018c07"/> <link rel="apple-touch-icon" href="/favicon.ico?a0e0d018c07"/> <link rel="alternate" type="application/rss+xml" title="RSS for yegor256.com" href="https://www.yegor256.com/rss.xml"/> <link rel="stylesheet" href="/css/layout.css?a0e0d018c07"/> <link rel="stylesheet" href="/css/icons.css?a0e0d018c07"/> <link rel="canonical" href="https://www.yegor256.com/2018/02/27/parsing-objects.html" /> <link rel="amphtml" href="https://www.yegor256.com/2018/02/27/parsing-objects.amp.html" /> <title>Don't Parse, Use Parsing Objects </title> <meta name='og:image' content='https://www.yegor256.com/images/2018/02/la-science-des-reves.jpg'/><meta name='twitter:image' content='https://www.yegor256.com/images/2018/02/la-science-des-reves.jpg'/><meta name='og:image:width' content='1600'/> <meta name='twitter:image:width' content='1600'/><meta name='og:image:height' content='900'/> <meta name='twitter:image:height' content='900'/><meta name='twitter:card' content='summary_large_image'/><meta name='twitter:image:alt' content='La science des rêves (2006) by Michel Gondry'/> </head> <body><div class="wrapper"> <aside class="header-toggle unprintable" id="header-toggle" title="Show the menu" onclick="$('#header').show();$('#header-toggle').hide();">&#9776;</aside> <header class="header" id="header"><div class="face"> <a href="/about-me.html#form" class="sub" title="Click to subscribe to my monthly newsletter"><span>Subscribe</span></a> <a href="/about-me.html" style="position:relative;"> <img src="/images/face-256x256.jpg" class="photo" alt="Yegor Bugayenko"/> </a></div><nav><ul class="menu social notranslate"> <li><a href="https://twitter.com/intent/follow?screen_name=yegor256" rel="nofollow" title="Follow me on Twitter"><i class="icon icon-twitter notranslate" aria-hidden="true"></i></a></li> <li><a href="/rss.xml" rel="nofollow" title="Subscribe to my RSS feed"><i class="icon icon-rss notranslate" aria-hidden="true"></i></a></li> <li><a itemprop="sameAs" href="https://github.com/yegor256" rel="nofollow" title="My GitHub profile"><i class="icon icon-github notranslate" aria-hidden="true"></i></a></li> <li><a itemprop="sameAs" href="http://stackoverflow.com/users/187141/yegor256" rel="nofollow" title="My StackOverflow profile"><i class="icon icon-stackoverflow notranslate" aria-hidden="true"></i></a></li> <li><a itemprop="sameAs" href="https://www.facebook.com/yegor256" rel="nofollow" title="Follow me on Facebook"><i class="icon icon-facebook notranslate" aria-hidden="true"></i></a></li> <li><a itemprop="sameAs" href="https://instagram.com/yegor256" rel="nofollow" title="Follow me on Instagram"><i class="icon icon-instagram notranslate" aria-hidden="true"></i></a></li> <li><a itemprop="sameAs" href="https://www.linkedin.com/in/yegor256" rel="nofollow" title="My LinkedIn profile"><i class="icon icon-linkedin notranslate" aria-hidden="true"></i></a></li> <li><a itemprop="sameAs" href="https://www.youtube.com/c/yegor256?sub_confirmation=1" rel="nofollow" title="My Youtube video channel"><i class="icon icon-youtube notranslate" aria-hidden="true"></i></a></li> <li><a itemprop="sameAs" href="https://www.pinterest.com/yegor256/" rel="nofollow" title="My Pinterest boards"><i class="icon icon-pinterest notranslate" aria-hidden="true"></i></a></li> <li><a itemprop="sameAs" href="https://angel.co/yegor256" rel="nofollow" title="My AngelList profile"><i class="icon icon-angellist notranslate" aria-hidden="true"></i></a></li> <li><a href="https://soundcloud.com/yegor256" rel="nofollow" title="My podcast"><i class="icon icon-podcast notranslate" aria-hidden="true"></i></a></li> <li><a href="https://itunes.apple.com/us/podcast/yegor256-podcast/id1150826721" rel="nofollow" title="My iTunes podcast"><i class="icon icon-itunes notranslate" aria-hidden="true"></i></a></li> <li><a href="https://t.me/joinchat/AAAAAEJFMRzsRTRxM3ec6A" rel="nofollow" title="My Telegram public channel"><i class="icon icon-telegram notranslate" aria-hidden="true"></i></a></li> <li><a href="mailto:blog@yegor256.com" rel="nofollow" title="Email me any time"><i class="icon icon-mail notranslate" aria-hidden="true"></i></a></li></ul><ul class="menu"> <li><a href="/" title="Home page">Home</a></li> <li ><a href="/best.html" title="Best articles to read">12&#160;Best</a></li> <li ><a href="/contents.html" title="The contents of the entire blog">All&#160;288</a></li> <li ><a href="/webinars.html" title="My webinars">Webinars</a></li> <li ><a href="/talks.html" title="Future and past conference talks">Talks</a></li> <li ><a href="/books.html" title="The books I wrote">Books</a></li> <li ><a href="/papers.html" title="My academic papers and patents">Papers</a></li> <li ><a href="/pets.html" title="My loved pet projects">Pets</a></li> <li ><a href="/award.html" title="Software quality award">Award</a></li> <li ><a href="/testimonials.html" title="What some people say about me">Testimonials</a></li> <li ><a href="/shift-m.html" title="Audio podcast about project management">Shift-M</a></li> <li ><a href="/paintings.html" title="My paintings for sale">Paintings</a></li> <li><a href="http://ru.yegor256.com/" title="Немного на русском языке">По-русски</a></li></ul></nav><div class="search"> <form method="get" action="https://www.google.com/search" itemprop="potentialAction" itemscope="" itemtype="http://schema.org/SearchAction"> <meta itemprop="target" content="https://www.google.com/search?q={q}"/> <input name="sitesearch" value="yegor256.com" type="hidden"/> <input itemprop="query-input" type="text" id="search-query" class="field field-text" required="required" onfocus="$('.google').css('visibility', 'visible');" name="q" placeholder="Search..." autocomplete="off"/> <input type="image" src="/images/google-search-icon.svg" class="google" title="Search via Google" alt="Search via Google"/> </form></div><div class="hot"><ul> <li> <a href="/code-ahead.html">Code Ahead</a> was published on Amazon just a few days ago! It is my new book, a novel about programmers. It explains in details the majority of ideas that stand behind <a href="https://www.zerocracy.com">Zerocracy</a> and <a href="https://www.xdsd.org">XDSD</a>. </li> <li> At <a href="/webinars.html">Webinar #37</a> we will discuss naming problem in OOP, for objects, methods and attributes; join us on <b>September 12</b>, at 11am PST. </li></ul></div></header></div><section itemscope="" itemtype="http://schema.org/BlogPosting"><div class="wrapper"> <header><p class="printable"> <img src="https://api.qrserver.com/v1/create-qr-code/?data=https://www.yegor256.com/2018/02/27/parsing-objects.html&amp;format=svg" style="width:125px;height:125px;" alt="QR code"/></p><p class="printable"> <code itemprop="url">https://www.yegor256.com/2018/02/27/parsing-objects.html</code></p><h1 itemprop="name headline mainEntityOfPage">Don't Parse, Use Parsing Objects</h1><ul class="subline"> <li> <time itemprop="datePublished" datetime="2018-02-27T00:00:00+00:00"> 27 February 2018 </time> </li> <li class="desktop-only" itemprop="locationCreated">Moscow, Russia</li> <li class="printable" itemscope="" itemprop="author" itemtype="http://schema.org/Person"> <span itemprop="name">Yegor Bugayenko</span> </li> <li class="unprintable"> <i class="icon icon-comments"></i> <a href="http://www.yegor256.com/2018/02/27/parsing-objects.html#disqus_thread" itemprop="discussionUrl">comments</a> </li></ul><p class="unprintable"><p>The traditional way of integrating object-oriented back-end with an external system is through <a href="/2016/07/06/data-transfer-object.html">data transfer objects</a>, which are serialized into JSON before going out and deserialized when coming back. This way is as much popular as it is wrong. The serialization part should be replaced by <a href="/2016/04/05/printers-instead-of-getters.html">printers</a>, which I explained earlier. Here is my take on deserialization, which should be done by---guess what---objects.</p><figure class='jb_picture'><img itemprop='image' alt='La science des rêves (2006) by Michel Gondry' src='/images/2018/02/la-science-des-reves.jpg' longdesc='#bad54f07'/><figcaption id='bad54f07'>La science des rêves (2006) by Michel Gondry</figcaption></figure><p>Say there is a back-end entry point, which is supposed to register a new book in the library, arriving in JSON:</p><figure class="highlight"><pre><code class="language-json" data-lang="json"><span></span><span class="p">{</span>
  <span class="nt">&quot;title&quot;</span><span class="p">:</span> <span class="s2">&quot;Object Thinking&quot;</span><span class="p">,</span>
  <span class="nt">&quot;isbn: &quot;</span><span class="mi">0735619654</span><span class="s2">&quot;,</span>
<span class="s2">  &quot;</span><span class="err">author</span><span class="p">:</span> <span class="s2">&quot;David West&quot;</span>
<span class="p">}</span></code></pre></figure><p>Also, there is an object of class <code>Library</code>, which expects an object of type <code>Book</code> to be given to its method <code>register()</code>:</p><figure class="highlight"><pre><code class="language-java" data-lang="java"><span></span><span class="kd">class</span> <span class="nc">Library</span> <span class="o">{</span>
  <span class="kd">public</span> <span class="kt">void</span> <span class="nf">register</span><span class="o">(</span><span class="n">Book</span> <span class="n">book</span><span class="o">)</span> <span class="o">{</span>
    <span class="c1">// Create a new record in the database</span>
  <span class="o">}</span>
<span class="o">}</span></code></pre></figure><p>Say also, type <code>Book</code> has a simple method <code>isbn()</code>:</p><figure class="highlight"><pre><code class="language-java" data-lang="java"><span></span><span class="kd">interface</span> <span class="nc">Book</span> <span class="o">{</span>
  <span class="n">String</span> <span class="nf">isbn</span><span class="o">();</span>
<span class="o">}</span></code></pre></figure><p>Now, here is the HTTP entry point (I&#39;m using <a href="/2015/03/22/takes-java-web-framework.html">Takes</a> and <a href="/2017/06/22/object-oriented-input-output-in-cactoos.html">Cactoos</a>), which is accepting a POST <a href="https://www.ietf.org/rfc/rfc2045.txt"><code>multipart/form-data</code></a> request and registering the book in the library:</p><figure class="highlight"><pre><code class="language-java" data-lang="java"><span></span><span class="kd">public</span> <span class="kd">class</span> <span class="nc">TkUpload</span> <span class="kd">implements</span> <span class="n">Take</span> <span class="o">{</span>
  <span class="kd">private</span> <span class="kd">final</span> <span class="n">Library</span> <span class="n">library</span><span class="o">;</span>
  <span class="nd">@Override</span>
  <span class="kd">public</span> <span class="n">Response</span> <span class="nf">act</span><span class="o">(</span><span class="n">Request</span> <span class="n">req</span><span class="o">)</span> <span class="o">{</span>
    <span class="n">String</span> <span class="n">body</span> <span class="o">=</span> <span class="k">new</span> <span class="n">RqPrint</span><span class="o">(</span>
      <span class="k">new</span> <span class="n">RqMtSmart</span><span class="o">(</span><span class="k">new</span> <span class="n">RqMtBase</span><span class="o">(</span><span class="n">req</span><span class="o">)).</span><span class="na">single</span><span class="o">(</span><span class="s">&quot;book&quot;</span><span class="o">)</span>
    <span class="o">).</span><span class="na">printBody</span><span class="o">();</span>
    <span class="n">JsonObject</span> <span class="n">json</span> <span class="o">=</span> <span class="n">Json</span><span class="o">.</span><span class="na">createReader</span><span class="o">(</span>
      <span class="k">new</span> <span class="n">InputStreamOf</span><span class="o">(</span><span class="n">body</span><span class="o">)</span>
    <span class="o">).</span><span class="na">readObject</span><span class="o">();</span>
    <span class="n">Book</span> <span class="n">book</span> <span class="o">=</span> <span class="k">new</span> <span class="n">BookDTO</span><span class="o">();</span>
    <span class="n">book</span><span class="o">.</span><span class="na">setIsbn</span><span class="o">(</span><span class="n">json</span><span class="o">.</span><span class="na">getString</span><span class="o">(</span><span class="s">&quot;isbn&quot;</span><span class="o">));</span>
    <span class="n">library</span><span class="o">.</span><span class="na">register</span><span class="o">(</span><span class="n">book</span><span class="o">);</span>
  <span class="o">}</span>
<span class="o">}</span></code></pre></figure><p>What is wrong with this? Well, a few things.</p><p>First, it&#39;s not reusable. If we were to need something similar in a different place, we would have to write this HTTP processing and JSON parsing again.</p><p>Second, error handling and <a href="/2018/05/29/object-validation.html">validation</a> are not reusable either. If we add it to the method above, we will have to copy it everywhere. Of course, the DTO may encapsulate it, but that&#39;s not what DTOs are usually for.</p><p>Third, the code above is rather procedural and has a lot of <a href="/2015/12/08/temporal-coupling-between-method-calls.html">temporal coupling</a>.</p><p>A better design would be to hide this parsing inside a new class <code>JsonBook</code>:</p><figure class="highlight"><pre><code class="language-java" data-lang="java"><span></span><span class="kd">class</span> <span class="nc">JsonBook</span> <span class="kd">implements</span> <span class="n">Book</span> <span class="o">{</span>
  <span class="kd">private</span> <span class="kd">final</span> <span class="n">String</span> <span class="n">json</span><span class="o">;</span>
  <span class="n">JsonBook</span><span class="o">(</span><span class="n">String</span> <span class="n">body</span><span class="o">)</span> <span class="o">{</span>
    <span class="k">this</span><span class="o">.</span><span class="na">json</span> <span class="o">=</span> <span class="n">body</span><span class="o">;</span>
  <span class="o">}</span>
  <span class="nd">@Override</span>
  <span class="kd">public</span> <span class="n">String</span> <span class="nf">isbn</span><span class="o">()</span> <span class="o">{</span>
    <span class="k">return</span> <span class="n">Json</span><span class="o">.</span><span class="na">createReader</span><span class="o">(</span>
      <span class="k">new</span> <span class="n">InputStreamOf</span><span class="o">(</span><span class="n">body</span><span class="o">)</span>
    <span class="o">).</span><span class="na">readObject</span><span class="o">().</span><span class="na">getString</span><span class="o">(</span><span class="s">&quot;isbn&quot;</span><span class="o">);</span>
  <span class="o">}</span>
<span class="o">}</span></code></pre></figure><p>Then, the RESTful entry point will look like this:</p><figure class="highlight"><pre><code class="language-java" data-lang="java"><span></span><span class="kd">public</span> <span class="kd">class</span> <span class="nc">TkUpload</span> <span class="kd">implements</span> <span class="n">Take</span> <span class="o">{</span>
  <span class="kd">private</span> <span class="kd">final</span> <span class="n">Library</span> <span class="n">library</span><span class="o">;</span>
  <span class="nd">@Override</span>
  <span class="kd">public</span> <span class="n">Response</span> <span class="nf">act</span><span class="o">(</span><span class="n">Request</span> <span class="n">req</span><span class="o">)</span> <span class="o">{</span>
    <span class="n">library</span><span class="o">.</span><span class="na">register</span><span class="o">(</span>
      <span class="k">new</span> <span class="n">JsonBook</span><span class="o">(</span>
        <span class="k">new</span> <span class="n">RqPrint</span><span class="o">(</span>
          <span class="k">new</span> <span class="n">RqMtSmart</span><span class="o">(</span>
            <span class="k">new</span> <span class="n">RqMtBase</span><span class="o">(</span><span class="n">req</span><span class="o">)</span>
          <span class="o">).</span><span class="na">single</span><span class="o">(</span><span class="s">&quot;book&quot;</span><span class="o">)</span>
        <span class="o">).</span><span class="na">printBody</span><span class="o">()</span>
      <span class="o">)</span>
    <span class="o">);</span>
  <span class="o">}</span>
<span class="o">}</span></code></pre></figure><p>Isn&#39;t that more elegant?</p><p>Here are some examples from my projects: <a href="https://github.com/zerocracy/farm/blob/0.21/src/main/java/com/zerocracy/tk/RqUser.java"><code>RqUser</code></a> from <a href="https://github.com/zerocracy/farm/">zerocracy/farm</a> and <a href="https://github.com/yegor256/jare/blob/0.11.2/src/main/java/io/jare/tk/RqUser.java"><code>RqUser</code></a> from <a href="https://github.com/yegor256/jare/blob/0.11.2/src/main/java/io/jare/tk/RqUser.java">yegor256/jare</a>.</p><p>As you can see from the examples above, sometimes we can&#39;t use <code>implements</code> because some primitives in Java are not interfaces but <code>final</code> classes: <code>String</code> is a &quot;perfect&quot; example. That&#39;s why I have to do this:</p><figure class="highlight"><pre><code class="language-java" data-lang="java"><span></span><span class="kd">class</span> <span class="nc">RqUser</span> <span class="kd">implements</span> <span class="n">Scalar</span><span class="o">&lt;</span><span class="n">String</span><span class="o">&gt;</span> <span class="o">{</span>
  <span class="nd">@Override</span>
  <span class="kd">public</span> <span class="n">String</span> <span class="nf">value</span><span class="o">()</span> <span class="o">{</span>
    <span class="c1">// Parsing happens here and returns String</span>
  <span class="o">}</span>
<span class="o">}</span></code></pre></figure><p>But aside from that, these examples perfectly demonstrate the principle of &quot;parsing objects&quot; suggested above.</p></p><nav class="buttons notranslate desktop-only"> <a href="http://www.facebook.com/sharer/sharer.php?u=https://www.yegor256.com/2018/02/27/parsing-objects.html" title="Share on Facebook" class="button" rel="nofollow"> <span class="count count-facebook">0</span> <i class="icon icon-facebook notranslate" aria-hidden="true"></i> </a> <a href="https://twitter.com/share?url=https://www.yegor256.com/2018/02/27/parsing-objects.html&amp;text=Don%27t+Parse%2C+Use+Parsing+Objects" title="Share on Twitter" class="button" rel="nofollow"> <span class="count count-twitter">0</span> <i class="icon icon-twitter notranslate" aria-hidden="true"></i> </a> <a href="https://plus.google.com/share?url=https://www.yegor256.com/2018/02/27/parsing-objects.html" title="Share on Google+" class="button" rel="nofollow"> <span class="count count-googleplus">0</span> <i class="icon icon-googleplus notranslate" aria-hidden="true"></i> </a> <a href="https://www.linkedin.com/cws/share?url=https://www.yegor256.com/2018/02/27/parsing-objects.html" title="Share on LinkedIn" class="button" rel="nofollow"> <span class="count count-linkedin">0</span> <i class="icon icon-linkedin notranslate" aria-hidden="true"></i> </a> <a href="http://reddit.com/submit?url=https://www.yegor256.com/2018/02/27/parsing-objects.html%3F2018-08&amp;title=Don%27t+Parse%2C+Use+Parsing+Objects" title="Share on Reddit" class="button" rel="nofollow"> <span class="count count-reddit">0</span> <i class="icon icon-reddit notranslate" aria-hidden="true"></i> </a> <a href="http://news.ycombinator.com/submitlink?u=https://www.yegor256.com/2018/02/27/parsing-objects.html%3F2018-08&amp;t=Don%27t+Parse%2C+Use+Parsing+Objects" title="Share on Hacker News" class="button" rel="nofollow"> <span class="count count-hackernews">0</span> <i class="icon icon-hackernews notranslate" aria-hidden="true"></i> </a> </nav> </header> <article class="main" itemprop="articleBody"><div ><p>The traditional way of integrating object-oriented back-end with an external system is through <a href="/2016/07/06/data-transfer-object.html">data transfer objects</a>, which are serialized into JSON before going out and deserialized when coming back. This way is as much popular as it is wrong. The serialization part should be replaced by <a href="/2016/04/05/printers-instead-of-getters.html">printers</a>, which I explained earlier. Here is my take on deserialization, which should be done by---guess what---objects.</p><figure class='jb_picture'><img itemprop='image' alt='La science des rêves (2006) by Michel Gondry' src='/images/2018/02/la-science-des-reves.jpg' longdesc='#bad54f07'/><figcaption id='bad54f07'>La science des rêves (2006) by Michel Gondry</figcaption></figure><p>Say there is a back-end entry point, which is supposed to register a new book in the library, arriving in JSON:</p><figure class="highlight"><pre><code class="language-json" data-lang="json"><span></span><span class="p">{</span>
  <span class="nt">&quot;title&quot;</span><span class="p">:</span> <span class="s2">&quot;Object Thinking&quot;</span><span class="p">,</span>
  <span class="nt">&quot;isbn: &quot;</span><span class="mi">0735619654</span><span class="s2">&quot;,</span>
<span class="s2">  &quot;</span><span class="err">author</span><span class="p">:</span> <span class="s2">&quot;David West&quot;</span>
<span class="p">}</span></code></pre></figure><p>Also, there is an object of class <code>Library</code>, which expects an object of type <code>Book</code> to be given to its method <code>register()</code>:</p><figure class="highlight"><pre><code class="language-java" data-lang="java"><span></span><span class="kd">class</span> <span class="nc">Library</span> <span class="o">{</span>
  <span class="kd">public</span> <span class="kt">void</span> <span class="nf">register</span><span class="o">(</span><span class="n">Book</span> <span class="n">book</span><span class="o">)</span> <span class="o">{</span>
    <span class="c1">// Create a new record in the database</span>
  <span class="o">}</span>
<span class="o">}</span></code></pre></figure><p>Say also, type <code>Book</code> has a simple method <code>isbn()</code>:</p><figure class="highlight"><pre><code class="language-java" data-lang="java"><span></span><span class="kd">interface</span> <span class="nc">Book</span> <span class="o">{</span>
  <span class="n">String</span> <span class="nf">isbn</span><span class="o">();</span>
<span class="o">}</span></code></pre></figure><p>Now, here is the HTTP entry point (I&#39;m using <a href="/2015/03/22/takes-java-web-framework.html">Takes</a> and <a href="/2017/06/22/object-oriented-input-output-in-cactoos.html">Cactoos</a>), which is accepting a POST <a href="https://www.ietf.org/rfc/rfc2045.txt"><code>multipart/form-data</code></a> request and registering the book in the library:</p><figure class="highlight"><pre><code class="language-java" data-lang="java"><span></span><span class="kd">public</span> <span class="kd">class</span> <span class="nc">TkUpload</span> <span class="kd">implements</span> <span class="n">Take</span> <span class="o">{</span>
  <span class="kd">private</span> <span class="kd">final</span> <span class="n">Library</span> <span class="n">library</span><span class="o">;</span>
  <span class="nd">@Override</span>
  <span class="kd">public</span> <span class="n">Response</span> <span class="nf">act</span><span class="o">(</span><span class="n">Request</span> <span class="n">req</span><span class="o">)</span> <span class="o">{</span>
    <span class="n">String</span> <span class="n">body</span> <span class="o">=</span> <span class="k">new</span> <span class="n">RqPrint</span><span class="o">(</span>
      <span class="k">new</span> <span class="n">RqMtSmart</span><span class="o">(</span><span class="k">new</span> <span class="n">RqMtBase</span><span class="o">(</span><span class="n">req</span><span class="o">)).</span><span class="na">single</span><span class="o">(</span><span class="s">&quot;book&quot;</span><span class="o">)</span>
    <span class="o">).</span><span class="na">printBody</span><span class="o">();</span>
    <span class="n">JsonObject</span> <span class="n">json</span> <span class="o">=</span> <span class="n">Json</span><span class="o">.</span><span class="na">createReader</span><span class="o">(</span>
      <span class="k">new</span> <span class="n">InputStreamOf</span><span class="o">(</span><span class="n">body</span><span class="o">)</span>
    <span class="o">).</span><span class="na">readObject</span><span class="o">();</span>
    <span class="n">Book</span> <span class="n">book</span> <span class="o">=</span> <span class="k">new</span> <span class="n">BookDTO</span><span class="o">();</span>
    <span class="n">book</span><span class="o">.</span><span class="na">setIsbn</span><span class="o">(</span><span class="n">json</span><span class="o">.</span><span class="na">getString</span><span class="o">(</span><span class="s">&quot;isbn&quot;</span><span class="o">));</span>
    <span class="n">library</span><span class="o">.</span><span class="na">register</span><span class="o">(</span><span class="n">book</span><span class="o">);</span>
  <span class="o">}</span>
<span class="o">}</span></code></pre></figure><p>What is wrong with this? Well, a few things.</p><p>First, it&#39;s not reusable. If we were to need something similar in a different place, we would have to write this HTTP processing and JSON parsing again.</p><p>Second, error handling and <a href="/2018/05/29/object-validation.html">validation</a> are not reusable either. If we add it to the method above, we will have to copy it everywhere. Of course, the DTO may encapsulate it, but that&#39;s not what DTOs are usually for.</p><p>Third, the code above is rather procedural and has a lot of <a href="/2015/12/08/temporal-coupling-between-method-calls.html">temporal coupling</a>.</p><p>A better design would be to hide this parsing inside a new class <code>JsonBook</code>:</p><figure class="highlight"><pre><code class="language-java" data-lang="java"><span></span><span class="kd">class</span> <span class="nc">JsonBook</span> <span class="kd">implements</span> <span class="n">Book</span> <span class="o">{</span>
  <span class="kd">private</span> <span class="kd">final</span> <span class="n">String</span> <span class="n">json</span><span class="o">;</span>
  <span class="n">JsonBook</span><span class="o">(</span><span class="n">String</span> <span class="n">body</span><span class="o">)</span> <span class="o">{</span>
    <span class="k">this</span><span class="o">.</span><span class="na">json</span> <span class="o">=</span> <span class="n">body</span><span class="o">;</span>
  <span class="o">}</span>
  <span class="nd">@Override</span>
  <span class="kd">public</span> <span class="n">String</span> <span class="nf">isbn</span><span class="o">()</span> <span class="o">{</span>
    <span class="k">return</span> <span class="n">Json</span><span class="o">.</span><span class="na">createReader</span><span class="o">(</span>
      <span class="k">new</span> <span class="n">InputStreamOf</span><span class="o">(</span><span class="n">body</span><span class="o">)</span>
    <span class="o">).</span><span class="na">readObject</span><span class="o">().</span><span class="na">getString</span><span class="o">(</span><span class="s">&quot;isbn&quot;</span><span class="o">);</span>
  <span class="o">}</span>
<span class="o">}</span></code></pre></figure><p>Then, the RESTful entry point will look like this:</p><figure class="highlight"><pre><code class="language-java" data-lang="java"><span></span><span class="kd">public</span> <span class="kd">class</span> <span class="nc">TkUpload</span> <span class="kd">implements</span> <span class="n">Take</span> <span class="o">{</span>
  <span class="kd">private</span> <span class="kd">final</span> <span class="n">Library</span> <span class="n">library</span><span class="o">;</span>
  <span class="nd">@Override</span>
  <span class="kd">public</span> <span class="n">Response</span> <span class="nf">act</span><span class="o">(</span><span class="n">Request</span> <span class="n">req</span><span class="o">)</span> <span class="o">{</span>
    <span class="n">library</span><span class="o">.</span><span class="na">register</span><span class="o">(</span>
      <span class="k">new</span> <span class="n">JsonBook</span><span class="o">(</span>
        <span class="k">new</span> <span class="n">RqPrint</span><span class="o">(</span>
          <span class="k">new</span> <span class="n">RqMtSmart</span><span class="o">(</span>
            <span class="k">new</span> <span class="n">RqMtBase</span><span class="o">(</span><span class="n">req</span><span class="o">)</span>
          <span class="o">).</span><span class="na">single</span><span class="o">(</span><span class="s">&quot;book&quot;</span><span class="o">)</span>
        <span class="o">).</span><span class="na">printBody</span><span class="o">()</span>
      <span class="o">)</span>
    <span class="o">);</span>
  <span class="o">}</span>
<span class="o">}</span></code></pre></figure><p>Isn&#39;t that more elegant?</p><p>Here are some examples from my projects: <a href="https://github.com/zerocracy/farm/blob/0.21/src/main/java/com/zerocracy/tk/RqUser.java"><code>RqUser</code></a> from <a href="https://github.com/zerocracy/farm/">zerocracy/farm</a> and <a href="https://github.com/yegor256/jare/blob/0.11.2/src/main/java/io/jare/tk/RqUser.java"><code>RqUser</code></a> from <a href="https://github.com/yegor256/jare/blob/0.11.2/src/main/java/io/jare/tk/RqUser.java">yegor256/jare</a>.</p><p>As you can see from the examples above, sometimes we can&#39;t use <code>implements</code> because some primitives in Java are not interfaces but <code>final</code> classes: <code>String</code> is a &quot;perfect&quot; example. That&#39;s why I have to do this:</p><figure class="highlight"><pre><code class="language-java" data-lang="java"><span></span><span class="kd">class</span> <span class="nc">RqUser</span> <span class="kd">implements</span> <span class="n">Scalar</span><span class="o">&lt;</span><span class="n">String</span><span class="o">&gt;</span> <span class="o">{</span>
  <span class="nd">@Override</span>
  <span class="kd">public</span> <span class="n">String</span> <span class="nf">value</span><span class="o">()</span> <span class="o">{</span>
    <span class="c1">// Parsing happens here and returns String</span>
  <span class="o">}</span>
<span class="o">}</span></code></pre></figure><p>But aside from that, these examples perfectly demonstrate the principle of &quot;parsing objects&quot; suggested above.</p></div></article></div><div class="wrapper"> <related-posts /></div><div class="disqus" role="complementary"><p class="disqus_hint"> Please, use <a href="https://help.disqus.com/commenting/what-html-tags-are-allowed-within-comments">syntax highlighting</a> in your comments, to make them more readable.</p><div id="disqus_thread" class="disqus-thread"> <a>&nbsp;</a></div><script> var disqus_config = function () { this.page.url = document.location.href.split('?')[0].split('#')[0].replace('https://', 'http://'); this.page.identifier = this.page.url; }; (function() { var d = document, s = d.createElement('script'); s.src = '//yegor256.disqus.com/embed.js'; s.setAttribute('data-timestamp', +new Date()); (d.head || d.body).appendChild(s); })(); </script> <noscript><div><p class="red"> JavaScript is disabled in your browser, that's why you can't see comments under this post.</p></div></noscript></div><div class="wrapper"> <footer class="footer"><p> &copy; <span itemscope="" itemprop="copyrightHolder" itemtype="http://schema.org/Person"> <span itemprop="name">Yegor Bugayenko</span> </span> 2014&ndash;<span itemprop="copyrightYear">2018</span></p></footer></div></section><div class="wrapper unprintable" style="text-align:center;margin-top:2em;"> <a href="http://www.sixnines.io/h/3ba1652f"> <img src="//www.sixnines.io/b/3ba1652f?style=flat" alt="sixnines availability badge"/> </a></div><script src="//code.jquery.com/jquery-1.9.0.min.js"></script> <script src="/js/all.js?a0e0d018c07"></script> <script>var disqus_shortname = 'yegor256';</script> <script id="dsq-count-scr" src="//yegor256.disqus.com/count.js" async="async"></script> <script> (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){ (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o), m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m) })(window,document,'script','//www.google-analytics.com/analytics.js','ga'); ga('create', 'UA-1963507-32', 'auto'); ga('send', 'pageview'); </script> <script> Cd=document;Cr="&"+Math.random();Cp="&s=1"; Cd.cookie="b=b";if(Cd.cookie)Cp+="&c=1"; Cp+="&t="+(new Date()).getTimezoneOffset(); if(self!=top)Cp+="&f=1"; </script> <script> if(navigator.javaEnabled())Cp+="&j=1"; </script> <script> if(typeof(screen)!='undefined')Cp+="&w="+screen.width+"&h="+ screen.height+"&d="+(screen.colorDepth?screen.colorDepth:screen.pixelDepth); </script> <script> Cd.write("<img src='//c.hit.ua/hit?i=95870&g=0&x=2"+Cp+Cr+ "&r="+escape(Cd.referrer)+"&u="+escape(window.location.href)+ "' border='0' wi"+"dth='1' he"+"ight='1'/>"); </script> <script type="application/ld+json"> { "@context": "http://schema.org", "@type": "Person", "name": "Yegor Bugayenko", "url": "http://www.yegor256.com", "sameAs": [ "https://www.facebook.com/yegor256", "https://instagram.com/yegor256", "https://www.linkedin.com/in/yegor256", "https://twitter.com/yegor256", "https://github.com/yegor256", "https://www.pinterest.com/yegor256/" ] } </script> </body> </html> <!DOCTYPE html> <html xmlns="http://www.w3.org/1999/xhtml" lang="en-US" xml:lang="en-US" itemscope="" itemtype="http://schema.org/WebSite"> <head> <meta charset="utf-8"/> <meta name="description" content="Instantiating objects via operator NEW is what we have to do in order to have those objects; however, it&apos;s important where this happens. " /> <meta name="keywords" content="alan kay about oop, alan kay oop definition, message oriented programming, messages oop, operator new" /> <meta name="viewport" content="width=device-width,minimum-scale=1,initial-scale=1"/> <meta name="google-site-verification" content="JEj_gQr2CPe2QKGw8XdMz0R7VboQIUbX3FlM-lwTq-8" /> <meta name="author" content="Yegor Bugayenko"> <meta name="article:published_time" content="2018-01-02 00:00:00 +0000"> <meta name="og:site_name" content="Yegor Bugayenko"/> <meta name="og:type" content="article" /> <meta name="og:locale" content="en_US" /> <meta name="twitter:account_id" content="4503599630178231" /> <meta name="twitter:creator" content="@yegor256"/> <meta name="twitter:site" content="@yegor256"/> <meta name="twitter:title" property="og:title" content="Operator new() is Toxic"/> <meta name="twitter:description" property="og:description" content="Instantiating objects via operator NEW is what we have to do in order to have those objects; however, it&apos;s important where this happens. "/> <meta name="twitter:url" property="og:url" content="https://www.yegor256.com/2018/01/02/operator-new-is-toxic.html"/> <meta name="telegram:channel" content="AAAAAEJFMRzsRTRxM3ec6A"/> <link rel="search" type="application/opensearchdescription+xml" href="/opensearch.xml" title="yegor256" /> <link rel="shortcut icon" href="/favicon.ico?a0e0d018c07"/> <link rel="apple-touch-icon" href="/favicon.ico?a0e0d018c07"/> <link rel="alternate" type="application/rss+xml" title="RSS for yegor256.com" href="https://www.yegor256.com/rss.xml"/> <link rel="stylesheet" href="/css/layout.css?a0e0d018c07"/> <link rel="stylesheet" href="/css/icons.css?a0e0d018c07"/> <link rel="canonical" href="https://www.yegor256.com/2018/01/02/operator-new-is-toxic.html" /> <link rel="amphtml" href="https://www.yegor256.com/2018/01/02/operator-new-is-toxic.amp.html" /> <title>Operator new() is Toxic </title> <meta name='og:image' content='https://www.yegor256.com/images/2018/01/the-gift.jpg'/><meta name='twitter:image' content='https://www.yegor256.com/images/2018/01/the-gift.jpg'/><meta name='og:image:width' content='1280'/> <meta name='twitter:image:width' content='1280'/><meta name='og:image:height' content='803'/> <meta name='twitter:image:height' content='803'/><meta name='twitter:card' content='summary_large_image'/><meta name='twitter:image:alt' content='The Gift (2015) by Joel Edgerton'/> </head> <body><div class="wrapper"> <aside class="header-toggle unprintable" id="header-toggle" title="Show the menu" onclick="$('#header').show();$('#header-toggle').hide();">&#9776;</aside> <header class="header" id="header"><div class="face"> <a href="/about-me.html#form" class="sub" title="Click to subscribe to my monthly newsletter"><span>Subscribe</span></a> <a href="/about-me.html" style="position:relative;"> <img src="/images/face-256x256.jpg" class="photo" alt="Yegor Bugayenko"/> </a></div><nav><ul class="menu social notranslate"> <li><a href="https://twitter.com/intent/follow?screen_name=yegor256" rel="nofollow" title="Follow me on Twitter"><i class="icon icon-twitter notranslate" aria-hidden="true"></i></a></li> <li><a href="/rss.xml" rel="nofollow" title="Subscribe to my RSS feed"><i class="icon icon-rss notranslate" aria-hidden="true"></i></a></li> <li><a itemprop="sameAs" href="https://github.com/yegor256" rel="nofollow" title="My GitHub profile"><i class="icon icon-github notranslate" aria-hidden="true"></i></a></li> <li><a itemprop="sameAs" href="http://stackoverflow.com/users/187141/yegor256" rel="nofollow" title="My StackOverflow profile"><i class="icon icon-stackoverflow notranslate" aria-hidden="true"></i></a></li> <li><a itemprop="sameAs" href="https://www.facebook.com/yegor256" rel="nofollow" title="Follow me on Facebook"><i class="icon icon-facebook notranslate" aria-hidden="true"></i></a></li> <li><a itemprop="sameAs" href="https://instagram.com/yegor256" rel="nofollow" title="Follow me on Instagram"><i class="icon icon-instagram notranslate" aria-hidden="true"></i></a></li> <li><a itemprop="sameAs" href="https://www.linkedin.com/in/yegor256" rel="nofollow" title="My LinkedIn profile"><i class="icon icon-linkedin notranslate" aria-hidden="true"></i></a></li> <li><a itemprop="sameAs" href="https://www.youtube.com/c/yegor256?sub_confirmation=1" rel="nofollow" title="My Youtube video channel"><i class="icon icon-youtube notranslate" aria-hidden="true"></i></a></li> <li><a itemprop="sameAs" href="https://www.pinterest.com/yegor256/" rel="nofollow" title="My Pinterest boards"><i class="icon icon-pinterest notranslate" aria-hidden="true"></i></a></li> <li><a itemprop="sameAs" href="https://angel.co/yegor256" rel="nofollow" title="My AngelList profile"><i class="icon icon-angellist notranslate" aria-hidden="true"></i></a></li> <li><a href="https://soundcloud.com/yegor256" rel="nofollow" title="My podcast"><i class="icon icon-podcast notranslate" aria-hidden="true"></i></a></li> <li><a href="https://itunes.apple.com/us/podcast/yegor256-podcast/id1150826721" rel="nofollow" title="My iTunes podcast"><i class="icon icon-itunes notranslate" aria-hidden="true"></i></a></li> <li><a href="https://t.me/joinchat/AAAAAEJFMRzsRTRxM3ec6A" rel="nofollow" title="My Telegram public channel"><i class="icon icon-telegram notranslate" aria-hidden="true"></i></a></li> <li><a href="mailto:blog@yegor256.com" rel="nofollow" title="Email me any time"><i class="icon icon-mail notranslate" aria-hidden="true"></i></a></li></ul><ul class="menu"> <li><a href="/" title="Home page">Home</a></li> <li ><a href="/best.html" title="Best articles to read">12&#160;Best</a></li> <li ><a href="/contents.html" title="The contents of the entire blog">All&#160;288</a></li> <li ><a href="/webinars.html" title="My webinars">Webinars</a></li> <li ><a href="/talks.html" title="Future and past conference talks">Talks</a></li> <li ><a href="/books.html" title="The books I wrote">Books</a></li> <li ><a href="/papers.html" title="My academic papers and patents">Papers</a></li> <li ><a href="/pets.html" title="My loved pet projects">Pets</a></li> <li ><a href="/award.html" title="Software quality award">Award</a></li> <li ><a href="/testimonials.html" title="What some people say about me">Testimonials</a></li> <li ><a href="/shift-m.html" title="Audio podcast about project management">Shift-M</a></li> <li ><a href="/paintings.html" title="My paintings for sale">Paintings</a></li> <li><a href="http://ru.yegor256.com/" title="Немного на русском языке">По-русски</a></li></ul></nav><div class="search"> <form method="get" action="https://www.google.com/search" itemprop="potentialAction" itemscope="" itemtype="http://schema.org/SearchAction"> <meta itemprop="target" content="https://www.google.com/search?q={q}"/> <input name="sitesearch" value="yegor256.com" type="hidden"/> <input itemprop="query-input" type="text" id="search-query" class="field field-text" required="required" onfocus="$('.google').css('visibility', 'visible');" name="q" placeholder="Search..." autocomplete="off"/> <input type="image" src="/images/google-search-icon.svg" class="google" title="Search via Google" alt="Search via Google"/> </form></div><div class="hot"><ul> <li> <a href="/code-ahead.html">Code Ahead</a> was published on Amazon just a few days ago! It is my new book, a novel about programmers. It explains in details the majority of ideas that stand behind <a href="https://www.zerocracy.com">Zerocracy</a> and <a href="https://www.xdsd.org">XDSD</a>. </li> <li> At <a href="/webinars.html">Webinar #37</a> we will discuss naming problem in OOP, for objects, methods and attributes; join us on <b>September 12</b>, at 11am PST. </li></ul></div></header></div><section itemscope="" itemtype="http://schema.org/BlogPosting"><div class="wrapper"> <header><p class="printable"> <img src="https://api.qrserver.com/v1/create-qr-code/?data=https://www.yegor256.com/2018/01/02/operator-new-is-toxic.html&amp;format=svg" style="width:125px;height:125px;" alt="QR code"/></p><p class="printable"> <code itemprop="url">https://www.yegor256.com/2018/01/02/operator-new-is-toxic.html</code></p><h1 itemprop="name headline mainEntityOfPage">Operator new() is Toxic</h1><aside class='book'><a href='http://amzn.to/2qFt4Tn'><img src='/images/books/elegant-objects/cover.png' class='book-cover' alt='book cover'/></a>Read more about this subject in <a href='http://amzn.to/2qFt4Tn'>Section&nbsp;3.6</a><br/> of my book<a href='http://amzn.to/2qFt4Tn'><img src='/images/books/amazon-buy-button.png' class='amazon-button' alt='Click to buy'/></a></aside><ul class="subline"> <li> <time itemprop="datePublished" datetime="2018-01-02T00:00:00+00:00"> 2 January 2018 </time> </li> <li class="desktop-only" itemprop="locationCreated">Moscow, Russia</li> <li class="printable" itemscope="" itemprop="author" itemtype="http://schema.org/Person"> <span itemprop="name">Yegor Bugayenko</span> </li> <li class="unprintable"> <i class="icon icon-comments"></i> <a href="http://www.yegor256.com/2018/01/02/operator-new-is-toxic.html#disqus_thread" itemprop="discussionUrl">comments</a> </li></ul><p class="unprintable"><p>To instantiate objects, in most object-oriented languages, including Java, Ruby, and C++, we use operator <code>new()</code>. Well, unless we use static factory methods, which we don&#39;t use because <a href="/2017/11/14/static-factory-methods.html">they are evil</a>. Even though it looks so easy to make a new object any time we need it, I would recommend to be more careful with this rather toxic operator.</p><figure class='jb_picture'><img itemprop='image' alt='The Gift (2015) by Joel Edgerton' src='/images/2018/01/the-gift.jpg' longdesc='#63533835'/><figcaption id='63533835'>The Gift (2015) by Joel Edgerton</figcaption></figure><p>I&#39;m sure you understand that the problem with this operator is that it couples objects, making testing and reuse very difficult or even impossible. Let&#39;s say there is a story in a file that we need to read as a UTF-8 text (I&#39;m using <a href="http://static.javadoc.io/org.cactoos/cactoos/0.25.6/org/cactoos/text/TextOf.html"><code>TextOf</code></a> from <a href="http://www.cactoos.org">Cactoos</a>):</p><figure class="highlight"><pre><code class="language-java" data-lang="java"><span></span><span class="kd">class</span> <span class="nc">Story</span> <span class="o">{</span>
  <span class="n">String</span> <span class="nf">text</span><span class="o">()</span> <span class="o">{</span>
    <span class="k">return</span> <span class="k">new</span> <span class="n">TextOf</span><span class="o">(</span>
      <span class="k">new</span> <span class="n">File</span><span class="o">(</span><span class="s">&quot;/tmp/story.txt&quot;</span><span class="o">)</span>
    <span class="o">).</span><span class="na">asString</span><span class="o">();</span>
  <span class="o">}</span>
<span class="o">}</span></code></pre></figure><p>It seems super simple, but the problem is obvious: class <code>Story</code> can&#39;t be reused. It can only read one particular file. Moreover, testing it will be rather difficult, since it reads the content from exactly one place, which can&#39;t be changed at all. More formally this problem is known as an <em>unbreakable dependency</em>---we can&#39;t break the link between <code>Story</code> and <code>/tmp/story.txt</code>---they are together forever.</p><p>To solve this we need to introduce a constructor and let <code>Story</code> accept the location of the content as an argument:</p><figure class="highlight"><pre><code class="language-java" data-lang="java"><span></span><span class="kd">class</span> <span class="nc">Story</span> <span class="o">{</span>
  <span class="kd">private</span> <span class="kd">final</span> <span class="n">File</span> <span class="n">file</span><span class="o">;</span>
  <span class="n">Story</span><span class="o">(</span><span class="n">File</span> <span class="n">f</span><span class="o">)</span> <span class="o">{</span>
    <span class="k">this</span><span class="o">.</span><span class="na">file</span> <span class="o">=</span> <span class="n">f</span><span class="o">;</span>
  <span class="o">}</span>
  <span class="n">String</span> <span class="nf">text</span><span class="o">()</span> <span class="o">{</span>
    <span class="k">return</span> <span class="k">new</span> <span class="n">TextOf</span><span class="o">(</span><span class="k">this</span><span class="o">.</span><span class="na">file</span><span class="o">).</span><span class="na">asString</span><span class="o">();</span>
  <span class="o">}</span>
<span class="o">}</span></code></pre></figure><p>Now, each user of the <code>Story</code> has to know the name of the file:</p><figure class="highlight"><pre><code class="language-java" data-lang="java"><span></span><span class="k">new</span> <span class="n">Story</span><span class="o">(</span><span class="k">new</span> <span class="n">File</span><span class="o">(</span><span class="s">&quot;/tmp/story.txt&quot;</span><span class="o">));</span></code></pre></figure><p>It&#39;s not really convenient, especially for those users who were using <code>Story</code> before, knowing nothing about the file path. To help them we introduce a <a href="/2015/05/28/one-primary-constructor.html">secondary constructor</a>:</p><figure class="highlight"><pre><code class="language-java" data-lang="java"><span></span><span class="kd">class</span> <span class="nc">Story</span> <span class="o">{</span>
  <span class="kd">private</span> <span class="kd">final</span> <span class="n">File</span> <span class="n">file</span><span class="o">;</span>
  <span class="n">Story</span><span class="o">()</span> <span class="o">{</span> <span class="c1">// Here!</span>
    <span class="k">this</span><span class="o">(</span><span class="k">new</span> <span class="n">File</span><span class="o">(</span><span class="s">&quot;/tmp/story.txt&quot;</span><span class="o">));</span>
  <span class="o">}</span>
  <span class="n">Story</span><span class="o">(</span><span class="n">File</span> <span class="n">f</span><span class="o">)</span> <span class="o">{</span>
    <span class="k">this</span><span class="o">.</span><span class="na">file</span> <span class="o">=</span> <span class="n">f</span><span class="o">;</span>
  <span class="o">}</span>
  <span class="n">String</span> <span class="nf">text</span><span class="o">()</span> <span class="o">{</span>
    <span class="k">return</span> <span class="k">new</span> <span class="n">TextOf</span><span class="o">(</span><span class="k">this</span><span class="o">.</span><span class="na">file</span><span class="o">).</span><span class="na">asString</span><span class="o">();</span>
  <span class="o">}</span>
<span class="o">}</span></code></pre></figure><p>Now we just make an instance through a no-arguments constructor, just like we did before:</p><figure class="highlight"><pre><code class="language-java" data-lang="java"><span></span><span class="k">new</span> <span class="n">Story</span><span class="o">();</span></code></pre></figure><p>I&#39;m sure you&#39;re well aware of this technique, which is also known as <a href="http://martinfowler.com/articles/injection.html">dependency injection</a>. I&#39;m actually not saying anything new. What I want you to pay attention to here is the location and the amount of <code>new</code> operators in all three code snippets.</p><p>In the first snippet both <code>new</code> operators are in the method <code>text()</code>. In the second snippet we lost one of them. In the third snippet one operator is in the method, while the second one moved up, to the constructor.</p><p>Remember this fact and let&#39;s move on.</p><p>What if the file is not in UTF-8 encoding but in <a href="https://en.wikipedia.org/wiki/KOI8-R">KOI8-R</a>? Class <code>TextOf</code> and then method <code>Story.text()</code> will throw an exception. However, class <code>TextOf</code> is capable of reading in any encoding, it just needs to have a secondary argument for its constructor:</p><figure class="highlight"><pre><code class="language-java" data-lang="java"><span></span><span class="k">new</span> <span class="n">TextOf</span><span class="o">(</span><span class="k">this</span><span class="o">.</span><span class="na">file</span><span class="o">,</span> <span class="s">&quot;KOI8_R&quot;</span><span class="o">).</span><span class="na">asString</span><span class="o">();</span></code></pre></figure><p>In order to make <code>Story</code> capable of using different encodings, we need to introduce a few additional secondary constructors and modify its primary constructor:</p><figure class="highlight"><pre><code class="language-java" data-lang="java"><span></span><span class="kd">class</span> <span class="nc">Story</span> <span class="o">{</span>
  <span class="kd">private</span> <span class="kd">final</span> <span class="n">Text</span> <span class="n">text</span><span class="o">;</span>
  <span class="n">Story</span><span class="o">()</span> <span class="o">{</span>
    <span class="k">this</span><span class="o">(</span><span class="k">new</span> <span class="n">File</span><span class="o">(</span><span class="s">&quot;/tmp/story.txt&quot;</span><span class="o">));</span>
  <span class="o">}</span>
  <span class="n">Story</span><span class="o">(</span><span class="n">File</span> <span class="n">f</span><span class="o">)</span> <span class="o">{</span>
    <span class="k">this</span><span class="o">(</span><span class="n">f</span><span class="o">,</span> <span class="n">StandardEncodings</span><span class="o">.</span><span class="na">UTF_8</span><span class="o">);</span>
  <span class="o">}</span>
  <span class="n">Story</span><span class="o">(</span><span class="n">File</span> <span class="n">f</span><span class="o">,</span> <span class="n">Encoding</span> <span class="n">e</span><span class="o">)</span> <span class="o">{</span>
    <span class="k">this</span><span class="o">(</span><span class="k">new</span> <span class="n">TextOf</span><span class="o">(</span><span class="n">f</span><span class="o">,</span> <span class="n">e</span><span class="o">));</span>
  <span class="o">}</span>
  <span class="n">Story</span><span class="o">(</span><span class="n">Text</span> <span class="n">t</span><span class="o">)</span> <span class="o">{</span>
    <span class="k">this</span><span class="o">.</span><span class="na">text</span> <span class="o">=</span> <span class="n">t</span><span class="o">;</span>
  <span class="o">}</span>
  <span class="n">String</span> <span class="nf">text</span><span class="o">()</span> <span class="o">{</span>
    <span class="k">return</span> <span class="k">this</span><span class="o">.</span><span class="na">text</span><span class="o">.</span><span class="na">asString</span><span class="o">();</span>
  <span class="o">}</span>
<span class="o">}</span></code></pre></figure><p>It&#39;s just dependency injection, but pay attention to the locations of the operator <code>new</code>. They are all in the constructors now and none of them are left in the method <code>text()</code>.</p><p>The tendency here is obvious to me: the more the <code>new</code> operators stay in the methods, the less reusable and testable is the class.</p><p>In other words, operator <code>new</code> is a rather toxic thing, so try to keep its usage to a minimum in your methods. Make sure you instantiate everything or almost everything in your secondary constructors.</p></p><nav class="buttons notranslate desktop-only"> <a href="http://www.facebook.com/sharer/sharer.php?u=https://www.yegor256.com/2018/01/02/operator-new-is-toxic.html" title="Share on Facebook" class="button" rel="nofollow"> <span class="count count-facebook">0</span> <i class="icon icon-facebook notranslate" aria-hidden="true"></i> </a> <a href="https://twitter.com/share?url=https://www.yegor256.com/2018/01/02/operator-new-is-toxic.html&amp;text=Operator+new%28%29+is+Toxic" title="Share on Twitter" class="button" rel="nofollow"> <span class="count count-twitter">0</span> <i class="icon icon-twitter notranslate" aria-hidden="true"></i> </a> <a href="https://plus.google.com/share?url=https://www.yegor256.com/2018/01/02/operator-new-is-toxic.html" title="Share on Google+" class="button" rel="nofollow"> <span class="count count-googleplus">0</span> <i class="icon icon-googleplus notranslate" aria-hidden="true"></i> </a> <a href="https://www.linkedin.com/cws/share?url=https://www.yegor256.com/2018/01/02/operator-new-is-toxic.html" title="Share on LinkedIn" class="button" rel="nofollow"> <span class="count count-linkedin">0</span> <i class="icon icon-linkedin notranslate" aria-hidden="true"></i> </a> <a href="http://reddit.com/submit?url=https://www.yegor256.com/2018/01/02/operator-new-is-toxic.html%3F2018-00&amp;title=Operator+new%28%29+is+Toxic" title="Share on Reddit" class="button" rel="nofollow"> <span class="count count-reddit">0</span> <i class="icon icon-reddit notranslate" aria-hidden="true"></i> </a> <a href="http://news.ycombinator.com/submitlink?u=https://www.yegor256.com/2018/01/02/operator-new-is-toxic.html%3F2018-00&amp;t=Operator+new%28%29+is+Toxic" title="Share on Hacker News" class="button" rel="nofollow"> <span class="count count-hackernews">0</span> <i class="icon icon-hackernews notranslate" aria-hidden="true"></i> </a> </nav> </header> <article class="main" itemprop="articleBody"><div ><p>To instantiate objects, in most object-oriented languages, including Java, Ruby, and C++, we use operator <code>new()</code>. Well, unless we use static factory methods, which we don&#39;t use because <a href="/2017/11/14/static-factory-methods.html">they are evil</a>. Even though it looks so easy to make a new object any time we need it, I would recommend to be more careful with this rather toxic operator.</p><figure class='jb_picture'><img itemprop='image' alt='The Gift (2015) by Joel Edgerton' src='/images/2018/01/the-gift.jpg' longdesc='#63533835'/><figcaption id='63533835'>The Gift (2015) by Joel Edgerton</figcaption></figure><p>I&#39;m sure you understand that the problem with this operator is that it couples objects, making testing and reuse very difficult or even impossible. Let&#39;s say there is a story in a file that we need to read as a UTF-8 text (I&#39;m using <a href="http://static.javadoc.io/org.cactoos/cactoos/0.25.6/org/cactoos/text/TextOf.html"><code>TextOf</code></a> from <a href="http://www.cactoos.org">Cactoos</a>):</p><figure class="highlight"><pre><code class="language-java" data-lang="java"><span></span><span class="kd">class</span> <span class="nc">Story</span> <span class="o">{</span>
  <span class="n">String</span> <span class="nf">text</span><span class="o">()</span> <span class="o">{</span>
    <span class="k">return</span> <span class="k">new</span> <span class="n">TextOf</span><span class="o">(</span>
      <span class="k">new</span> <span class="n">File</span><span class="o">(</span><span class="s">&quot;/tmp/story.txt&quot;</span><span class="o">)</span>
    <span class="o">).</span><span class="na">asString</span><span class="o">();</span>
  <span class="o">}</span>
<span class="o">}</span></code></pre></figure><p>It seems super simple, but the problem is obvious: class <code>Story</code> can&#39;t be reused. It can only read one particular file. Moreover, testing it will be rather difficult, since it reads the content from exactly one place, which can&#39;t be changed at all. More formally this problem is known as an <em>unbreakable dependency</em>---we can&#39;t break the link between <code>Story</code> and <code>/tmp/story.txt</code>---they are together forever.</p><p>To solve this we need to introduce a constructor and let <code>Story</code> accept the location of the content as an argument:</p><figure class="highlight"><pre><code class="language-java" data-lang="java"><span></span><span class="kd">class</span> <span class="nc">Story</span> <span class="o">{</span>
  <span class="kd">private</span> <span class="kd">final</span> <span class="n">File</span> <span class="n">file</span><span class="o">;</span>
  <span class="n">Story</span><span class="o">(</span><span class="n">File</span> <span class="n">f</span><span class="o">)</span> <span class="o">{</span>
    <span class="k">this</span><span class="o">.</span><span class="na">file</span> <span class="o">=</span> <span class="n">f</span><span class="o">;</span>
  <span class="o">}</span>
  <span class="n">String</span> <span class="nf">text</span><span class="o">()</span> <span class="o">{</span>
    <span class="k">return</span> <span class="k">new</span> <span class="n">TextOf</span><span class="o">(</span><span class="k">this</span><span class="o">.</span><span class="na">file</span><span class="o">).</span><span class="na">asString</span><span class="o">();</span>
  <span class="o">}</span>
<span class="o">}</span></code></pre></figure><p>Now, each user of the <code>Story</code> has to know the name of the file:</p><figure class="highlight"><pre><code class="language-java" data-lang="java"><span></span><span class="k">new</span> <span class="n">Story</span><span class="o">(</span><span class="k">new</span> <span class="n">File</span><span class="o">(</span><span class="s">&quot;/tmp/story.txt&quot;</span><span class="o">));</span></code></pre></figure><p>It&#39;s not really convenient, especially for those users who were using <code>Story</code> before, knowing nothing about the file path. To help them we introduce a <a href="/2015/05/28/one-primary-constructor.html">secondary constructor</a>:</p><figure class="highlight"><pre><code class="language-java" data-lang="java"><span></span><span class="kd">class</span> <span class="nc">Story</span> <span class="o">{</span>
  <span class="kd">private</span> <span class="kd">final</span> <span class="n">File</span> <span class="n">file</span><span class="o">;</span>
  <span class="n">Story</span><span class="o">()</span> <span class="o">{</span> <span class="c1">// Here!</span>
    <span class="k">this</span><span class="o">(</span><span class="k">new</span> <span class="n">File</span><span class="o">(</span><span class="s">&quot;/tmp/story.txt&quot;</span><span class="o">));</span>
  <span class="o">}</span>
  <span class="n">Story</span><span class="o">(</span><span class="n">File</span> <span class="n">f</span><span class="o">)</span> <span class="o">{</span>
    <span class="k">this</span><span class="o">.</span><span class="na">file</span> <span class="o">=</span> <span class="n">f</span><span class="o">;</span>
  <span class="o">}</span>
  <span class="n">String</span> <span class="nf">text</span><span class="o">()</span> <span class="o">{</span>
    <span class="k">return</span> <span class="k">new</span> <span class="n">TextOf</span><span class="o">(</span><span class="k">this</span><span class="o">.</span><span class="na">file</span><span class="o">).</span><span class="na">asString</span><span class="o">();</span>
  <span class="o">}</span>
<span class="o">}</span></code></pre></figure><p>Now we just make an instance through a no-arguments constructor, just like we did before:</p><figure class="highlight"><pre><code class="language-java" data-lang="java"><span></span><span class="k">new</span> <span class="n">Story</span><span class="o">();</span></code></pre></figure><p>I&#39;m sure you&#39;re well aware of this technique, which is also known as <a href="http://martinfowler.com/articles/injection.html">dependency injection</a>. I&#39;m actually not saying anything new. What I want you to pay attention to here is the location and the amount of <code>new</code> operators in all three code snippets.</p><p>In the first snippet both <code>new</code> operators are in the method <code>text()</code>. In the second snippet we lost one of them. In the third snippet one operator is in the method, while the second one moved up, to the constructor.</p><p>Remember this fact and let&#39;s move on.</p><p>What if the file is not in UTF-8 encoding but in <a href="https://en.wikipedia.org/wiki/KOI8-R">KOI8-R</a>? Class <code>TextOf</code> and then method <code>Story.text()</code> will throw an exception. However, class <code>TextOf</code> is capable of reading in any encoding, it just needs to have a secondary argument for its constructor:</p><figure class="highlight"><pre><code class="language-java" data-lang="java"><span></span><span class="k">new</span> <span class="n">TextOf</span><span class="o">(</span><span class="k">this</span><span class="o">.</span><span class="na">file</span><span class="o">,</span> <span class="s">&quot;KOI8_R&quot;</span><span class="o">).</span><span class="na">asString</span><span class="o">();</span></code></pre></figure><p>In order to make <code>Story</code> capable of using different encodings, we need to introduce a few additional secondary constructors and modify its primary constructor:</p><figure class="highlight"><pre><code class="language-java" data-lang="java"><span></span><span class="kd">class</span> <span class="nc">Story</span> <span class="o">{</span>
  <span class="kd">private</span> <span class="kd">final</span> <span class="n">Text</span> <span class="n">text</span><span class="o">;</span>
  <span class="n">Story</span><span class="o">()</span> <span class="o">{</span>
    <span class="k">this</span><span class="o">(</span><span class="k">new</span> <span class="n">File</span><span class="o">(</span><span class="s">&quot;/tmp/story.txt&quot;</span><span class="o">));</span>
  <span class="o">}</span>
  <span class="n">Story</span><span class="o">(</span><span class="n">File</span> <span class="n">f</span><span class="o">)</span> <span class="o">{</span>
    <span class="k">this</span><span class="o">(</span><span class="n">f</span><span class="o">,</span> <span class="n">StandardEncodings</span><span class="o">.</span><span class="na">UTF_8</span><span class="o">);</span>
  <span class="o">}</span>
  <span class="n">Story</span><span class="o">(</span><span class="n">File</span> <span class="n">f</span><span class="o">,</span> <span class="n">Encoding</span> <span class="n">e</span><span class="o">)</span> <span class="o">{</span>
    <span class="k">this</span><span class="o">(</span><span class="k">new</span> <span class="n">TextOf</span><span class="o">(</span><span class="n">f</span><span class="o">,</span> <span class="n">e</span><span class="o">));</span>
  <span class="o">}</span>
  <span class="n">Story</span><span class="o">(</span><span class="n">Text</span> <span class="n">t</span><span class="o">)</span> <span class="o">{</span>
    <span class="k">this</span><span class="o">.</span><span class="na">text</span> <span class="o">=</span> <span class="n">t</span><span class="o">;</span>
  <span class="o">}</span>
  <span class="n">String</span> <span class="nf">text</span><span class="o">()</span> <span class="o">{</span>
    <span class="k">return</span> <span class="k">this</span><span class="o">.</span><span class="na">text</span><span class="o">.</span><span class="na">asString</span><span class="o">();</span>
  <span class="o">}</span>
<span class="o">}</span></code></pre></figure><p>It&#39;s just dependency injection, but pay attention to the locations of the operator <code>new</code>. They are all in the constructors now and none of them are left in the method <code>text()</code>.</p><p>The tendency here is obvious to me: the more the <code>new</code> operators stay in the methods, the less reusable and testable is the class.</p><p>In other words, operator <code>new</code> is a rather toxic thing, so try to keep its usage to a minimum in your methods. Make sure you instantiate everything or almost everything in your secondary constructors.</p></div></article></div><div class="wrapper"> <related-posts /></div><div class="disqus" role="complementary"><p class="disqus_hint"> Please, use <a href="https://help.disqus.com/commenting/what-html-tags-are-allowed-within-comments">syntax highlighting</a> in your comments, to make them more readable.</p><div id="disqus_thread" class="disqus-thread"> <a>&nbsp;</a></div><script> var disqus_config = function () { this.page.url = document.location.href.split('?')[0].split('#')[0].replace('https://', 'http://'); this.page.identifier = this.page.url; }; (function() { var d = document, s = d.createElement('script'); s.src = '//yegor256.disqus.com/embed.js'; s.setAttribute('data-timestamp', +new Date()); (d.head || d.body).appendChild(s); })(); </script> <noscript><div><p class="red"> JavaScript is disabled in your browser, that's why you can't see comments under this post.</p></div></noscript></div><div class="wrapper"> <footer class="footer"><p> &copy; <span itemscope="" itemprop="copyrightHolder" itemtype="http://schema.org/Person"> <span itemprop="name">Yegor Bugayenko</span> </span> 2014&ndash;<span itemprop="copyrightYear">2018</span></p></footer></div></section><div class="wrapper unprintable" style="text-align:center;margin-top:2em;"> <a href="http://www.sixnines.io/h/3ba1652f"> <img src="//www.sixnines.io/b/3ba1652f?style=flat" alt="sixnines availability badge"/> </a></div><script src="//code.jquery.com/jquery-1.9.0.min.js"></script> <script src="/js/all.js?a0e0d018c07"></script> <script>var disqus_shortname = 'yegor256';</script> <script id="dsq-count-scr" src="//yegor256.disqus.com/count.js" async="async"></script> <script> (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){ (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o), m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m) })(window,document,'script','//www.google-analytics.com/analytics.js','ga'); ga('create', 'UA-1963507-32', 'auto'); ga('send', 'pageview'); </script> <script> Cd=document;Cr="&"+Math.random();Cp="&s=1"; Cd.cookie="b=b";if(Cd.cookie)Cp+="&c=1"; Cp+="&t="+(new Date()).getTimezoneOffset(); if(self!=top)Cp+="&f=1"; </script> <script> if(navigator.javaEnabled())Cp+="&j=1"; </script> <script> if(typeof(screen)!='undefined')Cp+="&w="+screen.width+"&h="+ screen.height+"&d="+(screen.colorDepth?screen.colorDepth:screen.pixelDepth); </script> <script> Cd.write("<img src='//c.hit.ua/hit?i=95870&g=0&x=2"+Cp+Cr+ "&r="+escape(Cd.referrer)+"&u="+escape(window.location.href)+ "' border='0' wi"+"dth='1' he"+"ight='1'/>"); </script> <script type="application/ld+json"> { "@context": "http://schema.org", "@type": "Person", "name": "Yegor Bugayenko", "url": "http://www.yegor256.com", "sameAs": [ "https://www.facebook.com/yegor256", "https://instagram.com/yegor256", "https://www.linkedin.com/in/yegor256", "https://twitter.com/yegor256", "https://github.com/yegor256", "https://www.pinterest.com/yegor256/" ] } </script> </body> </html> <!DOCTYPE html> <html xmlns="http://www.w3.org/1999/xhtml" lang="en-US" xml:lang="en-US" itemscope="" itemtype="http://schema.org/WebSite"> <head> <meta charset="utf-8"/> <meta name="description" content="The single responsibility principle is very popular among object-oriented programmers, but how practical and valid is it really? " /> <meta name="keywords" content="single responsibility principle, srp, srp is fake, srp java, srp oop" /> <meta name="viewport" content="width=device-width,minimum-scale=1,initial-scale=1"/> <meta name="google-site-verification" content="JEj_gQr2CPe2QKGw8XdMz0R7VboQIUbX3FlM-lwTq-8" /> <meta name="author" content="Yegor Bugayenko"> <meta name="article:published_time" content="2017-12-19 00:00:00 +0000"> <meta name="og:site_name" content="Yegor Bugayenko"/> <meta name="og:type" content="article" /> <meta name="og:locale" content="en_US" /> <meta name="twitter:account_id" content="4503599630178231" /> <meta name="twitter:creator" content="@yegor256"/> <meta name="twitter:site" content="@yegor256"/> <meta name="twitter:title" property="og:title" content="SRP is a Hoax"/> <meta name="twitter:description" property="og:description" content="The single responsibility principle is very popular among object-oriented programmers, but how practical and valid is it really? "/> <meta name="twitter:url" property="og:url" content="https://www.yegor256.com/2017/12/19/srp-is-hoax.html"/> <meta name="telegram:channel" content="AAAAAEJFMRzsRTRxM3ec6A"/> <link rel="search" type="application/opensearchdescription+xml" href="/opensearch.xml" title="yegor256" /> <link rel="shortcut icon" href="/favicon.ico?a0e0d018c07"/> <link rel="apple-touch-icon" href="/favicon.ico?a0e0d018c07"/> <link rel="alternate" type="application/rss+xml" title="RSS for yegor256.com" href="https://www.yegor256.com/rss.xml"/> <link rel="stylesheet" href="/css/layout.css?a0e0d018c07"/> <link rel="stylesheet" href="/css/icons.css?a0e0d018c07"/> <link rel="canonical" href="https://www.yegor256.com/2017/12/19/srp-is-hoax.html" /> <link rel="amphtml" href="https://www.yegor256.com/2017/12/19/srp-is-hoax.amp.html" /> <title>SRP is a Hoax </title> <meta name='og:image' content='https://www.yegor256.com/images/2017/12/the-thomas-crown-affair.jpg'/><meta name='twitter:image' content='https://www.yegor256.com/images/2017/12/the-thomas-crown-affair.jpg'/><meta name='og:image:width' content='1280'/> <meta name='twitter:image:width' content='1280'/><meta name='og:image:height' content='539'/> <meta name='twitter:image:height' content='539'/><meta name='twitter:card' content='summary_large_image'/><meta name='twitter:image:alt' content='The Thomas Crown Affair (1999) by John McTiernan'/> </head> <body><div class="wrapper"> <aside class="header-toggle unprintable" id="header-toggle" title="Show the menu" onclick="$('#header').show();$('#header-toggle').hide();">&#9776;</aside> <header class="header" id="header"><div class="face"> <a href="/about-me.html#form" class="sub" title="Click to subscribe to my monthly newsletter"><span>Subscribe</span></a> <a href="/about-me.html" style="position:relative;"> <img src="/images/face-256x256.jpg" class="photo" alt="Yegor Bugayenko"/> </a></div><nav><ul class="menu social notranslate"> <li><a href="https://twitter.com/intent/follow?screen_name=yegor256" rel="nofollow" title="Follow me on Twitter"><i class="icon icon-twitter notranslate" aria-hidden="true"></i></a></li> <li><a href="/rss.xml" rel="nofollow" title="Subscribe to my RSS feed"><i class="icon icon-rss notranslate" aria-hidden="true"></i></a></li> <li><a itemprop="sameAs" href="https://github.com/yegor256" rel="nofollow" title="My GitHub profile"><i class="icon icon-github notranslate" aria-hidden="true"></i></a></li> <li><a itemprop="sameAs" href="http://stackoverflow.com/users/187141/yegor256" rel="nofollow" title="My StackOverflow profile"><i class="icon icon-stackoverflow notranslate" aria-hidden="true"></i></a></li> <li><a itemprop="sameAs" href="https://www.facebook.com/yegor256" rel="nofollow" title="Follow me on Facebook"><i class="icon icon-facebook notranslate" aria-hidden="true"></i></a></li> <li><a itemprop="sameAs" href="https://instagram.com/yegor256" rel="nofollow" title="Follow me on Instagram"><i class="icon icon-instagram notranslate" aria-hidden="true"></i></a></li> <li><a itemprop="sameAs" href="https://www.linkedin.com/in/yegor256" rel="nofollow" title="My LinkedIn profile"><i class="icon icon-linkedin notranslate" aria-hidden="true"></i></a></li> <li><a itemprop="sameAs" href="https://www.youtube.com/c/yegor256?sub_confirmation=1" rel="nofollow" title="My Youtube video channel"><i class="icon icon-youtube notranslate" aria-hidden="true"></i></a></li> <li><a itemprop="sameAs" href="https://www.pinterest.com/yegor256/" rel="nofollow" title="My Pinterest boards"><i class="icon icon-pinterest notranslate" aria-hidden="true"></i></a></li> <li><a itemprop="sameAs" href="https://angel.co/yegor256" rel="nofollow" title="My AngelList profile"><i class="icon icon-angellist notranslate" aria-hidden="true"></i></a></li> <li><a href="https://soundcloud.com/yegor256" rel="nofollow" title="My podcast"><i class="icon icon-podcast notranslate" aria-hidden="true"></i></a></li> <li><a href="https://itunes.apple.com/us/podcast/yegor256-podcast/id1150826721" rel="nofollow" title="My iTunes podcast"><i class="icon icon-itunes notranslate" aria-hidden="true"></i></a></li> <li><a href="https://t.me/joinchat/AAAAAEJFMRzsRTRxM3ec6A" rel="nofollow" title="My Telegram public channel"><i class="icon icon-telegram notranslate" aria-hidden="true"></i></a></li> <li><a href="mailto:blog@yegor256.com" rel="nofollow" title="Email me any time"><i class="icon icon-mail notranslate" aria-hidden="true"></i></a></li></ul><ul class="menu"> <li><a href="/" title="Home page">Home</a></li> <li ><a href="/best.html" title="Best articles to read">12&#160;Best</a></li> <li ><a href="/contents.html" title="The contents of the entire blog">All&#160;288</a></li> <li ><a href="/webinars.html" title="My webinars">Webinars</a></li> <li ><a href="/talks.html" title="Future and past conference talks">Talks</a></li> <li ><a href="/books.html" title="The books I wrote">Books</a></li> <li ><a href="/papers.html" title="My academic papers and patents">Papers</a></li> <li ><a href="/pets.html" title="My loved pet projects">Pets</a></li> <li ><a href="/award.html" title="Software quality award">Award</a></li> <li ><a href="/testimonials.html" title="What some people say about me">Testimonials</a></li> <li ><a href="/shift-m.html" title="Audio podcast about project management">Shift-M</a></li> <li ><a href="/paintings.html" title="My paintings for sale">Paintings</a></li> <li><a href="http://ru.yegor256.com/" title="Немного на русском языке">По-русски</a></li></ul></nav><div class="search"> <form method="get" action="https://www.google.com/search" itemprop="potentialAction" itemscope="" itemtype="http://schema.org/SearchAction"> <meta itemprop="target" content="https://www.google.com/search?q={q}"/> <input name="sitesearch" value="yegor256.com" type="hidden"/> <input itemprop="query-input" type="text" id="search-query" class="field field-text" required="required" onfocus="$('.google').css('visibility', 'visible');" name="q" placeholder="Search..." autocomplete="off"/> <input type="image" src="/images/google-search-icon.svg" class="google" title="Search via Google" alt="Search via Google"/> </form></div><div class="hot"><ul> <li> <a href="/code-ahead.html">Code Ahead</a> was published on Amazon just a few days ago! It is my new book, a novel about programmers. It explains in details the majority of ideas that stand behind <a href="https://www.zerocracy.com">Zerocracy</a> and <a href="https://www.xdsd.org">XDSD</a>. </li> <li> At <a href="/webinars.html">Webinar #37</a> we will discuss naming problem in OOP, for objects, methods and attributes; join us on <b>September 12</b>, at 11am PST. </li></ul></div></header></div><section itemscope="" itemtype="http://schema.org/BlogPosting"><div class="wrapper"> <header><p class="printable"> <img src="https://api.qrserver.com/v1/create-qr-code/?data=https://www.yegor256.com/2017/12/19/srp-is-hoax.html&amp;format=svg" style="width:125px;height:125px;" alt="QR code"/></p><p class="printable"> <code itemprop="url">https://www.yegor256.com/2017/12/19/srp-is-hoax.html</code></p><h1 itemprop="name headline mainEntityOfPage">SRP is a Hoax</h1><ul class="subline"> <li> <time itemprop="datePublished" datetime="2017-12-19T00:00:00+00:00"> 19 December 2017 </time> </li> <li class="desktop-only" itemprop="locationCreated">Moscow, Russia</li> <li class="printable" itemscope="" itemprop="author" itemtype="http://schema.org/Person"> <span itemprop="name">Yegor Bugayenko</span> </li> <li class="unprintable"> <i class="icon icon-comments"></i> <a href="http://www.yegor256.com/2017/12/19/srp-is-hoax.html#disqus_thread" itemprop="discussionUrl">comments</a> </li></ul><p class="unprintable"><p>The <a href="https://en.wikipedia.org/wiki/Single_responsibility_principle">Single Responsibility Principle</a>, according to <a href="https://en.wikipedia.org/wiki/Robert_Cecil_Martin">Robert Martin</a>&#39;s <a href="http://amzn.to/2m7LmaA">Clean Code</a>, means that &quot;a class should have only one reason to change.&quot; Let&#39;s try to decrypt this rather vague statement and see how it helps us design better object-oriented software. If it does.</p><figure class='jb_picture'><img itemprop='image' alt='The Thomas Crown Affair (1999) by John McTiernan' src='/images/2017/12/the-thomas-crown-affair.jpg' longdesc='#e55eaeb4'/><figcaption id='e55eaeb4'>The Thomas Crown Affair (1999) by John McTiernan</figcaption></figure><p>I mentioned SRP once in <a href="/2017/03/28/solid.html">my post about SOLID</a>, saying that it doesn&#39;t really help programmers understand the good old &quot;<a href="https://en.wikipedia.org/wiki/Cohesion_%28computer_science%29">high cohesion</a>&quot; concept, which was introduced by <a href="https://en.wikipedia.org/wiki/Larry_Constantine">Larry Constantine</a> back in 1974. Now let&#39;s see it by example and analyze how we can improve a class, with the SRP in mind, and whether it will become <a href="/2014/11/20/seven-virtues-of-good-object.html">more object-oriented</a>.</p><p>Let&#39;s try the class <a href="https://github.com/jcabi/jcabi-s3/blob/0.18/src/main/java/com/jcabi/s3/AwsOcket.java"><code>AwsOcket</code></a> from <a href="http://s3.jcabi.com">jcabi-s3</a> (I&#39;ve simplified the code):</p><figure class="highlight"><pre><code class="language-java" data-lang="java"><span></span><span class="kd">class</span> <span class="nc">AwsOcket</span> <span class="o">{</span>
  <span class="kt">boolean</span> <span class="nf">exists</span><span class="o">()</span> <span class="o">{</span> <span class="cm">/* ... */</span> <span class="o">}</span>
  <span class="kt">void</span> <span class="nf">read</span><span class="o">(</span><span class="kd">final</span> <span class="n">OutputStream</span> <span class="n">output</span><span class="o">)</span> <span class="o">{</span> <span class="cm">/* ... */</span> <span class="o">}</span>
  <span class="kt">void</span> <span class="nf">write</span><span class="o">(</span><span class="kd">final</span> <span class="n">InputStream</span> <span class="n">input</span><span class="o">)</span> <span class="o">{</span> <span class="cm">/* ... */</span> <span class="o">}</span>
<span class="o">}</span></code></pre></figure><p>Correct me if I&#39;m wrong, but according to SRP this class is responsible for too many things: 1) checking the existence of an object in AWS S3, 2) reading its content, and 3) modifying its content. Right? It&#39;s not a good design and it must be changed.</p><p>In order to change it and make it responsible for just one thing we must introduce a getter, which will return an AWS client and then create three new classes: <code>ExistenceChecker</code>, <code>ContentReader</code>, and <code>ContentWriter</code>. They will check, read, and write. Now, in order to read the content and print it to the console I&#39;m currently doing this:</p><figure class="highlight"><pre><code class="language-java" data-lang="java"><span></span><span class="k">if</span> <span class="o">(</span><span class="n">ocket</span><span class="o">.</span><span class="na">exists</span><span class="o">())</span> <span class="o">{</span>
  <span class="n">ocket</span><span class="o">.</span><span class="na">read</span><span class="o">(</span><span class="n">System</span><span class="o">.</span><span class="na">out</span><span class="o">);</span>
<span class="o">}</span></code></pre></figure><p>Tomorrow, if I refactor the class, I will be doing this:</p><figure class="highlight"><pre><code class="language-java" data-lang="java"><span></span><span class="k">if</span> <span class="o">(</span><span class="k">new</span> <span class="n">ExistenceChecker</span><span class="o">(</span><span class="n">ocket</span><span class="o">.</span><span class="na">aws</span><span class="o">()).</span><span class="na">exists</span><span class="o">())</span> <span class="o">{</span>
  <span class="k">new</span> <span class="n">ContentReader</span><span class="o">(</span><span class="n">ocket</span><span class="o">.</span><span class="na">aws</span><span class="o">()).</span><span class="na">read</span><span class="o">(</span><span class="n">System</span><span class="o">.</span><span class="na">out</span><span class="o">);</span>
<span class="o">}</span></code></pre></figure><p>Aside from the fact that these checkers, readers, and writers are not really classes, but pure holders of procedures, the usage of this <code>ocket</code> turns into a nightmare. We can&#39;t really know anymore what will happen with it when we pass it somewhere. We can&#39;t, for example, guarantee that the content that is coming from it is decrypted or decoded on the fly. We simply can&#39;t decorate it. It is not an object anymore, but a holder of an AWS client, which is used by some other classes somewhere.</p><p>Yes, now it is responsible for only one thing: encapsulating the reference to the AWS client. It is a perfect class as far as SRP is concerned. But it is not an object anymore.</p><p>The same will happen with any class if you apply the SRP principle to its full extent: it will become a holder of data or of other objects, with a collection of setters and getters on top of them. Maybe with one extra method in addition to those.</p><p>My point is that SRP is a wrong idea.</p><p>Making classes small and cohesive is a good idea, but making them responsible &quot;for one thing&quot; is a misleading simplification of a &quot;high cohesion&quot; concept. It only turns them into dumb carriers of something else, instead of being encapsulators and decorators of smaller entities, to construct bigger ones.</p><p>In our fight for this fake SRP idea we lose a much more important principle, which really is about true object-oriented programming and thinking: encapsulation. It is much less important how many things an object is responsible for than how tightly it protects the entities it encapsulates. A monster object with a hundred methods is much less of a problem than a DTO with five pairs of getters and setters! This is because a DTO spreads the problem all over the code, where we can&#39;t even find it, while the monster object is always right in front of us and we can always refactor it into smaller pieces.</p><p>Encapsulation comes first, size goes next, if ever.</p><blockquote class="twitter-tweet" data-lang="en"><p lang="en" dir="ltr">What do you think about the Single Responsibility Principle (SRP)? <a href="https://twitter.com/hashtag/oop?src=hash&amp;ref_src=twsrc%5Etfw">#oop</a> <a href="https://twitter.com/hashtag/elegantobjects?src=hash&amp;ref_src=twsrc%5Etfw">#elegantobjects</a></p>&mdash; Yegor Bugayenko (@yegor256) <a href="https://twitter.com/yegor256/status/1036247379140399104?ref_src=twsrc%5Etfw">September 2, 2018</a></blockquote> <script async src="https://platform.twitter.com/widgets.js" charset="utf-8"></script></p><nav class="buttons notranslate desktop-only"> <a href="http://www.facebook.com/sharer/sharer.php?u=https://www.yegor256.com/2017/12/19/srp-is-hoax.html" title="Share on Facebook" class="button" rel="nofollow"> <span class="count count-facebook">0</span> <i class="icon icon-facebook notranslate" aria-hidden="true"></i> </a> <a href="https://twitter.com/share?url=https://www.yegor256.com/2017/12/19/srp-is-hoax.html&amp;text=SRP+is+a+Hoax" title="Share on Twitter" class="button" rel="nofollow"> <span class="count count-twitter">0</span> <i class="icon icon-twitter notranslate" aria-hidden="true"></i> </a> <a href="https://plus.google.com/share?url=https://www.yegor256.com/2017/12/19/srp-is-hoax.html" title="Share on Google+" class="button" rel="nofollow"> <span class="count count-googleplus">0</span> <i class="icon icon-googleplus notranslate" aria-hidden="true"></i> </a> <a href="https://www.linkedin.com/cws/share?url=https://www.yegor256.com/2017/12/19/srp-is-hoax.html" title="Share on LinkedIn" class="button" rel="nofollow"> <span class="count count-linkedin">0</span> <i class="icon icon-linkedin notranslate" aria-hidden="true"></i> </a> <a href="http://reddit.com/submit?url=https://www.yegor256.com/2017/12/19/srp-is-hoax.html%3F2017-51&amp;title=SRP+is+a+Hoax" title="Share on Reddit" class="button" rel="nofollow"> <span class="count count-reddit">0</span> <i class="icon icon-reddit notranslate" aria-hidden="true"></i> </a> <a href="http://news.ycombinator.com/submitlink?u=https://www.yegor256.com/2017/12/19/srp-is-hoax.html%3F2017-51&amp;t=SRP+is+a+Hoax" title="Share on Hacker News" class="button" rel="nofollow"> <span class="count count-hackernews">0</span> <i class="icon icon-hackernews notranslate" aria-hidden="true"></i> </a> </nav> </header> <article class="main" itemprop="articleBody"><div ><p>The <a href="https://en.wikipedia.org/wiki/Single_responsibility_principle">Single Responsibility Principle</a>, according to <a href="https://en.wikipedia.org/wiki/Robert_Cecil_Martin">Robert Martin</a>&#39;s <a href="http://amzn.to/2m7LmaA">Clean Code</a>, means that &quot;a class should have only one reason to change.&quot; Let&#39;s try to decrypt this rather vague statement and see how it helps us design better object-oriented software. If it does.</p><figure class='jb_picture'><img itemprop='image' alt='The Thomas Crown Affair (1999) by John McTiernan' src='/images/2017/12/the-thomas-crown-affair.jpg' longdesc='#e55eaeb4'/><figcaption id='e55eaeb4'>The Thomas Crown Affair (1999) by John McTiernan</figcaption></figure><p>I mentioned SRP once in <a href="/2017/03/28/solid.html">my post about SOLID</a>, saying that it doesn&#39;t really help programmers understand the good old &quot;<a href="https://en.wikipedia.org/wiki/Cohesion_%28computer_science%29">high cohesion</a>&quot; concept, which was introduced by <a href="https://en.wikipedia.org/wiki/Larry_Constantine">Larry Constantine</a> back in 1974. Now let&#39;s see it by example and analyze how we can improve a class, with the SRP in mind, and whether it will become <a href="/2014/11/20/seven-virtues-of-good-object.html">more object-oriented</a>.</p><p>Let&#39;s try the class <a href="https://github.com/jcabi/jcabi-s3/blob/0.18/src/main/java/com/jcabi/s3/AwsOcket.java"><code>AwsOcket</code></a> from <a href="http://s3.jcabi.com">jcabi-s3</a> (I&#39;ve simplified the code):</p><figure class="highlight"><pre><code class="language-java" data-lang="java"><span></span><span class="kd">class</span> <span class="nc">AwsOcket</span> <span class="o">{</span>
  <span class="kt">boolean</span> <span class="nf">exists</span><span class="o">()</span> <span class="o">{</span> <span class="cm">/* ... */</span> <span class="o">}</span>
  <span class="kt">void</span> <span class="nf">read</span><span class="o">(</span><span class="kd">final</span> <span class="n">OutputStream</span> <span class="n">output</span><span class="o">)</span> <span class="o">{</span> <span class="cm">/* ... */</span> <span class="o">}</span>
  <span class="kt">void</span> <span class="nf">write</span><span class="o">(</span><span class="kd">final</span> <span class="n">InputStream</span> <span class="n">input</span><span class="o">)</span> <span class="o">{</span> <span class="cm">/* ... */</span> <span class="o">}</span>
<span class="o">}</span></code></pre></figure><p>Correct me if I&#39;m wrong, but according to SRP this class is responsible for too many things: 1) checking the existence of an object in AWS S3, 2) reading its content, and 3) modifying its content. Right? It&#39;s not a good design and it must be changed.</p><p>In order to change it and make it responsible for just one thing we must introduce a getter, which will return an AWS client and then create three new classes: <code>ExistenceChecker</code>, <code>ContentReader</code>, and <code>ContentWriter</code>. They will check, read, and write. Now, in order to read the content and print it to the console I&#39;m currently doing this:</p><figure class="highlight"><pre><code class="language-java" data-lang="java"><span></span><span class="k">if</span> <span class="o">(</span><span class="n">ocket</span><span class="o">.</span><span class="na">exists</span><span class="o">())</span> <span class="o">{</span>
  <span class="n">ocket</span><span class="o">.</span><span class="na">read</span><span class="o">(</span><span class="n">System</span><span class="o">.</span><span class="na">out</span><span class="o">);</span>
<span class="o">}</span></code></pre></figure><p>Tomorrow, if I refactor the class, I will be doing this:</p><figure class="highlight"><pre><code class="language-java" data-lang="java"><span></span><span class="k">if</span> <span class="o">(</span><span class="k">new</span> <span class="n">ExistenceChecker</span><span class="o">(</span><span class="n">ocket</span><span class="o">.</span><span class="na">aws</span><span class="o">()).</span><span class="na">exists</span><span class="o">())</span> <span class="o">{</span>
  <span class="k">new</span> <span class="n">ContentReader</span><span class="o">(</span><span class="n">ocket</span><span class="o">.</span><span class="na">aws</span><span class="o">()).</span><span class="na">read</span><span class="o">(</span><span class="n">System</span><span class="o">.</span><span class="na">out</span><span class="o">);</span>
<span class="o">}</span></code></pre></figure><p>Aside from the fact that these checkers, readers, and writers are not really classes, but pure holders of procedures, the usage of this <code>ocket</code> turns into a nightmare. We can&#39;t really know anymore what will happen with it when we pass it somewhere. We can&#39;t, for example, guarantee that the content that is coming from it is decrypted or decoded on the fly. We simply can&#39;t decorate it. It is not an object anymore, but a holder of an AWS client, which is used by some other classes somewhere.</p><p>Yes, now it is responsible for only one thing: encapsulating the reference to the AWS client. It is a perfect class as far as SRP is concerned. But it is not an object anymore.</p><p>The same will happen with any class if you apply the SRP principle to its full extent: it will become a holder of data or of other objects, with a collection of setters and getters on top of them. Maybe with one extra method in addition to those.</p><p>My point is that SRP is a wrong idea.</p><p>Making classes small and cohesive is a good idea, but making them responsible &quot;for one thing&quot; is a misleading simplification of a &quot;high cohesion&quot; concept. It only turns them into dumb carriers of something else, instead of being encapsulators and decorators of smaller entities, to construct bigger ones.</p><p>In our fight for this fake SRP idea we lose a much more important principle, which really is about true object-oriented programming and thinking: encapsulation. It is much less important how many things an object is responsible for than how tightly it protects the entities it encapsulates. A monster object with a hundred methods is much less of a problem than a DTO with five pairs of getters and setters! This is because a DTO spreads the problem all over the code, where we can&#39;t even find it, while the monster object is always right in front of us and we can always refactor it into smaller pieces.</p><p>Encapsulation comes first, size goes next, if ever.</p><blockquote class="twitter-tweet" data-lang="en"><p lang="en" dir="ltr">What do you think about the Single Responsibility Principle (SRP)? <a href="https://twitter.com/hashtag/oop?src=hash&amp;ref_src=twsrc%5Etfw">#oop</a> <a href="https://twitter.com/hashtag/elegantobjects?src=hash&amp;ref_src=twsrc%5Etfw">#elegantobjects</a></p>&mdash; Yegor Bugayenko (@yegor256) <a href="https://twitter.com/yegor256/status/1036247379140399104?ref_src=twsrc%5Etfw">September 2, 2018</a></blockquote> <script async src="https://platform.twitter.com/widgets.js" charset="utf-8"></script></div></article></div><div class="wrapper"> <related-posts /></div><div class="disqus" role="complementary"><p class="disqus_hint"> Please, use <a href="https://help.disqus.com/commenting/what-html-tags-are-allowed-within-comments">syntax highlighting</a> in your comments, to make them more readable.</p><div id="disqus_thread" class="disqus-thread"> <a>&nbsp;</a></div><script> var disqus_config = function () { this.page.url = document.location.href.split('?')[0].split('#')[0].replace('https://', 'http://'); this.page.identifier = this.page.url; }; (function() { var d = document, s = d.createElement('script'); s.src = '//yegor256.disqus.com/embed.js'; s.setAttribute('data-timestamp', +new Date()); (d.head || d.body).appendChild(s); })(); </script> <noscript><div><p class="red"> JavaScript is disabled in your browser, that's why you can't see comments under this post.</p></div></noscript></div><div class="wrapper"> <footer class="footer"><p> &copy; <span itemscope="" itemprop="copyrightHolder" itemtype="http://schema.org/Person"> <span itemprop="name">Yegor Bugayenko</span> </span> 2014&ndash;<span itemprop="copyrightYear">2018</span></p></footer></div></section><div class="wrapper unprintable" style="text-align:center;margin-top:2em;"> <a href="http://www.sixnines.io/h/3ba1652f"> <img src="//www.sixnines.io/b/3ba1652f?style=flat" alt="sixnines availability badge"/> </a></div><script src="//code.jquery.com/jquery-1.9.0.min.js"></script> <script src="/js/all.js?a0e0d018c07"></script> <script>var disqus_shortname = 'yegor256';</script> <script id="dsq-count-scr" src="//yegor256.disqus.com/count.js" async="async"></script> <script> (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){ (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o), m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m) })(window,document,'script','//www.google-analytics.com/analytics.js','ga'); ga('create', 'UA-1963507-32', 'auto'); ga('send', 'pageview'); </script> <script> Cd=document;Cr="&"+Math.random();Cp="&s=1"; Cd.cookie="b=b";if(Cd.cookie)Cp+="&c=1"; Cp+="&t="+(new Date()).getTimezoneOffset(); if(self!=top)Cp+="&f=1"; </script> <script> if(navigator.javaEnabled())Cp+="&j=1"; </script> <script> if(typeof(screen)!='undefined')Cp+="&w="+screen.width+"&h="+ screen.height+"&d="+(screen.colorDepth?screen.colorDepth:screen.pixelDepth); </script> <script> Cd.write("<img src='//c.hit.ua/hit?i=95870&g=0&x=2"+Cp+Cr+ "&r="+escape(Cd.referrer)+"&u="+escape(window.location.href)+ "' border='0' wi"+"dth='1' he"+"ight='1'/>"); </script> <script type="application/ld+json"> { "@context": "http://schema.org", "@type": "Person", "name": "Yegor Bugayenko", "url": "http://www.yegor256.com", "sameAs": [ "https://www.facebook.com/yegor256", "https://instagram.com/yegor256", "https://www.linkedin.com/in/yegor256", "https://twitter.com/yegor256", "https://github.com/yegor256", "https://www.pinterest.com/yegor256/" ] } </script> </body> </html> <!DOCTYPE html> <html xmlns="http://www.w3.org/1999/xhtml" lang="en-US" xml:lang="en-US" itemscope="" itemtype="http://schema.org/WebSite"> <head> <meta charset="utf-8"/> <meta name="description" content="Data Access Object (DAO) is a design pattern that is supposed to abstract a persistence layer from a business one; its implementation is very wrong. " /> <meta name="keywords" content="dao, dao in oop, data access object, data access objects, database access object" /> <meta name="viewport" content="width=device-width,minimum-scale=1,initial-scale=1"/> <meta name="google-site-verification" content="JEj_gQr2CPe2QKGw8XdMz0R7VboQIUbX3FlM-lwTq-8" /> <meta name="author" content="Yegor Bugayenko"> <meta name="article:published_time" content="2017-12-05 00:00:00 +0000"> <meta name="og:site_name" content="Yegor Bugayenko"/> <meta name="og:type" content="article" /> <meta name="og:locale" content="en_US" /> <meta name="twitter:account_id" content="4503599630178231" /> <meta name="twitter:creator" content="@yegor256"/> <meta name="twitter:site" content="@yegor256"/> <meta name="twitter:title" property="og:title" content="DAO is Yet Another OOP Shame"/> <meta name="twitter:description" property="og:description" content="Data Access Object (DAO) is a design pattern that is supposed to abstract a persistence layer from a business one; its implementation is very wrong. "/> <meta name="twitter:url" property="og:url" content="https://www.yegor256.com/2017/12/05/data-access-object.html"/> <meta name="telegram:channel" content="AAAAAEJFMRzsRTRxM3ec6A"/> <link rel="search" type="application/opensearchdescription+xml" href="/opensearch.xml" title="yegor256" /> <link rel="shortcut icon" href="/favicon.ico?a0e0d018c07"/> <link rel="apple-touch-icon" href="/favicon.ico?a0e0d018c07"/> <link rel="alternate" type="application/rss+xml" title="RSS for yegor256.com" href="https://www.yegor256.com/rss.xml"/> <link rel="stylesheet" href="/css/layout.css?a0e0d018c07"/> <link rel="stylesheet" href="/css/icons.css?a0e0d018c07"/> <link rel="canonical" href="https://www.yegor256.com/2017/12/05/data-access-object.html" /> <link rel="amphtml" href="https://www.yegor256.com/2017/12/05/data-access-object.amp.html" /> <title>DAO is Yet Another OOP Shame </title> <meta name='og:image' content='https://www.yegor256.com/images/2017/12/requiem-for-a-dream.jpg'/><meta name='twitter:image' content='https://www.yegor256.com/images/2017/12/requiem-for-a-dream.jpg'/><meta name='og:image:width' content='1330'/> <meta name='twitter:image:width' content='1330'/><meta name='og:image:height' content='748'/> <meta name='twitter:image:height' content='748'/><meta name='twitter:card' content='summary_large_image'/><meta name='twitter:image:alt' content='Requiem for a Dream (2000) by Darren Aronofsky'/> </head> <body><div class="wrapper"> <aside class="header-toggle unprintable" id="header-toggle" title="Show the menu" onclick="$('#header').show();$('#header-toggle').hide();">&#9776;</aside> <header class="header" id="header"><div class="face"> <a href="/about-me.html#form" class="sub" title="Click to subscribe to my monthly newsletter"><span>Subscribe</span></a> <a href="/about-me.html" style="position:relative;"> <img src="/images/face-256x256.jpg" class="photo" alt="Yegor Bugayenko"/> </a></div><nav><ul class="menu social notranslate"> <li><a href="https://twitter.com/intent/follow?screen_name=yegor256" rel="nofollow" title="Follow me on Twitter"><i class="icon icon-twitter notranslate" aria-hidden="true"></i></a></li> <li><a href="/rss.xml" rel="nofollow" title="Subscribe to my RSS feed"><i class="icon icon-rss notranslate" aria-hidden="true"></i></a></li> <li><a itemprop="sameAs" href="https://github.com/yegor256" rel="nofollow" title="My GitHub profile"><i class="icon icon-github notranslate" aria-hidden="true"></i></a></li> <li><a itemprop="sameAs" href="http://stackoverflow.com/users/187141/yegor256" rel="nofollow" title="My StackOverflow profile"><i class="icon icon-stackoverflow notranslate" aria-hidden="true"></i></a></li> <li><a itemprop="sameAs" href="https://www.facebook.com/yegor256" rel="nofollow" title="Follow me on Facebook"><i class="icon icon-facebook notranslate" aria-hidden="true"></i></a></li> <li><a itemprop="sameAs" href="https://instagram.com/yegor256" rel="nofollow" title="Follow me on Instagram"><i class="icon icon-instagram notranslate" aria-hidden="true"></i></a></li> <li><a itemprop="sameAs" href="https://www.linkedin.com/in/yegor256" rel="nofollow" title="My LinkedIn profile"><i class="icon icon-linkedin notranslate" aria-hidden="true"></i></a></li> <li><a itemprop="sameAs" href="https://www.youtube.com/c/yegor256?sub_confirmation=1" rel="nofollow" title="My Youtube video channel"><i class="icon icon-youtube notranslate" aria-hidden="true"></i></a></li> <li><a itemprop="sameAs" href="https://www.pinterest.com/yegor256/" rel="nofollow" title="My Pinterest boards"><i class="icon icon-pinterest notranslate" aria-hidden="true"></i></a></li> <li><a itemprop="sameAs" href="https://angel.co/yegor256" rel="nofollow" title="My AngelList profile"><i class="icon icon-angellist notranslate" aria-hidden="true"></i></a></li> <li><a href="https://soundcloud.com/yegor256" rel="nofollow" title="My podcast"><i class="icon icon-podcast notranslate" aria-hidden="true"></i></a></li> <li><a href="https://itunes.apple.com/us/podcast/yegor256-podcast/id1150826721" rel="nofollow" title="My iTunes podcast"><i class="icon icon-itunes notranslate" aria-hidden="true"></i></a></li> <li><a href="https://t.me/joinchat/AAAAAEJFMRzsRTRxM3ec6A" rel="nofollow" title="My Telegram public channel"><i class="icon icon-telegram notranslate" aria-hidden="true"></i></a></li> <li><a href="mailto:blog@yegor256.com" rel="nofollow" title="Email me any time"><i class="icon icon-mail notranslate" aria-hidden="true"></i></a></li></ul><ul class="menu"> <li><a href="/" title="Home page">Home</a></li> <li ><a href="/best.html" title="Best articles to read">12&#160;Best</a></li> <li ><a href="/contents.html" title="The contents of the entire blog">All&#160;288</a></li> <li ><a href="/webinars.html" title="My webinars">Webinars</a></li> <li ><a href="/talks.html" title="Future and past conference talks">Talks</a></li> <li ><a href="/books.html" title="The books I wrote">Books</a></li> <li ><a href="/papers.html" title="My academic papers and patents">Papers</a></li> <li ><a href="/pets.html" title="My loved pet projects">Pets</a></li> <li ><a href="/award.html" title="Software quality award">Award</a></li> <li ><a href="/testimonials.html" title="What some people say about me">Testimonials</a></li> <li ><a href="/shift-m.html" title="Audio podcast about project management">Shift-M</a></li> <li ><a href="/paintings.html" title="My paintings for sale">Paintings</a></li> <li><a href="http://ru.yegor256.com/" title="Немного на русском языке">По-русски</a></li></ul></nav><div class="search"> <form method="get" action="https://www.google.com/search" itemprop="potentialAction" itemscope="" itemtype="http://schema.org/SearchAction"> <meta itemprop="target" content="https://www.google.com/search?q={q}"/> <input name="sitesearch" value="yegor256.com" type="hidden"/> <input itemprop="query-input" type="text" id="search-query" class="field field-text" required="required" onfocus="$('.google').css('visibility', 'visible');" name="q" placeholder="Search..." autocomplete="off"/> <input type="image" src="/images/google-search-icon.svg" class="google" title="Search via Google" alt="Search via Google"/> </form></div><div class="hot"><ul> <li> <a href="/code-ahead.html">Code Ahead</a> was published on Amazon just a few days ago! It is my new book, a novel about programmers. It explains in details the majority of ideas that stand behind <a href="https://www.zerocracy.com">Zerocracy</a> and <a href="https://www.xdsd.org">XDSD</a>. </li> <li> At <a href="/webinars.html">Webinar #37</a> we will discuss naming problem in OOP, for objects, methods and attributes; join us on <b>September 12</b>, at 11am PST. </li></ul></div></header></div><section itemscope="" itemtype="http://schema.org/BlogPosting"><div class="wrapper"> <header><p class="printable"> <img src="https://api.qrserver.com/v1/create-qr-code/?data=https://www.yegor256.com/2017/12/05/data-access-object.html&amp;format=svg" style="width:125px;height:125px;" alt="QR code"/></p><p class="printable"> <code itemprop="url">https://www.yegor256.com/2017/12/05/data-access-object.html</code></p><h1 itemprop="name headline mainEntityOfPage">DAO is Yet Another OOP Shame</h1><ul class="subline"> <li> <time itemprop="datePublished" datetime="2017-12-05T00:00:00+00:00"> 5 December 2017 </time> </li> <li class="desktop-only" itemprop="locationCreated">Odessa, Ukraine</li> <li class="printable" itemscope="" itemprop="author" itemtype="http://schema.org/Person"> <span itemprop="name">Yegor Bugayenko</span> </li> <li class="unprintable"> <i class="icon icon-comments"></i> <a href="http://www.yegor256.com/2017/12/05/data-access-object.html#disqus_thread" itemprop="discussionUrl">comments</a> </li></ul><p class="unprintable"><p>Someone asked me what I think about DAO and I realized that, even though I wrote about <a href="/2014/12/01/orm-offensive-anti-pattern.html">ORM</a>, <a href="/2016/07/06/data-transfer-object.html">DTO</a>, and <a href="/2014/09/16/getters-and-setters-are-evil.html">getters</a>, I haven&#39;t had a chance yet to mention DAO. Here is my take on it: it&#39;s as much of a shame as its friends---ORM, DTO, and getters. In a nutshell, a <a href="http://www.oracle.com/technetwork/java/dataaccessobject-138824.html">Data Access Object</a> is an object <a href="https://en.wikipedia.org/wiki/Data_access_object">that</a> &quot;provides an abstract interface to some type of database or other persistence mechanism.&quot; The purpose is noble, but the implementation is terrible.</p><figure class='jb_picture'><img itemprop='image' alt='Requiem for a Dream (2000) by Darren Aronofsky' src='/images/2017/12/requiem-for-a-dream.jpg' longdesc='#edf81e4e'/><figcaption id='edf81e4e'>Requiem for a Dream (2000) by Darren Aronofsky</figcaption></figure><p>Here is how it <a href="https://stackoverflow.com/a/19154487/187141">may look</a>:</p><figure class="highlight"><pre><code class="language-java" data-lang="java"><span></span><span class="kd">class</span> <span class="nc">BookDAO</span> <span class="o">{</span>
  <span class="n">Book</span> <span class="nf">find</span><span class="o">(</span><span class="kt">int</span> <span class="n">id</span><span class="o">);</span>
  <span class="kt">void</span> <span class="nf">update</span><span class="o">(</span><span class="n">Book</span> <span class="n">book</span><span class="o">);</span>
  <span class="c1">// Other methods here ...</span>
<span class="o">}</span></code></pre></figure><p>The idea is simple---method <code>find()</code> creates a <a href="/2016/07/06/data-transfer-object.html">DTO</a> <code>Book</code>, someone else injects new data into it and calls <code>update()</code>:</p><figure class="highlight"><pre><code class="language-java" data-lang="java"><span></span><span class="n">BookDAO</span> <span class="n">dao</span> <span class="o">=</span> <span class="n">BookDAOFactory</span><span class="o">.</span><span class="na">getBookDAO</span><span class="o">();</span>
<span class="n">Book</span> <span class="n">book</span> <span class="o">=</span> <span class="n">dao</span><span class="o">.</span><span class="na">find</span><span class="o">(</span><span class="mi">123</span><span class="o">);</span>
<span class="n">book</span><span class="o">.</span><span class="na">setTitle</span><span class="o">(</span><span class="s">&quot;Don Quixote&quot;</span><span class="o">);</span>
<span class="n">dao</span><span class="o">.</span><span class="na">update</span><span class="o">(</span><span class="n">book</span><span class="o">);</span></code></pre></figure><p>What is wrong, you ask? Everything that was wrong with <a href="/2014/12/01/orm-offensive-anti-pattern.html">ORM</a>, but instead of a &quot;session&quot; we have this DAO. The problem remains the same: the <code>book</code> is not an object, but a data container. I quote my own three-year-old statement from the <a href="/2014/12/01/orm-offensive-anti-pattern.html">ORM article</a>, with a slight change in the name: &quot;DAO, instead of encapsulating database interaction inside an object, extracts it away, literally tearing a solid and cohesive living organism apart.&quot; For more details, please check that article.</p><p>However, I have to say that I have something like DAOs in most of my <a href="/pets.html">pet projects</a>, but they don&#39;t return or accept DTOs. Instead, they return objects and sometimes accept operations on them. Here are a few examples. Look at this <a href="https://github.com/yegor256/wring/blob/0.17.4/src/main/java/io/wring/model/Pipes.java"><code>Pipes</code></a> interface from <a href="/2016/03/15/wring-dispatcher-github-notifications.html">Wring.io</a>:</p><figure class="highlight"><pre><code class="language-java" data-lang="java"><span></span><span class="kd">interface</span> <span class="nc">Pipes</span> <span class="o">{</span>
  <span class="kt">void</span> <span class="nf">add</span><span class="o">(</span><span class="n">String</span> <span class="n">json</span><span class="o">);</span>
  <span class="n">Pipe</span> <span class="nf">pipe</span><span class="o">(</span><span class="kt">long</span> <span class="n">number</span><span class="o">);</span>
<span class="o">}</span></code></pre></figure><p>Its method <a href="https://github.com/yegor256/wring/blob/0.17.4/src/main/java/io/wring/model/Pipes.java#L55"><code>add()</code></a> creates a new item in the &quot;collection&quot; and method <a href="https://github.com/yegor256/wring/blob/0.17.4/src/main/java/io/wring/model/Pipes.java#L62"><code>pipe()</code></a> returns a single object from the collection. The <a href="https://github.com/yegor256/wring/blob/0.17.4/src/main/java/io/wring/model/Pipe.java"><code>Pipe</code></a> is not a DTO, it is a normal object that is fully capable of doing all necessary database operations, without any help from a DAO. For example, there is <a href="https://github.com/yegor256/wring/blob/0.17.4/src/main/java/io/wring/model/Pipe.java#L63"><code>Pipe.status(String)</code></a> method to update its status. I&#39;m not going to use <code>Pipes</code> for that, I just do <code>pipe.status(&quot;Hello, world!&quot;)</code>.</p><p>Here is yet another example from <a href="/2016/03/30/jare-instant-free-cdn.html">Jare.io</a>: interface <a href="https://github.com/yegor256/jare/blob/0.11/src/main/java/io/jare/model/Base.java"><code>Base</code></a> which returns a list of objects of type <a href="https://github.com/yegor256/jare/blob/0.11/src/main/java/io/jare/model/Domain.java"><code>Domain</code></a>. Then, when we want to delete a domain, we just call <a href="https://github.com/yegor256/jare/blob/0.11/src/main/java/io/jare/model/Domain.java#L54"><code>domain.delete()</code></a>. The domain is fully capable of doing all necessary database manipulations.</p><p>The problem with DAO is right in its name, I believe. It says that we are accessing &quot;data&quot; and does exactly that: goes to the database, retrieves some data, and returns <em>data</em>. Not an object, but data, also known as a &quot;data transfer object.&quot; As we <a href="/2016/11/21/naked-data.html">discussed before</a>, direct data manipulations are what break encapsulation and make object-oriented code procedural and unmaintainable.</p></p><nav class="buttons notranslate desktop-only"> <a href="http://www.facebook.com/sharer/sharer.php?u=https://www.yegor256.com/2017/12/05/data-access-object.html" title="Share on Facebook" class="button" rel="nofollow"> <span class="count count-facebook">0</span> <i class="icon icon-facebook notranslate" aria-hidden="true"></i> </a> <a href="https://twitter.com/share?url=https://www.yegor256.com/2017/12/05/data-access-object.html&amp;text=DAO+is+Yet+Another+OOP+Shame" title="Share on Twitter" class="button" rel="nofollow"> <span class="count count-twitter">0</span> <i class="icon icon-twitter notranslate" aria-hidden="true"></i> </a> <a href="https://plus.google.com/share?url=https://www.yegor256.com/2017/12/05/data-access-object.html" title="Share on Google+" class="button" rel="nofollow"> <span class="count count-googleplus">0</span> <i class="icon icon-googleplus notranslate" aria-hidden="true"></i> </a> <a href="https://www.linkedin.com/cws/share?url=https://www.yegor256.com/2017/12/05/data-access-object.html" title="Share on LinkedIn" class="button" rel="nofollow"> <span class="count count-linkedin">0</span> <i class="icon icon-linkedin notranslate" aria-hidden="true"></i> </a> <a href="http://reddit.com/submit?url=https://www.yegor256.com/2017/12/05/data-access-object.html%3F2017-49&amp;title=DAO+is+Yet+Another+OOP+Shame" title="Share on Reddit" class="button" rel="nofollow"> <span class="count count-reddit">0</span> <i class="icon icon-reddit notranslate" aria-hidden="true"></i> </a> <a href="http://news.ycombinator.com/submitlink?u=https://www.yegor256.com/2017/12/05/data-access-object.html%3F2017-49&amp;t=DAO+is+Yet+Another+OOP+Shame" title="Share on Hacker News" class="button" rel="nofollow"> <span class="count count-hackernews">0</span> <i class="icon icon-hackernews notranslate" aria-hidden="true"></i> </a> </nav> </header> <article class="main" itemprop="articleBody"><div ><p>Someone asked me what I think about DAO and I realized that, even though I wrote about <a href="/2014/12/01/orm-offensive-anti-pattern.html">ORM</a>, <a href="/2016/07/06/data-transfer-object.html">DTO</a>, and <a href="/2014/09/16/getters-and-setters-are-evil.html">getters</a>, I haven&#39;t had a chance yet to mention DAO. Here is my take on it: it&#39;s as much of a shame as its friends---ORM, DTO, and getters. In a nutshell, a <a href="http://www.oracle.com/technetwork/java/dataaccessobject-138824.html">Data Access Object</a> is an object <a href="https://en.wikipedia.org/wiki/Data_access_object">that</a> &quot;provides an abstract interface to some type of database or other persistence mechanism.&quot; The purpose is noble, but the implementation is terrible.</p><figure class='jb_picture'><img itemprop='image' alt='Requiem for a Dream (2000) by Darren Aronofsky' src='/images/2017/12/requiem-for-a-dream.jpg' longdesc='#edf81e4e'/><figcaption id='edf81e4e'>Requiem for a Dream (2000) by Darren Aronofsky</figcaption></figure><p>Here is how it <a href="https://stackoverflow.com/a/19154487/187141">may look</a>:</p><figure class="highlight"><pre><code class="language-java" data-lang="java"><span></span><span class="kd">class</span> <span class="nc">BookDAO</span> <span class="o">{</span>
  <span class="n">Book</span> <span class="nf">find</span><span class="o">(</span><span class="kt">int</span> <span class="n">id</span><span class="o">);</span>
  <span class="kt">void</span> <span class="nf">update</span><span class="o">(</span><span class="n">Book</span> <span class="n">book</span><span class="o">);</span>
  <span class="c1">// Other methods here ...</span>
<span class="o">}</span></code></pre></figure><p>The idea is simple---method <code>find()</code> creates a <a href="/2016/07/06/data-transfer-object.html">DTO</a> <code>Book</code>, someone else injects new data into it and calls <code>update()</code>:</p><figure class="highlight"><pre><code class="language-java" data-lang="java"><span></span><span class="n">BookDAO</span> <span class="n">dao</span> <span class="o">=</span> <span class="n">BookDAOFactory</span><span class="o">.</span><span class="na">getBookDAO</span><span class="o">();</span>
<span class="n">Book</span> <span class="n">book</span> <span class="o">=</span> <span class="n">dao</span><span class="o">.</span><span class="na">find</span><span class="o">(</span><span class="mi">123</span><span class="o">);</span>
<span class="n">book</span><span class="o">.</span><span class="na">setTitle</span><span class="o">(</span><span class="s">&quot;Don Quixote&quot;</span><span class="o">);</span>
<span class="n">dao</span><span class="o">.</span><span class="na">update</span><span class="o">(</span><span class="n">book</span><span class="o">);</span></code></pre></figure><p>What is wrong, you ask? Everything that was wrong with <a href="/2014/12/01/orm-offensive-anti-pattern.html">ORM</a>, but instead of a &quot;session&quot; we have this DAO. The problem remains the same: the <code>book</code> is not an object, but a data container. I quote my own three-year-old statement from the <a href="/2014/12/01/orm-offensive-anti-pattern.html">ORM article</a>, with a slight change in the name: &quot;DAO, instead of encapsulating database interaction inside an object, extracts it away, literally tearing a solid and cohesive living organism apart.&quot; For more details, please check that article.</p><p>However, I have to say that I have something like DAOs in most of my <a href="/pets.html">pet projects</a>, but they don&#39;t return or accept DTOs. Instead, they return objects and sometimes accept operations on them. Here are a few examples. Look at this <a href="https://github.com/yegor256/wring/blob/0.17.4/src/main/java/io/wring/model/Pipes.java"><code>Pipes</code></a> interface from <a href="/2016/03/15/wring-dispatcher-github-notifications.html">Wring.io</a>:</p><figure class="highlight"><pre><code class="language-java" data-lang="java"><span></span><span class="kd">interface</span> <span class="nc">Pipes</span> <span class="o">{</span>
  <span class="kt">void</span> <span class="nf">add</span><span class="o">(</span><span class="n">String</span> <span class="n">json</span><span class="o">);</span>
  <span class="n">Pipe</span> <span class="nf">pipe</span><span class="o">(</span><span class="kt">long</span> <span class="n">number</span><span class="o">);</span>
<span class="o">}</span></code></pre></figure><p>Its method <a href="https://github.com/yegor256/wring/blob/0.17.4/src/main/java/io/wring/model/Pipes.java#L55"><code>add()</code></a> creates a new item in the &quot;collection&quot; and method <a href="https://github.com/yegor256/wring/blob/0.17.4/src/main/java/io/wring/model/Pipes.java#L62"><code>pipe()</code></a> returns a single object from the collection. The <a href="https://github.com/yegor256/wring/blob/0.17.4/src/main/java/io/wring/model/Pipe.java"><code>Pipe</code></a> is not a DTO, it is a normal object that is fully capable of doing all necessary database operations, without any help from a DAO. For example, there is <a href="https://github.com/yegor256/wring/blob/0.17.4/src/main/java/io/wring/model/Pipe.java#L63"><code>Pipe.status(String)</code></a> method to update its status. I&#39;m not going to use <code>Pipes</code> for that, I just do <code>pipe.status(&quot;Hello, world!&quot;)</code>.</p><p>Here is yet another example from <a href="/2016/03/30/jare-instant-free-cdn.html">Jare.io</a>: interface <a href="https://github.com/yegor256/jare/blob/0.11/src/main/java/io/jare/model/Base.java"><code>Base</code></a> which returns a list of objects of type <a href="https://github.com/yegor256/jare/blob/0.11/src/main/java/io/jare/model/Domain.java"><code>Domain</code></a>. Then, when we want to delete a domain, we just call <a href="https://github.com/yegor256/jare/blob/0.11/src/main/java/io/jare/model/Domain.java#L54"><code>domain.delete()</code></a>. The domain is fully capable of doing all necessary database manipulations.</p><p>The problem with DAO is right in its name, I believe. It says that we are accessing &quot;data&quot; and does exactly that: goes to the database, retrieves some data, and returns <em>data</em>. Not an object, but data, also known as a &quot;data transfer object.&quot; As we <a href="/2016/11/21/naked-data.html">discussed before</a>, direct data manipulations are what break encapsulation and make object-oriented code procedural and unmaintainable.</p></div></article></div><div class="wrapper"> <related-posts /></div><div class="disqus" role="complementary"><p class="disqus_hint"> Please, use <a href="https://help.disqus.com/commenting/what-html-tags-are-allowed-within-comments">syntax highlighting</a> in your comments, to make them more readable.</p><div id="disqus_thread" class="disqus-thread"> <a>&nbsp;</a></div><script> var disqus_config = function () { this.page.url = document.location.href.split('?')[0].split('#')[0].replace('https://', 'http://'); this.page.identifier = this.page.url; }; (function() { var d = document, s = d.createElement('script'); s.src = '//yegor256.disqus.com/embed.js'; s.setAttribute('data-timestamp', +new Date()); (d.head || d.body).appendChild(s); })(); </script> <noscript><div><p class="red"> JavaScript is disabled in your browser, that's why you can't see comments under this post.</p></div></noscript></div><div class="wrapper"> <footer class="footer"><p> &copy; <span itemscope="" itemprop="copyrightHolder" itemtype="http://schema.org/Person"> <span itemprop="name">Yegor Bugayenko</span> </span> 2014&ndash;<span itemprop="copyrightYear">2018</span></p></footer></div></section><div class="wrapper unprintable" style="text-align:center;margin-top:2em;"> <a href="http://www.sixnines.io/h/3ba1652f"> <img src="//www.sixnines.io/b/3ba1652f?style=flat" alt="sixnines availability badge"/> </a></div><script src="//code.jquery.com/jquery-1.9.0.min.js"></script> <script src="/js/all.js?a0e0d018c07"></script> <script>var disqus_shortname = 'yegor256';</script> <script id="dsq-count-scr" src="//yegor256.disqus.com/count.js" async="async"></script> <script> (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){ (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o), m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m) })(window,document,'script','//www.google-analytics.com/analytics.js','ga'); ga('create', 'UA-1963507-32', 'auto'); ga('send', 'pageview'); </script> <script> Cd=document;Cr="&"+Math.random();Cp="&s=1"; Cd.cookie="b=b";if(Cd.cookie)Cp+="&c=1"; Cp+="&t="+(new Date()).getTimezoneOffset(); if(self!=top)Cp+="&f=1"; </script> <script> if(navigator.javaEnabled())Cp+="&j=1"; </script> <script> if(typeof(screen)!='undefined')Cp+="&w="+screen.width+"&h="+ screen.height+"&d="+(screen.colorDepth?screen.colorDepth:screen.pixelDepth); </script> <script> Cd.write("<img src='//c.hit.ua/hit?i=95870&g=0&x=2"+Cp+Cr+ "&r="+escape(Cd.referrer)+"&u="+escape(window.location.href)+ "' border='0' wi"+"dth='1' he"+"ight='1'/>"); </script> <script type="application/ld+json"> { "@context": "http://schema.org", "@type": "Person", "name": "Yegor Bugayenko", "url": "http://www.yegor256.com", "sameAs": [ "https://www.facebook.com/yegor256", "https://instagram.com/yegor256", "https://www.linkedin.com/in/yegor256", "https://twitter.com/yegor256", "https://github.com/yegor256", "https://www.pinterest.com/yegor256/" ] } </script> </body> </html> <!DOCTYPE html> <html xmlns="http://www.w3.org/1999/xhtml" lang="en-US" xml:lang="en-US" itemscope="" itemtype="http://schema.org/WebSite"> <head> <meta charset="utf-8"/> <meta name="description" content="Static factory methods are supposed to be a convenient replacement of object constructors; however, I disagree with this idea and explain why. " /> <meta name="keywords" content="constructor or factory, constructors, factories vs constructiors, factory method, factory methods" /> <meta name="viewport" content="width=device-width,minimum-scale=1,initial-scale=1"/> <meta name="google-site-verification" content="JEj_gQr2CPe2QKGw8XdMz0R7VboQIUbX3FlM-lwTq-8" /> <meta name="author" content="Yegor Bugayenko"> <meta name="article:published_time" content="2017-11-14 00:00:00 +0000"> <meta name="og:site_name" content="Yegor Bugayenko"/> <meta name="og:type" content="article" /> <meta name="og:locale" content="en_US" /> <meta name="twitter:account_id" content="4503599630178231" /> <meta name="twitter:creator" content="@yegor256"/> <meta name="twitter:site" content="@yegor256"/> <meta name="twitter:title" property="og:title" content="Constructors or Static Factory Methods?"/> <meta name="twitter:description" property="og:description" content="Static factory methods are supposed to be a convenient replacement of object constructors; however, I disagree with this idea and explain why. "/> <meta name="twitter:url" property="og:url" content="https://www.yegor256.com/2017/11/14/static-factory-methods.html"/> <meta name="telegram:channel" content="AAAAAEJFMRzsRTRxM3ec6A"/> <link rel="search" type="application/opensearchdescription+xml" href="/opensearch.xml" title="yegor256" /> <link rel="shortcut icon" href="/favicon.ico?a0e0d018c07"/> <link rel="apple-touch-icon" href="/favicon.ico?a0e0d018c07"/> <link rel="alternate" type="application/rss+xml" title="RSS for yegor256.com" href="https://www.yegor256.com/rss.xml"/> <link rel="stylesheet" href="/css/layout.css?a0e0d018c07"/> <link rel="stylesheet" href="/css/icons.css?a0e0d018c07"/> <link rel="canonical" href="https://www.yegor256.com/2017/11/14/static-factory-methods.html" /> <link rel="amphtml" href="https://www.yegor256.com/2017/11/14/static-factory-methods.amp.html" /> <title>Constructors or Static Factory Methods? </title> <meta name='og:image' content='https://www.yegor256.com/images/2017/11/extract.jpg'/><meta name='twitter:image' content='https://www.yegor256.com/images/2017/11/extract.jpg'/><meta name='og:image:width' content='1280'/> <meta name='twitter:image:width' content='1280'/><meta name='og:image:height' content='688'/> <meta name='twitter:image:height' content='688'/><meta name='twitter:card' content='summary_large_image'/><meta name='twitter:image:alt' content='Extract (2009) by Mike Judge'/> </head> <body><div class="wrapper"> <aside class="header-toggle unprintable" id="header-toggle" title="Show the menu" onclick="$('#header').show();$('#header-toggle').hide();">&#9776;</aside> <header class="header" id="header"><div class="face"> <a href="/about-me.html#form" class="sub" title="Click to subscribe to my monthly newsletter"><span>Subscribe</span></a> <a href="/about-me.html" style="position:relative;"> <img src="/images/face-256x256.jpg" class="photo" alt="Yegor Bugayenko"/> </a></div><nav><ul class="menu social notranslate"> <li><a href="https://twitter.com/intent/follow?screen_name=yegor256" rel="nofollow" title="Follow me on Twitter"><i class="icon icon-twitter notranslate" aria-hidden="true"></i></a></li> <li><a href="/rss.xml" rel="nofollow" title="Subscribe to my RSS feed"><i class="icon icon-rss notranslate" aria-hidden="true"></i></a></li> <li><a itemprop="sameAs" href="https://github.com/yegor256" rel="nofollow" title="My GitHub profile"><i class="icon icon-github notranslate" aria-hidden="true"></i></a></li> <li><a itemprop="sameAs" href="http://stackoverflow.com/users/187141/yegor256" rel="nofollow" title="My StackOverflow profile"><i class="icon icon-stackoverflow notranslate" aria-hidden="true"></i></a></li> <li><a itemprop="sameAs" href="https://www.facebook.com/yegor256" rel="nofollow" title="Follow me on Facebook"><i class="icon icon-facebook notranslate" aria-hidden="true"></i></a></li> <li><a itemprop="sameAs" href="https://instagram.com/yegor256" rel="nofollow" title="Follow me on Instagram"><i class="icon icon-instagram notranslate" aria-hidden="true"></i></a></li> <li><a itemprop="sameAs" href="https://www.linkedin.com/in/yegor256" rel="nofollow" title="My LinkedIn profile"><i class="icon icon-linkedin notranslate" aria-hidden="true"></i></a></li> <li><a itemprop="sameAs" href="https://www.youtube.com/c/yegor256?sub_confirmation=1" rel="nofollow" title="My Youtube video channel"><i class="icon icon-youtube notranslate" aria-hidden="true"></i></a></li> <li><a itemprop="sameAs" href="https://www.pinterest.com/yegor256/" rel="nofollow" title="My Pinterest boards"><i class="icon icon-pinterest notranslate" aria-hidden="true"></i></a></li> <li><a itemprop="sameAs" href="https://angel.co/yegor256" rel="nofollow" title="My AngelList profile"><i class="icon icon-angellist notranslate" aria-hidden="true"></i></a></li> <li><a href="https://soundcloud.com/yegor256" rel="nofollow" title="My podcast"><i class="icon icon-podcast notranslate" aria-hidden="true"></i></a></li> <li><a href="https://itunes.apple.com/us/podcast/yegor256-podcast/id1150826721" rel="nofollow" title="My iTunes podcast"><i class="icon icon-itunes notranslate" aria-hidden="true"></i></a></li> <li><a href="https://t.me/joinchat/AAAAAEJFMRzsRTRxM3ec6A" rel="nofollow" title="My Telegram public channel"><i class="icon icon-telegram notranslate" aria-hidden="true"></i></a></li> <li><a href="mailto:blog@yegor256.com" rel="nofollow" title="Email me any time"><i class="icon icon-mail notranslate" aria-hidden="true"></i></a></li></ul><ul class="menu"> <li><a href="/" title="Home page">Home</a></li> <li ><a href="/best.html" title="Best articles to read">12&#160;Best</a></li> <li ><a href="/contents.html" title="The contents of the entire blog">All&#160;288</a></li> <li ><a href="/webinars.html" title="My webinars">Webinars</a></li> <li ><a href="/talks.html" title="Future and past conference talks">Talks</a></li> <li ><a href="/books.html" title="The books I wrote">Books</a></li> <li ><a href="/papers.html" title="My academic papers and patents">Papers</a></li> <li ><a href="/pets.html" title="My loved pet projects">Pets</a></li> <li ><a href="/award.html" title="Software quality award">Award</a></li> <li ><a href="/testimonials.html" title="What some people say about me">Testimonials</a></li> <li ><a href="/shift-m.html" title="Audio podcast about project management">Shift-M</a></li> <li ><a href="/paintings.html" title="My paintings for sale">Paintings</a></li> <li><a href="http://ru.yegor256.com/" title="Немного на русском языке">По-русски</a></li></ul></nav><div class="search"> <form method="get" action="https://www.google.com/search" itemprop="potentialAction" itemscope="" itemtype="http://schema.org/SearchAction"> <meta itemprop="target" content="https://www.google.com/search?q={q}"/> <input name="sitesearch" value="yegor256.com" type="hidden"/> <input itemprop="query-input" type="text" id="search-query" class="field field-text" required="required" onfocus="$('.google').css('visibility', 'visible');" name="q" placeholder="Search..." autocomplete="off"/> <input type="image" src="/images/google-search-icon.svg" class="google" title="Search via Google" alt="Search via Google"/> </form></div><div class="hot"><ul> <li> <a href="/code-ahead.html">Code Ahead</a> was published on Amazon just a few days ago! It is my new book, a novel about programmers. It explains in details the majority of ideas that stand behind <a href="https://www.zerocracy.com">Zerocracy</a> and <a href="https://www.xdsd.org">XDSD</a>. </li> <li> At <a href="/webinars.html">Webinar #37</a> we will discuss naming problem in OOP, for objects, methods and attributes; join us on <b>September 12</b>, at 11am PST. </li></ul></div></header></div><section itemscope="" itemtype="http://schema.org/BlogPosting"><div class="wrapper"> <header><p class="printable"> <img src="https://api.qrserver.com/v1/create-qr-code/?data=https://www.yegor256.com/2017/11/14/static-factory-methods.html&amp;format=svg" style="width:125px;height:125px;" alt="QR code"/></p><p class="printable"> <code itemprop="url">https://www.yegor256.com/2017/11/14/static-factory-methods.html</code></p><h1 itemprop="name headline mainEntityOfPage">Constructors or Static Factory Methods?</h1><ul class="subline"> <li> <time itemprop="datePublished" datetime="2017-11-14T00:00:00+00:00"> 14 November 2017 </time> </li> <li class="desktop-only" itemprop="locationCreated">Odessa, Ukraine</li> <li class="printable" itemscope="" itemprop="author" itemtype="http://schema.org/Person"> <span itemprop="name">Yegor Bugayenko</span> </li> <li class="unprintable"> <i class="icon icon-comments"></i> <a href="http://www.yegor256.com/2017/11/14/static-factory-methods.html#disqus_thread" itemprop="discussionUrl">comments</a> </li></ul><ul class="subline"> <li>Discussed at:</li> <li><a href="https://dzone.com/articles/constructors-or-static-factory-methods">dzone</a></li></ul><p class="unprintable"><p>I believe Joshua Bloch said it first in his very good book &quot;<a href="http://amzn.to/2zgpiRI">Effective Java</a>&quot;: static factory methods are the preferred way to instantiate objects compared with constructors. I disagree. Not only because I believe that static methods are pure evil, but mostly because in this particular case they pretend to be good and make us think that we have to love them.</p><figure class='jb_picture'><img itemprop='image' alt='Extract (2009) by Mike Judge' src='/images/2017/11/extract.jpg' longdesc='#81adfef8'/><figcaption id='81adfef8'>Extract (2009) by Mike Judge</figcaption></figure><p>Let&#39;s analyze the reasoning and see why it&#39;s wrong, from an object-oriented point of view.</p><p>This is a class with one primary and two secondary constructors:</p><figure class="highlight"><pre><code class="language-java" data-lang="java"><span></span><span class="kd">class</span> <span class="nc">Color</span> <span class="o">{</span>
  <span class="kd">private</span> <span class="kd">final</span> <span class="kt">int</span> <span class="n">hex</span><span class="o">;</span>
  <span class="n">Color</span><span class="o">(</span><span class="n">String</span> <span class="n">rgb</span><span class="o">)</span> <span class="o">{</span>
    <span class="k">this</span><span class="o">(</span><span class="n">Integer</span><span class="o">.</span><span class="na">parseInt</span><span class="o">(</span><span class="n">rgb</span><span class="o">,</span> <span class="mi">16</span><span class="o">));</span>
  <span class="o">}</span>
  <span class="n">Color</span><span class="o">(</span><span class="kt">int</span> <span class="n">red</span><span class="o">,</span> <span class="kt">int</span> <span class="n">green</span><span class="o">,</span> <span class="kt">int</span> <span class="n">blue</span><span class="o">)</span> <span class="o">{</span>
    <span class="k">this</span><span class="o">(</span><span class="n">red</span> <span class="o">&lt;&lt;</span> <span class="mi">16</span> <span class="o">+</span> <span class="n">green</span> <span class="o">&lt;&lt;</span> <span class="mi">8</span> <span class="o">+</span> <span class="n">blue</span><span class="o">);</span>
  <span class="o">}</span>
  <span class="n">Color</span><span class="o">(</span><span class="kt">int</span> <span class="n">h</span><span class="o">)</span> <span class="o">{</span>
    <span class="k">this</span><span class="o">.</span><span class="na">hex</span> <span class="o">=</span> <span class="n">h</span><span class="o">;</span>
  <span class="o">}</span>
<span class="o">}</span></code></pre></figure><p>This is a similar class with three static factory methods:</p><figure class="highlight"><pre><code class="language-java" data-lang="java"><span></span><span class="kd">class</span> <span class="nc">Color</span> <span class="o">{</span>
  <span class="kd">private</span> <span class="kd">final</span> <span class="kt">int</span> <span class="n">hex</span><span class="o">;</span>
  <span class="kd">static</span> <span class="n">Color</span> <span class="nf">makeFromRGB</span><span class="o">(</span><span class="n">String</span> <span class="n">rgb</span><span class="o">)</span> <span class="o">{</span>
    <span class="k">return</span> <span class="k">new</span> <span class="n">Color</span><span class="o">(</span><span class="n">Integer</span><span class="o">.</span><span class="na">parseInt</span><span class="o">(</span><span class="n">rgb</span><span class="o">,</span> <span class="mi">16</span><span class="o">));</span>
  <span class="o">}</span>
  <span class="kd">static</span> <span class="n">Color</span> <span class="nf">makeFromPalette</span><span class="o">(</span><span class="kt">int</span> <span class="n">red</span><span class="o">,</span> <span class="kt">int</span> <span class="n">green</span><span class="o">,</span> <span class="kt">int</span> <span class="n">blue</span><span class="o">)</span> <span class="o">{</span>
    <span class="k">return</span> <span class="k">new</span> <span class="n">Color</span><span class="o">(</span><span class="n">red</span> <span class="o">&lt;&lt;</span> <span class="mi">16</span> <span class="o">+</span> <span class="n">green</span> <span class="o">&lt;&lt;</span> <span class="mi">8</span> <span class="o">+</span> <span class="n">blue</span><span class="o">);</span>
  <span class="o">}</span>
  <span class="kd">static</span> <span class="n">Color</span> <span class="nf">makeFromHex</span><span class="o">(</span><span class="kt">int</span> <span class="n">h</span><span class="o">)</span> <span class="o">{</span>
    <span class="k">return</span> <span class="k">new</span> <span class="n">Color</span><span class="o">(</span><span class="n">h</span><span class="o">);</span>
  <span class="o">}</span>
  <span class="kd">private</span> <span class="nf">Color</span><span class="o">(</span><span class="kt">int</span> <span class="n">h</span><span class="o">)</span> <span class="o">{</span>
    <span class="k">this</span><span class="o">.</span><span class="na">hex</span> <span class="o">=</span> <span class="n">h</span><span class="o">;</span>
  <span class="o">}</span>
<span class="o">}</span></code></pre></figure><p>Which one do you like better?</p><aside class='quote'>Giving birth to an object through its constructor is the most "sacred" moment in any object-oriented software, don't miss the beauty of it!</aside><p>According to Joshua Bloch, there are three basic advantages to using static factory methods instead of constructors (there are actually four, but the fourth one is not applicable to Java <a href="https://docs.oracle.com/javase/7/docs/technotes/guides/language/type-inference-generic-instance-creation.html">anymore</a>):</p><ul> <li>They have names.</li> <li>They can cache.</li> <li>They can subtype.</li></ul><p>I believe that all three make perfect sense ... if the design is wrong. They are good excuses for workarounds. Let&#39;s take them one by one.</p><h2 id="they-have-names">They Have Names</h2><p>This is how you make a <a href="http://www.rapidtables.com/web/color/red-color.htm">red tomato</a> color object with a constructor:</p><figure class="highlight"><pre><code class="language-java" data-lang="java"><span></span><span class="n">Color</span> <span class="n">tomato</span> <span class="o">=</span> <span class="k">new</span> <span class="n">Color</span><span class="o">(</span><span class="mi">255</span><span class="o">,</span> <span class="mi">99</span><span class="o">,</span> <span class="mi">71</span><span class="o">);</span></code></pre></figure><p>This is how you do it with a static factory method:</p><figure class="highlight"><pre><code class="language-java" data-lang="java"><span></span><span class="n">Color</span> <span class="n">tomato</span> <span class="o">=</span> <span class="n">Color</span><span class="o">.</span><span class="na">makeFromPalette</span><span class="o">(</span><span class="mi">255</span><span class="o">,</span> <span class="mi">99</span><span class="o">,</span> <span class="mi">71</span><span class="o">);</span></code></pre></figure><p>It seems that <code>makeFromPalette()</code> is semantically richer than just <code>new Color()</code>, right? Well, yes. Who knows what those three numbers mean if we just pass them to the constructor. But the word &quot;palette&quot; helps us figure everything out immediately.</p><p>True.</p><p>However, the right solution would be to use polymorphism and encapsulation, to decompose the problem into a few semantically rich classes:</p><figure class="highlight"><pre><code class="language-java" data-lang="java"><span></span><span class="kd">interface</span> <span class="nc">Color</span> <span class="o">{</span>
<span class="o">}</span>
<span class="kd">class</span> <span class="nc">HexColor</span> <span class="kd">implements</span> <span class="n">Color</span> <span class="o">{</span>
  <span class="kd">private</span> <span class="kd">final</span> <span class="kt">int</span> <span class="n">hex</span><span class="o">;</span>
  <span class="n">HexColor</span><span class="o">(</span><span class="kt">int</span> <span class="n">h</span><span class="o">)</span> <span class="o">{</span>
    <span class="k">this</span><span class="o">.</span><span class="na">hex</span> <span class="o">=</span> <span class="n">h</span><span class="o">;</span>
  <span class="o">}</span>
<span class="o">}</span>
<span class="kd">class</span> <span class="nc">RGBColor</span> <span class="kd">implements</span> <span class="n">Color</span> <span class="o">{</span>
  <span class="kd">private</span> <span class="kd">final</span> <span class="n">Color</span> <span class="n">origin</span><span class="o">;</span>
  <span class="n">RGBColor</span><span class="o">(</span><span class="kt">int</span> <span class="n">red</span><span class="o">,</span> <span class="kt">int</span> <span class="n">green</span><span class="o">,</span> <span class="kt">int</span> <span class="n">blue</span><span class="o">)</span> <span class="o">{</span>
    <span class="k">this</span><span class="o">.</span><span class="na">origin</span> <span class="o">=</span> <span class="k">new</span> <span class="n">HexColor</span><span class="o">(</span>
      <span class="n">red</span> <span class="o">&lt;&lt;</span> <span class="mi">16</span> <span class="o">+</span> <span class="n">green</span> <span class="o">&lt;&lt;</span> <span class="mi">8</span> <span class="o">+</span> <span class="n">blue</span>
    <span class="o">);</span>
  <span class="o">}</span>
<span class="o">}</span></code></pre></figure><p>Now, we use the right constructor of the right class:</p><figure class="highlight"><pre><code class="language-java" data-lang="java"><span></span><span class="n">Color</span> <span class="n">tomato</span> <span class="o">=</span> <span class="k">new</span> <span class="n">RGBColor</span><span class="o">(</span><span class="mi">255</span><span class="o">,</span> <span class="mi">99</span><span class="o">,</span> <span class="mi">71</span><span class="o">);</span></code></pre></figure><p>See, Joshua?</p><h2 id="they-can-cache">They Can Cache</h2><p>Let&#39;s say I need a red tomato color in multiple places in the application:</p><figure class="highlight"><pre><code class="language-java" data-lang="java"><span></span><span class="n">Color</span> <span class="n">tomato</span> <span class="o">=</span> <span class="k">new</span> <span class="n">Color</span><span class="o">(</span><span class="mi">255</span><span class="o">,</span> <span class="mi">99</span><span class="o">,</span> <span class="mi">71</span><span class="o">);</span>
<span class="c1">// ... sometime later</span>
<span class="n">Color</span> <span class="n">red</span> <span class="o">=</span> <span class="k">new</span> <span class="n">Color</span><span class="o">(</span><span class="mi">255</span><span class="o">,</span> <span class="mi">99</span><span class="o">,</span> <span class="mi">71</span><span class="o">);</span></code></pre></figure><p>Two objects will be created, which is obviously inefficient, since they are identical. It would be better to keep the first instance somewhere in memory and return it when the second call arrives. Static factory methods make it possible to solve this very problem:</p><figure class="highlight"><pre><code class="language-java" data-lang="java"><span></span><span class="n">Color</span> <span class="n">tomato</span> <span class="o">=</span> <span class="n">Color</span><span class="o">.</span><span class="na">makeFromPalette</span><span class="o">(</span><span class="mi">255</span><span class="o">,</span> <span class="mi">99</span><span class="o">,</span> <span class="mi">71</span><span class="o">);</span>
<span class="c1">// ... sometime later</span>
<span class="n">Color</span> <span class="n">red</span> <span class="o">=</span> <span class="n">Color</span><span class="o">.</span><span class="na">makeFromPalette</span><span class="o">(</span><span class="mi">255</span><span class="o">,</span> <span class="mi">99</span><span class="o">,</span> <span class="mi">71</span><span class="o">);</span></code></pre></figure><p>Then somewhere inside the <code>Color</code> we keep a private static <code>Map</code> with all the objects already instantiated:</p><figure class="highlight"><pre><code class="language-java" data-lang="java"><span></span><span class="kd">class</span> <span class="nc">Color</span> <span class="o">{</span>
  <span class="kd">private</span> <span class="kd">static</span> <span class="kd">final</span> <span class="n">Map</span><span class="o">&lt;</span><span class="n">Integer</span><span class="o">,</span> <span class="n">Color</span><span class="o">&gt;</span> <span class="n">CACHE</span> <span class="o">=</span>
    <span class="k">new</span> <span class="n">HashMap</span><span class="o">&lt;&gt;();</span>
  <span class="kd">private</span> <span class="kd">final</span> <span class="kt">int</span> <span class="n">hex</span><span class="o">;</span>
  <span class="kd">static</span> <span class="n">Color</span> <span class="nf">makeFromPalette</span><span class="o">(</span><span class="kt">int</span> <span class="n">red</span><span class="o">,</span> <span class="kt">int</span> <span class="n">green</span><span class="o">,</span> <span class="kt">int</span> <span class="n">blue</span><span class="o">)</span> <span class="o">{</span>
    <span class="kd">final</span> <span class="kt">int</span> <span class="n">hex</span> <span class="o">=</span> <span class="n">red</span> <span class="o">&lt;&lt;</span> <span class="mi">16</span> <span class="o">+</span> <span class="n">green</span> <span class="o">&lt;&lt;</span> <span class="mi">8</span> <span class="o">+</span> <span class="n">blue</span><span class="o">;</span>
    <span class="k">return</span> <span class="n">Color</span><span class="o">.</span><span class="na">CACHE</span><span class="o">.</span><span class="na">computeIfAbsent</span><span class="o">(</span>
      <span class="n">hex</span><span class="o">,</span> <span class="n">h</span> <span class="o">-&gt;</span> <span class="k">new</span> <span class="n">Color</span><span class="o">(</span><span class="n">h</span><span class="o">)</span>
    <span class="o">);</span>
  <span class="o">}</span>
  <span class="kd">private</span> <span class="nf">Color</span><span class="o">(</span><span class="kt">int</span> <span class="n">h</span><span class="o">)</span> <span class="o">{</span>
    <span class="k">return</span> <span class="k">new</span> <span class="n">Color</span><span class="o">(</span><span class="n">h</span><span class="o">);</span>
  <span class="o">}</span>
<span class="o">}</span></code></pre></figure><p>It is very effective performance-wise. With a small object like our <code>Color</code> the problem may not be so obvious, but when objects are bigger, their instantiation and garbage collection may waste a lot of time.</p><p>True.</p><p>However, there is an object-oriented way to solve this problem. We just introduce a new class <code>Palette</code>, which becomes a store of colors:</p><figure class="highlight"><pre><code class="language-java" data-lang="java"><span></span><span class="kd">class</span> <span class="nc">Palette</span> <span class="o">{</span>
  <span class="kd">private</span> <span class="kd">final</span> <span class="n">Map</span><span class="o">&lt;</span><span class="n">Integer</span><span class="o">,</span> <span class="n">Color</span><span class="o">&gt;</span> <span class="n">colors</span> <span class="o">=</span>
    <span class="k">new</span> <span class="n">HashMap</span><span class="o">&lt;&gt;();</span>
  <span class="n">Color</span> <span class="nf">take</span><span class="o">(</span><span class="kt">int</span> <span class="n">red</span><span class="o">,</span> <span class="kt">int</span> <span class="n">green</span><span class="o">,</span> <span class="kt">int</span> <span class="n">blue</span><span class="o">)</span> <span class="o">{</span>
    <span class="kd">final</span> <span class="kt">int</span> <span class="n">hex</span> <span class="o">=</span> <span class="n">red</span> <span class="o">&lt;&lt;</span> <span class="mi">16</span> <span class="o">+</span> <span class="n">green</span> <span class="o">&lt;&lt;</span> <span class="mi">8</span> <span class="o">+</span> <span class="n">blue</span><span class="o">;</span>
    <span class="k">return</span> <span class="k">this</span><span class="o">.</span><span class="na">computerIfAbsent</span><span class="o">(</span>
      <span class="n">hex</span><span class="o">,</span> <span class="n">h</span> <span class="o">-&gt;</span> <span class="k">new</span> <span class="n">Color</span><span class="o">(</span><span class="n">h</span><span class="o">)</span>
    <span class="o">);</span>
  <span class="o">}</span>
<span class="o">}</span></code></pre></figure><p>Now, we make an instance of <code>Palette</code> once and ask it to return a color to us every time we need it:</p><figure class="highlight"><pre><code class="language-java" data-lang="java"><span></span><span class="n">Color</span> <span class="n">tomato</span> <span class="o">=</span> <span class="n">palette</span><span class="o">.</span><span class="na">take</span><span class="o">(</span><span class="mi">255</span><span class="o">,</span> <span class="mi">99</span><span class="o">,</span> <span class="mi">71</span><span class="o">);</span>
<span class="c1">// Later we will get the same instance:</span>
<span class="n">Color</span> <span class="n">red</span> <span class="o">=</span> <span class="n">palette</span><span class="o">.</span><span class="na">take</span><span class="o">(</span><span class="mi">255</span><span class="o">,</span> <span class="mi">99</span><span class="o">,</span> <span class="mi">71</span><span class="o">);</span></code></pre></figure><p>See, Joshua, no static methods, no static attributes.</p><h2 id="they-can-subtype">They Can Subtype</h2><p>Let&#39;s say our class <code>Color</code> has a method <code>lighter()</code>, which is supposed to shift the color to the next available lighter one:</p><figure class="highlight"><pre><code class="language-java" data-lang="java"><span></span><span class="kd">class</span> <span class="nc">Color</span> <span class="o">{</span>
  <span class="kd">protected</span> <span class="kd">final</span> <span class="kt">int</span> <span class="n">hex</span><span class="o">;</span>
  <span class="n">Color</span><span class="o">(</span><span class="kt">int</span> <span class="n">h</span><span class="o">)</span> <span class="o">{</span>
    <span class="k">this</span><span class="o">.</span><span class="na">hex</span> <span class="o">=</span> <span class="n">h</span><span class="o">;</span>
  <span class="o">}</span>
  <span class="kd">public</span> <span class="n">Color</span> <span class="nf">lighter</span><span class="o">()</span> <span class="o">{</span>
    <span class="k">return</span> <span class="k">new</span> <span class="n">Color</span><span class="o">(</span><span class="n">hex</span> <span class="o">+</span> <span class="mh">0x111</span><span class="o">);</span>
  <span class="o">}</span>
<span class="o">}</span></code></pre></figure><p>However, sometimes it&#39;s more desirable to pick the next lighter color through a set of available <a href="https://en.wikipedia.org/wiki/Pantone">Pantone</a> colors:</p><figure class="highlight"><pre><code class="language-java" data-lang="java"><span></span><span class="kd">class</span> <span class="nc">PantoneColor</span> <span class="kd">extends</span> <span class="n">Color</span> <span class="o">{</span>
  <span class="kd">private</span> <span class="kd">final</span> <span class="n">PantoneName</span> <span class="n">pantone</span><span class="o">;</span>
  <span class="n">PantoneColor</span><span class="o">(</span><span class="n">String</span> <span class="n">name</span><span class="o">)</span> <span class="o">{</span>
    <span class="k">this</span><span class="o">(</span><span class="k">new</span> <span class="n">PantoneName</span><span class="o">(</span><span class="n">name</span><span class="o">));</span>
  <span class="o">}</span>
  <span class="n">PantoneColor</span><span class="o">(</span><span class="n">PantoneName</span> <span class="n">name</span><span class="o">)</span> <span class="o">{</span>
    <span class="k">this</span><span class="o">.</span><span class="na">pantone</span> <span class="o">=</span> <span class="n">name</span><span class="o">;</span>
  <span class="o">}</span>
  <span class="nd">@Override</span>
  <span class="kd">public</span> <span class="n">Color</span> <span class="nf">lighter</span><span class="o">()</span> <span class="o">{</span>
    <span class="k">return</span> <span class="k">new</span> <span class="n">PantoneColor</span><span class="o">(</span><span class="k">this</span><span class="o">.</span><span class="na">pantone</span><span class="o">.</span><span class="na">up</span><span class="o">());</span>
  <span class="o">}</span>
<span class="o">}</span></code></pre></figure><p>Then, we create a static factory method, which will decide which <code>Color</code> implementation is the most suitable for us:</p><figure class="highlight"><pre><code class="language-java" data-lang="java"><span></span><span class="kd">class</span> <span class="nc">Color</span> <span class="o">{</span>
  <span class="kd">private</span> <span class="kd">final</span> <span class="n">String</span> <span class="n">code</span><span class="o">;</span>
  <span class="kd">static</span> <span class="n">Color</span> <span class="nf">make</span><span class="o">(</span><span class="kt">int</span> <span class="n">h</span><span class="o">)</span> <span class="o">{</span>
    <span class="k">if</span> <span class="o">(</span><span class="n">h</span> <span class="o">==</span> <span class="mh">0xBF1932</span><span class="o">)</span> <span class="o">{</span>
      <span class="k">return</span> <span class="k">new</span> <span class="n">PantoneColor</span><span class="o">(</span><span class="s">&quot;19-1664 TPX&quot;</span><span class="o">);</span>
    <span class="o">}</span>
    <span class="k">return</span> <span class="k">new</span> <span class="n">RGBColor</span><span class="o">(</span><span class="n">h</span><span class="o">);</span>
  <span class="o">}</span>
<span class="o">}</span></code></pre></figure><p>If the <a href="https://www.pantone.com/color-finder/19-1664-TPX">true red</a> color is requested, we return an instance of <code>PantoneColor</code>. In all other cases it&#39;s just a standard <code>RGBColor</code>. The decision is made by the static factory method. This is how we will call it:</p><figure class="highlight"><pre><code class="language-java" data-lang="java"><span></span><span class="n">Color</span> <span class="n">color</span> <span class="o">=</span> <span class="n">Color</span><span class="o">.</span><span class="na">make</span><span class="o">(</span><span class="mh">0xBF1932</span><span class="o">);</span></code></pre></figure><p>It would not be possible to do the same &quot;forking&quot; with a constructor, since it can only return the class it is declared in. A static method has all the necessary freedom to return any subtype of <code>Color</code>.</p><p>True.</p><p>However, in an object-oriented world we can and must do it all differently. First, we would make <code>Color</code> an interface:</p><figure class="highlight"><pre><code class="language-java" data-lang="java"><span></span><span class="kd">interface</span> <span class="nc">Color</span> <span class="o">{</span>
  <span class="n">Color</span> <span class="nf">lighter</span><span class="o">();</span>
<span class="o">}</span></code></pre></figure><p>Next, we would move this decision making process to its own class <code>Colors</code>, just like we did in the previous example:</p><figure class="highlight"><pre><code class="language-java" data-lang="java"><span></span><span class="kd">class</span> <span class="nc">Colors</span> <span class="o">{</span>
  <span class="n">Color</span> <span class="nf">make</span><span class="o">(</span><span class="kt">int</span> <span class="n">h</span><span class="o">)</span> <span class="o">{</span>
    <span class="k">if</span> <span class="o">(</span><span class="n">h</span> <span class="o">==</span> <span class="mh">0xBF1932</span><span class="o">)</span> <span class="o">{</span>
      <span class="k">return</span> <span class="k">new</span> <span class="n">PantoneColor</span><span class="o">(</span><span class="s">&quot;19-1664-TPX&quot;</span><span class="o">);</span>
    <span class="o">}</span>
    <span class="k">return</span> <span class="k">new</span> <span class="n">RGBColor</span><span class="o">(</span><span class="n">h</span><span class="o">);</span>
  <span class="o">}</span>
<span class="o">}</span></code></pre></figure><p>And we would use an instance of class <code>Colors</code> instead of a static faсtory method inside <code>Color</code>:</p><figure class="highlight"><pre><code class="language-java" data-lang="java"><span></span><span class="n">colors</span><span class="o">.</span><span class="na">make</span><span class="o">(</span><span class="mh">0xBF1932</span><span class="o">);</span></code></pre></figure> <aside class='youtube'> <a href='https://www.youtube.com/watch?v=9yjtsCK6Wdk'><div class='box'> <img src='https://i.ytimg.com/vi/9yjtsCK6Wdk/mqdefault.jpg' alt='YouTube video #9yjtsCK6Wdk'/><div class='play'><i class='icon icon-play'></i></div></div></a><div>A Few Thoughts About Constructors in OOP (webinar #7); 7 October 2015.</div></aside><p>However, this is still not really an object-oriented way of thinking, because we&#39;re taking the decision-making away from the object it belongs to. Either through a static factory method <code>make()</code> or a new class <code>Colors</code>---it doesn&#39;t really matter how---we tear our objects into two pieces. The first piece is the object itself and the second one is the decision making algorithm that stays somewhere else.</p><p>A much more object-oriented design would be to put the logic into an object of class <code>PantoneColor</code> which would decorate the original <code>RGBColor</code>:</p><figure class="highlight"><pre><code class="language-java" data-lang="java"><span></span><span class="kd">class</span> <span class="nc">PantoneColor</span> <span class="o">{</span>
  <span class="kd">private</span> <span class="kd">final</span> <span class="n">Color</span> <span class="n">origin</span><span class="o">;</span>
  <span class="n">PantoneColor</span><span class="o">(</span><span class="n">Color</span> <span class="n">color</span><span class="o">)</span> <span class="o">{</span>
    <span class="k">this</span><span class="o">.</span><span class="na">origin</span> <span class="o">=</span> <span class="n">color</span><span class="o">;</span>
  <span class="o">}</span>
  <span class="nd">@Override</span>
  <span class="kd">public</span> <span class="n">Color</span> <span class="nf">lighter</span><span class="o">()</span> <span class="o">{</span>
    <span class="kd">final</span> <span class="n">Color</span> <span class="n">next</span><span class="o">;</span>
    <span class="k">if</span> <span class="o">(</span><span class="k">this</span><span class="o">.</span><span class="na">origin</span><span class="o">.</span><span class="na">hex</span><span class="o">()</span> <span class="o">==</span> <span class="mh">0xBF1932</span><span class="o">)</span> <span class="o">{</span>
      <span class="n">next</span> <span class="o">=</span> <span class="k">new</span> <span class="n">RGBColor</span><span class="o">(</span><span class="mh">0xD12631</span><span class="o">);</span>
    <span class="o">}</span> <span class="k">else</span> <span class="o">{</span>
      <span class="n">next</span> <span class="o">=</span> <span class="k">this</span><span class="o">.</span><span class="na">origin</span><span class="o">.</span><span class="na">lighter</span><span class="o">();</span>
    <span class="o">}</span>
    <span class="k">return</span> <span class="k">new</span> <span class="n">PantoneColor</span><span class="o">(</span><span class="n">next</span><span class="o">);</span>
  <span class="o">}</span>
<span class="o">)</span></code></pre></figure><p>Then, we make an instance of <code>RGBColor</code> and decorate it with <code>PantoneColor</code>:</p><figure class="highlight"><pre><code class="language-java" data-lang="java"><span></span><span class="n">Color</span> <span class="n">red</span> <span class="o">=</span> <span class="k">new</span> <span class="n">PantoneColor</span><span class="o">(</span>
  <span class="k">new</span> <span class="n">RGBColor</span><span class="o">(</span><span class="mh">0xBF1932</span><span class="o">)</span>
<span class="o">);</span></code></pre></figure><p>We ask <code>red</code> to return a lighter color and it returns the one from the Pantone palette, not the one that is merely lighter in RGB coordinates:</p><figure class="highlight"><pre><code class="language-java" data-lang="java"><span></span><span class="n">Color</span> <span class="n">lighter</span> <span class="o">=</span> <span class="n">red</span><span class="o">.</span><span class="na">lighter</span><span class="o">();</span> <span class="c1">// 0xD12631</span></code></pre></figure><p>Of course, this example is rather primitive and needs <a href="/2016/12/20/can-objects-be-friends.html">further improvement</a> if we really want it to be applicable to all Pantone colors, but I hope you get the idea. The logic must stay <em>inside</em> the class, not somewhere outside, not in static factory methods or even in some other supplementary class. I&#39;m talking about the logic that belongs to this particular class, of course. If it&#39;s something related to the management of class instances, then there can be containers and stores, just like in the previous example above.</p><p>To summarize, I would strongly recommend you <em>never</em> use static methods, especially when they are going to replace object constructors. Giving birth to an object through its constructor is <a href="/2014/10/03/di-containers-are-evil.html">the most</a> &quot;sacred&quot; moment in any object-oriented software, don&#39;t miss the beauty of it.</p></p><nav class="buttons notranslate desktop-only"> <a href="http://www.facebook.com/sharer/sharer.php?u=https://www.yegor256.com/2017/11/14/static-factory-methods.html" title="Share on Facebook" class="button" rel="nofollow"> <span class="count count-facebook">0</span> <i class="icon icon-facebook notranslate" aria-hidden="true"></i> </a> <a href="https://twitter.com/share?url=https://www.yegor256.com/2017/11/14/static-factory-methods.html&amp;text=Constructors+or+Static+Factory+Methods%3F" title="Share on Twitter" class="button" rel="nofollow"> <span class="count count-twitter">0</span> <i class="icon icon-twitter notranslate" aria-hidden="true"></i> </a> <a href="https://plus.google.com/share?url=https://www.yegor256.com/2017/11/14/static-factory-methods.html" title="Share on Google+" class="button" rel="nofollow"> <span class="count count-googleplus">0</span> <i class="icon icon-googleplus notranslate" aria-hidden="true"></i> </a> <a href="https://www.linkedin.com/cws/share?url=https://www.yegor256.com/2017/11/14/static-factory-methods.html" title="Share on LinkedIn" class="button" rel="nofollow"> <span class="count count-linkedin">0</span> <i class="icon icon-linkedin notranslate" aria-hidden="true"></i> </a> <a href="http://reddit.com/submit?url=https://www.yegor256.com/2017/11/14/static-factory-methods.html%3F2017-46&amp;title=Constructors+or+Static+Factory+Methods%3F" title="Share on Reddit" class="button" rel="nofollow"> <span class="count count-reddit">0</span> <i class="icon icon-reddit notranslate" aria-hidden="true"></i> </a> <a href="http://news.ycombinator.com/submitlink?u=https://www.yegor256.com/2017/11/14/static-factory-methods.html%3F2017-46&amp;t=Constructors+or+Static+Factory+Methods%3F" title="Share on Hacker News" class="button" rel="nofollow"> <span class="count count-hackernews">0</span> <i class="icon icon-hackernews notranslate" aria-hidden="true"></i> </a> </nav> </header> <article class="main" itemprop="articleBody"><div ><p>I believe Joshua Bloch said it first in his very good book &quot;<a href="http://amzn.to/2zgpiRI">Effective Java</a>&quot;: static factory methods are the preferred way to instantiate objects compared with constructors. I disagree. Not only because I believe that static methods are pure evil, but mostly because in this particular case they pretend to be good and make us think that we have to love them.</p><figure class='jb_picture'><img itemprop='image' alt='Extract (2009) by Mike Judge' src='/images/2017/11/extract.jpg' longdesc='#81adfef8'/><figcaption id='81adfef8'>Extract (2009) by Mike Judge</figcaption></figure><p>Let&#39;s analyze the reasoning and see why it&#39;s wrong, from an object-oriented point of view.</p><p>This is a class with one primary and two secondary constructors:</p><figure class="highlight"><pre><code class="language-java" data-lang="java"><span></span><span class="kd">class</span> <span class="nc">Color</span> <span class="o">{</span>
  <span class="kd">private</span> <span class="kd">final</span> <span class="kt">int</span> <span class="n">hex</span><span class="o">;</span>
  <span class="n">Color</span><span class="o">(</span><span class="n">String</span> <span class="n">rgb</span><span class="o">)</span> <span class="o">{</span>
    <span class="k">this</span><span class="o">(</span><span class="n">Integer</span><span class="o">.</span><span class="na">parseInt</span><span class="o">(</span><span class="n">rgb</span><span class="o">,</span> <span class="mi">16</span><span class="o">));</span>
  <span class="o">}</span>
  <span class="n">Color</span><span class="o">(</span><span class="kt">int</span> <span class="n">red</span><span class="o">,</span> <span class="kt">int</span> <span class="n">green</span><span class="o">,</span> <span class="kt">int</span> <span class="n">blue</span><span class="o">)</span> <span class="o">{</span>
    <span class="k">this</span><span class="o">(</span><span class="n">red</span> <span class="o">&lt;&lt;</span> <span class="mi">16</span> <span class="o">+</span> <span class="n">green</span> <span class="o">&lt;&lt;</span> <span class="mi">8</span> <span class="o">+</span> <span class="n">blue</span><span class="o">);</span>
  <span class="o">}</span>
  <span class="n">Color</span><span class="o">(</span><span class="kt">int</span> <span class="n">h</span><span class="o">)</span> <span class="o">{</span>
    <span class="k">this</span><span class="o">.</span><span class="na">hex</span> <span class="o">=</span> <span class="n">h</span><span class="o">;</span>
  <span class="o">}</span>
<span class="o">}</span></code></pre></figure><p>This is a similar class with three static factory methods:</p><figure class="highlight"><pre><code class="language-java" data-lang="java"><span></span><span class="kd">class</span> <span class="nc">Color</span> <span class="o">{</span>
  <span class="kd">private</span> <span class="kd">final</span> <span class="kt">int</span> <span class="n">hex</span><span class="o">;</span>
  <span class="kd">static</span> <span class="n">Color</span> <span class="nf">makeFromRGB</span><span class="o">(</span><span class="n">String</span> <span class="n">rgb</span><span class="o">)</span> <span class="o">{</span>
    <span class="k">return</span> <span class="k">new</span> <span class="n">Color</span><span class="o">(</span><span class="n">Integer</span><span class="o">.</span><span class="na">parseInt</span><span class="o">(</span><span class="n">rgb</span><span class="o">,</span> <span class="mi">16</span><span class="o">));</span>
  <span class="o">}</span>
  <span class="kd">static</span> <span class="n">Color</span> <span class="nf">makeFromPalette</span><span class="o">(</span><span class="kt">int</span> <span class="n">red</span><span class="o">,</span> <span class="kt">int</span> <span class="n">green</span><span class="o">,</span> <span class="kt">int</span> <span class="n">blue</span><span class="o">)</span> <span class="o">{</span>
    <span class="k">return</span> <span class="k">new</span> <span class="n">Color</span><span class="o">(</span><span class="n">red</span> <span class="o">&lt;&lt;</span> <span class="mi">16</span> <span class="o">+</span> <span class="n">green</span> <span class="o">&lt;&lt;</span> <span class="mi">8</span> <span class="o">+</span> <span class="n">blue</span><span class="o">);</span>
  <span class="o">}</span>
  <span class="kd">static</span> <span class="n">Color</span> <span class="nf">makeFromHex</span><span class="o">(</span><span class="kt">int</span> <span class="n">h</span><span class="o">)</span> <span class="o">{</span>
    <span class="k">return</span> <span class="k">new</span> <span class="n">Color</span><span class="o">(</span><span class="n">h</span><span class="o">);</span>
  <span class="o">}</span>
  <span class="kd">private</span> <span class="nf">Color</span><span class="o">(</span><span class="kt">int</span> <span class="n">h</span><span class="o">)</span> <span class="o">{</span>
    <span class="k">this</span><span class="o">.</span><span class="na">hex</span> <span class="o">=</span> <span class="n">h</span><span class="o">;</span>
  <span class="o">}</span>
<span class="o">}</span></code></pre></figure><p>Which one do you like better?</p><aside class='quote'>Giving birth to an object through its constructor is the most "sacred" moment in any object-oriented software, don't miss the beauty of it!</aside><p>According to Joshua Bloch, there are three basic advantages to using static factory methods instead of constructors (there are actually four, but the fourth one is not applicable to Java <a href="https://docs.oracle.com/javase/7/docs/technotes/guides/language/type-inference-generic-instance-creation.html">anymore</a>):</p><ul> <li>They have names.</li> <li>They can cache.</li> <li>They can subtype.</li></ul><p>I believe that all three make perfect sense ... if the design is wrong. They are good excuses for workarounds. Let&#39;s take them one by one.</p><h2 id="they-have-names">They Have Names</h2><p>This is how you make a <a href="http://www.rapidtables.com/web/color/red-color.htm">red tomato</a> color object with a constructor:</p><figure class="highlight"><pre><code class="language-java" data-lang="java"><span></span><span class="n">Color</span> <span class="n">tomato</span> <span class="o">=</span> <span class="k">new</span> <span class="n">Color</span><span class="o">(</span><span class="mi">255</span><span class="o">,</span> <span class="mi">99</span><span class="o">,</span> <span class="mi">71</span><span class="o">);</span></code></pre></figure><p>This is how you do it with a static factory method:</p><figure class="highlight"><pre><code class="language-java" data-lang="java"><span></span><span class="n">Color</span> <span class="n">tomato</span> <span class="o">=</span> <span class="n">Color</span><span class="o">.</span><span class="na">makeFromPalette</span><span class="o">(</span><span class="mi">255</span><span class="o">,</span> <span class="mi">99</span><span class="o">,</span> <span class="mi">71</span><span class="o">);</span></code></pre></figure><p>It seems that <code>makeFromPalette()</code> is semantically richer than just <code>new Color()</code>, right? Well, yes. Who knows what those three numbers mean if we just pass them to the constructor. But the word &quot;palette&quot; helps us figure everything out immediately.</p><p>True.</p><p>However, the right solution would be to use polymorphism and encapsulation, to decompose the problem into a few semantically rich classes:</p><figure class="highlight"><pre><code class="language-java" data-lang="java"><span></span><span class="kd">interface</span> <span class="nc">Color</span> <span class="o">{</span>
<span class="o">}</span>
<span class="kd">class</span> <span class="nc">HexColor</span> <span class="kd">implements</span> <span class="n">Color</span> <span class="o">{</span>
  <span class="kd">private</span> <span class="kd">final</span> <span class="kt">int</span> <span class="n">hex</span><span class="o">;</span>
  <span class="n">HexColor</span><span class="o">(</span><span class="kt">int</span> <span class="n">h</span><span class="o">)</span> <span class="o">{</span>
    <span class="k">this</span><span class="o">.</span><span class="na">hex</span> <span class="o">=</span> <span class="n">h</span><span class="o">;</span>
  <span class="o">}</span>
<span class="o">}</span>
<span class="kd">class</span> <span class="nc">RGBColor</span> <span class="kd">implements</span> <span class="n">Color</span> <span class="o">{</span>
  <span class="kd">private</span> <span class="kd">final</span> <span class="n">Color</span> <span class="n">origin</span><span class="o">;</span>
  <span class="n">RGBColor</span><span class="o">(</span><span class="kt">int</span> <span class="n">red</span><span class="o">,</span> <span class="kt">int</span> <span class="n">green</span><span class="o">,</span> <span class="kt">int</span> <span class="n">blue</span><span class="o">)</span> <span class="o">{</span>
    <span class="k">this</span><span class="o">.</span><span class="na">origin</span> <span class="o">=</span> <span class="k">new</span> <span class="n">HexColor</span><span class="o">(</span>
      <span class="n">red</span> <span class="o">&lt;&lt;</span> <span class="mi">16</span> <span class="o">+</span> <span class="n">green</span> <span class="o">&lt;&lt;</span> <span class="mi">8</span> <span class="o">+</span> <span class="n">blue</span>
    <span class="o">);</span>
  <span class="o">}</span>
<span class="o">}</span></code></pre></figure><p>Now, we use the right constructor of the right class:</p><figure class="highlight"><pre><code class="language-java" data-lang="java"><span></span><span class="n">Color</span> <span class="n">tomato</span> <span class="o">=</span> <span class="k">new</span> <span class="n">RGBColor</span><span class="o">(</span><span class="mi">255</span><span class="o">,</span> <span class="mi">99</span><span class="o">,</span> <span class="mi">71</span><span class="o">);</span></code></pre></figure><p>See, Joshua?</p><h2 id="they-can-cache">They Can Cache</h2><p>Let&#39;s say I need a red tomato color in multiple places in the application:</p><figure class="highlight"><pre><code class="language-java" data-lang="java"><span></span><span class="n">Color</span> <span class="n">tomato</span> <span class="o">=</span> <span class="k">new</span> <span class="n">Color</span><span class="o">(</span><span class="mi">255</span><span class="o">,</span> <span class="mi">99</span><span class="o">,</span> <span class="mi">71</span><span class="o">);</span>
<span class="c1">// ... sometime later</span>
<span class="n">Color</span> <span class="n">red</span> <span class="o">=</span> <span class="k">new</span> <span class="n">Color</span><span class="o">(</span><span class="mi">255</span><span class="o">,</span> <span class="mi">99</span><span class="o">,</span> <span class="mi">71</span><span class="o">);</span></code></pre></figure><p>Two objects will be created, which is obviously inefficient, since they are identical. It would be better to keep the first instance somewhere in memory and return it when the second call arrives. Static factory methods make it possible to solve this very problem:</p><figure class="highlight"><pre><code class="language-java" data-lang="java"><span></span><span class="n">Color</span> <span class="n">tomato</span> <span class="o">=</span> <span class="n">Color</span><span class="o">.</span><span class="na">makeFromPalette</span><span class="o">(</span><span class="mi">255</span><span class="o">,</span> <span class="mi">99</span><span class="o">,</span> <span class="mi">71</span><span class="o">);</span>
<span class="c1">// ... sometime later</span>
<span class="n">Color</span> <span class="n">red</span> <span class="o">=</span> <span class="n">Color</span><span class="o">.</span><span class="na">makeFromPalette</span><span class="o">(</span><span class="mi">255</span><span class="o">,</span> <span class="mi">99</span><span class="o">,</span> <span class="mi">71</span><span class="o">);</span></code></pre></figure><p>Then somewhere inside the <code>Color</code> we keep a private static <code>Map</code> with all the objects already instantiated:</p><figure class="highlight"><pre><code class="language-java" data-lang="java"><span></span><span class="kd">class</span> <span class="nc">Color</span> <span class="o">{</span>
  <span class="kd">private</span> <span class="kd">static</span> <span class="kd">final</span> <span class="n">Map</span><span class="o">&lt;</span><span class="n">Integer</span><span class="o">,</span> <span class="n">Color</span><span class="o">&gt;</span> <span class="n">CACHE</span> <span class="o">=</span>
    <span class="k">new</span> <span class="n">HashMap</span><span class="o">&lt;&gt;();</span>
  <span class="kd">private</span> <span class="kd">final</span> <span class="kt">int</span> <span class="n">hex</span><span class="o">;</span>
  <span class="kd">static</span> <span class="n">Color</span> <span class="nf">makeFromPalette</span><span class="o">(</span><span class="kt">int</span> <span class="n">red</span><span class="o">,</span> <span class="kt">int</span> <span class="n">green</span><span class="o">,</span> <span class="kt">int</span> <span class="n">blue</span><span class="o">)</span> <span class="o">{</span>
    <span class="kd">final</span> <span class="kt">int</span> <span class="n">hex</span> <span class="o">=</span> <span class="n">red</span> <span class="o">&lt;&lt;</span> <span class="mi">16</span> <span class="o">+</span> <span class="n">green</span> <span class="o">&lt;&lt;</span> <span class="mi">8</span> <span class="o">+</span> <span class="n">blue</span><span class="o">;</span>
    <span class="k">return</span> <span class="n">Color</span><span class="o">.</span><span class="na">CACHE</span><span class="o">.</span><span class="na">computeIfAbsent</span><span class="o">(</span>
      <span class="n">hex</span><span class="o">,</span> <span class="n">h</span> <span class="o">-&gt;</span> <span class="k">new</span> <span class="n">Color</span><span class="o">(</span><span class="n">h</span><span class="o">)</span>
    <span class="o">);</span>
  <span class="o">}</span>
  <span class="kd">private</span> <span class="nf">Color</span><span class="o">(</span><span class="kt">int</span> <span class="n">h</span><span class="o">)</span> <span class="o">{</span>
    <span class="k">return</span> <span class="k">new</span> <span class="n">Color</span><span class="o">(</span><span class="n">h</span><span class="o">);</span>
  <span class="o">}</span>
<span class="o">}</span></code></pre></figure><p>It is very effective performance-wise. With a small object like our <code>Color</code> the problem may not be so obvious, but when objects are bigger, their instantiation and garbage collection may waste a lot of time.</p><p>True.</p><p>However, there is an object-oriented way to solve this problem. We just introduce a new class <code>Palette</code>, which becomes a store of colors:</p><figure class="highlight"><pre><code class="language-java" data-lang="java"><span></span><span class="kd">class</span> <span class="nc">Palette</span> <span class="o">{</span>
  <span class="kd">private</span> <span class="kd">final</span> <span class="n">Map</span><span class="o">&lt;</span><span class="n">Integer</span><span class="o">,</span> <span class="n">Color</span><span class="o">&gt;</span> <span class="n">colors</span> <span class="o">=</span>
    <span class="k">new</span> <span class="n">HashMap</span><span class="o">&lt;&gt;();</span>
  <span class="n">Color</span> <span class="nf">take</span><span class="o">(</span><span class="kt">int</span> <span class="n">red</span><span class="o">,</span> <span class="kt">int</span> <span class="n">green</span><span class="o">,</span> <span class="kt">int</span> <span class="n">blue</span><span class="o">)</span> <span class="o">{</span>
    <span class="kd">final</span> <span class="kt">int</span> <span class="n">hex</span> <span class="o">=</span> <span class="n">red</span> <span class="o">&lt;&lt;</span> <span class="mi">16</span> <span class="o">+</span> <span class="n">green</span> <span class="o">&lt;&lt;</span> <span class="mi">8</span> <span class="o">+</span> <span class="n">blue</span><span class="o">;</span>
    <span class="k">return</span> <span class="k">this</span><span class="o">.</span><span class="na">computerIfAbsent</span><span class="o">(</span>
      <span class="n">hex</span><span class="o">,</span> <span class="n">h</span> <span class="o">-&gt;</span> <span class="k">new</span> <span class="n">Color</span><span class="o">(</span><span class="n">h</span><span class="o">)</span>
    <span class="o">);</span>
  <span class="o">}</span>
<span class="o">}</span></code></pre></figure><p>Now, we make an instance of <code>Palette</code> once and ask it to return a color to us every time we need it:</p><figure class="highlight"><pre><code class="language-java" data-lang="java"><span></span><span class="n">Color</span> <span class="n">tomato</span> <span class="o">=</span> <span class="n">palette</span><span class="o">.</span><span class="na">take</span><span class="o">(</span><span class="mi">255</span><span class="o">,</span> <span class="mi">99</span><span class="o">,</span> <span class="mi">71</span><span class="o">);</span>
<span class="c1">// Later we will get the same instance:</span>
<span class="n">Color</span> <span class="n">red</span> <span class="o">=</span> <span class="n">palette</span><span class="o">.</span><span class="na">take</span><span class="o">(</span><span class="mi">255</span><span class="o">,</span> <span class="mi">99</span><span class="o">,</span> <span class="mi">71</span><span class="o">);</span></code></pre></figure><p>See, Joshua, no static methods, no static attributes.</p><h2 id="they-can-subtype">They Can Subtype</h2><p>Let&#39;s say our class <code>Color</code> has a method <code>lighter()</code>, which is supposed to shift the color to the next available lighter one:</p><figure class="highlight"><pre><code class="language-java" data-lang="java"><span></span><span class="kd">class</span> <span class="nc">Color</span> <span class="o">{</span>
  <span class="kd">protected</span> <span class="kd">final</span> <span class="kt">int</span> <span class="n">hex</span><span class="o">;</span>
  <span class="n">Color</span><span class="o">(</span><span class="kt">int</span> <span class="n">h</span><span class="o">)</span> <span class="o">{</span>
    <span class="k">this</span><span class="o">.</span><span class="na">hex</span> <span class="o">=</span> <span class="n">h</span><span class="o">;</span>
  <span class="o">}</span>
  <span class="kd">public</span> <span class="n">Color</span> <span class="nf">lighter</span><span class="o">()</span> <span class="o">{</span>
    <span class="k">return</span> <span class="k">new</span> <span class="n">Color</span><span class="o">(</span><span class="n">hex</span> <span class="o">+</span> <span class="mh">0x111</span><span class="o">);</span>
  <span class="o">}</span>
<span class="o">}</span></code></pre></figure><p>However, sometimes it&#39;s more desirable to pick the next lighter color through a set of available <a href="https://en.wikipedia.org/wiki/Pantone">Pantone</a> colors:</p><figure class="highlight"><pre><code class="language-java" data-lang="java"><span></span><span class="kd">class</span> <span class="nc">PantoneColor</span> <span class="kd">extends</span> <span class="n">Color</span> <span class="o">{</span>
  <span class="kd">private</span> <span class="kd">final</span> <span class="n">PantoneName</span> <span class="n">pantone</span><span class="o">;</span>
  <span class="n">PantoneColor</span><span class="o">(</span><span class="n">String</span> <span class="n">name</span><span class="o">)</span> <span class="o">{</span>
    <span class="k">this</span><span class="o">(</span><span class="k">new</span> <span class="n">PantoneName</span><span class="o">(</span><span class="n">name</span><span class="o">));</span>
  <span class="o">}</span>
  <span class="n">PantoneColor</span><span class="o">(</span><span class="n">PantoneName</span> <span class="n">name</span><span class="o">)</span> <span class="o">{</span>
    <span class="k">this</span><span class="o">.</span><span class="na">pantone</span> <span class="o">=</span> <span class="n">name</span><span class="o">;</span>
  <span class="o">}</span>
  <span class="nd">@Override</span>
  <span class="kd">public</span> <span class="n">Color</span> <span class="nf">lighter</span><span class="o">()</span> <span class="o">{</span>
    <span class="k">return</span> <span class="k">new</span> <span class="n">PantoneColor</span><span class="o">(</span><span class="k">this</span><span class="o">.</span><span class="na">pantone</span><span class="o">.</span><span class="na">up</span><span class="o">());</span>
  <span class="o">}</span>
<span class="o">}</span></code></pre></figure><p>Then, we create a static factory method, which will decide which <code>Color</code> implementation is the most suitable for us:</p><figure class="highlight"><pre><code class="language-java" data-lang="java"><span></span><span class="kd">class</span> <span class="nc">Color</span> <span class="o">{</span>
  <span class="kd">private</span> <span class="kd">final</span> <span class="n">String</span> <span class="n">code</span><span class="o">;</span>
  <span class="kd">static</span> <span class="n">Color</span> <span class="nf">make</span><span class="o">(</span><span class="kt">int</span> <span class="n">h</span><span class="o">)</span> <span class="o">{</span>
    <span class="k">if</span> <span class="o">(</span><span class="n">h</span> <span class="o">==</span> <span class="mh">0xBF1932</span><span class="o">)</span> <span class="o">{</span>
      <span class="k">return</span> <span class="k">new</span> <span class="n">PantoneColor</span><span class="o">(</span><span class="s">&quot;19-1664 TPX&quot;</span><span class="o">);</span>
    <span class="o">}</span>
    <span class="k">return</span> <span class="k">new</span> <span class="n">RGBColor</span><span class="o">(</span><span class="n">h</span><span class="o">);</span>
  <span class="o">}</span>
<span class="o">}</span></code></pre></figure><p>If the <a href="https://www.pantone.com/color-finder/19-1664-TPX">true red</a> color is requested, we return an instance of <code>PantoneColor</code>. In all other cases it&#39;s just a standard <code>RGBColor</code>. The decision is made by the static factory method. This is how we will call it:</p><figure class="highlight"><pre><code class="language-java" data-lang="java"><span></span><span class="n">Color</span> <span class="n">color</span> <span class="o">=</span> <span class="n">Color</span><span class="o">.</span><span class="na">make</span><span class="o">(</span><span class="mh">0xBF1932</span><span class="o">);</span></code></pre></figure><p>It would not be possible to do the same &quot;forking&quot; with a constructor, since it can only return the class it is declared in. A static method has all the necessary freedom to return any subtype of <code>Color</code>.</p><p>True.</p><p>However, in an object-oriented world we can and must do it all differently. First, we would make <code>Color</code> an interface:</p><figure class="highlight"><pre><code class="language-java" data-lang="java"><span></span><span class="kd">interface</span> <span class="nc">Color</span> <span class="o">{</span>
  <span class="n">Color</span> <span class="nf">lighter</span><span class="o">();</span>
<span class="o">}</span></code></pre></figure><p>Next, we would move this decision making process to its own class <code>Colors</code>, just like we did in the previous example:</p><figure class="highlight"><pre><code class="language-java" data-lang="java"><span></span><span class="kd">class</span> <span class="nc">Colors</span> <span class="o">{</span>
  <span class="n">Color</span> <span class="nf">make</span><span class="o">(</span><span class="kt">int</span> <span class="n">h</span><span class="o">)</span> <span class="o">{</span>
    <span class="k">if</span> <span class="o">(</span><span class="n">h</span> <span class="o">==</span> <span class="mh">0xBF1932</span><span class="o">)</span> <span class="o">{</span>
      <span class="k">return</span> <span class="k">new</span> <span class="n">PantoneColor</span><span class="o">(</span><span class="s">&quot;19-1664-TPX&quot;</span><span class="o">);</span>
    <span class="o">}</span>
    <span class="k">return</span> <span class="k">new</span> <span class="n">RGBColor</span><span class="o">(</span><span class="n">h</span><span class="o">);</span>
  <span class="o">}</span>
<span class="o">}</span></code></pre></figure><p>And we would use an instance of class <code>Colors</code> instead of a static faсtory method inside <code>Color</code>:</p><figure class="highlight"><pre><code class="language-java" data-lang="java"><span></span><span class="n">colors</span><span class="o">.</span><span class="na">make</span><span class="o">(</span><span class="mh">0xBF1932</span><span class="o">);</span></code></pre></figure> <aside class='youtube'> <a href='https://www.youtube.com/watch?v=9yjtsCK6Wdk'><div class='box'> <img src='https://i.ytimg.com/vi/9yjtsCK6Wdk/mqdefault.jpg' alt='YouTube video #9yjtsCK6Wdk'/><div class='play'><i class='icon icon-play'></i></div></div></a><div>A Few Thoughts About Constructors in OOP (webinar #7); 7 October 2015.</div></aside><p>However, this is still not really an object-oriented way of thinking, because we&#39;re taking the decision-making away from the object it belongs to. Either through a static factory method <code>make()</code> or a new class <code>Colors</code>---it doesn&#39;t really matter how---we tear our objects into two pieces. The first piece is the object itself and the second one is the decision making algorithm that stays somewhere else.</p><p>A much more object-oriented design would be to put the logic into an object of class <code>PantoneColor</code> which would decorate the original <code>RGBColor</code>:</p><figure class="highlight"><pre><code class="language-java" data-lang="java"><span></span><span class="kd">class</span> <span class="nc">PantoneColor</span> <span class="o">{</span>
  <span class="kd">private</span> <span class="kd">final</span> <span class="n">Color</span> <span class="n">origin</span><span class="o">;</span>
  <span class="n">PantoneColor</span><span class="o">(</span><span class="n">Color</span> <span class="n">color</span><span class="o">)</span> <span class="o">{</span>
    <span class="k">this</span><span class="o">.</span><span class="na">origin</span> <span class="o">=</span> <span class="n">color</span><span class="o">;</span>
  <span class="o">}</span>
  <span class="nd">@Override</span>
  <span class="kd">public</span> <span class="n">Color</span> <span class="nf">lighter</span><span class="o">()</span> <span class="o">{</span>
    <span class="kd">final</span> <span class="n">Color</span> <span class="n">next</span><span class="o">;</span>
    <span class="k">if</span> <span class="o">(</span><span class="k">this</span><span class="o">.</span><span class="na">origin</span><span class="o">.</span><span class="na">hex</span><span class="o">()</span> <span class="o">==</span> <span class="mh">0xBF1932</span><span class="o">)</span> <span class="o">{</span>
      <span class="n">next</span> <span class="o">=</span> <span class="k">new</span> <span class="n">RGBColor</span><span class="o">(</span><span class="mh">0xD12631</span><span class="o">);</span>
    <span class="o">}</span> <span class="k">else</span> <span class="o">{</span>
      <span class="n">next</span> <span class="o">=</span> <span class="k">this</span><span class="o">.</span><span class="na">origin</span><span class="o">.</span><span class="na">lighter</span><span class="o">();</span>
    <span class="o">}</span>
    <span class="k">return</span> <span class="k">new</span> <span class="n">PantoneColor</span><span class="o">(</span><span class="n">next</span><span class="o">);</span>
  <span class="o">}</span>
<span class="o">)</span></code></pre></figure><p>Then, we make an instance of <code>RGBColor</code> and decorate it with <code>PantoneColor</code>:</p><figure class="highlight"><pre><code class="language-java" data-lang="java"><span></span><span class="n">Color</span> <span class="n">red</span> <span class="o">=</span> <span class="k">new</span> <span class="n">PantoneColor</span><span class="o">(</span>
  <span class="k">new</span> <span class="n">RGBColor</span><span class="o">(</span><span class="mh">0xBF1932</span><span class="o">)</span>
<span class="o">);</span></code></pre></figure><p>We ask <code>red</code> to return a lighter color and it returns the one from the Pantone palette, not the one that is merely lighter in RGB coordinates:</p><figure class="highlight"><pre><code class="language-java" data-lang="java"><span></span><span class="n">Color</span> <span class="n">lighter</span> <span class="o">=</span> <span class="n">red</span><span class="o">.</span><span class="na">lighter</span><span class="o">();</span> <span class="c1">// 0xD12631</span></code></pre></figure><p>Of course, this example is rather primitive and needs <a href="/2016/12/20/can-objects-be-friends.html">further improvement</a> if we really want it to be applicable to all Pantone colors, but I hope you get the idea. The logic must stay <em>inside</em> the class, not somewhere outside, not in static factory methods or even in some other supplementary class. I&#39;m talking about the logic that belongs to this particular class, of course. If it&#39;s something related to the management of class instances, then there can be containers and stores, just like in the previous example above.</p><p>To summarize, I would strongly recommend you <em>never</em> use static methods, especially when they are going to replace object constructors. Giving birth to an object through its constructor is <a href="/2014/10/03/di-containers-are-evil.html">the most</a> &quot;sacred&quot; moment in any object-oriented software, don&#39;t miss the beauty of it.</p></div></article></div><div class="wrapper"> <related-posts /></div><div class="disqus" role="complementary"><p class="disqus_hint"> Please, use <a href="https://help.disqus.com/commenting/what-html-tags-are-allowed-within-comments">syntax highlighting</a> in your comments, to make them more readable.</p><div id="disqus_thread" class="disqus-thread"> <a>&nbsp;</a></div><script> var disqus_config = function () { this.page.url = document.location.href.split('?')[0].split('#')[0].replace('https://', 'http://'); this.page.identifier = this.page.url; }; (function() { var d = document, s = d.createElement('script'); s.src = '//yegor256.disqus.com/embed.js'; s.setAttribute('data-timestamp', +new Date()); (d.head || d.body).appendChild(s); })(); </script> <noscript><div><p class="red"> JavaScript is disabled in your browser, that's why you can't see comments under this post.</p></div></noscript></div><div class="wrapper"> <footer class="footer"><p> &copy; <span itemscope="" itemprop="copyrightHolder" itemtype="http://schema.org/Person"> <span itemprop="name">Yegor Bugayenko</span> </span> 2014&ndash;<span itemprop="copyrightYear">2018</span></p></footer></div></section><div class="wrapper unprintable" style="text-align:center;margin-top:2em;"> <a href="http://www.sixnines.io/h/3ba1652f"> <img src="//www.sixnines.io/b/3ba1652f?style=flat" alt="sixnines availability badge"/> </a></div><script src="//code.jquery.com/jquery-1.9.0.min.js"></script> <script src="/js/all.js?a0e0d018c07"></script> <script>var disqus_shortname = 'yegor256';</script> <script id="dsq-count-scr" src="//yegor256.disqus.com/count.js" async="async"></script> <script> (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){ (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o), m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m) })(window,document,'script','//www.google-analytics.com/analytics.js','ga'); ga('create', 'UA-1963507-32', 'auto'); ga('send', 'pageview'); </script> <script> Cd=document;Cr="&"+Math.random();Cp="&s=1"; Cd.cookie="b=b";if(Cd.cookie)Cp+="&c=1"; Cp+="&t="+(new Date()).getTimezoneOffset(); if(self!=top)Cp+="&f=1"; </script> <script> if(navigator.javaEnabled())Cp+="&j=1"; </script> <script> if(typeof(screen)!='undefined')Cp+="&w="+screen.width+"&h="+ screen.height+"&d="+(screen.colorDepth?screen.colorDepth:screen.pixelDepth); </script> <script> Cd.write("<img src='//c.hit.ua/hit?i=95870&g=0&x=2"+Cp+Cr+ "&r="+escape(Cd.referrer)+"&u="+escape(window.location.href)+ "' border='0' wi"+"dth='1' he"+"ight='1'/>"); </script> <script type="application/ld+json"> { "@context": "http://schema.org", "@type": "Person", "name": "Yegor Bugayenko", "url": "http://www.yegor256.com", "sameAs": [ "https://www.facebook.com/yegor256", "https://instagram.com/yegor256", "https://www.linkedin.com/in/yegor256", "https://twitter.com/yegor256", "https://github.com/yegor256", "https://www.pinterest.com/yegor256/" ] } </script> </body> </html> <!DOCTYPE html> <html xmlns="http://www.w3.org/1999/xhtml" lang="en-US" xml:lang="en-US" itemscope="" itemtype="http://schema.org/WebSite"> <head> <meta charset="utf-8"/> <meta name="description" content="It is a very popular design idea to create a client for a server and expose the entire functionality; this leads to procedural code and must be avoided. " /> <meta name="keywords" content="how to name a class, naming of classes, object naming, object-oriented programming naming, oop object names" /> <meta name="viewport" content="width=device-width,minimum-scale=1,initial-scale=1"/> <meta name="google-site-verification" content="JEj_gQr2CPe2QKGw8XdMz0R7VboQIUbX3FlM-lwTq-8" /> <meta name="author" content="Yegor Bugayenko"> <meta name="article:published_time" content="2017-09-12 00:00:00 +0000"> <meta name="og:site_name" content="Yegor Bugayenko"/> <meta name="og:type" content="article" /> <meta name="og:locale" content="en_US" /> <meta name="twitter:account_id" content="4503599630178231" /> <meta name="twitter:creator" content="@yegor256"/> <meta name="twitter:site" content="@yegor256"/> <meta name="twitter:title" property="og:title" content="Yet Another Evil Suffix For Object Names: Client"/> <meta name="twitter:description" property="og:description" content="It is a very popular design idea to create a client for a server and expose the entire functionality; this leads to procedural code and must be avoided. "/> <meta name="twitter:url" property="og:url" content="https://www.yegor256.com/2017/09/12/evil-object-name-suffix-client.html"/> <meta name="telegram:channel" content="AAAAAEJFMRzsRTRxM3ec6A"/> <link rel="search" type="application/opensearchdescription+xml" href="/opensearch.xml" title="yegor256" /> <link rel="shortcut icon" href="/favicon.ico?a0e0d018c07"/> <link rel="apple-touch-icon" href="/favicon.ico?a0e0d018c07"/> <link rel="alternate" type="application/rss+xml" title="RSS for yegor256.com" href="https://www.yegor256.com/rss.xml"/> <link rel="stylesheet" href="/css/layout.css?a0e0d018c07"/> <link rel="stylesheet" href="/css/icons.css?a0e0d018c07"/> <link rel="canonical" href="https://www.yegor256.com/2017/09/12/evil-object-name-suffix-client.html" /> <link rel="amphtml" href="https://www.yegor256.com/2017/09/12/evil-object-name-suffix-client.amp.html" /> <title>Yet Another Evil Suffix For Object Names: Client </title> <meta name='og:image' content='https://www.yegor256.com/images/2017/09/dont-tempt-me.jpg'/><meta name='twitter:image' content='https://www.yegor256.com/images/2017/09/dont-tempt-me.jpg'/><meta name='og:image:width' content='1280'/> <meta name='twitter:image:width' content='1280'/><meta name='og:image:height' content='720'/> <meta name='twitter:image:height' content='720'/><meta name='twitter:card' content='summary_large_image'/><meta name='twitter:image:alt' content='Sin noticias de Dios (2001) by Agustín Díaz Yanes'/> </head> <body><div class="wrapper"> <aside class="header-toggle unprintable" id="header-toggle" title="Show the menu" onclick="$('#header').show();$('#header-toggle').hide();">&#9776;</aside> <header class="header" id="header"><div class="face"> <a href="/about-me.html#form" class="sub" title="Click to subscribe to my monthly newsletter"><span>Subscribe</span></a> <a href="/about-me.html" style="position:relative;"> <img src="/images/face-256x256.jpg" class="photo" alt="Yegor Bugayenko"/> </a></div><nav><ul class="menu social notranslate"> <li><a href="https://twitter.com/intent/follow?screen_name=yegor256" rel="nofollow" title="Follow me on Twitter"><i class="icon icon-twitter notranslate" aria-hidden="true"></i></a></li> <li><a href="/rss.xml" rel="nofollow" title="Subscribe to my RSS feed"><i class="icon icon-rss notranslate" aria-hidden="true"></i></a></li> <li><a itemprop="sameAs" href="https://github.com/yegor256" rel="nofollow" title="My GitHub profile"><i class="icon icon-github notranslate" aria-hidden="true"></i></a></li> <li><a itemprop="sameAs" href="http://stackoverflow.com/users/187141/yegor256" rel="nofollow" title="My StackOverflow profile"><i class="icon icon-stackoverflow notranslate" aria-hidden="true"></i></a></li> <li><a itemprop="sameAs" href="https://www.facebook.com/yegor256" rel="nofollow" title="Follow me on Facebook"><i class="icon icon-facebook notranslate" aria-hidden="true"></i></a></li> <li><a itemprop="sameAs" href="https://instagram.com/yegor256" rel="nofollow" title="Follow me on Instagram"><i class="icon icon-instagram notranslate" aria-hidden="true"></i></a></li> <li><a itemprop="sameAs" href="https://www.linkedin.com/in/yegor256" rel="nofollow" title="My LinkedIn profile"><i class="icon icon-linkedin notranslate" aria-hidden="true"></i></a></li> <li><a itemprop="sameAs" href="https://www.youtube.com/c/yegor256?sub_confirmation=1" rel="nofollow" title="My Youtube video channel"><i class="icon icon-youtube notranslate" aria-hidden="true"></i></a></li> <li><a itemprop="sameAs" href="https://www.pinterest.com/yegor256/" rel="nofollow" title="My Pinterest boards"><i class="icon icon-pinterest notranslate" aria-hidden="true"></i></a></li> <li><a itemprop="sameAs" href="https://angel.co/yegor256" rel="nofollow" title="My AngelList profile"><i class="icon icon-angellist notranslate" aria-hidden="true"></i></a></li> <li><a href="https://soundcloud.com/yegor256" rel="nofollow" title="My podcast"><i class="icon icon-podcast notranslate" aria-hidden="true"></i></a></li> <li><a href="https://itunes.apple.com/us/podcast/yegor256-podcast/id1150826721" rel="nofollow" title="My iTunes podcast"><i class="icon icon-itunes notranslate" aria-hidden="true"></i></a></li> <li><a href="https://t.me/joinchat/AAAAAEJFMRzsRTRxM3ec6A" rel="nofollow" title="My Telegram public channel"><i class="icon icon-telegram notranslate" aria-hidden="true"></i></a></li> <li><a href="mailto:blog@yegor256.com" rel="nofollow" title="Email me any time"><i class="icon icon-mail notranslate" aria-hidden="true"></i></a></li></ul><ul class="menu"> <li><a href="/" title="Home page">Home</a></li> <li ><a href="/best.html" title="Best articles to read">12&#160;Best</a></li> <li ><a href="/contents.html" title="The contents of the entire blog">All&#160;288</a></li> <li ><a href="/webinars.html" title="My webinars">Webinars</a></li> <li ><a href="/talks.html" title="Future and past conference talks">Talks</a></li> <li ><a href="/books.html" title="The books I wrote">Books</a></li> <li ><a href="/papers.html" title="My academic papers and patents">Papers</a></li> <li ><a href="/pets.html" title="My loved pet projects">Pets</a></li> <li ><a href="/award.html" title="Software quality award">Award</a></li> <li ><a href="/testimonials.html" title="What some people say about me">Testimonials</a></li> <li ><a href="/shift-m.html" title="Audio podcast about project management">Shift-M</a></li> <li ><a href="/paintings.html" title="My paintings for sale">Paintings</a></li> <li><a href="http://ru.yegor256.com/" title="Немного на русском языке">По-русски</a></li></ul></nav><div class="search"> <form method="get" action="https://www.google.com/search" itemprop="potentialAction" itemscope="" itemtype="http://schema.org/SearchAction"> <meta itemprop="target" content="https://www.google.com/search?q={q}"/> <input name="sitesearch" value="yegor256.com" type="hidden"/> <input itemprop="query-input" type="text" id="search-query" class="field field-text" required="required" onfocus="$('.google').css('visibility', 'visible');" name="q" placeholder="Search..." autocomplete="off"/> <input type="image" src="/images/google-search-icon.svg" class="google" title="Search via Google" alt="Search via Google"/> </form></div><div class="hot"><ul> <li> <a href="/code-ahead.html">Code Ahead</a> was published on Amazon just a few days ago! It is my new book, a novel about programmers. It explains in details the majority of ideas that stand behind <a href="https://www.zerocracy.com">Zerocracy</a> and <a href="https://www.xdsd.org">XDSD</a>. </li> <li> At <a href="/webinars.html">Webinar #37</a> we will discuss naming problem in OOP, for objects, methods and attributes; join us on <b>September 12</b>, at 11am PST. </li></ul></div></header></div><section itemscope="" itemtype="http://schema.org/BlogPosting"><div class="wrapper"> <header><p class="printable"> <img src="https://api.qrserver.com/v1/create-qr-code/?data=https://www.yegor256.com/2017/09/12/evil-object-name-suffix-client.html&amp;format=svg" style="width:125px;height:125px;" alt="QR code"/></p><p class="printable"> <code itemprop="url">https://www.yegor256.com/2017/09/12/evil-object-name-suffix-client.html</code></p><h1 itemprop="name headline mainEntityOfPage">Yet Another Evil Suffix For Object Names: Client</h1><ul class="subline"> <li> <time itemprop="datePublished" datetime="2017-09-12T00:00:00+00:00"> 12 September 2017 </time> </li> <li class="desktop-only" itemprop="locationCreated">Odessa, Ukraine</li> <li class="printable" itemscope="" itemprop="author" itemtype="http://schema.org/Person"> <span itemprop="name">Yegor Bugayenko</span> </li> <li class="unprintable"> <i class="icon icon-comments"></i> <a href="http://www.yegor256.com/2017/09/12/evil-object-name-suffix-client.html#disqus_thread" itemprop="discussionUrl">comments</a> </li></ul><p class="unprintable"><p>Some time ago we <a href="/2015/03/09/objects-end-with-er.html">were talking</a> about &quot;-ER&quot; suffixes in object and class names. We agreed that they were evil and must be avoided if we want our code to be truly object-oriented and our objects to be objects instead of collections of procedures. Now I&#39;m ready to introduce a new evil suffix: <code>Client</code>.</p><figure class='jb_picture'><img itemprop='image' alt='Sin noticias de Dios (2001) by Agustín Díaz Yanes' src='/images/2017/09/dont-tempt-me.jpg' longdesc='#467f4c9d'/><figcaption id='467f4c9d'>Sin noticias de Dios (2001) by Agustín Díaz Yanes</figcaption></figure><p>Let me give an example first. This is what an object with such a suffix may look like (it&#39;s a pseudo-code version of the <a href="http://docs.aws.amazon.com/AWSJavaSDK/latest/javadoc/com/amazonaws/services/s3/AmazonS3Client.html"><code>AmazonS3Client</code></a> from <a href="https://aws.amazon.com/sdk-for-java/">AWS Java SDK</a>):</p><figure class="highlight"><pre><code class="language-java" data-lang="java"><span></span><span class="kd">class</span> <span class="nc">AmazonS3Client</span> <span class="o">{</span>
  <span class="n">createBucket</span><span class="o">(</span><span class="n">String</span> <span class="n">name</span><span class="o">);</span>
  <span class="n">deleteBucket</span><span class="o">(</span><span class="n">String</span> <span class="n">name</span><span class="o">);</span>
  <span class="n">doesBucketExist</span><span class="o">(</span><span class="n">String</span> <span class="n">name</span><span class="o">);</span>
  <span class="n">getBucketAcl</span><span class="o">(</span><span class="n">String</span> <span class="n">name</span><span class="o">)</span>
  <span class="n">getBucketPolicy</span><span class="o">(</span><span class="n">String</span> <span class="n">name</span><span class="o">);</span>
  <span class="n">listBuckets</span><span class="o">();</span>
  <span class="c1">// 160+ more methods here</span>
<span class="o">}</span></code></pre></figure><p>All &quot;clients&quot; look similar: they encapsulate the destination URL with some access credentials and expose a number of methods, which transport the data to/from the &quot;server.&quot; Even though this design looks like a <a href="/2014/11/20/seven-virtues-of-good-object.html">proper object</a>, it doesn&#39;t really follow the true spirit of object-orientation. That&#39;s why it&#39;s not as maintainable as it should be, for two reasons:</p><ul> <li><p><strong>Its scope is too broad</strong>. Since the client is an abstraction of a server, it inevitably has to represent the server&#39;s <em>entire</em> functionality. When the functionality is rather limited there is no issue. Take <a href="https://hc.apache.org/httpcomponents-client-ga/httpclient/apidocs/org/apache/http/client/HttpClient.html"><code>HttpClient</code></a> from <a href="https://hc.apache.org/">Apache HttpComponents</a> as an example. However, when the server is more complex, the size of the client also grows. There are over 160 (!) methods in <code>AmazonS3Client</code> at the time of writing, while it started with only a few dozen just a few <del>years</del> hundred versions ago.</p></li> <li><p><strong>It is data focused</strong>. The very idea of a client-server relationship is about transferring data. Take the HTTP RESTful API of the AWS S3 service as an example. There are entities on the AWS side: buckets, objects, versions, access control policies, etc., and the server turns them into JSON/XML data. Then the <a href="/2016/11/21/naked-data.html">data</a> comes to us and the client on our side deals with JSON or XML. It inevitably remains <em>data</em> for us and never really becomes buckets, objects, or versions.</p></li></ul><p>The consequences depend on the situation, but these are the most probable:</p><ul> <li><p><strong>Procedural code</strong>. Since the client returns the data, the code that works with that data will <a href="/2016/11/21/naked-data.html">most likely</a> be procedural. Look at the results AWS SDK methods return, they all look like <a href="/2016/07/14/who-is-object.html">objects</a>, but in reality they are just data structures: <a href="http://docs.aws.amazon.com/AWSJavaSDK/latest/javadoc/com/amazonaws/services/s3/model/S3Object.html"><code>S3Object</code></a>, <a href="http://docs.aws.amazon.com/AWSJavaSDK/latest/javadoc/com/amazonaws/services/s3/model/ObjectMetadata.html"><code>ObjectMetadata</code></a>, <a href="http://docs.aws.amazon.com/AWSJavaSDK/latest/javadoc/com/amazonaws/services/s3/model/BucketPolicy.html"><code>BucketPolicy</code></a>, <a href="http://docs.aws.amazon.com/AWSJavaSDK/latest/javadoc/com/amazonaws/services/s3/model/PutObjectResult.html"><code>PutObjectResult</code></a>, etc. They are all <a href="/2016/07/06/data-transfer-object.html">Data Transfer Objects</a> with only <a href="/2014/09/16/getters-and-setters-are-evil.html">getters and setters</a> inside.</p></li> <li><p><strong>Duplicated code</strong>. If we actually decide to stay object-oriented we will have to turn the data the client returns to us into <a href="/2016/07/14/who-is-object.html">objects</a>. Most likely this will lead to code duplication in multiple projects. I had that too, when I started to work with S3 SDK. Very soon I realized that in order to avoid duplication I&#39;d better create a library that does the job of converting S3 SDK data into objects: <a href="https://github.com/jcabi/jcabi-s3">jcabi-s3</a>.</p></li> <li><p><strong>Difficulties with testing</strong>. Since the client is in most cases a rather big class/interface, mocking it in unit tests or creating its <a href="/2014/09/23/built-in-fake-objects.html">test doubles/fakes</a> is a rather complex task.</p></li> <li><p><strong>Static problems</strong>. Client classes, even though their methods are not static, look very similar to <a href="/2014/05/05/oop-alternative-to-utility-classes.html">utility classes</a>, which are well known for being <a href="/2014/09/10/anti-patterns-in-oop.html">anti-OOP</a>. The issues we have with utility classes are almost the same as those we have with &quot;client&quot; classes.</p></li> <li><p><strong>Extendability issues</strong>. Needless to say, it&#39;s almost impossible to <a href="/2015/02/26/composable-decorators.html">decorate</a> a client object when it has 160+ methods and keeps on growing. The only possible way to add new functionality to it is by creating new methods. Eventually we get a <a href="https://en.wikipedia.org/wiki/God_object">monster class</a> that can&#39;t be re-used anyhow without modification.</p></li></ul><p>What is the alternative?</p><p>The right design would be to replace &quot;clients&quot; with client-side objects that represent <em>entities</em> of the server side, not the entire server. For example, with the S3 SDK, that could be <code>Bucket</code>, <code>Object</code>, <code>Version</code>, <code>Policy</code>, etc. Each of them exposes the functionality of real <a href="http://docs.aws.amazon.com/AmazonS3/latest/dev/UsingBucket.html">buckets</a>, <a href="http://docs.aws.amazon.com/AmazonS3/latest/dev/UsingObjects.html">objects</a> and <a href="http://docs.aws.amazon.com/AmazonS3/latest/dev/ObjectVersioning.html">versions</a>, which the AWS S3 can expose.</p><aside class='quote'>The right design would be to replace clients with client-side objects that represent entities of the server side.</aside><p>Of course, we will need a high-level object that somehow represents the entire API/server, but it should be small. For example, in the S3 SDK example it could be called <code>Region</code>, which means the entire <a href="http://docs.aws.amazon.com/general/latest/gr/rande.html#s3_region">AWS region</a> with buckets. Then we could retrieve a bucket from it and won&#39;t need a region anymore. Then, to list objects in the bucket we ask the bucket to do it for us. No need to communicate with the entire &quot;server object&quot; every time, even though technically such a communication happens, of course.</p><p>To summarize, the trouble is not exactly in the name suffix, but in the very idea of representing the entire server on the client side rather than its <em>entities</em>. Such an abstraction is 1) too big and 2) very data driven.</p><p>BTW, check out some of the <a href="http://www.jcabi.com">JCabi libraries</a> (Java) for examples of object-oriented clients without &quot;client&quot; objects: <a href="http://github.jcabi.com">jcabi-github</a>, <a href="http://dynamo.jcabi.com">jcabi-dynamo</a>, <a href="http://s3.jcabi.com">jcabi-s3</a>, or <a href="http://simpledb.jcabi.com">jcabi-simpledb</a>.</p></p><nav class="buttons notranslate desktop-only"> <a href="http://www.facebook.com/sharer/sharer.php?u=https://www.yegor256.com/2017/09/12/evil-object-name-suffix-client.html" title="Share on Facebook" class="button" rel="nofollow"> <span class="count count-facebook">0</span> <i class="icon icon-facebook notranslate" aria-hidden="true"></i> </a> <a href="https://twitter.com/share?url=https://www.yegor256.com/2017/09/12/evil-object-name-suffix-client.html&amp;text=Yet+Another+Evil+Suffix+For+Object+Names%3A+Client" title="Share on Twitter" class="button" rel="nofollow"> <span class="count count-twitter">0</span> <i class="icon icon-twitter notranslate" aria-hidden="true"></i> </a> <a href="https://plus.google.com/share?url=https://www.yegor256.com/2017/09/12/evil-object-name-suffix-client.html" title="Share on Google+" class="button" rel="nofollow"> <span class="count count-googleplus">0</span> <i class="icon icon-googleplus notranslate" aria-hidden="true"></i> </a> <a href="https://www.linkedin.com/cws/share?url=https://www.yegor256.com/2017/09/12/evil-object-name-suffix-client.html" title="Share on LinkedIn" class="button" rel="nofollow"> <span class="count count-linkedin">0</span> <i class="icon icon-linkedin notranslate" aria-hidden="true"></i> </a> <a href="http://reddit.com/submit?url=https://www.yegor256.com/2017/09/12/evil-object-name-suffix-client.html%3F2017-37&amp;title=Yet+Another+Evil+Suffix+For+Object+Names%3A+Client" title="Share on Reddit" class="button" rel="nofollow"> <span class="count count-reddit">0</span> <i class="icon icon-reddit notranslate" aria-hidden="true"></i> </a> <a href="http://news.ycombinator.com/submitlink?u=https://www.yegor256.com/2017/09/12/evil-object-name-suffix-client.html%3F2017-37&amp;t=Yet+Another+Evil+Suffix+For+Object+Names%3A+Client" title="Share on Hacker News" class="button" rel="nofollow"> <span class="count count-hackernews">0</span> <i class="icon icon-hackernews notranslate" aria-hidden="true"></i> </a> </nav> </header> <article class="main" itemprop="articleBody"><div ><p>Some time ago we <a href="/2015/03/09/objects-end-with-er.html">were talking</a> about &quot;-ER&quot; suffixes in object and class names. We agreed that they were evil and must be avoided if we want our code to be truly object-oriented and our objects to be objects instead of collections of procedures. Now I&#39;m ready to introduce a new evil suffix: <code>Client</code>.</p><figure class='jb_picture'><img itemprop='image' alt='Sin noticias de Dios (2001) by Agustín Díaz Yanes' src='/images/2017/09/dont-tempt-me.jpg' longdesc='#467f4c9d'/><figcaption id='467f4c9d'>Sin noticias de Dios (2001) by Agustín Díaz Yanes</figcaption></figure><p>Let me give an example first. This is what an object with such a suffix may look like (it&#39;s a pseudo-code version of the <a href="http://docs.aws.amazon.com/AWSJavaSDK/latest/javadoc/com/amazonaws/services/s3/AmazonS3Client.html"><code>AmazonS3Client</code></a> from <a href="https://aws.amazon.com/sdk-for-java/">AWS Java SDK</a>):</p><figure class="highlight"><pre><code class="language-java" data-lang="java"><span></span><span class="kd">class</span> <span class="nc">AmazonS3Client</span> <span class="o">{</span>
  <span class="n">createBucket</span><span class="o">(</span><span class="n">String</span> <span class="n">name</span><span class="o">);</span>
  <span class="n">deleteBucket</span><span class="o">(</span><span class="n">String</span> <span class="n">name</span><span class="o">);</span>
  <span class="n">doesBucketExist</span><span class="o">(</span><span class="n">String</span> <span class="n">name</span><span class="o">);</span>
  <span class="n">getBucketAcl</span><span class="o">(</span><span class="n">String</span> <span class="n">name</span><span class="o">)</span>
  <span class="n">getBucketPolicy</span><span class="o">(</span><span class="n">String</span> <span class="n">name</span><span class="o">);</span>
  <span class="n">listBuckets</span><span class="o">();</span>
  <span class="c1">// 160+ more methods here</span>
<span class="o">}</span></code></pre></figure><p>All &quot;clients&quot; look similar: they encapsulate the destination URL with some access credentials and expose a number of methods, which transport the data to/from the &quot;server.&quot; Even though this design looks like a <a href="/2014/11/20/seven-virtues-of-good-object.html">proper object</a>, it doesn&#39;t really follow the true spirit of object-orientation. That&#39;s why it&#39;s not as maintainable as it should be, for two reasons:</p><ul> <li><p><strong>Its scope is too broad</strong>. Since the client is an abstraction of a server, it inevitably has to represent the server&#39;s <em>entire</em> functionality. When the functionality is rather limited there is no issue. Take <a href="https://hc.apache.org/httpcomponents-client-ga/httpclient/apidocs/org/apache/http/client/HttpClient.html"><code>HttpClient</code></a> from <a href="https://hc.apache.org/">Apache HttpComponents</a> as an example. However, when the server is more complex, the size of the client also grows. There are over 160 (!) methods in <code>AmazonS3Client</code> at the time of writing, while it started with only a few dozen just a few <del>years</del> hundred versions ago.</p></li> <li><p><strong>It is data focused</strong>. The very idea of a client-server relationship is about transferring data. Take the HTTP RESTful API of the AWS S3 service as an example. There are entities on the AWS side: buckets, objects, versions, access control policies, etc., and the server turns them into JSON/XML data. Then the <a href="/2016/11/21/naked-data.html">data</a> comes to us and the client on our side deals with JSON or XML. It inevitably remains <em>data</em> for us and never really becomes buckets, objects, or versions.</p></li></ul><p>The consequences depend on the situation, but these are the most probable:</p><ul> <li><p><strong>Procedural code</strong>. Since the client returns the data, the code that works with that data will <a href="/2016/11/21/naked-data.html">most likely</a> be procedural. Look at the results AWS SDK methods return, they all look like <a href="/2016/07/14/who-is-object.html">objects</a>, but in reality they are just data structures: <a href="http://docs.aws.amazon.com/AWSJavaSDK/latest/javadoc/com/amazonaws/services/s3/model/S3Object.html"><code>S3Object</code></a>, <a href="http://docs.aws.amazon.com/AWSJavaSDK/latest/javadoc/com/amazonaws/services/s3/model/ObjectMetadata.html"><code>ObjectMetadata</code></a>, <a href="http://docs.aws.amazon.com/AWSJavaSDK/latest/javadoc/com/amazonaws/services/s3/model/BucketPolicy.html"><code>BucketPolicy</code></a>, <a href="http://docs.aws.amazon.com/AWSJavaSDK/latest/javadoc/com/amazonaws/services/s3/model/PutObjectResult.html"><code>PutObjectResult</code></a>, etc. They are all <a href="/2016/07/06/data-transfer-object.html">Data Transfer Objects</a> with only <a href="/2014/09/16/getters-and-setters-are-evil.html">getters and setters</a> inside.</p></li> <li><p><strong>Duplicated code</strong>. If we actually decide to stay object-oriented we will have to turn the data the client returns to us into <a href="/2016/07/14/who-is-object.html">objects</a>. Most likely this will lead to code duplication in multiple projects. I had that too, when I started to work with S3 SDK. Very soon I realized that in order to avoid duplication I&#39;d better create a library that does the job of converting S3 SDK data into objects: <a href="https://github.com/jcabi/jcabi-s3">jcabi-s3</a>.</p></li> <li><p><strong>Difficulties with testing</strong>. Since the client is in most cases a rather big class/interface, mocking it in unit tests or creating its <a href="/2014/09/23/built-in-fake-objects.html">test doubles/fakes</a> is a rather complex task.</p></li> <li><p><strong>Static problems</strong>. Client classes, even though their methods are not static, look very similar to <a href="/2014/05/05/oop-alternative-to-utility-classes.html">utility classes</a>, which are well known for being <a href="/2014/09/10/anti-patterns-in-oop.html">anti-OOP</a>. The issues we have with utility classes are almost the same as those we have with &quot;client&quot; classes.</p></li> <li><p><strong>Extendability issues</strong>. Needless to say, it&#39;s almost impossible to <a href="/2015/02/26/composable-decorators.html">decorate</a> a client object when it has 160+ methods and keeps on growing. The only possible way to add new functionality to it is by creating new methods. Eventually we get a <a href="https://en.wikipedia.org/wiki/God_object">monster class</a> that can&#39;t be re-used anyhow without modification.</p></li></ul><p>What is the alternative?</p><p>The right design would be to replace &quot;clients&quot; with client-side objects that represent <em>entities</em> of the server side, not the entire server. For example, with the S3 SDK, that could be <code>Bucket</code>, <code>Object</code>, <code>Version</code>, <code>Policy</code>, etc. Each of them exposes the functionality of real <a href="http://docs.aws.amazon.com/AmazonS3/latest/dev/UsingBucket.html">buckets</a>, <a href="http://docs.aws.amazon.com/AmazonS3/latest/dev/UsingObjects.html">objects</a> and <a href="http://docs.aws.amazon.com/AmazonS3/latest/dev/ObjectVersioning.html">versions</a>, which the AWS S3 can expose.</p><aside class='quote'>The right design would be to replace clients with client-side objects that represent entities of the server side.</aside><p>Of course, we will need a high-level object that somehow represents the entire API/server, but it should be small. For example, in the S3 SDK example it could be called <code>Region</code>, which means the entire <a href="http://docs.aws.amazon.com/general/latest/gr/rande.html#s3_region">AWS region</a> with buckets. Then we could retrieve a bucket from it and won&#39;t need a region anymore. Then, to list objects in the bucket we ask the bucket to do it for us. No need to communicate with the entire &quot;server object&quot; every time, even though technically such a communication happens, of course.</p><p>To summarize, the trouble is not exactly in the name suffix, but in the very idea of representing the entire server on the client side rather than its <em>entities</em>. Such an abstraction is 1) too big and 2) very data driven.</p><p>BTW, check out some of the <a href="http://www.jcabi.com">JCabi libraries</a> (Java) for examples of object-oriented clients without &quot;client&quot; objects: <a href="http://github.jcabi.com">jcabi-github</a>, <a href="http://dynamo.jcabi.com">jcabi-dynamo</a>, <a href="http://s3.jcabi.com">jcabi-s3</a>, or <a href="http://simpledb.jcabi.com">jcabi-simpledb</a>.</p></div></article></div><div class="wrapper"> <related-posts /></div><div class="disqus" role="complementary"><p class="disqus_hint"> Please, use <a href="https://help.disqus.com/commenting/what-html-tags-are-allowed-within-comments">syntax highlighting</a> in your comments, to make them more readable.</p><div id="disqus_thread" class="disqus-thread"> <a>&nbsp;</a></div><script> var disqus_config = function () { this.page.url = document.location.href.split('?')[0].split('#')[0].replace('https://', 'http://'); this.page.identifier = this.page.url; }; (function() { var d = document, s = d.createElement('script'); s.src = '//yegor256.disqus.com/embed.js'; s.setAttribute('data-timestamp', +new Date()); (d.head || d.body).appendChild(s); })(); </script> <noscript><div><p class="red"> JavaScript is disabled in your browser, that's why you can't see comments under this post.</p></div></noscript></div><div class="wrapper"> <footer class="footer"><p> &copy; <span itemscope="" itemprop="copyrightHolder" itemtype="http://schema.org/Person"> <span itemprop="name">Yegor Bugayenko</span> </span> 2014&ndash;<span itemprop="copyrightYear">2018</span></p></footer></div></section><div class="wrapper unprintable" style="text-align:center;margin-top:2em;"> <a href="http://www.sixnines.io/h/3ba1652f"> <img src="//www.sixnines.io/b/3ba1652f?style=flat" alt="sixnines availability badge"/> </a></div><script src="//code.jquery.com/jquery-1.9.0.min.js"></script> <script src="/js/all.js?a0e0d018c07"></script> <script>var disqus_shortname = 'yegor256';</script> <script id="dsq-count-scr" src="//yegor256.disqus.com/count.js" async="async"></script> <script> (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){ (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o), m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m) })(window,document,'script','//www.google-analytics.com/analytics.js','ga'); ga('create', 'UA-1963507-32', 'auto'); ga('send', 'pageview'); </script> <script> Cd=document;Cr="&"+Math.random();Cp="&s=1"; Cd.cookie="b=b";if(Cd.cookie)Cp+="&c=1"; Cp+="&t="+(new Date()).getTimezoneOffset(); if(self!=top)Cp+="&f=1"; </script> <script> if(navigator.javaEnabled())Cp+="&j=1"; </script> <script> if(typeof(screen)!='undefined')Cp+="&w="+screen.width+"&h="+ screen.height+"&d="+(screen.colorDepth?screen.colorDepth:screen.pixelDepth); </script> <script> Cd.write("<img src='//c.hit.ua/hit?i=95870&g=0&x=2"+Cp+Cr+ "&r="+escape(Cd.referrer)+"&u="+escape(window.location.href)+ "' border='0' wi"+"dth='1' he"+"ight='1'/>"); </script> <script type="application/ld+json"> { "@context": "http://schema.org", "@type": "Person", "name": "Yegor Bugayenko", "url": "http://www.yegor256.com", "sameAs": [ "https://www.facebook.com/yegor256", "https://instagram.com/yegor256", "https://www.linkedin.com/in/yegor256", "https://twitter.com/yegor256", "https://github.com/yegor256", "https://www.pinterest.com/yegor256/" ] } </script> </body> </html> <!DOCTYPE html> <html xmlns="http://www.w3.org/1999/xhtml" lang="en-US" xml:lang="en-US" itemscope="" itemtype="http://schema.org/WebSite"> <head> <meta charset="utf-8"/> <meta name="description" content="Resource Acquisition Is Initialization (RAII) is a design idea introduced in C++; it is applicable to Java as well. " /> <meta name="keywords" content="RAII, RAII in C++, RAII in Java, RAII in OOP, resource acquisition is initialization" /> <meta name="viewport" content="width=device-width,minimum-scale=1,initial-scale=1"/> <meta name="google-site-verification" content="JEj_gQr2CPe2QKGw8XdMz0R7VboQIUbX3FlM-lwTq-8" /> <meta name="author" content="Yegor Bugayenko"> <meta name="article:published_time" content="2017-08-08 00:00:00 +0000"> <meta name="og:site_name" content="Yegor Bugayenko"/> <meta name="og:type" content="article" /> <meta name="og:locale" content="en_US" /> <meta name="twitter:account_id" content="4503599630178231" /> <meta name="twitter:creator" content="@yegor256"/> <meta name="twitter:site" content="@yegor256"/> <meta name="twitter:title" property="og:title" content="RAII in Java"/> <meta name="twitter:description" property="og:description" content="Resource Acquisition Is Initialization (RAII) is a design idea introduced in C++; it is applicable to Java as well. "/> <meta name="twitter:url" property="og:url" content="https://www.yegor256.com/2017/08/08/raii-in-java.html"/> <meta name="telegram:channel" content="AAAAAEJFMRzsRTRxM3ec6A"/> <link rel="search" type="application/opensearchdescription+xml" href="/opensearch.xml" title="yegor256" /> <link rel="shortcut icon" href="/favicon.ico?a0e0d018c07"/> <link rel="apple-touch-icon" href="/favicon.ico?a0e0d018c07"/> <link rel="alternate" type="application/rss+xml" title="RSS for yegor256.com" href="https://www.yegor256.com/rss.xml"/> <link rel="stylesheet" href="/css/layout.css?a0e0d018c07"/> <link rel="stylesheet" href="/css/icons.css?a0e0d018c07"/> <link rel="canonical" href="https://www.yegor256.com/2017/08/08/raii-in-java.html" /> <link rel="amphtml" href="https://www.yegor256.com/2017/08/08/raii-in-java.amp.html" /> <title>RAII in Java </title> <meta name='og:image' content='https://www.yegor256.com/images/2017/08/at-sachem-farm.jpg'/><meta name='twitter:image' content='https://www.yegor256.com/images/2017/08/at-sachem-farm.jpg'/><meta name='og:image:width' content='1280'/> <meta name='twitter:image:width' content='1280'/><meta name='og:image:height' content='674'/> <meta name='twitter:image:height' content='674'/><meta name='twitter:card' content='summary_large_image'/><meta name='twitter:image:alt' content='At Sachem Farm (1998) by John Huddles'/> </head> <body><div class="wrapper"> <aside class="header-toggle unprintable" id="header-toggle" title="Show the menu" onclick="$('#header').show();$('#header-toggle').hide();">&#9776;</aside> <header class="header" id="header"><div class="face"> <a href="/about-me.html#form" class="sub" title="Click to subscribe to my monthly newsletter"><span>Subscribe</span></a> <a href="/about-me.html" style="position:relative;"> <img src="/images/face-256x256.jpg" class="photo" alt="Yegor Bugayenko"/> </a></div><nav><ul class="menu social notranslate"> <li><a href="https://twitter.com/intent/follow?screen_name=yegor256" rel="nofollow" title="Follow me on Twitter"><i class="icon icon-twitter notranslate" aria-hidden="true"></i></a></li> <li><a href="/rss.xml" rel="nofollow" title="Subscribe to my RSS feed"><i class="icon icon-rss notranslate" aria-hidden="true"></i></a></li> <li><a itemprop="sameAs" href="https://github.com/yegor256" rel="nofollow" title="My GitHub profile"><i class="icon icon-github notranslate" aria-hidden="true"></i></a></li> <li><a itemprop="sameAs" href="http://stackoverflow.com/users/187141/yegor256" rel="nofollow" title="My StackOverflow profile"><i class="icon icon-stackoverflow notranslate" aria-hidden="true"></i></a></li> <li><a itemprop="sameAs" href="https://www.facebook.com/yegor256" rel="nofollow" title="Follow me on Facebook"><i class="icon icon-facebook notranslate" aria-hidden="true"></i></a></li> <li><a itemprop="sameAs" href="https://instagram.com/yegor256" rel="nofollow" title="Follow me on Instagram"><i class="icon icon-instagram notranslate" aria-hidden="true"></i></a></li> <li><a itemprop="sameAs" href="https://www.linkedin.com/in/yegor256" rel="nofollow" title="My LinkedIn profile"><i class="icon icon-linkedin notranslate" aria-hidden="true"></i></a></li> <li><a itemprop="sameAs" href="https://www.youtube.com/c/yegor256?sub_confirmation=1" rel="nofollow" title="My Youtube video channel"><i class="icon icon-youtube notranslate" aria-hidden="true"></i></a></li> <li><a itemprop="sameAs" href="https://www.pinterest.com/yegor256/" rel="nofollow" title="My Pinterest boards"><i class="icon icon-pinterest notranslate" aria-hidden="true"></i></a></li> <li><a itemprop="sameAs" href="https://angel.co/yegor256" rel="nofollow" title="My AngelList profile"><i class="icon icon-angellist notranslate" aria-hidden="true"></i></a></li> <li><a href="https://soundcloud.com/yegor256" rel="nofollow" title="My podcast"><i class="icon icon-podcast notranslate" aria-hidden="true"></i></a></li> <li><a href="https://itunes.apple.com/us/podcast/yegor256-podcast/id1150826721" rel="nofollow" title="My iTunes podcast"><i class="icon icon-itunes notranslate" aria-hidden="true"></i></a></li> <li><a href="https://t.me/joinchat/AAAAAEJFMRzsRTRxM3ec6A" rel="nofollow" title="My Telegram public channel"><i class="icon icon-telegram notranslate" aria-hidden="true"></i></a></li> <li><a href="mailto:blog@yegor256.com" rel="nofollow" title="Email me any time"><i class="icon icon-mail notranslate" aria-hidden="true"></i></a></li></ul><ul class="menu"> <li><a href="/" title="Home page">Home</a></li> <li ><a href="/best.html" title="Best articles to read">12&#160;Best</a></li> <li ><a href="/contents.html" title="The contents of the entire blog">All&#160;288</a></li> <li ><a href="/webinars.html" title="My webinars">Webinars</a></li> <li ><a href="/talks.html" title="Future and past conference talks">Talks</a></li> <li ><a href="/books.html" title="The books I wrote">Books</a></li> <li ><a href="/papers.html" title="My academic papers and patents">Papers</a></li> <li ><a href="/pets.html" title="My loved pet projects">Pets</a></li> <li ><a href="/award.html" title="Software quality award">Award</a></li> <li ><a href="/testimonials.html" title="What some people say about me">Testimonials</a></li> <li ><a href="/shift-m.html" title="Audio podcast about project management">Shift-M</a></li> <li ><a href="/paintings.html" title="My paintings for sale">Paintings</a></li> <li><a href="http://ru.yegor256.com/" title="Немного на русском языке">По-русски</a></li></ul></nav><div class="search"> <form method="get" action="https://www.google.com/search" itemprop="potentialAction" itemscope="" itemtype="http://schema.org/SearchAction"> <meta itemprop="target" content="https://www.google.com/search?q={q}"/> <input name="sitesearch" value="yegor256.com" type="hidden"/> <input itemprop="query-input" type="text" id="search-query" class="field field-text" required="required" onfocus="$('.google').css('visibility', 'visible');" name="q" placeholder="Search..." autocomplete="off"/> <input type="image" src="/images/google-search-icon.svg" class="google" title="Search via Google" alt="Search via Google"/> </form></div><div class="hot"><ul> <li> <a href="/code-ahead.html">Code Ahead</a> was published on Amazon just a few days ago! It is my new book, a novel about programmers. It explains in details the majority of ideas that stand behind <a href="https://www.zerocracy.com">Zerocracy</a> and <a href="https://www.xdsd.org">XDSD</a>. </li> <li> At <a href="/webinars.html">Webinar #37</a> we will discuss naming problem in OOP, for objects, methods and attributes; join us on <b>September 12</b>, at 11am PST. </li></ul></div></header></div><section itemscope="" itemtype="http://schema.org/BlogPosting"><div class="wrapper"> <header><p class="printable"> <img src="https://api.qrserver.com/v1/create-qr-code/?data=https://www.yegor256.com/2017/08/08/raii-in-java.html&amp;format=svg" style="width:125px;height:125px;" alt="QR code"/></p><p class="printable"> <code itemprop="url">https://www.yegor256.com/2017/08/08/raii-in-java.html</code></p><h1 itemprop="name headline mainEntityOfPage">RAII in Java</h1><aside class='book'><a href='http://amzn.to/2qFt4Tn'><img src='/images/books/elegant-objects/cover.png' class='book-cover' alt='book cover'/></a>Read more about this subject in <a href='http://amzn.to/2qFt4Tn'>Section&nbsp;4.4</a><br/> of my book<a href='http://amzn.to/2qFt4Tn'><img src='/images/books/amazon-buy-button.png' class='amazon-button' alt='Click to buy'/></a></aside><ul class="subline"> <li> <time itemprop="datePublished" datetime="2017-08-08T00:00:00+00:00"> 8 August 2017 </time> </li> <li class="desktop-only" itemprop="locationCreated">Riga, Latvia</li> <li class="printable" itemscope="" itemprop="author" itemtype="http://schema.org/Person"> <span itemprop="name">Yegor Bugayenko</span> </li> <li class="unprintable"> <i class="icon icon-comments"></i> <a href="http://www.yegor256.com/2017/08/08/raii-in-java.html#disqus_thread" itemprop="discussionUrl">comments</a> </li></ul><p class="unprintable"><p>Resource Acquisition Is Initialization (<a href="https://en.wikipedia.org/wiki/Resource_acquisition_is_initialization">RAII</a>) is a design idea introduced in C++ by <a href="http://amzn.to/2uMlANB">Bjarne Stroustrup</a> for exception-safe resource management. Thanks to garbage collection Java <a href="https://stackoverflow.com/questions/477399">doesn&#39;t have</a> this feature, but we can implement something similar, using <a href="https://docs.oracle.com/javase/tutorial/essential/exceptions/tryResourceClose.html">try-with-resources</a>.</p><figure class='jb_picture'><img itemprop='image' alt='At Sachem Farm (1998) by John Huddles' src='/images/2017/08/at-sachem-farm.jpg' longdesc='#7aef3b5b'/><figcaption id='7aef3b5b'>At Sachem Farm (1998) by John Huddles</figcaption></figure><p>The problem RAII is solving is obvious; have a look at this code (I&#39;m sure you know what <a href="https://docs.oracle.com/javase/7/docs/api/java/util/concurrent/Semaphore.html"><code>Semaphore</code></a> is and how it works in Java):</p><figure class="highlight"><pre><code class="language-java" data-lang="java"><span></span><span class="kd">class</span> <span class="nc">Foo</span> <span class="o">{</span>
  <span class="kd">private</span> <span class="n">Semaphore</span> <span class="n">sem</span> <span class="o">=</span> <span class="k">new</span> <span class="n">Semaphore</span><span class="o">(</span><span class="mi">5</span><span class="o">);</span>
  <span class="kt">void</span> <span class="nf">print</span><span class="o">(</span><span class="kt">int</span> <span class="n">x</span><span class="o">)</span> <span class="kd">throws</span> <span class="n">Exception</span> <span class="o">{</span>
    <span class="k">this</span><span class="o">.</span><span class="na">sem</span><span class="o">.</span><span class="na">acquire</span><span class="o">();</span>
    <span class="k">if</span> <span class="o">(</span><span class="n">x</span> <span class="o">&gt;</span> <span class="mi">1000</span><span class="o">)</span> <span class="o">{</span>
      <span class="k">throw</span> <span class="k">new</span> <span class="n">Exception</span><span class="o">(</span><span class="s">&quot;Too large!&quot;</span><span class="o">);</span>
    <span class="o">}</span>
    <span class="n">System</span><span class="o">.</span><span class="na">out</span><span class="o">.</span><span class="na">printf</span><span class="o">(</span><span class="s">&quot;x = %d&quot;</span><span class="o">,</span> <span class="n">x</span><span class="o">);</span>
    <span class="k">this</span><span class="o">.</span><span class="na">sem</span><span class="o">.</span><span class="na">release</span><span class="o">();</span>
  <span class="o">}</span>
<span class="o">}</span></code></pre></figure><p>The code is rather primitive and doesn&#39;t do anything useful, but you most probably get the idea: the method <code>print()</code>, if being called from multiple parallel threads, will allow only five of them to print in parallel. Sometimes it will not allow some of them to print and will throw an exception if <code>x</code> is bigger than <code>1000</code>.</p><p>The problem with this code is---<a href="https://en.wikipedia.org/wiki/Resource_leak">resource leakage</a>. Each <code>print()</code> call with <code>x</code> larger than <code>1000</code> will take one permit from the semaphore and won&#39;t return it. In five calls with exceptions the semaphore will be empty and all other threads won&#39;t print anything.</p><p>What is the solution? Here it is:</p><figure class="highlight"><pre><code class="language-java" data-lang="java"><span></span><span class="kd">class</span> <span class="nc">Foo</span> <span class="o">{</span>
  <span class="kd">private</span> <span class="n">Semaphore</span> <span class="n">sem</span> <span class="o">=</span> <span class="k">new</span> <span class="n">Semaphore</span><span class="o">(</span><span class="mi">5</span><span class="o">);</span>
  <span class="kt">void</span> <span class="nf">print</span><span class="o">(</span><span class="kt">int</span> <span class="n">x</span><span class="o">)</span> <span class="kd">throws</span> <span class="n">Exception</span> <span class="o">{</span>
    <span class="k">this</span><span class="o">.</span><span class="na">sem</span><span class="o">.</span><span class="na">acquire</span><span class="o">();</span>
    <span class="k">if</span> <span class="o">(</span><span class="n">x</span> <span class="o">&gt;</span> <span class="mi">1000</span><span class="o">)</span> <span class="o">{</span>
      <span class="k">this</span><span class="o">.</span><span class="na">sem</span><span class="o">.</span><span class="na">release</span><span class="o">();</span>
      <span class="k">throw</span> <span class="k">new</span> <span class="n">Exception</span><span class="o">(</span><span class="s">&quot;Too large!&quot;</span><span class="o">);</span>
    <span class="o">}</span>
    <span class="n">System</span><span class="o">.</span><span class="na">out</span><span class="o">.</span><span class="na">printf</span><span class="o">(</span><span class="s">&quot;x = %d&quot;</span><span class="o">,</span> <span class="n">x</span><span class="o">);</span>
    <span class="k">this</span><span class="o">.</span><span class="na">sem</span><span class="o">.</span><span class="na">release</span><span class="o">();</span>
  <span class="o">}</span>
<span class="o">}</span></code></pre></figure><p>We must release the permit before we throw the exception.</p><p>However, there is another problem that shows up: code duplication. We release the permit in two places. If we add more <code>throw</code> instructions we will also have to add more <code>sem.release()</code> calls.</p><p>A very elegant solution was introduced in C++ and is called RAII. This is how it would look in Java:</p><figure class="highlight"><pre><code class="language-java" data-lang="java"><span></span><span class="kd">class</span> <span class="nc">Permit</span> <span class="o">{</span>
  <span class="kd">private</span> <span class="n">Semaphore</span> <span class="n">sem</span><span class="o">;</span>
  <span class="n">Permit</span><span class="o">(</span><span class="n">Semaphore</span> <span class="n">s</span><span class="o">)</span> <span class="o">{</span>
    <span class="k">this</span><span class="o">.</span><span class="na">sem</span> <span class="o">=</span> <span class="n">s</span><span class="o">;</span>
    <span class="k">this</span><span class="o">.</span><span class="na">sem</span><span class="o">.</span><span class="na">acquire</span><span class="o">();</span>
  <span class="o">}</span>
  <span class="nd">@Override</span>
  <span class="kd">public</span> <span class="kt">void</span> <span class="nf">finalize</span><span class="o">()</span> <span class="o">{</span>
    <span class="k">this</span><span class="o">.</span><span class="na">sem</span><span class="o">.</span><span class="na">release</span><span class="o">();</span>
  <span class="o">}</span>
<span class="o">}</span>
<span class="kd">class</span> <span class="nc">Foo</span> <span class="o">{</span>
  <span class="kd">private</span> <span class="n">Semaphore</span> <span class="n">sem</span> <span class="o">=</span> <span class="k">new</span> <span class="n">Semaphore</span><span class="o">(</span><span class="mi">5</span><span class="o">);</span>
  <span class="kt">void</span> <span class="nf">print</span><span class="o">(</span><span class="kt">int</span> <span class="n">x</span><span class="o">)</span> <span class="kd">throws</span> <span class="n">Exception</span> <span class="o">{</span>
    <span class="k">new</span> <span class="n">Permit</span><span class="o">(</span><span class="k">this</span><span class="o">.</span><span class="na">sem</span><span class="o">);</span>
    <span class="k">if</span> <span class="o">(</span><span class="n">x</span> <span class="o">&gt;</span> <span class="mi">1000</span><span class="o">)</span> <span class="o">{</span>
      <span class="k">throw</span> <span class="k">new</span> <span class="n">Exception</span><span class="o">(</span><span class="s">&quot;Too large!&quot;</span><span class="o">);</span>
    <span class="o">}</span>
    <span class="n">System</span><span class="o">.</span><span class="na">out</span><span class="o">.</span><span class="na">printf</span><span class="o">(</span><span class="s">&quot;x = %d&quot;</span><span class="o">,</span> <span class="n">x</span><span class="o">);</span>
  <span class="o">}</span>
<span class="o">}</span></code></pre></figure><p>See how beautiful the code is inside method <code>Foo.print()</code>. We just create an instance of class <code>Permit</code> and it immediately acquires a new permit at the semaphore. Then we exit the method <code>print()</code>, either by exception or in the normal way, and the method <code>Permit.finalize()</code> releases the permit.</p><p>Elegant, isn&#39;t it? Yes, it is, but it won&#39;t work in Java.</p><p>It won&#39;t work because, unlike C++, Java doesn&#39;t destroy objects when their scope of visibility is closed. The object of class <code>Permit</code> won&#39;t be destroyed when we exit the method <code>print()</code>. It will be destroyed <em>eventually</em> but we don&#39;t know when exactly. Most likely it will be destroyed way after all permits in the semaphore got acquired and we get blocked.</p><p>There is a solution in Java too. It is not as elegant as the one from C++, but it does work. Here it is:</p><figure class="highlight"><pre><code class="language-java" data-lang="java"><span></span><span class="kd">class</span> <span class="nc">Permit</span> <span class="kd">implements</span> <span class="n">Closeable</span> <span class="o">{</span>
  <span class="kd">private</span> <span class="n">Semaphore</span> <span class="n">sem</span><span class="o">;</span>
  <span class="n">Permit</span><span class="o">(</span><span class="n">Semaphore</span> <span class="n">s</span><span class="o">)</span> <span class="o">{</span>
    <span class="k">this</span><span class="o">.</span><span class="na">sem</span> <span class="o">=</span> <span class="n">s</span><span class="o">;</span>
  <span class="o">}</span>
  <span class="nd">@Override</span>
  <span class="kd">public</span> <span class="kt">void</span> <span class="nf">close</span><span class="o">()</span> <span class="o">{</span>
    <span class="k">this</span><span class="o">.</span><span class="na">sem</span><span class="o">.</span><span class="na">release</span><span class="o">();</span>
  <span class="o">}</span>
  <span class="kd">public</span> <span class="n">Permit</span> <span class="nf">acquire</span><span class="o">()</span> <span class="o">{</span>
    <span class="k">this</span><span class="o">.</span><span class="na">sem</span><span class="o">.</span><span class="na">acquire</span><span class="o">();</span>
    <span class="k">return</span> <span class="k">this</span><span class="o">;</span>
  <span class="o">}</span>
<span class="o">}</span>
<span class="kd">class</span> <span class="nc">Foo</span> <span class="o">{</span>
  <span class="kd">private</span> <span class="n">Semaphore</span> <span class="n">sem</span> <span class="o">=</span> <span class="k">new</span> <span class="n">Semaphore</span><span class="o">(</span><span class="mi">5</span><span class="o">);</span>
  <span class="kt">void</span> <span class="nf">print</span><span class="o">(</span><span class="kt">int</span> <span class="n">x</span><span class="o">)</span> <span class="kd">throws</span> <span class="n">Exception</span> <span class="o">{</span>
    <span class="k">try</span> <span class="o">(</span><span class="n">Permit</span> <span class="n">p</span> <span class="o">=</span> <span class="k">new</span> <span class="n">Permit</span><span class="o">(</span><span class="k">this</span><span class="o">.</span><span class="na">sem</span><span class="o">).</span><span class="na">acquire</span><span class="o">())</span> <span class="o">{</span>
      <span class="k">if</span> <span class="o">(</span><span class="n">x</span> <span class="o">&gt;</span> <span class="mi">1000</span><span class="o">)</span> <span class="o">{</span>
        <span class="k">throw</span> <span class="k">new</span> <span class="n">Exception</span><span class="o">(</span><span class="s">&quot;Too large!&quot;</span><span class="o">);</span>
      <span class="o">}</span>
      <span class="n">System</span><span class="o">.</span><span class="na">out</span><span class="o">.</span><span class="na">printf</span><span class="o">(</span><span class="s">&quot;x = %d&quot;</span><span class="o">,</span> <span class="n">x</span><span class="o">);</span>
    <span class="o">}</span>
  <span class="o">}</span>
<span class="o">}</span></code></pre></figure><p>Pay attention to the <code>try</code> block and to the <a href="https://docs.oracle.com/javase/7/docs/api/java/io/Closeable.html"><code>Closeable</code></a> interface that the class <code>Permit</code> now implements. The object <code>p</code> will be &quot;closed&quot; when the <code>try</code> block exits. It may exit either at the end, or by the <code>return</code> or <code>throw</code> statements. In either case <code>Permit.close()</code> will be called: this is how <a href="https://docs.oracle.com/javase/tutorial/essential/exceptions/tryResourceClose.html">try-with-resources</a> works in Java.</p><p>I introduced method <code>acquire()</code> and moved <code>sem.acquire()</code> out of the <code>Permit</code> constructor because I <a href="/2015/05/07/ctors-must-be-code-free.html">believe</a> that constructors must be code-free.</p><p>To summarize, RAII is a perfect design <del>pattern</del> approach when you deal with resources that may <a href="https://en.wikipedia.org/wiki/Resource_leak">leak</a>. Even though Java doesn&#39;t have it out of the box we can implement it via <a href="https://docs.oracle.com/javase/tutorial/essential/exceptions/tryResourceClose.html">try-with-resources</a> and <a href="https://docs.oracle.com/javase/7/docs/api/java/io/Closeable.html"><code>Closeable</code></a>.</p></p><nav class="buttons notranslate desktop-only"> <a href="http://www.facebook.com/sharer/sharer.php?u=https://www.yegor256.com/2017/08/08/raii-in-java.html" title="Share on Facebook" class="button" rel="nofollow"> <span class="count count-facebook">0</span> <i class="icon icon-facebook notranslate" aria-hidden="true"></i> </a> <a href="https://twitter.com/share?url=https://www.yegor256.com/2017/08/08/raii-in-java.html&amp;text=RAII+in+Java" title="Share on Twitter" class="button" rel="nofollow"> <span class="count count-twitter">0</span> <i class="icon icon-twitter notranslate" aria-hidden="true"></i> </a> <a href="https://plus.google.com/share?url=https://www.yegor256.com/2017/08/08/raii-in-java.html" title="Share on Google+" class="button" rel="nofollow"> <span class="count count-googleplus">0</span> <i class="icon icon-googleplus notranslate" aria-hidden="true"></i> </a> <a href="https://www.linkedin.com/cws/share?url=https://www.yegor256.com/2017/08/08/raii-in-java.html" title="Share on LinkedIn" class="button" rel="nofollow"> <span class="count count-linkedin">0</span> <i class="icon icon-linkedin notranslate" aria-hidden="true"></i> </a> <a href="http://reddit.com/submit?url=https://www.yegor256.com/2017/08/08/raii-in-java.html%3F2017-32&amp;title=RAII+in+Java" title="Share on Reddit" class="button" rel="nofollow"> <span class="count count-reddit">0</span> <i class="icon icon-reddit notranslate" aria-hidden="true"></i> </a> <a href="http://news.ycombinator.com/submitlink?u=https://www.yegor256.com/2017/08/08/raii-in-java.html%3F2017-32&amp;t=RAII+in+Java" title="Share on Hacker News" class="button" rel="nofollow"> <span class="count count-hackernews">0</span> <i class="icon icon-hackernews notranslate" aria-hidden="true"></i> </a> </nav> </header> <article class="main" itemprop="articleBody"><div ><p>Resource Acquisition Is Initialization (<a href="https://en.wikipedia.org/wiki/Resource_acquisition_is_initialization">RAII</a>) is a design idea introduced in C++ by <a href="http://amzn.to/2uMlANB">Bjarne Stroustrup</a> for exception-safe resource management. Thanks to garbage collection Java <a href="https://stackoverflow.com/questions/477399">doesn&#39;t have</a> this feature, but we can implement something similar, using <a href="https://docs.oracle.com/javase/tutorial/essential/exceptions/tryResourceClose.html">try-with-resources</a>.</p><figure class='jb_picture'><img itemprop='image' alt='At Sachem Farm (1998) by John Huddles' src='/images/2017/08/at-sachem-farm.jpg' longdesc='#7aef3b5b'/><figcaption id='7aef3b5b'>At Sachem Farm (1998) by John Huddles</figcaption></figure><p>The problem RAII is solving is obvious; have a look at this code (I&#39;m sure you know what <a href="https://docs.oracle.com/javase/7/docs/api/java/util/concurrent/Semaphore.html"><code>Semaphore</code></a> is and how it works in Java):</p><figure class="highlight"><pre><code class="language-java" data-lang="java"><span></span><span class="kd">class</span> <span class="nc">Foo</span> <span class="o">{</span>
  <span class="kd">private</span> <span class="n">Semaphore</span> <span class="n">sem</span> <span class="o">=</span> <span class="k">new</span> <span class="n">Semaphore</span><span class="o">(</span><span class="mi">5</span><span class="o">);</span>
  <span class="kt">void</span> <span class="nf">print</span><span class="o">(</span><span class="kt">int</span> <span class="n">x</span><span class="o">)</span> <span class="kd">throws</span> <span class="n">Exception</span> <span class="o">{</span>
    <span class="k">this</span><span class="o">.</span><span class="na">sem</span><span class="o">.</span><span class="na">acquire</span><span class="o">();</span>
    <span class="k">if</span> <span class="o">(</span><span class="n">x</span> <span class="o">&gt;</span> <span class="mi">1000</span><span class="o">)</span> <span class="o">{</span>
      <span class="k">throw</span> <span class="k">new</span> <span class="n">Exception</span><span class="o">(</span><span class="s">&quot;Too large!&quot;</span><span class="o">);</span>
    <span class="o">}</span>
    <span class="n">System</span><span class="o">.</span><span class="na">out</span><span class="o">.</span><span class="na">printf</span><span class="o">(</span><span class="s">&quot;x = %d&quot;</span><span class="o">,</span> <span class="n">x</span><span class="o">);</span>
    <span class="k">this</span><span class="o">.</span><span class="na">sem</span><span class="o">.</span><span class="na">release</span><span class="o">();</span>
  <span class="o">}</span>
<span class="o">}</span></code></pre></figure><p>The code is rather primitive and doesn&#39;t do anything useful, but you most probably get the idea: the method <code>print()</code>, if being called from multiple parallel threads, will allow only five of them to print in parallel. Sometimes it will not allow some of them to print and will throw an exception if <code>x</code> is bigger than <code>1000</code>.</p><p>The problem with this code is---<a href="https://en.wikipedia.org/wiki/Resource_leak">resource leakage</a>. Each <code>print()</code> call with <code>x</code> larger than <code>1000</code> will take one permit from the semaphore and won&#39;t return it. In five calls with exceptions the semaphore will be empty and all other threads won&#39;t print anything.</p><p>What is the solution? Here it is:</p><figure class="highlight"><pre><code class="language-java" data-lang="java"><span></span><span class="kd">class</span> <span class="nc">Foo</span> <span class="o">{</span>
  <span class="kd">private</span> <span class="n">Semaphore</span> <span class="n">sem</span> <span class="o">=</span> <span class="k">new</span> <span class="n">Semaphore</span><span class="o">(</span><span class="mi">5</span><span class="o">);</span>
  <span class="kt">void</span> <span class="nf">print</span><span class="o">(</span><span class="kt">int</span> <span class="n">x</span><span class="o">)</span> <span class="kd">throws</span> <span class="n">Exception</span> <span class="o">{</span>
    <span class="k">this</span><span class="o">.</span><span class="na">sem</span><span class="o">.</span><span class="na">acquire</span><span class="o">();</span>
    <span class="k">if</span> <span class="o">(</span><span class="n">x</span> <span class="o">&gt;</span> <span class="mi">1000</span><span class="o">)</span> <span class="o">{</span>
      <span class="k">this</span><span class="o">.</span><span class="na">sem</span><span class="o">.</span><span class="na">release</span><span class="o">();</span>
      <span class="k">throw</span> <span class="k">new</span> <span class="n">Exception</span><span class="o">(</span><span class="s">&quot;Too large!&quot;</span><span class="o">);</span>
    <span class="o">}</span>
    <span class="n">System</span><span class="o">.</span><span class="na">out</span><span class="o">.</span><span class="na">printf</span><span class="o">(</span><span class="s">&quot;x = %d&quot;</span><span class="o">,</span> <span class="n">x</span><span class="o">);</span>
    <span class="k">this</span><span class="o">.</span><span class="na">sem</span><span class="o">.</span><span class="na">release</span><span class="o">();</span>
  <span class="o">}</span>
<span class="o">}</span></code></pre></figure><p>We must release the permit before we throw the exception.</p><p>However, there is another problem that shows up: code duplication. We release the permit in two places. If we add more <code>throw</code> instructions we will also have to add more <code>sem.release()</code> calls.</p><p>A very elegant solution was introduced in C++ and is called RAII. This is how it would look in Java:</p><figure class="highlight"><pre><code class="language-java" data-lang="java"><span></span><span class="kd">class</span> <span class="nc">Permit</span> <span class="o">{</span>
  <span class="kd">private</span> <span class="n">Semaphore</span> <span class="n">sem</span><span class="o">;</span>
  <span class="n">Permit</span><span class="o">(</span><span class="n">Semaphore</span> <span class="n">s</span><span class="o">)</span> <span class="o">{</span>
    <span class="k">this</span><span class="o">.</span><span class="na">sem</span> <span class="o">=</span> <span class="n">s</span><span class="o">;</span>
    <span class="k">this</span><span class="o">.</span><span class="na">sem</span><span class="o">.</span><span class="na">acquire</span><span class="o">();</span>
  <span class="o">}</span>
  <span class="nd">@Override</span>
  <span class="kd">public</span> <span class="kt">void</span> <span class="nf">finalize</span><span class="o">()</span> <span class="o">{</span>
    <span class="k">this</span><span class="o">.</span><span class="na">sem</span><span class="o">.</span><span class="na">release</span><span class="o">();</span>
  <span class="o">}</span>
<span class="o">}</span>
<span class="kd">class</span> <span class="nc">Foo</span> <span class="o">{</span>
  <span class="kd">private</span> <span class="n">Semaphore</span> <span class="n">sem</span> <span class="o">=</span> <span class="k">new</span> <span class="n">Semaphore</span><span class="o">(</span><span class="mi">5</span><span class="o">);</span>
  <span class="kt">void</span> <span class="nf">print</span><span class="o">(</span><span class="kt">int</span> <span class="n">x</span><span class="o">)</span> <span class="kd">throws</span> <span class="n">Exception</span> <span class="o">{</span>
    <span class="k">new</span> <span class="n">Permit</span><span class="o">(</span><span class="k">this</span><span class="o">.</span><span class="na">sem</span><span class="o">);</span>
    <span class="k">if</span> <span class="o">(</span><span class="n">x</span> <span class="o">&gt;</span> <span class="mi">1000</span><span class="o">)</span> <span class="o">{</span>
      <span class="k">throw</span> <span class="k">new</span> <span class="n">Exception</span><span class="o">(</span><span class="s">&quot;Too large!&quot;</span><span class="o">);</span>
    <span class="o">}</span>
    <span class="n">System</span><span class="o">.</span><span class="na">out</span><span class="o">.</span><span class="na">printf</span><span class="o">(</span><span class="s">&quot;x = %d&quot;</span><span class="o">,</span> <span class="n">x</span><span class="o">);</span>
  <span class="o">}</span>
<span class="o">}</span></code></pre></figure><p>See how beautiful the code is inside method <code>Foo.print()</code>. We just create an instance of class <code>Permit</code> and it immediately acquires a new permit at the semaphore. Then we exit the method <code>print()</code>, either by exception or in the normal way, and the method <code>Permit.finalize()</code> releases the permit.</p><p>Elegant, isn&#39;t it? Yes, it is, but it won&#39;t work in Java.</p><p>It won&#39;t work because, unlike C++, Java doesn&#39;t destroy objects when their scope of visibility is closed. The object of class <code>Permit</code> won&#39;t be destroyed when we exit the method <code>print()</code>. It will be destroyed <em>eventually</em> but we don&#39;t know when exactly. Most likely it will be destroyed way after all permits in the semaphore got acquired and we get blocked.</p><p>There is a solution in Java too. It is not as elegant as the one from C++, but it does work. Here it is:</p><figure class="highlight"><pre><code class="language-java" data-lang="java"><span></span><span class="kd">class</span> <span class="nc">Permit</span> <span class="kd">implements</span> <span class="n">Closeable</span> <span class="o">{</span>
  <span class="kd">private</span> <span class="n">Semaphore</span> <span class="n">sem</span><span class="o">;</span>
  <span class="n">Permit</span><span class="o">(</span><span class="n">Semaphore</span> <span class="n">s</span><span class="o">)</span> <span class="o">{</span>
    <span class="k">this</span><span class="o">.</span><span class="na">sem</span> <span class="o">=</span> <span class="n">s</span><span class="o">;</span>
  <span class="o">}</span>
  <span class="nd">@Override</span>
  <span class="kd">public</span> <span class="kt">void</span> <span class="nf">close</span><span class="o">()</span> <span class="o">{</span>
    <span class="k">this</span><span class="o">.</span><span class="na">sem</span><span class="o">.</span><span class="na">release</span><span class="o">();</span>
  <span class="o">}</span>
  <span class="kd">public</span> <span class="n">Permit</span> <span class="nf">acquire</span><span class="o">()</span> <span class="o">{</span>
    <span class="k">this</span><span class="o">.</span><span class="na">sem</span><span class="o">.</span><span class="na">acquire</span><span class="o">();</span>
    <span class="k">return</span> <span class="k">this</span><span class="o">;</span>
  <span class="o">}</span>
<span class="o">}</span>
<span class="kd">class</span> <span class="nc">Foo</span> <span class="o">{</span>
  <span class="kd">private</span> <span class="n">Semaphore</span> <span class="n">sem</span> <span class="o">=</span> <span class="k">new</span> <span class="n">Semaphore</span><span class="o">(</span><span class="mi">5</span><span class="o">);</span>
  <span class="kt">void</span> <span class="nf">print</span><span class="o">(</span><span class="kt">int</span> <span class="n">x</span><span class="o">)</span> <span class="kd">throws</span> <span class="n">Exception</span> <span class="o">{</span>
    <span class="k">try</span> <span class="o">(</span><span class="n">Permit</span> <span class="n">p</span> <span class="o">=</span> <span class="k">new</span> <span class="n">Permit</span><span class="o">(</span><span class="k">this</span><span class="o">.</span><span class="na">sem</span><span class="o">).</span><span class="na">acquire</span><span class="o">())</span> <span class="o">{</span>
      <span class="k">if</span> <span class="o">(</span><span class="n">x</span> <span class="o">&gt;</span> <span class="mi">1000</span><span class="o">)</span> <span class="o">{</span>
        <span class="k">throw</span> <span class="k">new</span> <span class="n">Exception</span><span class="o">(</span><span class="s">&quot;Too large!&quot;</span><span class="o">);</span>
      <span class="o">}</span>
      <span class="n">System</span><span class="o">.</span><span class="na">out</span><span class="o">.</span><span class="na">printf</span><span class="o">(</span><span class="s">&quot;x = %d&quot;</span><span class="o">,</span> <span class="n">x</span><span class="o">);</span>
    <span class="o">}</span>
  <span class="o">}</span>
<span class="o">}</span></code></pre></figure><p>Pay attention to the <code>try</code> block and to the <a href="https://docs.oracle.com/javase/7/docs/api/java/io/Closeable.html"><code>Closeable</code></a> interface that the class <code>Permit</code> now implements. The object <code>p</code> will be &quot;closed&quot; when the <code>try</code> block exits. It may exit either at the end, or by the <code>return</code> or <code>throw</code> statements. In either case <code>Permit.close()</code> will be called: this is how <a href="https://docs.oracle.com/javase/tutorial/essential/exceptions/tryResourceClose.html">try-with-resources</a> works in Java.</p><p>I introduced method <code>acquire()</code> and moved <code>sem.acquire()</code> out of the <code>Permit</code> constructor because I <a href="/2015/05/07/ctors-must-be-code-free.html">believe</a> that constructors must be code-free.</p><p>To summarize, RAII is a perfect design <del>pattern</del> approach when you deal with resources that may <a href="https://en.wikipedia.org/wiki/Resource_leak">leak</a>. Even though Java doesn&#39;t have it out of the box we can implement it via <a href="https://docs.oracle.com/javase/tutorial/essential/exceptions/tryResourceClose.html">try-with-resources</a> and <a href="https://docs.oracle.com/javase/7/docs/api/java/io/Closeable.html"><code>Closeable</code></a>.</p></div></article></div><div class="wrapper"> <related-posts /></div><div class="disqus" role="complementary"><p class="disqus_hint"> Please, use <a href="https://help.disqus.com/commenting/what-html-tags-are-allowed-within-comments">syntax highlighting</a> in your comments, to make them more readable.</p><div id="disqus_thread" class="disqus-thread"> <a>&nbsp;</a></div><script> var disqus_config = function () { this.page.url = document.location.href.split('?')[0].split('#')[0].replace('https://', 'http://'); this.page.identifier = this.page.url; }; (function() { var d = document, s = d.createElement('script'); s.src = '//yegor256.disqus.com/embed.js'; s.setAttribute('data-timestamp', +new Date()); (d.head || d.body).appendChild(s); })(); </script> <noscript><div><p class="red"> JavaScript is disabled in your browser, that's why you can't see comments under this post.</p></div></noscript></div><div class="wrapper"> <footer class="footer"><p> &copy; <span itemscope="" itemprop="copyrightHolder" itemtype="http://schema.org/Person"> <span itemprop="name">Yegor Bugayenko</span> </span> 2014&ndash;<span itemprop="copyrightYear">2018</span></p></footer></div></section><div class="wrapper unprintable" style="text-align:center;margin-top:2em;"> <a href="http://www.sixnines.io/h/3ba1652f"> <img src="//www.sixnines.io/b/3ba1652f?style=flat" alt="sixnines availability badge"/> </a></div><script src="//code.jquery.com/jquery-1.9.0.min.js"></script> <script src="/js/all.js?a0e0d018c07"></script> <script>var disqus_shortname = 'yegor256';</script> <script id="dsq-count-scr" src="//yegor256.disqus.com/count.js" async="async"></script> <script> (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){ (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o), m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m) })(window,document,'script','//www.google-analytics.com/analytics.js','ga'); ga('create', 'UA-1963507-32', 'auto'); ga('send', 'pageview'); </script> <script> Cd=document;Cr="&"+Math.random();Cp="&s=1"; Cd.cookie="b=b";if(Cd.cookie)Cp+="&c=1"; Cp+="&t="+(new Date()).getTimezoneOffset(); if(self!=top)Cp+="&f=1"; </script> <script> if(navigator.javaEnabled())Cp+="&j=1"; </script> <script> if(typeof(screen)!='undefined')Cp+="&w="+screen.width+"&h="+ screen.height+"&d="+(screen.colorDepth?screen.colorDepth:screen.pixelDepth); </script> <script> Cd.write("<img src='//c.hit.ua/hit?i=95870&g=0&x=2"+Cp+Cr+ "&r="+escape(Cd.referrer)+"&u="+escape(window.location.href)+ "' border='0' wi"+"dth='1' he"+"ight='1'/>"); </script> <script type="application/ld+json"> { "@context": "http://schema.org", "@type": "Person", "name": "Yegor Bugayenko", "url": "http://www.yegor256.com", "sameAs": [ "https://www.facebook.com/yegor256", "https://instagram.com/yegor256", "https://www.linkedin.com/in/yegor256", "https://twitter.com/yegor256", "https://github.com/yegor256", "https://www.pinterest.com/yegor256/" ] } </script> </body> </html> <!DOCTYPE html> <html xmlns="http://www.w3.org/1999/xhtml" lang="en-US" xml:lang="en-US" itemscope="" itemtype="http://schema.org/WebSite"> <head> <meta charset="utf-8"/> <meta name="description" content="The design of equals() and compareTo() in Java is far from perfect; this is how I would improve it and make more object-oriented. " /> <meta name="keywords" content="design of compareTo(), design of equals(), how to compare objects, object-oriented compare objects, oop object comparison" /> <meta name="viewport" content="width=device-width,minimum-scale=1,initial-scale=1"/> <meta name="google-site-verification" content="JEj_gQr2CPe2QKGw8XdMz0R7VboQIUbX3FlM-lwTq-8" /> <meta name="author" content="Yegor Bugayenko"> <meta name="article:published_time" content="2017-07-11 00:00:00 +0000"> <meta name="og:site_name" content="Yegor Bugayenko"/> <meta name="og:type" content="article" /> <meta name="og:locale" content="en_US" /> <meta name="twitter:account_id" content="4503599630178231" /> <meta name="twitter:creator" content="@yegor256"/> <meta name="twitter:site" content="@yegor256"/> <meta name="twitter:title" property="og:title" content="How I Would Re-design equals()"/> <meta name="twitter:description" property="og:description" content="The design of equals() and compareTo() in Java is far from perfect; this is how I would improve it and make more object-oriented. "/> <meta name="twitter:url" property="og:url" content="https://www.yegor256.com/2017/07/11/how-to-redesign-equals.html"/> <meta name="telegram:channel" content="AAAAAEJFMRzsRTRxM3ec6A"/> <link rel="search" type="application/opensearchdescription+xml" href="/opensearch.xml" title="yegor256" /> <link rel="shortcut icon" href="/favicon.ico?a0e0d018c07"/> <link rel="apple-touch-icon" href="/favicon.ico?a0e0d018c07"/> <link rel="alternate" type="application/rss+xml" title="RSS for yegor256.com" href="https://www.yegor256.com/rss.xml"/> <link rel="stylesheet" href="/css/layout.css?a0e0d018c07"/> <link rel="stylesheet" href="/css/icons.css?a0e0d018c07"/> <link rel="canonical" href="https://www.yegor256.com/2017/07/11/how-to-redesign-equals.html" /> <link rel="amphtml" href="https://www.yegor256.com/2017/07/11/how-to-redesign-equals.amp.html" /> <title>How I Would Re-design equals() </title> <meta name='og:image' content='https://www.yegor256.com/images/2017/07/lultimo-capodanno.jpg'/><meta name='twitter:image' content='https://www.yegor256.com/images/2017/07/lultimo-capodanno.jpg'/><meta name='og:image:width' content='1280'/> <meta name='twitter:image:width' content='1280'/><meta name='og:image:height' content='542'/> <meta name='twitter:image:height' content='542'/><meta name='twitter:card' content='summary_large_image'/><meta name='twitter:image:alt' content='L&#39;ultimo capodanno (1998) by Marco Risi'/> </head> <body><div class="wrapper"> <aside class="header-toggle unprintable" id="header-toggle" title="Show the menu" onclick="$('#header').show();$('#header-toggle').hide();">&#9776;</aside> <header class="header" id="header"><div class="face"> <a href="/about-me.html#form" class="sub" title="Click to subscribe to my monthly newsletter"><span>Subscribe</span></a> <a href="/about-me.html" style="position:relative;"> <img src="/images/face-256x256.jpg" class="photo" alt="Yegor Bugayenko"/> </a></div><nav><ul class="menu social notranslate"> <li><a href="https://twitter.com/intent/follow?screen_name=yegor256" rel="nofollow" title="Follow me on Twitter"><i class="icon icon-twitter notranslate" aria-hidden="true"></i></a></li> <li><a href="/rss.xml" rel="nofollow" title="Subscribe to my RSS feed"><i class="icon icon-rss notranslate" aria-hidden="true"></i></a></li> <li><a itemprop="sameAs" href="https://github.com/yegor256" rel="nofollow" title="My GitHub profile"><i class="icon icon-github notranslate" aria-hidden="true"></i></a></li> <li><a itemprop="sameAs" href="http://stackoverflow.com/users/187141/yegor256" rel="nofollow" title="My StackOverflow profile"><i class="icon icon-stackoverflow notranslate" aria-hidden="true"></i></a></li> <li><a itemprop="sameAs" href="https://www.facebook.com/yegor256" rel="nofollow" title="Follow me on Facebook"><i class="icon icon-facebook notranslate" aria-hidden="true"></i></a></li> <li><a itemprop="sameAs" href="https://instagram.com/yegor256" rel="nofollow" title="Follow me on Instagram"><i class="icon icon-instagram notranslate" aria-hidden="true"></i></a></li> <li><a itemprop="sameAs" href="https://www.linkedin.com/in/yegor256" rel="nofollow" title="My LinkedIn profile"><i class="icon icon-linkedin notranslate" aria-hidden="true"></i></a></li> <li><a itemprop="sameAs" href="https://www.youtube.com/c/yegor256?sub_confirmation=1" rel="nofollow" title="My Youtube video channel"><i class="icon icon-youtube notranslate" aria-hidden="true"></i></a></li> <li><a itemprop="sameAs" href="https://www.pinterest.com/yegor256/" rel="nofollow" title="My Pinterest boards"><i class="icon icon-pinterest notranslate" aria-hidden="true"></i></a></li> <li><a itemprop="sameAs" href="https://angel.co/yegor256" rel="nofollow" title="My AngelList profile"><i class="icon icon-angellist notranslate" aria-hidden="true"></i></a></li> <li><a href="https://soundcloud.com/yegor256" rel="nofollow" title="My podcast"><i class="icon icon-podcast notranslate" aria-hidden="true"></i></a></li> <li><a href="https://itunes.apple.com/us/podcast/yegor256-podcast/id1150826721" rel="nofollow" title="My iTunes podcast"><i class="icon icon-itunes notranslate" aria-hidden="true"></i></a></li> <li><a href="https://t.me/joinchat/AAAAAEJFMRzsRTRxM3ec6A" rel="nofollow" title="My Telegram public channel"><i class="icon icon-telegram notranslate" aria-hidden="true"></i></a></li> <li><a href="mailto:blog@yegor256.com" rel="nofollow" title="Email me any time"><i class="icon icon-mail notranslate" aria-hidden="true"></i></a></li></ul><ul class="menu"> <li><a href="/" title="Home page">Home</a></li> <li ><a href="/best.html" title="Best articles to read">12&#160;Best</a></li> <li ><a href="/contents.html" title="The contents of the entire blog">All&#160;288</a></li> <li ><a href="/webinars.html" title="My webinars">Webinars</a></li> <li ><a href="/talks.html" title="Future and past conference talks">Talks</a></li> <li ><a href="/books.html" title="The books I wrote">Books</a></li> <li ><a href="/papers.html" title="My academic papers and patents">Papers</a></li> <li ><a href="/pets.html" title="My loved pet projects">Pets</a></li> <li ><a href="/award.html" title="Software quality award">Award</a></li> <li ><a href="/testimonials.html" title="What some people say about me">Testimonials</a></li> <li ><a href="/shift-m.html" title="Audio podcast about project management">Shift-M</a></li> <li ><a href="/paintings.html" title="My paintings for sale">Paintings</a></li> <li><a href="http://ru.yegor256.com/" title="Немного на русском языке">По-русски</a></li></ul></nav><div class="search"> <form method="get" action="https://www.google.com/search" itemprop="potentialAction" itemscope="" itemtype="http://schema.org/SearchAction"> <meta itemprop="target" content="https://www.google.com/search?q={q}"/> <input name="sitesearch" value="yegor256.com" type="hidden"/> <input itemprop="query-input" type="text" id="search-query" class="field field-text" required="required" onfocus="$('.google').css('visibility', 'visible');" name="q" placeholder="Search..." autocomplete="off"/> <input type="image" src="/images/google-search-icon.svg" class="google" title="Search via Google" alt="Search via Google"/> </form></div><div class="hot"><ul> <li> <a href="/code-ahead.html">Code Ahead</a> was published on Amazon just a few days ago! It is my new book, a novel about programmers. It explains in details the majority of ideas that stand behind <a href="https://www.zerocracy.com">Zerocracy</a> and <a href="https://www.xdsd.org">XDSD</a>. </li> <li> At <a href="/webinars.html">Webinar #37</a> we will discuss naming problem in OOP, for objects, methods and attributes; join us on <b>September 12</b>, at 11am PST. </li></ul></div></header></div><section itemscope="" itemtype="http://schema.org/BlogPosting"><div class="wrapper"> <header><p class="printable"> <img src="https://api.qrserver.com/v1/create-qr-code/?data=https://www.yegor256.com/2017/07/11/how-to-redesign-equals.html&amp;format=svg" style="width:125px;height:125px;" alt="QR code"/></p><p class="printable"> <code itemprop="url">https://www.yegor256.com/2017/07/11/how-to-redesign-equals.html</code></p><h1 itemprop="name headline mainEntityOfPage">How I Would Re-design equals()</h1><ul class="subline"> <li> <time itemprop="datePublished" datetime="2017-07-11T00:00:00+00:00"> 11 July 2017 </time> </li> <li class="desktop-only" itemprop="locationCreated">Copenhagen, Denmark</li> <li class="printable" itemscope="" itemprop="author" itemtype="http://schema.org/Person"> <span itemprop="name">Yegor Bugayenko</span> </li> <li class="unprintable"> <i class="icon icon-comments"></i> <a href="http://www.yegor256.com/2017/07/11/how-to-redesign-equals.html#disqus_thread" itemprop="discussionUrl">comments</a> </li></ul><p class="unprintable"><p>I want to rant a bit about Java design, in particular about the methods <a href="https://docs.oracle.com/javase/7/docs/api/java/lang/Object.html#equals%28java.lang.Object%29"><code>Object.equals()</code></a> and <a href="https://docs.oracle.com/javase/7/docs/api/java/lang/Comparable.html#compareTo%28T%29"><code>Comparable.compareTo()</code></a>. I&#39;ve hated them for years, because, no matter how hard I try to like them, the code inside looks ugly. Now I know what exactly is wrong and how I would design this &quot;object-to-object comparing&quot; mechanism <em>better</em>.</p><figure class='jb_picture'><img itemprop='image' alt='L&#39;ultimo capodanno (1998) by Marco Risi' src='/images/2017/07/lultimo-capodanno.jpg' longdesc='#4900028f'/><figcaption id='4900028f'>L&#39;ultimo capodanno (1998) by Marco Risi</figcaption></figure><p>Say we have a <del>simple</del> primitive class <code>Weight</code>, objects of which represent the weight of something in kilos:</p><figure class="highlight"><pre><code class="language-java" data-lang="java"><span></span><span class="kd">class</span> <span class="nc">Weight</span> <span class="o">{</span>
  <span class="kd">private</span> <span class="kt">int</span> <span class="n">kilos</span><span class="o">;</span>
  <span class="n">Weight</span><span class="o">(</span><span class="kt">int</span> <span class="n">k</span><span class="o">)</span> <span class="o">{</span>
    <span class="k">this</span><span class="o">.</span><span class="na">kilos</span> <span class="o">=</span> <span class="n">k</span><span class="o">;</span>
  <span class="o">}</span>
<span class="o">}</span></code></pre></figure><p>Next, we want two objects of the same weight to be equal to each other:</p><figure class="highlight"><pre><code class="language-java" data-lang="java"><span></span><span class="k">new</span> <span class="n">Weight</span><span class="o">(</span><span class="mi">15</span><span class="o">).</span><span class="na">equals</span><span class="o">(</span><span class="k">new</span> <span class="n">Weight</span><span class="o">(</span><span class="mi">15</span><span class="o">));</span></code></pre></figure><p>Here is how such a method may look:</p><figure class="highlight"><pre><code class="language-java" data-lang="java"><span></span><span class="kd">class</span> <span class="nc">Weight</span> <span class="o">{</span>
  <span class="kd">private</span> <span class="kt">int</span> <span class="n">kilos</span><span class="o">;</span>
  <span class="n">Weight</span><span class="o">(</span><span class="kt">int</span> <span class="n">k</span><span class="o">)</span> <span class="o">{</span>
    <span class="k">this</span><span class="o">.</span><span class="na">kilos</span> <span class="o">=</span> <span class="n">k</span><span class="o">;</span>
  <span class="o">}</span>
  <span class="kd">public</span> <span class="kt">boolean</span> <span class="nf">equals</span><span class="o">(</span><span class="n">Object</span> <span class="n">obj</span><span class="o">)</span> <span class="o">{</span>
    <span class="k">if</span> <span class="o">(!(</span><span class="n">obj</span> <span class="k">instanceof</span> <span class="n">Weight</span><span class="o">))</span> <span class="o">{</span>
      <span class="k">return</span> <span class="kc">false</span><span class="o">;</span>
    <span class="o">}</span>
    <span class="n">Weight</span> <span class="n">weight</span> <span class="o">=</span> <span class="n">Weight</span><span class="o">.</span><span class="na">class</span><span class="o">.</span><span class="na">cast</span><span class="o">(</span><span class="n">obj</span><span class="o">);</span>
    <span class="k">return</span> <span class="n">weight</span><span class="o">.</span><span class="na">kilos</span> <span class="o">==</span> <span class="k">this</span><span class="o">.</span><span class="na">kilos</span><span class="o">;</span>
  <span class="o">}</span>
<span class="o">}</span></code></pre></figure><p>The ugly part here is, first of all, the <a href="/2015/04/02/class-casting-is-anti-pattern.html">type casting</a> with <code>instanceof</code>. The second problem is that we touch the internals of the incoming object. This design makes polymorphic behavior of the <code>Weight</code> impossible. We simply can&#39;t pass anything else to the <code>equals()</code> method, besides an instance of the class <code>Weight</code>. We can&#39;t turn it into an interface and introduce multiple implementations of it:</p><figure class="highlight"><pre><code class="language-java" data-lang="java"><span></span><span class="kd">interface</span> <span class="nc">Weight</span> <span class="o">{</span>
  <span class="kt">boolean</span> <span class="nf">equals</span><span class="o">(</span><span class="n">Object</span> <span class="n">obj</span><span class="o">);</span>
<span class="o">}</span></code></pre></figure><p>This code will not work:</p><figure class="highlight"><pre><code class="language-java" data-lang="java"><span></span><span class="kd">class</span> <span class="nc">DefaultWeight</span> <span class="kd">implements</span> <span class="n">Weight</span> <span class="o">{</span>
  <span class="c1">// attribute and ctor skipped</span>
  <span class="kd">public</span> <span class="kt">boolean</span> <span class="nf">equals</span><span class="o">(</span><span class="n">Object</span> <span class="n">obj</span><span class="o">)</span> <span class="o">{</span>
    <span class="k">if</span> <span class="o">(!(</span><span class="n">obj</span> <span class="k">instanceof</span> <span class="n">Weight</span><span class="o">))</span> <span class="o">{</span>
      <span class="k">return</span> <span class="kc">false</span><span class="o">;</span>
    <span class="o">}</span>
    <span class="n">Weight</span> <span class="n">weight</span> <span class="o">=</span> <span class="n">Weight</span><span class="o">.</span><span class="na">class</span><span class="o">.</span><span class="na">cast</span><span class="o">(</span><span class="n">obj</span><span class="o">);</span>
    <span class="k">return</span> <span class="n">weight</span><span class="o">.</span><span class="na">kilos</span> <span class="o">==</span> <span class="k">this</span><span class="o">.</span><span class="na">kilos</span><span class="o">;</span> <span class="c1">// error here!</span>
  <span class="o">}</span>
<span class="o">}</span></code></pre></figure><p>The problem is that one object decides for the other whether they are equal. This inevitably leads to a necessity to touch private attributes in order to do the actual comparison.</p><p>What is the solution?</p><p>This is what I&#39;m offering. Any comparison, no matter what types we are talking about, is about comparing two digital values. Either we compare a weight with a weight, text with text, or a user with a user---our CPUs can only compare numbers. Thus, we introduce a new interface <code>Digitizable</code>:</p><figure class="highlight"><pre><code class="language-java" data-lang="java"><span></span><span class="kd">interface</span> <span class="nc">Digitizable</span> <span class="o">{</span>
  <span class="kt">byte</span><span class="o">[]</span> <span class="nf">digits</span><span class="o">();</span>
<span class="o">}</span></code></pre></figure><p>Next, we introduce a new class <code>Comparison</code>, which <em>is</em> the comparison of two streams of bytes (I&#39;m not sure the code is perfect, I tested it <a href="https://github.com/yegor256/blog/tree/master/_samples/2017/07/equals">here</a>, feel free to improve and contribute with a pull request):</p><figure class="highlight"><pre><code class="language-java" data-lang="java"><span></span><span class="kd">class</span> <span class="nc">Comparison</span><span class="o">&lt;</span><span class="n">T</span> <span class="kd">extends</span> <span class="n">Digitizable</span><span class="o">&gt;</span> <span class="o">{</span>
  <span class="kd">private</span> <span class="n">T</span> <span class="n">lt</span><span class="o">;</span>
  <span class="kd">private</span> <span class="n">T</span> <span class="n">rt</span><span class="o">;</span>
  <span class="n">Comparison</span><span class="o">(</span><span class="n">T</span> <span class="n">left</span><span class="o">,</span> <span class="n">T</span> <span class="n">right</span><span class="o">)</span> <span class="o">{</span>
    <span class="k">this</span><span class="o">.</span><span class="na">lt</span> <span class="o">=</span> <span class="n">left</span><span class="o">;</span>
    <span class="k">this</span><span class="o">.</span><span class="na">rt</span> <span class="o">=</span> <span class="n">right</span><span class="o">;</span>
  <span class="o">}</span>
  <span class="kt">int</span> <span class="nf">value</span><span class="o">()</span> <span class="o">{</span>
    <span class="kd">final</span> <span class="kt">byte</span><span class="o">[]</span> <span class="n">left</span> <span class="o">=</span> <span class="k">this</span><span class="o">.</span><span class="na">lt</span><span class="o">.</span><span class="na">digits</span><span class="o">();</span>
    <span class="kd">final</span> <span class="kt">byte</span><span class="o">[]</span> <span class="n">right</span> <span class="o">=</span> <span class="k">this</span><span class="o">.</span><span class="na">rt</span><span class="o">.</span><span class="na">digits</span><span class="o">();</span>
    <span class="kt">int</span> <span class="n">result</span> <span class="o">=</span> <span class="mi">0</span><span class="o">;</span>
    <span class="kt">int</span> <span class="n">max</span> <span class="o">=</span> <span class="n">Math</span><span class="o">.</span><span class="na">max</span><span class="o">(</span><span class="n">left</span><span class="o">.</span><span class="na">length</span><span class="o">,</span> <span class="n">right</span><span class="o">.</span><span class="na">length</span><span class="o">);</span>
    <span class="k">for</span> <span class="o">(</span><span class="kt">int</span> <span class="n">idx</span> <span class="o">=</span> <span class="n">max</span><span class="o">;</span> <span class="n">idx</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="o">;</span> <span class="o">--</span><span class="n">idx</span><span class="o">)</span> <span class="o">{</span>
      <span class="kt">byte</span> <span class="n">lft</span> <span class="o">=</span> <span class="mi">0</span><span class="o">;</span>
      <span class="k">if</span> <span class="o">(</span><span class="n">idx</span> <span class="o">&lt;=</span> <span class="n">left</span><span class="o">.</span><span class="na">length</span><span class="o">)</span> <span class="o">{</span>
        <span class="n">lft</span> <span class="o">=</span> <span class="n">left</span><span class="o">[</span><span class="n">max</span> <span class="o">-</span> <span class="n">idx</span><span class="o">];</span>
      <span class="o">}</span>
      <span class="kt">byte</span> <span class="n">rht</span> <span class="o">=</span> <span class="mi">0</span><span class="o">;</span>
      <span class="k">if</span> <span class="o">(</span><span class="n">idx</span> <span class="o">&lt;=</span> <span class="n">right</span><span class="o">.</span><span class="na">length</span><span class="o">)</span> <span class="o">{</span>
        <span class="n">rht</span> <span class="o">=</span> <span class="n">right</span><span class="o">[</span><span class="n">max</span> <span class="o">-</span> <span class="n">idx</span><span class="o">];</span>
      <span class="o">}</span>
      <span class="n">result</span> <span class="o">=</span> <span class="n">lft</span> <span class="o">-</span> <span class="n">rht</span><span class="o">;</span>
      <span class="k">if</span> <span class="o">(</span><span class="n">result</span> <span class="o">!=</span> <span class="mi">0</span><span class="o">)</span> <span class="o">{</span>
        <span class="k">break</span><span class="o">;</span>
      <span class="o">}</span>
    <span class="o">}</span>
    <span class="k">return</span> <span class="o">(</span><span class="kt">int</span><span class="o">)</span> <span class="n">Math</span><span class="o">.</span><span class="na">signum</span><span class="o">(</span><span class="n">result</span><span class="o">);</span>
  <span class="o">}</span>
<span class="o">}</span></code></pre></figure><p>Now, we need <code>Weight</code> to implement <code>Digitizable</code>:</p><figure class="highlight"><pre><code class="language-java" data-lang="java"><span></span><span class="kd">class</span> <span class="nc">Weight</span> <span class="kd">implements</span> <span class="n">Digitizable</span> <span class="o">{</span>
  <span class="kd">private</span> <span class="kt">int</span> <span class="n">kilos</span><span class="o">;</span>
  <span class="n">Weight</span><span class="o">(</span><span class="kt">int</span> <span class="n">k</span><span class="o">)</span> <span class="o">{</span>
    <span class="k">this</span><span class="o">.</span><span class="na">kilos</span> <span class="o">=</span> <span class="n">k</span><span class="o">;</span>
  <span class="o">}</span>
  <span class="nd">@Override</span>
  <span class="kd">public</span> <span class="kt">byte</span><span class="o">[]</span> <span class="nf">digits</span><span class="o">()</span> <span class="o">{</span>
    <span class="k">return</span> <span class="n">ByteBuffer</span><span class="o">.</span><span class="na">allocate</span><span class="o">(</span><span class="mi">4</span><span class="o">)</span>
      <span class="o">.</span><span class="na">putInt</span><span class="o">(</span><span class="k">this</span><span class="o">.</span><span class="na">kilos</span><span class="o">).</span><span class="na">array</span><span class="o">();</span>
  <span class="o">}</span>
<span class="o">}</span></code></pre></figure><p>Finally, this is how we compare them:</p><figure class="highlight"><pre><code class="language-java" data-lang="java"><span></span><span class="kt">int</span> <span class="n">v</span> <span class="o">=</span> <span class="k">new</span> <span class="n">Comparison</span><span class="o">&lt;</span><span class="n">Weight</span><span class="o">&gt;(</span>
  <span class="k">new</span> <span class="n">Weight</span><span class="o">(</span><span class="mi">400</span><span class="o">),</span> <span class="k">new</span> <span class="n">Weight</span><span class="o">(</span><span class="mi">500</span><span class="o">)</span>
<span class="o">).</span><span class="na">value</span><span class="o">();</span></code></pre></figure><p>This <code>v</code> will either be <code>-1</code>, <code>0</code>, or <code>1</code>. In this particular case it will be <code>-1</code>, because <code>400</code> is less than <code>500</code>.</p><p>No more violation of encapsulation, no more type casting, no more ugly code inside those <code>equals()</code> and <code>compareTo()</code> methods. The class <code>Comparison</code> will work with all possible types. All our objects need to do in order to become comparable is to implement <code>Digitizable</code> and &quot;provide&quot; their bytes for inspection/comparison.</p><p>This approach is actually very close to the <a href="/2016/04/05/printers-instead-of-getters.html">printers</a> I described earlier.</p></p><nav class="buttons notranslate desktop-only"> <a href="http://www.facebook.com/sharer/sharer.php?u=https://www.yegor256.com/2017/07/11/how-to-redesign-equals.html" title="Share on Facebook" class="button" rel="nofollow"> <span class="count count-facebook">0</span> <i class="icon icon-facebook notranslate" aria-hidden="true"></i> </a> <a href="https://twitter.com/share?url=https://www.yegor256.com/2017/07/11/how-to-redesign-equals.html&amp;text=How+I+Would+Re-design+equals%28%29" title="Share on Twitter" class="button" rel="nofollow"> <span class="count count-twitter">0</span> <i class="icon icon-twitter notranslate" aria-hidden="true"></i> </a> <a href="https://plus.google.com/share?url=https://www.yegor256.com/2017/07/11/how-to-redesign-equals.html" title="Share on Google+" class="button" rel="nofollow"> <span class="count count-googleplus">0</span> <i class="icon icon-googleplus notranslate" aria-hidden="true"></i> </a> <a href="https://www.linkedin.com/cws/share?url=https://www.yegor256.com/2017/07/11/how-to-redesign-equals.html" title="Share on LinkedIn" class="button" rel="nofollow"> <span class="count count-linkedin">0</span> <i class="icon icon-linkedin notranslate" aria-hidden="true"></i> </a> <a href="http://reddit.com/submit?url=https://www.yegor256.com/2017/07/11/how-to-redesign-equals.html%3F2017-28&amp;title=How+I+Would+Re-design+equals%28%29" title="Share on Reddit" class="button" rel="nofollow"> <span class="count count-reddit">0</span> <i class="icon icon-reddit notranslate" aria-hidden="true"></i> </a> <a href="http://news.ycombinator.com/submitlink?u=https://www.yegor256.com/2017/07/11/how-to-redesign-equals.html%3F2017-28&amp;t=How+I+Would+Re-design+equals%28%29" title="Share on Hacker News" class="button" rel="nofollow"> <span class="count count-hackernews">0</span> <i class="icon icon-hackernews notranslate" aria-hidden="true"></i> </a> </nav> </header> <article class="main" itemprop="articleBody"><div ><p>I want to rant a bit about Java design, in particular about the methods <a href="https://docs.oracle.com/javase/7/docs/api/java/lang/Object.html#equals%28java.lang.Object%29"><code>Object.equals()</code></a> and <a href="https://docs.oracle.com/javase/7/docs/api/java/lang/Comparable.html#compareTo%28T%29"><code>Comparable.compareTo()</code></a>. I&#39;ve hated them for years, because, no matter how hard I try to like them, the code inside looks ugly. Now I know what exactly is wrong and how I would design this &quot;object-to-object comparing&quot; mechanism <em>better</em>.</p><figure class='jb_picture'><img itemprop='image' alt='L&#39;ultimo capodanno (1998) by Marco Risi' src='/images/2017/07/lultimo-capodanno.jpg' longdesc='#4900028f'/><figcaption id='4900028f'>L&#39;ultimo capodanno (1998) by Marco Risi</figcaption></figure><p>Say we have a <del>simple</del> primitive class <code>Weight</code>, objects of which represent the weight of something in kilos:</p><figure class="highlight"><pre><code class="language-java" data-lang="java"><span></span><span class="kd">class</span> <span class="nc">Weight</span> <span class="o">{</span>
  <span class="kd">private</span> <span class="kt">int</span> <span class="n">kilos</span><span class="o">;</span>
  <span class="n">Weight</span><span class="o">(</span><span class="kt">int</span> <span class="n">k</span><span class="o">)</span> <span class="o">{</span>
    <span class="k">this</span><span class="o">.</span><span class="na">kilos</span> <span class="o">=</span> <span class="n">k</span><span class="o">;</span>
  <span class="o">}</span>
<span class="o">}</span></code></pre></figure><p>Next, we want two objects of the same weight to be equal to each other:</p><figure class="highlight"><pre><code class="language-java" data-lang="java"><span></span><span class="k">new</span> <span class="n">Weight</span><span class="o">(</span><span class="mi">15</span><span class="o">).</span><span class="na">equals</span><span class="o">(</span><span class="k">new</span> <span class="n">Weight</span><span class="o">(</span><span class="mi">15</span><span class="o">));</span></code></pre></figure><p>Here is how such a method may look:</p><figure class="highlight"><pre><code class="language-java" data-lang="java"><span></span><span class="kd">class</span> <span class="nc">Weight</span> <span class="o">{</span>
  <span class="kd">private</span> <span class="kt">int</span> <span class="n">kilos</span><span class="o">;</span>
  <span class="n">Weight</span><span class="o">(</span><span class="kt">int</span> <span class="n">k</span><span class="o">)</span> <span class="o">{</span>
    <span class="k">this</span><span class="o">.</span><span class="na">kilos</span> <span class="o">=</span> <span class="n">k</span><span class="o">;</span>
  <span class="o">}</span>
  <span class="kd">public</span> <span class="kt">boolean</span> <span class="nf">equals</span><span class="o">(</span><span class="n">Object</span> <span class="n">obj</span><span class="o">)</span> <span class="o">{</span>
    <span class="k">if</span> <span class="o">(!(</span><span class="n">obj</span> <span class="k">instanceof</span> <span class="n">Weight</span><span class="o">))</span> <span class="o">{</span>
      <span class="k">return</span> <span class="kc">false</span><span class="o">;</span>
    <span class="o">}</span>
    <span class="n">Weight</span> <span class="n">weight</span> <span class="o">=</span> <span class="n">Weight</span><span class="o">.</span><span class="na">class</span><span class="o">.</span><span class="na">cast</span><span class="o">(</span><span class="n">obj</span><span class="o">);</span>
    <span class="k">return</span> <span class="n">weight</span><span class="o">.</span><span class="na">kilos</span> <span class="o">==</span> <span class="k">this</span><span class="o">.</span><span class="na">kilos</span><span class="o">;</span>
  <span class="o">}</span>
<span class="o">}</span></code></pre></figure><p>The ugly part here is, first of all, the <a href="/2015/04/02/class-casting-is-anti-pattern.html">type casting</a> with <code>instanceof</code>. The second problem is that we touch the internals of the incoming object. This design makes polymorphic behavior of the <code>Weight</code> impossible. We simply can&#39;t pass anything else to the <code>equals()</code> method, besides an instance of the class <code>Weight</code>. We can&#39;t turn it into an interface and introduce multiple implementations of it:</p><figure class="highlight"><pre><code class="language-java" data-lang="java"><span></span><span class="kd">interface</span> <span class="nc">Weight</span> <span class="o">{</span>
  <span class="kt">boolean</span> <span class="nf">equals</span><span class="o">(</span><span class="n">Object</span> <span class="n">obj</span><span class="o">);</span>
<span class="o">}</span></code></pre></figure><p>This code will not work:</p><figure class="highlight"><pre><code class="language-java" data-lang="java"><span></span><span class="kd">class</span> <span class="nc">DefaultWeight</span> <span class="kd">implements</span> <span class="n">Weight</span> <span class="o">{</span>
  <span class="c1">// attribute and ctor skipped</span>
  <span class="kd">public</span> <span class="kt">boolean</span> <span class="nf">equals</span><span class="o">(</span><span class="n">Object</span> <span class="n">obj</span><span class="o">)</span> <span class="o">{</span>
    <span class="k">if</span> <span class="o">(!(</span><span class="n">obj</span> <span class="k">instanceof</span> <span class="n">Weight</span><span class="o">))</span> <span class="o">{</span>
      <span class="k">return</span> <span class="kc">false</span><span class="o">;</span>
    <span class="o">}</span>
    <span class="n">Weight</span> <span class="n">weight</span> <span class="o">=</span> <span class="n">Weight</span><span class="o">.</span><span class="na">class</span><span class="o">.</span><span class="na">cast</span><span class="o">(</span><span class="n">obj</span><span class="o">);</span>
    <span class="k">return</span> <span class="n">weight</span><span class="o">.</span><span class="na">kilos</span> <span class="o">==</span> <span class="k">this</span><span class="o">.</span><span class="na">kilos</span><span class="o">;</span> <span class="c1">// error here!</span>
  <span class="o">}</span>
<span class="o">}</span></code></pre></figure><p>The problem is that one object decides for the other whether they are equal. This inevitably leads to a necessity to touch private attributes in order to do the actual comparison.</p><p>What is the solution?</p><p>This is what I&#39;m offering. Any comparison, no matter what types we are talking about, is about comparing two digital values. Either we compare a weight with a weight, text with text, or a user with a user---our CPUs can only compare numbers. Thus, we introduce a new interface <code>Digitizable</code>:</p><figure class="highlight"><pre><code class="language-java" data-lang="java"><span></span><span class="kd">interface</span> <span class="nc">Digitizable</span> <span class="o">{</span>
  <span class="kt">byte</span><span class="o">[]</span> <span class="nf">digits</span><span class="o">();</span>
<span class="o">}</span></code></pre></figure><p>Next, we introduce a new class <code>Comparison</code>, which <em>is</em> the comparison of two streams of bytes (I&#39;m not sure the code is perfect, I tested it <a href="https://github.com/yegor256/blog/tree/master/_samples/2017/07/equals">here</a>, feel free to improve and contribute with a pull request):</p><figure class="highlight"><pre><code class="language-java" data-lang="java"><span></span><span class="kd">class</span> <span class="nc">Comparison</span><span class="o">&lt;</span><span class="n">T</span> <span class="kd">extends</span> <span class="n">Digitizable</span><span class="o">&gt;</span> <span class="o">{</span>
  <span class="kd">private</span> <span class="n">T</span> <span class="n">lt</span><span class="o">;</span>
  <span class="kd">private</span> <span class="n">T</span> <span class="n">rt</span><span class="o">;</span>
  <span class="n">Comparison</span><span class="o">(</span><span class="n">T</span> <span class="n">left</span><span class="o">,</span> <span class="n">T</span> <span class="n">right</span><span class="o">)</span> <span class="o">{</span>
    <span class="k">this</span><span class="o">.</span><span class="na">lt</span> <span class="o">=</span> <span class="n">left</span><span class="o">;</span>
    <span class="k">this</span><span class="o">.</span><span class="na">rt</span> <span class="o">=</span> <span class="n">right</span><span class="o">;</span>
  <span class="o">}</span>
  <span class="kt">int</span> <span class="nf">value</span><span class="o">()</span> <span class="o">{</span>
    <span class="kd">final</span> <span class="kt">byte</span><span class="o">[]</span> <span class="n">left</span> <span class="o">=</span> <span class="k">this</span><span class="o">.</span><span class="na">lt</span><span class="o">.</span><span class="na">digits</span><span class="o">();</span>
    <span class="kd">final</span> <span class="kt">byte</span><span class="o">[]</span> <span class="n">right</span> <span class="o">=</span> <span class="k">this</span><span class="o">.</span><span class="na">rt</span><span class="o">.</span><span class="na">digits</span><span class="o">();</span>
    <span class="kt">int</span> <span class="n">result</span> <span class="o">=</span> <span class="mi">0</span><span class="o">;</span>
    <span class="kt">int</span> <span class="n">max</span> <span class="o">=</span> <span class="n">Math</span><span class="o">.</span><span class="na">max</span><span class="o">(</span><span class="n">left</span><span class="o">.</span><span class="na">length</span><span class="o">,</span> <span class="n">right</span><span class="o">.</span><span class="na">length</span><span class="o">);</span>
    <span class="k">for</span> <span class="o">(</span><span class="kt">int</span> <span class="n">idx</span> <span class="o">=</span> <span class="n">max</span><span class="o">;</span> <span class="n">idx</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="o">;</span> <span class="o">--</span><span class="n">idx</span><span class="o">)</span> <span class="o">{</span>
      <span class="kt">byte</span> <span class="n">lft</span> <span class="o">=</span> <span class="mi">0</span><span class="o">;</span>
      <span class="k">if</span> <span class="o">(</span><span class="n">idx</span> <span class="o">&lt;=</span> <span class="n">left</span><span class="o">.</span><span class="na">length</span><span class="o">)</span> <span class="o">{</span>
        <span class="n">lft</span> <span class="o">=</span> <span class="n">left</span><span class="o">[</span><span class="n">max</span> <span class="o">-</span> <span class="n">idx</span><span class="o">];</span>
      <span class="o">}</span>
      <span class="kt">byte</span> <span class="n">rht</span> <span class="o">=</span> <span class="mi">0</span><span class="o">;</span>
      <span class="k">if</span> <span class="o">(</span><span class="n">idx</span> <span class="o">&lt;=</span> <span class="n">right</span><span class="o">.</span><span class="na">length</span><span class="o">)</span> <span class="o">{</span>
        <span class="n">rht</span> <span class="o">=</span> <span class="n">right</span><span class="o">[</span><span class="n">max</span> <span class="o">-</span> <span class="n">idx</span><span class="o">];</span>
      <span class="o">}</span>
      <span class="n">result</span> <span class="o">=</span> <span class="n">lft</span> <span class="o">-</span> <span class="n">rht</span><span class="o">;</span>
      <span class="k">if</span> <span class="o">(</span><span class="n">result</span> <span class="o">!=</span> <span class="mi">0</span><span class="o">)</span> <span class="o">{</span>
        <span class="k">break</span><span class="o">;</span>
      <span class="o">}</span>
    <span class="o">}</span>
    <span class="k">return</span> <span class="o">(</span><span class="kt">int</span><span class="o">)</span> <span class="n">Math</span><span class="o">.</span><span class="na">signum</span><span class="o">(</span><span class="n">result</span><span class="o">);</span>
  <span class="o">}</span>
<span class="o">}</span></code></pre></figure><p>Now, we need <code>Weight</code> to implement <code>Digitizable</code>:</p><figure class="highlight"><pre><code class="language-java" data-lang="java"><span></span><span class="kd">class</span> <span class="nc">Weight</span> <span class="kd">implements</span> <span class="n">Digitizable</span> <span class="o">{</span>
  <span class="kd">private</span> <span class="kt">int</span> <span class="n">kilos</span><span class="o">;</span>
  <span class="n">Weight</span><span class="o">(</span><span class="kt">int</span> <span class="n">k</span><span class="o">)</span> <span class="o">{</span>
    <span class="k">this</span><span class="o">.</span><span class="na">kilos</span> <span class="o">=</span> <span class="n">k</span><span class="o">;</span>
  <span class="o">}</span>
  <span class="nd">@Override</span>
  <span class="kd">public</span> <span class="kt">byte</span><span class="o">[]</span> <span class="nf">digits</span><span class="o">()</span> <span class="o">{</span>
    <span class="k">return</span> <span class="n">ByteBuffer</span><span class="o">.</span><span class="na">allocate</span><span class="o">(</span><span class="mi">4</span><span class="o">)</span>
      <span class="o">.</span><span class="na">putInt</span><span class="o">(</span><span class="k">this</span><span class="o">.</span><span class="na">kilos</span><span class="o">).</span><span class="na">array</span><span class="o">();</span>
  <span class="o">}</span>
<span class="o">}</span></code></pre></figure><p>Finally, this is how we compare them:</p><figure class="highlight"><pre><code class="language-java" data-lang="java"><span></span><span class="kt">int</span> <span class="n">v</span> <span class="o">=</span> <span class="k">new</span> <span class="n">Comparison</span><span class="o">&lt;</span><span class="n">Weight</span><span class="o">&gt;(</span>
  <span class="k">new</span> <span class="n">Weight</span><span class="o">(</span><span class="mi">400</span><span class="o">),</span> <span class="k">new</span> <span class="n">Weight</span><span class="o">(</span><span class="mi">500</span><span class="o">)</span>
<span class="o">).</span><span class="na">value</span><span class="o">();</span></code></pre></figure><p>This <code>v</code> will either be <code>-1</code>, <code>0</code>, or <code>1</code>. In this particular case it will be <code>-1</code>, because <code>400</code> is less than <code>500</code>.</p><p>No more violation of encapsulation, no more type casting, no more ugly code inside those <code>equals()</code> and <code>compareTo()</code> methods. The class <code>Comparison</code> will work with all possible types. All our objects need to do in order to become comparable is to implement <code>Digitizable</code> and &quot;provide&quot; their bytes for inspection/comparison.</p><p>This approach is actually very close to the <a href="/2016/04/05/printers-instead-of-getters.html">printers</a> I described earlier.</p></div></article></div><div class="wrapper"> <related-posts /></div><div class="disqus" role="complementary"><p class="disqus_hint"> Please, use <a href="https://help.disqus.com/commenting/what-html-tags-are-allowed-within-comments">syntax highlighting</a> in your comments, to make them more readable.</p><div id="disqus_thread" class="disqus-thread"> <a>&nbsp;</a></div><script> var disqus_config = function () { this.page.url = document.location.href.split('?')[0].split('#')[0].replace('https://', 'http://'); this.page.identifier = this.page.url; }; (function() { var d = document, s = d.createElement('script'); s.src = '//yegor256.disqus.com/embed.js'; s.setAttribute('data-timestamp', +new Date()); (d.head || d.body).appendChild(s); })(); </script> <noscript><div><p class="red"> JavaScript is disabled in your browser, that's why you can't see comments under this post.</p></div></noscript></div><div class="wrapper"> <footer class="footer"><p> &copy; <span itemscope="" itemprop="copyrightHolder" itemtype="http://schema.org/Person"> <span itemprop="name">Yegor Bugayenko</span> </span> 2014&ndash;<span itemprop="copyrightYear">2018</span></p></footer></div></section><div class="wrapper unprintable" style="text-align:center;margin-top:2em;"> <a href="http://www.sixnines.io/h/3ba1652f"> <img src="//www.sixnines.io/b/3ba1652f?style=flat" alt="sixnines availability badge"/> </a></div><script src="//code.jquery.com/jquery-1.9.0.min.js"></script> <script src="/js/all.js?a0e0d018c07"></script> <script>var disqus_shortname = 'yegor256';</script> <script id="dsq-count-scr" src="//yegor256.disqus.com/count.js" async="async"></script> <script> (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){ (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o), m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m) })(window,document,'script','//www.google-analytics.com/analytics.js','ga'); ga('create', 'UA-1963507-32', 'auto'); ga('send', 'pageview'); </script> <script> Cd=document;Cr="&"+Math.random();Cp="&s=1"; Cd.cookie="b=b";if(Cd.cookie)Cp+="&c=1"; Cp+="&t="+(new Date()).getTimezoneOffset(); if(self!=top)Cp+="&f=1"; </script> <script> if(navigator.javaEnabled())Cp+="&j=1"; </script> <script> if(typeof(screen)!='undefined')Cp+="&w="+screen.width+"&h="+ screen.height+"&d="+(screen.colorDepth?screen.colorDepth:screen.pixelDepth); </script> <script> Cd.write("<img src='//c.hit.ua/hit?i=95870&g=0&x=2"+Cp+Cr+ "&r="+escape(Cd.referrer)+"&u="+escape(window.location.href)+ "' border='0' wi"+"dth='1' he"+"ight='1'/>"); </script> <script type="application/ld+json"> { "@context": "http://schema.org", "@type": "Person", "name": "Yegor Bugayenko", "url": "http://www.yegor256.com", "sameAs": [ "https://www.facebook.com/yegor256", "https://instagram.com/yegor256", "https://www.linkedin.com/in/yegor256", "https://twitter.com/yegor256", "https://github.com/yegor256", "https://www.pinterest.com/yegor256/" ] } </script> </body> </html> <!DOCTYPE html> <html xmlns="http://www.w3.org/1999/xhtml" lang="en-US" xml:lang="en-US" itemscope="" itemtype="http://schema.org/WebSite"> <head> <meta charset="utf-8"/> <meta name="description" content="Instead of calling static procedures we may want to use objects, the way they are supposed to be used; that&apos;s why Cactoos. " /> <meta name="keywords" content="IO java, cactoos, input/output cactoos, object-oriented input/output, read/write java" /> <meta name="viewport" content="width=device-width,minimum-scale=1,initial-scale=1"/> <meta name="google-site-verification" content="JEj_gQr2CPe2QKGw8XdMz0R7VboQIUbX3FlM-lwTq-8" /> <meta name="author" content="Yegor Bugayenko"> <meta name="article:published_time" content="2017-06-22 00:00:00 +0000"> <meta name="og:site_name" content="Yegor Bugayenko"/> <meta name="og:type" content="article" /> <meta name="og:locale" content="en_US" /> <meta name="twitter:account_id" content="4503599630178231" /> <meta name="twitter:creator" content="@yegor256"/> <meta name="twitter:site" content="@yegor256"/> <meta name="twitter:title" property="og:title" content="Object-Oriented Declarative Input/Output in Cactoos"/> <meta name="twitter:description" property="og:description" content="Instead of calling static procedures we may want to use objects, the way they are supposed to be used; that&apos;s why Cactoos. "/> <meta name="twitter:url" property="og:url" content="https://www.yegor256.com/2017/06/22/object-oriented-input-output-in-cactoos.html"/> <meta name="telegram:channel" content="AAAAAEJFMRzsRTRxM3ec6A"/> <link rel="search" type="application/opensearchdescription+xml" href="/opensearch.xml" title="yegor256" /> <link rel="shortcut icon" href="/favicon.ico?a0e0d018c07"/> <link rel="apple-touch-icon" href="/favicon.ico?a0e0d018c07"/> <link rel="alternate" type="application/rss+xml" title="RSS for yegor256.com" href="https://www.yegor256.com/rss.xml"/> <link rel="stylesheet" href="/css/layout.css?a0e0d018c07"/> <link rel="stylesheet" href="/css/icons.css?a0e0d018c07"/> <link rel="canonical" href="https://www.yegor256.com/2017/06/22/object-oriented-input-output-in-cactoos.html" /> <link rel="amphtml" href="https://www.yegor256.com/2017/06/22/object-oriented-input-output-in-cactoos.amp.html" /> <title>Object-Oriented Declarative Input/Output in Cactoos </title> </head> <body><div class="wrapper"> <aside class="header-toggle unprintable" id="header-toggle" title="Show the menu" onclick="$('#header').show();$('#header-toggle').hide();">&#9776;</aside> <header class="header" id="header"><div class="face"> <a href="/about-me.html#form" class="sub" title="Click to subscribe to my monthly newsletter"><span>Subscribe</span></a> <a href="/about-me.html" style="position:relative;"> <img src="/images/face-256x256.jpg" class="photo" alt="Yegor Bugayenko"/> </a></div><nav><ul class="menu social notranslate"> <li><a href="https://twitter.com/intent/follow?screen_name=yegor256" rel="nofollow" title="Follow me on Twitter"><i class="icon icon-twitter notranslate" aria-hidden="true"></i></a></li> <li><a href="/rss.xml" rel="nofollow" title="Subscribe to my RSS feed"><i class="icon icon-rss notranslate" aria-hidden="true"></i></a></li> <li><a itemprop="sameAs" href="https://github.com/yegor256" rel="nofollow" title="My GitHub profile"><i class="icon icon-github notranslate" aria-hidden="true"></i></a></li> <li><a itemprop="sameAs" href="http://stackoverflow.com/users/187141/yegor256" rel="nofollow" title="My StackOverflow profile"><i class="icon icon-stackoverflow notranslate" aria-hidden="true"></i></a></li> <li><a itemprop="sameAs" href="https://www.facebook.com/yegor256" rel="nofollow" title="Follow me on Facebook"><i class="icon icon-facebook notranslate" aria-hidden="true"></i></a></li> <li><a itemprop="sameAs" href="https://instagram.com/yegor256" rel="nofollow" title="Follow me on Instagram"><i class="icon icon-instagram notranslate" aria-hidden="true"></i></a></li> <li><a itemprop="sameAs" href="https://www.linkedin.com/in/yegor256" rel="nofollow" title="My LinkedIn profile"><i class="icon icon-linkedin notranslate" aria-hidden="true"></i></a></li> <li><a itemprop="sameAs" href="https://www.youtube.com/c/yegor256?sub_confirmation=1" rel="nofollow" title="My Youtube video channel"><i class="icon icon-youtube notranslate" aria-hidden="true"></i></a></li> <li><a itemprop="sameAs" href="https://www.pinterest.com/yegor256/" rel="nofollow" title="My Pinterest boards"><i class="icon icon-pinterest notranslate" aria-hidden="true"></i></a></li> <li><a itemprop="sameAs" href="https://angel.co/yegor256" rel="nofollow" title="My AngelList profile"><i class="icon icon-angellist notranslate" aria-hidden="true"></i></a></li> <li><a href="https://soundcloud.com/yegor256" rel="nofollow" title="My podcast"><i class="icon icon-podcast notranslate" aria-hidden="true"></i></a></li> <li><a href="https://itunes.apple.com/us/podcast/yegor256-podcast/id1150826721" rel="nofollow" title="My iTunes podcast"><i class="icon icon-itunes notranslate" aria-hidden="true"></i></a></li> <li><a href="https://t.me/joinchat/AAAAAEJFMRzsRTRxM3ec6A" rel="nofollow" title="My Telegram public channel"><i class="icon icon-telegram notranslate" aria-hidden="true"></i></a></li> <li><a href="mailto:blog@yegor256.com" rel="nofollow" title="Email me any time"><i class="icon icon-mail notranslate" aria-hidden="true"></i></a></li></ul><ul class="menu"> <li><a href="/" title="Home page">Home</a></li> <li ><a href="/best.html" title="Best articles to read">12&#160;Best</a></li> <li ><a href="/contents.html" title="The contents of the entire blog">All&#160;288</a></li> <li ><a href="/webinars.html" title="My webinars">Webinars</a></li> <li ><a href="/talks.html" title="Future and past conference talks">Talks</a></li> <li ><a href="/books.html" title="The books I wrote">Books</a></li> <li ><a href="/papers.html" title="My academic papers and patents">Papers</a></li> <li ><a href="/pets.html" title="My loved pet projects">Pets</a></li> <li ><a href="/award.html" title="Software quality award">Award</a></li> <li ><a href="/testimonials.html" title="What some people say about me">Testimonials</a></li> <li ><a href="/shift-m.html" title="Audio podcast about project management">Shift-M</a></li> <li ><a href="/paintings.html" title="My paintings for sale">Paintings</a></li> <li><a href="http://ru.yegor256.com/" title="Немного на русском языке">По-русски</a></li></ul></nav><div class="search"> <form method="get" action="https://www.google.com/search" itemprop="potentialAction" itemscope="" itemtype="http://schema.org/SearchAction"> <meta itemprop="target" content="https://www.google.com/search?q={q}"/> <input name="sitesearch" value="yegor256.com" type="hidden"/> <input itemprop="query-input" type="text" id="search-query" class="field field-text" required="required" onfocus="$('.google').css('visibility', 'visible');" name="q" placeholder="Search..." autocomplete="off"/> <input type="image" src="/images/google-search-icon.svg" class="google" title="Search via Google" alt="Search via Google"/> </form></div><div class="hot"><ul> <li> <a href="/code-ahead.html">Code Ahead</a> was published on Amazon just a few days ago! It is my new book, a novel about programmers. It explains in details the majority of ideas that stand behind <a href="https://www.zerocracy.com">Zerocracy</a> and <a href="https://www.xdsd.org">XDSD</a>. </li> <li> At <a href="/webinars.html">Webinar #37</a> we will discuss naming problem in OOP, for objects, methods and attributes; join us on <b>September 12</b>, at 11am PST. </li></ul></div></header></div><section itemscope="" itemtype="http://schema.org/BlogPosting"><div class="wrapper"> <header><p class="printable"> <img src="https://api.qrserver.com/v1/create-qr-code/?data=https://www.yegor256.com/2017/06/22/object-oriented-input-output-in-cactoos.html&amp;format=svg" style="width:125px;height:125px;" alt="QR code"/></p><p class="printable"> <code itemprop="url">https://www.yegor256.com/2017/06/22/object-oriented-input-output-in-cactoos.html</code></p><h1 itemprop="name headline mainEntityOfPage">Object-Oriented Declarative Input/Output in Cactoos</h1><ul class="subline"> <li> <time itemprop="datePublished" datetime="2017-06-22T00:00:00+00:00"> 22 June 2017 </time> </li> <li class="desktop-only" itemprop="locationCreated">Dnipro, Ukraine</li> <li class="printable" itemscope="" itemprop="author" itemtype="http://schema.org/Person"> <span itemprop="name">Yegor Bugayenko</span> </li> <li class="unprintable"> <i class="icon icon-comments"></i> <a href="http://www.yegor256.com/2017/06/22/object-oriented-input-output-in-cactoos.html#disqus_thread" itemprop="discussionUrl">comments</a> </li></ul><p class="unprintable"><figure class='badge'><a href='http://www.cactoos.org'><img src='https://www.yegor256.com/images/books/elegant-objects/cactus.svg' style='width:92px;max-width:100%;' alt='badge'/></a></figure><p><a href="http://www.cactoos.org">Cactoos</a> is a library of object-oriented Java primitives <a href="https://github.com/yegor256/cactoos#contributors">we</a> started to work on just a few weeks ago. The intent was to propose a clean and more declarative alternative to <a href="https://en.wikipedia.org/wiki/Java_Development_Kit">JDK</a>, <a href="https://github.com/google/guava">Guava</a>, <a href="https://commons.apache.org/">Apache Commons</a>, and others. Instead of calling static <a href="/2014/05/05/oop-alternative-to-utility-classes.html">procedures</a> we want to use <a href="/2016/07/14/who-is-object.html">objects</a>, the way they are supposed to be used. Let&#39;s see how input/output works in a <em>pure</em> <a href="/2016/08/15/what-is-wrong-object-oriented-programming.html">object-oriented</a> fashion.</p><p><strong>Disclaimer</strong>: The version I&#39;m using at the time of writing is <a href="https://github.com/yegor256/cactoos/releases/tag/0.9">0.9</a>. Later versions may have different names of classes and a totally different design.</p><p>Let&#39;s say you want to read a file. This is how you would do it with the static method <a href="https://docs.oracle.com/javase/7/docs/api/java/nio/file/Files.html#readAllBytes%28java.nio.file.Path%29"><code>readAllBytes()</code></a> from the <a href="/2014/05/05/oop-alternative-to-utility-classes.html">utility class</a> <a href="https://docs.oracle.com/javase/7/docs/api/java/nio/file/Files.html"><code>Files</code></a> in JDK7:</p><figure class="highlight"><pre><code class="language-java" data-lang="java"><span></span><span class="kt">byte</span><span class="o">[]</span> <span class="n">content</span> <span class="o">=</span> <span class="n">Files</span><span class="o">.</span><span class="na">readAllBytes</span><span class="o">(</span>
  <span class="k">new</span> <span class="n">File</span><span class="o">(</span><span class="s">&quot;/tmp/photo.jpg&quot;</span><span class="o">).</span><span class="na">toPath</span><span class="o">()</span>
<span class="o">);</span></code></pre></figure><p>This code is very imperative---it reads the file content right here and now, placing it into the array.</p><p>This is how you do it with <a href="https://github.com/yegor256/cactoos">Cactoos</a>:</p><figure class="highlight"><pre><code class="language-java" data-lang="java"><span></span><span class="n">Bytes</span> <span class="n">source</span> <span class="o">=</span> <span class="k">new</span> <span class="n">InputAsBytes</span><span class="o">(</span>
  <span class="k">new</span> <span class="n">FileAsInput</span><span class="o">(</span>
    <span class="k">new</span> <span class="n">File</span><span class="o">(</span><span class="s">&quot;/tmp/photo.jpg&quot;</span><span class="o">)</span>
  <span class="o">)</span>
<span class="o">);</span></code></pre></figure><p>Pay attention---there are no method calls yet. Just three constructors of three classes that compose a bigger object. The object <code>source</code> is of type <a href="http://static.javadoc.io/org.cactoos/cactoos/0.9/org/cactoos/Bytes.html"><code>Bytes</code></a> and represents the content of the file. To get that content out of it we call its method <code>asBytes()</code>:</p><figure class="highlight"><pre><code class="language-java" data-lang="java"><span></span><span class="n">bytes</span><span class="o">[]</span> <span class="n">content</span> <span class="o">=</span> <span class="n">source</span><span class="o">.</span><span class="na">asBytes</span><span class="o">();</span></code></pre></figure><p>This is the moment when the file system is touched. This approach, as you can see, is absolutely declarative and thanks to that possesses all the benefits of object orientation.</p><p>Here is another example. Say you want to write some text into a file. Here is how you do it in Cactoos. First you need the <a href="http://static.javadoc.io/org.cactoos/cactoos/0.9/org/cactoos/Input.html"><code>Input</code></a>:</p><figure class="highlight"><pre><code class="language-java" data-lang="java"><span></span><span class="n">Input</span> <span class="n">input</span> <span class="o">=</span> <span class="k">new</span> <span class="n">BytesAsInput</span><span class="o">(</span>
  <span class="k">new</span> <span class="n">TextAsBytes</span><span class="o">(</span>
    <span class="k">new</span> <span class="n">StringAsText</span><span class="o">(</span>
      <span class="s">&quot;Hello, world!&quot;</span>
    <span class="o">)</span>
  <span class="o">)</span>
<span class="o">);</span></code></pre></figure><p>Then you need the <a href="http://static.javadoc.io/org.cactoos/cactoos/0.9/org/cactoos/Output.html"><code>Output</code></a>:</p><figure class="highlight"><pre><code class="language-java" data-lang="java"><span></span><span class="n">Output</span> <span class="n">output</span> <span class="o">=</span> <span class="k">new</span> <span class="n">FileAsOutput</span><span class="o">(</span>
  <span class="k">new</span> <span class="n">File</span><span class="o">(</span><span class="s">&quot;/tmp/hello.txt&quot;</span><span class="o">)</span>
<span class="o">);</span></code></pre></figure><p>Now, we want to copy the input to the output. There is no &quot;copy&quot; operation in <em>pure</em> OOP. Moreover, there must be no operations at all. Just objects. We have a class named <a href="http://static.javadoc.io/org.cactoos/cactoos/0.9/org/cactoos/io/TeeInput.html"><code>TeeInput</code></a>, which is an <code>Input</code> that copies everything you read from it to the <a href="http://static.javadoc.io/org.cactoos/cactoos/0.9/org/cactoos/Output.html"><code>Output</code></a>, similar to what <a href="https://commons.apache.org/proper/commons-io/javadocs/api-1.4/org/apache/commons/io/input/TeeInputStream.html"><code>TeeInputStream</code></a> from <a href="https://commons.apache.org/">Apache Commons</a> does, but encapsulated. So we don&#39;t copy, we create an <a href="http://static.javadoc.io/org.cactoos/cactoos/0.9/org/cactoos/Input.html"><code>Input</code></a> that will copy if you <em>touch</em> it:</p><figure class="highlight"><pre><code class="language-java" data-lang="java"><span></span><span class="n">Input</span> <span class="n">tee</span> <span class="o">=</span> <span class="k">new</span> <span class="n">TeeInput</span><span class="o">(</span><span class="n">input</span><span class="o">,</span> <span class="n">output</span><span class="o">);</span></code></pre></figure><p>Now, we have to &quot;touch&quot; it. And we have to touch every single byte of it, in order to make sure they all are copied. If we just <code>read()</code> the first byte, only one byte will be copied to the file. The best way to touch them all is to calculate the size of the <code>tee</code> object, going byte by byte. We have an object for it, called <a href="http://static.javadoc.io/org.cactoos/cactoos/0.9/org/cactoos/io/LengthOfInput.html"><code>LengthOfInput</code></a>. It encapsulates an <a href="http://static.javadoc.io/org.cactoos/cactoos/0.9/org/cactoos/Input.html"><code>Input</code></a> and behaves like its length in bytes:</p><figure class="highlight"><pre><code class="language-java" data-lang="java"><span></span><span class="n">Scalar</span><span class="o">&lt;</span><span class="n">Long</span><span class="o">&gt;</span> <span class="n">length</span> <span class="o">=</span> <span class="k">new</span> <span class="n">LengthOfInput</span><span class="o">(</span><span class="n">tee</span><span class="o">);</span></code></pre></figure><p>Then we take the value out of it and the file writing operation takes place:</p><figure class="highlight"><pre><code class="language-java" data-lang="java"><span></span><span class="kt">long</span> <span class="n">len</span> <span class="o">=</span> <span class="n">length</span><span class="o">.</span><span class="na">value</span><span class="o">();</span></code></pre></figure><p>Thus, the entire operation of writing the string to the file will look like this:</p><figure class="highlight"><pre><code class="language-java" data-lang="java"><span></span><span class="k">new</span> <span class="n">LengthOfInput</span><span class="o">(</span>
  <span class="k">new</span> <span class="n">TeeInput</span><span class="o">(</span>
    <span class="k">new</span> <span class="n">BytesAsInput</span><span class="o">(</span>
      <span class="k">new</span> <span class="n">TextAsBytes</span><span class="o">(</span>
        <span class="k">new</span> <span class="n">StringAsText</span><span class="o">(</span>
          <span class="s">&quot;Hello, world!&quot;</span>
        <span class="o">)</span>
      <span class="o">)</span>
    <span class="o">),</span>
    <span class="k">new</span> <span class="n">FileAsOutput</span><span class="o">(</span>
      <span class="k">new</span> <span class="n">File</span><span class="o">(</span><span class="s">&quot;/tmp/hello.txt&quot;</span><span class="o">)</span>
    <span class="o">)</span>
  <span class="o">)</span>
<span class="o">).</span><span class="na">value</span><span class="o">();</span> <span class="c1">// happens here</span></code></pre></figure><p>This is its procedural alternative from <a href="https://docs.oracle.com/javase/7/docs/api/java/nio/file/Files.html#write%28java.nio.file.Path,%20byte%5B%5D,%20java.nio.file.OpenOption...%29">JDK7</a>:</p><figure class="highlight"><pre><code class="language-java" data-lang="java"><span></span><span class="n">Files</span><span class="o">.</span><span class="na">write</span><span class="o">(</span>
  <span class="k">new</span> <span class="n">File</span><span class="o">(</span><span class="s">&quot;/tmp/hello.txt&quot;</span><span class="o">).</span><span class="na">toPath</span><span class="o">(),</span>
  <span class="s">&quot;Hello, world!&quot;</span><span class="o">.</span><span class="na">getBytes</span><span class="o">()</span>
<span class="o">);</span></code></pre></figure><p>&quot;Why is object-oriented better, even though it&#39;s longer?&quot; I hear you ask. Because it perfectly <strong>decouples</strong> concepts, while the procedural one keeps them together.</p><p>Let&#39;s say, you are designing a class that is supposed to encrypt some text and save it to a file. Here is how you would design it the procedural way (not a real encryption, of course):</p><figure class="highlight"><pre><code class="language-java" data-lang="java"><span></span><span class="kd">class</span> <span class="nc">Encoder</span> <span class="o">{</span>
  <span class="kd">private</span> <span class="kd">final</span> <span class="n">File</span> <span class="n">target</span><span class="o">;</span>
  <span class="n">Encoder</span><span class="o">(</span><span class="kd">final</span> <span class="n">File</span> <span class="n">file</span><span class="o">)</span> <span class="o">{</span>
    <span class="k">this</span><span class="o">.</span><span class="na">target</span> <span class="o">=</span> <span class="n">file</span><span class="o">;</span>
  <span class="o">}</span>
  <span class="kt">void</span> <span class="nf">encode</span><span class="o">(</span><span class="n">String</span> <span class="n">text</span><span class="o">)</span> <span class="o">{</span>
    <span class="n">Files</span><span class="o">.</span><span class="na">write</span><span class="o">(</span>
      <span class="k">this</span><span class="o">.</span><span class="na">target</span><span class="o">,</span>
      <span class="n">text</span><span class="o">.</span><span class="na">replaceAll</span><span class="o">(</span><span class="s">&quot;[a-z]&quot;</span><span class="o">,</span> <span class="s">&quot;*&quot;</span><span class="o">)</span>
    <span class="o">);</span>
  <span class="o">}</span>
<span class="o">}</span></code></pre></figure><p>Works fine, but what will happen when you decide to extend it to also write to an <a href="https://docs.oracle.com/javase/7/docs/api/java/io/OutputStream.html"><code>OutputStream</code></a>? How will you modify this class? How ugly will it look after that? That&#39;s because the design is not object-oriented.</p><p>This is how you would do the same design, in an object-oriented way, with <a href="http://www.cactoos.org">Cactoos</a>:</p><figure class="highlight"><pre><code class="language-java" data-lang="java"><span></span><span class="kd">class</span> <span class="nc">Encoder</span> <span class="o">{</span>
  <span class="kd">private</span> <span class="kd">final</span> <span class="n">Output</span> <span class="n">target</span><span class="o">;</span>
  <span class="n">Encoder</span><span class="o">(</span><span class="kd">final</span> <span class="n">File</span> <span class="n">file</span><span class="o">)</span> <span class="o">{</span>
    <span class="k">this</span><span class="o">(</span><span class="k">new</span> <span class="n">FileAsOutput</span><span class="o">(</span><span class="n">file</span><span class="o">));</span>
  <span class="o">}</span>
  <span class="n">Encoder</span><span class="o">(</span><span class="kd">final</span> <span class="n">Output</span> <span class="n">output</span><span class="o">)</span> <span class="o">{</span>
    <span class="k">this</span><span class="o">.</span><span class="na">target</span> <span class="o">=</span> <span class="n">output</span><span class="o">;</span>
  <span class="o">}</span>
  <span class="kt">void</span> <span class="nf">encode</span><span class="o">(</span><span class="n">String</span> <span class="n">text</span><span class="o">)</span> <span class="o">{</span>
    <span class="k">new</span> <span class="n">LengthOfInput</span><span class="o">(</span>
      <span class="k">new</span> <span class="n">TeeInput</span><span class="o">(</span>
        <span class="k">new</span> <span class="n">BytesAsInput</span><span class="o">(</span>
          <span class="k">new</span> <span class="n">TextAsBytes</span><span class="o">(</span>
            <span class="k">new</span> <span class="n">StringAsText</span><span class="o">(</span>
              <span class="n">text</span><span class="o">.</span><span class="na">replaceAll</span><span class="o">(</span><span class="s">&quot;[a-z]&quot;</span><span class="o">,</span> <span class="s">&quot;*&quot;</span><span class="o">)</span>
            <span class="o">)</span>
          <span class="o">)</span>
        <span class="o">),</span>
        <span class="k">this</span><span class="o">.</span><span class="na">target</span>
      <span class="o">)</span>
    <span class="o">).</span><span class="na">value</span><span class="o">();</span>
  <span class="o">}</span>
<span class="o">}</span></code></pre></figure><p>What do we do with this design if we want <a href="https://docs.oracle.com/javase/7/docs/api/java/io/OutputStream.html"><code>OutputStream</code></a> to be accepted? We just add one <a href="/2015/05/28/one-primary-constructor.html">secondary</a> constructor:</p><figure class="highlight"><pre><code class="language-java" data-lang="java"><span></span><span class="kd">class</span> <span class="nc">Encoder</span> <span class="o">{</span>
  <span class="n">Encoder</span><span class="o">(</span><span class="kd">final</span> <span class="n">OutputStream</span> <span class="n">stream</span><span class="o">)</span> <span class="o">{</span>
    <span class="k">this</span><span class="o">(</span><span class="k">new</span> <span class="n">OutputStreamAsOutput</span><span class="o">(</span><span class="n">stream</span><span class="o">));</span>
  <span class="o">}</span>
<span class="o">}</span></code></pre></figure><p>Done. That&#39;s how easy and elegant it is.</p><p>That&#39;s because concepts are perfectly separated and functionality is encapsulated. In the procedural example the behavior of the object is located outside of it, in the method <code>encode()</code>. The file itself doesn&#39;t know how to write, some outside procedure <a href="https://docs.oracle.com/javase/7/docs/api/java/nio/file/Files.html#write%28java.nio.file.Path,%20byte%5B%5D,%20java.nio.file.OpenOption...%29"><code>Files.write()</code></a> knows that instead.</p><p>To the contrary, in the object-oriented design the <a href="http://static.javadoc.io/org.cactoos/cactoos/0.9/org/cactoos/io/FileAsOutput.html"><code>FileAsOutput</code></a> knows how to write, and nobody else does. The file writing functionality is encapsulated and this makes it possible to decorate the objects in any possible way, creating reusable and replaceable composite objects.</p><p>Do you see the beauty of OOP now?</p></p><nav class="buttons notranslate desktop-only"> <a href="http://www.facebook.com/sharer/sharer.php?u=https://www.yegor256.com/2017/06/22/object-oriented-input-output-in-cactoos.html" title="Share on Facebook" class="button" rel="nofollow"> <span class="count count-facebook">0</span> <i class="icon icon-facebook notranslate" aria-hidden="true"></i> </a> <a href="https://twitter.com/share?url=https://www.yegor256.com/2017/06/22/object-oriented-input-output-in-cactoos.html&amp;text=Object-Oriented+Declarative+Input%2FOutput+in+Cactoos" title="Share on Twitter" class="button" rel="nofollow"> <span class="count count-twitter">0</span> <i class="icon icon-twitter notranslate" aria-hidden="true"></i> </a> <a href="https://plus.google.com/share?url=https://www.yegor256.com/2017/06/22/object-oriented-input-output-in-cactoos.html" title="Share on Google+" class="button" rel="nofollow"> <span class="count count-googleplus">0</span> <i class="icon icon-googleplus notranslate" aria-hidden="true"></i> </a> <a href="https://www.linkedin.com/cws/share?url=https://www.yegor256.com/2017/06/22/object-oriented-input-output-in-cactoos.html" title="Share on LinkedIn" class="button" rel="nofollow"> <span class="count count-linkedin">0</span> <i class="icon icon-linkedin notranslate" aria-hidden="true"></i> </a> <a href="http://reddit.com/submit?url=https://www.yegor256.com/2017/06/22/object-oriented-input-output-in-cactoos.html%3F2017-25&amp;title=Object-Oriented+Declarative+Input%2FOutput+in+Cactoos" title="Share on Reddit" class="button" rel="nofollow"> <span class="count count-reddit">0</span> <i class="icon icon-reddit notranslate" aria-hidden="true"></i> </a> <a href="http://news.ycombinator.com/submitlink?u=https://www.yegor256.com/2017/06/22/object-oriented-input-output-in-cactoos.html%3F2017-25&amp;t=Object-Oriented+Declarative+Input%2FOutput+in+Cactoos" title="Share on Hacker News" class="button" rel="nofollow"> <span class="count count-hackernews">0</span> <i class="icon icon-hackernews notranslate" aria-hidden="true"></i> </a> </nav> </header> <article class="main" itemprop="articleBody"><div > <figure class='badge'><a href='http://www.cactoos.org'><img src='https://www.yegor256.com/images/books/elegant-objects/cactus.svg' style='width:92px;max-width:100%;' alt='badge'/></a></figure><p><a href="http://www.cactoos.org">Cactoos</a> is a library of object-oriented Java primitives <a href="https://github.com/yegor256/cactoos#contributors">we</a> started to work on just a few weeks ago. The intent was to propose a clean and more declarative alternative to <a href="https://en.wikipedia.org/wiki/Java_Development_Kit">JDK</a>, <a href="https://github.com/google/guava">Guava</a>, <a href="https://commons.apache.org/">Apache Commons</a>, and others. Instead of calling static <a href="/2014/05/05/oop-alternative-to-utility-classes.html">procedures</a> we want to use <a href="/2016/07/14/who-is-object.html">objects</a>, the way they are supposed to be used. Let&#39;s see how input/output works in a <em>pure</em> <a href="/2016/08/15/what-is-wrong-object-oriented-programming.html">object-oriented</a> fashion.</p><p><strong>Disclaimer</strong>: The version I&#39;m using at the time of writing is <a href="https://github.com/yegor256/cactoos/releases/tag/0.9">0.9</a>. Later versions may have different names of classes and a totally different design.</p><p>Let&#39;s say you want to read a file. This is how you would do it with the static method <a href="https://docs.oracle.com/javase/7/docs/api/java/nio/file/Files.html#readAllBytes%28java.nio.file.Path%29"><code>readAllBytes()</code></a> from the <a href="/2014/05/05/oop-alternative-to-utility-classes.html">utility class</a> <a href="https://docs.oracle.com/javase/7/docs/api/java/nio/file/Files.html"><code>Files</code></a> in JDK7:</p><figure class="highlight"><pre><code class="language-java" data-lang="java"><span></span><span class="kt">byte</span><span class="o">[]</span> <span class="n">content</span> <span class="o">=</span> <span class="n">Files</span><span class="o">.</span><span class="na">readAllBytes</span><span class="o">(</span>
  <span class="k">new</span> <span class="n">File</span><span class="o">(</span><span class="s">&quot;/tmp/photo.jpg&quot;</span><span class="o">).</span><span class="na">toPath</span><span class="o">()</span>
<span class="o">);</span></code></pre></figure><p>This code is very imperative---it reads the file content right here and now, placing it into the array.</p><p>This is how you do it with <a href="https://github.com/yegor256/cactoos">Cactoos</a>:</p><figure class="highlight"><pre><code class="language-java" data-lang="java"><span></span><span class="n">Bytes</span> <span class="n">source</span> <span class="o">=</span> <span class="k">new</span> <span class="n">InputAsBytes</span><span class="o">(</span>
  <span class="k">new</span> <span class="n">FileAsInput</span><span class="o">(</span>
    <span class="k">new</span> <span class="n">File</span><span class="o">(</span><span class="s">&quot;/tmp/photo.jpg&quot;</span><span class="o">)</span>
  <span class="o">)</span>
<span class="o">);</span></code></pre></figure><p>Pay attention---there are no method calls yet. Just three constructors of three classes that compose a bigger object. The object <code>source</code> is of type <a href="http://static.javadoc.io/org.cactoos/cactoos/0.9/org/cactoos/Bytes.html"><code>Bytes</code></a> and represents the content of the file. To get that content out of it we call its method <code>asBytes()</code>:</p><figure class="highlight"><pre><code class="language-java" data-lang="java"><span></span><span class="n">bytes</span><span class="o">[]</span> <span class="n">content</span> <span class="o">=</span> <span class="n">source</span><span class="o">.</span><span class="na">asBytes</span><span class="o">();</span></code></pre></figure><p>This is the moment when the file system is touched. This approach, as you can see, is absolutely declarative and thanks to that possesses all the benefits of object orientation.</p><p>Here is another example. Say you want to write some text into a file. Here is how you do it in Cactoos. First you need the <a href="http://static.javadoc.io/org.cactoos/cactoos/0.9/org/cactoos/Input.html"><code>Input</code></a>:</p><figure class="highlight"><pre><code class="language-java" data-lang="java"><span></span><span class="n">Input</span> <span class="n">input</span> <span class="o">=</span> <span class="k">new</span> <span class="n">BytesAsInput</span><span class="o">(</span>
  <span class="k">new</span> <span class="n">TextAsBytes</span><span class="o">(</span>
    <span class="k">new</span> <span class="n">StringAsText</span><span class="o">(</span>
      <span class="s">&quot;Hello, world!&quot;</span>
    <span class="o">)</span>
  <span class="o">)</span>
<span class="o">);</span></code></pre></figure><p>Then you need the <a href="http://static.javadoc.io/org.cactoos/cactoos/0.9/org/cactoos/Output.html"><code>Output</code></a>:</p><figure class="highlight"><pre><code class="language-java" data-lang="java"><span></span><span class="n">Output</span> <span class="n">output</span> <span class="o">=</span> <span class="k">new</span> <span class="n">FileAsOutput</span><span class="o">(</span>
  <span class="k">new</span> <span class="n">File</span><span class="o">(</span><span class="s">&quot;/tmp/hello.txt&quot;</span><span class="o">)</span>
<span class="o">);</span></code></pre></figure><p>Now, we want to copy the input to the output. There is no &quot;copy&quot; operation in <em>pure</em> OOP. Moreover, there must be no operations at all. Just objects. We have a class named <a href="http://static.javadoc.io/org.cactoos/cactoos/0.9/org/cactoos/io/TeeInput.html"><code>TeeInput</code></a>, which is an <code>Input</code> that copies everything you read from it to the <a href="http://static.javadoc.io/org.cactoos/cactoos/0.9/org/cactoos/Output.html"><code>Output</code></a>, similar to what <a href="https://commons.apache.org/proper/commons-io/javadocs/api-1.4/org/apache/commons/io/input/TeeInputStream.html"><code>TeeInputStream</code></a> from <a href="https://commons.apache.org/">Apache Commons</a> does, but encapsulated. So we don&#39;t copy, we create an <a href="http://static.javadoc.io/org.cactoos/cactoos/0.9/org/cactoos/Input.html"><code>Input</code></a> that will copy if you <em>touch</em> it:</p><figure class="highlight"><pre><code class="language-java" data-lang="java"><span></span><span class="n">Input</span> <span class="n">tee</span> <span class="o">=</span> <span class="k">new</span> <span class="n">TeeInput</span><span class="o">(</span><span class="n">input</span><span class="o">,</span> <span class="n">output</span><span class="o">);</span></code></pre></figure><p>Now, we have to &quot;touch&quot; it. And we have to touch every single byte of it, in order to make sure they all are copied. If we just <code>read()</code> the first byte, only one byte will be copied to the file. The best way to touch them all is to calculate the size of the <code>tee</code> object, going byte by byte. We have an object for it, called <a href="http://static.javadoc.io/org.cactoos/cactoos/0.9/org/cactoos/io/LengthOfInput.html"><code>LengthOfInput</code></a>. It encapsulates an <a href="http://static.javadoc.io/org.cactoos/cactoos/0.9/org/cactoos/Input.html"><code>Input</code></a> and behaves like its length in bytes:</p><figure class="highlight"><pre><code class="language-java" data-lang="java"><span></span><span class="n">Scalar</span><span class="o">&lt;</span><span class="n">Long</span><span class="o">&gt;</span> <span class="n">length</span> <span class="o">=</span> <span class="k">new</span> <span class="n">LengthOfInput</span><span class="o">(</span><span class="n">tee</span><span class="o">);</span></code></pre></figure><p>Then we take the value out of it and the file writing operation takes place:</p><figure class="highlight"><pre><code class="language-java" data-lang="java"><span></span><span class="kt">long</span> <span class="n">len</span> <span class="o">=</span> <span class="n">length</span><span class="o">.</span><span class="na">value</span><span class="o">();</span></code></pre></figure><p>Thus, the entire operation of writing the string to the file will look like this:</p><figure class="highlight"><pre><code class="language-java" data-lang="java"><span></span><span class="k">new</span> <span class="n">LengthOfInput</span><span class="o">(</span>
  <span class="k">new</span> <span class="n">TeeInput</span><span class="o">(</span>
    <span class="k">new</span> <span class="n">BytesAsInput</span><span class="o">(</span>
      <span class="k">new</span> <span class="n">TextAsBytes</span><span class="o">(</span>
        <span class="k">new</span> <span class="n">StringAsText</span><span class="o">(</span>
          <span class="s">&quot;Hello, world!&quot;</span>
        <span class="o">)</span>
      <span class="o">)</span>
    <span class="o">),</span>
    <span class="k">new</span> <span class="n">FileAsOutput</span><span class="o">(</span>
      <span class="k">new</span> <span class="n">File</span><span class="o">(</span><span class="s">&quot;/tmp/hello.txt&quot;</span><span class="o">)</span>
    <span class="o">)</span>
  <span class="o">)</span>
<span class="o">).</span><span class="na">value</span><span class="o">();</span> <span class="c1">// happens here</span></code></pre></figure><p>This is its procedural alternative from <a href="https://docs.oracle.com/javase/7/docs/api/java/nio/file/Files.html#write%28java.nio.file.Path,%20byte%5B%5D,%20java.nio.file.OpenOption...%29">JDK7</a>:</p><figure class="highlight"><pre><code class="language-java" data-lang="java"><span></span><span class="n">Files</span><span class="o">.</span><span class="na">write</span><span class="o">(</span>
  <span class="k">new</span> <span class="n">File</span><span class="o">(</span><span class="s">&quot;/tmp/hello.txt&quot;</span><span class="o">).</span><span class="na">toPath</span><span class="o">(),</span>
  <span class="s">&quot;Hello, world!&quot;</span><span class="o">.</span><span class="na">getBytes</span><span class="o">()</span>
<span class="o">);</span></code></pre></figure><p>&quot;Why is object-oriented better, even though it&#39;s longer?&quot; I hear you ask. Because it perfectly <strong>decouples</strong> concepts, while the procedural one keeps them together.</p><p>Let&#39;s say, you are designing a class that is supposed to encrypt some text and save it to a file. Here is how you would design it the procedural way (not a real encryption, of course):</p><figure class="highlight"><pre><code class="language-java" data-lang="java"><span></span><span class="kd">class</span> <span class="nc">Encoder</span> <span class="o">{</span>
  <span class="kd">private</span> <span class="kd">final</span> <span class="n">File</span> <span class="n">target</span><span class="o">;</span>
  <span class="n">Encoder</span><span class="o">(</span><span class="kd">final</span> <span class="n">File</span> <span class="n">file</span><span class="o">)</span> <span class="o">{</span>
    <span class="k">this</span><span class="o">.</span><span class="na">target</span> <span class="o">=</span> <span class="n">file</span><span class="o">;</span>
  <span class="o">}</span>
  <span class="kt">void</span> <span class="nf">encode</span><span class="o">(</span><span class="n">String</span> <span class="n">text</span><span class="o">)</span> <span class="o">{</span>
    <span class="n">Files</span><span class="o">.</span><span class="na">write</span><span class="o">(</span>
      <span class="k">this</span><span class="o">.</span><span class="na">target</span><span class="o">,</span>
      <span class="n">text</span><span class="o">.</span><span class="na">replaceAll</span><span class="o">(</span><span class="s">&quot;[a-z]&quot;</span><span class="o">,</span> <span class="s">&quot;*&quot;</span><span class="o">)</span>
    <span class="o">);</span>
  <span class="o">}</span>
<span class="o">}</span></code></pre></figure><p>Works fine, but what will happen when you decide to extend it to also write to an <a href="https://docs.oracle.com/javase/7/docs/api/java/io/OutputStream.html"><code>OutputStream</code></a>? How will you modify this class? How ugly will it look after that? That&#39;s because the design is not object-oriented.</p><p>This is how you would do the same design, in an object-oriented way, with <a href="http://www.cactoos.org">Cactoos</a>:</p><figure class="highlight"><pre><code class="language-java" data-lang="java"><span></span><span class="kd">class</span> <span class="nc">Encoder</span> <span class="o">{</span>
  <span class="kd">private</span> <span class="kd">final</span> <span class="n">Output</span> <span class="n">target</span><span class="o">;</span>
  <span class="n">Encoder</span><span class="o">(</span><span class="kd">final</span> <span class="n">File</span> <span class="n">file</span><span class="o">)</span> <span class="o">{</span>
    <span class="k">this</span><span class="o">(</span><span class="k">new</span> <span class="n">FileAsOutput</span><span class="o">(</span><span class="n">file</span><span class="o">));</span>
  <span class="o">}</span>
  <span class="n">Encoder</span><span class="o">(</span><span class="kd">final</span> <span class="n">Output</span> <span class="n">output</span><span class="o">)</span> <span class="o">{</span>
    <span class="k">this</span><span class="o">.</span><span class="na">target</span> <span class="o">=</span> <span class="n">output</span><span class="o">;</span>
  <span class="o">}</span>
  <span class="kt">void</span> <span class="nf">encode</span><span class="o">(</span><span class="n">String</span> <span class="n">text</span><span class="o">)</span> <span class="o">{</span>
    <span class="k">new</span> <span class="n">LengthOfInput</span><span class="o">(</span>
      <span class="k">new</span> <span class="n">TeeInput</span><span class="o">(</span>
        <span class="k">new</span> <span class="n">BytesAsInput</span><span class="o">(</span>
          <span class="k">new</span> <span class="n">TextAsBytes</span><span class="o">(</span>
            <span class="k">new</span> <span class="n">StringAsText</span><span class="o">(</span>
              <span class="n">text</span><span class="o">.</span><span class="na">replaceAll</span><span class="o">(</span><span class="s">&quot;[a-z]&quot;</span><span class="o">,</span> <span class="s">&quot;*&quot;</span><span class="o">)</span>
            <span class="o">)</span>
          <span class="o">)</span>
        <span class="o">),</span>
        <span class="k">this</span><span class="o">.</span><span class="na">target</span>
      <span class="o">)</span>
    <span class="o">).</span><span class="na">value</span><span class="o">();</span>
  <span class="o">}</span>
<span class="o">}</span></code></pre></figure><p>What do we do with this design if we want <a href="https://docs.oracle.com/javase/7/docs/api/java/io/OutputStream.html"><code>OutputStream</code></a> to be accepted? We just add one <a href="/2015/05/28/one-primary-constructor.html">secondary</a> constructor:</p><figure class="highlight"><pre><code class="language-java" data-lang="java"><span></span><span class="kd">class</span> <span class="nc">Encoder</span> <span class="o">{</span>
  <span class="n">Encoder</span><span class="o">(</span><span class="kd">final</span> <span class="n">OutputStream</span> <span class="n">stream</span><span class="o">)</span> <span class="o">{</span>
    <span class="k">this</span><span class="o">(</span><span class="k">new</span> <span class="n">OutputStreamAsOutput</span><span class="o">(</span><span class="n">stream</span><span class="o">));</span>
  <span class="o">}</span>
<span class="o">}</span></code></pre></figure><p>Done. That&#39;s how easy and elegant it is.</p><p>That&#39;s because concepts are perfectly separated and functionality is encapsulated. In the procedural example the behavior of the object is located outside of it, in the method <code>encode()</code>. The file itself doesn&#39;t know how to write, some outside procedure <a href="https://docs.oracle.com/javase/7/docs/api/java/nio/file/Files.html#write%28java.nio.file.Path,%20byte%5B%5D,%20java.nio.file.OpenOption...%29"><code>Files.write()</code></a> knows that instead.</p><p>To the contrary, in the object-oriented design the <a href="http://static.javadoc.io/org.cactoos/cactoos/0.9/org/cactoos/io/FileAsOutput.html"><code>FileAsOutput</code></a> knows how to write, and nobody else does. The file writing functionality is encapsulated and this makes it possible to decorate the objects in any possible way, creating reusable and replaceable composite objects.</p><p>Do you see the beauty of OOP now?</p></div></article></div><div class="wrapper"> <related-posts /></div><div class="disqus" role="complementary"><p class="disqus_hint"> Please, use <a href="https://help.disqus.com/commenting/what-html-tags-are-allowed-within-comments">syntax highlighting</a> in your comments, to make them more readable.</p><div id="disqus_thread" class="disqus-thread"> <a>&nbsp;</a></div><script> var disqus_config = function () { this.page.url = document.location.href.split('?')[0].split('#')[0].replace('https://', 'http://'); this.page.identifier = this.page.url; }; (function() { var d = document, s = d.createElement('script'); s.src = '//yegor256.disqus.com/embed.js'; s.setAttribute('data-timestamp', +new Date()); (d.head || d.body).appendChild(s); })(); </script> <noscript><div><p class="red"> JavaScript is disabled in your browser, that's why you can't see comments under this post.</p></div></noscript></div><div class="wrapper"> <footer class="footer"><p> &copy; <span itemscope="" itemprop="copyrightHolder" itemtype="http://schema.org/Person"> <span itemprop="name">Yegor Bugayenko</span> </span> 2014&ndash;<span itemprop="copyrightYear">2018</span></p></footer></div></section><div class="wrapper unprintable" style="text-align:center;margin-top:2em;"> <a href="http://www.sixnines.io/h/3ba1652f"> <img src="//www.sixnines.io/b/3ba1652f?style=flat" alt="sixnines availability badge"/> </a></div><script src="//code.jquery.com/jquery-1.9.0.min.js"></script> <script src="/js/all.js?a0e0d018c07"></script> <script>var disqus_shortname = 'yegor256';</script> <script id="dsq-count-scr" src="//yegor256.disqus.com/count.js" async="async"></script> <script> (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){ (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o), m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m) })(window,document,'script','//www.google-analytics.com/analytics.js','ga'); ga('create', 'UA-1963507-32', 'auto'); ga('send', 'pageview'); </script> <script> Cd=document;Cr="&"+Math.random();Cp="&s=1"; Cd.cookie="b=b";if(Cd.cookie)Cp+="&c=1"; Cp+="&t="+(new Date()).getTimezoneOffset(); if(self!=top)Cp+="&f=1"; </script> <script> if(navigator.javaEnabled())Cp+="&j=1"; </script> <script> if(typeof(screen)!='undefined')Cp+="&w="+screen.width+"&h="+ screen.height+"&d="+(screen.colorDepth?screen.colorDepth:screen.pixelDepth); </script> <script> Cd.write("<img src='//c.hit.ua/hit?i=95870&g=0&x=2"+Cp+Cr+ "&r="+escape(Cd.referrer)+"&u="+escape(window.location.href)+ "' border='0' wi"+"dth='1' he"+"ight='1'/>"); </script> <script type="application/ld+json"> { "@context": "http://schema.org", "@type": "Person", "name": "Yegor Bugayenko", "url": "http://www.yegor256.com", "sameAs": [ "https://www.facebook.com/yegor256", "https://instagram.com/yegor256", "https://www.linkedin.com/in/yegor256", "https://twitter.com/yegor256", "https://github.com/yegor256", "https://www.pinterest.com/yegor256/" ] } </script> </body> </html> <!DOCTYPE html> <html xmlns="http://www.w3.org/1999/xhtml" lang="en-US" xml:lang="en-US" itemscope="" itemtype="http://schema.org/WebSite"> <head> <meta charset="utf-8"/> <meta name="description" content="To make code shorter and more cohesive we use unmodifiable values, still calling them variables; why so? " /> <meta name="keywords" content="algorithms in oop, no variables, oop, variables, variables in oop" /> <meta name="viewport" content="width=device-width,minimum-scale=1,initial-scale=1"/> <meta name="google-site-verification" content="JEj_gQr2CPe2QKGw8XdMz0R7VboQIUbX3FlM-lwTq-8" /> <meta name="author" content="Yegor Bugayenko"> <meta name="article:published_time" content="2017-05-16 00:00:00 +0000"> <meta name="og:site_name" content="Yegor Bugayenko"/> <meta name="og:type" content="article" /> <meta name="og:locale" content="en_US" /> <meta name="twitter:account_id" content="4503599630178231" /> <meta name="twitter:creator" content="@yegor256"/> <meta name="twitter:site" content="@yegor256"/> <meta name="twitter:title" property="og:title" content="Monikers Instead of Variables"/> <meta name="twitter:description" property="og:description" content="To make code shorter and more cohesive we use unmodifiable values, still calling them variables; why so? "/> <meta name="twitter:url" property="og:url" content="https://www.yegor256.com/2017/05/16/monikers.html"/> <meta name="telegram:channel" content="AAAAAEJFMRzsRTRxM3ec6A"/> <link rel="search" type="application/opensearchdescription+xml" href="/opensearch.xml" title="yegor256" /> <link rel="shortcut icon" href="/favicon.ico?a0e0d018c07"/> <link rel="apple-touch-icon" href="/favicon.ico?a0e0d018c07"/> <link rel="alternate" type="application/rss+xml" title="RSS for yegor256.com" href="https://www.yegor256.com/rss.xml"/> <link rel="stylesheet" href="/css/layout.css?a0e0d018c07"/> <link rel="stylesheet" href="/css/icons.css?a0e0d018c07"/> <link rel="canonical" href="https://www.yegor256.com/2017/05/16/monikers.html" /> <link rel="amphtml" href="https://www.yegor256.com/2017/05/16/monikers.amp.html" /> <title>Monikers Instead of Variables </title> <meta name='og:image' content='https://www.yegor256.com/images/2017/05/oss-117.jpg'/><meta name='twitter:image' content='https://www.yegor256.com/images/2017/05/oss-117.jpg'/><meta name='og:image:width' content='1268'/> <meta name='twitter:image:width' content='1268'/><meta name='og:image:height' content='713'/> <meta name='twitter:image:height' content='713'/><meta name='twitter:card' content='summary_large_image'/><meta name='twitter:image:alt' content='OSS 117: Cairo, Nest of Spies (2006) by Michel Hazanavicius'/> </head> <body><div class="wrapper"> <aside class="header-toggle unprintable" id="header-toggle" title="Show the menu" onclick="$('#header').show();$('#header-toggle').hide();">&#9776;</aside> <header class="header" id="header"><div class="face"> <a href="/about-me.html#form" class="sub" title="Click to subscribe to my monthly newsletter"><span>Subscribe</span></a> <a href="/about-me.html" style="position:relative;"> <img src="/images/face-256x256.jpg" class="photo" alt="Yegor Bugayenko"/> </a></div><nav><ul class="menu social notranslate"> <li><a href="https://twitter.com/intent/follow?screen_name=yegor256" rel="nofollow" title="Follow me on Twitter"><i class="icon icon-twitter notranslate" aria-hidden="true"></i></a></li> <li><a href="/rss.xml" rel="nofollow" title="Subscribe to my RSS feed"><i class="icon icon-rss notranslate" aria-hidden="true"></i></a></li> <li><a itemprop="sameAs" href="https://github.com/yegor256" rel="nofollow" title="My GitHub profile"><i class="icon icon-github notranslate" aria-hidden="true"></i></a></li> <li><a itemprop="sameAs" href="http://stackoverflow.com/users/187141/yegor256" rel="nofollow" title="My StackOverflow profile"><i class="icon icon-stackoverflow notranslate" aria-hidden="true"></i></a></li> <li><a itemprop="sameAs" href="https://www.facebook.com/yegor256" rel="nofollow" title="Follow me on Facebook"><i class="icon icon-facebook notranslate" aria-hidden="true"></i></a></li> <li><a itemprop="sameAs" href="https://instagram.com/yegor256" rel="nofollow" title="Follow me on Instagram"><i class="icon icon-instagram notranslate" aria-hidden="true"></i></a></li> <li><a itemprop="sameAs" href="https://www.linkedin.com/in/yegor256" rel="nofollow" title="My LinkedIn profile"><i class="icon icon-linkedin notranslate" aria-hidden="true"></i></a></li> <li><a itemprop="sameAs" href="https://www.youtube.com/c/yegor256?sub_confirmation=1" rel="nofollow" title="My Youtube video channel"><i class="icon icon-youtube notranslate" aria-hidden="true"></i></a></li> <li><a itemprop="sameAs" href="https://www.pinterest.com/yegor256/" rel="nofollow" title="My Pinterest boards"><i class="icon icon-pinterest notranslate" aria-hidden="true"></i></a></li> <li><a itemprop="sameAs" href="https://angel.co/yegor256" rel="nofollow" title="My AngelList profile"><i class="icon icon-angellist notranslate" aria-hidden="true"></i></a></li> <li><a href="https://soundcloud.com/yegor256" rel="nofollow" title="My podcast"><i class="icon icon-podcast notranslate" aria-hidden="true"></i></a></li> <li><a href="https://itunes.apple.com/us/podcast/yegor256-podcast/id1150826721" rel="nofollow" title="My iTunes podcast"><i class="icon icon-itunes notranslate" aria-hidden="true"></i></a></li> <li><a href="https://t.me/joinchat/AAAAAEJFMRzsRTRxM3ec6A" rel="nofollow" title="My Telegram public channel"><i class="icon icon-telegram notranslate" aria-hidden="true"></i></a></li> <li><a href="mailto:blog@yegor256.com" rel="nofollow" title="Email me any time"><i class="icon icon-mail notranslate" aria-hidden="true"></i></a></li></ul><ul class="menu"> <li><a href="/" title="Home page">Home</a></li> <li ><a href="/best.html" title="Best articles to read">12&#160;Best</a></li> <li ><a href="/contents.html" title="The contents of the entire blog">All&#160;288</a></li> <li ><a href="/webinars.html" title="My webinars">Webinars</a></li> <li ><a href="/talks.html" title="Future and past conference talks">Talks</a></li> <li ><a href="/books.html" title="The books I wrote">Books</a></li> <li ><a href="/papers.html" title="My academic papers and patents">Papers</a></li> <li ><a href="/pets.html" title="My loved pet projects">Pets</a></li> <li ><a href="/award.html" title="Software quality award">Award</a></li> <li ><a href="/testimonials.html" title="What some people say about me">Testimonials</a></li> <li ><a href="/shift-m.html" title="Audio podcast about project management">Shift-M</a></li> <li ><a href="/paintings.html" title="My paintings for sale">Paintings</a></li> <li><a href="http://ru.yegor256.com/" title="Немного на русском языке">По-русски</a></li></ul></nav><div class="search"> <form method="get" action="https://www.google.com/search" itemprop="potentialAction" itemscope="" itemtype="http://schema.org/SearchAction"> <meta itemprop="target" content="https://www.google.com/search?q={q}"/> <input name="sitesearch" value="yegor256.com" type="hidden"/> <input itemprop="query-input" type="text" id="search-query" class="field field-text" required="required" onfocus="$('.google').css('visibility', 'visible');" name="q" placeholder="Search..." autocomplete="off"/> <input type="image" src="/images/google-search-icon.svg" class="google" title="Search via Google" alt="Search via Google"/> </form></div><div class="hot"><ul> <li> <a href="/code-ahead.html">Code Ahead</a> was published on Amazon just a few days ago! It is my new book, a novel about programmers. It explains in details the majority of ideas that stand behind <a href="https://www.zerocracy.com">Zerocracy</a> and <a href="https://www.xdsd.org">XDSD</a>. </li> <li> At <a href="/webinars.html">Webinar #37</a> we will discuss naming problem in OOP, for objects, methods and attributes; join us on <b>September 12</b>, at 11am PST. </li></ul></div></header></div><section itemscope="" itemtype="http://schema.org/BlogPosting"><div class="wrapper"> <header><p class="printable"> <img src="https://api.qrserver.com/v1/create-qr-code/?data=https://www.yegor256.com/2017/05/16/monikers.html&amp;format=svg" style="width:125px;height:125px;" alt="QR code"/></p><p class="printable"> <code itemprop="url">https://www.yegor256.com/2017/05/16/monikers.html</code></p><h1 itemprop="name headline mainEntityOfPage">Monikers Instead of Variables</h1><ul class="subline"> <li> <time itemprop="datePublished" datetime="2017-05-16T00:00:00+00:00"> 16 May 2017 </time> </li> <li class="desktop-only" itemprop="locationCreated">Odessa, Ukraine</li> <li class="printable" itemscope="" itemprop="author" itemtype="http://schema.org/Person"> <span itemprop="name">Yegor Bugayenko</span> </li> <li class="unprintable"> <i class="icon icon-comments"></i> <a href="http://www.yegor256.com/2017/05/16/monikers.html#disqus_thread" itemprop="discussionUrl">comments</a> </li></ul><p class="unprintable"><p>If we agree that all local variables <a href="https://softwareengineering.stackexchange.com/questions/48413">must be</a> <code>final</code>, multiple <code>return</code>s must be avoided, and temporal coupling between statements is evil---we can get rid of variables entirely and replace them with <em>inline values</em> and their <em>monikers</em>.</p><figure class='jb_picture'><img itemprop='image' alt='OSS 117: Cairo, Nest of Spies (2006) by Michel Hazanavicius' src='/images/2017/05/oss-117.jpg' longdesc='#fde99754'/><figcaption id='fde99754'>OSS 117: Cairo, Nest of Spies (2006) by Michel Hazanavicius</figcaption></figure><p>Here is the code from Section 5.10 (<em>Algorithms</em>) of my book <a href="http://amzn.to/2pjciUY"><em>Elegant Objects</em></a>:</p><figure class="highlight"><pre><code class="language-java" data-lang="java"><span></span><span class="kd">public</span> <span class="kd">class</span> <span class="nc">Main</span> <span class="o">{</span>
  <span class="kd">public</span> <span class="kd">static</span> <span class="kt">void</span> <span class="nf">main</span><span class="o">(</span><span class="n">String</span><span class="o">...</span> <span class="n">args</span><span class="o">)</span> <span class="o">{</span>
    <span class="kd">final</span> <span class="n">Secret</span> <span class="n">secret</span> <span class="o">=</span> <span class="k">new</span> <span class="n">Secret</span><span class="o">();</span>
    <span class="k">new</span> <span class="n">Farewell</span><span class="o">(</span>
      <span class="k">new</span> <span class="n">Attempts</span><span class="o">(</span>
        <span class="k">new</span> <span class="n">VerboseDiff</span><span class="o">(</span>
          <span class="k">new</span> <span class="n">Diff</span><span class="o">(</span>
            <span class="n">secret</span><span class="o">,</span>
            <span class="k">new</span> <span class="n">Guess</span><span class="o">()</span>
          <span class="o">)</span>
        <span class="o">),</span> <span class="mi">5</span>
      <span class="o">),</span>
      <span class="n">secret</span>
    <span class="o">).</span><span class="na">say</span><span class="o">();</span>
  <span class="o">}</span>
<span class="o">}</span></code></pre></figure><p>Pay attention to the variable <code>secret</code>. It exists here because we need its value twice: first, as a constructor argument for the <code>Diff</code>, second as a constructor argument for the <code>Farewell</code>. We can&#39;t <em>inline</em> the value by creating two separate instances of class <code>Secret</code>, because it really has to be the same object---it encapsulates the number that we hide from the user in a number-guessing game.</p><p>There could be many other situations where a <em>value</em> needs to be used multiple times while remaining unmodifiable. Why do we still call these values <em>variables</em> if technically they are constants?</p><p>I&#39;m suggesting we introduce &quot;monikers&quot; for these values, assigning them through the <code>as</code> keyword. For example:</p><figure class="highlight"><pre><code class="language-java" data-lang="java"><span></span><span class="kd">public</span> <span class="kd">class</span> <span class="nc">Main</span> <span class="o">{</span>
  <span class="kd">public</span> <span class="kd">static</span> <span class="kt">void</span> <span class="nf">main</span><span class="o">(</span><span class="n">String</span><span class="o">...</span> <span class="n">args</span><span class="o">)</span> <span class="o">{</span>
    <span class="k">new</span> <span class="n">Farewell</span><span class="o">(</span>
      <span class="k">new</span> <span class="n">Attempts</span><span class="o">(</span>
        <span class="k">new</span> <span class="n">VerboseDiff</span><span class="o">(</span>
          <span class="k">new</span> <span class="n">Diff</span><span class="o">(</span>
            <span class="k">new</span> <span class="n">Secret</span><span class="o">()</span> <span class="n">as</span> <span class="n">secret</span><span class="o">,</span>
            <span class="k">new</span> <span class="n">Guess</span><span class="o">()</span>
          <span class="o">)</span>
        <span class="o">),</span> <span class="mi">5</span>
      <span class="o">),</span>
      <span class="n">secret</span>
    <span class="o">).</span><span class="na">say</span><span class="o">();</span>
  <span class="o">}</span>
<span class="o">}</span></code></pre></figure><p>Here <code>new Secret()</code> is the inlined value and <code>secret</code> is its <em>moniker</em>, which we use a few lines later.</p><p>It would be great to have this feature in Java, right?</p></p><nav class="buttons notranslate desktop-only"> <a href="http://www.facebook.com/sharer/sharer.php?u=https://www.yegor256.com/2017/05/16/monikers.html" title="Share on Facebook" class="button" rel="nofollow"> <span class="count count-facebook">0</span> <i class="icon icon-facebook notranslate" aria-hidden="true"></i> </a> <a href="https://twitter.com/share?url=https://www.yegor256.com/2017/05/16/monikers.html&amp;text=Monikers+Instead+of+Variables" title="Share on Twitter" class="button" rel="nofollow"> <span class="count count-twitter">0</span> <i class="icon icon-twitter notranslate" aria-hidden="true"></i> </a> <a href="https://plus.google.com/share?url=https://www.yegor256.com/2017/05/16/monikers.html" title="Share on Google+" class="button" rel="nofollow"> <span class="count count-googleplus">0</span> <i class="icon icon-googleplus notranslate" aria-hidden="true"></i> </a> <a href="https://www.linkedin.com/cws/share?url=https://www.yegor256.com/2017/05/16/monikers.html" title="Share on LinkedIn" class="button" rel="nofollow"> <span class="count count-linkedin">0</span> <i class="icon icon-linkedin notranslate" aria-hidden="true"></i> </a> <a href="http://reddit.com/submit?url=https://www.yegor256.com/2017/05/16/monikers.html%3F2017-20&amp;title=Monikers+Instead+of+Variables" title="Share on Reddit" class="button" rel="nofollow"> <span class="count count-reddit">0</span> <i class="icon icon-reddit notranslate" aria-hidden="true"></i> </a> <a href="http://news.ycombinator.com/submitlink?u=https://www.yegor256.com/2017/05/16/monikers.html%3F2017-20&amp;t=Monikers+Instead+of+Variables" title="Share on Hacker News" class="button" rel="nofollow"> <span class="count count-hackernews">0</span> <i class="icon icon-hackernews notranslate" aria-hidden="true"></i> </a> </nav> </header> <article class="main" itemprop="articleBody"><div ><p>If we agree that all local variables <a href="https://softwareengineering.stackexchange.com/questions/48413">must be</a> <code>final</code>, multiple <code>return</code>s must be avoided, and temporal coupling between statements is evil---we can get rid of variables entirely and replace them with <em>inline values</em> and their <em>monikers</em>.</p><figure class='jb_picture'><img itemprop='image' alt='OSS 117: Cairo, Nest of Spies (2006) by Michel Hazanavicius' src='/images/2017/05/oss-117.jpg' longdesc='#fde99754'/><figcaption id='fde99754'>OSS 117: Cairo, Nest of Spies (2006) by Michel Hazanavicius</figcaption></figure><p>Here is the code from Section 5.10 (<em>Algorithms</em>) of my book <a href="http://amzn.to/2pjciUY"><em>Elegant Objects</em></a>:</p><figure class="highlight"><pre><code class="language-java" data-lang="java"><span></span><span class="kd">public</span> <span class="kd">class</span> <span class="nc">Main</span> <span class="o">{</span>
  <span class="kd">public</span> <span class="kd">static</span> <span class="kt">void</span> <span class="nf">main</span><span class="o">(</span><span class="n">String</span><span class="o">...</span> <span class="n">args</span><span class="o">)</span> <span class="o">{</span>
    <span class="kd">final</span> <span class="n">Secret</span> <span class="n">secret</span> <span class="o">=</span> <span class="k">new</span> <span class="n">Secret</span><span class="o">();</span>
    <span class="k">new</span> <span class="n">Farewell</span><span class="o">(</span>
      <span class="k">new</span> <span class="n">Attempts</span><span class="o">(</span>
        <span class="k">new</span> <span class="n">VerboseDiff</span><span class="o">(</span>
          <span class="k">new</span> <span class="n">Diff</span><span class="o">(</span>
            <span class="n">secret</span><span class="o">,</span>
            <span class="k">new</span> <span class="n">Guess</span><span class="o">()</span>
          <span class="o">)</span>
        <span class="o">),</span> <span class="mi">5</span>
      <span class="o">),</span>
      <span class="n">secret</span>
    <span class="o">).</span><span class="na">say</span><span class="o">();</span>
  <span class="o">}</span>
<span class="o">}</span></code></pre></figure><p>Pay attention to the variable <code>secret</code>. It exists here because we need its value twice: first, as a constructor argument for the <code>Diff</code>, second as a constructor argument for the <code>Farewell</code>. We can&#39;t <em>inline</em> the value by creating two separate instances of class <code>Secret</code>, because it really has to be the same object---it encapsulates the number that we hide from the user in a number-guessing game.</p><p>There could be many other situations where a <em>value</em> needs to be used multiple times while remaining unmodifiable. Why do we still call these values <em>variables</em> if technically they are constants?</p><p>I&#39;m suggesting we introduce &quot;monikers&quot; for these values, assigning them through the <code>as</code> keyword. For example:</p><figure class="highlight"><pre><code class="language-java" data-lang="java"><span></span><span class="kd">public</span> <span class="kd">class</span> <span class="nc">Main</span> <span class="o">{</span>
  <span class="kd">public</span> <span class="kd">static</span> <span class="kt">void</span> <span class="nf">main</span><span class="o">(</span><span class="n">String</span><span class="o">...</span> <span class="n">args</span><span class="o">)</span> <span class="o">{</span>
    <span class="k">new</span> <span class="n">Farewell</span><span class="o">(</span>
      <span class="k">new</span> <span class="n">Attempts</span><span class="o">(</span>
        <span class="k">new</span> <span class="n">VerboseDiff</span><span class="o">(</span>
          <span class="k">new</span> <span class="n">Diff</span><span class="o">(</span>
            <span class="k">new</span> <span class="n">Secret</span><span class="o">()</span> <span class="n">as</span> <span class="n">secret</span><span class="o">,</span>
            <span class="k">new</span> <span class="n">Guess</span><span class="o">()</span>
          <span class="o">)</span>
        <span class="o">),</span> <span class="mi">5</span>
      <span class="o">),</span>
      <span class="n">secret</span>
    <span class="o">).</span><span class="na">say</span><span class="o">();</span>
  <span class="o">}</span>
<span class="o">}</span></code></pre></figure><p>Here <code>new Secret()</code> is the inlined value and <code>secret</code> is its <em>moniker</em>, which we use a few lines later.</p><p>It would be great to have this feature in Java, right?</p></div></article></div><div class="wrapper"> <related-posts /></div><div class="disqus" role="complementary"><p class="disqus_hint"> Please, use <a href="https://help.disqus.com/commenting/what-html-tags-are-allowed-within-comments">syntax highlighting</a> in your comments, to make them more readable.</p><div id="disqus_thread" class="disqus-thread"> <a>&nbsp;</a></div><script> var disqus_config = function () { this.page.url = document.location.href.split('?')[0].split('#')[0].replace('https://', 'http://'); this.page.identifier = this.page.url; }; (function() { var d = document, s = d.createElement('script'); s.src = '//yegor256.disqus.com/embed.js'; s.setAttribute('data-timestamp', +new Date()); (d.head || d.body).appendChild(s); })(); </script> <noscript><div><p class="red"> JavaScript is disabled in your browser, that's why you can't see comments under this post.</p></div></noscript></div><div class="wrapper"> <footer class="footer"><p> &copy; <span itemscope="" itemprop="copyrightHolder" itemtype="http://schema.org/Person"> <span itemprop="name">Yegor Bugayenko</span> </span> 2014&ndash;<span itemprop="copyrightYear">2018</span></p></footer></div></section><div class="wrapper unprintable" style="text-align:center;margin-top:2em;"> <a href="http://www.sixnines.io/h/3ba1652f"> <img src="//www.sixnines.io/b/3ba1652f?style=flat" alt="sixnines availability badge"/> </a></div><script src="//code.jquery.com/jquery-1.9.0.min.js"></script> <script src="/js/all.js?a0e0d018c07"></script> <script>var disqus_shortname = 'yegor256';</script> <script id="dsq-count-scr" src="//yegor256.disqus.com/count.js" async="async"></script> <script> (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){ (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o), m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m) })(window,document,'script','//www.google-analytics.com/analytics.js','ga'); ga('create', 'UA-1963507-32', 'auto'); ga('send', 'pageview'); </script> <script> Cd=document;Cr="&"+Math.random();Cp="&s=1"; Cd.cookie="b=b";if(Cd.cookie)Cp+="&c=1"; Cp+="&t="+(new Date()).getTimezoneOffset(); if(self!=top)Cp+="&f=1"; </script> <script> if(navigator.javaEnabled())Cp+="&j=1"; </script> <script> if(typeof(screen)!='undefined')Cp+="&w="+screen.width+"&h="+ screen.height+"&d="+(screen.colorDepth?screen.colorDepth:screen.pixelDepth); </script> <script> Cd.write("<img src='//c.hit.ua/hit?i=95870&g=0&x=2"+Cp+Cr+ "&r="+escape(Cd.referrer)+"&u="+escape(window.location.href)+ "' border='0' wi"+"dth='1' he"+"ight='1'/>"); </script> <script type="application/ld+json"> { "@context": "http://schema.org", "@type": "Person", "name": "Yegor Bugayenko", "url": "http://www.yegor256.com", "sameAs": [ "https://www.facebook.com/yegor256", "https://instagram.com/yegor256", "https://www.linkedin.com/in/yegor256", "https://twitter.com/yegor256", "https://github.com/yegor256", "https://www.pinterest.com/yegor256/" ] } </script> </body> </html> <!DOCTYPE html> <html xmlns="http://www.w3.org/1999/xhtml" lang="en-US" xml:lang="en-US" itemscope="" itemtype="http://schema.org/WebSite"> <head> <meta charset="utf-8"/> <meta name="description" content="IoC is a very popular concept, which for most programmers looks overcomplicated or very much coupled with dependency injection containers; it&apos;s not. " /> <meta name="keywords" content="IoC, IoC OOP, dependency control, dependency injection, inversion of control" /> <meta name="viewport" content="width=device-width,minimum-scale=1,initial-scale=1"/> <meta name="google-site-verification" content="JEj_gQr2CPe2QKGw8XdMz0R7VboQIUbX3FlM-lwTq-8" /> <meta name="author" content="Yegor Bugayenko"> <meta name="article:published_time" content="2017-05-10 00:00:00 +0000"> <meta name="og:site_name" content="Yegor Bugayenko"/> <meta name="og:type" content="article" /> <meta name="og:locale" content="en_US" /> <meta name="twitter:account_id" content="4503599630178231" /> <meta name="twitter:creator" content="@yegor256"/> <meta name="twitter:site" content="@yegor256"/> <meta name="twitter:title" property="og:title" content="How Does Inversion of Control Really Work?"/> <meta name="twitter:description" property="og:description" content="IoC is a very popular concept, which for most programmers looks overcomplicated or very much coupled with dependency injection containers; it&apos;s not. "/> <meta name="twitter:url" property="og:url" content="https://www.yegor256.com/2017/05/10/inversion-of-control.html"/> <meta name="telegram:channel" content="AAAAAEJFMRzsRTRxM3ec6A"/> <link rel="search" type="application/opensearchdescription+xml" href="/opensearch.xml" title="yegor256" /> <link rel="shortcut icon" href="/favicon.ico?a0e0d018c07"/> <link rel="apple-touch-icon" href="/favicon.ico?a0e0d018c07"/> <link rel="alternate" type="application/rss+xml" title="RSS for yegor256.com" href="https://www.yegor256.com/rss.xml"/> <link rel="stylesheet" href="/css/layout.css?a0e0d018c07"/> <link rel="stylesheet" href="/css/icons.css?a0e0d018c07"/> <link rel="canonical" href="https://www.yegor256.com/2017/05/10/inversion-of-control.html" /> <link rel="amphtml" href="https://www.yegor256.com/2017/05/10/inversion-of-control.amp.html" /> <title>How Does Inversion of Control Really Work? </title> <meta name='og:image' content='https://www.yegor256.com/images/2017/05/le-conseguenze-dellamore.jpg'/><meta name='twitter:image' content='https://www.yegor256.com/images/2017/05/le-conseguenze-dellamore.jpg'/><meta name='og:image:width' content='1280'/> <meta name='twitter:image:width' content='1280'/><meta name='og:image:height' content='539'/> <meta name='twitter:image:height' content='539'/><meta name='twitter:card' content='summary_large_image'/><meta name='twitter:image:alt' content='Le conseguenze dell&#39;amore (2004) by Paolo Sorrentino'/> </head> <body><div class="wrapper"> <aside class="header-toggle unprintable" id="header-toggle" title="Show the menu" onclick="$('#header').show();$('#header-toggle').hide();">&#9776;</aside> <header class="header" id="header"><div class="face"> <a href="/about-me.html#form" class="sub" title="Click to subscribe to my monthly newsletter"><span>Subscribe</span></a> <a href="/about-me.html" style="position:relative;"> <img src="/images/face-256x256.jpg" class="photo" alt="Yegor Bugayenko"/> </a></div><nav><ul class="menu social notranslate"> <li><a href="https://twitter.com/intent/follow?screen_name=yegor256" rel="nofollow" title="Follow me on Twitter"><i class="icon icon-twitter notranslate" aria-hidden="true"></i></a></li> <li><a href="/rss.xml" rel="nofollow" title="Subscribe to my RSS feed"><i class="icon icon-rss notranslate" aria-hidden="true"></i></a></li> <li><a itemprop="sameAs" href="https://github.com/yegor256" rel="nofollow" title="My GitHub profile"><i class="icon icon-github notranslate" aria-hidden="true"></i></a></li> <li><a itemprop="sameAs" href="http://stackoverflow.com/users/187141/yegor256" rel="nofollow" title="My StackOverflow profile"><i class="icon icon-stackoverflow notranslate" aria-hidden="true"></i></a></li> <li><a itemprop="sameAs" href="https://www.facebook.com/yegor256" rel="nofollow" title="Follow me on Facebook"><i class="icon icon-facebook notranslate" aria-hidden="true"></i></a></li> <li><a itemprop="sameAs" href="https://instagram.com/yegor256" rel="nofollow" title="Follow me on Instagram"><i class="icon icon-instagram notranslate" aria-hidden="true"></i></a></li> <li><a itemprop="sameAs" href="https://www.linkedin.com/in/yegor256" rel="nofollow" title="My LinkedIn profile"><i class="icon icon-linkedin notranslate" aria-hidden="true"></i></a></li> <li><a itemprop="sameAs" href="https://www.youtube.com/c/yegor256?sub_confirmation=1" rel="nofollow" title="My Youtube video channel"><i class="icon icon-youtube notranslate" aria-hidden="true"></i></a></li> <li><a itemprop="sameAs" href="https://www.pinterest.com/yegor256/" rel="nofollow" title="My Pinterest boards"><i class="icon icon-pinterest notranslate" aria-hidden="true"></i></a></li> <li><a itemprop="sameAs" href="https://angel.co/yegor256" rel="nofollow" title="My AngelList profile"><i class="icon icon-angellist notranslate" aria-hidden="true"></i></a></li> <li><a href="https://soundcloud.com/yegor256" rel="nofollow" title="My podcast"><i class="icon icon-podcast notranslate" aria-hidden="true"></i></a></li> <li><a href="https://itunes.apple.com/us/podcast/yegor256-podcast/id1150826721" rel="nofollow" title="My iTunes podcast"><i class="icon icon-itunes notranslate" aria-hidden="true"></i></a></li> <li><a href="https://t.me/joinchat/AAAAAEJFMRzsRTRxM3ec6A" rel="nofollow" title="My Telegram public channel"><i class="icon icon-telegram notranslate" aria-hidden="true"></i></a></li> <li><a href="mailto:blog@yegor256.com" rel="nofollow" title="Email me any time"><i class="icon icon-mail notranslate" aria-hidden="true"></i></a></li></ul><ul class="menu"> <li><a href="/" title="Home page">Home</a></li> <li ><a href="/best.html" title="Best articles to read">12&#160;Best</a></li> <li ><a href="/contents.html" title="The contents of the entire blog">All&#160;288</a></li> <li ><a href="/webinars.html" title="My webinars">Webinars</a></li> <li ><a href="/talks.html" title="Future and past conference talks">Talks</a></li> <li ><a href="/books.html" title="The books I wrote">Books</a></li> <li ><a href="/papers.html" title="My academic papers and patents">Papers</a></li> <li ><a href="/pets.html" title="My loved pet projects">Pets</a></li> <li ><a href="/award.html" title="Software quality award">Award</a></li> <li ><a href="/testimonials.html" title="What some people say about me">Testimonials</a></li> <li ><a href="/shift-m.html" title="Audio podcast about project management">Shift-M</a></li> <li ><a href="/paintings.html" title="My paintings for sale">Paintings</a></li> <li><a href="http://ru.yegor256.com/" title="Немного на русском языке">По-русски</a></li></ul></nav><div class="search"> <form method="get" action="https://www.google.com/search" itemprop="potentialAction" itemscope="" itemtype="http://schema.org/SearchAction"> <meta itemprop="target" content="https://www.google.com/search?q={q}"/> <input name="sitesearch" value="yegor256.com" type="hidden"/> <input itemprop="query-input" type="text" id="search-query" class="field field-text" required="required" onfocus="$('.google').css('visibility', 'visible');" name="q" placeholder="Search..." autocomplete="off"/> <input type="image" src="/images/google-search-icon.svg" class="google" title="Search via Google" alt="Search via Google"/> </form></div><div class="hot"><ul> <li> <a href="/code-ahead.html">Code Ahead</a> was published on Amazon just a few days ago! It is my new book, a novel about programmers. It explains in details the majority of ideas that stand behind <a href="https://www.zerocracy.com">Zerocracy</a> and <a href="https://www.xdsd.org">XDSD</a>. </li> <li> At <a href="/webinars.html">Webinar #37</a> we will discuss naming problem in OOP, for objects, methods and attributes; join us on <b>September 12</b>, at 11am PST. </li></ul></div></header></div><section itemscope="" itemtype="http://schema.org/BlogPosting"><div class="wrapper"> <header><p class="printable"> <img src="https://api.qrserver.com/v1/create-qr-code/?data=https://www.yegor256.com/2017/05/10/inversion-of-control.html&amp;format=svg" style="width:125px;height:125px;" alt="QR code"/></p><p class="printable"> <code itemprop="url">https://www.yegor256.com/2017/05/10/inversion-of-control.html</code></p><h1 itemprop="name headline mainEntityOfPage">How Does Inversion of Control Really Work?</h1><ul class="subline"> <li> <time itemprop="datePublished" datetime="2017-05-10T00:00:00+00:00"> 10 May 2017 </time> </li> <li class="desktop-only" itemprop="locationCreated">Odessa, Ukraine</li> <li class="printable" itemscope="" itemprop="author" itemtype="http://schema.org/Person"> <span itemprop="name">Yegor Bugayenko</span> </li> <li class="unprintable"> <i class="icon icon-comments"></i> <a href="http://www.yegor256.com/2017/05/10/inversion-of-control.html#disqus_thread" itemprop="discussionUrl">comments</a> </li></ul><p class="unprintable"><p><a href="https://en.wikipedia.org/wiki/Inversion_of_control">IoC</a> seems to have become the cornerstone concept of many frameworks and object-oriented designs since it was described by <a href="https://martinfowler.com/bliki/InversionOfControl.html">Martin Fowler</a>, <a href="https://web.archive.org/web/20041221102842/http://www.objectmentor.com/resources/articles/dip.pdf">Robert Martin</a> and <a href="http://www.laputan.org/drc/drc.html">others</a> ten years ago. Despite its popularity IoC is misunderstood and overcomplicated all too often.</p><figure class='jb_picture'><img itemprop='image' alt='Le conseguenze dell&#39;amore (2004) by Paolo Sorrentino' src='/images/2017/05/le-conseguenze-dellamore.jpg' longdesc='#d072e2ac'/><figcaption id='d072e2ac'>Le conseguenze dell&#39;amore (2004) by Paolo Sorrentino</figcaption></figure><p>Look at this code:</p><figure class="highlight"><pre><code class="language-java" data-lang="java"><span></span><span class="n">print</span><span class="o">(</span><span class="n">book</span><span class="o">.</span><span class="na">title</span><span class="o">());</span></code></pre></figure><p>It is very straight forward: we retrieve the title from the book and simply give it to the <code>print()</code> procedure, or whatever else it might be. <em>We</em> are in charge, the <em>control</em> is in our hands.</p><p>In contrast to this, here is the <em>inversion</em>:</p><figure class="highlight"><pre><code class="language-java" data-lang="java"><span></span><span class="n">print</span><span class="o">(</span><span class="n">book</span><span class="o">);</span></code></pre></figure><p>We give the entire book to the procedure <code>print()</code> and it calls <code>title()</code> when it feels like it. That is, we <em>delegate</em> control.</p><p>This is pretty much everything you need to know about IoC.</p><aside class='quote'>The main point of IoC: we must not deal with data, but instead only with object composition.</aside><p>Does it have anything to do with <a href="https://en.wikipedia.org/wiki/Dependency_injection">dependency injection</a> containers? Well, of course, we <em>could</em> put the book into a container, inject the entire container into <code>print()</code>, let it retrieve the book from the container and then call <code>title()</code>. But that&#39;s not what IoC is really about---it&#39;s merely one of its <a href="/2014/10/03/di-containers-are-evil.html">perverted</a> usage scenarios.</p><p>The main point of IoC is exactly the same as I was proposing in my previous posts about <a href="/2016/11/21/naked-data.html">naked data</a> and <a href="/2016/12/20/can-objects-be-friends.html">object friends</a>: we must <em>not</em> deal with <em>data</em>, but instead only with <a href="https://en.wikipedia.org/wiki/Object_composition">object composition</a>. In the given example the design would be even better if we got rid of the <code>print()</code> procedure altogether and replaced it with an object:</p><figure class="highlight"><pre><code class="language-java" data-lang="java"><span></span><span class="k">new</span> <span class="n">PrintedBook</span><span class="o">(</span><span class="n">book</span><span class="o">);</span></code></pre></figure><p>That would be pure <a href="https://en.wikipedia.org/wiki/Object_composition">object composition</a>.</p><p>There is not much more to say on this subject; I hope I have cleared it up for you---it is just as simple as that.</p></p><nav class="buttons notranslate desktop-only"> <a href="http://www.facebook.com/sharer/sharer.php?u=https://www.yegor256.com/2017/05/10/inversion-of-control.html" title="Share on Facebook" class="button" rel="nofollow"> <span class="count count-facebook">0</span> <i class="icon icon-facebook notranslate" aria-hidden="true"></i> </a> <a href="https://twitter.com/share?url=https://www.yegor256.com/2017/05/10/inversion-of-control.html&amp;text=How+Does+Inversion+of+Control+Really+Work%3F" title="Share on Twitter" class="button" rel="nofollow"> <span class="count count-twitter">0</span> <i class="icon icon-twitter notranslate" aria-hidden="true"></i> </a> <a href="https://plus.google.com/share?url=https://www.yegor256.com/2017/05/10/inversion-of-control.html" title="Share on Google+" class="button" rel="nofollow"> <span class="count count-googleplus">0</span> <i class="icon icon-googleplus notranslate" aria-hidden="true"></i> </a> <a href="https://www.linkedin.com/cws/share?url=https://www.yegor256.com/2017/05/10/inversion-of-control.html" title="Share on LinkedIn" class="button" rel="nofollow"> <span class="count count-linkedin">0</span> <i class="icon icon-linkedin notranslate" aria-hidden="true"></i> </a> <a href="http://reddit.com/submit?url=https://www.yegor256.com/2017/05/10/inversion-of-control.html%3F2017-19&amp;title=How+Does+Inversion+of+Control+Really+Work%3F" title="Share on Reddit" class="button" rel="nofollow"> <span class="count count-reddit">0</span> <i class="icon icon-reddit notranslate" aria-hidden="true"></i> </a> <a href="http://news.ycombinator.com/submitlink?u=https://www.yegor256.com/2017/05/10/inversion-of-control.html%3F2017-19&amp;t=How+Does+Inversion+of+Control+Really+Work%3F" title="Share on Hacker News" class="button" rel="nofollow"> <span class="count count-hackernews">0</span> <i class="icon icon-hackernews notranslate" aria-hidden="true"></i> </a> </nav> </header> <article class="main" itemprop="articleBody"><div ><p><a href="https://en.wikipedia.org/wiki/Inversion_of_control">IoC</a> seems to have become the cornerstone concept of many frameworks and object-oriented designs since it was described by <a href="https://martinfowler.com/bliki/InversionOfControl.html">Martin Fowler</a>, <a href="https://web.archive.org/web/20041221102842/http://www.objectmentor.com/resources/articles/dip.pdf">Robert Martin</a> and <a href="http://www.laputan.org/drc/drc.html">others</a> ten years ago. Despite its popularity IoC is misunderstood and overcomplicated all too often.</p><figure class='jb_picture'><img itemprop='image' alt='Le conseguenze dell&#39;amore (2004) by Paolo Sorrentino' src='/images/2017/05/le-conseguenze-dellamore.jpg' longdesc='#d072e2ac'/><figcaption id='d072e2ac'>Le conseguenze dell&#39;amore (2004) by Paolo Sorrentino</figcaption></figure><p>Look at this code:</p><figure class="highlight"><pre><code class="language-java" data-lang="java"><span></span><span class="n">print</span><span class="o">(</span><span class="n">book</span><span class="o">.</span><span class="na">title</span><span class="o">());</span></code></pre></figure><p>It is very straight forward: we retrieve the title from the book and simply give it to the <code>print()</code> procedure, or whatever else it might be. <em>We</em> are in charge, the <em>control</em> is in our hands.</p><p>In contrast to this, here is the <em>inversion</em>:</p><figure class="highlight"><pre><code class="language-java" data-lang="java"><span></span><span class="n">print</span><span class="o">(</span><span class="n">book</span><span class="o">);</span></code></pre></figure><p>We give the entire book to the procedure <code>print()</code> and it calls <code>title()</code> when it feels like it. That is, we <em>delegate</em> control.</p><p>This is pretty much everything you need to know about IoC.</p><aside class='quote'>The main point of IoC: we must not deal with data, but instead only with object composition.</aside><p>Does it have anything to do with <a href="https://en.wikipedia.org/wiki/Dependency_injection">dependency injection</a> containers? Well, of course, we <em>could</em> put the book into a container, inject the entire container into <code>print()</code>, let it retrieve the book from the container and then call <code>title()</code>. But that&#39;s not what IoC is really about---it&#39;s merely one of its <a href="/2014/10/03/di-containers-are-evil.html">perverted</a> usage scenarios.</p><p>The main point of IoC is exactly the same as I was proposing in my previous posts about <a href="/2016/11/21/naked-data.html">naked data</a> and <a href="/2016/12/20/can-objects-be-friends.html">object friends</a>: we must <em>not</em> deal with <em>data</em>, but instead only with <a href="https://en.wikipedia.org/wiki/Object_composition">object composition</a>. In the given example the design would be even better if we got rid of the <code>print()</code> procedure altogether and replaced it with an object:</p><figure class="highlight"><pre><code class="language-java" data-lang="java"><span></span><span class="k">new</span> <span class="n">PrintedBook</span><span class="o">(</span><span class="n">book</span><span class="o">);</span></code></pre></figure><p>That would be pure <a href="https://en.wikipedia.org/wiki/Object_composition">object composition</a>.</p><p>There is not much more to say on this subject; I hope I have cleared it up for you---it is just as simple as that.</p></div></article></div><div class="wrapper"> <related-posts /></div><div class="disqus" role="complementary"><p class="disqus_hint"> Please, use <a href="https://help.disqus.com/commenting/what-html-tags-are-allowed-within-comments">syntax highlighting</a> in your comments, to make them more readable.</p><div id="disqus_thread" class="disqus-thread"> <a>&nbsp;</a></div><script> var disqus_config = function () { this.page.url = document.location.href.split('?')[0].split('#')[0].replace('https://', 'http://'); this.page.identifier = this.page.url; }; (function() { var d = document, s = d.createElement('script'); s.src = '//yegor256.disqus.com/embed.js'; s.setAttribute('data-timestamp', +new Date()); (d.head || d.body).appendChild(s); })(); </script> <noscript><div><p class="red"> JavaScript is disabled in your browser, that's why you can't see comments under this post.</p></div></noscript></div><div class="wrapper"> <footer class="footer"><p> &copy; <span itemscope="" itemprop="copyrightHolder" itemtype="http://schema.org/Person"> <span itemprop="name">Yegor Bugayenko</span> </span> 2014&ndash;<span itemprop="copyrightYear">2018</span></p></footer></div></section><div class="wrapper unprintable" style="text-align:center;margin-top:2em;"> <a href="http://www.sixnines.io/h/3ba1652f"> <img src="//www.sixnines.io/b/3ba1652f?style=flat" alt="sixnines availability badge"/> </a></div><script src="//code.jquery.com/jquery-1.9.0.min.js"></script> <script src="/js/all.js?a0e0d018c07"></script> <script>var disqus_shortname = 'yegor256';</script> <script id="dsq-count-scr" src="//yegor256.disqus.com/count.js" async="async"></script> <script> (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){ (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o), m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m) })(window,document,'script','//www.google-analytics.com/analytics.js','ga'); ga('create', 'UA-1963507-32', 'auto'); ga('send', 'pageview'); </script> <script> Cd=document;Cr="&"+Math.random();Cp="&s=1"; Cd.cookie="b=b";if(Cd.cookie)Cp+="&c=1"; Cp+="&t="+(new Date()).getTimezoneOffset(); if(self!=top)Cp+="&f=1"; </script> <script> if(navigator.javaEnabled())Cp+="&j=1"; </script> <script> if(typeof(screen)!='undefined')Cp+="&w="+screen.width+"&h="+ screen.height+"&d="+(screen.colorDepth?screen.colorDepth:screen.pixelDepth); </script> <script> Cd.write("<img src='//c.hit.ua/hit?i=95870&g=0&x=2"+Cp+Cr+ "&r="+escape(Cd.referrer)+"&u="+escape(window.location.href)+ "' border='0' wi"+"dth='1' he"+"ight='1'/>"); </script> <script type="application/ld+json"> { "@context": "http://schema.org", "@type": "Person", "name": "Yegor Bugayenko", "url": "http://www.yegor256.com", "sameAs": [ "https://www.facebook.com/yegor256", "https://instagram.com/yegor256", "https://www.linkedin.com/in/yegor256", "https://twitter.com/yegor256", "https://github.com/yegor256", "https://www.pinterest.com/yegor256/" ] } </script> </body> </html> <!DOCTYPE html> <html xmlns="http://www.w3.org/1999/xhtml" lang="en-US" xml:lang="en-US" itemscope="" itemtype="http://schema.org/WebSite"> <head> <meta charset="utf-8"/> <meta name="description" content="The very famous SOLID principles in object-oriented programming are supposed to help us design better software; in reality, they don&apos;t. " /> <meta name="keywords" content="S.O.L.I.D., SOLID in OOP, SOLID principles, SRP, principles of OOP" /> <meta name="viewport" content="width=device-width,minimum-scale=1,initial-scale=1"/> <meta name="google-site-verification" content="JEj_gQr2CPe2QKGw8XdMz0R7VboQIUbX3FlM-lwTq-8" /> <meta name="author" content="Yegor Bugayenko"> <meta name="article:published_time" content="2017-03-28 00:00:00 +0000"> <meta name="og:site_name" content="Yegor Bugayenko"/> <meta name="og:type" content="article" /> <meta name="og:locale" content="en_US" /> <meta name="twitter:account_id" content="4503599630178231" /> <meta name="twitter:creator" content="@yegor256"/> <meta name="twitter:site" content="@yegor256"/> <meta name="twitter:title" property="og:title" content="SOLID Is OOP for Dummies"/> <meta name="twitter:description" property="og:description" content="The very famous SOLID principles in object-oriented programming are supposed to help us design better software; in reality, they don&apos;t. "/> <meta name="twitter:url" property="og:url" content="https://www.yegor256.com/2017/03/28/solid.html"/> <meta name="telegram:channel" content="AAAAAEJFMRzsRTRxM3ec6A"/> <link rel="search" type="application/opensearchdescription+xml" href="/opensearch.xml" title="yegor256" /> <link rel="shortcut icon" href="/favicon.ico?a0e0d018c07"/> <link rel="apple-touch-icon" href="/favicon.ico?a0e0d018c07"/> <link rel="alternate" type="application/rss+xml" title="RSS for yegor256.com" href="https://www.yegor256.com/rss.xml"/> <link rel="stylesheet" href="/css/layout.css?a0e0d018c07"/> <link rel="stylesheet" href="/css/icons.css?a0e0d018c07"/> <link rel="canonical" href="https://www.yegor256.com/2017/03/28/solid.html" /> <link rel="amphtml" href="https://www.yegor256.com/2017/03/28/solid.amp.html" /> <title>SOLID Is OOP for Dummies </title> <meta name='og:image' content='https://www.yegor256.com/images/2017/03/dumb-and-dumber.jpg'/><meta name='twitter:image' content='https://www.yegor256.com/images/2017/03/dumb-and-dumber.jpg'/><meta name='og:image:width' content='1280'/> <meta name='twitter:image:width' content='1280'/><meta name='og:image:height' content='720'/> <meta name='twitter:image:height' content='720'/><meta name='twitter:card' content='summary_large_image'/><meta name='twitter:image:alt' content='Dumb &amp; Dumber (1994) by Peter Farrelly'/> </head> <body><div class="wrapper"> <aside class="header-toggle unprintable" id="header-toggle" title="Show the menu" onclick="$('#header').show();$('#header-toggle').hide();">&#9776;</aside> <header class="header" id="header"><div class="face"> <a href="/about-me.html#form" class="sub" title="Click to subscribe to my monthly newsletter"><span>Subscribe</span></a> <a href="/about-me.html" style="position:relative;"> <img src="/images/face-256x256.jpg" class="photo" alt="Yegor Bugayenko"/> </a></div><nav><ul class="menu social notranslate"> <li><a href="https://twitter.com/intent/follow?screen_name=yegor256" rel="nofollow" title="Follow me on Twitter"><i class="icon icon-twitter notranslate" aria-hidden="true"></i></a></li> <li><a href="/rss.xml" rel="nofollow" title="Subscribe to my RSS feed"><i class="icon icon-rss notranslate" aria-hidden="true"></i></a></li> <li><a itemprop="sameAs" href="https://github.com/yegor256" rel="nofollow" title="My GitHub profile"><i class="icon icon-github notranslate" aria-hidden="true"></i></a></li> <li><a itemprop="sameAs" href="http://stackoverflow.com/users/187141/yegor256" rel="nofollow" title="My StackOverflow profile"><i class="icon icon-stackoverflow notranslate" aria-hidden="true"></i></a></li> <li><a itemprop="sameAs" href="https://www.facebook.com/yegor256" rel="nofollow" title="Follow me on Facebook"><i class="icon icon-facebook notranslate" aria-hidden="true"></i></a></li> <li><a itemprop="sameAs" href="https://instagram.com/yegor256" rel="nofollow" title="Follow me on Instagram"><i class="icon icon-instagram notranslate" aria-hidden="true"></i></a></li> <li><a itemprop="sameAs" href="https://www.linkedin.com/in/yegor256" rel="nofollow" title="My LinkedIn profile"><i class="icon icon-linkedin notranslate" aria-hidden="true"></i></a></li> <li><a itemprop="sameAs" href="https://www.youtube.com/c/yegor256?sub_confirmation=1" rel="nofollow" title="My Youtube video channel"><i class="icon icon-youtube notranslate" aria-hidden="true"></i></a></li> <li><a itemprop="sameAs" href="https://www.pinterest.com/yegor256/" rel="nofollow" title="My Pinterest boards"><i class="icon icon-pinterest notranslate" aria-hidden="true"></i></a></li> <li><a itemprop="sameAs" href="https://angel.co/yegor256" rel="nofollow" title="My AngelList profile"><i class="icon icon-angellist notranslate" aria-hidden="true"></i></a></li> <li><a href="https://soundcloud.com/yegor256" rel="nofollow" title="My podcast"><i class="icon icon-podcast notranslate" aria-hidden="true"></i></a></li> <li><a href="https://itunes.apple.com/us/podcast/yegor256-podcast/id1150826721" rel="nofollow" title="My iTunes podcast"><i class="icon icon-itunes notranslate" aria-hidden="true"></i></a></li> <li><a href="https://t.me/joinchat/AAAAAEJFMRzsRTRxM3ec6A" rel="nofollow" title="My Telegram public channel"><i class="icon icon-telegram notranslate" aria-hidden="true"></i></a></li> <li><a href="mailto:blog@yegor256.com" rel="nofollow" title="Email me any time"><i class="icon icon-mail notranslate" aria-hidden="true"></i></a></li></ul><ul class="menu"> <li><a href="/" title="Home page">Home</a></li> <li ><a href="/best.html" title="Best articles to read">12&#160;Best</a></li> <li ><a href="/contents.html" title="The contents of the entire blog">All&#160;288</a></li> <li ><a href="/webinars.html" title="My webinars">Webinars</a></li> <li ><a href="/talks.html" title="Future and past conference talks">Talks</a></li> <li ><a href="/books.html" title="The books I wrote">Books</a></li> <li ><a href="/papers.html" title="My academic papers and patents">Papers</a></li> <li ><a href="/pets.html" title="My loved pet projects">Pets</a></li> <li ><a href="/award.html" title="Software quality award">Award</a></li> <li ><a href="/testimonials.html" title="What some people say about me">Testimonials</a></li> <li ><a href="/shift-m.html" title="Audio podcast about project management">Shift-M</a></li> <li ><a href="/paintings.html" title="My paintings for sale">Paintings</a></li> <li><a href="http://ru.yegor256.com/" title="Немного на русском языке">По-русски</a></li></ul></nav><div class="search"> <form method="get" action="https://www.google.com/search" itemprop="potentialAction" itemscope="" itemtype="http://schema.org/SearchAction"> <meta itemprop="target" content="https://www.google.com/search?q={q}"/> <input name="sitesearch" value="yegor256.com" type="hidden"/> <input itemprop="query-input" type="text" id="search-query" class="field field-text" required="required" onfocus="$('.google').css('visibility', 'visible');" name="q" placeholder="Search..." autocomplete="off"/> <input type="image" src="/images/google-search-icon.svg" class="google" title="Search via Google" alt="Search via Google"/> </form></div><div class="hot"><ul> <li> <a href="/code-ahead.html">Code Ahead</a> was published on Amazon just a few days ago! It is my new book, a novel about programmers. It explains in details the majority of ideas that stand behind <a href="https://www.zerocracy.com">Zerocracy</a> and <a href="https://www.xdsd.org">XDSD</a>. </li> <li> At <a href="/webinars.html">Webinar #37</a> we will discuss naming problem in OOP, for objects, methods and attributes; join us on <b>September 12</b>, at 11am PST. </li></ul></div></header></div><section itemscope="" itemtype="http://schema.org/BlogPosting"><div class="wrapper"> <header><p class="printable"> <img src="https://api.qrserver.com/v1/create-qr-code/?data=https://www.yegor256.com/2017/03/28/solid.html&amp;format=svg" style="width:125px;height:125px;" alt="QR code"/></p><p class="printable"> <code itemprop="url">https://www.yegor256.com/2017/03/28/solid.html</code></p><h1 itemprop="name headline mainEntityOfPage">SOLID Is OOP for Dummies</h1><ul class="subline"> <li> <time itemprop="datePublished" datetime="2017-03-28T00:00:00+00:00"> 28 March 2017 </time> </li> <li class="desktop-only" itemprop="locationCreated">Kharkiv, Ukraine</li> <li class="printable" itemscope="" itemprop="author" itemtype="http://schema.org/Person"> <span itemprop="name">Yegor Bugayenko</span> </li> <li class="unprintable"> <i class="icon icon-comments"></i> <a href="http://www.yegor256.com/2017/03/28/solid.html#disqus_thread" itemprop="discussionUrl">comments</a> </li></ul><ul class="subline"> <li>Discussed at:</li> <li><a href="https://dzone.com/articles/solid-is-oop-for-dummies">dzone</a></li></ul><p class="unprintable"><p>You definitely know the <a href="https://en.wikipedia.org/wiki/SOLID_%28object-oriented_design%29">SOLID</a> acronym. It stands for five principles of <a href="/2016/08/15/what-is-wrong-object-oriented-programming.html">object-oriented programming</a> that, if followed, are supposed to make your code both <a href="https://en.wikipedia.org/wiki/SOLID_%28object-oriented_design%29">legible and extensible</a>. They were introduced almost 30 years ago, but have they really made us better programmers in the time since? Do we really understand OOP better thanks to them? Do we write more &quot;legible and extensible&quot; code? I don&#39;t think so.</p><figure class='jb_picture'><img itemprop='image' alt='Dumb &amp; Dumber (1994) by Peter Farrelly' src='/images/2017/03/dumb-and-dumber.jpg' longdesc='#0ebdb718'/><figcaption id='0ebdb718'>Dumb &amp; Dumber (1994) by Peter Farrelly</figcaption></figure><p>Let&#39;s go one by one and see how they &quot;help.&quot;</p><h2 id="s">S</h2><p>The &quot;S&quot; refers to the <a href="/2017/12/19/srp-is-hoax.html">Single Responsibility Principle</a>, which, according to <a href="http://amzn.to/2m7LmaA">Clean Code</a> by <a href="https://en.wikipedia.org/wiki/Robert_Cecil_Martin">Robert Martin</a>, means that &quot;a class should have only one reason to change.&quot;</p><p>This statement sounds extremely vague to me, but the book explains it, stating that objects must be problem-centered and responsible for &quot;one thing.&quot; It&#39;s up to us to decide what that <em>one thing</em> is, of course.</p><p>This is what we know as &quot;<a href="https://en.wikipedia.org/wiki/Cohesion_%28computer_science%29">high cohesion</a>&quot; since <a href="https://en.wikipedia.org/wiki/Larry_Constantine">Larry Constantine</a> wrote about it in the IBM Systems Journal in 1974. Why was it necessary to create a new principle 15 years later with an ambiguous name and a very questionable definition?</p><h2 id="o">O</h2><p>This letter is about the <a href="https://en.wikipedia.org/wiki/Open/closed_principle">Open/Close Principle</a>, which was introduced by Bertrand Meyer in <a href="http://amzn.to/2lNxy44">Object Oriented Software Construction</a> in 1988. Simply put, it means that an object should not be modifiable. I can&#39;t agree more with this.</p><p>But then it says it should be <em>extendable</em>, literally through <a href="https://en.wikipedia.org/wiki/Inheritance_%28object-oriented_programming%29">implementation inheritance</a>, which is <a href="/2016/09/13/inheritance-is-procedural.html">known</a> as an anti-OOP technology. Thus, this principle is not really applicable to objects and OOP. It may work with modules and services, but not with objects.</p><h2 id="l">L</h2><p>The third letter is for the <a href="https://en.wikipedia.org/wiki/Liskov_substitution_principle">Liskov Substitution Principle</a>, which was introduced by <a href="https://en.wikipedia.org/wiki/Barbara_Liskov">Barbara Liskov</a> in 1987. This one is the most innocent part in the SOLID pentad. In simple words, it states that if your method expects a <a href="http://docs.oracle.com/javase/7/docs/api/java/util/Collection.html"><code>Collection,</code></a> an <a href="http://docs.oracle.com/javase/7/docs/api/java/util/ArrayList.html"><code>ArrayList</code></a> will work.</p><p>It is also known as <a href="https://en.wikipedia.org/wiki/Subtyping">subtyping</a> and is the foundational component of any object-oriented language. Why do we need to call it a principle and &quot;follow&quot; it? Is it at all possible to create any object-oriented software without subtyping? If this one is a principle, let&#39;s add &quot;variables&quot; and &quot;method calling&quot; here too.</p><p>Honestly, I suspect that this principle was added to SOLID mostly in order to somehow fill the gap between &quot;SO&quot; and &quot;ID.&quot;</p><h2 id="i-and-d">I and D</h2><p>I guess they both were introduced by <a href="https://en.wikipedia.org/wiki/Robert_Cecil_Martin">Robert Martin</a> while he was working at Xerox.</p><p>The <a href="https://en.wikipedia.org/wiki/Interface_segregation_principle">Interface Segregation Principle</a> states that you must not declare <code>List x</code> if you only need <code>Collection x</code> or even <code>Iterable x.</code> I can&#39;t agree more. Let&#39;s see the next one.</p><p>The <a href="https://en.wikipedia.org/wiki/Dependency_inversion_principle">Dependency Inversion Principle</a> means that instead of <code>ArrayList x,</code> you must declare <code>List x</code> and let the provider of the object decide whether it is <a href="http://docs.oracle.com/javase/7/docs/api/java/util/ArrayList.html"><code>ArrayList</code></a> or <a href="http://docs.oracle.com/javase/7/docs/api/java/util/LinkedList.html"><code>LinkedList.</code></a> This one also sounds reasonable to me.</p><p>However, how is all this different from the good old &quot;<a href="https://en.wikipedia.org/wiki/Coupling_%28computer_programming%29">loose coupling</a>&quot; introduced together with cohesion by Constantine in 1974? Do we really need to simplify and blur in order to learn better? No, not to learn better, but to <em>sell</em> better. Here goes my point.</p><h2 id="my-point-is">My point is...</h2><p>The point being these principles are nothing but an explanation of &quot;cohesion and coupling&quot; for dummies in a very primitive, ambiguous, and marketable way. Dummies will buy books, seminars, and trainings, but won&#39;t really be able to understand the logic behind them. Do they really need to? They are just <del>monkeys</del> <a href="/2014/10/26/hacker-vs-programmer-mentality.html">coders</a>, right?</p><aside class='quote'>SOLID is a money-making instrument, not an instrument to make code better.</aside><p>&quot;But an object must be responsible for one thing!&quot; is what I often hear at conferences. People learn that mantra without even knowing what cohesion is nor understanding what this &quot;one thing&quot; they are praying for really is. There is no such thing as &quot;one thing,&quot; guys! There are different levels of cohesion.</p><p>Who is guilty? Uncle Bob &amp; Co.</p><p>They are no better than <a href="/2015/10/16/ridley-scott-and-joseph-goebbels.html">Ridley Scott</a> and other Hollywood money makers who deliver primitive and easy-to-cry-at movies just to generate a profit. People are getting dumber by watching---but this is not of their concern. The same happens with magic OOP principles---programmers rely on them, thinking the truth is right there while the real truth is not understood even by the creators of this &quot;magic.&quot;</p><p>SOLID is a money-making instrument, not an instrument to make code better.</p></p><nav class="buttons notranslate desktop-only"> <a href="http://www.facebook.com/sharer/sharer.php?u=https://www.yegor256.com/2017/03/28/solid.html" title="Share on Facebook" class="button" rel="nofollow"> <span class="count count-facebook">0</span> <i class="icon icon-facebook notranslate" aria-hidden="true"></i> </a> <a href="https://twitter.com/share?url=https://www.yegor256.com/2017/03/28/solid.html&amp;text=SOLID+Is+OOP+for+Dummies" title="Share on Twitter" class="button" rel="nofollow"> <span class="count count-twitter">0</span> <i class="icon icon-twitter notranslate" aria-hidden="true"></i> </a> <a href="https://plus.google.com/share?url=https://www.yegor256.com/2017/03/28/solid.html" title="Share on Google+" class="button" rel="nofollow"> <span class="count count-googleplus">0</span> <i class="icon icon-googleplus notranslate" aria-hidden="true"></i> </a> <a href="https://www.linkedin.com/cws/share?url=https://www.yegor256.com/2017/03/28/solid.html" title="Share on LinkedIn" class="button" rel="nofollow"> <span class="count count-linkedin">0</span> <i class="icon icon-linkedin notranslate" aria-hidden="true"></i> </a> <a href="http://reddit.com/submit?url=https://www.yegor256.com/2017/03/28/solid.html%3F2017-13&amp;title=SOLID+Is+OOP+for+Dummies" title="Share on Reddit" class="button" rel="nofollow"> <span class="count count-reddit">0</span> <i class="icon icon-reddit notranslate" aria-hidden="true"></i> </a> <a href="http://news.ycombinator.com/submitlink?u=https://www.yegor256.com/2017/03/28/solid.html%3F2017-13&amp;t=SOLID+Is+OOP+for+Dummies" title="Share on Hacker News" class="button" rel="nofollow"> <span class="count count-hackernews">0</span> <i class="icon icon-hackernews notranslate" aria-hidden="true"></i> </a> </nav> </header> <article class="main" itemprop="articleBody"><div ><p>You definitely know the <a href="https://en.wikipedia.org/wiki/SOLID_%28object-oriented_design%29">SOLID</a> acronym. It stands for five principles of <a href="/2016/08/15/what-is-wrong-object-oriented-programming.html">object-oriented programming</a> that, if followed, are supposed to make your code both <a href="https://en.wikipedia.org/wiki/SOLID_%28object-oriented_design%29">legible and extensible</a>. They were introduced almost 30 years ago, but have they really made us better programmers in the time since? Do we really understand OOP better thanks to them? Do we write more &quot;legible and extensible&quot; code? I don&#39;t think so.</p><figure class='jb_picture'><img itemprop='image' alt='Dumb &amp; Dumber (1994) by Peter Farrelly' src='/images/2017/03/dumb-and-dumber.jpg' longdesc='#0ebdb718'/><figcaption id='0ebdb718'>Dumb &amp; Dumber (1994) by Peter Farrelly</figcaption></figure><p>Let&#39;s go one by one and see how they &quot;help.&quot;</p><h2 id="s">S</h2><p>The &quot;S&quot; refers to the <a href="/2017/12/19/srp-is-hoax.html">Single Responsibility Principle</a>, which, according to <a href="http://amzn.to/2m7LmaA">Clean Code</a> by <a href="https://en.wikipedia.org/wiki/Robert_Cecil_Martin">Robert Martin</a>, means that &quot;a class should have only one reason to change.&quot;</p><p>This statement sounds extremely vague to me, but the book explains it, stating that objects must be problem-centered and responsible for &quot;one thing.&quot; It&#39;s up to us to decide what that <em>one thing</em> is, of course.</p><p>This is what we know as &quot;<a href="https://en.wikipedia.org/wiki/Cohesion_%28computer_science%29">high cohesion</a>&quot; since <a href="https://en.wikipedia.org/wiki/Larry_Constantine">Larry Constantine</a> wrote about it in the IBM Systems Journal in 1974. Why was it necessary to create a new principle 15 years later with an ambiguous name and a very questionable definition?</p><h2 id="o">O</h2><p>This letter is about the <a href="https://en.wikipedia.org/wiki/Open/closed_principle">Open/Close Principle</a>, which was introduced by Bertrand Meyer in <a href="http://amzn.to/2lNxy44">Object Oriented Software Construction</a> in 1988. Simply put, it means that an object should not be modifiable. I can&#39;t agree more with this.</p><p>But then it says it should be <em>extendable</em>, literally through <a href="https://en.wikipedia.org/wiki/Inheritance_%28object-oriented_programming%29">implementation inheritance</a>, which is <a href="/2016/09/13/inheritance-is-procedural.html">known</a> as an anti-OOP technology. Thus, this principle is not really applicable to objects and OOP. It may work with modules and services, but not with objects.</p><h2 id="l">L</h2><p>The third letter is for the <a href="https://en.wikipedia.org/wiki/Liskov_substitution_principle">Liskov Substitution Principle</a>, which was introduced by <a href="https://en.wikipedia.org/wiki/Barbara_Liskov">Barbara Liskov</a> in 1987. This one is the most innocent part in the SOLID pentad. In simple words, it states that if your method expects a <a href="http://docs.oracle.com/javase/7/docs/api/java/util/Collection.html"><code>Collection,</code></a> an <a href="http://docs.oracle.com/javase/7/docs/api/java/util/ArrayList.html"><code>ArrayList</code></a> will work.</p><p>It is also known as <a href="https://en.wikipedia.org/wiki/Subtyping">subtyping</a> and is the foundational component of any object-oriented language. Why do we need to call it a principle and &quot;follow&quot; it? Is it at all possible to create any object-oriented software without subtyping? If this one is a principle, let&#39;s add &quot;variables&quot; and &quot;method calling&quot; here too.</p><p>Honestly, I suspect that this principle was added to SOLID mostly in order to somehow fill the gap between &quot;SO&quot; and &quot;ID.&quot;</p><h2 id="i-and-d">I and D</h2><p>I guess they both were introduced by <a href="https://en.wikipedia.org/wiki/Robert_Cecil_Martin">Robert Martin</a> while he was working at Xerox.</p><p>The <a href="https://en.wikipedia.org/wiki/Interface_segregation_principle">Interface Segregation Principle</a> states that you must not declare <code>List x</code> if you only need <code>Collection x</code> or even <code>Iterable x.</code> I can&#39;t agree more. Let&#39;s see the next one.</p><p>The <a href="https://en.wikipedia.org/wiki/Dependency_inversion_principle">Dependency Inversion Principle</a> means that instead of <code>ArrayList x,</code> you must declare <code>List x</code> and let the provider of the object decide whether it is <a href="http://docs.oracle.com/javase/7/docs/api/java/util/ArrayList.html"><code>ArrayList</code></a> or <a href="http://docs.oracle.com/javase/7/docs/api/java/util/LinkedList.html"><code>LinkedList.</code></a> This one also sounds reasonable to me.</p><p>However, how is all this different from the good old &quot;<a href="https://en.wikipedia.org/wiki/Coupling_%28computer_programming%29">loose coupling</a>&quot; introduced together with cohesion by Constantine in 1974? Do we really need to simplify and blur in order to learn better? No, not to learn better, but to <em>sell</em> better. Here goes my point.</p><h2 id="my-point-is">My point is...</h2><p>The point being these principles are nothing but an explanation of &quot;cohesion and coupling&quot; for dummies in a very primitive, ambiguous, and marketable way. Dummies will buy books, seminars, and trainings, but won&#39;t really be able to understand the logic behind them. Do they really need to? They are just <del>monkeys</del> <a href="/2014/10/26/hacker-vs-programmer-mentality.html">coders</a>, right?</p><aside class='quote'>SOLID is a money-making instrument, not an instrument to make code better.</aside><p>&quot;But an object must be responsible for one thing!&quot; is what I often hear at conferences. People learn that mantra without even knowing what cohesion is nor understanding what this &quot;one thing&quot; they are praying for really is. There is no such thing as &quot;one thing,&quot; guys! There are different levels of cohesion.</p><p>Who is guilty? Uncle Bob &amp; Co.</p><p>They are no better than <a href="/2015/10/16/ridley-scott-and-joseph-goebbels.html">Ridley Scott</a> and other Hollywood money makers who deliver primitive and easy-to-cry-at movies just to generate a profit. People are getting dumber by watching---but this is not of their concern. The same happens with magic OOP principles---programmers rely on them, thinking the truth is right there while the real truth is not understood even by the creators of this &quot;magic.&quot;</p><p>SOLID is a money-making instrument, not an instrument to make code better.</p></div></article></div><div class="wrapper"> <related-posts /></div><div class="disqus" role="complementary"><p class="disqus_hint"> Please, use <a href="https://help.disqus.com/commenting/what-html-tags-are-allowed-within-comments">syntax highlighting</a> in your comments, to make them more readable.</p><div id="disqus_thread" class="disqus-thread"> <a>&nbsp;</a></div><script> var disqus_config = function () { this.page.url = document.location.href.split('?')[0].split('#')[0].replace('https://', 'http://'); this.page.identifier = this.page.url; }; (function() { var d = document, s = d.createElement('script'); s.src = '//yegor256.disqus.com/embed.js'; s.setAttribute('data-timestamp', +new Date()); (d.head || d.body).appendChild(s); })(); </script> <noscript><div><p class="red"> JavaScript is disabled in your browser, that's why you can't see comments under this post.</p></div></noscript></div><div class="wrapper"> <footer class="footer"><p> &copy; <span itemscope="" itemprop="copyrightHolder" itemtype="http://schema.org/Person"> <span itemprop="name">Yegor Bugayenko</span> </span> 2014&ndash;<span itemprop="copyrightYear">2018</span></p></footer></div></section><div class="wrapper unprintable" style="text-align:center;margin-top:2em;"> <a href="http://www.sixnines.io/h/3ba1652f"> <img src="//www.sixnines.io/b/3ba1652f?style=flat" alt="sixnines availability badge"/> </a></div><script src="//code.jquery.com/jquery-1.9.0.min.js"></script> <script src="/js/all.js?a0e0d018c07"></script> <script>var disqus_shortname = 'yegor256';</script> <script id="dsq-count-scr" src="//yegor256.disqus.com/count.js" async="async"></script> <script> (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){ (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o), m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m) })(window,document,'script','//www.google-analytics.com/analytics.js','ga'); ga('create', 'UA-1963507-32', 'auto'); ga('send', 'pageview'); </script> <script> Cd=document;Cr="&"+Math.random();Cp="&s=1"; Cd.cookie="b=b";if(Cd.cookie)Cp+="&c=1"; Cp+="&t="+(new Date()).getTimezoneOffset(); if(self!=top)Cp+="&f=1"; </script> <script> if(navigator.javaEnabled())Cp+="&j=1"; </script> <script> if(typeof(screen)!='undefined')Cp+="&w="+screen.width+"&h="+ screen.height+"&d="+(screen.colorDepth?screen.colorDepth:screen.pixelDepth); </script> <script> Cd.write("<img src='//c.hit.ua/hit?i=95870&g=0&x=2"+Cp+Cr+ "&r="+escape(Cd.referrer)+"&u="+escape(window.location.href)+ "' border='0' wi"+"dth='1' he"+"ight='1'/>"); </script> <script type="application/ld+json"> { "@context": "http://schema.org", "@type": "Person", "name": "Yegor Bugayenko", "url": "http://www.yegor256.com", "sameAs": [ "https://www.facebook.com/yegor256", "https://instagram.com/yegor256", "https://www.linkedin.com/in/yegor256", "https://twitter.com/yegor256", "https://github.com/yegor256", "https://www.pinterest.com/yegor256/" ] } </script> </body> </html> <!DOCTYPE html> <html xmlns="http://www.w3.org/1999/xhtml" lang="en-US" xml:lang="en-US" itemscope="" itemtype="http://schema.org/WebSite"> <head> <meta charset="utf-8"/> <meta name="description" content="Mixins and traits are becoming popular in OOP, but do they really have anything to do with proper object-oriented thinking and design? " /> <meta name="keywords" content="OOP, mixin oop, oop traits, trait in programming, traits" /> <meta name="viewport" content="width=device-width,minimum-scale=1,initial-scale=1"/> <meta name="google-site-verification" content="JEj_gQr2CPe2QKGw8XdMz0R7VboQIUbX3FlM-lwTq-8" /> <meta name="author" content="Yegor Bugayenko"> <meta name="article:published_time" content="2017-03-07 00:00:00 +0000"> <meta name="og:site_name" content="Yegor Bugayenko"/> <meta name="og:type" content="article" /> <meta name="og:locale" content="en_US" /> <meta name="twitter:account_id" content="4503599630178231" /> <meta name="twitter:creator" content="@yegor256"/> <meta name="twitter:site" content="@yegor256"/> <meta name="twitter:title" property="og:title" content="Traits and Mixins Are Not OOP"/> <meta name="twitter:description" property="og:description" content="Mixins and traits are becoming popular in OOP, but do they really have anything to do with proper object-oriented thinking and design? "/> <meta name="twitter:url" property="og:url" content="https://www.yegor256.com/2017/03/07/traits-and-mixins.html"/> <meta name="telegram:channel" content="AAAAAEJFMRzsRTRxM3ec6A"/> <link rel="search" type="application/opensearchdescription+xml" href="/opensearch.xml" title="yegor256" /> <link rel="shortcut icon" href="/favicon.ico?a0e0d018c07"/> <link rel="apple-touch-icon" href="/favicon.ico?a0e0d018c07"/> <link rel="alternate" type="application/rss+xml" title="RSS for yegor256.com" href="https://www.yegor256.com/rss.xml"/> <link rel="stylesheet" href="/css/layout.css?a0e0d018c07"/> <link rel="stylesheet" href="/css/icons.css?a0e0d018c07"/> <link rel="canonical" href="https://www.yegor256.com/2017/03/07/traits-and-mixins.html" /> <link rel="amphtml" href="https://www.yegor256.com/2017/03/07/traits-and-mixins.amp.html" /> <title>Traits and Mixins Are Not OOP </title> <meta name='og:image' content='https://www.yegor256.com/images/2014/04/fear-and-loathing-adrenochrome.png'/><meta name='twitter:image' content='https://www.yegor256.com/images/2014/04/fear-and-loathing-adrenochrome.png'/><meta name='og:image:width' content='1920'/> <meta name='twitter:image:width' content='1920'/><meta name='og:image:height' content='816'/> <meta name='twitter:image:height' content='816'/><meta name='twitter:card' content='summary_large_image'/><meta name='twitter:image:alt' content='Fear and Loathing in Las Vegas (1998) by Terry Gilliam'/> </head> <body><div class="wrapper"> <aside class="header-toggle unprintable" id="header-toggle" title="Show the menu" onclick="$('#header').show();$('#header-toggle').hide();">&#9776;</aside> <header class="header" id="header"><div class="face"> <a href="/about-me.html#form" class="sub" title="Click to subscribe to my monthly newsletter"><span>Subscribe</span></a> <a href="/about-me.html" style="position:relative;"> <img src="/images/face-256x256.jpg" class="photo" alt="Yegor Bugayenko"/> </a></div><nav><ul class="menu social notranslate"> <li><a href="https://twitter.com/intent/follow?screen_name=yegor256" rel="nofollow" title="Follow me on Twitter"><i class="icon icon-twitter notranslate" aria-hidden="true"></i></a></li> <li><a href="/rss.xml" rel="nofollow" title="Subscribe to my RSS feed"><i class="icon icon-rss notranslate" aria-hidden="true"></i></a></li> <li><a itemprop="sameAs" href="https://github.com/yegor256" rel="nofollow" title="My GitHub profile"><i class="icon icon-github notranslate" aria-hidden="true"></i></a></li> <li><a itemprop="sameAs" href="http://stackoverflow.com/users/187141/yegor256" rel="nofollow" title="My StackOverflow profile"><i class="icon icon-stackoverflow notranslate" aria-hidden="true"></i></a></li> <li><a itemprop="sameAs" href="https://www.facebook.com/yegor256" rel="nofollow" title="Follow me on Facebook"><i class="icon icon-facebook notranslate" aria-hidden="true"></i></a></li> <li><a itemprop="sameAs" href="https://instagram.com/yegor256" rel="nofollow" title="Follow me on Instagram"><i class="icon icon-instagram notranslate" aria-hidden="true"></i></a></li> <li><a itemprop="sameAs" href="https://www.linkedin.com/in/yegor256" rel="nofollow" title="My LinkedIn profile"><i class="icon icon-linkedin notranslate" aria-hidden="true"></i></a></li> <li><a itemprop="sameAs" href="https://www.youtube.com/c/yegor256?sub_confirmation=1" rel="nofollow" title="My Youtube video channel"><i class="icon icon-youtube notranslate" aria-hidden="true"></i></a></li> <li><a itemprop="sameAs" href="https://www.pinterest.com/yegor256/" rel="nofollow" title="My Pinterest boards"><i class="icon icon-pinterest notranslate" aria-hidden="true"></i></a></li> <li><a itemprop="sameAs" href="https://angel.co/yegor256" rel="nofollow" title="My AngelList profile"><i class="icon icon-angellist notranslate" aria-hidden="true"></i></a></li> <li><a href="https://soundcloud.com/yegor256" rel="nofollow" title="My podcast"><i class="icon icon-podcast notranslate" aria-hidden="true"></i></a></li> <li><a href="https://itunes.apple.com/us/podcast/yegor256-podcast/id1150826721" rel="nofollow" title="My iTunes podcast"><i class="icon icon-itunes notranslate" aria-hidden="true"></i></a></li> <li><a href="https://t.me/joinchat/AAAAAEJFMRzsRTRxM3ec6A" rel="nofollow" title="My Telegram public channel"><i class="icon icon-telegram notranslate" aria-hidden="true"></i></a></li> <li><a href="mailto:blog@yegor256.com" rel="nofollow" title="Email me any time"><i class="icon icon-mail notranslate" aria-hidden="true"></i></a></li></ul><ul class="menu"> <li><a href="/" title="Home page">Home</a></li> <li ><a href="/best.html" title="Best articles to read">12&#160;Best</a></li> <li ><a href="/contents.html" title="The contents of the entire blog">All&#160;288</a></li> <li ><a href="/webinars.html" title="My webinars">Webinars</a></li> <li ><a href="/talks.html" title="Future and past conference talks">Talks</a></li> <li ><a href="/books.html" title="The books I wrote">Books</a></li> <li ><a href="/papers.html" title="My academic papers and patents">Papers</a></li> <li ><a href="/pets.html" title="My loved pet projects">Pets</a></li> <li ><a href="/award.html" title="Software quality award">Award</a></li> <li ><a href="/testimonials.html" title="What some people say about me">Testimonials</a></li> <li ><a href="/shift-m.html" title="Audio podcast about project management">Shift-M</a></li> <li ><a href="/paintings.html" title="My paintings for sale">Paintings</a></li> <li><a href="http://ru.yegor256.com/" title="Немного на русском языке">По-русски</a></li></ul></nav><div class="search"> <form method="get" action="https://www.google.com/search" itemprop="potentialAction" itemscope="" itemtype="http://schema.org/SearchAction"> <meta itemprop="target" content="https://www.google.com/search?q={q}"/> <input name="sitesearch" value="yegor256.com" type="hidden"/> <input itemprop="query-input" type="text" id="search-query" class="field field-text" required="required" onfocus="$('.google').css('visibility', 'visible');" name="q" placeholder="Search..." autocomplete="off"/> <input type="image" src="/images/google-search-icon.svg" class="google" title="Search via Google" alt="Search via Google"/> </form></div><div class="hot"><ul> <li> <a href="/code-ahead.html">Code Ahead</a> was published on Amazon just a few days ago! It is my new book, a novel about programmers. It explains in details the majority of ideas that stand behind <a href="https://www.zerocracy.com">Zerocracy</a> and <a href="https://www.xdsd.org">XDSD</a>. </li> <li> At <a href="/webinars.html">Webinar #37</a> we will discuss naming problem in OOP, for objects, methods and attributes; join us on <b>September 12</b>, at 11am PST. </li></ul></div></header></div><section itemscope="" itemtype="http://schema.org/BlogPosting"><div class="wrapper"> <header><p class="printable"> <img src="https://api.qrserver.com/v1/create-qr-code/?data=https://www.yegor256.com/2017/03/07/traits-and-mixins.html&amp;format=svg" style="width:125px;height:125px;" alt="QR code"/></p><p class="printable"> <code itemprop="url">https://www.yegor256.com/2017/03/07/traits-and-mixins.html</code></p><h1 itemprop="name headline mainEntityOfPage">Traits and Mixins Are Not OOP</h1><ul class="subline"> <li> <time itemprop="datePublished" datetime="2017-03-07T00:00:00+00:00"> 7 March 2017 </time> </li> <li class="desktop-only" itemprop="locationCreated">Odessa, Ukraine</li> <li class="printable" itemscope="" itemprop="author" itemtype="http://schema.org/Person"> <span itemprop="name">Yegor Bugayenko</span> </li> <li class="unprintable"> <i class="icon icon-comments"></i> <a href="http://www.yegor256.com/2017/03/07/traits-and-mixins.html#disqus_thread" itemprop="discussionUrl">comments</a> </li></ul><p class="unprintable"><p>Let me say right off the bat that the features we will discuss here are pure <em>poison</em> brought to object-oriented programming by those who desperately needed a lobotomy, just like David West suggested in his <a href="http://amzn.to/2ass77O">Object Thinking</a> book. These features have different names, but the most common ones are <a href="https://en.wikipedia.org/wiki/Trait_%28computer_programming%29">traits</a> and <a href="https://en.wikipedia.org/wiki/Mixin">mixins</a>. I seriously can&#39;t understand how we can still call programming object-oriented when it has <a href="http://stackoverflow.com/questions/925609/mixins-vs-traits">these features</a>.</p><figure class='jb_picture'><img itemprop='image' alt='Fear and Loathing in Las Vegas (1998) by Terry Gilliam' src='/images/2014/04/fear-and-loathing-adrenochrome.png' longdesc='#8efe9524'/><figcaption id='8efe9524'>Fear and Loathing in Las Vegas (1998) by Terry Gilliam</figcaption></figure><p>First, here&#39;s how they work in a nutshell. Let&#39;s use <a href="http://phrogz.net/programmingruby/tut_modules.html">Ruby modules</a> as a sample implementation. Say that we have a class <code>Book</code>:</p><figure class="highlight"><pre><code class="language-ruby" data-lang="ruby"><span></span><span class="k">class</span> <span class="nc">Book</span>
  <span class="k">def</span> <span class="nf">initialize</span><span class="p">(</span><span class="n">title</span><span class="p">)</span>
    <span class="vi">@title</span> <span class="o">=</span> <span class="n">title</span>
  <span class="k">end</span>
<span class="k">end</span></code></pre></figure><p>Now, we want class <code>Book</code> to use a static method (a procedure) that does something useful. We may either define it in a <a href="/2014/05/05/oop-alternative-to-utility-classes.html">utility class</a> and let <code>Book</code> call it:</p><figure class="highlight"><pre><code class="language-ruby" data-lang="ruby"><span></span><span class="k">class</span> <span class="nc">TextUtils</span>
  <span class="k">def</span> <span class="nc">self</span><span class="o">.</span><span class="nf">caps</span><span class="p">(</span><span class="n">text</span><span class="p">)</span>
    <span class="n">text</span><span class="o">.</span><span class="n">split</span><span class="o">.</span><span class="n">map</span><span class="p">(</span><span class="o">&amp;</span><span class="ss">:capitalize</span><span class="p">)</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="s1">&#39; &#39;</span><span class="p">)</span>
  <span class="k">end</span>
<span class="k">end</span>
<span class="k">class</span> <span class="nc">Book</span>
  <span class="k">def</span> <span class="nf">print</span>
    <span class="nb">puts</span> <span class="s2">&quot;My title is </span><span class="si">#{</span><span class="no">TextUtils</span><span class="o">.</span><span class="n">caps</span><span class="p">(</span><span class="vi">@title</span><span class="p">)</span><span class="si">}</span><span class="s2">&quot;</span>
  <span class="k">end</span>
<span class="k">end</span></code></pre></figure><p>Or we may make it even more &quot;convenient&quot; and <code>extend</code> our module in order to access its methods directly:</p><figure class="highlight"><pre><code class="language-ruby" data-lang="ruby"><span></span><span class="k">module</span> <span class="nn">TextModule</span>
  <span class="k">def</span> <span class="nf">caps</span><span class="p">(</span><span class="n">text</span><span class="p">)</span>
    <span class="n">text</span><span class="o">.</span><span class="n">split</span><span class="o">.</span><span class="n">map</span><span class="p">(</span><span class="o">&amp;</span><span class="ss">:capitalize</span><span class="p">)</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="s1">&#39; &#39;</span><span class="p">)</span>
  <span class="k">end</span>
<span class="k">end</span>
<span class="k">class</span> <span class="nc">Book</span>
  <span class="kp">extend</span> <span class="no">TextModule</span>
  <span class="k">def</span> <span class="nf">print</span>
    <span class="nb">puts</span> <span class="s2">&quot;My title is </span><span class="si">#{</span><span class="n">caps</span><span class="p">(</span><span class="vi">@title</span><span class="p">)</span><span class="si">}</span><span class="s2">&quot;</span>
  <span class="k">end</span>
<span class="k">end</span></code></pre></figure><p>It seems nice---if you don&#39;t understand the <a href="/2014/05/05/oop-alternative-to-utility-classes.html">difference</a> between <a href="/2016/08/15/what-is-wrong-object-oriented-programming.html">object-oriented programming</a> and static methods. Moreover, if we forget <a href="/2014/11/20/seven-virtues-of-good-object.html">OOP purity</a> for a minute, this approach actually looks less readable to me, even though it has fewer characters; it&#39;s difficult to understand where the method <code>caps()</code> is coming from when it&#39;s called just like <code>#{caps(@title)}</code> instead of <code>#{TextUtils.caps(@title)}</code>. Don&#39;t you think?</p><p>Mixins start to play their role better when we <code>include</code> them. We can combine them to construct the behavior of the class we&#39;re looking for. Let&#39;s create two mixins. The first one will be called <code>PlainMixin</code> and will print the title of the book the way it is, and the second one will be called <code>CapsMixin</code> and will capitalize what&#39;s already printed:</p><figure class="highlight"><pre><code class="language-ruby" data-lang="ruby"><span></span><span class="k">module</span> <span class="nn">CapsMixin</span>
  <span class="k">def</span> <span class="nf">to_s</span>
    <span class="k">super</span><span class="o">.</span><span class="n">to_s</span><span class="o">.</span><span class="n">split</span><span class="o">.</span><span class="n">map</span><span class="p">(</span><span class="o">&amp;</span><span class="ss">:capitalize</span><span class="p">)</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="s1">&#39; &#39;</span><span class="p">)</span>
  <span class="k">end</span>
<span class="k">end</span>
<span class="k">module</span> <span class="nn">PlainMixin</span>
  <span class="k">def</span> <span class="nf">to_s</span>
    <span class="vi">@title</span>
  <span class="k">end</span>
<span class="k">end</span>
<span class="k">class</span> <span class="nc">Book</span>
  <span class="k">def</span> <span class="nf">initialize</span><span class="p">(</span><span class="n">title</span><span class="p">)</span>
    <span class="vi">@title</span> <span class="o">=</span> <span class="n">title</span>
  <span class="k">end</span>
  <span class="kp">include</span> <span class="no">CapsMixin</span><span class="p">,</span> <span class="no">PlainMixin</span>
  <span class="k">def</span> <span class="nf">print</span>
    <span class="nb">puts</span> <span class="s2">&quot;My title is </span><span class="si">#{</span><span class="nb">self</span><span class="si">}</span><span class="s2">&quot;</span>
  <span class="k">end</span>
<span class="k">end</span></code></pre></figure><p>Calling <code>Book</code> without the included mixin will print its title the way it is. Once we add the <code>include</code> statement, the behavior of <code>to_s</code> is overridden and method <code>print</code> produces a different result. We can combine mixins to produce the required functionality. For example, we can add one more, which will <a href="http://stackoverflow.com/a/25136035/187141">abbreviate</a> the title to 16 characters:</p><figure class="highlight"><pre><code class="language-ruby" data-lang="ruby"><span></span><span class="k">module</span> <span class="nn">AbbrMixin</span>
  <span class="k">def</span> <span class="nf">to_s</span>
    <span class="k">super</span><span class="o">.</span><span class="n">to_s</span><span class="o">.</span><span class="n">gsub</span><span class="p">(</span><span class="sr">/^(.{16,}?).*$/m</span><span class="p">,</span><span class="s1">&#39;\1...&#39;</span><span class="p">)</span>
  <span class="k">end</span>
<span class="k">end</span>
<span class="k">class</span> <span class="nc">Book</span>
  <span class="k">def</span> <span class="nf">initialize</span><span class="p">(</span><span class="n">title</span><span class="p">)</span>
    <span class="vi">@title</span> <span class="o">=</span> <span class="n">title</span>
  <span class="k">end</span>
  <span class="kp">include</span> <span class="no">AbbrMixin</span><span class="p">,</span> <span class="no">CapsMixin</span><span class="p">,</span> <span class="no">PlainMixin</span>
  <span class="k">def</span> <span class="nf">print</span>
    <span class="nb">puts</span> <span class="s2">&quot;My title is </span><span class="si">#{</span><span class="nb">self</span><span class="si">}</span><span class="s2">&quot;</span>
  <span class="k">end</span>
<span class="k">end</span></code></pre></figure><p>I&#39;m sure you already understand that they both have access to the private attribute <code>@title</code> of class <code>Book</code>. They actually have full access to <em>everything</em> in the class. They literally are &quot;pieces of code&quot; that we <em>inject</em> into the class to make it more powerful and complex. What&#39;s wrong with this approach?</p><p>It&#39;s the same issue as with <a href="/2016/04/12/java-annotations-are-evil.html">annotations</a>, <a href="/2016/07/06/data-transfer-object.html">DTOs</a>, <a href="/2014/09/16/getters-and-setters-are-evil.html">getters</a>, and <a href="/2014/05/05/oop-alternative-to-utility-classes.html">utility classes</a>---they tear objects apart and place pieces of functionality in places where objects don&#39;t see them.</p><p>In the case of mixins, the functionality is in the Ruby <code>modules</code>, which make assumptions about the internal structure of <code>Book</code> and further assume that the programmer will still understand what&#39;s in <code>Book</code> after the internal structure changes. Such assumptions completely violate the very idea of <a href="/2016/11/21/naked-data.html">encapsulation</a>.</p><p>Such a tight coupling between mixins and object private structure leads to nothing but unmaintainable and difficult to understand code.</p><p>The very obvious alternatives to mixins are <a href="/2015/02/26/composable-decorators.html">composable decorators</a>. Take a look at the example given in the <a href="/2015/02/26/composable-decorators.html">article</a>:</p><figure class="highlight"><pre><code class="language-java" data-lang="java"><span></span><span class="n">Text</span> <span class="n">text</span> <span class="o">=</span> <span class="k">new</span> <span class="n">AllCapsText</span><span class="o">(</span>
  <span class="k">new</span> <span class="n">TrimmedText</span><span class="o">(</span>
    <span class="k">new</span> <span class="n">PrintableText</span><span class="o">(</span>
      <span class="k">new</span> <span class="n">TextInFile</span><span class="o">(</span><span class="k">new</span> <span class="n">File</span><span class="o">(</span><span class="s">&quot;/tmp/a.txt&quot;</span><span class="o">))</span>
    <span class="o">)</span>
  <span class="o">)</span>
<span class="o">);</span></code></pre></figure><p>Doesn&#39;t it look very similar to what we were doing above with Ruby mixins?</p><p>However, unlike mixins, decorators leave objects small and cohesive, layering extra functionality on top of them. Mixins do the opposite---they make objects more complex and, thanks to that, less readable and maintainable.</p><p>I honestly believe they are just poison. Whoever invented them was a long ways from understanding the philosophy of object-oriented design.</p></p><nav class="buttons notranslate desktop-only"> <a href="http://www.facebook.com/sharer/sharer.php?u=https://www.yegor256.com/2017/03/07/traits-and-mixins.html" title="Share on Facebook" class="button" rel="nofollow"> <span class="count count-facebook">0</span> <i class="icon icon-facebook notranslate" aria-hidden="true"></i> </a> <a href="https://twitter.com/share?url=https://www.yegor256.com/2017/03/07/traits-and-mixins.html&amp;text=Traits+and+Mixins+Are+Not+OOP" title="Share on Twitter" class="button" rel="nofollow"> <span class="count count-twitter">0</span> <i class="icon icon-twitter notranslate" aria-hidden="true"></i> </a> <a href="https://plus.google.com/share?url=https://www.yegor256.com/2017/03/07/traits-and-mixins.html" title="Share on Google+" class="button" rel="nofollow"> <span class="count count-googleplus">0</span> <i class="icon icon-googleplus notranslate" aria-hidden="true"></i> </a> <a href="https://www.linkedin.com/cws/share?url=https://www.yegor256.com/2017/03/07/traits-and-mixins.html" title="Share on LinkedIn" class="button" rel="nofollow"> <span class="count count-linkedin">0</span> <i class="icon icon-linkedin notranslate" aria-hidden="true"></i> </a> <a href="http://reddit.com/submit?url=https://www.yegor256.com/2017/03/07/traits-and-mixins.html%3F2017-10&amp;title=Traits+and+Mixins+Are+Not+OOP" title="Share on Reddit" class="button" rel="nofollow"> <span class="count count-reddit">0</span> <i class="icon icon-reddit notranslate" aria-hidden="true"></i> </a> <a href="http://news.ycombinator.com/submitlink?u=https://www.yegor256.com/2017/03/07/traits-and-mixins.html%3F2017-10&amp;t=Traits+and+Mixins+Are+Not+OOP" title="Share on Hacker News" class="button" rel="nofollow"> <span class="count count-hackernews">0</span> <i class="icon icon-hackernews notranslate" aria-hidden="true"></i> </a> </nav> </header> <article class="main" itemprop="articleBody"><div ><p>Let me say right off the bat that the features we will discuss here are pure <em>poison</em> brought to object-oriented programming by those who desperately needed a lobotomy, just like David West suggested in his <a href="http://amzn.to/2ass77O">Object Thinking</a> book. These features have different names, but the most common ones are <a href="https://en.wikipedia.org/wiki/Trait_%28computer_programming%29">traits</a> and <a href="https://en.wikipedia.org/wiki/Mixin">mixins</a>. I seriously can&#39;t understand how we can still call programming object-oriented when it has <a href="http://stackoverflow.com/questions/925609/mixins-vs-traits">these features</a>.</p><figure class='jb_picture'><img itemprop='image' alt='Fear and Loathing in Las Vegas (1998) by Terry Gilliam' src='/images/2014/04/fear-and-loathing-adrenochrome.png' longdesc='#8efe9524'/><figcaption id='8efe9524'>Fear and Loathing in Las Vegas (1998) by Terry Gilliam</figcaption></figure><p>First, here&#39;s how they work in a nutshell. Let&#39;s use <a href="http://phrogz.net/programmingruby/tut_modules.html">Ruby modules</a> as a sample implementation. Say that we have a class <code>Book</code>:</p><figure class="highlight"><pre><code class="language-ruby" data-lang="ruby"><span></span><span class="k">class</span> <span class="nc">Book</span>
  <span class="k">def</span> <span class="nf">initialize</span><span class="p">(</span><span class="n">title</span><span class="p">)</span>
    <span class="vi">@title</span> <span class="o">=</span> <span class="n">title</span>
  <span class="k">end</span>
<span class="k">end</span></code></pre></figure><p>Now, we want class <code>Book</code> to use a static method (a procedure) that does something useful. We may either define it in a <a href="/2014/05/05/oop-alternative-to-utility-classes.html">utility class</a> and let <code>Book</code> call it:</p><figure class="highlight"><pre><code class="language-ruby" data-lang="ruby"><span></span><span class="k">class</span> <span class="nc">TextUtils</span>
  <span class="k">def</span> <span class="nc">self</span><span class="o">.</span><span class="nf">caps</span><span class="p">(</span><span class="n">text</span><span class="p">)</span>
    <span class="n">text</span><span class="o">.</span><span class="n">split</span><span class="o">.</span><span class="n">map</span><span class="p">(</span><span class="o">&amp;</span><span class="ss">:capitalize</span><span class="p">)</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="s1">&#39; &#39;</span><span class="p">)</span>
  <span class="k">end</span>
<span class="k">end</span>
<span class="k">class</span> <span class="nc">Book</span>
  <span class="k">def</span> <span class="nf">print</span>
    <span class="nb">puts</span> <span class="s2">&quot;My title is </span><span class="si">#{</span><span class="no">TextUtils</span><span class="o">.</span><span class="n">caps</span><span class="p">(</span><span class="vi">@title</span><span class="p">)</span><span class="si">}</span><span class="s2">&quot;</span>
  <span class="k">end</span>
<span class="k">end</span></code></pre></figure><p>Or we may make it even more &quot;convenient&quot; and <code>extend</code> our module in order to access its methods directly:</p><figure class="highlight"><pre><code class="language-ruby" data-lang="ruby"><span></span><span class="k">module</span> <span class="nn">TextModule</span>
  <span class="k">def</span> <span class="nf">caps</span><span class="p">(</span><span class="n">text</span><span class="p">)</span>
    <span class="n">text</span><span class="o">.</span><span class="n">split</span><span class="o">.</span><span class="n">map</span><span class="p">(</span><span class="o">&amp;</span><span class="ss">:capitalize</span><span class="p">)</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="s1">&#39; &#39;</span><span class="p">)</span>
  <span class="k">end</span>
<span class="k">end</span>
<span class="k">class</span> <span class="nc">Book</span>
  <span class="kp">extend</span> <span class="no">TextModule</span>
  <span class="k">def</span> <span class="nf">print</span>
    <span class="nb">puts</span> <span class="s2">&quot;My title is </span><span class="si">#{</span><span class="n">caps</span><span class="p">(</span><span class="vi">@title</span><span class="p">)</span><span class="si">}</span><span class="s2">&quot;</span>
  <span class="k">end</span>
<span class="k">end</span></code></pre></figure><p>It seems nice---if you don&#39;t understand the <a href="/2014/05/05/oop-alternative-to-utility-classes.html">difference</a> between <a href="/2016/08/15/what-is-wrong-object-oriented-programming.html">object-oriented programming</a> and static methods. Moreover, if we forget <a href="/2014/11/20/seven-virtues-of-good-object.html">OOP purity</a> for a minute, this approach actually looks less readable to me, even though it has fewer characters; it&#39;s difficult to understand where the method <code>caps()</code> is coming from when it&#39;s called just like <code>#{caps(@title)}</code> instead of <code>#{TextUtils.caps(@title)}</code>. Don&#39;t you think?</p><p>Mixins start to play their role better when we <code>include</code> them. We can combine them to construct the behavior of the class we&#39;re looking for. Let&#39;s create two mixins. The first one will be called <code>PlainMixin</code> and will print the title of the book the way it is, and the second one will be called <code>CapsMixin</code> and will capitalize what&#39;s already printed:</p><figure class="highlight"><pre><code class="language-ruby" data-lang="ruby"><span></span><span class="k">module</span> <span class="nn">CapsMixin</span>
  <span class="k">def</span> <span class="nf">to_s</span>
    <span class="k">super</span><span class="o">.</span><span class="n">to_s</span><span class="o">.</span><span class="n">split</span><span class="o">.</span><span class="n">map</span><span class="p">(</span><span class="o">&amp;</span><span class="ss">:capitalize</span><span class="p">)</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="s1">&#39; &#39;</span><span class="p">)</span>
  <span class="k">end</span>
<span class="k">end</span>
<span class="k">module</span> <span class="nn">PlainMixin</span>
  <span class="k">def</span> <span class="nf">to_s</span>
    <span class="vi">@title</span>
  <span class="k">end</span>
<span class="k">end</span>
<span class="k">class</span> <span class="nc">Book</span>
  <span class="k">def</span> <span class="nf">initialize</span><span class="p">(</span><span class="n">title</span><span class="p">)</span>
    <span class="vi">@title</span> <span class="o">=</span> <span class="n">title</span>
  <span class="k">end</span>
  <span class="kp">include</span> <span class="no">CapsMixin</span><span class="p">,</span> <span class="no">PlainMixin</span>
  <span class="k">def</span> <span class="nf">print</span>
    <span class="nb">puts</span> <span class="s2">&quot;My title is </span><span class="si">#{</span><span class="nb">self</span><span class="si">}</span><span class="s2">&quot;</span>
  <span class="k">end</span>
<span class="k">end</span></code></pre></figure><p>Calling <code>Book</code> without the included mixin will print its title the way it is. Once we add the <code>include</code> statement, the behavior of <code>to_s</code> is overridden and method <code>print</code> produces a different result. We can combine mixins to produce the required functionality. For example, we can add one more, which will <a href="http://stackoverflow.com/a/25136035/187141">abbreviate</a> the title to 16 characters:</p><figure class="highlight"><pre><code class="language-ruby" data-lang="ruby"><span></span><span class="k">module</span> <span class="nn">AbbrMixin</span>
  <span class="k">def</span> <span class="nf">to_s</span>
    <span class="k">super</span><span class="o">.</span><span class="n">to_s</span><span class="o">.</span><span class="n">gsub</span><span class="p">(</span><span class="sr">/^(.{16,}?).*$/m</span><span class="p">,</span><span class="s1">&#39;\1...&#39;</span><span class="p">)</span>
  <span class="k">end</span>
<span class="k">end</span>
<span class="k">class</span> <span class="nc">Book</span>
  <span class="k">def</span> <span class="nf">initialize</span><span class="p">(</span><span class="n">title</span><span class="p">)</span>
    <span class="vi">@title</span> <span class="o">=</span> <span class="n">title</span>
  <span class="k">end</span>
  <span class="kp">include</span> <span class="no">AbbrMixin</span><span class="p">,</span> <span class="no">CapsMixin</span><span class="p">,</span> <span class="no">PlainMixin</span>
  <span class="k">def</span> <span class="nf">print</span>
    <span class="nb">puts</span> <span class="s2">&quot;My title is </span><span class="si">#{</span><span class="nb">self</span><span class="si">}</span><span class="s2">&quot;</span>
  <span class="k">end</span>
<span class="k">end</span></code></pre></figure><p>I&#39;m sure you already understand that they both have access to the private attribute <code>@title</code> of class <code>Book</code>. They actually have full access to <em>everything</em> in the class. They literally are &quot;pieces of code&quot; that we <em>inject</em> into the class to make it more powerful and complex. What&#39;s wrong with this approach?</p><p>It&#39;s the same issue as with <a href="/2016/04/12/java-annotations-are-evil.html">annotations</a>, <a href="/2016/07/06/data-transfer-object.html">DTOs</a>, <a href="/2014/09/16/getters-and-setters-are-evil.html">getters</a>, and <a href="/2014/05/05/oop-alternative-to-utility-classes.html">utility classes</a>---they tear objects apart and place pieces of functionality in places where objects don&#39;t see them.</p><p>In the case of mixins, the functionality is in the Ruby <code>modules</code>, which make assumptions about the internal structure of <code>Book</code> and further assume that the programmer will still understand what&#39;s in <code>Book</code> after the internal structure changes. Such assumptions completely violate the very idea of <a href="/2016/11/21/naked-data.html">encapsulation</a>.</p><p>Such a tight coupling between mixins and object private structure leads to nothing but unmaintainable and difficult to understand code.</p><p>The very obvious alternatives to mixins are <a href="/2015/02/26/composable-decorators.html">composable decorators</a>. Take a look at the example given in the <a href="/2015/02/26/composable-decorators.html">article</a>:</p><figure class="highlight"><pre><code class="language-java" data-lang="java"><span></span><span class="n">Text</span> <span class="n">text</span> <span class="o">=</span> <span class="k">new</span> <span class="n">AllCapsText</span><span class="o">(</span>
  <span class="k">new</span> <span class="n">TrimmedText</span><span class="o">(</span>
    <span class="k">new</span> <span class="n">PrintableText</span><span class="o">(</span>
      <span class="k">new</span> <span class="n">TextInFile</span><span class="o">(</span><span class="k">new</span> <span class="n">File</span><span class="o">(</span><span class="s">&quot;/tmp/a.txt&quot;</span><span class="o">))</span>
    <span class="o">)</span>
  <span class="o">)</span>
<span class="o">);</span></code></pre></figure><p>Doesn&#39;t it look very similar to what we were doing above with Ruby mixins?</p><p>However, unlike mixins, decorators leave objects small and cohesive, layering extra functionality on top of them. Mixins do the opposite---they make objects more complex and, thanks to that, less readable and maintainable.</p><p>I honestly believe they are just poison. Whoever invented them was a long ways from understanding the philosophy of object-oriented design.</p></div></article></div><div class="wrapper"> <related-posts /></div><div class="disqus" role="complementary"><p class="disqus_hint"> Please, use <a href="https://help.disqus.com/commenting/what-html-tags-are-allowed-within-comments">syntax highlighting</a> in your comments, to make them more readable.</p><div id="disqus_thread" class="disqus-thread"> <a>&nbsp;</a></div><script> var disqus_config = function () { this.page.url = document.location.href.split('?')[0].split('#')[0].replace('https://', 'http://'); this.page.identifier = this.page.url; }; (function() { var d = document, s = d.createElement('script'); s.src = '//yegor256.disqus.com/embed.js'; s.setAttribute('data-timestamp', +new Date()); (d.head || d.body).appendChild(s); })(); </script> <noscript><div><p class="red"> JavaScript is disabled in your browser, that's why you can't see comments under this post.</p></div></noscript></div><div class="wrapper"> <footer class="footer"><p> &copy; <span itemscope="" itemprop="copyrightHolder" itemtype="http://schema.org/Person"> <span itemprop="name">Yegor Bugayenko</span> </span> 2014&ndash;<span itemprop="copyrightYear">2018</span></p></footer></div></section><div class="wrapper unprintable" style="text-align:center;margin-top:2em;"> <a href="http://www.sixnines.io/h/3ba1652f"> <img src="//www.sixnines.io/b/3ba1652f?style=flat" alt="sixnines availability badge"/> </a></div><script src="//code.jquery.com/jquery-1.9.0.min.js"></script> <script src="/js/all.js?a0e0d018c07"></script> <script>var disqus_shortname = 'yegor256';</script> <script id="dsq-count-scr" src="//yegor256.disqus.com/count.js" async="async"></script> <script> (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){ (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o), m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m) })(window,document,'script','//www.google-analytics.com/analytics.js','ga'); ga('create', 'UA-1963507-32', 'auto'); ga('send', 'pageview'); </script> <script> Cd=document;Cr="&"+Math.random();Cp="&s=1"; Cd.cookie="b=b";if(Cd.cookie)Cp+="&c=1"; Cp+="&t="+(new Date()).getTimezoneOffset(); if(self!=top)Cp+="&f=1"; </script> <script> if(navigator.javaEnabled())Cp+="&j=1"; </script> <script> if(typeof(screen)!='undefined')Cp+="&w="+screen.width+"&h="+ screen.height+"&d="+(screen.colorDepth?screen.colorDepth:screen.pixelDepth); </script> <script> Cd.write("<img src='//c.hit.ua/hit?i=95870&g=0&x=2"+Cp+Cr+ "&r="+escape(Cd.referrer)+"&u="+escape(window.location.href)+ "' border='0' wi"+"dth='1' he"+"ight='1'/>"); </script> <script type="application/ld+json"> { "@context": "http://schema.org", "@type": "Person", "name": "Yegor Bugayenko", "url": "http://www.yegor256.com", "sameAs": [ "https://www.facebook.com/yegor256", "https://instagram.com/yegor256", "https://www.linkedin.com/in/yegor256", "https://twitter.com/yegor256", "https://github.com/yegor256", "https://www.pinterest.com/yegor256/" ] } </script> </body> </html> <!DOCTYPE html> <html xmlns="http://www.w3.org/1999/xhtml" lang="en-US" xml:lang="en-US" itemscope="" itemtype="http://schema.org/WebSite"> <head> <meta charset="utf-8"/> <meta name="description" content="I often hear that having too many classes in an object-oriented design is a problem; let&apos;s investigate when this is likely to happen and how to handle it correctly. " /> <meta name="keywords" content="OOP classes, class names in OOP, many classes, naming classes in OOP, too many classes" /> <meta name="viewport" content="width=device-width,minimum-scale=1,initial-scale=1"/> <meta name="google-site-verification" content="JEj_gQr2CPe2QKGw8XdMz0R7VboQIUbX3FlM-lwTq-8" /> <meta name="author" content="Yegor Bugayenko"> <meta name="article:published_time" content="2017-02-28 00:00:00 +0000"> <meta name="og:site_name" content="Yegor Bugayenko"/> <meta name="og:type" content="article" /> <meta name="og:locale" content="en_US" /> <meta name="twitter:account_id" content="4503599630178231" /> <meta name="twitter:creator" content="@yegor256"/> <meta name="twitter:site" content="@yegor256"/> <meta name="twitter:title" property="og:title" content="How to Handle the Problem of Too Many Classes"/> <meta name="twitter:description" property="og:description" content="I often hear that having too many classes in an object-oriented design is a problem; let&apos;s investigate when this is likely to happen and how to handle it correctly. "/> <meta name="twitter:url" property="og:url" content="https://www.yegor256.com/2017/02/28/too-many-classes.html"/> <meta name="telegram:channel" content="AAAAAEJFMRzsRTRxM3ec6A"/> <link rel="search" type="application/opensearchdescription+xml" href="/opensearch.xml" title="yegor256" /> <link rel="shortcut icon" href="/favicon.ico?a0e0d018c07"/> <link rel="apple-touch-icon" href="/favicon.ico?a0e0d018c07"/> <link rel="alternate" type="application/rss+xml" title="RSS for yegor256.com" href="https://www.yegor256.com/rss.xml"/> <link rel="stylesheet" href="/css/layout.css?a0e0d018c07"/> <link rel="stylesheet" href="/css/icons.css?a0e0d018c07"/> <link rel="canonical" href="https://www.yegor256.com/2017/02/28/too-many-classes.html" /> <link rel="amphtml" href="https://www.yegor256.com/2017/02/28/too-many-classes.amp.html" /> <title>How to Handle the Problem of Too Many Classes </title> <meta name='og:image' content='https://www.yegor256.com/images/2017/02/el-dia-de-la-bestia.jpg'/><meta name='twitter:image' content='https://www.yegor256.com/images/2017/02/el-dia-de-la-bestia.jpg'/><meta name='og:image:width' content='1200'/> <meta name='twitter:image:width' content='1200'/><meta name='og:image:height' content='646'/> <meta name='twitter:image:height' content='646'/><meta name='twitter:card' content='summary_large_image'/><meta name='twitter:image:alt' content='El día de la bestia (1995) by Álex de la Iglesia'/> </head> <body><div class="wrapper"> <aside class="header-toggle unprintable" id="header-toggle" title="Show the menu" onclick="$('#header').show();$('#header-toggle').hide();">&#9776;</aside> <header class="header" id="header"><div class="face"> <a href="/about-me.html#form" class="sub" title="Click to subscribe to my monthly newsletter"><span>Subscribe</span></a> <a href="/about-me.html" style="position:relative;"> <img src="/images/face-256x256.jpg" class="photo" alt="Yegor Bugayenko"/> </a></div><nav><ul class="menu social notranslate"> <li><a href="https://twitter.com/intent/follow?screen_name=yegor256" rel="nofollow" title="Follow me on Twitter"><i class="icon icon-twitter notranslate" aria-hidden="true"></i></a></li> <li><a href="/rss.xml" rel="nofollow" title="Subscribe to my RSS feed"><i class="icon icon-rss notranslate" aria-hidden="true"></i></a></li> <li><a itemprop="sameAs" href="https://github.com/yegor256" rel="nofollow" title="My GitHub profile"><i class="icon icon-github notranslate" aria-hidden="true"></i></a></li> <li><a itemprop="sameAs" href="http://stackoverflow.com/users/187141/yegor256" rel="nofollow" title="My StackOverflow profile"><i class="icon icon-stackoverflow notranslate" aria-hidden="true"></i></a></li> <li><a itemprop="sameAs" href="https://www.facebook.com/yegor256" rel="nofollow" title="Follow me on Facebook"><i class="icon icon-facebook notranslate" aria-hidden="true"></i></a></li> <li><a itemprop="sameAs" href="https://instagram.com/yegor256" rel="nofollow" title="Follow me on Instagram"><i class="icon icon-instagram notranslate" aria-hidden="true"></i></a></li> <li><a itemprop="sameAs" href="https://www.linkedin.com/in/yegor256" rel="nofollow" title="My LinkedIn profile"><i class="icon icon-linkedin notranslate" aria-hidden="true"></i></a></li> <li><a itemprop="sameAs" href="https://www.youtube.com/c/yegor256?sub_confirmation=1" rel="nofollow" title="My Youtube video channel"><i class="icon icon-youtube notranslate" aria-hidden="true"></i></a></li> <li><a itemprop="sameAs" href="https://www.pinterest.com/yegor256/" rel="nofollow" title="My Pinterest boards"><i class="icon icon-pinterest notranslate" aria-hidden="true"></i></a></li> <li><a itemprop="sameAs" href="https://angel.co/yegor256" rel="nofollow" title="My AngelList profile"><i class="icon icon-angellist notranslate" aria-hidden="true"></i></a></li> <li><a href="https://soundcloud.com/yegor256" rel="nofollow" title="My podcast"><i class="icon icon-podcast notranslate" aria-hidden="true"></i></a></li> <li><a href="https://itunes.apple.com/us/podcast/yegor256-podcast/id1150826721" rel="nofollow" title="My iTunes podcast"><i class="icon icon-itunes notranslate" aria-hidden="true"></i></a></li> <li><a href="https://t.me/joinchat/AAAAAEJFMRzsRTRxM3ec6A" rel="nofollow" title="My Telegram public channel"><i class="icon icon-telegram notranslate" aria-hidden="true"></i></a></li> <li><a href="mailto:blog@yegor256.com" rel="nofollow" title="Email me any time"><i class="icon icon-mail notranslate" aria-hidden="true"></i></a></li></ul><ul class="menu"> <li><a href="/" title="Home page">Home</a></li> <li ><a href="/best.html" title="Best articles to read">12&#160;Best</a></li> <li ><a href="/contents.html" title="The contents of the entire blog">All&#160;288</a></li> <li ><a href="/webinars.html" title="My webinars">Webinars</a></li> <li ><a href="/talks.html" title="Future and past conference talks">Talks</a></li> <li ><a href="/books.html" title="The books I wrote">Books</a></li> <li ><a href="/papers.html" title="My academic papers and patents">Papers</a></li> <li ><a href="/pets.html" title="My loved pet projects">Pets</a></li> <li ><a href="/award.html" title="Software quality award">Award</a></li> <li ><a href="/testimonials.html" title="What some people say about me">Testimonials</a></li> <li ><a href="/shift-m.html" title="Audio podcast about project management">Shift-M</a></li> <li ><a href="/paintings.html" title="My paintings for sale">Paintings</a></li> <li><a href="http://ru.yegor256.com/" title="Немного на русском языке">По-русски</a></li></ul></nav><div class="search"> <form method="get" action="https://www.google.com/search" itemprop="potentialAction" itemscope="" itemtype="http://schema.org/SearchAction"> <meta itemprop="target" content="https://www.google.com/search?q={q}"/> <input name="sitesearch" value="yegor256.com" type="hidden"/> <input itemprop="query-input" type="text" id="search-query" class="field field-text" required="required" onfocus="$('.google').css('visibility', 'visible');" name="q" placeholder="Search..." autocomplete="off"/> <input type="image" src="/images/google-search-icon.svg" class="google" title="Search via Google" alt="Search via Google"/> </form></div><div class="hot"><ul> <li> <a href="/code-ahead.html">Code Ahead</a> was published on Amazon just a few days ago! It is my new book, a novel about programmers. It explains in details the majority of ideas that stand behind <a href="https://www.zerocracy.com">Zerocracy</a> and <a href="https://www.xdsd.org">XDSD</a>. </li> <li> At <a href="/webinars.html">Webinar #37</a> we will discuss naming problem in OOP, for objects, methods and attributes; join us on <b>September 12</b>, at 11am PST. </li></ul></div></header></div><section itemscope="" itemtype="http://schema.org/BlogPosting"><div class="wrapper"> <header><p class="printable"> <img src="https://api.qrserver.com/v1/create-qr-code/?data=https://www.yegor256.com/2017/02/28/too-many-classes.html&amp;format=svg" style="width:125px;height:125px;" alt="QR code"/></p><p class="printable"> <code itemprop="url">https://www.yegor256.com/2017/02/28/too-many-classes.html</code></p><h1 itemprop="name headline mainEntityOfPage">How to Handle the Problem of Too Many Classes</h1><ul class="subline"> <li> <time itemprop="datePublished" datetime="2017-02-28T00:00:00+00:00"> 28 February 2017 </time> </li> <li class="desktop-only" itemprop="locationCreated">Odessa, Ukraine</li> <li class="printable" itemscope="" itemprop="author" itemtype="http://schema.org/Person"> <span itemprop="name">Yegor Bugayenko</span> </li> <li class="unprintable"> <i class="icon icon-comments"></i> <a href="http://www.yegor256.com/2017/02/28/too-many-classes.html#disqus_thread" itemprop="discussionUrl">comments</a> </li></ul><p class="unprintable"><p>During nearly <a href="/talks.html">every presentation</a> in which I explain <a href="/2016/07/14/who-is-object.html">my view</a> of <a href="/2016/08/15/what-is-wrong-object-oriented-programming.html">object-oriented programming</a>, there is someone who shares a comment like this: &quot;If we follow your advice, we will have so many small classes.&quot; And my answer is always the same: &quot;Of course we will, and that&#39;s great!&quot; I honestly believe that even if you can&#39;t consider having &quot;a lot of classes&quot; a virtue, you can&#39;t call it a drawback of any truly object-oriented code either. However, there may come a point when classes become a problem; let&#39;s see when, how, and what to do about that.</p><figure class='jb_picture'><img itemprop='image' alt='El día de la bestia (1995) by Álex de la Iglesia' src='/images/2017/02/el-dia-de-la-bestia.jpg' longdesc='#746b98ae'/><figcaption id='746b98ae'>El día de la bestia (1995) by Álex de la Iglesia</figcaption></figure><p>There were a number of &quot;rules&quot; previously mentioned that, if applied, would obviously lead to a large number of classes, including: a) all public methods <a href="/2014/11/20/seven-virtues-of-good-object.html">must be</a> declared in interfaces; b) objects must not have more than four attributes (Section 2.1 of <a href="/elegant-objects.html">Elegant Objects</a>); c) static methods are <a href="/2014/05/05/oop-alternative-to-utility-classes.html">not allowed</a>; d) constructors <a href="/2015/05/07/ctors-must-be-code-free.html">must be</a> code-free; e) objects must expose fewer than five public methods (Section 3.1 of <a href="/elegant-objects.html">Elegant Objects</a>).</p><aside class='quote'>Types in OOP constitute your vocabulary, which explains the world around your code.</aside><p>The biggest concern, of course, is maintainability: &quot;If, instead of 50 longer classes, we had 300 shorter ones, then the code would be way less readable.&quot; This will most certainly happen if you design them wrong.</p><p>Types (or classes) in OOP constitute your <a href="https://en.wikipedia.org/wiki/Vocabulary"><em>vocabulary</em></a>, which explains the world around your code---the world your code lives in. The richer the vocabulary, the more powerful your code. The more types you have, the better you can understand and explain the world.</p><p>If your vocabulary is big enough, you will say something like:</p><blockquote><p>Read the book that is on the table.</p></blockquote><p>With a much smaller vocabulary, the same phrase would sound like:</p><blockquote><p>Do it with the thing that is on that thing.</p></blockquote><p>Obviously, it&#39;s easier to read and understand the first phrase. The same occurs with types in OOP: the more of them you have at your disposal, the more expressive, bright, and readable your code is.</p><p>Unfortunately, Java and many other languages are not designed with this concept in mind. Packages, modules, and namespaces don&#39;t really help, and we usually end up with names like <a href="https://docs.spring.io/spring/docs/current/javadoc-api/org/springframework/web/method/annotation/AbstractCookieValueMethodArgumentResolver.html"><code>AbstractCookieValueMethodArgumentResolver</code></a> (Spring) or <a href="https://hadoop.apache.org/docs/r3.0.0-alpha1/api/org/apache/hadoop/mapreduce/lib/input/CombineFileRecordReaderWrapper.html"><code>CombineFileRecordReaderWrapper</code></a> (Hadoop). We&#39;re trying to pack as many semantics into class names as possible so their users won&#39;t doubt for a second. Then we&#39;re trying to put as many methods into one class as possible to make life easier for users; they will use their IDE hints to find the right one.</p><p>This is anything but OOP.</p><p>If your code is object-oriented, your classes must be small, their names must be nouns, and their method names must be just one word. Here is what I do in my code to make that happen:</p><p><strong>Interfaces are nouns</strong>. For example, <a href="http://static.javadoc.io/org.takes/takes/1.1/org/takes/Request.html"><code>Request</code></a>, <a href="http://static.javadoc.io/com.jcabi.incubator/xembly/0.22/org/xembly/Directive.html"><code>Directive</code></a>, or <a href="https://github.com/yegor256/jare/blob/0.8.4/src/main/java/io/jare/model/Domain.java"><code>Domain</code></a>. There are no exceptions. Types (also known as <a href="https://docs.oracle.com/javase/tutorial/java/concepts/interface.html">interfaces</a> in Java) are the core part of my vocabulary; they have to be nouns.</p><p><strong>Classes are prefixed</strong>. My classes <a href="/2014/11/20/seven-virtues-of-good-object.html">always</a> implement interfaces. Thanks to that, I can say they always <em>are</em> requests, directives, or domains. And I always want their users to remember that. Prefixes help. For example, <a href="http://static.javadoc.io/org.takes/takes/1.1/org/takes/rq/RqBuffered.html"><code>RqBuffered</code></a> is a buffered request, <a href="http://static.javadoc.io/org.takes/takes/1.1/org/takes/rq/RqSimple.html"><code>RqSimple</code></a> is a simple request, <a href="http://static.javadoc.io/org.takes/takes/1.1/org/takes/rq/RqLive.html"><code>RqLive</code></a> is a request that represents a &quot;live&quot; HTTP connection, and <a href="http://static.javadoc.io/org.takes/takes/1.1/org/takes/rq/RqWithHeader.html"><code>RqWithHeader</code></a> is a request with an extra header.</p><p>An alternative approach is to use the type name as the central part of the class name and add a prefix that explains implementation details. For example, <a href="https://github.com/yegor256/jare/blob/0.8.4/src/main/java/io/jare/dynamo/DyDomain.java"><code>DyDomain</code></a> is a domain that persists its data in DynamoDB. Once you know what that <code>Dy</code> prefix is for, you can easily understand what <a href="https://github.com/yegor256/jare/blob/0.8.4/src/main/java/io/jare/dynamo/DyUser.java"><code>DyUser</code></a> and <a href="https://github.com/yegor256/jare/blob/0.8.4/src/main/java/io/jare/dynamo/DyBase.java"><code>DyBase</code></a> are about.</p><p>In a medium-sized application or a library, there will be as many as 10 to 15 prefixes you will have to remember, no more. For example, in the <a href="http://www.takes.org">Takes Framework</a>, there are 24,000 lines of code, 410 Java files, and 10 prefixes: <code>Bc</code>, <code>Cc</code>, <code>Tk</code>, <code>Rq</code>, <code>Rs</code>, <code>Fb</code>, <code>Fk</code>, <code>Hm</code>, <code>Ps</code>, and <code>Xe</code>. Not so difficult to remember what they mean, right?</p><p>Among all <a href="http://static.javadoc.io/org.takes/takes/1.1/allclasses-frame.html">240 classes</a>, the longest name is <a href="http://static.javadoc.io/org.takes/takes/1.1/org/takes/rq/RqWithDefaultHeader.html"><code>RqWithDefaultHeader</code></a>.</p><p>I find this approach to class naming rather convenient. I used it in these open source projects (in GitHub): <a href="https://github.com/yegor256/takes">yegor256/takes</a> (10 prefixes), <a href="https://github.com/yegor256/jare">yegor256/jare</a> (5 prefixes), <a href="https://github.com/yegor256/rultor">yegor256/rultor</a> (6 prefixes), and <a href="https://github.com/yegor256/wring">yegor256/wring</a> (5 prefixes).</p></p><nav class="buttons notranslate desktop-only"> <a href="http://www.facebook.com/sharer/sharer.php?u=https://www.yegor256.com/2017/02/28/too-many-classes.html" title="Share on Facebook" class="button" rel="nofollow"> <span class="count count-facebook">0</span> <i class="icon icon-facebook notranslate" aria-hidden="true"></i> </a> <a href="https://twitter.com/share?url=https://www.yegor256.com/2017/02/28/too-many-classes.html&amp;text=How+to+Handle+the+Problem+of+Too+Many+Classes" title="Share on Twitter" class="button" rel="nofollow"> <span class="count count-twitter">0</span> <i class="icon icon-twitter notranslate" aria-hidden="true"></i> </a> <a href="https://plus.google.com/share?url=https://www.yegor256.com/2017/02/28/too-many-classes.html" title="Share on Google+" class="button" rel="nofollow"> <span class="count count-googleplus">0</span> <i class="icon icon-googleplus notranslate" aria-hidden="true"></i> </a> <a href="https://www.linkedin.com/cws/share?url=https://www.yegor256.com/2017/02/28/too-many-classes.html" title="Share on LinkedIn" class="button" rel="nofollow"> <span class="count count-linkedin">0</span> <i class="icon icon-linkedin notranslate" aria-hidden="true"></i> </a> <a href="http://reddit.com/submit?url=https://www.yegor256.com/2017/02/28/too-many-classes.html%3F2017-09&amp;title=How+to+Handle+the+Problem+of+Too+Many+Classes" title="Share on Reddit" class="button" rel="nofollow"> <span class="count count-reddit">0</span> <i class="icon icon-reddit notranslate" aria-hidden="true"></i> </a> <a href="http://news.ycombinator.com/submitlink?u=https://www.yegor256.com/2017/02/28/too-many-classes.html%3F2017-09&amp;t=How+to+Handle+the+Problem+of+Too+Many+Classes" title="Share on Hacker News" class="button" rel="nofollow"> <span class="count count-hackernews">0</span> <i class="icon icon-hackernews notranslate" aria-hidden="true"></i> </a> </nav> </header> <article class="main" itemprop="articleBody"><div ><p>During nearly <a href="/talks.html">every presentation</a> in which I explain <a href="/2016/07/14/who-is-object.html">my view</a> of <a href="/2016/08/15/what-is-wrong-object-oriented-programming.html">object-oriented programming</a>, there is someone who shares a comment like this: &quot;If we follow your advice, we will have so many small classes.&quot; And my answer is always the same: &quot;Of course we will, and that&#39;s great!&quot; I honestly believe that even if you can&#39;t consider having &quot;a lot of classes&quot; a virtue, you can&#39;t call it a drawback of any truly object-oriented code either. However, there may come a point when classes become a problem; let&#39;s see when, how, and what to do about that.</p><figure class='jb_picture'><img itemprop='image' alt='El día de la bestia (1995) by Álex de la Iglesia' src='/images/2017/02/el-dia-de-la-bestia.jpg' longdesc='#746b98ae'/><figcaption id='746b98ae'>El día de la bestia (1995) by Álex de la Iglesia</figcaption></figure><p>There were a number of &quot;rules&quot; previously mentioned that, if applied, would obviously lead to a large number of classes, including: a) all public methods <a href="/2014/11/20/seven-virtues-of-good-object.html">must be</a> declared in interfaces; b) objects must not have more than four attributes (Section 2.1 of <a href="/elegant-objects.html">Elegant Objects</a>); c) static methods are <a href="/2014/05/05/oop-alternative-to-utility-classes.html">not allowed</a>; d) constructors <a href="/2015/05/07/ctors-must-be-code-free.html">must be</a> code-free; e) objects must expose fewer than five public methods (Section 3.1 of <a href="/elegant-objects.html">Elegant Objects</a>).</p><aside class='quote'>Types in OOP constitute your vocabulary, which explains the world around your code.</aside><p>The biggest concern, of course, is maintainability: &quot;If, instead of 50 longer classes, we had 300 shorter ones, then the code would be way less readable.&quot; This will most certainly happen if you design them wrong.</p><p>Types (or classes) in OOP constitute your <a href="https://en.wikipedia.org/wiki/Vocabulary"><em>vocabulary</em></a>, which explains the world around your code---the world your code lives in. The richer the vocabulary, the more powerful your code. The more types you have, the better you can understand and explain the world.</p><p>If your vocabulary is big enough, you will say something like:</p><blockquote><p>Read the book that is on the table.</p></blockquote><p>With a much smaller vocabulary, the same phrase would sound like:</p><blockquote><p>Do it with the thing that is on that thing.</p></blockquote><p>Obviously, it&#39;s easier to read and understand the first phrase. The same occurs with types in OOP: the more of them you have at your disposal, the more expressive, bright, and readable your code is.</p><p>Unfortunately, Java and many other languages are not designed with this concept in mind. Packages, modules, and namespaces don&#39;t really help, and we usually end up with names like <a href="https://docs.spring.io/spring/docs/current/javadoc-api/org/springframework/web/method/annotation/AbstractCookieValueMethodArgumentResolver.html"><code>AbstractCookieValueMethodArgumentResolver</code></a> (Spring) or <a href="https://hadoop.apache.org/docs/r3.0.0-alpha1/api/org/apache/hadoop/mapreduce/lib/input/CombineFileRecordReaderWrapper.html"><code>CombineFileRecordReaderWrapper</code></a> (Hadoop). We&#39;re trying to pack as many semantics into class names as possible so their users won&#39;t doubt for a second. Then we&#39;re trying to put as many methods into one class as possible to make life easier for users; they will use their IDE hints to find the right one.</p><p>This is anything but OOP.</p><p>If your code is object-oriented, your classes must be small, their names must be nouns, and their method names must be just one word. Here is what I do in my code to make that happen:</p><p><strong>Interfaces are nouns</strong>. For example, <a href="http://static.javadoc.io/org.takes/takes/1.1/org/takes/Request.html"><code>Request</code></a>, <a href="http://static.javadoc.io/com.jcabi.incubator/xembly/0.22/org/xembly/Directive.html"><code>Directive</code></a>, or <a href="https://github.com/yegor256/jare/blob/0.8.4/src/main/java/io/jare/model/Domain.java"><code>Domain</code></a>. There are no exceptions. Types (also known as <a href="https://docs.oracle.com/javase/tutorial/java/concepts/interface.html">interfaces</a> in Java) are the core part of my vocabulary; they have to be nouns.</p><p><strong>Classes are prefixed</strong>. My classes <a href="/2014/11/20/seven-virtues-of-good-object.html">always</a> implement interfaces. Thanks to that, I can say they always <em>are</em> requests, directives, or domains. And I always want their users to remember that. Prefixes help. For example, <a href="http://static.javadoc.io/org.takes/takes/1.1/org/takes/rq/RqBuffered.html"><code>RqBuffered</code></a> is a buffered request, <a href="http://static.javadoc.io/org.takes/takes/1.1/org/takes/rq/RqSimple.html"><code>RqSimple</code></a> is a simple request, <a href="http://static.javadoc.io/org.takes/takes/1.1/org/takes/rq/RqLive.html"><code>RqLive</code></a> is a request that represents a &quot;live&quot; HTTP connection, and <a href="http://static.javadoc.io/org.takes/takes/1.1/org/takes/rq/RqWithHeader.html"><code>RqWithHeader</code></a> is a request with an extra header.</p><p>An alternative approach is to use the type name as the central part of the class name and add a prefix that explains implementation details. For example, <a href="https://github.com/yegor256/jare/blob/0.8.4/src/main/java/io/jare/dynamo/DyDomain.java"><code>DyDomain</code></a> is a domain that persists its data in DynamoDB. Once you know what that <code>Dy</code> prefix is for, you can easily understand what <a href="https://github.com/yegor256/jare/blob/0.8.4/src/main/java/io/jare/dynamo/DyUser.java"><code>DyUser</code></a> and <a href="https://github.com/yegor256/jare/blob/0.8.4/src/main/java/io/jare/dynamo/DyBase.java"><code>DyBase</code></a> are about.</p><p>In a medium-sized application or a library, there will be as many as 10 to 15 prefixes you will have to remember, no more. For example, in the <a href="http://www.takes.org">Takes Framework</a>, there are 24,000 lines of code, 410 Java files, and 10 prefixes: <code>Bc</code>, <code>Cc</code>, <code>Tk</code>, <code>Rq</code>, <code>Rs</code>, <code>Fb</code>, <code>Fk</code>, <code>Hm</code>, <code>Ps</code>, and <code>Xe</code>. Not so difficult to remember what they mean, right?</p><p>Among all <a href="http://static.javadoc.io/org.takes/takes/1.1/allclasses-frame.html">240 classes</a>, the longest name is <a href="http://static.javadoc.io/org.takes/takes/1.1/org/takes/rq/RqWithDefaultHeader.html"><code>RqWithDefaultHeader</code></a>.</p><p>I find this approach to class naming rather convenient. I used it in these open source projects (in GitHub): <a href="https://github.com/yegor256/takes">yegor256/takes</a> (10 prefixes), <a href="https://github.com/yegor256/jare">yegor256/jare</a> (5 prefixes), <a href="https://github.com/yegor256/rultor">yegor256/rultor</a> (6 prefixes), and <a href="https://github.com/yegor256/wring">yegor256/wring</a> (5 prefixes).</p></div></article></div><div class="wrapper"> <related-posts /></div><div class="disqus" role="complementary"><p class="disqus_hint"> Please, use <a href="https://help.disqus.com/commenting/what-html-tags-are-allowed-within-comments">syntax highlighting</a> in your comments, to make them more readable.</p><div id="disqus_thread" class="disqus-thread"> <a>&nbsp;</a></div><script> var disqus_config = function () { this.page.url = document.location.href.split('?')[0].split('#')[0].replace('https://', 'http://'); this.page.identifier = this.page.url; }; (function() { var d = document, s = d.createElement('script'); s.src = '//yegor256.disqus.com/embed.js'; s.setAttribute('data-timestamp', +new Date()); (d.head || d.body).appendChild(s); })(); </script> <noscript><div><p class="red"> JavaScript is disabled in your browser, that's why you can't see comments under this post.</p></div></noscript></div><div class="wrapper"> <footer class="footer"><p> &copy; <span itemscope="" itemprop="copyrightHolder" itemtype="http://schema.org/Person"> <span itemprop="name">Yegor Bugayenko</span> </span> 2014&ndash;<span itemprop="copyrightYear">2018</span></p></footer></div></section><div class="wrapper unprintable" style="text-align:center;margin-top:2em;"> <a href="http://www.sixnines.io/h/3ba1652f"> <img src="//www.sixnines.io/b/3ba1652f?style=flat" alt="sixnines availability badge"/> </a></div><script src="//code.jquery.com/jquery-1.9.0.min.js"></script> <script src="/js/all.js?a0e0d018c07"></script> <script>var disqus_shortname = 'yegor256';</script> <script id="dsq-count-scr" src="//yegor256.disqus.com/count.js" async="async"></script> <script> (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){ (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o), m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m) })(window,document,'script','//www.google-analytics.com/analytics.js','ga'); ga('create', 'UA-1963507-32', 'auto'); ga('send', 'pageview'); </script> <script> Cd=document;Cr="&"+Math.random();Cp="&s=1"; Cd.cookie="b=b";if(Cd.cookie)Cp+="&c=1"; Cp+="&t="+(new Date()).getTimezoneOffset(); if(self!=top)Cp+="&f=1"; </script> <script> if(navigator.javaEnabled())Cp+="&j=1"; </script> <script> if(typeof(screen)!='undefined')Cp+="&w="+screen.width+"&h="+ screen.height+"&d="+(screen.colorDepth?screen.colorDepth:screen.pixelDepth); </script> <script> Cd.write("<img src='//c.hit.ua/hit?i=95870&g=0&x=2"+Cp+Cr+ "&r="+escape(Cd.referrer)+"&u="+escape(window.location.href)+ "' border='0' wi"+"dth='1' he"+"ight='1'/>"); </script> <script type="application/ld+json"> { "@context": "http://schema.org", "@type": "Person", "name": "Yegor Bugayenko", "url": "http://www.yegor256.com", "sameAs": [ "https://www.facebook.com/yegor256", "https://instagram.com/yegor256", "https://www.linkedin.com/in/yegor256", "https://twitter.com/yegor256", "https://github.com/yegor256", "https://www.pinterest.com/yegor256/" ] } </script> </body> </html> <!DOCTYPE html> <html xmlns="http://www.w3.org/1999/xhtml" lang="en-US" xml:lang="en-US" itemscope="" itemtype="http://schema.org/WebSite"> <head> <meta charset="utf-8"/> <meta name="description" content="Private static methods are perfect instruments to avoid code duplication inside a class, but they introduce duplication between classes and are not testable. " /> <meta name="keywords" content="java private method, private method, private static, private static method, static method" /> <meta name="viewport" content="width=device-width,minimum-scale=1,initial-scale=1"/> <meta name="google-site-verification" content="JEj_gQr2CPe2QKGw8XdMz0R7VboQIUbX3FlM-lwTq-8" /> <meta name="author" content="Yegor Bugayenko"> <meta name="article:published_time" content="2017-02-07 00:00:00 +0000"> <meta name="og:site_name" content="Yegor Bugayenko"/> <meta name="og:type" content="article" /> <meta name="og:locale" content="en_US" /> <meta name="twitter:account_id" content="4503599630178231" /> <meta name="twitter:creator" content="@yegor256"/> <meta name="twitter:site" content="@yegor256"/> <meta name="twitter:title" property="og:title" content="Each Private Static Method Is a Candidate for a New Class"/> <meta name="twitter:description" property="og:description" content="Private static methods are perfect instruments to avoid code duplication inside a class, but they introduce duplication between classes and are not testable. "/> <meta name="twitter:url" property="og:url" content="https://www.yegor256.com/2017/02/07/private-method-is-new-class.html"/> <meta name="telegram:channel" content="AAAAAEJFMRzsRTRxM3ec6A"/> <link rel="search" type="application/opensearchdescription+xml" href="/opensearch.xml" title="yegor256" /> <link rel="shortcut icon" href="/favicon.ico?a0e0d018c07"/> <link rel="apple-touch-icon" href="/favicon.ico?a0e0d018c07"/> <link rel="alternate" type="application/rss+xml" title="RSS for yegor256.com" href="https://www.yegor256.com/rss.xml"/> <link rel="stylesheet" href="/css/layout.css?a0e0d018c07"/> <link rel="stylesheet" href="/css/icons.css?a0e0d018c07"/> <link rel="canonical" href="https://www.yegor256.com/2017/02/07/private-method-is-new-class.html" /> <link rel="amphtml" href="https://www.yegor256.com/2017/02/07/private-method-is-new-class.amp.html" /> <title>Each Private Static Method Is a Candidate for a New Class </title> <meta name='og:image' content='https://www.yegor256.com/images/2017/02/the-master.jpg'/><meta name='twitter:image' content='https://www.yegor256.com/images/2017/02/the-master.jpg'/><meta name='og:image:width' content='1200'/> <meta name='twitter:image:width' content='1200'/><meta name='og:image:height' content='675'/> <meta name='twitter:image:height' content='675'/><meta name='twitter:card' content='summary_large_image'/><meta name='twitter:image:alt' content='The Master (2012) by Paul Thomas Anderson'/> </head> <body><div class="wrapper"> <aside class="header-toggle unprintable" id="header-toggle" title="Show the menu" onclick="$('#header').show();$('#header-toggle').hide();">&#9776;</aside> <header class="header" id="header"><div class="face"> <a href="/about-me.html#form" class="sub" title="Click to subscribe to my monthly newsletter"><span>Subscribe</span></a> <a href="/about-me.html" style="position:relative;"> <img src="/images/face-256x256.jpg" class="photo" alt="Yegor Bugayenko"/> </a></div><nav><ul class="menu social notranslate"> <li><a href="https://twitter.com/intent/follow?screen_name=yegor256" rel="nofollow" title="Follow me on Twitter"><i class="icon icon-twitter notranslate" aria-hidden="true"></i></a></li> <li><a href="/rss.xml" rel="nofollow" title="Subscribe to my RSS feed"><i class="icon icon-rss notranslate" aria-hidden="true"></i></a></li> <li><a itemprop="sameAs" href="https://github.com/yegor256" rel="nofollow" title="My GitHub profile"><i class="icon icon-github notranslate" aria-hidden="true"></i></a></li> <li><a itemprop="sameAs" href="http://stackoverflow.com/users/187141/yegor256" rel="nofollow" title="My StackOverflow profile"><i class="icon icon-stackoverflow notranslate" aria-hidden="true"></i></a></li> <li><a itemprop="sameAs" href="https://www.facebook.com/yegor256" rel="nofollow" title="Follow me on Facebook"><i class="icon icon-facebook notranslate" aria-hidden="true"></i></a></li> <li><a itemprop="sameAs" href="https://instagram.com/yegor256" rel="nofollow" title="Follow me on Instagram"><i class="icon icon-instagram notranslate" aria-hidden="true"></i></a></li> <li><a itemprop="sameAs" href="https://www.linkedin.com/in/yegor256" rel="nofollow" title="My LinkedIn profile"><i class="icon icon-linkedin notranslate" aria-hidden="true"></i></a></li> <li><a itemprop="sameAs" href="https://www.youtube.com/c/yegor256?sub_confirmation=1" rel="nofollow" title="My Youtube video channel"><i class="icon icon-youtube notranslate" aria-hidden="true"></i></a></li> <li><a itemprop="sameAs" href="https://www.pinterest.com/yegor256/" rel="nofollow" title="My Pinterest boards"><i class="icon icon-pinterest notranslate" aria-hidden="true"></i></a></li> <li><a itemprop="sameAs" href="https://angel.co/yegor256" rel="nofollow" title="My AngelList profile"><i class="icon icon-angellist notranslate" aria-hidden="true"></i></a></li> <li><a href="https://soundcloud.com/yegor256" rel="nofollow" title="My podcast"><i class="icon icon-podcast notranslate" aria-hidden="true"></i></a></li> <li><a href="https://itunes.apple.com/us/podcast/yegor256-podcast/id1150826721" rel="nofollow" title="My iTunes podcast"><i class="icon icon-itunes notranslate" aria-hidden="true"></i></a></li> <li><a href="https://t.me/joinchat/AAAAAEJFMRzsRTRxM3ec6A" rel="nofollow" title="My Telegram public channel"><i class="icon icon-telegram notranslate" aria-hidden="true"></i></a></li> <li><a href="mailto:blog@yegor256.com" rel="nofollow" title="Email me any time"><i class="icon icon-mail notranslate" aria-hidden="true"></i></a></li></ul><ul class="menu"> <li><a href="/" title="Home page">Home</a></li> <li ><a href="/best.html" title="Best articles to read">12&#160;Best</a></li> <li ><a href="/contents.html" title="The contents of the entire blog">All&#160;288</a></li> <li ><a href="/webinars.html" title="My webinars">Webinars</a></li> <li ><a href="/talks.html" title="Future and past conference talks">Talks</a></li> <li ><a href="/books.html" title="The books I wrote">Books</a></li> <li ><a href="/papers.html" title="My academic papers and patents">Papers</a></li> <li ><a href="/pets.html" title="My loved pet projects">Pets</a></li> <li ><a href="/award.html" title="Software quality award">Award</a></li> <li ><a href="/testimonials.html" title="What some people say about me">Testimonials</a></li> <li ><a href="/shift-m.html" title="Audio podcast about project management">Shift-M</a></li> <li ><a href="/paintings.html" title="My paintings for sale">Paintings</a></li> <li><a href="http://ru.yegor256.com/" title="Немного на русском языке">По-русски</a></li></ul></nav><div class="search"> <form method="get" action="https://www.google.com/search" itemprop="potentialAction" itemscope="" itemtype="http://schema.org/SearchAction"> <meta itemprop="target" content="https://www.google.com/search?q={q}"/> <input name="sitesearch" value="yegor256.com" type="hidden"/> <input itemprop="query-input" type="text" id="search-query" class="field field-text" required="required" onfocus="$('.google').css('visibility', 'visible');" name="q" placeholder="Search..." autocomplete="off"/> <input type="image" src="/images/google-search-icon.svg" class="google" title="Search via Google" alt="Search via Google"/> </form></div><div class="hot"><ul> <li> <a href="/code-ahead.html">Code Ahead</a> was published on Amazon just a few days ago! It is my new book, a novel about programmers. It explains in details the majority of ideas that stand behind <a href="https://www.zerocracy.com">Zerocracy</a> and <a href="https://www.xdsd.org">XDSD</a>. </li> <li> At <a href="/webinars.html">Webinar #37</a> we will discuss naming problem in OOP, for objects, methods and attributes; join us on <b>September 12</b>, at 11am PST. </li></ul></div></header></div><section itemscope="" itemtype="http://schema.org/BlogPosting"><div class="wrapper"> <header><p class="printable"> <img src="https://api.qrserver.com/v1/create-qr-code/?data=https://www.yegor256.com/2017/02/07/private-method-is-new-class.html&amp;format=svg" style="width:125px;height:125px;" alt="QR code"/></p><p class="printable"> <code itemprop="url">https://www.yegor256.com/2017/02/07/private-method-is-new-class.html</code></p><h1 itemprop="name headline mainEntityOfPage">Each Private Static Method Is a Candidate for a New Class</h1><ul class="subline"> <li> <time itemprop="datePublished" datetime="2017-02-07T00:00:00+00:00"> 7 February 2017 </time> </li> <li class="desktop-only" itemprop="locationCreated">Kharkiv, Ukraine</li> <li class="printable" itemscope="" itemprop="author" itemtype="http://schema.org/Person"> <span itemprop="name">Yegor Bugayenko</span> </li> <li class="unprintable"> <i class="icon icon-comments"></i> <a href="http://www.yegor256.com/2017/02/07/private-method-is-new-class.html#disqus_thread" itemprop="discussionUrl">comments</a> </li></ul><p class="unprintable"><p>Do you have private static methods that help you break your algorithms down into smaller parts? I do. Every time I write a new method, I realize that it can be a new class instead. Of course, I don&#39;t make classes out of all of them, but that has to be the goal. Private static methods are not reusable, while classes are---that is the main difference between them, and it is crucial.</p><figure class='jb_picture'><img itemprop='image' alt='The Master (2012) by Paul Thomas Anderson' src='/images/2017/02/the-master.jpg' longdesc='#b894db33'/><figcaption id='b894db33'>The Master (2012) by Paul Thomas Anderson</figcaption></figure><p>Here is an example of a simple class:</p><figure class="highlight"><pre><code class="language-java" data-lang="java"><span></span><span class="kd">class</span> <span class="nc">Token</span> <span class="o">{</span>
  <span class="kd">private</span> <span class="n">String</span> <span class="n">key</span><span class="o">;</span>
  <span class="kd">private</span> <span class="n">String</span> <span class="n">secret</span><span class="o">;</span>
  <span class="n">String</span> <span class="nf">encoded</span><span class="o">()</span> <span class="o">{</span>
    <span class="k">return</span> <span class="s">&quot;key=&quot;</span>
      <span class="o">+</span> <span class="n">URLEncoder</span><span class="o">.</span><span class="na">encode</span><span class="o">(</span><span class="n">key</span><span class="o">,</span> <span class="s">&quot;UTF-8&quot;</span><span class="o">)</span>
      <span class="o">+</span> <span class="s">&quot;&amp;secret=&quot;</span>
      <span class="o">+</span> <span class="n">URLEncoder</span><span class="o">.</span><span class="na">encode</span><span class="o">(</span><span class="n">secret</span><span class="o">,</span> <span class="s">&quot;UTF-8&quot;</span><span class="o">);</span>
  <span class="o">}</span>
<span class="o">}</span></code></pre></figure><p>There is an obvious code duplication, right? The easiest way to resolve it is to introduce a private static method:</p><figure class="highlight"><pre><code class="language-java" data-lang="java"><span></span><span class="kd">class</span> <span class="nc">Token</span> <span class="o">{</span>
  <span class="kd">private</span> <span class="n">String</span> <span class="n">key</span><span class="o">;</span>
  <span class="kd">private</span> <span class="n">String</span> <span class="n">secret</span><span class="o">;</span>
  <span class="n">String</span> <span class="nf">encoded</span><span class="o">()</span> <span class="o">{</span>
    <span class="k">return</span> <span class="s">&quot;key=&quot;</span>
      <span class="o">+</span> <span class="n">Token</span><span class="o">.</span><span class="na">encoded</span><span class="o">(</span><span class="n">key</span><span class="o">)</span>
      <span class="o">+</span> <span class="s">&quot;&amp;secret=&quot;</span>
      <span class="o">+</span> <span class="n">Token</span><span class="o">.</span><span class="na">encoded</span><span class="o">(</span><span class="n">secret</span><span class="o">);</span>
  <span class="o">}</span>
  <span class="kd">private</span> <span class="kd">static</span> <span class="n">String</span> <span class="nf">encoded</span><span class="o">(</span><span class="n">String</span> <span class="n">text</span><span class="o">)</span> <span class="o">{</span>
    <span class="k">return</span> <span class="n">URLEncoder</span><span class="o">.</span><span class="na">encode</span><span class="o">(</span><span class="n">text</span><span class="o">,</span> <span class="s">&quot;UTF-8&quot;</span><span class="o">);</span>
  <span class="o">}</span>
<span class="o">}</span></code></pre></figure><p>Looks much better now. But what will happen if we have another class that needs the exact same functionality? We will have to copy and paste this private static method <code>encoded()</code> into it, right?</p><p>A better alternative would be to introduce a new class <code>Encoded</code> that implements the functionality we want to share:</p><figure class="highlight"><pre><code class="language-java" data-lang="java"><span></span><span class="kd">class</span> <span class="nc">Encoded</span> <span class="o">{</span>
  <span class="kd">private</span> <span class="kd">final</span> <span class="n">String</span> <span class="n">raw</span><span class="o">;</span>
  <span class="nd">@Override</span>
  <span class="kd">public</span> <span class="n">String</span> <span class="nf">toString</span><span class="o">()</span> <span class="o">{</span>
    <span class="k">return</span> <span class="n">URLEncoder</span><span class="o">.</span><span class="na">encode</span><span class="o">(</span><span class="k">this</span><span class="o">.</span><span class="na">raw</span><span class="o">,</span> <span class="s">&quot;UTF-8&quot;</span><span class="o">);</span>
  <span class="o">}</span>
<span class="o">}</span></code></pre></figure><p>And then:</p><figure class="highlight"><pre><code class="language-java" data-lang="java"><span></span><span class="kd">class</span> <span class="nc">Token</span> <span class="o">{</span>
  <span class="kd">private</span> <span class="n">String</span> <span class="n">key</span><span class="o">;</span>
  <span class="kd">private</span> <span class="n">String</span> <span class="n">secret</span><span class="o">;</span>
  <span class="n">String</span> <span class="nf">encoded</span><span class="o">()</span> <span class="o">{</span>
    <span class="k">return</span> <span class="s">&quot;key=&quot;</span>
      <span class="o">+</span> <span class="k">new</span> <span class="n">Encoded</span><span class="o">(</span><span class="n">key</span><span class="o">)</span>
      <span class="o">+</span> <span class="s">&quot;&amp;secret=&quot;</span>
      <span class="o">+</span> <span class="k">new</span> <span class="n">Encoded</span><span class="o">(</span><span class="n">secret</span><span class="o">);</span>
  <span class="o">}</span>
<span class="o">}</span></code></pre></figure><p>Now this functionality is 1) reusable, and 2) testable. We can easily use this class <code>Encoded</code> in many other places, and we can create a unit test for it. We were not able to do that with the private static method before.</p><p>See the point? The rule of thumb I&#39;ve already figured for myself is that <em>each</em> private static method is a perfect candidate for a new class. That&#39;s why we don&#39;t have them at all in <a href="http://www.eolang.org">EO</a>.</p><p>By the way, <em>public</em> static methods are a different story. They are also evil, but for <a href="/2014/05/05/oop-alternative-to-utility-classes.html">different reasons</a>.</p><p>P.S. Now I think that the reasons in this article are applicable to <em>all</em> private methods, not only static ones.</p></p><nav class="buttons notranslate desktop-only"> <a href="http://www.facebook.com/sharer/sharer.php?u=https://www.yegor256.com/2017/02/07/private-method-is-new-class.html" title="Share on Facebook" class="button" rel="nofollow"> <span class="count count-facebook">0</span> <i class="icon icon-facebook notranslate" aria-hidden="true"></i> </a> <a href="https://twitter.com/share?url=https://www.yegor256.com/2017/02/07/private-method-is-new-class.html&amp;text=Each+Private+Static+Method+Is+a+Candidate+for+a+New+Class" title="Share on Twitter" class="button" rel="nofollow"> <span class="count count-twitter">0</span> <i class="icon icon-twitter notranslate" aria-hidden="true"></i> </a> <a href="https://plus.google.com/share?url=https://www.yegor256.com/2017/02/07/private-method-is-new-class.html" title="Share on Google+" class="button" rel="nofollow"> <span class="count count-googleplus">0</span> <i class="icon icon-googleplus notranslate" aria-hidden="true"></i> </a> <a href="https://www.linkedin.com/cws/share?url=https://www.yegor256.com/2017/02/07/private-method-is-new-class.html" title="Share on LinkedIn" class="button" rel="nofollow"> <span class="count count-linkedin">0</span> <i class="icon icon-linkedin notranslate" aria-hidden="true"></i> </a> <a href="http://reddit.com/submit?url=https://www.yegor256.com/2017/02/07/private-method-is-new-class.html%3F2017-06&amp;title=Each+Private+Static+Method+Is+a+Candidate+for+a+New+Class" title="Share on Reddit" class="button" rel="nofollow"> <span class="count count-reddit">0</span> <i class="icon icon-reddit notranslate" aria-hidden="true"></i> </a> <a href="http://news.ycombinator.com/submitlink?u=https://www.yegor256.com/2017/02/07/private-method-is-new-class.html%3F2017-06&amp;t=Each+Private+Static+Method+Is+a+Candidate+for+a+New+Class" title="Share on Hacker News" class="button" rel="nofollow"> <span class="count count-hackernews">0</span> <i class="icon icon-hackernews notranslate" aria-hidden="true"></i> </a> </nav> </header> <article class="main" itemprop="articleBody"><div ><p>Do you have private static methods that help you break your algorithms down into smaller parts? I do. Every time I write a new method, I realize that it can be a new class instead. Of course, I don&#39;t make classes out of all of them, but that has to be the goal. Private static methods are not reusable, while classes are---that is the main difference between them, and it is crucial.</p><figure class='jb_picture'><img itemprop='image' alt='The Master (2012) by Paul Thomas Anderson' src='/images/2017/02/the-master.jpg' longdesc='#b894db33'/><figcaption id='b894db33'>The Master (2012) by Paul Thomas Anderson</figcaption></figure><p>Here is an example of a simple class:</p><figure class="highlight"><pre><code class="language-java" data-lang="java"><span></span><span class="kd">class</span> <span class="nc">Token</span> <span class="o">{</span>
  <span class="kd">private</span> <span class="n">String</span> <span class="n">key</span><span class="o">;</span>
  <span class="kd">private</span> <span class="n">String</span> <span class="n">secret</span><span class="o">;</span>
  <span class="n">String</span> <span class="nf">encoded</span><span class="o">()</span> <span class="o">{</span>
    <span class="k">return</span> <span class="s">&quot;key=&quot;</span>
      <span class="o">+</span> <span class="n">URLEncoder</span><span class="o">.</span><span class="na">encode</span><span class="o">(</span><span class="n">key</span><span class="o">,</span> <span class="s">&quot;UTF-8&quot;</span><span class="o">)</span>
      <span class="o">+</span> <span class="s">&quot;&amp;secret=&quot;</span>
      <span class="o">+</span> <span class="n">URLEncoder</span><span class="o">.</span><span class="na">encode</span><span class="o">(</span><span class="n">secret</span><span class="o">,</span> <span class="s">&quot;UTF-8&quot;</span><span class="o">);</span>
  <span class="o">}</span>
<span class="o">}</span></code></pre></figure><p>There is an obvious code duplication, right? The easiest way to resolve it is to introduce a private static method:</p><figure class="highlight"><pre><code class="language-java" data-lang="java"><span></span><span class="kd">class</span> <span class="nc">Token</span> <span class="o">{</span>
  <span class="kd">private</span> <span class="n">String</span> <span class="n">key</span><span class="o">;</span>
  <span class="kd">private</span> <span class="n">String</span> <span class="n">secret</span><span class="o">;</span>
  <span class="n">String</span> <span class="nf">encoded</span><span class="o">()</span> <span class="o">{</span>
    <span class="k">return</span> <span class="s">&quot;key=&quot;</span>
      <span class="o">+</span> <span class="n">Token</span><span class="o">.</span><span class="na">encoded</span><span class="o">(</span><span class="n">key</span><span class="o">)</span>
      <span class="o">+</span> <span class="s">&quot;&amp;secret=&quot;</span>
      <span class="o">+</span> <span class="n">Token</span><span class="o">.</span><span class="na">encoded</span><span class="o">(</span><span class="n">secret</span><span class="o">);</span>
  <span class="o">}</span>
  <span class="kd">private</span> <span class="kd">static</span> <span class="n">String</span> <span class="nf">encoded</span><span class="o">(</span><span class="n">String</span> <span class="n">text</span><span class="o">)</span> <span class="o">{</span>
    <span class="k">return</span> <span class="n">URLEncoder</span><span class="o">.</span><span class="na">encode</span><span class="o">(</span><span class="n">text</span><span class="o">,</span> <span class="s">&quot;UTF-8&quot;</span><span class="o">);</span>
  <span class="o">}</span>
<span class="o">}</span></code></pre></figure><p>Looks much better now. But what will happen if we have another class that needs the exact same functionality? We will have to copy and paste this private static method <code>encoded()</code> into it, right?</p><p>A better alternative would be to introduce a new class <code>Encoded</code> that implements the functionality we want to share:</p><figure class="highlight"><pre><code class="language-java" data-lang="java"><span></span><span class="kd">class</span> <span class="nc">Encoded</span> <span class="o">{</span>
  <span class="kd">private</span> <span class="kd">final</span> <span class="n">String</span> <span class="n">raw</span><span class="o">;</span>
  <span class="nd">@Override</span>
  <span class="kd">public</span> <span class="n">String</span> <span class="nf">toString</span><span class="o">()</span> <span class="o">{</span>
    <span class="k">return</span> <span class="n">URLEncoder</span><span class="o">.</span><span class="na">encode</span><span class="o">(</span><span class="k">this</span><span class="o">.</span><span class="na">raw</span><span class="o">,</span> <span class="s">&quot;UTF-8&quot;</span><span class="o">);</span>
  <span class="o">}</span>
<span class="o">}</span></code></pre></figure><p>And then:</p><figure class="highlight"><pre><code class="language-java" data-lang="java"><span></span><span class="kd">class</span> <span class="nc">Token</span> <span class="o">{</span>
  <span class="kd">private</span> <span class="n">String</span> <span class="n">key</span><span class="o">;</span>
  <span class="kd">private</span> <span class="n">String</span> <span class="n">secret</span><span class="o">;</span>
  <span class="n">String</span> <span class="nf">encoded</span><span class="o">()</span> <span class="o">{</span>
    <span class="k">return</span> <span class="s">&quot;key=&quot;</span>
      <span class="o">+</span> <span class="k">new</span> <span class="n">Encoded</span><span class="o">(</span><span class="n">key</span><span class="o">)</span>
      <span class="o">+</span> <span class="s">&quot;&amp;secret=&quot;</span>
      <span class="o">+</span> <span class="k">new</span> <span class="n">Encoded</span><span class="o">(</span><span class="n">secret</span><span class="o">);</span>
  <span class="o">}</span>
<span class="o">}</span></code></pre></figure><p>Now this functionality is 1) reusable, and 2) testable. We can easily use this class <code>Encoded</code> in many other places, and we can create a unit test for it. We were not able to do that with the private static method before.</p><p>See the point? The rule of thumb I&#39;ve already figured for myself is that <em>each</em> private static method is a perfect candidate for a new class. That&#39;s why we don&#39;t have them at all in <a href="http://www.eolang.org">EO</a>.</p><p>By the way, <em>public</em> static methods are a different story. They are also evil, but for <a href="/2014/05/05/oop-alternative-to-utility-classes.html">different reasons</a>.</p><p>P.S. Now I think that the reasons in this article are applicable to <em>all</em> private methods, not only static ones.</p></div></article></div><div class="wrapper"> <related-posts /></div><div class="disqus" role="complementary"><p class="disqus_hint"> Please, use <a href="https://help.disqus.com/commenting/what-html-tags-are-allowed-within-comments">syntax highlighting</a> in your comments, to make them more readable.</p><div id="disqus_thread" class="disqus-thread"> <a>&nbsp;</a></div><script> var disqus_config = function () { this.page.url = document.location.href.split('?')[0].split('#')[0].replace('https://', 'http://'); this.page.identifier = this.page.url; }; (function() { var d = document, s = d.createElement('script'); s.src = '//yegor256.disqus.com/embed.js'; s.setAttribute('data-timestamp', +new Date()); (d.head || d.body).appendChild(s); })(); </script> <noscript><div><p class="red"> JavaScript is disabled in your browser, that's why you can't see comments under this post.</p></div></noscript></div><div class="wrapper"> <footer class="footer"><p> &copy; <span itemscope="" itemprop="copyrightHolder" itemtype="http://schema.org/Person"> <span itemprop="name">Yegor Bugayenko</span> </span> 2014&ndash;<span itemprop="copyrightYear">2018</span></p></footer></div></section><div class="wrapper unprintable" style="text-align:center;margin-top:2em;"> <a href="http://www.sixnines.io/h/3ba1652f"> <img src="//www.sixnines.io/b/3ba1652f?style=flat" alt="sixnines availability badge"/> </a></div><script src="//code.jquery.com/jquery-1.9.0.min.js"></script> <script src="/js/all.js?a0e0d018c07"></script> <script>var disqus_shortname = 'yegor256';</script> <script id="dsq-count-scr" src="//yegor256.disqus.com/count.js" async="async"></script> <script> (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){ (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o), m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m) })(window,document,'script','//www.google-analytics.com/analytics.js','ga'); ga('create', 'UA-1963507-32', 'auto'); ga('send', 'pageview'); </script> <script> Cd=document;Cr="&"+Math.random();Cp="&s=1"; Cd.cookie="b=b";if(Cd.cookie)Cp+="&c=1"; Cp+="&t="+(new Date()).getTimezoneOffset(); if(self!=top)Cp+="&f=1"; </script> <script> if(navigator.javaEnabled())Cp+="&j=1"; </script> <script> if(typeof(screen)!='undefined')Cp+="&w="+screen.width+"&h="+ screen.height+"&d="+(screen.colorDepth?screen.colorDepth:screen.pixelDepth); </script> <script> Cd.write("<img src='//c.hit.ua/hit?i=95870&g=0&x=2"+Cp+Cr+ "&r="+escape(Cd.referrer)+"&u="+escape(window.location.href)+ "' border='0' wi"+"dth='1' he"+"ight='1'/>"); </script> <script type="application/ld+json"> { "@context": "http://schema.org", "@type": "Person", "name": "Yegor Bugayenko", "url": "http://www.yegor256.com", "sameAs": [ "https://www.facebook.com/yegor256", "https://instagram.com/yegor256", "https://www.linkedin.com/in/yegor256", "https://twitter.com/yegor256", "https://github.com/yegor256", "https://www.pinterest.com/yegor256/" ] } </script> </body> </html> <!DOCTYPE html> <html xmlns="http://www.w3.org/1999/xhtml" lang="en-US" xml:lang="en-US" itemscope="" itemtype="http://schema.org/WebSite"> <head> <meta charset="utf-8"/> <meta name="description" content="Composing a large object is a rather verbose process in Java; it would be great to have the ability to do it more succinctly. " /> <meta name="keywords" content="constructor in oop, decorators, object oriented programming, oop constructor, primary constructor oop" /> <meta name="viewport" content="width=device-width,minimum-scale=1,initial-scale=1"/> <meta name="google-site-verification" content="JEj_gQr2CPe2QKGw8XdMz0R7VboQIUbX3FlM-lwTq-8" /> <meta name="author" content="Yegor Bugayenko"> <meta name="article:published_time" content="2017-01-31 00:00:00 +0000"> <meta name="og:site_name" content="Yegor Bugayenko"/> <meta name="og:type" content="article" /> <meta name="og:locale" content="en_US" /> <meta name="twitter:account_id" content="4503599630178231" /> <meta name="twitter:creator" content="@yegor256"/> <meta name="twitter:site" content="@yegor256"/> <meta name="twitter:title" property="og:title" content="Decorating Envelopes"/> <meta name="twitter:description" property="og:description" content="Composing a large object is a rather verbose process in Java; it would be great to have the ability to do it more succinctly. "/> <meta name="twitter:url" property="og:url" content="https://www.yegor256.com/2017/01/31/decorating-envelopes.html"/> <meta name="telegram:channel" content="AAAAAEJFMRzsRTRxM3ec6A"/> <link rel="search" type="application/opensearchdescription+xml" href="/opensearch.xml" title="yegor256" /> <link rel="shortcut icon" href="/favicon.ico?a0e0d018c07"/> <link rel="apple-touch-icon" href="/favicon.ico?a0e0d018c07"/> <link rel="alternate" type="application/rss+xml" title="RSS for yegor256.com" href="https://www.yegor256.com/rss.xml"/> <link rel="stylesheet" href="/css/layout.css?a0e0d018c07"/> <link rel="stylesheet" href="/css/icons.css?a0e0d018c07"/> <link rel="canonical" href="https://www.yegor256.com/2017/01/31/decorating-envelopes.html" /> <link rel="amphtml" href="https://www.yegor256.com/2017/01/31/decorating-envelopes.amp.html" /> <title>Decorating Envelopes </title> <meta name='og:image' content='https://www.yegor256.com/images/2017/01/north-by-northwest.jpg'/><meta name='twitter:image' content='https://www.yegor256.com/images/2017/01/north-by-northwest.jpg'/><meta name='og:image:width' content='1280'/> <meta name='twitter:image:width' content='1280'/><meta name='og:image:height' content='717'/> <meta name='twitter:image:height' content='717'/><meta name='twitter:card' content='summary_large_image'/><meta name='twitter:image:alt' content='North by Northwest (1959) by Alfred Hitchcock'/> </head> <body><div class="wrapper"> <aside class="header-toggle unprintable" id="header-toggle" title="Show the menu" onclick="$('#header').show();$('#header-toggle').hide();">&#9776;</aside> <header class="header" id="header"><div class="face"> <a href="/about-me.html#form" class="sub" title="Click to subscribe to my monthly newsletter"><span>Subscribe</span></a> <a href="/about-me.html" style="position:relative;"> <img src="/images/face-256x256.jpg" class="photo" alt="Yegor Bugayenko"/> </a></div><nav><ul class="menu social notranslate"> <li><a href="https://twitter.com/intent/follow?screen_name=yegor256" rel="nofollow" title="Follow me on Twitter"><i class="icon icon-twitter notranslate" aria-hidden="true"></i></a></li> <li><a href="/rss.xml" rel="nofollow" title="Subscribe to my RSS feed"><i class="icon icon-rss notranslate" aria-hidden="true"></i></a></li> <li><a itemprop="sameAs" href="https://github.com/yegor256" rel="nofollow" title="My GitHub profile"><i class="icon icon-github notranslate" aria-hidden="true"></i></a></li> <li><a itemprop="sameAs" href="http://stackoverflow.com/users/187141/yegor256" rel="nofollow" title="My StackOverflow profile"><i class="icon icon-stackoverflow notranslate" aria-hidden="true"></i></a></li> <li><a itemprop="sameAs" href="https://www.facebook.com/yegor256" rel="nofollow" title="Follow me on Facebook"><i class="icon icon-facebook notranslate" aria-hidden="true"></i></a></li> <li><a itemprop="sameAs" href="https://instagram.com/yegor256" rel="nofollow" title="Follow me on Instagram"><i class="icon icon-instagram notranslate" aria-hidden="true"></i></a></li> <li><a itemprop="sameAs" href="https://www.linkedin.com/in/yegor256" rel="nofollow" title="My LinkedIn profile"><i class="icon icon-linkedin notranslate" aria-hidden="true"></i></a></li> <li><a itemprop="sameAs" href="https://www.youtube.com/c/yegor256?sub_confirmation=1" rel="nofollow" title="My Youtube video channel"><i class="icon icon-youtube notranslate" aria-hidden="true"></i></a></li> <li><a itemprop="sameAs" href="https://www.pinterest.com/yegor256/" rel="nofollow" title="My Pinterest boards"><i class="icon icon-pinterest notranslate" aria-hidden="true"></i></a></li> <li><a itemprop="sameAs" href="https://angel.co/yegor256" rel="nofollow" title="My AngelList profile"><i class="icon icon-angellist notranslate" aria-hidden="true"></i></a></li> <li><a href="https://soundcloud.com/yegor256" rel="nofollow" title="My podcast"><i class="icon icon-podcast notranslate" aria-hidden="true"></i></a></li> <li><a href="https://itunes.apple.com/us/podcast/yegor256-podcast/id1150826721" rel="nofollow" title="My iTunes podcast"><i class="icon icon-itunes notranslate" aria-hidden="true"></i></a></li> <li><a href="https://t.me/joinchat/AAAAAEJFMRzsRTRxM3ec6A" rel="nofollow" title="My Telegram public channel"><i class="icon icon-telegram notranslate" aria-hidden="true"></i></a></li> <li><a href="mailto:blog@yegor256.com" rel="nofollow" title="Email me any time"><i class="icon icon-mail notranslate" aria-hidden="true"></i></a></li></ul><ul class="menu"> <li><a href="/" title="Home page">Home</a></li> <li ><a href="/best.html" title="Best articles to read">12&#160;Best</a></li> <li ><a href="/contents.html" title="The contents of the entire blog">All&#160;288</a></li> <li ><a href="/webinars.html" title="My webinars">Webinars</a></li> <li ><a href="/talks.html" title="Future and past conference talks">Talks</a></li> <li ><a href="/books.html" title="The books I wrote">Books</a></li> <li ><a href="/papers.html" title="My academic papers and patents">Papers</a></li> <li ><a href="/pets.html" title="My loved pet projects">Pets</a></li> <li ><a href="/award.html" title="Software quality award">Award</a></li> <li ><a href="/testimonials.html" title="What some people say about me">Testimonials</a></li> <li ><a href="/shift-m.html" title="Audio podcast about project management">Shift-M</a></li> <li ><a href="/paintings.html" title="My paintings for sale">Paintings</a></li> <li><a href="http://ru.yegor256.com/" title="Немного на русском языке">По-русски</a></li></ul></nav><div class="search"> <form method="get" action="https://www.google.com/search" itemprop="potentialAction" itemscope="" itemtype="http://schema.org/SearchAction"> <meta itemprop="target" content="https://www.google.com/search?q={q}"/> <input name="sitesearch" value="yegor256.com" type="hidden"/> <input itemprop="query-input" type="text" id="search-query" class="field field-text" required="required" onfocus="$('.google').css('visibility', 'visible');" name="q" placeholder="Search..." autocomplete="off"/> <input type="image" src="/images/google-search-icon.svg" class="google" title="Search via Google" alt="Search via Google"/> </form></div><div class="hot"><ul> <li> <a href="/code-ahead.html">Code Ahead</a> was published on Amazon just a few days ago! It is my new book, a novel about programmers. It explains in details the majority of ideas that stand behind <a href="https://www.zerocracy.com">Zerocracy</a> and <a href="https://www.xdsd.org">XDSD</a>. </li> <li> At <a href="/webinars.html">Webinar #37</a> we will discuss naming problem in OOP, for objects, methods and attributes; join us on <b>September 12</b>, at 11am PST. </li></ul></div></header></div><section itemscope="" itemtype="http://schema.org/BlogPosting"><div class="wrapper"> <header><p class="printable"> <img src="https://api.qrserver.com/v1/create-qr-code/?data=https://www.yegor256.com/2017/01/31/decorating-envelopes.html&amp;format=svg" style="width:125px;height:125px;" alt="QR code"/></p><p class="printable"> <code itemprop="url">https://www.yegor256.com/2017/01/31/decorating-envelopes.html</code></p><h1 itemprop="name headline mainEntityOfPage">Decorating Envelopes</h1><ul class="subline"> <li> <time itemprop="datePublished" datetime="2017-01-31T00:00:00+00:00"> 31 January 2017 </time> </li> <li class="desktop-only" itemprop="locationCreated">Lviv, Ukraine</li> <li class="printable" itemscope="" itemprop="author" itemtype="http://schema.org/Person"> <span itemprop="name">Yegor Bugayenko</span> </li> <li class="unprintable"> <i class="icon icon-comments"></i> <a href="http://www.yegor256.com/2017/01/31/decorating-envelopes.html#disqus_thread" itemprop="discussionUrl">comments</a> </li></ul><p class="unprintable"><p><del>Sometimes</del> Very often I need a <a href="/2016/09/20/oop-without-classes.html">class</a> that implements an interface by making an instance of another class. Sound weird? Let me show you an example. There are many classes of that kind in the <a href="http://www.takes.org">Takes Framework</a>, and they all are named like <code>*Wrap</code>. It&#39;s a convenient design concept that, unfortunately, looks rather verbose in Java. It would be great to have something shorter, like in <a href="http://www.eolang.org">EO</a> for example.</p><figure class='jb_picture'><img itemprop='image' alt='North by Northwest (1959) by Alfred Hitchcock' src='/images/2017/01/north-by-northwest.jpg' longdesc='#1633d9e6'/><figcaption id='1633d9e6'>North by Northwest (1959) by Alfred Hitchcock</figcaption></figure><p>Take a look at <a href="https://github.com/yegor256/takes/blob/1.1/src/main/java/org/takes/rs/RsHtml.java"><code>RsHtml</code></a> from <a href="http://www.takes.org">Takes Framework</a>. Its design looks like this (a simplified version with only one primary constructor):</p><figure class="highlight"><pre><code class="language-java" data-lang="java"><span></span><span class="kd">class</span> <span class="nc">RsHtml</span> <span class="kd">extends</span> <span class="n">RsWrap</span> <span class="o">{</span>
  <span class="n">RsHtml</span><span class="o">(</span><span class="kd">final</span> <span class="n">String</span> <span class="n">text</span><span class="o">)</span> <span class="o">{</span>
    <span class="kd">super</span><span class="o">(</span>
      <span class="k">new</span> <span class="n">RsWithType</span><span class="o">(</span>
        <span class="k">new</span> <span class="n">RsWithStatus</span><span class="o">(</span><span class="n">text</span><span class="o">,</span> <span class="mi">200</span><span class="o">),</span>
        <span class="s">&quot;text/html&quot;</span>
      <span class="o">)</span>
    <span class="o">);</span>
  <span class="o">}</span>
<span class="o">}</span></code></pre></figure><p>Now, let&#39;s take a look at that <a href="https://github.com/yegor256/takes/blob/1.1/src/main/java/org/takes/rs/RsWrap.java"><code>RsWrap</code></a> it extends:</p><figure class="highlight"><pre><code class="language-java" data-lang="java"><span></span><span class="kd">public</span> <span class="kd">class</span> <span class="nc">RsWrap</span> <span class="kd">implements</span> <span class="n">Response</span> <span class="o">{</span>
  <span class="kd">private</span> <span class="kd">final</span> <span class="n">Response</span> <span class="n">origin</span><span class="o">;</span>
  <span class="kd">public</span> <span class="nf">RsWrap</span><span class="o">(</span><span class="kd">final</span> <span class="n">Response</span> <span class="n">res</span><span class="o">)</span> <span class="o">{</span>
    <span class="k">this</span><span class="o">.</span><span class="na">origin</span> <span class="o">=</span> <span class="n">res</span><span class="o">;</span>
  <span class="o">}</span>
  <span class="nd">@Override</span>
  <span class="kd">public</span> <span class="kd">final</span> <span class="n">Iterable</span><span class="o">&lt;</span><span class="n">String</span><span class="o">&gt;</span> <span class="nf">head</span><span class="o">()</span> <span class="o">{</span>
    <span class="k">return</span> <span class="k">this</span><span class="o">.</span><span class="na">origin</span><span class="o">.</span><span class="na">head</span><span class="o">();</span>
  <span class="o">}</span>
  <span class="nd">@Override</span>
  <span class="kd">public</span> <span class="kd">final</span> <span class="n">InputStream</span> <span class="nf">body</span><span class="o">()</span> <span class="o">{</span>
    <span class="k">return</span> <span class="k">this</span><span class="o">.</span><span class="na">origin</span><span class="o">.</span><span class="na">body</span><span class="o">();</span>
  <span class="o">}</span>
<span class="o">}</span></code></pre></figure><p>As you see, this &quot;decorator&quot; doesn&#39;t do anything except &quot;just decorating.&quot; It encapsulates another <code>Response</code> and passes through all method calls.</p><aside class='youtube'> <a href='https://www.youtube.com/watch?v=Wcy53ZSF78o'><div class='box'> <img src='https://i.ytimg.com/vi/Wcy53ZSF78o/mqdefault.jpg' alt='YouTube video #Wcy53ZSF78o'/><div class='play'><i class='icon icon-play'></i></div></div></a><div>Decorating Envelopes in OOP (webinar #31); 3 January 2018.</div></aside><p>If it&#39;s not clear yet, I&#39;ll explain the purpose of <code>RsHtml</code>. Let&#39;s say you have text and you want to create a <code>Response</code>:</p><figure class="highlight"><pre><code class="language-java" data-lang="java"><span></span><span class="n">String</span> <span class="n">text</span> <span class="o">=</span> <span class="c1">// you have it already</span>
<span class="n">Response</span> <span class="n">response</span> <span class="o">=</span> <span class="k">new</span> <span class="n">RsWithType</span><span class="o">(</span>
  <span class="k">new</span> <span class="n">RsWithStatus</span><span class="o">(</span><span class="n">text</span><span class="o">,</span> <span class="n">HttpURLConnection</span><span class="o">.</span><span class="na">HTTP_OK</span><span class="o">),</span>
  <span class="s">&quot;text/html&quot;</span>
<span class="o">);</span></code></pre></figure><p>Instead of doing this <a href="/2015/02/26/composable-decorators.html">composition of decorators</a> over and over again in many places, you use <code>RsHtml</code>:</p><figure class="highlight"><pre><code class="language-java" data-lang="java"><span></span><span class="n">String</span> <span class="n">text</span> <span class="o">=</span> <span class="c1">// you have it already</span>
<span class="n">Response</span> <span class="n">response</span> <span class="o">=</span> <span class="k">new</span> <span class="n">RsHtml</span><span class="o">(</span><span class="n">text</span><span class="o">);</span></code></pre></figure><p>It is very convenient, but that <code>RsWrap</code> is very verbose. There are too many lines that don&#39;t do anything special; they just forward all method calls to the encapsulated <code>Response</code>.</p><p>How about we introduce a new concept, &quot;decorators,&quot; with a new keyword, <code>decorates</code>:</p><figure class="highlight"><pre><code class="language-java" data-lang="java"><span></span><span class="kd">class</span> <span class="nc">RsHtml</span> <span class="n">decorates</span> <span class="n">Response</span> <span class="o">{</span>
  <span class="n">RsHtml</span><span class="o">(</span><span class="kd">final</span> <span class="n">String</span> <span class="n">text</span><span class="o">)</span> <span class="o">{</span>
    <span class="k">this</span><span class="o">(</span>
      <span class="k">new</span> <span class="n">RsWithType</span><span class="o">(</span>
        <span class="k">new</span> <span class="n">RsWithStatus</span><span class="o">(</span><span class="n">text</span><span class="o">,</span> <span class="mi">200</span><span class="o">),</span>
        <span class="s">&quot;text/html&quot;</span>
      <span class="o">)</span>
    <span class="o">)</span>
  <span class="o">}</span>
<span class="o">}</span></code></pre></figure><p>Then, in order to create an object, we just call:</p><figure class="highlight"><pre><code class="language-java" data-lang="java"><span></span><span class="n">Response</span> <span class="n">response</span> <span class="o">=</span> <span class="k">new</span> <span class="n">RsHtml</span><span class="o">(</span><span class="n">text</span><span class="o">);</span></code></pre></figure><p>We don&#39;t have any new methods in the decorators, just constructors. The only purpose for these guys is to create other objects and encapsulate them. They are not really full-purpose objects. They only help us create other objects.</p><p>That&#39;s why I would call them &quot;decorating envelopes.&quot;</p><p>This idea may look very similar to the <a href="https://en.wikipedia.org/wiki/Factory_%28object-oriented_programming%29">Factory</a> design pattern, but it doesn&#39;t have <a href="/2014/05/05/oop-alternative-to-utility-classes.html">static methods</a>, which we are trying to avoid in <a href="/2016/08/15/what-is-wrong-object-oriented-programming.html">object-oriented programming</a>.</p></p><nav class="buttons notranslate desktop-only"> <a href="http://www.facebook.com/sharer/sharer.php?u=https://www.yegor256.com/2017/01/31/decorating-envelopes.html" title="Share on Facebook" class="button" rel="nofollow"> <span class="count count-facebook">0</span> <i class="icon icon-facebook notranslate" aria-hidden="true"></i> </a> <a href="https://twitter.com/share?url=https://www.yegor256.com/2017/01/31/decorating-envelopes.html&amp;text=Decorating+Envelopes" title="Share on Twitter" class="button" rel="nofollow"> <span class="count count-twitter">0</span> <i class="icon icon-twitter notranslate" aria-hidden="true"></i> </a> <a href="https://plus.google.com/share?url=https://www.yegor256.com/2017/01/31/decorating-envelopes.html" title="Share on Google+" class="button" rel="nofollow"> <span class="count count-googleplus">0</span> <i class="icon icon-googleplus notranslate" aria-hidden="true"></i> </a> <a href="https://www.linkedin.com/cws/share?url=https://www.yegor256.com/2017/01/31/decorating-envelopes.html" title="Share on LinkedIn" class="button" rel="nofollow"> <span class="count count-linkedin">0</span> <i class="icon icon-linkedin notranslate" aria-hidden="true"></i> </a> <a href="http://reddit.com/submit?url=https://www.yegor256.com/2017/01/31/decorating-envelopes.html%3F2017-05&amp;title=Decorating+Envelopes" title="Share on Reddit" class="button" rel="nofollow"> <span class="count count-reddit">0</span> <i class="icon icon-reddit notranslate" aria-hidden="true"></i> </a> <a href="http://news.ycombinator.com/submitlink?u=https://www.yegor256.com/2017/01/31/decorating-envelopes.html%3F2017-05&amp;t=Decorating+Envelopes" title="Share on Hacker News" class="button" rel="nofollow"> <span class="count count-hackernews">0</span> <i class="icon icon-hackernews notranslate" aria-hidden="true"></i> </a> </nav> </header> <article class="main" itemprop="articleBody"><div ><p><del>Sometimes</del> Very often I need a <a href="/2016/09/20/oop-without-classes.html">class</a> that implements an interface by making an instance of another class. Sound weird? Let me show you an example. There are many classes of that kind in the <a href="http://www.takes.org">Takes Framework</a>, and they all are named like <code>*Wrap</code>. It&#39;s a convenient design concept that, unfortunately, looks rather verbose in Java. It would be great to have something shorter, like in <a href="http://www.eolang.org">EO</a> for example.</p><figure class='jb_picture'><img itemprop='image' alt='North by Northwest (1959) by Alfred Hitchcock' src='/images/2017/01/north-by-northwest.jpg' longdesc='#1633d9e6'/><figcaption id='1633d9e6'>North by Northwest (1959) by Alfred Hitchcock</figcaption></figure><p>Take a look at <a href="https://github.com/yegor256/takes/blob/1.1/src/main/java/org/takes/rs/RsHtml.java"><code>RsHtml</code></a> from <a href="http://www.takes.org">Takes Framework</a>. Its design looks like this (a simplified version with only one primary constructor):</p><figure class="highlight"><pre><code class="language-java" data-lang="java"><span></span><span class="kd">class</span> <span class="nc">RsHtml</span> <span class="kd">extends</span> <span class="n">RsWrap</span> <span class="o">{</span>
  <span class="n">RsHtml</span><span class="o">(</span><span class="kd">final</span> <span class="n">String</span> <span class="n">text</span><span class="o">)</span> <span class="o">{</span>
    <span class="kd">super</span><span class="o">(</span>
      <span class="k">new</span> <span class="n">RsWithType</span><span class="o">(</span>
        <span class="k">new</span> <span class="n">RsWithStatus</span><span class="o">(</span><span class="n">text</span><span class="o">,</span> <span class="mi">200</span><span class="o">),</span>
        <span class="s">&quot;text/html&quot;</span>
      <span class="o">)</span>
    <span class="o">);</span>
  <span class="o">}</span>
<span class="o">}</span></code></pre></figure><p>Now, let&#39;s take a look at that <a href="https://github.com/yegor256/takes/blob/1.1/src/main/java/org/takes/rs/RsWrap.java"><code>RsWrap</code></a> it extends:</p><figure class="highlight"><pre><code class="language-java" data-lang="java"><span></span><span class="kd">public</span> <span class="kd">class</span> <span class="nc">RsWrap</span> <span class="kd">implements</span> <span class="n">Response</span> <span class="o">{</span>
  <span class="kd">private</span> <span class="kd">final</span> <span class="n">Response</span> <span class="n">origin</span><span class="o">;</span>
  <span class="kd">public</span> <span class="nf">RsWrap</span><span class="o">(</span><span class="kd">final</span> <span class="n">Response</span> <span class="n">res</span><span class="o">)</span> <span class="o">{</span>
    <span class="k">this</span><span class="o">.</span><span class="na">origin</span> <span class="o">=</span> <span class="n">res</span><span class="o">;</span>
  <span class="o">}</span>
  <span class="nd">@Override</span>
  <span class="kd">public</span> <span class="kd">final</span> <span class="n">Iterable</span><span class="o">&lt;</span><span class="n">String</span><span class="o">&gt;</span> <span class="nf">head</span><span class="o">()</span> <span class="o">{</span>
    <span class="k">return</span> <span class="k">this</span><span class="o">.</span><span class="na">origin</span><span class="o">.</span><span class="na">head</span><span class="o">();</span>
  <span class="o">}</span>
  <span class="nd">@Override</span>
  <span class="kd">public</span> <span class="kd">final</span> <span class="n">InputStream</span> <span class="nf">body</span><span class="o">()</span> <span class="o">{</span>
    <span class="k">return</span> <span class="k">this</span><span class="o">.</span><span class="na">origin</span><span class="o">.</span><span class="na">body</span><span class="o">();</span>
  <span class="o">}</span>
<span class="o">}</span></code></pre></figure><p>As you see, this &quot;decorator&quot; doesn&#39;t do anything except &quot;just decorating.&quot; It encapsulates another <code>Response</code> and passes through all method calls.</p><aside class='youtube'> <a href='https://www.youtube.com/watch?v=Wcy53ZSF78o'><div class='box'> <img src='https://i.ytimg.com/vi/Wcy53ZSF78o/mqdefault.jpg' alt='YouTube video #Wcy53ZSF78o'/><div class='play'><i class='icon icon-play'></i></div></div></a><div>Decorating Envelopes in OOP (webinar #31); 3 January 2018.</div></aside><p>If it&#39;s not clear yet, I&#39;ll explain the purpose of <code>RsHtml</code>. Let&#39;s say you have text and you want to create a <code>Response</code>:</p><figure class="highlight"><pre><code class="language-java" data-lang="java"><span></span><span class="n">String</span> <span class="n">text</span> <span class="o">=</span> <span class="c1">// you have it already</span>
<span class="n">Response</span> <span class="n">response</span> <span class="o">=</span> <span class="k">new</span> <span class="n">RsWithType</span><span class="o">(</span>
  <span class="k">new</span> <span class="n">RsWithStatus</span><span class="o">(</span><span class="n">text</span><span class="o">,</span> <span class="n">HttpURLConnection</span><span class="o">.</span><span class="na">HTTP_OK</span><span class="o">),</span>
  <span class="s">&quot;text/html&quot;</span>
<span class="o">);</span></code></pre></figure><p>Instead of doing this <a href="/2015/02/26/composable-decorators.html">composition of decorators</a> over and over again in many places, you use <code>RsHtml</code>:</p><figure class="highlight"><pre><code class="language-java" data-lang="java"><span></span><span class="n">String</span> <span class="n">text</span> <span class="o">=</span> <span class="c1">// you have it already</span>
<span class="n">Response</span> <span class="n">response</span> <span class="o">=</span> <span class="k">new</span> <span class="n">RsHtml</span><span class="o">(</span><span class="n">text</span><span class="o">);</span></code></pre></figure><p>It is very convenient, but that <code>RsWrap</code> is very verbose. There are too many lines that don&#39;t do anything special; they just forward all method calls to the encapsulated <code>Response</code>.</p><p>How about we introduce a new concept, &quot;decorators,&quot; with a new keyword, <code>decorates</code>:</p><figure class="highlight"><pre><code class="language-java" data-lang="java"><span></span><span class="kd">class</span> <span class="nc">RsHtml</span> <span class="n">decorates</span> <span class="n">Response</span> <span class="o">{</span>
  <span class="n">RsHtml</span><span class="o">(</span><span class="kd">final</span> <span class="n">String</span> <span class="n">text</span><span class="o">)</span> <span class="o">{</span>
    <span class="k">this</span><span class="o">(</span>
      <span class="k">new</span> <span class="n">RsWithType</span><span class="o">(</span>
        <span class="k">new</span> <span class="n">RsWithStatus</span><span class="o">(</span><span class="n">text</span><span class="o">,</span> <span class="mi">200</span><span class="o">),</span>
        <span class="s">&quot;text/html&quot;</span>
      <span class="o">)</span>
    <span class="o">)</span>
  <span class="o">}</span>
<span class="o">}</span></code></pre></figure><p>Then, in order to create an object, we just call:</p><figure class="highlight"><pre><code class="language-java" data-lang="java"><span></span><span class="n">Response</span> <span class="n">response</span> <span class="o">=</span> <span class="k">new</span> <span class="n">RsHtml</span><span class="o">(</span><span class="n">text</span><span class="o">);</span></code></pre></figure><p>We don&#39;t have any new methods in the decorators, just constructors. The only purpose for these guys is to create other objects and encapsulate them. They are not really full-purpose objects. They only help us create other objects.</p><p>That&#39;s why I would call them &quot;decorating envelopes.&quot;</p><p>This idea may look very similar to the <a href="https://en.wikipedia.org/wiki/Factory_%28object-oriented_programming%29">Factory</a> design pattern, but it doesn&#39;t have <a href="/2014/05/05/oop-alternative-to-utility-classes.html">static methods</a>, which we are trying to avoid in <a href="/2016/08/15/what-is-wrong-object-oriented-programming.html">object-oriented programming</a>.</p></div></article></div><div class="wrapper"> <related-posts /></div><div class="disqus" role="complementary"><p class="disqus_hint"> Please, use <a href="https://help.disqus.com/commenting/what-html-tags-are-allowed-within-comments">syntax highlighting</a> in your comments, to make them more readable.</p><div id="disqus_thread" class="disqus-thread"> <a>&nbsp;</a></div><script> var disqus_config = function () { this.page.url = document.location.href.split('?')[0].split('#')[0].replace('https://', 'http://'); this.page.identifier = this.page.url; }; (function() { var d = document, s = d.createElement('script'); s.src = '//yegor256.disqus.com/embed.js'; s.setAttribute('data-timestamp', +new Date()); (d.head || d.body).appendChild(s); })(); </script> <noscript><div><p class="red"> JavaScript is disabled in your browser, that's why you can't see comments under this post.</p></div></noscript></div><div class="wrapper"> <footer class="footer"><p> &copy; <span itemscope="" itemprop="copyrightHolder" itemtype="http://schema.org/Person"> <span itemprop="name">Yegor Bugayenko</span> </span> 2014&ndash;<span itemprop="copyrightYear">2018</span></p></footer></div></section><div class="wrapper unprintable" style="text-align:center;margin-top:2em;"> <a href="http://www.sixnines.io/h/3ba1652f"> <img src="//www.sixnines.io/b/3ba1652f?style=flat" alt="sixnines availability badge"/> </a></div><script src="//code.jquery.com/jquery-1.9.0.min.js"></script> <script src="/js/all.js?a0e0d018c07"></script> <script>var disqus_shortname = 'yegor256';</script> <script id="dsq-count-scr" src="//yegor256.disqus.com/count.js" async="async"></script> <script> (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){ (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o), m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m) })(window,document,'script','//www.google-analytics.com/analytics.js','ga'); ga('create', 'UA-1963507-32', 'auto'); ga('send', 'pageview'); </script> <script> Cd=document;Cr="&"+Math.random();Cp="&s=1"; Cd.cookie="b=b";if(Cd.cookie)Cp+="&c=1"; Cp+="&t="+(new Date()).getTimezoneOffset(); if(self!=top)Cp+="&f=1"; </script> <script> if(navigator.javaEnabled())Cp+="&j=1"; </script> <script> if(typeof(screen)!='undefined')Cp+="&w="+screen.width+"&h="+ screen.height+"&d="+(screen.colorDepth?screen.colorDepth:screen.pixelDepth); </script> <script> Cd.write("<img src='//c.hit.ua/hit?i=95870&g=0&x=2"+Cp+Cr+ "&r="+escape(Cd.referrer)+"&u="+escape(window.location.href)+ "' border='0' wi"+"dth='1' he"+"ight='1'/>"); </script> <script type="application/ld+json"> { "@context": "http://schema.org", "@type": "Person", "name": "Yegor Bugayenko", "url": "http://www.yegor256.com", "sameAs": [ "https://www.facebook.com/yegor256", "https://instagram.com/yegor256", "https://www.linkedin.com/in/yegor256", "https://twitter.com/yegor256", "https://github.com/yegor256", "https://www.pinterest.com/yegor256/" ] } </script> </body> </html> <!DOCTYPE html> <html xmlns="http://www.w3.org/1999/xhtml" lang="en-US" xml:lang="en-US" itemscope="" itemtype="http://schema.org/WebSite"> <head> <meta charset="utf-8"/> <meta name="description" content="Don&apos;t make your classes thread-safe; instead, create thread-safe decorators to make thread safety configurable. " /> <meta name="keywords" content="how to make class thread-safe, synchronized in java, synchronized java, thread safety, thread-safe java" /> <meta name="viewport" content="width=device-width,minimum-scale=1,initial-scale=1"/> <meta name="google-site-verification" content="JEj_gQr2CPe2QKGw8XdMz0R7VboQIUbX3FlM-lwTq-8" /> <meta name="author" content="Yegor Bugayenko"> <meta name="article:published_time" content="2017-01-17 00:00:00 +0000"> <meta name="og:site_name" content="Yegor Bugayenko"/> <meta name="og:type" content="article" /> <meta name="og:locale" content="en_US" /> <meta name="twitter:account_id" content="4503599630178231" /> <meta name="twitter:creator" content="@yegor256"/> <meta name="twitter:site" content="@yegor256"/> <meta name="twitter:title" property="og:title" content="Synchronized Decorators to Replace Thread-Safe Classes"/> <meta name="twitter:description" property="og:description" content="Don&apos;t make your classes thread-safe; instead, create thread-safe decorators to make thread safety configurable. "/> <meta name="twitter:url" property="og:url" content="https://www.yegor256.com/2017/01/17/synchronized-decorators.html"/> <meta name="telegram:channel" content="AAAAAEJFMRzsRTRxM3ec6A"/> <link rel="search" type="application/opensearchdescription+xml" href="/opensearch.xml" title="yegor256" /> <link rel="shortcut icon" href="/favicon.ico?a0e0d018c07"/> <link rel="apple-touch-icon" href="/favicon.ico?a0e0d018c07"/> <link rel="alternate" type="application/rss+xml" title="RSS for yegor256.com" href="https://www.yegor256.com/rss.xml"/> <link rel="stylesheet" href="/css/layout.css?a0e0d018c07"/> <link rel="stylesheet" href="/css/icons.css?a0e0d018c07"/> <link rel="canonical" href="https://www.yegor256.com/2017/01/17/synchronized-decorators.html" /> <link rel="amphtml" href="https://www.yegor256.com/2017/01/17/synchronized-decorators.amp.html" /> <title>Synchronized Decorators to Replace Thread-Safe Classes </title> <meta name='og:image' content='https://www.yegor256.com/images/2017/01/aladdin.jpg'/><meta name='twitter:image' content='https://www.yegor256.com/images/2017/01/aladdin.jpg'/><meta name='og:image:width' content='1200'/> <meta name='twitter:image:width' content='1200'/><meta name='og:image:height' content='679'/> <meta name='twitter:image:height' content='679'/><meta name='twitter:card' content='summary_large_image'/><meta name='twitter:image:alt' content='Aladdin (1992) by Ron Clements and John Musker'/> </head> <body><div class="wrapper"> <aside class="header-toggle unprintable" id="header-toggle" title="Show the menu" onclick="$('#header').show();$('#header-toggle').hide();">&#9776;</aside> <header class="header" id="header"><div class="face"> <a href="/about-me.html#form" class="sub" title="Click to subscribe to my monthly newsletter"><span>Subscribe</span></a> <a href="/about-me.html" style="position:relative;"> <img src="/images/face-256x256.jpg" class="photo" alt="Yegor Bugayenko"/> </a></div><nav><ul class="menu social notranslate"> <li><a href="https://twitter.com/intent/follow?screen_name=yegor256" rel="nofollow" title="Follow me on Twitter"><i class="icon icon-twitter notranslate" aria-hidden="true"></i></a></li> <li><a href="/rss.xml" rel="nofollow" title="Subscribe to my RSS feed"><i class="icon icon-rss notranslate" aria-hidden="true"></i></a></li> <li><a itemprop="sameAs" href="https://github.com/yegor256" rel="nofollow" title="My GitHub profile"><i class="icon icon-github notranslate" aria-hidden="true"></i></a></li> <li><a itemprop="sameAs" href="http://stackoverflow.com/users/187141/yegor256" rel="nofollow" title="My StackOverflow profile"><i class="icon icon-stackoverflow notranslate" aria-hidden="true"></i></a></li> <li><a itemprop="sameAs" href="https://www.facebook.com/yegor256" rel="nofollow" title="Follow me on Facebook"><i class="icon icon-facebook notranslate" aria-hidden="true"></i></a></li> <li><a itemprop="sameAs" href="https://instagram.com/yegor256" rel="nofollow" title="Follow me on Instagram"><i class="icon icon-instagram notranslate" aria-hidden="true"></i></a></li> <li><a itemprop="sameAs" href="https://www.linkedin.com/in/yegor256" rel="nofollow" title="My LinkedIn profile"><i class="icon icon-linkedin notranslate" aria-hidden="true"></i></a></li> <li><a itemprop="sameAs" href="https://www.youtube.com/c/yegor256?sub_confirmation=1" rel="nofollow" title="My Youtube video channel"><i class="icon icon-youtube notranslate" aria-hidden="true"></i></a></li> <li><a itemprop="sameAs" href="https://www.pinterest.com/yegor256/" rel="nofollow" title="My Pinterest boards"><i class="icon icon-pinterest notranslate" aria-hidden="true"></i></a></li> <li><a itemprop="sameAs" href="https://angel.co/yegor256" rel="nofollow" title="My AngelList profile"><i class="icon icon-angellist notranslate" aria-hidden="true"></i></a></li> <li><a href="https://soundcloud.com/yegor256" rel="nofollow" title="My podcast"><i class="icon icon-podcast notranslate" aria-hidden="true"></i></a></li> <li><a href="https://itunes.apple.com/us/podcast/yegor256-podcast/id1150826721" rel="nofollow" title="My iTunes podcast"><i class="icon icon-itunes notranslate" aria-hidden="true"></i></a></li> <li><a href="https://t.me/joinchat/AAAAAEJFMRzsRTRxM3ec6A" rel="nofollow" title="My Telegram public channel"><i class="icon icon-telegram notranslate" aria-hidden="true"></i></a></li> <li><a href="mailto:blog@yegor256.com" rel="nofollow" title="Email me any time"><i class="icon icon-mail notranslate" aria-hidden="true"></i></a></li></ul><ul class="menu"> <li><a href="/" title="Home page">Home</a></li> <li ><a href="/best.html" title="Best articles to read">12&#160;Best</a></li> <li ><a href="/contents.html" title="The contents of the entire blog">All&#160;288</a></li> <li ><a href="/webinars.html" title="My webinars">Webinars</a></li> <li ><a href="/talks.html" title="Future and past conference talks">Talks</a></li> <li ><a href="/books.html" title="The books I wrote">Books</a></li> <li ><a href="/papers.html" title="My academic papers and patents">Papers</a></li> <li ><a href="/pets.html" title="My loved pet projects">Pets</a></li> <li ><a href="/award.html" title="Software quality award">Award</a></li> <li ><a href="/testimonials.html" title="What some people say about me">Testimonials</a></li> <li ><a href="/shift-m.html" title="Audio podcast about project management">Shift-M</a></li> <li ><a href="/paintings.html" title="My paintings for sale">Paintings</a></li> <li><a href="http://ru.yegor256.com/" title="Немного на русском языке">По-русски</a></li></ul></nav><div class="search"> <form method="get" action="https://www.google.com/search" itemprop="potentialAction" itemscope="" itemtype="http://schema.org/SearchAction"> <meta itemprop="target" content="https://www.google.com/search?q={q}"/> <input name="sitesearch" value="yegor256.com" type="hidden"/> <input itemprop="query-input" type="text" id="search-query" class="field field-text" required="required" onfocus="$('.google').css('visibility', 'visible');" name="q" placeholder="Search..." autocomplete="off"/> <input type="image" src="/images/google-search-icon.svg" class="google" title="Search via Google" alt="Search via Google"/> </form></div><div class="hot"><ul> <li> <a href="/code-ahead.html">Code Ahead</a> was published on Amazon just a few days ago! It is my new book, a novel about programmers. It explains in details the majority of ideas that stand behind <a href="https://www.zerocracy.com">Zerocracy</a> and <a href="https://www.xdsd.org">XDSD</a>. </li> <li> At <a href="/webinars.html">Webinar #37</a> we will discuss naming problem in OOP, for objects, methods and attributes; join us on <b>September 12</b>, at 11am PST. </li></ul></div></header></div><section itemscope="" itemtype="http://schema.org/BlogPosting"><div class="wrapper"> <header><p class="printable"> <img src="https://api.qrserver.com/v1/create-qr-code/?data=https://www.yegor256.com/2017/01/17/synchronized-decorators.html&amp;format=svg" style="width:125px;height:125px;" alt="QR code"/></p><p class="printable"> <code itemprop="url">https://www.yegor256.com/2017/01/17/synchronized-decorators.html</code></p><h1 itemprop="name headline mainEntityOfPage">Synchronized Decorators to Replace Thread-Safe Classes</h1><ul class="subline"> <li> <time itemprop="datePublished" datetime="2017-01-17T00:00:00+00:00"> 17 January 2017 </time> </li> <li class="desktop-only" itemprop="locationCreated">Odessa, Ukraine</li> <li class="printable" itemscope="" itemprop="author" itemtype="http://schema.org/Person"> <span itemprop="name">Yegor Bugayenko</span> </li> <li class="unprintable"> <i class="icon icon-comments"></i> <a href="http://www.yegor256.com/2017/01/17/synchronized-decorators.html#disqus_thread" itemprop="discussionUrl">comments</a> </li></ul><p class="unprintable"><p>You know what thread safety is, right? If not, there is a simple example below. All classes must be thread-safe, right? Not really. Some of them have to be thread-safe? Wrong again. I think none of them have to be thread-safe, while all of them have to provide synchronized decorators.</p><figure class='jb_picture'><img itemprop='image' alt='Aladdin (1992) by Ron Clements and John Musker' src='/images/2017/01/aladdin.jpg' longdesc='#f5aa3c20'/><figcaption id='f5aa3c20'>Aladdin (1992) by Ron Clements and John Musker</figcaption></figure><p>Let&#39;s start with an example (it&#39;s <a href="/2014/06/09/objects-should-be-immutable.html">mutable</a>, by the way):</p><figure class="highlight"><pre><code class="language-java" data-lang="java"><span></span><span class="kd">class</span> <span class="nc">Position</span> <span class="o">{</span>
  <span class="kd">private</span> <span class="kt">int</span> <span class="n">number</span> <span class="o">=</span> <span class="mi">0</span><span class="o">;</span>
  <span class="nd">@Override</span>
  <span class="kd">public</span> <span class="kt">void</span> <span class="nf">increment</span><span class="o">()</span> <span class="o">{</span>
    <span class="kt">int</span> <span class="n">before</span> <span class="o">=</span> <span class="k">this</span><span class="o">.</span><span class="na">number</span><span class="o">;</span>
    <span class="kt">int</span> <span class="n">after</span> <span class="o">=</span> <span class="n">before</span> <span class="o">+</span> <span class="mi">1</span><span class="o">;</span>
    <span class="k">this</span><span class="o">.</span><span class="na">number</span> <span class="o">=</span> <span class="n">after</span><span class="o">;</span>
  <span class="o">}</span>
<span class="o">}</span></code></pre></figure><p>What do you think---is it <a href="https://en.wikipedia.org/wiki/Thread_safety">thread-safe</a>? This term refers to whether an object of this class will operate without mistakes when used by multiple threads at the same time. Let&#39;s say we have two threads working with the same object, <code>position</code>, and calling its method <code>increment()</code> at exactly the same moment in time.</p><p>We expect the <code>number</code> integer to be equal to 2 when both threads finish up, because each of them will increment it once, right? However, most likely this won&#39;t happen.</p><aside class='youtube'> <a href='https://www.youtube.com/watch?v=rC17YwowURQ'><div class='box'> <img src='https://i.ytimg.com/vi/rC17YwowURQ/mqdefault.jpg' alt='YouTube video #rC17YwowURQ'/><div class='play'><i class='icon icon-play'></i></div></div></a><div>Synchronized Decorators for Thread-Safety (Webinar #32); 7 February 2018.</div></aside><p>Let&#39;s see what will happen. In both threads, <code>before</code> will equal <code>0</code> when they start. Then <code>after</code> will be set to <code>1</code>. Then, both threads will do <code>this.number = 1</code> and we will end up with <code>1</code> in <code>number</code> instead of the expected <code>2</code>. See the problem? Classes with such a flaw in their design are <strong>not thread-safe</strong>.</p><p>The simplest and most obvious solution is to make our method <a href="https://docs.oracle.com/javase/tutorial/essential/concurrency/syncmeth.html"><code>synchronized</code></a>. That will guarantee that no matter how many threads call it at the same time, they will all go sequentially, not in parallel: one thread after another. Of course, it will take longer, but it will prevent that mistake from happening:</p><figure class="highlight"><pre><code class="language-java" data-lang="java"><span></span><span class="kd">class</span> <span class="nc">Position</span> <span class="o">{</span>
  <span class="kd">private</span> <span class="kt">int</span> <span class="n">number</span> <span class="o">=</span> <span class="mi">0</span><span class="o">;</span>
  <span class="nd">@Override</span>
  <span class="kd">public</span> <span class="kd">synchronized</span> <span class="kt">void</span> <span class="nf">increment</span><span class="o">()</span> <span class="o">{</span>
    <span class="kt">int</span> <span class="n">before</span> <span class="o">=</span> <span class="k">this</span><span class="o">.</span><span class="na">number</span><span class="o">;</span>
    <span class="kt">int</span> <span class="n">after</span> <span class="o">=</span> <span class="n">before</span> <span class="o">+</span> <span class="mi">1</span><span class="o">;</span>
    <span class="k">this</span><span class="o">.</span><span class="na">number</span> <span class="o">=</span> <span class="n">after</span><span class="o">;</span>
  <span class="o">}</span>
<span class="o">}</span></code></pre></figure><p>A class that guarantees it won&#39;t break no matter how many threads are working with it is called <strong>thread-safe</strong>.</p><p>Now the question is: Do we have to make all classes thread-safe or only some of them? It would seem to be better to have all classes error-free, right? Why would anyone want an object that may break at some point? Well, not exactly. Remember, there is a performance concern involved; we don&#39;t often have multiple threads, and we always want our objects to run as fast as possible. A between-threads synchronization mechanism will definitely slow us down.</p><p>I think the right approach is to have two classes. The first one is not thread-safe, while the other one is a <strong>synchronized decorator</strong>, which would look like this:</p><figure class="highlight"><pre><code class="language-java" data-lang="java"><span></span><span class="kd">class</span> <span class="nc">SyncPosition</span> <span class="kd">implements</span> <span class="n">Position</span> <span class="o">{</span>
  <span class="kd">private</span> <span class="kd">final</span> <span class="n">Position</span> <span class="n">origin</span><span class="o">;</span>
  <span class="n">SyncPosition</span><span class="o">(</span><span class="n">Position</span> <span class="n">pos</span><span class="o">)</span> <span class="o">{</span>
    <span class="k">this</span><span class="o">.</span><span class="na">origin</span> <span class="o">=</span> <span class="n">pos</span><span class="o">;</span>
  <span class="o">}</span>
  <span class="nd">@Override</span>
  <span class="kd">public</span> <span class="kd">synchronized</span> <span class="kt">void</span> <span class="nf">increment</span><span class="o">()</span> <span class="o">{</span>
    <span class="k">this</span><span class="o">.</span><span class="na">origin</span><span class="o">.</span><span class="na">increment</span><span class="o">();</span>
  <span class="o">}</span>
<span class="o">}</span></code></pre></figure><p>Now, when we need our <code>position</code> object to be thread-safe, we decorate it with <code>SyncPosition</code>:</p><figure class="highlight"><pre><code class="language-java" data-lang="java"><span></span><span class="n">Position</span> <span class="n">position</span> <span class="o">=</span> <span class="k">new</span> <span class="n">SyncPosition</span><span class="o">(</span>
  <span class="k">new</span> <span class="n">SimplePosition</span><span class="o">()</span>
<span class="o">);</span></code></pre></figure><p>When we need a plain simple position, without any thread safety, we do this:</p><figure class="highlight"><pre><code class="language-java" data-lang="java"><span></span><span class="n">Position</span> <span class="n">position</span> <span class="o">=</span> <span class="k">new</span> <span class="n">SimplePosition</span><span class="o">();</span></code></pre></figure><p>Making class functionality both rich <em>and</em> thread-safe is, in my opinion, a violation of that famous <a href="https://en.wikipedia.org/wiki/Single_responsibility_principle">single responsibility principle</a>.</p><p>By the way, this problem is very close to the one of <a href="/2016/01/26/defensive-programming.html">defensive programming</a> and validators.</p></p><nav class="buttons notranslate desktop-only"> <a href="http://www.facebook.com/sharer/sharer.php?u=https://www.yegor256.com/2017/01/17/synchronized-decorators.html" title="Share on Facebook" class="button" rel="nofollow"> <span class="count count-facebook">0</span> <i class="icon icon-facebook notranslate" aria-hidden="true"></i> </a> <a href="https://twitter.com/share?url=https://www.yegor256.com/2017/01/17/synchronized-decorators.html&amp;text=Synchronized+Decorators+to+Replace+Thread-Safe+Classes" title="Share on Twitter" class="button" rel="nofollow"> <span class="count count-twitter">0</span> <i class="icon icon-twitter notranslate" aria-hidden="true"></i> </a> <a href="https://plus.google.com/share?url=https://www.yegor256.com/2017/01/17/synchronized-decorators.html" title="Share on Google+" class="button" rel="nofollow"> <span class="count count-googleplus">0</span> <i class="icon icon-googleplus notranslate" aria-hidden="true"></i> </a> <a href="https://www.linkedin.com/cws/share?url=https://www.yegor256.com/2017/01/17/synchronized-decorators.html" title="Share on LinkedIn" class="button" rel="nofollow"> <span class="count count-linkedin">0</span> <i class="icon icon-linkedin notranslate" aria-hidden="true"></i> </a> <a href="http://reddit.com/submit?url=https://www.yegor256.com/2017/01/17/synchronized-decorators.html%3F2017-03&amp;title=Synchronized+Decorators+to+Replace+Thread-Safe+Classes" title="Share on Reddit" class="button" rel="nofollow"> <span class="count count-reddit">0</span> <i class="icon icon-reddit notranslate" aria-hidden="true"></i> </a> <a href="http://news.ycombinator.com/submitlink?u=https://www.yegor256.com/2017/01/17/synchronized-decorators.html%3F2017-03&amp;t=Synchronized+Decorators+to+Replace+Thread-Safe+Classes" title="Share on Hacker News" class="button" rel="nofollow"> <span class="count count-hackernews">0</span> <i class="icon icon-hackernews notranslate" aria-hidden="true"></i> </a> </nav> </header> <article class="main" itemprop="articleBody"><div ><p>You know what thread safety is, right? If not, there is a simple example below. All classes must be thread-safe, right? Not really. Some of them have to be thread-safe? Wrong again. I think none of them have to be thread-safe, while all of them have to provide synchronized decorators.</p><figure class='jb_picture'><img itemprop='image' alt='Aladdin (1992) by Ron Clements and John Musker' src='/images/2017/01/aladdin.jpg' longdesc='#f5aa3c20'/><figcaption id='f5aa3c20'>Aladdin (1992) by Ron Clements and John Musker</figcaption></figure><p>Let&#39;s start with an example (it&#39;s <a href="/2014/06/09/objects-should-be-immutable.html">mutable</a>, by the way):</p><figure class="highlight"><pre><code class="language-java" data-lang="java"><span></span><span class="kd">class</span> <span class="nc">Position</span> <span class="o">{</span>
  <span class="kd">private</span> <span class="kt">int</span> <span class="n">number</span> <span class="o">=</span> <span class="mi">0</span><span class="o">;</span>
  <span class="nd">@Override</span>
  <span class="kd">public</span> <span class="kt">void</span> <span class="nf">increment</span><span class="o">()</span> <span class="o">{</span>
    <span class="kt">int</span> <span class="n">before</span> <span class="o">=</span> <span class="k">this</span><span class="o">.</span><span class="na">number</span><span class="o">;</span>
    <span class="kt">int</span> <span class="n">after</span> <span class="o">=</span> <span class="n">before</span> <span class="o">+</span> <span class="mi">1</span><span class="o">;</span>
    <span class="k">this</span><span class="o">.</span><span class="na">number</span> <span class="o">=</span> <span class="n">after</span><span class="o">;</span>
  <span class="o">}</span>
<span class="o">}</span></code></pre></figure><p>What do you think---is it <a href="https://en.wikipedia.org/wiki/Thread_safety">thread-safe</a>? This term refers to whether an object of this class will operate without mistakes when used by multiple threads at the same time. Let&#39;s say we have two threads working with the same object, <code>position</code>, and calling its method <code>increment()</code> at exactly the same moment in time.</p><p>We expect the <code>number</code> integer to be equal to 2 when both threads finish up, because each of them will increment it once, right? However, most likely this won&#39;t happen.</p><aside class='youtube'> <a href='https://www.youtube.com/watch?v=rC17YwowURQ'><div class='box'> <img src='https://i.ytimg.com/vi/rC17YwowURQ/mqdefault.jpg' alt='YouTube video #rC17YwowURQ'/><div class='play'><i class='icon icon-play'></i></div></div></a><div>Synchronized Decorators for Thread-Safety (Webinar #32); 7 February 2018.</div></aside><p>Let&#39;s see what will happen. In both threads, <code>before</code> will equal <code>0</code> when they start. Then <code>after</code> will be set to <code>1</code>. Then, both threads will do <code>this.number = 1</code> and we will end up with <code>1</code> in <code>number</code> instead of the expected <code>2</code>. See the problem? Classes with such a flaw in their design are <strong>not thread-safe</strong>.</p><p>The simplest and most obvious solution is to make our method <a href="https://docs.oracle.com/javase/tutorial/essential/concurrency/syncmeth.html"><code>synchronized</code></a>. That will guarantee that no matter how many threads call it at the same time, they will all go sequentially, not in parallel: one thread after another. Of course, it will take longer, but it will prevent that mistake from happening:</p><figure class="highlight"><pre><code class="language-java" data-lang="java"><span></span><span class="kd">class</span> <span class="nc">Position</span> <span class="o">{</span>
  <span class="kd">private</span> <span class="kt">int</span> <span class="n">number</span> <span class="o">=</span> <span class="mi">0</span><span class="o">;</span>
  <span class="nd">@Override</span>
  <span class="kd">public</span> <span class="kd">synchronized</span> <span class="kt">void</span> <span class="nf">increment</span><span class="o">()</span> <span class="o">{</span>
    <span class="kt">int</span> <span class="n">before</span> <span class="o">=</span> <span class="k">this</span><span class="o">.</span><span class="na">number</span><span class="o">;</span>
    <span class="kt">int</span> <span class="n">after</span> <span class="o">=</span> <span class="n">before</span> <span class="o">+</span> <span class="mi">1</span><span class="o">;</span>
    <span class="k">this</span><span class="o">.</span><span class="na">number</span> <span class="o">=</span> <span class="n">after</span><span class="o">;</span>
  <span class="o">}</span>
<span class="o">}</span></code></pre></figure><p>A class that guarantees it won&#39;t break no matter how many threads are working with it is called <strong>thread-safe</strong>.</p><p>Now the question is: Do we have to make all classes thread-safe or only some of them? It would seem to be better to have all classes error-free, right? Why would anyone want an object that may break at some point? Well, not exactly. Remember, there is a performance concern involved; we don&#39;t often have multiple threads, and we always want our objects to run as fast as possible. A between-threads synchronization mechanism will definitely slow us down.</p><p>I think the right approach is to have two classes. The first one is not thread-safe, while the other one is a <strong>synchronized decorator</strong>, which would look like this:</p><figure class="highlight"><pre><code class="language-java" data-lang="java"><span></span><span class="kd">class</span> <span class="nc">SyncPosition</span> <span class="kd">implements</span> <span class="n">Position</span> <span class="o">{</span>
  <span class="kd">private</span> <span class="kd">final</span> <span class="n">Position</span> <span class="n">origin</span><span class="o">;</span>
  <span class="n">SyncPosition</span><span class="o">(</span><span class="n">Position</span> <span class="n">pos</span><span class="o">)</span> <span class="o">{</span>
    <span class="k">this</span><span class="o">.</span><span class="na">origin</span> <span class="o">=</span> <span class="n">pos</span><span class="o">;</span>
  <span class="o">}</span>
  <span class="nd">@Override</span>
  <span class="kd">public</span> <span class="kd">synchronized</span> <span class="kt">void</span> <span class="nf">increment</span><span class="o">()</span> <span class="o">{</span>
    <span class="k">this</span><span class="o">.</span><span class="na">origin</span><span class="o">.</span><span class="na">increment</span><span class="o">();</span>
  <span class="o">}</span>
<span class="o">}</span></code></pre></figure><p>Now, when we need our <code>position</code> object to be thread-safe, we decorate it with <code>SyncPosition</code>:</p><figure class="highlight"><pre><code class="language-java" data-lang="java"><span></span><span class="n">Position</span> <span class="n">position</span> <span class="o">=</span> <span class="k">new</span> <span class="n">SyncPosition</span><span class="o">(</span>
  <span class="k">new</span> <span class="n">SimplePosition</span><span class="o">()</span>
<span class="o">);</span></code></pre></figure><p>When we need a plain simple position, without any thread safety, we do this:</p><figure class="highlight"><pre><code class="language-java" data-lang="java"><span></span><span class="n">Position</span> <span class="n">position</span> <span class="o">=</span> <span class="k">new</span> <span class="n">SimplePosition</span><span class="o">();</span></code></pre></figure><p>Making class functionality both rich <em>and</em> thread-safe is, in my opinion, a violation of that famous <a href="https://en.wikipedia.org/wiki/Single_responsibility_principle">single responsibility principle</a>.</p><p>By the way, this problem is very close to the one of <a href="/2016/01/26/defensive-programming.html">defensive programming</a> and validators.</p></div></article></div><div class="wrapper"> <related-posts /></div><div class="disqus" role="complementary"><p class="disqus_hint"> Please, use <a href="https://help.disqus.com/commenting/what-html-tags-are-allowed-within-comments">syntax highlighting</a> in your comments, to make them more readable.</p><div id="disqus_thread" class="disqus-thread"> <a>&nbsp;</a></div><script> var disqus_config = function () { this.page.url = document.location.href.split('?')[0].split('#')[0].replace('https://', 'http://'); this.page.identifier = this.page.url; }; (function() { var d = document, s = d.createElement('script'); s.src = '//yegor256.disqus.com/embed.js'; s.setAttribute('data-timestamp', +new Date()); (d.head || d.body).appendChild(s); })(); </script> <noscript><div><p class="red"> JavaScript is disabled in your browser, that's why you can't see comments under this post.</p></div></noscript></div><div class="wrapper"> <footer class="footer"><p> &copy; <span itemscope="" itemprop="copyrightHolder" itemtype="http://schema.org/Person"> <span itemprop="name">Yegor Bugayenko</span> </span> 2014&ndash;<span itemprop="copyrightYear">2018</span></p></footer></div></section><div class="wrapper unprintable" style="text-align:center;margin-top:2em;"> <a href="http://www.sixnines.io/h/3ba1652f"> <img src="//www.sixnines.io/b/3ba1652f?style=flat" alt="sixnines availability badge"/> </a></div><script src="//code.jquery.com/jquery-1.9.0.min.js"></script> <script src="/js/all.js?a0e0d018c07"></script> <script>var disqus_shortname = 'yegor256';</script> <script id="dsq-count-scr" src="//yegor256.disqus.com/count.js" async="async"></script> <script> (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){ (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o), m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m) })(window,document,'script','//www.google-analytics.com/analytics.js','ga'); ga('create', 'UA-1963507-32', 'auto'); ga('send', 'pageview'); </script> <script> Cd=document;Cr="&"+Math.random();Cp="&s=1"; Cd.cookie="b=b";if(Cd.cookie)Cp+="&c=1"; Cp+="&t="+(new Date()).getTimezoneOffset(); if(self!=top)Cp+="&f=1"; </script> <script> if(navigator.javaEnabled())Cp+="&j=1"; </script> <script> if(typeof(screen)!='undefined')Cp+="&w="+screen.width+"&h="+ screen.height+"&d="+(screen.colorDepth?screen.colorDepth:screen.pixelDepth); </script> <script> Cd.write("<img src='//c.hit.ua/hit?i=95870&g=0&x=2"+Cp+Cr+ "&r="+escape(Cd.referrer)+"&u="+escape(window.location.href)+ "' border='0' wi"+"dth='1' he"+"ight='1'/>"); </script> <script type="application/ld+json"> { "@context": "http://schema.org", "@type": "Person", "name": "Yegor Bugayenko", "url": "http://www.yegor256.com", "sameAs": [ "https://www.facebook.com/yegor256", "https://instagram.com/yegor256", "https://www.linkedin.com/in/yegor256", "https://twitter.com/yegor256", "https://github.com/yegor256", "https://www.pinterest.com/yegor256/" ] } </script> </body> </html> <!DOCTYPE html> <html xmlns="http://www.w3.org/1999/xhtml" lang="en-US" xml:lang="en-US" itemscope="" itemtype="http://schema.org/WebSite"> <head> <meta charset="utf-8"/> <meta name="description" content="Can you have encapsulation with only objects and no naked data? The question boils down to how objects can interact without data. They can be friends! " /> <meta name="keywords" content="encapsulation, encapsulation friends, encapsulation meaning, encapsulation trusted objects, encapsulation violation" /> <meta name="viewport" content="width=device-width,minimum-scale=1,initial-scale=1"/> <meta name="google-site-verification" content="JEj_gQr2CPe2QKGw8XdMz0R7VboQIUbX3FlM-lwTq-8" /> <meta name="author" content="Yegor Bugayenko"> <meta name="article:published_time" content="2016-12-20 00:00:00 +0000"> <meta name="og:site_name" content="Yegor Bugayenko"/> <meta name="og:type" content="article" /> <meta name="og:locale" content="en_US" /> <meta name="twitter:account_id" content="4503599630178231" /> <meta name="twitter:creator" content="@yegor256"/> <meta name="twitter:site" content="@yegor256"/> <meta name="twitter:title" property="og:title" content="Can Objects Be Friends?"/> <meta name="twitter:description" property="og:description" content="Can you have encapsulation with only objects and no naked data? The question boils down to how objects can interact without data. They can be friends! "/> <meta name="twitter:url" property="og:url" content="https://www.yegor256.com/2016/12/20/can-objects-be-friends.html"/> <meta name="telegram:channel" content="AAAAAEJFMRzsRTRxM3ec6A"/> <link rel="search" type="application/opensearchdescription+xml" href="/opensearch.xml" title="yegor256" /> <link rel="shortcut icon" href="/favicon.ico?a0e0d018c07"/> <link rel="apple-touch-icon" href="/favicon.ico?a0e0d018c07"/> <link rel="alternate" type="application/rss+xml" title="RSS for yegor256.com" href="https://www.yegor256.com/rss.xml"/> <link rel="stylesheet" href="/css/layout.css?a0e0d018c07"/> <link rel="stylesheet" href="/css/icons.css?a0e0d018c07"/> <link rel="canonical" href="https://www.yegor256.com/2016/12/20/can-objects-be-friends.html" /> <link rel="amphtml" href="https://www.yegor256.com/2016/12/20/can-objects-be-friends.amp.html" /> <title>Can Objects Be Friends? </title> <meta name='og:image' content='https://www.yegor256.com/images/2016/12/raging-bull.jpg'/><meta name='twitter:image' content='https://www.yegor256.com/images/2016/12/raging-bull.jpg'/><meta name='og:image:width' content='1280'/> <meta name='twitter:image:width' content='1280'/><meta name='og:image:height' content='688'/> <meta name='twitter:image:height' content='688'/><meta name='twitter:card' content='summary_large_image'/><meta name='twitter:image:alt' content='Raging Bull (1980) by Martin Scorsese'/> </head> <body><div class="wrapper"> <aside class="header-toggle unprintable" id="header-toggle" title="Show the menu" onclick="$('#header').show();$('#header-toggle').hide();">&#9776;</aside> <header class="header" id="header"><div class="face"> <a href="/about-me.html#form" class="sub" title="Click to subscribe to my monthly newsletter"><span>Subscribe</span></a> <a href="/about-me.html" style="position:relative;"> <img src="/images/face-256x256.jpg" class="photo" alt="Yegor Bugayenko"/> </a></div><nav><ul class="menu social notranslate"> <li><a href="https://twitter.com/intent/follow?screen_name=yegor256" rel="nofollow" title="Follow me on Twitter"><i class="icon icon-twitter notranslate" aria-hidden="true"></i></a></li> <li><a href="/rss.xml" rel="nofollow" title="Subscribe to my RSS feed"><i class="icon icon-rss notranslate" aria-hidden="true"></i></a></li> <li><a itemprop="sameAs" href="https://github.com/yegor256" rel="nofollow" title="My GitHub profile"><i class="icon icon-github notranslate" aria-hidden="true"></i></a></li> <li><a itemprop="sameAs" href="http://stackoverflow.com/users/187141/yegor256" rel="nofollow" title="My StackOverflow profile"><i class="icon icon-stackoverflow notranslate" aria-hidden="true"></i></a></li> <li><a itemprop="sameAs" href="https://www.facebook.com/yegor256" rel="nofollow" title="Follow me on Facebook"><i class="icon icon-facebook notranslate" aria-hidden="true"></i></a></li> <li><a itemprop="sameAs" href="https://instagram.com/yegor256" rel="nofollow" title="Follow me on Instagram"><i class="icon icon-instagram notranslate" aria-hidden="true"></i></a></li> <li><a itemprop="sameAs" href="https://www.linkedin.com/in/yegor256" rel="nofollow" title="My LinkedIn profile"><i class="icon icon-linkedin notranslate" aria-hidden="true"></i></a></li> <li><a itemprop="sameAs" href="https://www.youtube.com/c/yegor256?sub_confirmation=1" rel="nofollow" title="My Youtube video channel"><i class="icon icon-youtube notranslate" aria-hidden="true"></i></a></li> <li><a itemprop="sameAs" href="https://www.pinterest.com/yegor256/" rel="nofollow" title="My Pinterest boards"><i class="icon icon-pinterest notranslate" aria-hidden="true"></i></a></li> <li><a itemprop="sameAs" href="https://angel.co/yegor256" rel="nofollow" title="My AngelList profile"><i class="icon icon-angellist notranslate" aria-hidden="true"></i></a></li> <li><a href="https://soundcloud.com/yegor256" rel="nofollow" title="My podcast"><i class="icon icon-podcast notranslate" aria-hidden="true"></i></a></li> <li><a href="https://itunes.apple.com/us/podcast/yegor256-podcast/id1150826721" rel="nofollow" title="My iTunes podcast"><i class="icon icon-itunes notranslate" aria-hidden="true"></i></a></li> <li><a href="https://t.me/joinchat/AAAAAEJFMRzsRTRxM3ec6A" rel="nofollow" title="My Telegram public channel"><i class="icon icon-telegram notranslate" aria-hidden="true"></i></a></li> <li><a href="mailto:blog@yegor256.com" rel="nofollow" title="Email me any time"><i class="icon icon-mail notranslate" aria-hidden="true"></i></a></li></ul><ul class="menu"> <li><a href="/" title="Home page">Home</a></li> <li ><a href="/best.html" title="Best articles to read">12&#160;Best</a></li> <li ><a href="/contents.html" title="The contents of the entire blog">All&#160;288</a></li> <li ><a href="/webinars.html" title="My webinars">Webinars</a></li> <li ><a href="/talks.html" title="Future and past conference talks">Talks</a></li> <li ><a href="/books.html" title="The books I wrote">Books</a></li> <li ><a href="/papers.html" title="My academic papers and patents">Papers</a></li> <li ><a href="/pets.html" title="My loved pet projects">Pets</a></li> <li ><a href="/award.html" title="Software quality award">Award</a></li> <li ><a href="/testimonials.html" title="What some people say about me">Testimonials</a></li> <li ><a href="/shift-m.html" title="Audio podcast about project management">Shift-M</a></li> <li ><a href="/paintings.html" title="My paintings for sale">Paintings</a></li> <li><a href="http://ru.yegor256.com/" title="Немного на русском языке">По-русски</a></li></ul></nav><div class="search"> <form method="get" action="https://www.google.com/search" itemprop="potentialAction" itemscope="" itemtype="http://schema.org/SearchAction"> <meta itemprop="target" content="https://www.google.com/search?q={q}"/> <input name="sitesearch" value="yegor256.com" type="hidden"/> <input itemprop="query-input" type="text" id="search-query" class="field field-text" required="required" onfocus="$('.google').css('visibility', 'visible');" name="q" placeholder="Search..." autocomplete="off"/> <input type="image" src="/images/google-search-icon.svg" class="google" title="Search via Google" alt="Search via Google"/> </form></div><div class="hot"><ul> <li> <a href="/code-ahead.html">Code Ahead</a> was published on Amazon just a few days ago! It is my new book, a novel about programmers. It explains in details the majority of ideas that stand behind <a href="https://www.zerocracy.com">Zerocracy</a> and <a href="https://www.xdsd.org">XDSD</a>. </li> <li> At <a href="/webinars.html">Webinar #37</a> we will discuss naming problem in OOP, for objects, methods and attributes; join us on <b>September 12</b>, at 11am PST. </li></ul></div></header></div><section itemscope="" itemtype="http://schema.org/BlogPosting"><div class="wrapper"> <header><p class="printable"> <img src="https://api.qrserver.com/v1/create-qr-code/?data=https://www.yegor256.com/2016/12/20/can-objects-be-friends.html&amp;format=svg" style="width:125px;height:125px;" alt="QR code"/></p><p class="printable"> <code itemprop="url">https://www.yegor256.com/2016/12/20/can-objects-be-friends.html</code></p><h1 itemprop="name headline mainEntityOfPage">Can Objects Be Friends?</h1><ul class="subline"> <li> <time itemprop="datePublished" datetime="2016-12-20T00:00:00+00:00"> 20 December 2016 </time> </li> <li class="desktop-only" itemprop="locationCreated">Moscow, Russia</li> <li class="printable" itemscope="" itemprop="author" itemtype="http://schema.org/Person"> <span itemprop="name">Yegor Bugayenko</span> </li> <li class="unprintable"> <i class="icon icon-comments"></i> <a href="http://www.yegor256.com/2016/12/20/can-objects-be-friends.html#disqus_thread" itemprop="discussionUrl">comments</a> </li></ul><p class="unprintable"><p>As <a href="/2016/11/21/naked-data.html">discussed before</a>, proper encapsulation leads to a complete absence of &quot;naked data.&quot; However, the question remains: How can objects interact if they can&#39;t exchange data? Eventually we have to expose some data in order to let other objects use it, right? Yes, that&#39;s true. However, I guess I have a solution that keeps encapsulation in place while allowing objects to interact.</p><figure class='jb_picture'><img itemprop='image' alt='Raging Bull (1980) by Martin Scorsese' src='/images/2016/12/raging-bull.jpg' longdesc='#52a9356c'/><figcaption id='52a9356c'>Raging Bull (1980) by Martin Scorsese</figcaption></figure><p>Say that this is our object:</p><figure class="highlight"><pre><code class="language-java" data-lang="java"><span></span><span class="kd">class</span> <span class="nc">Temperature</span> <span class="o">{</span>
  <span class="kd">private</span> <span class="kt">int</span> <span class="n">t</span><span class="o">;</span>
  <span class="kd">public</span> <span class="n">String</span> <span class="nf">toString</span><span class="o">()</span> <span class="o">{</span>
    <span class="k">return</span> <span class="n">String</span><span class="o">.</span><span class="na">format</span><span class="o">(</span><span class="s">&quot;%d C&quot;</span><span class="o">,</span> <span class="k">this</span><span class="o">.</span><span class="na">t</span><span class="o">);</span>
  <span class="o">}</span>
<span class="o">}</span></code></pre></figure><p>It represents a temperature. The only behavior it exposes is printing the temperature in Celsius. We don&#39;t want to expose <code>t</code>, because that will lead to the &quot;<a href="/2016/11/21/naked-data.html">naked data</a>&quot; problem. We want to keep <code>t</code> secret, and that&#39;s a good desire.</p><p>Now, we want to have the ability to print temperature in Fahrenheit. The most obvious approach would be to introduce another method, <code>toFahrenheitString()</code>, or add a Boolean flag to the object, which will change the behavior of method <code>toString()</code>, right? Either one of these solutions is better than adding a method <code>getT()</code>, but neither one is perfect.</p><p>What if we create this decorator:</p><figure class="highlight"><pre><code class="language-java" data-lang="java"><span></span><span class="kd">class</span> <span class="nc">TempFahrenheit</span> <span class="kd">implements</span> <span class="n">Temperature</span> <span class="o">{</span>
  <span class="kd">private</span> <span class="n">TempCelsius</span> <span class="n">origin</span><span class="o">;</span>
  <span class="kd">public</span> <span class="n">String</span> <span class="nf">toString</span><span class="o">()</span> <span class="o">{</span>
    <span class="k">return</span> <span class="n">String</span><span class="o">.</span><span class="na">format</span><span class="o">(</span>
      <span class="s">&quot;%d F&quot;</span><span class="o">,</span> <span class="k">this</span><span class="o">.</span><span class="na">origin</span><span class="o">.</span><span class="na">t</span> <span class="o">*</span> <span class="mf">1.8</span> <span class="o">+</span> <span class="mi">32</span>
    <span class="o">);</span>
  <span class="o">}</span>
<span class="o">}</span></code></pre></figure><p>It should work just great:</p><figure class="highlight"><pre><code class="language-java" data-lang="java"><span></span><span class="n">Temperature</span> <span class="n">t</span> <span class="o">=</span> <span class="k">new</span> <span class="n">TempFahrenheit</span><span class="o">(</span>
  <span class="k">new</span> <span class="n">TempCelsius</span><span class="o">(</span><span class="mi">35</span><span class="o">)</span>
<span class="o">);</span></code></pre></figure><p>The only problem is that it won&#39;t compile in Java, because class <code>TempFahrenheit</code> is not allowed to access private <code>t</code> in class <code>TempCelsius</code>. And if we make <code>t</code> public, everybody will be able to read it directly, and we&#39;ll have that &quot;naked data&quot; problem---a severe violation of encapsulation.</p><p>However, if we allow that access <em>only</em> to one class, everything will be fine. Something like this (won&#39;t work in Java; it&#39;s just a concept):</p><figure class="highlight"><pre><code class="language-java" data-lang="java"><span></span><span class="kd">class</span> <span class="nc">TempCelsius</span> <span class="o">{</span>
  <span class="n">trust</span> <span class="n">TempFahrenheit</span><span class="o">;</span> <span class="c1">// here!</span>
  <span class="kd">private</span> <span class="kt">int</span> <span class="n">t</span><span class="o">;</span>
  <span class="kd">public</span> <span class="n">String</span> <span class="nf">toString</span><span class="o">()</span> <span class="o">{</span>
    <span class="k">return</span> <span class="n">String</span><span class="o">.</span><span class="na">format</span><span class="o">(</span><span class="s">&quot;%d C&quot;</span><span class="o">,</span> <span class="k">this</span><span class="o">.</span><span class="na">t</span><span class="o">);</span>
  <span class="o">}</span>
<span class="o">}</span></code></pre></figure><p>Since this <code>trust</code> keyword is placed into the class that allows access, we won&#39;t have the &quot;naked data&quot; problem---we will always know exactly which objects posses knowledge about <code>t</code>. When we change something about <code>t</code>, we know exactly where to update the code.</p><p>What do you think?</p><p>P.S. After discussing this idea below in comments I <a href="http://www.yegor256.com/2016/12/20/can-objects-be-friends.html#comment-3068629632">started</a> to think that we don&#39;t need that <code>trust</code> keyword at all. Instead, we should just give all decorators access to all private attributes of an object.</p></p><nav class="buttons notranslate desktop-only"> <a href="http://www.facebook.com/sharer/sharer.php?u=https://www.yegor256.com/2016/12/20/can-objects-be-friends.html" title="Share on Facebook" class="button" rel="nofollow"> <span class="count count-facebook">0</span> <i class="icon icon-facebook notranslate" aria-hidden="true"></i> </a> <a href="https://twitter.com/share?url=https://www.yegor256.com/2016/12/20/can-objects-be-friends.html&amp;text=Can+Objects+Be+Friends%3F" title="Share on Twitter" class="button" rel="nofollow"> <span class="count count-twitter">0</span> <i class="icon icon-twitter notranslate" aria-hidden="true"></i> </a> <a href="https://plus.google.com/share?url=https://www.yegor256.com/2016/12/20/can-objects-be-friends.html" title="Share on Google+" class="button" rel="nofollow"> <span class="count count-googleplus">0</span> <i class="icon icon-googleplus notranslate" aria-hidden="true"></i> </a> <a href="https://www.linkedin.com/cws/share?url=https://www.yegor256.com/2016/12/20/can-objects-be-friends.html" title="Share on LinkedIn" class="button" rel="nofollow"> <span class="count count-linkedin">0</span> <i class="icon icon-linkedin notranslate" aria-hidden="true"></i> </a> <a href="http://reddit.com/submit?url=https://www.yegor256.com/2016/12/20/can-objects-be-friends.html%3F2016-51&amp;title=Can+Objects+Be+Friends%3F" title="Share on Reddit" class="button" rel="nofollow"> <span class="count count-reddit">0</span> <i class="icon icon-reddit notranslate" aria-hidden="true"></i> </a> <a href="http://news.ycombinator.com/submitlink?u=https://www.yegor256.com/2016/12/20/can-objects-be-friends.html%3F2016-51&amp;t=Can+Objects+Be+Friends%3F" title="Share on Hacker News" class="button" rel="nofollow"> <span class="count count-hackernews">0</span> <i class="icon icon-hackernews notranslate" aria-hidden="true"></i> </a> </nav> </header> <article class="main" itemprop="articleBody"><div ><p>As <a href="/2016/11/21/naked-data.html">discussed before</a>, proper encapsulation leads to a complete absence of &quot;naked data.&quot; However, the question remains: How can objects interact if they can&#39;t exchange data? Eventually we have to expose some data in order to let other objects use it, right? Yes, that&#39;s true. However, I guess I have a solution that keeps encapsulation in place while allowing objects to interact.</p><figure class='jb_picture'><img itemprop='image' alt='Raging Bull (1980) by Martin Scorsese' src='/images/2016/12/raging-bull.jpg' longdesc='#52a9356c'/><figcaption id='52a9356c'>Raging Bull (1980) by Martin Scorsese</figcaption></figure><p>Say that this is our object:</p><figure class="highlight"><pre><code class="language-java" data-lang="java"><span></span><span class="kd">class</span> <span class="nc">Temperature</span> <span class="o">{</span>
  <span class="kd">private</span> <span class="kt">int</span> <span class="n">t</span><span class="o">;</span>
  <span class="kd">public</span> <span class="n">String</span> <span class="nf">toString</span><span class="o">()</span> <span class="o">{</span>
    <span class="k">return</span> <span class="n">String</span><span class="o">.</span><span class="na">format</span><span class="o">(</span><span class="s">&quot;%d C&quot;</span><span class="o">,</span> <span class="k">this</span><span class="o">.</span><span class="na">t</span><span class="o">);</span>
  <span class="o">}</span>
<span class="o">}</span></code></pre></figure><p>It represents a temperature. The only behavior it exposes is printing the temperature in Celsius. We don&#39;t want to expose <code>t</code>, because that will lead to the &quot;<a href="/2016/11/21/naked-data.html">naked data</a>&quot; problem. We want to keep <code>t</code> secret, and that&#39;s a good desire.</p><p>Now, we want to have the ability to print temperature in Fahrenheit. The most obvious approach would be to introduce another method, <code>toFahrenheitString()</code>, or add a Boolean flag to the object, which will change the behavior of method <code>toString()</code>, right? Either one of these solutions is better than adding a method <code>getT()</code>, but neither one is perfect.</p><p>What if we create this decorator:</p><figure class="highlight"><pre><code class="language-java" data-lang="java"><span></span><span class="kd">class</span> <span class="nc">TempFahrenheit</span> <span class="kd">implements</span> <span class="n">Temperature</span> <span class="o">{</span>
  <span class="kd">private</span> <span class="n">TempCelsius</span> <span class="n">origin</span><span class="o">;</span>
  <span class="kd">public</span> <span class="n">String</span> <span class="nf">toString</span><span class="o">()</span> <span class="o">{</span>
    <span class="k">return</span> <span class="n">String</span><span class="o">.</span><span class="na">format</span><span class="o">(</span>
      <span class="s">&quot;%d F&quot;</span><span class="o">,</span> <span class="k">this</span><span class="o">.</span><span class="na">origin</span><span class="o">.</span><span class="na">t</span> <span class="o">*</span> <span class="mf">1.8</span> <span class="o">+</span> <span class="mi">32</span>
    <span class="o">);</span>
  <span class="o">}</span>
<span class="o">}</span></code></pre></figure><p>It should work just great:</p><figure class="highlight"><pre><code class="language-java" data-lang="java"><span></span><span class="n">Temperature</span> <span class="n">t</span> <span class="o">=</span> <span class="k">new</span> <span class="n">TempFahrenheit</span><span class="o">(</span>
  <span class="k">new</span> <span class="n">TempCelsius</span><span class="o">(</span><span class="mi">35</span><span class="o">)</span>
<span class="o">);</span></code></pre></figure><p>The only problem is that it won&#39;t compile in Java, because class <code>TempFahrenheit</code> is not allowed to access private <code>t</code> in class <code>TempCelsius</code>. And if we make <code>t</code> public, everybody will be able to read it directly, and we&#39;ll have that &quot;naked data&quot; problem---a severe violation of encapsulation.</p><p>However, if we allow that access <em>only</em> to one class, everything will be fine. Something like this (won&#39;t work in Java; it&#39;s just a concept):</p><figure class="highlight"><pre><code class="language-java" data-lang="java"><span></span><span class="kd">class</span> <span class="nc">TempCelsius</span> <span class="o">{</span>
  <span class="n">trust</span> <span class="n">TempFahrenheit</span><span class="o">;</span> <span class="c1">// here!</span>
  <span class="kd">private</span> <span class="kt">int</span> <span class="n">t</span><span class="o">;</span>
  <span class="kd">public</span> <span class="n">String</span> <span class="nf">toString</span><span class="o">()</span> <span class="o">{</span>
    <span class="k">return</span> <span class="n">String</span><span class="o">.</span><span class="na">format</span><span class="o">(</span><span class="s">&quot;%d C&quot;</span><span class="o">,</span> <span class="k">this</span><span class="o">.</span><span class="na">t</span><span class="o">);</span>
  <span class="o">}</span>
<span class="o">}</span></code></pre></figure><p>Since this <code>trust</code> keyword is placed into the class that allows access, we won&#39;t have the &quot;naked data&quot; problem---we will always know exactly which objects posses knowledge about <code>t</code>. When we change something about <code>t</code>, we know exactly where to update the code.</p><p>What do you think?</p><p>P.S. After discussing this idea below in comments I <a href="http://www.yegor256.com/2016/12/20/can-objects-be-friends.html#comment-3068629632">started</a> to think that we don&#39;t need that <code>trust</code> keyword at all. Instead, we should just give all decorators access to all private attributes of an object.</p></div></article></div><div class="wrapper"> <related-posts /></div><div class="disqus" role="complementary"><p class="disqus_hint"> Please, use <a href="https://help.disqus.com/commenting/what-html-tags-are-allowed-within-comments">syntax highlighting</a> in your comments, to make them more readable.</p><div id="disqus_thread" class="disqus-thread"> <a>&nbsp;</a></div><script> var disqus_config = function () { this.page.url = document.location.href.split('?')[0].split('#')[0].replace('https://', 'http://'); this.page.identifier = this.page.url; }; (function() { var d = document, s = d.createElement('script'); s.src = '//yegor256.disqus.com/embed.js'; s.setAttribute('data-timestamp', +new Date()); (d.head || d.body).appendChild(s); })(); </script> <noscript><div><p class="red"> JavaScript is disabled in your browser, that's why you can't see comments under this post.</p></div></noscript></div><div class="wrapper"> <footer class="footer"><p> &copy; <span itemscope="" itemprop="copyrightHolder" itemtype="http://schema.org/Person"> <span itemprop="name">Yegor Bugayenko</span> </span> 2014&ndash;<span itemprop="copyrightYear">2018</span></p></footer></div></section><div class="wrapper unprintable" style="text-align:center;margin-top:2em;"> <a href="http://www.sixnines.io/h/3ba1652f"> <img src="//www.sixnines.io/b/3ba1652f?style=flat" alt="sixnines availability badge"/> </a></div><script src="//code.jquery.com/jquery-1.9.0.min.js"></script> <script src="/js/all.js?a0e0d018c07"></script> <script>var disqus_shortname = 'yegor256';</script> <script id="dsq-count-scr" src="//yegor256.disqus.com/count.js" async="async"></script> <script> (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){ (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o), m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m) })(window,document,'script','//www.google-analytics.com/analytics.js','ga'); ga('create', 'UA-1963507-32', 'auto'); ga('send', 'pageview'); </script> <script> Cd=document;Cr="&"+Math.random();Cp="&s=1"; Cd.cookie="b=b";if(Cd.cookie)Cp+="&c=1"; Cp+="&t="+(new Date()).getTimezoneOffset(); if(self!=top)Cp+="&f=1"; </script> <script> if(navigator.javaEnabled())Cp+="&j=1"; </script> <script> if(typeof(screen)!='undefined')Cp+="&w="+screen.width+"&h="+ screen.height+"&d="+(screen.colorDepth?screen.colorDepth:screen.pixelDepth); </script> <script> Cd.write("<img src='//c.hit.ua/hit?i=95870&g=0&x=2"+Cp+Cr+ "&r="+escape(Cd.referrer)+"&u="+escape(window.location.href)+ "' border='0' wi"+"dth='1' he"+"ight='1'/>"); </script> <script type="application/ld+json"> { "@context": "http://schema.org", "@type": "Person", "name": "Yegor Bugayenko", "url": "http://www.yegor256.com", "sameAs": [ "https://www.facebook.com/yegor256", "https://instagram.com/yegor256", "https://www.linkedin.com/in/yegor256", "https://twitter.com/yegor256", "https://github.com/yegor256", "https://www.pinterest.com/yegor256/" ] } </script> </body> </html> <!DOCTYPE html> <html xmlns="http://www.w3.org/1999/xhtml" lang="en-US" xml:lang="en-US" itemscope="" itemtype="http://schema.org/WebSite"> <head> <meta charset="utf-8"/> <meta name="description" content="MVC is a very popular architectural design pattern that goes absolutely against the spirit of object-oriented programming. " /> <meta name="keywords" content="mvc, mvc design pattern, mvc design pattern in java, mvc in java, mvc java" /> <meta name="viewport" content="width=device-width,minimum-scale=1,initial-scale=1"/> <meta name="google-site-verification" content="JEj_gQr2CPe2QKGw8XdMz0R7VboQIUbX3FlM-lwTq-8" /> <meta name="author" content="Yegor Bugayenko"> <meta name="article:published_time" content="2016-12-13 00:00:00 +0000"> <meta name="og:site_name" content="Yegor Bugayenko"/> <meta name="og:type" content="article" /> <meta name="og:locale" content="en_US" /> <meta name="twitter:account_id" content="4503599630178231" /> <meta name="twitter:creator" content="@yegor256"/> <meta name="twitter:site" content="@yegor256"/> <meta name="twitter:title" property="og:title" content="MVC vs. OOP"/> <meta name="twitter:description" property="og:description" content="MVC is a very popular architectural design pattern that goes absolutely against the spirit of object-oriented programming. "/> <meta name="twitter:url" property="og:url" content="https://www.yegor256.com/2016/12/13/mvc-vs-oop.html"/> <meta name="telegram:channel" content="AAAAAEJFMRzsRTRxM3ec6A"/> <link rel="search" type="application/opensearchdescription+xml" href="/opensearch.xml" title="yegor256" /> <link rel="shortcut icon" href="/favicon.ico?a0e0d018c07"/> <link rel="apple-touch-icon" href="/favicon.ico?a0e0d018c07"/> <link rel="alternate" type="application/rss+xml" title="RSS for yegor256.com" href="https://www.yegor256.com/rss.xml"/> <link rel="stylesheet" href="/css/layout.css?a0e0d018c07"/> <link rel="stylesheet" href="/css/icons.css?a0e0d018c07"/> <link rel="canonical" href="https://www.yegor256.com/2016/12/13/mvc-vs-oop.html" /> <link rel="amphtml" href="https://www.yegor256.com/2016/12/13/mvc-vs-oop.amp.html" /> <title>MVC vs. OOP </title> <meta name='og:image' content='https://www.yegor256.com/images/2016/12/hot-shots.jpg'/><meta name='twitter:image' content='https://www.yegor256.com/images/2016/12/hot-shots.jpg'/><meta name='og:image:width' content='1192'/> <meta name='twitter:image:width' content='1192'/><meta name='og:image:height' content='787'/> <meta name='twitter:image:height' content='787'/><meta name='twitter:card' content='summary_large_image'/><meta name='twitter:image:alt' content='Hot Shots! (1991) by Jim Abrahams'/> </head> <body><div class="wrapper"> <aside class="header-toggle unprintable" id="header-toggle" title="Show the menu" onclick="$('#header').show();$('#header-toggle').hide();">&#9776;</aside> <header class="header" id="header"><div class="face"> <a href="/about-me.html#form" class="sub" title="Click to subscribe to my monthly newsletter"><span>Subscribe</span></a> <a href="/about-me.html" style="position:relative;"> <img src="/images/face-256x256.jpg" class="photo" alt="Yegor Bugayenko"/> </a></div><nav><ul class="menu social notranslate"> <li><a href="https://twitter.com/intent/follow?screen_name=yegor256" rel="nofollow" title="Follow me on Twitter"><i class="icon icon-twitter notranslate" aria-hidden="true"></i></a></li> <li><a href="/rss.xml" rel="nofollow" title="Subscribe to my RSS feed"><i class="icon icon-rss notranslate" aria-hidden="true"></i></a></li> <li><a itemprop="sameAs" href="https://github.com/yegor256" rel="nofollow" title="My GitHub profile"><i class="icon icon-github notranslate" aria-hidden="true"></i></a></li> <li><a itemprop="sameAs" href="http://stackoverflow.com/users/187141/yegor256" rel="nofollow" title="My StackOverflow profile"><i class="icon icon-stackoverflow notranslate" aria-hidden="true"></i></a></li> <li><a itemprop="sameAs" href="https://www.facebook.com/yegor256" rel="nofollow" title="Follow me on Facebook"><i class="icon icon-facebook notranslate" aria-hidden="true"></i></a></li> <li><a itemprop="sameAs" href="https://instagram.com/yegor256" rel="nofollow" title="Follow me on Instagram"><i class="icon icon-instagram notranslate" aria-hidden="true"></i></a></li> <li><a itemprop="sameAs" href="https://www.linkedin.com/in/yegor256" rel="nofollow" title="My LinkedIn profile"><i class="icon icon-linkedin notranslate" aria-hidden="true"></i></a></li> <li><a itemprop="sameAs" href="https://www.youtube.com/c/yegor256?sub_confirmation=1" rel="nofollow" title="My Youtube video channel"><i class="icon icon-youtube notranslate" aria-hidden="true"></i></a></li> <li><a itemprop="sameAs" href="https://www.pinterest.com/yegor256/" rel="nofollow" title="My Pinterest boards"><i class="icon icon-pinterest notranslate" aria-hidden="true"></i></a></li> <li><a itemprop="sameAs" href="https://angel.co/yegor256" rel="nofollow" title="My AngelList profile"><i class="icon icon-angellist notranslate" aria-hidden="true"></i></a></li> <li><a href="https://soundcloud.com/yegor256" rel="nofollow" title="My podcast"><i class="icon icon-podcast notranslate" aria-hidden="true"></i></a></li> <li><a href="https://itunes.apple.com/us/podcast/yegor256-podcast/id1150826721" rel="nofollow" title="My iTunes podcast"><i class="icon icon-itunes notranslate" aria-hidden="true"></i></a></li> <li><a href="https://t.me/joinchat/AAAAAEJFMRzsRTRxM3ec6A" rel="nofollow" title="My Telegram public channel"><i class="icon icon-telegram notranslate" aria-hidden="true"></i></a></li> <li><a href="mailto:blog@yegor256.com" rel="nofollow" title="Email me any time"><i class="icon icon-mail notranslate" aria-hidden="true"></i></a></li></ul><ul class="menu"> <li><a href="/" title="Home page">Home</a></li> <li ><a href="/best.html" title="Best articles to read">12&#160;Best</a></li> <li ><a href="/contents.html" title="The contents of the entire blog">All&#160;288</a></li> <li ><a href="/webinars.html" title="My webinars">Webinars</a></li> <li ><a href="/talks.html" title="Future and past conference talks">Talks</a></li> <li ><a href="/books.html" title="The books I wrote">Books</a></li> <li ><a href="/papers.html" title="My academic papers and patents">Papers</a></li> <li ><a href="/pets.html" title="My loved pet projects">Pets</a></li> <li ><a href="/award.html" title="Software quality award">Award</a></li> <li ><a href="/testimonials.html" title="What some people say about me">Testimonials</a></li> <li ><a href="/shift-m.html" title="Audio podcast about project management">Shift-M</a></li> <li ><a href="/paintings.html" title="My paintings for sale">Paintings</a></li> <li><a href="http://ru.yegor256.com/" title="Немного на русском языке">По-русски</a></li></ul></nav><div class="search"> <form method="get" action="https://www.google.com/search" itemprop="potentialAction" itemscope="" itemtype="http://schema.org/SearchAction"> <meta itemprop="target" content="https://www.google.com/search?q={q}"/> <input name="sitesearch" value="yegor256.com" type="hidden"/> <input itemprop="query-input" type="text" id="search-query" class="field field-text" required="required" onfocus="$('.google').css('visibility', 'visible');" name="q" placeholder="Search..." autocomplete="off"/> <input type="image" src="/images/google-search-icon.svg" class="google" title="Search via Google" alt="Search via Google"/> </form></div><div class="hot"><ul> <li> <a href="/code-ahead.html">Code Ahead</a> was published on Amazon just a few days ago! It is my new book, a novel about programmers. It explains in details the majority of ideas that stand behind <a href="https://www.zerocracy.com">Zerocracy</a> and <a href="https://www.xdsd.org">XDSD</a>. </li> <li> At <a href="/webinars.html">Webinar #37</a> we will discuss naming problem in OOP, for objects, methods and attributes; join us on <b>September 12</b>, at 11am PST. </li></ul></div></header></div><section itemscope="" itemtype="http://schema.org/BlogPosting"><div class="wrapper"> <header><p class="printable"> <img src="https://api.qrserver.com/v1/create-qr-code/?data=https://www.yegor256.com/2016/12/13/mvc-vs-oop.html&amp;format=svg" style="width:125px;height:125px;" alt="QR code"/></p><p class="printable"> <code itemprop="url">https://www.yegor256.com/2016/12/13/mvc-vs-oop.html</code></p><h1 itemprop="name headline mainEntityOfPage">MVC vs. OOP</h1><aside class='book'><a href='http://amzn.to/2pyceWc'><img src='/images/books/elegant-objects/cover.png' class='book-cover' alt='book cover'/></a>Read more about this subject in <a href='http://amzn.to/2pyceWc'>Section&nbsp;6.2</a><br/> of my book<a href='http://amzn.to/2pyceWc'><img src='/images/books/amazon-buy-button.png' class='amazon-button' alt='Click to buy'/></a></aside><ul class="subline"> <li> <time itemprop="datePublished" datetime="2016-12-13T00:00:00+00:00"> 13 December 2016 </time> </li> <li class="desktop-only" itemprop="locationCreated">Kiev, Ukraine</li> <li class="printable" itemscope="" itemprop="author" itemtype="http://schema.org/Person"> <span itemprop="name">Yegor Bugayenko</span> </li> <li class="unprintable"> <i class="icon icon-comments"></i> <a href="http://www.yegor256.com/2016/12/13/mvc-vs-oop.html#disqus_thread" itemprop="discussionUrl">comments</a> </li></ul><ul class="subline"> <li>Discussed at:</li> <li><a href="https://dzone.com/articles/mvc-vs-oop">dzone</a></li></ul><p class="unprintable"><p><a href="https://en.wikipedia.org/wiki/Model%E2%80%93view%E2%80%93controller">Model-View-Controller</a> (MVC) is an architectural pattern we all are well aware of. It&#39;s a de-facto standard for almost all UI and <a href="https://en.wikipedia.org/wiki/Web_framework">Web frameworks</a>. It is convenient and easy to use. It is simple and effective. It is a great concept ... for a procedural programmer. If your software is object-oriented, you should dislike MVC as much as I do. Here is why.</p><figure class='jb_picture'><img itemprop='image' alt='Hot Shots! (1991) by Jim Abrahams' src='/images/2016/12/hot-shots.jpg' longdesc='#cdf5cce3'/><figcaption id='cdf5cce3'>Hot Shots! (1991) by Jim Abrahams</figcaption></figure><p>This is how MVC architecture looks:</p><p><img src='/uml/45d05ab3bd9a93ad88ec209352b62f60.svg' style="width:35%" alt='PlantUML SVG diagram' class='plantuml'/></p><p>Controller is <em>in charge</em>, taking care of the data received from Model and injecting it into View---and this is exactly the problem. The data escapes the Model and becomes &quot;naked,&quot; which is a big problem, as we <a href="/2016/11/21/naked-data.html">agreed earlier</a>. OOP is all about encapsulation---data hiding.</p><p>MVC architecture does exactly the opposite by <em>exposing</em> the data and hiding behavior. The controller deals with the data directly, making decisions about its purpose and properties, while the objects, which are supposed to know everything about the data and hide it, remain <a href="/2016/07/06/data-transfer-object.html">anemic</a>. That is exactly the principle any procedural architecture is built upon; the code is in charge of the data. Take this C++ code, for example:</p><figure class="highlight"><pre><code class="language-c" data-lang="c"><span></span><span class="kt">void</span> <span class="nf">print_speed</span><span class="p">()</span> <span class="p">{</span> <span class="c1">// controller</span>
  <span class="kt">int</span> <span class="n">s</span> <span class="o">=</span> <span class="n">load_from_engine</span><span class="p">();</span> <span class="c1">// model</span>
  <span class="n">printf</span><span class="p">(</span><span class="s">&quot;The speed is %d mph&quot;</span><span class="p">,</span> <span class="n">s</span><span class="p">);</span> <span class="c1">// view</span>
<span class="p">}</span></code></pre></figure><p>The function <code>print_speed()</code> is the controller. It gets the data <code>s</code> from the model <code>load_from_engine()</code> and renders it via the view <code>printf()</code>. Only the controller knows that the data is in miles per hour. The engine returns <code>int</code> without any properties. The controller simply assumed that that data is in mph. If we want to create a similar controller somewhere else, we will have to make a similar assumption again and again. That&#39;s what the &quot;naked data&quot; problem is about, and it leads to serious maintainability issues.</p><p>This is an object-oriented alternative to the code above (pseudo-C++):</p><figure class="highlight"><pre><code class="language-c" data-lang="c"><span></span><span class="n">printf</span><span class="p">(</span>
  <span class="n">new</span> <span class="n">PrintedSpeed</span><span class="p">(</span> <span class="c1">// view</span>
    <span class="n">new</span> <span class="n">FormattedSpeed</span><span class="p">(</span> <span class="c1">// controller</span>
      <span class="n">new</span> <span class="n">SpeedFromEngine</span><span class="p">()</span> <span class="c1">// model</span>
    <span class="p">)</span>
  <span class="p">)</span>
<span class="p">);</span></code></pre></figure><p>Here, <code>SpeedFromEngine.speed()</code> returns speed in mph, as an integer; <code>FormattedSpeed.speed()</code> returns <code>&quot;%d mph&quot;</code>; and finally, <code>PrintedSpeed.to_str()</code> returns the full text of the message. We can call them &quot;model, view, and controller,&quot; but in reality they are just objects decorating each other. It&#39;s still the same entity---the speed. But it gets more complex and intelligent by being decorated.</p><p>We don&#39;t tear the concept of speed apart. The speed is the speed, no matter who works with it and where it is presented. It just gets new behavior from decorators. It grows, but never falls apart.</p><p>To summarize, Controller is a pure <em>procedural</em> component in the MVC trio, which turns Model into a passive data holder and View into a passive data renderer. The controll<b>er</b>, the hold<b>er</b>, the render<b>er</b> ... Is it <a href="/2015/03/09/objects-end-with-er.html">really OOP</a>?</p></p><nav class="buttons notranslate desktop-only"> <a href="http://www.facebook.com/sharer/sharer.php?u=https://www.yegor256.com/2016/12/13/mvc-vs-oop.html" title="Share on Facebook" class="button" rel="nofollow"> <span class="count count-facebook">0</span> <i class="icon icon-facebook notranslate" aria-hidden="true"></i> </a> <a href="https://twitter.com/share?url=https://www.yegor256.com/2016/12/13/mvc-vs-oop.html&amp;text=MVC+vs.+OOP" title="Share on Twitter" class="button" rel="nofollow"> <span class="count count-twitter">0</span> <i class="icon icon-twitter notranslate" aria-hidden="true"></i> </a> <a href="https://plus.google.com/share?url=https://www.yegor256.com/2016/12/13/mvc-vs-oop.html" title="Share on Google+" class="button" rel="nofollow"> <span class="count count-googleplus">0</span> <i class="icon icon-googleplus notranslate" aria-hidden="true"></i> </a> <a href="https://www.linkedin.com/cws/share?url=https://www.yegor256.com/2016/12/13/mvc-vs-oop.html" title="Share on LinkedIn" class="button" rel="nofollow"> <span class="count count-linkedin">0</span> <i class="icon icon-linkedin notranslate" aria-hidden="true"></i> </a> <a href="http://reddit.com/submit?url=https://www.yegor256.com/2016/12/13/mvc-vs-oop.html%3F2016-50&amp;title=MVC+vs.+OOP" title="Share on Reddit" class="button" rel="nofollow"> <span class="count count-reddit">0</span> <i class="icon icon-reddit notranslate" aria-hidden="true"></i> </a> <a href="http://news.ycombinator.com/submitlink?u=https://www.yegor256.com/2016/12/13/mvc-vs-oop.html%3F2016-50&amp;t=MVC+vs.+OOP" title="Share on Hacker News" class="button" rel="nofollow"> <span class="count count-hackernews">0</span> <i class="icon icon-hackernews notranslate" aria-hidden="true"></i> </a> </nav> </header> <article class="main" itemprop="articleBody"><div ><p><a href="https://en.wikipedia.org/wiki/Model%E2%80%93view%E2%80%93controller">Model-View-Controller</a> (MVC) is an architectural pattern we all are well aware of. It&#39;s a de-facto standard for almost all UI and <a href="https://en.wikipedia.org/wiki/Web_framework">Web frameworks</a>. It is convenient and easy to use. It is simple and effective. It is a great concept ... for a procedural programmer. If your software is object-oriented, you should dislike MVC as much as I do. Here is why.</p><figure class='jb_picture'><img itemprop='image' alt='Hot Shots! (1991) by Jim Abrahams' src='/images/2016/12/hot-shots.jpg' longdesc='#cdf5cce3'/><figcaption id='cdf5cce3'>Hot Shots! (1991) by Jim Abrahams</figcaption></figure><p>This is how MVC architecture looks:</p><p><img src='/uml/45d05ab3bd9a93ad88ec209352b62f60.svg' style="width:35%" alt='PlantUML SVG diagram' class='plantuml'/></p><p>Controller is <em>in charge</em>, taking care of the data received from Model and injecting it into View---and this is exactly the problem. The data escapes the Model and becomes &quot;naked,&quot; which is a big problem, as we <a href="/2016/11/21/naked-data.html">agreed earlier</a>. OOP is all about encapsulation---data hiding.</p><p>MVC architecture does exactly the opposite by <em>exposing</em> the data and hiding behavior. The controller deals with the data directly, making decisions about its purpose and properties, while the objects, which are supposed to know everything about the data and hide it, remain <a href="/2016/07/06/data-transfer-object.html">anemic</a>. That is exactly the principle any procedural architecture is built upon; the code is in charge of the data. Take this C++ code, for example:</p><figure class="highlight"><pre><code class="language-c" data-lang="c"><span></span><span class="kt">void</span> <span class="nf">print_speed</span><span class="p">()</span> <span class="p">{</span> <span class="c1">// controller</span>
  <span class="kt">int</span> <span class="n">s</span> <span class="o">=</span> <span class="n">load_from_engine</span><span class="p">();</span> <span class="c1">// model</span>
  <span class="n">printf</span><span class="p">(</span><span class="s">&quot;The speed is %d mph&quot;</span><span class="p">,</span> <span class="n">s</span><span class="p">);</span> <span class="c1">// view</span>
<span class="p">}</span></code></pre></figure><p>The function <code>print_speed()</code> is the controller. It gets the data <code>s</code> from the model <code>load_from_engine()</code> and renders it via the view <code>printf()</code>. Only the controller knows that the data is in miles per hour. The engine returns <code>int</code> without any properties. The controller simply assumed that that data is in mph. If we want to create a similar controller somewhere else, we will have to make a similar assumption again and again. That&#39;s what the &quot;naked data&quot; problem is about, and it leads to serious maintainability issues.</p><p>This is an object-oriented alternative to the code above (pseudo-C++):</p><figure class="highlight"><pre><code class="language-c" data-lang="c"><span></span><span class="n">printf</span><span class="p">(</span>
  <span class="n">new</span> <span class="n">PrintedSpeed</span><span class="p">(</span> <span class="c1">// view</span>
    <span class="n">new</span> <span class="n">FormattedSpeed</span><span class="p">(</span> <span class="c1">// controller</span>
      <span class="n">new</span> <span class="n">SpeedFromEngine</span><span class="p">()</span> <span class="c1">// model</span>
    <span class="p">)</span>
  <span class="p">)</span>
<span class="p">);</span></code></pre></figure><p>Here, <code>SpeedFromEngine.speed()</code> returns speed in mph, as an integer; <code>FormattedSpeed.speed()</code> returns <code>&quot;%d mph&quot;</code>; and finally, <code>PrintedSpeed.to_str()</code> returns the full text of the message. We can call them &quot;model, view, and controller,&quot; but in reality they are just objects decorating each other. It&#39;s still the same entity---the speed. But it gets more complex and intelligent by being decorated.</p><p>We don&#39;t tear the concept of speed apart. The speed is the speed, no matter who works with it and where it is presented. It just gets new behavior from decorators. It grows, but never falls apart.</p><p>To summarize, Controller is a pure <em>procedural</em> component in the MVC trio, which turns Model into a passive data holder and View into a passive data renderer. The controll<b>er</b>, the hold<b>er</b>, the render<b>er</b> ... Is it <a href="/2015/03/09/objects-end-with-er.html">really OOP</a>?</p></div></article></div><div class="wrapper"> <related-posts /></div><div class="disqus" role="complementary"><p class="disqus_hint"> Please, use <a href="https://help.disqus.com/commenting/what-html-tags-are-allowed-within-comments">syntax highlighting</a> in your comments, to make them more readable.</p><div id="disqus_thread" class="disqus-thread"> <a>&nbsp;</a></div><script> var disqus_config = function () { this.page.url = document.location.href.split('?')[0].split('#')[0].replace('https://', 'http://'); this.page.identifier = this.page.url; }; (function() { var d = document, s = d.createElement('script'); s.src = '//yegor256.disqus.com/embed.js'; s.setAttribute('data-timestamp', +new Date()); (d.head || d.body).appendChild(s); })(); </script> <noscript><div><p class="red"> JavaScript is disabled in your browser, that's why you can't see comments under this post.</p></div></noscript></div><div class="wrapper"> <footer class="footer"><p> &copy; <span itemscope="" itemprop="copyrightHolder" itemtype="http://schema.org/Person"> <span itemprop="name">Yegor Bugayenko</span> </span> 2014&ndash;<span itemprop="copyrightYear">2018</span></p></footer></div></section><div class="wrapper unprintable" style="text-align:center;margin-top:2em;"> <a href="http://www.sixnines.io/h/3ba1652f"> <img src="//www.sixnines.io/b/3ba1652f?style=flat" alt="sixnines availability badge"/> </a></div><script src="//code.jquery.com/jquery-1.9.0.min.js"></script> <script src="/js/all.js?a0e0d018c07"></script> <script>var disqus_shortname = 'yegor256';</script> <script id="dsq-count-scr" src="//yegor256.disqus.com/count.js" async="async"></script> <script> (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){ (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o), m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m) })(window,document,'script','//www.google-analytics.com/analytics.js','ga'); ga('create', 'UA-1963507-32', 'auto'); ga('send', 'pageview'); </script> <script> Cd=document;Cr="&"+Math.random();Cp="&s=1"; Cd.cookie="b=b";if(Cd.cookie)Cp+="&c=1"; Cp+="&t="+(new Date()).getTimezoneOffset(); if(self!=top)Cp+="&f=1"; </script> <script> if(navigator.javaEnabled())Cp+="&j=1"; </script> <script> if(typeof(screen)!='undefined')Cp+="&w="+screen.width+"&h="+ screen.height+"&d="+(screen.colorDepth?screen.colorDepth:screen.pixelDepth); </script> <script> Cd.write("<img src='//c.hit.ua/hit?i=95870&g=0&x=2"+Cp+Cr+ "&r="+escape(Cd.referrer)+"&u="+escape(window.location.href)+ "' border='0' wi"+"dth='1' he"+"ight='1'/>"); </script> <script type="application/ld+json"> { "@context": "http://schema.org", "@type": "Person", "name": "Yegor Bugayenko", "url": "http://www.yegor256.com", "sameAs": [ "https://www.facebook.com/yegor256", "https://instagram.com/yegor256", "https://www.linkedin.com/in/yegor256", "https://twitter.com/yegor256", "https://github.com/yegor256", "https://www.pinterest.com/yegor256/" ] } </script> </body> </html> <!DOCTYPE html> <html xmlns="http://www.w3.org/1999/xhtml" lang="en-US" xml:lang="en-US" itemscope="" itemtype="http://schema.org/WebSite"> <head> <meta charset="utf-8"/> <meta name="description" content="EO is a new object-oriented programming language we started designing a few days ago; we&apos;re looking for your contribution. " /> <meta name="keywords" content="EO language, EO programming language, OO language, eolang, object-oriented language" /> <meta name="viewport" content="width=device-width,minimum-scale=1,initial-scale=1"/> <meta name="google-site-verification" content="JEj_gQr2CPe2QKGw8XdMz0R7VboQIUbX3FlM-lwTq-8" /> <meta name="author" content="Yegor Bugayenko"> <meta name="article:published_time" content="2016-11-29 00:00:00 +0000"> <meta name="og:site_name" content="Yegor Bugayenko"/> <meta name="og:type" content="article" /> <meta name="og:locale" content="en_US" /> <meta name="twitter:account_id" content="4503599630178231" /> <meta name="twitter:creator" content="@yegor256"/> <meta name="twitter:site" content="@yegor256"/> <meta name="twitter:title" property="og:title" content="EO"/> <meta name="twitter:description" property="og:description" content="EO is a new object-oriented programming language we started designing a few days ago; we&apos;re looking for your contribution. "/> <meta name="twitter:url" property="og:url" content="https://www.yegor256.com/2016/11/29/eolang.html"/> <meta name="telegram:channel" content="AAAAAEJFMRzsRTRxM3ec6A"/> <link rel="search" type="application/opensearchdescription+xml" href="/opensearch.xml" title="yegor256" /> <link rel="shortcut icon" href="/favicon.ico?a0e0d018c07"/> <link rel="apple-touch-icon" href="/favicon.ico?a0e0d018c07"/> <link rel="alternate" type="application/rss+xml" title="RSS for yegor256.com" href="https://www.yegor256.com/rss.xml"/> <link rel="stylesheet" href="/css/layout.css?a0e0d018c07"/> <link rel="stylesheet" href="/css/icons.css?a0e0d018c07"/> <link rel="canonical" href="https://www.yegor256.com/2016/11/29/eolang.html" /> <link rel="amphtml" href="https://www.yegor256.com/2016/11/29/eolang.amp.html" /> <title>EO </title> <meta name='og:image' content='https://www.yegor256.com/images/2016/11/vicky-cristina-barcelona.jpg'/><meta name='twitter:image' content='https://www.yegor256.com/images/2016/11/vicky-cristina-barcelona.jpg'/><meta name='og:image:width' content='1200'/> <meta name='twitter:image:width' content='1200'/><meta name='og:image:height' content='649'/> <meta name='twitter:image:height' content='649'/><meta name='twitter:card' content='summary_large_image'/><meta name='twitter:image:alt' content='Vicky Cristina Barcelona (2008) by Woody Allen'/> </head> <body><div class="wrapper"> <aside class="header-toggle unprintable" id="header-toggle" title="Show the menu" onclick="$('#header').show();$('#header-toggle').hide();">&#9776;</aside> <header class="header" id="header"><div class="face"> <a href="/about-me.html#form" class="sub" title="Click to subscribe to my monthly newsletter"><span>Subscribe</span></a> <a href="/about-me.html" style="position:relative;"> <img src="/images/face-256x256.jpg" class="photo" alt="Yegor Bugayenko"/> </a></div><nav><ul class="menu social notranslate"> <li><a href="https://twitter.com/intent/follow?screen_name=yegor256" rel="nofollow" title="Follow me on Twitter"><i class="icon icon-twitter notranslate" aria-hidden="true"></i></a></li> <li><a href="/rss.xml" rel="nofollow" title="Subscribe to my RSS feed"><i class="icon icon-rss notranslate" aria-hidden="true"></i></a></li> <li><a itemprop="sameAs" href="https://github.com/yegor256" rel="nofollow" title="My GitHub profile"><i class="icon icon-github notranslate" aria-hidden="true"></i></a></li> <li><a itemprop="sameAs" href="http://stackoverflow.com/users/187141/yegor256" rel="nofollow" title="My StackOverflow profile"><i class="icon icon-stackoverflow notranslate" aria-hidden="true"></i></a></li> <li><a itemprop="sameAs" href="https://www.facebook.com/yegor256" rel="nofollow" title="Follow me on Facebook"><i class="icon icon-facebook notranslate" aria-hidden="true"></i></a></li> <li><a itemprop="sameAs" href="https://instagram.com/yegor256" rel="nofollow" title="Follow me on Instagram"><i class="icon icon-instagram notranslate" aria-hidden="true"></i></a></li> <li><a itemprop="sameAs" href="https://www.linkedin.com/in/yegor256" rel="nofollow" title="My LinkedIn profile"><i class="icon icon-linkedin notranslate" aria-hidden="true"></i></a></li> <li><a itemprop="sameAs" href="https://www.youtube.com/c/yegor256?sub_confirmation=1" rel="nofollow" title="My Youtube video channel"><i class="icon icon-youtube notranslate" aria-hidden="true"></i></a></li> <li><a itemprop="sameAs" href="https://www.pinterest.com/yegor256/" rel="nofollow" title="My Pinterest boards"><i class="icon icon-pinterest notranslate" aria-hidden="true"></i></a></li> <li><a itemprop="sameAs" href="https://angel.co/yegor256" rel="nofollow" title="My AngelList profile"><i class="icon icon-angellist notranslate" aria-hidden="true"></i></a></li> <li><a href="https://soundcloud.com/yegor256" rel="nofollow" title="My podcast"><i class="icon icon-podcast notranslate" aria-hidden="true"></i></a></li> <li><a href="https://itunes.apple.com/us/podcast/yegor256-podcast/id1150826721" rel="nofollow" title="My iTunes podcast"><i class="icon icon-itunes notranslate" aria-hidden="true"></i></a></li> <li><a href="https://t.me/joinchat/AAAAAEJFMRzsRTRxM3ec6A" rel="nofollow" title="My Telegram public channel"><i class="icon icon-telegram notranslate" aria-hidden="true"></i></a></li> <li><a href="mailto:blog@yegor256.com" rel="nofollow" title="Email me any time"><i class="icon icon-mail notranslate" aria-hidden="true"></i></a></li></ul><ul class="menu"> <li><a href="/" title="Home page">Home</a></li> <li ><a href="/best.html" title="Best articles to read">12&#160;Best</a></li> <li ><a href="/contents.html" title="The contents of the entire blog">All&#160;288</a></li> <li ><a href="/webinars.html" title="My webinars">Webinars</a></li> <li ><a href="/talks.html" title="Future and past conference talks">Talks</a></li> <li ><a href="/books.html" title="The books I wrote">Books</a></li> <li ><a href="/papers.html" title="My academic papers and patents">Papers</a></li> <li ><a href="/pets.html" title="My loved pet projects">Pets</a></li> <li ><a href="/award.html" title="Software quality award">Award</a></li> <li ><a href="/testimonials.html" title="What some people say about me">Testimonials</a></li> <li ><a href="/shift-m.html" title="Audio podcast about project management">Shift-M</a></li> <li ><a href="/paintings.html" title="My paintings for sale">Paintings</a></li> <li><a href="http://ru.yegor256.com/" title="Немного на русском языке">По-русски</a></li></ul></nav><div class="search"> <form method="get" action="https://www.google.com/search" itemprop="potentialAction" itemscope="" itemtype="http://schema.org/SearchAction"> <meta itemprop="target" content="https://www.google.com/search?q={q}"/> <input name="sitesearch" value="yegor256.com" type="hidden"/> <input itemprop="query-input" type="text" id="search-query" class="field field-text" required="required" onfocus="$('.google').css('visibility', 'visible');" name="q" placeholder="Search..." autocomplete="off"/> <input type="image" src="/images/google-search-icon.svg" class="google" title="Search via Google" alt="Search via Google"/> </form></div><div class="hot"><ul> <li> <a href="/code-ahead.html">Code Ahead</a> was published on Amazon just a few days ago! It is my new book, a novel about programmers. It explains in details the majority of ideas that stand behind <a href="https://www.zerocracy.com">Zerocracy</a> and <a href="https://www.xdsd.org">XDSD</a>. </li> <li> At <a href="/webinars.html">Webinar #37</a> we will discuss naming problem in OOP, for objects, methods and attributes; join us on <b>September 12</b>, at 11am PST. </li></ul></div></header></div><section itemscope="" itemtype="http://schema.org/BlogPosting"><div class="wrapper"> <header><p class="printable"> <img src="https://api.qrserver.com/v1/create-qr-code/?data=https://www.yegor256.com/2016/11/29/eolang.html&amp;format=svg" style="width:125px;height:125px;" alt="QR code"/></p><p class="printable"> <code itemprop="url">https://www.yegor256.com/2016/11/29/eolang.html</code></p><h1 itemprop="name headline mainEntityOfPage">EO</h1><ul class="subline"> <li> <time itemprop="datePublished" datetime="2016-11-29T00:00:00+00:00"> 29 November 2016 </time> </li> <li class="desktop-only" itemprop="locationCreated">Tallinn, Estonia</li> <li class="printable" itemscope="" itemprop="author" itemtype="http://schema.org/Person"> <span itemprop="name">Yegor Bugayenko</span> </li> <li class="unprintable"> <i class="icon icon-comments"></i> <a href="http://www.yegor256.com/2016/11/29/eolang.html#disqus_thread" itemprop="discussionUrl">comments</a> </li></ul><p class="unprintable"><p>It&#39;s time to do it! We&#39;ve started work on a new programming language. Its name is <strong>EO</strong> (as in <a href="/elegant-objects.html">Elegant Objects</a> or in <a href="https://en.wikipedia.org/wiki/Esperanto">Esperanto</a>): <a href="http://www.eolang.org">eolang.org</a>. It&#39;s open source and community driven: <a href="https://github.com/yegor256/eo">yegor256/eo</a> GitHub repo. It&#39;s still in very early draft form, but the direction is more or less clear: It has to be truly object-oriented, with no compromises. You&#39;re welcome to join us.</p><figure class='jb_picture'><img itemprop='image' alt='Vicky Cristina Barcelona (2008) by Woody Allen' src='/images/2016/11/vicky-cristina-barcelona.jpg' longdesc='#36492e39'/><figcaption id='36492e39'>Vicky Cristina Barcelona (2008) by Woody Allen</figcaption></figure><p>Why yet another language? Because there are no object-oriented languages on the market that are really object-oriented, to my knowledge. Here are the things I think do not belong in a pure object-oriented language:</p><ul> <li>static methods</li> <li>classes (only types and objects)</li> <li>implementation inheritance</li> <li>mutability</li> <li>NULL</li> <li>reflection</li> <li>constants</li> <li>type casting</li> <li>annotations</li> <li>flow control (<code>for</code>, <code>while</code>, <code>if</code>, etc.)</li></ul><p>And many other minor mistakes that Java and C++ are full of.</p><p>At the moment, we think that EO will compile into Java. Not into byte-code, but into <code>.java</code> files, later compilable to byte-code.</p><p>I really count on your contribution. Please submit your ideas as tickets and pull request to the <a href="https://github.com/yegor256/eo">yegor256/eo</a> GitHub repo.</p></p><nav class="buttons notranslate desktop-only"> <a href="http://www.facebook.com/sharer/sharer.php?u=https://www.yegor256.com/2016/11/29/eolang.html" title="Share on Facebook" class="button" rel="nofollow"> <span class="count count-facebook">0</span> <i class="icon icon-facebook notranslate" aria-hidden="true"></i> </a> <a href="https://twitter.com/share?url=https://www.yegor256.com/2016/11/29/eolang.html&amp;text=EO" title="Share on Twitter" class="button" rel="nofollow"> <span class="count count-twitter">0</span> <i class="icon icon-twitter notranslate" aria-hidden="true"></i> </a> <a href="https://plus.google.com/share?url=https://www.yegor256.com/2016/11/29/eolang.html" title="Share on Google+" class="button" rel="nofollow"> <span class="count count-googleplus">0</span> <i class="icon icon-googleplus notranslate" aria-hidden="true"></i> </a> <a href="https://www.linkedin.com/cws/share?url=https://www.yegor256.com/2016/11/29/eolang.html" title="Share on LinkedIn" class="button" rel="nofollow"> <span class="count count-linkedin">0</span> <i class="icon icon-linkedin notranslate" aria-hidden="true"></i> </a> <a href="http://reddit.com/submit?url=https://www.yegor256.com/2016/11/29/eolang.html%3F2016-48&amp;title=EO" title="Share on Reddit" class="button" rel="nofollow"> <span class="count count-reddit">0</span> <i class="icon icon-reddit notranslate" aria-hidden="true"></i> </a> <a href="http://news.ycombinator.com/submitlink?u=https://www.yegor256.com/2016/11/29/eolang.html%3F2016-48&amp;t=EO" title="Share on Hacker News" class="button" rel="nofollow"> <span class="count count-hackernews">0</span> <i class="icon icon-hackernews notranslate" aria-hidden="true"></i> </a> </nav> </header> <article class="main" itemprop="articleBody"><div ><p>It&#39;s time to do it! We&#39;ve started work on a new programming language. Its name is <strong>EO</strong> (as in <a href="/elegant-objects.html">Elegant Objects</a> or in <a href="https://en.wikipedia.org/wiki/Esperanto">Esperanto</a>): <a href="http://www.eolang.org">eolang.org</a>. It&#39;s open source and community driven: <a href="https://github.com/yegor256/eo">yegor256/eo</a> GitHub repo. It&#39;s still in very early draft form, but the direction is more or less clear: It has to be truly object-oriented, with no compromises. You&#39;re welcome to join us.</p><figure class='jb_picture'><img itemprop='image' alt='Vicky Cristina Barcelona (2008) by Woody Allen' src='/images/2016/11/vicky-cristina-barcelona.jpg' longdesc='#36492e39'/><figcaption id='36492e39'>Vicky Cristina Barcelona (2008) by Woody Allen</figcaption></figure><p>Why yet another language? Because there are no object-oriented languages on the market that are really object-oriented, to my knowledge. Here are the things I think do not belong in a pure object-oriented language:</p><ul> <li>static methods</li> <li>classes (only types and objects)</li> <li>implementation inheritance</li> <li>mutability</li> <li>NULL</li> <li>reflection</li> <li>constants</li> <li>type casting</li> <li>annotations</li> <li>flow control (<code>for</code>, <code>while</code>, <code>if</code>, etc.)</li></ul><p>And many other minor mistakes that Java and C++ are full of.</p><p>At the moment, we think that EO will compile into Java. Not into byte-code, but into <code>.java</code> files, later compilable to byte-code.</p><p>I really count on your contribution. Please submit your ideas as tickets and pull request to the <a href="https://github.com/yegor256/eo">yegor256/eo</a> GitHub repo.</p></div></article></div><div class="wrapper"> <related-posts /></div><div class="disqus" role="complementary"><p class="disqus_hint"> Please, use <a href="https://help.disqus.com/commenting/what-html-tags-are-allowed-within-comments">syntax highlighting</a> in your comments, to make them more readable.</p><div id="disqus_thread" class="disqus-thread"> <a>&nbsp;</a></div><script> var disqus_config = function () { this.page.url = document.location.href.split('?')[0].split('#')[0].replace('https://', 'http://'); this.page.identifier = this.page.url; }; (function() { var d = document, s = d.createElement('script'); s.src = '//yegor256.disqus.com/embed.js'; s.setAttribute('data-timestamp', +new Date()); (d.head || d.body).appendChild(s); })(); </script> <noscript><div><p class="red"> JavaScript is disabled in your browser, that's why you can't see comments under this post.</p></div></noscript></div><div class="wrapper"> <footer class="footer"><p> &copy; <span itemscope="" itemprop="copyrightHolder" itemtype="http://schema.org/Person"> <span itemprop="name">Yegor Bugayenko</span> </span> 2014&ndash;<span itemprop="copyrightYear">2018</span></p></footer></div></section><div class="wrapper unprintable" style="text-align:center;margin-top:2em;"> <a href="http://www.sixnines.io/h/3ba1652f"> <img src="//www.sixnines.io/b/3ba1652f?style=flat" alt="sixnines availability badge"/> </a></div><script src="//code.jquery.com/jquery-1.9.0.min.js"></script> <script src="/js/all.js?a0e0d018c07"></script> <script>var disqus_shortname = 'yegor256';</script> <script id="dsq-count-scr" src="//yegor256.disqus.com/count.js" async="async"></script> <script> (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){ (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o), m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m) })(window,document,'script','//www.google-analytics.com/analytics.js','ga'); ga('create', 'UA-1963507-32', 'auto'); ga('send', 'pageview'); </script> <script> Cd=document;Cr="&"+Math.random();Cp="&s=1"; Cd.cookie="b=b";if(Cd.cookie)Cp+="&c=1"; Cp+="&t="+(new Date()).getTimezoneOffset(); if(self!=top)Cp+="&f=1"; </script> <script> if(navigator.javaEnabled())Cp+="&j=1"; </script> <script> if(typeof(screen)!='undefined')Cp+="&w="+screen.width+"&h="+ screen.height+"&d="+(screen.colorDepth?screen.colorDepth:screen.pixelDepth); </script> <script> Cd.write("<img src='//c.hit.ua/hit?i=95870&g=0&x=2"+Cp+Cr+ "&r="+escape(Cd.referrer)+"&u="+escape(window.location.href)+ "' border='0' wi"+"dth='1' he"+"ight='1'/>"); </script> <script type="application/ld+json"> { "@context": "http://schema.org", "@type": "Person", "name": "Yegor Bugayenko", "url": "http://www.yegor256.com", "sameAs": [ "https://www.facebook.com/yegor256", "https://instagram.com/yegor256", "https://www.linkedin.com/in/yegor256", "https://twitter.com/yegor256", "https://github.com/yegor256", "https://www.pinterest.com/yegor256/" ] } </script> </body> </html> <!DOCTYPE html> <html xmlns="http://www.w3.org/1999/xhtml" lang="en-US" xml:lang="en-US" itemscope="" itemtype="http://schema.org/WebSite"> <head> <meta charset="utf-8"/> <meta name="description" content="Encapsulation is what makes OOP objects solid, cohesive, and trustworthy; publicly accessible data is what breaks encapsulation. " /> <meta name="keywords" content="encapsulation, encapsulation data, encapsulation meaning, encapsulation trusted objects, encapsulation violation" /> <meta name="viewport" content="width=device-width,minimum-scale=1,initial-scale=1"/> <meta name="google-site-verification" content="JEj_gQr2CPe2QKGw8XdMz0R7VboQIUbX3FlM-lwTq-8" /> <meta name="author" content="Yegor Bugayenko"> <meta name="article:published_time" content="2016-11-21 00:00:00 +0000"> <meta name="og:site_name" content="Yegor Bugayenko"/> <meta name="og:type" content="article" /> <meta name="og:locale" content="en_US" /> <meta name="twitter:account_id" content="4503599630178231" /> <meta name="twitter:creator" content="@yegor256"/> <meta name="twitter:site" content="@yegor256"/> <meta name="twitter:title" property="og:title" content="Encapsulation Covers Up Naked&nbsp;Data"/> <meta name="twitter:description" property="og:description" content="Encapsulation is what makes OOP objects solid, cohesive, and trustworthy; publicly accessible data is what breaks encapsulation. "/> <meta name="twitter:url" property="og:url" content="https://www.yegor256.com/2016/11/21/naked-data.html"/> <meta name="telegram:channel" content="AAAAAEJFMRzsRTRxM3ec6A"/> <link rel="search" type="application/opensearchdescription+xml" href="/opensearch.xml" title="yegor256" /> <link rel="shortcut icon" href="/favicon.ico?a0e0d018c07"/> <link rel="apple-touch-icon" href="/favicon.ico?a0e0d018c07"/> <link rel="alternate" type="application/rss+xml" title="RSS for yegor256.com" href="https://www.yegor256.com/rss.xml"/> <link rel="stylesheet" href="/css/layout.css?a0e0d018c07"/> <link rel="stylesheet" href="/css/icons.css?a0e0d018c07"/> <link rel="canonical" href="https://www.yegor256.com/2016/11/21/naked-data.html" /> <link rel="amphtml" href="https://www.yegor256.com/2016/11/21/naked-data.amp.html" /> <title>Encapsulation Covers Up Naked&nbsp;Data </title> <meta name='og:image' content='https://www.yegor256.com/images/2016/11/borat.jpg'/><meta name='twitter:image' content='https://www.yegor256.com/images/2016/11/borat.jpg'/><meta name='og:image:width' content='1280'/> <meta name='twitter:image:width' content='1280'/><meta name='og:image:height' content='688'/> <meta name='twitter:image:height' content='688'/><meta name='twitter:card' content='summary_large_image'/><meta name='twitter:image:alt' content='Borat: Cultural Learnings of America for Make Benefit Glorious Nation of Kazakhstan (2006) by Larry Charles'/> </head> <body><div class="wrapper"> <aside class="header-toggle unprintable" id="header-toggle" title="Show the menu" onclick="$('#header').show();$('#header-toggle').hide();">&#9776;</aside> <header class="header" id="header"><div class="face"> <a href="/about-me.html#form" class="sub" title="Click to subscribe to my monthly newsletter"><span>Subscribe</span></a> <a href="/about-me.html" style="position:relative;"> <img src="/images/face-256x256.jpg" class="photo" alt="Yegor Bugayenko"/> </a></div><nav><ul class="menu social notranslate"> <li><a href="https://twitter.com/intent/follow?screen_name=yegor256" rel="nofollow" title="Follow me on Twitter"><i class="icon icon-twitter notranslate" aria-hidden="true"></i></a></li> <li><a href="/rss.xml" rel="nofollow" title="Subscribe to my RSS feed"><i class="icon icon-rss notranslate" aria-hidden="true"></i></a></li> <li><a itemprop="sameAs" href="https://github.com/yegor256" rel="nofollow" title="My GitHub profile"><i class="icon icon-github notranslate" aria-hidden="true"></i></a></li> <li><a itemprop="sameAs" href="http://stackoverflow.com/users/187141/yegor256" rel="nofollow" title="My StackOverflow profile"><i class="icon icon-stackoverflow notranslate" aria-hidden="true"></i></a></li> <li><a itemprop="sameAs" href="https://www.facebook.com/yegor256" rel="nofollow" title="Follow me on Facebook"><i class="icon icon-facebook notranslate" aria-hidden="true"></i></a></li> <li><a itemprop="sameAs" href="https://instagram.com/yegor256" rel="nofollow" title="Follow me on Instagram"><i class="icon icon-instagram notranslate" aria-hidden="true"></i></a></li> <li><a itemprop="sameAs" href="https://www.linkedin.com/in/yegor256" rel="nofollow" title="My LinkedIn profile"><i class="icon icon-linkedin notranslate" aria-hidden="true"></i></a></li> <li><a itemprop="sameAs" href="https://www.youtube.com/c/yegor256?sub_confirmation=1" rel="nofollow" title="My Youtube video channel"><i class="icon icon-youtube notranslate" aria-hidden="true"></i></a></li> <li><a itemprop="sameAs" href="https://www.pinterest.com/yegor256/" rel="nofollow" title="My Pinterest boards"><i class="icon icon-pinterest notranslate" aria-hidden="true"></i></a></li> <li><a itemprop="sameAs" href="https://angel.co/yegor256" rel="nofollow" title="My AngelList profile"><i class="icon icon-angellist notranslate" aria-hidden="true"></i></a></li> <li><a href="https://soundcloud.com/yegor256" rel="nofollow" title="My podcast"><i class="icon icon-podcast notranslate" aria-hidden="true"></i></a></li> <li><a href="https://itunes.apple.com/us/podcast/yegor256-podcast/id1150826721" rel="nofollow" title="My iTunes podcast"><i class="icon icon-itunes notranslate" aria-hidden="true"></i></a></li> <li><a href="https://t.me/joinchat/AAAAAEJFMRzsRTRxM3ec6A" rel="nofollow" title="My Telegram public channel"><i class="icon icon-telegram notranslate" aria-hidden="true"></i></a></li> <li><a href="mailto:blog@yegor256.com" rel="nofollow" title="Email me any time"><i class="icon icon-mail notranslate" aria-hidden="true"></i></a></li></ul><ul class="menu"> <li><a href="/" title="Home page">Home</a></li> <li ><a href="/best.html" title="Best articles to read">12&#160;Best</a></li> <li ><a href="/contents.html" title="The contents of the entire blog">All&#160;288</a></li> <li ><a href="/webinars.html" title="My webinars">Webinars</a></li> <li ><a href="/talks.html" title="Future and past conference talks">Talks</a></li> <li ><a href="/books.html" title="The books I wrote">Books</a></li> <li ><a href="/papers.html" title="My academic papers and patents">Papers</a></li> <li ><a href="/pets.html" title="My loved pet projects">Pets</a></li> <li ><a href="/award.html" title="Software quality award">Award</a></li> <li ><a href="/testimonials.html" title="What some people say about me">Testimonials</a></li> <li ><a href="/shift-m.html" title="Audio podcast about project management">Shift-M</a></li> <li ><a href="/paintings.html" title="My paintings for sale">Paintings</a></li> <li><a href="http://ru.yegor256.com/" title="Немного на русском языке">По-русски</a></li></ul></nav><div class="search"> <form method="get" action="https://www.google.com/search" itemprop="potentialAction" itemscope="" itemtype="http://schema.org/SearchAction"> <meta itemprop="target" content="https://www.google.com/search?q={q}"/> <input name="sitesearch" value="yegor256.com" type="hidden"/> <input itemprop="query-input" type="text" id="search-query" class="field field-text" required="required" onfocus="$('.google').css('visibility', 'visible');" name="q" placeholder="Search..." autocomplete="off"/> <input type="image" src="/images/google-search-icon.svg" class="google" title="Search via Google" alt="Search via Google"/> </form></div><div class="hot"><ul> <li> <a href="/code-ahead.html">Code Ahead</a> was published on Amazon just a few days ago! It is my new book, a novel about programmers. It explains in details the majority of ideas that stand behind <a href="https://www.zerocracy.com">Zerocracy</a> and <a href="https://www.xdsd.org">XDSD</a>. </li> <li> At <a href="/webinars.html">Webinar #37</a> we will discuss naming problem in OOP, for objects, methods and attributes; join us on <b>September 12</b>, at 11am PST. </li></ul></div></header></div><section itemscope="" itemtype="http://schema.org/BlogPosting"><div class="wrapper"> <header><p class="printable"> <img src="https://api.qrserver.com/v1/create-qr-code/?data=https://www.yegor256.com/2016/11/21/naked-data.html&amp;format=svg" style="width:125px;height:125px;" alt="QR code"/></p><p class="printable"> <code itemprop="url">https://www.yegor256.com/2016/11/21/naked-data.html</code></p><h1 itemprop="name headline mainEntityOfPage">Encapsulation Covers Up Naked&nbsp;Data</h1><ul class="subline"> <li> <time itemprop="datePublished" datetime="2016-11-21T00:00:00+00:00"> 21 November 2016 </time> </li> <li class="desktop-only" itemprop="locationCreated">Moscow, Russia</li> <li class="printable" itemscope="" itemprop="author" itemtype="http://schema.org/Person"> <span itemprop="name">Yegor Bugayenko</span> </li> <li class="unprintable"> <i class="icon icon-comments"></i> <a href="http://www.yegor256.com/2016/11/21/naked-data.html#disqus_thread" itemprop="discussionUrl">comments</a> </li></ul><p class="unprintable"><p>Encapsulation is the core principle of object-oriented programming that makes objects solid, cohesive, trustworthy, etc. But what exactly is encapsulation? Does it only protect against access to private attributes from outside an object? I think it&#39;s much more. Encapsulation leads to the absence of <em>naked</em> data on all levels and in all forms.</p><figure class='jb_picture'><img itemprop='image' alt='Borat: Cultural Learnings of America for Make Benefit Glorious Nation of Kazakhstan (2006) by Larry Charles' src='/images/2016/11/borat.jpg' longdesc='#30fc8a97'/><figcaption id='30fc8a97'>Borat: Cultural Learnings of America for Make Benefit Glorious Nation of Kazakhstan (2006) by Larry Charles</figcaption></figure><p>This is what naked data is (C code):</p><figure class="highlight"><pre><code class="language-c" data-lang="c"><span></span><span class="kt">int</span> <span class="n">t</span><span class="p">;</span>
<span class="n">t</span> <span class="o">=</span> <span class="mi">85</span><span class="p">;</span>
<span class="n">printf</span><span class="p">(</span><span class="s">&quot;The temperature is %d F&quot;</span><span class="p">,</span> <span class="n">t</span><span class="p">);</span></code></pre></figure><p>Here <code>t</code> is the data, which is publicly accessible by the code around it. Anyone can modify it or read it.</p><p>Why is that bad? For one reason: tight and hidden coupling.</p><p>The code around <code>t</code> inevitably makes a lot of assumptions about the data. For example, both lines after <code>int t</code> decided that the temperature is in Fahrenheit. At the moment of writing, this may be true, but this assumption couples the code with the data. If tomorrow we change <code>t</code> to Celsius, the code won&#39;t know about this change. That&#39;s why I call this coupling <em>hidden</em>.</p><aside class='youtube'> <a href='https://www.youtube.com/watch?v=Nm274dGikFc'><div class='box'> <img src='https://i.ytimg.com/vi/Nm274dGikFc/mqdefault.jpg' alt='YouTube video #Nm274dGikFc'/><div class='play'><i class='icon icon-play'></i></div></div></a><div>Naked Data in OOP (webinar #22); 15 March 2017.</div></aside><p>If we change the type of <code>t</code> from <code>int</code> to, say, <code>double</code>, the <code>printf</code> line won&#39;t print anything after the decimal point. Again, the coupling is there, but it&#39;s hidden. Later on, we simply won&#39;t be able to find all the places in our code where we made these or other assumptions about <code>t</code>.</p><p>This will seriously affect maintainability.</p><p>And this is not a solution, as you can imagine (Java now):</p><figure class="highlight"><pre><code class="language-java" data-lang="java"><span></span><span class="kd">class</span> <span class="nc">Temperature</span> <span class="o">{</span>
  <span class="kd">private</span> <span class="kt">int</span> <span class="n">t</span><span class="o">;</span>
  <span class="kd">public</span> <span class="kt">int</span> <span class="nf">getT</span><span class="o">()</span> <span class="o">{</span> <span class="k">return</span> <span class="k">this</span><span class="o">.</span><span class="na">t</span><span class="o">;</span> <span class="o">}</span>
  <span class="kd">public</span> <span class="kt">void</span> <span class="nf">setT</span><span class="o">(</span><span class="kt">int</span> <span class="n">t</span><span class="o">)</span> <span class="o">{</span> <span class="k">this</span><span class="o">.</span><span class="na">t</span> <span class="o">=</span> <span class="n">t</span><span class="o">;</span> <span class="o">}</span>
<span class="o">}</span></code></pre></figure><p>It looks like an object, but the data is still naked. Anyone can retrieve <code>t</code> from the object and decide whether it&#39;s Fahrenheit or Celsius, whether it has digits after the dot or not, etc. This is not encapsulation yet!</p><p>The only way to encapsulate <code>t</code> is to make sure nobody can touch it either directly or by retrieving it from an object. How do we do that? Just stop exposing data and start exposing functionality. Here is how, for example:</p><figure class="highlight"><pre><code class="language-java" data-lang="java"><span></span><span class="kd">class</span> <span class="nc">Temperature</span> <span class="o">{</span>
  <span class="kd">private</span> <span class="kt">int</span> <span class="n">t</span><span class="o">;</span>
  <span class="kd">public</span> <span class="n">String</span> <span class="nf">toString</span><span class="o">()</span> <span class="o">{</span>
    <span class="k">return</span> <span class="n">String</span><span class="o">.</span><span class="na">format</span><span class="o">(</span><span class="s">&quot;%d F&quot;</span><span class="o">,</span> <span class="k">this</span><span class="o">.</span><span class="na">t</span><span class="o">);</span>
  <span class="o">}</span>
<span class="o">}</span></code></pre></figure><p>We don&#39;t allow anyone to retrieve <code>t</code> anymore. All they can do is convert temperature to text. If and when we decide to change <code>t</code> to Celsius, we will do it just once and in one place: in the class <code>Temperature</code>.</p><aside class='quote'>Any data elements that escape objects are naked and lead to maintainability problems</aside><p>If we need other functions in the future, like math operations or conversion to Celsius, we add more methods to class <code>Temperature</code>. But we never let anyone touch or know about <code>t</code>.</p><p>This idea is close to &quot;<a href="/2016/04/05/printers-instead-of-getters.html">printers instead of getters</a>,&quot; which we discussed earlier, though from a much wider perspective. Here I&#39;m saying that any data elements that escape objects are <em>naked</em> and lead to maintainability problems.</p><p>The question is how we can work entirely without naked data, right? Eventually we have to let objects exchange data, don&#39;t we? Yes, that&#39;s true. But not entirely. I&#39;ll explain that in <a href="/2016/12/20/can-objects-be-friends.html">my next post</a>.</p></p><nav class="buttons notranslate desktop-only"> <a href="http://www.facebook.com/sharer/sharer.php?u=https://www.yegor256.com/2016/11/21/naked-data.html" title="Share on Facebook" class="button" rel="nofollow"> <span class="count count-facebook">0</span> <i class="icon icon-facebook notranslate" aria-hidden="true"></i> </a> <a href="https://twitter.com/share?url=https://www.yegor256.com/2016/11/21/naked-data.html&amp;text=Encapsulation+Covers+Up+Naked%26nbsp%3BData" title="Share on Twitter" class="button" rel="nofollow"> <span class="count count-twitter">0</span> <i class="icon icon-twitter notranslate" aria-hidden="true"></i> </a> <a href="https://plus.google.com/share?url=https://www.yegor256.com/2016/11/21/naked-data.html" title="Share on Google+" class="button" rel="nofollow"> <span class="count count-googleplus">0</span> <i class="icon icon-googleplus notranslate" aria-hidden="true"></i> </a> <a href="https://www.linkedin.com/cws/share?url=https://www.yegor256.com/2016/11/21/naked-data.html" title="Share on LinkedIn" class="button" rel="nofollow"> <span class="count count-linkedin">0</span> <i class="icon icon-linkedin notranslate" aria-hidden="true"></i> </a> <a href="http://reddit.com/submit?url=https://www.yegor256.com/2016/11/21/naked-data.html%3F2016-47&amp;title=Encapsulation+Covers+Up+Naked%26nbsp%3BData" title="Share on Reddit" class="button" rel="nofollow"> <span class="count count-reddit">0</span> <i class="icon icon-reddit notranslate" aria-hidden="true"></i> </a> <a href="http://news.ycombinator.com/submitlink?u=https://www.yegor256.com/2016/11/21/naked-data.html%3F2016-47&amp;t=Encapsulation+Covers+Up+Naked%26nbsp%3BData" title="Share on Hacker News" class="button" rel="nofollow"> <span class="count count-hackernews">0</span> <i class="icon icon-hackernews notranslate" aria-hidden="true"></i> </a> </nav> </header> <article class="main" itemprop="articleBody"><div ><p>Encapsulation is the core principle of object-oriented programming that makes objects solid, cohesive, trustworthy, etc. But what exactly is encapsulation? Does it only protect against access to private attributes from outside an object? I think it&#39;s much more. Encapsulation leads to the absence of <em>naked</em> data on all levels and in all forms.</p><figure class='jb_picture'><img itemprop='image' alt='Borat: Cultural Learnings of America for Make Benefit Glorious Nation of Kazakhstan (2006) by Larry Charles' src='/images/2016/11/borat.jpg' longdesc='#30fc8a97'/><figcaption id='30fc8a97'>Borat: Cultural Learnings of America for Make Benefit Glorious Nation of Kazakhstan (2006) by Larry Charles</figcaption></figure><p>This is what naked data is (C code):</p><figure class="highlight"><pre><code class="language-c" data-lang="c"><span></span><span class="kt">int</span> <span class="n">t</span><span class="p">;</span>
<span class="n">t</span> <span class="o">=</span> <span class="mi">85</span><span class="p">;</span>
<span class="n">printf</span><span class="p">(</span><span class="s">&quot;The temperature is %d F&quot;</span><span class="p">,</span> <span class="n">t</span><span class="p">);</span></code></pre></figure><p>Here <code>t</code> is the data, which is publicly accessible by the code around it. Anyone can modify it or read it.</p><p>Why is that bad? For one reason: tight and hidden coupling.</p><p>The code around <code>t</code> inevitably makes a lot of assumptions about the data. For example, both lines after <code>int t</code> decided that the temperature is in Fahrenheit. At the moment of writing, this may be true, but this assumption couples the code with the data. If tomorrow we change <code>t</code> to Celsius, the code won&#39;t know about this change. That&#39;s why I call this coupling <em>hidden</em>.</p><aside class='youtube'> <a href='https://www.youtube.com/watch?v=Nm274dGikFc'><div class='box'> <img src='https://i.ytimg.com/vi/Nm274dGikFc/mqdefault.jpg' alt='YouTube video #Nm274dGikFc'/><div class='play'><i class='icon icon-play'></i></div></div></a><div>Naked Data in OOP (webinar #22); 15 March 2017.</div></aside><p>If we change the type of <code>t</code> from <code>int</code> to, say, <code>double</code>, the <code>printf</code> line won&#39;t print anything after the decimal point. Again, the coupling is there, but it&#39;s hidden. Later on, we simply won&#39;t be able to find all the places in our code where we made these or other assumptions about <code>t</code>.</p><p>This will seriously affect maintainability.</p><p>And this is not a solution, as you can imagine (Java now):</p><figure class="highlight"><pre><code class="language-java" data-lang="java"><span></span><span class="kd">class</span> <span class="nc">Temperature</span> <span class="o">{</span>
  <span class="kd">private</span> <span class="kt">int</span> <span class="n">t</span><span class="o">;</span>
  <span class="kd">public</span> <span class="kt">int</span> <span class="nf">getT</span><span class="o">()</span> <span class="o">{</span> <span class="k">return</span> <span class="k">this</span><span class="o">.</span><span class="na">t</span><span class="o">;</span> <span class="o">}</span>
  <span class="kd">public</span> <span class="kt">void</span> <span class="nf">setT</span><span class="o">(</span><span class="kt">int</span> <span class="n">t</span><span class="o">)</span> <span class="o">{</span> <span class="k">this</span><span class="o">.</span><span class="na">t</span> <span class="o">=</span> <span class="n">t</span><span class="o">;</span> <span class="o">}</span>
<span class="o">}</span></code></pre></figure><p>It looks like an object, but the data is still naked. Anyone can retrieve <code>t</code> from the object and decide whether it&#39;s Fahrenheit or Celsius, whether it has digits after the dot or not, etc. This is not encapsulation yet!</p><p>The only way to encapsulate <code>t</code> is to make sure nobody can touch it either directly or by retrieving it from an object. How do we do that? Just stop exposing data and start exposing functionality. Here is how, for example:</p><figure class="highlight"><pre><code class="language-java" data-lang="java"><span></span><span class="kd">class</span> <span class="nc">Temperature</span> <span class="o">{</span>
  <span class="kd">private</span> <span class="kt">int</span> <span class="n">t</span><span class="o">;</span>
  <span class="kd">public</span> <span class="n">String</span> <span class="nf">toString</span><span class="o">()</span> <span class="o">{</span>
    <span class="k">return</span> <span class="n">String</span><span class="o">.</span><span class="na">format</span><span class="o">(</span><span class="s">&quot;%d F&quot;</span><span class="o">,</span> <span class="k">this</span><span class="o">.</span><span class="na">t</span><span class="o">);</span>
  <span class="o">}</span>
<span class="o">}</span></code></pre></figure><p>We don&#39;t allow anyone to retrieve <code>t</code> anymore. All they can do is convert temperature to text. If and when we decide to change <code>t</code> to Celsius, we will do it just once and in one place: in the class <code>Temperature</code>.</p><aside class='quote'>Any data elements that escape objects are naked and lead to maintainability problems</aside><p>If we need other functions in the future, like math operations or conversion to Celsius, we add more methods to class <code>Temperature</code>. But we never let anyone touch or know about <code>t</code>.</p><p>This idea is close to &quot;<a href="/2016/04/05/printers-instead-of-getters.html">printers instead of getters</a>,&quot; which we discussed earlier, though from a much wider perspective. Here I&#39;m saying that any data elements that escape objects are <em>naked</em> and lead to maintainability problems.</p><p>The question is how we can work entirely without naked data, right? Eventually we have to let objects exchange data, don&#39;t we? Yes, that&#39;s true. But not entirely. I&#39;ll explain that in <a href="/2016/12/20/can-objects-be-friends.html">my next post</a>.</p></div></article></div><div class="wrapper"> <related-posts /></div><div class="disqus" role="complementary"><p class="disqus_hint"> Please, use <a href="https://help.disqus.com/commenting/what-html-tags-are-allowed-within-comments">syntax highlighting</a> in your comments, to make them more readable.</p><div id="disqus_thread" class="disqus-thread"> <a>&nbsp;</a></div><script> var disqus_config = function () { this.page.url = document.location.href.split('?')[0].split('#')[0].replace('https://', 'http://'); this.page.identifier = this.page.url; }; (function() { var d = document, s = d.createElement('script'); s.src = '//yegor256.disqus.com/embed.js'; s.setAttribute('data-timestamp', +new Date()); (d.head || d.body).appendChild(s); })(); </script> <noscript><div><p class="red"> JavaScript is disabled in your browser, that's why you can't see comments under this post.</p></div></noscript></div><div class="wrapper"> <footer class="footer"><p> &copy; <span itemscope="" itemprop="copyrightHolder" itemtype="http://schema.org/Person"> <span itemprop="name">Yegor Bugayenko</span> </span> 2014&ndash;<span itemprop="copyrightYear">2018</span></p></footer></div></section><div class="wrapper unprintable" style="text-align:center;margin-top:2em;"> <a href="http://www.sixnines.io/h/3ba1652f"> <img src="//www.sixnines.io/b/3ba1652f?style=flat" alt="sixnines availability badge"/> </a></div><script src="//code.jquery.com/jquery-1.9.0.min.js"></script> <script src="/js/all.js?a0e0d018c07"></script> <script>var disqus_shortname = 'yegor256';</script> <script id="dsq-count-scr" src="//yegor256.disqus.com/count.js" async="async"></script> <script> (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){ (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o), m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m) })(window,document,'script','//www.google-analytics.com/analytics.js','ga'); ga('create', 'UA-1963507-32', 'auto'); ga('send', 'pageview'); </script> <script> Cd=document;Cr="&"+Math.random();Cp="&s=1"; Cd.cookie="b=b";if(Cd.cookie)Cp+="&c=1"; Cp+="&t="+(new Date()).getTimezoneOffset(); if(self!=top)Cp+="&f=1"; </script> <script> if(navigator.javaEnabled())Cp+="&j=1"; </script> <script> if(typeof(screen)!='undefined')Cp+="&w="+screen.width+"&h="+ screen.height+"&d="+(screen.colorDepth?screen.colorDepth:screen.pixelDepth); </script> <script> Cd.write("<img src='//c.hit.ua/hit?i=95870&g=0&x=2"+Cp+Cr+ "&r="+escape(Cd.referrer)+"&u="+escape(window.location.href)+ "' border='0' wi"+"dth='1' he"+"ight='1'/>"); </script> <script type="application/ld+json"> { "@context": "http://schema.org", "@type": "Person", "name": "Yegor Bugayenko", "url": "http://www.yegor256.com", "sameAs": [ "https://www.facebook.com/yegor256", "https://instagram.com/yegor256", "https://www.linkedin.com/in/yegor256", "https://twitter.com/yegor256", "https://github.com/yegor256", "https://www.pinterest.com/yegor256/" ] } </script> </body> </html> <!DOCTYPE html> <html xmlns="http://www.w3.org/1999/xhtml" lang="en-US" xml:lang="en-US" itemscope="" itemtype="http://schema.org/WebSite"> <head> <meta charset="utf-8"/> <meta name="description" content="Do we really need classes in OOP? Maybe it&apos;s possible to just have objects, and types. And, of course, no implementation inheritance. " /> <meta name="keywords" content="class in oop, classes in oop, object-oriented programming, role of class in oop, what is class in oop" /> <meta name="viewport" content="width=device-width,minimum-scale=1,initial-scale=1"/> <meta name="google-site-verification" content="JEj_gQr2CPe2QKGw8XdMz0R7VboQIUbX3FlM-lwTq-8" /> <meta name="author" content="Yegor Bugayenko"> <meta name="article:published_time" content="2016-09-20 00:00:00 +0000"> <meta name="og:site_name" content="Yegor Bugayenko"/> <meta name="og:type" content="article" /> <meta name="og:locale" content="en_US" /> <meta name="twitter:account_id" content="4503599630178231" /> <meta name="twitter:creator" content="@yegor256"/> <meta name="twitter:site" content="@yegor256"/> <meta name="twitter:title" property="og:title" content="OOP Without Classes?"/> <meta name="twitter:description" property="og:description" content="Do we really need classes in OOP? Maybe it&apos;s possible to just have objects, and types. And, of course, no implementation inheritance. "/> <meta name="twitter:url" property="og:url" content="https://www.yegor256.com/2016/09/20/oop-without-classes.html"/> <meta name="telegram:channel" content="AAAAAEJFMRzsRTRxM3ec6A"/> <link rel="search" type="application/opensearchdescription+xml" href="/opensearch.xml" title="yegor256" /> <link rel="shortcut icon" href="/favicon.ico?a0e0d018c07"/> <link rel="apple-touch-icon" href="/favicon.ico?a0e0d018c07"/> <link rel="alternate" type="application/rss+xml" title="RSS for yegor256.com" href="https://www.yegor256.com/rss.xml"/> <link rel="stylesheet" href="/css/layout.css?a0e0d018c07"/> <link rel="stylesheet" href="/css/icons.css?a0e0d018c07"/> <link rel="canonical" href="https://www.yegor256.com/2016/09/20/oop-without-classes.html" /> <link rel="amphtml" href="https://www.yegor256.com/2016/09/20/oop-without-classes.amp.html" /> <title>OOP Without Classes? </title> <meta name='og:image' content='https://www.yegor256.com/images/2016/09/battleship-potemkin.jpg'/><meta name='twitter:image' content='https://www.yegor256.com/images/2016/09/battleship-potemkin.jpg'/><meta name='og:image:width' content='1200'/> <meta name='twitter:image:width' content='1200'/><meta name='og:image:height' content='816'/> <meta name='twitter:image:height' content='816'/><meta name='twitter:card' content='summary_large_image'/><meta name='twitter:image:alt' content='Battleship Potemkin (1925) by Sergei M. Eisenstein'/> </head> <body><div class="wrapper"> <aside class="header-toggle unprintable" id="header-toggle" title="Show the menu" onclick="$('#header').show();$('#header-toggle').hide();">&#9776;</aside> <header class="header" id="header"><div class="face"> <a href="/about-me.html#form" class="sub" title="Click to subscribe to my monthly newsletter"><span>Subscribe</span></a> <a href="/about-me.html" style="position:relative;"> <img src="/images/face-256x256.jpg" class="photo" alt="Yegor Bugayenko"/> </a></div><nav><ul class="menu social notranslate"> <li><a href="https://twitter.com/intent/follow?screen_name=yegor256" rel="nofollow" title="Follow me on Twitter"><i class="icon icon-twitter notranslate" aria-hidden="true"></i></a></li> <li><a href="/rss.xml" rel="nofollow" title="Subscribe to my RSS feed"><i class="icon icon-rss notranslate" aria-hidden="true"></i></a></li> <li><a itemprop="sameAs" href="https://github.com/yegor256" rel="nofollow" title="My GitHub profile"><i class="icon icon-github notranslate" aria-hidden="true"></i></a></li> <li><a itemprop="sameAs" href="http://stackoverflow.com/users/187141/yegor256" rel="nofollow" title="My StackOverflow profile"><i class="icon icon-stackoverflow notranslate" aria-hidden="true"></i></a></li> <li><a itemprop="sameAs" href="https://www.facebook.com/yegor256" rel="nofollow" title="Follow me on Facebook"><i class="icon icon-facebook notranslate" aria-hidden="true"></i></a></li> <li><a itemprop="sameAs" href="https://instagram.com/yegor256" rel="nofollow" title="Follow me on Instagram"><i class="icon icon-instagram notranslate" aria-hidden="true"></i></a></li> <li><a itemprop="sameAs" href="https://www.linkedin.com/in/yegor256" rel="nofollow" title="My LinkedIn profile"><i class="icon icon-linkedin notranslate" aria-hidden="true"></i></a></li> <li><a itemprop="sameAs" href="https://www.youtube.com/c/yegor256?sub_confirmation=1" rel="nofollow" title="My Youtube video channel"><i class="icon icon-youtube notranslate" aria-hidden="true"></i></a></li> <li><a itemprop="sameAs" href="https://www.pinterest.com/yegor256/" rel="nofollow" title="My Pinterest boards"><i class="icon icon-pinterest notranslate" aria-hidden="true"></i></a></li> <li><a itemprop="sameAs" href="https://angel.co/yegor256" rel="nofollow" title="My AngelList profile"><i class="icon icon-angellist notranslate" aria-hidden="true"></i></a></li> <li><a href="https://soundcloud.com/yegor256" rel="nofollow" title="My podcast"><i class="icon icon-podcast notranslate" aria-hidden="true"></i></a></li> <li><a href="https://itunes.apple.com/us/podcast/yegor256-podcast/id1150826721" rel="nofollow" title="My iTunes podcast"><i class="icon icon-itunes notranslate" aria-hidden="true"></i></a></li> <li><a href="https://t.me/joinchat/AAAAAEJFMRzsRTRxM3ec6A" rel="nofollow" title="My Telegram public channel"><i class="icon icon-telegram notranslate" aria-hidden="true"></i></a></li> <li><a href="mailto:blog@yegor256.com" rel="nofollow" title="Email me any time"><i class="icon icon-mail notranslate" aria-hidden="true"></i></a></li></ul><ul class="menu"> <li><a href="/" title="Home page">Home</a></li> <li ><a href="/best.html" title="Best articles to read">12&#160;Best</a></li> <li ><a href="/contents.html" title="The contents of the entire blog">All&#160;288</a></li> <li ><a href="/webinars.html" title="My webinars">Webinars</a></li> <li ><a href="/talks.html" title="Future and past conference talks">Talks</a></li> <li ><a href="/books.html" title="The books I wrote">Books</a></li> <li ><a href="/papers.html" title="My academic papers and patents">Papers</a></li> <li ><a href="/pets.html" title="My loved pet projects">Pets</a></li> <li ><a href="/award.html" title="Software quality award">Award</a></li> <li ><a href="/testimonials.html" title="What some people say about me">Testimonials</a></li> <li ><a href="/shift-m.html" title="Audio podcast about project management">Shift-M</a></li> <li ><a href="/paintings.html" title="My paintings for sale">Paintings</a></li> <li><a href="http://ru.yegor256.com/" title="Немного на русском языке">По-русски</a></li></ul></nav><div class="search"> <form method="get" action="https://www.google.com/search" itemprop="potentialAction" itemscope="" itemtype="http://schema.org/SearchAction"> <meta itemprop="target" content="https://www.google.com/search?q={q}"/> <input name="sitesearch" value="yegor256.com" type="hidden"/> <input itemprop="query-input" type="text" id="search-query" class="field field-text" required="required" onfocus="$('.google').css('visibility', 'visible');" name="q" placeholder="Search..." autocomplete="off"/> <input type="image" src="/images/google-search-icon.svg" class="google" title="Search via Google" alt="Search via Google"/> </form></div><div class="hot"><ul> <li> <a href="/code-ahead.html">Code Ahead</a> was published on Amazon just a few days ago! It is my new book, a novel about programmers. It explains in details the majority of ideas that stand behind <a href="https://www.zerocracy.com">Zerocracy</a> and <a href="https://www.xdsd.org">XDSD</a>. </li> <li> At <a href="/webinars.html">Webinar #37</a> we will discuss naming problem in OOP, for objects, methods and attributes; join us on <b>September 12</b>, at 11am PST. </li></ul></div></header></div><section itemscope="" itemtype="http://schema.org/BlogPosting"><div class="wrapper"> <header><p class="printable"> <img src="https://api.qrserver.com/v1/create-qr-code/?data=https://www.yegor256.com/2016/09/20/oop-without-classes.html&amp;format=svg" style="width:125px;height:125px;" alt="QR code"/></p><p class="printable"> <code itemprop="url">https://www.yegor256.com/2016/09/20/oop-without-classes.html</code></p><h1 itemprop="name headline mainEntityOfPage">OOP Without Classes?</h1><ul class="subline"> <li> <time itemprop="datePublished" datetime="2016-09-20T00:00:00+00:00"> 20 September 2016 </time> </li> <li class="desktop-only" itemprop="locationCreated">Palo Alto, CA</li> <li class="printable" itemscope="" itemprop="author" itemtype="http://schema.org/Person"> <span itemprop="name">Yegor Bugayenko</span> </li> <li class="unprintable"> <i class="icon icon-comments"></i> <a href="http://www.yegor256.com/2016/09/20/oop-without-classes.html#disqus_thread" itemprop="discussionUrl">comments</a> </li></ul><p class="unprintable"><p>I <a href="https://www.youtube.com/watch?v=s-hdZZzMCac">interviewed</a> David West, the author of the <a href="http://amzn.to/266oJr4">Object Thinking</a> book, a few weeks ago, and he said that classes were not meant to be in object-oriented programming at all. He actually said that <a href="https://www.youtube.com/watch?v=RdE-d_EhzmA">earlier</a>; I just didn&#39;t understand him then. The more I&#39;ve thought about this, the more it appears obvious that we indeed do not need classes.</p><figure class='jb_picture'><img itemprop='image' alt='Battleship Potemkin (1925) by Sergei M. Eisenstein' src='/images/2016/09/battleship-potemkin.jpg' longdesc='#fd0de29f'/><figcaption id='fd0de29f'>Battleship Potemkin (1925) by Sergei M. Eisenstein</figcaption></figure><p>Here is a prototype.</p><p>Let&#39;s say we have only <em>types</em> and <em>objects</em>. First, we define a type:</p><figure class="highlight"><pre><code class="language-text" data-lang="text"><span></span>type Book {
  void print();
}</code></pre></figure><p>Then we <em>create</em> an object (pay attention; we don&#39;t &quot;instantiate&quot;):</p><figure class="highlight"><pre><code class="language-text" data-lang="text"><span></span>Book b1 = create Book(&quot;Object Thinking&quot;) {
  String title;
  Book(String t) {
    this.title = t;
  }
  public void print() {
    print(&quot;My title: &quot; + this.title);
  }
}</code></pre></figure><p>Then we create another object, which will behave similarly to the one we already have but with different constructor arguments. We <em>copy</em> an existing one:</p><figure class="highlight"><pre><code class="language-text" data-lang="text"><span></span>Book b2 = copy b1(&quot;Elegant Objects&quot;);</code></pre></figure><p>Libraries will deliver us objects, which we can copy.</p><p>That&#39;s it.</p><p>No <a href="/2016/09/13/inheritance-is-procedural.html">implementation inheritance</a> and no <a href="/2014/05/05/oop-alternative-to-utility-classes.html">static methods</a>, of course. Only <a href="https://en.wikipedia.org/wiki/Subtyping">subtyping</a>.</p><p>Why not?</p></p><nav class="buttons notranslate desktop-only"> <a href="http://www.facebook.com/sharer/sharer.php?u=https://www.yegor256.com/2016/09/20/oop-without-classes.html" title="Share on Facebook" class="button" rel="nofollow"> <span class="count count-facebook">0</span> <i class="icon icon-facebook notranslate" aria-hidden="true"></i> </a> <a href="https://twitter.com/share?url=https://www.yegor256.com/2016/09/20/oop-without-classes.html&amp;text=OOP+Without+Classes%3F" title="Share on Twitter" class="button" rel="nofollow"> <span class="count count-twitter">0</span> <i class="icon icon-twitter notranslate" aria-hidden="true"></i> </a> <a href="https://plus.google.com/share?url=https://www.yegor256.com/2016/09/20/oop-without-classes.html" title="Share on Google+" class="button" rel="nofollow"> <span class="count count-googleplus">0</span> <i class="icon icon-googleplus notranslate" aria-hidden="true"></i> </a> <a href="https://www.linkedin.com/cws/share?url=https://www.yegor256.com/2016/09/20/oop-without-classes.html" title="Share on LinkedIn" class="button" rel="nofollow"> <span class="count count-linkedin">0</span> <i class="icon icon-linkedin notranslate" aria-hidden="true"></i> </a> <a href="http://reddit.com/submit?url=https://www.yegor256.com/2016/09/20/oop-without-classes.html%3F2016-38&amp;title=OOP+Without+Classes%3F" title="Share on Reddit" class="button" rel="nofollow"> <span class="count count-reddit">0</span> <i class="icon icon-reddit notranslate" aria-hidden="true"></i> </a> <a href="http://news.ycombinator.com/submitlink?u=https://www.yegor256.com/2016/09/20/oop-without-classes.html%3F2016-38&amp;t=OOP+Without+Classes%3F" title="Share on Hacker News" class="button" rel="nofollow"> <span class="count count-hackernews">0</span> <i class="icon icon-hackernews notranslate" aria-hidden="true"></i> </a> </nav> </header> <article class="main" itemprop="articleBody"><div ><p>I <a href="https://www.youtube.com/watch?v=s-hdZZzMCac">interviewed</a> David West, the author of the <a href="http://amzn.to/266oJr4">Object Thinking</a> book, a few weeks ago, and he said that classes were not meant to be in object-oriented programming at all. He actually said that <a href="https://www.youtube.com/watch?v=RdE-d_EhzmA">earlier</a>; I just didn&#39;t understand him then. The more I&#39;ve thought about this, the more it appears obvious that we indeed do not need classes.</p><figure class='jb_picture'><img itemprop='image' alt='Battleship Potemkin (1925) by Sergei M. Eisenstein' src='/images/2016/09/battleship-potemkin.jpg' longdesc='#fd0de29f'/><figcaption id='fd0de29f'>Battleship Potemkin (1925) by Sergei M. Eisenstein</figcaption></figure><p>Here is a prototype.</p><p>Let&#39;s say we have only <em>types</em> and <em>objects</em>. First, we define a type:</p><figure class="highlight"><pre><code class="language-text" data-lang="text"><span></span>type Book {
  void print();
}</code></pre></figure><p>Then we <em>create</em> an object (pay attention; we don&#39;t &quot;instantiate&quot;):</p><figure class="highlight"><pre><code class="language-text" data-lang="text"><span></span>Book b1 = create Book(&quot;Object Thinking&quot;) {
  String title;
  Book(String t) {
    this.title = t;
  }
  public void print() {
    print(&quot;My title: &quot; + this.title);
  }
}</code></pre></figure><p>Then we create another object, which will behave similarly to the one we already have but with different constructor arguments. We <em>copy</em> an existing one:</p><figure class="highlight"><pre><code class="language-text" data-lang="text"><span></span>Book b2 = copy b1(&quot;Elegant Objects&quot;);</code></pre></figure><p>Libraries will deliver us objects, which we can copy.</p><p>That&#39;s it.</p><p>No <a href="/2016/09/13/inheritance-is-procedural.html">implementation inheritance</a> and no <a href="/2014/05/05/oop-alternative-to-utility-classes.html">static methods</a>, of course. Only <a href="https://en.wikipedia.org/wiki/Subtyping">subtyping</a>.</p><p>Why not?</p></div></article></div><div class="wrapper"> <related-posts /></div><div class="disqus" role="complementary"><p class="disqus_hint"> Please, use <a href="https://help.disqus.com/commenting/what-html-tags-are-allowed-within-comments">syntax highlighting</a> in your comments, to make them more readable.</p><div id="disqus_thread" class="disqus-thread"> <a>&nbsp;</a></div><script> var disqus_config = function () { this.page.url = document.location.href.split('?')[0].split('#')[0].replace('https://', 'http://'); this.page.identifier = this.page.url; }; (function() { var d = document, s = d.createElement('script'); s.src = '//yegor256.disqus.com/embed.js'; s.setAttribute('data-timestamp', +new Date()); (d.head || d.body).appendChild(s); })(); </script> <noscript><div><p class="red"> JavaScript is disabled in your browser, that's why you can't see comments under this post.</p></div></noscript></div><div class="wrapper"> <footer class="footer"><p> &copy; <span itemscope="" itemprop="copyrightHolder" itemtype="http://schema.org/Person"> <span itemprop="name">Yegor Bugayenko</span> </span> 2014&ndash;<span itemprop="copyrightYear">2018</span></p></footer></div></section><div class="wrapper unprintable" style="text-align:center;margin-top:2em;"> <a href="http://www.sixnines.io/h/3ba1652f"> <img src="//www.sixnines.io/b/3ba1652f?style=flat" alt="sixnines availability badge"/> </a></div><script src="//code.jquery.com/jquery-1.9.0.min.js"></script> <script src="/js/all.js?a0e0d018c07"></script> <script>var disqus_shortname = 'yegor256';</script> <script id="dsq-count-scr" src="//yegor256.disqus.com/count.js" async="async"></script> <script> (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){ (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o), m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m) })(window,document,'script','//www.google-analytics.com/analytics.js','ga'); ga('create', 'UA-1963507-32', 'auto'); ga('send', 'pageview'); </script> <script> Cd=document;Cr="&"+Math.random();Cp="&s=1"; Cd.cookie="b=b";if(Cd.cookie)Cp+="&c=1"; Cp+="&t="+(new Date()).getTimezoneOffset(); if(self!=top)Cp+="&f=1"; </script> <script> if(navigator.javaEnabled())Cp+="&j=1"; </script> <script> if(typeof(screen)!='undefined')Cp+="&w="+screen.width+"&h="+ screen.height+"&d="+(screen.colorDepth?screen.colorDepth:screen.pixelDepth); </script> <script> Cd.write("<img src='//c.hit.ua/hit?i=95870&g=0&x=2"+Cp+Cr+ "&r="+escape(Cd.referrer)+"&u="+escape(window.location.href)+ "' border='0' wi"+"dth='1' he"+"ight='1'/>"); </script> <script type="application/ld+json"> { "@context": "http://schema.org", "@type": "Person", "name": "Yegor Bugayenko", "url": "http://www.yegor256.com", "sameAs": [ "https://www.facebook.com/yegor256", "https://instagram.com/yegor256", "https://www.linkedin.com/in/yegor256", "https://twitter.com/yegor256", "https://github.com/yegor256", "https://www.pinterest.com/yegor256/" ] } </script> </body> </html> <!DOCTYPE html> <html xmlns="http://www.w3.org/1999/xhtml" lang="en-US" xml:lang="en-US" itemscope="" itemtype="http://schema.org/WebSite"> <head> <meta charset="utf-8"/> <meta name="description" content="Inheritance is generally considered a bad practice in object-oriented programming, but why exactly? Here we try to answer that question. " /> <meta name="keywords" content="composition over inheritance, inheritance in oop, inheritance is bad, inheritance over composition, inheritance vs composition" /> <meta name="viewport" content="width=device-width,minimum-scale=1,initial-scale=1"/> <meta name="google-site-verification" content="JEj_gQr2CPe2QKGw8XdMz0R7VboQIUbX3FlM-lwTq-8" /> <meta name="author" content="Yegor Bugayenko"> <meta name="article:published_time" content="2016-09-13 00:00:00 +0000"> <meta name="og:site_name" content="Yegor Bugayenko"/> <meta name="og:type" content="article" /> <meta name="og:locale" content="en_US" /> <meta name="twitter:account_id" content="4503599630178231" /> <meta name="twitter:creator" content="@yegor256"/> <meta name="twitter:site" content="@yegor256"/> <meta name="twitter:title" property="og:title" content="Inheritance Is a Procedural Technique for Code Reuse"/> <meta name="twitter:description" property="og:description" content="Inheritance is generally considered a bad practice in object-oriented programming, but why exactly? Here we try to answer that question. "/> <meta name="twitter:url" property="og:url" content="https://www.yegor256.com/2016/09/13/inheritance-is-procedural.html"/> <meta name="telegram:channel" content="AAAAAEJFMRzsRTRxM3ec6A"/> <link rel="search" type="application/opensearchdescription+xml" href="/opensearch.xml" title="yegor256" /> <link rel="shortcut icon" href="/favicon.ico?a0e0d018c07"/> <link rel="apple-touch-icon" href="/favicon.ico?a0e0d018c07"/> <link rel="alternate" type="application/rss+xml" title="RSS for yegor256.com" href="https://www.yegor256.com/rss.xml"/> <link rel="stylesheet" href="/css/layout.css?a0e0d018c07"/> <link rel="stylesheet" href="/css/icons.css?a0e0d018c07"/> <link rel="canonical" href="https://www.yegor256.com/2016/09/13/inheritance-is-procedural.html" /> <link rel="amphtml" href="https://www.yegor256.com/2016/09/13/inheritance-is-procedural.amp.html" /> <title>Inheritance Is a Procedural Technique for Code Reuse </title> <meta name='og:image' content='https://www.yegor256.com/images/2016/09/death-at-a-funeral.jpg'/><meta name='twitter:image' content='https://www.yegor256.com/images/2016/09/death-at-a-funeral.jpg'/><meta name='og:image:width' content='1200'/> <meta name='twitter:image:width' content='1200'/><meta name='og:image:height' content='668'/> <meta name='twitter:image:height' content='668'/><meta name='twitter:card' content='summary_large_image'/><meta name='twitter:image:alt' content='Death at a Funeral (2007) by Frank Oz'/> </head> <body><div class="wrapper"> <aside class="header-toggle unprintable" id="header-toggle" title="Show the menu" onclick="$('#header').show();$('#header-toggle').hide();">&#9776;</aside> <header class="header" id="header"><div class="face"> <a href="/about-me.html#form" class="sub" title="Click to subscribe to my monthly newsletter"><span>Subscribe</span></a> <a href="/about-me.html" style="position:relative;"> <img src="/images/face-256x256.jpg" class="photo" alt="Yegor Bugayenko"/> </a></div><nav><ul class="menu social notranslate"> <li><a href="https://twitter.com/intent/follow?screen_name=yegor256" rel="nofollow" title="Follow me on Twitter"><i class="icon icon-twitter notranslate" aria-hidden="true"></i></a></li> <li><a href="/rss.xml" rel="nofollow" title="Subscribe to my RSS feed"><i class="icon icon-rss notranslate" aria-hidden="true"></i></a></li> <li><a itemprop="sameAs" href="https://github.com/yegor256" rel="nofollow" title="My GitHub profile"><i class="icon icon-github notranslate" aria-hidden="true"></i></a></li> <li><a itemprop="sameAs" href="http://stackoverflow.com/users/187141/yegor256" rel="nofollow" title="My StackOverflow profile"><i class="icon icon-stackoverflow notranslate" aria-hidden="true"></i></a></li> <li><a itemprop="sameAs" href="https://www.facebook.com/yegor256" rel="nofollow" title="Follow me on Facebook"><i class="icon icon-facebook notranslate" aria-hidden="true"></i></a></li> <li><a itemprop="sameAs" href="https://instagram.com/yegor256" rel="nofollow" title="Follow me on Instagram"><i class="icon icon-instagram notranslate" aria-hidden="true"></i></a></li> <li><a itemprop="sameAs" href="https://www.linkedin.com/in/yegor256" rel="nofollow" title="My LinkedIn profile"><i class="icon icon-linkedin notranslate" aria-hidden="true"></i></a></li> <li><a itemprop="sameAs" href="https://www.youtube.com/c/yegor256?sub_confirmation=1" rel="nofollow" title="My Youtube video channel"><i class="icon icon-youtube notranslate" aria-hidden="true"></i></a></li> <li><a itemprop="sameAs" href="https://www.pinterest.com/yegor256/" rel="nofollow" title="My Pinterest boards"><i class="icon icon-pinterest notranslate" aria-hidden="true"></i></a></li> <li><a itemprop="sameAs" href="https://angel.co/yegor256" rel="nofollow" title="My AngelList profile"><i class="icon icon-angellist notranslate" aria-hidden="true"></i></a></li> <li><a href="https://soundcloud.com/yegor256" rel="nofollow" title="My podcast"><i class="icon icon-podcast notranslate" aria-hidden="true"></i></a></li> <li><a href="https://itunes.apple.com/us/podcast/yegor256-podcast/id1150826721" rel="nofollow" title="My iTunes podcast"><i class="icon icon-itunes notranslate" aria-hidden="true"></i></a></li> <li><a href="https://t.me/joinchat/AAAAAEJFMRzsRTRxM3ec6A" rel="nofollow" title="My Telegram public channel"><i class="icon icon-telegram notranslate" aria-hidden="true"></i></a></li> <li><a href="mailto:blog@yegor256.com" rel="nofollow" title="Email me any time"><i class="icon icon-mail notranslate" aria-hidden="true"></i></a></li></ul><ul class="menu"> <li><a href="/" title="Home page">Home</a></li> <li ><a href="/best.html" title="Best articles to read">12&#160;Best</a></li> <li ><a href="/contents.html" title="The contents of the entire blog">All&#160;288</a></li> <li ><a href="/webinars.html" title="My webinars">Webinars</a></li> <li ><a href="/talks.html" title="Future and past conference talks">Talks</a></li> <li ><a href="/books.html" title="The books I wrote">Books</a></li> <li ><a href="/papers.html" title="My academic papers and patents">Papers</a></li> <li ><a href="/pets.html" title="My loved pet projects">Pets</a></li> <li ><a href="/award.html" title="Software quality award">Award</a></li> <li ><a href="/testimonials.html" title="What some people say about me">Testimonials</a></li> <li ><a href="/shift-m.html" title="Audio podcast about project management">Shift-M</a></li> <li ><a href="/paintings.html" title="My paintings for sale">Paintings</a></li> <li><a href="http://ru.yegor256.com/" title="Немного на русском языке">По-русски</a></li></ul></nav><div class="search"> <form method="get" action="https://www.google.com/search" itemprop="potentialAction" itemscope="" itemtype="http://schema.org/SearchAction"> <meta itemprop="target" content="https://www.google.com/search?q={q}"/> <input name="sitesearch" value="yegor256.com" type="hidden"/> <input itemprop="query-input" type="text" id="search-query" class="field field-text" required="required" onfocus="$('.google').css('visibility', 'visible');" name="q" placeholder="Search..." autocomplete="off"/> <input type="image" src="/images/google-search-icon.svg" class="google" title="Search via Google" alt="Search via Google"/> </form></div><div class="hot"><ul> <li> <a href="/code-ahead.html">Code Ahead</a> was published on Amazon just a few days ago! It is my new book, a novel about programmers. It explains in details the majority of ideas that stand behind <a href="https://www.zerocracy.com">Zerocracy</a> and <a href="https://www.xdsd.org">XDSD</a>. </li> <li> At <a href="/webinars.html">Webinar #37</a> we will discuss naming problem in OOP, for objects, methods and attributes; join us on <b>September 12</b>, at 11am PST. </li></ul></div></header></div><section itemscope="" itemtype="http://schema.org/BlogPosting"><div class="wrapper"> <header><p class="printable"> <img src="https://api.qrserver.com/v1/create-qr-code/?data=https://www.yegor256.com/2016/09/13/inheritance-is-procedural.html&amp;format=svg" style="width:125px;height:125px;" alt="QR code"/></p><p class="printable"> <code itemprop="url">https://www.yegor256.com/2016/09/13/inheritance-is-procedural.html</code></p><h1 itemprop="name headline mainEntityOfPage">Inheritance Is a Procedural Technique for Code Reuse</h1><aside class='book'><a href='http://amzn.to/2pyceWc'><img src='/images/books/elegant-objects/cover.png' class='book-cover' alt='book cover'/></a>Read more about this subject in <a href='http://amzn.to/2pyceWc'>Section&nbsp;5.7</a><br/> of my book<a href='http://amzn.to/2pyceWc'><img src='/images/books/amazon-buy-button.png' class='amazon-button' alt='Click to buy'/></a></aside><ul class="subline"> <li> <time itemprop="datePublished" datetime="2016-09-13T00:00:00+00:00"> 13 September 2016 </time> </li> <li class="desktop-only" itemprop="locationCreated">Palo Alto, CA</li> <li class="printable" itemscope="" itemprop="author" itemtype="http://schema.org/Person"> <span itemprop="name">Yegor Bugayenko</span> </li> <li class="unprintable"> <i class="icon icon-comments"></i> <a href="http://www.yegor256.com/2016/09/13/inheritance-is-procedural.html#disqus_thread" itemprop="discussionUrl">comments</a> </li></ul><ul class="unprintable subline"> <li>Translated:</li> <li><a href="https://bulldogjob.pl/news/288-dziedziczenie-to-technika-proceduralna">Polish</a></li> <li><a href="mailto:translate@yegor256.com">add yours!</a></li></ul><p class="unprintable"><p>We all know that <a href="https://en.wikipedia.org/wiki/Inheritance_(object-oriented_programming)">inheritance</a> is bad and that <a href="https://en.wikipedia.org/wiki/Composition_over_inheritance">composition over inheritance</a> is a <a href="http://programmers.stackexchange.com/questions/65179">good idea</a>, but do we really understand why? In <del>most</del> all articles <a href="https://www.google.com/search?q=inheritance+is+bad">I&#39;ve found</a> addressing this subject, authors have said that inheritance may be harmful to your code, so it&#39;s better not to use it. This &quot;better&quot; part is what bothers me; does it mean that sometimes inheritance makes sense? I interviewed <a href="http://davewest.us/">David West</a> (the author of <a href="http://amzn.to/266oJr4">Object Thinking</a>, my favorite book about OOP) a few weeks ago, and he said that inheritance should not exist in object-oriented programming at all (<a href="https://www.youtube.com/watch?v=s-hdZZzMCac">full video</a>). Maybe Dr. West is right and we should totally forget <code>extends</code> keyword in Java, for example.</p><figure class='jb_picture'><img itemprop='image' alt='Death at a Funeral (2007) by Frank Oz' src='/images/2016/09/death-at-a-funeral.jpg' longdesc='#92ebede1'/><figcaption id='92ebede1'>Death at a Funeral (2007) by Frank Oz</figcaption></figure><p>I think we should. And I think I know the reason why.</p><p>It&#39;s not because we introduce unnecessary coupling, as Allen Holub said in his <a href="http://www.javaworld.com/article/2073649/core-java/why-extends-is-evil.html">Why extends is evil</a> article. He was definitely right, but I believe it&#39;s not the root cause of the problem.</p><p>&quot;Inherit,&quot; as an English verb, has a number of meanings. <a href="http://www.oxforddictionaries.com/us/definition/american_english/inherit">This one</a> is what inheritance inventors in <a href="https://en.wikipedia.org/wiki/Simula">Simula</a> had in mind, I guess: &quot;Derive (a quality, characteristic, or predisposition) genetically from one&#39;s parents or ancestors.&quot;</p><aside class='youtube'> <a href='https://www.youtube.com/watch?v=DjrA7_Uymok'><div class='box'> <img src='https://i.ytimg.com/vi/DjrA7_Uymok/mqdefault.jpg' alt='YouTube video #DjrA7_Uymok'/><div class='play'><i class='icon icon-play'></i></div></div></a><div>Inheritance vs. Subtyping (webinar #24); 3 May 2017.</div></aside><p>Deriving a characteristic from another object is a great idea, and it&#39;s called <a href="https://en.wikipedia.org/wiki/Subtyping">subtyping</a>. It perfectly fits into OOP and actually enables <a href="https://en.wikipedia.org/wiki/Polymorphism_%28computer_science%29">polymorphism</a>: An object of class <code>Article</code> inherits all characteristics of objects in class <code>Manuscript</code> and adds its own. For example, it <em>inherits</em> an ability to print itself and <em>adds</em> an ability to submit itself to a conference:</p><figure class="highlight"><pre><code class="language-java" data-lang="java"><span></span><span class="kd">interface</span> <span class="nc">Manuscript</span> <span class="o">{</span>
  <span class="kt">void</span> <span class="nf">print</span><span class="o">(</span><span class="n">Console</span> <span class="n">console</span><span class="o">);</span>
<span class="o">}</span>
<span class="kd">interface</span> <span class="nc">Article</span> <span class="kd">extends</span> <span class="n">Manuscript</span> <span class="o">{</span>
  <span class="kt">void</span> <span class="nf">submit</span><span class="o">(</span><span class="n">Conference</span> <span class="n">cnf</span><span class="o">);</span>
<span class="o">}</span></code></pre></figure><p>This is <em>subtyping</em>, and it&#39;s a perfect technique; whenever a manuscript is required, we can provide an article and nobody will notice anything, because type <code>Article</code> is a subtype of type <code>Manuscript</code> (<a href="https://en.wikipedia.org/wiki/Liskov_substitution_principle">Liskov substitution principle</a>).</p><p>But what does <em>copying</em> methods and attributes from a parent class to a child one have to do with &quot;deriving characteristics?&quot; Implementation inheritance is exactly that---copying---and it has nothing to do with the meaning of the word &quot;inherit&quot; I quoted above.</p><p>Implementation inheritance is much closer to a different <a href="http://www.oxforddictionaries.com/us/definition/american_english/inherit">meaning</a>: &quot;Receive (money, property, or a title) as an heir at the death of the previous holder.&quot; Who is dead, you ask? An object is dead if it allows other objects to <em>inherit</em> its encapsulated code and data. This is implementation inheritance:</p><figure class="highlight"><pre><code class="language-java" data-lang="java"><span></span><span class="kd">class</span> <span class="nc">Manuscript</span> <span class="o">{</span>
  <span class="kd">protected</span> <span class="n">String</span> <span class="n">body</span><span class="o">;</span>
  <span class="kt">void</span> <span class="nf">print</span><span class="o">(</span><span class="n">Console</span> <span class="n">console</span><span class="o">)</span> <span class="o">{</span>
    <span class="n">console</span><span class="o">.</span><span class="na">println</span><span class="o">(</span><span class="k">this</span><span class="o">.</span><span class="na">body</span><span class="o">);</span>
  <span class="o">}</span>
<span class="o">}</span>
<span class="kd">class</span> <span class="nc">Article</span> <span class="kd">extends</span> <span class="n">Manuscript</span> <span class="o">{</span>
  <span class="kt">void</span> <span class="nf">submit</span><span class="o">(</span><span class="n">Conference</span> <span class="n">cnf</span><span class="o">)</span> <span class="o">{</span>
    <span class="n">cnf</span><span class="o">.</span><span class="na">send</span><span class="o">(</span><span class="k">this</span><span class="o">.</span><span class="na">body</span><span class="o">);</span>
  <span class="o">}</span>
<span class="o">}</span></code></pre></figure><p>Class <code>Article</code> <strong>copies</strong> method <code>print()</code> and attribute <code>body</code> from class <code>Manuscript</code>, as if it&#39;s not a <a href="/2014/11/20/seven-virtues-of-good-object.html">living organism</a>, but rather a dead one from which we can inherit its parts, &quot;money, properties, or a title.&quot;</p><figure class='badge'><a href='http://amzn.to/266oJr4'><img src='https://www.yegor256.com/images/2015/04/book-object-thinking.jpg' style='width:96px;max-width:100%;' alt='badge'/></a></figure><p>Implementation inheritance was created as a mechanism for <a href="https://en.wikipedia.org/wiki/Code_reuse">code reuse</a>, and it doesn&#39;t fit into OOP at all. Yes, it may look convenient in the beginning, but it is absolutely wrong in terms of <a href="http://amzn.to/266oJr4">object thinking</a>. Just like <a href="/2014/09/16/getters-and-setters-are-evil.html">getters and setters</a>, implementation inheritance turns objects into <em>containers</em> with data and procedures. Of course, it&#39;s convenient to copy some of those data and procedures to a new object in order to avoid code duplication. But this is not what objects are about. They are not dead; they are alive!</p><p>Don&#39;t <strong>kill</strong> them with inheritance :)</p><p>Thus, I think inheritance is bad because it is a <em>procedural</em> technique for <em>code reuse</em>. It comes as no surprise that it introduces all the problems people have been talking about for years. Because it is procedural! That&#39;s why it doesn&#39;t fit into object-oriented programming.</p><p>By the way, we <a href="https://gitter.im/yegor256/elegantobjects?at=57bcd2e4cd00bdff6e745584">discussed</a> this problem in our <a href="https://gitter.im/yegor256/elegantobjects">Gitter chat</a> (it&#39;s dead already) a week ago, and that&#39;s when it became obvious to me what exactly is wrong with inheritance. Take a look at our discussion there.</p></p><nav class="buttons notranslate desktop-only"> <a href="http://www.facebook.com/sharer/sharer.php?u=https://www.yegor256.com/2016/09/13/inheritance-is-procedural.html" title="Share on Facebook" class="button" rel="nofollow"> <span class="count count-facebook">0</span> <i class="icon icon-facebook notranslate" aria-hidden="true"></i> </a> <a href="https://twitter.com/share?url=https://www.yegor256.com/2016/09/13/inheritance-is-procedural.html&amp;text=Inheritance+Is+a+Procedural+Technique+for+Code+Reuse" title="Share on Twitter" class="button" rel="nofollow"> <span class="count count-twitter">0</span> <i class="icon icon-twitter notranslate" aria-hidden="true"></i> </a> <a href="https://plus.google.com/share?url=https://www.yegor256.com/2016/09/13/inheritance-is-procedural.html" title="Share on Google+" class="button" rel="nofollow"> <span class="count count-googleplus">0</span> <i class="icon icon-googleplus notranslate" aria-hidden="true"></i> </a> <a href="https://www.linkedin.com/cws/share?url=https://www.yegor256.com/2016/09/13/inheritance-is-procedural.html" title="Share on LinkedIn" class="button" rel="nofollow"> <span class="count count-linkedin">0</span> <i class="icon icon-linkedin notranslate" aria-hidden="true"></i> </a> <a href="http://reddit.com/submit?url=https://www.yegor256.com/2016/09/13/inheritance-is-procedural.html%3F2016-37&amp;title=Inheritance+Is+a+Procedural+Technique+for+Code+Reuse" title="Share on Reddit" class="button" rel="nofollow"> <span class="count count-reddit">0</span> <i class="icon icon-reddit notranslate" aria-hidden="true"></i> </a> <a href="http://news.ycombinator.com/submitlink?u=https://www.yegor256.com/2016/09/13/inheritance-is-procedural.html%3F2016-37&amp;t=Inheritance+Is+a+Procedural+Technique+for+Code+Reuse" title="Share on Hacker News" class="button" rel="nofollow"> <span class="count count-hackernews">0</span> <i class="icon icon-hackernews notranslate" aria-hidden="true"></i> </a> </nav> </header> <article class="main" itemprop="articleBody"><div ><p>We all know that <a href="https://en.wikipedia.org/wiki/Inheritance_(object-oriented_programming)">inheritance</a> is bad and that <a href="https://en.wikipedia.org/wiki/Composition_over_inheritance">composition over inheritance</a> is a <a href="http://programmers.stackexchange.com/questions/65179">good idea</a>, but do we really understand why? In <del>most</del> all articles <a href="https://www.google.com/search?q=inheritance+is+bad">I&#39;ve found</a> addressing this subject, authors have said that inheritance may be harmful to your code, so it&#39;s better not to use it. This &quot;better&quot; part is what bothers me; does it mean that sometimes inheritance makes sense? I interviewed <a href="http://davewest.us/">David West</a> (the author of <a href="http://amzn.to/266oJr4">Object Thinking</a>, my favorite book about OOP) a few weeks ago, and he said that inheritance should not exist in object-oriented programming at all (<a href="https://www.youtube.com/watch?v=s-hdZZzMCac">full video</a>). Maybe Dr. West is right and we should totally forget <code>extends</code> keyword in Java, for example.</p><figure class='jb_picture'><img itemprop='image' alt='Death at a Funeral (2007) by Frank Oz' src='/images/2016/09/death-at-a-funeral.jpg' longdesc='#92ebede1'/><figcaption id='92ebede1'>Death at a Funeral (2007) by Frank Oz</figcaption></figure><p>I think we should. And I think I know the reason why.</p><p>It&#39;s not because we introduce unnecessary coupling, as Allen Holub said in his <a href="http://www.javaworld.com/article/2073649/core-java/why-extends-is-evil.html">Why extends is evil</a> article. He was definitely right, but I believe it&#39;s not the root cause of the problem.</p><p>&quot;Inherit,&quot; as an English verb, has a number of meanings. <a href="http://www.oxforddictionaries.com/us/definition/american_english/inherit">This one</a> is what inheritance inventors in <a href="https://en.wikipedia.org/wiki/Simula">Simula</a> had in mind, I guess: &quot;Derive (a quality, characteristic, or predisposition) genetically from one&#39;s parents or ancestors.&quot;</p><aside class='youtube'> <a href='https://www.youtube.com/watch?v=DjrA7_Uymok'><div class='box'> <img src='https://i.ytimg.com/vi/DjrA7_Uymok/mqdefault.jpg' alt='YouTube video #DjrA7_Uymok'/><div class='play'><i class='icon icon-play'></i></div></div></a><div>Inheritance vs. Subtyping (webinar #24); 3 May 2017.</div></aside><p>Deriving a characteristic from another object is a great idea, and it&#39;s called <a href="https://en.wikipedia.org/wiki/Subtyping">subtyping</a>. It perfectly fits into OOP and actually enables <a href="https://en.wikipedia.org/wiki/Polymorphism_%28computer_science%29">polymorphism</a>: An object of class <code>Article</code> inherits all characteristics of objects in class <code>Manuscript</code> and adds its own. For example, it <em>inherits</em> an ability to print itself and <em>adds</em> an ability to submit itself to a conference:</p><figure class="highlight"><pre><code class="language-java" data-lang="java"><span></span><span class="kd">interface</span> <span class="nc">Manuscript</span> <span class="o">{</span>
  <span class="kt">void</span> <span class="nf">print</span><span class="o">(</span><span class="n">Console</span> <span class="n">console</span><span class="o">);</span>
<span class="o">}</span>
<span class="kd">interface</span> <span class="nc">Article</span> <span class="kd">extends</span> <span class="n">Manuscript</span> <span class="o">{</span>
  <span class="kt">void</span> <span class="nf">submit</span><span class="o">(</span><span class="n">Conference</span> <span class="n">cnf</span><span class="o">);</span>
<span class="o">}</span></code></pre></figure><p>This is <em>subtyping</em>, and it&#39;s a perfect technique; whenever a manuscript is required, we can provide an article and nobody will notice anything, because type <code>Article</code> is a subtype of type <code>Manuscript</code> (<a href="https://en.wikipedia.org/wiki/Liskov_substitution_principle">Liskov substitution principle</a>).</p><p>But what does <em>copying</em> methods and attributes from a parent class to a child one have to do with &quot;deriving characteristics?&quot; Implementation inheritance is exactly that---copying---and it has nothing to do with the meaning of the word &quot;inherit&quot; I quoted above.</p><p>Implementation inheritance is much closer to a different <a href="http://www.oxforddictionaries.com/us/definition/american_english/inherit">meaning</a>: &quot;Receive (money, property, or a title) as an heir at the death of the previous holder.&quot; Who is dead, you ask? An object is dead if it allows other objects to <em>inherit</em> its encapsulated code and data. This is implementation inheritance:</p><figure class="highlight"><pre><code class="language-java" data-lang="java"><span></span><span class="kd">class</span> <span class="nc">Manuscript</span> <span class="o">{</span>
  <span class="kd">protected</span> <span class="n">String</span> <span class="n">body</span><span class="o">;</span>
  <span class="kt">void</span> <span class="nf">print</span><span class="o">(</span><span class="n">Console</span> <span class="n">console</span><span class="o">)</span> <span class="o">{</span>
    <span class="n">console</span><span class="o">.</span><span class="na">println</span><span class="o">(</span><span class="k">this</span><span class="o">.</span><span class="na">body</span><span class="o">);</span>
  <span class="o">}</span>
<span class="o">}</span>
<span class="kd">class</span> <span class="nc">Article</span> <span class="kd">extends</span> <span class="n">Manuscript</span> <span class="o">{</span>
  <span class="kt">void</span> <span class="nf">submit</span><span class="o">(</span><span class="n">Conference</span> <span class="n">cnf</span><span class="o">)</span> <span class="o">{</span>
    <span class="n">cnf</span><span class="o">.</span><span class="na">send</span><span class="o">(</span><span class="k">this</span><span class="o">.</span><span class="na">body</span><span class="o">);</span>
  <span class="o">}</span>
<span class="o">}</span></code></pre></figure><p>Class <code>Article</code> <strong>copies</strong> method <code>print()</code> and attribute <code>body</code> from class <code>Manuscript</code>, as if it&#39;s not a <a href="/2014/11/20/seven-virtues-of-good-object.html">living organism</a>, but rather a dead one from which we can inherit its parts, &quot;money, properties, or a title.&quot;</p><figure class='badge'><a href='http://amzn.to/266oJr4'><img src='https://www.yegor256.com/images/2015/04/book-object-thinking.jpg' style='width:96px;max-width:100%;' alt='badge'/></a></figure><p>Implementation inheritance was created as a mechanism for <a href="https://en.wikipedia.org/wiki/Code_reuse">code reuse</a>, and it doesn&#39;t fit into OOP at all. Yes, it may look convenient in the beginning, but it is absolutely wrong in terms of <a href="http://amzn.to/266oJr4">object thinking</a>. Just like <a href="/2014/09/16/getters-and-setters-are-evil.html">getters and setters</a>, implementation inheritance turns objects into <em>containers</em> with data and procedures. Of course, it&#39;s convenient to copy some of those data and procedures to a new object in order to avoid code duplication. But this is not what objects are about. They are not dead; they are alive!</p><p>Don&#39;t <strong>kill</strong> them with inheritance :)</p><p>Thus, I think inheritance is bad because it is a <em>procedural</em> technique for <em>code reuse</em>. It comes as no surprise that it introduces all the problems people have been talking about for years. Because it is procedural! That&#39;s why it doesn&#39;t fit into object-oriented programming.</p><p>By the way, we <a href="https://gitter.im/yegor256/elegantobjects?at=57bcd2e4cd00bdff6e745584">discussed</a> this problem in our <a href="https://gitter.im/yegor256/elegantobjects">Gitter chat</a> (it&#39;s dead already) a week ago, and that&#39;s when it became obvious to me what exactly is wrong with inheritance. Take a look at our discussion there.</p></div></article></div><div class="wrapper"> <related-posts /></div><div class="disqus" role="complementary"><p class="disqus_hint"> Please, use <a href="https://help.disqus.com/commenting/what-html-tags-are-allowed-within-comments">syntax highlighting</a> in your comments, to make them more readable.</p><div id="disqus_thread" class="disqus-thread"> <a>&nbsp;</a></div><script> var disqus_config = function () { this.page.url = document.location.href.split('?')[0].split('#')[0].replace('https://', 'http://'); this.page.identifier = this.page.url; }; (function() { var d = document, s = d.createElement('script'); s.src = '//yegor256.disqus.com/embed.js'; s.setAttribute('data-timestamp', +new Date()); (d.head || d.body).appendChild(s); })(); </script> <noscript><div><p class="red"> JavaScript is disabled in your browser, that's why you can't see comments under this post.</p></div></noscript></div><div class="wrapper"> <footer class="footer"><p> &copy; <span itemscope="" itemprop="copyrightHolder" itemtype="http://schema.org/Person"> <span itemprop="name">Yegor Bugayenko</span> </span> 2014&ndash;<span itemprop="copyrightYear">2018</span></p></footer></div></section><div class="wrapper unprintable" style="text-align:center;margin-top:2em;"> <a href="http://www.sixnines.io/h/3ba1652f"> <img src="//www.sixnines.io/b/3ba1652f?style=flat" alt="sixnines availability badge"/> </a></div><script src="//code.jquery.com/jquery-1.9.0.min.js"></script> <script src="/js/all.js?a0e0d018c07"></script> <script>var disqus_shortname = 'yegor256';</script> <script id="dsq-count-scr" src="//yegor256.disqus.com/count.js" async="async"></script> <script> (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){ (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o), m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m) })(window,document,'script','//www.google-analytics.com/analytics.js','ga'); ga('create', 'UA-1963507-32', 'auto'); ga('send', 'pageview'); </script> <script> Cd=document;Cr="&"+Math.random();Cp="&s=1"; Cd.cookie="b=b";if(Cd.cookie)Cp+="&c=1"; Cp+="&t="+(new Date()).getTimezoneOffset(); if(self!=top)Cp+="&f=1"; </script> <script> if(navigator.javaEnabled())Cp+="&j=1"; </script> <script> if(typeof(screen)!='undefined')Cp+="&w="+screen.width+"&h="+ screen.height+"&d="+(screen.colorDepth?screen.colorDepth:screen.pixelDepth); </script> <script> Cd.write("<img src='//c.hit.ua/hit?i=95870&g=0&x=2"+Cp+Cr+ "&r="+escape(Cd.referrer)+"&u="+escape(window.location.href)+ "' border='0' wi"+"dth='1' he"+"ight='1'/>"); </script> <script type="application/ld+json"> { "@context": "http://schema.org", "@type": "Person", "name": "Yegor Bugayenko", "url": "http://www.yegor256.com", "sameAs": [ "https://www.facebook.com/yegor256", "https://instagram.com/yegor256", "https://www.linkedin.com/in/yegor256", "https://twitter.com/yegor256", "https://github.com/yegor256", "https://www.pinterest.com/yegor256/" ] } </script> </body> </html> <!DOCTYPE html> <html xmlns="http://www.w3.org/1999/xhtml" lang="en-US" xml:lang="en-US" itemscope="" itemtype="http://schema.org/WebSite"> <head> <meta charset="utf-8"/> <meta name="description" content="There are a few levels and forms of immutability in object-oriented programming, all of which can be used when they seem appropriate. " /> <meta name="keywords" content="immutability, immutability java, immutable list, immutable object, immutable object java" /> <meta name="viewport" content="width=device-width,minimum-scale=1,initial-scale=1"/> <meta name="google-site-verification" content="JEj_gQr2CPe2QKGw8XdMz0R7VboQIUbX3FlM-lwTq-8" /> <meta name="author" content="Yegor Bugayenko"> <meta name="article:published_time" content="2016-09-07 00:00:00 +0000"> <meta name="og:site_name" content="Yegor Bugayenko"/> <meta name="og:type" content="article" /> <meta name="og:locale" content="en_US" /> <meta name="twitter:account_id" content="4503599630178231" /> <meta name="twitter:creator" content="@yegor256"/> <meta name="twitter:site" content="@yegor256"/> <meta name="twitter:title" property="og:title" content="Gradients of Immutability"/> <meta name="twitter:description" property="og:description" content="There are a few levels and forms of immutability in object-oriented programming, all of which can be used when they seem appropriate. "/> <meta name="twitter:url" property="og:url" content="https://www.yegor256.com/2016/09/07/gradients-of-immutability.html"/> <meta name="telegram:channel" content="AAAAAEJFMRzsRTRxM3ec6A"/> <link rel="search" type="application/opensearchdescription+xml" href="/opensearch.xml" title="yegor256" /> <link rel="shortcut icon" href="/favicon.ico?a0e0d018c07"/> <link rel="apple-touch-icon" href="/favicon.ico?a0e0d018c07"/> <link rel="alternate" type="application/rss+xml" title="RSS for yegor256.com" href="https://www.yegor256.com/rss.xml"/> <link rel="stylesheet" href="/css/layout.css?a0e0d018c07"/> <link rel="stylesheet" href="/css/icons.css?a0e0d018c07"/> <link rel="canonical" href="https://www.yegor256.com/2016/09/07/gradients-of-immutability.html" /> <link rel="amphtml" href="https://www.yegor256.com/2016/09/07/gradients-of-immutability.amp.html" /> <title>Gradients of Immutability </title> <meta name='og:image' content='https://www.yegor256.com/images/2016/09/twelve-monkeys.jpg'/><meta name='twitter:image' content='https://www.yegor256.com/images/2016/09/twelve-monkeys.jpg'/><meta name='og:image:width' content='1200'/> <meta name='twitter:image:width' content='1200'/><meta name='og:image:height' content='671'/> <meta name='twitter:image:height' content='671'/><meta name='twitter:card' content='summary_large_image'/><meta name='twitter:image:alt' content='Twelve Monkeys (1995) by Terry Gilliam'/> </head> <body><div class="wrapper"> <aside class="header-toggle unprintable" id="header-toggle" title="Show the menu" onclick="$('#header').show();$('#header-toggle').hide();">&#9776;</aside> <header class="header" id="header"><div class="face"> <a href="/about-me.html#form" class="sub" title="Click to subscribe to my monthly newsletter"><span>Subscribe</span></a> <a href="/about-me.html" style="position:relative;"> <img src="/images/face-256x256.jpg" class="photo" alt="Yegor Bugayenko"/> </a></div><nav><ul class="menu social notranslate"> <li><a href="https://twitter.com/intent/follow?screen_name=yegor256" rel="nofollow" title="Follow me on Twitter"><i class="icon icon-twitter notranslate" aria-hidden="true"></i></a></li> <li><a href="/rss.xml" rel="nofollow" title="Subscribe to my RSS feed"><i class="icon icon-rss notranslate" aria-hidden="true"></i></a></li> <li><a itemprop="sameAs" href="https://github.com/yegor256" rel="nofollow" title="My GitHub profile"><i class="icon icon-github notranslate" aria-hidden="true"></i></a></li> <li><a itemprop="sameAs" href="http://stackoverflow.com/users/187141/yegor256" rel="nofollow" title="My StackOverflow profile"><i class="icon icon-stackoverflow notranslate" aria-hidden="true"></i></a></li> <li><a itemprop="sameAs" href="https://www.facebook.com/yegor256" rel="nofollow" title="Follow me on Facebook"><i class="icon icon-facebook notranslate" aria-hidden="true"></i></a></li> <li><a itemprop="sameAs" href="https://instagram.com/yegor256" rel="nofollow" title="Follow me on Instagram"><i class="icon icon-instagram notranslate" aria-hidden="true"></i></a></li> <li><a itemprop="sameAs" href="https://www.linkedin.com/in/yegor256" rel="nofollow" title="My LinkedIn profile"><i class="icon icon-linkedin notranslate" aria-hidden="true"></i></a></li> <li><a itemprop="sameAs" href="https://www.youtube.com/c/yegor256?sub_confirmation=1" rel="nofollow" title="My Youtube video channel"><i class="icon icon-youtube notranslate" aria-hidden="true"></i></a></li> <li><a itemprop="sameAs" href="https://www.pinterest.com/yegor256/" rel="nofollow" title="My Pinterest boards"><i class="icon icon-pinterest notranslate" aria-hidden="true"></i></a></li> <li><a itemprop="sameAs" href="https://angel.co/yegor256" rel="nofollow" title="My AngelList profile"><i class="icon icon-angellist notranslate" aria-hidden="true"></i></a></li> <li><a href="https://soundcloud.com/yegor256" rel="nofollow" title="My podcast"><i class="icon icon-podcast notranslate" aria-hidden="true"></i></a></li> <li><a href="https://itunes.apple.com/us/podcast/yegor256-podcast/id1150826721" rel="nofollow" title="My iTunes podcast"><i class="icon icon-itunes notranslate" aria-hidden="true"></i></a></li> <li><a href="https://t.me/joinchat/AAAAAEJFMRzsRTRxM3ec6A" rel="nofollow" title="My Telegram public channel"><i class="icon icon-telegram notranslate" aria-hidden="true"></i></a></li> <li><a href="mailto:blog@yegor256.com" rel="nofollow" title="Email me any time"><i class="icon icon-mail notranslate" aria-hidden="true"></i></a></li></ul><ul class="menu"> <li><a href="/" title="Home page">Home</a></li> <li ><a href="/best.html" title="Best articles to read">12&#160;Best</a></li> <li ><a href="/contents.html" title="The contents of the entire blog">All&#160;288</a></li> <li ><a href="/webinars.html" title="My webinars">Webinars</a></li> <li ><a href="/talks.html" title="Future and past conference talks">Talks</a></li> <li ><a href="/books.html" title="The books I wrote">Books</a></li> <li ><a href="/papers.html" title="My academic papers and patents">Papers</a></li> <li ><a href="/pets.html" title="My loved pet projects">Pets</a></li> <li ><a href="/award.html" title="Software quality award">Award</a></li> <li ><a href="/testimonials.html" title="What some people say about me">Testimonials</a></li> <li ><a href="/shift-m.html" title="Audio podcast about project management">Shift-M</a></li> <li ><a href="/paintings.html" title="My paintings for sale">Paintings</a></li> <li><a href="http://ru.yegor256.com/" title="Немного на русском языке">По-русски</a></li></ul></nav><div class="search"> <form method="get" action="https://www.google.com/search" itemprop="potentialAction" itemscope="" itemtype="http://schema.org/SearchAction"> <meta itemprop="target" content="https://www.google.com/search?q={q}"/> <input name="sitesearch" value="yegor256.com" type="hidden"/> <input itemprop="query-input" type="text" id="search-query" class="field field-text" required="required" onfocus="$('.google').css('visibility', 'visible');" name="q" placeholder="Search..." autocomplete="off"/> <input type="image" src="/images/google-search-icon.svg" class="google" title="Search via Google" alt="Search via Google"/> </form></div><div class="hot"><ul> <li> <a href="/code-ahead.html">Code Ahead</a> was published on Amazon just a few days ago! It is my new book, a novel about programmers. It explains in details the majority of ideas that stand behind <a href="https://www.zerocracy.com">Zerocracy</a> and <a href="https://www.xdsd.org">XDSD</a>. </li> <li> At <a href="/webinars.html">Webinar #37</a> we will discuss naming problem in OOP, for objects, methods and attributes; join us on <b>September 12</b>, at 11am PST. </li></ul></div></header></div><section itemscope="" itemtype="http://schema.org/BlogPosting"><div class="wrapper"> <header><p class="printable"> <img src="https://api.qrserver.com/v1/create-qr-code/?data=https://www.yegor256.com/2016/09/07/gradients-of-immutability.html&amp;format=svg" style="width:125px;height:125px;" alt="QR code"/></p><p class="printable"> <code itemprop="url">https://www.yegor256.com/2016/09/07/gradients-of-immutability.html</code></p><h1 itemprop="name headline mainEntityOfPage">Gradients of Immutability</h1><aside class='book'><a href='http://amzn.to/2pyceWc'><img src='/images/books/elegant-objects/cover.png' class='book-cover' alt='book cover'/></a>Read more about this subject in <a href='http://amzn.to/2pyceWc'>Section&nbsp;5.8</a><br/> of my book<a href='http://amzn.to/2pyceWc'><img src='/images/books/amazon-buy-button.png' class='amazon-button' alt='Click to buy'/></a></aside><ul class="subline"> <li> <time itemprop="datePublished" datetime="2016-09-07T00:00:00+00:00"> 7 September 2016 </time> </li> <li class="desktop-only" itemprop="locationCreated">Palo Alto, CA</li> <li class="printable" itemscope="" itemprop="author" itemtype="http://schema.org/Person"> <span itemprop="name">Yegor Bugayenko</span> </li> <li class="unprintable"> <i class="icon icon-comments"></i> <a href="http://www.yegor256.com/2016/09/07/gradients-of-immutability.html#disqus_thread" itemprop="discussionUrl">comments</a> </li></ul><p class="unprintable"><p>Good objects are immutable, but not necessarily constants. I tried to explain it <a href="/2014/06/09/objects-should-be-immutable.html">here</a>, <a href="/2014/12/09/immutable-object-state-and-behavior.html">here</a>, and <a href="/2014/12/22/immutable-objects-not-dumb.html">here</a>, but now it&#39;s time to make another attempt. Actually, the more I think about it, the more I realize that immutability is not black or white---there are a few more gradients; let&#39;s take a look.</p><figure class='jb_picture'><img itemprop='image' alt='Twelve Monkeys (1995) by Terry Gilliam' src='/images/2016/09/twelve-monkeys.jpg' longdesc='#322549d7'/><figcaption id='322549d7'>Twelve Monkeys (1995) by Terry Gilliam</figcaption></figure><p>As we agreed <a href="/2016/07/14/who-is-object.html">here</a>, an object is a <em>representative</em> of someone else (some entity or entities, other object(s), data, memory, files, etc.). Let&#39;s examine a number of objects that look exactly the same to us but <em>represent</em> different things, then analyze how immutable they are and why.</p><h2 id="constant">Constant</h2><p>This is <em>constant</em>; it doesn&#39;t allow any modifications to the encapsulated entity and always returns the same text (I&#39;ve skipped constructors for the sake of brevity):</p><figure class="highlight"><pre><code class="language-java" data-lang="java"><span></span><span class="kd">class</span> <span class="nc">Book</span> <span class="o">{</span>
  <span class="kd">private</span> <span class="kd">final</span> <span class="n">String</span> <span class="n">ttl</span><span class="o">;</span>
  <span class="n">Book</span> <span class="nf">rename</span><span class="o">(</span><span class="n">String</span> <span class="n">title</span><span class="o">)</span> <span class="o">{</span>
    <span class="k">return</span> <span class="k">new</span> <span class="n">Book</span><span class="o">(</span><span class="n">title</span><span class="o">);</span>
  <span class="o">}</span>
  <span class="n">String</span> <span class="nf">title</span><span class="o">()</span> <span class="o">{</span>
    <span class="k">return</span> <span class="k">this</span><span class="o">.</span><span class="na">ttl</span><span class="o">;</span>
  <span class="o">}</span>
<span class="o">}</span></code></pre></figure><p>This is what we usually have in mind when talking about immutable objects. Such a class is very close to a <a href="https://en.wikipedia.org/wiki/Pure_function">pure function</a>, which means that no matter how many times we instantiate it with the same initial values, the result of <code>title()</code> will be the same.</p><h2 id="not-a-constant">Not a Constant</h2><p>Check out this one:</p><figure class="highlight"><pre><code class="language-java" data-lang="java"><span></span><span class="kd">class</span> <span class="nc">Book</span> <span class="o">{</span>
  <span class="kd">private</span> <span class="kd">final</span> <span class="n">String</span> <span class="n">ttl</span><span class="o">;</span>
  <span class="n">Book</span> <span class="nf">rename</span><span class="o">(</span><span class="n">String</span> <span class="n">title</span><span class="o">)</span> <span class="o">{</span>
    <span class="k">return</span> <span class="k">new</span> <span class="n">Book</span><span class="o">(</span><span class="n">title</span><span class="o">);</span>
  <span class="o">}</span>
  <span class="n">String</span> <span class="nf">title</span><span class="o">()</span> <span class="o">{</span>
    <span class="k">return</span> <span class="n">String</span><span class="o">.</span><span class="na">format</span><span class="o">(</span>
      <span class="s">&quot;%s (as of %tR)&quot;</span><span class="o">,</span> <span class="k">this</span><span class="o">.</span><span class="na">ttl</span><span class="o">,</span> <span class="k">new</span> <span class="n">Date</span><span class="o">()</span>
    <span class="o">);</span>
  <span class="o">}</span>
<span class="o">}</span></code></pre></figure><p>The object is still immutable, but it is not a pure function anymore because of the method <code>title()</code>---it returns different values if we call it multiple times with at least a one-minute interval. The object is immutable; it&#39;s just not a constant anymore.</p><h2 id="represented-mutability">Represented Mutability</h2><p>How about this one:</p><figure class="highlight"><pre><code class="language-java" data-lang="java"><span></span><span class="kd">class</span> <span class="nc">Book</span> <span class="o">{</span>
  <span class="kd">private</span> <span class="kd">final</span> <span class="n">Path</span> <span class="n">path</span><span class="o">;</span>
  <span class="n">Book</span> <span class="nf">rename</span><span class="o">(</span><span class="n">String</span> <span class="n">title</span><span class="o">)</span> <span class="o">{</span>
    <span class="n">Files</span><span class="o">.</span><span class="na">write</span><span class="o">(</span>
      <span class="k">this</span><span class="o">.</span><span class="na">path</span><span class="o">,</span>
      <span class="n">title</span><span class="o">.</span><span class="na">getBytes</span><span class="o">(),</span>
      <span class="n">StandardOpenOption</span><span class="o">.</span><span class="na">CREATE</span>
    <span class="o">);</span>
    <span class="k">return</span> <span class="k">this</span><span class="o">;</span>
  <span class="o">}</span>
  <span class="n">String</span> <span class="nf">title</span><span class="o">()</span> <span class="o">{</span>
    <span class="k">return</span> <span class="k">new</span> <span class="n">String</span><span class="o">(</span>
      <span class="n">Files</span><span class="o">.</span><span class="na">readAllBytes</span><span class="o">(</span><span class="k">this</span><span class="o">.</span><span class="na">path</span><span class="o">)</span>
    <span class="o">);</span>
  <span class="o">}</span>
<span class="o">}</span></code></pre></figure><p>This <em>immutable</em> object keeps the book title in a file. It&#39;s not a constant, because its method <code>title()</code> may return different values on every second call. Moreover, the represented entity (the file) is not a constant. We can&#39;t say whether it&#39;s mutable or immutable, as we don&#39;t know how <code>Files.write()</code> is implemented. But we know for sure that it&#39;s not a constant, because it accepts change requests.</p><h2 id="encapsulated-mutability">Encapsulated Mutability</h2><p>An immutable object may not only represent but even encapsulate a mutable one. Just like in the previous example, a mutable file was encapsulated. Even though it was represented by the immutable class <code>Path</code>, the real file on disk was mutable. We can do the same, but in memory:</p><figure class="highlight"><pre><code class="language-java" data-lang="java"><span></span><span class="kd">class</span> <span class="nc">Book</span> <span class="o">{</span>
  <span class="kd">private</span> <span class="kd">final</span> <span class="n">StringBuffer</span> <span class="n">buffer</span><span class="o">;</span>
  <span class="n">Book</span> <span class="nf">rename</span><span class="o">(</span><span class="n">String</span> <span class="n">title</span><span class="o">)</span> <span class="o">{</span>
    <span class="k">this</span><span class="o">.</span><span class="na">buffer</span><span class="o">.</span><span class="na">setLength</span><span class="o">(</span><span class="mi">0</span><span class="o">);</span>
    <span class="k">this</span><span class="o">.</span><span class="na">buffer</span><span class="o">.</span><span class="na">append</span><span class="o">(</span><span class="n">title</span><span class="o">);</span>
    <span class="k">return</span> <span class="k">this</span><span class="o">;</span>
  <span class="o">}</span>
  <span class="n">String</span> <span class="nf">title</span><span class="o">()</span> <span class="o">{</span>
    <span class="k">return</span> <span class="k">this</span><span class="o">.</span><span class="na">buffer</span><span class="o">.</span><span class="na">toString</span><span class="o">();</span>
  <span class="o">}</span>
<span class="o">}</span></code></pre></figure><p>The object is still <em>immutable</em>. Is it <a href="/2017/01/17/synchronized-decorators.html">thread-safe</a>? No. Is it a constant? No. Is it immutable? Yes. Confused? You bet.</p><hr/> <aside class='youtube'> <a href='https://www.youtube.com/watch?v=PVvLQGnyDrQ'><div class='box'> <img src='https://i.ytimg.com/vi/PVvLQGnyDrQ/mqdefault.jpg' alt='YouTube video #PVvLQGnyDrQ'/><div class='play'><i class='icon icon-play'></i></div></div></a><div>Gradients of Immutability (webinar #20); 11 January 2017.</div></aside><p>My point is that immutability is not <em>binary</em>; there are many forms of it. The most simple one is, of course, a constant. Constants are almost the same as pure functions in functional programming. But object-oriented programming allows us to take a few steps forward and give immutable objects more permissions and flexibility. In OOP, we may have many more forms of immutability.</p><p>What is common among all these examples is that our objects are <em>loyal</em> to the entities they encapsulate. There are no <a href="/2014/09/16/getters-and-setters-are-evil.html">setters</a> that could change them. All encapsulated objects are <code>final</code>.</p><p>This is the only quality that differentiates mutable objects from immutable ones. The latter are always loyal to the entities they encapsulate and represent. For all the rest ... it depends.</p></p><nav class="buttons notranslate desktop-only"> <a href="http://www.facebook.com/sharer/sharer.php?u=https://www.yegor256.com/2016/09/07/gradients-of-immutability.html" title="Share on Facebook" class="button" rel="nofollow"> <span class="count count-facebook">0</span> <i class="icon icon-facebook notranslate" aria-hidden="true"></i> </a> <a href="https://twitter.com/share?url=https://www.yegor256.com/2016/09/07/gradients-of-immutability.html&amp;text=Gradients+of+Immutability" title="Share on Twitter" class="button" rel="nofollow"> <span class="count count-twitter">0</span> <i class="icon icon-twitter notranslate" aria-hidden="true"></i> </a> <a href="https://plus.google.com/share?url=https://www.yegor256.com/2016/09/07/gradients-of-immutability.html" title="Share on Google+" class="button" rel="nofollow"> <span class="count count-googleplus">0</span> <i class="icon icon-googleplus notranslate" aria-hidden="true"></i> </a> <a href="https://www.linkedin.com/cws/share?url=https://www.yegor256.com/2016/09/07/gradients-of-immutability.html" title="Share on LinkedIn" class="button" rel="nofollow"> <span class="count count-linkedin">0</span> <i class="icon icon-linkedin notranslate" aria-hidden="true"></i> </a> <a href="http://reddit.com/submit?url=https://www.yegor256.com/2016/09/07/gradients-of-immutability.html%3F2016-36&amp;title=Gradients+of+Immutability" title="Share on Reddit" class="button" rel="nofollow"> <span class="count count-reddit">0</span> <i class="icon icon-reddit notranslate" aria-hidden="true"></i> </a> <a href="http://news.ycombinator.com/submitlink?u=https://www.yegor256.com/2016/09/07/gradients-of-immutability.html%3F2016-36&amp;t=Gradients+of+Immutability" title="Share on Hacker News" class="button" rel="nofollow"> <span class="count count-hackernews">0</span> <i class="icon icon-hackernews notranslate" aria-hidden="true"></i> </a> </nav> </header> <article class="main" itemprop="articleBody"><div ><p>Good objects are immutable, but not necessarily constants. I tried to explain it <a href="/2014/06/09/objects-should-be-immutable.html">here</a>, <a href="/2014/12/09/immutable-object-state-and-behavior.html">here</a>, and <a href="/2014/12/22/immutable-objects-not-dumb.html">here</a>, but now it&#39;s time to make another attempt. Actually, the more I think about it, the more I realize that immutability is not black or white---there are a few more gradients; let&#39;s take a look.</p><figure class='jb_picture'><img itemprop='image' alt='Twelve Monkeys (1995) by Terry Gilliam' src='/images/2016/09/twelve-monkeys.jpg' longdesc='#322549d7'/><figcaption id='322549d7'>Twelve Monkeys (1995) by Terry Gilliam</figcaption></figure><p>As we agreed <a href="/2016/07/14/who-is-object.html">here</a>, an object is a <em>representative</em> of someone else (some entity or entities, other object(s), data, memory, files, etc.). Let&#39;s examine a number of objects that look exactly the same to us but <em>represent</em> different things, then analyze how immutable they are and why.</p><h2 id="constant">Constant</h2><p>This is <em>constant</em>; it doesn&#39;t allow any modifications to the encapsulated entity and always returns the same text (I&#39;ve skipped constructors for the sake of brevity):</p><figure class="highlight"><pre><code class="language-java" data-lang="java"><span></span><span class="kd">class</span> <span class="nc">Book</span> <span class="o">{</span>
  <span class="kd">private</span> <span class="kd">final</span> <span class="n">String</span> <span class="n">ttl</span><span class="o">;</span>
  <span class="n">Book</span> <span class="nf">rename</span><span class="o">(</span><span class="n">String</span> <span class="n">title</span><span class="o">)</span> <span class="o">{</span>
    <span class="k">return</span> <span class="k">new</span> <span class="n">Book</span><span class="o">(</span><span class="n">title</span><span class="o">);</span>
  <span class="o">}</span>
  <span class="n">String</span> <span class="nf">title</span><span class="o">()</span> <span class="o">{</span>
    <span class="k">return</span> <span class="k">this</span><span class="o">.</span><span class="na">ttl</span><span class="o">;</span>
  <span class="o">}</span>
<span class="o">}</span></code></pre></figure><p>This is what we usually have in mind when talking about immutable objects. Such a class is very close to a <a href="https://en.wikipedia.org/wiki/Pure_function">pure function</a>, which means that no matter how many times we instantiate it with the same initial values, the result of <code>title()</code> will be the same.</p><h2 id="not-a-constant">Not a Constant</h2><p>Check out this one:</p><figure class="highlight"><pre><code class="language-java" data-lang="java"><span></span><span class="kd">class</span> <span class="nc">Book</span> <span class="o">{</span>
  <span class="kd">private</span> <span class="kd">final</span> <span class="n">String</span> <span class="n">ttl</span><span class="o">;</span>
  <span class="n">Book</span> <span class="nf">rename</span><span class="o">(</span><span class="n">String</span> <span class="n">title</span><span class="o">)</span> <span class="o">{</span>
    <span class="k">return</span> <span class="k">new</span> <span class="n">Book</span><span class="o">(</span><span class="n">title</span><span class="o">);</span>
  <span class="o">}</span>
  <span class="n">String</span> <span class="nf">title</span><span class="o">()</span> <span class="o">{</span>
    <span class="k">return</span> <span class="n">String</span><span class="o">.</span><span class="na">format</span><span class="o">(</span>
      <span class="s">&quot;%s (as of %tR)&quot;</span><span class="o">,</span> <span class="k">this</span><span class="o">.</span><span class="na">ttl</span><span class="o">,</span> <span class="k">new</span> <span class="n">Date</span><span class="o">()</span>
    <span class="o">);</span>
  <span class="o">}</span>
<span class="o">}</span></code></pre></figure><p>The object is still immutable, but it is not a pure function anymore because of the method <code>title()</code>---it returns different values if we call it multiple times with at least a one-minute interval. The object is immutable; it&#39;s just not a constant anymore.</p><h2 id="represented-mutability">Represented Mutability</h2><p>How about this one:</p><figure class="highlight"><pre><code class="language-java" data-lang="java"><span></span><span class="kd">class</span> <span class="nc">Book</span> <span class="o">{</span>
  <span class="kd">private</span> <span class="kd">final</span> <span class="n">Path</span> <span class="n">path</span><span class="o">;</span>
  <span class="n">Book</span> <span class="nf">rename</span><span class="o">(</span><span class="n">String</span> <span class="n">title</span><span class="o">)</span> <span class="o">{</span>
    <span class="n">Files</span><span class="o">.</span><span class="na">write</span><span class="o">(</span>
      <span class="k">this</span><span class="o">.</span><span class="na">path</span><span class="o">,</span>
      <span class="n">title</span><span class="o">.</span><span class="na">getBytes</span><span class="o">(),</span>
      <span class="n">StandardOpenOption</span><span class="o">.</span><span class="na">CREATE</span>
    <span class="o">);</span>
    <span class="k">return</span> <span class="k">this</span><span class="o">;</span>
  <span class="o">}</span>
  <span class="n">String</span> <span class="nf">title</span><span class="o">()</span> <span class="o">{</span>
    <span class="k">return</span> <span class="k">new</span> <span class="n">String</span><span class="o">(</span>
      <span class="n">Files</span><span class="o">.</span><span class="na">readAllBytes</span><span class="o">(</span><span class="k">this</span><span class="o">.</span><span class="na">path</span><span class="o">)</span>
    <span class="o">);</span>
  <span class="o">}</span>
<span class="o">}</span></code></pre></figure><p>This <em>immutable</em> object keeps the book title in a file. It&#39;s not a constant, because its method <code>title()</code> may return different values on every second call. Moreover, the represented entity (the file) is not a constant. We can&#39;t say whether it&#39;s mutable or immutable, as we don&#39;t know how <code>Files.write()</code> is implemented. But we know for sure that it&#39;s not a constant, because it accepts change requests.</p><h2 id="encapsulated-mutability">Encapsulated Mutability</h2><p>An immutable object may not only represent but even encapsulate a mutable one. Just like in the previous example, a mutable file was encapsulated. Even though it was represented by the immutable class <code>Path</code>, the real file on disk was mutable. We can do the same, but in memory:</p><figure class="highlight"><pre><code class="language-java" data-lang="java"><span></span><span class="kd">class</span> <span class="nc">Book</span> <span class="o">{</span>
  <span class="kd">private</span> <span class="kd">final</span> <span class="n">StringBuffer</span> <span class="n">buffer</span><span class="o">;</span>
  <span class="n">Book</span> <span class="nf">rename</span><span class="o">(</span><span class="n">String</span> <span class="n">title</span><span class="o">)</span> <span class="o">{</span>
    <span class="k">this</span><span class="o">.</span><span class="na">buffer</span><span class="o">.</span><span class="na">setLength</span><span class="o">(</span><span class="mi">0</span><span class="o">);</span>
    <span class="k">this</span><span class="o">.</span><span class="na">buffer</span><span class="o">.</span><span class="na">append</span><span class="o">(</span><span class="n">title</span><span class="o">);</span>
    <span class="k">return</span> <span class="k">this</span><span class="o">;</span>
  <span class="o">}</span>
  <span class="n">String</span> <span class="nf">title</span><span class="o">()</span> <span class="o">{</span>
    <span class="k">return</span> <span class="k">this</span><span class="o">.</span><span class="na">buffer</span><span class="o">.</span><span class="na">toString</span><span class="o">();</span>
  <span class="o">}</span>
<span class="o">}</span></code></pre></figure><p>The object is still <em>immutable</em>. Is it <a href="/2017/01/17/synchronized-decorators.html">thread-safe</a>? No. Is it a constant? No. Is it immutable? Yes. Confused? You bet.</p><hr/> <aside class='youtube'> <a href='https://www.youtube.com/watch?v=PVvLQGnyDrQ'><div class='box'> <img src='https://i.ytimg.com/vi/PVvLQGnyDrQ/mqdefault.jpg' alt='YouTube video #PVvLQGnyDrQ'/><div class='play'><i class='icon icon-play'></i></div></div></a><div>Gradients of Immutability (webinar #20); 11 January 2017.</div></aside><p>My point is that immutability is not <em>binary</em>; there are many forms of it. The most simple one is, of course, a constant. Constants are almost the same as pure functions in functional programming. But object-oriented programming allows us to take a few steps forward and give immutable objects more permissions and flexibility. In OOP, we may have many more forms of immutability.</p><p>What is common among all these examples is that our objects are <em>loyal</em> to the entities they encapsulate. There are no <a href="/2014/09/16/getters-and-setters-are-evil.html">setters</a> that could change them. All encapsulated objects are <code>final</code>.</p><p>This is the only quality that differentiates mutable objects from immutable ones. The latter are always loyal to the entities they encapsulate and represent. For all the rest ... it depends.</p></div></article></div><div class="wrapper"><div class="unprintable"> <hr/><p>If you like this article, you will definitely like these <strong>very relevant</strong> posts too:</p><p><a href='/2014/06/09/objects-should-be-immutable.html'><strong>Objects Should Be Immutable</strong></a> <br/>The article gives arguments about why classes/objects in object-oriented programming have to be immutable, i.e. never modify their encapsulated state</p><p><a href='/2014/12/09/immutable-object-state-and-behavior.html'><strong>How an Immutable Object Can Have State and Behavior?</strong></a> <br/>Object state and behavior are two very different things, and confusing the two often leads to incorrect design.</p><p><a href='/2014/12/22/immutable-objects-not-dumb.html'><strong>Immutable Objects Are Not Dumb</strong></a> <br/>Immutable objects are not the same as passive data structures without setters, despite a very common mis-belief.</p></div></div><div class="disqus" role="complementary"><p class="disqus_hint"> Please, use <a href="https://help.disqus.com/commenting/what-html-tags-are-allowed-within-comments">syntax highlighting</a> in your comments, to make them more readable.</p><div id="disqus_thread" class="disqus-thread"> <a>&nbsp;</a></div><script> var disqus_config = function () { this.page.url = document.location.href.split('?')[0].split('#')[0].replace('https://', 'http://'); this.page.identifier = this.page.url; }; (function() { var d = document, s = d.createElement('script'); s.src = '//yegor256.disqus.com/embed.js'; s.setAttribute('data-timestamp', +new Date()); (d.head || d.body).appendChild(s); })(); </script> <noscript><div><p class="red"> JavaScript is disabled in your browser, that's why you can't see comments under this post.</p></div></noscript></div><div class="wrapper"> <footer class="footer"><p> &copy; <span itemscope="" itemprop="copyrightHolder" itemtype="http://schema.org/Person"> <span itemprop="name">Yegor Bugayenko</span> </span> 2014&ndash;<span itemprop="copyrightYear">2018</span></p></footer></div></section><div class="wrapper unprintable" style="text-align:center;margin-top:2em;"> <a href="http://www.sixnines.io/h/3ba1652f"> <img src="//www.sixnines.io/b/3ba1652f?style=flat" alt="sixnines availability badge"/> </a></div><script src="//code.jquery.com/jquery-1.9.0.min.js"></script> <script src="/js/all.js?a0e0d018c07"></script> <script>var disqus_shortname = 'yegor256';</script> <script id="dsq-count-scr" src="//yegor256.disqus.com/count.js" async="async"></script> <script> (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){ (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o), m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m) })(window,document,'script','//www.google-analytics.com/analytics.js','ga'); ga('create', 'UA-1963507-32', 'auto'); ga('send', 'pageview'); </script> <script> Cd=document;Cr="&"+Math.random();Cp="&s=1"; Cd.cookie="b=b";if(Cd.cookie)Cp+="&c=1"; Cp+="&t="+(new Date()).getTimezoneOffset(); if(self!=top)Cp+="&f=1"; </script> <script> if(navigator.javaEnabled())Cp+="&j=1"; </script> <script> if(typeof(screen)!='undefined')Cp+="&w="+screen.width+"&h="+ screen.height+"&d="+(screen.colorDepth?screen.colorDepth:screen.pixelDepth); </script> <script> Cd.write("<img src='//c.hit.ua/hit?i=95870&g=0&x=2"+Cp+Cr+ "&r="+escape(Cd.referrer)+"&u="+escape(window.location.href)+ "' border='0' wi"+"dth='1' he"+"ight='1'/>"); </script> <script type="application/ld+json"> { "@context": "http://schema.org", "@type": "Person", "name": "Yegor Bugayenko", "url": "http://www.yegor256.com", "sameAs": [ "https://www.facebook.com/yegor256", "https://instagram.com/yegor256", "https://www.linkedin.com/in/yegor256", "https://twitter.com/yegor256", "https://github.com/yegor256", "https://www.pinterest.com/yegor256/" ] } </script> </body> </html> <!DOCTYPE html> <html xmlns="http://www.w3.org/1999/xhtml" lang="en-US" xml:lang="en-US" itemscope="" itemtype="http://schema.org/WebSite"> <head> <meta charset="utf-8"/> <meta name="description" content="Decomposition of responsibility is what we do in order to break a complex object into smaller ones, and we can do it right or wrong. " /> <meta name="keywords" content="SRP in OOP, decomposition of responsibility, decomposition of responsibility in oop, god object, single responsibility principle" /> <meta name="viewport" content="width=device-width,minimum-scale=1,initial-scale=1"/> <meta name="google-site-verification" content="JEj_gQr2CPe2QKGw8XdMz0R7VboQIUbX3FlM-lwTq-8" /> <meta name="author" content="Yegor Bugayenko"> <meta name="article:published_time" content="2016-08-30 00:00:00 +0000"> <meta name="og:site_name" content="Yegor Bugayenko"/> <meta name="og:type" content="article" /> <meta name="og:locale" content="en_US" /> <meta name="twitter:account_id" content="4503599630178231" /> <meta name="twitter:creator" content="@yegor256"/> <meta name="twitter:site" content="@yegor256"/> <meta name="twitter:title" property="og:title" content="Vertical vs. Horizontal Decomposition of Responsibility"/> <meta name="twitter:description" property="og:description" content="Decomposition of responsibility is what we do in order to break a complex object into smaller ones, and we can do it right or wrong. "/> <meta name="twitter:url" property="og:url" content="https://www.yegor256.com/2016/08/30/decomposition-of-responsibility.html"/> <meta name="telegram:channel" content="AAAAAEJFMRzsRTRxM3ec6A"/> <link rel="search" type="application/opensearchdescription+xml" href="/opensearch.xml" title="yegor256" /> <link rel="shortcut icon" href="/favicon.ico?a0e0d018c07"/> <link rel="apple-touch-icon" href="/favicon.ico?a0e0d018c07"/> <link rel="alternate" type="application/rss+xml" title="RSS for yegor256.com" href="https://www.yegor256.com/rss.xml"/> <link rel="stylesheet" href="/css/layout.css?a0e0d018c07"/> <link rel="stylesheet" href="/css/icons.css?a0e0d018c07"/> <link rel="canonical" href="https://www.yegor256.com/2016/08/30/decomposition-of-responsibility.html" /> <link rel="amphtml" href="https://www.yegor256.com/2016/08/30/decomposition-of-responsibility.amp.html" /> <title>Vertical vs. Horizontal Decomposition of Responsibility </title> <meta name='og:image' content='https://www.yegor256.com/images/2016/08/once-upon-a-time-in-america.jpg'/><meta name='twitter:image' content='https://www.yegor256.com/images/2016/08/once-upon-a-time-in-america.jpg'/><meta name='og:image:width' content='1280'/> <meta name='twitter:image:width' content='1280'/><meta name='og:image:height' content='720'/> <meta name='twitter:image:height' content='720'/><meta name='twitter:card' content='summary_large_image'/><meta name='twitter:image:alt' content='Once Upon a Time in America (1984) by Sergio Leone'/> </head> <body><div class="wrapper"> <aside class="header-toggle unprintable" id="header-toggle" title="Show the menu" onclick="$('#header').show();$('#header-toggle').hide();">&#9776;</aside> <header class="header" id="header"><div class="face"> <a href="/about-me.html#form" class="sub" title="Click to subscribe to my monthly newsletter"><span>Subscribe</span></a> <a href="/about-me.html" style="position:relative;"> <img src="/images/face-256x256.jpg" class="photo" alt="Yegor Bugayenko"/> </a></div><nav><ul class="menu social notranslate"> <li><a href="https://twitter.com/intent/follow?screen_name=yegor256" rel="nofollow" title="Follow me on Twitter"><i class="icon icon-twitter notranslate" aria-hidden="true"></i></a></li> <li><a href="/rss.xml" rel="nofollow" title="Subscribe to my RSS feed"><i class="icon icon-rss notranslate" aria-hidden="true"></i></a></li> <li><a itemprop="sameAs" href="https://github.com/yegor256" rel="nofollow" title="My GitHub profile"><i class="icon icon-github notranslate" aria-hidden="true"></i></a></li> <li><a itemprop="sameAs" href="http://stackoverflow.com/users/187141/yegor256" rel="nofollow" title="My StackOverflow profile"><i class="icon icon-stackoverflow notranslate" aria-hidden="true"></i></a></li> <li><a itemprop="sameAs" href="https://www.facebook.com/yegor256" rel="nofollow" title="Follow me on Facebook"><i class="icon icon-facebook notranslate" aria-hidden="true"></i></a></li> <li><a itemprop="sameAs" href="https://instagram.com/yegor256" rel="nofollow" title="Follow me on Instagram"><i class="icon icon-instagram notranslate" aria-hidden="true"></i></a></li> <li><a itemprop="sameAs" href="https://www.linkedin.com/in/yegor256" rel="nofollow" title="My LinkedIn profile"><i class="icon icon-linkedin notranslate" aria-hidden="true"></i></a></li> <li><a itemprop="sameAs" href="https://www.youtube.com/c/yegor256?sub_confirmation=1" rel="nofollow" title="My Youtube video channel"><i class="icon icon-youtube notranslate" aria-hidden="true"></i></a></li> <li><a itemprop="sameAs" href="https://www.pinterest.com/yegor256/" rel="nofollow" title="My Pinterest boards"><i class="icon icon-pinterest notranslate" aria-hidden="true"></i></a></li> <li><a itemprop="sameAs" href="https://angel.co/yegor256" rel="nofollow" title="My AngelList profile"><i class="icon icon-angellist notranslate" aria-hidden="true"></i></a></li> <li><a href="https://soundcloud.com/yegor256" rel="nofollow" title="My podcast"><i class="icon icon-podcast notranslate" aria-hidden="true"></i></a></li> <li><a href="https://itunes.apple.com/us/podcast/yegor256-podcast/id1150826721" rel="nofollow" title="My iTunes podcast"><i class="icon icon-itunes notranslate" aria-hidden="true"></i></a></li> <li><a href="https://t.me/joinchat/AAAAAEJFMRzsRTRxM3ec6A" rel="nofollow" title="My Telegram public channel"><i class="icon icon-telegram notranslate" aria-hidden="true"></i></a></li> <li><a href="mailto:blog@yegor256.com" rel="nofollow" title="Email me any time"><i class="icon icon-mail notranslate" aria-hidden="true"></i></a></li></ul><ul class="menu"> <li><a href="/" title="Home page">Home</a></li> <li ><a href="/best.html" title="Best articles to read">12&#160;Best</a></li> <li ><a href="/contents.html" title="The contents of the entire blog">All&#160;288</a></li> <li ><a href="/webinars.html" title="My webinars">Webinars</a></li> <li ><a href="/talks.html" title="Future and past conference talks">Talks</a></li> <li ><a href="/books.html" title="The books I wrote">Books</a></li> <li ><a href="/papers.html" title="My academic papers and patents">Papers</a></li> <li ><a href="/pets.html" title="My loved pet projects">Pets</a></li> <li ><a href="/award.html" title="Software quality award">Award</a></li> <li ><a href="/testimonials.html" title="What some people say about me">Testimonials</a></li> <li ><a href="/shift-m.html" title="Audio podcast about project management">Shift-M</a></li> <li ><a href="/paintings.html" title="My paintings for sale">Paintings</a></li> <li><a href="http://ru.yegor256.com/" title="Немного на русском языке">По-русски</a></li></ul></nav><div class="search"> <form method="get" action="https://www.google.com/search" itemprop="potentialAction" itemscope="" itemtype="http://schema.org/SearchAction"> <meta itemprop="target" content="https://www.google.com/search?q={q}"/> <input name="sitesearch" value="yegor256.com" type="hidden"/> <input itemprop="query-input" type="text" id="search-query" class="field field-text" required="required" onfocus="$('.google').css('visibility', 'visible');" name="q" placeholder="Search..." autocomplete="off"/> <input type="image" src="/images/google-search-icon.svg" class="google" title="Search via Google" alt="Search via Google"/> </form></div><div class="hot"><ul> <li> <a href="/code-ahead.html">Code Ahead</a> was published on Amazon just a few days ago! It is my new book, a novel about programmers. It explains in details the majority of ideas that stand behind <a href="https://www.zerocracy.com">Zerocracy</a> and <a href="https://www.xdsd.org">XDSD</a>. </li> <li> At <a href="/webinars.html">Webinar #37</a> we will discuss naming problem in OOP, for objects, methods and attributes; join us on <b>September 12</b>, at 11am PST. </li></ul></div></header></div><section itemscope="" itemtype="http://schema.org/BlogPosting"><div class="wrapper"> <header><p class="printable"> <img src="https://api.qrserver.com/v1/create-qr-code/?data=https://www.yegor256.com/2016/08/30/decomposition-of-responsibility.html&amp;format=svg" style="width:125px;height:125px;" alt="QR code"/></p><p class="printable"> <code itemprop="url">https://www.yegor256.com/2016/08/30/decomposition-of-responsibility.html</code></p><h1 itemprop="name headline mainEntityOfPage">Vertical vs. Horizontal Decomposition of Responsibility</h1><ul class="subline"> <li> <time itemprop="datePublished" datetime="2016-08-30T00:00:00+00:00"> 30 August 2016 </time> </li> <li class="desktop-only" itemprop="locationCreated">Palo Alto, CA</li> <li class="printable" itemscope="" itemprop="author" itemtype="http://schema.org/Person"> <span itemprop="name">Yegor Bugayenko</span> </li> <li class="unprintable"> <i class="icon icon-comments"></i> <a href="http://www.yegor256.com/2016/08/30/decomposition-of-responsibility.html#disqus_thread" itemprop="discussionUrl">comments</a> </li></ul><p class="unprintable"><p>Objects responsible for too many things are a problem. Because their complexity is high, they are difficult to maintain and extend. <em>Decomposition of responsibility</em> is what we do in order to break these overly complex objects into smaller ones. I see two types of this refactoring operation: vertical and horizontal. And I believe the former is better than the latter.</p><figure class='jb_picture'><img itemprop='image' alt='Once Upon a Time in America (1984) by Sergio Leone' src='/images/2016/08/once-upon-a-time-in-america.jpg' longdesc='#f7308496'/><figcaption id='f7308496'>Once Upon a Time in America (1984) by Sergio Leone</figcaption></figure><p>Let&#39;s say this is our code (it is Ruby):</p><figure class="highlight"><pre><code class="language-ruby" data-lang="ruby"><span></span><span class="k">class</span> <span class="nc">Log</span>
  <span class="k">def</span> <span class="nf">initialize</span><span class="p">(</span><span class="n">path</span><span class="p">)</span>
    <span class="vi">@file</span> <span class="o">=</span> <span class="no">IO</span><span class="o">.</span><span class="n">new</span><span class="p">(</span><span class="n">path</span><span class="p">,</span> <span class="s1">&#39;a&#39;</span><span class="p">)</span>
  <span class="k">end</span>
  <span class="k">def</span> <span class="nf">put</span><span class="p">(</span><span class="n">text</span><span class="p">)</span>
    <span class="n">line</span> <span class="o">=</span> <span class="no">Time</span><span class="o">.</span><span class="n">now</span><span class="o">.</span><span class="n">strftime</span><span class="p">(</span><span class="s2">&quot;%d/%m/%Y %H:%M &quot;</span><span class="p">)</span> <span class="o">+</span> <span class="n">text</span>
    <span class="vi">@file</span><span class="o">.</span><span class="n">puts</span> <span class="n">line</span>
  <span class="k">end</span>
<span class="k">end</span></code></pre></figure><p>Obviously, objects of this class are doing too much. They save log lines to the file and also format them---an obvious violation of a famous <a href="https://en.wikipedia.org/wiki/Single_responsibility_principle">single responsibility principle</a>. An object of this class would be <em>responsible</em> for too many things. We have to extract some functionality out of it and put that into another object(s). We have to <em>decompose</em> its responsibility. No matter where we put it, this is how the <code>Log</code> class will look after the extraction:</p><figure class="highlight"><pre><code class="language-ruby" data-lang="ruby"><span></span><span class="k">class</span> <span class="nc">Log</span>
  <span class="k">def</span> <span class="nf">initialize</span><span class="p">(</span><span class="n">path</span><span class="p">)</span>
    <span class="vi">@file</span> <span class="o">=</span> <span class="no">IO</span><span class="o">.</span><span class="n">new</span><span class="p">(</span><span class="n">path</span><span class="p">,</span> <span class="s1">&#39;a&#39;</span><span class="p">)</span>
  <span class="k">end</span>
  <span class="k">def</span> <span class="nf">put</span><span class="p">(</span><span class="n">line</span><span class="p">)</span>
    <span class="vi">@file</span><span class="o">.</span><span class="n">puts</span> <span class="n">line</span>
  <span class="k">end</span>
<span class="k">end</span></code></pre></figure><p>Now it only saves lines to the file, which is perfect. The class is cohesive and small. Let&#39;s make an instance of it:</p><figure class="highlight"><pre><code class="language-ruby" data-lang="ruby"><span></span><span class="n">log</span> <span class="o">=</span> <span class="no">Log</span><span class="o">.</span><span class="n">new</span><span class="p">(</span><span class="s1">&#39;/tmp/log.txt&#39;</span><span class="p">)</span></code></pre></figure><p>Next, where do we put the lines with formatting functionality that were just extracted? There are two approaches to decompose responsibility: horizontal and vertical. This one is <em>horizontal</em>:</p><figure class="highlight"><pre><code class="language-ruby" data-lang="ruby"><span></span><span class="k">class</span> <span class="nc">Line</span>
  <span class="k">def</span> <span class="nf">initialize</span><span class="p">(</span><span class="n">text</span><span class="p">)</span>
    <span class="vi">@line</span> <span class="o">=</span> <span class="n">text</span>
  <span class="k">end</span>
  <span class="k">def</span> <span class="nf">to_s</span>
    <span class="no">Time</span><span class="o">.</span><span class="n">now</span><span class="o">.</span><span class="n">strftime</span><span class="p">(</span><span class="s2">&quot;%d/%m/%Y %H:%M &quot;</span><span class="p">)</span> <span class="o">+</span> <span class="n">text</span>
  <span class="k">end</span>
<span class="k">end</span></code></pre></figure><p>In order to use <code>Log</code> and <code>Line</code> together, we have to do this:</p><figure class="highlight"><pre><code class="language-ruby" data-lang="ruby"><span></span><span class="n">log</span><span class="o">.</span><span class="n">put</span><span class="p">(</span><span class="no">Line</span><span class="o">.</span><span class="n">new</span><span class="p">(</span><span class="s2">&quot;Hello, world&quot;</span><span class="p">))</span></code></pre></figure><p>See why it&#39;s horizontal? Because this script sees them both. They both are on the same level of visibility. We will always have to communicate with both of them when we want to log a line. Both objects of <code>Log</code> and <code>Line</code> are in front of us. We have to deal with two classes in order to log a line:</p><p><img src='/uml/653125b6c32d12b7325dba52054c09ca.svg' style="width:30%" alt='PlantUML SVG diagram' class='plantuml'/></p><p>To the contrary, this decomposition of responsibility is <em>vertical</em>:</p><figure class="highlight"><pre><code class="language-ruby" data-lang="ruby"><span></span><span class="k">class</span> <span class="nc">TimedLog</span>
  <span class="k">def</span> <span class="nf">initialize</span><span class="p">(</span><span class="n">log</span><span class="p">)</span>
    <span class="vi">@origin</span> <span class="o">=</span> <span class="n">log</span>
  <span class="k">end</span>
  <span class="k">def</span> <span class="nf">put</span><span class="p">(</span><span class="n">text</span><span class="p">)</span>
    <span class="vi">@origin</span><span class="o">.</span><span class="n">put</span><span class="p">(</span><span class="no">Time</span><span class="o">.</span><span class="n">now</span><span class="o">.</span><span class="n">strftime</span><span class="p">(</span><span class="s2">&quot;%d/%m/%Y %H:%M &quot;</span><span class="p">)</span> <span class="o">+</span> <span class="n">text</span><span class="p">)</span>
  <span class="k">end</span>
<span class="k">end</span></code></pre></figure><p>Class <code>TimedLog</code> is a decorator, and this is how we use them together:</p><figure class="highlight"><pre><code class="language-ruby" data-lang="ruby"><span></span><span class="n">log</span> <span class="o">=</span> <span class="no">TimedLog</span><span class="o">.</span><span class="n">new</span><span class="p">(</span><span class="n">log</span><span class="p">)</span></code></pre></figure><p>Now, we just put a line in the log:</p><figure class="highlight"><pre><code class="language-ruby" data-lang="ruby"><span></span><span class="n">log</span><span class="o">.</span><span class="n">put</span><span class="p">(</span><span class="s2">&quot;Hello, world&quot;</span><span class="p">)</span></code></pre></figure><p>The responsibility is decomposed vertically. We still have one entry point into the <code>log</code> object, but the object &quot;consists&quot; of two objects, one wrapped into another:</p><p><img src='/uml/cad4de541e1ab10d3d9d751c661fe63f.svg' style="width:20%" alt='PlantUML SVG diagram' class='plantuml'/></p><p>In general, I think horizontal decomposition of responsibility is a bad idea, while vertical is a much better one. That&#39;s because a vertically decomposed object decreases complexity, while a horizontally decomposed one actually makes things more complex because its clients have to deal with more dependencies and more points of contact.</p></p><nav class="buttons notranslate desktop-only"> <a href="http://www.facebook.com/sharer/sharer.php?u=https://www.yegor256.com/2016/08/30/decomposition-of-responsibility.html" title="Share on Facebook" class="button" rel="nofollow"> <span class="count count-facebook">0</span> <i class="icon icon-facebook notranslate" aria-hidden="true"></i> </a> <a href="https://twitter.com/share?url=https://www.yegor256.com/2016/08/30/decomposition-of-responsibility.html&amp;text=Vertical+vs.+Horizontal+Decomposition+of+Responsibility" title="Share on Twitter" class="button" rel="nofollow"> <span class="count count-twitter">0</span> <i class="icon icon-twitter notranslate" aria-hidden="true"></i> </a> <a href="https://plus.google.com/share?url=https://www.yegor256.com/2016/08/30/decomposition-of-responsibility.html" title="Share on Google+" class="button" rel="nofollow"> <span class="count count-googleplus">0</span> <i class="icon icon-googleplus notranslate" aria-hidden="true"></i> </a> <a href="https://www.linkedin.com/cws/share?url=https://www.yegor256.com/2016/08/30/decomposition-of-responsibility.html" title="Share on LinkedIn" class="button" rel="nofollow"> <span class="count count-linkedin">0</span> <i class="icon icon-linkedin notranslate" aria-hidden="true"></i> </a> <a href="http://reddit.com/submit?url=https://www.yegor256.com/2016/08/30/decomposition-of-responsibility.html%3F2016-35&amp;title=Vertical+vs.+Horizontal+Decomposition+of+Responsibility" title="Share on Reddit" class="button" rel="nofollow"> <span class="count count-reddit">0</span> <i class="icon icon-reddit notranslate" aria-hidden="true"></i> </a> <a href="http://news.ycombinator.com/submitlink?u=https://www.yegor256.com/2016/08/30/decomposition-of-responsibility.html%3F2016-35&amp;t=Vertical+vs.+Horizontal+Decomposition+of+Responsibility" title="Share on Hacker News" class="button" rel="nofollow"> <span class="count count-hackernews">0</span> <i class="icon icon-hackernews notranslate" aria-hidden="true"></i> </a> </nav> </header> <article class="main" itemprop="articleBody"><div ><p>Objects responsible for too many things are a problem. Because their complexity is high, they are difficult to maintain and extend. <em>Decomposition of responsibility</em> is what we do in order to break these overly complex objects into smaller ones. I see two types of this refactoring operation: vertical and horizontal. And I believe the former is better than the latter.</p><figure class='jb_picture'><img itemprop='image' alt='Once Upon a Time in America (1984) by Sergio Leone' src='/images/2016/08/once-upon-a-time-in-america.jpg' longdesc='#f7308496'/><figcaption id='f7308496'>Once Upon a Time in America (1984) by Sergio Leone</figcaption></figure><p>Let&#39;s say this is our code (it is Ruby):</p><figure class="highlight"><pre><code class="language-ruby" data-lang="ruby"><span></span><span class="k">class</span> <span class="nc">Log</span>
  <span class="k">def</span> <span class="nf">initialize</span><span class="p">(</span><span class="n">path</span><span class="p">)</span>
    <span class="vi">@file</span> <span class="o">=</span> <span class="no">IO</span><span class="o">.</span><span class="n">new</span><span class="p">(</span><span class="n">path</span><span class="p">,</span> <span class="s1">&#39;a&#39;</span><span class="p">)</span>
  <span class="k">end</span>
  <span class="k">def</span> <span class="nf">put</span><span class="p">(</span><span class="n">text</span><span class="p">)</span>
    <span class="n">line</span> <span class="o">=</span> <span class="no">Time</span><span class="o">.</span><span class="n">now</span><span class="o">.</span><span class="n">strftime</span><span class="p">(</span><span class="s2">&quot;%d/%m/%Y %H:%M &quot;</span><span class="p">)</span> <span class="o">+</span> <span class="n">text</span>
    <span class="vi">@file</span><span class="o">.</span><span class="n">puts</span> <span class="n">line</span>
  <span class="k">end</span>
<span class="k">end</span></code></pre></figure><p>Obviously, objects of this class are doing too much. They save log lines to the file and also format them---an obvious violation of a famous <a href="https://en.wikipedia.org/wiki/Single_responsibility_principle">single responsibility principle</a>. An object of this class would be <em>responsible</em> for too many things. We have to extract some functionality out of it and put that into another object(s). We have to <em>decompose</em> its responsibility. No matter where we put it, this is how the <code>Log</code> class will look after the extraction:</p><figure class="highlight"><pre><code class="language-ruby" data-lang="ruby"><span></span><span class="k">class</span> <span class="nc">Log</span>
  <span class="k">def</span> <span class="nf">initialize</span><span class="p">(</span><span class="n">path</span><span class="p">)</span>
    <span class="vi">@file</span> <span class="o">=</span> <span class="no">IO</span><span class="o">.</span><span class="n">new</span><span class="p">(</span><span class="n">path</span><span class="p">,</span> <span class="s1">&#39;a&#39;</span><span class="p">)</span>
  <span class="k">end</span>
  <span class="k">def</span> <span class="nf">put</span><span class="p">(</span><span class="n">line</span><span class="p">)</span>
    <span class="vi">@file</span><span class="o">.</span><span class="n">puts</span> <span class="n">line</span>
  <span class="k">end</span>
<span class="k">end</span></code></pre></figure><p>Now it only saves lines to the file, which is perfect. The class is cohesive and small. Let&#39;s make an instance of it:</p><figure class="highlight"><pre><code class="language-ruby" data-lang="ruby"><span></span><span class="n">log</span> <span class="o">=</span> <span class="no">Log</span><span class="o">.</span><span class="n">new</span><span class="p">(</span><span class="s1">&#39;/tmp/log.txt&#39;</span><span class="p">)</span></code></pre></figure><p>Next, where do we put the lines with formatting functionality that were just extracted? There are two approaches to decompose responsibility: horizontal and vertical. This one is <em>horizontal</em>:</p><figure class="highlight"><pre><code class="language-ruby" data-lang="ruby"><span></span><span class="k">class</span> <span class="nc">Line</span>
  <span class="k">def</span> <span class="nf">initialize</span><span class="p">(</span><span class="n">text</span><span class="p">)</span>
    <span class="vi">@line</span> <span class="o">=</span> <span class="n">text</span>
  <span class="k">end</span>
  <span class="k">def</span> <span class="nf">to_s</span>
    <span class="no">Time</span><span class="o">.</span><span class="n">now</span><span class="o">.</span><span class="n">strftime</span><span class="p">(</span><span class="s2">&quot;%d/%m/%Y %H:%M &quot;</span><span class="p">)</span> <span class="o">+</span> <span class="n">text</span>
  <span class="k">end</span>
<span class="k">end</span></code></pre></figure><p>In order to use <code>Log</code> and <code>Line</code> together, we have to do this:</p><figure class="highlight"><pre><code class="language-ruby" data-lang="ruby"><span></span><span class="n">log</span><span class="o">.</span><span class="n">put</span><span class="p">(</span><span class="no">Line</span><span class="o">.</span><span class="n">new</span><span class="p">(</span><span class="s2">&quot;Hello, world&quot;</span><span class="p">))</span></code></pre></figure><p>See why it&#39;s horizontal? Because this script sees them both. They both are on the same level of visibility. We will always have to communicate with both of them when we want to log a line. Both objects of <code>Log</code> and <code>Line</code> are in front of us. We have to deal with two classes in order to log a line:</p><p><img src='/uml/653125b6c32d12b7325dba52054c09ca.svg' style="width:30%" alt='PlantUML SVG diagram' class='plantuml'/></p><p>To the contrary, this decomposition of responsibility is <em>vertical</em>:</p><figure class="highlight"><pre><code class="language-ruby" data-lang="ruby"><span></span><span class="k">class</span> <span class="nc">TimedLog</span>
  <span class="k">def</span> <span class="nf">initialize</span><span class="p">(</span><span class="n">log</span><span class="p">)</span>
    <span class="vi">@origin</span> <span class="o">=</span> <span class="n">log</span>
  <span class="k">end</span>
  <span class="k">def</span> <span class="nf">put</span><span class="p">(</span><span class="n">text</span><span class="p">)</span>
    <span class="vi">@origin</span><span class="o">.</span><span class="n">put</span><span class="p">(</span><span class="no">Time</span><span class="o">.</span><span class="n">now</span><span class="o">.</span><span class="n">strftime</span><span class="p">(</span><span class="s2">&quot;%d/%m/%Y %H:%M &quot;</span><span class="p">)</span> <span class="o">+</span> <span class="n">text</span><span class="p">)</span>
  <span class="k">end</span>
<span class="k">end</span></code></pre></figure><p>Class <code>TimedLog</code> is a decorator, and this is how we use them together:</p><figure class="highlight"><pre><code class="language-ruby" data-lang="ruby"><span></span><span class="n">log</span> <span class="o">=</span> <span class="no">TimedLog</span><span class="o">.</span><span class="n">new</span><span class="p">(</span><span class="n">log</span><span class="p">)</span></code></pre></figure><p>Now, we just put a line in the log:</p><figure class="highlight"><pre><code class="language-ruby" data-lang="ruby"><span></span><span class="n">log</span><span class="o">.</span><span class="n">put</span><span class="p">(</span><span class="s2">&quot;Hello, world&quot;</span><span class="p">)</span></code></pre></figure><p>The responsibility is decomposed vertically. We still have one entry point into the <code>log</code> object, but the object &quot;consists&quot; of two objects, one wrapped into another:</p><p><img src='/uml/cad4de541e1ab10d3d9d751c661fe63f.svg' style="width:20%" alt='PlantUML SVG diagram' class='plantuml'/></p><p>In general, I think horizontal decomposition of responsibility is a bad idea, while vertical is a much better one. That&#39;s because a vertically decomposed object decreases complexity, while a horizontally decomposed one actually makes things more complex because its clients have to deal with more dependencies and more points of contact.</p></div></article></div><div class="wrapper"> <related-posts /></div><div class="disqus" role="complementary"><p class="disqus_hint"> Please, use <a href="https://help.disqus.com/commenting/what-html-tags-are-allowed-within-comments">syntax highlighting</a> in your comments, to make them more readable.</p><div id="disqus_thread" class="disqus-thread"> <a>&nbsp;</a></div><script> var disqus_config = function () { this.page.url = document.location.href.split('?')[0].split('#')[0].replace('https://', 'http://'); this.page.identifier = this.page.url; }; (function() { var d = document, s = d.createElement('script'); s.src = '//yegor256.disqus.com/embed.js'; s.setAttribute('data-timestamp', +new Date()); (d.head || d.body).appendChild(s); })(); </script> <noscript><div><p class="red"> JavaScript is disabled in your browser, that's why you can't see comments under this post.</p></div></noscript></div><div class="wrapper"> <footer class="footer"><p> &copy; <span itemscope="" itemprop="copyrightHolder" itemtype="http://schema.org/Person"> <span itemprop="name">Yegor Bugayenko</span> </span> 2014&ndash;<span itemprop="copyrightYear">2018</span></p></footer></div></section><div class="wrapper unprintable" style="text-align:center;margin-top:2em;"> <a href="http://www.sixnines.io/h/3ba1652f"> <img src="//www.sixnines.io/b/3ba1652f?style=flat" alt="sixnines availability badge"/> </a></div><script src="//code.jquery.com/jquery-1.9.0.min.js"></script> <script src="/js/all.js?a0e0d018c07"></script> <script>var disqus_shortname = 'yegor256';</script> <script id="dsq-count-scr" src="//yegor256.disqus.com/count.js" async="async"></script> <script> (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){ (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o), m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m) })(window,document,'script','//www.google-analytics.com/analytics.js','ga'); ga('create', 'UA-1963507-32', 'auto'); ga('send', 'pageview'); </script> <script> Cd=document;Cr="&"+Math.random();Cp="&s=1"; Cd.cookie="b=b";if(Cd.cookie)Cp+="&c=1"; Cp+="&t="+(new Date()).getTimezoneOffset(); if(self!=top)Cp+="&f=1"; </script> <script> if(navigator.javaEnabled())Cp+="&j=1"; </script> <script> if(typeof(screen)!='undefined')Cp+="&w="+screen.width+"&h="+ screen.height+"&d="+(screen.colorDepth?screen.colorDepth:screen.pixelDepth); </script> <script> Cd.write("<img src='//c.hit.ua/hit?i=95870&g=0&x=2"+Cp+Cr+ "&r="+escape(Cd.referrer)+"&u="+escape(window.location.href)+ "' border='0' wi"+"dth='1' he"+"ight='1'/>"); </script> <script type="application/ld+json"> { "@context": "http://schema.org", "@type": "Person", "name": "Yegor Bugayenko", "url": "http://www.yegor256.com", "sameAs": [ "https://www.facebook.com/yegor256", "https://instagram.com/yegor256", "https://www.linkedin.com/in/yegor256", "https://twitter.com/yegor256", "https://github.com/yegor256", "https://www.pinterest.com/yegor256/" ] } </script> </body> </html> <!DOCTYPE html> <html xmlns="http://www.w3.org/1999/xhtml" lang="en-US" xml:lang="en-US" itemscope="" itemtype="http://schema.org/WebSite"> <head> <meta charset="utf-8"/> <meta name="description" content="This is my collection of arguments against object-oriented programming in general, and its elements in particular, expressed by different people at different times. " /> <meta name="keywords" content="arguments against oop, criticism of object-oriented programming, oop criticism, oop vs functional programming, why oop is bad" /> <meta name="viewport" content="width=device-width,minimum-scale=1,initial-scale=1"/> <meta name="google-site-verification" content="JEj_gQr2CPe2QKGw8XdMz0R7VboQIUbX3FlM-lwTq-8" /> <meta name="author" content="Yegor Bugayenko"> <meta name="article:published_time" content="2016-08-15 00:00:00 +0000"> <meta name="og:site_name" content="Yegor Bugayenko"/> <meta name="og:type" content="article" /> <meta name="og:locale" content="en_US" /> <meta name="twitter:account_id" content="4503599630178231" /> <meta name="twitter:creator" content="@yegor256"/> <meta name="twitter:site" content="@yegor256"/> <meta name="twitter:title" property="og:title" content="What's Wrong With Object-Oriented Programming?"/> <meta name="twitter:description" property="og:description" content="This is my collection of arguments against object-oriented programming in general, and its elements in particular, expressed by different people at different times. "/> <meta name="twitter:url" property="og:url" content="https://www.yegor256.com/2016/08/15/what-is-wrong-object-oriented-programming.html"/> <meta name="telegram:channel" content="AAAAAEJFMRzsRTRxM3ec6A"/> <link rel="search" type="application/opensearchdescription+xml" href="/opensearch.xml" title="yegor256" /> <link rel="shortcut icon" href="/favicon.ico?a0e0d018c07"/> <link rel="apple-touch-icon" href="/favicon.ico?a0e0d018c07"/> <link rel="alternate" type="application/rss+xml" title="RSS for yegor256.com" href="https://www.yegor256.com/rss.xml"/> <link rel="stylesheet" href="/css/layout.css?a0e0d018c07"/> <link rel="stylesheet" href="/css/icons.css?a0e0d018c07"/> <link rel="canonical" href="https://www.yegor256.com/2016/08/15/what-is-wrong-object-oriented-programming.html" /> <link rel="amphtml" href="https://www.yegor256.com/2016/08/15/what-is-wrong-object-oriented-programming.amp.html" /> <title>What's Wrong With Object-Oriented Programming? </title> <style> .quote-author { width: 125px; height: 150px; } </style> <meta name='og:image' content='https://www.yegor256.com/images/2016/08/swingers.jpg'/><meta name='twitter:image' content='https://www.yegor256.com/images/2016/08/swingers.jpg'/><meta name='og:image:width' content='1200'/> <meta name='twitter:image:width' content='1200'/><meta name='og:image:height' content='645'/> <meta name='twitter:image:height' content='645'/><meta name='twitter:card' content='summary_large_image'/><meta name='twitter:image:alt' content='Swingers (1996) by Doug Liman'/> </head> <body><div class="wrapper"> <aside class="header-toggle unprintable" id="header-toggle" title="Show the menu" onclick="$('#header').show();$('#header-toggle').hide();">&#9776;</aside> <header class="header" id="header"><div class="face"> <a href="/about-me.html#form" class="sub" title="Click to subscribe to my monthly newsletter"><span>Subscribe</span></a> <a href="/about-me.html" style="position:relative;"> <img src="/images/face-256x256.jpg" class="photo" alt="Yegor Bugayenko"/> </a></div><nav><ul class="menu social notranslate"> <li><a href="https://twitter.com/intent/follow?screen_name=yegor256" rel="nofollow" title="Follow me on Twitter"><i class="icon icon-twitter notranslate" aria-hidden="true"></i></a></li> <li><a href="/rss.xml" rel="nofollow" title="Subscribe to my RSS feed"><i class="icon icon-rss notranslate" aria-hidden="true"></i></a></li> <li><a itemprop="sameAs" href="https://github.com/yegor256" rel="nofollow" title="My GitHub profile"><i class="icon icon-github notranslate" aria-hidden="true"></i></a></li> <li><a itemprop="sameAs" href="http://stackoverflow.com/users/187141/yegor256" rel="nofollow" title="My StackOverflow profile"><i class="icon icon-stackoverflow notranslate" aria-hidden="true"></i></a></li> <li><a itemprop="sameAs" href="https://www.facebook.com/yegor256" rel="nofollow" title="Follow me on Facebook"><i class="icon icon-facebook notranslate" aria-hidden="true"></i></a></li> <li><a itemprop="sameAs" href="https://instagram.com/yegor256" rel="nofollow" title="Follow me on Instagram"><i class="icon icon-instagram notranslate" aria-hidden="true"></i></a></li> <li><a itemprop="sameAs" href="https://www.linkedin.com/in/yegor256" rel="nofollow" title="My LinkedIn profile"><i class="icon icon-linkedin notranslate" aria-hidden="true"></i></a></li> <li><a itemprop="sameAs" href="https://www.youtube.com/c/yegor256?sub_confirmation=1" rel="nofollow" title="My Youtube video channel"><i class="icon icon-youtube notranslate" aria-hidden="true"></i></a></li> <li><a itemprop="sameAs" href="https://www.pinterest.com/yegor256/" rel="nofollow" title="My Pinterest boards"><i class="icon icon-pinterest notranslate" aria-hidden="true"></i></a></li> <li><a itemprop="sameAs" href="https://angel.co/yegor256" rel="nofollow" title="My AngelList profile"><i class="icon icon-angellist notranslate" aria-hidden="true"></i></a></li> <li><a href="https://soundcloud.com/yegor256" rel="nofollow" title="My podcast"><i class="icon icon-podcast notranslate" aria-hidden="true"></i></a></li> <li><a href="https://itunes.apple.com/us/podcast/yegor256-podcast/id1150826721" rel="nofollow" title="My iTunes podcast"><i class="icon icon-itunes notranslate" aria-hidden="true"></i></a></li> <li><a href="https://t.me/joinchat/AAAAAEJFMRzsRTRxM3ec6A" rel="nofollow" title="My Telegram public channel"><i class="icon icon-telegram notranslate" aria-hidden="true"></i></a></li> <li><a href="mailto:blog@yegor256.com" rel="nofollow" title="Email me any time"><i class="icon icon-mail notranslate" aria-hidden="true"></i></a></li></ul><ul class="menu"> <li><a href="/" title="Home page">Home</a></li> <li ><a href="/best.html" title="Best articles to read">12&#160;Best</a></li> <li ><a href="/contents.html" title="The contents of the entire blog">All&#160;288</a></li> <li ><a href="/webinars.html" title="My webinars">Webinars</a></li> <li ><a href="/talks.html" title="Future and past conference talks">Talks</a></li> <li ><a href="/books.html" title="The books I wrote">Books</a></li> <li ><a href="/papers.html" title="My academic papers and patents">Papers</a></li> <li ><a href="/pets.html" title="My loved pet projects">Pets</a></li> <li ><a href="/award.html" title="Software quality award">Award</a></li> <li ><a href="/testimonials.html" title="What some people say about me">Testimonials</a></li> <li ><a href="/shift-m.html" title="Audio podcast about project management">Shift-M</a></li> <li ><a href="/paintings.html" title="My paintings for sale">Paintings</a></li> <li><a href="http://ru.yegor256.com/" title="Немного на русском языке">По-русски</a></li></ul></nav><div class="search"> <form method="get" action="https://www.google.com/search" itemprop="potentialAction" itemscope="" itemtype="http://schema.org/SearchAction"> <meta itemprop="target" content="https://www.google.com/search?q={q}"/> <input name="sitesearch" value="yegor256.com" type="hidden"/> <input itemprop="query-input" type="text" id="search-query" class="field field-text" required="required" onfocus="$('.google').css('visibility', 'visible');" name="q" placeholder="Search..." autocomplete="off"/> <input type="image" src="/images/google-search-icon.svg" class="google" title="Search via Google" alt="Search via Google"/> </form></div><div class="hot"><ul> <li> <a href="/code-ahead.html">Code Ahead</a> was published on Amazon just a few days ago! It is my new book, a novel about programmers. It explains in details the majority of ideas that stand behind <a href="https://www.zerocracy.com">Zerocracy</a> and <a href="https://www.xdsd.org">XDSD</a>. </li> <li> At <a href="/webinars.html">Webinar #37</a> we will discuss naming problem in OOP, for objects, methods and attributes; join us on <b>September 12</b>, at 11am PST. </li></ul></div></header></div><section itemscope="" itemtype="http://schema.org/BlogPosting"><div class="wrapper"> <header><p class="printable"> <img src="https://api.qrserver.com/v1/create-qr-code/?data=https://www.yegor256.com/2016/08/15/what-is-wrong-object-oriented-programming.html&amp;format=svg" style="width:125px;height:125px;" alt="QR code"/></p><p class="printable"> <code itemprop="url">https://www.yegor256.com/2016/08/15/what-is-wrong-object-oriented-programming.html</code></p><h1 itemprop="name headline mainEntityOfPage">What's Wrong With Object-Oriented Programming?</h1><ul class="subline"> <li> <time itemprop="datePublished" datetime="2016-08-15T00:00:00+00:00"> 15 August 2016 </time> </li> <li class="desktop-only" itemprop="locationCreated">Palo Alto, CA</li> <li class="printable" itemscope="" itemprop="author" itemtype="http://schema.org/Person"> <span itemprop="name">Yegor Bugayenko</span> </li> <li class="unprintable"> <i class="icon icon-comments"></i> <a href="http://www.yegor256.com/2016/08/15/what-is-wrong-object-oriented-programming.html#disqus_thread" itemprop="discussionUrl">comments</a> </li></ul><ul class="subline"> <li>Discussed at:</li> <li><a href="https://dzone.com/articles/whats-wrong-with-object-oriented-programming">dzone</a></li></ul><p class="unprintable"><p>Recently, I was trying to convince a few of my readers that <a href="/2016/07/14/who-is-object.html">a better understanding of an object</a> in OOP would help us solve many problems in existing pseudo-object-oriented languages. Then, suddenly, the question came up: &quot;<strong>What problems?</strong>&quot; I was puzzled. I thought it was obvious that the vast majority of modern software written in modern OO languages is unmaintainable and simply a mess. So I Googled a bit, and this is what I found (in chronological order).</p><figure class='jb_picture'><img itemprop='image' alt='Swingers (1996) by Doug Liman' src='/images/2016/08/swingers.jpg' longdesc='#070cf1de'/><figcaption id='070cf1de'>Swingers (1996) by Doug Liman</figcaption></figure><p>The list of quotes is sorted in chronological order, with the oldest on the top:</p><p><img src="/images/2016/08/edsger-dijkstra.jpg" class="quote-author" alt="Edsger W. Dijkstra"/><br/> <a href="https://en.wikipedia.org/wiki/Edsger_W._Dijkstra"><strong>Edsger W. Dijkstra</strong></a> (1989)<br/> &quot;TUG LINES,&quot; Issue 32, August 1989<br/> &quot;Object oriented programs are offered as alternatives to correct ones&quot; and &quot;Object-oriented programming is an exceptionally bad idea which could only have originated in California.&quot;</p><aside class='youtube'> <a href='https://www.youtube.com/watch?v=cGcCcxx4xrg'><div class='box'> <img src='https://i.ytimg.com/vi/cGcCcxx4xrg/mqdefault.jpg' alt='YouTube video #cGcCcxx4xrg'/><div class='play'><i class='icon icon-play'></i></div></div></a><div>Java vs OOP (JavaDay Kyiv); 14 October 2016.</div></aside><p><img src="/images/2016/08/alan-kay.jpg" class="quote-author" alt="Alan Kay"/><br/> <a href="https://en.wikipedia.org/wiki/Alan_Kay"><strong>Alan Kay</strong></a> (1997)<br/> <a href="https://www.youtube.com/watch?v=oKg1hTOQXoY">The Computer Revolution hasn&#39;t happened yet</a><br/> &quot;I invented the term object-oriented, and I can tell you I did not have C++ in mind.&quot; and &quot;Java and C++ make you think that the new ideas are like the old ones. Java is the most distressing thing to happen to computing since MS-DOS.&quot; (<a href="http://www.cc.gatech.edu/fac/mark.guzdial/squeak/oopsla.html">proof</a>)</p><p><img src="/images/2016/08/paul-graham.jpg" class="quote-author" alt="Paul Graham"/><br/> <a href="https://en.wikipedia.org/wiki/Paul_Graham_%28computer_programmer%29"><strong>Paul Graham</strong></a> (2003)<br/> <a href="http://www.paulgraham.com/hundred.html">The Hundred-Year Language</a><br/> &quot;Object-oriented programming offers a sustainable way to write spaghetti code.&quot;</p><p><img src="/images/2016/08/richard-mansfield.jpg" class="quote-author" alt="Richard Mansfield"/><br/> <strong>Richard Mansfield</strong> (2005)<br/> <a href="http://www.4js.com/files/documents/products/genero/WhitePaperHasOOPFailed.pdf">Has OOP Failed?</a><br/> &quot;With OOP-inflected programming languages, computer software becomes more verbose, less readable, less descriptive, and harder to modify and maintain.&quot;</p><p><img src="/images/2016/08/eric-raymond.jpg" class="quote-author" alt="Eric Raymond"/><br/> <a href="http://www.catb.org/esr/"><strong>Eric Raymond</strong></a> (2005)<br/> <a href="http://catb.org/esr/writings/taoup/html/unix_and_oo.html">The Art of UNIX Programming</a><br/> &quot;The OO design concept initially proved valuable in the design of graphics systems, graphical user interfaces, and certain kinds of simulation. To the surprise and gradual disillusionment of many, it has proven difficult to demonstrate significant benefits of OO outside those areas.&quot;</p><p><img src="/images/2016/08/jeff-atwood.jpg" class="quote-author" alt="Jeff Atwood"/><br/> <a href="https://blog.codinghorror.com/"><strong>Jeff Atwood</strong></a> (2007)<br/> <a href="https://blog.codinghorror.com/your-code-oop-or-poo/">Your Code: OOP or POO?</a><br/> &quot;OO seems to bring at least as many problems to the table as it solves.&quot;</p><p><img src="/images/2016/08/linus-torvalds.jpg" class="quote-author" alt="Linus Torvalds"/><br/> <a href="https://en.wikipedia.org/wiki/Linus_Torvalds"><strong>Linus Torvalds</strong></a> (2007)<br/> <a href="http://article.gmane.org/gmane.comp.version-control.git/57918/">this email</a><br/> &quot;C++ is a horrible language. ... C++ leads to really, really bad design choices. ... In other words, the only way to do good, efficient, and system-level and portable C++ ends up to limit yourself to all the things that are basically available in C. And limiting your project to C means that people don&#39;t screw that up, and also means that you get a lot of programmers that do actually understand low-level issues and don&#39;t screw things up with any idiotic &quot;object model&quot; crap.&quot;</p><p><img src="/images/2016/08/oscar-nierstrasz.jpg" class="quote-author" alt="Oscar Nierstrasz"/><br/> <a href="https://en.wikipedia.org/wiki/Oscar_Nierstrasz"><strong>Oscar Nierstrasz</strong></a> (2010)<br/> <a href="http://blog.jot.fm/2010/08/26/ten-things-i-hate-about-object-oriented-programming">Ten Things I Hate About Object-Oriented Programming</a><br/> &quot;OOP is about taming complexity through modeling, but we have not mastered this yet, possibly because we have difficulty distinguishing real and accidental complexity.&quot;</p><p><img src="/images/2016/08/rich-hickey.jpg" class="quote-author" alt="Rich Hickey"/><br/> <a href="https://github.com/richhickey"><strong>Rich Hickey</strong></a> (2010)<br/> <a href="http://www.se-radio.net/2010/03/episode-158-rich-hickey-on-clojure/">SE Radio, Episode 158</a><br/> &quot;I think that large objected-oriented programs struggle with increasing complexity as you build this large object graph of mutable objects. You know, trying to understand and keep in your mind what will happen when you call a method and what will the side effects be.&quot;</p><p><img src="/images/2016/08/eric-allman.jpg" class="quote-author" alt="Eric Allman"/><br/> <a href="https://en.wikipedia.org/wiki/Eric_Allman"><strong>Eric Allman</strong></a> (2011)<br/> <a href="http://queue.acm.org/blogposting.cfm?id=34658">Programming Isn&#39;t Fun Any More</a><br/> &quot;I used to be enamored of object-oriented programming. I&#39;m now finding myself leaning toward believing that it is a plot designed to destroy joy. The methodology looks clean and elegant at first, but when you actually get into real programs they rapidly turn into horrid messes.&quot;</p><p><img src="/images/2016/08/joe-armstrong.jpg" class="quote-author" alt="Joe Armstrong"/><br/> <a href="http://joearms.github.io/"><strong>Joe Armstrong</strong></a> (2011)<br/> <a href="http://harmful.cat-v.org/software/OO_programming/why_oo_sucks">Why OO Sucks</a><br/> &quot;Objects bind functions and data structures together in indivisible units. I think this is a fundamental error since functions and data structures belong in totally different worlds.&quot;</p><p><img src="/images/2016/08/rob-pike.jpg" class="quote-author" alt="Rob Pike"/><br/> <a href="https://en.wikipedia.org/wiki/Rob_Pike"><strong>Rob Pike</strong></a> (2012)<br/> <a href="https://plus.google.com/+RobPikeTheHuman/posts/hoJdanihKwb">here</a><br/> &quot;Object-oriented programming, whose essence is nothing more than programming using data with associated behaviors, is a powerful idea. It truly is. But it&#39;s not always the best idea. ... Sometimes data is just data and functions are just functions.&quot;</p><p><img src="/images/2016/08/john-barker.jpg" class="quote-author" alt="John Barker"/><br/> <a href="https://www.linkedin.com/in/johnebgood"><strong>John Barker</strong></a> (2013)<br/> <a href="https://blog.pivotal.io/labs/labs/all-evidence-points-to-oop-being-bullshit">All evidence points to OOP being bullshit</a><br/> &quot;What OOP introduces are abstractions that attempt to improve code sharing and security. In many ways, it is still essentially procedural code.&quot;</p><p><img src="/images/2016/08/lawrence-krubner.jpg" class="quote-author" alt="Lawrence Krubner"/><br/> <a href="https://www.linkedin.com/in/krubner"><strong>Lawrence Krubner</strong></a> (2014)<br/> <a href="http://www.smashcompany.com/technology/object-oriented-programming-is-an-expensive-disaster-which-must-end">Object Oriented Programming is an expensive disaster which must end</a><br/> &quot;We now know that OOP is an experiment that failed. It is time to move on. It is time that we, as a community, admit that this idea has failed us, and we must give up on it.&quot;</p><p><img src="/images/2016/08/asaf-shelly.jpg" class="quote-author" alt="Asaf Shelly"/><br/> <a href="https://www.linkedin.com/in/asafshelly"><strong>Asaf Shelly</strong></a> (2015)<br/> <a href="https://software.intel.com/en-us/blogs/2008/08/22/flaws-of-object-oriented-modeling/">Flaws of Object Oriented Modeling</a><br/> &quot;Reading an object oriented code you can&#39;t see the big picture and it is often impossible to review all the small functions that call the one function that you modified.&quot;</p><hr/><p>If you have something to add to this list, please post a comment below.</p></p><nav class="buttons notranslate desktop-only"> <a href="http://www.facebook.com/sharer/sharer.php?u=https://www.yegor256.com/2016/08/15/what-is-wrong-object-oriented-programming.html" title="Share on Facebook" class="button" rel="nofollow"> <span class="count count-facebook">0</span> <i class="icon icon-facebook notranslate" aria-hidden="true"></i> </a> <a href="https://twitter.com/share?url=https://www.yegor256.com/2016/08/15/what-is-wrong-object-oriented-programming.html&amp;text=What%27s+Wrong+With+Object-Oriented+Programming%3F" title="Share on Twitter" class="button" rel="nofollow"> <span class="count count-twitter">0</span> <i class="icon icon-twitter notranslate" aria-hidden="true"></i> </a> <a href="https://plus.google.com/share?url=https://www.yegor256.com/2016/08/15/what-is-wrong-object-oriented-programming.html" title="Share on Google+" class="button" rel="nofollow"> <span class="count count-googleplus">0</span> <i class="icon icon-googleplus notranslate" aria-hidden="true"></i> </a> <a href="https://www.linkedin.com/cws/share?url=https://www.yegor256.com/2016/08/15/what-is-wrong-object-oriented-programming.html" title="Share on LinkedIn" class="button" rel="nofollow"> <span class="count count-linkedin">0</span> <i class="icon icon-linkedin notranslate" aria-hidden="true"></i> </a> <a href="http://reddit.com/submit?url=https://www.yegor256.com/2016/08/15/what-is-wrong-object-oriented-programming.html%3F2016-33&amp;title=What%27s+Wrong+With+Object-Oriented+Programming%3F" title="Share on Reddit" class="button" rel="nofollow"> <span class="count count-reddit">0</span> <i class="icon icon-reddit notranslate" aria-hidden="true"></i> </a> <a href="http://news.ycombinator.com/submitlink?u=https://www.yegor256.com/2016/08/15/what-is-wrong-object-oriented-programming.html%3F2016-33&amp;t=What%27s+Wrong+With+Object-Oriented+Programming%3F" title="Share on Hacker News" class="button" rel="nofollow"> <span class="count count-hackernews">0</span> <i class="icon icon-hackernews notranslate" aria-hidden="true"></i> </a> </nav> </header> <article class="main" itemprop="articleBody"><div ><p>Recently, I was trying to convince a few of my readers that <a href="/2016/07/14/who-is-object.html">a better understanding of an object</a> in OOP would help us solve many problems in existing pseudo-object-oriented languages. Then, suddenly, the question came up: &quot;<strong>What problems?</strong>&quot; I was puzzled. I thought it was obvious that the vast majority of modern software written in modern OO languages is unmaintainable and simply a mess. So I Googled a bit, and this is what I found (in chronological order).</p><figure class='jb_picture'><img itemprop='image' alt='Swingers (1996) by Doug Liman' src='/images/2016/08/swingers.jpg' longdesc='#070cf1de'/><figcaption id='070cf1de'>Swingers (1996) by Doug Liman</figcaption></figure><p>The list of quotes is sorted in chronological order, with the oldest on the top:</p><p><img src="/images/2016/08/edsger-dijkstra.jpg" class="quote-author" alt="Edsger W. Dijkstra"/><br/> <a href="https://en.wikipedia.org/wiki/Edsger_W._Dijkstra"><strong>Edsger W. Dijkstra</strong></a> (1989)<br/> &quot;TUG LINES,&quot; Issue 32, August 1989<br/> &quot;Object oriented programs are offered as alternatives to correct ones&quot; and &quot;Object-oriented programming is an exceptionally bad idea which could only have originated in California.&quot;</p><aside class='youtube'> <a href='https://www.youtube.com/watch?v=cGcCcxx4xrg'><div class='box'> <img src='https://i.ytimg.com/vi/cGcCcxx4xrg/mqdefault.jpg' alt='YouTube video #cGcCcxx4xrg'/><div class='play'><i class='icon icon-play'></i></div></div></a><div>Java vs OOP (JavaDay Kyiv); 14 October 2016.</div></aside><p><img src="/images/2016/08/alan-kay.jpg" class="quote-author" alt="Alan Kay"/><br/> <a href="https://en.wikipedia.org/wiki/Alan_Kay"><strong>Alan Kay</strong></a> (1997)<br/> <a href="https://www.youtube.com/watch?v=oKg1hTOQXoY">The Computer Revolution hasn&#39;t happened yet</a><br/> &quot;I invented the term object-oriented, and I can tell you I did not have C++ in mind.&quot; and &quot;Java and C++ make you think that the new ideas are like the old ones. Java is the most distressing thing to happen to computing since MS-DOS.&quot; (<a href="http://www.cc.gatech.edu/fac/mark.guzdial/squeak/oopsla.html">proof</a>)</p><p><img src="/images/2016/08/paul-graham.jpg" class="quote-author" alt="Paul Graham"/><br/> <a href="https://en.wikipedia.org/wiki/Paul_Graham_%28computer_programmer%29"><strong>Paul Graham</strong></a> (2003)<br/> <a href="http://www.paulgraham.com/hundred.html">The Hundred-Year Language</a><br/> &quot;Object-oriented programming offers a sustainable way to write spaghetti code.&quot;</p><p><img src="/images/2016/08/richard-mansfield.jpg" class="quote-author" alt="Richard Mansfield"/><br/> <strong>Richard Mansfield</strong> (2005)<br/> <a href="http://www.4js.com/files/documents/products/genero/WhitePaperHasOOPFailed.pdf">Has OOP Failed?</a><br/> &quot;With OOP-inflected programming languages, computer software becomes more verbose, less readable, less descriptive, and harder to modify and maintain.&quot;</p><p><img src="/images/2016/08/eric-raymond.jpg" class="quote-author" alt="Eric Raymond"/><br/> <a href="http://www.catb.org/esr/"><strong>Eric Raymond</strong></a> (2005)<br/> <a href="http://catb.org/esr/writings/taoup/html/unix_and_oo.html">The Art of UNIX Programming</a><br/> &quot;The OO design concept initially proved valuable in the design of graphics systems, graphical user interfaces, and certain kinds of simulation. To the surprise and gradual disillusionment of many, it has proven difficult to demonstrate significant benefits of OO outside those areas.&quot;</p><p><img src="/images/2016/08/jeff-atwood.jpg" class="quote-author" alt="Jeff Atwood"/><br/> <a href="https://blog.codinghorror.com/"><strong>Jeff Atwood</strong></a> (2007)<br/> <a href="https://blog.codinghorror.com/your-code-oop-or-poo/">Your Code: OOP or POO?</a><br/> &quot;OO seems to bring at least as many problems to the table as it solves.&quot;</p><p><img src="/images/2016/08/linus-torvalds.jpg" class="quote-author" alt="Linus Torvalds"/><br/> <a href="https://en.wikipedia.org/wiki/Linus_Torvalds"><strong>Linus Torvalds</strong></a> (2007)<br/> <a href="http://article.gmane.org/gmane.comp.version-control.git/57918/">this email</a><br/> &quot;C++ is a horrible language. ... C++ leads to really, really bad design choices. ... In other words, the only way to do good, efficient, and system-level and portable C++ ends up to limit yourself to all the things that are basically available in C. And limiting your project to C means that people don&#39;t screw that up, and also means that you get a lot of programmers that do actually understand low-level issues and don&#39;t screw things up with any idiotic &quot;object model&quot; crap.&quot;</p><p><img src="/images/2016/08/oscar-nierstrasz.jpg" class="quote-author" alt="Oscar Nierstrasz"/><br/> <a href="https://en.wikipedia.org/wiki/Oscar_Nierstrasz"><strong>Oscar Nierstrasz</strong></a> (2010)<br/> <a href="http://blog.jot.fm/2010/08/26/ten-things-i-hate-about-object-oriented-programming">Ten Things I Hate About Object-Oriented Programming</a><br/> &quot;OOP is about taming complexity through modeling, but we have not mastered this yet, possibly because we have difficulty distinguishing real and accidental complexity.&quot;</p><p><img src="/images/2016/08/rich-hickey.jpg" class="quote-author" alt="Rich Hickey"/><br/> <a href="https://github.com/richhickey"><strong>Rich Hickey</strong></a> (2010)<br/> <a href="http://www.se-radio.net/2010/03/episode-158-rich-hickey-on-clojure/">SE Radio, Episode 158</a><br/> &quot;I think that large objected-oriented programs struggle with increasing complexity as you build this large object graph of mutable objects. You know, trying to understand and keep in your mind what will happen when you call a method and what will the side effects be.&quot;</p><p><img src="/images/2016/08/eric-allman.jpg" class="quote-author" alt="Eric Allman"/><br/> <a href="https://en.wikipedia.org/wiki/Eric_Allman"><strong>Eric Allman</strong></a> (2011)<br/> <a href="http://queue.acm.org/blogposting.cfm?id=34658">Programming Isn&#39;t Fun Any More</a><br/> &quot;I used to be enamored of object-oriented programming. I&#39;m now finding myself leaning toward believing that it is a plot designed to destroy joy. The methodology looks clean and elegant at first, but when you actually get into real programs they rapidly turn into horrid messes.&quot;</p><p><img src="/images/2016/08/joe-armstrong.jpg" class="quote-author" alt="Joe Armstrong"/><br/> <a href="http://joearms.github.io/"><strong>Joe Armstrong</strong></a> (2011)<br/> <a href="http://harmful.cat-v.org/software/OO_programming/why_oo_sucks">Why OO Sucks</a><br/> &quot;Objects bind functions and data structures together in indivisible units. I think this is a fundamental error since functions and data structures belong in totally different worlds.&quot;</p><p><img src="/images/2016/08/rob-pike.jpg" class="quote-author" alt="Rob Pike"/><br/> <a href="https://en.wikipedia.org/wiki/Rob_Pike"><strong>Rob Pike</strong></a> (2012)<br/> <a href="https://plus.google.com/+RobPikeTheHuman/posts/hoJdanihKwb">here</a><br/> &quot;Object-oriented programming, whose essence is nothing more than programming using data with associated behaviors, is a powerful idea. It truly is. But it&#39;s not always the best idea. ... Sometimes data is just data and functions are just functions.&quot;</p><p><img src="/images/2016/08/john-barker.jpg" class="quote-author" alt="John Barker"/><br/> <a href="https://www.linkedin.com/in/johnebgood"><strong>John Barker</strong></a> (2013)<br/> <a href="https://blog.pivotal.io/labs/labs/all-evidence-points-to-oop-being-bullshit">All evidence points to OOP being bullshit</a><br/> &quot;What OOP introduces are abstractions that attempt to improve code sharing and security. In many ways, it is still essentially procedural code.&quot;</p><p><img src="/images/2016/08/lawrence-krubner.jpg" class="quote-author" alt="Lawrence Krubner"/><br/> <a href="https://www.linkedin.com/in/krubner"><strong>Lawrence Krubner</strong></a> (2014)<br/> <a href="http://www.smashcompany.com/technology/object-oriented-programming-is-an-expensive-disaster-which-must-end">Object Oriented Programming is an expensive disaster which must end</a><br/> &quot;We now know that OOP is an experiment that failed. It is time to move on. It is time that we, as a community, admit that this idea has failed us, and we must give up on it.&quot;</p><p><img src="/images/2016/08/asaf-shelly.jpg" class="quote-author" alt="Asaf Shelly"/><br/> <a href="https://www.linkedin.com/in/asafshelly"><strong>Asaf Shelly</strong></a> (2015)<br/> <a href="https://software.intel.com/en-us/blogs/2008/08/22/flaws-of-object-oriented-modeling/">Flaws of Object Oriented Modeling</a><br/> &quot;Reading an object oriented code you can&#39;t see the big picture and it is often impossible to review all the small functions that call the one function that you modified.&quot;</p><hr/><p>If you have something to add to this list, please post a comment below.</p></div></article></div><div class="wrapper"> <related-posts /></div><div class="disqus" role="complementary"><p class="disqus_hint"> Please, use <a href="https://help.disqus.com/commenting/what-html-tags-are-allowed-within-comments">syntax highlighting</a> in your comments, to make them more readable.</p><div id="disqus_thread" class="disqus-thread"> <a>&nbsp;</a></div><script> var disqus_config = function () { this.page.url = document.location.href.split('?')[0].split('#')[0].replace('https://', 'http://'); this.page.identifier = this.page.url; }; (function() { var d = document, s = d.createElement('script'); s.src = '//yegor256.disqus.com/embed.js'; s.setAttribute('data-timestamp', +new Date()); (d.head || d.body).appendChild(s); })(); </script> <noscript><div><p class="red"> JavaScript is disabled in your browser, that's why you can't see comments under this post.</p></div></noscript></div><div class="wrapper"> <footer class="footer"><p> &copy; <span itemscope="" itemprop="copyrightHolder" itemtype="http://schema.org/Person"> <span itemprop="name">Yegor Bugayenko</span> </span> 2014&ndash;<span itemprop="copyrightYear">2018</span></p></footer></div></section><div class="wrapper unprintable" style="text-align:center;margin-top:2em;"> <a href="http://www.sixnines.io/h/3ba1652f"> <img src="//www.sixnines.io/b/3ba1652f?style=flat" alt="sixnines availability badge"/> </a></div><script src="//code.jquery.com/jquery-1.9.0.min.js"></script> <script src="/js/all.js?a0e0d018c07"></script> <script>var disqus_shortname = 'yegor256';</script> <script id="dsq-count-scr" src="//yegor256.disqus.com/count.js" async="async"></script> <script> (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){ (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o), m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m) })(window,document,'script','//www.google-analytics.com/analytics.js','ga'); ga('create', 'UA-1963507-32', 'auto'); ga('send', 'pageview'); </script> <script> Cd=document;Cr="&"+Math.random();Cp="&s=1"; Cd.cookie="b=b";if(Cd.cookie)Cp+="&c=1"; Cp+="&t="+(new Date()).getTimezoneOffset(); if(self!=top)Cp+="&f=1"; </script> <script> if(navigator.javaEnabled())Cp+="&j=1"; </script> <script> if(typeof(screen)!='undefined')Cp+="&w="+screen.width+"&h="+ screen.height+"&d="+(screen.colorDepth?screen.colorDepth:screen.pixelDepth); </script> <script> Cd.write("<img src='//c.hit.ua/hit?i=95870&g=0&x=2"+Cp+Cr+ "&r="+escape(Cd.referrer)+"&u="+escape(window.location.href)+ "' border='0' wi"+"dth='1' he"+"ight='1'/>"); </script> <script type="application/ld+json"> { "@context": "http://schema.org", "@type": "Person", "name": "Yegor Bugayenko", "url": "http://www.yegor256.com", "sameAs": [ "https://www.facebook.com/yegor256", "https://instagram.com/yegor256", "https://www.linkedin.com/in/yegor256", "https://twitter.com/yegor256", "https://github.com/yegor256", "https://www.pinterest.com/yegor256/" ] } </script> </body> </html> <!DOCTYPE html> <html xmlns="http://www.w3.org/1999/xhtml" lang="en-US" xml:lang="en-US" itemscope="" itemtype="http://schema.org/WebSite"> <head> <meta charset="utf-8"/> <meta name="description" content="Forking is a perfect mechanism to control execution flow in a procedure, which has almost no right to exist in OOP. " /> <meta name="keywords" content="if forking, if then else, if then else oop, oop forking" /> <meta name="viewport" content="width=device-width,minimum-scale=1,initial-scale=1"/> <meta name="google-site-verification" content="JEj_gQr2CPe2QKGw8XdMz0R7VboQIUbX3FlM-lwTq-8" /> <meta name="author" content="Yegor Bugayenko"> <meta name="article:published_time" content="2016-08-10 00:00:00 +0000"> <meta name="og:site_name" content="Yegor Bugayenko"/> <meta name="og:type" content="article" /> <meta name="og:locale" content="en_US" /> <meta name="twitter:account_id" content="4503599630178231" /> <meta name="twitter:creator" content="@yegor256"/> <meta name="twitter:site" content="@yegor256"/> <meta name="twitter:title" property="og:title" content="If-Then-Else Is a Code Smell"/> <meta name="twitter:description" property="og:description" content="Forking is a perfect mechanism to control execution flow in a procedure, which has almost no right to exist in OOP. "/> <meta name="twitter:url" property="og:url" content="https://www.yegor256.com/2016/08/10/if-then-else-code-smell.html"/> <meta name="telegram:channel" content="AAAAAEJFMRzsRTRxM3ec6A"/> <link rel="search" type="application/opensearchdescription+xml" href="/opensearch.xml" title="yegor256" /> <link rel="shortcut icon" href="/favicon.ico?a0e0d018c07"/> <link rel="apple-touch-icon" href="/favicon.ico?a0e0d018c07"/> <link rel="alternate" type="application/rss+xml" title="RSS for yegor256.com" href="https://www.yegor256.com/rss.xml"/> <link rel="stylesheet" href="/css/layout.css?a0e0d018c07"/> <link rel="stylesheet" href="/css/icons.css?a0e0d018c07"/> <link rel="canonical" href="https://www.yegor256.com/2016/08/10/if-then-else-code-smell.html" /> <link rel="amphtml" href="https://www.yegor256.com/2016/08/10/if-then-else-code-smell.amp.html" /> <title>If-Then-Else Is a Code Smell </title> <meta name='og:image' content='https://www.yegor256.com/images/2016/08/fargo.jpg'/><meta name='twitter:image' content='https://www.yegor256.com/images/2016/08/fargo.jpg'/><meta name='og:image:width' content='1200'/> <meta name='twitter:image:width' content='1200'/><meta name='og:image:height' content='650'/> <meta name='twitter:image:height' content='650'/><meta name='twitter:card' content='summary_large_image'/><meta name='twitter:image:alt' content='Fargo (1996) by Coen Brothers'/> </head> <body><div class="wrapper"> <aside class="header-toggle unprintable" id="header-toggle" title="Show the menu" onclick="$('#header').show();$('#header-toggle').hide();">&#9776;</aside> <header class="header" id="header"><div class="face"> <a href="/about-me.html#form" class="sub" title="Click to subscribe to my monthly newsletter"><span>Subscribe</span></a> <a href="/about-me.html" style="position:relative;"> <img src="/images/face-256x256.jpg" class="photo" alt="Yegor Bugayenko"/> </a></div><nav><ul class="menu social notranslate"> <li><a href="https://twitter.com/intent/follow?screen_name=yegor256" rel="nofollow" title="Follow me on Twitter"><i class="icon icon-twitter notranslate" aria-hidden="true"></i></a></li> <li><a href="/rss.xml" rel="nofollow" title="Subscribe to my RSS feed"><i class="icon icon-rss notranslate" aria-hidden="true"></i></a></li> <li><a itemprop="sameAs" href="https://github.com/yegor256" rel="nofollow" title="My GitHub profile"><i class="icon icon-github notranslate" aria-hidden="true"></i></a></li> <li><a itemprop="sameAs" href="http://stackoverflow.com/users/187141/yegor256" rel="nofollow" title="My StackOverflow profile"><i class="icon icon-stackoverflow notranslate" aria-hidden="true"></i></a></li> <li><a itemprop="sameAs" href="https://www.facebook.com/yegor256" rel="nofollow" title="Follow me on Facebook"><i class="icon icon-facebook notranslate" aria-hidden="true"></i></a></li> <li><a itemprop="sameAs" href="https://instagram.com/yegor256" rel="nofollow" title="Follow me on Instagram"><i class="icon icon-instagram notranslate" aria-hidden="true"></i></a></li> <li><a itemprop="sameAs" href="https://www.linkedin.com/in/yegor256" rel="nofollow" title="My LinkedIn profile"><i class="icon icon-linkedin notranslate" aria-hidden="true"></i></a></li> <li><a itemprop="sameAs" href="https://www.youtube.com/c/yegor256?sub_confirmation=1" rel="nofollow" title="My Youtube video channel"><i class="icon icon-youtube notranslate" aria-hidden="true"></i></a></li> <li><a itemprop="sameAs" href="https://www.pinterest.com/yegor256/" rel="nofollow" title="My Pinterest boards"><i class="icon icon-pinterest notranslate" aria-hidden="true"></i></a></li> <li><a itemprop="sameAs" href="https://angel.co/yegor256" rel="nofollow" title="My AngelList profile"><i class="icon icon-angellist notranslate" aria-hidden="true"></i></a></li> <li><a href="https://soundcloud.com/yegor256" rel="nofollow" title="My podcast"><i class="icon icon-podcast notranslate" aria-hidden="true"></i></a></li> <li><a href="https://itunes.apple.com/us/podcast/yegor256-podcast/id1150826721" rel="nofollow" title="My iTunes podcast"><i class="icon icon-itunes notranslate" aria-hidden="true"></i></a></li> <li><a href="https://t.me/joinchat/AAAAAEJFMRzsRTRxM3ec6A" rel="nofollow" title="My Telegram public channel"><i class="icon icon-telegram notranslate" aria-hidden="true"></i></a></li> <li><a href="mailto:blog@yegor256.com" rel="nofollow" title="Email me any time"><i class="icon icon-mail notranslate" aria-hidden="true"></i></a></li></ul><ul class="menu"> <li><a href="/" title="Home page">Home</a></li> <li ><a href="/best.html" title="Best articles to read">12&#160;Best</a></li> <li ><a href="/contents.html" title="The contents of the entire blog">All&#160;288</a></li> <li ><a href="/webinars.html" title="My webinars">Webinars</a></li> <li ><a href="/talks.html" title="Future and past conference talks">Talks</a></li> <li ><a href="/books.html" title="The books I wrote">Books</a></li> <li ><a href="/papers.html" title="My academic papers and patents">Papers</a></li> <li ><a href="/pets.html" title="My loved pet projects">Pets</a></li> <li ><a href="/award.html" title="Software quality award">Award</a></li> <li ><a href="/testimonials.html" title="What some people say about me">Testimonials</a></li> <li ><a href="/shift-m.html" title="Audio podcast about project management">Shift-M</a></li> <li ><a href="/paintings.html" title="My paintings for sale">Paintings</a></li> <li><a href="http://ru.yegor256.com/" title="Немного на русском языке">По-русски</a></li></ul></nav><div class="search"> <form method="get" action="https://www.google.com/search" itemprop="potentialAction" itemscope="" itemtype="http://schema.org/SearchAction"> <meta itemprop="target" content="https://www.google.com/search?q={q}"/> <input name="sitesearch" value="yegor256.com" type="hidden"/> <input itemprop="query-input" type="text" id="search-query" class="field field-text" required="required" onfocus="$('.google').css('visibility', 'visible');" name="q" placeholder="Search..." autocomplete="off"/> <input type="image" src="/images/google-search-icon.svg" class="google" title="Search via Google" alt="Search via Google"/> </form></div><div class="hot"><ul> <li> <a href="/code-ahead.html">Code Ahead</a> was published on Amazon just a few days ago! It is my new book, a novel about programmers. It explains in details the majority of ideas that stand behind <a href="https://www.zerocracy.com">Zerocracy</a> and <a href="https://www.xdsd.org">XDSD</a>. </li> <li> At <a href="/webinars.html">Webinar #37</a> we will discuss naming problem in OOP, for objects, methods and attributes; join us on <b>September 12</b>, at 11am PST. </li></ul></div></header></div><section itemscope="" itemtype="http://schema.org/BlogPosting"><div class="wrapper"> <header><p class="printable"> <img src="https://api.qrserver.com/v1/create-qr-code/?data=https://www.yegor256.com/2016/08/10/if-then-else-code-smell.html&amp;format=svg" style="width:125px;height:125px;" alt="QR code"/></p><p class="printable"> <code itemprop="url">https://www.yegor256.com/2016/08/10/if-then-else-code-smell.html</code></p><h1 itemprop="name headline mainEntityOfPage">If-Then-Else Is a Code Smell</h1><ul class="subline"> <li> <time itemprop="datePublished" datetime="2016-08-10T00:00:00+00:00"> 10 August 2016 </time> </li> <li class="desktop-only" itemprop="locationCreated">Tallinn, Estonia</li> <li class="printable" itemscope="" itemprop="author" itemtype="http://schema.org/Person"> <span itemprop="name">Yegor Bugayenko</span> </li> <li class="unprintable"> <i class="icon icon-comments"></i> <a href="http://www.yegor256.com/2016/08/10/if-then-else-code-smell.html#disqus_thread" itemprop="discussionUrl">comments</a> </li></ul><p class="unprintable"><p>In most cases (maybe even in all of them), if-then-else can and must be replaced by a decorator or simply another object. I&#39;ve been planning to write about this for almost a year but only today found a real case in my own code that perfectly illustrates the problem. So it&#39;s time to demonstrate it and explain.</p><figure class='jb_picture'><img itemprop='image' alt='Fargo (1996) by Coen Brothers' src='/images/2016/08/fargo.jpg' longdesc='#19d4ca55'/><figcaption id='19d4ca55'>Fargo (1996) by Coen Brothers</figcaption></figure><p>Take a look at the class <a href="https://github.com/yegor256/rultor/blob/1.61.9/src/main/java/com/rultor/dynamo/DyTalk.java"><code>DyTalk</code></a> from <a href="https://github.com/yegor256/rultor">yegor256/rultor</a> and its method <a href="https://github.com/yegor256/rultor/blob/1.61.9/src/main/java/com/rultor/dynamo/DyTalk.java#L127-L169"><code>modify()</code></a>. In a nutshell, it prevents you from saving any data to the DynamoDB if there were no modifications of the XML document. It&#39;s a valid case, and it has to be validated, but the way it&#39;s implemented is simply wrong. This is how it works (an oversimplified example):</p><figure class="highlight"><pre><code class="language-java" data-lang="java"><span></span><span class="kd">class</span> <span class="nc">DyTalk</span> <span class="kd">implements</span> <span class="n">Talk</span> <span class="o">{</span>
  <span class="kt">void</span> <span class="nf">modify</span><span class="o">(</span><span class="n">Collection</span><span class="o">&lt;</span><span class="n">Directive</span><span class="o">&gt;</span> <span class="n">dirs</span><span class="o">)</span> <span class="o">{</span>
    <span class="k">if</span> <span class="o">(!</span><span class="n">dirs</span><span class="o">.</span><span class="na">isEmpty</span><span class="o">())</span> <span class="o">{</span>
      <span class="c1">// Apply the modification</span>
      <span class="c1">// and save the new XML document</span>
      <span class="c1">// to the DynamoDB table.</span>
    <span class="o">}</span>
  <span class="o">}</span>
<span class="o">}</span></code></pre></figure><p>What&#39;s wrong, you wonder? This if-then-else forking functionality doesn&#39;t really belong to this object---that&#39;s what&#39;s wrong. Modifying the XML document and saving it to the database is <em>its functionality</em>, while not saving anything if the modification instructions set is empty is not (it&#39;s very similar to <a href="/2016/01/26/defensive-programming.html">defensive programming</a>). Instead, there should be a decorator, which would look like this:</p><figure class="highlight"><pre><code class="language-java" data-lang="java"><span></span><span class="kd">class</span> <span class="nc">QuickTalk</span> <span class="kd">implements</span> <span class="n">Talk</span> <span class="o">{</span>
  <span class="kd">private</span> <span class="kd">final</span> <span class="n">Talk</span> <span class="n">origin</span><span class="o">;</span>
  <span class="kt">void</span> <span class="nf">modify</span><span class="o">(</span><span class="n">Collection</span><span class="o">&lt;</span><span class="n">Directive</span><span class="o">&gt;</span> <span class="n">dirs</span><span class="o">)</span> <span class="o">{</span>
    <span class="k">if</span> <span class="o">(!</span><span class="n">dirs</span><span class="o">.</span><span class="na">isEmpty</span><span class="o">())</span> <span class="o">{</span>
      <span class="k">this</span><span class="o">.</span><span class="na">origin</span><span class="o">.</span><span class="na">modify</span><span class="o">(</span><span class="n">dirs</span><span class="o">);</span>
    <span class="o">}</span>
  <span class="o">}</span>
<span class="o">}</span></code></pre></figure><p>Now, if and when we need our talk to be more clever in situations where the list of directives is empty, we decorate it with <code>QuickTalk</code>. The benefits are obvious: the <code>DyTalk</code> class is smaller and therefore more cohesive.</p><aside class='quote'>If it's possible to convert if-then-else forking to a decorator, it has to be done</aside><p>But the question is bigger than just that. Can we make a rule out of it? Can we say that <strong>each and every forking</strong> is bad and should be moved out of a class? What about forking that happens inside a method and can&#39;t be converted to a decorator?</p><p>I&#39;m suggesting this simple rule: If it&#39;s possible to convert if-then-else forking to a decorator, it has to be done. If it&#39;s not done, it&#39;s a code smell. Make sense?</p></p><nav class="buttons notranslate desktop-only"> <a href="http://www.facebook.com/sharer/sharer.php?u=https://www.yegor256.com/2016/08/10/if-then-else-code-smell.html" title="Share on Facebook" class="button" rel="nofollow"> <span class="count count-facebook">0</span> <i class="icon icon-facebook notranslate" aria-hidden="true"></i> </a> <a href="https://twitter.com/share?url=https://www.yegor256.com/2016/08/10/if-then-else-code-smell.html&amp;text=If-Then-Else+Is+a+Code+Smell" title="Share on Twitter" class="button" rel="nofollow"> <span class="count count-twitter">0</span> <i class="icon icon-twitter notranslate" aria-hidden="true"></i> </a> <a href="https://plus.google.com/share?url=https://www.yegor256.com/2016/08/10/if-then-else-code-smell.html" title="Share on Google+" class="button" rel="nofollow"> <span class="count count-googleplus">0</span> <i class="icon icon-googleplus notranslate" aria-hidden="true"></i> </a> <a href="https://www.linkedin.com/cws/share?url=https://www.yegor256.com/2016/08/10/if-then-else-code-smell.html" title="Share on LinkedIn" class="button" rel="nofollow"> <span class="count count-linkedin">0</span> <i class="icon icon-linkedin notranslate" aria-hidden="true"></i> </a> <a href="http://reddit.com/submit?url=https://www.yegor256.com/2016/08/10/if-then-else-code-smell.html%3F2016-32&amp;title=If-Then-Else+Is+a+Code+Smell" title="Share on Reddit" class="button" rel="nofollow"> <span class="count count-reddit">0</span> <i class="icon icon-reddit notranslate" aria-hidden="true"></i> </a> <a href="http://news.ycombinator.com/submitlink?u=https://www.yegor256.com/2016/08/10/if-then-else-code-smell.html%3F2016-32&amp;t=If-Then-Else+Is+a+Code+Smell" title="Share on Hacker News" class="button" rel="nofollow"> <span class="count count-hackernews">0</span> <i class="icon icon-hackernews notranslate" aria-hidden="true"></i> </a> </nav> </header> <article class="main" itemprop="articleBody"><div ><p>In most cases (maybe even in all of them), if-then-else can and must be replaced by a decorator or simply another object. I&#39;ve been planning to write about this for almost a year but only today found a real case in my own code that perfectly illustrates the problem. So it&#39;s time to demonstrate it and explain.</p><figure class='jb_picture'><img itemprop='image' alt='Fargo (1996) by Coen Brothers' src='/images/2016/08/fargo.jpg' longdesc='#19d4ca55'/><figcaption id='19d4ca55'>Fargo (1996) by Coen Brothers</figcaption></figure><p>Take a look at the class <a href="https://github.com/yegor256/rultor/blob/1.61.9/src/main/java/com/rultor/dynamo/DyTalk.java"><code>DyTalk</code></a> from <a href="https://github.com/yegor256/rultor">yegor256/rultor</a> and its method <a href="https://github.com/yegor256/rultor/blob/1.61.9/src/main/java/com/rultor/dynamo/DyTalk.java#L127-L169"><code>modify()</code></a>. In a nutshell, it prevents you from saving any data to the DynamoDB if there were no modifications of the XML document. It&#39;s a valid case, and it has to be validated, but the way it&#39;s implemented is simply wrong. This is how it works (an oversimplified example):</p><figure class="highlight"><pre><code class="language-java" data-lang="java"><span></span><span class="kd">class</span> <span class="nc">DyTalk</span> <span class="kd">implements</span> <span class="n">Talk</span> <span class="o">{</span>
  <span class="kt">void</span> <span class="nf">modify</span><span class="o">(</span><span class="n">Collection</span><span class="o">&lt;</span><span class="n">Directive</span><span class="o">&gt;</span> <span class="n">dirs</span><span class="o">)</span> <span class="o">{</span>
    <span class="k">if</span> <span class="o">(!</span><span class="n">dirs</span><span class="o">.</span><span class="na">isEmpty</span><span class="o">())</span> <span class="o">{</span>
      <span class="c1">// Apply the modification</span>
      <span class="c1">// and save the new XML document</span>
      <span class="c1">// to the DynamoDB table.</span>
    <span class="o">}</span>
  <span class="o">}</span>
<span class="o">}</span></code></pre></figure><p>What&#39;s wrong, you wonder? This if-then-else forking functionality doesn&#39;t really belong to this object---that&#39;s what&#39;s wrong. Modifying the XML document and saving it to the database is <em>its functionality</em>, while not saving anything if the modification instructions set is empty is not (it&#39;s very similar to <a href="/2016/01/26/defensive-programming.html">defensive programming</a>). Instead, there should be a decorator, which would look like this:</p><figure class="highlight"><pre><code class="language-java" data-lang="java"><span></span><span class="kd">class</span> <span class="nc">QuickTalk</span> <span class="kd">implements</span> <span class="n">Talk</span> <span class="o">{</span>
  <span class="kd">private</span> <span class="kd">final</span> <span class="n">Talk</span> <span class="n">origin</span><span class="o">;</span>
  <span class="kt">void</span> <span class="nf">modify</span><span class="o">(</span><span class="n">Collection</span><span class="o">&lt;</span><span class="n">Directive</span><span class="o">&gt;</span> <span class="n">dirs</span><span class="o">)</span> <span class="o">{</span>
    <span class="k">if</span> <span class="o">(!</span><span class="n">dirs</span><span class="o">.</span><span class="na">isEmpty</span><span class="o">())</span> <span class="o">{</span>
      <span class="k">this</span><span class="o">.</span><span class="na">origin</span><span class="o">.</span><span class="na">modify</span><span class="o">(</span><span class="n">dirs</span><span class="o">);</span>
    <span class="o">}</span>
  <span class="o">}</span>
<span class="o">}</span></code></pre></figure><p>Now, if and when we need our talk to be more clever in situations where the list of directives is empty, we decorate it with <code>QuickTalk</code>. The benefits are obvious: the <code>DyTalk</code> class is smaller and therefore more cohesive.</p><aside class='quote'>If it's possible to convert if-then-else forking to a decorator, it has to be done</aside><p>But the question is bigger than just that. Can we make a rule out of it? Can we say that <strong>each and every forking</strong> is bad and should be moved out of a class? What about forking that happens inside a method and can&#39;t be converted to a decorator?</p><p>I&#39;m suggesting this simple rule: If it&#39;s possible to convert if-then-else forking to a decorator, it has to be done. If it&#39;s not done, it&#39;s a code smell. Make sense?</p></div></article></div><div class="wrapper"> <related-posts /></div><div class="disqus" role="complementary"><p class="disqus_hint"> Please, use <a href="https://help.disqus.com/commenting/what-html-tags-are-allowed-within-comments">syntax highlighting</a> in your comments, to make them more readable.</p><div id="disqus_thread" class="disqus-thread"> <a>&nbsp;</a></div><script> var disqus_config = function () { this.page.url = document.location.href.split('?')[0].split('#')[0].replace('https://', 'http://'); this.page.identifier = this.page.url; }; (function() { var d = document, s = d.createElement('script'); s.src = '//yegor256.disqus.com/embed.js'; s.setAttribute('data-timestamp', +new Date()); (d.head || d.body).appendChild(s); })(); </script> <noscript><div><p class="red"> JavaScript is disabled in your browser, that's why you can't see comments under this post.</p></div></noscript></div><div class="wrapper"> <footer class="footer"><p> &copy; <span itemscope="" itemprop="copyrightHolder" itemtype="http://schema.org/Person"> <span itemprop="name">Yegor Bugayenko</span> </span> 2014&ndash;<span itemprop="copyrightYear">2018</span></p></footer></div></section><div class="wrapper unprintable" style="text-align:center;margin-top:2em;"> <a href="http://www.sixnines.io/h/3ba1652f"> <img src="//www.sixnines.io/b/3ba1652f?style=flat" alt="sixnines availability badge"/> </a></div><script src="//code.jquery.com/jquery-1.9.0.min.js"></script> <script src="/js/all.js?a0e0d018c07"></script> <script>var disqus_shortname = 'yegor256';</script> <script id="dsq-count-scr" src="//yegor256.disqus.com/count.js" async="async"></script> <script> (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){ (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o), m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m) })(window,document,'script','//www.google-analytics.com/analytics.js','ga'); ga('create', 'UA-1963507-32', 'auto'); ga('send', 'pageview'); </script> <script> Cd=document;Cr="&"+Math.random();Cp="&s=1"; Cd.cookie="b=b";if(Cd.cookie)Cp+="&c=1"; Cp+="&t="+(new Date()).getTimezoneOffset(); if(self!=top)Cp+="&f=1"; </script> <script> if(navigator.javaEnabled())Cp+="&j=1"; </script> <script> if(typeof(screen)!='undefined')Cp+="&w="+screen.width+"&h="+ screen.height+"&d="+(screen.colorDepth?screen.colorDepth:screen.pixelDepth); </script> <script> Cd.write("<img src='//c.hit.ua/hit?i=95870&g=0&x=2"+Cp+Cr+ "&r="+escape(Cd.referrer)+"&u="+escape(window.location.href)+ "' border='0' wi"+"dth='1' he"+"ight='1'/>"); </script> <script type="application/ld+json"> { "@context": "http://schema.org", "@type": "Person", "name": "Yegor Bugayenko", "url": "http://www.yegor256.com", "sameAs": [ "https://www.facebook.com/yegor256", "https://instagram.com/yegor256", "https://www.linkedin.com/in/yegor256", "https://twitter.com/yegor256", "https://github.com/yegor256", "https://www.pinterest.com/yegor256/" ] } </script> </body> </html> <!DOCTYPE html> <html xmlns="http://www.w3.org/1999/xhtml" lang="en-US" xml:lang="en-US" itemscope="" itemtype="http://schema.org/WebSite"> <head> <meta charset="utf-8"/> <meta name="description" content="ActiveRecord is a popular design pattern that seemed to be better than ORM, though from an object thinking standpoint it is even worse. " /> <meta name="keywords" content="ActiveRecord, ActiveRecord ORM, ActiveRecord anti-pattern, ActiveRecord design pattern, ActiveRecord java" /> <meta name="viewport" content="width=device-width,minimum-scale=1,initial-scale=1"/> <meta name="google-site-verification" content="JEj_gQr2CPe2QKGw8XdMz0R7VboQIUbX3FlM-lwTq-8" /> <meta name="author" content="Yegor Bugayenko"> <meta name="article:published_time" content="2016-07-26 00:00:00 +0000"> <meta name="og:site_name" content="Yegor Bugayenko"/> <meta name="og:type" content="article" /> <meta name="og:locale" content="en_US" /> <meta name="twitter:account_id" content="4503599630178231" /> <meta name="twitter:creator" content="@yegor256"/> <meta name="twitter:site" content="@yegor256"/> <meta name="twitter:title" property="og:title" content="ActiveRecord Is Even Worse Than ORM"/> <meta name="twitter:description" property="og:description" content="ActiveRecord is a popular design pattern that seemed to be better than ORM, though from an object thinking standpoint it is even worse. "/> <meta name="twitter:url" property="og:url" content="https://www.yegor256.com/2016/07/26/active-record.html"/> <meta name="telegram:channel" content="AAAAAEJFMRzsRTRxM3ec6A"/> <link rel="search" type="application/opensearchdescription+xml" href="/opensearch.xml" title="yegor256" /> <link rel="shortcut icon" href="/favicon.ico?a0e0d018c07"/> <link rel="apple-touch-icon" href="/favicon.ico?a0e0d018c07"/> <link rel="alternate" type="application/rss+xml" title="RSS for yegor256.com" href="https://www.yegor256.com/rss.xml"/> <link rel="stylesheet" href="/css/layout.css?a0e0d018c07"/> <link rel="stylesheet" href="/css/icons.css?a0e0d018c07"/> <link rel="canonical" href="https://www.yegor256.com/2016/07/26/active-record.html" /> <link rel="amphtml" href="https://www.yegor256.com/2016/07/26/active-record.amp.html" /> <title>ActiveRecord Is Even Worse Than ORM </title> <meta name='og:image' content='https://www.yegor256.com/images/2016/07/en-duva-satt-pa-engren.jpg'/><meta name='twitter:image' content='https://www.yegor256.com/images/2016/07/en-duva-satt-pa-engren.jpg'/><meta name='og:image:width' content='1200'/> <meta name='twitter:image:width' content='1200'/><meta name='og:image:height' content='670'/> <meta name='twitter:image:height' content='670'/><meta name='twitter:card' content='summary_large_image'/><meta name='twitter:image:alt' content='En duva satt på en gren och funderade på tillvaron (2014) by Roy Andersson'/> </head> <body><div class="wrapper"> <aside class="header-toggle unprintable" id="header-toggle" title="Show the menu" onclick="$('#header').show();$('#header-toggle').hide();">&#9776;</aside> <header class="header" id="header"><div class="face"> <a href="/about-me.html#form" class="sub" title="Click to subscribe to my monthly newsletter"><span>Subscribe</span></a> <a href="/about-me.html" style="position:relative;"> <img src="/images/face-256x256.jpg" class="photo" alt="Yegor Bugayenko"/> </a></div><nav><ul class="menu social notranslate"> <li><a href="https://twitter.com/intent/follow?screen_name=yegor256" rel="nofollow" title="Follow me on Twitter"><i class="icon icon-twitter notranslate" aria-hidden="true"></i></a></li> <li><a href="/rss.xml" rel="nofollow" title="Subscribe to my RSS feed"><i class="icon icon-rss notranslate" aria-hidden="true"></i></a></li> <li><a itemprop="sameAs" href="https://github.com/yegor256" rel="nofollow" title="My GitHub profile"><i class="icon icon-github notranslate" aria-hidden="true"></i></a></li> <li><a itemprop="sameAs" href="http://stackoverflow.com/users/187141/yegor256" rel="nofollow" title="My StackOverflow profile"><i class="icon icon-stackoverflow notranslate" aria-hidden="true"></i></a></li> <li><a itemprop="sameAs" href="https://www.facebook.com/yegor256" rel="nofollow" title="Follow me on Facebook"><i class="icon icon-facebook notranslate" aria-hidden="true"></i></a></li> <li><a itemprop="sameAs" href="https://instagram.com/yegor256" rel="nofollow" title="Follow me on Instagram"><i class="icon icon-instagram notranslate" aria-hidden="true"></i></a></li> <li><a itemprop="sameAs" href="https://www.linkedin.com/in/yegor256" rel="nofollow" title="My LinkedIn profile"><i class="icon icon-linkedin notranslate" aria-hidden="true"></i></a></li> <li><a itemprop="sameAs" href="https://www.youtube.com/c/yegor256?sub_confirmation=1" rel="nofollow" title="My Youtube video channel"><i class="icon icon-youtube notranslate" aria-hidden="true"></i></a></li> <li><a itemprop="sameAs" href="https://www.pinterest.com/yegor256/" rel="nofollow" title="My Pinterest boards"><i class="icon icon-pinterest notranslate" aria-hidden="true"></i></a></li> <li><a itemprop="sameAs" href="https://angel.co/yegor256" rel="nofollow" title="My AngelList profile"><i class="icon icon-angellist notranslate" aria-hidden="true"></i></a></li> <li><a href="https://soundcloud.com/yegor256" rel="nofollow" title="My podcast"><i class="icon icon-podcast notranslate" aria-hidden="true"></i></a></li> <li><a href="https://itunes.apple.com/us/podcast/yegor256-podcast/id1150826721" rel="nofollow" title="My iTunes podcast"><i class="icon icon-itunes notranslate" aria-hidden="true"></i></a></li> <li><a href="https://t.me/joinchat/AAAAAEJFMRzsRTRxM3ec6A" rel="nofollow" title="My Telegram public channel"><i class="icon icon-telegram notranslate" aria-hidden="true"></i></a></li> <li><a href="mailto:blog@yegor256.com" rel="nofollow" title="Email me any time"><i class="icon icon-mail notranslate" aria-hidden="true"></i></a></li></ul><ul class="menu"> <li><a href="/" title="Home page">Home</a></li> <li ><a href="/best.html" title="Best articles to read">12&#160;Best</a></li> <li ><a href="/contents.html" title="The contents of the entire blog">All&#160;288</a></li> <li ><a href="/webinars.html" title="My webinars">Webinars</a></li> <li ><a href="/talks.html" title="Future and past conference talks">Talks</a></li> <li ><a href="/books.html" title="The books I wrote">Books</a></li> <li ><a href="/papers.html" title="My academic papers and patents">Papers</a></li> <li ><a href="/pets.html" title="My loved pet projects">Pets</a></li> <li ><a href="/award.html" title="Software quality award">Award</a></li> <li ><a href="/testimonials.html" title="What some people say about me">Testimonials</a></li> <li ><a href="/shift-m.html" title="Audio podcast about project management">Shift-M</a></li> <li ><a href="/paintings.html" title="My paintings for sale">Paintings</a></li> <li><a href="http://ru.yegor256.com/" title="Немного на русском языке">По-русски</a></li></ul></nav><div class="search"> <form method="get" action="https://www.google.com/search" itemprop="potentialAction" itemscope="" itemtype="http://schema.org/SearchAction"> <meta itemprop="target" content="https://www.google.com/search?q={q}"/> <input name="sitesearch" value="yegor256.com" type="hidden"/> <input itemprop="query-input" type="text" id="search-query" class="field field-text" required="required" onfocus="$('.google').css('visibility', 'visible');" name="q" placeholder="Search..." autocomplete="off"/> <input type="image" src="/images/google-search-icon.svg" class="google" title="Search via Google" alt="Search via Google"/> </form></div><div class="hot"><ul> <li> <a href="/code-ahead.html">Code Ahead</a> was published on Amazon just a few days ago! It is my new book, a novel about programmers. It explains in details the majority of ideas that stand behind <a href="https://www.zerocracy.com">Zerocracy</a> and <a href="https://www.xdsd.org">XDSD</a>. </li> <li> At <a href="/webinars.html">Webinar #37</a> we will discuss naming problem in OOP, for objects, methods and attributes; join us on <b>September 12</b>, at 11am PST. </li></ul></div></header></div><section itemscope="" itemtype="http://schema.org/BlogPosting"><div class="wrapper"> <header><p class="printable"> <img src="https://api.qrserver.com/v1/create-qr-code/?data=https://www.yegor256.com/2016/07/26/active-record.html&amp;format=svg" style="width:125px;height:125px;" alt="QR code"/></p><p class="printable"> <code itemprop="url">https://www.yegor256.com/2016/07/26/active-record.html</code></p><h1 itemprop="name headline mainEntityOfPage">ActiveRecord Is Even Worse Than ORM</h1><aside class='book'><a href='http://amzn.to/2pyceWc'><img src='/images/books/elegant-objects/cover.png' class='book-cover' alt='book cover'/></a>Read more about this subject in <a href='http://amzn.to/2pyceWc'>Section&nbsp;6.5</a><br/> of my book<a href='http://amzn.to/2pyceWc'><img src='/images/books/amazon-buy-button.png' class='amazon-button' alt='Click to buy'/></a></aside><ul class="subline"> <li> <time itemprop="datePublished" datetime="2016-07-26T00:00:00+00:00"> 26 July 2016 </time> </li> <li class="desktop-only" itemprop="locationCreated">Palo Alto, CA</li> <li class="printable" itemscope="" itemprop="author" itemtype="http://schema.org/Person"> <span itemprop="name">Yegor Bugayenko</span> </li> <li class="unprintable"> <i class="icon icon-comments"></i> <a href="http://www.yegor256.com/2016/07/26/active-record.html#disqus_thread" itemprop="discussionUrl">comments</a> </li></ul><ul class="subline"> <li>Discussed at:</li> <li><a href="https://dzone.com/articles/activerecord-is-even-worse-than-orm">dzone</a></li></ul><p class="unprintable"><p>You probably remember what <a href="/2014/12/01/orm-offensive-anti-pattern.html">I think</a> about ORM, a very popular design pattern. In a nutshell, it encourages us to turn objects into <a href="/2016/07/06/data-transfer-object.html">DTOs</a>, which are anemic, passive, and not objects at all. The consequences are usually dramatic---the entire programming paradigm shifts from object-oriented to procedural. I&#39;ve tried to explain this at a <a href="https://www.youtube.com/watch?v=aER4uwyFbqQ">JPoint</a> and <a href="https://www.youtube.com/watch?v=63tS3HNmhiE">JEEConf</a> this year. After each talk, a few people told me that what I&#39;m suggesting is called <a href="https://en.wikipedia.org/wiki/Active_record_pattern">ActiveRecord</a> or <a href="https://msdn.microsoft.com/en-us/library/ff649690.aspx">Repository</a> patterns.</p><figure class='jb_picture'><img itemprop='image' alt='En duva satt på en gren och funderade på tillvaron (2014) by Roy Andersson' src='/images/2016/07/en-duva-satt-pa-engren.jpg' longdesc='#36f12aea'/><figcaption id='36f12aea'>En duva satt på en gren och funderade på tillvaron (2014) by Roy Andersson</figcaption></figure><p>Moreover, they claimed that ActiveRecord actually solves the problem I&#39;ve found in ORM. They said I should explain in my talks that what I&#39;m offering (SQL-speaking objects) already exists and has a name: ActiveRecord.</p><p>I disagree. Moreover, I think that ActiveRecord is even worse than ORM.</p><aside class='quote'>What's even worse in ActiveRecord is that it hides the fact that objects are data containers.</aside><p>ORM consists of two parts: the session and <a href="/2016/07/06/data-transfer-object.html">DTOs</a>, also known as &quot;entities.&quot; The entities have no functionality; they are just primitive containers for the data transferred from and to the session. And that is what the problem is---objects don&#39;t encapsulate but rather expose data. To understand why this is wrong and why it&#39;s against the object paradigm, you can read <a href="/2014/09/16/getters-and-setters-are-evil.html">here</a>, <a href="/2016/04/05/printers-instead-of-getters.html">here</a>, <a href="/2014/12/01/orm-offensive-anti-pattern.html">here</a>, <a href="/2014/11/20/seven-virtues-of-good-object.html">here</a>, and <a href="/2016/07/06/data-transfer-object.html">here</a>. Now, let&#39;s just agree that it&#39;s very wrong and move on.</p><p>What solution is ActiveRecord proposing? How is it solving the problem? It moves the engine into the <em>parent class</em>, which all our entities inherit from. This is how we were supposed to save our entity to the database in the ORM scenario (pseudo-code):</p><figure class="highlight"><pre><code class="language-java" data-lang="java"><span></span><span class="n">book</span><span class="o">.</span><span class="na">setTitle</span><span class="o">(</span><span class="s">&quot;Java in a Nutshell&quot;</span><span class="o">);</span>
<span class="n">session</span><span class="o">.</span><span class="na">update</span><span class="o">(</span><span class="n">book</span><span class="o">);</span></code></pre></figure><p>And this is what we do with an ActiveRecord:</p><figure class="highlight"><pre><code class="language-java" data-lang="java"><span></span><span class="n">book</span><span class="o">.</span><span class="na">setTitle</span><span class="o">(</span><span class="s">&quot;Java in a Nutshell&quot;</span><span class="o">);</span>
<span class="n">book</span><span class="o">.</span><span class="na">update</span><span class="o">();</span></code></pre></figure><p>The method <code>update()</code> is defined in book&#39;s parent class and uses book as a <em>data container</em>. When called, it fetches data from the container (the book) and updates the database. How is it different than ORM? There is absolutely no difference. The book is still a container that knows nothing about SQL and any persistence mechanisms.</p><p>What&#39;s even worse in ActiveRecord, compared to ORM, is that it <em>hides</em> the fact that objects are data containers. A book, in the second snippet, <em>pretends</em> to be a <a href="/2014/11/20/seven-virtues-of-good-object.html">proper object</a>, while in reality it&#39;s just a dumb data bag.</p><p>I believe this is what misguided those who were saying that my SQL-speaking objects concept is exactly the same as the ActiveRecord design pattern (or Repository, which is almost exactly the same).</p><p>No, it&#39;s not.</p></p><nav class="buttons notranslate desktop-only"> <a href="http://www.facebook.com/sharer/sharer.php?u=https://www.yegor256.com/2016/07/26/active-record.html" title="Share on Facebook" class="button" rel="nofollow"> <span class="count count-facebook">0</span> <i class="icon icon-facebook notranslate" aria-hidden="true"></i> </a> <a href="https://twitter.com/share?url=https://www.yegor256.com/2016/07/26/active-record.html&amp;text=ActiveRecord+Is+Even+Worse+Than+ORM" title="Share on Twitter" class="button" rel="nofollow"> <span class="count count-twitter">0</span> <i class="icon icon-twitter notranslate" aria-hidden="true"></i> </a> <a href="https://plus.google.com/share?url=https://www.yegor256.com/2016/07/26/active-record.html" title="Share on Google+" class="button" rel="nofollow"> <span class="count count-googleplus">0</span> <i class="icon icon-googleplus notranslate" aria-hidden="true"></i> </a> <a href="https://www.linkedin.com/cws/share?url=https://www.yegor256.com/2016/07/26/active-record.html" title="Share on LinkedIn" class="button" rel="nofollow"> <span class="count count-linkedin">0</span> <i class="icon icon-linkedin notranslate" aria-hidden="true"></i> </a> <a href="http://reddit.com/submit?url=https://www.yegor256.com/2016/07/26/active-record.html%3F2016-30&amp;title=ActiveRecord+Is+Even+Worse+Than+ORM" title="Share on Reddit" class="button" rel="nofollow"> <span class="count count-reddit">0</span> <i class="icon icon-reddit notranslate" aria-hidden="true"></i> </a> <a href="http://news.ycombinator.com/submitlink?u=https://www.yegor256.com/2016/07/26/active-record.html%3F2016-30&amp;t=ActiveRecord+Is+Even+Worse+Than+ORM" title="Share on Hacker News" class="button" rel="nofollow"> <span class="count count-hackernews">0</span> <i class="icon icon-hackernews notranslate" aria-hidden="true"></i> </a> </nav> </header> <article class="main" itemprop="articleBody"><div ><p>You probably remember what <a href="/2014/12/01/orm-offensive-anti-pattern.html">I think</a> about ORM, a very popular design pattern. In a nutshell, it encourages us to turn objects into <a href="/2016/07/06/data-transfer-object.html">DTOs</a>, which are anemic, passive, and not objects at all. The consequences are usually dramatic---the entire programming paradigm shifts from object-oriented to procedural. I&#39;ve tried to explain this at a <a href="https://www.youtube.com/watch?v=aER4uwyFbqQ">JPoint</a> and <a href="https://www.youtube.com/watch?v=63tS3HNmhiE">JEEConf</a> this year. After each talk, a few people told me that what I&#39;m suggesting is called <a href="https://en.wikipedia.org/wiki/Active_record_pattern">ActiveRecord</a> or <a href="https://msdn.microsoft.com/en-us/library/ff649690.aspx">Repository</a> patterns.</p><figure class='jb_picture'><img itemprop='image' alt='En duva satt på en gren och funderade på tillvaron (2014) by Roy Andersson' src='/images/2016/07/en-duva-satt-pa-engren.jpg' longdesc='#36f12aea'/><figcaption id='36f12aea'>En duva satt på en gren och funderade på tillvaron (2014) by Roy Andersson</figcaption></figure><p>Moreover, they claimed that ActiveRecord actually solves the problem I&#39;ve found in ORM. They said I should explain in my talks that what I&#39;m offering (SQL-speaking objects) already exists and has a name: ActiveRecord.</p><p>I disagree. Moreover, I think that ActiveRecord is even worse than ORM.</p><aside class='quote'>What's even worse in ActiveRecord is that it hides the fact that objects are data containers.</aside><p>ORM consists of two parts: the session and <a href="/2016/07/06/data-transfer-object.html">DTOs</a>, also known as &quot;entities.&quot; The entities have no functionality; they are just primitive containers for the data transferred from and to the session. And that is what the problem is---objects don&#39;t encapsulate but rather expose data. To understand why this is wrong and why it&#39;s against the object paradigm, you can read <a href="/2014/09/16/getters-and-setters-are-evil.html">here</a>, <a href="/2016/04/05/printers-instead-of-getters.html">here</a>, <a href="/2014/12/01/orm-offensive-anti-pattern.html">here</a>, <a href="/2014/11/20/seven-virtues-of-good-object.html">here</a>, and <a href="/2016/07/06/data-transfer-object.html">here</a>. Now, let&#39;s just agree that it&#39;s very wrong and move on.</p><p>What solution is ActiveRecord proposing? How is it solving the problem? It moves the engine into the <em>parent class</em>, which all our entities inherit from. This is how we were supposed to save our entity to the database in the ORM scenario (pseudo-code):</p><figure class="highlight"><pre><code class="language-java" data-lang="java"><span></span><span class="n">book</span><span class="o">.</span><span class="na">setTitle</span><span class="o">(</span><span class="s">&quot;Java in a Nutshell&quot;</span><span class="o">);</span>
<span class="n">session</span><span class="o">.</span><span class="na">update</span><span class="o">(</span><span class="n">book</span><span class="o">);</span></code></pre></figure><p>And this is what we do with an ActiveRecord:</p><figure class="highlight"><pre><code class="language-java" data-lang="java"><span></span><span class="n">book</span><span class="o">.</span><span class="na">setTitle</span><span class="o">(</span><span class="s">&quot;Java in a Nutshell&quot;</span><span class="o">);</span>
<span class="n">book</span><span class="o">.</span><span class="na">update</span><span class="o">();</span></code></pre></figure><p>The method <code>update()</code> is defined in book&#39;s parent class and uses book as a <em>data container</em>. When called, it fetches data from the container (the book) and updates the database. How is it different than ORM? There is absolutely no difference. The book is still a container that knows nothing about SQL and any persistence mechanisms.</p><p>What&#39;s even worse in ActiveRecord, compared to ORM, is that it <em>hides</em> the fact that objects are data containers. A book, in the second snippet, <em>pretends</em> to be a <a href="/2014/11/20/seven-virtues-of-good-object.html">proper object</a>, while in reality it&#39;s just a dumb data bag.</p><p>I believe this is what misguided those who were saying that my SQL-speaking objects concept is exactly the same as the ActiveRecord design pattern (or Repository, which is almost exactly the same).</p><p>No, it&#39;s not.</p></div></article></div><div class="wrapper"> <related-posts /></div><div class="disqus" role="complementary"><p class="disqus_hint"> Please, use <a href="https://help.disqus.com/commenting/what-html-tags-are-allowed-within-comments">syntax highlighting</a> in your comments, to make them more readable.</p><div id="disqus_thread" class="disqus-thread"> <a>&nbsp;</a></div><script> var disqus_config = function () { this.page.url = document.location.href.split('?')[0].split('#')[0].replace('https://', 'http://'); this.page.identifier = this.page.url; }; (function() { var d = document, s = d.createElement('script'); s.src = '//yegor256.disqus.com/embed.js'; s.setAttribute('data-timestamp', +new Date()); (d.head || d.body).appendChild(s); })(); </script> <noscript><div><p class="red"> JavaScript is disabled in your browser, that's why you can't see comments under this post.</p></div></noscript></div><div class="wrapper"> <footer class="footer"><p> &copy; <span itemscope="" itemprop="copyrightHolder" itemtype="http://schema.org/Person"> <span itemprop="name">Yegor Bugayenko</span> </span> 2014&ndash;<span itemprop="copyrightYear">2018</span></p></footer></div></section><div class="wrapper unprintable" style="text-align:center;margin-top:2em;"> <a href="http://www.sixnines.io/h/3ba1652f"> <img src="//www.sixnines.io/b/3ba1652f?style=flat" alt="sixnines availability badge"/> </a></div><script src="//code.jquery.com/jquery-1.9.0.min.js"></script> <script src="/js/all.js?a0e0d018c07"></script> <script>var disqus_shortname = 'yegor256';</script> <script id="dsq-count-scr" src="//yegor256.disqus.com/count.js" async="async"></script> <script> (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){ (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o), m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m) })(window,document,'script','//www.google-analytics.com/analytics.js','ga'); ga('create', 'UA-1963507-32', 'auto'); ga('send', 'pageview'); </script> <script> Cd=document;Cr="&"+Math.random();Cp="&s=1"; Cd.cookie="b=b";if(Cd.cookie)Cp+="&c=1"; Cp+="&t="+(new Date()).getTimezoneOffset(); if(self!=top)Cp+="&f=1"; </script> <script> if(navigator.javaEnabled())Cp+="&j=1"; </script> <script> if(typeof(screen)!='undefined')Cp+="&w="+screen.width+"&h="+ screen.height+"&d="+(screen.colorDepth?screen.colorDepth:screen.pixelDepth); </script> <script> Cd.write("<img src='//c.hit.ua/hit?i=95870&g=0&x=2"+Cp+Cr+ "&r="+escape(Cd.referrer)+"&u="+escape(window.location.href)+ "' border='0' wi"+"dth='1' he"+"ight='1'/>"); </script> <script type="application/ld+json"> { "@context": "http://schema.org", "@type": "Person", "name": "Yegor Bugayenko", "url": "http://www.yegor256.com", "sameAs": [ "https://www.facebook.com/yegor256", "https://instagram.com/yegor256", "https://www.linkedin.com/in/yegor256", "https://twitter.com/yegor256", "https://github.com/yegor256", "https://www.pinterest.com/yegor256/" ] } </script> </body> </html> <!DOCTYPE html> <html xmlns="http://www.w3.org/1999/xhtml" lang="en-US" xml:lang="en-US" itemscope="" itemtype="http://schema.org/WebSite"> <head> <meta charset="utf-8"/> <meta name="description" content="The well-known Law of Demeter is seriously misunderstood by object-oriented programmers---it isn&apos;t equal to the law of one dot. " /> <meta name="keywords" content="law of demeter, law of demeter c#, law of demeter example, law of demeter java, law of demeter violation" /> <meta name="viewport" content="width=device-width,minimum-scale=1,initial-scale=1"/> <meta name="google-site-verification" content="JEj_gQr2CPe2QKGw8XdMz0R7VboQIUbX3FlM-lwTq-8" /> <meta name="author" content="Yegor Bugayenko"> <meta name="article:published_time" content="2016-07-18 00:00:00 +0000"> <meta name="og:site_name" content="Yegor Bugayenko"/> <meta name="og:type" content="article" /> <meta name="og:locale" content="en_US" /> <meta name="twitter:account_id" content="4503599630178231" /> <meta name="twitter:creator" content="@yegor256"/> <meta name="twitter:site" content="@yegor256"/> <meta name="twitter:title" property="og:title" content="The Law of Demeter Doesn't Mean One Dot"/> <meta name="twitter:description" property="og:description" content="The well-known Law of Demeter is seriously misunderstood by object-oriented programmers---it isn&apos;t equal to the law of one dot. "/> <meta name="twitter:url" property="og:url" content="https://www.yegor256.com/2016/07/18/law-of-demeter.html"/> <meta name="telegram:channel" content="AAAAAEJFMRzsRTRxM3ec6A"/> <link rel="search" type="application/opensearchdescription+xml" href="/opensearch.xml" title="yegor256" /> <link rel="shortcut icon" href="/favicon.ico?a0e0d018c07"/> <link rel="apple-touch-icon" href="/favicon.ico?a0e0d018c07"/> <link rel="alternate" type="application/rss+xml" title="RSS for yegor256.com" href="https://www.yegor256.com/rss.xml"/> <link rel="stylesheet" href="/css/layout.css?a0e0d018c07"/> <link rel="stylesheet" href="/css/icons.css?a0e0d018c07"/> <link rel="canonical" href="https://www.yegor256.com/2016/07/18/law-of-demeter.html" /> <link rel="amphtml" href="https://www.yegor256.com/2016/07/18/law-of-demeter.amp.html" /> <title>The Law of Demeter Doesn't Mean One Dot </title> <meta name='og:image' content='https://www.yegor256.com/images/2016/07/spartacus.jpg'/><meta name='twitter:image' content='https://www.yegor256.com/images/2016/07/spartacus.jpg'/><meta name='og:image:width' content='1200'/> <meta name='twitter:image:width' content='1200'/><meta name='og:image:height' content='537'/> <meta name='twitter:image:height' content='537'/><meta name='twitter:card' content='summary_large_image'/><meta name='twitter:image:alt' content='Spartacus (1960) by Stanley Kubrick'/> </head> <body><div class="wrapper"> <aside class="header-toggle unprintable" id="header-toggle" title="Show the menu" onclick="$('#header').show();$('#header-toggle').hide();">&#9776;</aside> <header class="header" id="header"><div class="face"> <a href="/about-me.html#form" class="sub" title="Click to subscribe to my monthly newsletter"><span>Subscribe</span></a> <a href="/about-me.html" style="position:relative;"> <img src="/images/face-256x256.jpg" class="photo" alt="Yegor Bugayenko"/> </a></div><nav><ul class="menu social notranslate"> <li><a href="https://twitter.com/intent/follow?screen_name=yegor256" rel="nofollow" title="Follow me on Twitter"><i class="icon icon-twitter notranslate" aria-hidden="true"></i></a></li> <li><a href="/rss.xml" rel="nofollow" title="Subscribe to my RSS feed"><i class="icon icon-rss notranslate" aria-hidden="true"></i></a></li> <li><a itemprop="sameAs" href="https://github.com/yegor256" rel="nofollow" title="My GitHub profile"><i class="icon icon-github notranslate" aria-hidden="true"></i></a></li> <li><a itemprop="sameAs" href="http://stackoverflow.com/users/187141/yegor256" rel="nofollow" title="My StackOverflow profile"><i class="icon icon-stackoverflow notranslate" aria-hidden="true"></i></a></li> <li><a itemprop="sameAs" href="https://www.facebook.com/yegor256" rel="nofollow" title="Follow me on Facebook"><i class="icon icon-facebook notranslate" aria-hidden="true"></i></a></li> <li><a itemprop="sameAs" href="https://instagram.com/yegor256" rel="nofollow" title="Follow me on Instagram"><i class="icon icon-instagram notranslate" aria-hidden="true"></i></a></li> <li><a itemprop="sameAs" href="https://www.linkedin.com/in/yegor256" rel="nofollow" title="My LinkedIn profile"><i class="icon icon-linkedin notranslate" aria-hidden="true"></i></a></li> <li><a itemprop="sameAs" href="https://www.youtube.com/c/yegor256?sub_confirmation=1" rel="nofollow" title="My Youtube video channel"><i class="icon icon-youtube notranslate" aria-hidden="true"></i></a></li> <li><a itemprop="sameAs" href="https://www.pinterest.com/yegor256/" rel="nofollow" title="My Pinterest boards"><i class="icon icon-pinterest notranslate" aria-hidden="true"></i></a></li> <li><a itemprop="sameAs" href="https://angel.co/yegor256" rel="nofollow" title="My AngelList profile"><i class="icon icon-angellist notranslate" aria-hidden="true"></i></a></li> <li><a href="https://soundcloud.com/yegor256" rel="nofollow" title="My podcast"><i class="icon icon-podcast notranslate" aria-hidden="true"></i></a></li> <li><a href="https://itunes.apple.com/us/podcast/yegor256-podcast/id1150826721" rel="nofollow" title="My iTunes podcast"><i class="icon icon-itunes notranslate" aria-hidden="true"></i></a></li> <li><a href="https://t.me/joinchat/AAAAAEJFMRzsRTRxM3ec6A" rel="nofollow" title="My Telegram public channel"><i class="icon icon-telegram notranslate" aria-hidden="true"></i></a></li> <li><a href="mailto:blog@yegor256.com" rel="nofollow" title="Email me any time"><i class="icon icon-mail notranslate" aria-hidden="true"></i></a></li></ul><ul class="menu"> <li><a href="/" title="Home page">Home</a></li> <li ><a href="/best.html" title="Best articles to read">12&#160;Best</a></li> <li ><a href="/contents.html" title="The contents of the entire blog">All&#160;288</a></li> <li ><a href="/webinars.html" title="My webinars">Webinars</a></li> <li ><a href="/talks.html" title="Future and past conference talks">Talks</a></li> <li ><a href="/books.html" title="The books I wrote">Books</a></li> <li ><a href="/papers.html" title="My academic papers and patents">Papers</a></li> <li ><a href="/pets.html" title="My loved pet projects">Pets</a></li> <li ><a href="/award.html" title="Software quality award">Award</a></li> <li ><a href="/testimonials.html" title="What some people say about me">Testimonials</a></li> <li ><a href="/shift-m.html" title="Audio podcast about project management">Shift-M</a></li> <li ><a href="/paintings.html" title="My paintings for sale">Paintings</a></li> <li><a href="http://ru.yegor256.com/" title="Немного на русском языке">По-русски</a></li></ul></nav><div class="search"> <form method="get" action="https://www.google.com/search" itemprop="potentialAction" itemscope="" itemtype="http://schema.org/SearchAction"> <meta itemprop="target" content="https://www.google.com/search?q={q}"/> <input name="sitesearch" value="yegor256.com" type="hidden"/> <input itemprop="query-input" type="text" id="search-query" class="field field-text" required="required" onfocus="$('.google').css('visibility', 'visible');" name="q" placeholder="Search..." autocomplete="off"/> <input type="image" src="/images/google-search-icon.svg" class="google" title="Search via Google" alt="Search via Google"/> </form></div><div class="hot"><ul> <li> <a href="/code-ahead.html">Code Ahead</a> was published on Amazon just a few days ago! It is my new book, a novel about programmers. It explains in details the majority of ideas that stand behind <a href="https://www.zerocracy.com">Zerocracy</a> and <a href="https://www.xdsd.org">XDSD</a>. </li> <li> At <a href="/webinars.html">Webinar #37</a> we will discuss naming problem in OOP, for objects, methods and attributes; join us on <b>September 12</b>, at 11am PST. </li></ul></div></header></div><section itemscope="" itemtype="http://schema.org/BlogPosting"><div class="wrapper"> <header><p class="printable"> <img src="https://api.qrserver.com/v1/create-qr-code/?data=https://www.yegor256.com/2016/07/18/law-of-demeter.html&amp;format=svg" style="width:125px;height:125px;" alt="QR code"/></p><p class="printable"> <code itemprop="url">https://www.yegor256.com/2016/07/18/law-of-demeter.html</code></p><h1 itemprop="name headline mainEntityOfPage">The Law of Demeter Doesn't Mean One Dot</h1><aside class='book'><a href='http://amzn.to/2pyceWc'><img src='/images/books/elegant-objects/cover.png' class='book-cover' alt='book cover'/></a>Read more about this subject in <a href='http://amzn.to/2pyceWc'>Section&nbsp;5.9</a><br/> of my book<a href='http://amzn.to/2pyceWc'><img src='/images/books/amazon-buy-button.png' class='amazon-button' alt='Click to buy'/></a></aside><ul class="subline"> <li> <time itemprop="datePublished" datetime="2016-07-18T00:00:00+00:00"> 18 July 2016 </time> </li> <li class="desktop-only" itemprop="locationCreated">Palo Alto, CA</li> <li class="printable" itemscope="" itemprop="author" itemtype="http://schema.org/Person"> <span itemprop="name">Yegor Bugayenko</span> </li> <li class="unprintable"> <i class="icon icon-comments"></i> <a href="http://www.yegor256.com/2016/07/18/law-of-demeter.html#disqus_thread" itemprop="discussionUrl">comments</a> </li></ul><p class="unprintable"><p>You&#39;ve probably heard about that 30-year-old <a href="https://en.wikipedia.org/wiki/Law_of_Demeter">Law of Demeter</a> (LoD). Someone asked me recently what I think about it. And not just what I think, but how it is possible to keep objects small and obey the LoD. According to the law, we&#39;re not allowed to do something like <code>book.pages().last().text()</code>. Instead, we&#39;re supposed to go with <code>book.textOfLastPage()</code>. It puzzled me, because I strongly disagree. I believe the first construct is perfectly valid in OOP. So I&#39;ve done some research to find out whether this law is really a law. What I found out is that the law is perfect, but its common understanding in the OOP world is simply wrong (not surprisingly).</p><figure class='jb_picture'><img itemprop='image' alt='Spartacus (1960) by Stanley Kubrick' src='/images/2016/07/spartacus.jpg' longdesc='#88aa81d2'/><figcaption id='88aa81d2'>Spartacus (1960) by Stanley Kubrick</figcaption></figure><p><a href="http://www.ccs.neu.edu/research/demeter/papers/law-of-demeter/oopsla88-law-of-demeter.pdf">Object-Oriented Programming: An Objective Sense of Style</a>, K.Lieberherr, I.Holland, and A.Riel, OOPSLA&#39;88 Proceedings, 1988.</p><p>This is where it was introduced. Let&#39;s see what it literally says (look for Section 3 in that PDF document):</p><blockquote><p>For all classes C, and for all methods M attached to C, all objects to which M sends a message must be instances of classes associated with the following classes: 1) the argument classes of M (including C), 2) the instance variable classes of C.</p></blockquote><p>Say it&#39;s a Java class:</p><figure class="highlight"><pre><code class="language-java" data-lang="java"><span></span><span class="kd">class</span> <span class="nc">C</span> <span class="o">{</span>
  <span class="kd">private</span> <span class="n">B</span> <span class="n">b</span><span class="o">;</span>
  <span class="kt">void</span> <span class="nf">m</span><span class="o">(</span><span class="n">A</span> <span class="n">a</span><span class="o">)</span> <span class="o">{</span>
    <span class="n">b</span><span class="o">.</span><span class="na">hello</span><span class="o">();</span>
    <span class="n">a</span><span class="o">.</span><span class="na">hello</span><span class="o">();</span>
    <span class="n">Singleton</span><span class="o">.</span><span class="na">INSTANCE</span><span class="o">.</span><span class="na">hello</span><span class="o">();</span>
    <span class="k">new</span> <span class="n">Z</span><span class="o">().</span><span class="na">hello</span><span class="o">();</span>
  <span class="o">}</span>
<span class="o">}</span></code></pre></figure><p>All four calls to four different <code>hello()</code> methods are legal, according to the LoD. So what would be illegal, I ask myself? No surprise; the answer is this: <code>a.x.hello()</code>. That would be illegal. Directly accessing the attribute from another object and then talking to it is not allowed by the law.</p><p>But we don&#39;t do that anyway. We&#39;re talking about <code>book.pages().last().text()</code>. In this chain of method calls, we&#39;re not accessing any attributes. We&#39;re asking our objects to build new objects for us. What does the law say about that? Let me read it and quote:</p><blockquote><p>Objects created by M, or by functions or methods that M calls, are considered as arguments of M</p></blockquote><p>In other words, the object <code>Pages</code> that method call <code>book.pages()</code> returns is a perfectly valid object that can be used. Then, we can call method <code>last()</code> on it and get an object <code>Page</code>, and then call method <code>text()</code>, etc. This is a perfectly valid scenario that doesn&#39;t violate the law at all, just as I expected.</p><aside class='quote'>So the bottom line is that the Law of Demeter is not against method chaining at all</aside><p>So where does this common understanding of the law come from? Why does <a href="https://en.wikipedia.org/wiki/Law_of_Demeter">Wikipedia</a> call it a rule of &quot;one dot&quot; and say that &quot;an object should avoid invoking methods of a member object returned by another method?&quot; This is absolutely to the contrary of what the original paper says! What&#39;s going on?</p><p>The answer is simple: <a href="/2014/09/16/getters-and-setters-are-evil.html">getters</a>.</p><p>The majority of OOP developers think most object methods that return anything are getters. And getters, indeed, are no different than direct access to object attributes. That&#39;s why Wikipedia actually says &quot;no direct access to attributes and, since most of your methods are getters, don&#39;t touch them either, silly.&quot;</p><p>That&#39;s just sad to see.</p><p>So the bottom line is that the Law of Demeter is not against method chaining at all. Of course, it&#39;s against getters and direct attribute access. But who isn&#39;t, right?</p></p><nav class="buttons notranslate desktop-only"> <a href="http://www.facebook.com/sharer/sharer.php?u=https://www.yegor256.com/2016/07/18/law-of-demeter.html" title="Share on Facebook" class="button" rel="nofollow"> <span class="count count-facebook">0</span> <i class="icon icon-facebook notranslate" aria-hidden="true"></i> </a> <a href="https://twitter.com/share?url=https://www.yegor256.com/2016/07/18/law-of-demeter.html&amp;text=The+Law+of+Demeter+Doesn%27t+Mean+One+Dot" title="Share on Twitter" class="button" rel="nofollow"> <span class="count count-twitter">0</span> <i class="icon icon-twitter notranslate" aria-hidden="true"></i> </a> <a href="https://plus.google.com/share?url=https://www.yegor256.com/2016/07/18/law-of-demeter.html" title="Share on Google+" class="button" rel="nofollow"> <span class="count count-googleplus">0</span> <i class="icon icon-googleplus notranslate" aria-hidden="true"></i> </a> <a href="https://www.linkedin.com/cws/share?url=https://www.yegor256.com/2016/07/18/law-of-demeter.html" title="Share on LinkedIn" class="button" rel="nofollow"> <span class="count count-linkedin">0</span> <i class="icon icon-linkedin notranslate" aria-hidden="true"></i> </a> <a href="http://reddit.com/submit?url=https://www.yegor256.com/2016/07/18/law-of-demeter.html%3F2016-29&amp;title=The+Law+of+Demeter+Doesn%27t+Mean+One+Dot" title="Share on Reddit" class="button" rel="nofollow"> <span class="count count-reddit">0</span> <i class="icon icon-reddit notranslate" aria-hidden="true"></i> </a> <a href="http://news.ycombinator.com/submitlink?u=https://www.yegor256.com/2016/07/18/law-of-demeter.html%3F2016-29&amp;t=The+Law+of+Demeter+Doesn%27t+Mean+One+Dot" title="Share on Hacker News" class="button" rel="nofollow"> <span class="count count-hackernews">0</span> <i class="icon icon-hackernews notranslate" aria-hidden="true"></i> </a> </nav> </header> <article class="main" itemprop="articleBody"><div ><p>You&#39;ve probably heard about that 30-year-old <a href="https://en.wikipedia.org/wiki/Law_of_Demeter">Law of Demeter</a> (LoD). Someone asked me recently what I think about it. And not just what I think, but how it is possible to keep objects small and obey the LoD. According to the law, we&#39;re not allowed to do something like <code>book.pages().last().text()</code>. Instead, we&#39;re supposed to go with <code>book.textOfLastPage()</code>. It puzzled me, because I strongly disagree. I believe the first construct is perfectly valid in OOP. So I&#39;ve done some research to find out whether this law is really a law. What I found out is that the law is perfect, but its common understanding in the OOP world is simply wrong (not surprisingly).</p><figure class='jb_picture'><img itemprop='image' alt='Spartacus (1960) by Stanley Kubrick' src='/images/2016/07/spartacus.jpg' longdesc='#88aa81d2'/><figcaption id='88aa81d2'>Spartacus (1960) by Stanley Kubrick</figcaption></figure><p><a href="http://www.ccs.neu.edu/research/demeter/papers/law-of-demeter/oopsla88-law-of-demeter.pdf">Object-Oriented Programming: An Objective Sense of Style</a>, K.Lieberherr, I.Holland, and A.Riel, OOPSLA&#39;88 Proceedings, 1988.</p><p>This is where it was introduced. Let&#39;s see what it literally says (look for Section 3 in that PDF document):</p><blockquote><p>For all classes C, and for all methods M attached to C, all objects to which M sends a message must be instances of classes associated with the following classes: 1) the argument classes of M (including C), 2) the instance variable classes of C.</p></blockquote><p>Say it&#39;s a Java class:</p><figure class="highlight"><pre><code class="language-java" data-lang="java"><span></span><span class="kd">class</span> <span class="nc">C</span> <span class="o">{</span>
  <span class="kd">private</span> <span class="n">B</span> <span class="n">b</span><span class="o">;</span>
  <span class="kt">void</span> <span class="nf">m</span><span class="o">(</span><span class="n">A</span> <span class="n">a</span><span class="o">)</span> <span class="o">{</span>
    <span class="n">b</span><span class="o">.</span><span class="na">hello</span><span class="o">();</span>
    <span class="n">a</span><span class="o">.</span><span class="na">hello</span><span class="o">();</span>
    <span class="n">Singleton</span><span class="o">.</span><span class="na">INSTANCE</span><span class="o">.</span><span class="na">hello</span><span class="o">();</span>
    <span class="k">new</span> <span class="n">Z</span><span class="o">().</span><span class="na">hello</span><span class="o">();</span>
  <span class="o">}</span>
<span class="o">}</span></code></pre></figure><p>All four calls to four different <code>hello()</code> methods are legal, according to the LoD. So what would be illegal, I ask myself? No surprise; the answer is this: <code>a.x.hello()</code>. That would be illegal. Directly accessing the attribute from another object and then talking to it is not allowed by the law.</p><p>But we don&#39;t do that anyway. We&#39;re talking about <code>book.pages().last().text()</code>. In this chain of method calls, we&#39;re not accessing any attributes. We&#39;re asking our objects to build new objects for us. What does the law say about that? Let me read it and quote:</p><blockquote><p>Objects created by M, or by functions or methods that M calls, are considered as arguments of M</p></blockquote><p>In other words, the object <code>Pages</code> that method call <code>book.pages()</code> returns is a perfectly valid object that can be used. Then, we can call method <code>last()</code> on it and get an object <code>Page</code>, and then call method <code>text()</code>, etc. This is a perfectly valid scenario that doesn&#39;t violate the law at all, just as I expected.</p><aside class='quote'>So the bottom line is that the Law of Demeter is not against method chaining at all</aside><p>So where does this common understanding of the law come from? Why does <a href="https://en.wikipedia.org/wiki/Law_of_Demeter">Wikipedia</a> call it a rule of &quot;one dot&quot; and say that &quot;an object should avoid invoking methods of a member object returned by another method?&quot; This is absolutely to the contrary of what the original paper says! What&#39;s going on?</p><p>The answer is simple: <a href="/2014/09/16/getters-and-setters-are-evil.html">getters</a>.</p><p>The majority of OOP developers think most object methods that return anything are getters. And getters, indeed, are no different than direct access to object attributes. That&#39;s why Wikipedia actually says &quot;no direct access to attributes and, since most of your methods are getters, don&#39;t touch them either, silly.&quot;</p><p>That&#39;s just sad to see.</p><p>So the bottom line is that the Law of Demeter is not against method chaining at all. Of course, it&#39;s against getters and direct attribute access. But who isn&#39;t, right?</p></div></article></div><div class="wrapper"> <related-posts /></div><div class="disqus" role="complementary"><p class="disqus_hint"> Please, use <a href="https://help.disqus.com/commenting/what-html-tags-are-allowed-within-comments">syntax highlighting</a> in your comments, to make them more readable.</p><div id="disqus_thread" class="disqus-thread"> <a>&nbsp;</a></div><script> var disqus_config = function () { this.page.url = document.location.href.split('?')[0].split('#')[0].replace('https://', 'http://'); this.page.identifier = this.page.url; }; (function() { var d = document, s = d.createElement('script'); s.src = '//yegor256.disqus.com/embed.js'; s.setAttribute('data-timestamp', +new Date()); (d.head || d.body).appendChild(s); })(); </script> <noscript><div><p class="red"> JavaScript is disabled in your browser, that's why you can't see comments under this post.</p></div></noscript></div><div class="wrapper"> <footer class="footer"><p> &copy; <span itemscope="" itemprop="copyrightHolder" itemtype="http://schema.org/Person"> <span itemprop="name">Yegor Bugayenko</span> </span> 2014&ndash;<span itemprop="copyrightYear">2018</span></p></footer></div></section><div class="wrapper unprintable" style="text-align:center;margin-top:2em;"> <a href="http://www.sixnines.io/h/3ba1652f"> <img src="//www.sixnines.io/b/3ba1652f?style=flat" alt="sixnines availability badge"/> </a></div><script src="//code.jquery.com/jquery-1.9.0.min.js"></script> <script src="/js/all.js?a0e0d018c07"></script> <script>var disqus_shortname = 'yegor256';</script> <script id="dsq-count-scr" src="//yegor256.disqus.com/count.js" async="async"></script> <script> (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){ (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o), m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m) })(window,document,'script','//www.google-analytics.com/analytics.js','ga'); ga('create', 'UA-1963507-32', 'auto'); ga('send', 'pageview'); </script> <script> Cd=document;Cr="&"+Math.random();Cp="&s=1"; Cd.cookie="b=b";if(Cd.cookie)Cp+="&c=1"; Cp+="&t="+(new Date()).getTimezoneOffset(); if(self!=top)Cp+="&f=1"; </script> <script> if(navigator.javaEnabled())Cp+="&j=1"; </script> <script> if(typeof(screen)!='undefined')Cp+="&w="+screen.width+"&h="+ screen.height+"&d="+(screen.colorDepth?screen.colorDepth:screen.pixelDepth); </script> <script> Cd.write("<img src='//c.hit.ua/hit?i=95870&g=0&x=2"+Cp+Cr+ "&r="+escape(Cd.referrer)+"&u="+escape(window.location.href)+ "' border='0' wi"+"dth='1' he"+"ight='1'/>"); </script> <script type="application/ld+json"> { "@context": "http://schema.org", "@type": "Person", "name": "Yegor Bugayenko", "url": "http://www.yegor256.com", "sameAs": [ "https://www.facebook.com/yegor256", "https://instagram.com/yegor256", "https://www.linkedin.com/in/yegor256", "https://twitter.com/yegor256", "https://github.com/yegor256", "https://www.pinterest.com/yegor256/" ] } </script> </body> </html> <!DOCTYPE html> <html xmlns="http://www.w3.org/1999/xhtml" lang="en-US" xml:lang="en-US" itemscope="" itemtype="http://schema.org/WebSite"> <head> <meta charset="utf-8"/> <meta name="description" content="The definition of an object is fundamental to the entire object-oriented programming paradigm, but it is not defined correctly in most books. " /> <meta name="keywords" content="object, object definition in oop, object in oop, oop object, what is object in oop" /> <meta name="viewport" content="width=device-width,minimum-scale=1,initial-scale=1"/> <meta name="google-site-verification" content="JEj_gQr2CPe2QKGw8XdMz0R7VboQIUbX3FlM-lwTq-8" /> <meta name="author" content="Yegor Bugayenko"> <meta name="article:published_time" content="2016-07-14 00:00:00 +0000"> <meta name="og:site_name" content="Yegor Bugayenko"/> <meta name="og:type" content="article" /> <meta name="og:locale" content="en_US" /> <meta name="twitter:account_id" content="4503599630178231" /> <meta name="twitter:creator" content="@yegor256"/> <meta name="twitter:site" content="@yegor256"/> <meta name="twitter:title" property="og:title" content="Who Is an Object?"/> <meta name="twitter:description" property="og:description" content="The definition of an object is fundamental to the entire object-oriented programming paradigm, but it is not defined correctly in most books. "/> <meta name="twitter:url" property="og:url" content="https://www.yegor256.com/2016/07/14/who-is-object.html"/> <meta name="telegram:channel" content="AAAAAEJFMRzsRTRxM3ec6A"/> <link rel="search" type="application/opensearchdescription+xml" href="/opensearch.xml" title="yegor256" /> <link rel="shortcut icon" href="/favicon.ico?a0e0d018c07"/> <link rel="apple-touch-icon" href="/favicon.ico?a0e0d018c07"/> <link rel="alternate" type="application/rss+xml" title="RSS for yegor256.com" href="https://www.yegor256.com/rss.xml"/> <link rel="stylesheet" href="/css/layout.css?a0e0d018c07"/> <link rel="stylesheet" href="/css/icons.css?a0e0d018c07"/> <link rel="canonical" href="https://www.yegor256.com/2016/07/14/who-is-object.html" /> <link rel="amphtml" href="https://www.yegor256.com/2016/07/14/who-is-object.amp.html" /> <title>Who Is an Object? </title> <meta name='og:image' content='https://www.yegor256.com/images/2016/07/jackass-the-movie.jpg'/><meta name='twitter:image' content='https://www.yegor256.com/images/2016/07/jackass-the-movie.jpg'/><meta name='og:image:width' content='1200'/> <meta name='twitter:image:width' content='1200'/><meta name='og:image:height' content='675'/> <meta name='twitter:image:height' content='675'/><meta name='twitter:card' content='summary_large_image'/><meta name='twitter:image:alt' content='Jackass: The Movie (2002) by Jeff Tremaine'/> </head> <body><div class="wrapper"> <aside class="header-toggle unprintable" id="header-toggle" title="Show the menu" onclick="$('#header').show();$('#header-toggle').hide();">&#9776;</aside> <header class="header" id="header"><div class="face"> <a href="/about-me.html#form" class="sub" title="Click to subscribe to my monthly newsletter"><span>Subscribe</span></a> <a href="/about-me.html" style="position:relative;"> <img src="/images/face-256x256.jpg" class="photo" alt="Yegor Bugayenko"/> </a></div><nav><ul class="menu social notranslate"> <li><a href="https://twitter.com/intent/follow?screen_name=yegor256" rel="nofollow" title="Follow me on Twitter"><i class="icon icon-twitter notranslate" aria-hidden="true"></i></a></li> <li><a href="/rss.xml" rel="nofollow" title="Subscribe to my RSS feed"><i class="icon icon-rss notranslate" aria-hidden="true"></i></a></li> <li><a itemprop="sameAs" href="https://github.com/yegor256" rel="nofollow" title="My GitHub profile"><i class="icon icon-github notranslate" aria-hidden="true"></i></a></li> <li><a itemprop="sameAs" href="http://stackoverflow.com/users/187141/yegor256" rel="nofollow" title="My StackOverflow profile"><i class="icon icon-stackoverflow notranslate" aria-hidden="true"></i></a></li> <li><a itemprop="sameAs" href="https://www.facebook.com/yegor256" rel="nofollow" title="Follow me on Facebook"><i class="icon icon-facebook notranslate" aria-hidden="true"></i></a></li> <li><a itemprop="sameAs" href="https://instagram.com/yegor256" rel="nofollow" title="Follow me on Instagram"><i class="icon icon-instagram notranslate" aria-hidden="true"></i></a></li> <li><a itemprop="sameAs" href="https://www.linkedin.com/in/yegor256" rel="nofollow" title="My LinkedIn profile"><i class="icon icon-linkedin notranslate" aria-hidden="true"></i></a></li> <li><a itemprop="sameAs" href="https://www.youtube.com/c/yegor256?sub_confirmation=1" rel="nofollow" title="My Youtube video channel"><i class="icon icon-youtube notranslate" aria-hidden="true"></i></a></li> <li><a itemprop="sameAs" href="https://www.pinterest.com/yegor256/" rel="nofollow" title="My Pinterest boards"><i class="icon icon-pinterest notranslate" aria-hidden="true"></i></a></li> <li><a itemprop="sameAs" href="https://angel.co/yegor256" rel="nofollow" title="My AngelList profile"><i class="icon icon-angellist notranslate" aria-hidden="true"></i></a></li> <li><a href="https://soundcloud.com/yegor256" rel="nofollow" title="My podcast"><i class="icon icon-podcast notranslate" aria-hidden="true"></i></a></li> <li><a href="https://itunes.apple.com/us/podcast/yegor256-podcast/id1150826721" rel="nofollow" title="My iTunes podcast"><i class="icon icon-itunes notranslate" aria-hidden="true"></i></a></li> <li><a href="https://t.me/joinchat/AAAAAEJFMRzsRTRxM3ec6A" rel="nofollow" title="My Telegram public channel"><i class="icon icon-telegram notranslate" aria-hidden="true"></i></a></li> <li><a href="mailto:blog@yegor256.com" rel="nofollow" title="Email me any time"><i class="icon icon-mail notranslate" aria-hidden="true"></i></a></li></ul><ul class="menu"> <li><a href="/" title="Home page">Home</a></li> <li ><a href="/best.html" title="Best articles to read">12&#160;Best</a></li> <li ><a href="/contents.html" title="The contents of the entire blog">All&#160;288</a></li> <li ><a href="/webinars.html" title="My webinars">Webinars</a></li> <li ><a href="/talks.html" title="Future and past conference talks">Talks</a></li> <li ><a href="/books.html" title="The books I wrote">Books</a></li> <li ><a href="/papers.html" title="My academic papers and patents">Papers</a></li> <li ><a href="/pets.html" title="My loved pet projects">Pets</a></li> <li ><a href="/award.html" title="Software quality award">Award</a></li> <li ><a href="/testimonials.html" title="What some people say about me">Testimonials</a></li> <li ><a href="/shift-m.html" title="Audio podcast about project management">Shift-M</a></li> <li ><a href="/paintings.html" title="My paintings for sale">Paintings</a></li> <li><a href="http://ru.yegor256.com/" title="Немного на русском языке">По-русски</a></li></ul></nav><div class="search"> <form method="get" action="https://www.google.com/search" itemprop="potentialAction" itemscope="" itemtype="http://schema.org/SearchAction"> <meta itemprop="target" content="https://www.google.com/search?q={q}"/> <input name="sitesearch" value="yegor256.com" type="hidden"/> <input itemprop="query-input" type="text" id="search-query" class="field field-text" required="required" onfocus="$('.google').css('visibility', 'visible');" name="q" placeholder="Search..." autocomplete="off"/> <input type="image" src="/images/google-search-icon.svg" class="google" title="Search via Google" alt="Search via Google"/> </form></div><div class="hot"><ul> <li> <a href="/code-ahead.html">Code Ahead</a> was published on Amazon just a few days ago! It is my new book, a novel about programmers. It explains in details the majority of ideas that stand behind <a href="https://www.zerocracy.com">Zerocracy</a> and <a href="https://www.xdsd.org">XDSD</a>. </li> <li> At <a href="/webinars.html">Webinar #37</a> we will discuss naming problem in OOP, for objects, methods and attributes; join us on <b>September 12</b>, at 11am PST. </li></ul></div></header></div><section itemscope="" itemtype="http://schema.org/BlogPosting"><div class="wrapper"> <header><p class="printable"> <img src="https://api.qrserver.com/v1/create-qr-code/?data=https://www.yegor256.com/2016/07/14/who-is-object.html&amp;format=svg" style="width:125px;height:125px;" alt="QR code"/></p><p class="printable"> <code itemprop="url">https://www.yegor256.com/2016/07/14/who-is-object.html</code></p><h1 itemprop="name headline mainEntityOfPage">Who Is an Object?</h1><ul class="subline"> <li> <time itemprop="datePublished" datetime="2016-07-14T00:00:00+00:00"> 14 July 2016 </time> </li> <li class="desktop-only" itemprop="locationCreated">Palo Alto, CA</li> <li class="printable" itemscope="" itemprop="author" itemtype="http://schema.org/Person"> <span itemprop="name">Yegor Bugayenko</span> </li> <li class="unprintable"> <i class="icon icon-comments"></i> <a href="http://www.yegor256.com/2016/07/14/who-is-object.html#disqus_thread" itemprop="discussionUrl">comments</a> </li></ul><ul class="unprintable subline"> <li>Translated:</li> <li><a href="https://agorlov.github.io/yb-object.html">Russian</a></li> <li><a href="mailto:translate@yegor256.com">add yours!</a></li></ul><p class="unprintable"><p>There are thousands of books about object-oriented programming and hundreds of object-oriented languages, and I believe most (read &quot;all&quot;) of them give us an incorrect definition of an &quot;object.&quot; That&#39;s why the entire OOP world is so full of misconceptions and mistakes. Their definition of an object is limited by the hardware architecture they are working with and that&#39;s why is very primitive and mechanical. I&#39;d like to introduce a better one.</p><figure class='jb_picture'><img itemprop='image' alt='Jackass: The Movie (2002) by Jeff Tremaine' src='/images/2016/07/jackass-the-movie.jpg' longdesc='#deacdd46'/><figcaption id='deacdd46'>Jackass: The Movie (2002) by Jeff Tremaine</figcaption></figure><p>What is an object? I&#39;ve done a little research, and this is what I&#39;ve found:</p><ul> <li><p>&quot;Objects may contain data, in the form of fields, often known as attributes; and code, in the form of procedures, often known as methods&quot;---<a href="https://en.wikipedia.org/wiki/Object-oriented_programming">Wikipedia</a> at the time of writing.</p></li> <li><p>&quot;An object stores its state in fields and exposes its behavior through methods&quot;---<a href="https://docs.oracle.com/javase/tutorial/java/concepts/object.html">What Is an Object?</a> by Oracle.</p></li> <li><p>&quot;Each object looks quite a bit like a little computer---it has a state, and it has operations that you can ask it to perform&quot;---<a href="http://amzn.to/1PBmQpm">Thinking in Java</a>, 4th Ed., Bruce Eckel, p. 16.</p></li> <li><p>&quot;A class is a collection of data fields that hold values and methods that operate on those values&quot;---<a href="http://amzn.to/28PEqSi">Java in a Nutshell</a>, 6th Ed., Evans and Flanagan, p. 98.</p></li> <li><p>&quot;An object is some memory that holds a value of some type&quot;---<a href="http://amzn.to/1XyGCtk">The C++ Programming Language</a>, 4th Ed., Bjarne Stroustrup, p. 40.</p></li> <li><p>&quot;An object consists of some private memory and a set of operations&quot;---<a href="http://amzn.to/1UhYinp">Smalltalk-80</a>, Goldberg and Robson, p. 6.</p></li></ul><p>What is common throughout all these definitions is the word &quot;contains&quot; (or &quot;holds,&quot; &quot;consists,&quot; &quot;has,&quot; etc.). They all think that an object is a <em>box with data</em>. And this perspective is exactly what I&#39;m strongly against.</p><aside class='quote'>They all think that an object is a box with data---this perspective is exactly what I'm strongly against.</aside><p>If we look at how C++ or Java are implemented, such a definition of an object will sound <em>technically</em> correct. Indeed, for each object, Java Virtual Machine allocates a few bytes in memory in order to store object attributes there. Thus, we can technically say, in that language, that an object is an in-memory box with data.</p><p>Right, but this is just a corner case!</p><p>Let&#39;s try to imagine another object-oriented language that doesn&#39;t store object attributes in memory. Confused? Bear with me for a minute. Let&#39;s say that in that language we define an object:</p><figure class="highlight"><pre><code class="language-text" data-lang="text"><span></span>c {
  vin: v,
  engine: e
}</code></pre></figure><p>Here, <code>vin</code> and <code>engine</code> are attributes of object <code>c</code> (it&#39;s a car; let&#39;s forget about classes for now to focus strictly on objects). Thus, there is a simple object that has two attributes. The first one is car&#39;s VIN, and the second one is its engine. The VIN is an object <code>v</code>, while the engine is <code>e</code>. To make it easier to understand, this is how a similar object would look in Java:</p><figure class="highlight"><pre><code class="language-java" data-lang="java"><span></span><span class="kt">char</span><span class="o">[]</span> <span class="n">v</span> <span class="o">=</span> <span class="o">{</span><span class="sc">&#39;W&#39;</span><span class="o">,</span><span class="sc">&#39;D&#39;</span><span class="o">,</span><span class="sc">&#39;B&#39;</span><span class="o">,</span><span class="sc">&#39;H&#39;</span><span class="o">,...</span><span class="sc">&#39;7&#39;</span><span class="o">,</span><span class="sc">&#39;2&#39;</span><span class="o">,</span><span class="sc">&#39;8&#39;</span><span class="o">,</span><span class="sc">&#39;8&#39;</span><span class="o">};</span> <span class="c1">// 17 chars</span>
<span class="n">Engine</span> <span class="n">e</span> <span class="o">=</span> <span class="k">new</span> <span class="n">Engine</span><span class="o">();</span>
<span class="n">Car</span> <span class="n">c</span> <span class="o">=</span> <span class="k">new</span> <span class="n">Car</span><span class="o">(</span><span class="n">v</span><span class="o">,</span> <span class="n">e</span><span class="o">);</span></code></pre></figure><p>I&#39;m not entirely sure about JVM, but in C++ such an object will take exactly 25 bytes in memory (assuming it&#39;s 64-bit x86 architecture). The first 17 bytes will be taken by the array of chars and another 8 bytes by a pointer to the block in memory with object <code>e</code>. That&#39;s how the C++ compiler understands objects and translates them to the x86 architecture. In C++, objects are just data structures with clearly defined allocation of data attributes.</p><p>In that example, attributes <code>vin</code> and <code>engine</code> are not equal: <code>vin</code> is &quot;data,&quot; while <code>engine</code> is a &quot;pointer&quot; to another object. I intentionally made it this way in order to demonstrate that calling an object a box with data is possible only with <code>vin</code>. Only when the data are located right &quot;inside&quot; the object can we say that the object is actually a box for the data. With <code>engine</code>, it isn&#39;t really true because there is no data technically <em>inside</em> the object. Instead, there is a <em>pointer</em> to another object. If our object would only have an <code>engine</code> attribute, it would take just 8 bytes in memory, with none of them actually occupied by &quot;data.&quot;</p><aside class='quote'>Objects are no longer boxes with data; they know where the data is, but they don't contain the data.</aside><p>Now, let&#39;s get back to our new pseudo language. Let&#39;s imagine it treats objects very differently than C++---it doesn&#39;t keep object attributes in memory <em>at all</em>. It doesn&#39;t have pointers, and it doesn&#39;t know anything about x86 architecture. It just <em>knows</em> somehow what attributes belong to an object.</p><p>Thus, in our language, objects are no longer boxes with data both technically and conceptually. They know where the data is, but they don&#39;t <em>contain</em> the data. They <em>represent</em> the data, as well as other objects and entities. Indeed, the object <code>c</code> in our imaginary language represents two other objects: a VIN and an engine.</p><p>To summarize, we have to understand that even though a mechanical definition of an object is correct in most programming languages on the market at the moment, it is very incorrect conceptually because it treats an object as a box with data that are too visible to the outside world. That visibility provokes us to think <em>procedurally</em> and try to access that data as much as possible.</p><figure class='badge'><a href='http://amzn.to/266oJr4'><img src='https://www.yegor256.com/images/2015/04/book-object-thinking.jpg' style='width:96px;max-width:100%;' alt='badge'/></a></figure><p>If we would think of an object as a <strong>representative</strong> of data instead of a container of them, we would not want to get a hold of data as soon as possible. We would understand that the data are far away and we can&#39;t just easily touch them. We should communicate with an object---and how exactly it communicates with the data is not our concern.</p><p>I hope that in the near future, the market will introduce new object-oriented languages that won&#39;t store objects as in-memory data structures, even technically.</p><p>By the way, here is the definition of an object from my favorite book, <a href="http://amzn.to/266oJr4">Object Thinking</a> by David West, p. 66:</p><blockquote><p>An object is the equivalent of the quanta from which the universe is constructed</p></blockquote><p>What do you think? Is it close to the &quot;representative&quot; definition I just proposed?</p></p><nav class="buttons notranslate desktop-only"> <a href="http://www.facebook.com/sharer/sharer.php?u=https://www.yegor256.com/2016/07/14/who-is-object.html" title="Share on Facebook" class="button" rel="nofollow"> <span class="count count-facebook">0</span> <i class="icon icon-facebook notranslate" aria-hidden="true"></i> </a> <a href="https://twitter.com/share?url=https://www.yegor256.com/2016/07/14/who-is-object.html&amp;text=Who+Is+an+Object%3F" title="Share on Twitter" class="button" rel="nofollow"> <span class="count count-twitter">0</span> <i class="icon icon-twitter notranslate" aria-hidden="true"></i> </a> <a href="https://plus.google.com/share?url=https://www.yegor256.com/2016/07/14/who-is-object.html" title="Share on Google+" class="button" rel="nofollow"> <span class="count count-googleplus">0</span> <i class="icon icon-googleplus notranslate" aria-hidden="true"></i> </a> <a href="https://www.linkedin.com/cws/share?url=https://www.yegor256.com/2016/07/14/who-is-object.html" title="Share on LinkedIn" class="button" rel="nofollow"> <span class="count count-linkedin">0</span> <i class="icon icon-linkedin notranslate" aria-hidden="true"></i> </a> <a href="http://reddit.com/submit?url=https://www.yegor256.com/2016/07/14/who-is-object.html%3F2016-28&amp;title=Who+Is+an+Object%3F" title="Share on Reddit" class="button" rel="nofollow"> <span class="count count-reddit">0</span> <i class="icon icon-reddit notranslate" aria-hidden="true"></i> </a> <a href="http://news.ycombinator.com/submitlink?u=https://www.yegor256.com/2016/07/14/who-is-object.html%3F2016-28&amp;t=Who+Is+an+Object%3F" title="Share on Hacker News" class="button" rel="nofollow"> <span class="count count-hackernews">0</span> <i class="icon icon-hackernews notranslate" aria-hidden="true"></i> </a> </nav> </header> <article class="main" itemprop="articleBody"><div ><p>There are thousands of books about object-oriented programming and hundreds of object-oriented languages, and I believe most (read &quot;all&quot;) of them give us an incorrect definition of an &quot;object.&quot; That&#39;s why the entire OOP world is so full of misconceptions and mistakes. Their definition of an object is limited by the hardware architecture they are working with and that&#39;s why is very primitive and mechanical. I&#39;d like to introduce a better one.</p><figure class='jb_picture'><img itemprop='image' alt='Jackass: The Movie (2002) by Jeff Tremaine' src='/images/2016/07/jackass-the-movie.jpg' longdesc='#deacdd46'/><figcaption id='deacdd46'>Jackass: The Movie (2002) by Jeff Tremaine</figcaption></figure><p>What is an object? I&#39;ve done a little research, and this is what I&#39;ve found:</p><ul> <li><p>&quot;Objects may contain data, in the form of fields, often known as attributes; and code, in the form of procedures, often known as methods&quot;---<a href="https://en.wikipedia.org/wiki/Object-oriented_programming">Wikipedia</a> at the time of writing.</p></li> <li><p>&quot;An object stores its state in fields and exposes its behavior through methods&quot;---<a href="https://docs.oracle.com/javase/tutorial/java/concepts/object.html">What Is an Object?</a> by Oracle.</p></li> <li><p>&quot;Each object looks quite a bit like a little computer---it has a state, and it has operations that you can ask it to perform&quot;---<a href="http://amzn.to/1PBmQpm">Thinking in Java</a>, 4th Ed., Bruce Eckel, p. 16.</p></li> <li><p>&quot;A class is a collection of data fields that hold values and methods that operate on those values&quot;---<a href="http://amzn.to/28PEqSi">Java in a Nutshell</a>, 6th Ed., Evans and Flanagan, p. 98.</p></li> <li><p>&quot;An object is some memory that holds a value of some type&quot;---<a href="http://amzn.to/1XyGCtk">The C++ Programming Language</a>, 4th Ed., Bjarne Stroustrup, p. 40.</p></li> <li><p>&quot;An object consists of some private memory and a set of operations&quot;---<a href="http://amzn.to/1UhYinp">Smalltalk-80</a>, Goldberg and Robson, p. 6.</p></li></ul><p>What is common throughout all these definitions is the word &quot;contains&quot; (or &quot;holds,&quot; &quot;consists,&quot; &quot;has,&quot; etc.). They all think that an object is a <em>box with data</em>. And this perspective is exactly what I&#39;m strongly against.</p><aside class='quote'>They all think that an object is a box with data---this perspective is exactly what I'm strongly against.</aside><p>If we look at how C++ or Java are implemented, such a definition of an object will sound <em>technically</em> correct. Indeed, for each object, Java Virtual Machine allocates a few bytes in memory in order to store object attributes there. Thus, we can technically say, in that language, that an object is an in-memory box with data.</p><p>Right, but this is just a corner case!</p><p>Let&#39;s try to imagine another object-oriented language that doesn&#39;t store object attributes in memory. Confused? Bear with me for a minute. Let&#39;s say that in that language we define an object:</p><figure class="highlight"><pre><code class="language-text" data-lang="text"><span></span>c {
  vin: v,
  engine: e
}</code></pre></figure><p>Here, <code>vin</code> and <code>engine</code> are attributes of object <code>c</code> (it&#39;s a car; let&#39;s forget about classes for now to focus strictly on objects). Thus, there is a simple object that has two attributes. The first one is car&#39;s VIN, and the second one is its engine. The VIN is an object <code>v</code>, while the engine is <code>e</code>. To make it easier to understand, this is how a similar object would look in Java:</p><figure class="highlight"><pre><code class="language-java" data-lang="java"><span></span><span class="kt">char</span><span class="o">[]</span> <span class="n">v</span> <span class="o">=</span> <span class="o">{</span><span class="sc">&#39;W&#39;</span><span class="o">,</span><span class="sc">&#39;D&#39;</span><span class="o">,</span><span class="sc">&#39;B&#39;</span><span class="o">,</span><span class="sc">&#39;H&#39;</span><span class="o">,...</span><span class="sc">&#39;7&#39;</span><span class="o">,</span><span class="sc">&#39;2&#39;</span><span class="o">,</span><span class="sc">&#39;8&#39;</span><span class="o">,</span><span class="sc">&#39;8&#39;</span><span class="o">};</span> <span class="c1">// 17 chars</span>
<span class="n">Engine</span> <span class="n">e</span> <span class="o">=</span> <span class="k">new</span> <span class="n">Engine</span><span class="o">();</span>
<span class="n">Car</span> <span class="n">c</span> <span class="o">=</span> <span class="k">new</span> <span class="n">Car</span><span class="o">(</span><span class="n">v</span><span class="o">,</span> <span class="n">e</span><span class="o">);</span></code></pre></figure><p>I&#39;m not entirely sure about JVM, but in C++ such an object will take exactly 25 bytes in memory (assuming it&#39;s 64-bit x86 architecture). The first 17 bytes will be taken by the array of chars and another 8 bytes by a pointer to the block in memory with object <code>e</code>. That&#39;s how the C++ compiler understands objects and translates them to the x86 architecture. In C++, objects are just data structures with clearly defined allocation of data attributes.</p><p>In that example, attributes <code>vin</code> and <code>engine</code> are not equal: <code>vin</code> is &quot;data,&quot; while <code>engine</code> is a &quot;pointer&quot; to another object. I intentionally made it this way in order to demonstrate that calling an object a box with data is possible only with <code>vin</code>. Only when the data are located right &quot;inside&quot; the object can we say that the object is actually a box for the data. With <code>engine</code>, it isn&#39;t really true because there is no data technically <em>inside</em> the object. Instead, there is a <em>pointer</em> to another object. If our object would only have an <code>engine</code> attribute, it would take just 8 bytes in memory, with none of them actually occupied by &quot;data.&quot;</p><aside class='quote'>Objects are no longer boxes with data; they know where the data is, but they don't contain the data.</aside><p>Now, let&#39;s get back to our new pseudo language. Let&#39;s imagine it treats objects very differently than C++---it doesn&#39;t keep object attributes in memory <em>at all</em>. It doesn&#39;t have pointers, and it doesn&#39;t know anything about x86 architecture. It just <em>knows</em> somehow what attributes belong to an object.</p><p>Thus, in our language, objects are no longer boxes with data both technically and conceptually. They know where the data is, but they don&#39;t <em>contain</em> the data. They <em>represent</em> the data, as well as other objects and entities. Indeed, the object <code>c</code> in our imaginary language represents two other objects: a VIN and an engine.</p><p>To summarize, we have to understand that even though a mechanical definition of an object is correct in most programming languages on the market at the moment, it is very incorrect conceptually because it treats an object as a box with data that are too visible to the outside world. That visibility provokes us to think <em>procedurally</em> and try to access that data as much as possible.</p><figure class='badge'><a href='http://amzn.to/266oJr4'><img src='https://www.yegor256.com/images/2015/04/book-object-thinking.jpg' style='width:96px;max-width:100%;' alt='badge'/></a></figure><p>If we would think of an object as a <strong>representative</strong> of data instead of a container of them, we would not want to get a hold of data as soon as possible. We would understand that the data are far away and we can&#39;t just easily touch them. We should communicate with an object---and how exactly it communicates with the data is not our concern.</p><p>I hope that in the near future, the market will introduce new object-oriented languages that won&#39;t store objects as in-memory data structures, even technically.</p><p>By the way, here is the definition of an object from my favorite book, <a href="http://amzn.to/266oJr4">Object Thinking</a> by David West, p. 66:</p><blockquote><p>An object is the equivalent of the quanta from which the universe is constructed</p></blockquote><p>What do you think? Is it close to the &quot;representative&quot; definition I just proposed?</p></div></article></div><div class="wrapper"> <related-posts /></div><div class="disqus" role="complementary"><p class="disqus_hint"> Please, use <a href="https://help.disqus.com/commenting/what-html-tags-are-allowed-within-comments">syntax highlighting</a> in your comments, to make them more readable.</p><div id="disqus_thread" class="disqus-thread"> <a>&nbsp;</a></div><script> var disqus_config = function () { this.page.url = document.location.href.split('?')[0].split('#')[0].replace('https://', 'http://'); this.page.identifier = this.page.url; }; (function() { var d = document, s = d.createElement('script'); s.src = '//yegor256.disqus.com/embed.js'; s.setAttribute('data-timestamp', +new Date()); (d.head || d.body).appendChild(s); })(); </script> <noscript><div><p class="red"> JavaScript is disabled in your browser, that's why you can't see comments under this post.</p></div></noscript></div><div class="wrapper"> <footer class="footer"><p> &copy; <span itemscope="" itemprop="copyrightHolder" itemtype="http://schema.org/Person"> <span itemprop="name">Yegor Bugayenko</span> </span> 2014&ndash;<span itemprop="copyrightYear">2018</span></p></footer></div></section><div class="wrapper unprintable" style="text-align:center;margin-top:2em;"> <a href="http://www.sixnines.io/h/3ba1652f"> <img src="//www.sixnines.io/b/3ba1652f?style=flat" alt="sixnines availability badge"/> </a></div><script src="//code.jquery.com/jquery-1.9.0.min.js"></script> <script src="/js/all.js?a0e0d018c07"></script> <script>var disqus_shortname = 'yegor256';</script> <script id="dsq-count-scr" src="//yegor256.disqus.com/count.js" async="async"></script> <script> (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){ (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o), m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m) })(window,document,'script','//www.google-analytics.com/analytics.js','ga'); ga('create', 'UA-1963507-32', 'auto'); ga('send', 'pageview'); </script> <script> Cd=document;Cr="&"+Math.random();Cp="&s=1"; Cd.cookie="b=b";if(Cd.cookie)Cp+="&c=1"; Cp+="&t="+(new Date()).getTimezoneOffset(); if(self!=top)Cp+="&f=1"; </script> <script> if(navigator.javaEnabled())Cp+="&j=1"; </script> <script> if(typeof(screen)!='undefined')Cp+="&w="+screen.width+"&h="+ screen.height+"&d="+(screen.colorDepth?screen.colorDepth:screen.pixelDepth); </script> <script> Cd.write("<img src='//c.hit.ua/hit?i=95870&g=0&x=2"+Cp+Cr+ "&r="+escape(Cd.referrer)+"&u="+escape(window.location.href)+ "' border='0' wi"+"dth='1' he"+"ight='1'/>"); </script> <script type="application/ld+json"> { "@context": "http://schema.org", "@type": "Person", "name": "Yegor Bugayenko", "url": "http://www.yegor256.com", "sameAs": [ "https://www.facebook.com/yegor256", "https://instagram.com/yegor256", "https://www.linkedin.com/in/yegor256", "https://twitter.com/yegor256", "https://github.com/yegor256", "https://www.pinterest.com/yegor256/" ] } </script> </body> </html> <!DOCTYPE html> <html xmlns="http://www.w3.org/1999/xhtml" lang="en-US" xml:lang="en-US" itemscope="" itemtype="http://schema.org/WebSite"> <head> <meta charset="utf-8"/> <meta name="description" content="DTO is a very popular design pattern, but it is actually an anti-pattern in object-oriented programming that has no right to exist. " /> <meta name="keywords" content="DTO, DTO design pattern, DTO in java, ORM DTO, data transfer object" /> <meta name="viewport" content="width=device-width,minimum-scale=1,initial-scale=1"/> <meta name="google-site-verification" content="JEj_gQr2CPe2QKGw8XdMz0R7VboQIUbX3FlM-lwTq-8" /> <meta name="author" content="Yegor Bugayenko"> <meta name="article:published_time" content="2016-07-06 00:00:00 +0000"> <meta name="og:site_name" content="Yegor Bugayenko"/> <meta name="og:type" content="article" /> <meta name="og:locale" content="en_US" /> <meta name="twitter:account_id" content="4503599630178231" /> <meta name="twitter:creator" content="@yegor256"/> <meta name="twitter:site" content="@yegor256"/> <meta name="twitter:title" property="og:title" content="Data Transfer Object Is a Shame"/> <meta name="twitter:description" property="og:description" content="DTO is a very popular design pattern, but it is actually an anti-pattern in object-oriented programming that has no right to exist. "/> <meta name="twitter:url" property="og:url" content="https://www.yegor256.com/2016/07/06/data-transfer-object.html"/> <meta name="telegram:channel" content="AAAAAEJFMRzsRTRxM3ec6A"/> <link rel="search" type="application/opensearchdescription+xml" href="/opensearch.xml" title="yegor256" /> <link rel="shortcut icon" href="/favicon.ico?a0e0d018c07"/> <link rel="apple-touch-icon" href="/favicon.ico?a0e0d018c07"/> <link rel="alternate" type="application/rss+xml" title="RSS for yegor256.com" href="https://www.yegor256.com/rss.xml"/> <link rel="stylesheet" href="/css/layout.css?a0e0d018c07"/> <link rel="stylesheet" href="/css/icons.css?a0e0d018c07"/> <link rel="canonical" href="https://www.yegor256.com/2016/07/06/data-transfer-object.html" /> <link rel="amphtml" href="https://www.yegor256.com/2016/07/06/data-transfer-object.amp.html" /> <title>Data Transfer Object Is a Shame </title> <meta name='og:image' content='https://www.yegor256.com/images/2016/07/before-the-devil-knows-you-are-dead.jpg'/><meta name='twitter:image' content='https://www.yegor256.com/images/2016/07/before-the-devil-knows-you-are-dead.jpg'/><meta name='og:image:width' content='1200'/> <meta name='twitter:image:width' content='1200'/><meta name='og:image:height' content='655'/> <meta name='twitter:image:height' content='655'/><meta name='twitter:card' content='summary_large_image'/><meta name='twitter:image:alt' content='Before the Devil Knows You&#39;re Dead (2007) by Sidney Lumet'/> </head> <body><div class="wrapper"> <aside class="header-toggle unprintable" id="header-toggle" title="Show the menu" onclick="$('#header').show();$('#header-toggle').hide();">&#9776;</aside> <header class="header" id="header"><div class="face"> <a href="/about-me.html#form" class="sub" title="Click to subscribe to my monthly newsletter"><span>Subscribe</span></a> <a href="/about-me.html" style="position:relative;"> <img src="/images/face-256x256.jpg" class="photo" alt="Yegor Bugayenko"/> </a></div><nav><ul class="menu social notranslate"> <li><a href="https://twitter.com/intent/follow?screen_name=yegor256" rel="nofollow" title="Follow me on Twitter"><i class="icon icon-twitter notranslate" aria-hidden="true"></i></a></li> <li><a href="/rss.xml" rel="nofollow" title="Subscribe to my RSS feed"><i class="icon icon-rss notranslate" aria-hidden="true"></i></a></li> <li><a itemprop="sameAs" href="https://github.com/yegor256" rel="nofollow" title="My GitHub profile"><i class="icon icon-github notranslate" aria-hidden="true"></i></a></li> <li><a itemprop="sameAs" href="http://stackoverflow.com/users/187141/yegor256" rel="nofollow" title="My StackOverflow profile"><i class="icon icon-stackoverflow notranslate" aria-hidden="true"></i></a></li> <li><a itemprop="sameAs" href="https://www.facebook.com/yegor256" rel="nofollow" title="Follow me on Facebook"><i class="icon icon-facebook notranslate" aria-hidden="true"></i></a></li> <li><a itemprop="sameAs" href="https://instagram.com/yegor256" rel="nofollow" title="Follow me on Instagram"><i class="icon icon-instagram notranslate" aria-hidden="true"></i></a></li> <li><a itemprop="sameAs" href="https://www.linkedin.com/in/yegor256" rel="nofollow" title="My LinkedIn profile"><i class="icon icon-linkedin notranslate" aria-hidden="true"></i></a></li> <li><a itemprop="sameAs" href="https://www.youtube.com/c/yegor256?sub_confirmation=1" rel="nofollow" title="My Youtube video channel"><i class="icon icon-youtube notranslate" aria-hidden="true"></i></a></li> <li><a itemprop="sameAs" href="https://www.pinterest.com/yegor256/" rel="nofollow" title="My Pinterest boards"><i class="icon icon-pinterest notranslate" aria-hidden="true"></i></a></li> <li><a itemprop="sameAs" href="https://angel.co/yegor256" rel="nofollow" title="My AngelList profile"><i class="icon icon-angellist notranslate" aria-hidden="true"></i></a></li> <li><a href="https://soundcloud.com/yegor256" rel="nofollow" title="My podcast"><i class="icon icon-podcast notranslate" aria-hidden="true"></i></a></li> <li><a href="https://itunes.apple.com/us/podcast/yegor256-podcast/id1150826721" rel="nofollow" title="My iTunes podcast"><i class="icon icon-itunes notranslate" aria-hidden="true"></i></a></li> <li><a href="https://t.me/joinchat/AAAAAEJFMRzsRTRxM3ec6A" rel="nofollow" title="My Telegram public channel"><i class="icon icon-telegram notranslate" aria-hidden="true"></i></a></li> <li><a href="mailto:blog@yegor256.com" rel="nofollow" title="Email me any time"><i class="icon icon-mail notranslate" aria-hidden="true"></i></a></li></ul><ul class="menu"> <li><a href="/" title="Home page">Home</a></li> <li ><a href="/best.html" title="Best articles to read">12&#160;Best</a></li> <li ><a href="/contents.html" title="The contents of the entire blog">All&#160;288</a></li> <li ><a href="/webinars.html" title="My webinars">Webinars</a></li> <li ><a href="/talks.html" title="Future and past conference talks">Talks</a></li> <li ><a href="/books.html" title="The books I wrote">Books</a></li> <li ><a href="/papers.html" title="My academic papers and patents">Papers</a></li> <li ><a href="/pets.html" title="My loved pet projects">Pets</a></li> <li ><a href="/award.html" title="Software quality award">Award</a></li> <li ><a href="/testimonials.html" title="What some people say about me">Testimonials</a></li> <li ><a href="/shift-m.html" title="Audio podcast about project management">Shift-M</a></li> <li ><a href="/paintings.html" title="My paintings for sale">Paintings</a></li> <li><a href="http://ru.yegor256.com/" title="Немного на русском языке">По-русски</a></li></ul></nav><div class="search"> <form method="get" action="https://www.google.com/search" itemprop="potentialAction" itemscope="" itemtype="http://schema.org/SearchAction"> <meta itemprop="target" content="https://www.google.com/search?q={q}"/> <input name="sitesearch" value="yegor256.com" type="hidden"/> <input itemprop="query-input" type="text" id="search-query" class="field field-text" required="required" onfocus="$('.google').css('visibility', 'visible');" name="q" placeholder="Search..." autocomplete="off"/> <input type="image" src="/images/google-search-icon.svg" class="google" title="Search via Google" alt="Search via Google"/> </form></div><div class="hot"><ul> <li> <a href="/code-ahead.html">Code Ahead</a> was published on Amazon just a few days ago! It is my new book, a novel about programmers. It explains in details the majority of ideas that stand behind <a href="https://www.zerocracy.com">Zerocracy</a> and <a href="https://www.xdsd.org">XDSD</a>. </li> <li> At <a href="/webinars.html">Webinar #37</a> we will discuss naming problem in OOP, for objects, methods and attributes; join us on <b>September 12</b>, at 11am PST. </li></ul></div></header></div><section itemscope="" itemtype="http://schema.org/BlogPosting"><div class="wrapper"> <header><p class="printable"> <img src="https://api.qrserver.com/v1/create-qr-code/?data=https://www.yegor256.com/2016/07/06/data-transfer-object.html&amp;format=svg" style="width:125px;height:125px;" alt="QR code"/></p><p class="printable"> <code itemprop="url">https://www.yegor256.com/2016/07/06/data-transfer-object.html</code></p><h1 itemprop="name headline mainEntityOfPage">Data Transfer Object Is a Shame</h1><ul class="subline"> <li> <time itemprop="datePublished" datetime="2016-07-06T00:00:00+00:00"> 6 July 2016 </time> </li> <li class="desktop-only" itemprop="locationCreated">Palo Alto, CA</li> <li class="printable" itemscope="" itemprop="author" itemtype="http://schema.org/Person"> <span itemprop="name">Yegor Bugayenko</span> </li> <li class="unprintable"> <i class="icon icon-comments"></i> <a href="http://www.yegor256.com/2016/07/06/data-transfer-object.html#disqus_thread" itemprop="discussionUrl">comments</a> </li></ul><p class="unprintable"><p><a href="https://en.wikipedia.org/wiki/Data_transfer_object">DTO</a>, as far as I understand it, is a cornerstone of the ORM design pattern, which I <a href="/2014/12/01/orm-offensive-anti-pattern.html">simply &quot;adore.&quot;</a> But let&#39;s skip to the point: DTO is just a shame, and the man who invented it is just wrong. There is no excuse for what he has done.</p><figure class='jb_picture'><img itemprop='image' alt='Before the Devil Knows You&#39;re Dead (2007) by Sidney Lumet' src='/images/2016/07/before-the-devil-knows-you-are-dead.jpg' longdesc='#5b0543dd'/><figcaption id='5b0543dd'>Before the Devil Knows You&#39;re Dead (2007) by Sidney Lumet</figcaption></figure><p>By the way, his name, to my knowledge, was <a href="http://martinfowler.com/bliki/LocalDTO.html">Martin Fowler</a>. Maybe he was not the sole inventor of DTO, but he made it legal and recommended its use. With all due respect, he was just wrong.</p><aside class='quote'>Objects must only have access to the data they encapsulate and never to the data encapsulated by other objects.</aside><p>The key idea of object-oriented programming is to hide data behind objects. This idea has a name: <a href="/2016/11/21/naked-data.html">encapsulation</a>. In OOP, data must not be visible. <a href="/2014/11/20/seven-virtues-of-good-object.html">Objects</a> must only have access to the data they encapsulate and never to the data encapsulated by other objects. There can be no arguing about this principle---it is what <a href="/2016/08/15/what-is-wrong-object-oriented-programming.html">OOP</a> is all about.</p><p>However, DTO runs completely against that principle.</p><p>Let&#39;s see a practical example. Say that this is a service that fetches a JSON document from some RESTful API and returns a DTO, which we can then store in the database:</p><figure class="highlight"><pre><code class="language-java" data-lang="java"><span></span><span class="n">Book</span> <span class="n">book</span> <span class="o">=</span> <span class="n">api</span><span class="o">.</span><span class="na">loadBookById</span><span class="o">(</span><span class="mi">123</span><span class="o">);</span>
<span class="n">database</span><span class="o">.</span><span class="na">saveNewBook</span><span class="o">(</span><span class="n">book</span><span class="o">);</span></code></pre></figure><p>I guess this is what will happen inside the <code>loadBookById()</code> method:</p><figure class="highlight"><pre><code class="language-java" data-lang="java"><span></span><span class="n">Book</span> <span class="nf">loadBookById</span><span class="o">(</span><span class="kt">int</span> <span class="n">id</span><span class="o">)</span> <span class="o">{</span>
  <span class="n">JsonObject</span> <span class="n">json</span> <span class="o">=</span> <span class="cm">/* Load it from RESTful API */</span>
  <span class="n">Book</span> <span class="n">book</span> <span class="o">=</span> <span class="k">new</span> <span class="n">Book</span><span class="o">();</span>
  <span class="n">book</span><span class="o">.</span><span class="na">setISBN</span><span class="o">(</span><span class="n">json</span><span class="o">.</span><span class="na">getString</span><span class="o">(</span><span class="s">&quot;isbn&quot;</span><span class="o">));</span>
  <span class="n">book</span><span class="o">.</span><span class="na">setTitle</span><span class="o">(</span><span class="n">json</span><span class="o">.</span><span class="na">getString</span><span class="o">(</span><span class="s">&quot;title&quot;</span><span class="o">));</span>
  <span class="n">book</span><span class="o">.</span><span class="na">setAuthor</span><span class="o">(</span><span class="n">json</span><span class="o">.</span><span class="na">getString</span><span class="o">(</span><span class="s">&quot;author&quot;</span><span class="o">));</span>
  <span class="k">return</span> <span class="n">book</span><span class="o">;</span>
<span class="o">}</span></code></pre></figure><p>Am I right? I bet I am. It already looks disgusting to me. Anyway, let&#39;s continue. This is what will most likely happen in the <code>saveNewBook()</code> method (I&#39;m using pure JDBC):</p><figure class="highlight"><pre><code class="language-java" data-lang="java"><span></span><span class="kt">void</span> <span class="nf">saveNewBook</span><span class="o">(</span><span class="n">Book</span> <span class="n">book</span><span class="o">)</span> <span class="o">{</span>
  <span class="n">Statement</span> <span class="n">stmt</span> <span class="o">=</span> <span class="n">connection</span><span class="o">.</span><span class="na">prepareStatement</span><span class="o">(</span>
    <span class="s">&quot;INSERT INTO book VALUES (?, ?, ?)&quot;</span>
  <span class="o">);</span>
  <span class="n">stmt</span><span class="o">.</span><span class="na">setString</span><span class="o">(</span><span class="mi">1</span><span class="o">,</span> <span class="n">book</span><span class="o">.</span><span class="na">getISBN</span><span class="o">());</span>
  <span class="n">stmt</span><span class="o">.</span><span class="na">setString</span><span class="o">(</span><span class="mi">2</span><span class="o">,</span> <span class="n">book</span><span class="o">.</span><span class="na">getTitle</span><span class="o">());</span>
  <span class="n">stmt</span><span class="o">.</span><span class="na">setString</span><span class="o">(</span><span class="mi">3</span><span class="o">,</span> <span class="n">book</span><span class="o">.</span><span class="na">getAuthor</span><span class="o">());</span>
  <span class="n">stmt</span><span class="o">.</span><span class="na">execute</span><span class="o">();</span>
<span class="o">}</span></code></pre></figure><p>This <code>Book</code> is a classic example of a data transfer object design pattern. All it does is transfer data between two pieces of code, two procedures. The object <code>book</code> is pretty dumb. All it knows how to do is ... nothing. It doesn&#39;t do anything. It is actually not an object at all but rather a passive and anemic data structure.</p><p>What is the right design? There are a few. For example, this one looks good to me:</p><figure class="highlight"><pre><code class="language-java" data-lang="java"><span></span><span class="n">Book</span> <span class="n">book</span> <span class="o">=</span> <span class="n">api</span><span class="o">.</span><span class="na">bookById</span><span class="o">(</span><span class="mi">123</span><span class="o">);</span>
<span class="n">book</span><span class="o">.</span><span class="na">save</span><span class="o">(</span><span class="n">database</span><span class="o">);</span></code></pre></figure><p>This is what happens in <code>bookById()</code>:</p><figure class="highlight"><pre><code class="language-java" data-lang="java"><span></span><span class="n">Book</span> <span class="nf">bookById</span><span class="o">(</span><span class="kt">int</span> <span class="n">id</span><span class="o">)</span> <span class="o">{</span>
  <span class="k">return</span> <span class="k">new</span> <span class="n">JsonBook</span><span class="o">(</span>
    <span class="cm">/* RESTful API access point */</span>
  <span class="o">);</span>
<span class="o">}</span></code></pre></figure><p>This is what happens in <code>Book.save()</code>:</p><figure class="highlight"><pre><code class="language-java" data-lang="java"><span></span><span class="kt">void</span> <span class="nf">save</span><span class="o">(</span><span class="n">Database</span> <span class="n">db</span><span class="o">)</span> <span class="o">{</span>
  <span class="n">JsonObject</span> <span class="n">json</span> <span class="o">=</span> <span class="cm">/* Load it from RESTful API */</span>
  <span class="n">db</span><span class="o">.</span><span class="na">createBook</span><span class="o">(</span>
    <span class="n">json</span><span class="o">.</span><span class="na">getString</span><span class="o">(</span><span class="s">&quot;isbn&quot;</span><span class="o">),</span>
    <span class="n">json</span><span class="o">.</span><span class="na">getString</span><span class="o">(</span><span class="s">&quot;title&quot;</span><span class="o">),</span>
    <span class="n">json</span><span class="o">.</span><span class="na">getString</span><span class="o">(</span><span class="s">&quot;author&quot;</span><span class="o">)</span>
  <span class="o">);</span>
<span class="o">}</span></code></pre></figure><p>What happens if there are many more parameters of the book in JSON that won&#39;t fit nicely as parameters into a single <code>createBook()</code> method? How about this:</p><figure class="highlight"><pre><code class="language-java" data-lang="java"><span></span><span class="kt">void</span> <span class="nf">save</span><span class="o">(</span><span class="n">Database</span> <span class="n">db</span><span class="o">)</span> <span class="o">{</span>
  <span class="n">db</span><span class="o">.</span><span class="na">create</span><span class="o">()</span>
    <span class="o">.</span><span class="na">withISBN</span><span class="o">(</span><span class="n">json</span><span class="o">.</span><span class="na">getString</span><span class="o">(</span><span class="s">&quot;isbn&quot;</span><span class="o">))</span>
    <span class="o">.</span><span class="na">withTitle</span><span class="o">(</span><span class="n">json</span><span class="o">.</span><span class="na">getString</span><span class="o">(</span><span class="s">&quot;title&quot;</span><span class="o">))</span>
    <span class="o">.</span><span class="na">withAuthor</span><span class="o">(</span><span class="n">json</span><span class="o">.</span><span class="na">getString</span><span class="o">(</span><span class="s">&quot;author&quot;</span><span class="o">))</span>
    <span class="o">.</span><span class="na">deploy</span><span class="o">();</span>
<span class="o">}</span></code></pre></figure><p>There are many other options. But the main point is that the data <strong>never</strong> escapes the object <code>book</code>. Once the object is instantiated, the data is not visible or accessible by anyone else. We may only ask our object to save itself or to <a href="/2016/04/05/printers-instead-of-getters.html">print</a> itself to some media, but we will never <a href="/2014/09/16/getters-and-setters-are-evil.html">get</a> any data from it.</p><p>The very idea of DTO is wrong because it turns object-oriented code into procedural code. We have procedures that manipulate data, and DTO is just a box for that data. Don&#39;t think that way, and don&#39;t do that.</p><p>PS. There are a few other names of DTO: <a href="https://en.wikipedia.org/wiki/Business_object">business objects</a>, domain objects (not in <a href="https://en.wikipedia.org/wiki/Domain-driven_design">DDD</a>), <a href="https://docs.oracle.com/cd/A97335_02/apps.102/bc4j/developing_bc_projects/bc_awhatisaneo.htm">entity objects</a>, <a href="https://en.wikipedia.org/wiki/JavaBeans">JavaBeans</a>.</p></p><nav class="buttons notranslate desktop-only"> <a href="http://www.facebook.com/sharer/sharer.php?u=https://www.yegor256.com/2016/07/06/data-transfer-object.html" title="Share on Facebook" class="button" rel="nofollow"> <span class="count count-facebook">0</span> <i class="icon icon-facebook notranslate" aria-hidden="true"></i> </a> <a href="https://twitter.com/share?url=https://www.yegor256.com/2016/07/06/data-transfer-object.html&amp;text=Data+Transfer+Object+Is+a+Shame" title="Share on Twitter" class="button" rel="nofollow"> <span class="count count-twitter">0</span> <i class="icon icon-twitter notranslate" aria-hidden="true"></i> </a> <a href="https://plus.google.com/share?url=https://www.yegor256.com/2016/07/06/data-transfer-object.html" title="Share on Google+" class="button" rel="nofollow"> <span class="count count-googleplus">0</span> <i class="icon icon-googleplus notranslate" aria-hidden="true"></i> </a> <a href="https://www.linkedin.com/cws/share?url=https://www.yegor256.com/2016/07/06/data-transfer-object.html" title="Share on LinkedIn" class="button" rel="nofollow"> <span class="count count-linkedin">0</span> <i class="icon icon-linkedin notranslate" aria-hidden="true"></i> </a> <a href="http://reddit.com/submit?url=https://www.yegor256.com/2016/07/06/data-transfer-object.html%3F2016-27&amp;title=Data+Transfer+Object+Is+a+Shame" title="Share on Reddit" class="button" rel="nofollow"> <span class="count count-reddit">0</span> <i class="icon icon-reddit notranslate" aria-hidden="true"></i> </a> <a href="http://news.ycombinator.com/submitlink?u=https://www.yegor256.com/2016/07/06/data-transfer-object.html%3F2016-27&amp;t=Data+Transfer+Object+Is+a+Shame" title="Share on Hacker News" class="button" rel="nofollow"> <span class="count count-hackernews">0</span> <i class="icon icon-hackernews notranslate" aria-hidden="true"></i> </a> </nav> </header> <article class="main" itemprop="articleBody"><div ><p><a href="https://en.wikipedia.org/wiki/Data_transfer_object">DTO</a>, as far as I understand it, is a cornerstone of the ORM design pattern, which I <a href="/2014/12/01/orm-offensive-anti-pattern.html">simply &quot;adore.&quot;</a> But let&#39;s skip to the point: DTO is just a shame, and the man who invented it is just wrong. There is no excuse for what he has done.</p><figure class='jb_picture'><img itemprop='image' alt='Before the Devil Knows You&#39;re Dead (2007) by Sidney Lumet' src='/images/2016/07/before-the-devil-knows-you-are-dead.jpg' longdesc='#5b0543dd'/><figcaption id='5b0543dd'>Before the Devil Knows You&#39;re Dead (2007) by Sidney Lumet</figcaption></figure><p>By the way, his name, to my knowledge, was <a href="http://martinfowler.com/bliki/LocalDTO.html">Martin Fowler</a>. Maybe he was not the sole inventor of DTO, but he made it legal and recommended its use. With all due respect, he was just wrong.</p><aside class='quote'>Objects must only have access to the data they encapsulate and never to the data encapsulated by other objects.</aside><p>The key idea of object-oriented programming is to hide data behind objects. This idea has a name: <a href="/2016/11/21/naked-data.html">encapsulation</a>. In OOP, data must not be visible. <a href="/2014/11/20/seven-virtues-of-good-object.html">Objects</a> must only have access to the data they encapsulate and never to the data encapsulated by other objects. There can be no arguing about this principle---it is what <a href="/2016/08/15/what-is-wrong-object-oriented-programming.html">OOP</a> is all about.</p><p>However, DTO runs completely against that principle.</p><p>Let&#39;s see a practical example. Say that this is a service that fetches a JSON document from some RESTful API and returns a DTO, which we can then store in the database:</p><figure class="highlight"><pre><code class="language-java" data-lang="java"><span></span><span class="n">Book</span> <span class="n">book</span> <span class="o">=</span> <span class="n">api</span><span class="o">.</span><span class="na">loadBookById</span><span class="o">(</span><span class="mi">123</span><span class="o">);</span>
<span class="n">database</span><span class="o">.</span><span class="na">saveNewBook</span><span class="o">(</span><span class="n">book</span><span class="o">);</span></code></pre></figure><p>I guess this is what will happen inside the <code>loadBookById()</code> method:</p><figure class="highlight"><pre><code class="language-java" data-lang="java"><span></span><span class="n">Book</span> <span class="nf">loadBookById</span><span class="o">(</span><span class="kt">int</span> <span class="n">id</span><span class="o">)</span> <span class="o">{</span>
  <span class="n">JsonObject</span> <span class="n">json</span> <span class="o">=</span> <span class="cm">/* Load it from RESTful API */</span>
  <span class="n">Book</span> <span class="n">book</span> <span class="o">=</span> <span class="k">new</span> <span class="n">Book</span><span class="o">();</span>
  <span class="n">book</span><span class="o">.</span><span class="na">setISBN</span><span class="o">(</span><span class="n">json</span><span class="o">.</span><span class="na">getString</span><span class="o">(</span><span class="s">&quot;isbn&quot;</span><span class="o">));</span>
  <span class="n">book</span><span class="o">.</span><span class="na">setTitle</span><span class="o">(</span><span class="n">json</span><span class="o">.</span><span class="na">getString</span><span class="o">(</span><span class="s">&quot;title&quot;</span><span class="o">));</span>
  <span class="n">book</span><span class="o">.</span><span class="na">setAuthor</span><span class="o">(</span><span class="n">json</span><span class="o">.</span><span class="na">getString</span><span class="o">(</span><span class="s">&quot;author&quot;</span><span class="o">));</span>
  <span class="k">return</span> <span class="n">book</span><span class="o">;</span>
<span class="o">}</span></code></pre></figure><p>Am I right? I bet I am. It already looks disgusting to me. Anyway, let&#39;s continue. This is what will most likely happen in the <code>saveNewBook()</code> method (I&#39;m using pure JDBC):</p><figure class="highlight"><pre><code class="language-java" data-lang="java"><span></span><span class="kt">void</span> <span class="nf">saveNewBook</span><span class="o">(</span><span class="n">Book</span> <span class="n">book</span><span class="o">)</span> <span class="o">{</span>
  <span class="n">Statement</span> <span class="n">stmt</span> <span class="o">=</span> <span class="n">connection</span><span class="o">.</span><span class="na">prepareStatement</span><span class="o">(</span>
    <span class="s">&quot;INSERT INTO book VALUES (?, ?, ?)&quot;</span>
  <span class="o">);</span>
  <span class="n">stmt</span><span class="o">.</span><span class="na">setString</span><span class="o">(</span><span class="mi">1</span><span class="o">,</span> <span class="n">book</span><span class="o">.</span><span class="na">getISBN</span><span class="o">());</span>
  <span class="n">stmt</span><span class="o">.</span><span class="na">setString</span><span class="o">(</span><span class="mi">2</span><span class="o">,</span> <span class="n">book</span><span class="o">.</span><span class="na">getTitle</span><span class="o">());</span>
  <span class="n">stmt</span><span class="o">.</span><span class="na">setString</span><span class="o">(</span><span class="mi">3</span><span class="o">,</span> <span class="n">book</span><span class="o">.</span><span class="na">getAuthor</span><span class="o">());</span>
  <span class="n">stmt</span><span class="o">.</span><span class="na">execute</span><span class="o">();</span>
<span class="o">}</span></code></pre></figure><p>This <code>Book</code> is a classic example of a data transfer object design pattern. All it does is transfer data between two pieces of code, two procedures. The object <code>book</code> is pretty dumb. All it knows how to do is ... nothing. It doesn&#39;t do anything. It is actually not an object at all but rather a passive and anemic data structure.</p><p>What is the right design? There are a few. For example, this one looks good to me:</p><figure class="highlight"><pre><code class="language-java" data-lang="java"><span></span><span class="n">Book</span> <span class="n">book</span> <span class="o">=</span> <span class="n">api</span><span class="o">.</span><span class="na">bookById</span><span class="o">(</span><span class="mi">123</span><span class="o">);</span>
<span class="n">book</span><span class="o">.</span><span class="na">save</span><span class="o">(</span><span class="n">database</span><span class="o">);</span></code></pre></figure><p>This is what happens in <code>bookById()</code>:</p><figure class="highlight"><pre><code class="language-java" data-lang="java"><span></span><span class="n">Book</span> <span class="nf">bookById</span><span class="o">(</span><span class="kt">int</span> <span class="n">id</span><span class="o">)</span> <span class="o">{</span>
  <span class="k">return</span> <span class="k">new</span> <span class="n">JsonBook</span><span class="o">(</span>
    <span class="cm">/* RESTful API access point */</span>
  <span class="o">);</span>
<span class="o">}</span></code></pre></figure><p>This is what happens in <code>Book.save()</code>:</p><figure class="highlight"><pre><code class="language-java" data-lang="java"><span></span><span class="kt">void</span> <span class="nf">save</span><span class="o">(</span><span class="n">Database</span> <span class="n">db</span><span class="o">)</span> <span class="o">{</span>
  <span class="n">JsonObject</span> <span class="n">json</span> <span class="o">=</span> <span class="cm">/* Load it from RESTful API */</span>
  <span class="n">db</span><span class="o">.</span><span class="na">createBook</span><span class="o">(</span>
    <span class="n">json</span><span class="o">.</span><span class="na">getString</span><span class="o">(</span><span class="s">&quot;isbn&quot;</span><span class="o">),</span>
    <span class="n">json</span><span class="o">.</span><span class="na">getString</span><span class="o">(</span><span class="s">&quot;title&quot;</span><span class="o">),</span>
    <span class="n">json</span><span class="o">.</span><span class="na">getString</span><span class="o">(</span><span class="s">&quot;author&quot;</span><span class="o">)</span>
  <span class="o">);</span>
<span class="o">}</span></code></pre></figure><p>What happens if there are many more parameters of the book in JSON that won&#39;t fit nicely as parameters into a single <code>createBook()</code> method? How about this:</p><figure class="highlight"><pre><code class="language-java" data-lang="java"><span></span><span class="kt">void</span> <span class="nf">save</span><span class="o">(</span><span class="n">Database</span> <span class="n">db</span><span class="o">)</span> <span class="o">{</span>
  <span class="n">db</span><span class="o">.</span><span class="na">create</span><span class="o">()</span>
    <span class="o">.</span><span class="na">withISBN</span><span class="o">(</span><span class="n">json</span><span class="o">.</span><span class="na">getString</span><span class="o">(</span><span class="s">&quot;isbn&quot;</span><span class="o">))</span>
    <span class="o">.</span><span class="na">withTitle</span><span class="o">(</span><span class="n">json</span><span class="o">.</span><span class="na">getString</span><span class="o">(</span><span class="s">&quot;title&quot;</span><span class="o">))</span>
    <span class="o">.</span><span class="na">withAuthor</span><span class="o">(</span><span class="n">json</span><span class="o">.</span><span class="na">getString</span><span class="o">(</span><span class="s">&quot;author&quot;</span><span class="o">))</span>
    <span class="o">.</span><span class="na">deploy</span><span class="o">();</span>
<span class="o">}</span></code></pre></figure><p>There are many other options. But the main point is that the data <strong>never</strong> escapes the object <code>book</code>. Once the object is instantiated, the data is not visible or accessible by anyone else. We may only ask our object to save itself or to <a href="/2016/04/05/printers-instead-of-getters.html">print</a> itself to some media, but we will never <a href="/2014/09/16/getters-and-setters-are-evil.html">get</a> any data from it.</p><p>The very idea of DTO is wrong because it turns object-oriented code into procedural code. We have procedures that manipulate data, and DTO is just a box for that data. Don&#39;t think that way, and don&#39;t do that.</p><p>PS. There are a few other names of DTO: <a href="https://en.wikipedia.org/wiki/Business_object">business objects</a>, domain objects (not in <a href="https://en.wikipedia.org/wiki/Domain-driven_design">DDD</a>), <a href="https://docs.oracle.com/cd/A97335_02/apps.102/bc4j/developing_bc_projects/bc_awhatisaneo.htm">entity objects</a>, <a href="https://en.wikipedia.org/wiki/JavaBeans">JavaBeans</a>.</p></div></article></div><div class="wrapper"> <related-posts /></div><div class="disqus" role="complementary"><p class="disqus_hint"> Please, use <a href="https://help.disqus.com/commenting/what-html-tags-are-allowed-within-comments">syntax highlighting</a> in your comments, to make them more readable.</p><div id="disqus_thread" class="disqus-thread"> <a>&nbsp;</a></div><script> var disqus_config = function () { this.page.url = document.location.href.split('?')[0].split('#')[0].replace('https://', 'http://'); this.page.identifier = this.page.url; }; (function() { var d = document, s = d.createElement('script'); s.src = '//yegor256.disqus.com/embed.js'; s.setAttribute('data-timestamp', +new Date()); (d.head || d.body).appendChild(s); })(); </script> <noscript><div><p class="red"> JavaScript is disabled in your browser, that's why you can't see comments under this post.</p></div></noscript></div><div class="wrapper"> <footer class="footer"><p> &copy; <span itemscope="" itemprop="copyrightHolder" itemtype="http://schema.org/Person"> <span itemprop="name">Yegor Bugayenko</span> </span> 2014&ndash;<span itemprop="copyrightYear">2018</span></p></footer></div></section><div class="wrapper unprintable" style="text-align:center;margin-top:2em;"> <a href="http://www.sixnines.io/h/3ba1652f"> <img src="//www.sixnines.io/b/3ba1652f?style=flat" alt="sixnines availability badge"/> </a></div><script src="//code.jquery.com/jquery-1.9.0.min.js"></script> <script src="/js/all.js?a0e0d018c07"></script> <script>var disqus_shortname = 'yegor256';</script> <script id="dsq-count-scr" src="//yegor256.disqus.com/count.js" async="async"></script> <script> (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){ (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o), m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m) })(window,document,'script','//www.google-analytics.com/analytics.js','ga'); ga('create', 'UA-1963507-32', 'auto'); ga('send', 'pageview'); </script> <script> Cd=document;Cr="&"+Math.random();Cp="&s=1"; Cd.cookie="b=b";if(Cd.cookie)Cp+="&c=1"; Cp+="&t="+(new Date()).getTimezoneOffset(); if(self!=top)Cp+="&f=1"; </script> <script> if(navigator.javaEnabled())Cp+="&j=1"; </script> <script> if(typeof(screen)!='undefined')Cp+="&w="+screen.width+"&h="+ screen.height+"&d="+(screen.colorDepth?screen.colorDepth:screen.pixelDepth); </script> <script> Cd.write("<img src='//c.hit.ua/hit?i=95870&g=0&x=2"+Cp+Cr+ "&r="+escape(Cd.referrer)+"&u="+escape(window.location.href)+ "' border='0' wi"+"dth='1' he"+"ight='1'/>"); </script> <script type="application/ld+json"> { "@context": "http://schema.org", "@type": "Person", "name": "Yegor Bugayenko", "url": "http://www.yegor256.com", "sameAs": [ "https://www.facebook.com/yegor256", "https://instagram.com/yegor256", "https://www.linkedin.com/in/yegor256", "https://twitter.com/yegor256", "https://github.com/yegor256", "https://www.pinterest.com/yegor256/" ] } </script> </body> </html> <!DOCTYPE html> <html xmlns="http://www.w3.org/1999/xhtml" lang="en-US" xml:lang="en-US" itemscope="" itemtype="http://schema.org/WebSite"> <head> <meta charset="utf-8"/> <meta name="description" content="A singleton is a well-known anti-pattern; however, it&apos;s often not clear what could be used instead, to access global things. " /> <meta name="keywords" content="singleton, singleton anti-pattern, singleton is bad, singleton java, singleton replacement" /> <meta name="viewport" content="width=device-width,minimum-scale=1,initial-scale=1"/> <meta name="google-site-verification" content="JEj_gQr2CPe2QKGw8XdMz0R7VboQIUbX3FlM-lwTq-8" /> <meta name="author" content="Yegor Bugayenko"> <meta name="article:published_time" content="2016-06-27 00:00:00 +0000"> <meta name="og:site_name" content="Yegor Bugayenko"/> <meta name="og:type" content="article" /> <meta name="og:locale" content="en_US" /> <meta name="twitter:account_id" content="4503599630178231" /> <meta name="twitter:creator" content="@yegor256"/> <meta name="twitter:site" content="@yegor256"/> <meta name="twitter:title" property="og:title" content="Singletons Must Die"/> <meta name="twitter:description" property="og:description" content="A singleton is a well-known anti-pattern; however, it&apos;s often not clear what could be used instead, to access global things. "/> <meta name="twitter:url" property="og:url" content="https://www.yegor256.com/2016/06/27/singletons-must-die.html"/> <meta name="telegram:channel" content="AAAAAEJFMRzsRTRxM3ec6A"/> <link rel="search" type="application/opensearchdescription+xml" href="/opensearch.xml" title="yegor256" /> <link rel="shortcut icon" href="/favicon.ico?a0e0d018c07"/> <link rel="apple-touch-icon" href="/favicon.ico?a0e0d018c07"/> <link rel="alternate" type="application/rss+xml" title="RSS for yegor256.com" href="https://www.yegor256.com/rss.xml"/> <link rel="stylesheet" href="/css/layout.css?a0e0d018c07"/> <link rel="stylesheet" href="/css/icons.css?a0e0d018c07"/> <link rel="canonical" href="https://www.yegor256.com/2016/06/27/singletons-must-die.html" /> <link rel="amphtml" href="https://www.yegor256.com/2016/06/27/singletons-must-die.amp.html" /> <title>Singletons Must Die </title> <meta name='og:image' content='https://www.yegor256.com/images/2016/06/perdita-durango.jpg'/><meta name='twitter:image' content='https://www.yegor256.com/images/2016/06/perdita-durango.jpg'/><meta name='og:image:width' content='1200'/> <meta name='twitter:image:width' content='1200'/><meta name='og:image:height' content='721'/> <meta name='twitter:image:height' content='721'/><meta name='twitter:card' content='summary_large_image'/><meta name='twitter:image:alt' content='Perdita Durango (1997) by Álex de la Iglesia'/> </head> <body><div class="wrapper"> <aside class="header-toggle unprintable" id="header-toggle" title="Show the menu" onclick="$('#header').show();$('#header-toggle').hide();">&#9776;</aside> <header class="header" id="header"><div class="face"> <a href="/about-me.html#form" class="sub" title="Click to subscribe to my monthly newsletter"><span>Subscribe</span></a> <a href="/about-me.html" style="position:relative;"> <img src="/images/face-256x256.jpg" class="photo" alt="Yegor Bugayenko"/> </a></div><nav><ul class="menu social notranslate"> <li><a href="https://twitter.com/intent/follow?screen_name=yegor256" rel="nofollow" title="Follow me on Twitter"><i class="icon icon-twitter notranslate" aria-hidden="true"></i></a></li> <li><a href="/rss.xml" rel="nofollow" title="Subscribe to my RSS feed"><i class="icon icon-rss notranslate" aria-hidden="true"></i></a></li> <li><a itemprop="sameAs" href="https://github.com/yegor256" rel="nofollow" title="My GitHub profile"><i class="icon icon-github notranslate" aria-hidden="true"></i></a></li> <li><a itemprop="sameAs" href="http://stackoverflow.com/users/187141/yegor256" rel="nofollow" title="My StackOverflow profile"><i class="icon icon-stackoverflow notranslate" aria-hidden="true"></i></a></li> <li><a itemprop="sameAs" href="https://www.facebook.com/yegor256" rel="nofollow" title="Follow me on Facebook"><i class="icon icon-facebook notranslate" aria-hidden="true"></i></a></li> <li><a itemprop="sameAs" href="https://instagram.com/yegor256" rel="nofollow" title="Follow me on Instagram"><i class="icon icon-instagram notranslate" aria-hidden="true"></i></a></li> <li><a itemprop="sameAs" href="https://www.linkedin.com/in/yegor256" rel="nofollow" title="My LinkedIn profile"><i class="icon icon-linkedin notranslate" aria-hidden="true"></i></a></li> <li><a itemprop="sameAs" href="https://www.youtube.com/c/yegor256?sub_confirmation=1" rel="nofollow" title="My Youtube video channel"><i class="icon icon-youtube notranslate" aria-hidden="true"></i></a></li> <li><a itemprop="sameAs" href="https://www.pinterest.com/yegor256/" rel="nofollow" title="My Pinterest boards"><i class="icon icon-pinterest notranslate" aria-hidden="true"></i></a></li> <li><a itemprop="sameAs" href="https://angel.co/yegor256" rel="nofollow" title="My AngelList profile"><i class="icon icon-angellist notranslate" aria-hidden="true"></i></a></li> <li><a href="https://soundcloud.com/yegor256" rel="nofollow" title="My podcast"><i class="icon icon-podcast notranslate" aria-hidden="true"></i></a></li> <li><a href="https://itunes.apple.com/us/podcast/yegor256-podcast/id1150826721" rel="nofollow" title="My iTunes podcast"><i class="icon icon-itunes notranslate" aria-hidden="true"></i></a></li> <li><a href="https://t.me/joinchat/AAAAAEJFMRzsRTRxM3ec6A" rel="nofollow" title="My Telegram public channel"><i class="icon icon-telegram notranslate" aria-hidden="true"></i></a></li> <li><a href="mailto:blog@yegor256.com" rel="nofollow" title="Email me any time"><i class="icon icon-mail notranslate" aria-hidden="true"></i></a></li></ul><ul class="menu"> <li><a href="/" title="Home page">Home</a></li> <li ><a href="/best.html" title="Best articles to read">12&#160;Best</a></li> <li ><a href="/contents.html" title="The contents of the entire blog">All&#160;288</a></li> <li ><a href="/webinars.html" title="My webinars">Webinars</a></li> <li ><a href="/talks.html" title="Future and past conference talks">Talks</a></li> <li ><a href="/books.html" title="The books I wrote">Books</a></li> <li ><a href="/papers.html" title="My academic papers and patents">Papers</a></li> <li ><a href="/pets.html" title="My loved pet projects">Pets</a></li> <li ><a href="/award.html" title="Software quality award">Award</a></li> <li ><a href="/testimonials.html" title="What some people say about me">Testimonials</a></li> <li ><a href="/shift-m.html" title="Audio podcast about project management">Shift-M</a></li> <li ><a href="/paintings.html" title="My paintings for sale">Paintings</a></li> <li><a href="http://ru.yegor256.com/" title="Немного на русском языке">По-русски</a></li></ul></nav><div class="search"> <form method="get" action="https://www.google.com/search" itemprop="potentialAction" itemscope="" itemtype="http://schema.org/SearchAction"> <meta itemprop="target" content="https://www.google.com/search?q={q}"/> <input name="sitesearch" value="yegor256.com" type="hidden"/> <input itemprop="query-input" type="text" id="search-query" class="field field-text" required="required" onfocus="$('.google').css('visibility', 'visible');" name="q" placeholder="Search..." autocomplete="off"/> <input type="image" src="/images/google-search-icon.svg" class="google" title="Search via Google" alt="Search via Google"/> </form></div><div class="hot"><ul> <li> <a href="/code-ahead.html">Code Ahead</a> was published on Amazon just a few days ago! It is my new book, a novel about programmers. It explains in details the majority of ideas that stand behind <a href="https://www.zerocracy.com">Zerocracy</a> and <a href="https://www.xdsd.org">XDSD</a>. </li> <li> At <a href="/webinars.html">Webinar #37</a> we will discuss naming problem in OOP, for objects, methods and attributes; join us on <b>September 12</b>, at 11am PST. </li></ul></div></header></div><section itemscope="" itemtype="http://schema.org/BlogPosting"><div class="wrapper"> <header><p class="printable"> <img src="https://api.qrserver.com/v1/create-qr-code/?data=https://www.yegor256.com/2016/06/27/singletons-must-die.html&amp;format=svg" style="width:125px;height:125px;" alt="QR code"/></p><p class="printable"> <code itemprop="url">https://www.yegor256.com/2016/06/27/singletons-must-die.html</code></p><h1 itemprop="name headline mainEntityOfPage">Singletons Must Die</h1><ul class="subline"> <li> <time itemprop="datePublished" datetime="2016-06-27T00:00:00+00:00"> 27 June 2016 </time> </li> <li class="desktop-only" itemprop="locationCreated">Los Angeles, CA</li> <li class="printable" itemscope="" itemprop="author" itemtype="http://schema.org/Person"> <span itemprop="name">Yegor Bugayenko</span> </li> <li class="unprintable"> <i class="icon icon-comments"></i> <a href="http://www.yegor256.com/2016/06/27/singletons-must-die.html#disqus_thread" itemprop="discussionUrl">comments</a> </li></ul><ul class="subline"> <li>Discussed at:</li> <li><a href="https://dzone.com/articles/singletons-must-die">dzone</a></li></ul><p class="unprintable"><p>I think it&#39;s too obvious to say that a singleton is an anti-pattern as there are tons of articles about that (singleton being an anti-pattern). However, more often than not, the question is how to define global things without a singleton; and the answer to that is not obvious for many of us. There are several examples: a database connection pool, a repository, a configuration map, etc. They all naturally seem to be &quot;global&quot;; but what do we do with them?</p><figure class='jb_picture'><img itemprop='image' alt='Perdita Durango (1997) by Álex de la Iglesia' src='/images/2016/06/perdita-durango.jpg' longdesc='#d4ffd517'/><figcaption id='d4ffd517'>Perdita Durango (1997) by Álex de la Iglesia</figcaption></figure><p>I assume you already know what a singleton is and why it&#39;s an anti-pattern. If not, I recommend you read this StackOverflow thread: <a href="http://stackoverflow.com/questions/137975/what-is-so-bad-about-singletons">What is so bad about singletons?</a></p><p>Now that we agree it&#39;s a bad deal, what do we do if we need to, let&#39;s say, have access to a database connection pool in many different places within the application? We simply need something like this:</p><figure class="highlight"><pre><code class="language-java" data-lang="java"><span></span><span class="kd">class</span> <span class="nc">Database</span> <span class="o">{</span>
  <span class="kd">public</span> <span class="kd">static</span> <span class="n">Database</span> <span class="n">INSTANCE</span> <span class="o">=</span> <span class="k">new</span> <span class="n">Database</span><span class="o">();</span>
  <span class="kd">private</span> <span class="nf">Database</span><span class="o">()</span> <span class="o">{</span>
    <span class="c1">// create a connection pool</span>
  <span class="o">}</span>
  <span class="kd">public</span> <span class="n">java</span><span class="o">.</span><span class="na">sql</span><span class="o">.</span><span class="na">Connection</span> <span class="nf">connect</span><span class="o">()</span> <span class="o">{</span>
    <span class="c1">// Get new connection from the pool</span>
    <span class="c1">// and return</span>
  <span class="o">}</span>
<span class="o">}</span></code></pre></figure><p>Later in at, say, the JAX-RS REST method, we need to retrieve something from the database:</p><figure class="highlight"><pre><code class="language-java" data-lang="java"><span></span><span class="nd">@Path</span><span class="o">(</span><span class="s">&quot;/&quot;</span><span class="o">)</span>
<span class="kd">class</span> <span class="nc">Index</span> <span class="o">{</span>
  <span class="nd">@GET</span>
  <span class="kd">public</span> <span class="n">String</span> <span class="nf">text</span><span class="o">()</span> <span class="o">{</span>
    <span class="n">java</span><span class="o">.</span><span class="na">sql</span><span class="o">.</span><span class="na">Connection</span> <span class="n">connection</span> <span class="o">=</span>
      <span class="n">Database</span><span class="o">.</span><span class="na">INSTANCE</span><span class="o">.</span><span class="na">connect</span><span class="o">();</span>
    <span class="k">return</span> <span class="k">new</span> <span class="n">JdbcSession</span><span class="o">(</span><span class="n">connection</span><span class="o">)</span>
      <span class="o">.</span><span class="na">sql</span><span class="o">(</span><span class="s">&quot;SELECT text FROM table&quot;</span><span class="o">)</span>
      <span class="o">.</span><span class="na">fetch</span><span class="o">(</span><span class="k">new</span> <span class="n">SingleOutcome</span><span class="o">(</span><span class="n">String</span><span class="o">.</span><span class="na">class</span><span class="o">))</span>
  <span class="o">}</span>
<span class="o">}</span></code></pre></figure><p>In case you&#39;re not familiar with JAX-RS, it&#39;s a simple <a href="/2016/12/13/mvc-vs-oop.html">MVC</a> architecture, and this <code>text()</code> method is a &quot;controller.&quot; Additionally, I&#39;m using <a href="http://jdbc.jcabi.com/apidocs-0.16/com/jcabi/jdbc/JdbcSession.html"><code>JdbcSession</code></a>, a simple JDBC wrapper from <a href="http://jdbc.jcabi.com">jcabi-jdbc</a>.</p><p>We need that <code>Database.INSTANCE</code> to be a singleton, right? We need it to be globally available so that <em>any</em> MVC controller can have direct access to it. Since we all understand and agree that a singleton is an evil thing, what do we replace it with?</p><p>A <a href="/2014/10/03/di-containers-are-evil.html">dependency injection</a> is the answer.</p><aside class='quote'>Forget about singletons; never use them; turn them into dependencies</aside><p>We need to make this database connection pool dependency of the controller and ensure it&#39;s provided through a constructor. However, in this particular case, for JAX-RS, we can&#39;t do it through a constructor thanks to its ugly architecture. But we can create a <a href="https://docs.oracle.com/javaee/7/api/javax/servlet/ServletContextListener.html"><code>ServletContextListener</code></a>, instantiate a <code>Database</code> in its <a href="https://docs.oracle.com/javaee/7/api/javax/servlet/ServletContextListener.html#contextInitialized-javax.servlet.ServletContextEvent-"><code>contextInitialized()</code></a> method, and add that instance as an attribute of <a href="https://docs.oracle.com/javaee/7/api/javax/servlet/ServletContext.html"><code>servletContext</code></a>. Then, inside the controller, we retrieve the servlet context by adding the <a href="http://docs.oracle.com/javaee/7/api/javax/ws/rs/core/Context.html"><code>javax.ws.rs.core.Context</code></a> annotation to a setter and using <a href="https://docs.oracle.com/javaee/7/api/javax/servlet/ServletContext.html#getAttribute-java.lang.String-"><code>getAttribute()</code></a> on it. This is absolutely terrible and procedural, but it&#39;s better than a singleton.</p><p>A proper object-oriented design would pass an instance of <code>Database</code> to <em>all</em> objects that may need it through their constructors.</p><p>Nonetheless, what do we do if there are many dependencies? Do we make a 10-argument constructor? No, we don&#39;t. If our objects really need 10 dependencies to do their work, we need to break them down into smaller ones.</p><p>That&#39;s it. Forget about singletons; never use them. Turn them into dependencies and pass them from object to object through the operator <code>new</code>.</p></p><nav class="buttons notranslate desktop-only"> <a href="http://www.facebook.com/sharer/sharer.php?u=https://www.yegor256.com/2016/06/27/singletons-must-die.html" title="Share on Facebook" class="button" rel="nofollow"> <span class="count count-facebook">0</span> <i class="icon icon-facebook notranslate" aria-hidden="true"></i> </a> <a href="https://twitter.com/share?url=https://www.yegor256.com/2016/06/27/singletons-must-die.html&amp;text=Singletons+Must+Die" title="Share on Twitter" class="button" rel="nofollow"> <span class="count count-twitter">0</span> <i class="icon icon-twitter notranslate" aria-hidden="true"></i> </a> <a href="https://plus.google.com/share?url=https://www.yegor256.com/2016/06/27/singletons-must-die.html" title="Share on Google+" class="button" rel="nofollow"> <span class="count count-googleplus">0</span> <i class="icon icon-googleplus notranslate" aria-hidden="true"></i> </a> <a href="https://www.linkedin.com/cws/share?url=https://www.yegor256.com/2016/06/27/singletons-must-die.html" title="Share on LinkedIn" class="button" rel="nofollow"> <span class="count count-linkedin">0</span> <i class="icon icon-linkedin notranslate" aria-hidden="true"></i> </a> <a href="http://reddit.com/submit?url=https://www.yegor256.com/2016/06/27/singletons-must-die.html%3F2016-26&amp;title=Singletons+Must+Die" title="Share on Reddit" class="button" rel="nofollow"> <span class="count count-reddit">0</span> <i class="icon icon-reddit notranslate" aria-hidden="true"></i> </a> <a href="http://news.ycombinator.com/submitlink?u=https://www.yegor256.com/2016/06/27/singletons-must-die.html%3F2016-26&amp;t=Singletons+Must+Die" title="Share on Hacker News" class="button" rel="nofollow"> <span class="count count-hackernews">0</span> <i class="icon icon-hackernews notranslate" aria-hidden="true"></i> </a> </nav> </header> <article class="main" itemprop="articleBody"><div ><p>I think it&#39;s too obvious to say that a singleton is an anti-pattern as there are tons of articles about that (singleton being an anti-pattern). However, more often than not, the question is how to define global things without a singleton; and the answer to that is not obvious for many of us. There are several examples: a database connection pool, a repository, a configuration map, etc. They all naturally seem to be &quot;global&quot;; but what do we do with them?</p><figure class='jb_picture'><img itemprop='image' alt='Perdita Durango (1997) by Álex de la Iglesia' src='/images/2016/06/perdita-durango.jpg' longdesc='#d4ffd517'/><figcaption id='d4ffd517'>Perdita Durango (1997) by Álex de la Iglesia</figcaption></figure><p>I assume you already know what a singleton is and why it&#39;s an anti-pattern. If not, I recommend you read this StackOverflow thread: <a href="http://stackoverflow.com/questions/137975/what-is-so-bad-about-singletons">What is so bad about singletons?</a></p><p>Now that we agree it&#39;s a bad deal, what do we do if we need to, let&#39;s say, have access to a database connection pool in many different places within the application? We simply need something like this:</p><figure class="highlight"><pre><code class="language-java" data-lang="java"><span></span><span class="kd">class</span> <span class="nc">Database</span> <span class="o">{</span>
  <span class="kd">public</span> <span class="kd">static</span> <span class="n">Database</span> <span class="n">INSTANCE</span> <span class="o">=</span> <span class="k">new</span> <span class="n">Database</span><span class="o">();</span>
  <span class="kd">private</span> <span class="nf">Database</span><span class="o">()</span> <span class="o">{</span>
    <span class="c1">// create a connection pool</span>
  <span class="o">}</span>
  <span class="kd">public</span> <span class="n">java</span><span class="o">.</span><span class="na">sql</span><span class="o">.</span><span class="na">Connection</span> <span class="nf">connect</span><span class="o">()</span> <span class="o">{</span>
    <span class="c1">// Get new connection from the pool</span>
    <span class="c1">// and return</span>
  <span class="o">}</span>
<span class="o">}</span></code></pre></figure><p>Later in at, say, the JAX-RS REST method, we need to retrieve something from the database:</p><figure class="highlight"><pre><code class="language-java" data-lang="java"><span></span><span class="nd">@Path</span><span class="o">(</span><span class="s">&quot;/&quot;</span><span class="o">)</span>
<span class="kd">class</span> <span class="nc">Index</span> <span class="o">{</span>
  <span class="nd">@GET</span>
  <span class="kd">public</span> <span class="n">String</span> <span class="nf">text</span><span class="o">()</span> <span class="o">{</span>
    <span class="n">java</span><span class="o">.</span><span class="na">sql</span><span class="o">.</span><span class="na">Connection</span> <span class="n">connection</span> <span class="o">=</span>
      <span class="n">Database</span><span class="o">.</span><span class="na">INSTANCE</span><span class="o">.</span><span class="na">connect</span><span class="o">();</span>
    <span class="k">return</span> <span class="k">new</span> <span class="n">JdbcSession</span><span class="o">(</span><span class="n">connection</span><span class="o">)</span>
      <span class="o">.</span><span class="na">sql</span><span class="o">(</span><span class="s">&quot;SELECT text FROM table&quot;</span><span class="o">)</span>
      <span class="o">.</span><span class="na">fetch</span><span class="o">(</span><span class="k">new</span> <span class="n">SingleOutcome</span><span class="o">(</span><span class="n">String</span><span class="o">.</span><span class="na">class</span><span class="o">))</span>
  <span class="o">}</span>
<span class="o">}</span></code></pre></figure><p>In case you&#39;re not familiar with JAX-RS, it&#39;s a simple <a href="/2016/12/13/mvc-vs-oop.html">MVC</a> architecture, and this <code>text()</code> method is a &quot;controller.&quot; Additionally, I&#39;m using <a href="http://jdbc.jcabi.com/apidocs-0.16/com/jcabi/jdbc/JdbcSession.html"><code>JdbcSession</code></a>, a simple JDBC wrapper from <a href="http://jdbc.jcabi.com">jcabi-jdbc</a>.</p><p>We need that <code>Database.INSTANCE</code> to be a singleton, right? We need it to be globally available so that <em>any</em> MVC controller can have direct access to it. Since we all understand and agree that a singleton is an evil thing, what do we replace it with?</p><p>A <a href="/2014/10/03/di-containers-are-evil.html">dependency injection</a> is the answer.</p><aside class='quote'>Forget about singletons; never use them; turn them into dependencies</aside><p>We need to make this database connection pool dependency of the controller and ensure it&#39;s provided through a constructor. However, in this particular case, for JAX-RS, we can&#39;t do it through a constructor thanks to its ugly architecture. But we can create a <a href="https://docs.oracle.com/javaee/7/api/javax/servlet/ServletContextListener.html"><code>ServletContextListener</code></a>, instantiate a <code>Database</code> in its <a href="https://docs.oracle.com/javaee/7/api/javax/servlet/ServletContextListener.html#contextInitialized-javax.servlet.ServletContextEvent-"><code>contextInitialized()</code></a> method, and add that instance as an attribute of <a href="https://docs.oracle.com/javaee/7/api/javax/servlet/ServletContext.html"><code>servletContext</code></a>. Then, inside the controller, we retrieve the servlet context by adding the <a href="http://docs.oracle.com/javaee/7/api/javax/ws/rs/core/Context.html"><code>javax.ws.rs.core.Context</code></a> annotation to a setter and using <a href="https://docs.oracle.com/javaee/7/api/javax/servlet/ServletContext.html#getAttribute-java.lang.String-"><code>getAttribute()</code></a> on it. This is absolutely terrible and procedural, but it&#39;s better than a singleton.</p><p>A proper object-oriented design would pass an instance of <code>Database</code> to <em>all</em> objects that may need it through their constructors.</p><p>Nonetheless, what do we do if there are many dependencies? Do we make a 10-argument constructor? No, we don&#39;t. If our objects really need 10 dependencies to do their work, we need to break them down into smaller ones.</p><p>That&#39;s it. Forget about singletons; never use them. Turn them into dependencies and pass them from object to object through the operator <code>new</code>.</p></div></article></div><div class="wrapper"> <related-posts /></div><div class="disqus" role="complementary"><p class="disqus_hint"> Please, use <a href="https://help.disqus.com/commenting/what-html-tags-are-allowed-within-comments">syntax highlighting</a> in your comments, to make them more readable.</p><div id="disqus_thread" class="disqus-thread"> <a>&nbsp;</a></div><script> var disqus_config = function () { this.page.url = document.location.href.split('?')[0].split('#')[0].replace('https://', 'http://'); this.page.identifier = this.page.url; }; (function() { var d = document, s = d.createElement('script'); s.src = '//yegor256.disqus.com/embed.js'; s.setAttribute('data-timestamp', +new Date()); (d.head || d.body).appendChild(s); })(); </script> <noscript><div><p class="red"> JavaScript is disabled in your browser, that's why you can't see comments under this post.</p></div></noscript></div><div class="wrapper"> <footer class="footer"><p> &copy; <span itemscope="" itemprop="copyrightHolder" itemtype="http://schema.org/Person"> <span itemprop="name">Yegor Bugayenko</span> </span> 2014&ndash;<span itemprop="copyrightYear">2018</span></p></footer></div></section><div class="wrapper unprintable" style="text-align:center;margin-top:2em;"> <a href="http://www.sixnines.io/h/3ba1652f"> <img src="//www.sixnines.io/b/3ba1652f?style=flat" alt="sixnines availability badge"/> </a></div><script src="//code.jquery.com/jquery-1.9.0.min.js"></script> <script src="/js/all.js?a0e0d018c07"></script> <script>var disqus_shortname = 'yegor256';</script> <script id="dsq-count-scr" src="//yegor256.disqus.com/count.js" async="async"></script> <script> (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){ (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o), m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m) })(window,document,'script','//www.google-analytics.com/analytics.js','ga'); ga('create', 'UA-1963507-32', 'auto'); ga('send', 'pageview'); </script> <script> Cd=document;Cr="&"+Math.random();Cp="&s=1"; Cd.cookie="b=b";if(Cd.cookie)Cp+="&c=1"; Cp+="&t="+(new Date()).getTimezoneOffset(); if(self!=top)Cp+="&f=1"; </script> <script> if(navigator.javaEnabled())Cp+="&j=1"; </script> <script> if(typeof(screen)!='undefined')Cp+="&w="+screen.width+"&h="+ screen.height+"&d="+(screen.colorDepth?screen.colorDepth:screen.pixelDepth); </script> <script> Cd.write("<img src='//c.hit.ua/hit?i=95870&g=0&x=2"+Cp+Cr+ "&r="+escape(Cd.referrer)+"&u="+escape(window.location.href)+ "' border='0' wi"+"dth='1' he"+"ight='1'/>"); </script> <script type="application/ld+json"> { "@context": "http://schema.org", "@type": "Person", "name": "Yegor Bugayenko", "url": "http://www.yegor256.com", "sameAs": [ "https://www.facebook.com/yegor256", "https://instagram.com/yegor256", "https://www.linkedin.com/in/yegor256", "https://twitter.com/yegor256", "https://github.com/yegor256", "https://www.pinterest.com/yegor256/" ] } </script> </body> </html> <!DOCTYPE html> <html xmlns="http://www.w3.org/1999/xhtml" lang="en-US" xml:lang="en-US" itemscope="" itemtype="http://schema.org/WebSite"> <head> <meta charset="utf-8"/> <meta name="description" content="When we use private static literals to get rid of value duplication, unnecessary coupling between test methods serously affects maintainability. " /> <meta name="keywords" content="code duplication, coupling and cohesion, java private static final, private static final, private static final java" /> <meta name="viewport" content="width=device-width,minimum-scale=1,initial-scale=1"/> <meta name="google-site-verification" content="JEj_gQr2CPe2QKGw8XdMz0R7VboQIUbX3FlM-lwTq-8" /> <meta name="author" content="Yegor Bugayenko"> <meta name="article:published_time" content="2016-05-03 00:00:00 +0000"> <meta name="og:site_name" content="Yegor Bugayenko"/> <meta name="og:type" content="article" /> <meta name="og:locale" content="en_US" /> <meta name="twitter:account_id" content="4503599630178231" /> <meta name="twitter:creator" content="@yegor256"/> <meta name="twitter:site" content="@yegor256"/> <meta name="twitter:title" property="og:title" content="Test Methods Must Share Nothing"/> <meta name="twitter:description" property="og:description" content="When we use private static literals to get rid of value duplication, unnecessary coupling between test methods serously affects maintainability. "/> <meta name="twitter:url" property="og:url" content="https://www.yegor256.com/2016/05/03/test-methods-must-share-nothing.html"/> <meta name="telegram:channel" content="AAAAAEJFMRzsRTRxM3ec6A"/> <link rel="search" type="application/opensearchdescription+xml" href="/opensearch.xml" title="yegor256" /> <link rel="shortcut icon" href="/favicon.ico?a0e0d018c07"/> <link rel="apple-touch-icon" href="/favicon.ico?a0e0d018c07"/> <link rel="alternate" type="application/rss+xml" title="RSS for yegor256.com" href="https://www.yegor256.com/rss.xml"/> <link rel="stylesheet" href="/css/layout.css?a0e0d018c07"/> <link rel="stylesheet" href="/css/icons.css?a0e0d018c07"/> <link rel="canonical" href="https://www.yegor256.com/2016/05/03/test-methods-must-share-nothing.html" /> <link rel="amphtml" href="https://www.yegor256.com/2016/05/03/test-methods-must-share-nothing.amp.html" /> <title>Test Methods Must Share Nothing </title> <meta name='og:image' content='https://www.yegor256.com/images/2016/05/old-boy.jpg'/><meta name='twitter:image' content='https://www.yegor256.com/images/2016/05/old-boy.jpg'/><meta name='og:image:width' content='1200'/> <meta name='twitter:image:width' content='1200'/><meta name='og:image:height' content='675'/> <meta name='twitter:image:height' content='675'/><meta name='twitter:card' content='summary_large_image'/><meta name='twitter:image:alt' content='Oldeuboi (2003) by Chan-wook Park'/> </head> <body><div class="wrapper"> <aside class="header-toggle unprintable" id="header-toggle" title="Show the menu" onclick="$('#header').show();$('#header-toggle').hide();">&#9776;</aside> <header class="header" id="header"><div class="face"> <a href="/about-me.html#form" class="sub" title="Click to subscribe to my monthly newsletter"><span>Subscribe</span></a> <a href="/about-me.html" style="position:relative;"> <img src="/images/face-256x256.jpg" class="photo" alt="Yegor Bugayenko"/> </a></div><nav><ul class="menu social notranslate"> <li><a href="https://twitter.com/intent/follow?screen_name=yegor256" rel="nofollow" title="Follow me on Twitter"><i class="icon icon-twitter notranslate" aria-hidden="true"></i></a></li> <li><a href="/rss.xml" rel="nofollow" title="Subscribe to my RSS feed"><i class="icon icon-rss notranslate" aria-hidden="true"></i></a></li> <li><a itemprop="sameAs" href="https://github.com/yegor256" rel="nofollow" title="My GitHub profile"><i class="icon icon-github notranslate" aria-hidden="true"></i></a></li> <li><a itemprop="sameAs" href="http://stackoverflow.com/users/187141/yegor256" rel="nofollow" title="My StackOverflow profile"><i class="icon icon-stackoverflow notranslate" aria-hidden="true"></i></a></li> <li><a itemprop="sameAs" href="https://www.facebook.com/yegor256" rel="nofollow" title="Follow me on Facebook"><i class="icon icon-facebook notranslate" aria-hidden="true"></i></a></li> <li><a itemprop="sameAs" href="https://instagram.com/yegor256" rel="nofollow" title="Follow me on Instagram"><i class="icon icon-instagram notranslate" aria-hidden="true"></i></a></li> <li><a itemprop="sameAs" href="https://www.linkedin.com/in/yegor256" rel="nofollow" title="My LinkedIn profile"><i class="icon icon-linkedin notranslate" aria-hidden="true"></i></a></li> <li><a itemprop="sameAs" href="https://www.youtube.com/c/yegor256?sub_confirmation=1" rel="nofollow" title="My Youtube video channel"><i class="icon icon-youtube notranslate" aria-hidden="true"></i></a></li> <li><a itemprop="sameAs" href="https://www.pinterest.com/yegor256/" rel="nofollow" title="My Pinterest boards"><i class="icon icon-pinterest notranslate" aria-hidden="true"></i></a></li> <li><a itemprop="sameAs" href="https://angel.co/yegor256" rel="nofollow" title="My AngelList profile"><i class="icon icon-angellist notranslate" aria-hidden="true"></i></a></li> <li><a href="https://soundcloud.com/yegor256" rel="nofollow" title="My podcast"><i class="icon icon-podcast notranslate" aria-hidden="true"></i></a></li> <li><a href="https://itunes.apple.com/us/podcast/yegor256-podcast/id1150826721" rel="nofollow" title="My iTunes podcast"><i class="icon icon-itunes notranslate" aria-hidden="true"></i></a></li> <li><a href="https://t.me/joinchat/AAAAAEJFMRzsRTRxM3ec6A" rel="nofollow" title="My Telegram public channel"><i class="icon icon-telegram notranslate" aria-hidden="true"></i></a></li> <li><a href="mailto:blog@yegor256.com" rel="nofollow" title="Email me any time"><i class="icon icon-mail notranslate" aria-hidden="true"></i></a></li></ul><ul class="menu"> <li><a href="/" title="Home page">Home</a></li> <li ><a href="/best.html" title="Best articles to read">12&#160;Best</a></li> <li ><a href="/contents.html" title="The contents of the entire blog">All&#160;288</a></li> <li ><a href="/webinars.html" title="My webinars">Webinars</a></li> <li ><a href="/talks.html" title="Future and past conference talks">Talks</a></li> <li ><a href="/books.html" title="The books I wrote">Books</a></li> <li ><a href="/papers.html" title="My academic papers and patents">Papers</a></li> <li ><a href="/pets.html" title="My loved pet projects">Pets</a></li> <li ><a href="/award.html" title="Software quality award">Award</a></li> <li ><a href="/testimonials.html" title="What some people say about me">Testimonials</a></li> <li ><a href="/shift-m.html" title="Audio podcast about project management">Shift-M</a></li> <li ><a href="/paintings.html" title="My paintings for sale">Paintings</a></li> <li><a href="http://ru.yegor256.com/" title="Немного на русском языке">По-русски</a></li></ul></nav><div class="search"> <form method="get" action="https://www.google.com/search" itemprop="potentialAction" itemscope="" itemtype="http://schema.org/SearchAction"> <meta itemprop="target" content="https://www.google.com/search?q={q}"/> <input name="sitesearch" value="yegor256.com" type="hidden"/> <input itemprop="query-input" type="text" id="search-query" class="field field-text" required="required" onfocus="$('.google').css('visibility', 'visible');" name="q" placeholder="Search..." autocomplete="off"/> <input type="image" src="/images/google-search-icon.svg" class="google" title="Search via Google" alt="Search via Google"/> </form></div><div class="hot"><ul> <li> <a href="/code-ahead.html">Code Ahead</a> was published on Amazon just a few days ago! It is my new book, a novel about programmers. It explains in details the majority of ideas that stand behind <a href="https://www.zerocracy.com">Zerocracy</a> and <a href="https://www.xdsd.org">XDSD</a>. </li> <li> At <a href="/webinars.html">Webinar #37</a> we will discuss naming problem in OOP, for objects, methods and attributes; join us on <b>September 12</b>, at 11am PST. </li></ul></div></header></div><section itemscope="" itemtype="http://schema.org/BlogPosting"><div class="wrapper"> <header><p class="printable"> <img src="https://api.qrserver.com/v1/create-qr-code/?data=https://www.yegor256.com/2016/05/03/test-methods-must-share-nothing.html&amp;format=svg" style="width:125px;height:125px;" alt="QR code"/></p><p class="printable"> <code itemprop="url">https://www.yegor256.com/2016/05/03/test-methods-must-share-nothing.html</code></p><h1 itemprop="name headline mainEntityOfPage">Test Methods Must Share Nothing</h1><ul class="subline"> <li> <time itemprop="datePublished" datetime="2016-05-03T00:00:00+00:00"> 3 May 2016 </time> </li> <li class="desktop-only" itemprop="locationCreated">Palo Alto, CA</li> <li class="printable" itemscope="" itemprop="author" itemtype="http://schema.org/Person"> <span itemprop="name">Yegor Bugayenko</span> </li> <li class="unprintable"> <i class="icon icon-comments"></i> <a href="http://www.yegor256.com/2016/05/03/test-methods-must-share-nothing.html#disqus_thread" itemprop="discussionUrl">comments</a> </li></ul><p class="unprintable"><p>Constants... I wrote about them <a href="/2015/07/06/public-static-literals.html">some time ago</a>, mostly saying that they are a bad thing, if being public. They reduce duplication, but introduce coupling. A much better way to get rid of duplication is by creating new classes or methods---a traditional OOP method. This seems to make sense and in our projects I see less and less public constants. In some projects we don&#39;t have them at all. But one thing still bothers me: unit tests. Most programmers seem to think that when static analysis says that there are too many similar literals in the same file, the best way to get rid of them is via a private static literal. This is just wrong.</p><figure class='jb_picture'><img itemprop='image' alt='Oldeuboi (2003) by Chan-wook Park' src='/images/2016/05/old-boy.jpg' longdesc='#934a9853'/><figcaption id='934a9853'>Oldeuboi (2003) by Chan-wook Park</figcaption></figure><p>Unit tests, naturally, duplicate a lot of code. Test methods contain similar or almost identical functionality and this is almost inevitable. Well, we can use more of that <a href="http://junit.sourceforge.net/javadoc/org/junit/Before.html"><code>@Before</code></a> and <a href="http://junit.sourceforge.net/javadoc/org/junit/Before.html"><code>@BeforeClass</code></a> features, but sometimes it&#39;s just not possible. We may have, say, 20 test methods in one <code>FooTest.java</code> file. Preparing all objects in one &quot;before&quot; is not possible. So we have to do certain things again and again in our test methods.</p><p>Let&#39;s take a look at one of the classes in our <a href="http://www.takes.org">Takes Framework</a>: <a href="https://github.com/yegor256/takes/blob/0.32.7/src/test/java/org/takes/misc/VerboseListTest.java"><code>VerboseListTest</code></a>. It&#39;s a unit test and it has a problem, which I&#39;m trying to tell you about. Look at that <a href="https://github.com/yegor256/takes/blob/0.32.7/src/test/java/org/takes/misc/VerboseListTest.java#L54"><code>MSG</code></a> private literal. It is used for the first time in <a href="https://github.com/yegor256/takes/blob/0.32.7/src/test/java/org/takes/misc/VerboseListTest.java#L77-L80"><code>setUp()</code></a> method as an argument of an object constructor and then in a few test methods to check how that object behaves. Let me simplify that code:</p><figure class="highlight"><pre><code class="language-java" data-lang="java"><span></span><span class="kd">class</span> <span class="nc">FooTest</span> <span class="o">{</span>
  <span class="kd">private</span> <span class="kd">static</span> <span class="kd">final</span> <span class="n">String</span> <span class="n">MSG</span> <span class="o">=</span> <span class="s">&quot;something&quot;</span><span class="o">;</span>
  <span class="nd">@Before</span>
  <span class="kd">public</span> <span class="kd">final</span> <span class="kt">void</span> <span class="nf">setUp</span><span class="o">()</span> <span class="kd">throws</span> <span class="n">Exception</span> <span class="o">{</span>
    <span class="k">this</span><span class="o">.</span><span class="na">foo</span> <span class="o">=</span> <span class="k">new</span> <span class="n">Foo</span><span class="o">(</span><span class="n">FooTest</span><span class="o">.</span><span class="na">MSG</span><span class="o">);</span>
  <span class="o">}</span>
  <span class="nd">@Test</span>
  <span class="kd">public</span> <span class="kt">void</span> <span class="nf">simplyWorks</span><span class="o">()</span> <span class="kd">throws</span> <span class="n">IOException</span> <span class="o">{</span>
    <span class="n">assertThat</span><span class="o">(</span>
      <span class="n">foo</span><span class="o">.</span><span class="na">doSomething</span><span class="o">(),</span>
      <span class="n">containsString</span><span class="o">(</span><span class="n">FooTest</span><span class="o">.</span><span class="na">MSG</span><span class="o">)</span>
    <span class="o">);</span>
  <span class="o">}</span>
  <span class="nd">@Test</span>
  <span class="kd">public</span> <span class="kt">void</span> <span class="nf">simplyWorksAgain</span><span class="o">()</span> <span class="kd">throws</span> <span class="n">IOException</span> <span class="o">{</span>
    <span class="n">assertThat</span><span class="o">(</span>
      <span class="n">foo</span><span class="o">.</span><span class="na">doSomethingElse</span><span class="o">(),</span>
      <span class="n">containsString</span><span class="o">(</span><span class="n">FooTest</span><span class="o">.</span><span class="na">MSG</span><span class="o">)</span>
    <span class="o">);</span>
  <span class="o">}</span>
<span class="o">}</span></code></pre></figure><p>This is basically what is happening in <a href="https://github.com/yegor256/takes/blob/0.32.7/src/test/java/org/takes/misc/VerboseListTest.java"><code>VerboseListTest</code></a> and it&#39;s very wrong. Why? Because this shared literal <code>MSG</code> introduced an unnatural coupling between these two test methods. They have nothing in common, because they test different behaviors of class <code>Foo</code>. But this private constant ties them together. Now they are somehow related.</p><p>If and when I want to modify one of the test methods, I may need to modify the other one too. Say I want to see how <code>doSomethingElse()</code> behaves if the encapsulated message is an empty string. What do I do? I change the value of the constant <code>FooTest.MSG</code>, which is used by another test method. This is called coupling. And it&#39;s a bad thing.</p><p>What do we do? Well, we can use that <code>&quot;something&quot;</code> string literal in both test methods:</p><figure class="highlight"><pre><code class="language-java" data-lang="java"><span></span><span class="kd">class</span> <span class="nc">FooTest</span> <span class="o">{</span>
  <span class="nd">@Test</span>
  <span class="kd">public</span> <span class="kt">void</span> <span class="nf">simplyWorks</span><span class="o">()</span> <span class="kd">throws</span> <span class="n">IOException</span> <span class="o">{</span>
    <span class="n">assertThat</span><span class="o">(</span>
      <span class="k">new</span> <span class="n">Foo</span><span class="o">(</span><span class="s">&quot;something&quot;</span><span class="o">).</span><span class="na">doSomething</span><span class="o">(),</span>
      <span class="n">containsString</span><span class="o">(</span><span class="s">&quot;something&quot;</span><span class="o">)</span>
    <span class="o">);</span>
  <span class="o">}</span>
  <span class="nd">@Test</span>
  <span class="kd">public</span> <span class="kt">void</span> <span class="nf">simplyWorksAgain</span><span class="o">()</span> <span class="kd">throws</span> <span class="n">IOException</span> <span class="o">{</span>
    <span class="n">assertThat</span><span class="o">(</span>
      <span class="k">new</span> <span class="n">Foo</span><span class="o">(</span><span class="s">&quot;something&quot;</span><span class="o">).</span><span class="na">doSomethingElse</span><span class="o">(),</span>
      <span class="n">containsString</span><span class="o">(</span><span class="s">&quot;something&quot;</span><span class="o">)</span>
    <span class="o">);</span>
  <span class="o">}</span>
<span class="o">}</span></code></pre></figure><p>As you see, I got rid of that <code>setUp()</code> method and the private static literal <code>MSG</code>. What do we have now? Code duplication. String <code>&quot;something&quot;</code> shows up four times in the test class. No static analyzers will tolerate that. Moreover, there are seven (!) test methods in <a href="https://github.com/yegor256/takes/blob/0.32.7/src/test/java/org/takes/misc/VerboseListTest.java"><code>VerboseListTest</code></a>, which are using <code>MSG</code>. Thus, we will have 14 occurrences of <code>&quot;something&quot;</code>, right? Yes, that&#39;s right and that&#39;s most likely why one of authors of this test case introduced the constant---to get rid of duplication. BTW, <a href="https://github.com/Happy-Neko">@Happy-Neko</a> did that in pull request <a href="https://github.com/yegor256/takes/pull/513">#513</a>, <a href="https://github.com/carlosmiranda"><code>@carlosmiranda</code></a> reviewed the code and I approved the changes. So, three people made/approved that mistake, including myself.</p><p>So what is the right approach that will avoid code duplication and at the same time won&#39;t introduce coupling? Here it is:</p><figure class="highlight"><pre><code class="language-java" data-lang="java"><span></span><span class="kd">class</span> <span class="nc">FooTest</span> <span class="o">{</span>
  <span class="nd">@Test</span>
  <span class="kd">public</span> <span class="kt">void</span> <span class="nf">simplyWorks</span><span class="o">()</span> <span class="kd">throws</span> <span class="n">IOException</span> <span class="o">{</span>
    <span class="kd">final</span> <span class="n">String</span> <span class="n">msg</span> <span class="o">=</span> <span class="s">&quot;something&quot;</span><span class="o">;</span>
    <span class="n">assertThat</span><span class="o">(</span>
      <span class="k">new</span> <span class="n">Foo</span><span class="o">(</span><span class="n">msg</span><span class="o">).</span><span class="na">doSomething</span><span class="o">(),</span>
      <span class="n">containsString</span><span class="o">(</span><span class="n">msg</span><span class="o">)</span>
    <span class="o">);</span>
  <span class="o">}</span>
  <span class="nd">@Test</span>
  <span class="kd">public</span> <span class="kt">void</span> <span class="nf">simplyWorksAgain</span><span class="o">()</span> <span class="kd">throws</span> <span class="n">IOException</span> <span class="o">{</span>
    <span class="kd">final</span> <span class="n">String</span> <span class="n">msg</span> <span class="o">=</span> <span class="s">&quot;something else&quot;</span><span class="o">;</span>
    <span class="n">assertThat</span><span class="o">(</span>
      <span class="k">new</span> <span class="n">Foo</span><span class="o">(</span><span class="n">msg</span><span class="o">).</span><span class="na">doSomethingElse</span><span class="o">(),</span>
      <span class="n">containsString</span><span class="o">(</span><span class="n">msg</span><span class="o">)</span>
    <span class="o">);</span>
  <span class="o">}</span>
<span class="o">}</span></code></pre></figure><p>These literals must be different. This is what any static analyzer is saying when it sees <code>&quot;something&quot;</code> in so many places. It questions us---why are they the same? Is it really so important to use <code>&quot;something&quot;</code> everywhere? Why can&#39;t you use different literals? Of course we can. And we should.</p><p>The bottom line is that each test method must have its own set of data and objects. They must not be shared between test methods ever. Test methods must always be independent, having nothing in common.</p><p>Having that in mind, we can easily conclude that methods like <code>setUp()</code> or any shared variables in test classes are <strong>evil</strong>. They must not be used and simply must not exist. I think that their invention in JUnit caused a lot of harm to Java code.</p></p><nav class="buttons notranslate desktop-only"> <a href="http://www.facebook.com/sharer/sharer.php?u=https://www.yegor256.com/2016/05/03/test-methods-must-share-nothing.html" title="Share on Facebook" class="button" rel="nofollow"> <span class="count count-facebook">0</span> <i class="icon icon-facebook notranslate" aria-hidden="true"></i> </a> <a href="https://twitter.com/share?url=https://www.yegor256.com/2016/05/03/test-methods-must-share-nothing.html&amp;text=Test+Methods+Must+Share+Nothing" title="Share on Twitter" class="button" rel="nofollow"> <span class="count count-twitter">0</span> <i class="icon icon-twitter notranslate" aria-hidden="true"></i> </a> <a href="https://plus.google.com/share?url=https://www.yegor256.com/2016/05/03/test-methods-must-share-nothing.html" title="Share on Google+" class="button" rel="nofollow"> <span class="count count-googleplus">0</span> <i class="icon icon-googleplus notranslate" aria-hidden="true"></i> </a> <a href="https://www.linkedin.com/cws/share?url=https://www.yegor256.com/2016/05/03/test-methods-must-share-nothing.html" title="Share on LinkedIn" class="button" rel="nofollow"> <span class="count count-linkedin">0</span> <i class="icon icon-linkedin notranslate" aria-hidden="true"></i> </a> <a href="http://reddit.com/submit?url=https://www.yegor256.com/2016/05/03/test-methods-must-share-nothing.html%3F2016-18&amp;title=Test+Methods+Must+Share+Nothing" title="Share on Reddit" class="button" rel="nofollow"> <span class="count count-reddit">0</span> <i class="icon icon-reddit notranslate" aria-hidden="true"></i> </a> <a href="http://news.ycombinator.com/submitlink?u=https://www.yegor256.com/2016/05/03/test-methods-must-share-nothing.html%3F2016-18&amp;t=Test+Methods+Must+Share+Nothing" title="Share on Hacker News" class="button" rel="nofollow"> <span class="count count-hackernews">0</span> <i class="icon icon-hackernews notranslate" aria-hidden="true"></i> </a> </nav> </header> <article class="main" itemprop="articleBody"><div ><p>Constants... I wrote about them <a href="/2015/07/06/public-static-literals.html">some time ago</a>, mostly saying that they are a bad thing, if being public. They reduce duplication, but introduce coupling. A much better way to get rid of duplication is by creating new classes or methods---a traditional OOP method. This seems to make sense and in our projects I see less and less public constants. In some projects we don&#39;t have them at all. But one thing still bothers me: unit tests. Most programmers seem to think that when static analysis says that there are too many similar literals in the same file, the best way to get rid of them is via a private static literal. This is just wrong.</p><figure class='jb_picture'><img itemprop='image' alt='Oldeuboi (2003) by Chan-wook Park' src='/images/2016/05/old-boy.jpg' longdesc='#934a9853'/><figcaption id='934a9853'>Oldeuboi (2003) by Chan-wook Park</figcaption></figure><p>Unit tests, naturally, duplicate a lot of code. Test methods contain similar or almost identical functionality and this is almost inevitable. Well, we can use more of that <a href="http://junit.sourceforge.net/javadoc/org/junit/Before.html"><code>@Before</code></a> and <a href="http://junit.sourceforge.net/javadoc/org/junit/Before.html"><code>@BeforeClass</code></a> features, but sometimes it&#39;s just not possible. We may have, say, 20 test methods in one <code>FooTest.java</code> file. Preparing all objects in one &quot;before&quot; is not possible. So we have to do certain things again and again in our test methods.</p><p>Let&#39;s take a look at one of the classes in our <a href="http://www.takes.org">Takes Framework</a>: <a href="https://github.com/yegor256/takes/blob/0.32.7/src/test/java/org/takes/misc/VerboseListTest.java"><code>VerboseListTest</code></a>. It&#39;s a unit test and it has a problem, which I&#39;m trying to tell you about. Look at that <a href="https://github.com/yegor256/takes/blob/0.32.7/src/test/java/org/takes/misc/VerboseListTest.java#L54"><code>MSG</code></a> private literal. It is used for the first time in <a href="https://github.com/yegor256/takes/blob/0.32.7/src/test/java/org/takes/misc/VerboseListTest.java#L77-L80"><code>setUp()</code></a> method as an argument of an object constructor and then in a few test methods to check how that object behaves. Let me simplify that code:</p><figure class="highlight"><pre><code class="language-java" data-lang="java"><span></span><span class="kd">class</span> <span class="nc">FooTest</span> <span class="o">{</span>
  <span class="kd">private</span> <span class="kd">static</span> <span class="kd">final</span> <span class="n">String</span> <span class="n">MSG</span> <span class="o">=</span> <span class="s">&quot;something&quot;</span><span class="o">;</span>
  <span class="nd">@Before</span>
  <span class="kd">public</span> <span class="kd">final</span> <span class="kt">void</span> <span class="nf">setUp</span><span class="o">()</span> <span class="kd">throws</span> <span class="n">Exception</span> <span class="o">{</span>
    <span class="k">this</span><span class="o">.</span><span class="na">foo</span> <span class="o">=</span> <span class="k">new</span> <span class="n">Foo</span><span class="o">(</span><span class="n">FooTest</span><span class="o">.</span><span class="na">MSG</span><span class="o">);</span>
  <span class="o">}</span>
  <span class="nd">@Test</span>
  <span class="kd">public</span> <span class="kt">void</span> <span class="nf">simplyWorks</span><span class="o">()</span> <span class="kd">throws</span> <span class="n">IOException</span> <span class="o">{</span>
    <span class="n">assertThat</span><span class="o">(</span>
      <span class="n">foo</span><span class="o">.</span><span class="na">doSomething</span><span class="o">(),</span>
      <span class="n">containsString</span><span class="o">(</span><span class="n">FooTest</span><span class="o">.</span><span class="na">MSG</span><span class="o">)</span>
    <span class="o">);</span>
  <span class="o">}</span>
  <span class="nd">@Test</span>
  <span class="kd">public</span> <span class="kt">void</span> <span class="nf">simplyWorksAgain</span><span class="o">()</span> <span class="kd">throws</span> <span class="n">IOException</span> <span class="o">{</span>
    <span class="n">assertThat</span><span class="o">(</span>
      <span class="n">foo</span><span class="o">.</span><span class="na">doSomethingElse</span><span class="o">(),</span>
      <span class="n">containsString</span><span class="o">(</span><span class="n">FooTest</span><span class="o">.</span><span class="na">MSG</span><span class="o">)</span>
    <span class="o">);</span>
  <span class="o">}</span>
<span class="o">}</span></code></pre></figure><p>This is basically what is happening in <a href="https://github.com/yegor256/takes/blob/0.32.7/src/test/java/org/takes/misc/VerboseListTest.java"><code>VerboseListTest</code></a> and it&#39;s very wrong. Why? Because this shared literal <code>MSG</code> introduced an unnatural coupling between these two test methods. They have nothing in common, because they test different behaviors of class <code>Foo</code>. But this private constant ties them together. Now they are somehow related.</p><p>If and when I want to modify one of the test methods, I may need to modify the other one too. Say I want to see how <code>doSomethingElse()</code> behaves if the encapsulated message is an empty string. What do I do? I change the value of the constant <code>FooTest.MSG</code>, which is used by another test method. This is called coupling. And it&#39;s a bad thing.</p><p>What do we do? Well, we can use that <code>&quot;something&quot;</code> string literal in both test methods:</p><figure class="highlight"><pre><code class="language-java" data-lang="java"><span></span><span class="kd">class</span> <span class="nc">FooTest</span> <span class="o">{</span>
  <span class="nd">@Test</span>
  <span class="kd">public</span> <span class="kt">void</span> <span class="nf">simplyWorks</span><span class="o">()</span> <span class="kd">throws</span> <span class="n">IOException</span> <span class="o">{</span>
    <span class="n">assertThat</span><span class="o">(</span>
      <span class="k">new</span> <span class="n">Foo</span><span class="o">(</span><span class="s">&quot;something&quot;</span><span class="o">).</span><span class="na">doSomething</span><span class="o">(),</span>
      <span class="n">containsString</span><span class="o">(</span><span class="s">&quot;something&quot;</span><span class="o">)</span>
    <span class="o">);</span>
  <span class="o">}</span>
  <span class="nd">@Test</span>
  <span class="kd">public</span> <span class="kt">void</span> <span class="nf">simplyWorksAgain</span><span class="o">()</span> <span class="kd">throws</span> <span class="n">IOException</span> <span class="o">{</span>
    <span class="n">assertThat</span><span class="o">(</span>
      <span class="k">new</span> <span class="n">Foo</span><span class="o">(</span><span class="s">&quot;something&quot;</span><span class="o">).</span><span class="na">doSomethingElse</span><span class="o">(),</span>
      <span class="n">containsString</span><span class="o">(</span><span class="s">&quot;something&quot;</span><span class="o">)</span>
    <span class="o">);</span>
  <span class="o">}</span>
<span class="o">}</span></code></pre></figure><p>As you see, I got rid of that <code>setUp()</code> method and the private static literal <code>MSG</code>. What do we have now? Code duplication. String <code>&quot;something&quot;</code> shows up four times in the test class. No static analyzers will tolerate that. Moreover, there are seven (!) test methods in <a href="https://github.com/yegor256/takes/blob/0.32.7/src/test/java/org/takes/misc/VerboseListTest.java"><code>VerboseListTest</code></a>, which are using <code>MSG</code>. Thus, we will have 14 occurrences of <code>&quot;something&quot;</code>, right? Yes, that&#39;s right and that&#39;s most likely why one of authors of this test case introduced the constant---to get rid of duplication. BTW, <a href="https://github.com/Happy-Neko">@Happy-Neko</a> did that in pull request <a href="https://github.com/yegor256/takes/pull/513">#513</a>, <a href="https://github.com/carlosmiranda"><code>@carlosmiranda</code></a> reviewed the code and I approved the changes. So, three people made/approved that mistake, including myself.</p><p>So what is the right approach that will avoid code duplication and at the same time won&#39;t introduce coupling? Here it is:</p><figure class="highlight"><pre><code class="language-java" data-lang="java"><span></span><span class="kd">class</span> <span class="nc">FooTest</span> <span class="o">{</span>
  <span class="nd">@Test</span>
  <span class="kd">public</span> <span class="kt">void</span> <span class="nf">simplyWorks</span><span class="o">()</span> <span class="kd">throws</span> <span class="n">IOException</span> <span class="o">{</span>
    <span class="kd">final</span> <span class="n">String</span> <span class="n">msg</span> <span class="o">=</span> <span class="s">&quot;something&quot;</span><span class="o">;</span>
    <span class="n">assertThat</span><span class="o">(</span>
      <span class="k">new</span> <span class="n">Foo</span><span class="o">(</span><span class="n">msg</span><span class="o">).</span><span class="na">doSomething</span><span class="o">(),</span>
      <span class="n">containsString</span><span class="o">(</span><span class="n">msg</span><span class="o">)</span>
    <span class="o">);</span>
  <span class="o">}</span>
  <span class="nd">@Test</span>
  <span class="kd">public</span> <span class="kt">void</span> <span class="nf">simplyWorksAgain</span><span class="o">()</span> <span class="kd">throws</span> <span class="n">IOException</span> <span class="o">{</span>
    <span class="kd">final</span> <span class="n">String</span> <span class="n">msg</span> <span class="o">=</span> <span class="s">&quot;something else&quot;</span><span class="o">;</span>
    <span class="n">assertThat</span><span class="o">(</span>
      <span class="k">new</span> <span class="n">Foo</span><span class="o">(</span><span class="n">msg</span><span class="o">).</span><span class="na">doSomethingElse</span><span class="o">(),</span>
      <span class="n">containsString</span><span class="o">(</span><span class="n">msg</span><span class="o">)</span>
    <span class="o">);</span>
  <span class="o">}</span>
<span class="o">}</span></code></pre></figure><p>These literals must be different. This is what any static analyzer is saying when it sees <code>&quot;something&quot;</code> in so many places. It questions us---why are they the same? Is it really so important to use <code>&quot;something&quot;</code> everywhere? Why can&#39;t you use different literals? Of course we can. And we should.</p><p>The bottom line is that each test method must have its own set of data and objects. They must not be shared between test methods ever. Test methods must always be independent, having nothing in common.</p><p>Having that in mind, we can easily conclude that methods like <code>setUp()</code> or any shared variables in test classes are <strong>evil</strong>. They must not be used and simply must not exist. I think that their invention in JUnit caused a lot of harm to Java code.</p></div></article></div><div class="wrapper"> <related-posts /></div><div class="disqus" role="complementary"><p class="disqus_hint"> Please, use <a href="https://help.disqus.com/commenting/what-html-tags-are-allowed-within-comments">syntax highlighting</a> in your comments, to make them more readable.</p><div id="disqus_thread" class="disqus-thread"> <a>&nbsp;</a></div><script> var disqus_config = function () { this.page.url = document.location.href.split('?')[0].split('#')[0].replace('https://', 'http://'); this.page.identifier = this.page.url; }; (function() { var d = document, s = d.createElement('script'); s.src = '//yegor256.disqus.com/embed.js'; s.setAttribute('data-timestamp', +new Date()); (d.head || d.body).appendChild(s); })(); </script> <noscript><div><p class="red"> JavaScript is disabled in your browser, that's why you can't see comments under this post.</p></div></noscript></div><div class="wrapper"> <footer class="footer"><p> &copy; <span itemscope="" itemprop="copyrightHolder" itemtype="http://schema.org/Person"> <span itemprop="name">Yegor Bugayenko</span> </span> 2014&ndash;<span itemprop="copyrightYear">2018</span></p></footer></div></section><div class="wrapper unprintable" style="text-align:center;margin-top:2em;"> <a href="http://www.sixnines.io/h/3ba1652f"> <img src="//www.sixnines.io/b/3ba1652f?style=flat" alt="sixnines availability badge"/> </a></div><script src="//code.jquery.com/jquery-1.9.0.min.js"></script> <script src="/js/all.js?a0e0d018c07"></script> <script>var disqus_shortname = 'yegor256';</script> <script id="dsq-count-scr" src="//yegor256.disqus.com/count.js" async="async"></script> <script> (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){ (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o), m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m) })(window,document,'script','//www.google-analytics.com/analytics.js','ga'); ga('create', 'UA-1963507-32', 'auto'); ga('send', 'pageview'); </script> <script> Cd=document;Cr="&"+Math.random();Cp="&s=1"; Cd.cookie="b=b";if(Cd.cookie)Cp+="&c=1"; Cp+="&t="+(new Date()).getTimezoneOffset(); if(self!=top)Cp+="&f=1"; </script> <script> if(navigator.javaEnabled())Cp+="&j=1"; </script> <script> if(typeof(screen)!='undefined')Cp+="&w="+screen.width+"&h="+ screen.height+"&d="+(screen.colorDepth?screen.colorDepth:screen.pixelDepth); </script> <script> Cd.write("<img src='//c.hit.ua/hit?i=95870&g=0&x=2"+Cp+Cr+ "&r="+escape(Cd.referrer)+"&u="+escape(window.location.href)+ "' border='0' wi"+"dth='1' he"+"ight='1'/>"); </script> <script type="application/ld+json"> { "@context": "http://schema.org", "@type": "Person", "name": "Yegor Bugayenko", "url": "http://www.yegor256.com", "sameAs": [ "https://www.facebook.com/yegor256", "https://instagram.com/yegor256", "https://www.linkedin.com/in/yegor256", "https://twitter.com/yegor256", "https://github.com/yegor256", "https://www.pinterest.com/yegor256/" ] } </script> </body> </html> <!DOCTYPE html> <html xmlns="http://www.w3.org/1999/xhtml" lang="en-US" xml:lang="en-US" itemscope="" itemtype="http://schema.org/WebSite"> <head> <meta charset="utf-8"/> <meta name="description" content="Class InputStream in Java has three methods read(), this is what I think is very wrong. Not only in this class, but in general in OOP. " /> <meta name="keywords" content="InputStream, InputStream java, method overloading, method overloading java, why InputStream is a class" /> <meta name="viewport" content="width=device-width,minimum-scale=1,initial-scale=1"/> <meta name="google-site-verification" content="JEj_gQr2CPe2QKGw8XdMz0R7VboQIUbX3FlM-lwTq-8" /> <meta name="author" content="Yegor Bugayenko"> <meta name="article:published_time" content="2016-04-26 00:00:00 +0000"> <meta name="og:site_name" content="Yegor Bugayenko"/> <meta name="og:type" content="article" /> <meta name="og:locale" content="en_US" /> <meta name="twitter:account_id" content="4503599630178231" /> <meta name="twitter:creator" content="@yegor256"/> <meta name="twitter:site" content="@yegor256"/> <meta name="twitter:title" property="og:title" content="Why InputStream Design Is Wrong"/> <meta name="twitter:description" property="og:description" content="Class InputStream in Java has three methods read(), this is what I think is very wrong. Not only in this class, but in general in OOP. "/> <meta name="twitter:url" property="og:url" content="https://www.yegor256.com/2016/04/26/why-inputstream-design-is-wrong.html"/> <meta name="telegram:channel" content="AAAAAEJFMRzsRTRxM3ec6A"/> <link rel="search" type="application/opensearchdescription+xml" href="/opensearch.xml" title="yegor256" /> <link rel="shortcut icon" href="/favicon.ico?a0e0d018c07"/> <link rel="apple-touch-icon" href="/favicon.ico?a0e0d018c07"/> <link rel="alternate" type="application/rss+xml" title="RSS for yegor256.com" href="https://www.yegor256.com/rss.xml"/> <link rel="stylesheet" href="/css/layout.css?a0e0d018c07"/> <link rel="stylesheet" href="/css/icons.css?a0e0d018c07"/> <link rel="canonical" href="https://www.yegor256.com/2016/04/26/why-inputstream-design-is-wrong.html" /> <link rel="amphtml" href="https://www.yegor256.com/2016/04/26/why-inputstream-design-is-wrong.amp.html" /> <title>Why InputStream Design Is Wrong </title> <meta name='og:image' content='https://www.yegor256.com/images/2016/04/a-serious-man.jpg'/><meta name='twitter:image' content='https://www.yegor256.com/images/2016/04/a-serious-man.jpg'/><meta name='og:image:width' content='1200'/> <meta name='twitter:image:width' content='1200'/><meta name='og:image:height' content='656'/> <meta name='twitter:image:height' content='656'/><meta name='twitter:card' content='summary_large_image'/><meta name='twitter:image:alt' content='A Serious Man (2009) by Coen Brothers'/> </head> <body><div class="wrapper"> <aside class="header-toggle unprintable" id="header-toggle" title="Show the menu" onclick="$('#header').show();$('#header-toggle').hide();">&#9776;</aside> <header class="header" id="header"><div class="face"> <a href="/about-me.html#form" class="sub" title="Click to subscribe to my monthly newsletter"><span>Subscribe</span></a> <a href="/about-me.html" style="position:relative;"> <img src="/images/face-256x256.jpg" class="photo" alt="Yegor Bugayenko"/> </a></div><nav><ul class="menu social notranslate"> <li><a href="https://twitter.com/intent/follow?screen_name=yegor256" rel="nofollow" title="Follow me on Twitter"><i class="icon icon-twitter notranslate" aria-hidden="true"></i></a></li> <li><a href="/rss.xml" rel="nofollow" title="Subscribe to my RSS feed"><i class="icon icon-rss notranslate" aria-hidden="true"></i></a></li> <li><a itemprop="sameAs" href="https://github.com/yegor256" rel="nofollow" title="My GitHub profile"><i class="icon icon-github notranslate" aria-hidden="true"></i></a></li> <li><a itemprop="sameAs" href="http://stackoverflow.com/users/187141/yegor256" rel="nofollow" title="My StackOverflow profile"><i class="icon icon-stackoverflow notranslate" aria-hidden="true"></i></a></li> <li><a itemprop="sameAs" href="https://www.facebook.com/yegor256" rel="nofollow" title="Follow me on Facebook"><i class="icon icon-facebook notranslate" aria-hidden="true"></i></a></li> <li><a itemprop="sameAs" href="https://instagram.com/yegor256" rel="nofollow" title="Follow me on Instagram"><i class="icon icon-instagram notranslate" aria-hidden="true"></i></a></li> <li><a itemprop="sameAs" href="https://www.linkedin.com/in/yegor256" rel="nofollow" title="My LinkedIn profile"><i class="icon icon-linkedin notranslate" aria-hidden="true"></i></a></li> <li><a itemprop="sameAs" href="https://www.youtube.com/c/yegor256?sub_confirmation=1" rel="nofollow" title="My Youtube video channel"><i class="icon icon-youtube notranslate" aria-hidden="true"></i></a></li> <li><a itemprop="sameAs" href="https://www.pinterest.com/yegor256/" rel="nofollow" title="My Pinterest boards"><i class="icon icon-pinterest notranslate" aria-hidden="true"></i></a></li> <li><a itemprop="sameAs" href="https://angel.co/yegor256" rel="nofollow" title="My AngelList profile"><i class="icon icon-angellist notranslate" aria-hidden="true"></i></a></li> <li><a href="https://soundcloud.com/yegor256" rel="nofollow" title="My podcast"><i class="icon icon-podcast notranslate" aria-hidden="true"></i></a></li> <li><a href="https://itunes.apple.com/us/podcast/yegor256-podcast/id1150826721" rel="nofollow" title="My iTunes podcast"><i class="icon icon-itunes notranslate" aria-hidden="true"></i></a></li> <li><a href="https://t.me/joinchat/AAAAAEJFMRzsRTRxM3ec6A" rel="nofollow" title="My Telegram public channel"><i class="icon icon-telegram notranslate" aria-hidden="true"></i></a></li> <li><a href="mailto:blog@yegor256.com" rel="nofollow" title="Email me any time"><i class="icon icon-mail notranslate" aria-hidden="true"></i></a></li></ul><ul class="menu"> <li><a href="/" title="Home page">Home</a></li> <li ><a href="/best.html" title="Best articles to read">12&#160;Best</a></li> <li ><a href="/contents.html" title="The contents of the entire blog">All&#160;288</a></li> <li ><a href="/webinars.html" title="My webinars">Webinars</a></li> <li ><a href="/talks.html" title="Future and past conference talks">Talks</a></li> <li ><a href="/books.html" title="The books I wrote">Books</a></li> <li ><a href="/papers.html" title="My academic papers and patents">Papers</a></li> <li ><a href="/pets.html" title="My loved pet projects">Pets</a></li> <li ><a href="/award.html" title="Software quality award">Award</a></li> <li ><a href="/testimonials.html" title="What some people say about me">Testimonials</a></li> <li ><a href="/shift-m.html" title="Audio podcast about project management">Shift-M</a></li> <li ><a href="/paintings.html" title="My paintings for sale">Paintings</a></li> <li><a href="http://ru.yegor256.com/" title="Немного на русском языке">По-русски</a></li></ul></nav><div class="search"> <form method="get" action="https://www.google.com/search" itemprop="potentialAction" itemscope="" itemtype="http://schema.org/SearchAction"> <meta itemprop="target" content="https://www.google.com/search?q={q}"/> <input name="sitesearch" value="yegor256.com" type="hidden"/> <input itemprop="query-input" type="text" id="search-query" class="field field-text" required="required" onfocus="$('.google').css('visibility', 'visible');" name="q" placeholder="Search..." autocomplete="off"/> <input type="image" src="/images/google-search-icon.svg" class="google" title="Search via Google" alt="Search via Google"/> </form></div><div class="hot"><ul> <li> <a href="/code-ahead.html">Code Ahead</a> was published on Amazon just a few days ago! It is my new book, a novel about programmers. It explains in details the majority of ideas that stand behind <a href="https://www.zerocracy.com">Zerocracy</a> and <a href="https://www.xdsd.org">XDSD</a>. </li> <li> At <a href="/webinars.html">Webinar #37</a> we will discuss naming problem in OOP, for objects, methods and attributes; join us on <b>September 12</b>, at 11am PST. </li></ul></div></header></div><section itemscope="" itemtype="http://schema.org/BlogPosting"><div class="wrapper"> <header><p class="printable"> <img src="https://api.qrserver.com/v1/create-qr-code/?data=https://www.yegor256.com/2016/04/26/why-inputstream-design-is-wrong.html&amp;format=svg" style="width:125px;height:125px;" alt="QR code"/></p><p class="printable"> <code itemprop="url">https://www.yegor256.com/2016/04/26/why-inputstream-design-is-wrong.html</code></p><h1 itemprop="name headline mainEntityOfPage">Why InputStream Design Is Wrong</h1><aside class='book'><a href='http://amzn.to/2qFt4Tn'><img src='/images/books/elegant-objects/cover.png' class='book-cover' alt='book cover'/></a>Read more about this subject in <a href='http://amzn.to/2qFt4Tn'>Section&nbsp;2.9</a><br/> of my book<a href='http://amzn.to/2qFt4Tn'><img src='/images/books/amazon-buy-button.png' class='amazon-button' alt='Click to buy'/></a></aside><ul class="subline"> <li> <time itemprop="datePublished" datetime="2016-04-26T00:00:00+00:00"> 26 April 2016 </time> </li> <li class="desktop-only" itemprop="locationCreated">Washington, D.C.</li> <li class="printable" itemscope="" itemprop="author" itemtype="http://schema.org/Person"> <span itemprop="name">Yegor Bugayenko</span> </li> <li class="unprintable"> <i class="icon icon-comments"></i> <a href="http://www.yegor256.com/2016/04/26/why-inputstream-design-is-wrong.html#disqus_thread" itemprop="discussionUrl">comments</a> </li></ul><p class="unprintable"><p>It&#39;s not just about <code>InputSteam</code>, this class is a good example of a bad design. I&#39;m talking about three overloaded methods <code>read()</code>. I&#39;ve mentioned this problem in Section 2.9 of <a href="/elegant-objects.html">Elegant Objects</a>. In a few words, I strongly believe that interfaces must be &quot;functionality poor.&quot; <code>InputStream</code> should have been an interface in the first place and it should have had a single method <code>read(byte[])</code>. Then if its authors wanted to give us extra functionality, they should have created supplementary &quot;smart&quot; classes.</p><figure class='jb_picture'><img itemprop='image' alt='A Serious Man (2009) by Coen Brothers' src='/images/2016/04/a-serious-man.jpg' longdesc='#490f983a'/><figcaption id='490f983a'>A Serious Man (2009) by Coen Brothers</figcaption></figure><p>This is how it looks now:</p><figure class="highlight"><pre><code class="language-java" data-lang="java"><span></span><span class="kd">abstract</span> <span class="kd">class</span> <span class="nc">InputStream</span> <span class="o">{</span>
  <span class="kt">int</span> <span class="nf">read</span><span class="o">();</span>
  <span class="kt">int</span> <span class="nf">read</span><span class="o">(</span><span class="kt">byte</span><span class="o">[]</span> <span class="n">buffer</span><span class="o">,</span> <span class="kt">int</span> <span class="n">offset</span><span class="o">,</span> <span class="kt">int</span> <span class="n">length</span><span class="o">);</span>
  <span class="kt">int</span> <span class="nf">read</span><span class="o">(</span><span class="kt">byte</span><span class="o">[]</span> <span class="n">buffer</span><span class="o">);</span>
<span class="o">}</span></code></pre></figure><p>What&#39;s wrong? It&#39;s very convenient to have the ability to read a single byte, an array of bytes or even an array of bytes with a direct positioning into a specific place in the buffer!</p><aside class='youtube'> <a href='https://www.youtube.com/watch?v=Xk9tIqwca3k'><div class='box'> <img src='https://i.ytimg.com/vi/Xk9tIqwca3k/mqdefault.jpg' alt='YouTube video #Xk9tIqwca3k'/><div class='play'><i class='icon icon-play'></i></div></div></a><div>Smart Classes and Functionality-Poor Interfaces (webinar #16); 7 July 2016.</div></aside><p>However, we are still lacking a few methods: for reading the bytes and immediately saving into a file, converting to a text with a selected encoding, sending them by email and posting on Twitter. It would be great to have the features too, right in the poor <code>InputStream</code>. I hope the Oracle Java team is working on them now.</p><p>In the mean time, let&#39;s see what exactly is wrong with what these bright engineers designed for us already. Or maybe let me show how I would design <code>InputStream</code> and we&#39;ll compare:</p><figure class="highlight"><pre><code class="language-java" data-lang="java"><span></span><span class="kd">interface</span> <span class="nc">InputStream</span> <span class="o">{</span>
  <span class="kt">int</span> <span class="nf">read</span><span class="o">(</span><span class="kt">byte</span><span class="o">[]</span> <span class="n">buffer</span><span class="o">,</span> <span class="kt">int</span> <span class="n">offset</span><span class="o">,</span> <span class="kt">int</span> <span class="n">length</span><span class="o">);</span>
<span class="o">}</span></code></pre></figure><p>This is my design. The <code>InputStream</code> is responsible for reading bytes from the stream. There is one single method for this feature. Is it convenient for everybody? Does it read and post on Twitter? Not yet. Do we need that functionality? Of course we do, but it doesn&#39;t mean that we will add it to the interface. Instead, we will create supplementary &quot;smart&quot; class:</p><figure class="highlight"><pre><code class="language-java" data-lang="java"><span></span><span class="kd">interface</span> <span class="nc">InputStream</span> <span class="o">{</span>
  <span class="kt">int</span> <span class="nf">read</span><span class="o">(</span><span class="kt">byte</span><span class="o">[]</span> <span class="n">buffer</span><span class="o">,</span> <span class="kt">int</span> <span class="n">offset</span><span class="o">,</span> <span class="kt">int</span> <span class="n">length</span><span class="o">);</span>
  <span class="kd">class</span> <span class="nc">Smart</span> <span class="o">{</span>
    <span class="kd">private</span> <span class="kd">final</span> <span class="n">InputStream</span> <span class="n">origin</span><span class="o">;</span>
    <span class="kd">public</span> <span class="nf">Smart</span><span class="o">(</span><span class="n">InputStream</span> <span class="n">stream</span><span class="o">)</span> <span class="o">{</span>
      <span class="k">this</span><span class="o">.</span><span class="na">origin</span> <span class="o">=</span> <span class="n">stream</span><span class="o">;</span>
    <span class="o">}</span>
    <span class="kd">public</span> <span class="kt">int</span> <span class="nf">read</span><span class="o">()</span> <span class="o">{</span>
      <span class="kd">final</span> <span class="kt">byte</span><span class="o">[]</span> <span class="n">buffer</span> <span class="o">=</span> <span class="k">new</span> <span class="kt">byte</span><span class="o">[</span><span class="mi">1</span><span class="o">];</span>
      <span class="kd">final</span> <span class="kt">int</span> <span class="n">read</span> <span class="o">=</span> <span class="k">this</span><span class="o">.</span><span class="na">origin</span><span class="o">.</span><span class="na">read</span><span class="o">(</span><span class="n">buffer</span><span class="o">,</span> <span class="mi">0</span><span class="o">,</span> <span class="mi">1</span><span class="o">);</span>
      <span class="kd">final</span> <span class="kt">int</span> <span class="n">result</span><span class="o">;</span>
      <span class="k">if</span> <span class="o">(</span><span class="n">read</span> <span class="o">&lt;</span> <span class="mi">1</span><span class="o">)</span> <span class="o">{</span>
        <span class="n">result</span> <span class="o">=</span> <span class="o">-</span><span class="mi">1</span><span class="o">;</span>
      <span class="o">}</span> <span class="k">else</span> <span class="o">{</span>
        <span class="n">result</span> <span class="o">=</span> <span class="n">buffer</span><span class="o">[</span><span class="mi">0</span><span class="o">];</span>
      <span class="o">}</span>
      <span class="k">return</span> <span class="n">result</span><span class="o">;</span>
    <span class="o">}</span>
  <span class="o">}</span>
<span class="o">}</span></code></pre></figure><p>Now, we want to read a single byte from the stream. Here is how:</p><figure class="highlight"><pre><code class="language-java" data-lang="java"><span></span><span class="kd">final</span> <span class="n">InputStream</span> <span class="n">input</span> <span class="o">=</span> <span class="k">new</span> <span class="n">FileInputStream</span><span class="o">(</span><span class="s">&quot;/tmp/a.txt&quot;</span><span class="o">);</span>
<span class="kd">final</span> <span class="kt">byte</span> <span class="n">b</span> <span class="o">=</span> <span class="k">new</span> <span class="n">InputStream</span><span class="o">.</span><span class="na">Smart</span><span class="o">(</span><span class="n">input</span><span class="o">).</span><span class="na">read</span><span class="o">();</span></code></pre></figure><p>The functionality of reading a single byte is outside of <code>InputStream</code>, because this is not its business. The stream doesn&#39;t need to know how to manage the data after it is read. All the stream is <strong>responsible</strong> for is reading, not parsing or manipulating afterwards.</p><p>Interfaces must be small.</p><p>Obviously, method overloading in interfaces is a code smell. An interface with more than <strong>three methods</strong> is a good candidate for refactoring. If methods overload each other---it&#39;s serious trouble.</p><p>Interfaces must be small!</p><p>You may say that the creators of <code>InputStream</code> cared about performance, that&#39;s why allowed us to implement <code>read()</code> in three different forms. Then I have to ask again, why not create a method for reading and immediately post it on Twitter? That would be fantastically fast. Isn&#39;t it what we all want? A fast software which nobody has any desire to read or maintain.</p></p><nav class="buttons notranslate desktop-only"> <a href="http://www.facebook.com/sharer/sharer.php?u=https://www.yegor256.com/2016/04/26/why-inputstream-design-is-wrong.html" title="Share on Facebook" class="button" rel="nofollow"> <span class="count count-facebook">0</span> <i class="icon icon-facebook notranslate" aria-hidden="true"></i> </a> <a href="https://twitter.com/share?url=https://www.yegor256.com/2016/04/26/why-inputstream-design-is-wrong.html&amp;text=Why+InputStream+Design+Is+Wrong" title="Share on Twitter" class="button" rel="nofollow"> <span class="count count-twitter">0</span> <i class="icon icon-twitter notranslate" aria-hidden="true"></i> </a> <a href="https://plus.google.com/share?url=https://www.yegor256.com/2016/04/26/why-inputstream-design-is-wrong.html" title="Share on Google+" class="button" rel="nofollow"> <span class="count count-googleplus">0</span> <i class="icon icon-googleplus notranslate" aria-hidden="true"></i> </a> <a href="https://www.linkedin.com/cws/share?url=https://www.yegor256.com/2016/04/26/why-inputstream-design-is-wrong.html" title="Share on LinkedIn" class="button" rel="nofollow"> <span class="count count-linkedin">0</span> <i class="icon icon-linkedin notranslate" aria-hidden="true"></i> </a> <a href="http://reddit.com/submit?url=https://www.yegor256.com/2016/04/26/why-inputstream-design-is-wrong.html%3F2016-17&amp;title=Why+InputStream+Design+Is+Wrong" title="Share on Reddit" class="button" rel="nofollow"> <span class="count count-reddit">0</span> <i class="icon icon-reddit notranslate" aria-hidden="true"></i> </a> <a href="http://news.ycombinator.com/submitlink?u=https://www.yegor256.com/2016/04/26/why-inputstream-design-is-wrong.html%3F2016-17&amp;t=Why+InputStream+Design+Is+Wrong" title="Share on Hacker News" class="button" rel="nofollow"> <span class="count count-hackernews">0</span> <i class="icon icon-hackernews notranslate" aria-hidden="true"></i> </a> </nav> </header> <article class="main" itemprop="articleBody"><div ><p>It&#39;s not just about <code>InputSteam</code>, this class is a good example of a bad design. I&#39;m talking about three overloaded methods <code>read()</code>. I&#39;ve mentioned this problem in Section 2.9 of <a href="/elegant-objects.html">Elegant Objects</a>. In a few words, I strongly believe that interfaces must be &quot;functionality poor.&quot; <code>InputStream</code> should have been an interface in the first place and it should have had a single method <code>read(byte[])</code>. Then if its authors wanted to give us extra functionality, they should have created supplementary &quot;smart&quot; classes.</p><figure class='jb_picture'><img itemprop='image' alt='A Serious Man (2009) by Coen Brothers' src='/images/2016/04/a-serious-man.jpg' longdesc='#490f983a'/><figcaption id='490f983a'>A Serious Man (2009) by Coen Brothers</figcaption></figure><p>This is how it looks now:</p><figure class="highlight"><pre><code class="language-java" data-lang="java"><span></span><span class="kd">abstract</span> <span class="kd">class</span> <span class="nc">InputStream</span> <span class="o">{</span>
  <span class="kt">int</span> <span class="nf">read</span><span class="o">();</span>
  <span class="kt">int</span> <span class="nf">read</span><span class="o">(</span><span class="kt">byte</span><span class="o">[]</span> <span class="n">buffer</span><span class="o">,</span> <span class="kt">int</span> <span class="n">offset</span><span class="o">,</span> <span class="kt">int</span> <span class="n">length</span><span class="o">);</span>
  <span class="kt">int</span> <span class="nf">read</span><span class="o">(</span><span class="kt">byte</span><span class="o">[]</span> <span class="n">buffer</span><span class="o">);</span>
<span class="o">}</span></code></pre></figure><p>What&#39;s wrong? It&#39;s very convenient to have the ability to read a single byte, an array of bytes or even an array of bytes with a direct positioning into a specific place in the buffer!</p><aside class='youtube'> <a href='https://www.youtube.com/watch?v=Xk9tIqwca3k'><div class='box'> <img src='https://i.ytimg.com/vi/Xk9tIqwca3k/mqdefault.jpg' alt='YouTube video #Xk9tIqwca3k'/><div class='play'><i class='icon icon-play'></i></div></div></a><div>Smart Classes and Functionality-Poor Interfaces (webinar #16); 7 July 2016.</div></aside><p>However, we are still lacking a few methods: for reading the bytes and immediately saving into a file, converting to a text with a selected encoding, sending them by email and posting on Twitter. It would be great to have the features too, right in the poor <code>InputStream</code>. I hope the Oracle Java team is working on them now.</p><p>In the mean time, let&#39;s see what exactly is wrong with what these bright engineers designed for us already. Or maybe let me show how I would design <code>InputStream</code> and we&#39;ll compare:</p><figure class="highlight"><pre><code class="language-java" data-lang="java"><span></span><span class="kd">interface</span> <span class="nc">InputStream</span> <span class="o">{</span>
  <span class="kt">int</span> <span class="nf">read</span><span class="o">(</span><span class="kt">byte</span><span class="o">[]</span> <span class="n">buffer</span><span class="o">,</span> <span class="kt">int</span> <span class="n">offset</span><span class="o">,</span> <span class="kt">int</span> <span class="n">length</span><span class="o">);</span>
<span class="o">}</span></code></pre></figure><p>This is my design. The <code>InputStream</code> is responsible for reading bytes from the stream. There is one single method for this feature. Is it convenient for everybody? Does it read and post on Twitter? Not yet. Do we need that functionality? Of course we do, but it doesn&#39;t mean that we will add it to the interface. Instead, we will create supplementary &quot;smart&quot; class:</p><figure class="highlight"><pre><code class="language-java" data-lang="java"><span></span><span class="kd">interface</span> <span class="nc">InputStream</span> <span class="o">{</span>
  <span class="kt">int</span> <span class="nf">read</span><span class="o">(</span><span class="kt">byte</span><span class="o">[]</span> <span class="n">buffer</span><span class="o">,</span> <span class="kt">int</span> <span class="n">offset</span><span class="o">,</span> <span class="kt">int</span> <span class="n">length</span><span class="o">);</span>
  <span class="kd">class</span> <span class="nc">Smart</span> <span class="o">{</span>
    <span class="kd">private</span> <span class="kd">final</span> <span class="n">InputStream</span> <span class="n">origin</span><span class="o">;</span>
    <span class="kd">public</span> <span class="nf">Smart</span><span class="o">(</span><span class="n">InputStream</span> <span class="n">stream</span><span class="o">)</span> <span class="o">{</span>
      <span class="k">this</span><span class="o">.</span><span class="na">origin</span> <span class="o">=</span> <span class="n">stream</span><span class="o">;</span>
    <span class="o">}</span>
    <span class="kd">public</span> <span class="kt">int</span> <span class="nf">read</span><span class="o">()</span> <span class="o">{</span>
      <span class="kd">final</span> <span class="kt">byte</span><span class="o">[]</span> <span class="n">buffer</span> <span class="o">=</span> <span class="k">new</span> <span class="kt">byte</span><span class="o">[</span><span class="mi">1</span><span class="o">];</span>
      <span class="kd">final</span> <span class="kt">int</span> <span class="n">read</span> <span class="o">=</span> <span class="k">this</span><span class="o">.</span><span class="na">origin</span><span class="o">.</span><span class="na">read</span><span class="o">(</span><span class="n">buffer</span><span class="o">,</span> <span class="mi">0</span><span class="o">,</span> <span class="mi">1</span><span class="o">);</span>
      <span class="kd">final</span> <span class="kt">int</span> <span class="n">result</span><span class="o">;</span>
      <span class="k">if</span> <span class="o">(</span><span class="n">read</span> <span class="o">&lt;</span> <span class="mi">1</span><span class="o">)</span> <span class="o">{</span>
        <span class="n">result</span> <span class="o">=</span> <span class="o">-</span><span class="mi">1</span><span class="o">;</span>
      <span class="o">}</span> <span class="k">else</span> <span class="o">{</span>
        <span class="n">result</span> <span class="o">=</span> <span class="n">buffer</span><span class="o">[</span><span class="mi">0</span><span class="o">];</span>
      <span class="o">}</span>
      <span class="k">return</span> <span class="n">result</span><span class="o">;</span>
    <span class="o">}</span>
  <span class="o">}</span>
<span class="o">}</span></code></pre></figure><p>Now, we want to read a single byte from the stream. Here is how:</p><figure class="highlight"><pre><code class="language-java" data-lang="java"><span></span><span class="kd">final</span> <span class="n">InputStream</span> <span class="n">input</span> <span class="o">=</span> <span class="k">new</span> <span class="n">FileInputStream</span><span class="o">(</span><span class="s">&quot;/tmp/a.txt&quot;</span><span class="o">);</span>
<span class="kd">final</span> <span class="kt">byte</span> <span class="n">b</span> <span class="o">=</span> <span class="k">new</span> <span class="n">InputStream</span><span class="o">.</span><span class="na">Smart</span><span class="o">(</span><span class="n">input</span><span class="o">).</span><span class="na">read</span><span class="o">();</span></code></pre></figure><p>The functionality of reading a single byte is outside of <code>InputStream</code>, because this is not its business. The stream doesn&#39;t need to know how to manage the data after it is read. All the stream is <strong>responsible</strong> for is reading, not parsing or manipulating afterwards.</p><p>Interfaces must be small.</p><p>Obviously, method overloading in interfaces is a code smell. An interface with more than <strong>three methods</strong> is a good candidate for refactoring. If methods overload each other---it&#39;s serious trouble.</p><p>Interfaces must be small!</p><p>You may say that the creators of <code>InputStream</code> cared about performance, that&#39;s why allowed us to implement <code>read()</code> in three different forms. Then I have to ask again, why not create a method for reading and immediately post it on Twitter? That would be fantastically fast. Isn&#39;t it what we all want? A fast software which nobody has any desire to read or maintain.</p></div></article></div><div class="wrapper"> <related-posts /></div><div class="disqus" role="complementary"><p class="disqus_hint"> Please, use <a href="https://help.disqus.com/commenting/what-html-tags-are-allowed-within-comments">syntax highlighting</a> in your comments, to make them more readable.</p><div id="disqus_thread" class="disqus-thread"> <a>&nbsp;</a></div><script> var disqus_config = function () { this.page.url = document.location.href.split('?')[0].split('#')[0].replace('https://', 'http://'); this.page.identifier = this.page.url; }; (function() { var d = document, s = d.createElement('script'); s.src = '//yegor256.disqus.com/embed.js'; s.setAttribute('data-timestamp', +new Date()); (d.head || d.body).appendChild(s); })(); </script> <noscript><div><p class="red"> JavaScript is disabled in your browser, that's why you can't see comments under this post.</p></div></noscript></div><div class="wrapper"> <footer class="footer"><p> &copy; <span itemscope="" itemprop="copyrightHolder" itemtype="http://schema.org/Person"> <span itemprop="name">Yegor Bugayenko</span> </span> 2014&ndash;<span itemprop="copyrightYear">2018</span></p></footer></div></section><div class="wrapper unprintable" style="text-align:center;margin-top:2em;"> <a href="http://www.sixnines.io/h/3ba1652f"> <img src="//www.sixnines.io/b/3ba1652f?style=flat" alt="sixnines availability badge"/> </a></div><script src="//code.jquery.com/jquery-1.9.0.min.js"></script> <script src="/js/all.js?a0e0d018c07"></script> <script>var disqus_shortname = 'yegor256';</script> <script id="dsq-count-scr" src="//yegor256.disqus.com/count.js" async="async"></script> <script> (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){ (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o), m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m) })(window,document,'script','//www.google-analytics.com/analytics.js','ga'); ga('create', 'UA-1963507-32', 'auto'); ga('send', 'pageview'); </script> <script> Cd=document;Cr="&"+Math.random();Cp="&s=1"; Cd.cookie="b=b";if(Cd.cookie)Cp+="&c=1"; Cp+="&t="+(new Date()).getTimezoneOffset(); if(self!=top)Cp+="&f=1"; </script> <script> if(navigator.javaEnabled())Cp+="&j=1"; </script> <script> if(typeof(screen)!='undefined')Cp+="&w="+screen.width+"&h="+ screen.height+"&d="+(screen.colorDepth?screen.colorDepth:screen.pixelDepth); </script> <script> Cd.write("<img src='//c.hit.ua/hit?i=95870&g=0&x=2"+Cp+Cr+ "&r="+escape(Cd.referrer)+"&u="+escape(window.location.href)+ "' border='0' wi"+"dth='1' he"+"ight='1'/>"); </script> <script type="application/ld+json"> { "@context": "http://schema.org", "@type": "Person", "name": "Yegor Bugayenko", "url": "http://www.yegor256.com", "sameAs": [ "https://www.facebook.com/yegor256", "https://instagram.com/yegor256", "https://www.linkedin.com/in/yegor256", "https://twitter.com/yegor256", "https://github.com/yegor256", "https://www.pinterest.com/yegor256/" ] } </script> </body> </html> <!DOCTYPE html> <html xmlns="http://www.w3.org/1999/xhtml" lang="en-US" xml:lang="en-US" itemscope="" itemtype="http://schema.org/WebSite"> <head> <meta charset="utf-8"/> <meta name="description" content="Using object properties as configuration parameters for object behavior is a bad practice that leads to bigger and less cohesive objects. " /> <meta name="keywords" content="decorator pattern, decorator pattern java, object configuration, parameters object, settings object" /> <meta name="viewport" content="width=device-width,minimum-scale=1,initial-scale=1"/> <meta name="google-site-verification" content="JEj_gQr2CPe2QKGw8XdMz0R7VboQIUbX3FlM-lwTq-8" /> <meta name="author" content="Yegor Bugayenko"> <meta name="article:published_time" content="2016-04-19 00:00:00 +0000"> <meta name="og:site_name" content="Yegor Bugayenko"/> <meta name="og:type" content="article" /> <meta name="og:locale" content="en_US" /> <meta name="twitter:account_id" content="4503599630178231" /> <meta name="twitter:creator" content="@yegor256"/> <meta name="twitter:site" content="@yegor256"/> <meta name="twitter:title" property="og:title" content="Object Behavior Must Not Be Configurable"/> <meta name="twitter:description" property="og:description" content="Using object properties as configuration parameters for object behavior is a bad practice that leads to bigger and less cohesive objects. "/> <meta name="twitter:url" property="og:url" content="https://www.yegor256.com/2016/04/19/object-must-not-be-configurable.html"/> <meta name="telegram:channel" content="AAAAAEJFMRzsRTRxM3ec6A"/> <link rel="search" type="application/opensearchdescription+xml" href="/opensearch.xml" title="yegor256" /> <link rel="shortcut icon" href="/favicon.ico?a0e0d018c07"/> <link rel="apple-touch-icon" href="/favicon.ico?a0e0d018c07"/> <link rel="alternate" type="application/rss+xml" title="RSS for yegor256.com" href="https://www.yegor256.com/rss.xml"/> <link rel="stylesheet" href="/css/layout.css?a0e0d018c07"/> <link rel="stylesheet" href="/css/icons.css?a0e0d018c07"/> <link rel="canonical" href="https://www.yegor256.com/2016/04/19/object-must-not-be-configurable.html" /> <link rel="amphtml" href="https://www.yegor256.com/2016/04/19/object-must-not-be-configurable.amp.html" /> <title>Object Behavior Must Not Be Configurable </title> <meta name='og:image' content='https://www.yegor256.com/images/2016/04/the-take.jpg'/><meta name='twitter:image' content='https://www.yegor256.com/images/2016/04/the-take.jpg'/><meta name='og:image:width' content='1200'/> <meta name='twitter:image:width' content='1200'/><meta name='og:image:height' content='677'/> <meta name='twitter:image:height' content='677'/><meta name='twitter:card' content='summary_large_image'/><meta name='twitter:image:alt' content='The Take (2009) by David Drury'/> </head> <body><div class="wrapper"> <aside class="header-toggle unprintable" id="header-toggle" title="Show the menu" onclick="$('#header').show();$('#header-toggle').hide();">&#9776;</aside> <header class="header" id="header"><div class="face"> <a href="/about-me.html#form" class="sub" title="Click to subscribe to my monthly newsletter"><span>Subscribe</span></a> <a href="/about-me.html" style="position:relative;"> <img src="/images/face-256x256.jpg" class="photo" alt="Yegor Bugayenko"/> </a></div><nav><ul class="menu social notranslate"> <li><a href="https://twitter.com/intent/follow?screen_name=yegor256" rel="nofollow" title="Follow me on Twitter"><i class="icon icon-twitter notranslate" aria-hidden="true"></i></a></li> <li><a href="/rss.xml" rel="nofollow" title="Subscribe to my RSS feed"><i class="icon icon-rss notranslate" aria-hidden="true"></i></a></li> <li><a itemprop="sameAs" href="https://github.com/yegor256" rel="nofollow" title="My GitHub profile"><i class="icon icon-github notranslate" aria-hidden="true"></i></a></li> <li><a itemprop="sameAs" href="http://stackoverflow.com/users/187141/yegor256" rel="nofollow" title="My StackOverflow profile"><i class="icon icon-stackoverflow notranslate" aria-hidden="true"></i></a></li> <li><a itemprop="sameAs" href="https://www.facebook.com/yegor256" rel="nofollow" title="Follow me on Facebook"><i class="icon icon-facebook notranslate" aria-hidden="true"></i></a></li> <li><a itemprop="sameAs" href="https://instagram.com/yegor256" rel="nofollow" title="Follow me on Instagram"><i class="icon icon-instagram notranslate" aria-hidden="true"></i></a></li> <li><a itemprop="sameAs" href="https://www.linkedin.com/in/yegor256" rel="nofollow" title="My LinkedIn profile"><i class="icon icon-linkedin notranslate" aria-hidden="true"></i></a></li> <li><a itemprop="sameAs" href="https://www.youtube.com/c/yegor256?sub_confirmation=1" rel="nofollow" title="My Youtube video channel"><i class="icon icon-youtube notranslate" aria-hidden="true"></i></a></li> <li><a itemprop="sameAs" href="https://www.pinterest.com/yegor256/" rel="nofollow" title="My Pinterest boards"><i class="icon icon-pinterest notranslate" aria-hidden="true"></i></a></li> <li><a itemprop="sameAs" href="https://angel.co/yegor256" rel="nofollow" title="My AngelList profile"><i class="icon icon-angellist notranslate" aria-hidden="true"></i></a></li> <li><a href="https://soundcloud.com/yegor256" rel="nofollow" title="My podcast"><i class="icon icon-podcast notranslate" aria-hidden="true"></i></a></li> <li><a href="https://itunes.apple.com/us/podcast/yegor256-podcast/id1150826721" rel="nofollow" title="My iTunes podcast"><i class="icon icon-itunes notranslate" aria-hidden="true"></i></a></li> <li><a href="https://t.me/joinchat/AAAAAEJFMRzsRTRxM3ec6A" rel="nofollow" title="My Telegram public channel"><i class="icon icon-telegram notranslate" aria-hidden="true"></i></a></li> <li><a href="mailto:blog@yegor256.com" rel="nofollow" title="Email me any time"><i class="icon icon-mail notranslate" aria-hidden="true"></i></a></li></ul><ul class="menu"> <li><a href="/" title="Home page">Home</a></li> <li ><a href="/best.html" title="Best articles to read">12&#160;Best</a></li> <li ><a href="/contents.html" title="The contents of the entire blog">All&#160;288</a></li> <li ><a href="/webinars.html" title="My webinars">Webinars</a></li> <li ><a href="/talks.html" title="Future and past conference talks">Talks</a></li> <li ><a href="/books.html" title="The books I wrote">Books</a></li> <li ><a href="/papers.html" title="My academic papers and patents">Papers</a></li> <li ><a href="/pets.html" title="My loved pet projects">Pets</a></li> <li ><a href="/award.html" title="Software quality award">Award</a></li> <li ><a href="/testimonials.html" title="What some people say about me">Testimonials</a></li> <li ><a href="/shift-m.html" title="Audio podcast about project management">Shift-M</a></li> <li ><a href="/paintings.html" title="My paintings for sale">Paintings</a></li> <li><a href="http://ru.yegor256.com/" title="Немного на русском языке">По-русски</a></li></ul></nav><div class="search"> <form method="get" action="https://www.google.com/search" itemprop="potentialAction" itemscope="" itemtype="http://schema.org/SearchAction"> <meta itemprop="target" content="https://www.google.com/search?q={q}"/> <input name="sitesearch" value="yegor256.com" type="hidden"/> <input itemprop="query-input" type="text" id="search-query" class="field field-text" required="required" onfocus="$('.google').css('visibility', 'visible');" name="q" placeholder="Search..." autocomplete="off"/> <input type="image" src="/images/google-search-icon.svg" class="google" title="Search via Google" alt="Search via Google"/> </form></div><div class="hot"><ul> <li> <a href="/code-ahead.html">Code Ahead</a> was published on Amazon just a few days ago! It is my new book, a novel about programmers. It explains in details the majority of ideas that stand behind <a href="https://www.zerocracy.com">Zerocracy</a> and <a href="https://www.xdsd.org">XDSD</a>. </li> <li> At <a href="/webinars.html">Webinar #37</a> we will discuss naming problem in OOP, for objects, methods and attributes; join us on <b>September 12</b>, at 11am PST. </li></ul></div></header></div><section itemscope="" itemtype="http://schema.org/BlogPosting"><div class="wrapper"> <header><p class="printable"> <img src="https://api.qrserver.com/v1/create-qr-code/?data=https://www.yegor256.com/2016/04/19/object-must-not-be-configurable.html&amp;format=svg" style="width:125px;height:125px;" alt="QR code"/></p><p class="printable"> <code itemprop="url">https://www.yegor256.com/2016/04/19/object-must-not-be-configurable.html</code></p><h1 itemprop="name headline mainEntityOfPage">Object Behavior Must Not Be Configurable</h1><aside class='book'><a href='http://amzn.to/2pyceWc'><img src='/images/books/elegant-objects/cover.png' class='book-cover' alt='book cover'/></a>Read more about this subject in <a href='http://amzn.to/2pyceWc'>Section&nbsp;5.5</a><br/> of my book<a href='http://amzn.to/2pyceWc'><img src='/images/books/amazon-buy-button.png' class='amazon-button' alt='Click to buy'/></a></aside><ul class="subline"> <li> <time itemprop="datePublished" datetime="2016-04-19T00:00:00+00:00"> 19 April 2016 </time> </li> <li class="desktop-only" itemprop="locationCreated">New York, NY</li> <li class="printable" itemscope="" itemprop="author" itemtype="http://schema.org/Person"> <span itemprop="name">Yegor Bugayenko</span> </li> <li class="unprintable"> <i class="icon icon-comments"></i> <a href="http://www.yegor256.com/2016/04/19/object-must-not-be-configurable.html#disqus_thread" itemprop="discussionUrl">comments</a> </li></ul><p class="unprintable"><p>Using object properties as configuration parameters is a very common mistake we keep making mostly because our objects are mutable---we <strong>configure</strong> them. We change their behavior by injecting parameters or even entire settings/configuration objects into them. Do I have to say that it&#39;s abusive and disrespectful from a <a href="/2014/11/20/seven-virtues-of-good-object.html">philosophical</a> point of view? I can, but let&#39;s take a look at it from a practical perspective.</p><figure class='jb_picture'><img itemprop='image' alt='The Take (2009) by David Drury' src='/images/2016/04/the-take.jpg' longdesc='#b28b6a76'/><figcaption id='b28b6a76'>The Take (2009) by David Drury</figcaption></figure><p>Let&#39;s say there is a class that is supposed to read a web page and return its content:</p><figure class="highlight"><pre><code class="language-java" data-lang="java"><span></span><span class="kd">class</span> <span class="nc">Page</span> <span class="o">{</span>
  <span class="kd">private</span> <span class="kd">final</span> <span class="n">String</span> <span class="n">uri</span><span class="o">;</span>
  <span class="n">Page</span><span class="o">(</span><span class="kd">final</span> <span class="n">String</span> <span class="n">address</span><span class="o">)</span> <span class="o">{</span>
    <span class="k">this</span><span class="o">.</span><span class="na">uri</span> <span class="o">=</span> <span class="n">address</span><span class="o">;</span>
  <span class="o">}</span>
  <span class="kd">public</span> <span class="n">String</span> <span class="nf">html</span><span class="o">()</span> <span class="kd">throws</span> <span class="n">IOException</span> <span class="o">{</span>
    <span class="k">return</span> <span class="n">IOUtils</span><span class="o">.</span><span class="na">toString</span><span class="o">(</span>
      <span class="k">new</span> <span class="n">URL</span><span class="o">(</span><span class="k">this</span><span class="o">.</span><span class="na">uri</span><span class="o">).</span><span class="na">openStream</span><span class="o">(),</span>
      <span class="s">&quot;UTF-8&quot;</span>
    <span class="o">);</span>
  <span class="o">}</span>
<span class="o">}</span></code></pre></figure><p>Looks simple and straight-forward, right? Yes, it&#39;s a rather cohesive and solid class. Here is how we use it to read the content of Google front page:</p><figure class="highlight"><pre><code class="language-java" data-lang="java"><span></span><span class="n">String</span> <span class="n">html</span> <span class="o">=</span> <span class="k">new</span> <span class="n">Page</span><span class="o">(</span><span class="s">&quot;http://www.google.com&quot;</span><span class="o">).</span><span class="na">html</span><span class="o">();</span></code></pre></figure><p>Everything is fine until we start making this class more powerful. Let&#39;s say we want to configure the encoding. We don&#39;t always want to use <code>&quot;UTF-8&quot;</code>. We want it to be configurable. Here is what we do:</p><figure class="highlight"><pre><code class="language-java" data-lang="java"><span></span><span class="kd">class</span> <span class="nc">Page</span> <span class="o">{</span>
  <span class="kd">private</span> <span class="kd">final</span> <span class="n">String</span> <span class="n">uri</span><span class="o">;</span>
  <span class="kd">private</span> <span class="kd">final</span> <span class="n">String</span> <span class="n">encoding</span><span class="o">;</span>
  <span class="n">Page</span><span class="o">(</span><span class="kd">final</span> <span class="n">String</span> <span class="n">address</span><span class="o">,</span> <span class="kd">final</span> <span class="n">String</span> <span class="n">enc</span><span class="o">)</span> <span class="o">{</span>
    <span class="k">this</span><span class="o">.</span><span class="na">uri</span> <span class="o">=</span> <span class="n">address</span><span class="o">;</span>
    <span class="k">this</span><span class="o">.</span><span class="na">encoding</span> <span class="o">=</span> <span class="n">enc</span><span class="o">;</span>
  <span class="o">}</span>
  <span class="kd">public</span> <span class="n">String</span> <span class="nf">html</span><span class="o">()</span> <span class="kd">throws</span> <span class="n">IOException</span> <span class="o">{</span>
    <span class="k">return</span> <span class="n">IOUtils</span><span class="o">.</span><span class="na">toString</span><span class="o">(</span>
      <span class="k">new</span> <span class="n">URL</span><span class="o">(</span><span class="k">this</span><span class="o">.</span><span class="na">uri</span><span class="o">).</span><span class="na">openStream</span><span class="o">(),</span>
      <span class="k">this</span><span class="o">.</span><span class="na">encoding</span>
    <span class="o">);</span>
  <span class="o">}</span>
<span class="o">}</span></code></pre></figure><p>Done, the encoding is encapsulated and configurable. Now, let&#39;s say we want to change the behavior of the class for the situation of an empty page. If an empty page is loaded, we want to return <code>&quot;&lt;html/&gt;&quot;</code>. But not always. We want this to be configurable. Here is what we do:</p><figure class="highlight"><pre><code class="language-java" data-lang="java"><span></span><span class="kd">class</span> <span class="nc">Page</span> <span class="o">{</span>
  <span class="kd">private</span> <span class="kd">final</span> <span class="n">String</span> <span class="n">uri</span><span class="o">;</span>
  <span class="kd">private</span> <span class="kd">final</span> <span class="n">String</span> <span class="n">encoding</span><span class="o">;</span>
  <span class="kd">private</span> <span class="kd">final</span> <span class="kt">boolean</span> <span class="n">alwaysHtml</span><span class="o">;</span>
  <span class="n">Page</span><span class="o">(</span><span class="kd">final</span> <span class="n">String</span> <span class="n">address</span><span class="o">,</span> <span class="kd">final</span> <span class="n">String</span> <span class="n">enc</span><span class="o">,</span>
    <span class="kd">final</span> <span class="kt">boolean</span> <span class="n">always</span><span class="o">)</span> <span class="o">{</span>
    <span class="k">this</span><span class="o">.</span><span class="na">uri</span> <span class="o">=</span> <span class="n">address</span><span class="o">;</span>
    <span class="k">this</span><span class="o">.</span><span class="na">encoding</span> <span class="o">=</span> <span class="n">enc</span><span class="o">;</span>
    <span class="k">this</span><span class="o">.</span><span class="na">alwaysHtml</span> <span class="o">=</span> <span class="n">always</span><span class="o">;</span>
  <span class="o">}</span>
  <span class="kd">public</span> <span class="n">String</span> <span class="nf">html</span><span class="o">()</span> <span class="kd">throws</span> <span class="n">IOException</span> <span class="o">{</span>
    <span class="n">String</span> <span class="n">html</span> <span class="o">=</span> <span class="n">IOUtils</span><span class="o">.</span><span class="na">toString</span><span class="o">(</span>
      <span class="k">new</span> <span class="n">URL</span><span class="o">(</span><span class="k">this</span><span class="o">.</span><span class="na">uri</span><span class="o">).</span><span class="na">openStream</span><span class="o">(),</span>
      <span class="k">this</span><span class="o">.</span><span class="na">encoding</span>
    <span class="o">);</span>
    <span class="k">if</span> <span class="o">(</span><span class="n">html</span><span class="o">.</span><span class="na">isEmpty</span><span class="o">()</span> <span class="o">&amp;&amp;</span> <span class="k">this</span><span class="o">.</span><span class="na">alwaysHtml</span><span class="o">)</span> <span class="o">{</span>
      <span class="n">html</span> <span class="o">=</span> <span class="s">&quot;&lt;html/&gt;&quot;</span><span class="o">;</span>
    <span class="o">}</span>
    <span class="k">return</span> <span class="n">html</span><span class="o">;</span>
  <span class="o">}</span>
<span class="o">}</span></code></pre></figure><p>The class is getting bigger, huh? It&#39;s great, we&#39;re good programmers and our code must be complex, right? The more complex it is, the better programmers we are! I&#39;m being sarcastic. Definitely <a href="/2015/06/29/simple-diagrams.html">not</a>! But let&#39;s move on. Now we want our class to proceed anyway, even if the encoding is not supported on the current platform:</p><figure class="highlight"><pre><code class="language-java" data-lang="java"><span></span><span class="kd">class</span> <span class="nc">Page</span> <span class="o">{</span>
  <span class="kd">private</span> <span class="kd">final</span> <span class="n">String</span> <span class="n">uri</span><span class="o">;</span>
  <span class="kd">private</span> <span class="kd">final</span> <span class="n">String</span> <span class="n">encoding</span><span class="o">;</span>
  <span class="kd">private</span> <span class="kd">final</span> <span class="kt">boolean</span> <span class="n">alwaysHtml</span><span class="o">;</span>
  <span class="kd">private</span> <span class="kd">final</span> <span class="kt">boolean</span> <span class="n">encodeAnyway</span><span class="o">;</span>
  <span class="n">Page</span><span class="o">(</span><span class="kd">final</span> <span class="n">String</span> <span class="n">address</span><span class="o">,</span> <span class="kd">final</span> <span class="n">String</span> <span class="n">enc</span><span class="o">,</span>
    <span class="kd">final</span> <span class="kt">boolean</span> <span class="n">always</span><span class="o">,</span> <span class="kd">final</span> <span class="kt">boolean</span> <span class="n">encode</span><span class="o">)</span> <span class="o">{</span>
    <span class="k">this</span><span class="o">.</span><span class="na">uri</span> <span class="o">=</span> <span class="n">address</span><span class="o">;</span>
    <span class="k">this</span><span class="o">.</span><span class="na">encoding</span> <span class="o">=</span> <span class="n">enc</span><span class="o">;</span>
    <span class="k">this</span><span class="o">.</span><span class="na">alwaysHtml</span> <span class="o">=</span> <span class="n">always</span><span class="o">;</span>
    <span class="k">this</span><span class="o">.</span><span class="na">encodeAnyway</span> <span class="o">=</span> <span class="n">encode</span><span class="o">;</span>
  <span class="o">}</span>
  <span class="kd">public</span> <span class="n">String</span> <span class="nf">html</span><span class="o">()</span> <span class="kd">throws</span> <span class="n">IOException</span><span class="o">,</span>
  <span class="n">UnsupportedEncodingException</span> <span class="o">{</span>
    <span class="kd">final</span> <span class="kt">byte</span><span class="o">[]</span> <span class="n">bytes</span> <span class="o">=</span> <span class="n">IOUtils</span><span class="o">.</span><span class="na">toByteArray</span><span class="o">(</span>
      <span class="k">new</span> <span class="n">URL</span><span class="o">(</span><span class="k">this</span><span class="o">.</span><span class="na">uri</span><span class="o">).</span><span class="na">openStream</span><span class="o">()</span>
    <span class="o">);</span>
    <span class="n">String</span> <span class="n">html</span><span class="o">;</span>
    <span class="k">try</span> <span class="o">{</span>
      <span class="n">html</span> <span class="o">=</span> <span class="k">new</span> <span class="n">String</span><span class="o">(</span><span class="n">bytes</span><span class="o">,</span> <span class="k">this</span><span class="o">.</span><span class="na">encoding</span><span class="o">);</span>
    <span class="o">}</span> <span class="k">catch</span> <span class="o">(</span><span class="n">UnsupportedEncodingException</span> <span class="n">ex</span><span class="o">)</span> <span class="o">{</span>
      <span class="k">if</span> <span class="o">(!</span><span class="k">this</span><span class="o">.</span><span class="na">encodeAnyway</span><span class="o">)</span> <span class="o">{</span>
        <span class="k">throw</span> <span class="n">ex</span><span class="o">;</span>
      <span class="o">}</span>
      <span class="n">html</span> <span class="o">=</span> <span class="k">new</span> <span class="n">String</span><span class="o">(</span><span class="n">bytes</span><span class="o">,</span> <span class="s">&quot;UTF-8&quot;</span><span class="o">)</span>
    <span class="o">}</span>
    <span class="k">if</span> <span class="o">(</span><span class="n">html</span><span class="o">.</span><span class="na">isEmpty</span><span class="o">()</span> <span class="o">&amp;&amp;</span> <span class="k">this</span><span class="o">.</span><span class="na">alwaysHtml</span><span class="o">)</span> <span class="o">{</span>
      <span class="n">html</span> <span class="o">=</span> <span class="s">&quot;&lt;html/&gt;&quot;</span><span class="o">;</span>
    <span class="o">}</span>
    <span class="k">return</span> <span class="n">html</span><span class="o">;</span>
  <span class="o">}</span>
<span class="o">}</span></code></pre></figure><p>The class is growing and becoming more and more powerful! Now it&#39;s time to introduce a new class, which we will call <code>PageSettings</code>:</p><figure class="highlight"><pre><code class="language-java" data-lang="java"><span></span><span class="kd">class</span> <span class="nc">Page</span> <span class="o">{</span>
  <span class="kd">private</span> <span class="kd">final</span> <span class="n">String</span> <span class="n">uri</span><span class="o">;</span>
  <span class="kd">private</span> <span class="kd">final</span> <span class="n">PageSettings</span> <span class="n">settings</span><span class="o">;</span>
  <span class="n">Page</span><span class="o">(</span><span class="kd">final</span> <span class="n">String</span> <span class="n">address</span><span class="o">,</span> <span class="kd">final</span> <span class="n">PageSettings</span> <span class="n">stts</span><span class="o">)</span> <span class="o">{</span>
    <span class="k">this</span><span class="o">.</span><span class="na">uri</span> <span class="o">=</span> <span class="n">address</span><span class="o">;</span>
    <span class="k">this</span><span class="o">.</span><span class="na">settings</span> <span class="o">=</span> <span class="n">stts</span><span class="o">;</span>
  <span class="o">}</span>
  <span class="kd">public</span> <span class="n">String</span> <span class="nf">html</span><span class="o">()</span> <span class="kd">throws</span> <span class="n">IOException</span> <span class="o">{</span>
    <span class="kd">final</span> <span class="kt">byte</span><span class="o">[]</span> <span class="n">bytes</span> <span class="o">=</span> <span class="n">IOUtils</span><span class="o">.</span><span class="na">toByteArray</span><span class="o">(</span>
      <span class="k">new</span> <span class="n">URL</span><span class="o">(</span><span class="k">this</span><span class="o">.</span><span class="na">uri</span><span class="o">).</span><span class="na">openStream</span><span class="o">()</span>
    <span class="o">);</span>
    <span class="n">String</span> <span class="n">html</span><span class="o">;</span>
    <span class="k">try</span> <span class="o">{</span>
      <span class="n">html</span> <span class="o">=</span> <span class="k">new</span> <span class="n">String</span><span class="o">(</span><span class="n">bytes</span><span class="o">,</span> <span class="k">this</span><span class="o">.</span><span class="na">settings</span><span class="o">.</span><span class="na">getEncoding</span><span class="o">());</span>
    <span class="o">}</span> <span class="k">catch</span> <span class="o">(</span><span class="n">UnsupportedEncodingException</span> <span class="n">ex</span><span class="o">)</span> <span class="o">{</span>
      <span class="k">if</span> <span class="o">(!</span><span class="k">this</span><span class="o">.</span><span class="na">settings</span><span class="o">.</span><span class="na">isEncodeAnyway</span><span class="o">())</span> <span class="o">{</span>
        <span class="k">throw</span> <span class="n">ex</span><span class="o">;</span>
      <span class="o">}</span>
      <span class="n">html</span> <span class="o">=</span> <span class="k">new</span> <span class="n">String</span><span class="o">(</span><span class="n">bytes</span><span class="o">,</span> <span class="s">&quot;UTF-8&quot;</span><span class="o">)</span>
    <span class="o">}</span>
    <span class="k">if</span> <span class="o">(</span><span class="n">html</span><span class="o">.</span><span class="na">isEmpty</span><span class="o">()</span> <span class="o">&amp;&amp;</span> <span class="k">this</span><span class="o">.</span><span class="na">settings</span><span class="o">.</span><span class="na">isAlwaysHtml</span><span class="o">())</span> <span class="o">{</span>
      <span class="n">html</span> <span class="o">=</span> <span class="s">&quot;&lt;html/&gt;&quot;</span><span class="o">;</span>
    <span class="o">}</span>
    <span class="k">return</span> <span class="n">html</span><span class="o">;</span>
  <span class="o">}</span>
<span class="o">}</span></code></pre></figure><p>Class <code>PageSettings</code> is basically a holder of parameters, without any behavior. It has getters, which give us access to the parameters: <code>isEncodeAnyway()</code>, <code>isAlwaysHtml()</code>, and <code>getEncoding()</code>. If we keep going in this direction, there could be a few dozen configuration settings in that class. This may look very convenient and is a very typical pattern in Java world. For example, look at <a href="https://hadoop.apache.org/docs/r2.4.1/api/org/apache/hadoop/mapred/JobConf.html"><code>JobConf</code></a> from Hadoop. This is how we will call our highly configurable <code>Page</code> (I&#39;m assuming <code>PageSettings</code> is immutable):</p><figure class="highlight"><pre><code class="language-java" data-lang="java"><span></span><span class="n">String</span> <span class="n">html</span> <span class="o">=</span> <span class="k">new</span> <span class="n">Page</span><span class="o">(</span>
  <span class="s">&quot;http://www.google.com&quot;</span><span class="o">,</span>
  <span class="k">new</span> <span class="n">PageSettings</span><span class="o">()</span>
    <span class="o">.</span><span class="na">withEncoding</span><span class="o">(</span><span class="s">&quot;ISO_8859_1&quot;</span><span class="o">)</span>
    <span class="o">.</span><span class="na">withAlwaysHtml</span><span class="o">(</span><span class="kc">true</span><span class="o">)</span>
    <span class="o">.</span><span class="na">withEncodeAnyway</span><span class="o">(</span><span class="kc">false</span><span class="o">)</span>
<span class="o">).</span><span class="na">html</span><span class="o">();</span></code></pre></figure><p>However, no matter how convenient it may look at first glance, this approach is <strong>very wrong</strong>. Mostly because it encourages us to make big and non-cohesive objects. They grow in size and become less testable, less maintainable and less readable.</p><aside class='quote'>Encapsulated properties must not be used to change the behavior of an object</aside><p>To prevent that from happening, I would suggest a simple rule here: object behavior should not be configurable. Or, more technically, encapsulated properties must not be used to change the behavior of an object.</p><p>Object properties are there only to coordinate the location of a real-world entity, which the object is representing. The <code>uri</code> is the coordinate, while the <code>alwaysHtml</code> boolean property is a behavior changing trigger. See the difference?</p><p>So, what should we do instead? What is the right design? We must use <a href="/2015/02/26/composable-decorators.html">composable decorators</a>. Here is how:</p><figure class="highlight"><pre><code class="language-java" data-lang="java"><span></span><span class="n">Page</span> <span class="n">page</span> <span class="o">=</span> <span class="k">new</span> <span class="n">NeverEmptyPage</span><span class="o">(</span>
  <span class="k">new</span> <span class="n">DefaultPage</span><span class="o">(</span><span class="s">&quot;http://www.google.com&quot;</span><span class="o">)</span>
<span class="o">)</span>
<span class="n">String</span> <span class="n">html</span> <span class="o">=</span> <span class="k">new</span> <span class="n">AlwaysTextPage</span><span class="o">(</span>
  <span class="k">new</span> <span class="n">TextPage</span><span class="o">(</span><span class="n">page</span><span class="o">,</span> <span class="s">&quot;ISO_8859_1&quot;</span><span class="o">)</span>
  <span class="n">page</span>
<span class="o">).</span><span class="na">html</span><span class="o">();</span></code></pre></figure><p>Here is how our <code>DefaultPage</code> would look (yes, I had to change its design a bit):</p><figure class="highlight"><pre><code class="language-java" data-lang="java"><span></span><span class="kd">class</span> <span class="nc">DefaultPage</span> <span class="kd">implements</span> <span class="n">Page</span> <span class="o">{</span>
  <span class="kd">private</span> <span class="kd">final</span> <span class="n">String</span> <span class="n">uri</span><span class="o">;</span>
  <span class="n">DefaultPage</span><span class="o">(</span><span class="kd">final</span> <span class="n">String</span> <span class="n">address</span><span class="o">)</span> <span class="o">{</span>
    <span class="k">this</span><span class="o">.</span><span class="na">uri</span> <span class="o">=</span> <span class="n">address</span><span class="o">;</span>
  <span class="o">}</span>
  <span class="nd">@Override</span>
  <span class="kd">public</span> <span class="kt">byte</span><span class="o">[]</span> <span class="nf">html</span><span class="o">()</span> <span class="kd">throws</span> <span class="n">IOException</span> <span class="o">{</span>
    <span class="k">return</span> <span class="n">IOUtils</span><span class="o">.</span><span class="na">toByteArray</span><span class="o">(</span>
      <span class="k">new</span> <span class="n">URL</span><span class="o">(</span><span class="k">this</span><span class="o">.</span><span class="na">uri</span><span class="o">).</span><span class="na">openStream</span><span class="o">()</span>
    <span class="o">);</span>
  <span class="o">}</span>
<span class="o">}</span></code></pre></figure><p>As you see, I&#39;m making it implement interface <code>Page</code>. Now <code>TextPage</code> decorator, which converts an array of bytes to a text using provided encoding:</p><figure class="highlight"><pre><code class="language-java" data-lang="java"><span></span><span class="kd">class</span> <span class="nc">TextPage</span> <span class="o">{</span>
  <span class="kd">private</span> <span class="kd">final</span> <span class="n">Page</span> <span class="n">origin</span><span class="o">;</span>
  <span class="kd">private</span> <span class="kd">final</span> <span class="n">String</span> <span class="n">encoding</span><span class="o">;</span>
  <span class="n">TextPage</span><span class="o">(</span><span class="kd">final</span> <span class="n">Page</span> <span class="n">page</span><span class="o">,</span> <span class="kd">final</span> <span class="n">String</span> <span class="n">enc</span><span class="o">)</span> <span class="o">{</span>
    <span class="k">this</span><span class="o">.</span><span class="na">origin</span> <span class="o">=</span> <span class="n">page</span><span class="o">;</span>
    <span class="k">this</span><span class="o">.</span><span class="na">encoding</span> <span class="o">=</span> <span class="n">enc</span><span class="o">;</span>
  <span class="o">}</span>
  <span class="kd">public</span> <span class="n">String</span> <span class="nf">html</span><span class="o">()</span> <span class="kd">throws</span> <span class="n">IOException</span> <span class="o">{</span>
    <span class="k">return</span> <span class="k">new</span> <span class="n">String</span><span class="o">(</span>
      <span class="k">this</span><span class="o">.</span><span class="na">origin</span><span class="o">.</span><span class="na">html</span><span class="o">(),</span>
      <span class="k">this</span><span class="o">.</span><span class="na">encoding</span>
    <span class="o">);</span>
  <span class="o">}</span>
<span class="o">}</span></code></pre></figure><p>Now the <code>NeverEmptyPage</code>:</p><figure class="highlight"><pre><code class="language-java" data-lang="java"><span></span><span class="kd">class</span> <span class="nc">NeverEmptyPage</span> <span class="kd">implements</span> <span class="n">Page</span> <span class="o">{</span>
  <span class="kd">private</span> <span class="kd">final</span> <span class="n">Page</span> <span class="n">origin</span><span class="o">;</span>
  <span class="n">NeverEmptyPage</span><span class="o">(</span><span class="kd">final</span> <span class="n">Page</span> <span class="n">page</span><span class="o">)</span> <span class="o">{</span>
    <span class="k">this</span><span class="o">.</span><span class="na">origin</span> <span class="o">=</span> <span class="n">page</span><span class="o">;</span>
  <span class="o">}</span>
  <span class="nd">@Override</span>
  <span class="kd">public</span> <span class="kt">byte</span><span class="o">[]</span> <span class="nf">html</span><span class="o">()</span> <span class="kd">throws</span> <span class="n">IOException</span> <span class="o">{</span>
    <span class="kt">byte</span><span class="o">[]</span> <span class="n">bytes</span> <span class="o">=</span> <span class="k">this</span><span class="o">.</span><span class="na">origin</span><span class="o">.</span><span class="na">html</span><span class="o">();</span>
    <span class="k">if</span> <span class="o">(</span><span class="n">bytes</span><span class="o">.</span><span class="na">length</span> <span class="o">==</span> <span class="mi">0</span><span class="o">)</span> <span class="o">{</span>
      <span class="n">bytes</span> <span class="o">=</span> <span class="s">&quot;&lt;html/&gt;&quot;</span><span class="o">.</span><span class="na">getBytes</span><span class="o">();</span>
    <span class="o">}</span>
    <span class="k">return</span> <span class="n">bytes</span><span class="o">;</span>
  <span class="o">}</span>
<span class="o">}</span></code></pre></figure><p>And finally the <code>AlwaysTextPage</code>:</p><figure class="highlight"><pre><code class="language-java" data-lang="java"><span></span><span class="kd">class</span> <span class="nc">AlwaysTextPage</span> <span class="o">{</span>
  <span class="kd">private</span> <span class="kd">final</span> <span class="n">TextPage</span> <span class="n">origin</span><span class="o">;</span>
  <span class="kd">private</span> <span class="kd">final</span> <span class="n">Page</span> <span class="n">source</span><span class="o">;</span>
  <span class="n">AlwaysTextPage</span><span class="o">(</span><span class="kd">final</span> <span class="n">TextPage</span> <span class="n">page</span><span class="o">,</span> <span class="kd">final</span> <span class="n">Page</span> <span class="n">src</span><span class="o">)</span> <span class="o">{</span>
    <span class="k">this</span><span class="o">.</span><span class="na">origin</span> <span class="o">=</span> <span class="n">page</span><span class="o">;</span>
    <span class="k">this</span><span class="o">.</span><span class="na">source</span> <span class="o">=</span> <span class="n">src</span><span class="o">;</span>
  <span class="o">}</span>
  <span class="kd">public</span> <span class="n">String</span> <span class="nf">html</span><span class="o">()</span> <span class="kd">throws</span> <span class="n">IOException</span> <span class="o">{</span>
    <span class="n">String</span> <span class="n">html</span><span class="o">;</span>
    <span class="k">try</span> <span class="o">{</span>
      <span class="n">html</span> <span class="o">=</span> <span class="k">this</span><span class="o">.</span><span class="na">origin</span><span class="o">.</span><span class="na">html</span><span class="o">();</span>
    <span class="o">}</span> <span class="k">catch</span> <span class="o">(</span><span class="n">UnsupportedEncodingException</span> <span class="n">ex</span><span class="o">)</span> <span class="o">{</span>
      <span class="n">html</span> <span class="o">=</span> <span class="k">new</span> <span class="n">TextPage</span><span class="o">(</span><span class="k">this</span><span class="o">.</span><span class="na">source</span><span class="o">,</span> <span class="s">&quot;UTF-8&quot;</span><span class="o">).</span><span class="na">html</span><span class="o">();</span>
    <span class="o">}</span>
    <span class="k">return</span> <span class="n">html</span><span class="o">;</span>
  <span class="o">}</span>
<span class="o">}</span></code></pre></figure><p>You may say that <code>AlwaysTextPage</code> will make two calls to the encapsulated <code>origin</code>, in case of an unsupported encoding, which will lead to a duplicated HTTP request. That&#39;s true and this is by design. We don&#39;t want this duplicated HTTP roundtrip to happen. Let&#39;s introduce one more class, which will cache the page fetched ( <a href="/2017/01/17/synchronized-decorators.html">not thread-safe</a>, but it&#39;s not important now):</p><figure class="highlight"><pre><code class="language-java" data-lang="java"><span></span><span class="kd">class</span> <span class="nc">OncePage</span> <span class="kd">implements</span> <span class="n">Page</span> <span class="o">{</span>
  <span class="kd">private</span> <span class="kd">final</span> <span class="n">Page</span> <span class="n">origin</span><span class="o">;</span>
  <span class="kd">private</span> <span class="kd">final</span> <span class="n">AtomicReference</span><span class="o">&lt;</span><span class="kt">byte</span><span class="o">[]&gt;</span> <span class="n">cache</span> <span class="o">=</span>
    <span class="k">new</span> <span class="n">AtomicReference</span><span class="o">&lt;&gt;;</span>
  <span class="n">OncePage</span><span class="o">(</span><span class="kd">final</span> <span class="n">Page</span> <span class="n">page</span><span class="o">)</span> <span class="o">{</span>
    <span class="k">this</span><span class="o">.</span><span class="na">origin</span> <span class="o">=</span> <span class="n">page</span><span class="o">;</span>
  <span class="o">}</span>
  <span class="nd">@Override</span>
  <span class="kd">public</span> <span class="kt">byte</span><span class="o">[]</span> <span class="nf">html</span><span class="o">()</span> <span class="kd">throws</span> <span class="n">IOException</span> <span class="o">{</span>
    <span class="k">if</span> <span class="o">(</span><span class="k">this</span><span class="o">.</span><span class="na">cache</span><span class="o">.</span><span class="na">get</span><span class="o">()</span> <span class="o">==</span> <span class="kc">null</span><span class="o">)</span> <span class="o">{</span>
      <span class="k">this</span><span class="o">.</span><span class="na">cache</span><span class="o">.</span><span class="na">set</span><span class="o">(</span><span class="k">this</span><span class="o">.</span><span class="na">origin</span><span class="o">.</span><span class="na">html</span><span class="o">());</span>
    <span class="o">}</span>
    <span class="k">return</span> <span class="k">this</span><span class="o">.</span><span class="na">cache</span><span class="o">.</span><span class="na">get</span><span class="o">();</span>
  <span class="o">}</span>
<span class="o">}</span></code></pre></figure><p>Now, our code should look like this (pay attention, I&#39;m now using <code>OncePage</code>):</p><figure class="highlight"><pre><code class="language-java" data-lang="java"><span></span><span class="n">Page</span> <span class="n">page</span> <span class="o">=</span> <span class="k">new</span> <span class="n">NeverEmptyPage</span><span class="o">(</span>
  <span class="k">new</span> <span class="n">OncePage</span><span class="o">(</span>
    <span class="k">new</span> <span class="n">DefaultPage</span><span class="o">(</span><span class="s">&quot;http://www.google.com&quot;</span><span class="o">)</span>
  <span class="o">)</span>
<span class="o">)</span>
<span class="n">String</span> <span class="n">html</span> <span class="o">=</span> <span class="k">new</span> <span class="n">AlwaysTextPage</span><span class="o">(</span>
  <span class="k">new</span> <span class="n">TextPage</span><span class="o">(</span><span class="n">page</span><span class="o">,</span> <span class="s">&quot;ISO_8859_1&quot;</span><span class="o">)</span>
  <span class="s">&quot;UTF-8&quot;</span>
<span class="o">).</span><span class="na">html</span><span class="o">();</span></code></pre></figure><p>This is probably the most code-intensive post on this site so far, but I hope it&#39;s readable and I managed to convey the idea. Now we have five classes, each of which is rather small, easy to read and easy to reuse.</p><p>Just follow the rule: never make classes configurable!</p></p><nav class="buttons notranslate desktop-only"> <a href="http://www.facebook.com/sharer/sharer.php?u=https://www.yegor256.com/2016/04/19/object-must-not-be-configurable.html" title="Share on Facebook" class="button" rel="nofollow"> <span class="count count-facebook">0</span> <i class="icon icon-facebook notranslate" aria-hidden="true"></i> </a> <a href="https://twitter.com/share?url=https://www.yegor256.com/2016/04/19/object-must-not-be-configurable.html&amp;text=Object+Behavior+Must+Not+Be+Configurable" title="Share on Twitter" class="button" rel="nofollow"> <span class="count count-twitter">0</span> <i class="icon icon-twitter notranslate" aria-hidden="true"></i> </a> <a href="https://plus.google.com/share?url=https://www.yegor256.com/2016/04/19/object-must-not-be-configurable.html" title="Share on Google+" class="button" rel="nofollow"> <span class="count count-googleplus">0</span> <i class="icon icon-googleplus notranslate" aria-hidden="true"></i> </a> <a href="https://www.linkedin.com/cws/share?url=https://www.yegor256.com/2016/04/19/object-must-not-be-configurable.html" title="Share on LinkedIn" class="button" rel="nofollow"> <span class="count count-linkedin">0</span> <i class="icon icon-linkedin notranslate" aria-hidden="true"></i> </a> <a href="http://reddit.com/submit?url=https://www.yegor256.com/2016/04/19/object-must-not-be-configurable.html%3F2016-16&amp;title=Object+Behavior+Must+Not+Be+Configurable" title="Share on Reddit" class="button" rel="nofollow"> <span class="count count-reddit">0</span> <i class="icon icon-reddit notranslate" aria-hidden="true"></i> </a> <a href="http://news.ycombinator.com/submitlink?u=https://www.yegor256.com/2016/04/19/object-must-not-be-configurable.html%3F2016-16&amp;t=Object+Behavior+Must+Not+Be+Configurable" title="Share on Hacker News" class="button" rel="nofollow"> <span class="count count-hackernews">0</span> <i class="icon icon-hackernews notranslate" aria-hidden="true"></i> </a> </nav> </header> <article class="main" itemprop="articleBody"><div ><p>Using object properties as configuration parameters is a very common mistake we keep making mostly because our objects are mutable---we <strong>configure</strong> them. We change their behavior by injecting parameters or even entire settings/configuration objects into them. Do I have to say that it&#39;s abusive and disrespectful from a <a href="/2014/11/20/seven-virtues-of-good-object.html">philosophical</a> point of view? I can, but let&#39;s take a look at it from a practical perspective.</p><figure class='jb_picture'><img itemprop='image' alt='The Take (2009) by David Drury' src='/images/2016/04/the-take.jpg' longdesc='#b28b6a76'/><figcaption id='b28b6a76'>The Take (2009) by David Drury</figcaption></figure><p>Let&#39;s say there is a class that is supposed to read a web page and return its content:</p><figure class="highlight"><pre><code class="language-java" data-lang="java"><span></span><span class="kd">class</span> <span class="nc">Page</span> <span class="o">{</span>
  <span class="kd">private</span> <span class="kd">final</span> <span class="n">String</span> <span class="n">uri</span><span class="o">;</span>
  <span class="n">Page</span><span class="o">(</span><span class="kd">final</span> <span class="n">String</span> <span class="n">address</span><span class="o">)</span> <span class="o">{</span>
    <span class="k">this</span><span class="o">.</span><span class="na">uri</span> <span class="o">=</span> <span class="n">address</span><span class="o">;</span>
  <span class="o">}</span>
  <span class="kd">public</span> <span class="n">String</span> <span class="nf">html</span><span class="o">()</span> <span class="kd">throws</span> <span class="n">IOException</span> <span class="o">{</span>
    <span class="k">return</span> <span class="n">IOUtils</span><span class="o">.</span><span class="na">toString</span><span class="o">(</span>
      <span class="k">new</span> <span class="n">URL</span><span class="o">(</span><span class="k">this</span><span class="o">.</span><span class="na">uri</span><span class="o">).</span><span class="na">openStream</span><span class="o">(),</span>
      <span class="s">&quot;UTF-8&quot;</span>
    <span class="o">);</span>
  <span class="o">}</span>
<span class="o">}</span></code></pre></figure><p>Looks simple and straight-forward, right? Yes, it&#39;s a rather cohesive and solid class. Here is how we use it to read the content of Google front page:</p><figure class="highlight"><pre><code class="language-java" data-lang="java"><span></span><span class="n">String</span> <span class="n">html</span> <span class="o">=</span> <span class="k">new</span> <span class="n">Page</span><span class="o">(</span><span class="s">&quot;http://www.google.com&quot;</span><span class="o">).</span><span class="na">html</span><span class="o">();</span></code></pre></figure><p>Everything is fine until we start making this class more powerful. Let&#39;s say we want to configure the encoding. We don&#39;t always want to use <code>&quot;UTF-8&quot;</code>. We want it to be configurable. Here is what we do:</p><figure class="highlight"><pre><code class="language-java" data-lang="java"><span></span><span class="kd">class</span> <span class="nc">Page</span> <span class="o">{</span>
  <span class="kd">private</span> <span class="kd">final</span> <span class="n">String</span> <span class="n">uri</span><span class="o">;</span>
  <span class="kd">private</span> <span class="kd">final</span> <span class="n">String</span> <span class="n">encoding</span><span class="o">;</span>
  <span class="n">Page</span><span class="o">(</span><span class="kd">final</span> <span class="n">String</span> <span class="n">address</span><span class="o">,</span> <span class="kd">final</span> <span class="n">String</span> <span class="n">enc</span><span class="o">)</span> <span class="o">{</span>
    <span class="k">this</span><span class="o">.</span><span class="na">uri</span> <span class="o">=</span> <span class="n">address</span><span class="o">;</span>
    <span class="k">this</span><span class="o">.</span><span class="na">encoding</span> <span class="o">=</span> <span class="n">enc</span><span class="o">;</span>
  <span class="o">}</span>
  <span class="kd">public</span> <span class="n">String</span> <span class="nf">html</span><span class="o">()</span> <span class="kd">throws</span> <span class="n">IOException</span> <span class="o">{</span>
    <span class="k">return</span> <span class="n">IOUtils</span><span class="o">.</span><span class="na">toString</span><span class="o">(</span>
      <span class="k">new</span> <span class="n">URL</span><span class="o">(</span><span class="k">this</span><span class="o">.</span><span class="na">uri</span><span class="o">).</span><span class="na">openStream</span><span class="o">(),</span>
      <span class="k">this</span><span class="o">.</span><span class="na">encoding</span>
    <span class="o">);</span>
  <span class="o">}</span>
<span class="o">}</span></code></pre></figure><p>Done, the encoding is encapsulated and configurable. Now, let&#39;s say we want to change the behavior of the class for the situation of an empty page. If an empty page is loaded, we want to return <code>&quot;&lt;html/&gt;&quot;</code>. But not always. We want this to be configurable. Here is what we do:</p><figure class="highlight"><pre><code class="language-java" data-lang="java"><span></span><span class="kd">class</span> <span class="nc">Page</span> <span class="o">{</span>
  <span class="kd">private</span> <span class="kd">final</span> <span class="n">String</span> <span class="n">uri</span><span class="o">;</span>
  <span class="kd">private</span> <span class="kd">final</span> <span class="n">String</span> <span class="n">encoding</span><span class="o">;</span>
  <span class="kd">private</span> <span class="kd">final</span> <span class="kt">boolean</span> <span class="n">alwaysHtml</span><span class="o">;</span>
  <span class="n">Page</span><span class="o">(</span><span class="kd">final</span> <span class="n">String</span> <span class="n">address</span><span class="o">,</span> <span class="kd">final</span> <span class="n">String</span> <span class="n">enc</span><span class="o">,</span>
    <span class="kd">final</span> <span class="kt">boolean</span> <span class="n">always</span><span class="o">)</span> <span class="o">{</span>
    <span class="k">this</span><span class="o">.</span><span class="na">uri</span> <span class="o">=</span> <span class="n">address</span><span class="o">;</span>
    <span class="k">this</span><span class="o">.</span><span class="na">encoding</span> <span class="o">=</span> <span class="n">enc</span><span class="o">;</span>
    <span class="k">this</span><span class="o">.</span><span class="na">alwaysHtml</span> <span class="o">=</span> <span class="n">always</span><span class="o">;</span>
  <span class="o">}</span>
  <span class="kd">public</span> <span class="n">String</span> <span class="nf">html</span><span class="o">()</span> <span class="kd">throws</span> <span class="n">IOException</span> <span class="o">{</span>
    <span class="n">String</span> <span class="n">html</span> <span class="o">=</span> <span class="n">IOUtils</span><span class="o">.</span><span class="na">toString</span><span class="o">(</span>
      <span class="k">new</span> <span class="n">URL</span><span class="o">(</span><span class="k">this</span><span class="o">.</span><span class="na">uri</span><span class="o">).</span><span class="na">openStream</span><span class="o">(),</span>
      <span class="k">this</span><span class="o">.</span><span class="na">encoding</span>
    <span class="o">);</span>
    <span class="k">if</span> <span class="o">(</span><span class="n">html</span><span class="o">.</span><span class="na">isEmpty</span><span class="o">()</span> <span class="o">&amp;&amp;</span> <span class="k">this</span><span class="o">.</span><span class="na">alwaysHtml</span><span class="o">)</span> <span class="o">{</span>
      <span class="n">html</span> <span class="o">=</span> <span class="s">&quot;&lt;html/&gt;&quot;</span><span class="o">;</span>
    <span class="o">}</span>
    <span class="k">return</span> <span class="n">html</span><span class="o">;</span>
  <span class="o">}</span>
<span class="o">}</span></code></pre></figure><p>The class is getting bigger, huh? It&#39;s great, we&#39;re good programmers and our code must be complex, right? The more complex it is, the better programmers we are! I&#39;m being sarcastic. Definitely <a href="/2015/06/29/simple-diagrams.html">not</a>! But let&#39;s move on. Now we want our class to proceed anyway, even if the encoding is not supported on the current platform:</p><figure class="highlight"><pre><code class="language-java" data-lang="java"><span></span><span class="kd">class</span> <span class="nc">Page</span> <span class="o">{</span>
  <span class="kd">private</span> <span class="kd">final</span> <span class="n">String</span> <span class="n">uri</span><span class="o">;</span>
  <span class="kd">private</span> <span class="kd">final</span> <span class="n">String</span> <span class="n">encoding</span><span class="o">;</span>
  <span class="kd">private</span> <span class="kd">final</span> <span class="kt">boolean</span> <span class="n">alwaysHtml</span><span class="o">;</span>
  <span class="kd">private</span> <span class="kd">final</span> <span class="kt">boolean</span> <span class="n">encodeAnyway</span><span class="o">;</span>
  <span class="n">Page</span><span class="o">(</span><span class="kd">final</span> <span class="n">String</span> <span class="n">address</span><span class="o">,</span> <span class="kd">final</span> <span class="n">String</span> <span class="n">enc</span><span class="o">,</span>
    <span class="kd">final</span> <span class="kt">boolean</span> <span class="n">always</span><span class="o">,</span> <span class="kd">final</span> <span class="kt">boolean</span> <span class="n">encode</span><span class="o">)</span> <span class="o">{</span>
    <span class="k">this</span><span class="o">.</span><span class="na">uri</span> <span class="o">=</span> <span class="n">address</span><span class="o">;</span>
    <span class="k">this</span><span class="o">.</span><span class="na">encoding</span> <span class="o">=</span> <span class="n">enc</span><span class="o">;</span>
    <span class="k">this</span><span class="o">.</span><span class="na">alwaysHtml</span> <span class="o">=</span> <span class="n">always</span><span class="o">;</span>
    <span class="k">this</span><span class="o">.</span><span class="na">encodeAnyway</span> <span class="o">=</span> <span class="n">encode</span><span class="o">;</span>
  <span class="o">}</span>
  <span class="kd">public</span> <span class="n">String</span> <span class="nf">html</span><span class="o">()</span> <span class="kd">throws</span> <span class="n">IOException</span><span class="o">,</span>
  <span class="n">UnsupportedEncodingException</span> <span class="o">{</span>
    <span class="kd">final</span> <span class="kt">byte</span><span class="o">[]</span> <span class="n">bytes</span> <span class="o">=</span> <span class="n">IOUtils</span><span class="o">.</span><span class="na">toByteArray</span><span class="o">(</span>
      <span class="k">new</span> <span class="n">URL</span><span class="o">(</span><span class="k">this</span><span class="o">.</span><span class="na">uri</span><span class="o">).</span><span class="na">openStream</span><span class="o">()</span>
    <span class="o">);</span>
    <span class="n">String</span> <span class="n">html</span><span class="o">;</span>
    <span class="k">try</span> <span class="o">{</span>
      <span class="n">html</span> <span class="o">=</span> <span class="k">new</span> <span class="n">String</span><span class="o">(</span><span class="n">bytes</span><span class="o">,</span> <span class="k">this</span><span class="o">.</span><span class="na">encoding</span><span class="o">);</span>
    <span class="o">}</span> <span class="k">catch</span> <span class="o">(</span><span class="n">UnsupportedEncodingException</span> <span class="n">ex</span><span class="o">)</span> <span class="o">{</span>
      <span class="k">if</span> <span class="o">(!</span><span class="k">this</span><span class="o">.</span><span class="na">encodeAnyway</span><span class="o">)</span> <span class="o">{</span>
        <span class="k">throw</span> <span class="n">ex</span><span class="o">;</span>
      <span class="o">}</span>
      <span class="n">html</span> <span class="o">=</span> <span class="k">new</span> <span class="n">String</span><span class="o">(</span><span class="n">bytes</span><span class="o">,</span> <span class="s">&quot;UTF-8&quot;</span><span class="o">)</span>
    <span class="o">}</span>
    <span class="k">if</span> <span class="o">(</span><span class="n">html</span><span class="o">.</span><span class="na">isEmpty</span><span class="o">()</span> <span class="o">&amp;&amp;</span> <span class="k">this</span><span class="o">.</span><span class="na">alwaysHtml</span><span class="o">)</span> <span class="o">{</span>
      <span class="n">html</span> <span class="o">=</span> <span class="s">&quot;&lt;html/&gt;&quot;</span><span class="o">;</span>
    <span class="o">}</span>
    <span class="k">return</span> <span class="n">html</span><span class="o">;</span>
  <span class="o">}</span>
<span class="o">}</span></code></pre></figure><p>The class is growing and becoming more and more powerful! Now it&#39;s time to introduce a new class, which we will call <code>PageSettings</code>:</p><figure class="highlight"><pre><code class="language-java" data-lang="java"><span></span><span class="kd">class</span> <span class="nc">Page</span> <span class="o">{</span>
  <span class="kd">private</span> <span class="kd">final</span> <span class="n">String</span> <span class="n">uri</span><span class="o">;</span>
  <span class="kd">private</span> <span class="kd">final</span> <span class="n">PageSettings</span> <span class="n">settings</span><span class="o">;</span>
  <span class="n">Page</span><span class="o">(</span><span class="kd">final</span> <span class="n">String</span> <span class="n">address</span><span class="o">,</span> <span class="kd">final</span> <span class="n">PageSettings</span> <span class="n">stts</span><span class="o">)</span> <span class="o">{</span>
    <span class="k">this</span><span class="o">.</span><span class="na">uri</span> <span class="o">=</span> <span class="n">address</span><span class="o">;</span>
    <span class="k">this</span><span class="o">.</span><span class="na">settings</span> <span class="o">=</span> <span class="n">stts</span><span class="o">;</span>
  <span class="o">}</span>
  <span class="kd">public</span> <span class="n">String</span> <span class="nf">html</span><span class="o">()</span> <span class="kd">throws</span> <span class="n">IOException</span> <span class="o">{</span>
    <span class="kd">final</span> <span class="kt">byte</span><span class="o">[]</span> <span class="n">bytes</span> <span class="o">=</span> <span class="n">IOUtils</span><span class="o">.</span><span class="na">toByteArray</span><span class="o">(</span>
      <span class="k">new</span> <span class="n">URL</span><span class="o">(</span><span class="k">this</span><span class="o">.</span><span class="na">uri</span><span class="o">).</span><span class="na">openStream</span><span class="o">()</span>
    <span class="o">);</span>
    <span class="n">String</span> <span class="n">html</span><span class="o">;</span>
    <span class="k">try</span> <span class="o">{</span>
      <span class="n">html</span> <span class="o">=</span> <span class="k">new</span> <span class="n">String</span><span class="o">(</span><span class="n">bytes</span><span class="o">,</span> <span class="k">this</span><span class="o">.</span><span class="na">settings</span><span class="o">.</span><span class="na">getEncoding</span><span class="o">());</span>
    <span class="o">}</span> <span class="k">catch</span> <span class="o">(</span><span class="n">UnsupportedEncodingException</span> <span class="n">ex</span><span class="o">)</span> <span class="o">{</span>
      <span class="k">if</span> <span class="o">(!</span><span class="k">this</span><span class="o">.</span><span class="na">settings</span><span class="o">.</span><span class="na">isEncodeAnyway</span><span class="o">())</span> <span class="o">{</span>
        <span class="k">throw</span> <span class="n">ex</span><span class="o">;</span>
      <span class="o">}</span>
      <span class="n">html</span> <span class="o">=</span> <span class="k">new</span> <span class="n">String</span><span class="o">(</span><span class="n">bytes</span><span class="o">,</span> <span class="s">&quot;UTF-8&quot;</span><span class="o">)</span>
    <span class="o">}</span>
    <span class="k">if</span> <span class="o">(</span><span class="n">html</span><span class="o">.</span><span class="na">isEmpty</span><span class="o">()</span> <span class="o">&amp;&amp;</span> <span class="k">this</span><span class="o">.</span><span class="na">settings</span><span class="o">.</span><span class="na">isAlwaysHtml</span><span class="o">())</span> <span class="o">{</span>
      <span class="n">html</span> <span class="o">=</span> <span class="s">&quot;&lt;html/&gt;&quot;</span><span class="o">;</span>
    <span class="o">}</span>
    <span class="k">return</span> <span class="n">html</span><span class="o">;</span>
  <span class="o">}</span>
<span class="o">}</span></code></pre></figure><p>Class <code>PageSettings</code> is basically a holder of parameters, without any behavior. It has getters, which give us access to the parameters: <code>isEncodeAnyway()</code>, <code>isAlwaysHtml()</code>, and <code>getEncoding()</code>. If we keep going in this direction, there could be a few dozen configuration settings in that class. This may look very convenient and is a very typical pattern in Java world. For example, look at <a href="https://hadoop.apache.org/docs/r2.4.1/api/org/apache/hadoop/mapred/JobConf.html"><code>JobConf</code></a> from Hadoop. This is how we will call our highly configurable <code>Page</code> (I&#39;m assuming <code>PageSettings</code> is immutable):</p><figure class="highlight"><pre><code class="language-java" data-lang="java"><span></span><span class="n">String</span> <span class="n">html</span> <span class="o">=</span> <span class="k">new</span> <span class="n">Page</span><span class="o">(</span>
  <span class="s">&quot;http://www.google.com&quot;</span><span class="o">,</span>
  <span class="k">new</span> <span class="n">PageSettings</span><span class="o">()</span>
    <span class="o">.</span><span class="na">withEncoding</span><span class="o">(</span><span class="s">&quot;ISO_8859_1&quot;</span><span class="o">)</span>
    <span class="o">.</span><span class="na">withAlwaysHtml</span><span class="o">(</span><span class="kc">true</span><span class="o">)</span>
    <span class="o">.</span><span class="na">withEncodeAnyway</span><span class="o">(</span><span class="kc">false</span><span class="o">)</span>
<span class="o">).</span><span class="na">html</span><span class="o">();</span></code></pre></figure><p>However, no matter how convenient it may look at first glance, this approach is <strong>very wrong</strong>. Mostly because it encourages us to make big and non-cohesive objects. They grow in size and become less testable, less maintainable and less readable.</p><aside class='quote'>Encapsulated properties must not be used to change the behavior of an object</aside><p>To prevent that from happening, I would suggest a simple rule here: object behavior should not be configurable. Or, more technically, encapsulated properties must not be used to change the behavior of an object.</p><p>Object properties are there only to coordinate the location of a real-world entity, which the object is representing. The <code>uri</code> is the coordinate, while the <code>alwaysHtml</code> boolean property is a behavior changing trigger. See the difference?</p><p>So, what should we do instead? What is the right design? We must use <a href="/2015/02/26/composable-decorators.html">composable decorators</a>. Here is how:</p><figure class="highlight"><pre><code class="language-java" data-lang="java"><span></span><span class="n">Page</span> <span class="n">page</span> <span class="o">=</span> <span class="k">new</span> <span class="n">NeverEmptyPage</span><span class="o">(</span>
  <span class="k">new</span> <span class="n">DefaultPage</span><span class="o">(</span><span class="s">&quot;http://www.google.com&quot;</span><span class="o">)</span>
<span class="o">)</span>
<span class="n">String</span> <span class="n">html</span> <span class="o">=</span> <span class="k">new</span> <span class="n">AlwaysTextPage</span><span class="o">(</span>
  <span class="k">new</span> <span class="n">TextPage</span><span class="o">(</span><span class="n">page</span><span class="o">,</span> <span class="s">&quot;ISO_8859_1&quot;</span><span class="o">)</span>
  <span class="n">page</span>
<span class="o">).</span><span class="na">html</span><span class="o">();</span></code></pre></figure><p>Here is how our <code>DefaultPage</code> would look (yes, I had to change its design a bit):</p><figure class="highlight"><pre><code class="language-java" data-lang="java"><span></span><span class="kd">class</span> <span class="nc">DefaultPage</span> <span class="kd">implements</span> <span class="n">Page</span> <span class="o">{</span>
  <span class="kd">private</span> <span class="kd">final</span> <span class="n">String</span> <span class="n">uri</span><span class="o">;</span>
  <span class="n">DefaultPage</span><span class="o">(</span><span class="kd">final</span> <span class="n">String</span> <span class="n">address</span><span class="o">)</span> <span class="o">{</span>
    <span class="k">this</span><span class="o">.</span><span class="na">uri</span> <span class="o">=</span> <span class="n">address</span><span class="o">;</span>
  <span class="o">}</span>
  <span class="nd">@Override</span>
  <span class="kd">public</span> <span class="kt">byte</span><span class="o">[]</span> <span class="nf">html</span><span class="o">()</span> <span class="kd">throws</span> <span class="n">IOException</span> <span class="o">{</span>
    <span class="k">return</span> <span class="n">IOUtils</span><span class="o">.</span><span class="na">toByteArray</span><span class="o">(</span>
      <span class="k">new</span> <span class="n">URL</span><span class="o">(</span><span class="k">this</span><span class="o">.</span><span class="na">uri</span><span class="o">).</span><span class="na">openStream</span><span class="o">()</span>
    <span class="o">);</span>
  <span class="o">}</span>
<span class="o">}</span></code></pre></figure><p>As you see, I&#39;m making it implement interface <code>Page</code>. Now <code>TextPage</code> decorator, which converts an array of bytes to a text using provided encoding:</p><figure class="highlight"><pre><code class="language-java" data-lang="java"><span></span><span class="kd">class</span> <span class="nc">TextPage</span> <span class="o">{</span>
  <span class="kd">private</span> <span class="kd">final</span> <span class="n">Page</span> <span class="n">origin</span><span class="o">;</span>
  <span class="kd">private</span> <span class="kd">final</span> <span class="n">String</span> <span class="n">encoding</span><span class="o">;</span>
  <span class="n">TextPage</span><span class="o">(</span><span class="kd">final</span> <span class="n">Page</span> <span class="n">page</span><span class="o">,</span> <span class="kd">final</span> <span class="n">String</span> <span class="n">enc</span><span class="o">)</span> <span class="o">{</span>
    <span class="k">this</span><span class="o">.</span><span class="na">origin</span> <span class="o">=</span> <span class="n">page</span><span class="o">;</span>
    <span class="k">this</span><span class="o">.</span><span class="na">encoding</span> <span class="o">=</span> <span class="n">enc</span><span class="o">;</span>
  <span class="o">}</span>
  <span class="kd">public</span> <span class="n">String</span> <span class="nf">html</span><span class="o">()</span> <span class="kd">throws</span> <span class="n">IOException</span> <span class="o">{</span>
    <span class="k">return</span> <span class="k">new</span> <span class="n">String</span><span class="o">(</span>
      <span class="k">this</span><span class="o">.</span><span class="na">origin</span><span class="o">.</span><span class="na">html</span><span class="o">(),</span>
      <span class="k">this</span><span class="o">.</span><span class="na">encoding</span>
    <span class="o">);</span>
  <span class="o">}</span>
<span class="o">}</span></code></pre></figure><p>Now the <code>NeverEmptyPage</code>:</p><figure class="highlight"><pre><code class="language-java" data-lang="java"><span></span><span class="kd">class</span> <span class="nc">NeverEmptyPage</span> <span class="kd">implements</span> <span class="n">Page</span> <span class="o">{</span>
  <span class="kd">private</span> <span class="kd">final</span> <span class="n">Page</span> <span class="n">origin</span><span class="o">;</span>
  <span class="n">NeverEmptyPage</span><span class="o">(</span><span class="kd">final</span> <span class="n">Page</span> <span class="n">page</span><span class="o">)</span> <span class="o">{</span>
    <span class="k">this</span><span class="o">.</span><span class="na">origin</span> <span class="o">=</span> <span class="n">page</span><span class="o">;</span>
  <span class="o">}</span>
  <span class="nd">@Override</span>
  <span class="kd">public</span> <span class="kt">byte</span><span class="o">[]</span> <span class="nf">html</span><span class="o">()</span> <span class="kd">throws</span> <span class="n">IOException</span> <span class="o">{</span>
    <span class="kt">byte</span><span class="o">[]</span> <span class="n">bytes</span> <span class="o">=</span> <span class="k">this</span><span class="o">.</span><span class="na">origin</span><span class="o">.</span><span class="na">html</span><span class="o">();</span>
    <span class="k">if</span> <span class="o">(</span><span class="n">bytes</span><span class="o">.</span><span class="na">length</span> <span class="o">==</span> <span class="mi">0</span><span class="o">)</span> <span class="o">{</span>
      <span class="n">bytes</span> <span class="o">=</span> <span class="s">&quot;&lt;html/&gt;&quot;</span><span class="o">.</span><span class="na">getBytes</span><span class="o">();</span>
    <span class="o">}</span>
    <span class="k">return</span> <span class="n">bytes</span><span class="o">;</span>
  <span class="o">}</span>
<span class="o">}</span></code></pre></figure><p>And finally the <code>AlwaysTextPage</code>:</p><figure class="highlight"><pre><code class="language-java" data-lang="java"><span></span><span class="kd">class</span> <span class="nc">AlwaysTextPage</span> <span class="o">{</span>
  <span class="kd">private</span> <span class="kd">final</span> <span class="n">TextPage</span> <span class="n">origin</span><span class="o">;</span>
  <span class="kd">private</span> <span class="kd">final</span> <span class="n">Page</span> <span class="n">source</span><span class="o">;</span>
  <span class="n">AlwaysTextPage</span><span class="o">(</span><span class="kd">final</span> <span class="n">TextPage</span> <span class="n">page</span><span class="o">,</span> <span class="kd">final</span> <span class="n">Page</span> <span class="n">src</span><span class="o">)</span> <span class="o">{</span>
    <span class="k">this</span><span class="o">.</span><span class="na">origin</span> <span class="o">=</span> <span class="n">page</span><span class="o">;</span>
    <span class="k">this</span><span class="o">.</span><span class="na">source</span> <span class="o">=</span> <span class="n">src</span><span class="o">;</span>
  <span class="o">}</span>
  <span class="kd">public</span> <span class="n">String</span> <span class="nf">html</span><span class="o">()</span> <span class="kd">throws</span> <span class="n">IOException</span> <span class="o">{</span>
    <span class="n">String</span> <span class="n">html</span><span class="o">;</span>
    <span class="k">try</span> <span class="o">{</span>
      <span class="n">html</span> <span class="o">=</span> <span class="k">this</span><span class="o">.</span><span class="na">origin</span><span class="o">.</span><span class="na">html</span><span class="o">();</span>
    <span class="o">}</span> <span class="k">catch</span> <span class="o">(</span><span class="n">UnsupportedEncodingException</span> <span class="n">ex</span><span class="o">)</span> <span class="o">{</span>
      <span class="n">html</span> <span class="o">=</span> <span class="k">new</span> <span class="n">TextPage</span><span class="o">(</span><span class="k">this</span><span class="o">.</span><span class="na">source</span><span class="o">,</span> <span class="s">&quot;UTF-8&quot;</span><span class="o">).</span><span class="na">html</span><span class="o">();</span>
    <span class="o">}</span>
    <span class="k">return</span> <span class="n">html</span><span class="o">;</span>
  <span class="o">}</span>
<span class="o">}</span></code></pre></figure><p>You may say that <code>AlwaysTextPage</code> will make two calls to the encapsulated <code>origin</code>, in case of an unsupported encoding, which will lead to a duplicated HTTP request. That&#39;s true and this is by design. We don&#39;t want this duplicated HTTP roundtrip to happen. Let&#39;s introduce one more class, which will cache the page fetched ( <a href="/2017/01/17/synchronized-decorators.html">not thread-safe</a>, but it&#39;s not important now):</p><figure class="highlight"><pre><code class="language-java" data-lang="java"><span></span><span class="kd">class</span> <span class="nc">OncePage</span> <span class="kd">implements</span> <span class="n">Page</span> <span class="o">{</span>
  <span class="kd">private</span> <span class="kd">final</span> <span class="n">Page</span> <span class="n">origin</span><span class="o">;</span>
  <span class="kd">private</span> <span class="kd">final</span> <span class="n">AtomicReference</span><span class="o">&lt;</span><span class="kt">byte</span><span class="o">[]&gt;</span> <span class="n">cache</span> <span class="o">=</span>
    <span class="k">new</span> <span class="n">AtomicReference</span><span class="o">&lt;&gt;;</span>
  <span class="n">OncePage</span><span class="o">(</span><span class="kd">final</span> <span class="n">Page</span> <span class="n">page</span><span class="o">)</span> <span class="o">{</span>
    <span class="k">this</span><span class="o">.</span><span class="na">origin</span> <span class="o">=</span> <span class="n">page</span><span class="o">;</span>
  <span class="o">}</span>
  <span class="nd">@Override</span>
  <span class="kd">public</span> <span class="kt">byte</span><span class="o">[]</span> <span class="nf">html</span><span class="o">()</span> <span class="kd">throws</span> <span class="n">IOException</span> <span class="o">{</span>
    <span class="k">if</span> <span class="o">(</span><span class="k">this</span><span class="o">.</span><span class="na">cache</span><span class="o">.</span><span class="na">get</span><span class="o">()</span> <span class="o">==</span> <span class="kc">null</span><span class="o">)</span> <span class="o">{</span>
      <span class="k">this</span><span class="o">.</span><span class="na">cache</span><span class="o">.</span><span class="na">set</span><span class="o">(</span><span class="k">this</span><span class="o">.</span><span class="na">origin</span><span class="o">.</span><span class="na">html</span><span class="o">());</span>
    <span class="o">}</span>
    <span class="k">return</span> <span class="k">this</span><span class="o">.</span><span class="na">cache</span><span class="o">.</span><span class="na">get</span><span class="o">();</span>
  <span class="o">}</span>
<span class="o">}</span></code></pre></figure><p>Now, our code should look like this (pay attention, I&#39;m now using <code>OncePage</code>):</p><figure class="highlight"><pre><code class="language-java" data-lang="java"><span></span><span class="n">Page</span> <span class="n">page</span> <span class="o">=</span> <span class="k">new</span> <span class="n">NeverEmptyPage</span><span class="o">(</span>
  <span class="k">new</span> <span class="n">OncePage</span><span class="o">(</span>
    <span class="k">new</span> <span class="n">DefaultPage</span><span class="o">(</span><span class="s">&quot;http://www.google.com&quot;</span><span class="o">)</span>
  <span class="o">)</span>
<span class="o">)</span>
<span class="n">String</span> <span class="n">html</span> <span class="o">=</span> <span class="k">new</span> <span class="n">AlwaysTextPage</span><span class="o">(</span>
  <span class="k">new</span> <span class="n">TextPage</span><span class="o">(</span><span class="n">page</span><span class="o">,</span> <span class="s">&quot;ISO_8859_1&quot;</span><span class="o">)</span>
  <span class="s">&quot;UTF-8&quot;</span>
<span class="o">).</span><span class="na">html</span><span class="o">();</span></code></pre></figure><p>This is probably the most code-intensive post on this site so far, but I hope it&#39;s readable and I managed to convey the idea. Now we have five classes, each of which is rather small, easy to read and easy to reuse.</p><p>Just follow the rule: never make classes configurable!</p></div></article></div><div class="wrapper"> <related-posts /></div><div class="disqus" role="complementary"><p class="disqus_hint"> Please, use <a href="https://help.disqus.com/commenting/what-html-tags-are-allowed-within-comments">syntax highlighting</a> in your comments, to make them more readable.</p><div id="disqus_thread" class="disqus-thread"> <a>&nbsp;</a></div><script> var disqus_config = function () { this.page.url = document.location.href.split('?')[0].split('#')[0].replace('https://', 'http://'); this.page.identifier = this.page.url; }; (function() { var d = document, s = d.createElement('script'); s.src = '//yegor256.disqus.com/embed.js'; s.setAttribute('data-timestamp', +new Date()); (d.head || d.body).appendChild(s); })(); </script> <noscript><div><p class="red"> JavaScript is disabled in your browser, that's why you can't see comments under this post.</p></div></noscript></div><div class="wrapper"> <footer class="footer"><p> &copy; <span itemscope="" itemprop="copyrightHolder" itemtype="http://schema.org/Person"> <span itemprop="name">Yegor Bugayenko</span> </span> 2014&ndash;<span itemprop="copyrightYear">2018</span></p></footer></div></section><div class="wrapper unprintable" style="text-align:center;margin-top:2em;"> <a href="http://www.sixnines.io/h/3ba1652f"> <img src="//www.sixnines.io/b/3ba1652f?style=flat" alt="sixnines availability badge"/> </a></div><script src="//code.jquery.com/jquery-1.9.0.min.js"></script> <script src="/js/all.js?a0e0d018c07"></script> <script>var disqus_shortname = 'yegor256';</script> <script id="dsq-count-scr" src="//yegor256.disqus.com/count.js" async="async"></script> <script> (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){ (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o), m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m) })(window,document,'script','//www.google-analytics.com/analytics.js','ga'); ga('create', 'UA-1963507-32', 'auto'); ga('send', 'pageview'); </script> <script> Cd=document;Cr="&"+Math.random();Cp="&s=1"; Cd.cookie="b=b";if(Cd.cookie)Cp+="&c=1"; Cp+="&t="+(new Date()).getTimezoneOffset(); if(self!=top)Cp+="&f=1"; </script> <script> if(navigator.javaEnabled())Cp+="&j=1"; </script> <script> if(typeof(screen)!='undefined')Cp+="&w="+screen.width+"&h="+ screen.height+"&d="+(screen.colorDepth?screen.colorDepth:screen.pixelDepth); </script> <script> Cd.write("<img src='//c.hit.ua/hit?i=95870&g=0&x=2"+Cp+Cr+ "&r="+escape(Cd.referrer)+"&u="+escape(window.location.href)+ "' border='0' wi"+"dth='1' he"+"ight='1'/>"); </script> <script type="application/ld+json"> { "@context": "http://schema.org", "@type": "Person", "name": "Yegor Bugayenko", "url": "http://www.yegor256.com", "sameAs": [ "https://www.facebook.com/yegor256", "https://instagram.com/yegor256", "https://www.linkedin.com/in/yegor256", "https://twitter.com/yegor256", "https://github.com/yegor256", "https://www.pinterest.com/yegor256/" ] } </script> </body> </html> <!DOCTYPE html> <html xmlns="http://www.w3.org/1999/xhtml" lang="en-US" xml:lang="en-US" itemscope="" itemtype="http://schema.org/WebSite"> <head> <meta charset="utf-8"/> <meta name="description" content="Even though Java annotations are very popular and convenient, they are making Java code less object-oriented and more messy. " /> <meta name="keywords" content="java annotations, java annotations example, java annotations list, java annotations runtime, java annotations tutorial" /> <meta name="viewport" content="width=device-width,minimum-scale=1,initial-scale=1"/> <meta name="google-site-verification" content="JEj_gQr2CPe2QKGw8XdMz0R7VboQIUbX3FlM-lwTq-8" /> <meta name="author" content="Yegor Bugayenko"> <meta name="article:published_time" content="2016-04-12 00:00:00 +0000"> <meta name="og:site_name" content="Yegor Bugayenko"/> <meta name="og:type" content="article" /> <meta name="og:locale" content="en_US" /> <meta name="twitter:account_id" content="4503599630178231" /> <meta name="twitter:creator" content="@yegor256"/> <meta name="twitter:site" content="@yegor256"/> <meta name="twitter:title" property="og:title" content="Java Annotations Are a Big Mistake"/> <meta name="twitter:description" property="og:description" content="Even though Java annotations are very popular and convenient, they are making Java code less object-oriented and more messy. "/> <meta name="twitter:url" property="og:url" content="https://www.yegor256.com/2016/04/12/java-annotations-are-evil.html"/> <meta name="telegram:channel" content="AAAAAEJFMRzsRTRxM3ec6A"/> <link rel="search" type="application/opensearchdescription+xml" href="/opensearch.xml" title="yegor256" /> <link rel="shortcut icon" href="/favicon.ico?a0e0d018c07"/> <link rel="apple-touch-icon" href="/favicon.ico?a0e0d018c07"/> <link rel="alternate" type="application/rss+xml" title="RSS for yegor256.com" href="https://www.yegor256.com/rss.xml"/> <link rel="stylesheet" href="/css/layout.css?a0e0d018c07"/> <link rel="stylesheet" href="/css/icons.css?a0e0d018c07"/> <link rel="canonical" href="https://www.yegor256.com/2016/04/12/java-annotations-are-evil.html" /> <link rel="amphtml" href="https://www.yegor256.com/2016/04/12/java-annotations-are-evil.amp.html" /> <title>Java Annotations Are a Big Mistake </title> <meta name='og:image' content='https://www.yegor256.com/images/2016/04/gomorrah.jpg'/><meta name='twitter:image' content='https://www.yegor256.com/images/2016/04/gomorrah.jpg'/><meta name='og:image:width' content='1280'/> <meta name='twitter:image:width' content='1280'/><meta name='og:image:height' content='852'/> <meta name='twitter:image:height' content='852'/><meta name='twitter:card' content='summary_large_image'/><meta name='twitter:image:alt' content='Gomorra (2008) by Matteo Garrone)'/> </head> <body><div class="wrapper"> <aside class="header-toggle unprintable" id="header-toggle" title="Show the menu" onclick="$('#header').show();$('#header-toggle').hide();">&#9776;</aside> <header class="header" id="header"><div class="face"> <a href="/about-me.html#form" class="sub" title="Click to subscribe to my monthly newsletter"><span>Subscribe</span></a> <a href="/about-me.html" style="position:relative;"> <img src="/images/face-256x256.jpg" class="photo" alt="Yegor Bugayenko"/> </a></div><nav><ul class="menu social notranslate"> <li><a href="https://twitter.com/intent/follow?screen_name=yegor256" rel="nofollow" title="Follow me on Twitter"><i class="icon icon-twitter notranslate" aria-hidden="true"></i></a></li> <li><a href="/rss.xml" rel="nofollow" title="Subscribe to my RSS feed"><i class="icon icon-rss notranslate" aria-hidden="true"></i></a></li> <li><a itemprop="sameAs" href="https://github.com/yegor256" rel="nofollow" title="My GitHub profile"><i class="icon icon-github notranslate" aria-hidden="true"></i></a></li> <li><a itemprop="sameAs" href="http://stackoverflow.com/users/187141/yegor256" rel="nofollow" title="My StackOverflow profile"><i class="icon icon-stackoverflow notranslate" aria-hidden="true"></i></a></li> <li><a itemprop="sameAs" href="https://www.facebook.com/yegor256" rel="nofollow" title="Follow me on Facebook"><i class="icon icon-facebook notranslate" aria-hidden="true"></i></a></li> <li><a itemprop="sameAs" href="https://instagram.com/yegor256" rel="nofollow" title="Follow me on Instagram"><i class="icon icon-instagram notranslate" aria-hidden="true"></i></a></li> <li><a itemprop="sameAs" href="https://www.linkedin.com/in/yegor256" rel="nofollow" title="My LinkedIn profile"><i class="icon icon-linkedin notranslate" aria-hidden="true"></i></a></li> <li><a itemprop="sameAs" href="https://www.youtube.com/c/yegor256?sub_confirmation=1" rel="nofollow" title="My Youtube video channel"><i class="icon icon-youtube notranslate" aria-hidden="true"></i></a></li> <li><a itemprop="sameAs" href="https://www.pinterest.com/yegor256/" rel="nofollow" title="My Pinterest boards"><i class="icon icon-pinterest notranslate" aria-hidden="true"></i></a></li> <li><a itemprop="sameAs" href="https://angel.co/yegor256" rel="nofollow" title="My AngelList profile"><i class="icon icon-angellist notranslate" aria-hidden="true"></i></a></li> <li><a href="https://soundcloud.com/yegor256" rel="nofollow" title="My podcast"><i class="icon icon-podcast notranslate" aria-hidden="true"></i></a></li> <li><a href="https://itunes.apple.com/us/podcast/yegor256-podcast/id1150826721" rel="nofollow" title="My iTunes podcast"><i class="icon icon-itunes notranslate" aria-hidden="true"></i></a></li> <li><a href="https://t.me/joinchat/AAAAAEJFMRzsRTRxM3ec6A" rel="nofollow" title="My Telegram public channel"><i class="icon icon-telegram notranslate" aria-hidden="true"></i></a></li> <li><a href="mailto:blog@yegor256.com" rel="nofollow" title="Email me any time"><i class="icon icon-mail notranslate" aria-hidden="true"></i></a></li></ul><ul class="menu"> <li><a href="/" title="Home page">Home</a></li> <li ><a href="/best.html" title="Best articles to read">12&#160;Best</a></li> <li ><a href="/contents.html" title="The contents of the entire blog">All&#160;288</a></li> <li ><a href="/webinars.html" title="My webinars">Webinars</a></li> <li ><a href="/talks.html" title="Future and past conference talks">Talks</a></li> <li ><a href="/books.html" title="The books I wrote">Books</a></li> <li ><a href="/papers.html" title="My academic papers and patents">Papers</a></li> <li ><a href="/pets.html" title="My loved pet projects">Pets</a></li> <li ><a href="/award.html" title="Software quality award">Award</a></li> <li ><a href="/testimonials.html" title="What some people say about me">Testimonials</a></li> <li ><a href="/shift-m.html" title="Audio podcast about project management">Shift-M</a></li> <li ><a href="/paintings.html" title="My paintings for sale">Paintings</a></li> <li><a href="http://ru.yegor256.com/" title="Немного на русском языке">По-русски</a></li></ul></nav><div class="search"> <form method="get" action="https://www.google.com/search" itemprop="potentialAction" itemscope="" itemtype="http://schema.org/SearchAction"> <meta itemprop="target" content="https://www.google.com/search?q={q}"/> <input name="sitesearch" value="yegor256.com" type="hidden"/> <input itemprop="query-input" type="text" id="search-query" class="field field-text" required="required" onfocus="$('.google').css('visibility', 'visible');" name="q" placeholder="Search..." autocomplete="off"/> <input type="image" src="/images/google-search-icon.svg" class="google" title="Search via Google" alt="Search via Google"/> </form></div><div class="hot"><ul> <li> <a href="/code-ahead.html">Code Ahead</a> was published on Amazon just a few days ago! It is my new book, a novel about programmers. It explains in details the majority of ideas that stand behind <a href="https://www.zerocracy.com">Zerocracy</a> and <a href="https://www.xdsd.org">XDSD</a>. </li> <li> At <a href="/webinars.html">Webinar #37</a> we will discuss naming problem in OOP, for objects, methods and attributes; join us on <b>September 12</b>, at 11am PST. </li></ul></div></header></div><section itemscope="" itemtype="http://schema.org/BlogPosting"><div class="wrapper"> <header><p class="printable"> <img src="https://api.qrserver.com/v1/create-qr-code/?data=https://www.yegor256.com/2016/04/12/java-annotations-are-evil.html&amp;format=svg" style="width:125px;height:125px;" alt="QR code"/></p><p class="printable"> <code itemprop="url">https://www.yegor256.com/2016/04/12/java-annotations-are-evil.html</code></p><h1 itemprop="name headline mainEntityOfPage">Java Annotations Are a Big Mistake</h1><aside class='book'><a href='http://amzn.to/2pyceWc'><img src='/images/books/elegant-objects/cover.png' class='book-cover' alt='book cover'/></a>Read more about this subject in <a href='http://amzn.to/2pyceWc'>Section&nbsp;6.1</a><br/> of my book<a href='http://amzn.to/2pyceWc'><img src='/images/books/amazon-buy-button.png' class='amazon-button' alt='Click to buy'/></a></aside><ul class="subline"> <li> <time itemprop="datePublished" datetime="2016-04-12T00:00:00+00:00"> 12 April 2016 </time> </li> <li class="desktop-only" itemprop="locationCreated">Seattle, WA</li> <li class="printable" itemscope="" itemprop="author" itemtype="http://schema.org/Person"> <span itemprop="name">Yegor Bugayenko</span> </li> <li class="unprintable"> <i class="icon icon-comments"></i> <a href="http://www.yegor256.com/2016/04/12/java-annotations-are-evil.html#disqus_thread" itemprop="discussionUrl">comments</a> </li></ul><p class="unprintable"><p><a href="https://en.wikipedia.org/wiki/Java_annotation">Annotations</a> were introduced in Java 5, and we all got excited. Such a great instrument to make code shorter! No more Hibernate/Spring XML configuration files! Just annotations, right there in the code where we need them. No more <a href="https://en.wikipedia.org/wiki/Marker_interface_pattern">marker interfaces</a>, just a <a href="https://docs.oracle.com/javase/7/docs/api/java/lang/annotation/Retention.html">runtime-retained</a> <a href="http://stackoverflow.com/questions/4296910/">reflection-discoverable</a> annotation! I was excited too. Moreover, I&#39;ve made a few open source libraries which use annotations heavily. Take <a href="https://github.com/jcabi/jcabi-aspects">jcabi-aspects</a>, for example. However, I&#39;m not excited any more. Moreover, I believe that annotations are a big mistake in Java design.</p><figure class='jb_picture'><img itemprop='image' alt='Gomorra (2008) by Matteo Garrone)' src='/images/2016/04/gomorrah.jpg' longdesc='#8ef9c86b'/><figcaption id='8ef9c86b'>Gomorra (2008) by Matteo Garrone)</figcaption></figure> <aside class='youtube'> <a href='https://www.youtube.com/watch?v=g1ctRcW214w'><div class='box'> <img src='https://i.ytimg.com/vi/g1ctRcW214w/mqdefault.jpg' alt='YouTube video #g1ctRcW214w'/><div class='play'><i class='icon icon-play'></i></div></div></a><div>Java Annotations Are a Big Mistake (webinar #14); 4 May 2016.</div></aside><p>Long story short, there is one big problem with annotations---they encourage us to implement <a href="/2014/11/20/seven-virtues-of-good-object.html">object</a> functionality <strong>outside</strong> of an object, which is against the very principle of <a href="/2016/11/21/naked-data.html">encapsulation</a>. The object is not solid any more, since its behavior is not defined entirely by its own methods---some of its functionality stays elsewhere. Why is it bad? Let&#39;s see in a few examples.</p><h2 id="inject"><code>@Inject</code></h2><p>Say we annotate a property with <code>@Inject</code>:</p><figure class="highlight"><pre><code class="language-java" data-lang="java"><span></span><span class="kn">import</span> <span class="nn">javax.inject.Inject</span><span class="o">;</span>
<span class="kd">public</span> <span class="kd">class</span> <span class="nc">Books</span> <span class="o">{</span>
  <span class="nd">@Inject</span>
  <span class="kd">private</span> <span class="kd">final</span> <span class="n">DB</span> <span class="n">db</span><span class="o">;</span>
  <span class="c1">// some methods here, which use this.db</span>
<span class="o">}</span></code></pre></figure><p>Then we have an injector that knows what to inject:</p><figure class="highlight"><pre><code class="language-java" data-lang="java"><span></span><span class="n">Injector</span> <span class="n">injector</span> <span class="o">=</span> <span class="n">Guice</span><span class="o">.</span><span class="na">createInjector</span><span class="o">(</span>
  <span class="k">new</span> <span class="n">AbstractModule</span><span class="o">()</span> <span class="o">{</span>
    <span class="nd">@Override</span>
    <span class="kd">public</span> <span class="kt">void</span> <span class="nf">configure</span><span class="o">()</span> <span class="o">{</span>
      <span class="k">this</span><span class="o">.</span><span class="na">bind</span><span class="o">(</span><span class="n">DB</span><span class="o">.</span><span class="na">class</span><span class="o">).</span><span class="na">toInstance</span><span class="o">(</span>
        <span class="k">new</span> <span class="n">Postgres</span><span class="o">(</span><span class="s">&quot;jdbc:postgresql:5740/main&quot;</span><span class="o">)</span>
      <span class="o">);</span>
    <span class="o">}</span>
  <span class="o">}</span>
<span class="o">);</span></code></pre></figure><p>Now we&#39;re making an instance of class <code>Books</code> via the container:</p><figure class="highlight"><pre><code class="language-java" data-lang="java"><span></span><span class="n">Books</span> <span class="n">books</span> <span class="o">=</span> <span class="n">injector</span><span class="o">.</span><span class="na">getInstance</span><span class="o">(</span><span class="n">Books</span><span class="o">.</span><span class="na">class</span><span class="o">);</span></code></pre></figure><p>The class <code>Books</code> has no idea how and who will inject an instance of class <code>DB</code> into it. This will happen behind the scenes and outside of its control. The injection will do it. It may look convenient, but this attitude causes a lot of damage to the entire code base. The control is lost (not inverted, but lost!). The object is not in charge any more. It can&#39;t be responsible for what&#39;s happening to it.</p><p>Instead, here is how this should be done:</p><figure class="highlight"><pre><code class="language-java" data-lang="java"><span></span><span class="kd">class</span> <span class="nc">Books</span> <span class="o">{</span>
  <span class="kd">private</span> <span class="kd">final</span> <span class="n">DB</span> <span class="n">db</span><span class="o">;</span>
  <span class="n">Books</span><span class="o">(</span><span class="kd">final</span> <span class="n">DB</span> <span class="n">base</span><span class="o">)</span> <span class="o">{</span>
    <span class="k">this</span><span class="o">.</span><span class="na">db</span> <span class="o">=</span> <span class="n">base</span><span class="o">;</span>
  <span class="o">}</span>
  <span class="c1">// some methods here, which use this.db</span>
<span class="o">}</span></code></pre></figure><p>This article explains why Dependency Injection containers are a wrong idea in the first place: <a href="/2014/10/03/di-containers-are-evil.html">Dependency Injection Containers are Code Polluters</a>. Annotations basically provoke us to make the containers and use them. We move functionality outside of our objects and put it into containers, or somewhere else. That&#39;s because we don&#39;t want to duplicate the same code over and over again, right? That&#39;s correct, duplication is bad, but tearing an object apart is even worse. Way worse. The same is true about ORM (JPA/Hibernate), where annotations are being actively used. Check this post, it explains what is wrong about ORM: <a href="/2014/12/01/orm-offensive-anti-pattern.html">ORM Is an Offensive Anti-Pattern</a>. Annotations by themselves are not the key motivator, but they help us and encourage us by tearing objects apart and keeping parts in different places. They are containers, sessions, managers, controllers, etc.</p><h2 id="xmlelement"><code>@XmlElement</code></h2><aside class='youtube'> <a href='https://www.youtube.com/watch?v=oV6Utb5Jows'><div class='box'> <img src='https://i.ytimg.com/vi/oV6Utb5Jows/mqdefault.jpg' alt='YouTube video #oV6Utb5Jows'/><div class='play'><i class='icon icon-play'></i></div></div></a><div>Dependency Injection Container is a Bad Idea (webinar #9); 1 December 2015.</div></aside><p>This is how JAXB <a href="/2015/03/26/jaxb-vs-xembly.html">works</a>, when you want to convert your <a href="https://en.wikipedia.org/wiki/Plain_Old_Java_Object">POJO</a> to XML. First, you attach the <code>@XmlElement</code> annotation to the getter:</p><figure class="highlight"><pre><code class="language-java" data-lang="java"><span></span><span class="kn">import</span> <span class="nn">javax.xml.bind.annotation.XmlElement</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">javax.xml.bind.annotation.XmlRootElement</span><span class="o">;</span>
<span class="nd">@XmlRootElement</span>
<span class="kd">public</span> <span class="kd">class</span> <span class="nc">Book</span> <span class="o">{</span>
  <span class="kd">private</span> <span class="kd">final</span> <span class="n">String</span> <span class="n">title</span><span class="o">;</span>
  <span class="kd">public</span> <span class="nf">Book</span><span class="o">(</span><span class="kd">final</span> <span class="n">String</span> <span class="n">title</span><span class="o">)</span> <span class="o">{</span>
    <span class="k">this</span><span class="o">.</span><span class="na">title</span> <span class="o">=</span> <span class="n">title</span><span class="o">;</span>
  <span class="o">}</span>
  <span class="nd">@XmlElement</span>
  <span class="kd">public</span> <span class="n">String</span> <span class="nf">getTitle</span><span class="o">()</span> <span class="o">{</span>
    <span class="k">return</span> <span class="k">this</span><span class="o">.</span><span class="na">title</span><span class="o">;</span>
  <span class="o">}</span>
<span class="o">}</span></code></pre></figure><p>Then, you create a marshaller and ask it to convert an instance of class <code>Book</code> into XML:</p><figure class="highlight"><pre><code class="language-java" data-lang="java"><span></span><span class="kd">final</span> <span class="n">Book</span> <span class="n">book</span> <span class="o">=</span> <span class="k">new</span> <span class="n">Book</span><span class="o">(</span><span class="s">&quot;0132350882&quot;</span><span class="o">,</span> <span class="s">&quot;Clean Code&quot;</span><span class="o">);</span>
<span class="kd">final</span> <span class="n">JAXBContext</span> <span class="n">ctx</span> <span class="o">=</span> <span class="n">JAXBContext</span><span class="o">.</span><span class="na">newInstance</span><span class="o">(</span><span class="n">Book</span><span class="o">.</span><span class="na">class</span><span class="o">);</span>
<span class="kd">final</span> <span class="n">Marshaller</span> <span class="n">marshaller</span> <span class="o">=</span> <span class="n">ctx</span><span class="o">.</span><span class="na">createMarshaller</span><span class="o">();</span>
<span class="n">marshaller</span><span class="o">.</span><span class="na">marshal</span><span class="o">(</span><span class="n">book</span><span class="o">,</span> <span class="n">System</span><span class="o">.</span><span class="na">out</span><span class="o">);</span></code></pre></figure> <aside class='youtube'> <a href='https://www.youtube.com/watch?v=cv23Z6xpwDw'><div class='box'> <img src='https://i.ytimg.com/vi/cv23Z6xpwDw/mqdefault.jpg' alt='YouTube video #cv23Z6xpwDw'/><div class='play'><i class='icon icon-play'></i></div></div></a><div>Java Annotations Are a Bad Idea; 20 June 2017.</div></aside><p>Who is creating the XML? Not the <code>book</code>. Someone else, outside of the class <code>Book</code>. This is very wrong. Instead, this is how this should have been done. First, the class that has no idea about XML:</p><figure class="highlight"><pre><code class="language-java" data-lang="java"><span></span><span class="kd">class</span> <span class="nc">DefaultBook</span> <span class="kd">implements</span> <span class="n">Book</span> <span class="o">{</span>
  <span class="kd">private</span> <span class="kd">final</span> <span class="n">String</span> <span class="n">title</span><span class="o">;</span>
  <span class="n">DefaultBook</span><span class="o">(</span><span class="kd">final</span> <span class="n">String</span> <span class="n">title</span><span class="o">)</span> <span class="o">{</span>
    <span class="k">this</span><span class="o">.</span><span class="na">title</span> <span class="o">=</span> <span class="n">title</span><span class="o">;</span>
  <span class="o">}</span>
  <span class="nd">@Override</span>
  <span class="kd">public</span> <span class="n">String</span> <span class="nf">getTitle</span><span class="o">()</span> <span class="o">{</span>
    <span class="k">return</span> <span class="k">this</span><span class="o">.</span><span class="na">title</span><span class="o">;</span>
  <span class="o">}</span>
<span class="o">}</span></code></pre></figure><p>Then, the <a href="/2015/02/26/composable-decorators.html">decorator</a> that prints it to the XML:</p><figure class="highlight"><pre><code class="language-java" data-lang="java"><span></span><span class="kd">class</span> <span class="nc">XmlBook</span> <span class="kd">implements</span> <span class="n">Book</span><span class="o">{</span>
  <span class="kd">private</span> <span class="kd">final</span> <span class="n">Book</span> <span class="n">origin</span><span class="o">;</span>
  <span class="n">XmlBook</span><span class="o">(</span><span class="kd">final</span> <span class="n">Book</span> <span class="n">book</span><span class="o">)</span> <span class="o">{</span>
    <span class="k">this</span><span class="o">.</span><span class="na">origin</span> <span class="o">=</span> <span class="n">book</span><span class="o">;</span>
  <span class="o">}</span>
  <span class="nd">@Override</span>
  <span class="kd">public</span> <span class="n">String</span> <span class="nf">getTitle</span><span class="o">()</span> <span class="o">{</span>
    <span class="k">return</span> <span class="k">this</span><span class="o">.</span><span class="na">origin</span><span class="o">.</span><span class="na">getTitle</span><span class="o">();</span>
  <span class="o">}</span>
  <span class="kd">public</span> <span class="n">String</span> <span class="nf">toXML</span><span class="o">()</span> <span class="o">{</span>
    <span class="k">return</span> <span class="n">String</span><span class="o">.</span><span class="na">format</span><span class="o">(</span>
      <span class="s">&quot;&lt;book&gt;&lt;title&gt;%s&lt;/title&gt;&lt;/book&gt;&quot;</span><span class="o">,</span>
      <span class="k">this</span><span class="o">.</span><span class="na">getTitle</span><span class="o">()</span>
    <span class="o">);</span>
  <span class="o">}</span>
<span class="o">}</span></code></pre></figure><p>Now, in order to <a href="/2016/04/05/printers-instead-of-getters.html">print</a> the book in XML we do the following:</p><figure class="highlight"><pre><code class="language-java" data-lang="java"><span></span><span class="n">String</span> <span class="n">xml</span> <span class="o">=</span> <span class="k">new</span> <span class="n">XmlBook</span><span class="o">(</span>
  <span class="k">new</span> <span class="n">DefaultBook</span><span class="o">(</span><span class="s">&quot;Elegant Objects&quot;</span><span class="o">)</span>
<span class="o">).</span><span class="na">toXML</span><span class="o">();</span></code></pre></figure><p>The XML printing functionality is inside <code>XmlBook</code>. If you don&#39;t like the decorator idea, you can move the <code>toXML()</code> method to the <code>DefaultBook</code> class. It&#39;s not important. What is important is that the functionality always stays where it belongs---inside the object. Only the object knows how to <a href="/2016/04/05/printers-instead-of-getters.html">print itself</a> to the XML. Nobody else!</p><h2 id="retryonfailure"><code>@RetryOnFailure</code></h2><p>Here is an example (from <a href="/2014/08/15/retry-java-method-on-exception.html">my own library</a>):</p><figure class="highlight"><pre><code class="language-java" data-lang="java"><span></span><span class="kn">import</span> <span class="nn">com.jcabi.aspects.RetryOnFailure</span><span class="o">;</span>
<span class="kd">class</span> <span class="nc">Foo</span> <span class="o">{</span>
  <span class="nd">@RetryOnFailure</span>
  <span class="kd">public</span> <span class="n">String</span> <span class="nf">load</span><span class="o">(</span><span class="n">URL</span> <span class="n">url</span><span class="o">)</span> <span class="o">{</span>
    <span class="k">return</span> <span class="n">url</span><span class="o">.</span><span class="na">openConnection</span><span class="o">().</span><span class="na">getContent</span><span class="o">();</span>
  <span class="o">}</span>
<span class="o">}</span></code></pre></figure><p>After compilation, we run a so called <a href="/2014/06/01/aop-aspectj-java-method-logging.html">AOP weaver</a> that technically turns our code into something like this:</p><figure class="highlight"><pre><code class="language-java" data-lang="java"><span></span><span class="kd">class</span> <span class="nc">Foo</span> <span class="o">{</span>
  <span class="kd">public</span> <span class="n">String</span> <span class="nf">load</span><span class="o">(</span><span class="n">URL</span> <span class="n">url</span><span class="o">)</span> <span class="o">{</span>
    <span class="k">while</span> <span class="o">(</span><span class="kc">true</span><span class="o">)</span> <span class="o">{</span>
      <span class="k">try</span> <span class="o">{</span>
        <span class="k">return</span> <span class="n">_Foo</span><span class="o">.</span><span class="na">load</span><span class="o">(</span><span class="n">url</span><span class="o">);</span>
      <span class="o">}</span> <span class="k">catch</span> <span class="o">(</span><span class="n">Exception</span> <span class="n">ex</span><span class="o">)</span> <span class="o">{</span>
        <span class="c1">// ignore it</span>
      <span class="o">}</span>
    <span class="o">}</span>
  <span class="o">}</span>
  <span class="kd">class</span> <span class="nc">_Foo</span> <span class="o">{</span>
    <span class="kd">public</span> <span class="n">String</span> <span class="nf">load</span><span class="o">(</span><span class="n">URL</span> <span class="n">url</span><span class="o">)</span> <span class="o">{</span>
      <span class="k">return</span> <span class="n">url</span><span class="o">.</span><span class="na">openConnection</span><span class="o">().</span><span class="na">getContent</span><span class="o">();</span>
    <span class="o">}</span>
  <span class="o">}</span>
<span class="o">}</span></code></pre></figure><p>I simplified the actual algorithm of retrying a method call on failure, but I&#39;m sure you get the idea. <a href="http://www.eclipse.org/aspectj/">AspectJ</a>, the <a href="http://en.wikipedia.org/wiki/Aspect-oriented_programming">AOP</a> engine, uses <a href="http://aspects.jcabi.com/annotation-retryonfailure.html"><code>@RetryOnFailure</code></a> annotation as a signal, informing us that the class has to be wrapped into another one. This is happening behind the scenes. We don&#39;t see that supplementary class, which implements the retrying algorithm. But the bytecode produced by the AspectJ weaver contains a modified version of class <code>Foo</code>.</p><aside class='youtube'> <a href='https://www.youtube.com/watch?v=WSgP85kr6eU'><div class='box'> <img src='https://i.ytimg.com/vi/WSgP85kr6eU/mqdefault.jpg' alt='YouTube video #WSgP85kr6eU'/><div class='play'><i class='icon icon-play'></i></div></div></a><div>Why Getters-and-Setters Is An Anti-Pattern? (webinar #4); 1 July 2015.</div></aside><p>That is exactly what is wrong with this approach---we don&#39;t see and don&#39;t control the instantiation of that supplementary object. Object composition, which is the most important process in object design, is hidden somewhere behind the scenes. You may say that we don&#39;t need to see it since it&#39;s supplementary. I disagree. We must see how our objects are composed. We may not care about how they work, but we must see the entire composition process.</p><p>A much better design would look like this (instead of annotations):</p><figure class="highlight"><pre><code class="language-java" data-lang="java"><span></span><span class="n">Foo</span> <span class="n">foo</span> <span class="o">=</span> <span class="k">new</span> <span class="n">FooThatRetries</span><span class="o">(</span><span class="k">new</span> <span class="n">Foo</span><span class="o">());</span></code></pre></figure><p>And then, the implementation of <code>FooThatRetries</code>:</p><figure class="highlight"><pre><code class="language-java" data-lang="java"><span></span><span class="kd">class</span> <span class="nc">FooThatRetries</span> <span class="kd">implements</span> <span class="n">Foo</span> <span class="o">{</span>
  <span class="kd">private</span> <span class="kd">final</span> <span class="n">Foo</span> <span class="n">origin</span><span class="o">;</span>
  <span class="n">FooThatRetries</span><span class="o">(</span><span class="n">Foo</span> <span class="n">foo</span><span class="o">)</span> <span class="o">{</span>
    <span class="k">this</span><span class="o">.</span><span class="na">origin</span> <span class="o">=</span> <span class="n">foo</span><span class="o">;</span>
  <span class="o">}</span>
  <span class="kd">public</span> <span class="n">String</span> <span class="nf">load</span><span class="o">(</span><span class="n">URL</span> <span class="n">url</span><span class="o">)</span> <span class="o">{</span>
    <span class="k">return</span> <span class="k">new</span> <span class="n">Retry</span><span class="o">().</span><span class="na">eval</span><span class="o">(</span>
      <span class="k">new</span> <span class="n">Retry</span><span class="o">.</span><span class="na">Algorithm</span><span class="o">&lt;</span><span class="n">String</span><span class="o">&gt;()</span> <span class="o">{</span>
        <span class="nd">@Override</span>
        <span class="kd">public</span> <span class="n">String</span> <span class="nf">eval</span><span class="o">()</span> <span class="o">{</span>
          <span class="k">return</span> <span class="n">FooThatRetries</span><span class="o">.</span><span class="na">this</span><span class="o">.</span><span class="na">load</span><span class="o">(</span><span class="n">url</span><span class="o">);</span>
        <span class="o">}</span>
      <span class="o">}</span>
    <span class="o">);</span>
  <span class="o">}</span>
<span class="o">}</span></code></pre></figure><p>And now, the implementation of <code>Retry</code>:</p><figure class="highlight"><pre><code class="language-java" data-lang="java"><span></span><span class="kd">class</span> <span class="nc">Retry</span> <span class="o">{</span>
  <span class="kd">public</span> <span class="o">&lt;</span><span class="n">T</span><span class="o">&gt;</span> <span class="n">T</span> <span class="nf">eval</span><span class="o">(</span><span class="n">Retry</span><span class="o">.</span><span class="na">Algorithm</span><span class="o">&lt;</span><span class="n">T</span><span class="o">&gt;</span> <span class="n">algo</span><span class="o">)</span> <span class="o">{</span>
    <span class="k">while</span> <span class="o">(</span><span class="kc">true</span><span class="o">)</span> <span class="o">{</span>
      <span class="k">try</span> <span class="o">{</span>
        <span class="k">return</span> <span class="n">algo</span><span class="o">.</span><span class="na">eval</span><span class="o">();</span>
      <span class="o">}</span> <span class="k">catch</span> <span class="o">(</span><span class="n">Exception</span> <span class="n">ex</span><span class="o">)</span> <span class="o">{</span>
        <span class="c1">// ignore it</span>
      <span class="o">}</span>
    <span class="o">}</span>
  <span class="o">}</span>
  <span class="kd">interface</span> <span class="nc">Algorithm</span><span class="o">&lt;</span><span class="n">T</span><span class="o">&gt;</span> <span class="o">{</span>
    <span class="n">T</span> <span class="nf">eval</span><span class="o">();</span>
  <span class="o">}</span>
<span class="o">}</span></code></pre></figure><p>Is the code longer? Yes. Is it cleaner? A lot more. I regret that I didn&#39;t understand it two years ago, when I started to work with <a href="https://github.com/jcabi/jcabi-aspects">jcabi-aspects</a>.</p><hr/><p>The bottom line is that annotations are bad. Don&#39;t use them. What should be used instead? Object <a href="/2015/02/26/composable-decorators.html">composition</a>.</p><p>What could be worse than annotations? <a href="/2016/04/19/object-must-not-be-configurable.html">Configurations</a>. For example, XML configurations. Spring XML configuration mechanisms is a perfect example of terrible design. I&#39;ve said it many times before. Let me repeat it again---Spring Framework is one of the worst software products in the Java world. If you can stay away from it, you will do yourself a big favor.</p><p>There should not be any &quot;configurations&quot; in <a href="/2016/08/15/what-is-wrong-object-oriented-programming.html">OOP</a>. We can&#39;t configure our objects if they are real objects. We can only instantiate them. And the best method of instantiation is operator <code>new</code>. This operator is the key instrument for an OOP developer. Taking it away from us and giving us &quot;configuration mechanisms&quot; is an unforgivable <a href="/2015/11/24/imprisonment-for-irresponsible-coding.html">crime</a>.</p></p><nav class="buttons notranslate desktop-only"> <a href="http://www.facebook.com/sharer/sharer.php?u=https://www.yegor256.com/2016/04/12/java-annotations-are-evil.html" title="Share on Facebook" class="button" rel="nofollow"> <span class="count count-facebook">0</span> <i class="icon icon-facebook notranslate" aria-hidden="true"></i> </a> <a href="https://twitter.com/share?url=https://www.yegor256.com/2016/04/12/java-annotations-are-evil.html&amp;text=Java+Annotations+Are+a+Big+Mistake" title="Share on Twitter" class="button" rel="nofollow"> <span class="count count-twitter">0</span> <i class="icon icon-twitter notranslate" aria-hidden="true"></i> </a> <a href="https://plus.google.com/share?url=https://www.yegor256.com/2016/04/12/java-annotations-are-evil.html" title="Share on Google+" class="button" rel="nofollow"> <span class="count count-googleplus">0</span> <i class="icon icon-googleplus notranslate" aria-hidden="true"></i> </a> <a href="https://www.linkedin.com/cws/share?url=https://www.yegor256.com/2016/04/12/java-annotations-are-evil.html" title="Share on LinkedIn" class="button" rel="nofollow"> <span class="count count-linkedin">0</span> <i class="icon icon-linkedin notranslate" aria-hidden="true"></i> </a> <a href="http://reddit.com/submit?url=https://www.yegor256.com/2016/04/12/java-annotations-are-evil.html%3F2016-15&amp;title=Java+Annotations+Are+a+Big+Mistake" title="Share on Reddit" class="button" rel="nofollow"> <span class="count count-reddit">0</span> <i class="icon icon-reddit notranslate" aria-hidden="true"></i> </a> <a href="http://news.ycombinator.com/submitlink?u=https://www.yegor256.com/2016/04/12/java-annotations-are-evil.html%3F2016-15&amp;t=Java+Annotations+Are+a+Big+Mistake" title="Share on Hacker News" class="button" rel="nofollow"> <span class="count count-hackernews">0</span> <i class="icon icon-hackernews notranslate" aria-hidden="true"></i> </a> </nav> </header> <article class="main" itemprop="articleBody"><div ><p><a href="https://en.wikipedia.org/wiki/Java_annotation">Annotations</a> were introduced in Java 5, and we all got excited. Such a great instrument to make code shorter! No more Hibernate/Spring XML configuration files! Just annotations, right there in the code where we need them. No more <a href="https://en.wikipedia.org/wiki/Marker_interface_pattern">marker interfaces</a>, just a <a href="https://docs.oracle.com/javase/7/docs/api/java/lang/annotation/Retention.html">runtime-retained</a> <a href="http://stackoverflow.com/questions/4296910/">reflection-discoverable</a> annotation! I was excited too. Moreover, I&#39;ve made a few open source libraries which use annotations heavily. Take <a href="https://github.com/jcabi/jcabi-aspects">jcabi-aspects</a>, for example. However, I&#39;m not excited any more. Moreover, I believe that annotations are a big mistake in Java design.</p><figure class='jb_picture'><img itemprop='image' alt='Gomorra (2008) by Matteo Garrone)' src='/images/2016/04/gomorrah.jpg' longdesc='#8ef9c86b'/><figcaption id='8ef9c86b'>Gomorra (2008) by Matteo Garrone)</figcaption></figure> <aside class='youtube'> <a href='https://www.youtube.com/watch?v=g1ctRcW214w'><div class='box'> <img src='https://i.ytimg.com/vi/g1ctRcW214w/mqdefault.jpg' alt='YouTube video #g1ctRcW214w'/><div class='play'><i class='icon icon-play'></i></div></div></a><div>Java Annotations Are a Big Mistake (webinar #14); 4 May 2016.</div></aside><p>Long story short, there is one big problem with annotations---they encourage us to implement <a href="/2014/11/20/seven-virtues-of-good-object.html">object</a> functionality <strong>outside</strong> of an object, which is against the very principle of <a href="/2016/11/21/naked-data.html">encapsulation</a>. The object is not solid any more, since its behavior is not defined entirely by its own methods---some of its functionality stays elsewhere. Why is it bad? Let&#39;s see in a few examples.</p><h2 id="inject"><code>@Inject</code></h2><p>Say we annotate a property with <code>@Inject</code>:</p><figure class="highlight"><pre><code class="language-java" data-lang="java"><span></span><span class="kn">import</span> <span class="nn">javax.inject.Inject</span><span class="o">;</span>
<span class="kd">public</span> <span class="kd">class</span> <span class="nc">Books</span> <span class="o">{</span>
  <span class="nd">@Inject</span>
  <span class="kd">private</span> <span class="kd">final</span> <span class="n">DB</span> <span class="n">db</span><span class="o">;</span>
  <span class="c1">// some methods here, which use this.db</span>
<span class="o">}</span></code></pre></figure><p>Then we have an injector that knows what to inject:</p><figure class="highlight"><pre><code class="language-java" data-lang="java"><span></span><span class="n">Injector</span> <span class="n">injector</span> <span class="o">=</span> <span class="n">Guice</span><span class="o">.</span><span class="na">createInjector</span><span class="o">(</span>
  <span class="k">new</span> <span class="n">AbstractModule</span><span class="o">()</span> <span class="o">{</span>
    <span class="nd">@Override</span>
    <span class="kd">public</span> <span class="kt">void</span> <span class="nf">configure</span><span class="o">()</span> <span class="o">{</span>
      <span class="k">this</span><span class="o">.</span><span class="na">bind</span><span class="o">(</span><span class="n">DB</span><span class="o">.</span><span class="na">class</span><span class="o">).</span><span class="na">toInstance</span><span class="o">(</span>
        <span class="k">new</span> <span class="n">Postgres</span><span class="o">(</span><span class="s">&quot;jdbc:postgresql:5740/main&quot;</span><span class="o">)</span>
      <span class="o">);</span>
    <span class="o">}</span>
  <span class="o">}</span>
<span class="o">);</span></code></pre></figure><p>Now we&#39;re making an instance of class <code>Books</code> via the container:</p><figure class="highlight"><pre><code class="language-java" data-lang="java"><span></span><span class="n">Books</span> <span class="n">books</span> <span class="o">=</span> <span class="n">injector</span><span class="o">.</span><span class="na">getInstance</span><span class="o">(</span><span class="n">Books</span><span class="o">.</span><span class="na">class</span><span class="o">);</span></code></pre></figure><p>The class <code>Books</code> has no idea how and who will inject an instance of class <code>DB</code> into it. This will happen behind the scenes and outside of its control. The injection will do it. It may look convenient, but this attitude causes a lot of damage to the entire code base. The control is lost (not inverted, but lost!). The object is not in charge any more. It can&#39;t be responsible for what&#39;s happening to it.</p><p>Instead, here is how this should be done:</p><figure class="highlight"><pre><code class="language-java" data-lang="java"><span></span><span class="kd">class</span> <span class="nc">Books</span> <span class="o">{</span>
  <span class="kd">private</span> <span class="kd">final</span> <span class="n">DB</span> <span class="n">db</span><span class="o">;</span>
  <span class="n">Books</span><span class="o">(</span><span class="kd">final</span> <span class="n">DB</span> <span class="n">base</span><span class="o">)</span> <span class="o">{</span>
    <span class="k">this</span><span class="o">.</span><span class="na">db</span> <span class="o">=</span> <span class="n">base</span><span class="o">;</span>
  <span class="o">}</span>
  <span class="c1">// some methods here, which use this.db</span>
<span class="o">}</span></code></pre></figure><p>This article explains why Dependency Injection containers are a wrong idea in the first place: <a href="/2014/10/03/di-containers-are-evil.html">Dependency Injection Containers are Code Polluters</a>. Annotations basically provoke us to make the containers and use them. We move functionality outside of our objects and put it into containers, or somewhere else. That&#39;s because we don&#39;t want to duplicate the same code over and over again, right? That&#39;s correct, duplication is bad, but tearing an object apart is even worse. Way worse. The same is true about ORM (JPA/Hibernate), where annotations are being actively used. Check this post, it explains what is wrong about ORM: <a href="/2014/12/01/orm-offensive-anti-pattern.html">ORM Is an Offensive Anti-Pattern</a>. Annotations by themselves are not the key motivator, but they help us and encourage us by tearing objects apart and keeping parts in different places. They are containers, sessions, managers, controllers, etc.</p><h2 id="xmlelement"><code>@XmlElement</code></h2><aside class='youtube'> <a href='https://www.youtube.com/watch?v=oV6Utb5Jows'><div class='box'> <img src='https://i.ytimg.com/vi/oV6Utb5Jows/mqdefault.jpg' alt='YouTube video #oV6Utb5Jows'/><div class='play'><i class='icon icon-play'></i></div></div></a><div>Dependency Injection Container is a Bad Idea (webinar #9); 1 December 2015.</div></aside><p>This is how JAXB <a href="/2015/03/26/jaxb-vs-xembly.html">works</a>, when you want to convert your <a href="https://en.wikipedia.org/wiki/Plain_Old_Java_Object">POJO</a> to XML. First, you attach the <code>@XmlElement</code> annotation to the getter:</p><figure class="highlight"><pre><code class="language-java" data-lang="java"><span></span><span class="kn">import</span> <span class="nn">javax.xml.bind.annotation.XmlElement</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">javax.xml.bind.annotation.XmlRootElement</span><span class="o">;</span>
<span class="nd">@XmlRootElement</span>
<span class="kd">public</span> <span class="kd">class</span> <span class="nc">Book</span> <span class="o">{</span>
  <span class="kd">private</span> <span class="kd">final</span> <span class="n">String</span> <span class="n">title</span><span class="o">;</span>
  <span class="kd">public</span> <span class="nf">Book</span><span class="o">(</span><span class="kd">final</span> <span class="n">String</span> <span class="n">title</span><span class="o">)</span> <span class="o">{</span>
    <span class="k">this</span><span class="o">.</span><span class="na">title</span> <span class="o">=</span> <span class="n">title</span><span class="o">;</span>
  <span class="o">}</span>
  <span class="nd">@XmlElement</span>
  <span class="kd">public</span> <span class="n">String</span> <span class="nf">getTitle</span><span class="o">()</span> <span class="o">{</span>
    <span class="k">return</span> <span class="k">this</span><span class="o">.</span><span class="na">title</span><span class="o">;</span>
  <span class="o">}</span>
<span class="o">}</span></code></pre></figure><p>Then, you create a marshaller and ask it to convert an instance of class <code>Book</code> into XML:</p><figure class="highlight"><pre><code class="language-java" data-lang="java"><span></span><span class="kd">final</span> <span class="n">Book</span> <span class="n">book</span> <span class="o">=</span> <span class="k">new</span> <span class="n">Book</span><span class="o">(</span><span class="s">&quot;0132350882&quot;</span><span class="o">,</span> <span class="s">&quot;Clean Code&quot;</span><span class="o">);</span>
<span class="kd">final</span> <span class="n">JAXBContext</span> <span class="n">ctx</span> <span class="o">=</span> <span class="n">JAXBContext</span><span class="o">.</span><span class="na">newInstance</span><span class="o">(</span><span class="n">Book</span><span class="o">.</span><span class="na">class</span><span class="o">);</span>
<span class="kd">final</span> <span class="n">Marshaller</span> <span class="n">marshaller</span> <span class="o">=</span> <span class="n">ctx</span><span class="o">.</span><span class="na">createMarshaller</span><span class="o">();</span>
<span class="n">marshaller</span><span class="o">.</span><span class="na">marshal</span><span class="o">(</span><span class="n">book</span><span class="o">,</span> <span class="n">System</span><span class="o">.</span><span class="na">out</span><span class="o">);</span></code></pre></figure> <aside class='youtube'> <a href='https://www.youtube.com/watch?v=cv23Z6xpwDw'><div class='box'> <img src='https://i.ytimg.com/vi/cv23Z6xpwDw/mqdefault.jpg' alt='YouTube video #cv23Z6xpwDw'/><div class='play'><i class='icon icon-play'></i></div></div></a><div>Java Annotations Are a Bad Idea; 20 June 2017.</div></aside><p>Who is creating the XML? Not the <code>book</code>. Someone else, outside of the class <code>Book</code>. This is very wrong. Instead, this is how this should have been done. First, the class that has no idea about XML:</p><figure class="highlight"><pre><code class="language-java" data-lang="java"><span></span><span class="kd">class</span> <span class="nc">DefaultBook</span> <span class="kd">implements</span> <span class="n">Book</span> <span class="o">{</span>
  <span class="kd">private</span> <span class="kd">final</span> <span class="n">String</span> <span class="n">title</span><span class="o">;</span>
  <span class="n">DefaultBook</span><span class="o">(</span><span class="kd">final</span> <span class="n">String</span> <span class="n">title</span><span class="o">)</span> <span class="o">{</span>
    <span class="k">this</span><span class="o">.</span><span class="na">title</span> <span class="o">=</span> <span class="n">title</span><span class="o">;</span>
  <span class="o">}</span>
  <span class="nd">@Override</span>
  <span class="kd">public</span> <span class="n">String</span> <span class="nf">getTitle</span><span class="o">()</span> <span class="o">{</span>
    <span class="k">return</span> <span class="k">this</span><span class="o">.</span><span class="na">title</span><span class="o">;</span>
  <span class="o">}</span>
<span class="o">}</span></code></pre></figure><p>Then, the <a href="/2015/02/26/composable-decorators.html">decorator</a> that prints it to the XML:</p><figure class="highlight"><pre><code class="language-java" data-lang="java"><span></span><span class="kd">class</span> <span class="nc">XmlBook</span> <span class="kd">implements</span> <span class="n">Book</span><span class="o">{</span>
  <span class="kd">private</span> <span class="kd">final</span> <span class="n">Book</span> <span class="n">origin</span><span class="o">;</span>
  <span class="n">XmlBook</span><span class="o">(</span><span class="kd">final</span> <span class="n">Book</span> <span class="n">book</span><span class="o">)</span> <span class="o">{</span>
    <span class="k">this</span><span class="o">.</span><span class="na">origin</span> <span class="o">=</span> <span class="n">book</span><span class="o">;</span>
  <span class="o">}</span>
  <span class="nd">@Override</span>
  <span class="kd">public</span> <span class="n">String</span> <span class="nf">getTitle</span><span class="o">()</span> <span class="o">{</span>
    <span class="k">return</span> <span class="k">this</span><span class="o">.</span><span class="na">origin</span><span class="o">.</span><span class="na">getTitle</span><span class="o">();</span>
  <span class="o">}</span>
  <span class="kd">public</span> <span class="n">String</span> <span class="nf">toXML</span><span class="o">()</span> <span class="o">{</span>
    <span class="k">return</span> <span class="n">String</span><span class="o">.</span><span class="na">format</span><span class="o">(</span>
      <span class="s">&quot;&lt;book&gt;&lt;title&gt;%s&lt;/title&gt;&lt;/book&gt;&quot;</span><span class="o">,</span>
      <span class="k">this</span><span class="o">.</span><span class="na">getTitle</span><span class="o">()</span>
    <span class="o">);</span>
  <span class="o">}</span>
<span class="o">}</span></code></pre></figure><p>Now, in order to <a href="/2016/04/05/printers-instead-of-getters.html">print</a> the book in XML we do the following:</p><figure class="highlight"><pre><code class="language-java" data-lang="java"><span></span><span class="n">String</span> <span class="n">xml</span> <span class="o">=</span> <span class="k">new</span> <span class="n">XmlBook</span><span class="o">(</span>
  <span class="k">new</span> <span class="n">DefaultBook</span><span class="o">(</span><span class="s">&quot;Elegant Objects&quot;</span><span class="o">)</span>
<span class="o">).</span><span class="na">toXML</span><span class="o">();</span></code></pre></figure><p>The XML printing functionality is inside <code>XmlBook</code>. If you don&#39;t like the decorator idea, you can move the <code>toXML()</code> method to the <code>DefaultBook</code> class. It&#39;s not important. What is important is that the functionality always stays where it belongs---inside the object. Only the object knows how to <a href="/2016/04/05/printers-instead-of-getters.html">print itself</a> to the XML. Nobody else!</p><h2 id="retryonfailure"><code>@RetryOnFailure</code></h2><p>Here is an example (from <a href="/2014/08/15/retry-java-method-on-exception.html">my own library</a>):</p><figure class="highlight"><pre><code class="language-java" data-lang="java"><span></span><span class="kn">import</span> <span class="nn">com.jcabi.aspects.RetryOnFailure</span><span class="o">;</span>
<span class="kd">class</span> <span class="nc">Foo</span> <span class="o">{</span>
  <span class="nd">@RetryOnFailure</span>
  <span class="kd">public</span> <span class="n">String</span> <span class="nf">load</span><span class="o">(</span><span class="n">URL</span> <span class="n">url</span><span class="o">)</span> <span class="o">{</span>
    <span class="k">return</span> <span class="n">url</span><span class="o">.</span><span class="na">openConnection</span><span class="o">().</span><span class="na">getContent</span><span class="o">();</span>
  <span class="o">}</span>
<span class="o">}</span></code></pre></figure><p>After compilation, we run a so called <a href="/2014/06/01/aop-aspectj-java-method-logging.html">AOP weaver</a> that technically turns our code into something like this:</p><figure class="highlight"><pre><code class="language-java" data-lang="java"><span></span><span class="kd">class</span> <span class="nc">Foo</span> <span class="o">{</span>
  <span class="kd">public</span> <span class="n">String</span> <span class="nf">load</span><span class="o">(</span><span class="n">URL</span> <span class="n">url</span><span class="o">)</span> <span class="o">{</span>
    <span class="k">while</span> <span class="o">(</span><span class="kc">true</span><span class="o">)</span> <span class="o">{</span>
      <span class="k">try</span> <span class="o">{</span>
        <span class="k">return</span> <span class="n">_Foo</span><span class="o">.</span><span class="na">load</span><span class="o">(</span><span class="n">url</span><span class="o">);</span>
      <span class="o">}</span> <span class="k">catch</span> <span class="o">(</span><span class="n">Exception</span> <span class="n">ex</span><span class="o">)</span> <span class="o">{</span>
        <span class="c1">// ignore it</span>
      <span class="o">}</span>
    <span class="o">}</span>
  <span class="o">}</span>
  <span class="kd">class</span> <span class="nc">_Foo</span> <span class="o">{</span>
    <span class="kd">public</span> <span class="n">String</span> <span class="nf">load</span><span class="o">(</span><span class="n">URL</span> <span class="n">url</span><span class="o">)</span> <span class="o">{</span>
      <span class="k">return</span> <span class="n">url</span><span class="o">.</span><span class="na">openConnection</span><span class="o">().</span><span class="na">getContent</span><span class="o">();</span>
    <span class="o">}</span>
  <span class="o">}</span>
<span class="o">}</span></code></pre></figure><p>I simplified the actual algorithm of retrying a method call on failure, but I&#39;m sure you get the idea. <a href="http://www.eclipse.org/aspectj/">AspectJ</a>, the <a href="http://en.wikipedia.org/wiki/Aspect-oriented_programming">AOP</a> engine, uses <a href="http://aspects.jcabi.com/annotation-retryonfailure.html"><code>@RetryOnFailure</code></a> annotation as a signal, informing us that the class has to be wrapped into another one. This is happening behind the scenes. We don&#39;t see that supplementary class, which implements the retrying algorithm. But the bytecode produced by the AspectJ weaver contains a modified version of class <code>Foo</code>.</p><aside class='youtube'> <a href='https://www.youtube.com/watch?v=WSgP85kr6eU'><div class='box'> <img src='https://i.ytimg.com/vi/WSgP85kr6eU/mqdefault.jpg' alt='YouTube video #WSgP85kr6eU'/><div class='play'><i class='icon icon-play'></i></div></div></a><div>Why Getters-and-Setters Is An Anti-Pattern? (webinar #4); 1 July 2015.</div></aside><p>That is exactly what is wrong with this approach---we don&#39;t see and don&#39;t control the instantiation of that supplementary object. Object composition, which is the most important process in object design, is hidden somewhere behind the scenes. You may say that we don&#39;t need to see it since it&#39;s supplementary. I disagree. We must see how our objects are composed. We may not care about how they work, but we must see the entire composition process.</p><p>A much better design would look like this (instead of annotations):</p><figure class="highlight"><pre><code class="language-java" data-lang="java"><span></span><span class="n">Foo</span> <span class="n">foo</span> <span class="o">=</span> <span class="k">new</span> <span class="n">FooThatRetries</span><span class="o">(</span><span class="k">new</span> <span class="n">Foo</span><span class="o">());</span></code></pre></figure><p>And then, the implementation of <code>FooThatRetries</code>:</p><figure class="highlight"><pre><code class="language-java" data-lang="java"><span></span><span class="kd">class</span> <span class="nc">FooThatRetries</span> <span class="kd">implements</span> <span class="n">Foo</span> <span class="o">{</span>
  <span class="kd">private</span> <span class="kd">final</span> <span class="n">Foo</span> <span class="n">origin</span><span class="o">;</span>
  <span class="n">FooThatRetries</span><span class="o">(</span><span class="n">Foo</span> <span class="n">foo</span><span class="o">)</span> <span class="o">{</span>
    <span class="k">this</span><span class="o">.</span><span class="na">origin</span> <span class="o">=</span> <span class="n">foo</span><span class="o">;</span>
  <span class="o">}</span>
  <span class="kd">public</span> <span class="n">String</span> <span class="nf">load</span><span class="o">(</span><span class="n">URL</span> <span class="n">url</span><span class="o">)</span> <span class="o">{</span>
    <span class="k">return</span> <span class="k">new</span> <span class="n">Retry</span><span class="o">().</span><span class="na">eval</span><span class="o">(</span>
      <span class="k">new</span> <span class="n">Retry</span><span class="o">.</span><span class="na">Algorithm</span><span class="o">&lt;</span><span class="n">String</span><span class="o">&gt;()</span> <span class="o">{</span>
        <span class="nd">@Override</span>
        <span class="kd">public</span> <span class="n">String</span> <span class="nf">eval</span><span class="o">()</span> <span class="o">{</span>
          <span class="k">return</span> <span class="n">FooThatRetries</span><span class="o">.</span><span class="na">this</span><span class="o">.</span><span class="na">load</span><span class="o">(</span><span class="n">url</span><span class="o">);</span>
        <span class="o">}</span>
      <span class="o">}</span>
    <span class="o">);</span>
  <span class="o">}</span>
<span class="o">}</span></code></pre></figure><p>And now, the implementation of <code>Retry</code>:</p><figure class="highlight"><pre><code class="language-java" data-lang="java"><span></span><span class="kd">class</span> <span class="nc">Retry</span> <span class="o">{</span>
  <span class="kd">public</span> <span class="o">&lt;</span><span class="n">T</span><span class="o">&gt;</span> <span class="n">T</span> <span class="nf">eval</span><span class="o">(</span><span class="n">Retry</span><span class="o">.</span><span class="na">Algorithm</span><span class="o">&lt;</span><span class="n">T</span><span class="o">&gt;</span> <span class="n">algo</span><span class="o">)</span> <span class="o">{</span>
    <span class="k">while</span> <span class="o">(</span><span class="kc">true</span><span class="o">)</span> <span class="o">{</span>
      <span class="k">try</span> <span class="o">{</span>
        <span class="k">return</span> <span class="n">algo</span><span class="o">.</span><span class="na">eval</span><span class="o">();</span>
      <span class="o">}</span> <span class="k">catch</span> <span class="o">(</span><span class="n">Exception</span> <span class="n">ex</span><span class="o">)</span> <span class="o">{</span>
        <span class="c1">// ignore it</span>
      <span class="o">}</span>
    <span class="o">}</span>
  <span class="o">}</span>
  <span class="kd">interface</span> <span class="nc">Algorithm</span><span class="o">&lt;</span><span class="n">T</span><span class="o">&gt;</span> <span class="o">{</span>
    <span class="n">T</span> <span class="nf">eval</span><span class="o">();</span>
  <span class="o">}</span>
<span class="o">}</span></code></pre></figure><p>Is the code longer? Yes. Is it cleaner? A lot more. I regret that I didn&#39;t understand it two years ago, when I started to work with <a href="https://github.com/jcabi/jcabi-aspects">jcabi-aspects</a>.</p><hr/><p>The bottom line is that annotations are bad. Don&#39;t use them. What should be used instead? Object <a href="/2015/02/26/composable-decorators.html">composition</a>.</p><p>What could be worse than annotations? <a href="/2016/04/19/object-must-not-be-configurable.html">Configurations</a>. For example, XML configurations. Spring XML configuration mechanisms is a perfect example of terrible design. I&#39;ve said it many times before. Let me repeat it again---Spring Framework is one of the worst software products in the Java world. If you can stay away from it, you will do yourself a big favor.</p><p>There should not be any &quot;configurations&quot; in <a href="/2016/08/15/what-is-wrong-object-oriented-programming.html">OOP</a>. We can&#39;t configure our objects if they are real objects. We can only instantiate them. And the best method of instantiation is operator <code>new</code>. This operator is the key instrument for an OOP developer. Taking it away from us and giving us &quot;configuration mechanisms&quot; is an unforgivable <a href="/2015/11/24/imprisonment-for-irresponsible-coding.html">crime</a>.</p></div></article></div><div class="wrapper"> <related-posts /></div><div class="disqus" role="complementary"><p class="disqus_hint"> Please, use <a href="https://help.disqus.com/commenting/what-html-tags-are-allowed-within-comments">syntax highlighting</a> in your comments, to make them more readable.</p><div id="disqus_thread" class="disqus-thread"> <a>&nbsp;</a></div><script> var disqus_config = function () { this.page.url = document.location.href.split('?')[0].split('#')[0].replace('https://', 'http://'); this.page.identifier = this.page.url; }; (function() { var d = document, s = d.createElement('script'); s.src = '//yegor256.disqus.com/embed.js'; s.setAttribute('data-timestamp', +new Date()); (d.head || d.body).appendChild(s); })(); </script> <noscript><div><p class="red"> JavaScript is disabled in your browser, that's why you can't see comments under this post.</p></div></noscript></div><div class="wrapper"> <footer class="footer"><p> &copy; <span itemscope="" itemprop="copyrightHolder" itemtype="http://schema.org/Person"> <span itemprop="name">Yegor Bugayenko</span> </span> 2014&ndash;<span itemprop="copyrightYear">2018</span></p></footer></div></section><div class="wrapper unprintable" style="text-align:center;margin-top:2em;"> <a href="http://www.sixnines.io/h/3ba1652f"> <img src="//www.sixnines.io/b/3ba1652f?style=flat" alt="sixnines availability badge"/> </a></div><script src="//code.jquery.com/jquery-1.9.0.min.js"></script> <script src="/js/all.js?a0e0d018c07"></script> <script>var disqus_shortname = 'yegor256';</script> <script id="dsq-count-scr" src="//yegor256.disqus.com/count.js" async="async"></script> <script> (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){ (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o), m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m) })(window,document,'script','//www.google-analytics.com/analytics.js','ga'); ga('create', 'UA-1963507-32', 'auto'); ga('send', 'pageview'); </script> <script> Cd=document;Cr="&"+Math.random();Cp="&s=1"; Cd.cookie="b=b";if(Cd.cookie)Cp+="&c=1"; Cp+="&t="+(new Date()).getTimezoneOffset(); if(self!=top)Cp+="&f=1"; </script> <script> if(navigator.javaEnabled())Cp+="&j=1"; </script> <script> if(typeof(screen)!='undefined')Cp+="&w="+screen.width+"&h="+ screen.height+"&d="+(screen.colorDepth?screen.colorDepth:screen.pixelDepth); </script> <script> Cd.write("<img src='//c.hit.ua/hit?i=95870&g=0&x=2"+Cp+Cr+ "&r="+escape(Cd.referrer)+"&u="+escape(window.location.href)+ "' border='0' wi"+"dth='1' he"+"ight='1'/>"); </script> <script type="application/ld+json"> { "@context": "http://schema.org", "@type": "Person", "name": "Yegor Bugayenko", "url": "http://www.yegor256.com", "sameAs": [ "https://www.facebook.com/yegor256", "https://instagram.com/yegor256", "https://www.linkedin.com/in/yegor256", "https://twitter.com/yegor256", "https://github.com/yegor256", "https://www.pinterest.com/yegor256/" ] } </script> </body> </html> <!DOCTYPE html> <html xmlns="http://www.w3.org/1999/xhtml" lang="en-US" xml:lang="en-US" itemscope="" itemtype="http://schema.org/WebSite"> <head> <meta charset="utf-8"/> <meta name="description" content="Since getters are an anti-pattern, how are we supposed to convert an object to, say, JSON or plain text? I&apos;m suggesting to use printers. " /> <meta name="keywords" content="alternative to getters, getters and setters, getters and setters java, getters java, how to avoid getters" /> <meta name="viewport" content="width=device-width,minimum-scale=1,initial-scale=1"/> <meta name="google-site-verification" content="JEj_gQr2CPe2QKGw8XdMz0R7VboQIUbX3FlM-lwTq-8" /> <meta name="author" content="Yegor Bugayenko"> <meta name="article:published_time" content="2016-04-05 00:00:00 +0000"> <meta name="og:site_name" content="Yegor Bugayenko"/> <meta name="og:type" content="article" /> <meta name="og:locale" content="en_US" /> <meta name="twitter:account_id" content="4503599630178231" /> <meta name="twitter:creator" content="@yegor256"/> <meta name="twitter:site" content="@yegor256"/> <meta name="twitter:title" property="og:title" content="Printers Instead of Getters"/> <meta name="twitter:description" property="og:description" content="Since getters are an anti-pattern, how are we supposed to convert an object to, say, JSON or plain text? I&apos;m suggesting to use printers. "/> <meta name="twitter:url" property="og:url" content="https://www.yegor256.com/2016/04/05/printers-instead-of-getters.html"/> <meta name="telegram:channel" content="AAAAAEJFMRzsRTRxM3ec6A"/> <link rel="search" type="application/opensearchdescription+xml" href="/opensearch.xml" title="yegor256" /> <link rel="shortcut icon" href="/favicon.ico?a0e0d018c07"/> <link rel="apple-touch-icon" href="/favicon.ico?a0e0d018c07"/> <link rel="alternate" type="application/rss+xml" title="RSS for yegor256.com" href="https://www.yegor256.com/rss.xml"/> <link rel="stylesheet" href="/css/layout.css?a0e0d018c07"/> <link rel="stylesheet" href="/css/icons.css?a0e0d018c07"/> <link rel="canonical" href="https://www.yegor256.com/2016/04/05/printers-instead-of-getters.html" /> <link rel="amphtml" href="https://www.yegor256.com/2016/04/05/printers-instead-of-getters.amp.html" /> <title>Printers Instead of Getters </title> <meta name='og:image' content='https://www.yegor256.com/images/2016/04/amelie.jpg'/><meta name='twitter:image' content='https://www.yegor256.com/images/2016/04/amelie.jpg'/><meta name='og:image:width' content='1200'/> <meta name='twitter:image:width' content='1200'/><meta name='og:image:height' content='675'/> <meta name='twitter:image:height' content='675'/><meta name='twitter:card' content='summary_large_image'/><meta name='twitter:image:alt' content='Le fabuleux destin d&#39;Amélie Poulain (2001) by Jean-Pierre Jeunet'/> </head> <body><div class="wrapper"> <aside class="header-toggle unprintable" id="header-toggle" title="Show the menu" onclick="$('#header').show();$('#header-toggle').hide();">&#9776;</aside> <header class="header" id="header"><div class="face"> <a href="/about-me.html#form" class="sub" title="Click to subscribe to my monthly newsletter"><span>Subscribe</span></a> <a href="/about-me.html" style="position:relative;"> <img src="/images/face-256x256.jpg" class="photo" alt="Yegor Bugayenko"/> </a></div><nav><ul class="menu social notranslate"> <li><a href="https://twitter.com/intent/follow?screen_name=yegor256" rel="nofollow" title="Follow me on Twitter"><i class="icon icon-twitter notranslate" aria-hidden="true"></i></a></li> <li><a href="/rss.xml" rel="nofollow" title="Subscribe to my RSS feed"><i class="icon icon-rss notranslate" aria-hidden="true"></i></a></li> <li><a itemprop="sameAs" href="https://github.com/yegor256" rel="nofollow" title="My GitHub profile"><i class="icon icon-github notranslate" aria-hidden="true"></i></a></li> <li><a itemprop="sameAs" href="http://stackoverflow.com/users/187141/yegor256" rel="nofollow" title="My StackOverflow profile"><i class="icon icon-stackoverflow notranslate" aria-hidden="true"></i></a></li> <li><a itemprop="sameAs" href="https://www.facebook.com/yegor256" rel="nofollow" title="Follow me on Facebook"><i class="icon icon-facebook notranslate" aria-hidden="true"></i></a></li> <li><a itemprop="sameAs" href="https://instagram.com/yegor256" rel="nofollow" title="Follow me on Instagram"><i class="icon icon-instagram notranslate" aria-hidden="true"></i></a></li> <li><a itemprop="sameAs" href="https://www.linkedin.com/in/yegor256" rel="nofollow" title="My LinkedIn profile"><i class="icon icon-linkedin notranslate" aria-hidden="true"></i></a></li> <li><a itemprop="sameAs" href="https://www.youtube.com/c/yegor256?sub_confirmation=1" rel="nofollow" title="My Youtube video channel"><i class="icon icon-youtube notranslate" aria-hidden="true"></i></a></li> <li><a itemprop="sameAs" href="https://www.pinterest.com/yegor256/" rel="nofollow" title="My Pinterest boards"><i class="icon icon-pinterest notranslate" aria-hidden="true"></i></a></li> <li><a itemprop="sameAs" href="https://angel.co/yegor256" rel="nofollow" title="My AngelList profile"><i class="icon icon-angellist notranslate" aria-hidden="true"></i></a></li> <li><a href="https://soundcloud.com/yegor256" rel="nofollow" title="My podcast"><i class="icon icon-podcast notranslate" aria-hidden="true"></i></a></li> <li><a href="https://itunes.apple.com/us/podcast/yegor256-podcast/id1150826721" rel="nofollow" title="My iTunes podcast"><i class="icon icon-itunes notranslate" aria-hidden="true"></i></a></li> <li><a href="https://t.me/joinchat/AAAAAEJFMRzsRTRxM3ec6A" rel="nofollow" title="My Telegram public channel"><i class="icon icon-telegram notranslate" aria-hidden="true"></i></a></li> <li><a href="mailto:blog@yegor256.com" rel="nofollow" title="Email me any time"><i class="icon icon-mail notranslate" aria-hidden="true"></i></a></li></ul><ul class="menu"> <li><a href="/" title="Home page">Home</a></li> <li ><a href="/best.html" title="Best articles to read">12&#160;Best</a></li> <li ><a href="/contents.html" title="The contents of the entire blog">All&#160;288</a></li> <li ><a href="/webinars.html" title="My webinars">Webinars</a></li> <li ><a href="/talks.html" title="Future and past conference talks">Talks</a></li> <li ><a href="/books.html" title="The books I wrote">Books</a></li> <li ><a href="/papers.html" title="My academic papers and patents">Papers</a></li> <li ><a href="/pets.html" title="My loved pet projects">Pets</a></li> <li ><a href="/award.html" title="Software quality award">Award</a></li> <li ><a href="/testimonials.html" title="What some people say about me">Testimonials</a></li> <li ><a href="/shift-m.html" title="Audio podcast about project management">Shift-M</a></li> <li ><a href="/paintings.html" title="My paintings for sale">Paintings</a></li> <li><a href="http://ru.yegor256.com/" title="Немного на русском языке">По-русски</a></li></ul></nav><div class="search"> <form method="get" action="https://www.google.com/search" itemprop="potentialAction" itemscope="" itemtype="http://schema.org/SearchAction"> <meta itemprop="target" content="https://www.google.com/search?q={q}"/> <input name="sitesearch" value="yegor256.com" type="hidden"/> <input itemprop="query-input" type="text" id="search-query" class="field field-text" required="required" onfocus="$('.google').css('visibility', 'visible');" name="q" placeholder="Search..." autocomplete="off"/> <input type="image" src="/images/google-search-icon.svg" class="google" title="Search via Google" alt="Search via Google"/> </form></div><div class="hot"><ul> <li> <a href="/code-ahead.html">Code Ahead</a> was published on Amazon just a few days ago! It is my new book, a novel about programmers. It explains in details the majority of ideas that stand behind <a href="https://www.zerocracy.com">Zerocracy</a> and <a href="https://www.xdsd.org">XDSD</a>. </li> <li> At <a href="/webinars.html">Webinar #37</a> we will discuss naming problem in OOP, for objects, methods and attributes; join us on <b>September 12</b>, at 11am PST. </li></ul></div></header></div><section itemscope="" itemtype="http://schema.org/BlogPosting"><div class="wrapper"> <header><p class="printable"> <img src="https://api.qrserver.com/v1/create-qr-code/?data=https://www.yegor256.com/2016/04/05/printers-instead-of-getters.html&amp;format=svg" style="width:125px;height:125px;" alt="QR code"/></p><p class="printable"> <code itemprop="url">https://www.yegor256.com/2016/04/05/printers-instead-of-getters.html</code></p><h1 itemprop="name headline mainEntityOfPage">Printers Instead of Getters</h1><aside class='book'><a href='http://amzn.to/2pyceWc'><img src='/images/books/elegant-objects/cover.png' class='book-cover' alt='book cover'/></a>Read more about this subject in <a href='http://amzn.to/2pyceWc'>Section&nbsp;5.3</a><br/> of my book<a href='http://amzn.to/2pyceWc'><img src='/images/books/amazon-buy-button.png' class='amazon-button' alt='Click to buy'/></a></aside><ul class="subline"> <li> <time itemprop="datePublished" datetime="2016-04-05T00:00:00+00:00"> 5 April 2016 </time> </li> <li class="desktop-only" itemprop="locationCreated">Palo Alto, CA</li> <li class="printable" itemscope="" itemprop="author" itemtype="http://schema.org/Person"> <span itemprop="name">Yegor Bugayenko</span> </li> <li class="unprintable"> <i class="icon icon-comments"></i> <a href="http://www.yegor256.com/2016/04/05/printers-instead-of-getters.html#disqus_thread" itemprop="discussionUrl">comments</a> </li></ul><p class="unprintable"><p>Getters and setters <a href="/2014/09/16/getters-and-setters-are-evil.html">are evil</a>. No need to argue about this, it&#39;s settled. You disagree? Let&#39;s discuss that later. For now, let&#39;s say, we want to get rid of getters. The key question is how is it possible at all? We do need to get the data out of an object, right? Nope. Wrong.</p><figure class='jb_picture'><img itemprop='image' alt='Le fabuleux destin d&#39;Amélie Poulain (2001) by Jean-Pierre Jeunet' src='/images/2016/04/amelie.jpg' longdesc='#a123a2ca'/><figcaption id='a123a2ca'>Le fabuleux destin d&#39;Amélie Poulain (2001) by Jean-Pierre Jeunet</figcaption></figure><p>I&#39;m suggesting to use &quot;printers&quot; instead. Instead of exposing data via getters, an object will have a functionality of <strong>printing</strong> itself to some media.</p><p>Let&#39;s say this is our class:</p><figure class="highlight"><pre><code class="language-java" data-lang="java"><span></span><span class="kd">public</span> <span class="kd">class</span> <span class="nc">Book</span> <span class="o">{</span>
  <span class="kd">private</span> <span class="kd">final</span> <span class="n">String</span> <span class="n">isbn</span> <span class="o">=</span>
    <span class="s">&quot;0735619654&quot;</span><span class="o">;</span>
  <span class="kd">private</span> <span class="kd">final</span> <span class="n">String</span> <span class="n">title</span> <span class="o">=</span>
    <span class="s">&quot;Object Thinking&quot;</span><span class="o">;</span>
<span class="o">}</span></code></pre></figure><p>We need it to be transferred into XML format. A more or less traditional way to do it is via getters and <a href="/2015/03/26/jaxb-vs-xembly.html">JAXB</a>:</p><figure class="highlight"><pre><code class="language-java" data-lang="java"><span></span><span class="kn">import</span> <span class="nn">javax.xml.bind.annotation.XmlElement</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">javax.xml.bind.annotation.XmlRootElement</span><span class="o">;</span>
<span class="nd">@XmlRootElement</span>
<span class="kd">public</span> <span class="kd">class</span> <span class="nc">Book</span> <span class="o">{</span>
  <span class="kd">private</span> <span class="kd">final</span> <span class="n">String</span> <span class="n">isbn</span> <span class="o">=</span>
    <span class="s">&quot;0735619654&quot;</span><span class="o">;</span>
  <span class="kd">private</span> <span class="kd">final</span> <span class="n">String</span> <span class="n">title</span> <span class="o">=</span>
    <span class="s">&quot;Object Thinking&quot;</span><span class="o">;</span>
  <span class="nd">@XmlElement</span>
  <span class="kd">public</span> <span class="n">String</span> <span class="nf">getIsbn</span><span class="o">()</span> <span class="o">{</span>
    <span class="k">return</span> <span class="k">this</span><span class="o">.</span><span class="na">isbn</span><span class="o">;</span>
  <span class="o">}</span>
  <span class="nd">@XmlElement</span>
  <span class="kd">public</span> <span class="n">String</span> <span class="nf">getTitle</span><span class="o">()</span> <span class="o">{</span>
    <span class="k">return</span> <span class="k">this</span><span class="o">.</span><span class="na">title</span><span class="o">;</span>
  <span class="o">}</span>
<span class="o">}</span></code></pre></figure><p>This is a very <a href="/2014/12/01/orm-offensive-anti-pattern.html">offensive</a> way of treating the <a href="/2014/11/20/seven-virtues-of-good-object.html">object</a>. We&#39;re basically exposing everything that&#39;s inside to the public. It was a nice little self-sufficient solid object and we turned it into a <a href="/2016/07/06/data-transfer-object.html">bag of data</a>, which anyone can access in many possible ways. We can access it for reading, of course.</p><p>It is convenient to have these getters, you may say. We are all used to them. If we want to convert it into <a href="/2015/11/16/json-vs-xml.html">JSON</a>, they will be very helpful. If we want to use this poor object as a data object in JSP, getters will help us. There are many examples in Java, where getters are being actively used.</p><aside class='youtube'> <a href='https://www.youtube.com/watch?v=_Q0cNykXB04'><div class='box'> <img src='https://i.ytimg.com/vi/_Q0cNykXB04/mqdefault.jpg' alt='YouTube video #_Q0cNykXB04'/><div class='play'><i class='icon icon-play'></i></div></div></a><div>Printers Instead of Getters in OOP (webinar #18); 7 September 2016.</div></aside><p>This is <strong>not</strong> because they are so effective. This is because we&#39;re so <a href="/2015/02/20/utility-classes-vs-functional-programming.html"><strong>procedural</strong></a> in our way of thinking. We <strong>don&#39;t trust</strong> our objects. We only trust the data they store. We don&#39;t want this <code>Book</code> object to generate the XML. We want it to give us the data. We will build the XML. The <code>Book</code> is too stupid to do that job. We&#39;re way smarter!</p><p>I&#39;m suggesting to stop thinking this way. Instead, let&#39;s try to give this poor <code>Book</code> a chance, and equip it with a &quot;printer&quot;:</p><figure class="highlight"><pre><code class="language-java" data-lang="java"><span></span><span class="kd">public</span> <span class="kd">class</span> <span class="nc">Book</span> <span class="o">{</span>
  <span class="kd">private</span> <span class="kd">final</span> <span class="n">String</span> <span class="n">isbn</span> <span class="o">=</span>
    <span class="s">&quot;0735619654&quot;</span><span class="o">;</span>
  <span class="kd">private</span> <span class="kd">final</span> <span class="n">String</span> <span class="n">title</span> <span class="o">=</span>
    <span class="s">&quot;Object Thinking&quot;</span><span class="o">;</span>
  <span class="kd">public</span> <span class="n">String</span> <span class="nf">toXML</span><span class="o">()</span> <span class="o">{</span>
    <span class="k">return</span> <span class="n">String</span><span class="o">.</span><span class="na">format</span><span class="o">(</span>
      <span class="s">&quot;&lt;book&gt;&lt;isbn&gt;%s&lt;/isbn&gt;&lt;title&gt;%s&lt;/title&gt;&lt;/book&gt;&quot;</span><span class="o">,</span>
      <span class="k">this</span><span class="o">.</span><span class="na">isbn</span><span class="o">,</span> <span class="k">this</span><span class="o">.</span><span class="na">title</span>
    <span class="o">);</span>
  <span class="o">}</span>
<span class="o">}</span></code></pre></figure><p>This isn&#39;t the <a href="/2015/03/26/jaxb-vs-xembly.html">best</a> implementation, but you got the idea. The object is not exposing its internals any more. We can&#39;t get its ISBN and its title. We can only ask it to print itself in XML format.</p><p>We can add an additional printer, if another format is required:</p><figure class="highlight"><pre><code class="language-java" data-lang="java"><span></span><span class="kd">public</span> <span class="kd">class</span> <span class="nc">Book</span> <span class="o">{</span>
  <span class="kd">private</span> <span class="kd">final</span> <span class="n">String</span> <span class="n">isbn</span> <span class="o">=</span>
    <span class="s">&quot;0735619654&quot;</span><span class="o">;</span>
  <span class="kd">private</span> <span class="kd">final</span> <span class="n">String</span> <span class="n">title</span> <span class="o">=</span>
    <span class="s">&quot;Object Thinking&quot;</span><span class="o">;</span>
  <span class="kd">public</span> <span class="n">String</span> <span class="nf">toJSON</span><span class="o">()</span> <span class="o">{</span>
    <span class="k">return</span> <span class="n">String</span><span class="o">.</span><span class="na">format</span><span class="o">(</span>
      <span class="s">&quot;{\&quot;isbn\&quot;:\&quot;%s\&quot;, \&quot;title\&quot;:\&quot;%s\&quot;}&quot;</span><span class="o">,</span>
      <span class="k">this</span><span class="o">.</span><span class="na">isbn</span><span class="o">,</span> <span class="k">this</span><span class="o">.</span><span class="na">title</span>
    <span class="o">);</span>
  <span class="o">}</span>
<span class="o">}</span></code></pre></figure><p>Again, not the best implementation, but you see what I&#39;m trying to show. Each time we need a new format, we create a new printer.</p><p>You may say that the object will be rather big if there will be many formats. That&#39;s true, but a big object is a bad design in the first place. I would say that if there is more than one printer---it&#39;s a problem.</p><p>So, what to do if we need multiple formats? Use &quot;media,&quot; where that printers will be able to print to. Say, we have an object that represents a record in MySQL. We want it to be printable to XML, HTML, JSON, some binary format and God knows what else. We can add that many printers to it, but the object will be big and ugly. To avoid that, introduce a new object, that represents the media where the data will be printed to:</p><figure class="highlight"><pre><code class="language-java" data-lang="java"><span></span><span class="kd">public</span> <span class="kd">class</span> <span class="nc">Book</span> <span class="o">{</span>
  <span class="kd">private</span> <span class="kd">final</span> <span class="n">String</span> <span class="n">isbn</span> <span class="o">=</span>
    <span class="s">&quot;0735619654&quot;</span><span class="o">;</span>
  <span class="kd">private</span> <span class="kd">final</span> <span class="n">String</span> <span class="n">title</span> <span class="o">=</span>
    <span class="s">&quot;Object Thinking&quot;</span><span class="o">;</span>
  <span class="kd">public</span> <span class="n">Media</span> <span class="nf">print</span><span class="o">(</span><span class="n">Media</span> <span class="n">media</span><span class="o">)</span> <span class="o">{</span>
    <span class="k">return</span> <span class="n">media</span>
      <span class="o">.</span><span class="na">with</span><span class="o">(</span><span class="s">&quot;isbn&quot;</span><span class="o">,</span> <span class="k">this</span><span class="o">.</span><span class="na">isbn</span><span class="o">)</span>
      <span class="o">.</span><span class="na">with</span><span class="o">(</span><span class="s">&quot;title&quot;</span><span class="o">,</span> <span class="k">this</span><span class="o">.</span><span class="na">title</span><span class="o">);</span>
  <span class="o">}</span>
<span class="o">}</span></code></pre></figure><p>Again, it&#39;s a very primitive design of that <a href="/2014/06/09/objects-should-be-immutable.html">immutable</a> <code>Media</code> class, but you got the idea---the <code>media</code> accepts the data. Now, we want to print our object to JSON (this design is not really perfect, since <code>JsonObjectBuilder</code> is not immutable, even though it looks like one...):</p><figure class="highlight"><pre><code class="language-java" data-lang="java"><span></span><span class="kd">class</span> <span class="nc">JsonMedia</span> <span class="kd">implements</span> <span class="n">Media</span> <span class="o">{</span>
  <span class="kd">private</span> <span class="kd">final</span> <span class="n">JsonObjectBuilder</span> <span class="n">builder</span><span class="o">;</span>
  <span class="n">JsonMedia</span><span class="o">()</span> <span class="o">{</span>
    <span class="k">this</span><span class="o">(</span><span class="s">&quot;book&quot;</span><span class="o">);</span>
  <span class="o">}</span>
  <span class="n">JsonMedia</span><span class="o">(</span><span class="n">String</span> <span class="n">head</span><span class="o">)</span> <span class="o">{</span>
    <span class="k">this</span><span class="o">(</span><span class="n">Json</span><span class="o">.</span><span class="na">createObjectBuilder</span><span class="o">().</span><span class="na">add</span><span class="o">(</span><span class="n">head</span><span class="o">));</span>
  <span class="o">}</span>
  <span class="n">JsonMedia</span><span class="o">(</span><span class="n">JsonObjectBuilder</span> <span class="n">bdr</span><span class="o">)</span> <span class="o">{</span>
    <span class="k">this</span><span class="o">.</span><span class="na">builder</span> <span class="o">=</span> <span class="n">bdr</span><span class="o">;</span>
  <span class="o">}</span>
  <span class="nd">@Override</span>
  <span class="kd">public</span> <span class="n">Media</span> <span class="nf">with</span><span class="o">(</span><span class="n">String</span> <span class="n">name</span><span class="o">,</span> <span class="n">String</span> <span class="n">value</span><span class="o">)</span> <span class="o">{</span>
    <span class="k">return</span> <span class="k">new</span> <span class="n">JsonMedia</span><span class="o">(</span>
      <span class="k">this</span><span class="o">.</span><span class="na">builder</span><span class="o">.</span><span class="na">add</span><span class="o">(</span><span class="n">name</span><span class="o">,</span> <span class="n">value</span><span class="o">)</span>
    <span class="o">);</span>
  <span class="o">}</span>
  <span class="kd">public</span> <span class="n">JsonObject</span> <span class="nf">json</span><span class="o">()</span> <span class="o">{</span>
    <span class="k">return</span> <span class="k">this</span><span class="o">.</span><span class="na">builder</span><span class="o">.</span><span class="na">build</span><span class="o">();</span>
  <span class="o">}</span>
<span class="o">}</span></code></pre></figure><p>Now, we make an instance of <code>JsonMedia</code> and ask our book to print itself there:</p><figure class="highlight"><pre><code class="language-java" data-lang="java"><span></span><span class="n">JsonMedia</span> <span class="n">media</span> <span class="o">=</span> <span class="k">new</span> <span class="n">JsonMedia</span><span class="o">(</span><span class="s">&quot;book&quot;</span><span class="o">);</span>
<span class="n">book</span><span class="o">.</span><span class="na">print</span><span class="o">(</span><span class="n">media</span><span class="o">);</span>
<span class="n">JsonObject</span> <span class="n">json</span> <span class="o">=</span> <span class="n">media</span><span class="o">.</span><span class="na">json</span><span class="o">();</span></code></pre></figure><p>Voilà! The JSON object is ready and the book has no idea about what exactly what printed just now. We need to print the book to XML? We create <code>XmlMedia</code>, which will print the book to XML. The <code>Book</code> class stays small, while the complexity of &quot;media&quot; objects is unlimited.</p><p>My point here is simple---no <a href="/2014/09/16/getters-and-setters-are-evil.html">getters</a>, just printers!</p></p><nav class="buttons notranslate desktop-only"> <a href="http://www.facebook.com/sharer/sharer.php?u=https://www.yegor256.com/2016/04/05/printers-instead-of-getters.html" title="Share on Facebook" class="button" rel="nofollow"> <span class="count count-facebook">0</span> <i class="icon icon-facebook notranslate" aria-hidden="true"></i> </a> <a href="https://twitter.com/share?url=https://www.yegor256.com/2016/04/05/printers-instead-of-getters.html&amp;text=Printers+Instead+of+Getters" title="Share on Twitter" class="button" rel="nofollow"> <span class="count count-twitter">0</span> <i class="icon icon-twitter notranslate" aria-hidden="true"></i> </a> <a href="https://plus.google.com/share?url=https://www.yegor256.com/2016/04/05/printers-instead-of-getters.html" title="Share on Google+" class="button" rel="nofollow"> <span class="count count-googleplus">0</span> <i class="icon icon-googleplus notranslate" aria-hidden="true"></i> </a> <a href="https://www.linkedin.com/cws/share?url=https://www.yegor256.com/2016/04/05/printers-instead-of-getters.html" title="Share on LinkedIn" class="button" rel="nofollow"> <span class="count count-linkedin">0</span> <i class="icon icon-linkedin notranslate" aria-hidden="true"></i> </a> <a href="http://reddit.com/submit?url=https://www.yegor256.com/2016/04/05/printers-instead-of-getters.html%3F2016-14&amp;title=Printers+Instead+of+Getters" title="Share on Reddit" class="button" rel="nofollow"> <span class="count count-reddit">0</span> <i class="icon icon-reddit notranslate" aria-hidden="true"></i> </a> <a href="http://news.ycombinator.com/submitlink?u=https://www.yegor256.com/2016/04/05/printers-instead-of-getters.html%3F2016-14&amp;t=Printers+Instead+of+Getters" title="Share on Hacker News" class="button" rel="nofollow"> <span class="count count-hackernews">0</span> <i class="icon icon-hackernews notranslate" aria-hidden="true"></i> </a> </nav> </header> <article class="main" itemprop="articleBody"><div ><p>Getters and setters <a href="/2014/09/16/getters-and-setters-are-evil.html">are evil</a>. No need to argue about this, it&#39;s settled. You disagree? Let&#39;s discuss that later. For now, let&#39;s say, we want to get rid of getters. The key question is how is it possible at all? We do need to get the data out of an object, right? Nope. Wrong.</p><figure class='jb_picture'><img itemprop='image' alt='Le fabuleux destin d&#39;Amélie Poulain (2001) by Jean-Pierre Jeunet' src='/images/2016/04/amelie.jpg' longdesc='#a123a2ca'/><figcaption id='a123a2ca'>Le fabuleux destin d&#39;Amélie Poulain (2001) by Jean-Pierre Jeunet</figcaption></figure><p>I&#39;m suggesting to use &quot;printers&quot; instead. Instead of exposing data via getters, an object will have a functionality of <strong>printing</strong> itself to some media.</p><p>Let&#39;s say this is our class:</p><figure class="highlight"><pre><code class="language-java" data-lang="java"><span></span><span class="kd">public</span> <span class="kd">class</span> <span class="nc">Book</span> <span class="o">{</span>
  <span class="kd">private</span> <span class="kd">final</span> <span class="n">String</span> <span class="n">isbn</span> <span class="o">=</span>
    <span class="s">&quot;0735619654&quot;</span><span class="o">;</span>
  <span class="kd">private</span> <span class="kd">final</span> <span class="n">String</span> <span class="n">title</span> <span class="o">=</span>
    <span class="s">&quot;Object Thinking&quot;</span><span class="o">;</span>
<span class="o">}</span></code></pre></figure><p>We need it to be transferred into XML format. A more or less traditional way to do it is via getters and <a href="/2015/03/26/jaxb-vs-xembly.html">JAXB</a>:</p><figure class="highlight"><pre><code class="language-java" data-lang="java"><span></span><span class="kn">import</span> <span class="nn">javax.xml.bind.annotation.XmlElement</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">javax.xml.bind.annotation.XmlRootElement</span><span class="o">;</span>
<span class="nd">@XmlRootElement</span>
<span class="kd">public</span> <span class="kd">class</span> <span class="nc">Book</span> <span class="o">{</span>
  <span class="kd">private</span> <span class="kd">final</span> <span class="n">String</span> <span class="n">isbn</span> <span class="o">=</span>
    <span class="s">&quot;0735619654&quot;</span><span class="o">;</span>
  <span class="kd">private</span> <span class="kd">final</span> <span class="n">String</span> <span class="n">title</span> <span class="o">=</span>
    <span class="s">&quot;Object Thinking&quot;</span><span class="o">;</span>
  <span class="nd">@XmlElement</span>
  <span class="kd">public</span> <span class="n">String</span> <span class="nf">getIsbn</span><span class="o">()</span> <span class="o">{</span>
    <span class="k">return</span> <span class="k">this</span><span class="o">.</span><span class="na">isbn</span><span class="o">;</span>
  <span class="o">}</span>
  <span class="nd">@XmlElement</span>
  <span class="kd">public</span> <span class="n">String</span> <span class="nf">getTitle</span><span class="o">()</span> <span class="o">{</span>
    <span class="k">return</span> <span class="k">this</span><span class="o">.</span><span class="na">title</span><span class="o">;</span>
  <span class="o">}</span>
<span class="o">}</span></code></pre></figure><p>This is a very <a href="/2014/12/01/orm-offensive-anti-pattern.html">offensive</a> way of treating the <a href="/2014/11/20/seven-virtues-of-good-object.html">object</a>. We&#39;re basically exposing everything that&#39;s inside to the public. It was a nice little self-sufficient solid object and we turned it into a <a href="/2016/07/06/data-transfer-object.html">bag of data</a>, which anyone can access in many possible ways. We can access it for reading, of course.</p><p>It is convenient to have these getters, you may say. We are all used to them. If we want to convert it into <a href="/2015/11/16/json-vs-xml.html">JSON</a>, they will be very helpful. If we want to use this poor object as a data object in JSP, getters will help us. There are many examples in Java, where getters are being actively used.</p><aside class='youtube'> <a href='https://www.youtube.com/watch?v=_Q0cNykXB04'><div class='box'> <img src='https://i.ytimg.com/vi/_Q0cNykXB04/mqdefault.jpg' alt='YouTube video #_Q0cNykXB04'/><div class='play'><i class='icon icon-play'></i></div></div></a><div>Printers Instead of Getters in OOP (webinar #18); 7 September 2016.</div></aside><p>This is <strong>not</strong> because they are so effective. This is because we&#39;re so <a href="/2015/02/20/utility-classes-vs-functional-programming.html"><strong>procedural</strong></a> in our way of thinking. We <strong>don&#39;t trust</strong> our objects. We only trust the data they store. We don&#39;t want this <code>Book</code> object to generate the XML. We want it to give us the data. We will build the XML. The <code>Book</code> is too stupid to do that job. We&#39;re way smarter!</p><p>I&#39;m suggesting to stop thinking this way. Instead, let&#39;s try to give this poor <code>Book</code> a chance, and equip it with a &quot;printer&quot;:</p><figure class="highlight"><pre><code class="language-java" data-lang="java"><span></span><span class="kd">public</span> <span class="kd">class</span> <span class="nc">Book</span> <span class="o">{</span>
  <span class="kd">private</span> <span class="kd">final</span> <span class="n">String</span> <span class="n">isbn</span> <span class="o">=</span>
    <span class="s">&quot;0735619654&quot;</span><span class="o">;</span>
  <span class="kd">private</span> <span class="kd">final</span> <span class="n">String</span> <span class="n">title</span> <span class="o">=</span>
    <span class="s">&quot;Object Thinking&quot;</span><span class="o">;</span>
  <span class="kd">public</span> <span class="n">String</span> <span class="nf">toXML</span><span class="o">()</span> <span class="o">{</span>
    <span class="k">return</span> <span class="n">String</span><span class="o">.</span><span class="na">format</span><span class="o">(</span>
      <span class="s">&quot;&lt;book&gt;&lt;isbn&gt;%s&lt;/isbn&gt;&lt;title&gt;%s&lt;/title&gt;&lt;/book&gt;&quot;</span><span class="o">,</span>
      <span class="k">this</span><span class="o">.</span><span class="na">isbn</span><span class="o">,</span> <span class="k">this</span><span class="o">.</span><span class="na">title</span>
    <span class="o">);</span>
  <span class="o">}</span>
<span class="o">}</span></code></pre></figure><p>This isn&#39;t the <a href="/2015/03/26/jaxb-vs-xembly.html">best</a> implementation, but you got the idea. The object is not exposing its internals any more. We can&#39;t get its ISBN and its title. We can only ask it to print itself in XML format.</p><p>We can add an additional printer, if another format is required:</p><figure class="highlight"><pre><code class="language-java" data-lang="java"><span></span><span class="kd">public</span> <span class="kd">class</span> <span class="nc">Book</span> <span class="o">{</span>
  <span class="kd">private</span> <span class="kd">final</span> <span class="n">String</span> <span class="n">isbn</span> <span class="o">=</span>
    <span class="s">&quot;0735619654&quot;</span><span class="o">;</span>
  <span class="kd">private</span> <span class="kd">final</span> <span class="n">String</span> <span class="n">title</span> <span class="o">=</span>
    <span class="s">&quot;Object Thinking&quot;</span><span class="o">;</span>
  <span class="kd">public</span> <span class="n">String</span> <span class="nf">toJSON</span><span class="o">()</span> <span class="o">{</span>
    <span class="k">return</span> <span class="n">String</span><span class="o">.</span><span class="na">format</span><span class="o">(</span>
      <span class="s">&quot;{\&quot;isbn\&quot;:\&quot;%s\&quot;, \&quot;title\&quot;:\&quot;%s\&quot;}&quot;</span><span class="o">,</span>
      <span class="k">this</span><span class="o">.</span><span class="na">isbn</span><span class="o">,</span> <span class="k">this</span><span class="o">.</span><span class="na">title</span>
    <span class="o">);</span>
  <span class="o">}</span>
<span class="o">}</span></code></pre></figure><p>Again, not the best implementation, but you see what I&#39;m trying to show. Each time we need a new format, we create a new printer.</p><p>You may say that the object will be rather big if there will be many formats. That&#39;s true, but a big object is a bad design in the first place. I would say that if there is more than one printer---it&#39;s a problem.</p><p>So, what to do if we need multiple formats? Use &quot;media,&quot; where that printers will be able to print to. Say, we have an object that represents a record in MySQL. We want it to be printable to XML, HTML, JSON, some binary format and God knows what else. We can add that many printers to it, but the object will be big and ugly. To avoid that, introduce a new object, that represents the media where the data will be printed to:</p><figure class="highlight"><pre><code class="language-java" data-lang="java"><span></span><span class="kd">public</span> <span class="kd">class</span> <span class="nc">Book</span> <span class="o">{</span>
  <span class="kd">private</span> <span class="kd">final</span> <span class="n">String</span> <span class="n">isbn</span> <span class="o">=</span>
    <span class="s">&quot;0735619654&quot;</span><span class="o">;</span>
  <span class="kd">private</span> <span class="kd">final</span> <span class="n">String</span> <span class="n">title</span> <span class="o">=</span>
    <span class="s">&quot;Object Thinking&quot;</span><span class="o">;</span>
  <span class="kd">public</span> <span class="n">Media</span> <span class="nf">print</span><span class="o">(</span><span class="n">Media</span> <span class="n">media</span><span class="o">)</span> <span class="o">{</span>
    <span class="k">return</span> <span class="n">media</span>
      <span class="o">.</span><span class="na">with</span><span class="o">(</span><span class="s">&quot;isbn&quot;</span><span class="o">,</span> <span class="k">this</span><span class="o">.</span><span class="na">isbn</span><span class="o">)</span>
      <span class="o">.</span><span class="na">with</span><span class="o">(</span><span class="s">&quot;title&quot;</span><span class="o">,</span> <span class="k">this</span><span class="o">.</span><span class="na">title</span><span class="o">);</span>
  <span class="o">}</span>
<span class="o">}</span></code></pre></figure><p>Again, it&#39;s a very primitive design of that <a href="/2014/06/09/objects-should-be-immutable.html">immutable</a> <code>Media</code> class, but you got the idea---the <code>media</code> accepts the data. Now, we want to print our object to JSON (this design is not really perfect, since <code>JsonObjectBuilder</code> is not immutable, even though it looks like one...):</p><figure class="highlight"><pre><code class="language-java" data-lang="java"><span></span><span class="kd">class</span> <span class="nc">JsonMedia</span> <span class="kd">implements</span> <span class="n">Media</span> <span class="o">{</span>
  <span class="kd">private</span> <span class="kd">final</span> <span class="n">JsonObjectBuilder</span> <span class="n">builder</span><span class="o">;</span>
  <span class="n">JsonMedia</span><span class="o">()</span> <span class="o">{</span>
    <span class="k">this</span><span class="o">(</span><span class="s">&quot;book&quot;</span><span class="o">);</span>
  <span class="o">}</span>
  <span class="n">JsonMedia</span><span class="o">(</span><span class="n">String</span> <span class="n">head</span><span class="o">)</span> <span class="o">{</span>
    <span class="k">this</span><span class="o">(</span><span class="n">Json</span><span class="o">.</span><span class="na">createObjectBuilder</span><span class="o">().</span><span class="na">add</span><span class="o">(</span><span class="n">head</span><span class="o">));</span>
  <span class="o">}</span>
  <span class="n">JsonMedia</span><span class="o">(</span><span class="n">JsonObjectBuilder</span> <span class="n">bdr</span><span class="o">)</span> <span class="o">{</span>
    <span class="k">this</span><span class="o">.</span><span class="na">builder</span> <span class="o">=</span> <span class="n">bdr</span><span class="o">;</span>
  <span class="o">}</span>
  <span class="nd">@Override</span>
  <span class="kd">public</span> <span class="n">Media</span> <span class="nf">with</span><span class="o">(</span><span class="n">String</span> <span class="n">name</span><span class="o">,</span> <span class="n">String</span> <span class="n">value</span><span class="o">)</span> <span class="o">{</span>
    <span class="k">return</span> <span class="k">new</span> <span class="n">JsonMedia</span><span class="o">(</span>
      <span class="k">this</span><span class="o">.</span><span class="na">builder</span><span class="o">.</span><span class="na">add</span><span class="o">(</span><span class="n">name</span><span class="o">,</span> <span class="n">value</span><span class="o">)</span>
    <span class="o">);</span>
  <span class="o">}</span>
  <span class="kd">public</span> <span class="n">JsonObject</span> <span class="nf">json</span><span class="o">()</span> <span class="o">{</span>
    <span class="k">return</span> <span class="k">this</span><span class="o">.</span><span class="na">builder</span><span class="o">.</span><span class="na">build</span><span class="o">();</span>
  <span class="o">}</span>
<span class="o">}</span></code></pre></figure><p>Now, we make an instance of <code>JsonMedia</code> and ask our book to print itself there:</p><figure class="highlight"><pre><code class="language-java" data-lang="java"><span></span><span class="n">JsonMedia</span> <span class="n">media</span> <span class="o">=</span> <span class="k">new</span> <span class="n">JsonMedia</span><span class="o">(</span><span class="s">&quot;book&quot;</span><span class="o">);</span>
<span class="n">book</span><span class="o">.</span><span class="na">print</span><span class="o">(</span><span class="n">media</span><span class="o">);</span>
<span class="n">JsonObject</span> <span class="n">json</span> <span class="o">=</span> <span class="n">media</span><span class="o">.</span><span class="na">json</span><span class="o">();</span></code></pre></figure><p>Voilà! The JSON object is ready and the book has no idea about what exactly what printed just now. We need to print the book to XML? We create <code>XmlMedia</code>, which will print the book to XML. The <code>Book</code> class stays small, while the complexity of &quot;media&quot; objects is unlimited.</p><p>My point here is simple---no <a href="/2014/09/16/getters-and-setters-are-evil.html">getters</a>, just printers!</p></div></article></div><div class="wrapper"> <related-posts /></div><div class="disqus" role="complementary"><p class="disqus_hint"> Please, use <a href="https://help.disqus.com/commenting/what-html-tags-are-allowed-within-comments">syntax highlighting</a> in your comments, to make them more readable.</p><div id="disqus_thread" class="disqus-thread"> <a>&nbsp;</a></div><script> var disqus_config = function () { this.page.url = document.location.href.split('?')[0].split('#')[0].replace('https://', 'http://'); this.page.identifier = this.page.url; }; (function() { var d = document, s = d.createElement('script'); s.src = '//yegor256.disqus.com/embed.js'; s.setAttribute('data-timestamp', +new Date()); (d.head || d.body).appendChild(s); })(); </script> <noscript><div><p class="red"> JavaScript is disabled in your browser, that's why you can't see comments under this post.</p></div></noscript></div><div class="wrapper"> <footer class="footer"><p> &copy; <span itemscope="" itemprop="copyrightHolder" itemtype="http://schema.org/Person"> <span itemprop="name">Yegor Bugayenko</span> </span> 2014&ndash;<span itemprop="copyrightYear">2018</span></p></footer></div></section><div class="wrapper unprintable" style="text-align:center;margin-top:2em;"> <a href="http://www.sixnines.io/h/3ba1652f"> <img src="//www.sixnines.io/b/3ba1652f?style=flat" alt="sixnines availability badge"/> </a></div><script src="//code.jquery.com/jquery-1.9.0.min.js"></script> <script src="/js/all.js?a0e0d018c07"></script> <script>var disqus_shortname = 'yegor256';</script> <script id="dsq-count-scr" src="//yegor256.disqus.com/count.js" async="async"></script> <script> (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){ (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o), m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m) })(window,document,'script','//www.google-analytics.com/analytics.js','ga'); ga('create', 'UA-1963507-32', 'auto'); ga('send', 'pageview'); </script> <script> Cd=document;Cr="&"+Math.random();Cp="&s=1"; Cd.cookie="b=b";if(Cd.cookie)Cp+="&c=1"; Cp+="&t="+(new Date()).getTimezoneOffset(); if(self!=top)Cp+="&f=1"; </script> <script> if(navigator.javaEnabled())Cp+="&j=1"; </script> <script> if(typeof(screen)!='undefined')Cp+="&w="+screen.width+"&h="+ screen.height+"&d="+(screen.colorDepth?screen.colorDepth:screen.pixelDepth); </script> <script> Cd.write("<img src='//c.hit.ua/hit?i=95870&g=0&x=2"+Cp+Cr+ "&r="+escape(Cd.referrer)+"&u="+escape(window.location.href)+ "' border='0' wi"+"dth='1' he"+"ight='1'/>"); </script> <script type="application/ld+json"> { "@context": "http://schema.org", "@type": "Person", "name": "Yegor Bugayenko", "url": "http://www.yegor256.com", "sameAs": [ "https://www.facebook.com/yegor256", "https://instagram.com/yegor256", "https://www.linkedin.com/in/yegor256", "https://twitter.com/yegor256", "https://github.com/yegor256", "https://www.pinterest.com/yegor256/" ] } </script> </body> </html> <!DOCTYPE html> <html xmlns="http://www.w3.org/1999/xhtml" lang="en-US" xml:lang="en-US" itemscope="" itemtype="http://schema.org/WebSite"> <head> <meta charset="utf-8"/> <meta name="description" content="Opening a resource inside a try/catch block and then finally checking for null is such a typical and annoying mistake. " /> <meta name="keywords" content="close stream java, java close stream in finally, java close stream try catch, java finally, java try catch" /> <meta name="viewport" content="width=device-width,minimum-scale=1,initial-scale=1"/> <meta name="google-site-verification" content="JEj_gQr2CPe2QKGw8XdMz0R7VboQIUbX3FlM-lwTq-8" /> <meta name="author" content="Yegor Bugayenko"> <meta name="article:published_time" content="2016-03-22 00:00:00 +0000"> <meta name="og:site_name" content="Yegor Bugayenko"/> <meta name="og:type" content="article" /> <meta name="og:locale" content="en_US" /> <meta name="twitter:account_id" content="4503599630178231" /> <meta name="twitter:creator" content="@yegor256"/> <meta name="twitter:site" content="@yegor256"/> <meta name="twitter:title" property="og:title" content="Try. Finally. If. Not. Null."/> <meta name="twitter:description" property="og:description" content="Opening a resource inside a try/catch block and then finally checking for null is such a typical and annoying mistake. "/> <meta name="twitter:url" property="og:url" content="https://www.yegor256.com/2016/03/22/try-finally-if-not-null.html"/> <meta name="telegram:channel" content="AAAAAEJFMRzsRTRxM3ec6A"/> <link rel="search" type="application/opensearchdescription+xml" href="/opensearch.xml" title="yegor256" /> <link rel="shortcut icon" href="/favicon.ico?a0e0d018c07"/> <link rel="apple-touch-icon" href="/favicon.ico?a0e0d018c07"/> <link rel="alternate" type="application/rss+xml" title="RSS for yegor256.com" href="https://www.yegor256.com/rss.xml"/> <link rel="stylesheet" href="/css/layout.css?a0e0d018c07"/> <link rel="stylesheet" href="/css/icons.css?a0e0d018c07"/> <link rel="canonical" href="https://www.yegor256.com/2016/03/22/try-finally-if-not-null.html" /> <link rel="amphtml" href="https://www.yegor256.com/2016/03/22/try-finally-if-not-null.amp.html" /> <title>Try. Finally. If. Not. Null. </title> <meta name='og:image' content='https://www.yegor256.com/images/2016/03/lock-stock-two-smoking-barrels.jpg'/><meta name='twitter:image' content='https://www.yegor256.com/images/2016/03/lock-stock-two-smoking-barrels.jpg'/><meta name='og:image:width' content='1200'/> <meta name='twitter:image:width' content='1200'/><meta name='og:image:height' content='675'/> <meta name='twitter:image:height' content='675'/><meta name='twitter:card' content='summary_large_image'/><meta name='twitter:image:alt' content='Lock, Stock and Two Smoking Barrels (1998) by Guy Ritchie'/> </head> <body><div class="wrapper"> <aside class="header-toggle unprintable" id="header-toggle" title="Show the menu" onclick="$('#header').show();$('#header-toggle').hide();">&#9776;</aside> <header class="header" id="header"><div class="face"> <a href="/about-me.html#form" class="sub" title="Click to subscribe to my monthly newsletter"><span>Subscribe</span></a> <a href="/about-me.html" style="position:relative;"> <img src="/images/face-256x256.jpg" class="photo" alt="Yegor Bugayenko"/> </a></div><nav><ul class="menu social notranslate"> <li><a href="https://twitter.com/intent/follow?screen_name=yegor256" rel="nofollow" title="Follow me on Twitter"><i class="icon icon-twitter notranslate" aria-hidden="true"></i></a></li> <li><a href="/rss.xml" rel="nofollow" title="Subscribe to my RSS feed"><i class="icon icon-rss notranslate" aria-hidden="true"></i></a></li> <li><a itemprop="sameAs" href="https://github.com/yegor256" rel="nofollow" title="My GitHub profile"><i class="icon icon-github notranslate" aria-hidden="true"></i></a></li> <li><a itemprop="sameAs" href="http://stackoverflow.com/users/187141/yegor256" rel="nofollow" title="My StackOverflow profile"><i class="icon icon-stackoverflow notranslate" aria-hidden="true"></i></a></li> <li><a itemprop="sameAs" href="https://www.facebook.com/yegor256" rel="nofollow" title="Follow me on Facebook"><i class="icon icon-facebook notranslate" aria-hidden="true"></i></a></li> <li><a itemprop="sameAs" href="https://instagram.com/yegor256" rel="nofollow" title="Follow me on Instagram"><i class="icon icon-instagram notranslate" aria-hidden="true"></i></a></li> <li><a itemprop="sameAs" href="https://www.linkedin.com/in/yegor256" rel="nofollow" title="My LinkedIn profile"><i class="icon icon-linkedin notranslate" aria-hidden="true"></i></a></li> <li><a itemprop="sameAs" href="https://www.youtube.com/c/yegor256?sub_confirmation=1" rel="nofollow" title="My Youtube video channel"><i class="icon icon-youtube notranslate" aria-hidden="true"></i></a></li> <li><a itemprop="sameAs" href="https://www.pinterest.com/yegor256/" rel="nofollow" title="My Pinterest boards"><i class="icon icon-pinterest notranslate" aria-hidden="true"></i></a></li> <li><a itemprop="sameAs" href="https://angel.co/yegor256" rel="nofollow" title="My AngelList profile"><i class="icon icon-angellist notranslate" aria-hidden="true"></i></a></li> <li><a href="https://soundcloud.com/yegor256" rel="nofollow" title="My podcast"><i class="icon icon-podcast notranslate" aria-hidden="true"></i></a></li> <li><a href="https://itunes.apple.com/us/podcast/yegor256-podcast/id1150826721" rel="nofollow" title="My iTunes podcast"><i class="icon icon-itunes notranslate" aria-hidden="true"></i></a></li> <li><a href="https://t.me/joinchat/AAAAAEJFMRzsRTRxM3ec6A" rel="nofollow" title="My Telegram public channel"><i class="icon icon-telegram notranslate" aria-hidden="true"></i></a></li> <li><a href="mailto:blog@yegor256.com" rel="nofollow" title="Email me any time"><i class="icon icon-mail notranslate" aria-hidden="true"></i></a></li></ul><ul class="menu"> <li><a href="/" title="Home page">Home</a></li> <li ><a href="/best.html" title="Best articles to read">12&#160;Best</a></li> <li ><a href="/contents.html" title="The contents of the entire blog">All&#160;288</a></li> <li ><a href="/webinars.html" title="My webinars">Webinars</a></li> <li ><a href="/talks.html" title="Future and past conference talks">Talks</a></li> <li ><a href="/books.html" title="The books I wrote">Books</a></li> <li ><a href="/papers.html" title="My academic papers and patents">Papers</a></li> <li ><a href="/pets.html" title="My loved pet projects">Pets</a></li> <li ><a href="/award.html" title="Software quality award">Award</a></li> <li ><a href="/testimonials.html" title="What some people say about me">Testimonials</a></li> <li ><a href="/shift-m.html" title="Audio podcast about project management">Shift-M</a></li> <li ><a href="/paintings.html" title="My paintings for sale">Paintings</a></li> <li><a href="http://ru.yegor256.com/" title="Немного на русском языке">По-русски</a></li></ul></nav><div class="search"> <form method="get" action="https://www.google.com/search" itemprop="potentialAction" itemscope="" itemtype="http://schema.org/SearchAction"> <meta itemprop="target" content="https://www.google.com/search?q={q}"/> <input name="sitesearch" value="yegor256.com" type="hidden"/> <input itemprop="query-input" type="text" id="search-query" class="field field-text" required="required" onfocus="$('.google').css('visibility', 'visible');" name="q" placeholder="Search..." autocomplete="off"/> <input type="image" src="/images/google-search-icon.svg" class="google" title="Search via Google" alt="Search via Google"/> </form></div><div class="hot"><ul> <li> <a href="/code-ahead.html">Code Ahead</a> was published on Amazon just a few days ago! It is my new book, a novel about programmers. It explains in details the majority of ideas that stand behind <a href="https://www.zerocracy.com">Zerocracy</a> and <a href="https://www.xdsd.org">XDSD</a>. </li> <li> At <a href="/webinars.html">Webinar #37</a> we will discuss naming problem in OOP, for objects, methods and attributes; join us on <b>September 12</b>, at 11am PST. </li></ul></div></header></div><section itemscope="" itemtype="http://schema.org/BlogPosting"><div class="wrapper"> <header><p class="printable"> <img src="https://api.qrserver.com/v1/create-qr-code/?data=https://www.yegor256.com/2016/03/22/try-finally-if-not-null.html&amp;format=svg" style="width:125px;height:125px;" alt="QR code"/></p><p class="printable"> <code itemprop="url">https://www.yegor256.com/2016/03/22/try-finally-if-not-null.html</code></p><h1 itemprop="name headline mainEntityOfPage">Try. Finally. If. Not. Null.</h1><aside class='book'><a href='http://amzn.to/2qFt4Tn'><img src='/images/books/elegant-objects/cover.png' class='book-cover' alt='book cover'/></a>Read more about this subject in <a href='http://amzn.to/2qFt4Tn'>Section&nbsp;2.6</a><br/> of my book<a href='http://amzn.to/2qFt4Tn'><img src='/images/books/amazon-buy-button.png' class='amazon-button' alt='Click to buy'/></a></aside><ul class="subline"> <li> <time itemprop="datePublished" datetime="2016-03-22T00:00:00+00:00"> 22 March 2016 </time> </li> <li class="desktop-only" itemprop="locationCreated">Palo Alto, CA</li> <li class="printable" itemscope="" itemprop="author" itemtype="http://schema.org/Person"> <span itemprop="name">Yegor Bugayenko</span> </li> <li class="unprintable"> <i class="icon icon-comments"></i> <a href="http://www.yegor256.com/2016/03/22/try-finally-if-not-null.html#disqus_thread" itemprop="discussionUrl">comments</a> </li></ul><p class="unprintable"><p>There is a very typical mistake in pre-Java7 &quot;try/finally&quot; scenario, which I keep seeing in so many code reviews. I just have to write about it. Java7 introduced a solution, but it doesn&#39;t cover all situations. Sometimes we need to deal with non-<code>AutoCloseable</code> resources. Let&#39;s open and close them correctly, please.</p><figure class='jb_picture'><img itemprop='image' alt='Lock, Stock and Two Smoking Barrels (1998) by Guy Ritchie' src='/images/2016/03/lock-stock-two-smoking-barrels.jpg' longdesc='#118d4d8e'/><figcaption id='118d4d8e'>Lock, Stock and Two Smoking Barrels (1998) by Guy Ritchie</figcaption></figure><p>This is how it looks (assuming we are in Java 6):</p><figure class="highlight"><pre><code class="language-java" data-lang="java"><span></span><span class="n">InputStream</span> <span class="n">input</span> <span class="o">=</span> <span class="kc">null</span><span class="o">;</span>
<span class="k">try</span> <span class="o">{</span>
  <span class="n">input</span> <span class="o">=</span> <span class="n">url</span><span class="o">.</span><span class="na">openStream</span><span class="o">();</span>
  <span class="c1">// reads the stream, throws IOException</span>
<span class="o">}</span> <span class="k">catch</span> <span class="o">(</span><span class="n">IOException</span> <span class="n">ex</span><span class="o">)</span> <span class="o">{</span>
  <span class="k">throw</span> <span class="k">new</span> <span class="n">RuntimeException</span><span class="o">(</span><span class="n">ex</span><span class="o">);</span>
<span class="o">}</span> <span class="k">finally</span> <span class="o">{</span>
  <span class="k">if</span> <span class="o">(</span><span class="n">input</span> <span class="o">!=</span> <span class="kc">null</span><span class="o">)</span> <span class="o">{</span>
    <span class="n">input</span><span class="o">.</span><span class="na">close</span><span class="o">();</span>
  <span class="o">}</span>
<span class="o">}</span></code></pre></figure> <aside class='youtube'> <a href='https://www.youtube.com/watch?v=o3aNJX7AP3M'><div class='box'> <img src='https://i.ytimg.com/vi/o3aNJX7AP3M/mqdefault.jpg' alt='YouTube video #o3aNJX7AP3M'/><div class='play'><i class='icon icon-play'></i></div></div></a><div>What is Wrong About NULL in OOP? (webinar #3); 3 June 2015.</div></aside><p>I already wrote about <a href="/2014/05/13/why-null-is-bad.html"><code>null</code></a> and its evil nature. Here it comes again. If you just follow the rule of &quot;not using NULL anywhere ever,&quot; this code would need an immediate refactoring. Its correct version will look like this:</p><figure class="highlight"><pre><code class="language-java" data-lang="java"><span></span><span class="kd">final</span> <span class="n">InputStream</span> <span class="n">input</span> <span class="o">=</span> <span class="n">url</span><span class="o">.</span><span class="na">openStream</span><span class="o">();</span>
<span class="k">try</span> <span class="o">{</span>
  <span class="c1">// reads the stream, throws IOException</span>
<span class="o">}</span> <span class="k">catch</span> <span class="o">(</span><span class="n">IOException</span> <span class="n">ex</span><span class="o">)</span> <span class="o">{</span>
  <span class="k">throw</span> <span class="k">new</span> <span class="n">RuntimeException</span><span class="o">(</span><span class="n">ex</span><span class="o">);</span>
<span class="o">}</span> <span class="k">finally</span> <span class="o">{</span>
  <span class="n">input</span><span class="o">.</span><span class="na">close</span><span class="o">();</span>
<span class="o">}</span></code></pre></figure><p>There is no <code>null</code> anymore and it&#39;s very clean. Isn&#39;t it?</p><p>There are situations when opening the resource itself throws <code>IOException</code> and we can&#39;t put it outside of <code>try/catch</code>. In that case, we have to have <strong>two</strong> <code>try/catch</code> blocks:</p><figure class="highlight"><pre><code class="language-java" data-lang="java"><span></span><span class="kd">final</span> <span class="n">InputStream</span> <span class="n">input</span><span class="o">;</span>
<span class="k">try</span> <span class="o">{</span>
  <span class="n">input</span> <span class="o">=</span> <span class="n">url</span><span class="o">.</span><span class="na">openStream</span><span class="o">();</span>
<span class="o">}</span> <span class="k">catch</span> <span class="o">(</span><span class="n">IOException</span> <span class="n">ex</span><span class="o">)</span> <span class="o">{</span>
  <span class="k">throw</span> <span class="k">new</span> <span class="n">RuntimeException</span><span class="o">(</span><span class="n">ex</span><span class="o">);</span>
<span class="o">}</span>
<span class="k">try</span> <span class="o">{</span>
  <span class="c1">// reads the stream, throws IOException</span>
<span class="o">}</span> <span class="k">catch</span> <span class="o">(</span><span class="n">IOException</span> <span class="n">ex</span><span class="o">)</span> <span class="o">{</span>
  <span class="k">throw</span> <span class="k">new</span> <span class="n">RuntimeException</span><span class="o">(</span><span class="n">ex</span><span class="o">);</span>
<span class="o">}</span> <span class="k">finally</span> <span class="o">{</span>
  <span class="n">input</span><span class="o">.</span><span class="na">close</span><span class="o">();</span>
<span class="o">}</span></code></pre></figure><p>But there should be no <code>null</code>, never!</p><p>The presence of <code>null</code> in Java code is a clear indicator of code smell. Something is not right if you have to use <code>null</code>. The only place where the presence of <code>null</code> is justified is where we&#39;re using third-party APIs or JDK. They may return <code>null</code> sometimes because... well, their design is bad. We have no other option but to do <code>if(x==null)</code>. But that&#39;s it. No other places are good for <code>null</code>.</p></p><nav class="buttons notranslate desktop-only"> <a href="http://www.facebook.com/sharer/sharer.php?u=https://www.yegor256.com/2016/03/22/try-finally-if-not-null.html" title="Share on Facebook" class="button" rel="nofollow"> <span class="count count-facebook">0</span> <i class="icon icon-facebook notranslate" aria-hidden="true"></i> </a> <a href="https://twitter.com/share?url=https://www.yegor256.com/2016/03/22/try-finally-if-not-null.html&amp;text=Try.+Finally.+If.+Not.+Null." title="Share on Twitter" class="button" rel="nofollow"> <span class="count count-twitter">0</span> <i class="icon icon-twitter notranslate" aria-hidden="true"></i> </a> <a href="https://plus.google.com/share?url=https://www.yegor256.com/2016/03/22/try-finally-if-not-null.html" title="Share on Google+" class="button" rel="nofollow"> <span class="count count-googleplus">0</span> <i class="icon icon-googleplus notranslate" aria-hidden="true"></i> </a> <a href="https://www.linkedin.com/cws/share?url=https://www.yegor256.com/2016/03/22/try-finally-if-not-null.html" title="Share on LinkedIn" class="button" rel="nofollow"> <span class="count count-linkedin">0</span> <i class="icon icon-linkedin notranslate" aria-hidden="true"></i> </a> <a href="http://reddit.com/submit?url=https://www.yegor256.com/2016/03/22/try-finally-if-not-null.html%3F2016-12&amp;title=Try.+Finally.+If.+Not.+Null." title="Share on Reddit" class="button" rel="nofollow"> <span class="count count-reddit">0</span> <i class="icon icon-reddit notranslate" aria-hidden="true"></i> </a> <a href="http://news.ycombinator.com/submitlink?u=https://www.yegor256.com/2016/03/22/try-finally-if-not-null.html%3F2016-12&amp;t=Try.+Finally.+If.+Not.+Null." title="Share on Hacker News" class="button" rel="nofollow"> <span class="count count-hackernews">0</span> <i class="icon icon-hackernews notranslate" aria-hidden="true"></i> </a> </nav> </header> <article class="main" itemprop="articleBody"><div ><p>There is a very typical mistake in pre-Java7 &quot;try/finally&quot; scenario, which I keep seeing in so many code reviews. I just have to write about it. Java7 introduced a solution, but it doesn&#39;t cover all situations. Sometimes we need to deal with non-<code>AutoCloseable</code> resources. Let&#39;s open and close them correctly, please.</p><figure class='jb_picture'><img itemprop='image' alt='Lock, Stock and Two Smoking Barrels (1998) by Guy Ritchie' src='/images/2016/03/lock-stock-two-smoking-barrels.jpg' longdesc='#118d4d8e'/><figcaption id='118d4d8e'>Lock, Stock and Two Smoking Barrels (1998) by Guy Ritchie</figcaption></figure><p>This is how it looks (assuming we are in Java 6):</p><figure class="highlight"><pre><code class="language-java" data-lang="java"><span></span><span class="n">InputStream</span> <span class="n">input</span> <span class="o">=</span> <span class="kc">null</span><span class="o">;</span>
<span class="k">try</span> <span class="o">{</span>
  <span class="n">input</span> <span class="o">=</span> <span class="n">url</span><span class="o">.</span><span class="na">openStream</span><span class="o">();</span>
  <span class="c1">// reads the stream, throws IOException</span>
<span class="o">}</span> <span class="k">catch</span> <span class="o">(</span><span class="n">IOException</span> <span class="n">ex</span><span class="o">)</span> <span class="o">{</span>
  <span class="k">throw</span> <span class="k">new</span> <span class="n">RuntimeException</span><span class="o">(</span><span class="n">ex</span><span class="o">);</span>
<span class="o">}</span> <span class="k">finally</span> <span class="o">{</span>
  <span class="k">if</span> <span class="o">(</span><span class="n">input</span> <span class="o">!=</span> <span class="kc">null</span><span class="o">)</span> <span class="o">{</span>
    <span class="n">input</span><span class="o">.</span><span class="na">close</span><span class="o">();</span>
  <span class="o">}</span>
<span class="o">}</span></code></pre></figure> <aside class='youtube'> <a href='https://www.youtube.com/watch?v=o3aNJX7AP3M'><div class='box'> <img src='https://i.ytimg.com/vi/o3aNJX7AP3M/mqdefault.jpg' alt='YouTube video #o3aNJX7AP3M'/><div class='play'><i class='icon icon-play'></i></div></div></a><div>What is Wrong About NULL in OOP? (webinar #3); 3 June 2015.</div></aside><p>I already wrote about <a href="/2014/05/13/why-null-is-bad.html"><code>null</code></a> and its evil nature. Here it comes again. If you just follow the rule of &quot;not using NULL anywhere ever,&quot; this code would need an immediate refactoring. Its correct version will look like this:</p><figure class="highlight"><pre><code class="language-java" data-lang="java"><span></span><span class="kd">final</span> <span class="n">InputStream</span> <span class="n">input</span> <span class="o">=</span> <span class="n">url</span><span class="o">.</span><span class="na">openStream</span><span class="o">();</span>
<span class="k">try</span> <span class="o">{</span>
  <span class="c1">// reads the stream, throws IOException</span>
<span class="o">}</span> <span class="k">catch</span> <span class="o">(</span><span class="n">IOException</span> <span class="n">ex</span><span class="o">)</span> <span class="o">{</span>
  <span class="k">throw</span> <span class="k">new</span> <span class="n">RuntimeException</span><span class="o">(</span><span class="n">ex</span><span class="o">);</span>
<span class="o">}</span> <span class="k">finally</span> <span class="o">{</span>
  <span class="n">input</span><span class="o">.</span><span class="na">close</span><span class="o">();</span>
<span class="o">}</span></code></pre></figure><p>There is no <code>null</code> anymore and it&#39;s very clean. Isn&#39;t it?</p><p>There are situations when opening the resource itself throws <code>IOException</code> and we can&#39;t put it outside of <code>try/catch</code>. In that case, we have to have <strong>two</strong> <code>try/catch</code> blocks:</p><figure class="highlight"><pre><code class="language-java" data-lang="java"><span></span><span class="kd">final</span> <span class="n">InputStream</span> <span class="n">input</span><span class="o">;</span>
<span class="k">try</span> <span class="o">{</span>
  <span class="n">input</span> <span class="o">=</span> <span class="n">url</span><span class="o">.</span><span class="na">openStream</span><span class="o">();</span>
<span class="o">}</span> <span class="k">catch</span> <span class="o">(</span><span class="n">IOException</span> <span class="n">ex</span><span class="o">)</span> <span class="o">{</span>
  <span class="k">throw</span> <span class="k">new</span> <span class="n">RuntimeException</span><span class="o">(</span><span class="n">ex</span><span class="o">);</span>
<span class="o">}</span>
<span class="k">try</span> <span class="o">{</span>
  <span class="c1">// reads the stream, throws IOException</span>
<span class="o">}</span> <span class="k">catch</span> <span class="o">(</span><span class="n">IOException</span> <span class="n">ex</span><span class="o">)</span> <span class="o">{</span>
  <span class="k">throw</span> <span class="k">new</span> <span class="n">RuntimeException</span><span class="o">(</span><span class="n">ex</span><span class="o">);</span>
<span class="o">}</span> <span class="k">finally</span> <span class="o">{</span>
  <span class="n">input</span><span class="o">.</span><span class="na">close</span><span class="o">();</span>
<span class="o">}</span></code></pre></figure><p>But there should be no <code>null</code>, never!</p><p>The presence of <code>null</code> in Java code is a clear indicator of code smell. Something is not right if you have to use <code>null</code>. The only place where the presence of <code>null</code> is justified is where we&#39;re using third-party APIs or JDK. They may return <code>null</code> sometimes because... well, their design is bad. We have no other option but to do <code>if(x==null)</code>. But that&#39;s it. No other places are good for <code>null</code>.</p></div></article></div><div class="wrapper"> <related-posts /></div><div class="disqus" role="complementary"><p class="disqus_hint"> Please, use <a href="https://help.disqus.com/commenting/what-html-tags-are-allowed-within-comments">syntax highlighting</a> in your comments, to make them more readable.</p><div id="disqus_thread" class="disqus-thread"> <a>&nbsp;</a></div><script> var disqus_config = function () { this.page.url = document.location.href.split('?')[0].split('#')[0].replace('https://', 'http://'); this.page.identifier = this.page.url; }; (function() { var d = document, s = d.createElement('script'); s.src = '//yegor256.disqus.com/embed.js'; s.setAttribute('data-timestamp', +new Date()); (d.head || d.body).appendChild(s); })(); </script> <noscript><div><p class="red"> JavaScript is disabled in your browser, that's why you can't see comments under this post.</p></div></noscript></div><div class="wrapper"> <footer class="footer"><p> &copy; <span itemscope="" itemprop="copyrightHolder" itemtype="http://schema.org/Person"> <span itemprop="name">Yegor Bugayenko</span> </span> 2014&ndash;<span itemprop="copyrightYear">2018</span></p></footer></div></section><div class="wrapper unprintable" style="text-align:center;margin-top:2em;"> <a href="http://www.sixnines.io/h/3ba1652f"> <img src="//www.sixnines.io/b/3ba1652f?style=flat" alt="sixnines availability badge"/> </a></div><script src="//code.jquery.com/jquery-1.9.0.min.js"></script> <script src="/js/all.js?a0e0d018c07"></script> <script>var disqus_shortname = 'yegor256';</script> <script id="dsq-count-scr" src="//yegor256.disqus.com/count.js" async="async"></script> <script> (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){ (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o), m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m) })(window,document,'script','//www.google-analytics.com/analytics.js','ga'); ga('create', 'UA-1963507-32', 'auto'); ga('send', 'pageview'); </script> <script> Cd=document;Cr="&"+Math.random();Cp="&s=1"; Cd.cookie="b=b";if(Cd.cookie)Cp+="&c=1"; Cp+="&t="+(new Date()).getTimezoneOffset(); if(self!=top)Cp+="&f=1"; </script> <script> if(navigator.javaEnabled())Cp+="&j=1"; </script> <script> if(typeof(screen)!='undefined')Cp+="&w="+screen.width+"&h="+ screen.height+"&d="+(screen.colorDepth?screen.colorDepth:screen.pixelDepth); </script> <script> Cd.write("<img src='//c.hit.ua/hit?i=95870&g=0&x=2"+Cp+Cr+ "&r="+escape(Cd.referrer)+"&u="+escape(window.location.href)+ "' border='0' wi"+"dth='1' he"+"ight='1'/>"); </script> <script type="application/ld+json"> { "@context": "http://schema.org", "@type": "Person", "name": "Yegor Bugayenko", "url": "http://www.yegor256.com", "sameAs": [ "https://www.facebook.com/yegor256", "https://instagram.com/yegor256", "https://www.linkedin.com/in/yegor256", "https://twitter.com/yegor256", "https://github.com/yegor256", "https://www.pinterest.com/yegor256/" ] } </script> </body> </html> <!DOCTYPE html> <html xmlns="http://www.w3.org/1999/xhtml" lang="en-US" xml:lang="en-US" itemscope="" itemtype="http://schema.org/WebSite"> <head> <meta charset="utf-8"/> <meta name="description" content="These are the most popular design patterns in object-oriented programming, though some of them are actually anti-patterns, in my opinion. " /> <meta name="keywords" content="anti patterns, clean code, design pattern, java design pattern, oop design pattern" /> <meta name="viewport" content="width=device-width,minimum-scale=1,initial-scale=1"/> <meta name="google-site-verification" content="JEj_gQr2CPe2QKGw8XdMz0R7VboQIUbX3FlM-lwTq-8" /> <meta name="author" content="Yegor Bugayenko"> <meta name="article:published_time" content="2016-02-03 00:00:00 +0000"> <meta name="og:site_name" content="Yegor Bugayenko"/> <meta name="og:type" content="article" /> <meta name="og:locale" content="en_US" /> <meta name="twitter:account_id" content="4503599630178231" /> <meta name="twitter:creator" content="@yegor256"/> <meta name="twitter:site" content="@yegor256"/> <meta name="twitter:title" property="og:title" content="Design Patterns and Anti-Patterns, Love and Hate"/> <meta name="twitter:description" property="og:description" content="These are the most popular design patterns in object-oriented programming, though some of them are actually anti-patterns, in my opinion. "/> <meta name="twitter:url" property="og:url" content="https://www.yegor256.com/2016/02/03/design-patterns-and-anti-patterns.html"/> <meta name="telegram:channel" content="AAAAAEJFMRzsRTRxM3ec6A"/> <link rel="search" type="application/opensearchdescription+xml" href="/opensearch.xml" title="yegor256" /> <link rel="shortcut icon" href="/favicon.ico?a0e0d018c07"/> <link rel="apple-touch-icon" href="/favicon.ico?a0e0d018c07"/> <link rel="alternate" type="application/rss+xml" title="RSS for yegor256.com" href="https://www.yegor256.com/rss.xml"/> <link rel="stylesheet" href="/css/layout.css?a0e0d018c07"/> <link rel="stylesheet" href="/css/icons.css?a0e0d018c07"/> <link rel="canonical" href="https://www.yegor256.com/2016/02/03/design-patterns-and-anti-patterns.html" /> <link rel="amphtml" href="https://www.yegor256.com/2016/02/03/design-patterns-and-anti-patterns.amp.html" /> <title>Design Patterns and Anti-Patterns, Love and Hate </title> <meta name='og:image' content='https://www.yegor256.com/images/2016/02/the-shining.jpg'/><meta name='twitter:image' content='https://www.yegor256.com/images/2016/02/the-shining.jpg'/><meta name='og:image:width' content='1200'/> <meta name='twitter:image:width' content='1200'/><meta name='og:image:height' content='675'/> <meta name='twitter:image:height' content='675'/><meta name='twitter:card' content='summary_large_image'/><meta name='twitter:image:alt' content='The Shining (1980) by Stanley Kubrick'/> </head> <body><div class="wrapper"> <aside class="header-toggle unprintable" id="header-toggle" title="Show the menu" onclick="$('#header').show();$('#header-toggle').hide();">&#9776;</aside> <header class="header" id="header"><div class="face"> <a href="/about-me.html#form" class="sub" title="Click to subscribe to my monthly newsletter"><span>Subscribe</span></a> <a href="/about-me.html" style="position:relative;"> <img src="/images/face-256x256.jpg" class="photo" alt="Yegor Bugayenko"/> </a></div><nav><ul class="menu social notranslate"> <li><a href="https://twitter.com/intent/follow?screen_name=yegor256" rel="nofollow" title="Follow me on Twitter"><i class="icon icon-twitter notranslate" aria-hidden="true"></i></a></li> <li><a href="/rss.xml" rel="nofollow" title="Subscribe to my RSS feed"><i class="icon icon-rss notranslate" aria-hidden="true"></i></a></li> <li><a itemprop="sameAs" href="https://github.com/yegor256" rel="nofollow" title="My GitHub profile"><i class="icon icon-github notranslate" aria-hidden="true"></i></a></li> <li><a itemprop="sameAs" href="http://stackoverflow.com/users/187141/yegor256" rel="nofollow" title="My StackOverflow profile"><i class="icon icon-stackoverflow notranslate" aria-hidden="true"></i></a></li> <li><a itemprop="sameAs" href="https://www.facebook.com/yegor256" rel="nofollow" title="Follow me on Facebook"><i class="icon icon-facebook notranslate" aria-hidden="true"></i></a></li> <li><a itemprop="sameAs" href="https://instagram.com/yegor256" rel="nofollow" title="Follow me on Instagram"><i class="icon icon-instagram notranslate" aria-hidden="true"></i></a></li> <li><a itemprop="sameAs" href="https://www.linkedin.com/in/yegor256" rel="nofollow" title="My LinkedIn profile"><i class="icon icon-linkedin notranslate" aria-hidden="true"></i></a></li> <li><a itemprop="sameAs" href="https://www.youtube.com/c/yegor256?sub_confirmation=1" rel="nofollow" title="My Youtube video channel"><i class="icon icon-youtube notranslate" aria-hidden="true"></i></a></li> <li><a itemprop="sameAs" href="https://www.pinterest.com/yegor256/" rel="nofollow" title="My Pinterest boards"><i class="icon icon-pinterest notranslate" aria-hidden="true"></i></a></li> <li><a itemprop="sameAs" href="https://angel.co/yegor256" rel="nofollow" title="My AngelList profile"><i class="icon icon-angellist notranslate" aria-hidden="true"></i></a></li> <li><a href="https://soundcloud.com/yegor256" rel="nofollow" title="My podcast"><i class="icon icon-podcast notranslate" aria-hidden="true"></i></a></li> <li><a href="https://itunes.apple.com/us/podcast/yegor256-podcast/id1150826721" rel="nofollow" title="My iTunes podcast"><i class="icon icon-itunes notranslate" aria-hidden="true"></i></a></li> <li><a href="https://t.me/joinchat/AAAAAEJFMRzsRTRxM3ec6A" rel="nofollow" title="My Telegram public channel"><i class="icon icon-telegram notranslate" aria-hidden="true"></i></a></li> <li><a href="mailto:blog@yegor256.com" rel="nofollow" title="Email me any time"><i class="icon icon-mail notranslate" aria-hidden="true"></i></a></li></ul><ul class="menu"> <li><a href="/" title="Home page">Home</a></li> <li ><a href="/best.html" title="Best articles to read">12&#160;Best</a></li> <li ><a href="/contents.html" title="The contents of the entire blog">All&#160;288</a></li> <li ><a href="/webinars.html" title="My webinars">Webinars</a></li> <li ><a href="/talks.html" title="Future and past conference talks">Talks</a></li> <li ><a href="/books.html" title="The books I wrote">Books</a></li> <li ><a href="/papers.html" title="My academic papers and patents">Papers</a></li> <li ><a href="/pets.html" title="My loved pet projects">Pets</a></li> <li ><a href="/award.html" title="Software quality award">Award</a></li> <li ><a href="/testimonials.html" title="What some people say about me">Testimonials</a></li> <li ><a href="/shift-m.html" title="Audio podcast about project management">Shift-M</a></li> <li ><a href="/paintings.html" title="My paintings for sale">Paintings</a></li> <li><a href="http://ru.yegor256.com/" title="Немного на русском языке">По-русски</a></li></ul></nav><div class="search"> <form method="get" action="https://www.google.com/search" itemprop="potentialAction" itemscope="" itemtype="http://schema.org/SearchAction"> <meta itemprop="target" content="https://www.google.com/search?q={q}"/> <input name="sitesearch" value="yegor256.com" type="hidden"/> <input itemprop="query-input" type="text" id="search-query" class="field field-text" required="required" onfocus="$('.google').css('visibility', 'visible');" name="q" placeholder="Search..." autocomplete="off"/> <input type="image" src="/images/google-search-icon.svg" class="google" title="Search via Google" alt="Search via Google"/> </form></div><div class="hot"><ul> <li> <a href="/code-ahead.html">Code Ahead</a> was published on Amazon just a few days ago! It is my new book, a novel about programmers. It explains in details the majority of ideas that stand behind <a href="https://www.zerocracy.com">Zerocracy</a> and <a href="https://www.xdsd.org">XDSD</a>. </li> <li> At <a href="/webinars.html">Webinar #37</a> we will discuss naming problem in OOP, for objects, methods and attributes; join us on <b>September 12</b>, at 11am PST. </li></ul></div></header></div><section itemscope="" itemtype="http://schema.org/BlogPosting"><div class="wrapper"> <header><p class="printable"> <img src="https://api.qrserver.com/v1/create-qr-code/?data=https://www.yegor256.com/2016/02/03/design-patterns-and-anti-patterns.html&amp;format=svg" style="width:125px;height:125px;" alt="QR code"/></p><p class="printable"> <code itemprop="url">https://www.yegor256.com/2016/02/03/design-patterns-and-anti-patterns.html</code></p><h1 itemprop="name headline mainEntityOfPage">Design Patterns and Anti-Patterns, Love and Hate</h1><ul class="subline"> <li> <time itemprop="datePublished" datetime="2016-02-03T00:00:00+00:00"> 3 February 2016 </time> </li> <li class="desktop-only" itemprop="locationCreated">Palo Alto, CA</li> <li class="printable" itemscope="" itemprop="author" itemtype="http://schema.org/Person"> <span itemprop="name">Yegor Bugayenko</span> </li> <li class="unprintable"> <i class="icon icon-comments"></i> <a href="http://www.yegor256.com/2016/02/03/design-patterns-and-anti-patterns.html#disqus_thread" itemprop="discussionUrl">comments</a> </li></ul><p class="unprintable"><p><a href="https://en.wikipedia.org/wiki/Software_design_pattern">Design Patterns</a> are ... Come on, you know what they are. They are something we <strong>love</strong> and <strong>hate</strong>. We love them because they let us write code without thinking. We hate them when we see the code of someone who is used to writing code without thinking. Am I wrong? Now, let me try to go through all of them and show you how much I love or hate each one. Follow me, in alphabetic order.</p><figure class='jb_picture'><img itemprop='image' alt='The Shining (1980) by Stanley Kubrick' src='/images/2016/02/the-shining.jpg' longdesc='#27f582ec'/><figcaption id='27f582ec'>The Shining (1980) by Stanley Kubrick</figcaption></figure> <aside class='youtube'> <a href='https://www.youtube.com/watch?v=WSgP85kr6eU'><div class='box'> <img src='https://i.ytimg.com/vi/WSgP85kr6eU/mqdefault.jpg' alt='YouTube video #WSgP85kr6eU'/><div class='play'><i class='icon icon-play'></i></div></div></a><div>Why Getters-and-Setters Is An Anti-Pattern? (webinar #4); 1 July 2015.</div></aside><p><a href="https://en.wikipedia.org/wiki/Abstract_factory_pattern"><span class='green'>Abstract Factory</span></a>. It&#39;s OK.</p><p><a href="https://en.wikipedia.org/wiki/Adapter_pattern"><span class='green'>Adapter</span></a>. Good one!</p><p><a href="https://en.wikipedia.org/wiki/Bridge_pattern"><span class='green'>Bridge</span></a>. Good one!</p><p><a href="https://en.wikipedia.org/wiki/Builder_pattern"><span class='red'>Builder</span></a>. Terrible concept, since it encourages us to create and use big, complex objects. If you need a builder, there is already something wrong in your code. Refactor it so any object is easy to create through its constructors.</p><p><a href="https://en.wikipedia.org/wiki/Chain_of_responsibility_pattern"><span class='green'>Chain of Responsibility</span></a>. Seems fine.</p><p><a href="https://en.wikipedia.org/wiki/Command_pattern"><span class='green'>Command</span></a>. It&#39;s OK.</p><p><a href="https://en.wikipedia.org/wiki/Composite_pattern"><span class='green'>Composite</span></a>. Good one; check out <a href="/2015/10/01/vertical-horizontal-decorating.html">this</a> too.</p><p><a href="https://en.wikipedia.org/wiki/Data_transfer_object"><span class='red'>Data Transfer Object</span></a>. It&#39;s just <a href="/2016/07/06/data-transfer-object.html">a shame</a>.</p><p><a href="https://en.wikipedia.org/wiki/Decorator_pattern"><span class='green'>Decorator</span></a>. My <a href="/2015/02/26/composable-decorators.html">favorite</a> one. I highly recommend you use it.</p><p><a href="https://en.wikipedia.org/wiki/Facade_pattern"><span class='red'>Facade</span></a>. Bad idea. In OOP, we need objects and only objects, not facades for them. This design pattern is very procedural in its spirit, since a facade is nothing more than a collection of <a href="/2015/02/20/utility-classes-vs-functional-programming.html">procedures</a>.</p><p><a href="https://en.wikipedia.org/wiki/Factory_method_pattern"><span class='orange'>Factory Method</span></a>. This one seems OK.</p><p><a href="https://en.wikipedia.org/wiki/Flyweight_pattern"><span class='red'>Flyweight</span></a>. It&#39;s a workaround, as I see it, so it&#39;s not a good design pattern. I would recommend you not use it unless there is a really critical performance issue. But calling it a design pattern ... no way. A fix for a performance problem in Java? Yes.</p><p><a href="https://en.wikipedia.org/wiki/Front_controller"><span class='red'>Front Controller</span></a>. Terrible idea, as well as the entire <a href="https://en.wikipedia.org/wiki/Model%E2%80%93view%E2%80%93controller">MVC</a>. It&#39;s very <a href="/2016/12/13/mvc-vs-oop.html">procedural</a>, that&#39;s why.</p><p><a href="https://en.wikipedia.org/wiki/Interpreter_pattern"><span class='orange'>Interpreter</span></a>. It&#39;s OK, but I <a href="/2015/03/09/objects-end-with-er.html">don&#39;t like</a> the name. &quot;Expression&quot; would be a much better alternative.</p><p><a href="https://en.wikipedia.org/wiki/Iterator_pattern"><span class='red'>Iterator</span></a>. Bad idea, since it is mutable. It would be much better to have <a href="/2014/06/09/objects-should-be-immutable.html">immutable</a> &quot;cursors.&quot;</p><p><a href="https://en.wikipedia.org/wiki/Lazy_initialization"><span class='green'>Lazy Initialization</span></a>. It&#39;s OK.</p><p><a href="https://en.wikipedia.org/wiki/Marker_interface_pattern"><span class='red'>Marker</span></a>. It&#39;s a terrible idea, along with reflection and <a href="/2015/04/02/class-casting-is-anti-pattern.html">type casting</a>.</p><p><a href="https://en.wikipedia.org/wiki/Model%E2%80%93view%E2%80%93controller"><span class='red'>MVC</span></a>. Bad idea, since it&#39;s very procedural. <a href="/2015/03/09/objects-end-with-er.html">Controllers</a> are the key broken element in this concept. We need real objects, not procedural controllers.</p><p><a href="https://en.wikipedia.org/wiki/Mediator_pattern"><span class='red'>Mediator</span></a>. I don&#39;t like it. Even though it sounds like a technique for decreasing complexity and coupling, it is not really object-oriented. Who is this mediator? Just a &quot;channel&quot; between objects? Why shouldn&#39;t objects communicate directly? Because they are too complex? Make them smaller and simpler, rather than inventing these mediators.</p><p><a href="https://en.wikipedia.org/wiki/Memento_pattern"><span class='red'>Memento</span></a>. This idea implies that objects are <a href="/2014/06/09/objects-should-be-immutable.html">mutable</a>, which I&#39;m against in general.</p><p><a href="https://en.wikipedia.org/wiki/Module_pattern"><span class='red'>Module</span></a>. If Wikipedia is right about this pattern, it&#39;s something even more terrible than the Singleton.</p><p><a href="https://en.wikipedia.org/wiki/Multiton_pattern"><span class='red'>Multiton</span></a>. Really bad idea. Same as Singleton.</p><p><a href="https://en.wikipedia.org/wiki/Null_Object_pattern"><span class='green'>Null Object</span></a>. Good one. By the way, see <a href="/2014/05/13/why-null-is-bad.html">Why NULL Is Bad</a></p><p><a href="https://en.wikipedia.org/wiki/Object_pool_pattern"><span class='green'>Object Pool</span></a>. Good one.</p><p><a href="https://en.wikipedia.org/wiki/Observer_pattern"><span class='orange'>Observer</span></a>. The idea is good, but the name is bad, since it <a href="/2015/03/09/objects-end-with-er.html">ends with -ER</a>. A much better one would be &quot;Source&quot; and &quot;Target.&quot; The Source generates events and the Target listens to them.</p><p><a href="https://en.wikipedia.org/wiki/Object-relational_mapping"><span class='red'>ORM</span></a>. It&#39;s terrible and &quot;offensive&quot;; check <a href="/2014/12/01/orm-offensive-anti-pattern.html">this</a> out.</p><p><a href="https://en.wikipedia.org/wiki/Prototype_pattern"><span class='orange'>Prototype</span></a>. Good idea, but what does it have to do with OOP?</p><p><a href="https://en.wikipedia.org/wiki/Proxy_pattern"><span class='green'>Proxy</span></a>. Good one.</p><p><a href="https://en.wikipedia.org/wiki/Resource_Acquisition_Is_Initialization"><span class='green'>RAII</span></a>. This is a really good one, and I <a href="/2017/08/08/raii-in-java.html">highly recommend</a> you use it.</p><p><a href="https://en.wikipedia.org/wiki/Design_pattern_Servant"><span class='red'>Servant</span></a>. A very bad idea, because it&#39;s highly <a href="/2015/02/20/utility-classes-vs-functional-programming.html">procedural</a>.</p><p><a href="https://en.wikipedia.org/wiki/Singleton_pattern"><span class='red'>Singleton</span></a>. It&#39;s the king of all anti-patterns. Stay away from it at all costs.</p><p><a href="https://en.wikipedia.org/wiki/Specification_pattern"><span class='green'>Specification</span></a>. It&#39;s OK.</p><p><a href="https://en.wikipedia.org/wiki/State_pattern"><span class='orange'>State</span></a>. Although it&#39;s not implied, I feel that in most cases the use of this pattern results in mutability, a code characteristic that I&#39;m generally <a href="/2014/06/09/objects-should-be-immutable.html">against</a>.</p><p><a href="https://en.wikipedia.org/wiki/Strategy_pattern"><span class='green'>Strategy</span></a>. A good one.</p><p><a href="https://en.wikipedia.org/wiki/Template_method_pattern"><span class='red'>Template Method</span></a>. is wrong, since implementation inheritance <a href="/2016/09/13/inheritance-is-procedural.html">is procedural</a>.</p><p><a href="https://en.wikipedia.org/wiki/Visitor_pattern"><span class='red'>Visitor</span></a>. A rather <a href="/2015/02/20/utility-classes-vs-functional-programming.html">procedural</a> concept that treats objects as data structures, which we can manipulate.</p><hr/><p>I have nothing against <a href="https://en.wikipedia.org/wiki/Concurrency_pattern">concurrency patterns</a> either; they are all <span class="green">good</span>, since they have almost nothing to do with object-oriented programming.</p><p>If you know some other design (anti-)patterns, let me know in the comments below. I&#39;ll add them here.</p></p><nav class="buttons notranslate desktop-only"> <a href="http://www.facebook.com/sharer/sharer.php?u=https://www.yegor256.com/2016/02/03/design-patterns-and-anti-patterns.html" title="Share on Facebook" class="button" rel="nofollow"> <span class="count count-facebook">0</span> <i class="icon icon-facebook notranslate" aria-hidden="true"></i> </a> <a href="https://twitter.com/share?url=https://www.yegor256.com/2016/02/03/design-patterns-and-anti-patterns.html&amp;text=Design+Patterns+and+Anti-Patterns%2C+Love+and+Hate" title="Share on Twitter" class="button" rel="nofollow"> <span class="count count-twitter">0</span> <i class="icon icon-twitter notranslate" aria-hidden="true"></i> </a> <a href="https://plus.google.com/share?url=https://www.yegor256.com/2016/02/03/design-patterns-and-anti-patterns.html" title="Share on Google+" class="button" rel="nofollow"> <span class="count count-googleplus">0</span> <i class="icon icon-googleplus notranslate" aria-hidden="true"></i> </a> <a href="https://www.linkedin.com/cws/share?url=https://www.yegor256.com/2016/02/03/design-patterns-and-anti-patterns.html" title="Share on LinkedIn" class="button" rel="nofollow"> <span class="count count-linkedin">0</span> <i class="icon icon-linkedin notranslate" aria-hidden="true"></i> </a> <a href="http://reddit.com/submit?url=https://www.yegor256.com/2016/02/03/design-patterns-and-anti-patterns.html%3F2016-05&amp;title=Design+Patterns+and+Anti-Patterns%2C+Love+and+Hate" title="Share on Reddit" class="button" rel="nofollow"> <span class="count count-reddit">0</span> <i class="icon icon-reddit notranslate" aria-hidden="true"></i> </a> <a href="http://news.ycombinator.com/submitlink?u=https://www.yegor256.com/2016/02/03/design-patterns-and-anti-patterns.html%3F2016-05&amp;t=Design+Patterns+and+Anti-Patterns%2C+Love+and+Hate" title="Share on Hacker News" class="button" rel="nofollow"> <span class="count count-hackernews">0</span> <i class="icon icon-hackernews notranslate" aria-hidden="true"></i> </a> </nav> </header> <article class="main" itemprop="articleBody"><div ><p><a href="https://en.wikipedia.org/wiki/Software_design_pattern">Design Patterns</a> are ... Come on, you know what they are. They are something we <strong>love</strong> and <strong>hate</strong>. We love them because they let us write code without thinking. We hate them when we see the code of someone who is used to writing code without thinking. Am I wrong? Now, let me try to go through all of them and show you how much I love or hate each one. Follow me, in alphabetic order.</p><figure class='jb_picture'><img itemprop='image' alt='The Shining (1980) by Stanley Kubrick' src='/images/2016/02/the-shining.jpg' longdesc='#27f582ec'/><figcaption id='27f582ec'>The Shining (1980) by Stanley Kubrick</figcaption></figure> <aside class='youtube'> <a href='https://www.youtube.com/watch?v=WSgP85kr6eU'><div class='box'> <img src='https://i.ytimg.com/vi/WSgP85kr6eU/mqdefault.jpg' alt='YouTube video #WSgP85kr6eU'/><div class='play'><i class='icon icon-play'></i></div></div></a><div>Why Getters-and-Setters Is An Anti-Pattern? (webinar #4); 1 July 2015.</div></aside><p><a href="https://en.wikipedia.org/wiki/Abstract_factory_pattern"><span class='green'>Abstract Factory</span></a>. It&#39;s OK.</p><p><a href="https://en.wikipedia.org/wiki/Adapter_pattern"><span class='green'>Adapter</span></a>. Good one!</p><p><a href="https://en.wikipedia.org/wiki/Bridge_pattern"><span class='green'>Bridge</span></a>. Good one!</p><p><a href="https://en.wikipedia.org/wiki/Builder_pattern"><span class='red'>Builder</span></a>. Terrible concept, since it encourages us to create and use big, complex objects. If you need a builder, there is already something wrong in your code. Refactor it so any object is easy to create through its constructors.</p><p><a href="https://en.wikipedia.org/wiki/Chain_of_responsibility_pattern"><span class='green'>Chain of Responsibility</span></a>. Seems fine.</p><p><a href="https://en.wikipedia.org/wiki/Command_pattern"><span class='green'>Command</span></a>. It&#39;s OK.</p><p><a href="https://en.wikipedia.org/wiki/Composite_pattern"><span class='green'>Composite</span></a>. Good one; check out <a href="/2015/10/01/vertical-horizontal-decorating.html">this</a> too.</p><p><a href="https://en.wikipedia.org/wiki/Data_transfer_object"><span class='red'>Data Transfer Object</span></a>. It&#39;s just <a href="/2016/07/06/data-transfer-object.html">a shame</a>.</p><p><a href="https://en.wikipedia.org/wiki/Decorator_pattern"><span class='green'>Decorator</span></a>. My <a href="/2015/02/26/composable-decorators.html">favorite</a> one. I highly recommend you use it.</p><p><a href="https://en.wikipedia.org/wiki/Facade_pattern"><span class='red'>Facade</span></a>. Bad idea. In OOP, we need objects and only objects, not facades for them. This design pattern is very procedural in its spirit, since a facade is nothing more than a collection of <a href="/2015/02/20/utility-classes-vs-functional-programming.html">procedures</a>.</p><p><a href="https://en.wikipedia.org/wiki/Factory_method_pattern"><span class='orange'>Factory Method</span></a>. This one seems OK.</p><p><a href="https://en.wikipedia.org/wiki/Flyweight_pattern"><span class='red'>Flyweight</span></a>. It&#39;s a workaround, as I see it, so it&#39;s not a good design pattern. I would recommend you not use it unless there is a really critical performance issue. But calling it a design pattern ... no way. A fix for a performance problem in Java? Yes.</p><p><a href="https://en.wikipedia.org/wiki/Front_controller"><span class='red'>Front Controller</span></a>. Terrible idea, as well as the entire <a href="https://en.wikipedia.org/wiki/Model%E2%80%93view%E2%80%93controller">MVC</a>. It&#39;s very <a href="/2016/12/13/mvc-vs-oop.html">procedural</a>, that&#39;s why.</p><p><a href="https://en.wikipedia.org/wiki/Interpreter_pattern"><span class='orange'>Interpreter</span></a>. It&#39;s OK, but I <a href="/2015/03/09/objects-end-with-er.html">don&#39;t like</a> the name. &quot;Expression&quot; would be a much better alternative.</p><p><a href="https://en.wikipedia.org/wiki/Iterator_pattern"><span class='red'>Iterator</span></a>. Bad idea, since it is mutable. It would be much better to have <a href="/2014/06/09/objects-should-be-immutable.html">immutable</a> &quot;cursors.&quot;</p><p><a href="https://en.wikipedia.org/wiki/Lazy_initialization"><span class='green'>Lazy Initialization</span></a>. It&#39;s OK.</p><p><a href="https://en.wikipedia.org/wiki/Marker_interface_pattern"><span class='red'>Marker</span></a>. It&#39;s a terrible idea, along with reflection and <a href="/2015/04/02/class-casting-is-anti-pattern.html">type casting</a>.</p><p><a href="https://en.wikipedia.org/wiki/Model%E2%80%93view%E2%80%93controller"><span class='red'>MVC</span></a>. Bad idea, since it&#39;s very procedural. <a href="/2015/03/09/objects-end-with-er.html">Controllers</a> are the key broken element in this concept. We need real objects, not procedural controllers.</p><p><a href="https://en.wikipedia.org/wiki/Mediator_pattern"><span class='red'>Mediator</span></a>. I don&#39;t like it. Even though it sounds like a technique for decreasing complexity and coupling, it is not really object-oriented. Who is this mediator? Just a &quot;channel&quot; between objects? Why shouldn&#39;t objects communicate directly? Because they are too complex? Make them smaller and simpler, rather than inventing these mediators.</p><p><a href="https://en.wikipedia.org/wiki/Memento_pattern"><span class='red'>Memento</span></a>. This idea implies that objects are <a href="/2014/06/09/objects-should-be-immutable.html">mutable</a>, which I&#39;m against in general.</p><p><a href="https://en.wikipedia.org/wiki/Module_pattern"><span class='red'>Module</span></a>. If Wikipedia is right about this pattern, it&#39;s something even more terrible than the Singleton.</p><p><a href="https://en.wikipedia.org/wiki/Multiton_pattern"><span class='red'>Multiton</span></a>. Really bad idea. Same as Singleton.</p><p><a href="https://en.wikipedia.org/wiki/Null_Object_pattern"><span class='green'>Null Object</span></a>. Good one. By the way, see <a href="/2014/05/13/why-null-is-bad.html">Why NULL Is Bad</a></p><p><a href="https://en.wikipedia.org/wiki/Object_pool_pattern"><span class='green'>Object Pool</span></a>. Good one.</p><p><a href="https://en.wikipedia.org/wiki/Observer_pattern"><span class='orange'>Observer</span></a>. The idea is good, but the name is bad, since it <a href="/2015/03/09/objects-end-with-er.html">ends with -ER</a>. A much better one would be &quot;Source&quot; and &quot;Target.&quot; The Source generates events and the Target listens to them.</p><p><a href="https://en.wikipedia.org/wiki/Object-relational_mapping"><span class='red'>ORM</span></a>. It&#39;s terrible and &quot;offensive&quot;; check <a href="/2014/12/01/orm-offensive-anti-pattern.html">this</a> out.</p><p><a href="https://en.wikipedia.org/wiki/Prototype_pattern"><span class='orange'>Prototype</span></a>. Good idea, but what does it have to do with OOP?</p><p><a href="https://en.wikipedia.org/wiki/Proxy_pattern"><span class='green'>Proxy</span></a>. Good one.</p><p><a href="https://en.wikipedia.org/wiki/Resource_Acquisition_Is_Initialization"><span class='green'>RAII</span></a>. This is a really good one, and I <a href="/2017/08/08/raii-in-java.html">highly recommend</a> you use it.</p><p><a href="https://en.wikipedia.org/wiki/Design_pattern_Servant"><span class='red'>Servant</span></a>. A very bad idea, because it&#39;s highly <a href="/2015/02/20/utility-classes-vs-functional-programming.html">procedural</a>.</p><p><a href="https://en.wikipedia.org/wiki/Singleton_pattern"><span class='red'>Singleton</span></a>. It&#39;s the king of all anti-patterns. Stay away from it at all costs.</p><p><a href="https://en.wikipedia.org/wiki/Specification_pattern"><span class='green'>Specification</span></a>. It&#39;s OK.</p><p><a href="https://en.wikipedia.org/wiki/State_pattern"><span class='orange'>State</span></a>. Although it&#39;s not implied, I feel that in most cases the use of this pattern results in mutability, a code characteristic that I&#39;m generally <a href="/2014/06/09/objects-should-be-immutable.html">against</a>.</p><p><a href="https://en.wikipedia.org/wiki/Strategy_pattern"><span class='green'>Strategy</span></a>. A good one.</p><p><a href="https://en.wikipedia.org/wiki/Template_method_pattern"><span class='red'>Template Method</span></a>. is wrong, since implementation inheritance <a href="/2016/09/13/inheritance-is-procedural.html">is procedural</a>.</p><p><a href="https://en.wikipedia.org/wiki/Visitor_pattern"><span class='red'>Visitor</span></a>. A rather <a href="/2015/02/20/utility-classes-vs-functional-programming.html">procedural</a> concept that treats objects as data structures, which we can manipulate.</p><hr/><p>I have nothing against <a href="https://en.wikipedia.org/wiki/Concurrency_pattern">concurrency patterns</a> either; they are all <span class="green">good</span>, since they have almost nothing to do with object-oriented programming.</p><p>If you know some other design (anti-)patterns, let me know in the comments below. I&#39;ll add them here.</p></div></article></div><div class="wrapper"> <related-posts /></div><div class="disqus" role="complementary"><p class="disqus_hint"> Please, use <a href="https://help.disqus.com/commenting/what-html-tags-are-allowed-within-comments">syntax highlighting</a> in your comments, to make them more readable.</p><div id="disqus_thread" class="disqus-thread"> <a>&nbsp;</a></div><script> var disqus_config = function () { this.page.url = document.location.href.split('?')[0].split('#')[0].replace('https://', 'http://'); this.page.identifier = this.page.url; }; (function() { var d = document, s = d.createElement('script'); s.src = '//yegor256.disqus.com/embed.js'; s.setAttribute('data-timestamp', +new Date()); (d.head || d.body).appendChild(s); })(); </script> <noscript><div><p class="red"> JavaScript is disabled in your browser, that's why you can't see comments under this post.</p></div></noscript></div><div class="wrapper"> <footer class="footer"><p> &copy; <span itemscope="" itemprop="copyrightHolder" itemtype="http://schema.org/Person"> <span itemprop="name">Yegor Bugayenko</span> </span> 2014&ndash;<span itemprop="copyrightYear">2018</span></p></footer></div></section><div class="wrapper unprintable" style="text-align:center;margin-top:2em;"> <a href="http://www.sixnines.io/h/3ba1652f"> <img src="//www.sixnines.io/b/3ba1652f?style=flat" alt="sixnines availability badge"/> </a></div><script src="//code.jquery.com/jquery-1.9.0.min.js"></script> <script src="/js/all.js?a0e0d018c07"></script> <script>var disqus_shortname = 'yegor256';</script> <script id="dsq-count-scr" src="//yegor256.disqus.com/count.js" async="async"></script> <script> (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){ (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o), m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m) })(window,document,'script','//www.google-analytics.com/analytics.js','ga'); ga('create', 'UA-1963507-32', 'auto'); ga('send', 'pageview'); </script> <script> Cd=document;Cr="&"+Math.random();Cp="&s=1"; Cd.cookie="b=b";if(Cd.cookie)Cp+="&c=1"; Cp+="&t="+(new Date()).getTimezoneOffset(); if(self!=top)Cp+="&f=1"; </script> <script> if(navigator.javaEnabled())Cp+="&j=1"; </script> <script> if(typeof(screen)!='undefined')Cp+="&w="+screen.width+"&h="+ screen.height+"&d="+(screen.colorDepth?screen.colorDepth:screen.pixelDepth); </script> <script> Cd.write("<img src='//c.hit.ua/hit?i=95870&g=0&x=2"+Cp+Cr+ "&r="+escape(Cd.referrer)+"&u="+escape(window.location.href)+ "' border='0' wi"+"dth='1' he"+"ight='1'/>"); </script> <script type="application/ld+json"> { "@context": "http://schema.org", "@type": "Person", "name": "Yegor Bugayenko", "url": "http://www.yegor256.com", "sameAs": [ "https://www.facebook.com/yegor256", "https://instagram.com/yegor256", "https://www.linkedin.com/in/yegor256", "https://twitter.com/yegor256", "https://github.com/yegor256", "https://www.pinterest.com/yegor256/" ] } </script> </body> </html> <!DOCTYPE html> <html xmlns="http://www.w3.org/1999/xhtml" lang="en-US" xml:lang="en-US" itemscope="" itemtype="http://schema.org/WebSite"> <head> <meta charset="utf-8"/> <meta name="description" content="Defensive programming is a good idea, but the way it gets implemented is, in most cases, very wrong; here is what I&apos;m suggesting instead. " /> <meta name="keywords" content="check for null, defensive programming, startup failure stories, validate method arguments, validators in oop" /> <meta name="viewport" content="width=device-width,minimum-scale=1,initial-scale=1"/> <meta name="google-site-verification" content="JEj_gQr2CPe2QKGw8XdMz0R7VboQIUbX3FlM-lwTq-8" /> <meta name="author" content="Yegor Bugayenko"> <meta name="article:published_time" content="2016-01-26 00:00:00 +0000"> <meta name="og:site_name" content="Yegor Bugayenko"/> <meta name="og:type" content="article" /> <meta name="og:locale" content="en_US" /> <meta name="twitter:account_id" content="4503599630178231" /> <meta name="twitter:creator" content="@yegor256"/> <meta name="twitter:site" content="@yegor256"/> <meta name="twitter:title" property="og:title" content="Defensive Programming via Validating Decorators"/> <meta name="twitter:description" property="og:description" content="Defensive programming is a good idea, but the way it gets implemented is, in most cases, very wrong; here is what I&apos;m suggesting instead. "/> <meta name="twitter:url" property="og:url" content="https://www.yegor256.com/2016/01/26/defensive-programming.html"/> <meta name="telegram:channel" content="AAAAAEJFMRzsRTRxM3ec6A"/> <link rel="search" type="application/opensearchdescription+xml" href="/opensearch.xml" title="yegor256" /> <link rel="shortcut icon" href="/favicon.ico?a0e0d018c07"/> <link rel="apple-touch-icon" href="/favicon.ico?a0e0d018c07"/> <link rel="alternate" type="application/rss+xml" title="RSS for yegor256.com" href="https://www.yegor256.com/rss.xml"/> <link rel="stylesheet" href="/css/layout.css?a0e0d018c07"/> <link rel="stylesheet" href="/css/icons.css?a0e0d018c07"/> <link rel="canonical" href="https://www.yegor256.com/2016/01/26/defensive-programming.html" /> <link rel="amphtml" href="https://www.yegor256.com/2016/01/26/defensive-programming.amp.html" /> <title>Defensive Programming via Validating Decorators </title> <meta name='og:image' content='https://www.yegor256.com/images/2016/01/shi-mian-mai-fu.jpg'/><meta name='twitter:image' content='https://www.yegor256.com/images/2016/01/shi-mian-mai-fu.jpg'/><meta name='og:image:width' content='1200'/> <meta name='twitter:image:width' content='1200'/><meta name='og:image:height' content='508'/> <meta name='twitter:image:height' content='508'/><meta name='twitter:card' content='summary_large_image'/><meta name='twitter:image:alt' content='Shi mian mai fu (2004) by Yimou Zhang'/> </head> <body><div class="wrapper"> <aside class="header-toggle unprintable" id="header-toggle" title="Show the menu" onclick="$('#header').show();$('#header-toggle').hide();">&#9776;</aside> <header class="header" id="header"><div class="face"> <a href="/about-me.html#form" class="sub" title="Click to subscribe to my monthly newsletter"><span>Subscribe</span></a> <a href="/about-me.html" style="position:relative;"> <img src="/images/face-256x256.jpg" class="photo" alt="Yegor Bugayenko"/> </a></div><nav><ul class="menu social notranslate"> <li><a href="https://twitter.com/intent/follow?screen_name=yegor256" rel="nofollow" title="Follow me on Twitter"><i class="icon icon-twitter notranslate" aria-hidden="true"></i></a></li> <li><a href="/rss.xml" rel="nofollow" title="Subscribe to my RSS feed"><i class="icon icon-rss notranslate" aria-hidden="true"></i></a></li> <li><a itemprop="sameAs" href="https://github.com/yegor256" rel="nofollow" title="My GitHub profile"><i class="icon icon-github notranslate" aria-hidden="true"></i></a></li> <li><a itemprop="sameAs" href="http://stackoverflow.com/users/187141/yegor256" rel="nofollow" title="My StackOverflow profile"><i class="icon icon-stackoverflow notranslate" aria-hidden="true"></i></a></li> <li><a itemprop="sameAs" href="https://www.facebook.com/yegor256" rel="nofollow" title="Follow me on Facebook"><i class="icon icon-facebook notranslate" aria-hidden="true"></i></a></li> <li><a itemprop="sameAs" href="https://instagram.com/yegor256" rel="nofollow" title="Follow me on Instagram"><i class="icon icon-instagram notranslate" aria-hidden="true"></i></a></li> <li><a itemprop="sameAs" href="https://www.linkedin.com/in/yegor256" rel="nofollow" title="My LinkedIn profile"><i class="icon icon-linkedin notranslate" aria-hidden="true"></i></a></li> <li><a itemprop="sameAs" href="https://www.youtube.com/c/yegor256?sub_confirmation=1" rel="nofollow" title="My Youtube video channel"><i class="icon icon-youtube notranslate" aria-hidden="true"></i></a></li> <li><a itemprop="sameAs" href="https://www.pinterest.com/yegor256/" rel="nofollow" title="My Pinterest boards"><i class="icon icon-pinterest notranslate" aria-hidden="true"></i></a></li> <li><a itemprop="sameAs" href="https://angel.co/yegor256" rel="nofollow" title="My AngelList profile"><i class="icon icon-angellist notranslate" aria-hidden="true"></i></a></li> <li><a href="https://soundcloud.com/yegor256" rel="nofollow" title="My podcast"><i class="icon icon-podcast notranslate" aria-hidden="true"></i></a></li> <li><a href="https://itunes.apple.com/us/podcast/yegor256-podcast/id1150826721" rel="nofollow" title="My iTunes podcast"><i class="icon icon-itunes notranslate" aria-hidden="true"></i></a></li> <li><a href="https://t.me/joinchat/AAAAAEJFMRzsRTRxM3ec6A" rel="nofollow" title="My Telegram public channel"><i class="icon icon-telegram notranslate" aria-hidden="true"></i></a></li> <li><a href="mailto:blog@yegor256.com" rel="nofollow" title="Email me any time"><i class="icon icon-mail notranslate" aria-hidden="true"></i></a></li></ul><ul class="menu"> <li><a href="/" title="Home page">Home</a></li> <li ><a href="/best.html" title="Best articles to read">12&#160;Best</a></li> <li ><a href="/contents.html" title="The contents of the entire blog">All&#160;288</a></li> <li ><a href="/webinars.html" title="My webinars">Webinars</a></li> <li ><a href="/talks.html" title="Future and past conference talks">Talks</a></li> <li ><a href="/books.html" title="The books I wrote">Books</a></li> <li ><a href="/papers.html" title="My academic papers and patents">Papers</a></li> <li ><a href="/pets.html" title="My loved pet projects">Pets</a></li> <li ><a href="/award.html" title="Software quality award">Award</a></li> <li ><a href="/testimonials.html" title="What some people say about me">Testimonials</a></li> <li ><a href="/shift-m.html" title="Audio podcast about project management">Shift-M</a></li> <li ><a href="/paintings.html" title="My paintings for sale">Paintings</a></li> <li><a href="http://ru.yegor256.com/" title="Немного на русском языке">По-русски</a></li></ul></nav><div class="search"> <form method="get" action="https://www.google.com/search" itemprop="potentialAction" itemscope="" itemtype="http://schema.org/SearchAction"> <meta itemprop="target" content="https://www.google.com/search?q={q}"/> <input name="sitesearch" value="yegor256.com" type="hidden"/> <input itemprop="query-input" type="text" id="search-query" class="field field-text" required="required" onfocus="$('.google').css('visibility', 'visible');" name="q" placeholder="Search..." autocomplete="off"/> <input type="image" src="/images/google-search-icon.svg" class="google" title="Search via Google" alt="Search via Google"/> </form></div><div class="hot"><ul> <li> <a href="/code-ahead.html">Code Ahead</a> was published on Amazon just a few days ago! It is my new book, a novel about programmers. It explains in details the majority of ideas that stand behind <a href="https://www.zerocracy.com">Zerocracy</a> and <a href="https://www.xdsd.org">XDSD</a>. </li> <li> At <a href="/webinars.html">Webinar #37</a> we will discuss naming problem in OOP, for objects, methods and attributes; join us on <b>September 12</b>, at 11am PST. </li></ul></div></header></div><section itemscope="" itemtype="http://schema.org/BlogPosting"><div class="wrapper"> <header><p class="printable"> <img src="https://api.qrserver.com/v1/create-qr-code/?data=https://www.yegor256.com/2016/01/26/defensive-programming.html&amp;format=svg" style="width:125px;height:125px;" alt="QR code"/></p><p class="printable"> <code itemprop="url">https://www.yegor256.com/2016/01/26/defensive-programming.html</code></p><h1 itemprop="name headline mainEntityOfPage">Defensive Programming via Validating Decorators</h1><aside class='book'><a href='http://amzn.to/2pyceWc'><img src='/images/books/elegant-objects/cover.png' class='book-cover' alt='book cover'/></a>Read more about this subject in <a href='http://amzn.to/2pyceWc'>Section&nbsp;5.2</a><br/> of my book<a href='http://amzn.to/2pyceWc'><img src='/images/books/amazon-buy-button.png' class='amazon-button' alt='Click to buy'/></a></aside><ul class="subline"> <li> <time itemprop="datePublished" datetime="2016-01-26T00:00:00+00:00"> 26 January 2016 </time> </li> <li class="desktop-only" itemprop="locationCreated">Palo Alto, CA</li> <li class="printable" itemscope="" itemprop="author" itemtype="http://schema.org/Person"> <span itemprop="name">Yegor Bugayenko</span> </li> <li class="unprintable"> <i class="icon icon-comments"></i> <a href="http://www.yegor256.com/2016/01/26/defensive-programming.html#disqus_thread" itemprop="discussionUrl">comments</a> </li></ul><p class="unprintable"><p>Do you check the input parameters of your methods for validity? I don&#39;t. I used to, but not anymore. I just let my methods crash with a null pointer and other exceptions when parameters are not valid. This may sound illogical, but only in the beginning. I&#39;m suggesting you use <strong>validating decorators</strong> instead.</p><figure class='jb_picture'><img itemprop='image' alt='Shi mian mai fu (2004) by Yimou Zhang' src='/images/2016/01/shi-mian-mai-fu.jpg' longdesc='#7c52eb30'/><figcaption id='7c52eb30'>Shi mian mai fu (2004) by Yimou Zhang</figcaption></figure><p>Let&#39;s take a look at this rather typical Java example:</p><figure class="highlight"><pre><code class="language-java" data-lang="java"><span></span><span class="kd">class</span> <span class="nc">Report</span> <span class="o">{</span>
  <span class="kt">void</span> <span class="nf">export</span><span class="o">(</span><span class="n">File</span> <span class="n">file</span><span class="o">)</span> <span class="o">{</span>
    <span class="k">if</span> <span class="o">(</span><span class="n">file</span> <span class="o">==</span> <span class="kc">null</span><span class="o">)</span> <span class="o">{</span>
      <span class="k">throw</span> <span class="k">new</span> <span class="n">IllegalArgumentException</span><span class="o">(</span>
        <span class="s">&quot;File is NULL; can&#39;t export.&quot;</span>
      <span class="o">);</span>
    <span class="o">}</span>
    <span class="k">if</span> <span class="o">(</span><span class="n">file</span><span class="o">.</span><span class="na">exists</span><span class="o">())</span> <span class="o">{</span>
      <span class="k">throw</span> <span class="k">new</span> <span class="n">IllegalArgumentException</span><span class="o">(</span>
        <span class="s">&quot;File already exists.&quot;</span>
      <span class="o">);</span>
    <span class="o">}</span>
    <span class="c1">// Export the report to the file</span>
  <span class="o">}</span>
<span class="o">}</span></code></pre></figure><p>Pretty <a href="https://en.wikipedia.org/wiki/Defensive_programming">defensive</a>, right? If we remove these validations, the code will be much shorter, but it will crash with rather confusing messages if <code>NULL</code> is provided by the client. Moreover, if the file already exists, our <code>Report</code> will silently overwrite it. Pretty dangerous, right?</p><p>Yes, we must protect ourselves, and we must be defensive.</p><p>But not this way, not by bloating the class with validations that have nothing to do with its core functionality. Instead, we should use decorators to do the validation. Here is how. First, there must be an interface <code>Report</code>:</p><figure class="highlight"><pre><code class="language-java" data-lang="java"><span></span><span class="kd">interface</span> <span class="nc">Report</span> <span class="o">{</span>
  <span class="kt">void</span> <span class="nf">export</span><span class="o">(</span><span class="n">File</span> <span class="n">file</span><span class="o">);</span>
<span class="o">}</span></code></pre></figure><p>Then, a class that implements the core functionality:</p><figure class="highlight"><pre><code class="language-java" data-lang="java"><span></span><span class="kd">class</span> <span class="nc">DefaultReport</span> <span class="kd">implements</span> <span class="n">Report</span> <span class="o">{</span>
  <span class="nd">@Override</span>
  <span class="kt">void</span> <span class="nf">export</span><span class="o">(</span><span class="n">File</span> <span class="n">file</span><span class="o">)</span> <span class="o">{</span>
    <span class="c1">// Export the report to the file</span>
  <span class="o">}</span>
<span class="o">}</span></code></pre></figure><p>And, finally, a number of decorators that will protect us:</p><figure class="highlight"><pre><code class="language-java" data-lang="java"><span></span><span class="kd">class</span> <span class="nc">NoWriteOverReport</span> <span class="kd">implements</span> <span class="n">Report</span> <span class="o">{</span>
  <span class="kd">private</span> <span class="kd">final</span> <span class="n">Report</span> <span class="n">origin</span><span class="o">;</span>
  <span class="n">NoWriteOverReport</span><span class="o">(</span><span class="n">Report</span> <span class="n">rep</span><span class="o">)</span> <span class="o">{</span>
    <span class="k">this</span><span class="o">.</span><span class="na">origin</span> <span class="o">=</span> <span class="n">rep</span><span class="o">;</span>
  <span class="o">}</span>
  <span class="nd">@Override</span>
  <span class="kt">void</span> <span class="nf">export</span><span class="o">(</span><span class="n">File</span> <span class="n">file</span><span class="o">)</span> <span class="o">{</span>
    <span class="k">if</span> <span class="o">(</span><span class="n">file</span><span class="o">.</span><span class="na">exists</span><span class="o">())</span> <span class="o">{</span>
      <span class="k">throw</span> <span class="k">new</span> <span class="n">IllegalArgumentException</span><span class="o">(</span>
        <span class="s">&quot;File already exists.&quot;</span>
      <span class="o">);</span>
    <span class="o">}</span>
    <span class="k">this</span><span class="o">.</span><span class="na">origin</span><span class="o">.</span><span class="na">export</span><span class="o">(</span><span class="n">file</span><span class="o">);</span>
  <span class="o">}</span>
<span class="o">}</span></code></pre></figure><p>Now, the client has the flexibility of composing a complex object from decorators that perform their specific tasks. The core object will do the reporting, while the decorators will validate parameters:</p><figure class="highlight"><pre><code class="language-java" data-lang="java"><span></span><span class="n">Report</span> <span class="n">report</span> <span class="o">=</span> <span class="k">new</span> <span class="n">NoNullReport</span><span class="o">(</span>
  <span class="k">new</span> <span class="n">NoWriteOverReport</span><span class="o">(</span>
    <span class="k">new</span> <span class="n">DefaultReport</span><span class="o">()</span>
  <span class="o">)</span>
<span class="o">);</span>
<span class="n">report</span><span class="o">.</span><span class="na">export</span><span class="o">(</span><span class="n">file</span><span class="o">);</span></code></pre></figure><p>What do we achieve with this approach? First and foremost: smaller objects. And smaller objects always mean higher <strong>maintainability</strong>. Our <code>DefaultReport</code> class will always remain small, no matter how many validations we may invent in the future. The more things we need to validate, the more validating decorators we will create. All of them will be small and cohesive. And we&#39;ll be able to put them together in different variations.</p><p>Besides that, this approach makes our code much more <strong>reusable</strong>, as classes perform very few operations and don&#39;t defend themselves by default. While being defensive is an important feature, we&#39;ll use validating decorators. But this will not always be the case. Sometimes validation is just too expensive in terms of time and memory, and we may want to work directly with objects that don&#39;t defend themselves.</p><p>I also decided not to use the Java Validation API anymore for the same reason. Its annotations make classes much more verbose and less cohesive. I&#39;m using validating decorators instead.</p></p><nav class="buttons notranslate desktop-only"> <a href="http://www.facebook.com/sharer/sharer.php?u=https://www.yegor256.com/2016/01/26/defensive-programming.html" title="Share on Facebook" class="button" rel="nofollow"> <span class="count count-facebook">0</span> <i class="icon icon-facebook notranslate" aria-hidden="true"></i> </a> <a href="https://twitter.com/share?url=https://www.yegor256.com/2016/01/26/defensive-programming.html&amp;text=Defensive+Programming+via+Validating+Decorators" title="Share on Twitter" class="button" rel="nofollow"> <span class="count count-twitter">0</span> <i class="icon icon-twitter notranslate" aria-hidden="true"></i> </a> <a href="https://plus.google.com/share?url=https://www.yegor256.com/2016/01/26/defensive-programming.html" title="Share on Google+" class="button" rel="nofollow"> <span class="count count-googleplus">0</span> <i class="icon icon-googleplus notranslate" aria-hidden="true"></i> </a> <a href="https://www.linkedin.com/cws/share?url=https://www.yegor256.com/2016/01/26/defensive-programming.html" title="Share on LinkedIn" class="button" rel="nofollow"> <span class="count count-linkedin">0</span> <i class="icon icon-linkedin notranslate" aria-hidden="true"></i> </a> <a href="http://reddit.com/submit?url=https://www.yegor256.com/2016/01/26/defensive-programming.html%3F2016-04&amp;title=Defensive+Programming+via+Validating+Decorators" title="Share on Reddit" class="button" rel="nofollow"> <span class="count count-reddit">0</span> <i class="icon icon-reddit notranslate" aria-hidden="true"></i> </a> <a href="http://news.ycombinator.com/submitlink?u=https://www.yegor256.com/2016/01/26/defensive-programming.html%3F2016-04&amp;t=Defensive+Programming+via+Validating+Decorators" title="Share on Hacker News" class="button" rel="nofollow"> <span class="count count-hackernews">0</span> <i class="icon icon-hackernews notranslate" aria-hidden="true"></i> </a> </nav> </header> <article class="main" itemprop="articleBody"><div ><p>Do you check the input parameters of your methods for validity? I don&#39;t. I used to, but not anymore. I just let my methods crash with a null pointer and other exceptions when parameters are not valid. This may sound illogical, but only in the beginning. I&#39;m suggesting you use <strong>validating decorators</strong> instead.</p><figure class='jb_picture'><img itemprop='image' alt='Shi mian mai fu (2004) by Yimou Zhang' src='/images/2016/01/shi-mian-mai-fu.jpg' longdesc='#7c52eb30'/><figcaption id='7c52eb30'>Shi mian mai fu (2004) by Yimou Zhang</figcaption></figure><p>Let&#39;s take a look at this rather typical Java example:</p><figure class="highlight"><pre><code class="language-java" data-lang="java"><span></span><span class="kd">class</span> <span class="nc">Report</span> <span class="o">{</span>
  <span class="kt">void</span> <span class="nf">export</span><span class="o">(</span><span class="n">File</span> <span class="n">file</span><span class="o">)</span> <span class="o">{</span>
    <span class="k">if</span> <span class="o">(</span><span class="n">file</span> <span class="o">==</span> <span class="kc">null</span><span class="o">)</span> <span class="o">{</span>
      <span class="k">throw</span> <span class="k">new</span> <span class="n">IllegalArgumentException</span><span class="o">(</span>
        <span class="s">&quot;File is NULL; can&#39;t export.&quot;</span>
      <span class="o">);</span>
    <span class="o">}</span>
    <span class="k">if</span> <span class="o">(</span><span class="n">file</span><span class="o">.</span><span class="na">exists</span><span class="o">())</span> <span class="o">{</span>
      <span class="k">throw</span> <span class="k">new</span> <span class="n">IllegalArgumentException</span><span class="o">(</span>
        <span class="s">&quot;File already exists.&quot;</span>
      <span class="o">);</span>
    <span class="o">}</span>
    <span class="c1">// Export the report to the file</span>
  <span class="o">}</span>
<span class="o">}</span></code></pre></figure><p>Pretty <a href="https://en.wikipedia.org/wiki/Defensive_programming">defensive</a>, right? If we remove these validations, the code will be much shorter, but it will crash with rather confusing messages if <code>NULL</code> is provided by the client. Moreover, if the file already exists, our <code>Report</code> will silently overwrite it. Pretty dangerous, right?</p><p>Yes, we must protect ourselves, and we must be defensive.</p><p>But not this way, not by bloating the class with validations that have nothing to do with its core functionality. Instead, we should use decorators to do the validation. Here is how. First, there must be an interface <code>Report</code>:</p><figure class="highlight"><pre><code class="language-java" data-lang="java"><span></span><span class="kd">interface</span> <span class="nc">Report</span> <span class="o">{</span>
  <span class="kt">void</span> <span class="nf">export</span><span class="o">(</span><span class="n">File</span> <span class="n">file</span><span class="o">);</span>
<span class="o">}</span></code></pre></figure><p>Then, a class that implements the core functionality:</p><figure class="highlight"><pre><code class="language-java" data-lang="java"><span></span><span class="kd">class</span> <span class="nc">DefaultReport</span> <span class="kd">implements</span> <span class="n">Report</span> <span class="o">{</span>
  <span class="nd">@Override</span>
  <span class="kt">void</span> <span class="nf">export</span><span class="o">(</span><span class="n">File</span> <span class="n">file</span><span class="o">)</span> <span class="o">{</span>
    <span class="c1">// Export the report to the file</span>
  <span class="o">}</span>
<span class="o">}</span></code></pre></figure><p>And, finally, a number of decorators that will protect us:</p><figure class="highlight"><pre><code class="language-java" data-lang="java"><span></span><span class="kd">class</span> <span class="nc">NoWriteOverReport</span> <span class="kd">implements</span> <span class="n">Report</span> <span class="o">{</span>
  <span class="kd">private</span> <span class="kd">final</span> <span class="n">Report</span> <span class="n">origin</span><span class="o">;</span>
  <span class="n">NoWriteOverReport</span><span class="o">(</span><span class="n">Report</span> <span class="n">rep</span><span class="o">)</span> <span class="o">{</span>
    <span class="k">this</span><span class="o">.</span><span class="na">origin</span> <span class="o">=</span> <span class="n">rep</span><span class="o">;</span>
  <span class="o">}</span>
  <span class="nd">@Override</span>
  <span class="kt">void</span> <span class="nf">export</span><span class="o">(</span><span class="n">File</span> <span class="n">file</span><span class="o">)</span> <span class="o">{</span>
    <span class="k">if</span> <span class="o">(</span><span class="n">file</span><span class="o">.</span><span class="na">exists</span><span class="o">())</span> <span class="o">{</span>
      <span class="k">throw</span> <span class="k">new</span> <span class="n">IllegalArgumentException</span><span class="o">(</span>
        <span class="s">&quot;File already exists.&quot;</span>
      <span class="o">);</span>
    <span class="o">}</span>
    <span class="k">this</span><span class="o">.</span><span class="na">origin</span><span class="o">.</span><span class="na">export</span><span class="o">(</span><span class="n">file</span><span class="o">);</span>
  <span class="o">}</span>
<span class="o">}</span></code></pre></figure><p>Now, the client has the flexibility of composing a complex object from decorators that perform their specific tasks. The core object will do the reporting, while the decorators will validate parameters:</p><figure class="highlight"><pre><code class="language-java" data-lang="java"><span></span><span class="n">Report</span> <span class="n">report</span> <span class="o">=</span> <span class="k">new</span> <span class="n">NoNullReport</span><span class="o">(</span>
  <span class="k">new</span> <span class="n">NoWriteOverReport</span><span class="o">(</span>
    <span class="k">new</span> <span class="n">DefaultReport</span><span class="o">()</span>
  <span class="o">)</span>
<span class="o">);</span>
<span class="n">report</span><span class="o">.</span><span class="na">export</span><span class="o">(</span><span class="n">file</span><span class="o">);</span></code></pre></figure><p>What do we achieve with this approach? First and foremost: smaller objects. And smaller objects always mean higher <strong>maintainability</strong>. Our <code>DefaultReport</code> class will always remain small, no matter how many validations we may invent in the future. The more things we need to validate, the more validating decorators we will create. All of them will be small and cohesive. And we&#39;ll be able to put them together in different variations.</p><p>Besides that, this approach makes our code much more <strong>reusable</strong>, as classes perform very few operations and don&#39;t defend themselves by default. While being defensive is an important feature, we&#39;ll use validating decorators. But this will not always be the case. Sometimes validation is just too expensive in terms of time and memory, and we may want to work directly with objects that don&#39;t defend themselves.</p><p>I also decided not to use the Java Validation API anymore for the same reason. Its annotations make classes much more verbose and less cohesive. I&#39;m using validating decorators instead.</p></div></article></div><div class="wrapper"> <related-posts /></div><div class="disqus" role="complementary"><p class="disqus_hint"> Please, use <a href="https://help.disqus.com/commenting/what-html-tags-are-allowed-within-comments">syntax highlighting</a> in your comments, to make them more readable.</p><div id="disqus_thread" class="disqus-thread"> <a>&nbsp;</a></div><script> var disqus_config = function () { this.page.url = document.location.href.split('?')[0].split('#')[0].replace('https://', 'http://'); this.page.identifier = this.page.url; }; (function() { var d = document, s = d.createElement('script'); s.src = '//yegor256.disqus.com/embed.js'; s.setAttribute('data-timestamp', +new Date()); (d.head || d.body).appendChild(s); })(); </script> <noscript><div><p class="red"> JavaScript is disabled in your browser, that's why you can't see comments under this post.</p></div></noscript></div><div class="wrapper"> <footer class="footer"><p> &copy; <span itemscope="" itemprop="copyrightHolder" itemtype="http://schema.org/Person"> <span itemprop="name">Yegor Bugayenko</span> </span> 2014&ndash;<span itemprop="copyrightYear">2018</span></p></footer></div></section><div class="wrapper unprintable" style="text-align:center;margin-top:2em;"> <a href="http://www.sixnines.io/h/3ba1652f"> <img src="//www.sixnines.io/b/3ba1652f?style=flat" alt="sixnines availability badge"/> </a></div><script src="//code.jquery.com/jquery-1.9.0.min.js"></script> <script src="/js/all.js?a0e0d018c07"></script> <script>var disqus_shortname = 'yegor256';</script> <script id="dsq-count-scr" src="//yegor256.disqus.com/count.js" async="async"></script> <script> (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){ (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o), m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m) })(window,document,'script','//www.google-analytics.com/analytics.js','ga'); ga('create', 'UA-1963507-32', 'auto'); ga('send', 'pageview'); </script> <script> Cd=document;Cr="&"+Math.random();Cp="&s=1"; Cd.cookie="b=b";if(Cd.cookie)Cp+="&c=1"; Cp+="&t="+(new Date()).getTimezoneOffset(); if(self!=top)Cp+="&f=1"; </script> <script> if(navigator.javaEnabled())Cp+="&j=1"; </script> <script> if(typeof(screen)!='undefined')Cp+="&w="+screen.width+"&h="+ screen.height+"&d="+(screen.colorDepth?screen.colorDepth:screen.pixelDepth); </script> <script> Cd.write("<img src='//c.hit.ua/hit?i=95870&g=0&x=2"+Cp+Cr+ "&r="+escape(Cd.referrer)+"&u="+escape(window.location.href)+ "' border='0' wi"+"dth='1' he"+"ight='1'/>"); </script> <script type="application/ld+json"> { "@context": "http://schema.org", "@type": "Person", "name": "Yegor Bugayenko", "url": "http://www.yegor256.com", "sameAs": [ "https://www.facebook.com/yegor256", "https://instagram.com/yegor256", "https://www.linkedin.com/in/yegor256", "https://twitter.com/yegor256", "https://github.com/yegor256", "https://www.pinterest.com/yegor256/" ] } </script> </body> </html> <!DOCTYPE html> <html xmlns="http://www.w3.org/1999/xhtml" lang="en-US" xml:lang="en-US" itemscope="" itemtype="http://schema.org/WebSite"> <head> <meta charset="utf-8"/> <meta name="description" content="Sequential method calls inevitably mean temporal coupling, which is a bottleneck for effective refactoring; avoid them. " /> <meta name="keywords" content="temporal coupling, temporal coupling definition, temporal coupling hidden, temporal coupling in oop, temporal coupling java" /> <meta name="viewport" content="width=device-width,minimum-scale=1,initial-scale=1"/> <meta name="google-site-verification" content="JEj_gQr2CPe2QKGw8XdMz0R7VboQIUbX3FlM-lwTq-8" /> <meta name="author" content="Yegor Bugayenko"> <meta name="article:published_time" content="2015-12-08 00:00:00 +0000"> <meta name="og:site_name" content="Yegor Bugayenko"/> <meta name="og:type" content="article" /> <meta name="og:locale" content="en_US" /> <meta name="twitter:account_id" content="4503599630178231" /> <meta name="twitter:creator" content="@yegor256"/> <meta name="twitter:site" content="@yegor256"/> <meta name="twitter:title" property="og:title" content="Temporal Coupling Between Method Calls"/> <meta name="twitter:description" property="og:description" content="Sequential method calls inevitably mean temporal coupling, which is a bottleneck for effective refactoring; avoid them. "/> <meta name="twitter:url" property="og:url" content="https://www.yegor256.com/2015/12/08/temporal-coupling-between-method-calls.html"/> <meta name="telegram:channel" content="AAAAAEJFMRzsRTRxM3ec6A"/> <link rel="search" type="application/opensearchdescription+xml" href="/opensearch.xml" title="yegor256" /> <link rel="shortcut icon" href="/favicon.ico?a0e0d018c07"/> <link rel="apple-touch-icon" href="/favicon.ico?a0e0d018c07"/> <link rel="alternate" type="application/rss+xml" title="RSS for yegor256.com" href="https://www.yegor256.com/rss.xml"/> <link rel="stylesheet" href="/css/layout.css?a0e0d018c07"/> <link rel="stylesheet" href="/css/icons.css?a0e0d018c07"/> <link rel="canonical" href="https://www.yegor256.com/2015/12/08/temporal-coupling-between-method-calls.html" /> <link rel="amphtml" href="https://www.yegor256.com/2015/12/08/temporal-coupling-between-method-calls.amp.html" /> <title>Temporal Coupling Between Method Calls </title> <meta name='og:image' content='https://www.yegor256.com/images/2015/12/blueberry.jpg'/><meta name='twitter:image' content='https://www.yegor256.com/images/2015/12/blueberry.jpg'/><meta name='og:image:width' content='1200'/> <meta name='twitter:image:width' content='1200'/><meta name='og:image:height' content='675'/> <meta name='twitter:image:height' content='675'/><meta name='twitter:card' content='summary_large_image'/><meta name='twitter:image:alt' content='Blueberry (2004) by Jan Kounen'/> </head> <body><div class="wrapper"> <aside class="header-toggle unprintable" id="header-toggle" title="Show the menu" onclick="$('#header').show();$('#header-toggle').hide();">&#9776;</aside> <header class="header" id="header"><div class="face"> <a href="/about-me.html#form" class="sub" title="Click to subscribe to my monthly newsletter"><span>Subscribe</span></a> <a href="/about-me.html" style="position:relative;"> <img src="/images/face-256x256.jpg" class="photo" alt="Yegor Bugayenko"/> </a></div><nav><ul class="menu social notranslate"> <li><a href="https://twitter.com/intent/follow?screen_name=yegor256" rel="nofollow" title="Follow me on Twitter"><i class="icon icon-twitter notranslate" aria-hidden="true"></i></a></li> <li><a href="/rss.xml" rel="nofollow" title="Subscribe to my RSS feed"><i class="icon icon-rss notranslate" aria-hidden="true"></i></a></li> <li><a itemprop="sameAs" href="https://github.com/yegor256" rel="nofollow" title="My GitHub profile"><i class="icon icon-github notranslate" aria-hidden="true"></i></a></li> <li><a itemprop="sameAs" href="http://stackoverflow.com/users/187141/yegor256" rel="nofollow" title="My StackOverflow profile"><i class="icon icon-stackoverflow notranslate" aria-hidden="true"></i></a></li> <li><a itemprop="sameAs" href="https://www.facebook.com/yegor256" rel="nofollow" title="Follow me on Facebook"><i class="icon icon-facebook notranslate" aria-hidden="true"></i></a></li> <li><a itemprop="sameAs" href="https://instagram.com/yegor256" rel="nofollow" title="Follow me on Instagram"><i class="icon icon-instagram notranslate" aria-hidden="true"></i></a></li> <li><a itemprop="sameAs" href="https://www.linkedin.com/in/yegor256" rel="nofollow" title="My LinkedIn profile"><i class="icon icon-linkedin notranslate" aria-hidden="true"></i></a></li> <li><a itemprop="sameAs" href="https://www.youtube.com/c/yegor256?sub_confirmation=1" rel="nofollow" title="My Youtube video channel"><i class="icon icon-youtube notranslate" aria-hidden="true"></i></a></li> <li><a itemprop="sameAs" href="https://www.pinterest.com/yegor256/" rel="nofollow" title="My Pinterest boards"><i class="icon icon-pinterest notranslate" aria-hidden="true"></i></a></li> <li><a itemprop="sameAs" href="https://angel.co/yegor256" rel="nofollow" title="My AngelList profile"><i class="icon icon-angellist notranslate" aria-hidden="true"></i></a></li> <li><a href="https://soundcloud.com/yegor256" rel="nofollow" title="My podcast"><i class="icon icon-podcast notranslate" aria-hidden="true"></i></a></li> <li><a href="https://itunes.apple.com/us/podcast/yegor256-podcast/id1150826721" rel="nofollow" title="My iTunes podcast"><i class="icon icon-itunes notranslate" aria-hidden="true"></i></a></li> <li><a href="https://t.me/joinchat/AAAAAEJFMRzsRTRxM3ec6A" rel="nofollow" title="My Telegram public channel"><i class="icon icon-telegram notranslate" aria-hidden="true"></i></a></li> <li><a href="mailto:blog@yegor256.com" rel="nofollow" title="Email me any time"><i class="icon icon-mail notranslate" aria-hidden="true"></i></a></li></ul><ul class="menu"> <li><a href="/" title="Home page">Home</a></li> <li ><a href="/best.html" title="Best articles to read">12&#160;Best</a></li> <li ><a href="/contents.html" title="The contents of the entire blog">All&#160;288</a></li> <li ><a href="/webinars.html" title="My webinars">Webinars</a></li> <li ><a href="/talks.html" title="Future and past conference talks">Talks</a></li> <li ><a href="/books.html" title="The books I wrote">Books</a></li> <li ><a href="/papers.html" title="My academic papers and patents">Papers</a></li> <li ><a href="/pets.html" title="My loved pet projects">Pets</a></li> <li ><a href="/award.html" title="Software quality award">Award</a></li> <li ><a href="/testimonials.html" title="What some people say about me">Testimonials</a></li> <li ><a href="/shift-m.html" title="Audio podcast about project management">Shift-M</a></li> <li ><a href="/paintings.html" title="My paintings for sale">Paintings</a></li> <li><a href="http://ru.yegor256.com/" title="Немного на русском языке">По-русски</a></li></ul></nav><div class="search"> <form method="get" action="https://www.google.com/search" itemprop="potentialAction" itemscope="" itemtype="http://schema.org/SearchAction"> <meta itemprop="target" content="https://www.google.com/search?q={q}"/> <input name="sitesearch" value="yegor256.com" type="hidden"/> <input itemprop="query-input" type="text" id="search-query" class="field field-text" required="required" onfocus="$('.google').css('visibility', 'visible');" name="q" placeholder="Search..." autocomplete="off"/> <input type="image" src="/images/google-search-icon.svg" class="google" title="Search via Google" alt="Search via Google"/> </form></div><div class="hot"><ul> <li> <a href="/code-ahead.html">Code Ahead</a> was published on Amazon just a few days ago! It is my new book, a novel about programmers. It explains in details the majority of ideas that stand behind <a href="https://www.zerocracy.com">Zerocracy</a> and <a href="https://www.xdsd.org">XDSD</a>. </li> <li> At <a href="/webinars.html">Webinar #37</a> we will discuss naming problem in OOP, for objects, methods and attributes; join us on <b>September 12</b>, at 11am PST. </li></ul></div></header></div><section itemscope="" itemtype="http://schema.org/BlogPosting"><div class="wrapper"> <header><p class="printable"> <img src="https://api.qrserver.com/v1/create-qr-code/?data=https://www.yegor256.com/2015/12/08/temporal-coupling-between-method-calls.html&amp;format=svg" style="width:125px;height:125px;" alt="QR code"/></p><p class="printable"> <code itemprop="url">https://www.yegor256.com/2015/12/08/temporal-coupling-between-method-calls.html</code></p><h1 itemprop="name headline mainEntityOfPage">Temporal Coupling Between Method Calls</h1><aside class='book'><a href='http://amzn.to/2pyceWc'><img src='/images/books/elegant-objects/cover.png' class='book-cover' alt='book cover'/></a>Read more about this subject in <a href='http://amzn.to/2pyceWc'>Section&nbsp;5.6</a><br/> of my book<a href='http://amzn.to/2pyceWc'><img src='/images/books/amazon-buy-button.png' class='amazon-button' alt='Click to buy'/></a></aside><ul class="subline"> <li> <time itemprop="datePublished" datetime="2015-12-08T00:00:00+00:00"> 8 December 2015 </time> </li> <li class="desktop-only" itemprop="locationCreated">Kiev, Ukraine</li> <li class="printable" itemscope="" itemprop="author" itemtype="http://schema.org/Person"> <span itemprop="name">Yegor Bugayenko</span> </li> <li class="unprintable"> <i class="icon icon-comments"></i> <a href="http://www.yegor256.com/2015/12/08/temporal-coupling-between-method-calls.html#disqus_thread" itemprop="discussionUrl">comments</a> </li></ul><p class="unprintable"><p>Temporal coupling happens between sequential method calls when they must stay in a particular order. This is inevitable in imperative programming, but we can reduce the negative effect of it just by turning those static procedures into functions. Take a look at this example.</p><figure class='jb_picture'><img itemprop='image' alt='Blueberry (2004) by Jan Kounen' src='/images/2015/12/blueberry.jpg' longdesc='#17ff3e16'/><figcaption id='17ff3e16'>Blueberry (2004) by Jan Kounen</figcaption></figure><p>Here is the code:</p><figure class="highlight"><pre><code class="language-java" data-lang="java"><span></span><span class="kd">class</span> <span class="nc">Foo</span> <span class="o">{</span>
  <span class="kd">public</span> <span class="n">List</span><span class="o">&lt;</span><span class="n">String</span><span class="o">&gt;</span> <span class="nf">names</span><span class="o">()</span> <span class="o">{</span>
    <span class="n">List</span><span class="o">&lt;</span><span class="n">String</span><span class="o">&gt;</span> <span class="n">list</span> <span class="o">=</span> <span class="k">new</span> <span class="n">LinkedList</span><span class="o">();</span>
    <span class="n">Foo</span><span class="o">.</span><span class="na">append</span><span class="o">(</span><span class="n">list</span><span class="o">,</span> <span class="s">&quot;Jeff&quot;</span><span class="o">);</span>
    <span class="n">Foo</span><span class="o">.</span><span class="na">append</span><span class="o">(</span><span class="n">list</span><span class="o">,</span> <span class="s">&quot;Walter&quot;</span><span class="o">);</span>
    <span class="k">return</span> <span class="n">list</span><span class="o">;</span>
  <span class="o">}</span>
  <span class="kd">private</span> <span class="kd">static</span> <span class="kt">void</span> <span class="nf">append</span><span class="o">(</span>
    <span class="n">List</span><span class="o">&lt;</span><span class="n">String</span><span class="o">&gt;</span> <span class="n">list</span><span class="o">,</span> <span class="n">String</span> <span class="n">item</span><span class="o">)</span> <span class="o">{</span>
    <span class="n">list</span><span class="o">.</span><span class="na">add</span><span class="o">(</span><span class="n">item</span><span class="o">.</span><span class="na">toLowerCase</span><span class="o">());</span>
  <span class="o">}</span>
<span class="o">}</span></code></pre></figure><p>What do you think about that? I believe it&#39;s clear what <code>names()</code> is doing---creating a list of names. In order to avoid duplication, there is a supplementary <em>procedure</em>, <code>append()</code>, which converts an item to lowercase and adds it to the list.</p><p>This is poor design.</p><p>It is a <strong>procedural</strong> design, and there is <strong>temporal coupling</strong> between lines in method <code>names()</code>.</p><p>Let me first show you a better (though not the best!) design, then I will try to explain its benefits:</p><figure class="highlight"><pre><code class="language-java" data-lang="java"><span></span><span class="kd">class</span> <span class="nc">Foo</span> <span class="o">{</span>
  <span class="kd">public</span> <span class="n">List</span><span class="o">&lt;</span><span class="n">String</span><span class="o">&gt;</span> <span class="nf">names</span><span class="o">()</span> <span class="o">{</span>
    <span class="k">return</span> <span class="n">Foo</span><span class="o">.</span><span class="na">with</span><span class="o">(</span>
      <span class="n">Foo</span><span class="o">.</span><span class="na">with</span><span class="o">(</span>
        <span class="k">new</span> <span class="n">LinkedList</span><span class="o">(),</span>
        <span class="s">&quot;Jeff&quot;</span>
      <span class="o">),</span>
      <span class="s">&quot;Walter&quot;</span>
    <span class="o">);</span>
  <span class="o">}</span>
  <span class="kd">private</span> <span class="kd">static</span> <span class="n">List</span><span class="o">&lt;</span><span class="n">String</span><span class="o">&gt;</span> <span class="nf">with</span><span class="o">(</span>
    <span class="n">List</span><span class="o">&lt;</span><span class="n">String</span><span class="o">&gt;</span> <span class="n">list</span><span class="o">,</span> <span class="n">String</span> <span class="n">item</span><span class="o">)</span> <span class="o">{</span>
    <span class="n">list</span><span class="o">.</span><span class="na">add</span><span class="o">(</span><span class="n">item</span><span class="o">.</span><span class="na">toLowerCase</span><span class="o">());</span>
    <span class="k">return</span> <span class="n">list</span><span class="o">;</span>
  <span class="o">}</span>
<span class="o">}</span></code></pre></figure><p>An ideal design for method <code>with()</code> would create a new instance of <code>List</code>, populate it through <code>addAll(list)</code>, then <code>add(item)</code> to it, and finally return. That would be perfectly <a href="http://www.yegor256.com/2014/06/09/objects-should-be-immutable.html">immutable</a>, but slow.</p><p>So, what is wrong with this:</p><figure class="highlight"><pre><code class="language-java" data-lang="java"><span></span><span class="n">List</span><span class="o">&lt;</span><span class="n">String</span><span class="o">&gt;</span> <span class="n">list</span> <span class="o">=</span> <span class="k">new</span> <span class="n">LinkedList</span><span class="o">();</span>
<span class="n">Foo</span><span class="o">.</span><span class="na">append</span><span class="o">(</span><span class="n">list</span><span class="o">,</span> <span class="s">&quot;Jeff&quot;</span><span class="o">);</span>
<span class="n">Foo</span><span class="o">.</span><span class="na">append</span><span class="o">(</span><span class="n">list</span><span class="o">,</span> <span class="s">&quot;Walter&quot;</span><span class="o">);</span>
<span class="k">return</span> <span class="n">list</span><span class="o">;</span></code></pre></figure><p>It looks perfectly clean, doesn&#39;t it? Instantiate a list, append two items to it, and return it. Yes, it is clean---for now. Because we remember what <code>append()</code> is doing. In a few months, we&#39;ll get back to this code, and it will look like this:</p><figure class="highlight"><pre><code class="language-java" data-lang="java"><span></span><span class="n">List</span><span class="o">&lt;</span><span class="n">String</span><span class="o">&gt;</span> <span class="n">list</span> <span class="o">=</span> <span class="k">new</span> <span class="n">LinkedList</span><span class="o">();</span>
<span class="c1">// 10 more lines here</span>
<span class="n">Foo</span><span class="o">.</span><span class="na">append</span><span class="o">(</span><span class="n">list</span><span class="o">,</span> <span class="s">&quot;Jeff&quot;</span><span class="o">);</span>
<span class="n">Foo</span><span class="o">.</span><span class="na">append</span><span class="o">(</span><span class="n">list</span><span class="o">,</span> <span class="s">&quot;Walter&quot;</span><span class="o">);</span>
<span class="c1">// 10 more lines here</span>
<span class="k">return</span> <span class="n">list</span><span class="o">;</span></code></pre></figure><p>Is it so clear now that <code>append()</code> is actually adding <code>&quot;Jeff&quot;</code> to <code>list</code>? What will happen if I remove that line? Will it affect the result being returned in the last line? I don&#39;t know. I need to <strong>check</strong> the body of method <code>append()</code> to make sure.</p><p>Also, how about returning <code>list</code> first and calling <code>append()</code> afterwards? This is what possible &quot;refactoring&quot; may do to our code:</p><figure class="highlight"><pre><code class="language-java" data-lang="java"><span></span><span class="n">List</span><span class="o">&lt;</span><span class="n">String</span><span class="o">&gt;</span> <span class="n">list</span> <span class="o">=</span> <span class="k">new</span> <span class="n">LinkedList</span><span class="o">();</span>
<span class="k">if</span> <span class="o">(</span><span class="cm">/* something */</span><span class="o">)</span> <span class="o">{</span>
  <span class="k">return</span> <span class="n">list</span><span class="o">;</span>
<span class="o">}</span>
<span class="c1">// 10 more lines here</span>
<span class="n">Foo</span><span class="o">.</span><span class="na">append</span><span class="o">(</span><span class="n">list</span><span class="o">,</span> <span class="s">&quot;Walter&quot;</span><span class="o">);</span>
<span class="n">Foo</span><span class="o">.</span><span class="na">append</span><span class="o">(</span><span class="n">list</span><span class="o">,</span> <span class="s">&quot;Jeff&quot;</span><span class="o">);</span>
<span class="c1">// 10 more lines here</span>
<span class="k">return</span> <span class="n">list</span><span class="o">;</span></code></pre></figure><p>First of all, we return <code>list</code> too early, when it is not ready. But did anyone tell me that these two calls to <code>append()</code> must happen before <code>return list</code>? Second, we changed the order of <code>append()</code> calls. Again, did anyone tell me that it&#39;s important to call them in that particular order?</p><p>Nobody. Nowhere. This is called <strong>temporal coupling</strong>.</p><p>Our lines are <strong>coupled</strong> together. They must stay in this particular order, but the knowledge about that order is hidden. It&#39;s easy to destroy the order, and our compiler won&#39;t be able to catch us.</p><p>To the contrary, this design doesn&#39;t have any &quot;order&quot;:</p><figure class="highlight"><pre><code class="language-java" data-lang="java"><span></span><span class="k">return</span> <span class="n">Foo</span><span class="o">.</span><span class="na">with</span><span class="o">(</span>
  <span class="n">Foo</span><span class="o">.</span><span class="na">with</span><span class="o">(</span>
    <span class="k">new</span> <span class="n">LinkedList</span><span class="o">(),</span>
    <span class="s">&quot;Jeff&quot;</span>
  <span class="o">),</span>
  <span class="s">&quot;Walter&quot;</span>
<span class="o">);</span></code></pre></figure><p>It just <strong>returns</strong> a list, which is constructed by a few calls to the <code>with()</code> method. It is a single line instead of four.</p><p>As <a href="/2015/08/18/multiple-return-statements-in-oop.html">discussed before</a>, an ideal method in OOP must have just a single statement, and this statement is <code>return</code>.</p><p>The same is true about validation. For example, this code is bad:</p><figure class="highlight"><pre><code class="language-java" data-lang="java"><span></span><span class="n">list</span><span class="o">.</span><span class="na">add</span><span class="o">(</span><span class="s">&quot;Jeff&quot;</span><span class="o">);</span>
<span class="n">Foo</span><span class="o">.</span><span class="na">checkIfListStillHasSpace</span><span class="o">(</span><span class="n">list</span><span class="o">);</span>
<span class="n">list</span><span class="o">.</span><span class="na">add</span><span class="o">(</span><span class="s">&quot;Walter&quot;</span><span class="o">);</span></code></pre></figure><p>While this one is much better:</p><figure class="highlight"><pre><code class="language-java" data-lang="java"><span></span><span class="n">list</span><span class="o">.</span><span class="na">add</span><span class="o">(</span><span class="s">&quot;Jeff&quot;</span><span class="o">);</span>
<span class="n">Foo</span><span class="o">.</span><span class="na">withEnoughSpace</span><span class="o">(</span><span class="n">list</span><span class="o">).</span><span class="na">add</span><span class="o">(</span><span class="s">&quot;Walter&quot;</span><span class="o">);</span></code></pre></figure><p>See the difference?</p><p>And, of course, an ideal approach would be to use <a href="/2015/02/26/composable-decorators.html">composable decorators</a> instead of these ugly static methods. But if it&#39;s not possible for some reason, just don&#39;t make those static methods look like procedures. Make sure they always return results, which become arguments to further calls.</p></p><nav class="buttons notranslate desktop-only"> <a href="http://www.facebook.com/sharer/sharer.php?u=https://www.yegor256.com/2015/12/08/temporal-coupling-between-method-calls.html" title="Share on Facebook" class="button" rel="nofollow"> <span class="count count-facebook">0</span> <i class="icon icon-facebook notranslate" aria-hidden="true"></i> </a> <a href="https://twitter.com/share?url=https://www.yegor256.com/2015/12/08/temporal-coupling-between-method-calls.html&amp;text=Temporal+Coupling+Between+Method+Calls" title="Share on Twitter" class="button" rel="nofollow"> <span class="count count-twitter">0</span> <i class="icon icon-twitter notranslate" aria-hidden="true"></i> </a> <a href="https://plus.google.com/share?url=https://www.yegor256.com/2015/12/08/temporal-coupling-between-method-calls.html" title="Share on Google+" class="button" rel="nofollow"> <span class="count count-googleplus">0</span> <i class="icon icon-googleplus notranslate" aria-hidden="true"></i> </a> <a href="https://www.linkedin.com/cws/share?url=https://www.yegor256.com/2015/12/08/temporal-coupling-between-method-calls.html" title="Share on LinkedIn" class="button" rel="nofollow"> <span class="count count-linkedin">0</span> <i class="icon icon-linkedin notranslate" aria-hidden="true"></i> </a> <a href="http://reddit.com/submit?url=https://www.yegor256.com/2015/12/08/temporal-coupling-between-method-calls.html%3F2015-49&amp;title=Temporal+Coupling+Between+Method+Calls" title="Share on Reddit" class="button" rel="nofollow"> <span class="count count-reddit">0</span> <i class="icon icon-reddit notranslate" aria-hidden="true"></i> </a> <a href="http://news.ycombinator.com/submitlink?u=https://www.yegor256.com/2015/12/08/temporal-coupling-between-method-calls.html%3F2015-49&amp;t=Temporal+Coupling+Between+Method+Calls" title="Share on Hacker News" class="button" rel="nofollow"> <span class="count count-hackernews">0</span> <i class="icon icon-hackernews notranslate" aria-hidden="true"></i> </a> </nav> </header> <article class="main" itemprop="articleBody"><div ><p>Temporal coupling happens between sequential method calls when they must stay in a particular order. This is inevitable in imperative programming, but we can reduce the negative effect of it just by turning those static procedures into functions. Take a look at this example.</p><figure class='jb_picture'><img itemprop='image' alt='Blueberry (2004) by Jan Kounen' src='/images/2015/12/blueberry.jpg' longdesc='#17ff3e16'/><figcaption id='17ff3e16'>Blueberry (2004) by Jan Kounen</figcaption></figure><p>Here is the code:</p><figure class="highlight"><pre><code class="language-java" data-lang="java"><span></span><span class="kd">class</span> <span class="nc">Foo</span> <span class="o">{</span>
  <span class="kd">public</span> <span class="n">List</span><span class="o">&lt;</span><span class="n">String</span><span class="o">&gt;</span> <span class="nf">names</span><span class="o">()</span> <span class="o">{</span>
    <span class="n">List</span><span class="o">&lt;</span><span class="n">String</span><span class="o">&gt;</span> <span class="n">list</span> <span class="o">=</span> <span class="k">new</span> <span class="n">LinkedList</span><span class="o">();</span>
    <span class="n">Foo</span><span class="o">.</span><span class="na">append</span><span class="o">(</span><span class="n">list</span><span class="o">,</span> <span class="s">&quot;Jeff&quot;</span><span class="o">);</span>
    <span class="n">Foo</span><span class="o">.</span><span class="na">append</span><span class="o">(</span><span class="n">list</span><span class="o">,</span> <span class="s">&quot;Walter&quot;</span><span class="o">);</span>
    <span class="k">return</span> <span class="n">list</span><span class="o">;</span>
  <span class="o">}</span>
  <span class="kd">private</span> <span class="kd">static</span> <span class="kt">void</span> <span class="nf">append</span><span class="o">(</span>
    <span class="n">List</span><span class="o">&lt;</span><span class="n">String</span><span class="o">&gt;</span> <span class="n">list</span><span class="o">,</span> <span class="n">String</span> <span class="n">item</span><span class="o">)</span> <span class="o">{</span>
    <span class="n">list</span><span class="o">.</span><span class="na">add</span><span class="o">(</span><span class="n">item</span><span class="o">.</span><span class="na">toLowerCase</span><span class="o">());</span>
  <span class="o">}</span>
<span class="o">}</span></code></pre></figure><p>What do you think about that? I believe it&#39;s clear what <code>names()</code> is doing---creating a list of names. In order to avoid duplication, there is a supplementary <em>procedure</em>, <code>append()</code>, which converts an item to lowercase and adds it to the list.</p><p>This is poor design.</p><p>It is a <strong>procedural</strong> design, and there is <strong>temporal coupling</strong> between lines in method <code>names()</code>.</p><p>Let me first show you a better (though not the best!) design, then I will try to explain its benefits:</p><figure class="highlight"><pre><code class="language-java" data-lang="java"><span></span><span class="kd">class</span> <span class="nc">Foo</span> <span class="o">{</span>
  <span class="kd">public</span> <span class="n">List</span><span class="o">&lt;</span><span class="n">String</span><span class="o">&gt;</span> <span class="nf">names</span><span class="o">()</span> <span class="o">{</span>
    <span class="k">return</span> <span class="n">Foo</span><span class="o">.</span><span class="na">with</span><span class="o">(</span>
      <span class="n">Foo</span><span class="o">.</span><span class="na">with</span><span class="o">(</span>
        <span class="k">new</span> <span class="n">LinkedList</span><span class="o">(),</span>
        <span class="s">&quot;Jeff&quot;</span>
      <span class="o">),</span>
      <span class="s">&quot;Walter&quot;</span>
    <span class="o">);</span>
  <span class="o">}</span>
  <span class="kd">private</span> <span class="kd">static</span> <span class="n">List</span><span class="o">&lt;</span><span class="n">String</span><span class="o">&gt;</span> <span class="nf">with</span><span class="o">(</span>
    <span class="n">List</span><span class="o">&lt;</span><span class="n">String</span><span class="o">&gt;</span> <span class="n">list</span><span class="o">,</span> <span class="n">String</span> <span class="n">item</span><span class="o">)</span> <span class="o">{</span>
    <span class="n">list</span><span class="o">.</span><span class="na">add</span><span class="o">(</span><span class="n">item</span><span class="o">.</span><span class="na">toLowerCase</span><span class="o">());</span>
    <span class="k">return</span> <span class="n">list</span><span class="o">;</span>
  <span class="o">}</span>
<span class="o">}</span></code></pre></figure><p>An ideal design for method <code>with()</code> would create a new instance of <code>List</code>, populate it through <code>addAll(list)</code>, then <code>add(item)</code> to it, and finally return. That would be perfectly <a href="http://www.yegor256.com/2014/06/09/objects-should-be-immutable.html">immutable</a>, but slow.</p><p>So, what is wrong with this:</p><figure class="highlight"><pre><code class="language-java" data-lang="java"><span></span><span class="n">List</span><span class="o">&lt;</span><span class="n">String</span><span class="o">&gt;</span> <span class="n">list</span> <span class="o">=</span> <span class="k">new</span> <span class="n">LinkedList</span><span class="o">();</span>
<span class="n">Foo</span><span class="o">.</span><span class="na">append</span><span class="o">(</span><span class="n">list</span><span class="o">,</span> <span class="s">&quot;Jeff&quot;</span><span class="o">);</span>
<span class="n">Foo</span><span class="o">.</span><span class="na">append</span><span class="o">(</span><span class="n">list</span><span class="o">,</span> <span class="s">&quot;Walter&quot;</span><span class="o">);</span>
<span class="k">return</span> <span class="n">list</span><span class="o">;</span></code></pre></figure><p>It looks perfectly clean, doesn&#39;t it? Instantiate a list, append two items to it, and return it. Yes, it is clean---for now. Because we remember what <code>append()</code> is doing. In a few months, we&#39;ll get back to this code, and it will look like this:</p><figure class="highlight"><pre><code class="language-java" data-lang="java"><span></span><span class="n">List</span><span class="o">&lt;</span><span class="n">String</span><span class="o">&gt;</span> <span class="n">list</span> <span class="o">=</span> <span class="k">new</span> <span class="n">LinkedList</span><span class="o">();</span>
<span class="c1">// 10 more lines here</span>
<span class="n">Foo</span><span class="o">.</span><span class="na">append</span><span class="o">(</span><span class="n">list</span><span class="o">,</span> <span class="s">&quot;Jeff&quot;</span><span class="o">);</span>
<span class="n">Foo</span><span class="o">.</span><span class="na">append</span><span class="o">(</span><span class="n">list</span><span class="o">,</span> <span class="s">&quot;Walter&quot;</span><span class="o">);</span>
<span class="c1">// 10 more lines here</span>
<span class="k">return</span> <span class="n">list</span><span class="o">;</span></code></pre></figure><p>Is it so clear now that <code>append()</code> is actually adding <code>&quot;Jeff&quot;</code> to <code>list</code>? What will happen if I remove that line? Will it affect the result being returned in the last line? I don&#39;t know. I need to <strong>check</strong> the body of method <code>append()</code> to make sure.</p><p>Also, how about returning <code>list</code> first and calling <code>append()</code> afterwards? This is what possible &quot;refactoring&quot; may do to our code:</p><figure class="highlight"><pre><code class="language-java" data-lang="java"><span></span><span class="n">List</span><span class="o">&lt;</span><span class="n">String</span><span class="o">&gt;</span> <span class="n">list</span> <span class="o">=</span> <span class="k">new</span> <span class="n">LinkedList</span><span class="o">();</span>
<span class="k">if</span> <span class="o">(</span><span class="cm">/* something */</span><span class="o">)</span> <span class="o">{</span>
  <span class="k">return</span> <span class="n">list</span><span class="o">;</span>
<span class="o">}</span>
<span class="c1">// 10 more lines here</span>
<span class="n">Foo</span><span class="o">.</span><span class="na">append</span><span class="o">(</span><span class="n">list</span><span class="o">,</span> <span class="s">&quot;Walter&quot;</span><span class="o">);</span>
<span class="n">Foo</span><span class="o">.</span><span class="na">append</span><span class="o">(</span><span class="n">list</span><span class="o">,</span> <span class="s">&quot;Jeff&quot;</span><span class="o">);</span>
<span class="c1">// 10 more lines here</span>
<span class="k">return</span> <span class="n">list</span><span class="o">;</span></code></pre></figure><p>First of all, we return <code>list</code> too early, when it is not ready. But did anyone tell me that these two calls to <code>append()</code> must happen before <code>return list</code>? Second, we changed the order of <code>append()</code> calls. Again, did anyone tell me that it&#39;s important to call them in that particular order?</p><p>Nobody. Nowhere. This is called <strong>temporal coupling</strong>.</p><p>Our lines are <strong>coupled</strong> together. They must stay in this particular order, but the knowledge about that order is hidden. It&#39;s easy to destroy the order, and our compiler won&#39;t be able to catch us.</p><p>To the contrary, this design doesn&#39;t have any &quot;order&quot;:</p><figure class="highlight"><pre><code class="language-java" data-lang="java"><span></span><span class="k">return</span> <span class="n">Foo</span><span class="o">.</span><span class="na">with</span><span class="o">(</span>
  <span class="n">Foo</span><span class="o">.</span><span class="na">with</span><span class="o">(</span>
    <span class="k">new</span> <span class="n">LinkedList</span><span class="o">(),</span>
    <span class="s">&quot;Jeff&quot;</span>
  <span class="o">),</span>
  <span class="s">&quot;Walter&quot;</span>
<span class="o">);</span></code></pre></figure><p>It just <strong>returns</strong> a list, which is constructed by a few calls to the <code>with()</code> method. It is a single line instead of four.</p><p>As <a href="/2015/08/18/multiple-return-statements-in-oop.html">discussed before</a>, an ideal method in OOP must have just a single statement, and this statement is <code>return</code>.</p><p>The same is true about validation. For example, this code is bad:</p><figure class="highlight"><pre><code class="language-java" data-lang="java"><span></span><span class="n">list</span><span class="o">.</span><span class="na">add</span><span class="o">(</span><span class="s">&quot;Jeff&quot;</span><span class="o">);</span>
<span class="n">Foo</span><span class="o">.</span><span class="na">checkIfListStillHasSpace</span><span class="o">(</span><span class="n">list</span><span class="o">);</span>
<span class="n">list</span><span class="o">.</span><span class="na">add</span><span class="o">(</span><span class="s">&quot;Walter&quot;</span><span class="o">);</span></code></pre></figure><p>While this one is much better:</p><figure class="highlight"><pre><code class="language-java" data-lang="java"><span></span><span class="n">list</span><span class="o">.</span><span class="na">add</span><span class="o">(</span><span class="s">&quot;Jeff&quot;</span><span class="o">);</span>
<span class="n">Foo</span><span class="o">.</span><span class="na">withEnoughSpace</span><span class="o">(</span><span class="n">list</span><span class="o">).</span><span class="na">add</span><span class="o">(</span><span class="s">&quot;Walter&quot;</span><span class="o">);</span></code></pre></figure><p>See the difference?</p><p>And, of course, an ideal approach would be to use <a href="/2015/02/26/composable-decorators.html">composable decorators</a> instead of these ugly static methods. But if it&#39;s not possible for some reason, just don&#39;t make those static methods look like procedures. Make sure they always return results, which become arguments to further calls.</p></div></article></div><div class="wrapper"> <related-posts /></div><div class="disqus" role="complementary"><p class="disqus_hint"> Please, use <a href="https://help.disqus.com/commenting/what-html-tags-are-allowed-within-comments">syntax highlighting</a> in your comments, to make them more readable.</p><div id="disqus_thread" class="disqus-thread"> <a>&nbsp;</a></div><script> var disqus_config = function () { this.page.url = document.location.href.split('?')[0].split('#')[0].replace('https://', 'http://'); this.page.identifier = this.page.url; }; (function() { var d = document, s = d.createElement('script'); s.src = '//yegor256.disqus.com/embed.js'; s.setAttribute('data-timestamp', +new Date()); (d.head || d.body).appendChild(s); })(); </script> <noscript><div><p class="red"> JavaScript is disabled in your browser, that's why you can't see comments under this post.</p></div></noscript></div><div class="wrapper"> <footer class="footer"><p> &copy; <span itemscope="" itemprop="copyrightHolder" itemtype="http://schema.org/Person"> <span itemprop="name">Yegor Bugayenko</span> </span> 2014&ndash;<span itemprop="copyrightYear">2018</span></p></footer></div></section><div class="wrapper unprintable" style="text-align:center;margin-top:2em;"> <a href="http://www.sixnines.io/h/3ba1652f"> <img src="//www.sixnines.io/b/3ba1652f?style=flat" alt="sixnines availability badge"/> </a></div><script src="//code.jquery.com/jquery-1.9.0.min.js"></script> <script src="/js/all.js?a0e0d018c07"></script> <script>var disqus_shortname = 'yegor256';</script> <script id="dsq-count-scr" src="//yegor256.disqus.com/count.js" async="async"></script> <script> (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){ (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o), m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m) })(window,document,'script','//www.google-analytics.com/analytics.js','ga'); ga('create', 'UA-1963507-32', 'auto'); ga('send', 'pageview'); </script> <script> Cd=document;Cr="&"+Math.random();Cp="&s=1"; Cd.cookie="b=b";if(Cd.cookie)Cp+="&c=1"; Cp+="&t="+(new Date()).getTimezoneOffset(); if(self!=top)Cp+="&f=1"; </script> <script> if(navigator.javaEnabled())Cp+="&j=1"; </script> <script> if(typeof(screen)!='undefined')Cp+="&w="+screen.width+"&h="+ screen.height+"&d="+(screen.colorDepth?screen.colorDepth:screen.pixelDepth); </script> <script> Cd.write("<img src='//c.hit.ua/hit?i=95870&g=0&x=2"+Cp+Cr+ "&r="+escape(Cd.referrer)+"&u="+escape(window.location.href)+ "' border='0' wi"+"dth='1' he"+"ight='1'/>"); </script> <script type="application/ld+json"> { "@context": "http://schema.org", "@type": "Person", "name": "Yegor Bugayenko", "url": "http://www.yegor256.com", "sameAs": [ "https://www.facebook.com/yegor256", "https://instagram.com/yegor256", "https://www.linkedin.com/in/yegor256", "https://twitter.com/yegor256", "https://github.com/yegor256", "https://www.pinterest.com/yegor256/" ] } </script> </body> </html> <!DOCTYPE html> <html xmlns="http://www.w3.org/1999/xhtml" lang="en-US" xml:lang="en-US" itemscope="" itemtype="http://schema.org/WebSite"> <head> <meta charset="utf-8"/> <meta name="description" content="Decorators are used to extend object functionality without changing their interfaces, and there are two approaches: horizontal and vertical. " /> <meta name="keywords" content="composable decorators, decorator java, decorator pattern, decorator pattern java, encapsulation" /> <meta name="viewport" content="width=device-width,minimum-scale=1,initial-scale=1"/> <meta name="google-site-verification" content="JEj_gQr2CPe2QKGw8XdMz0R7VboQIUbX3FlM-lwTq-8" /> <meta name="author" content="Yegor Bugayenko"> <meta name="article:published_time" content="2015-10-01 00:00:00 +0000"> <meta name="og:site_name" content="Yegor Bugayenko"/> <meta name="og:type" content="article" /> <meta name="og:locale" content="en_US" /> <meta name="twitter:account_id" content="4503599630178231" /> <meta name="twitter:creator" content="@yegor256"/> <meta name="twitter:site" content="@yegor256"/> <meta name="twitter:title" property="og:title" content="Vertical and Horizontal Decorating"/> <meta name="twitter:description" property="og:description" content="Decorators are used to extend object functionality without changing their interfaces, and there are two approaches: horizontal and vertical. "/> <meta name="twitter:url" property="og:url" content="https://www.yegor256.com/2015/10/01/vertical-horizontal-decorating.html"/> <meta name="telegram:channel" content="AAAAAEJFMRzsRTRxM3ec6A"/> <link rel="search" type="application/opensearchdescription+xml" href="/opensearch.xml" title="yegor256" /> <link rel="shortcut icon" href="/favicon.ico?a0e0d018c07"/> <link rel="apple-touch-icon" href="/favicon.ico?a0e0d018c07"/> <link rel="alternate" type="application/rss+xml" title="RSS for yegor256.com" href="https://www.yegor256.com/rss.xml"/> <link rel="stylesheet" href="/css/layout.css?a0e0d018c07"/> <link rel="stylesheet" href="/css/icons.css?a0e0d018c07"/> <link rel="canonical" href="https://www.yegor256.com/2015/10/01/vertical-horizontal-decorating.html" /> <link rel="amphtml" href="https://www.yegor256.com/2015/10/01/vertical-horizontal-decorating.amp.html" /> <title>Vertical and Horizontal Decorating </title> <meta name='og:image' content='https://www.yegor256.com/images/2015/10/the-apartment.jpg'/><meta name='twitter:image' content='https://www.yegor256.com/images/2015/10/the-apartment.jpg'/><meta name='og:image:width' content='1107'/> <meta name='twitter:image:width' content='1107'/><meta name='og:image:height' content='727'/> <meta name='twitter:image:height' content='727'/><meta name='twitter:card' content='summary_large_image'/><meta name='twitter:image:alt' content='The Apartment (1960) by Billy Wilder'/> </head> <body><div class="wrapper"> <aside class="header-toggle unprintable" id="header-toggle" title="Show the menu" onclick="$('#header').show();$('#header-toggle').hide();">&#9776;</aside> <header class="header" id="header"><div class="face"> <a href="/about-me.html#form" class="sub" title="Click to subscribe to my monthly newsletter"><span>Subscribe</span></a> <a href="/about-me.html" style="position:relative;"> <img src="/images/face-256x256.jpg" class="photo" alt="Yegor Bugayenko"/> </a></div><nav><ul class="menu social notranslate"> <li><a href="https://twitter.com/intent/follow?screen_name=yegor256" rel="nofollow" title="Follow me on Twitter"><i class="icon icon-twitter notranslate" aria-hidden="true"></i></a></li> <li><a href="/rss.xml" rel="nofollow" title="Subscribe to my RSS feed"><i class="icon icon-rss notranslate" aria-hidden="true"></i></a></li> <li><a itemprop="sameAs" href="https://github.com/yegor256" rel="nofollow" title="My GitHub profile"><i class="icon icon-github notranslate" aria-hidden="true"></i></a></li> <li><a itemprop="sameAs" href="http://stackoverflow.com/users/187141/yegor256" rel="nofollow" title="My StackOverflow profile"><i class="icon icon-stackoverflow notranslate" aria-hidden="true"></i></a></li> <li><a itemprop="sameAs" href="https://www.facebook.com/yegor256" rel="nofollow" title="Follow me on Facebook"><i class="icon icon-facebook notranslate" aria-hidden="true"></i></a></li> <li><a itemprop="sameAs" href="https://instagram.com/yegor256" rel="nofollow" title="Follow me on Instagram"><i class="icon icon-instagram notranslate" aria-hidden="true"></i></a></li> <li><a itemprop="sameAs" href="https://www.linkedin.com/in/yegor256" rel="nofollow" title="My LinkedIn profile"><i class="icon icon-linkedin notranslate" aria-hidden="true"></i></a></li> <li><a itemprop="sameAs" href="https://www.youtube.com/c/yegor256?sub_confirmation=1" rel="nofollow" title="My Youtube video channel"><i class="icon icon-youtube notranslate" aria-hidden="true"></i></a></li> <li><a itemprop="sameAs" href="https://www.pinterest.com/yegor256/" rel="nofollow" title="My Pinterest boards"><i class="icon icon-pinterest notranslate" aria-hidden="true"></i></a></li> <li><a itemprop="sameAs" href="https://angel.co/yegor256" rel="nofollow" title="My AngelList profile"><i class="icon icon-angellist notranslate" aria-hidden="true"></i></a></li> <li><a href="https://soundcloud.com/yegor256" rel="nofollow" title="My podcast"><i class="icon icon-podcast notranslate" aria-hidden="true"></i></a></li> <li><a href="https://itunes.apple.com/us/podcast/yegor256-podcast/id1150826721" rel="nofollow" title="My iTunes podcast"><i class="icon icon-itunes notranslate" aria-hidden="true"></i></a></li> <li><a href="https://t.me/joinchat/AAAAAEJFMRzsRTRxM3ec6A" rel="nofollow" title="My Telegram public channel"><i class="icon icon-telegram notranslate" aria-hidden="true"></i></a></li> <li><a href="mailto:blog@yegor256.com" rel="nofollow" title="Email me any time"><i class="icon icon-mail notranslate" aria-hidden="true"></i></a></li></ul><ul class="menu"> <li><a href="/" title="Home page">Home</a></li> <li ><a href="/best.html" title="Best articles to read">12&#160;Best</a></li> <li ><a href="/contents.html" title="The contents of the entire blog">All&#160;288</a></li> <li ><a href="/webinars.html" title="My webinars">Webinars</a></li> <li ><a href="/talks.html" title="Future and past conference talks">Talks</a></li> <li ><a href="/books.html" title="The books I wrote">Books</a></li> <li ><a href="/papers.html" title="My academic papers and patents">Papers</a></li> <li ><a href="/pets.html" title="My loved pet projects">Pets</a></li> <li ><a href="/award.html" title="Software quality award">Award</a></li> <li ><a href="/testimonials.html" title="What some people say about me">Testimonials</a></li> <li ><a href="/shift-m.html" title="Audio podcast about project management">Shift-M</a></li> <li ><a href="/paintings.html" title="My paintings for sale">Paintings</a></li> <li><a href="http://ru.yegor256.com/" title="Немного на русском языке">По-русски</a></li></ul></nav><div class="search"> <form method="get" action="https://www.google.com/search" itemprop="potentialAction" itemscope="" itemtype="http://schema.org/SearchAction"> <meta itemprop="target" content="https://www.google.com/search?q={q}"/> <input name="sitesearch" value="yegor256.com" type="hidden"/> <input itemprop="query-input" type="text" id="search-query" class="field field-text" required="required" onfocus="$('.google').css('visibility', 'visible');" name="q" placeholder="Search..." autocomplete="off"/> <input type="image" src="/images/google-search-icon.svg" class="google" title="Search via Google" alt="Search via Google"/> </form></div><div class="hot"><ul> <li> <a href="/code-ahead.html">Code Ahead</a> was published on Amazon just a few days ago! It is my new book, a novel about programmers. It explains in details the majority of ideas that stand behind <a href="https://www.zerocracy.com">Zerocracy</a> and <a href="https://www.xdsd.org">XDSD</a>. </li> <li> At <a href="/webinars.html">Webinar #37</a> we will discuss naming problem in OOP, for objects, methods and attributes; join us on <b>September 12</b>, at 11am PST. </li></ul></div></header></div><section itemscope="" itemtype="http://schema.org/BlogPosting"><div class="wrapper"> <header><p class="printable"> <img src="https://api.qrserver.com/v1/create-qr-code/?data=https://www.yegor256.com/2015/10/01/vertical-horizontal-decorating.html&amp;format=svg" style="width:125px;height:125px;" alt="QR code"/></p><p class="printable"> <code itemprop="url">https://www.yegor256.com/2015/10/01/vertical-horizontal-decorating.html</code></p><h1 itemprop="name headline mainEntityOfPage">Vertical and Horizontal Decorating</h1><aside class='book'><a href='http://amzn.to/2qFt4Tn'><img src='/images/books/elegant-objects/cover.png' class='book-cover' alt='book cover'/></a>Read more about this subject in <a href='http://amzn.to/2qFt4Tn'>Section&nbsp;3.2.6</a><br/> of my book<a href='http://amzn.to/2qFt4Tn'><img src='/images/books/amazon-buy-button.png' class='amazon-button' alt='Click to buy'/></a></aside><ul class="subline"> <li> <time itemprop="datePublished" datetime="2015-10-01T00:00:00+00:00"> 1 October 2015 </time> </li> <li class="desktop-only" itemprop="locationCreated">Moscow, Russia</li> <li class="printable" itemscope="" itemprop="author" itemtype="http://schema.org/Person"> <span itemprop="name">Yegor Bugayenko</span> </li> <li class="unprintable"> <i class="icon icon-comments"></i> <a href="http://www.yegor256.com/2015/10/01/vertical-horizontal-decorating.html#disqus_thread" itemprop="discussionUrl">comments</a> </li></ul><p class="unprintable"><p>A <a href="http://en.wikipedia.org/wiki/Decorator_pattern">decorator pattern</a> is one of the best ways to add features to an object without changing its interface. I use <a href="/2015/02/26/composable-decorators.html">composable decorators</a> quite often and always question myself as to how to design them right when the list of features must be configurable. I&#39;m not sure I have the right answer, but here is some food for thought.</p><figure class='jb_picture'><img itemprop='image' alt='The Apartment (1960) by Billy Wilder' src='/images/2015/10/the-apartment.jpg' longdesc='#3406debc'/><figcaption id='3406debc'>The Apartment (1960) by Billy Wilder</figcaption></figure><p>Let&#39;s say I have a list of numbers:</p><figure class="highlight"><pre><code class="language-java" data-lang="java"><span></span><span class="kd">interface</span> <span class="nc">Numbers</span> <span class="o">{</span>
  <span class="n">Iterable</span><span class="o">&lt;</span><span class="n">Integer</span><span class="o">&gt;</span> <span class="nf">iterate</span><span class="o">();</span>
<span class="o">}</span></code></pre></figure><p>Now I want to create a list that will only have odd, unique, positive, and sorted numbers. The first approach is <strong>vertical</strong> (I just made this name up):</p><figure class="highlight"><pre><code class="language-java" data-lang="java"><span></span><span class="n">Numbers</span> <span class="n">numbers</span> <span class="o">=</span> <span class="k">new</span> <span class="n">Sorted</span><span class="o">(</span>
  <span class="k">new</span> <span class="n">Unique</span><span class="o">(</span>
    <span class="k">new</span> <span class="n">Odds</span><span class="o">(</span>
      <span class="k">new</span> <span class="n">Positive</span><span class="o">(</span>
        <span class="k">new</span> <span class="n">ArrayNumbers</span><span class="o">(</span>
          <span class="k">new</span> <span class="n">Integer</span><span class="o">[]</span> <span class="o">{</span>
            <span class="o">-</span><span class="mi">1</span><span class="o">,</span> <span class="mi">78</span><span class="o">,</span> <span class="mi">4</span><span class="o">,</span> <span class="o">-</span><span class="mi">34</span><span class="o">,</span> <span class="mi">98</span><span class="o">,</span> <span class="mi">4</span><span class="o">,</span>
          <span class="o">}</span>
        <span class="o">)</span>
      <span class="o">)</span>
    <span class="o">)</span>
  <span class="o">)</span>
<span class="o">);</span></code></pre></figure><p>The second approach is <strong>horizontal</strong> (again, a name I made up):</p><figure class="highlight"><pre><code class="language-java" data-lang="java"><span></span><span class="n">Numbers</span> <span class="n">numbers</span> <span class="o">=</span> <span class="k">new</span> <span class="n">Modified</span><span class="o">(</span>
  <span class="k">new</span> <span class="n">ArrayNumbers</span><span class="o">(</span>
    <span class="k">new</span> <span class="n">Integer</span><span class="o">[]</span> <span class="o">{</span>
      <span class="o">-</span><span class="mi">1</span><span class="o">,</span> <span class="mi">78</span><span class="o">,</span> <span class="mi">4</span><span class="o">,</span> <span class="o">-</span><span class="mi">34</span><span class="o">,</span> <span class="mi">98</span><span class="o">,</span> <span class="mi">4</span><span class="o">,</span>
    <span class="o">}</span>
  <span class="o">),</span>
  <span class="k">new</span> <span class="n">Diff</span><span class="o">[]</span> <span class="o">{</span>
    <span class="k">new</span> <span class="n">Positive</span><span class="o">(),</span>
    <span class="k">new</span> <span class="n">Odds</span><span class="o">(),</span>
    <span class="k">new</span> <span class="n">Unique</span><span class="o">(),</span>
    <span class="k">new</span> <span class="n">Sorted</span><span class="o">(),</span>
  <span class="o">}</span>
<span class="o">);</span></code></pre></figure><p>See the difference? The first approach decorates <code>ArrayNumbers</code> &quot;vertically,&quot; adding functionality through the composable decorators <code>Positive</code>, <code>Odds</code>, <code>Unique</code>, and <code>Sorted</code>.</p><p>The second approach introduces the new interface <code>Diff</code>, which implements the core functionality of iterating numbers through instances of <code>Positive</code>, <code>Odds</code>, <code>Unique</code>, and <code>Sorted</code>:</p><figure class="highlight"><pre><code class="language-java" data-lang="java"><span></span><span class="kd">interface</span> <span class="nc">Diff</span> <span class="o">{</span>
  <span class="n">Iterable</span><span class="o">&lt;</span><span class="n">Integer</span><span class="o">&gt;</span> <span class="nf">apply</span><span class="o">(</span><span class="n">Iterable</span><span class="o">&lt;</span><span class="n">Integer</span><span class="o">&gt;</span> <span class="n">origin</span><span class="o">);</span>
<span class="o">}</span></code></pre></figure><p>For the user of <code>numbers</code>, both approaches are the same. The difference is only in the design. Which one is better and when? It seems that vertical decorating is easier to implement and is more suitable for smaller objects that expose just a few methods.</p><p>As for my experience, I always tend to start with vertical decorating since it&#39;s easier to implement but eventually migrate to a horizontal one when the number of decorators starts to grow.</p></p><nav class="buttons notranslate desktop-only"> <a href="http://www.facebook.com/sharer/sharer.php?u=https://www.yegor256.com/2015/10/01/vertical-horizontal-decorating.html" title="Share on Facebook" class="button" rel="nofollow"> <span class="count count-facebook">0</span> <i class="icon icon-facebook notranslate" aria-hidden="true"></i> </a> <a href="https://twitter.com/share?url=https://www.yegor256.com/2015/10/01/vertical-horizontal-decorating.html&amp;text=Vertical+and+Horizontal+Decorating" title="Share on Twitter" class="button" rel="nofollow"> <span class="count count-twitter">0</span> <i class="icon icon-twitter notranslate" aria-hidden="true"></i> </a> <a href="https://plus.google.com/share?url=https://www.yegor256.com/2015/10/01/vertical-horizontal-decorating.html" title="Share on Google+" class="button" rel="nofollow"> <span class="count count-googleplus">0</span> <i class="icon icon-googleplus notranslate" aria-hidden="true"></i> </a> <a href="https://www.linkedin.com/cws/share?url=https://www.yegor256.com/2015/10/01/vertical-horizontal-decorating.html" title="Share on LinkedIn" class="button" rel="nofollow"> <span class="count count-linkedin">0</span> <i class="icon icon-linkedin notranslate" aria-hidden="true"></i> </a> <a href="http://reddit.com/submit?url=https://www.yegor256.com/2015/10/01/vertical-horizontal-decorating.html%3F2015-39&amp;title=Vertical+and+Horizontal+Decorating" title="Share on Reddit" class="button" rel="nofollow"> <span class="count count-reddit">0</span> <i class="icon icon-reddit notranslate" aria-hidden="true"></i> </a> <a href="http://news.ycombinator.com/submitlink?u=https://www.yegor256.com/2015/10/01/vertical-horizontal-decorating.html%3F2015-39&amp;t=Vertical+and+Horizontal+Decorating" title="Share on Hacker News" class="button" rel="nofollow"> <span class="count count-hackernews">0</span> <i class="icon icon-hackernews notranslate" aria-hidden="true"></i> </a> </nav> </header> <article class="main" itemprop="articleBody"><div ><p>A <a href="http://en.wikipedia.org/wiki/Decorator_pattern">decorator pattern</a> is one of the best ways to add features to an object without changing its interface. I use <a href="/2015/02/26/composable-decorators.html">composable decorators</a> quite often and always question myself as to how to design them right when the list of features must be configurable. I&#39;m not sure I have the right answer, but here is some food for thought.</p><figure class='jb_picture'><img itemprop='image' alt='The Apartment (1960) by Billy Wilder' src='/images/2015/10/the-apartment.jpg' longdesc='#3406debc'/><figcaption id='3406debc'>The Apartment (1960) by Billy Wilder</figcaption></figure><p>Let&#39;s say I have a list of numbers:</p><figure class="highlight"><pre><code class="language-java" data-lang="java"><span></span><span class="kd">interface</span> <span class="nc">Numbers</span> <span class="o">{</span>
  <span class="n">Iterable</span><span class="o">&lt;</span><span class="n">Integer</span><span class="o">&gt;</span> <span class="nf">iterate</span><span class="o">();</span>
<span class="o">}</span></code></pre></figure><p>Now I want to create a list that will only have odd, unique, positive, and sorted numbers. The first approach is <strong>vertical</strong> (I just made this name up):</p><figure class="highlight"><pre><code class="language-java" data-lang="java"><span></span><span class="n">Numbers</span> <span class="n">numbers</span> <span class="o">=</span> <span class="k">new</span> <span class="n">Sorted</span><span class="o">(</span>
  <span class="k">new</span> <span class="n">Unique</span><span class="o">(</span>
    <span class="k">new</span> <span class="n">Odds</span><span class="o">(</span>
      <span class="k">new</span> <span class="n">Positive</span><span class="o">(</span>
        <span class="k">new</span> <span class="n">ArrayNumbers</span><span class="o">(</span>
          <span class="k">new</span> <span class="n">Integer</span><span class="o">[]</span> <span class="o">{</span>
            <span class="o">-</span><span class="mi">1</span><span class="o">,</span> <span class="mi">78</span><span class="o">,</span> <span class="mi">4</span><span class="o">,</span> <span class="o">-</span><span class="mi">34</span><span class="o">,</span> <span class="mi">98</span><span class="o">,</span> <span class="mi">4</span><span class="o">,</span>
          <span class="o">}</span>
        <span class="o">)</span>
      <span class="o">)</span>
    <span class="o">)</span>
  <span class="o">)</span>
<span class="o">);</span></code></pre></figure><p>The second approach is <strong>horizontal</strong> (again, a name I made up):</p><figure class="highlight"><pre><code class="language-java" data-lang="java"><span></span><span class="n">Numbers</span> <span class="n">numbers</span> <span class="o">=</span> <span class="k">new</span> <span class="n">Modified</span><span class="o">(</span>
  <span class="k">new</span> <span class="n">ArrayNumbers</span><span class="o">(</span>
    <span class="k">new</span> <span class="n">Integer</span><span class="o">[]</span> <span class="o">{</span>
      <span class="o">-</span><span class="mi">1</span><span class="o">,</span> <span class="mi">78</span><span class="o">,</span> <span class="mi">4</span><span class="o">,</span> <span class="o">-</span><span class="mi">34</span><span class="o">,</span> <span class="mi">98</span><span class="o">,</span> <span class="mi">4</span><span class="o">,</span>
    <span class="o">}</span>
  <span class="o">),</span>
  <span class="k">new</span> <span class="n">Diff</span><span class="o">[]</span> <span class="o">{</span>
    <span class="k">new</span> <span class="n">Positive</span><span class="o">(),</span>
    <span class="k">new</span> <span class="n">Odds</span><span class="o">(),</span>
    <span class="k">new</span> <span class="n">Unique</span><span class="o">(),</span>
    <span class="k">new</span> <span class="n">Sorted</span><span class="o">(),</span>
  <span class="o">}</span>
<span class="o">);</span></code></pre></figure><p>See the difference? The first approach decorates <code>ArrayNumbers</code> &quot;vertically,&quot; adding functionality through the composable decorators <code>Positive</code>, <code>Odds</code>, <code>Unique</code>, and <code>Sorted</code>.</p><p>The second approach introduces the new interface <code>Diff</code>, which implements the core functionality of iterating numbers through instances of <code>Positive</code>, <code>Odds</code>, <code>Unique</code>, and <code>Sorted</code>:</p><figure class="highlight"><pre><code class="language-java" data-lang="java"><span></span><span class="kd">interface</span> <span class="nc">Diff</span> <span class="o">{</span>
  <span class="n">Iterable</span><span class="o">&lt;</span><span class="n">Integer</span><span class="o">&gt;</span> <span class="nf">apply</span><span class="o">(</span><span class="n">Iterable</span><span class="o">&lt;</span><span class="n">Integer</span><span class="o">&gt;</span> <span class="n">origin</span><span class="o">);</span>
<span class="o">}</span></code></pre></figure><p>For the user of <code>numbers</code>, both approaches are the same. The difference is only in the design. Which one is better and when? It seems that vertical decorating is easier to implement and is more suitable for smaller objects that expose just a few methods.</p><p>As for my experience, I always tend to start with vertical decorating since it&#39;s easier to implement but eventually migrate to a horizontal one when the number of decorators starts to grow.</p></div></article></div><div class="wrapper"> <related-posts /></div><div class="disqus" role="complementary"><p class="disqus_hint"> Please, use <a href="https://help.disqus.com/commenting/what-html-tags-are-allowed-within-comments">syntax highlighting</a> in your comments, to make them more readable.</p><div id="disqus_thread" class="disqus-thread"> <a>&nbsp;</a></div><script> var disqus_config = function () { this.page.url = document.location.href.split('?')[0].split('#')[0].replace('https://', 'http://'); this.page.identifier = this.page.url; }; (function() { var d = document, s = d.createElement('script'); s.src = '//yegor256.disqus.com/embed.js'; s.setAttribute('data-timestamp', +new Date()); (d.head || d.body).appendChild(s); })(); </script> <noscript><div><p class="red"> JavaScript is disabled in your browser, that's why you can't see comments under this post.</p></div></noscript></div><div class="wrapper"> <footer class="footer"><p> &copy; <span itemscope="" itemprop="copyrightHolder" itemtype="http://schema.org/Person"> <span itemprop="name">Yegor Bugayenko</span> </span> 2014&ndash;<span itemprop="copyrightYear">2018</span></p></footer></div></section><div class="wrapper unprintable" style="text-align:center;margin-top:2em;"> <a href="http://www.sixnines.io/h/3ba1652f"> <img src="//www.sixnines.io/b/3ba1652f?style=flat" alt="sixnines availability badge"/> </a></div><script src="//code.jquery.com/jquery-1.9.0.min.js"></script> <script src="/js/all.js?a0e0d018c07"></script> <script>var disqus_shortname = 'yegor256';</script> <script id="dsq-count-scr" src="//yegor256.disqus.com/count.js" async="async"></script> <script> (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){ (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o), m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m) })(window,document,'script','//www.google-analytics.com/analytics.js','ga'); ga('create', 'UA-1963507-32', 'auto'); ga('send', 'pageview'); </script> <script> Cd=document;Cr="&"+Math.random();Cp="&s=1"; Cd.cookie="b=b";if(Cd.cookie)Cp+="&c=1"; Cp+="&t="+(new Date()).getTimezoneOffset(); if(self!=top)Cp+="&f=1"; </script> <script> if(navigator.javaEnabled())Cp+="&j=1"; </script> <script> if(typeof(screen)!='undefined')Cp+="&w="+screen.width+"&h="+ screen.height+"&d="+(screen.colorDepth?screen.colorDepth:screen.pixelDepth); </script> <script> Cd.write("<img src='//c.hit.ua/hit?i=95870&g=0&x=2"+Cp+Cr+ "&r="+escape(Cd.referrer)+"&u="+escape(window.location.href)+ "' border='0' wi"+"dth='1' he"+"ight='1'/>"); </script> <script type="application/ld+json"> { "@context": "http://schema.org", "@type": "Person", "name": "Yegor Bugayenko", "url": "http://www.yegor256.com", "sameAs": [ "https://www.facebook.com/yegor256", "https://instagram.com/yegor256", "https://www.linkedin.com/in/yegor256", "https://twitter.com/yegor256", "https://github.com/yegor256", "https://www.pinterest.com/yegor256/" ] } </script> </body> </html> <!DOCTYPE html> <html xmlns="http://www.w3.org/1999/xhtml" lang="en-US" xml:lang="en-US" itemscope="" itemtype="http://schema.org/WebSite"> <head> <meta charset="utf-8"/> <meta name="description" content="Despite good intentions, redundant variables actually make your code dirty and difficult to understand. " /> <meta name="keywords" content="java variables, redundant variables, too many variables, variables in java, variables in oop" /> <meta name="viewport" content="width=device-width,minimum-scale=1,initial-scale=1"/> <meta name="google-site-verification" content="JEj_gQr2CPe2QKGw8XdMz0R7VboQIUbX3FlM-lwTq-8" /> <meta name="author" content="Yegor Bugayenko"> <meta name="article:published_time" content="2015-09-01 00:00:00 +0000"> <meta name="og:site_name" content="Yegor Bugayenko"/> <meta name="og:type" content="article" /> <meta name="og:locale" content="en_US" /> <meta name="twitter:account_id" content="4503599630178231" /> <meta name="twitter:creator" content="@yegor256"/> <meta name="twitter:site" content="@yegor256"/> <meta name="twitter:title" property="og:title" content="Redundant Variables Are Pure Evil"/> <meta name="twitter:description" property="og:description" content="Despite good intentions, redundant variables actually make your code dirty and difficult to understand. "/> <meta name="twitter:url" property="og:url" content="https://www.yegor256.com/2015/09/01/redundant-variables-are-evil.html"/> <meta name="telegram:channel" content="AAAAAEJFMRzsRTRxM3ec6A"/> <link rel="search" type="application/opensearchdescription+xml" href="/opensearch.xml" title="yegor256" /> <link rel="shortcut icon" href="/favicon.ico?a0e0d018c07"/> <link rel="apple-touch-icon" href="/favicon.ico?a0e0d018c07"/> <link rel="alternate" type="application/rss+xml" title="RSS for yegor256.com" href="https://www.yegor256.com/rss.xml"/> <link rel="stylesheet" href="/css/layout.css?a0e0d018c07"/> <link rel="stylesheet" href="/css/icons.css?a0e0d018c07"/> <link rel="canonical" href="https://www.yegor256.com/2015/09/01/redundant-variables-are-evil.html" /> <link rel="amphtml" href="https://www.yegor256.com/2015/09/01/redundant-variables-are-evil.amp.html" /> <title>Redundant Variables Are Pure Evil </title> <meta name='og:image' content='https://www.yegor256.com/images/2015/09/y-tu-mama-tambien.jpg'/><meta name='twitter:image' content='https://www.yegor256.com/images/2015/09/y-tu-mama-tambien.jpg'/><meta name='og:image:width' content='1280'/> <meta name='twitter:image:width' content='1280'/><meta name='og:image:height' content='680'/> <meta name='twitter:image:height' content='680'/><meta name='twitter:card' content='summary_large_image'/><meta name='twitter:image:alt' content='Y Tu Mamá También (2001) by Alfonso Cuarón'/> </head> <body><div class="wrapper"> <aside class="header-toggle unprintable" id="header-toggle" title="Show the menu" onclick="$('#header').show();$('#header-toggle').hide();">&#9776;</aside> <header class="header" id="header"><div class="face"> <a href="/about-me.html#form" class="sub" title="Click to subscribe to my monthly newsletter"><span>Subscribe</span></a> <a href="/about-me.html" style="position:relative;"> <img src="/images/face-256x256.jpg" class="photo" alt="Yegor Bugayenko"/> </a></div><nav><ul class="menu social notranslate"> <li><a href="https://twitter.com/intent/follow?screen_name=yegor256" rel="nofollow" title="Follow me on Twitter"><i class="icon icon-twitter notranslate" aria-hidden="true"></i></a></li> <li><a href="/rss.xml" rel="nofollow" title="Subscribe to my RSS feed"><i class="icon icon-rss notranslate" aria-hidden="true"></i></a></li> <li><a itemprop="sameAs" href="https://github.com/yegor256" rel="nofollow" title="My GitHub profile"><i class="icon icon-github notranslate" aria-hidden="true"></i></a></li> <li><a itemprop="sameAs" href="http://stackoverflow.com/users/187141/yegor256" rel="nofollow" title="My StackOverflow profile"><i class="icon icon-stackoverflow notranslate" aria-hidden="true"></i></a></li> <li><a itemprop="sameAs" href="https://www.facebook.com/yegor256" rel="nofollow" title="Follow me on Facebook"><i class="icon icon-facebook notranslate" aria-hidden="true"></i></a></li> <li><a itemprop="sameAs" href="https://instagram.com/yegor256" rel="nofollow" title="Follow me on Instagram"><i class="icon icon-instagram notranslate" aria-hidden="true"></i></a></li> <li><a itemprop="sameAs" href="https://www.linkedin.com/in/yegor256" rel="nofollow" title="My LinkedIn profile"><i class="icon icon-linkedin notranslate" aria-hidden="true"></i></a></li> <li><a itemprop="sameAs" href="https://www.youtube.com/c/yegor256?sub_confirmation=1" rel="nofollow" title="My Youtube video channel"><i class="icon icon-youtube notranslate" aria-hidden="true"></i></a></li> <li><a itemprop="sameAs" href="https://www.pinterest.com/yegor256/" rel="nofollow" title="My Pinterest boards"><i class="icon icon-pinterest notranslate" aria-hidden="true"></i></a></li> <li><a itemprop="sameAs" href="https://angel.co/yegor256" rel="nofollow" title="My AngelList profile"><i class="icon icon-angellist notranslate" aria-hidden="true"></i></a></li> <li><a href="https://soundcloud.com/yegor256" rel="nofollow" title="My podcast"><i class="icon icon-podcast notranslate" aria-hidden="true"></i></a></li> <li><a href="https://itunes.apple.com/us/podcast/yegor256-podcast/id1150826721" rel="nofollow" title="My iTunes podcast"><i class="icon icon-itunes notranslate" aria-hidden="true"></i></a></li> <li><a href="https://t.me/joinchat/AAAAAEJFMRzsRTRxM3ec6A" rel="nofollow" title="My Telegram public channel"><i class="icon icon-telegram notranslate" aria-hidden="true"></i></a></li> <li><a href="mailto:blog@yegor256.com" rel="nofollow" title="Email me any time"><i class="icon icon-mail notranslate" aria-hidden="true"></i></a></li></ul><ul class="menu"> <li><a href="/" title="Home page">Home</a></li> <li ><a href="/best.html" title="Best articles to read">12&#160;Best</a></li> <li ><a href="/contents.html" title="The contents of the entire blog">All&#160;288</a></li> <li ><a href="/webinars.html" title="My webinars">Webinars</a></li> <li ><a href="/talks.html" title="Future and past conference talks">Talks</a></li> <li ><a href="/books.html" title="The books I wrote">Books</a></li> <li ><a href="/papers.html" title="My academic papers and patents">Papers</a></li> <li ><a href="/pets.html" title="My loved pet projects">Pets</a></li> <li ><a href="/award.html" title="Software quality award">Award</a></li> <li ><a href="/testimonials.html" title="What some people say about me">Testimonials</a></li> <li ><a href="/shift-m.html" title="Audio podcast about project management">Shift-M</a></li> <li ><a href="/paintings.html" title="My paintings for sale">Paintings</a></li> <li><a href="http://ru.yegor256.com/" title="Немного на русском языке">По-русски</a></li></ul></nav><div class="search"> <form method="get" action="https://www.google.com/search" itemprop="potentialAction" itemscope="" itemtype="http://schema.org/SearchAction"> <meta itemprop="target" content="https://www.google.com/search?q={q}"/> <input name="sitesearch" value="yegor256.com" type="hidden"/> <input itemprop="query-input" type="text" id="search-query" class="field field-text" required="required" onfocus="$('.google').css('visibility', 'visible');" name="q" placeholder="Search..." autocomplete="off"/> <input type="image" src="/images/google-search-icon.svg" class="google" title="Search via Google" alt="Search via Google"/> </form></div><div class="hot"><ul> <li> <a href="/code-ahead.html">Code Ahead</a> was published on Amazon just a few days ago! It is my new book, a novel about programmers. It explains in details the majority of ideas that stand behind <a href="https://www.zerocracy.com">Zerocracy</a> and <a href="https://www.xdsd.org">XDSD</a>. </li> <li> At <a href="/webinars.html">Webinar #37</a> we will discuss naming problem in OOP, for objects, methods and attributes; join us on <b>September 12</b>, at 11am PST. </li></ul></div></header></div><section itemscope="" itemtype="http://schema.org/BlogPosting"><div class="wrapper"> <header><p class="printable"> <img src="https://api.qrserver.com/v1/create-qr-code/?data=https://www.yegor256.com/2015/09/01/redundant-variables-are-evil.html&amp;format=svg" style="width:125px;height:125px;" alt="QR code"/></p><p class="printable"> <code itemprop="url">https://www.yegor256.com/2015/09/01/redundant-variables-are-evil.html</code></p><h1 itemprop="name headline mainEntityOfPage">Redundant Variables Are Pure Evil</h1><ul class="subline"> <li> <time itemprop="datePublished" datetime="2015-09-01T00:00:00+00:00"> 1 September 2015 </time> </li> <li class="desktop-only" itemprop="locationCreated">Kiev, Ukraine</li> <li class="printable" itemscope="" itemprop="author" itemtype="http://schema.org/Person"> <span itemprop="name">Yegor Bugayenko</span> </li> <li class="unprintable"> <i class="icon icon-comments"></i> <a href="http://www.yegor256.com/2015/09/01/redundant-variables-are-evil.html#disqus_thread" itemprop="discussionUrl">comments</a> </li></ul><p class="unprintable"><p>A redundant variable is one that exists exclusively to <strong>explain</strong> its value. I strongly believe that such a variable is not only pure noise but also <strong>evil</strong>, with a very negative effect on code readability. When we introduce a redundant variable, we intend to make our code cleaner and easier to read. In reality, though, we make it more verbose and difficult to understand. Without exception, any variable used only once is redundant and must be replaced with a value.</p><figure class='jb_picture'><img itemprop='image' alt='Y Tu Mamá También (2001) by Alfonso Cuarón' src='/images/2015/09/y-tu-mama-tambien.jpg' longdesc='#c57934a9'/><figcaption id='c57934a9'>Y Tu Mamá También (2001) by Alfonso Cuarón</figcaption></figure><p>Here, variable <code>fileName</code> is redundant:</p><figure class="highlight"><pre><code class="language-java" data-lang="java"><span></span><span class="n">String</span> <span class="n">fileName</span> <span class="o">=</span> <span class="s">&quot;test.txt&quot;</span><span class="o">;</span>
<span class="n">print</span><span class="o">(</span><span class="s">&quot;Length is &quot;</span> <span class="o">+</span> <span class="k">new</span> <span class="n">File</span><span class="o">(</span><span class="n">fileName</span><span class="o">).</span><span class="na">length</span><span class="o">());</span></code></pre></figure><p>This code must look differently:</p><figure class="highlight"><pre><code class="language-java" data-lang="java"><span></span><span class="n">print</span><span class="o">(</span><span class="s">&quot;Length is &quot;</span> <span class="o">+</span> <span class="k">new</span> <span class="n">File</span><span class="o">(</span><span class="s">&quot;test.txt&quot;</span><span class="o">).</span><span class="na">length</span><span class="o">());</span></code></pre></figure><p>This example is very primitive, but I&#39;m sure you&#39;ve seen these redundant variables many times. We use them to &quot;explain&quot; the code---it&#39;s not just a string literal <code>&quot;test.txt&quot;</code> anymore but a <code>fileName</code>. The code looks easier to understand, right? Not really.</p><aside class='quote'>The more variable names I have to remember, the longer it takes to digest the code</aside><p>Let&#39;s dig into what &quot;readability&quot; of code is in the first place. I think this quality can be measured by the number of seconds I need to understand the code I&#39;m looking at. The longer the timeframe, the lower the readability. Ideally, I want to understand any piece of code in a <strong>few seconds</strong>. If I can&#39;t, that&#39;s a failure of its <strong>author</strong>.</p><p><a href="/2015/06/29/simple-diagrams.html">Remember</a>, if I don&#39;t understand you, it&#39;s your fault.</p><p>An increasing length of code degrades readability. So the more variable names I have to remember while reading through it, the longer it takes to digest the code and come to a conclusion about its purpose and effects. I think <strong>four</strong> is the maximum number of variables I can comfortably keep in my head without thinking about quitting the job.</p><p>New variables make the code longer because they need extra lines to be declared. And they make the code more complex because its reader has to remember more names.</p><p>Thus, when you want to introduce a new variable to explain what your code is doing, stop and think. Your code is too complex and long in the first place! Refactor it using new objects or methods but not variables. Make your code shorter by moving pieces of it into new classes or private methods.</p><p>Moreover, I think that in <a href="/2015/08/18/multiple-return-statements-in-oop.html">perfectly designed methods</a>, you won&#39;t need <strong>any</strong> variables aside from method arguments.</p></p><nav class="buttons notranslate desktop-only"> <a href="http://www.facebook.com/sharer/sharer.php?u=https://www.yegor256.com/2015/09/01/redundant-variables-are-evil.html" title="Share on Facebook" class="button" rel="nofollow"> <span class="count count-facebook">0</span> <i class="icon icon-facebook notranslate" aria-hidden="true"></i> </a> <a href="https://twitter.com/share?url=https://www.yegor256.com/2015/09/01/redundant-variables-are-evil.html&amp;text=Redundant+Variables+Are+Pure+Evil" title="Share on Twitter" class="button" rel="nofollow"> <span class="count count-twitter">0</span> <i class="icon icon-twitter notranslate" aria-hidden="true"></i> </a> <a href="https://plus.google.com/share?url=https://www.yegor256.com/2015/09/01/redundant-variables-are-evil.html" title="Share on Google+" class="button" rel="nofollow"> <span class="count count-googleplus">0</span> <i class="icon icon-googleplus notranslate" aria-hidden="true"></i> </a> <a href="https://www.linkedin.com/cws/share?url=https://www.yegor256.com/2015/09/01/redundant-variables-are-evil.html" title="Share on LinkedIn" class="button" rel="nofollow"> <span class="count count-linkedin">0</span> <i class="icon icon-linkedin notranslate" aria-hidden="true"></i> </a> <a href="http://reddit.com/submit?url=https://www.yegor256.com/2015/09/01/redundant-variables-are-evil.html%3F2015-35&amp;title=Redundant+Variables+Are+Pure+Evil" title="Share on Reddit" class="button" rel="nofollow"> <span class="count count-reddit">0</span> <i class="icon icon-reddit notranslate" aria-hidden="true"></i> </a> <a href="http://news.ycombinator.com/submitlink?u=https://www.yegor256.com/2015/09/01/redundant-variables-are-evil.html%3F2015-35&amp;t=Redundant+Variables+Are+Pure+Evil" title="Share on Hacker News" class="button" rel="nofollow"> <span class="count count-hackernews">0</span> <i class="icon icon-hackernews notranslate" aria-hidden="true"></i> </a> </nav> </header> <article class="main" itemprop="articleBody"><div ><p>A redundant variable is one that exists exclusively to <strong>explain</strong> its value. I strongly believe that such a variable is not only pure noise but also <strong>evil</strong>, with a very negative effect on code readability. When we introduce a redundant variable, we intend to make our code cleaner and easier to read. In reality, though, we make it more verbose and difficult to understand. Without exception, any variable used only once is redundant and must be replaced with a value.</p><figure class='jb_picture'><img itemprop='image' alt='Y Tu Mamá También (2001) by Alfonso Cuarón' src='/images/2015/09/y-tu-mama-tambien.jpg' longdesc='#c57934a9'/><figcaption id='c57934a9'>Y Tu Mamá También (2001) by Alfonso Cuarón</figcaption></figure><p>Here, variable <code>fileName</code> is redundant:</p><figure class="highlight"><pre><code class="language-java" data-lang="java"><span></span><span class="n">String</span> <span class="n">fileName</span> <span class="o">=</span> <span class="s">&quot;test.txt&quot;</span><span class="o">;</span>
<span class="n">print</span><span class="o">(</span><span class="s">&quot;Length is &quot;</span> <span class="o">+</span> <span class="k">new</span> <span class="n">File</span><span class="o">(</span><span class="n">fileName</span><span class="o">).</span><span class="na">length</span><span class="o">());</span></code></pre></figure><p>This code must look differently:</p><figure class="highlight"><pre><code class="language-java" data-lang="java"><span></span><span class="n">print</span><span class="o">(</span><span class="s">&quot;Length is &quot;</span> <span class="o">+</span> <span class="k">new</span> <span class="n">File</span><span class="o">(</span><span class="s">&quot;test.txt&quot;</span><span class="o">).</span><span class="na">length</span><span class="o">());</span></code></pre></figure><p>This example is very primitive, but I&#39;m sure you&#39;ve seen these redundant variables many times. We use them to &quot;explain&quot; the code---it&#39;s not just a string literal <code>&quot;test.txt&quot;</code> anymore but a <code>fileName</code>. The code looks easier to understand, right? Not really.</p><aside class='quote'>The more variable names I have to remember, the longer it takes to digest the code</aside><p>Let&#39;s dig into what &quot;readability&quot; of code is in the first place. I think this quality can be measured by the number of seconds I need to understand the code I&#39;m looking at. The longer the timeframe, the lower the readability. Ideally, I want to understand any piece of code in a <strong>few seconds</strong>. If I can&#39;t, that&#39;s a failure of its <strong>author</strong>.</p><p><a href="/2015/06/29/simple-diagrams.html">Remember</a>, if I don&#39;t understand you, it&#39;s your fault.</p><p>An increasing length of code degrades readability. So the more variable names I have to remember while reading through it, the longer it takes to digest the code and come to a conclusion about its purpose and effects. I think <strong>four</strong> is the maximum number of variables I can comfortably keep in my head without thinking about quitting the job.</p><p>New variables make the code longer because they need extra lines to be declared. And they make the code more complex because its reader has to remember more names.</p><p>Thus, when you want to introduce a new variable to explain what your code is doing, stop and think. Your code is too complex and long in the first place! Refactor it using new objects or methods but not variables. Make your code shorter by moving pieces of it into new classes or private methods.</p><p>Moreover, I think that in <a href="/2015/08/18/multiple-return-statements-in-oop.html">perfectly designed methods</a>, you won&#39;t need <strong>any</strong> variables aside from method arguments.</p></div></article></div><div class="wrapper"> <related-posts /></div><div class="disqus" role="complementary"><p class="disqus_hint"> Please, use <a href="https://help.disqus.com/commenting/what-html-tags-are-allowed-within-comments">syntax highlighting</a> in your comments, to make them more readable.</p><div id="disqus_thread" class="disqus-thread"> <a>&nbsp;</a></div><script> var disqus_config = function () { this.page.url = document.location.href.split('?')[0].split('#')[0].replace('https://', 'http://'); this.page.identifier = this.page.url; }; (function() { var d = document, s = d.createElement('script'); s.src = '//yegor256.disqus.com/embed.js'; s.setAttribute('data-timestamp', +new Date()); (d.head || d.body).appendChild(s); })(); </script> <noscript><div><p class="red"> JavaScript is disabled in your browser, that's why you can't see comments under this post.</p></div></noscript></div><div class="wrapper"> <footer class="footer"><p> &copy; <span itemscope="" itemprop="copyrightHolder" itemtype="http://schema.org/Person"> <span itemprop="name">Yegor Bugayenko</span> </span> 2014&ndash;<span itemprop="copyrightYear">2018</span></p></footer></div></section><div class="wrapper unprintable" style="text-align:center;margin-top:2em;"> <a href="http://www.sixnines.io/h/3ba1652f"> <img src="//www.sixnines.io/b/3ba1652f?style=flat" alt="sixnines availability badge"/> </a></div><script src="//code.jquery.com/jquery-1.9.0.min.js"></script> <script src="/js/all.js?a0e0d018c07"></script> <script>var disqus_shortname = 'yegor256';</script> <script id="dsq-count-scr" src="//yegor256.disqus.com/count.js" async="async"></script> <script> (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){ (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o), m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m) })(window,document,'script','//www.google-analytics.com/analytics.js','ga'); ga('create', 'UA-1963507-32', 'auto'); ga('send', 'pageview'); </script> <script> Cd=document;Cr="&"+Math.random();Cp="&s=1"; Cd.cookie="b=b";if(Cd.cookie)Cp+="&c=1"; Cp+="&t="+(new Date()).getTimezoneOffset(); if(self!=top)Cp+="&f=1"; </script> <script> if(navigator.javaEnabled())Cp+="&j=1"; </script> <script> if(typeof(screen)!='undefined')Cp+="&w="+screen.width+"&h="+ screen.height+"&d="+(screen.colorDepth?screen.colorDepth:screen.pixelDepth); </script> <script> Cd.write("<img src='//c.hit.ua/hit?i=95870&g=0&x=2"+Cp+Cr+ "&r="+escape(Cd.referrer)+"&u="+escape(window.location.href)+ "' border='0' wi"+"dth='1' he"+"ight='1'/>"); </script> <script type="application/ld+json"> { "@context": "http://schema.org", "@type": "Person", "name": "Yegor Bugayenko", "url": "http://www.yegor256.com", "sameAs": [ "https://www.facebook.com/yegor256", "https://instagram.com/yegor256", "https://www.linkedin.com/in/yegor256", "https://twitter.com/yegor256", "https://github.com/yegor256", "https://www.pinterest.com/yegor256/" ] } </script> </body> </html> <!DOCTYPE html> <html xmlns="http://www.w3.org/1999/xhtml" lang="en-US" xml:lang="en-US" itemscope="" itemtype="http://schema.org/WebSite"> <head> <meta charset="utf-8"/> <meta name="description" content="A properly designed method in object-oriented software must have a single return statement---and nothing but a return statement. " /> <meta name="keywords" content="one return only, one return statement, single exit point, single function exit point, single return in method" /> <meta name="viewport" content="width=device-width,minimum-scale=1,initial-scale=1"/> <meta name="google-site-verification" content="JEj_gQr2CPe2QKGw8XdMz0R7VboQIUbX3FlM-lwTq-8" /> <meta name="author" content="Yegor Bugayenko"> <meta name="article:published_time" content="2015-08-18 00:00:00 +0000"> <meta name="og:site_name" content="Yegor Bugayenko"/> <meta name="og:type" content="article" /> <meta name="og:locale" content="en_US" /> <meta name="twitter:account_id" content="4503599630178231" /> <meta name="twitter:creator" content="@yegor256"/> <meta name="twitter:site" content="@yegor256"/> <meta name="twitter:title" property="og:title" content="Why Many Return Statements Are a Bad Idea in OOP"/> <meta name="twitter:description" property="og:description" content="A properly designed method in object-oriented software must have a single return statement---and nothing but a return statement. "/> <meta name="twitter:url" property="og:url" content="https://www.yegor256.com/2015/08/18/multiple-return-statements-in-oop.html"/> <meta name="telegram:channel" content="AAAAAEJFMRzsRTRxM3ec6A"/> <link rel="search" type="application/opensearchdescription+xml" href="/opensearch.xml" title="yegor256" /> <link rel="shortcut icon" href="/favicon.ico?a0e0d018c07"/> <link rel="apple-touch-icon" href="/favicon.ico?a0e0d018c07"/> <link rel="alternate" type="application/rss+xml" title="RSS for yegor256.com" href="https://www.yegor256.com/rss.xml"/> <link rel="stylesheet" href="/css/layout.css?a0e0d018c07"/> <link rel="stylesheet" href="/css/icons.css?a0e0d018c07"/> <link rel="canonical" href="https://www.yegor256.com/2015/08/18/multiple-return-statements-in-oop.html" /> <link rel="amphtml" href="https://www.yegor256.com/2015/08/18/multiple-return-statements-in-oop.amp.html" /> <title>Why Many Return Statements Are a Bad Idea in OOP </title> </head> <body><div class="wrapper"> <aside class="header-toggle unprintable" id="header-toggle" title="Show the menu" onclick="$('#header').show();$('#header-toggle').hide();">&#9776;</aside> <header class="header" id="header"><div class="face"> <a href="/about-me.html#form" class="sub" title="Click to subscribe to my monthly newsletter"><span>Subscribe</span></a> <a href="/about-me.html" style="position:relative;"> <img src="/images/face-256x256.jpg" class="photo" alt="Yegor Bugayenko"/> </a></div><nav><ul class="menu social notranslate"> <li><a href="https://twitter.com/intent/follow?screen_name=yegor256" rel="nofollow" title="Follow me on Twitter"><i class="icon icon-twitter notranslate" aria-hidden="true"></i></a></li> <li><a href="/rss.xml" rel="nofollow" title="Subscribe to my RSS feed"><i class="icon icon-rss notranslate" aria-hidden="true"></i></a></li> <li><a itemprop="sameAs" href="https://github.com/yegor256" rel="nofollow" title="My GitHub profile"><i class="icon icon-github notranslate" aria-hidden="true"></i></a></li> <li><a itemprop="sameAs" href="http://stackoverflow.com/users/187141/yegor256" rel="nofollow" title="My StackOverflow profile"><i class="icon icon-stackoverflow notranslate" aria-hidden="true"></i></a></li> <li><a itemprop="sameAs" href="https://www.facebook.com/yegor256" rel="nofollow" title="Follow me on Facebook"><i class="icon icon-facebook notranslate" aria-hidden="true"></i></a></li> <li><a itemprop="sameAs" href="https://instagram.com/yegor256" rel="nofollow" title="Follow me on Instagram"><i class="icon icon-instagram notranslate" aria-hidden="true"></i></a></li> <li><a itemprop="sameAs" href="https://www.linkedin.com/in/yegor256" rel="nofollow" title="My LinkedIn profile"><i class="icon icon-linkedin notranslate" aria-hidden="true"></i></a></li> <li><a itemprop="sameAs" href="https://www.youtube.com/c/yegor256?sub_confirmation=1" rel="nofollow" title="My Youtube video channel"><i class="icon icon-youtube notranslate" aria-hidden="true"></i></a></li> <li><a itemprop="sameAs" href="https://www.pinterest.com/yegor256/" rel="nofollow" title="My Pinterest boards"><i class="icon icon-pinterest notranslate" aria-hidden="true"></i></a></li> <li><a itemprop="sameAs" href="https://angel.co/yegor256" rel="nofollow" title="My AngelList profile"><i class="icon icon-angellist notranslate" aria-hidden="true"></i></a></li> <li><a href="https://soundcloud.com/yegor256" rel="nofollow" title="My podcast"><i class="icon icon-podcast notranslate" aria-hidden="true"></i></a></li> <li><a href="https://itunes.apple.com/us/podcast/yegor256-podcast/id1150826721" rel="nofollow" title="My iTunes podcast"><i class="icon icon-itunes notranslate" aria-hidden="true"></i></a></li> <li><a href="https://t.me/joinchat/AAAAAEJFMRzsRTRxM3ec6A" rel="nofollow" title="My Telegram public channel"><i class="icon icon-telegram notranslate" aria-hidden="true"></i></a></li> <li><a href="mailto:blog@yegor256.com" rel="nofollow" title="Email me any time"><i class="icon icon-mail notranslate" aria-hidden="true"></i></a></li></ul><ul class="menu"> <li><a href="/" title="Home page">Home</a></li> <li ><a href="/best.html" title="Best articles to read">12&#160;Best</a></li> <li ><a href="/contents.html" title="The contents of the entire blog">All&#160;288</a></li> <li ><a href="/webinars.html" title="My webinars">Webinars</a></li> <li ><a href="/talks.html" title="Future and past conference talks">Talks</a></li> <li ><a href="/books.html" title="The books I wrote">Books</a></li> <li ><a href="/papers.html" title="My academic papers and patents">Papers</a></li> <li ><a href="/pets.html" title="My loved pet projects">Pets</a></li> <li ><a href="/award.html" title="Software quality award">Award</a></li> <li ><a href="/testimonials.html" title="What some people say about me">Testimonials</a></li> <li ><a href="/shift-m.html" title="Audio podcast about project management">Shift-M</a></li> <li ><a href="/paintings.html" title="My paintings for sale">Paintings</a></li> <li><a href="http://ru.yegor256.com/" title="Немного на русском языке">По-русски</a></li></ul></nav><div class="search"> <form method="get" action="https://www.google.com/search" itemprop="potentialAction" itemscope="" itemtype="http://schema.org/SearchAction"> <meta itemprop="target" content="https://www.google.com/search?q={q}"/> <input name="sitesearch" value="yegor256.com" type="hidden"/> <input itemprop="query-input" type="text" id="search-query" class="field field-text" required="required" onfocus="$('.google').css('visibility', 'visible');" name="q" placeholder="Search..." autocomplete="off"/> <input type="image" src="/images/google-search-icon.svg" class="google" title="Search via Google" alt="Search via Google"/> </form></div><div class="hot"><ul> <li> <a href="/code-ahead.html">Code Ahead</a> was published on Amazon just a few days ago! It is my new book, a novel about programmers. It explains in details the majority of ideas that stand behind <a href="https://www.zerocracy.com">Zerocracy</a> and <a href="https://www.xdsd.org">XDSD</a>. </li> <li> At <a href="/webinars.html">Webinar #37</a> we will discuss naming problem in OOP, for objects, methods and attributes; join us on <b>September 12</b>, at 11am PST. </li></ul></div></header></div><section itemscope="" itemtype="http://schema.org/BlogPosting"><div class="wrapper"> <header><p class="printable"> <img src="https://api.qrserver.com/v1/create-qr-code/?data=https://www.yegor256.com/2015/08/18/multiple-return-statements-in-oop.html&amp;format=svg" style="width:125px;height:125px;" alt="QR code"/></p><p class="printable"> <code itemprop="url">https://www.yegor256.com/2015/08/18/multiple-return-statements-in-oop.html</code></p><h1 itemprop="name headline mainEntityOfPage">Why Many Return Statements Are a Bad Idea in OOP</h1><ul class="subline"> <li> <time itemprop="datePublished" datetime="2015-08-18T00:00:00+00:00"> 18 August 2015 </time> </li> <li class="desktop-only" itemprop="locationCreated">Kiev, Ukraine</li> <li class="printable" itemscope="" itemprop="author" itemtype="http://schema.org/Person"> <span itemprop="name">Yegor Bugayenko</span> </li> <li class="unprintable"> <i class="icon icon-comments"></i> <a href="http://www.yegor256.com/2015/08/18/multiple-return-statements-in-oop.html#disqus_thread" itemprop="discussionUrl">comments</a> </li></ul><p class="unprintable"><p>This <a href="http://programmers.stackexchange.com/questions/118703">debate</a> is very old, but I have something to say too. The question is whether a method may have multiple <code>return</code> statements or always just one. The answer may surprise you: In a pure object-oriented world, a method <strong>must</strong> have a <strong>single</strong> <code>return</code> statement and <strong>nothing</strong> else. Yes, just a <code>return</code> statement and that&#39;s it. No other operators or statements. Just <code>return</code>. All arguments in favor of multiple <code>return</code> statements go against the very idea of object-oriented programming.</p><p>This is a classical example:</p><figure class="highlight"><pre><code class="language-java" data-lang="java"><span></span><span class="kd">public</span> <span class="kt">int</span> <span class="nf">max</span><span class="o">(</span><span class="kt">int</span> <span class="n">a</span><span class="o">,</span> <span class="kt">int</span> <span class="n">b</span><span class="o">)</span> <span class="o">{</span>
  <span class="k">if</span> <span class="o">(</span><span class="n">a</span> <span class="o">&gt;</span> <span class="n">b</span><span class="o">)</span> <span class="o">{</span>
    <span class="k">return</span> <span class="n">a</span><span class="o">;</span>
  <span class="o">}</span>
  <span class="k">return</span> <span class="n">b</span><span class="o">;</span>
<span class="o">}</span></code></pre></figure><p>The code above has two <code>return</code> statements, and it is shorter than this one with a single <code>return</code>:</p><figure class="highlight"><pre><code class="language-java" data-lang="java"><span></span><span class="kd">public</span> <span class="kt">int</span> <span class="nf">max</span><span class="o">(</span><span class="kt">int</span> <span class="n">a</span><span class="o">,</span> <span class="kt">int</span> <span class="n">b</span><span class="o">)</span> <span class="o">{</span>
  <span class="kt">int</span> <span class="n">m</span><span class="o">;</span>
  <span class="k">if</span> <span class="o">(</span><span class="n">a</span> <span class="o">&gt;</span> <span class="n">b</span><span class="o">)</span> <span class="o">{</span>
    <span class="n">m</span> <span class="o">=</span> <span class="n">a</span><span class="o">;</span>
  <span class="o">}</span> <span class="k">else</span> <span class="o">{</span>
    <span class="n">m</span> <span class="o">=</span> <span class="n">b</span><span class="o">;</span>
  <span class="o">}</span>
  <span class="k">return</span> <span class="n">m</span><span class="o">;</span>
<span class="o">}</span></code></pre></figure><p>More verbose, less readable, and slower, right? Right.</p><p>This is the code in a <strong>pure</strong> object-oriented world:</p><figure class="highlight"><pre><code class="language-java" data-lang="java"><span></span><span class="kd">public</span> <span class="kt">int</span> <span class="nf">max</span><span class="o">(</span><span class="kt">int</span> <span class="n">a</span><span class="o">,</span> <span class="kt">int</span> <span class="n">b</span><span class="o">)</span> <span class="o">{</span>
  <span class="k">return</span> <span class="k">new</span> <span class="n">If</span><span class="o">(</span>
    <span class="k">new</span> <span class="n">GreaterThan</span><span class="o">(</span><span class="n">a</span><span class="o">,</span> <span class="n">b</span><span class="o">),</span>
    <span class="n">a</span><span class="o">,</span> <span class="n">b</span>
  <span class="o">);</span>
<span class="o">}</span></code></pre></figure><p>What do you think now? There are no statements or operators. No <code>if</code> and no <code>&gt;</code>. Instead, there are <strong>objects</strong> of class <code>If</code> and <code>GreaterThan</code>.</p><p>This is a pure and clean object-oriented approach.</p><p>However, Java doesn&#39;t have that. Java (and many other pseudo OOP languages) gives us operators like <code>if</code>, <code>else</code>, <code>switch</code>, <code>for</code>, <code>while</code>, etc. instead of giving built-in classes, which would do the same. Because of that, we continue to think in terms of procedures and keep talking about whether two <code>return</code> statements are better than one.</p><p>If your code is truly object-oriented, you won&#39;t be able to have more than one <code>return</code>. Moreover, you will have nothing except a <code>return</code> in each method. Actually, you will have only two operators in the entire software---<code>new</code> and <code>return</code>. That&#39;s it.</p><p>Until we&#39;re there, let&#39;s stick with just one <code>return</code> and at least try to look like pure <a href="/2016/08/15/what-is-wrong-object-oriented-programming.html">OOP</a>.</p></p><nav class="buttons notranslate desktop-only"> <a href="http://www.facebook.com/sharer/sharer.php?u=https://www.yegor256.com/2015/08/18/multiple-return-statements-in-oop.html" title="Share on Facebook" class="button" rel="nofollow"> <span class="count count-facebook">0</span> <i class="icon icon-facebook notranslate" aria-hidden="true"></i> </a> <a href="https://twitter.com/share?url=https://www.yegor256.com/2015/08/18/multiple-return-statements-in-oop.html&amp;text=Why+Many+Return+Statements+Are+a+Bad+Idea+in+OOP" title="Share on Twitter" class="button" rel="nofollow"> <span class="count count-twitter">0</span> <i class="icon icon-twitter notranslate" aria-hidden="true"></i> </a> <a href="https://plus.google.com/share?url=https://www.yegor256.com/2015/08/18/multiple-return-statements-in-oop.html" title="Share on Google+" class="button" rel="nofollow"> <span class="count count-googleplus">0</span> <i class="icon icon-googleplus notranslate" aria-hidden="true"></i> </a> <a href="https://www.linkedin.com/cws/share?url=https://www.yegor256.com/2015/08/18/multiple-return-statements-in-oop.html" title="Share on LinkedIn" class="button" rel="nofollow"> <span class="count count-linkedin">0</span> <i class="icon icon-linkedin notranslate" aria-hidden="true"></i> </a> <a href="http://reddit.com/submit?url=https://www.yegor256.com/2015/08/18/multiple-return-statements-in-oop.html%3F2015-33&amp;title=Why+Many+Return+Statements+Are+a+Bad+Idea+in+OOP" title="Share on Reddit" class="button" rel="nofollow"> <span class="count count-reddit">0</span> <i class="icon icon-reddit notranslate" aria-hidden="true"></i> </a> <a href="http://news.ycombinator.com/submitlink?u=https://www.yegor256.com/2015/08/18/multiple-return-statements-in-oop.html%3F2015-33&amp;t=Why+Many+Return+Statements+Are+a+Bad+Idea+in+OOP" title="Share on Hacker News" class="button" rel="nofollow"> <span class="count count-hackernews">0</span> <i class="icon icon-hackernews notranslate" aria-hidden="true"></i> </a> </nav> </header> <article class="main" itemprop="articleBody"><div ><p>This <a href="http://programmers.stackexchange.com/questions/118703">debate</a> is very old, but I have something to say too. The question is whether a method may have multiple <code>return</code> statements or always just one. The answer may surprise you: In a pure object-oriented world, a method <strong>must</strong> have a <strong>single</strong> <code>return</code> statement and <strong>nothing</strong> else. Yes, just a <code>return</code> statement and that&#39;s it. No other operators or statements. Just <code>return</code>. All arguments in favor of multiple <code>return</code> statements go against the very idea of object-oriented programming.</p><p>This is a classical example:</p><figure class="highlight"><pre><code class="language-java" data-lang="java"><span></span><span class="kd">public</span> <span class="kt">int</span> <span class="nf">max</span><span class="o">(</span><span class="kt">int</span> <span class="n">a</span><span class="o">,</span> <span class="kt">int</span> <span class="n">b</span><span class="o">)</span> <span class="o">{</span>
  <span class="k">if</span> <span class="o">(</span><span class="n">a</span> <span class="o">&gt;</span> <span class="n">b</span><span class="o">)</span> <span class="o">{</span>
    <span class="k">return</span> <span class="n">a</span><span class="o">;</span>
  <span class="o">}</span>
  <span class="k">return</span> <span class="n">b</span><span class="o">;</span>
<span class="o">}</span></code></pre></figure><p>The code above has two <code>return</code> statements, and it is shorter than this one with a single <code>return</code>:</p><figure class="highlight"><pre><code class="language-java" data-lang="java"><span></span><span class="kd">public</span> <span class="kt">int</span> <span class="nf">max</span><span class="o">(</span><span class="kt">int</span> <span class="n">a</span><span class="o">,</span> <span class="kt">int</span> <span class="n">b</span><span class="o">)</span> <span class="o">{</span>
  <span class="kt">int</span> <span class="n">m</span><span class="o">;</span>
  <span class="k">if</span> <span class="o">(</span><span class="n">a</span> <span class="o">&gt;</span> <span class="n">b</span><span class="o">)</span> <span class="o">{</span>
    <span class="n">m</span> <span class="o">=</span> <span class="n">a</span><span class="o">;</span>
  <span class="o">}</span> <span class="k">else</span> <span class="o">{</span>
    <span class="n">m</span> <span class="o">=</span> <span class="n">b</span><span class="o">;</span>
  <span class="o">}</span>
  <span class="k">return</span> <span class="n">m</span><span class="o">;</span>
<span class="o">}</span></code></pre></figure><p>More verbose, less readable, and slower, right? Right.</p><p>This is the code in a <strong>pure</strong> object-oriented world:</p><figure class="highlight"><pre><code class="language-java" data-lang="java"><span></span><span class="kd">public</span> <span class="kt">int</span> <span class="nf">max</span><span class="o">(</span><span class="kt">int</span> <span class="n">a</span><span class="o">,</span> <span class="kt">int</span> <span class="n">b</span><span class="o">)</span> <span class="o">{</span>
  <span class="k">return</span> <span class="k">new</span> <span class="n">If</span><span class="o">(</span>
    <span class="k">new</span> <span class="n">GreaterThan</span><span class="o">(</span><span class="n">a</span><span class="o">,</span> <span class="n">b</span><span class="o">),</span>
    <span class="n">a</span><span class="o">,</span> <span class="n">b</span>
  <span class="o">);</span>
<span class="o">}</span></code></pre></figure><p>What do you think now? There are no statements or operators. No <code>if</code> and no <code>&gt;</code>. Instead, there are <strong>objects</strong> of class <code>If</code> and <code>GreaterThan</code>.</p><p>This is a pure and clean object-oriented approach.</p><p>However, Java doesn&#39;t have that. Java (and many other pseudo OOP languages) gives us operators like <code>if</code>, <code>else</code>, <code>switch</code>, <code>for</code>, <code>while</code>, etc. instead of giving built-in classes, which would do the same. Because of that, we continue to think in terms of procedures and keep talking about whether two <code>return</code> statements are better than one.</p><p>If your code is truly object-oriented, you won&#39;t be able to have more than one <code>return</code>. Moreover, you will have nothing except a <code>return</code> in each method. Actually, you will have only two operators in the entire software---<code>new</code> and <code>return</code>. That&#39;s it.</p><p>Until we&#39;re there, let&#39;s stick with just one <code>return</code> and at least try to look like pure <a href="/2016/08/15/what-is-wrong-object-oriented-programming.html">OOP</a>.</p></div></article></div><div class="wrapper"> <related-posts /></div><div class="disqus" role="complementary"><p class="disqus_hint"> Please, use <a href="https://help.disqus.com/commenting/what-html-tags-are-allowed-within-comments">syntax highlighting</a> in your comments, to make them more readable.</p><div id="disqus_thread" class="disqus-thread"> <a>&nbsp;</a></div><script> var disqus_config = function () { this.page.url = document.location.href.split('?')[0].split('#')[0].replace('https://', 'http://'); this.page.identifier = this.page.url; }; (function() { var d = document, s = d.createElement('script'); s.src = '//yegor256.disqus.com/embed.js'; s.setAttribute('data-timestamp', +new Date()); (d.head || d.body).appendChild(s); })(); </script> <noscript><div><p class="red"> JavaScript is disabled in your browser, that's why you can't see comments under this post.</p></div></noscript></div><div class="wrapper"> <footer class="footer"><p> &copy; <span itemscope="" itemprop="copyrightHolder" itemtype="http://schema.org/Person"> <span itemprop="name">Yegor Bugayenko</span> </span> 2014&ndash;<span itemprop="copyrightYear">2018</span></p></footer></div></section><div class="wrapper unprintable" style="text-align:center;margin-top:2em;"> <a href="http://www.sixnines.io/h/3ba1652f"> <img src="//www.sixnines.io/b/3ba1652f?style=flat" alt="sixnines availability badge"/> </a></div><script src="//code.jquery.com/jquery-1.9.0.min.js"></script> <script src="/js/all.js?a0e0d018c07"></script> <script>var disqus_shortname = 'yegor256';</script> <script id="dsq-count-scr" src="//yegor256.disqus.com/count.js" async="async"></script> <script> (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){ (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o), m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m) })(window,document,'script','//www.google-analytics.com/analytics.js','ga'); ga('create', 'UA-1963507-32', 'auto'); ga('send', 'pageview'); </script> <script> Cd=document;Cr="&"+Math.random();Cp="&s=1"; Cd.cookie="b=b";if(Cd.cookie)Cp+="&c=1"; Cp+="&t="+(new Date()).getTimezoneOffset(); if(self!=top)Cp+="&f=1"; </script> <script> if(navigator.javaEnabled())Cp+="&j=1"; </script> <script> if(typeof(screen)!='undefined')Cp+="&w="+screen.width+"&h="+ screen.height+"&d="+(screen.colorDepth?screen.colorDepth:screen.pixelDepth); </script> <script> Cd.write("<img src='//c.hit.ua/hit?i=95870&g=0&x=2"+Cp+Cr+ "&r="+escape(Cd.referrer)+"&u="+escape(window.location.href)+ "' border='0' wi"+"dth='1' he"+"ight='1'/>"); </script> <script type="application/ld+json"> { "@context": "http://schema.org", "@type": "Person", "name": "Yegor Bugayenko", "url": "http://www.yegor256.com", "sameAs": [ "https://www.facebook.com/yegor256", "https://instagram.com/yegor256", "https://www.linkedin.com/in/yegor256", "https://twitter.com/yegor256", "https://github.com/yegor256", "https://www.pinterest.com/yegor256/" ] } </script> </body> </html> <!DOCTYPE html> <html xmlns="http://www.w3.org/1999/xhtml" lang="en-US" xml:lang="en-US" itemscope="" itemtype="http://schema.org/WebSite"> <head> <meta charset="utf-8"/> <meta name="description" content="While most programmers think checked exceptions in Java are a mistake, I&apos;m of the opposite opinion---unchecked ones are a mistake. " /> <meta name="keywords" content="checked vs unchecked exceptions, checked vs unchecked exceptions c#, checked vs unchecked exceptions debate, checked vs unchecked exceptions example, checked vs unchecked exceptions java" /> <meta name="viewport" content="width=device-width,minimum-scale=1,initial-scale=1"/> <meta name="google-site-verification" content="JEj_gQr2CPe2QKGw8XdMz0R7VboQIUbX3FlM-lwTq-8" /> <meta name="author" content="Yegor Bugayenko"> <meta name="article:published_time" content="2015-07-28 00:00:00 +0000"> <meta name="og:site_name" content="Yegor Bugayenko"/> <meta name="og:type" content="article" /> <meta name="og:locale" content="en_US" /> <meta name="twitter:account_id" content="4503599630178231" /> <meta name="twitter:creator" content="@yegor256"/> <meta name="twitter:site" content="@yegor256"/> <meta name="twitter:title" property="og:title" content="Checked vs. Unchecked Exceptions: The Debate Is Not Over"/> <meta name="twitter:description" property="og:description" content="While most programmers think checked exceptions in Java are a mistake, I&apos;m of the opposite opinion---unchecked ones are a mistake. "/> <meta name="twitter:url" property="og:url" content="https://www.yegor256.com/2015/07/28/checked-vs-unchecked-exceptions.html"/> <meta name="telegram:channel" content="AAAAAEJFMRzsRTRxM3ec6A"/> <link rel="search" type="application/opensearchdescription+xml" href="/opensearch.xml" title="yegor256" /> <link rel="shortcut icon" href="/favicon.ico?a0e0d018c07"/> <link rel="apple-touch-icon" href="/favicon.ico?a0e0d018c07"/> <link rel="alternate" type="application/rss+xml" title="RSS for yegor256.com" href="https://www.yegor256.com/rss.xml"/> <link rel="stylesheet" href="/css/layout.css?a0e0d018c07"/> <link rel="stylesheet" href="/css/icons.css?a0e0d018c07"/> <link rel="canonical" href="https://www.yegor256.com/2015/07/28/checked-vs-unchecked-exceptions.html" /> <link rel="amphtml" href="https://www.yegor256.com/2015/07/28/checked-vs-unchecked-exceptions.amp.html" /> <title>Checked vs. Unchecked Exceptions: The Debate Is Not Over </title> <meta name='og:image' content='https://www.yegor256.com/images/2015/07/true-romance.jpg'/><meta name='twitter:image' content='https://www.yegor256.com/images/2015/07/true-romance.jpg'/><meta name='og:image:width' content='1200'/> <meta name='twitter:image:width' content='1200'/><meta name='og:image:height' content='496'/> <meta name='twitter:image:height' content='496'/><meta name='twitter:card' content='summary_large_image'/><meta name='twitter:image:alt' content='True Romance (1993) by Tony Scott'/> </head> <body><div class="wrapper"> <aside class="header-toggle unprintable" id="header-toggle" title="Show the menu" onclick="$('#header').show();$('#header-toggle').hide();">&#9776;</aside> <header class="header" id="header"><div class="face"> <a href="/about-me.html#form" class="sub" title="Click to subscribe to my monthly newsletter"><span>Subscribe</span></a> <a href="/about-me.html" style="position:relative;"> <img src="/images/face-256x256.jpg" class="photo" alt="Yegor Bugayenko"/> </a></div><nav><ul class="menu social notranslate"> <li><a href="https://twitter.com/intent/follow?screen_name=yegor256" rel="nofollow" title="Follow me on Twitter"><i class="icon icon-twitter notranslate" aria-hidden="true"></i></a></li> <li><a href="/rss.xml" rel="nofollow" title="Subscribe to my RSS feed"><i class="icon icon-rss notranslate" aria-hidden="true"></i></a></li> <li><a itemprop="sameAs" href="https://github.com/yegor256" rel="nofollow" title="My GitHub profile"><i class="icon icon-github notranslate" aria-hidden="true"></i></a></li> <li><a itemprop="sameAs" href="http://stackoverflow.com/users/187141/yegor256" rel="nofollow" title="My StackOverflow profile"><i class="icon icon-stackoverflow notranslate" aria-hidden="true"></i></a></li> <li><a itemprop="sameAs" href="https://www.facebook.com/yegor256" rel="nofollow" title="Follow me on Facebook"><i class="icon icon-facebook notranslate" aria-hidden="true"></i></a></li> <li><a itemprop="sameAs" href="https://instagram.com/yegor256" rel="nofollow" title="Follow me on Instagram"><i class="icon icon-instagram notranslate" aria-hidden="true"></i></a></li> <li><a itemprop="sameAs" href="https://www.linkedin.com/in/yegor256" rel="nofollow" title="My LinkedIn profile"><i class="icon icon-linkedin notranslate" aria-hidden="true"></i></a></li> <li><a itemprop="sameAs" href="https://www.youtube.com/c/yegor256?sub_confirmation=1" rel="nofollow" title="My Youtube video channel"><i class="icon icon-youtube notranslate" aria-hidden="true"></i></a></li> <li><a itemprop="sameAs" href="https://www.pinterest.com/yegor256/" rel="nofollow" title="My Pinterest boards"><i class="icon icon-pinterest notranslate" aria-hidden="true"></i></a></li> <li><a itemprop="sameAs" href="https://angel.co/yegor256" rel="nofollow" title="My AngelList profile"><i class="icon icon-angellist notranslate" aria-hidden="true"></i></a></li> <li><a href="https://soundcloud.com/yegor256" rel="nofollow" title="My podcast"><i class="icon icon-podcast notranslate" aria-hidden="true"></i></a></li> <li><a href="https://itunes.apple.com/us/podcast/yegor256-podcast/id1150826721" rel="nofollow" title="My iTunes podcast"><i class="icon icon-itunes notranslate" aria-hidden="true"></i></a></li> <li><a href="https://t.me/joinchat/AAAAAEJFMRzsRTRxM3ec6A" rel="nofollow" title="My Telegram public channel"><i class="icon icon-telegram notranslate" aria-hidden="true"></i></a></li> <li><a href="mailto:blog@yegor256.com" rel="nofollow" title="Email me any time"><i class="icon icon-mail notranslate" aria-hidden="true"></i></a></li></ul><ul class="menu"> <li><a href="/" title="Home page">Home</a></li> <li ><a href="/best.html" title="Best articles to read">12&#160;Best</a></li> <li ><a href="/contents.html" title="The contents of the entire blog">All&#160;288</a></li> <li ><a href="/webinars.html" title="My webinars">Webinars</a></li> <li ><a href="/talks.html" title="Future and past conference talks">Talks</a></li> <li ><a href="/books.html" title="The books I wrote">Books</a></li> <li ><a href="/papers.html" title="My academic papers and patents">Papers</a></li> <li ><a href="/pets.html" title="My loved pet projects">Pets</a></li> <li ><a href="/award.html" title="Software quality award">Award</a></li> <li ><a href="/testimonials.html" title="What some people say about me">Testimonials</a></li> <li ><a href="/shift-m.html" title="Audio podcast about project management">Shift-M</a></li> <li ><a href="/paintings.html" title="My paintings for sale">Paintings</a></li> <li><a href="http://ru.yegor256.com/" title="Немного на русском языке">По-русски</a></li></ul></nav><div class="search"> <form method="get" action="https://www.google.com/search" itemprop="potentialAction" itemscope="" itemtype="http://schema.org/SearchAction"> <meta itemprop="target" content="https://www.google.com/search?q={q}"/> <input name="sitesearch" value="yegor256.com" type="hidden"/> <input itemprop="query-input" type="text" id="search-query" class="field field-text" required="required" onfocus="$('.google').css('visibility', 'visible');" name="q" placeholder="Search..." autocomplete="off"/> <input type="image" src="/images/google-search-icon.svg" class="google" title="Search via Google" alt="Search via Google"/> </form></div><div class="hot"><ul> <li> <a href="/code-ahead.html">Code Ahead</a> was published on Amazon just a few days ago! It is my new book, a novel about programmers. It explains in details the majority of ideas that stand behind <a href="https://www.zerocracy.com">Zerocracy</a> and <a href="https://www.xdsd.org">XDSD</a>. </li> <li> At <a href="/webinars.html">Webinar #37</a> we will discuss naming problem in OOP, for objects, methods and attributes; join us on <b>September 12</b>, at 11am PST. </li></ul></div></header></div><section itemscope="" itemtype="http://schema.org/BlogPosting"><div class="wrapper"> <header><p class="printable"> <img src="https://api.qrserver.com/v1/create-qr-code/?data=https://www.yegor256.com/2015/07/28/checked-vs-unchecked-exceptions.html&amp;format=svg" style="width:125px;height:125px;" alt="QR code"/></p><p class="printable"> <code itemprop="url">https://www.yegor256.com/2015/07/28/checked-vs-unchecked-exceptions.html</code></p><h1 itemprop="name headline mainEntityOfPage">Checked vs. Unchecked Exceptions: The Debate Is Not Over</h1><aside class='book'><a href='http://amzn.to/2qFt4Tn'><img src='/images/books/elegant-objects/cover.png' class='book-cover' alt='book cover'/></a>Read more about this subject in <a href='http://amzn.to/2qFt4Tn'>Section&nbsp;4.2</a><br/> of my book<a href='http://amzn.to/2qFt4Tn'><img src='/images/books/amazon-buy-button.png' class='amazon-button' alt='Click to buy'/></a></aside><ul class="subline"> <li> <time itemprop="datePublished" datetime="2015-07-28T00:00:00+00:00"> 28 July 2015 </time> </li> <li class="desktop-only" itemprop="locationCreated">Sunnyvale, CA</li> <li class="printable" itemscope="" itemprop="author" itemtype="http://schema.org/Person"> <span itemprop="name">Yegor Bugayenko</span> </li> <li class="unprintable"> <i class="icon icon-comments"></i> <a href="http://www.yegor256.com/2015/07/28/checked-vs-unchecked-exceptions.html#disqus_thread" itemprop="discussionUrl">comments</a> </li></ul><p class="unprintable"><p>Do we need checked exceptions at all? The <a href="http://stackoverflow.com/questions/6115896/java-checked-vs-unchecked-exception-explanation">debate</a> is over, isn&#39;t it? Not for me. While most object-oriented languages don&#39;t have them, and most programmers think checked exceptions are a Java mistake, I believe in the opposite---unchecked exceptions are the <strong>mistake</strong>. Moreover, I believe multiple exception types are a bad idea too.</p><figure class='jb_picture'><img itemprop='image' alt='True Romance (1993) by Tony Scott' src='/images/2015/07/true-romance.jpg' longdesc='#443dfa82'/><figcaption id='443dfa82'>True Romance (1993) by Tony Scott</figcaption></figure><p>Let me first explain how I understand exceptions in object-oriented programming. Then I&#39;ll compare my understanding with a &quot;traditional&quot; approach, and we&#39;ll discuss the differences. So, my understanding first.</p><p>Say there is a method that saves some binary data to a file:</p><figure class="highlight"><pre><code class="language-java" data-lang="java"><span></span><span class="kd">public</span> <span class="kt">void</span> <span class="nf">save</span><span class="o">(</span><span class="n">File</span> <span class="n">file</span><span class="o">,</span> <span class="kt">byte</span><span class="o">[]</span> <span class="n">data</span><span class="o">)</span>
  <span class="kd">throws</span> <span class="n">Exception</span> <span class="o">{</span>
  <span class="c1">// save data to the file</span>
<span class="o">}</span></code></pre></figure><p>When everything goes right, the method just saves the data and returns control. When something is wrong, it <a href="/2015/12/01/rethrow-exceptions.html">throws</a> <code>Exception</code> and we have to do something about it:</p><figure class="highlight"><pre><code class="language-java" data-lang="java"><span></span><span class="k">try</span> <span class="o">{</span>
  <span class="n">save</span><span class="o">(</span><span class="n">file</span><span class="o">,</span> <span class="n">data</span><span class="o">);</span>
<span class="o">}</span> <span class="k">catch</span> <span class="o">(</span><span class="n">Exception</span> <span class="n">ex</span><span class="o">)</span> <span class="o">{</span>
  <span class="n">System</span><span class="o">.</span><span class="na">out</span><span class="o">.</span><span class="na">println</span><span class="o">(</span><span class="s">&quot;Sorry, we can&#39;t save right now.&quot;</span><span class="o">);</span>
<span class="o">}</span></code></pre></figure><p>When a method says it <code>throws</code> an exception, I understand that the method is not <strong>safe</strong>. It may fail sometimes, and it&#39;s my responsibility to either 1) handle this failure or 2) declare myself as <strong>unsafe</strong> too.</p><p>I know each method is designed with a <a href="https://en.wikipedia.org/wiki/Single_responsibility_principle">single responsibility principle</a> in mind. This is a guarantee to me that if method <code>save()</code> fails, it means the entire saving operation can&#39;t be completed. If I need to know what the cause of this failure was, I will <a href="https://en.wikipedia.org/wiki/Exception_chaining">un-chain</a> the exception---traverse the stack of chained exceptions and stack traces encapsulated in <code>ex</code>.</p><p>I never use exceptions for flow control, which means I <strong>never recover</strong> situations where exceptions are thrown. When an exception occurs, I let it float up to the highest level of the application. Sometimes I <a href="/2015/12/01/rethrow-exceptions.html">rethrow</a> it in order to add more semantic information to the chain. That&#39;s why it doesn&#39;t matter to me what the cause of the exception thrown by <code>save()</code> was. I just know the method failed. That&#39;s enough for me. Always.</p><p>For the same reason, I don&#39;t need to differentiate between different exception types. I just don&#39;t need that type of hierarchy. <code>Exception</code> is enough for me. Again, that&#39;s because I don&#39;t use exceptions for flow control.</p><p>That&#39;s how I understand exceptions.</p><p>According to this paradigm, I would say we must:</p><ul> <li><p>always use checked exceptions.</p></li> <li><p>never throw/use unchecked exceptions.</p></li> <li><p>use only <code>Exception</code>, without any sub-types.</p></li> <li><p>always declare one exception type in the <code>throws</code> block.</p></li> <li><p>never catch without rethrowing; read <a href="/2015/07/09/catch-if-cant-otherwise.html">more about that here</a>.</p></li></ul><p>This paradigm diverges from many other articles I&#39;ve found on this subject. Let&#39;s compare and discuss.</p><h2 id="runtime-vs-api-exceptions">Runtime vs. API Exceptions</h2><p><a href="http://docs.oracle.com/javase/tutorial/essential/exceptions/runtime.html">Oracle says</a> some exceptions should be part of API (checked ones) while some are runtime exceptions and should not be part of it (unchecked). They will be documented in JavaDoc but not in the method signature.</p><p>I don&#39;t understand the logic here, and I&#39;m sure Java designers don&#39;t understand it either. How and why are some exceptions important while others are not? Why do some of them deserve a proper API position in the <code>throws</code> block of the method signature while others don&#39;t? What is the criteria?</p><p>I have an answer here, though. By introducing checked and unchecked exceptions, Java developers tried to solve the problem of methods that are too complex and messy. When a method is too big and does too many things at the same time (violates the single responsibility principle), it&#39;s definitely better to let us keep some exceptions &quot;hidden&quot; (a.k.a. unchecked). But it&#39;s not a real solution. It is only a temporary patch that does all of us more harm than good---methods keep growing in size and complexity.</p><p>Unchecked exceptions are a mistake in Java design, not <a href="/2015/10/20/interrupted-exception.html">checked</a> ones.</p><p>Hiding the fact that a method may fail at some point is a mistake. That&#39;s exactly what unchecked exceptions do.</p><p>Instead, we should make this fact visible. When a method does too many things, there will be too many points of failure, and the author of the method will realize that something is wrong---a method should not throw exceptions in so many situations. This will lead to refactoring. The existence of unchecked exceptions leads to a mess. By the way, checked exceptions don&#39;t exist at all in Ruby, C#, Python, PHP, etc. This means that creators of these languages understand <a href="/2016/08/15/what-is-wrong-object-oriented-programming.html">OOP</a> even less than Java authors.</p><h2 id="checked-exceptions-are-too-noisy">Checked Exceptions Are Too Noisy</h2><p>Another common argument against checked exceptions is that they make our code more verbose. We have to put <code>try/catch</code> everywhere instead of staying focused on the main logic. Bozhidar Bozhanov even <a href="http://techblog.bozho.net/checked-and-unchecked-exceptions-in-java/">suggests</a> a technical solution for this verbosity problem.</p><p>Again, I don&#39;t understand this logic. If I want to do something when method <code>save()</code> fails, I catch the exception and handle the situation somehow. If I don&#39;t want to do that, I just say my method also <code>throws</code> and pay no attention to exception handling. What is the problem? Where is the verbosity coming from?</p><p>I have an answer here, too. It&#39;s coming from the existence of unchecked exceptions. We simply can&#39;t always ignore failure, because the interfaces we&#39;re using don&#39;t allow us to do this. That&#39;s all. For example, class <a href="http://docs.oracle.com/javase/7/docs/api/java/lang/Runnable.html"><code>Runnable</code></a>, which is widely used for multi-thread programming, has method <code>run()</code> that is not supposed to throw anything. That&#39;s why we always have to catch everything inside the method and rethrow checked exceptions as unchecked.</p><p>If all methods in all Java <a href="/2016/04/26/why-inputstream-design-is-wrong.html">interfaces</a> would be declared either as &quot;safe&quot; (<code>throws</code> nothing) or &quot;unsafe&quot; (<code>throws Exception</code>), everything would become logical and clear. If you want to stay &quot;safe,&quot; take responsibility for failure handling. Otherwise, be &quot;unsafe&quot; and let your users worry about safety.</p><p>No noise, very clean code, and obvious logic.</p><h2 id="inappropriately-exposed-implementation-details">Inappropriately Exposed Implementation Details</h2><p><a href="http://www.ibm.com/developerworks/library/j-jtp05254/">Some say</a> the ability to put a checked exception into <code>throws</code> in the method signature instead of catching it here and rethrowing a new type encourages us to have too many irrelevant exception types in method signatures. For example, our method <code>save()</code> may declare that it may throw <code>OutOfMemoryException</code>, even though it seems to have nothing to do with memory allocation. But it does allocate some memory, right? So such a memory overflow may happen during a file saving operation.</p><p>Yet again, I don&#39;t get the logic of this argument. If all exceptions are checked, and we don&#39;t have multiple exception types, we just throw <code>Exception</code> everywhere, and that&#39;s it. Why do we need to care about the exception type in the first place? If we don&#39;t use exceptions to control flow, we won&#39;t do this.</p><p>If we really want to make our application memory overflow-resistant, we will introduce some memory manager, which will have something like the <code>bigEnough()</code> method, which will tell us whether our heap is big enough for the next operation. Using exceptions in such situations is a totally inappropriate approach to exception management in OOP.</p><h2 id="recoverable-exceptions">Recoverable Exceptions</h2><p>Joshua Bloch, in <a href="http://amzn.to/2crH5tW">Effective Java</a>, says to &quot;use checked exceptions for recoverable conditions and runtime exceptions for programming errors.&quot; He means something like this:</p><figure class="highlight"><pre><code class="language-java" data-lang="java"><span></span><span class="k">try</span> <span class="o">{</span>
  <span class="n">save</span><span class="o">(</span><span class="n">file</span><span class="o">,</span> <span class="n">data</span><span class="o">);</span>
<span class="o">}</span> <span class="k">catch</span> <span class="o">(</span><span class="n">Exception</span> <span class="n">ex</span><span class="o">)</span> <span class="o">{</span>
  <span class="c1">// We can&#39;t save the file, but it&#39;s OK</span>
  <span class="c1">// Let&#39;s move on and do something else</span>
<span class="o">}</span></code></pre></figure><p>How is that any different from a famous anti-pattern called <a href="http://c2.com/cgi/wiki?DontUseExceptionsForFlowControl">Don&#39;t Use Exceptions for Flow Control</a>? Joshua, with all due respect, you&#39;re wrong. There are no such things as recoverable conditions in OOP. An exception indicates that the execution of a chain of calls from method to method is broken, and it&#39;s time to go up through the chain and stop somewhere. But we never go back again after the exception:</p><figure class="highlight"><pre><code class="language-text" data-lang="text"><span></span>App#run()
  Data#update()
    Data#write()
      File#save() &lt;-- Boom, there&#39;s a failure here, so we go up</code></pre></figure><p>We can start this chain again, but we don&#39;t go back after <code>throw</code>. In other words, we don&#39;t <strong>do</strong> anything in the <code>catch</code> block. We only report the problem and wrap up execution. We never &quot;recover!&quot;</p><hr/><p>All arguments against checked exceptions demonstrate nothing but a serious misunderstanding of object-oriented programming by their authors. The mistake in Java and in many other languages is the existence of unchecked exceptions, not checked ones.</p></p><nav class="buttons notranslate desktop-only"> <a href="http://www.facebook.com/sharer/sharer.php?u=https://www.yegor256.com/2015/07/28/checked-vs-unchecked-exceptions.html" title="Share on Facebook" class="button" rel="nofollow"> <span class="count count-facebook">0</span> <i class="icon icon-facebook notranslate" aria-hidden="true"></i> </a> <a href="https://twitter.com/share?url=https://www.yegor256.com/2015/07/28/checked-vs-unchecked-exceptions.html&amp;text=Checked+vs.+Unchecked+Exceptions%3A+The+Debate+Is+Not+Over" title="Share on Twitter" class="button" rel="nofollow"> <span class="count count-twitter">0</span> <i class="icon icon-twitter notranslate" aria-hidden="true"></i> </a> <a href="https://plus.google.com/share?url=https://www.yegor256.com/2015/07/28/checked-vs-unchecked-exceptions.html" title="Share on Google+" class="button" rel="nofollow"> <span class="count count-googleplus">0</span> <i class="icon icon-googleplus notranslate" aria-hidden="true"></i> </a> <a href="https://www.linkedin.com/cws/share?url=https://www.yegor256.com/2015/07/28/checked-vs-unchecked-exceptions.html" title="Share on LinkedIn" class="button" rel="nofollow"> <span class="count count-linkedin">0</span> <i class="icon icon-linkedin notranslate" aria-hidden="true"></i> </a> <a href="http://reddit.com/submit?url=https://www.yegor256.com/2015/07/28/checked-vs-unchecked-exceptions.html%3F2015-30&amp;title=Checked+vs.+Unchecked+Exceptions%3A+The+Debate+Is+Not+Over" title="Share on Reddit" class="button" rel="nofollow"> <span class="count count-reddit">0</span> <i class="icon icon-reddit notranslate" aria-hidden="true"></i> </a> <a href="http://news.ycombinator.com/submitlink?u=https://www.yegor256.com/2015/07/28/checked-vs-unchecked-exceptions.html%3F2015-30&amp;t=Checked+vs.+Unchecked+Exceptions%3A+The+Debate+Is+Not+Over" title="Share on Hacker News" class="button" rel="nofollow"> <span class="count count-hackernews">0</span> <i class="icon icon-hackernews notranslate" aria-hidden="true"></i> </a> </nav> </header> <article class="main" itemprop="articleBody"><div ><p>Do we need checked exceptions at all? The <a href="http://stackoverflow.com/questions/6115896/java-checked-vs-unchecked-exception-explanation">debate</a> is over, isn&#39;t it? Not for me. While most object-oriented languages don&#39;t have them, and most programmers think checked exceptions are a Java mistake, I believe in the opposite---unchecked exceptions are the <strong>mistake</strong>. Moreover, I believe multiple exception types are a bad idea too.</p><figure class='jb_picture'><img itemprop='image' alt='True Romance (1993) by Tony Scott' src='/images/2015/07/true-romance.jpg' longdesc='#443dfa82'/><figcaption id='443dfa82'>True Romance (1993) by Tony Scott</figcaption></figure><p>Let me first explain how I understand exceptions in object-oriented programming. Then I&#39;ll compare my understanding with a &quot;traditional&quot; approach, and we&#39;ll discuss the differences. So, my understanding first.</p><p>Say there is a method that saves some binary data to a file:</p><figure class="highlight"><pre><code class="language-java" data-lang="java"><span></span><span class="kd">public</span> <span class="kt">void</span> <span class="nf">save</span><span class="o">(</span><span class="n">File</span> <span class="n">file</span><span class="o">,</span> <span class="kt">byte</span><span class="o">[]</span> <span class="n">data</span><span class="o">)</span>
  <span class="kd">throws</span> <span class="n">Exception</span> <span class="o">{</span>
  <span class="c1">// save data to the file</span>
<span class="o">}</span></code></pre></figure><p>When everything goes right, the method just saves the data and returns control. When something is wrong, it <a href="/2015/12/01/rethrow-exceptions.html">throws</a> <code>Exception</code> and we have to do something about it:</p><figure class="highlight"><pre><code class="language-java" data-lang="java"><span></span><span class="k">try</span> <span class="o">{</span>
  <span class="n">save</span><span class="o">(</span><span class="n">file</span><span class="o">,</span> <span class="n">data</span><span class="o">);</span>
<span class="o">}</span> <span class="k">catch</span> <span class="o">(</span><span class="n">Exception</span> <span class="n">ex</span><span class="o">)</span> <span class="o">{</span>
  <span class="n">System</span><span class="o">.</span><span class="na">out</span><span class="o">.</span><span class="na">println</span><span class="o">(</span><span class="s">&quot;Sorry, we can&#39;t save right now.&quot;</span><span class="o">);</span>
<span class="o">}</span></code></pre></figure><p>When a method says it <code>throws</code> an exception, I understand that the method is not <strong>safe</strong>. It may fail sometimes, and it&#39;s my responsibility to either 1) handle this failure or 2) declare myself as <strong>unsafe</strong> too.</p><p>I know each method is designed with a <a href="https://en.wikipedia.org/wiki/Single_responsibility_principle">single responsibility principle</a> in mind. This is a guarantee to me that if method <code>save()</code> fails, it means the entire saving operation can&#39;t be completed. If I need to know what the cause of this failure was, I will <a href="https://en.wikipedia.org/wiki/Exception_chaining">un-chain</a> the exception---traverse the stack of chained exceptions and stack traces encapsulated in <code>ex</code>.</p><p>I never use exceptions for flow control, which means I <strong>never recover</strong> situations where exceptions are thrown. When an exception occurs, I let it float up to the highest level of the application. Sometimes I <a href="/2015/12/01/rethrow-exceptions.html">rethrow</a> it in order to add more semantic information to the chain. That&#39;s why it doesn&#39;t matter to me what the cause of the exception thrown by <code>save()</code> was. I just know the method failed. That&#39;s enough for me. Always.</p><p>For the same reason, I don&#39;t need to differentiate between different exception types. I just don&#39;t need that type of hierarchy. <code>Exception</code> is enough for me. Again, that&#39;s because I don&#39;t use exceptions for flow control.</p><p>That&#39;s how I understand exceptions.</p><p>According to this paradigm, I would say we must:</p><ul> <li><p>always use checked exceptions.</p></li> <li><p>never throw/use unchecked exceptions.</p></li> <li><p>use only <code>Exception</code>, without any sub-types.</p></li> <li><p>always declare one exception type in the <code>throws</code> block.</p></li> <li><p>never catch without rethrowing; read <a href="/2015/07/09/catch-if-cant-otherwise.html">more about that here</a>.</p></li></ul><p>This paradigm diverges from many other articles I&#39;ve found on this subject. Let&#39;s compare and discuss.</p><h2 id="runtime-vs-api-exceptions">Runtime vs. API Exceptions</h2><p><a href="http://docs.oracle.com/javase/tutorial/essential/exceptions/runtime.html">Oracle says</a> some exceptions should be part of API (checked ones) while some are runtime exceptions and should not be part of it (unchecked). They will be documented in JavaDoc but not in the method signature.</p><p>I don&#39;t understand the logic here, and I&#39;m sure Java designers don&#39;t understand it either. How and why are some exceptions important while others are not? Why do some of them deserve a proper API position in the <code>throws</code> block of the method signature while others don&#39;t? What is the criteria?</p><p>I have an answer here, though. By introducing checked and unchecked exceptions, Java developers tried to solve the problem of methods that are too complex and messy. When a method is too big and does too many things at the same time (violates the single responsibility principle), it&#39;s definitely better to let us keep some exceptions &quot;hidden&quot; (a.k.a. unchecked). But it&#39;s not a real solution. It is only a temporary patch that does all of us more harm than good---methods keep growing in size and complexity.</p><p>Unchecked exceptions are a mistake in Java design, not <a href="/2015/10/20/interrupted-exception.html">checked</a> ones.</p><p>Hiding the fact that a method may fail at some point is a mistake. That&#39;s exactly what unchecked exceptions do.</p><p>Instead, we should make this fact visible. When a method does too many things, there will be too many points of failure, and the author of the method will realize that something is wrong---a method should not throw exceptions in so many situations. This will lead to refactoring. The existence of unchecked exceptions leads to a mess. By the way, checked exceptions don&#39;t exist at all in Ruby, C#, Python, PHP, etc. This means that creators of these languages understand <a href="/2016/08/15/what-is-wrong-object-oriented-programming.html">OOP</a> even less than Java authors.</p><h2 id="checked-exceptions-are-too-noisy">Checked Exceptions Are Too Noisy</h2><p>Another common argument against checked exceptions is that they make our code more verbose. We have to put <code>try/catch</code> everywhere instead of staying focused on the main logic. Bozhidar Bozhanov even <a href="http://techblog.bozho.net/checked-and-unchecked-exceptions-in-java/">suggests</a> a technical solution for this verbosity problem.</p><p>Again, I don&#39;t understand this logic. If I want to do something when method <code>save()</code> fails, I catch the exception and handle the situation somehow. If I don&#39;t want to do that, I just say my method also <code>throws</code> and pay no attention to exception handling. What is the problem? Where is the verbosity coming from?</p><p>I have an answer here, too. It&#39;s coming from the existence of unchecked exceptions. We simply can&#39;t always ignore failure, because the interfaces we&#39;re using don&#39;t allow us to do this. That&#39;s all. For example, class <a href="http://docs.oracle.com/javase/7/docs/api/java/lang/Runnable.html"><code>Runnable</code></a>, which is widely used for multi-thread programming, has method <code>run()</code> that is not supposed to throw anything. That&#39;s why we always have to catch everything inside the method and rethrow checked exceptions as unchecked.</p><p>If all methods in all Java <a href="/2016/04/26/why-inputstream-design-is-wrong.html">interfaces</a> would be declared either as &quot;safe&quot; (<code>throws</code> nothing) or &quot;unsafe&quot; (<code>throws Exception</code>), everything would become logical and clear. If you want to stay &quot;safe,&quot; take responsibility for failure handling. Otherwise, be &quot;unsafe&quot; and let your users worry about safety.</p><p>No noise, very clean code, and obvious logic.</p><h2 id="inappropriately-exposed-implementation-details">Inappropriately Exposed Implementation Details</h2><p><a href="http://www.ibm.com/developerworks/library/j-jtp05254/">Some say</a> the ability to put a checked exception into <code>throws</code> in the method signature instead of catching it here and rethrowing a new type encourages us to have too many irrelevant exception types in method signatures. For example, our method <code>save()</code> may declare that it may throw <code>OutOfMemoryException</code>, even though it seems to have nothing to do with memory allocation. But it does allocate some memory, right? So such a memory overflow may happen during a file saving operation.</p><p>Yet again, I don&#39;t get the logic of this argument. If all exceptions are checked, and we don&#39;t have multiple exception types, we just throw <code>Exception</code> everywhere, and that&#39;s it. Why do we need to care about the exception type in the first place? If we don&#39;t use exceptions to control flow, we won&#39;t do this.</p><p>If we really want to make our application memory overflow-resistant, we will introduce some memory manager, which will have something like the <code>bigEnough()</code> method, which will tell us whether our heap is big enough for the next operation. Using exceptions in such situations is a totally inappropriate approach to exception management in OOP.</p><h2 id="recoverable-exceptions">Recoverable Exceptions</h2><p>Joshua Bloch, in <a href="http://amzn.to/2crH5tW">Effective Java</a>, says to &quot;use checked exceptions for recoverable conditions and runtime exceptions for programming errors.&quot; He means something like this:</p><figure class="highlight"><pre><code class="language-java" data-lang="java"><span></span><span class="k">try</span> <span class="o">{</span>
  <span class="n">save</span><span class="o">(</span><span class="n">file</span><span class="o">,</span> <span class="n">data</span><span class="o">);</span>
<span class="o">}</span> <span class="k">catch</span> <span class="o">(</span><span class="n">Exception</span> <span class="n">ex</span><span class="o">)</span> <span class="o">{</span>
  <span class="c1">// We can&#39;t save the file, but it&#39;s OK</span>
  <span class="c1">// Let&#39;s move on and do something else</span>
<span class="o">}</span></code></pre></figure><p>How is that any different from a famous anti-pattern called <a href="http://c2.com/cgi/wiki?DontUseExceptionsForFlowControl">Don&#39;t Use Exceptions for Flow Control</a>? Joshua, with all due respect, you&#39;re wrong. There are no such things as recoverable conditions in OOP. An exception indicates that the execution of a chain of calls from method to method is broken, and it&#39;s time to go up through the chain and stop somewhere. But we never go back again after the exception:</p><figure class="highlight"><pre><code class="language-text" data-lang="text"><span></span>App#run()
  Data#update()
    Data#write()
      File#save() &lt;-- Boom, there&#39;s a failure here, so we go up</code></pre></figure><p>We can start this chain again, but we don&#39;t go back after <code>throw</code>. In other words, we don&#39;t <strong>do</strong> anything in the <code>catch</code> block. We only report the problem and wrap up execution. We never &quot;recover!&quot;</p><hr/><p>All arguments against checked exceptions demonstrate nothing but a serious misunderstanding of object-oriented programming by their authors. The mistake in Java and in many other languages is the existence of unchecked exceptions, not checked ones.</p></div></article></div><div class="wrapper"> <related-posts /></div><div class="disqus" role="complementary"><p class="disqus_hint"> Please, use <a href="https://help.disqus.com/commenting/what-html-tags-are-allowed-within-comments">syntax highlighting</a> in your comments, to make them more readable.</p><div id="disqus_thread" class="disqus-thread"> <a>&nbsp;</a></div><script> var disqus_config = function () { this.page.url = document.location.href.split('?')[0].split('#')[0].replace('https://', 'http://'); this.page.identifier = this.page.url; }; (function() { var d = document, s = d.createElement('script'); s.src = '//yegor256.disqus.com/embed.js'; s.setAttribute('data-timestamp', +new Date()); (d.head || d.body).appendChild(s); })(); </script> <noscript><div><p class="red"> JavaScript is disabled in your browser, that's why you can't see comments under this post.</p></div></noscript></div><div class="wrapper"> <footer class="footer"><p> &copy; <span itemscope="" itemprop="copyrightHolder" itemtype="http://schema.org/Person"> <span itemprop="name">Yegor Bugayenko</span> </span> 2014&ndash;<span itemprop="copyrightYear">2018</span></p></footer></div></section><div class="wrapper unprintable" style="text-align:center;margin-top:2em;"> <a href="http://www.sixnines.io/h/3ba1652f"> <img src="//www.sixnines.io/b/3ba1652f?style=flat" alt="sixnines availability badge"/> </a></div><script src="//code.jquery.com/jquery-1.9.0.min.js"></script> <script src="/js/all.js?a0e0d018c07"></script> <script>var disqus_shortname = 'yegor256';</script> <script id="dsq-count-scr" src="//yegor256.disqus.com/count.js" async="async"></script> <script> (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){ (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o), m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m) })(window,document,'script','//www.google-analytics.com/analytics.js','ga'); ga('create', 'UA-1963507-32', 'auto'); ga('send', 'pageview'); </script> <script> Cd=document;Cr="&"+Math.random();Cp="&s=1"; Cd.cookie="b=b";if(Cd.cookie)Cp+="&c=1"; Cp+="&t="+(new Date()).getTimezoneOffset(); if(self!=top)Cp+="&f=1"; </script> <script> if(navigator.javaEnabled())Cp+="&j=1"; </script> <script> if(typeof(screen)!='undefined')Cp+="&w="+screen.width+"&h="+ screen.height+"&d="+(screen.colorDepth?screen.colorDepth:screen.pixelDepth); </script> <script> Cd.write("<img src='//c.hit.ua/hit?i=95870&g=0&x=2"+Cp+Cr+ "&r="+escape(Cd.referrer)+"&u="+escape(window.location.href)+ "' border='0' wi"+"dth='1' he"+"ight='1'/>"); </script> <script type="application/ld+json"> { "@context": "http://schema.org", "@type": "Person", "name": "Yegor Bugayenko", "url": "http://www.yegor256.com", "sameAs": [ "https://www.facebook.com/yegor256", "https://instagram.com/yegor256", "https://www.linkedin.com/in/yegor256", "https://twitter.com/yegor256", "https://github.com/yegor256", "https://www.pinterest.com/yegor256/" ] } </script> </body> </html> <!DOCTYPE html> <html xmlns="http://www.w3.org/1999/xhtml" lang="en-US" xml:lang="en-US" itemscope="" itemtype="http://schema.org/WebSite"> <head> <meta charset="utf-8"/> <meta name="description" content="Catching an exception must be your last resort; a properly designed application would catch exceptions in one place only. " /> <meta name="keywords" content="catch exception, catch exception java, exception catching, exceptions java, when to catch exceptions" /> <meta name="viewport" content="width=device-width,minimum-scale=1,initial-scale=1"/> <meta name="google-site-verification" content="JEj_gQr2CPe2QKGw8XdMz0R7VboQIUbX3FlM-lwTq-8" /> <meta name="author" content="Yegor Bugayenko"> <meta name="article:published_time" content="2015-07-09 00:00:00 +0000"> <meta name="og:site_name" content="Yegor Bugayenko"/> <meta name="og:type" content="article" /> <meta name="og:locale" content="en_US" /> <meta name="twitter:account_id" content="4503599630178231" /> <meta name="twitter:creator" content="@yegor256"/> <meta name="twitter:site" content="@yegor256"/> <meta name="twitter:title" property="og:title" content="Catch Me If You ... Can't Do Otherwise"/> <meta name="twitter:description" property="og:description" content="Catching an exception must be your last resort; a properly designed application would catch exceptions in one place only. "/> <meta name="twitter:url" property="og:url" content="https://www.yegor256.com/2015/07/09/catch-if-cant-otherwise.html"/> <meta name="telegram:channel" content="AAAAAEJFMRzsRTRxM3ec6A"/> <link rel="search" type="application/opensearchdescription+xml" href="/opensearch.xml" title="yegor256" /> <link rel="shortcut icon" href="/favicon.ico?a0e0d018c07"/> <link rel="apple-touch-icon" href="/favicon.ico?a0e0d018c07"/> <link rel="alternate" type="application/rss+xml" title="RSS for yegor256.com" href="https://www.yegor256.com/rss.xml"/> <link rel="stylesheet" href="/css/layout.css?a0e0d018c07"/> <link rel="stylesheet" href="/css/icons.css?a0e0d018c07"/> <link rel="canonical" href="https://www.yegor256.com/2015/07/09/catch-if-cant-otherwise.html" /> <link rel="amphtml" href="https://www.yegor256.com/2015/07/09/catch-if-cant-otherwise.amp.html" /> <title>Catch Me If You ... Can't Do Otherwise </title> <meta name='og:image' content='https://www.yegor256.com/images/2015/07/catch-me-if-you-can.jpg'/><meta name='twitter:image' content='https://www.yegor256.com/images/2015/07/catch-me-if-you-can.jpg'/><meta name='og:image:width' content='1200'/> <meta name='twitter:image:width' content='1200'/><meta name='og:image:height' content='716'/> <meta name='twitter:image:height' content='716'/><meta name='twitter:card' content='summary_large_image'/><meta name='twitter:image:alt' content='Catch Me If You Can (2002) by Steven Spielberg'/> </head> <body><div class="wrapper"> <aside class="header-toggle unprintable" id="header-toggle" title="Show the menu" onclick="$('#header').show();$('#header-toggle').hide();">&#9776;</aside> <header class="header" id="header"><div class="face"> <a href="/about-me.html#form" class="sub" title="Click to subscribe to my monthly newsletter"><span>Subscribe</span></a> <a href="/about-me.html" style="position:relative;"> <img src="/images/face-256x256.jpg" class="photo" alt="Yegor Bugayenko"/> </a></div><nav><ul class="menu social notranslate"> <li><a href="https://twitter.com/intent/follow?screen_name=yegor256" rel="nofollow" title="Follow me on Twitter"><i class="icon icon-twitter notranslate" aria-hidden="true"></i></a></li> <li><a href="/rss.xml" rel="nofollow" title="Subscribe to my RSS feed"><i class="icon icon-rss notranslate" aria-hidden="true"></i></a></li> <li><a itemprop="sameAs" href="https://github.com/yegor256" rel="nofollow" title="My GitHub profile"><i class="icon icon-github notranslate" aria-hidden="true"></i></a></li> <li><a itemprop="sameAs" href="http://stackoverflow.com/users/187141/yegor256" rel="nofollow" title="My StackOverflow profile"><i class="icon icon-stackoverflow notranslate" aria-hidden="true"></i></a></li> <li><a itemprop="sameAs" href="https://www.facebook.com/yegor256" rel="nofollow" title="Follow me on Facebook"><i class="icon icon-facebook notranslate" aria-hidden="true"></i></a></li> <li><a itemprop="sameAs" href="https://instagram.com/yegor256" rel="nofollow" title="Follow me on Instagram"><i class="icon icon-instagram notranslate" aria-hidden="true"></i></a></li> <li><a itemprop="sameAs" href="https://www.linkedin.com/in/yegor256" rel="nofollow" title="My LinkedIn profile"><i class="icon icon-linkedin notranslate" aria-hidden="true"></i></a></li> <li><a itemprop="sameAs" href="https://www.youtube.com/c/yegor256?sub_confirmation=1" rel="nofollow" title="My Youtube video channel"><i class="icon icon-youtube notranslate" aria-hidden="true"></i></a></li> <li><a itemprop="sameAs" href="https://www.pinterest.com/yegor256/" rel="nofollow" title="My Pinterest boards"><i class="icon icon-pinterest notranslate" aria-hidden="true"></i></a></li> <li><a itemprop="sameAs" href="https://angel.co/yegor256" rel="nofollow" title="My AngelList profile"><i class="icon icon-angellist notranslate" aria-hidden="true"></i></a></li> <li><a href="https://soundcloud.com/yegor256" rel="nofollow" title="My podcast"><i class="icon icon-podcast notranslate" aria-hidden="true"></i></a></li> <li><a href="https://itunes.apple.com/us/podcast/yegor256-podcast/id1150826721" rel="nofollow" title="My iTunes podcast"><i class="icon icon-itunes notranslate" aria-hidden="true"></i></a></li> <li><a href="https://t.me/joinchat/AAAAAEJFMRzsRTRxM3ec6A" rel="nofollow" title="My Telegram public channel"><i class="icon icon-telegram notranslate" aria-hidden="true"></i></a></li> <li><a href="mailto:blog@yegor256.com" rel="nofollow" title="Email me any time"><i class="icon icon-mail notranslate" aria-hidden="true"></i></a></li></ul><ul class="menu"> <li><a href="/" title="Home page">Home</a></li> <li ><a href="/best.html" title="Best articles to read">12&#160;Best</a></li> <li ><a href="/contents.html" title="The contents of the entire blog">All&#160;288</a></li> <li ><a href="/webinars.html" title="My webinars">Webinars</a></li> <li ><a href="/talks.html" title="Future and past conference talks">Talks</a></li> <li ><a href="/books.html" title="The books I wrote">Books</a></li> <li ><a href="/papers.html" title="My academic papers and patents">Papers</a></li> <li ><a href="/pets.html" title="My loved pet projects">Pets</a></li> <li ><a href="/award.html" title="Software quality award">Award</a></li> <li ><a href="/testimonials.html" title="What some people say about me">Testimonials</a></li> <li ><a href="/shift-m.html" title="Audio podcast about project management">Shift-M</a></li> <li ><a href="/paintings.html" title="My paintings for sale">Paintings</a></li> <li><a href="http://ru.yegor256.com/" title="Немного на русском языке">По-русски</a></li></ul></nav><div class="search"> <form method="get" action="https://www.google.com/search" itemprop="potentialAction" itemscope="" itemtype="http://schema.org/SearchAction"> <meta itemprop="target" content="https://www.google.com/search?q={q}"/> <input name="sitesearch" value="yegor256.com" type="hidden"/> <input itemprop="query-input" type="text" id="search-query" class="field field-text" required="required" onfocus="$('.google').css('visibility', 'visible');" name="q" placeholder="Search..." autocomplete="off"/> <input type="image" src="/images/google-search-icon.svg" class="google" title="Search via Google" alt="Search via Google"/> </form></div><div class="hot"><ul> <li> <a href="/code-ahead.html">Code Ahead</a> was published on Amazon just a few days ago! It is my new book, a novel about programmers. It explains in details the majority of ideas that stand behind <a href="https://www.zerocracy.com">Zerocracy</a> and <a href="https://www.xdsd.org">XDSD</a>. </li> <li> At <a href="/webinars.html">Webinar #37</a> we will discuss naming problem in OOP, for objects, methods and attributes; join us on <b>September 12</b>, at 11am PST. </li></ul></div></header></div><section itemscope="" itemtype="http://schema.org/BlogPosting"><div class="wrapper"> <header><p class="printable"> <img src="https://api.qrserver.com/v1/create-qr-code/?data=https://www.yegor256.com/2015/07/09/catch-if-cant-otherwise.html&amp;format=svg" style="width:125px;height:125px;" alt="QR code"/></p><p class="printable"> <code itemprop="url">https://www.yegor256.com/2015/07/09/catch-if-cant-otherwise.html</code></p><h1 itemprop="name headline mainEntityOfPage">Catch Me If You ... Can't Do Otherwise</h1><ul class="subline"> <li> <time itemprop="datePublished" datetime="2015-07-09T00:00:00+00:00"> 9 July 2015 </time> </li> <li class="desktop-only" itemprop="locationCreated">Dallas, TX</li> <li class="printable" itemscope="" itemprop="author" itemtype="http://schema.org/Person"> <span itemprop="name">Yegor Bugayenko</span> </li> <li class="unprintable"> <i class="icon icon-comments"></i> <a href="http://www.yegor256.com/2015/07/09/catch-if-cant-otherwise.html#disqus_thread" itemprop="discussionUrl">comments</a> </li></ul><p class="unprintable"><p>I don&#39;t know whether it&#39;s an anti-pattern or just a common and very popular mistake, but I see it everywhere and simply must write about it. I&#39;m talking about <strong>exception catching without <a href="/2015/12/01/rethrow-exceptions.html">re-throwing</a></strong>. I&#39;m talking about something like this Java code:</p><figure class="highlight"><pre><code class="language-java" data-lang="java"><span></span><span class="k">try</span> <span class="o">{</span>
  <span class="n">stream</span><span class="o">.</span><span class="na">write</span><span class="o">(</span><span class="n">data</span><span class="o">);</span>
<span class="o">}</span> <span class="k">catch</span> <span class="o">(</span><span class="n">IOException</span> <span class="n">ex</span><span class="o">)</span> <span class="o">{</span>
  <span class="n">ex</span><span class="o">.</span><span class="na">printStackTrace</span><span class="o">();</span>
<span class="o">}</span></code></pre></figure> <figure class='jb_picture'><img itemprop='image' alt='Catch Me If You Can (2002) by Steven Spielberg' src='/images/2015/07/catch-me-if-you-can.jpg' longdesc='#6fa1eb03'/><figcaption id='6fa1eb03'>Catch Me If You Can (2002) by Steven Spielberg</figcaption></figure><p>Pay attention: I don&#39;t have anything against this code:</p><figure class="highlight"><pre><code class="language-java" data-lang="java"><span></span><span class="k">try</span> <span class="o">{</span>
  <span class="n">stream</span><span class="o">.</span><span class="na">write</span><span class="o">(</span><span class="sc">&#39;X&#39;</span><span class="o">);</span>
<span class="o">}</span> <span class="k">catch</span> <span class="o">(</span><span class="n">IOException</span> <span class="n">ex</span><span class="o">)</span> <span class="o">{</span>
  <span class="k">throw</span> <span class="k">new</span> <span class="n">IllegalStateException</span><span class="o">(</span><span class="n">ex</span><span class="o">);</span>
<span class="o">}</span></code></pre></figure><p>This is called <a href="https://en.wikipedia.org/wiki/Exception_chaining"><em>exception chaining</em></a> and is a perfectly valid construct.</p><p>So what is wrong with catching an exception and logging it? Let&#39;s try to look at the bigger picture first. We&#39;re talking about object-oriented programming---this means we&#39;re dealing with objects. Here is how an object (its class, to be exact) would look:</p><figure class="highlight"><pre><code class="language-java" data-lang="java"><span></span><span class="kd">final</span> <span class="kd">class</span> <span class="nc">Wire</span> <span class="o">{</span>
  <span class="kd">private</span> <span class="kd">final</span> <span class="n">OutputStream</span> <span class="n">stream</span><span class="o">;</span>
  <span class="n">Wire</span><span class="o">(</span><span class="kd">final</span> <span class="n">OutputStream</span> <span class="n">stm</span><span class="o">)</span> <span class="o">{</span>
    <span class="k">this</span><span class="o">.</span><span class="na">stream</span> <span class="o">=</span> <span class="n">stm</span><span class="o">;</span>
  <span class="o">}</span>
  <span class="kd">public</span> <span class="kt">void</span> <span class="nf">send</span><span class="o">(</span><span class="kd">final</span> <span class="kt">int</span> <span class="n">data</span><span class="o">)</span> <span class="o">{</span>
    <span class="k">try</span> <span class="o">{</span>
      <span class="k">this</span><span class="o">.</span><span class="na">stream</span><span class="o">.</span><span class="na">write</span><span class="o">(</span><span class="n">x</span><span class="o">);</span>
    <span class="o">}</span> <span class="k">catch</span> <span class="o">(</span><span class="n">IOException</span> <span class="n">ex</span><span class="o">)</span> <span class="o">{</span>
      <span class="n">ex</span><span class="o">.</span><span class="na">printStackTrace</span><span class="o">();</span>
    <span class="o">}</span>
  <span class="o">}</span>
<span class="o">}</span></code></pre></figure><p>Here is how I&#39;m using this class:</p><figure class="highlight"><pre><code class="language-java" data-lang="java"><span></span><span class="k">new</span> <span class="n">Wire</span><span class="o">(</span><span class="n">stream</span><span class="o">).</span><span class="na">send</span><span class="o">(</span><span class="mi">1</span><span class="o">);</span></code></pre></figure><p>Looks nice, right? I don&#39;t need to worry about that <code>IOException</code> when I&#39;m calling <code>send(1)</code>. It will be handled internally, and if it occurs, the stacktrace will be logged. But this is a totally wrong way of thinking, and it&#39;s inherited from languages without exceptions, like C.</p><aside class='quote'>An exception collects as much information as possible about the error and floats it up</aside><p>Exceptions were invented to simplify our design by moving the entire error handling code away from the main logic. Moreover, we&#39;re not just moving it away but also concentrating it in one place---in the <code>main()</code> method, the entry point of the entire app.</p><p>The primary purpose of an exception is to collect as much information as possible about the error and float it up to the highest level, where the user is capable of doing something about it. Exception chaining helps even further by allowing us to extend that information on its way up. We are basically putting our bubble (the exception) into a bigger bubble every time we catch it and <a href="/2015/12/01/rethrow-exceptions.html">re-throw</a>. When it hits the surface, there are many bubbles, each remaining inside another like a Russian doll. The original exception is the smallest bubble.</p><p>When you catch an exception without re-throwing it, you basically pop the bubble. Everything inside it, including the original exception and all other bubbles with the information inside them, are in your hands. You don&#39;t let me see them. You use them somehow, but I don&#39;t know how. You&#39;re doing something behind the scenes, hiding potentially important information.</p><p>If you&#39;re hiding that from me, I can&#39;t promise my user that I will be honest with him and openly report a problem when it occurs. I simply can&#39;t trust your <code>send()</code> method anymore, and my user will not trust me.</p><p>By catching exceptions without re-throwing them, you&#39;re basically breaking the chain of trust between objects.</p><p>My suggestion is to catch exceptions as seldom as possible, and every time you catch them, <a href="/2015/12/01/rethrow-exceptions.html">re-throw</a>.</p><p>Unfortunately, the design of Java goes against this principle in many places. For example, Java has checked and un-checked exceptions, while there should only be checked ones in my opinion (the ones you must catch or declare as throwable). Also, Java allows multiple exception types to be declared as throwable in a single method---yet another mistake; stick to declaring just one type. Also, there is a generic <code>Exception</code> class at the top of the hierarchy, which is also wrong in my opinion. Besides that, some built-in classes don&#39;t allow any checked exceptions to be thrown, like <code>Runnable.run()</code>. There are many other problems with exceptions in Java.</p><p>But try to keep this principle in mind and your code will be cleaner: <code>catch</code> only if you have no other choice.</p><p>P.S. Here is how the class should look:</p><figure class="highlight"><pre><code class="language-java" data-lang="java"><span></span><span class="kd">final</span> <span class="kd">class</span> <span class="nc">Wire</span> <span class="o">{</span>
  <span class="kd">private</span> <span class="kd">final</span> <span class="n">OutputStream</span> <span class="n">stream</span><span class="o">;</span>
  <span class="n">Wire</span><span class="o">(</span><span class="kd">final</span> <span class="n">OutputStream</span> <span class="n">stm</span><span class="o">)</span> <span class="o">{</span>
    <span class="k">this</span><span class="o">.</span><span class="na">stream</span> <span class="o">=</span> <span class="n">stm</span><span class="o">;</span>
  <span class="o">}</span>
  <span class="kd">public</span> <span class="kt">void</span> <span class="nf">send</span><span class="o">(</span><span class="kd">final</span> <span class="kt">int</span> <span class="n">data</span><span class="o">)</span>
    <span class="kd">throws</span> <span class="n">IOException</span> <span class="o">{</span>
    <span class="k">this</span><span class="o">.</span><span class="na">stream</span><span class="o">.</span><span class="na">write</span><span class="o">(</span><span class="n">x</span><span class="o">);</span>
  <span class="o">}</span>
<span class="o">}</span></code></pre></figure></p><nav class="buttons notranslate desktop-only"> <a href="http://www.facebook.com/sharer/sharer.php?u=https://www.yegor256.com/2015/07/09/catch-if-cant-otherwise.html" title="Share on Facebook" class="button" rel="nofollow"> <span class="count count-facebook">0</span> <i class="icon icon-facebook notranslate" aria-hidden="true"></i> </a> <a href="https://twitter.com/share?url=https://www.yegor256.com/2015/07/09/catch-if-cant-otherwise.html&amp;text=Catch+Me+If+You+...+Can%27t+Do+Otherwise" title="Share on Twitter" class="button" rel="nofollow"> <span class="count count-twitter">0</span> <i class="icon icon-twitter notranslate" aria-hidden="true"></i> </a> <a href="https://plus.google.com/share?url=https://www.yegor256.com/2015/07/09/catch-if-cant-otherwise.html" title="Share on Google+" class="button" rel="nofollow"> <span class="count count-googleplus">0</span> <i class="icon icon-googleplus notranslate" aria-hidden="true"></i> </a> <a href="https://www.linkedin.com/cws/share?url=https://www.yegor256.com/2015/07/09/catch-if-cant-otherwise.html" title="Share on LinkedIn" class="button" rel="nofollow"> <span class="count count-linkedin">0</span> <i class="icon icon-linkedin notranslate" aria-hidden="true"></i> </a> <a href="http://reddit.com/submit?url=https://www.yegor256.com/2015/07/09/catch-if-cant-otherwise.html%3F2015-27&amp;title=Catch+Me+If+You+...+Can%27t+Do+Otherwise" title="Share on Reddit" class="button" rel="nofollow"> <span class="count count-reddit">0</span> <i class="icon icon-reddit notranslate" aria-hidden="true"></i> </a> <a href="http://news.ycombinator.com/submitlink?u=https://www.yegor256.com/2015/07/09/catch-if-cant-otherwise.html%3F2015-27&amp;t=Catch+Me+If+You+...+Can%27t+Do+Otherwise" title="Share on Hacker News" class="button" rel="nofollow"> <span class="count count-hackernews">0</span> <i class="icon icon-hackernews notranslate" aria-hidden="true"></i> </a> </nav> </header> <article class="main" itemprop="articleBody"><div ><p>I don&#39;t know whether it&#39;s an anti-pattern or just a common and very popular mistake, but I see it everywhere and simply must write about it. I&#39;m talking about <strong>exception catching without <a href="/2015/12/01/rethrow-exceptions.html">re-throwing</a></strong>. I&#39;m talking about something like this Java code:</p><figure class="highlight"><pre><code class="language-java" data-lang="java"><span></span><span class="k">try</span> <span class="o">{</span>
  <span class="n">stream</span><span class="o">.</span><span class="na">write</span><span class="o">(</span><span class="n">data</span><span class="o">);</span>
<span class="o">}</span> <span class="k">catch</span> <span class="o">(</span><span class="n">IOException</span> <span class="n">ex</span><span class="o">)</span> <span class="o">{</span>
  <span class="n">ex</span><span class="o">.</span><span class="na">printStackTrace</span><span class="o">();</span>
<span class="o">}</span></code></pre></figure> <figure class='jb_picture'><img itemprop='image' alt='Catch Me If You Can (2002) by Steven Spielberg' src='/images/2015/07/catch-me-if-you-can.jpg' longdesc='#6fa1eb03'/><figcaption id='6fa1eb03'>Catch Me If You Can (2002) by Steven Spielberg</figcaption></figure><p>Pay attention: I don&#39;t have anything against this code:</p><figure class="highlight"><pre><code class="language-java" data-lang="java"><span></span><span class="k">try</span> <span class="o">{</span>
  <span class="n">stream</span><span class="o">.</span><span class="na">write</span><span class="o">(</span><span class="sc">&#39;X&#39;</span><span class="o">);</span>
<span class="o">}</span> <span class="k">catch</span> <span class="o">(</span><span class="n">IOException</span> <span class="n">ex</span><span class="o">)</span> <span class="o">{</span>
  <span class="k">throw</span> <span class="k">new</span> <span class="n">IllegalStateException</span><span class="o">(</span><span class="n">ex</span><span class="o">);</span>
<span class="o">}</span></code></pre></figure><p>This is called <a href="https://en.wikipedia.org/wiki/Exception_chaining"><em>exception chaining</em></a> and is a perfectly valid construct.</p><p>So what is wrong with catching an exception and logging it? Let&#39;s try to look at the bigger picture first. We&#39;re talking about object-oriented programming---this means we&#39;re dealing with objects. Here is how an object (its class, to be exact) would look:</p><figure class="highlight"><pre><code class="language-java" data-lang="java"><span></span><span class="kd">final</span> <span class="kd">class</span> <span class="nc">Wire</span> <span class="o">{</span>
  <span class="kd">private</span> <span class="kd">final</span> <span class="n">OutputStream</span> <span class="n">stream</span><span class="o">;</span>
  <span class="n">Wire</span><span class="o">(</span><span class="kd">final</span> <span class="n">OutputStream</span> <span class="n">stm</span><span class="o">)</span> <span class="o">{</span>
    <span class="k">this</span><span class="o">.</span><span class="na">stream</span> <span class="o">=</span> <span class="n">stm</span><span class="o">;</span>
  <span class="o">}</span>
  <span class="kd">public</span> <span class="kt">void</span> <span class="nf">send</span><span class="o">(</span><span class="kd">final</span> <span class="kt">int</span> <span class="n">data</span><span class="o">)</span> <span class="o">{</span>
    <span class="k">try</span> <span class="o">{</span>
      <span class="k">this</span><span class="o">.</span><span class="na">stream</span><span class="o">.</span><span class="na">write</span><span class="o">(</span><span class="n">x</span><span class="o">);</span>
    <span class="o">}</span> <span class="k">catch</span> <span class="o">(</span><span class="n">IOException</span> <span class="n">ex</span><span class="o">)</span> <span class="o">{</span>
      <span class="n">ex</span><span class="o">.</span><span class="na">printStackTrace</span><span class="o">();</span>
    <span class="o">}</span>
  <span class="o">}</span>
<span class="o">}</span></code></pre></figure><p>Here is how I&#39;m using this class:</p><figure class="highlight"><pre><code class="language-java" data-lang="java"><span></span><span class="k">new</span> <span class="n">Wire</span><span class="o">(</span><span class="n">stream</span><span class="o">).</span><span class="na">send</span><span class="o">(</span><span class="mi">1</span><span class="o">);</span></code></pre></figure><p>Looks nice, right? I don&#39;t need to worry about that <code>IOException</code> when I&#39;m calling <code>send(1)</code>. It will be handled internally, and if it occurs, the stacktrace will be logged. But this is a totally wrong way of thinking, and it&#39;s inherited from languages without exceptions, like C.</p><aside class='quote'>An exception collects as much information as possible about the error and floats it up</aside><p>Exceptions were invented to simplify our design by moving the entire error handling code away from the main logic. Moreover, we&#39;re not just moving it away but also concentrating it in one place---in the <code>main()</code> method, the entry point of the entire app.</p><p>The primary purpose of an exception is to collect as much information as possible about the error and float it up to the highest level, where the user is capable of doing something about it. Exception chaining helps even further by allowing us to extend that information on its way up. We are basically putting our bubble (the exception) into a bigger bubble every time we catch it and <a href="/2015/12/01/rethrow-exceptions.html">re-throw</a>. When it hits the surface, there are many bubbles, each remaining inside another like a Russian doll. The original exception is the smallest bubble.</p><p>When you catch an exception without re-throwing it, you basically pop the bubble. Everything inside it, including the original exception and all other bubbles with the information inside them, are in your hands. You don&#39;t let me see them. You use them somehow, but I don&#39;t know how. You&#39;re doing something behind the scenes, hiding potentially important information.</p><p>If you&#39;re hiding that from me, I can&#39;t promise my user that I will be honest with him and openly report a problem when it occurs. I simply can&#39;t trust your <code>send()</code> method anymore, and my user will not trust me.</p><p>By catching exceptions without re-throwing them, you&#39;re basically breaking the chain of trust between objects.</p><p>My suggestion is to catch exceptions as seldom as possible, and every time you catch them, <a href="/2015/12/01/rethrow-exceptions.html">re-throw</a>.</p><p>Unfortunately, the design of Java goes against this principle in many places. For example, Java has checked and un-checked exceptions, while there should only be checked ones in my opinion (the ones you must catch or declare as throwable). Also, Java allows multiple exception types to be declared as throwable in a single method---yet another mistake; stick to declaring just one type. Also, there is a generic <code>Exception</code> class at the top of the hierarchy, which is also wrong in my opinion. Besides that, some built-in classes don&#39;t allow any checked exceptions to be thrown, like <code>Runnable.run()</code>. There are many other problems with exceptions in Java.</p><p>But try to keep this principle in mind and your code will be cleaner: <code>catch</code> only if you have no other choice.</p><p>P.S. Here is how the class should look:</p><figure class="highlight"><pre><code class="language-java" data-lang="java"><span></span><span class="kd">final</span> <span class="kd">class</span> <span class="nc">Wire</span> <span class="o">{</span>
  <span class="kd">private</span> <span class="kd">final</span> <span class="n">OutputStream</span> <span class="n">stream</span><span class="o">;</span>
  <span class="n">Wire</span><span class="o">(</span><span class="kd">final</span> <span class="n">OutputStream</span> <span class="n">stm</span><span class="o">)</span> <span class="o">{</span>
    <span class="k">this</span><span class="o">.</span><span class="na">stream</span> <span class="o">=</span> <span class="n">stm</span><span class="o">;</span>
  <span class="o">}</span>
  <span class="kd">public</span> <span class="kt">void</span> <span class="nf">send</span><span class="o">(</span><span class="kd">final</span> <span class="kt">int</span> <span class="n">data</span><span class="o">)</span>
    <span class="kd">throws</span> <span class="n">IOException</span> <span class="o">{</span>
    <span class="k">this</span><span class="o">.</span><span class="na">stream</span><span class="o">.</span><span class="na">write</span><span class="o">(</span><span class="n">x</span><span class="o">);</span>
  <span class="o">}</span>
<span class="o">}</span></code></pre></figure></div></article></div><div class="wrapper"> <related-posts /></div><div class="disqus" role="complementary"><p class="disqus_hint"> Please, use <a href="https://help.disqus.com/commenting/what-html-tags-are-allowed-within-comments">syntax highlighting</a> in your comments, to make them more readable.</p><div id="disqus_thread" class="disqus-thread"> <a>&nbsp;</a></div><script> var disqus_config = function () { this.page.url = document.location.href.split('?')[0].split('#')[0].replace('https://', 'http://'); this.page.identifier = this.page.url; }; (function() { var d = document, s = d.createElement('script'); s.src = '//yegor256.disqus.com/embed.js'; s.setAttribute('data-timestamp', +new Date()); (d.head || d.body).appendChild(s); })(); </script> <noscript><div><p class="red"> JavaScript is disabled in your browser, that's why you can't see comments under this post.</p></div></noscript></div><div class="wrapper"> <footer class="footer"><p> &copy; <span itemscope="" itemprop="copyrightHolder" itemtype="http://schema.org/Person"> <span itemprop="name">Yegor Bugayenko</span> </span> 2014&ndash;<span itemprop="copyrightYear">2018</span></p></footer></div></section><div class="wrapper unprintable" style="text-align:center;margin-top:2em;"> <a href="http://www.sixnines.io/h/3ba1652f"> <img src="//www.sixnines.io/b/3ba1652f?style=flat" alt="sixnines availability badge"/> </a></div><script src="//code.jquery.com/jquery-1.9.0.min.js"></script> <script src="/js/all.js?a0e0d018c07"></script> <script>var disqus_shortname = 'yegor256';</script> <script id="dsq-count-scr" src="//yegor256.disqus.com/count.js" async="async"></script> <script> (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){ (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o), m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m) })(window,document,'script','//www.google-analytics.com/analytics.js','ga'); ga('create', 'UA-1963507-32', 'auto'); ga('send', 'pageview'); </script> <script> Cd=document;Cr="&"+Math.random();Cp="&s=1"; Cd.cookie="b=b";if(Cd.cookie)Cp+="&c=1"; Cp+="&t="+(new Date()).getTimezoneOffset(); if(self!=top)Cp+="&f=1"; </script> <script> if(navigator.javaEnabled())Cp+="&j=1"; </script> <script> if(typeof(screen)!='undefined')Cp+="&w="+screen.width+"&h="+ screen.height+"&d="+(screen.colorDepth?screen.colorDepth:screen.pixelDepth); </script> <script> Cd.write("<img src='//c.hit.ua/hit?i=95870&g=0&x=2"+Cp+Cr+ "&r="+escape(Cd.referrer)+"&u="+escape(window.location.href)+ "' border='0' wi"+"dth='1' he"+"ight='1'/>"); </script> <script type="application/ld+json"> { "@context": "http://schema.org", "@type": "Person", "name": "Yegor Bugayenko", "url": "http://www.yegor256.com", "sameAs": [ "https://www.facebook.com/yegor256", "https://instagram.com/yegor256", "https://www.linkedin.com/in/yegor256", "https://twitter.com/yegor256", "https://github.com/yegor256", "https://www.pinterest.com/yegor256/" ] } </script> </body> </html> <!DOCTYPE html> <html xmlns="http://www.w3.org/1999/xhtml" lang="en-US" xml:lang="en-US" itemscope="" itemtype="http://schema.org/WebSite"> <head> <meta charset="utf-8"/> <meta name="description" content="It&apos;s a common practice to make constants public in order to avoid duplication, but it&apos;s a bad practice, so use objects instead. " /> <meta name="keywords" content="public static, public static java, public static literals, static constants java, static literals java" /> <meta name="viewport" content="width=device-width,minimum-scale=1,initial-scale=1"/> <meta name="google-site-verification" content="JEj_gQr2CPe2QKGw8XdMz0R7VboQIUbX3FlM-lwTq-8" /> <meta name="author" content="Yegor Bugayenko"> <meta name="article:published_time" content="2015-07-06 00:00:00 +0000"> <meta name="og:site_name" content="Yegor Bugayenko"/> <meta name="og:type" content="article" /> <meta name="og:locale" content="en_US" /> <meta name="twitter:account_id" content="4503599630178231" /> <meta name="twitter:creator" content="@yegor256"/> <meta name="twitter:site" content="@yegor256"/> <meta name="twitter:title" property="og:title" content="Public Static Literals ... Are Not a Solution for Data Duplication"/> <meta name="twitter:description" property="og:description" content="It&apos;s a common practice to make constants public in order to avoid duplication, but it&apos;s a bad practice, so use objects instead. "/> <meta name="twitter:url" property="og:url" content="https://www.yegor256.com/2015/07/06/public-static-literals.html"/> <meta name="telegram:channel" content="AAAAAEJFMRzsRTRxM3ec6A"/> <link rel="search" type="application/opensearchdescription+xml" href="/opensearch.xml" title="yegor256" /> <link rel="shortcut icon" href="/favicon.ico?a0e0d018c07"/> <link rel="apple-touch-icon" href="/favicon.ico?a0e0d018c07"/> <link rel="alternate" type="application/rss+xml" title="RSS for yegor256.com" href="https://www.yegor256.com/rss.xml"/> <link rel="stylesheet" href="/css/layout.css?a0e0d018c07"/> <link rel="stylesheet" href="/css/icons.css?a0e0d018c07"/> <link rel="canonical" href="https://www.yegor256.com/2015/07/06/public-static-literals.html" /> <link rel="amphtml" href="https://www.yegor256.com/2015/07/06/public-static-literals.amp.html" /> <title>Public Static Literals ... Are Not a Solution for Data Duplication </title> <meta name='og:image' content='https://www.yegor256.com/images/2015/07/the-shining.jpg'/><meta name='twitter:image' content='https://www.yegor256.com/images/2015/07/the-shining.jpg'/><meta name='og:image:width' content='1200'/> <meta name='twitter:image:width' content='1200'/><meta name='og:image:height' content='600'/> <meta name='twitter:image:height' content='600'/><meta name='twitter:card' content='summary_large_image'/><meta name='twitter:image:alt' content='The Shining (1980) by Stanley Kubrick'/> </head> <body><div class="wrapper"> <aside class="header-toggle unprintable" id="header-toggle" title="Show the menu" onclick="$('#header').show();$('#header-toggle').hide();">&#9776;</aside> <header class="header" id="header"><div class="face"> <a href="/about-me.html#form" class="sub" title="Click to subscribe to my monthly newsletter"><span>Subscribe</span></a> <a href="/about-me.html" style="position:relative;"> <img src="/images/face-256x256.jpg" class="photo" alt="Yegor Bugayenko"/> </a></div><nav><ul class="menu social notranslate"> <li><a href="https://twitter.com/intent/follow?screen_name=yegor256" rel="nofollow" title="Follow me on Twitter"><i class="icon icon-twitter notranslate" aria-hidden="true"></i></a></li> <li><a href="/rss.xml" rel="nofollow" title="Subscribe to my RSS feed"><i class="icon icon-rss notranslate" aria-hidden="true"></i></a></li> <li><a itemprop="sameAs" href="https://github.com/yegor256" rel="nofollow" title="My GitHub profile"><i class="icon icon-github notranslate" aria-hidden="true"></i></a></li> <li><a itemprop="sameAs" href="http://stackoverflow.com/users/187141/yegor256" rel="nofollow" title="My StackOverflow profile"><i class="icon icon-stackoverflow notranslate" aria-hidden="true"></i></a></li> <li><a itemprop="sameAs" href="https://www.facebook.com/yegor256" rel="nofollow" title="Follow me on Facebook"><i class="icon icon-facebook notranslate" aria-hidden="true"></i></a></li> <li><a itemprop="sameAs" href="https://instagram.com/yegor256" rel="nofollow" title="Follow me on Instagram"><i class="icon icon-instagram notranslate" aria-hidden="true"></i></a></li> <li><a itemprop="sameAs" href="https://www.linkedin.com/in/yegor256" rel="nofollow" title="My LinkedIn profile"><i class="icon icon-linkedin notranslate" aria-hidden="true"></i></a></li> <li><a itemprop="sameAs" href="https://www.youtube.com/c/yegor256?sub_confirmation=1" rel="nofollow" title="My Youtube video channel"><i class="icon icon-youtube notranslate" aria-hidden="true"></i></a></li> <li><a itemprop="sameAs" href="https://www.pinterest.com/yegor256/" rel="nofollow" title="My Pinterest boards"><i class="icon icon-pinterest notranslate" aria-hidden="true"></i></a></li> <li><a itemprop="sameAs" href="https://angel.co/yegor256" rel="nofollow" title="My AngelList profile"><i class="icon icon-angellist notranslate" aria-hidden="true"></i></a></li> <li><a href="https://soundcloud.com/yegor256" rel="nofollow" title="My podcast"><i class="icon icon-podcast notranslate" aria-hidden="true"></i></a></li> <li><a href="https://itunes.apple.com/us/podcast/yegor256-podcast/id1150826721" rel="nofollow" title="My iTunes podcast"><i class="icon icon-itunes notranslate" aria-hidden="true"></i></a></li> <li><a href="https://t.me/joinchat/AAAAAEJFMRzsRTRxM3ec6A" rel="nofollow" title="My Telegram public channel"><i class="icon icon-telegram notranslate" aria-hidden="true"></i></a></li> <li><a href="mailto:blog@yegor256.com" rel="nofollow" title="Email me any time"><i class="icon icon-mail notranslate" aria-hidden="true"></i></a></li></ul><ul class="menu"> <li><a href="/" title="Home page">Home</a></li> <li ><a href="/best.html" title="Best articles to read">12&#160;Best</a></li> <li ><a href="/contents.html" title="The contents of the entire blog">All&#160;288</a></li> <li ><a href="/webinars.html" title="My webinars">Webinars</a></li> <li ><a href="/talks.html" title="Future and past conference talks">Talks</a></li> <li ><a href="/books.html" title="The books I wrote">Books</a></li> <li ><a href="/papers.html" title="My academic papers and patents">Papers</a></li> <li ><a href="/pets.html" title="My loved pet projects">Pets</a></li> <li ><a href="/award.html" title="Software quality award">Award</a></li> <li ><a href="/testimonials.html" title="What some people say about me">Testimonials</a></li> <li ><a href="/shift-m.html" title="Audio podcast about project management">Shift-M</a></li> <li ><a href="/paintings.html" title="My paintings for sale">Paintings</a></li> <li><a href="http://ru.yegor256.com/" title="Немного на русском языке">По-русски</a></li></ul></nav><div class="search"> <form method="get" action="https://www.google.com/search" itemprop="potentialAction" itemscope="" itemtype="http://schema.org/SearchAction"> <meta itemprop="target" content="https://www.google.com/search?q={q}"/> <input name="sitesearch" value="yegor256.com" type="hidden"/> <input itemprop="query-input" type="text" id="search-query" class="field field-text" required="required" onfocus="$('.google').css('visibility', 'visible');" name="q" placeholder="Search..." autocomplete="off"/> <input type="image" src="/images/google-search-icon.svg" class="google" title="Search via Google" alt="Search via Google"/> </form></div><div class="hot"><ul> <li> <a href="/code-ahead.html">Code Ahead</a> was published on Amazon just a few days ago! It is my new book, a novel about programmers. It explains in details the majority of ideas that stand behind <a href="https://www.zerocracy.com">Zerocracy</a> and <a href="https://www.xdsd.org">XDSD</a>. </li> <li> At <a href="/webinars.html">Webinar #37</a> we will discuss naming problem in OOP, for objects, methods and attributes; join us on <b>September 12</b>, at 11am PST. </li></ul></div></header></div><section itemscope="" itemtype="http://schema.org/BlogPosting"><div class="wrapper"> <header><p class="printable"> <img src="https://api.qrserver.com/v1/create-qr-code/?data=https://www.yegor256.com/2015/07/06/public-static-literals.html&amp;format=svg" style="width:125px;height:125px;" alt="QR code"/></p><p class="printable"> <code itemprop="url">https://www.yegor256.com/2015/07/06/public-static-literals.html</code></p><h1 itemprop="name headline mainEntityOfPage">Public Static Literals ... Are Not a Solution for Data Duplication</h1><aside class='book'><a href='http://amzn.to/2qFt4Tn'><img src='/images/books/elegant-objects/cover.png' class='book-cover' alt='book cover'/></a>Read more about this subject in <a href='http://amzn.to/2qFt4Tn'>Section&nbsp;2.5</a><br/> of my book<a href='http://amzn.to/2qFt4Tn'><img src='/images/books/amazon-buy-button.png' class='amazon-button' alt='Click to buy'/></a></aside><ul class="subline"> <li> <time itemprop="datePublished" datetime="2015-07-06T00:00:00+00:00"> 6 July 2015 </time> </li> <li class="desktop-only" itemprop="locationCreated">Palo Alto, CA</li> <li class="printable" itemscope="" itemprop="author" itemtype="http://schema.org/Person"> <span itemprop="name">Yegor Bugayenko</span> </li> <li class="unprintable"> <i class="icon icon-comments"></i> <a href="http://www.yegor256.com/2015/07/06/public-static-literals.html#disqus_thread" itemprop="discussionUrl">comments</a> </li></ul><p class="unprintable"><p>I have a <code>new String(array,&quot;UTF-8&quot;)</code> in one place and exactly the same code in another place in my app. Actually, I may have it in many places. And every time, I have to use that <code>&quot;UTF-8&quot;</code> constant in order to create a <code>String</code> from a byte array. It would be very convenient to define it once somewhere and reuse it, just like Apache Commons is doing; see <a href="https://commons.apache.org/proper/commons-lang/javadocs/api-2.6/org/apache/commons/lang/CharEncoding.html#UTF_8"><code>CharEncoding.UTF_8</code></a> (There are many other static literals there). These guys are setting a bad example! <code>public</code> <code>static</code> &quot;properties&quot; are as bad as <a href="/2014/05/05/oop-alternative-to-utility-classes.html">utility classes</a>.</p><figure class='jb_picture'><img itemprop='image' alt='The Shining (1980) by Stanley Kubrick' src='/images/2015/07/the-shining.jpg' longdesc='#3741e70e'/><figcaption id='3741e70e'>The Shining (1980) by Stanley Kubrick</figcaption></figure><p>Here is what I&#39;m talking about, specifically:</p><figure class="highlight"><pre><code class="language-java" data-lang="java"><span></span><span class="kn">package</span> <span class="nn">org.apache.commons.lang3</span><span class="o">;</span>
<span class="kd">public</span> <span class="kd">class</span> <span class="nc">CharEncoding</span> <span class="o">{</span>
  <span class="kd">public</span> <span class="kd">static</span> <span class="kd">final</span> <span class="n">String</span> <span class="n">UTF_8</span> <span class="o">=</span> <span class="s">&quot;UTF-8&quot;</span><span class="o">;</span>
  <span class="c1">// some other methods and properties</span>
<span class="o">}</span></code></pre></figure><p>Now, when I need to create a <code>String</code> from a byte array, I use this:</p><figure class="highlight"><pre><code class="language-java" data-lang="java"><span></span><span class="kn">import</span> <span class="nn">org.apache.commons.lang3.CharEncoding</span><span class="o">;</span>
<span class="n">String</span> <span class="n">text</span> <span class="o">=</span> <span class="k">new</span> <span class="n">String</span><span class="o">(</span><span class="n">array</span><span class="o">,</span> <span class="n">CharEncoding</span><span class="o">.</span><span class="na">UTF_8</span><span class="o">);</span></code></pre></figure><p>Let&#39;s say I want to convert a <code>String</code> into a byte array:</p><figure class="highlight"><pre><code class="language-java" data-lang="java"><span></span><span class="kn">import</span> <span class="nn">org.apache.commons.lang3.CharEncoding</span><span class="o">;</span>
<span class="kt">byte</span><span class="o">[]</span> <span class="n">array</span> <span class="o">=</span> <span class="n">text</span><span class="o">.</span><span class="na">getBytes</span><span class="o">(</span><span class="n">CharEncoding</span><span class="o">.</span><span class="na">UTF_8</span><span class="o">);</span></code></pre></figure><p>Looks convenient, right? This is what the designers of Apache Commons think (one of the most popular but simply <em>terrible</em> libraries in the Java world). I encourage you to think differently. I can&#39;t tell you to stop using Apache Commons, because we just don&#39;t have a better alternative (yet!). But in your own code, don&#39;t use public static properties---ever. Even if this code may look convenient to you, it&#39;s a very bad design.</p><aside class='quote'>Every time you see data duplication, start thinking about the functionality you're duplicating</aside><p>The reason why is very similar to <a href="/2015/02/26/composable-decorators.html">utility classes</a> with public static methods---they are unbreakable hard-coded dependencies. Once you use that <code>CharEncoding.UTF_8</code>, your object starts to depend on this data, and its user (the user of your object) can&#39;t break this dependency. You may say that this is your intention, in the case of a <code>&quot;UTF-8&quot;</code> constant---to make sure that Unicode is specifically and exclusively being used. In this particular example, this may be true, but look at it from a more global perspective.</p><p>Let me show you the alternative I have in mind before we continue. Here is what I&#39;m suggesting instead to convert a byte array into a <code>String</code>:</p><figure class="highlight"><pre><code class="language-java" data-lang="java"><span></span><span class="n">String</span> <span class="n">text</span> <span class="o">=</span> <span class="k">new</span> <span class="n">UTF8String</span><span class="o">(</span><span class="n">array</span><span class="o">);</span></code></pre></figure><p>It&#39;s pseudo-code, since Java designers made class <code>String</code> final and we can&#39;t really extend it and create <code>UTF8String</code>, but you get the idea. In the real world, this would look like this:</p><figure class="highlight"><pre><code class="language-java" data-lang="java"><span></span><span class="n">String</span> <span class="n">text</span> <span class="o">=</span> <span class="k">new</span> <span class="n">UTF8String</span><span class="o">(</span><span class="n">array</span><span class="o">).</span><span class="na">toString</span><span class="o">();</span></code></pre></figure><p>As you see, we encapsulate the &quot;UTF-8&quot; constant somewhere inside the class <code>UTF8String</code>, and its users have no idea how exactly this &quot;byte array to string&quot; conversion is happening.</p><p>By introducing <code>UTF8String</code>, we solved the problem of &quot;UTF-8&quot; literal duplication. But we did it in a proper object-oriented way---we encapsulated the functionality inside a class and let everybody instantiate its objects and use them. We resolved the problem of functionality duplication, not just data duplication.</p><p>Placing data into one shared place (<code>CharEncoding.UTF_8</code>) doesn&#39;t really solve the duplication problem; it actually makes it <strong>worse</strong>, mostly because it encourages everybody to duplicate functionality using the same piece of shared data.</p><p>My point here is that every time you see that you have some data duplication in your application, start thinking about the functionality you&#39;re duplicating. You will easily find the code that is repeated again and again. Make a new class for this code and place the data there, as a <code>private</code> property (or private <code>static</code> property). That&#39;s how you will improve your design and truly get rid of duplication.</p><p>PS. You can use a method instead of a class, but not a static literal.</p></p><nav class="buttons notranslate desktop-only"> <a href="http://www.facebook.com/sharer/sharer.php?u=https://www.yegor256.com/2015/07/06/public-static-literals.html" title="Share on Facebook" class="button" rel="nofollow"> <span class="count count-facebook">0</span> <i class="icon icon-facebook notranslate" aria-hidden="true"></i> </a> <a href="https://twitter.com/share?url=https://www.yegor256.com/2015/07/06/public-static-literals.html&amp;text=Public+Static+Literals+...+Are+Not+a+Solution+for+Data+Duplication" title="Share on Twitter" class="button" rel="nofollow"> <span class="count count-twitter">0</span> <i class="icon icon-twitter notranslate" aria-hidden="true"></i> </a> <a href="https://plus.google.com/share?url=https://www.yegor256.com/2015/07/06/public-static-literals.html" title="Share on Google+" class="button" rel="nofollow"> <span class="count count-googleplus">0</span> <i class="icon icon-googleplus notranslate" aria-hidden="true"></i> </a> <a href="https://www.linkedin.com/cws/share?url=https://www.yegor256.com/2015/07/06/public-static-literals.html" title="Share on LinkedIn" class="button" rel="nofollow"> <span class="count count-linkedin">0</span> <i class="icon icon-linkedin notranslate" aria-hidden="true"></i> </a> <a href="http://reddit.com/submit?url=https://www.yegor256.com/2015/07/06/public-static-literals.html%3F2015-27&amp;title=Public+Static+Literals+...+Are+Not+a+Solution+for+Data+Duplication" title="Share on Reddit" class="button" rel="nofollow"> <span class="count count-reddit">0</span> <i class="icon icon-reddit notranslate" aria-hidden="true"></i> </a> <a href="http://news.ycombinator.com/submitlink?u=https://www.yegor256.com/2015/07/06/public-static-literals.html%3F2015-27&amp;t=Public+Static+Literals+...+Are+Not+a+Solution+for+Data+Duplication" title="Share on Hacker News" class="button" rel="nofollow"> <span class="count count-hackernews">0</span> <i class="icon icon-hackernews notranslate" aria-hidden="true"></i> </a> </nav> </header> <article class="main" itemprop="articleBody"><div ><p>I have a <code>new String(array,&quot;UTF-8&quot;)</code> in one place and exactly the same code in another place in my app. Actually, I may have it in many places. And every time, I have to use that <code>&quot;UTF-8&quot;</code> constant in order to create a <code>String</code> from a byte array. It would be very convenient to define it once somewhere and reuse it, just like Apache Commons is doing; see <a href="https://commons.apache.org/proper/commons-lang/javadocs/api-2.6/org/apache/commons/lang/CharEncoding.html#UTF_8"><code>CharEncoding.UTF_8</code></a> (There are many other static literals there). These guys are setting a bad example! <code>public</code> <code>static</code> &quot;properties&quot; are as bad as <a href="/2014/05/05/oop-alternative-to-utility-classes.html">utility classes</a>.</p><figure class='jb_picture'><img itemprop='image' alt='The Shining (1980) by Stanley Kubrick' src='/images/2015/07/the-shining.jpg' longdesc='#3741e70e'/><figcaption id='3741e70e'>The Shining (1980) by Stanley Kubrick</figcaption></figure><p>Here is what I&#39;m talking about, specifically:</p><figure class="highlight"><pre><code class="language-java" data-lang="java"><span></span><span class="kn">package</span> <span class="nn">org.apache.commons.lang3</span><span class="o">;</span>
<span class="kd">public</span> <span class="kd">class</span> <span class="nc">CharEncoding</span> <span class="o">{</span>
  <span class="kd">public</span> <span class="kd">static</span> <span class="kd">final</span> <span class="n">String</span> <span class="n">UTF_8</span> <span class="o">=</span> <span class="s">&quot;UTF-8&quot;</span><span class="o">;</span>
  <span class="c1">// some other methods and properties</span>
<span class="o">}</span></code></pre></figure><p>Now, when I need to create a <code>String</code> from a byte array, I use this:</p><figure class="highlight"><pre><code class="language-java" data-lang="java"><span></span><span class="kn">import</span> <span class="nn">org.apache.commons.lang3.CharEncoding</span><span class="o">;</span>
<span class="n">String</span> <span class="n">text</span> <span class="o">=</span> <span class="k">new</span> <span class="n">String</span><span class="o">(</span><span class="n">array</span><span class="o">,</span> <span class="n">CharEncoding</span><span class="o">.</span><span class="na">UTF_8</span><span class="o">);</span></code></pre></figure><p>Let&#39;s say I want to convert a <code>String</code> into a byte array:</p><figure class="highlight"><pre><code class="language-java" data-lang="java"><span></span><span class="kn">import</span> <span class="nn">org.apache.commons.lang3.CharEncoding</span><span class="o">;</span>
<span class="kt">byte</span><span class="o">[]</span> <span class="n">array</span> <span class="o">=</span> <span class="n">text</span><span class="o">.</span><span class="na">getBytes</span><span class="o">(</span><span class="n">CharEncoding</span><span class="o">.</span><span class="na">UTF_8</span><span class="o">);</span></code></pre></figure><p>Looks convenient, right? This is what the designers of Apache Commons think (one of the most popular but simply <em>terrible</em> libraries in the Java world). I encourage you to think differently. I can&#39;t tell you to stop using Apache Commons, because we just don&#39;t have a better alternative (yet!). But in your own code, don&#39;t use public static properties---ever. Even if this code may look convenient to you, it&#39;s a very bad design.</p><aside class='quote'>Every time you see data duplication, start thinking about the functionality you're duplicating</aside><p>The reason why is very similar to <a href="/2015/02/26/composable-decorators.html">utility classes</a> with public static methods---they are unbreakable hard-coded dependencies. Once you use that <code>CharEncoding.UTF_8</code>, your object starts to depend on this data, and its user (the user of your object) can&#39;t break this dependency. You may say that this is your intention, in the case of a <code>&quot;UTF-8&quot;</code> constant---to make sure that Unicode is specifically and exclusively being used. In this particular example, this may be true, but look at it from a more global perspective.</p><p>Let me show you the alternative I have in mind before we continue. Here is what I&#39;m suggesting instead to convert a byte array into a <code>String</code>:</p><figure class="highlight"><pre><code class="language-java" data-lang="java"><span></span><span class="n">String</span> <span class="n">text</span> <span class="o">=</span> <span class="k">new</span> <span class="n">UTF8String</span><span class="o">(</span><span class="n">array</span><span class="o">);</span></code></pre></figure><p>It&#39;s pseudo-code, since Java designers made class <code>String</code> final and we can&#39;t really extend it and create <code>UTF8String</code>, but you get the idea. In the real world, this would look like this:</p><figure class="highlight"><pre><code class="language-java" data-lang="java"><span></span><span class="n">String</span> <span class="n">text</span> <span class="o">=</span> <span class="k">new</span> <span class="n">UTF8String</span><span class="o">(</span><span class="n">array</span><span class="o">).</span><span class="na">toString</span><span class="o">();</span></code></pre></figure><p>As you see, we encapsulate the &quot;UTF-8&quot; constant somewhere inside the class <code>UTF8String</code>, and its users have no idea how exactly this &quot;byte array to string&quot; conversion is happening.</p><p>By introducing <code>UTF8String</code>, we solved the problem of &quot;UTF-8&quot; literal duplication. But we did it in a proper object-oriented way---we encapsulated the functionality inside a class and let everybody instantiate its objects and use them. We resolved the problem of functionality duplication, not just data duplication.</p><p>Placing data into one shared place (<code>CharEncoding.UTF_8</code>) doesn&#39;t really solve the duplication problem; it actually makes it <strong>worse</strong>, mostly because it encourages everybody to duplicate functionality using the same piece of shared data.</p><p>My point here is that every time you see that you have some data duplication in your application, start thinking about the functionality you&#39;re duplicating. You will easily find the code that is repeated again and again. Make a new class for this code and place the data there, as a <code>private</code> property (or private <code>static</code> property). That&#39;s how you will improve your design and truly get rid of duplication.</p><p>PS. You can use a method instead of a class, but not a static literal.</p></div></article></div><div class="wrapper"> <related-posts /></div><div class="disqus" role="complementary"><p class="disqus_hint"> Please, use <a href="https://help.disqus.com/commenting/what-html-tags-are-allowed-within-comments">syntax highlighting</a> in your comments, to make them more readable.</p><div id="disqus_thread" class="disqus-thread"> <a>&nbsp;</a></div><script> var disqus_config = function () { this.page.url = document.location.href.split('?')[0].split('#')[0].replace('https://', 'http://'); this.page.identifier = this.page.url; }; (function() { var d = document, s = d.createElement('script'); s.src = '//yegor256.disqus.com/embed.js'; s.setAttribute('data-timestamp', +new Date()); (d.head || d.body).appendChild(s); })(); </script> <noscript><div><p class="red"> JavaScript is disabled in your browser, that's why you can't see comments under this post.</p></div></noscript></div><div class="wrapper"> <footer class="footer"><p> &copy; <span itemscope="" itemprop="copyrightHolder" itemtype="http://schema.org/Person"> <span itemprop="name">Yegor Bugayenko</span> </span> 2014&ndash;<span itemprop="copyrightYear">2018</span></p></footer></div></section><div class="wrapper unprintable" style="text-align:center;margin-top:2em;"> <a href="http://www.sixnines.io/h/3ba1652f"> <img src="//www.sixnines.io/b/3ba1652f?style=flat" alt="sixnines availability badge"/> </a></div><script src="//code.jquery.com/jquery-1.9.0.min.js"></script> <script src="/js/all.js?a0e0d018c07"></script> <script>var disqus_shortname = 'yegor256';</script> <script id="dsq-count-scr" src="//yegor256.disqus.com/count.js" async="async"></script> <script> (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){ (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o), m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m) })(window,document,'script','//www.google-analytics.com/analytics.js','ga'); ga('create', 'UA-1963507-32', 'auto'); ga('send', 'pageview'); </script> <script> Cd=document;Cr="&"+Math.random();Cp="&s=1"; Cd.cookie="b=b";if(Cd.cookie)Cp+="&c=1"; Cp+="&t="+(new Date()).getTimezoneOffset(); if(self!=top)Cp+="&f=1"; </script> <script> if(navigator.javaEnabled())Cp+="&j=1"; </script> <script> if(typeof(screen)!='undefined')Cp+="&w="+screen.width+"&h="+ screen.height+"&d="+(screen.colorDepth?screen.colorDepth:screen.pixelDepth); </script> <script> Cd.write("<img src='//c.hit.ua/hit?i=95870&g=0&x=2"+Cp+Cr+ "&r="+escape(Cd.referrer)+"&u="+escape(window.location.href)+ "' border='0' wi"+"dth='1' he"+"ight='1'/>"); </script> <script type="application/ld+json"> { "@context": "http://schema.org", "@type": "Person", "name": "Yegor Bugayenko", "url": "http://www.yegor256.com", "sameAs": [ "https://www.facebook.com/yegor256", "https://instagram.com/yegor256", "https://www.linkedin.com/in/yegor256", "https://twitter.com/yegor256", "https://github.com/yegor256", "https://www.pinterest.com/yegor256/" ] } </script> </body> </html> <!DOCTYPE html> <html xmlns="http://www.w3.org/1999/xhtml" lang="en-US" xml:lang="en-US" itemscope="" itemtype="http://schema.org/WebSite"> <head> <meta charset="utf-8"/> <meta name="description" content="In a properly designed class, there can only be one primary constructor and any number of secondary ones. " /> <meta name="keywords" content="class constructor, java constructor, object constructor, oop constructor, primary constructor" /> <meta name="viewport" content="width=device-width,minimum-scale=1,initial-scale=1"/> <meta name="google-site-verification" content="JEj_gQr2CPe2QKGw8XdMz0R7VboQIUbX3FlM-lwTq-8" /> <meta name="author" content="Yegor Bugayenko"> <meta name="article:published_time" content="2015-05-28 00:00:00 +0000"> <meta name="og:site_name" content="Yegor Bugayenko"/> <meta name="og:type" content="article" /> <meta name="og:locale" content="en_US" /> <meta name="twitter:account_id" content="4503599630178231" /> <meta name="twitter:creator" content="@yegor256"/> <meta name="twitter:site" content="@yegor256"/> <meta name="twitter:title" property="og:title" content="There Can Be Only One Primary Constructor"/> <meta name="twitter:description" property="og:description" content="In a properly designed class, there can only be one primary constructor and any number of secondary ones. "/> <meta name="twitter:url" property="og:url" content="https://www.yegor256.com/2015/05/28/one-primary-constructor.html"/> <meta name="telegram:channel" content="AAAAAEJFMRzsRTRxM3ec6A"/> <link rel="search" type="application/opensearchdescription+xml" href="/opensearch.xml" title="yegor256" /> <link rel="shortcut icon" href="/favicon.ico?a0e0d018c07"/> <link rel="apple-touch-icon" href="/favicon.ico?a0e0d018c07"/> <link rel="alternate" type="application/rss+xml" title="RSS for yegor256.com" href="https://www.yegor256.com/rss.xml"/> <link rel="stylesheet" href="/css/layout.css?a0e0d018c07"/> <link rel="stylesheet" href="/css/icons.css?a0e0d018c07"/> <link rel="canonical" href="https://www.yegor256.com/2015/05/28/one-primary-constructor.html" /> <link rel="amphtml" href="https://www.yegor256.com/2015/05/28/one-primary-constructor.amp.html" /> <title>There Can Be Only One Primary Constructor </title> <meta name='og:image' content='https://www.yegor256.com/images/2015/05/the-matrix-agent-smith.jpg'/><meta name='twitter:image' content='https://www.yegor256.com/images/2015/05/the-matrix-agent-smith.jpg'/><meta name='og:image:width' content='1200'/> <meta name='twitter:image:width' content='1200'/><meta name='og:image:height' content='678'/> <meta name='twitter:image:height' content='678'/><meta name='twitter:card' content='summary_large_image'/><meta name='twitter:image:alt' content='The Matrix (1999) by The Wachowski Brothers'/> </head> <body><div class="wrapper"> <aside class="header-toggle unprintable" id="header-toggle" title="Show the menu" onclick="$('#header').show();$('#header-toggle').hide();">&#9776;</aside> <header class="header" id="header"><div class="face"> <a href="/about-me.html#form" class="sub" title="Click to subscribe to my monthly newsletter"><span>Subscribe</span></a> <a href="/about-me.html" style="position:relative;"> <img src="/images/face-256x256.jpg" class="photo" alt="Yegor Bugayenko"/> </a></div><nav><ul class="menu social notranslate"> <li><a href="https://twitter.com/intent/follow?screen_name=yegor256" rel="nofollow" title="Follow me on Twitter"><i class="icon icon-twitter notranslate" aria-hidden="true"></i></a></li> <li><a href="/rss.xml" rel="nofollow" title="Subscribe to my RSS feed"><i class="icon icon-rss notranslate" aria-hidden="true"></i></a></li> <li><a itemprop="sameAs" href="https://github.com/yegor256" rel="nofollow" title="My GitHub profile"><i class="icon icon-github notranslate" aria-hidden="true"></i></a></li> <li><a itemprop="sameAs" href="http://stackoverflow.com/users/187141/yegor256" rel="nofollow" title="My StackOverflow profile"><i class="icon icon-stackoverflow notranslate" aria-hidden="true"></i></a></li> <li><a itemprop="sameAs" href="https://www.facebook.com/yegor256" rel="nofollow" title="Follow me on Facebook"><i class="icon icon-facebook notranslate" aria-hidden="true"></i></a></li> <li><a itemprop="sameAs" href="https://instagram.com/yegor256" rel="nofollow" title="Follow me on Instagram"><i class="icon icon-instagram notranslate" aria-hidden="true"></i></a></li> <li><a itemprop="sameAs" href="https://www.linkedin.com/in/yegor256" rel="nofollow" title="My LinkedIn profile"><i class="icon icon-linkedin notranslate" aria-hidden="true"></i></a></li> <li><a itemprop="sameAs" href="https://www.youtube.com/c/yegor256?sub_confirmation=1" rel="nofollow" title="My Youtube video channel"><i class="icon icon-youtube notranslate" aria-hidden="true"></i></a></li> <li><a itemprop="sameAs" href="https://www.pinterest.com/yegor256/" rel="nofollow" title="My Pinterest boards"><i class="icon icon-pinterest notranslate" aria-hidden="true"></i></a></li> <li><a itemprop="sameAs" href="https://angel.co/yegor256" rel="nofollow" title="My AngelList profile"><i class="icon icon-angellist notranslate" aria-hidden="true"></i></a></li> <li><a href="https://soundcloud.com/yegor256" rel="nofollow" title="My podcast"><i class="icon icon-podcast notranslate" aria-hidden="true"></i></a></li> <li><a href="https://itunes.apple.com/us/podcast/yegor256-podcast/id1150826721" rel="nofollow" title="My iTunes podcast"><i class="icon icon-itunes notranslate" aria-hidden="true"></i></a></li> <li><a href="https://t.me/joinchat/AAAAAEJFMRzsRTRxM3ec6A" rel="nofollow" title="My Telegram public channel"><i class="icon icon-telegram notranslate" aria-hidden="true"></i></a></li> <li><a href="mailto:blog@yegor256.com" rel="nofollow" title="Email me any time"><i class="icon icon-mail notranslate" aria-hidden="true"></i></a></li></ul><ul class="menu"> <li><a href="/" title="Home page">Home</a></li> <li ><a href="/best.html" title="Best articles to read">12&#160;Best</a></li> <li ><a href="/contents.html" title="The contents of the entire blog">All&#160;288</a></li> <li ><a href="/webinars.html" title="My webinars">Webinars</a></li> <li ><a href="/talks.html" title="Future and past conference talks">Talks</a></li> <li ><a href="/books.html" title="The books I wrote">Books</a></li> <li ><a href="/papers.html" title="My academic papers and patents">Papers</a></li> <li ><a href="/pets.html" title="My loved pet projects">Pets</a></li> <li ><a href="/award.html" title="Software quality award">Award</a></li> <li ><a href="/testimonials.html" title="What some people say about me">Testimonials</a></li> <li ><a href="/shift-m.html" title="Audio podcast about project management">Shift-M</a></li> <li ><a href="/paintings.html" title="My paintings for sale">Paintings</a></li> <li><a href="http://ru.yegor256.com/" title="Немного на русском языке">По-русски</a></li></ul></nav><div class="search"> <form method="get" action="https://www.google.com/search" itemprop="potentialAction" itemscope="" itemtype="http://schema.org/SearchAction"> <meta itemprop="target" content="https://www.google.com/search?q={q}"/> <input name="sitesearch" value="yegor256.com" type="hidden"/> <input itemprop="query-input" type="text" id="search-query" class="field field-text" required="required" onfocus="$('.google').css('visibility', 'visible');" name="q" placeholder="Search..." autocomplete="off"/> <input type="image" src="/images/google-search-icon.svg" class="google" title="Search via Google" alt="Search via Google"/> </form></div><div class="hot"><ul> <li> <a href="/code-ahead.html">Code Ahead</a> was published on Amazon just a few days ago! It is my new book, a novel about programmers. It explains in details the majority of ideas that stand behind <a href="https://www.zerocracy.com">Zerocracy</a> and <a href="https://www.xdsd.org">XDSD</a>. </li> <li> At <a href="/webinars.html">Webinar #37</a> we will discuss naming problem in OOP, for objects, methods and attributes; join us on <b>September 12</b>, at 11am PST. </li></ul></div></header></div><section itemscope="" itemtype="http://schema.org/BlogPosting"><div class="wrapper"> <header><p class="printable"> <img src="https://api.qrserver.com/v1/create-qr-code/?data=https://www.yegor256.com/2015/05/28/one-primary-constructor.html&amp;format=svg" style="width:125px;height:125px;" alt="QR code"/></p><p class="printable"> <code itemprop="url">https://www.yegor256.com/2015/05/28/one-primary-constructor.html</code></p><h1 itemprop="name headline mainEntityOfPage">There Can Be Only One Primary Constructor</h1><aside class='book'><a href='http://amzn.to/2qFt4Tn'><img src='/images/books/elegant-objects/cover.png' class='book-cover' alt='book cover'/></a>Read more about this subject in <a href='http://amzn.to/2qFt4Tn'>Section&nbsp;1.2</a><br/> of my book<a href='http://amzn.to/2qFt4Tn'><img src='/images/books/amazon-buy-button.png' class='amazon-button' alt='Click to buy'/></a></aside><ul class="subline"> <li> <time itemprop="datePublished" datetime="2015-05-28T00:00:00+00:00"> 28 May 2015 </time> </li> <li class="printable" itemscope="" itemprop="author" itemtype="http://schema.org/Person"> <span itemprop="name">Yegor Bugayenko</span> </li> <li class="unprintable"> <i class="icon icon-comments"></i> <a href="http://www.yegor256.com/2015/05/28/one-primary-constructor.html#disqus_thread" itemprop="discussionUrl">comments</a> </li></ul><ul class="unprintable subline"> <li>Translated:</li> <li><a href="http://blog.csdn.net/LvShuiLanTian/article/details/52390622">Chinese</a></li> <li><a href="mailto:translate@yegor256.com">add yours!</a></li></ul><p class="unprintable"><p>I suggest classifying class constructors in OOP as <strong>primary</strong> and <strong>secondary</strong>. A primary constructor is the one that constructs an object and encapsulates other objects inside it. A secondary one is simply a preparation step before calling a primary constructor and is not really a constructor but rather an introductory layer in front of a real constructing mechanism.</p><figure class='jb_picture'><img itemprop='image' alt='The Matrix (1999) by The Wachowski Brothers' src='/images/2015/05/the-matrix-agent-smith.jpg' longdesc='#8bc62615'/><figcaption id='8bc62615'>The Matrix (1999) by The Wachowski Brothers</figcaption></figure><p>Here is what I mean:</p><figure class="highlight"><pre><code class="language-java" data-lang="java"><span></span><span class="kd">final</span> <span class="kd">class</span> <span class="nc">Cash</span> <span class="o">{</span>
  <span class="kd">private</span> <span class="kd">final</span> <span class="kt">int</span> <span class="n">cents</span><span class="o">;</span>
  <span class="kd">private</span> <span class="kd">final</span> <span class="n">String</span> <span class="n">currency</span><span class="o">;</span>
  <span class="kd">public</span> <span class="nf">Cash</span><span class="o">()</span> <span class="o">{</span> <span class="c1">// secondary</span>
    <span class="k">this</span><span class="o">(</span><span class="mi">0</span><span class="o">);</span>
  <span class="o">}</span>
  <span class="kd">public</span> <span class="nf">Cash</span><span class="o">(</span><span class="kt">int</span> <span class="n">cts</span><span class="o">)</span> <span class="o">{</span> <span class="c1">// secondary</span>
    <span class="k">this</span><span class="o">(</span><span class="n">cts</span><span class="o">,</span> <span class="s">&quot;USD&quot;</span><span class="o">);</span>
  <span class="o">}</span>
  <span class="kd">public</span> <span class="nf">Cash</span><span class="o">(</span><span class="kt">int</span> <span class="n">cts</span><span class="o">,</span> <span class="n">String</span> <span class="n">crn</span><span class="o">)</span> <span class="o">{</span> <span class="c1">// primary</span>
    <span class="k">this</span><span class="o">.</span><span class="na">cents</span> <span class="o">=</span> <span class="n">cts</span><span class="o">;</span>
    <span class="k">this</span><span class="o">.</span><span class="na">currency</span> <span class="o">=</span> <span class="n">crn</span><span class="o">;</span>
  <span class="o">}</span>
  <span class="c1">// methods here</span>
<span class="o">}</span></code></pre></figure><p>There are three constructors in the class---only one is <em>primary</em> and the other two are <em>secondary</em>. My definition of a secondary constructor is simple: It doesn&#39;t do anything besides calling a primary constructor, through <code>this(..)</code>.</p><p>My point here is that a <a href="/2014/11/20/seven-virtues-of-good-object.html">properly designed class</a> must have only one primary constructor, and it should be declared after all secondary ones. Why? There is only one reason behind this rule: It helps eliminate code duplication.</p><p>Without such a rule, we may have this design for our class:</p><figure class="highlight"><pre><code class="language-java" data-lang="java"><span></span><span class="kd">final</span> <span class="kd">class</span> <span class="nc">Cash</span> <span class="o">{</span>
  <span class="kd">private</span> <span class="kd">final</span> <span class="kt">int</span> <span class="n">cents</span><span class="o">;</span>
  <span class="kd">private</span> <span class="kd">final</span> <span class="n">String</span> <span class="n">currency</span><span class="o">;</span>
  <span class="kd">public</span> <span class="nf">Cash</span><span class="o">()</span> <span class="o">{</span> <span class="c1">// primary</span>
    <span class="k">this</span><span class="o">.</span><span class="na">cents</span> <span class="o">=</span> <span class="mi">0</span><span class="o">;</span>
    <span class="k">this</span><span class="o">.</span><span class="na">currency</span> <span class="o">=</span> <span class="s">&quot;USD&quot;</span><span class="o">;</span>
  <span class="o">}</span>
  <span class="kd">public</span> <span class="nf">Cash</span><span class="o">(</span><span class="kt">int</span> <span class="n">cts</span><span class="o">)</span> <span class="o">{</span> <span class="c1">// primary</span>
    <span class="k">this</span><span class="o">.</span><span class="na">cents</span> <span class="o">=</span> <span class="n">cts</span><span class="o">;</span>
    <span class="k">this</span><span class="o">.</span><span class="na">currency</span> <span class="o">=</span> <span class="s">&quot;USD&quot;</span><span class="o">;</span>
  <span class="o">}</span>
  <span class="kd">public</span> <span class="nf">Cash</span><span class="o">(</span><span class="kt">int</span> <span class="n">cts</span><span class="o">,</span> <span class="n">String</span> <span class="n">crn</span><span class="o">)</span> <span class="o">{</span> <span class="c1">// primary</span>
    <span class="k">this</span><span class="o">.</span><span class="na">cents</span> <span class="o">=</span> <span class="n">cts</span><span class="o">;</span>
    <span class="k">this</span><span class="o">.</span><span class="na">currency</span> <span class="o">=</span> <span class="n">crn</span><span class="o">;</span>
  <span class="o">}</span>
  <span class="c1">// methods here</span>
<span class="o">}</span></code></pre></figure><p>There&#39;s not a lot of code here, but the duplication is massive and ugly; I hope you see it for yourself.</p><p>By strictly following this suggested rule, all classes will have a single entry point (point of construction), which is a primary constructor, and it will always be easy to find because it stays below all secondary constructors.</p><p>More about this subject in <a href="/elegant-objects.html">Elegant Objects</a>, Section <a href="/images/books/elegant-objects/contents.pdf">1.2</a>.</p></p><nav class="buttons notranslate desktop-only"> <a href="http://www.facebook.com/sharer/sharer.php?u=https://www.yegor256.com/2015/05/28/one-primary-constructor.html" title="Share on Facebook" class="button" rel="nofollow"> <span class="count count-facebook">0</span> <i class="icon icon-facebook notranslate" aria-hidden="true"></i> </a> <a href="https://twitter.com/share?url=https://www.yegor256.com/2015/05/28/one-primary-constructor.html&amp;text=There+Can+Be+Only+One+Primary+Constructor" title="Share on Twitter" class="button" rel="nofollow"> <span class="count count-twitter">0</span> <i class="icon icon-twitter notranslate" aria-hidden="true"></i> </a> <a href="https://plus.google.com/share?url=https://www.yegor256.com/2015/05/28/one-primary-constructor.html" title="Share on Google+" class="button" rel="nofollow"> <span class="count count-googleplus">0</span> <i class="icon icon-googleplus notranslate" aria-hidden="true"></i> </a> <a href="https://www.linkedin.com/cws/share?url=https://www.yegor256.com/2015/05/28/one-primary-constructor.html" title="Share on LinkedIn" class="button" rel="nofollow"> <span class="count count-linkedin">0</span> <i class="icon icon-linkedin notranslate" aria-hidden="true"></i> </a> <a href="http://reddit.com/submit?url=https://www.yegor256.com/2015/05/28/one-primary-constructor.html%3F2015-21&amp;title=There+Can+Be+Only+One+Primary+Constructor" title="Share on Reddit" class="button" rel="nofollow"> <span class="count count-reddit">0</span> <i class="icon icon-reddit notranslate" aria-hidden="true"></i> </a> <a href="http://news.ycombinator.com/submitlink?u=https://www.yegor256.com/2015/05/28/one-primary-constructor.html%3F2015-21&amp;t=There+Can+Be+Only+One+Primary+Constructor" title="Share on Hacker News" class="button" rel="nofollow"> <span class="count count-hackernews">0</span> <i class="icon icon-hackernews notranslate" aria-hidden="true"></i> </a> </nav> </header> <article class="main" itemprop="articleBody"><div ><p>I suggest classifying class constructors in OOP as <strong>primary</strong> and <strong>secondary</strong>. A primary constructor is the one that constructs an object and encapsulates other objects inside it. A secondary one is simply a preparation step before calling a primary constructor and is not really a constructor but rather an introductory layer in front of a real constructing mechanism.</p><figure class='jb_picture'><img itemprop='image' alt='The Matrix (1999) by The Wachowski Brothers' src='/images/2015/05/the-matrix-agent-smith.jpg' longdesc='#8bc62615'/><figcaption id='8bc62615'>The Matrix (1999) by The Wachowski Brothers</figcaption></figure><p>Here is what I mean:</p><figure class="highlight"><pre><code class="language-java" data-lang="java"><span></span><span class="kd">final</span> <span class="kd">class</span> <span class="nc">Cash</span> <span class="o">{</span>
  <span class="kd">private</span> <span class="kd">final</span> <span class="kt">int</span> <span class="n">cents</span><span class="o">;</span>
  <span class="kd">private</span> <span class="kd">final</span> <span class="n">String</span> <span class="n">currency</span><span class="o">;</span>
  <span class="kd">public</span> <span class="nf">Cash</span><span class="o">()</span> <span class="o">{</span> <span class="c1">// secondary</span>
    <span class="k">this</span><span class="o">(</span><span class="mi">0</span><span class="o">);</span>
  <span class="o">}</span>
  <span class="kd">public</span> <span class="nf">Cash</span><span class="o">(</span><span class="kt">int</span> <span class="n">cts</span><span class="o">)</span> <span class="o">{</span> <span class="c1">// secondary</span>
    <span class="k">this</span><span class="o">(</span><span class="n">cts</span><span class="o">,</span> <span class="s">&quot;USD&quot;</span><span class="o">);</span>
  <span class="o">}</span>
  <span class="kd">public</span> <span class="nf">Cash</span><span class="o">(</span><span class="kt">int</span> <span class="n">cts</span><span class="o">,</span> <span class="n">String</span> <span class="n">crn</span><span class="o">)</span> <span class="o">{</span> <span class="c1">// primary</span>
    <span class="k">this</span><span class="o">.</span><span class="na">cents</span> <span class="o">=</span> <span class="n">cts</span><span class="o">;</span>
    <span class="k">this</span><span class="o">.</span><span class="na">currency</span> <span class="o">=</span> <span class="n">crn</span><span class="o">;</span>
  <span class="o">}</span>
  <span class="c1">// methods here</span>
<span class="o">}</span></code></pre></figure><p>There are three constructors in the class---only one is <em>primary</em> and the other two are <em>secondary</em>. My definition of a secondary constructor is simple: It doesn&#39;t do anything besides calling a primary constructor, through <code>this(..)</code>.</p><p>My point here is that a <a href="/2014/11/20/seven-virtues-of-good-object.html">properly designed class</a> must have only one primary constructor, and it should be declared after all secondary ones. Why? There is only one reason behind this rule: It helps eliminate code duplication.</p><p>Without such a rule, we may have this design for our class:</p><figure class="highlight"><pre><code class="language-java" data-lang="java"><span></span><span class="kd">final</span> <span class="kd">class</span> <span class="nc">Cash</span> <span class="o">{</span>
  <span class="kd">private</span> <span class="kd">final</span> <span class="kt">int</span> <span class="n">cents</span><span class="o">;</span>
  <span class="kd">private</span> <span class="kd">final</span> <span class="n">String</span> <span class="n">currency</span><span class="o">;</span>
  <span class="kd">public</span> <span class="nf">Cash</span><span class="o">()</span> <span class="o">{</span> <span class="c1">// primary</span>
    <span class="k">this</span><span class="o">.</span><span class="na">cents</span> <span class="o">=</span> <span class="mi">0</span><span class="o">;</span>
    <span class="k">this</span><span class="o">.</span><span class="na">currency</span> <span class="o">=</span> <span class="s">&quot;USD&quot;</span><span class="o">;</span>
  <span class="o">}</span>
  <span class="kd">public</span> <span class="nf">Cash</span><span class="o">(</span><span class="kt">int</span> <span class="n">cts</span><span class="o">)</span> <span class="o">{</span> <span class="c1">// primary</span>
    <span class="k">this</span><span class="o">.</span><span class="na">cents</span> <span class="o">=</span> <span class="n">cts</span><span class="o">;</span>
    <span class="k">this</span><span class="o">.</span><span class="na">currency</span> <span class="o">=</span> <span class="s">&quot;USD&quot;</span><span class="o">;</span>
  <span class="o">}</span>
  <span class="kd">public</span> <span class="nf">Cash</span><span class="o">(</span><span class="kt">int</span> <span class="n">cts</span><span class="o">,</span> <span class="n">String</span> <span class="n">crn</span><span class="o">)</span> <span class="o">{</span> <span class="c1">// primary</span>
    <span class="k">this</span><span class="o">.</span><span class="na">cents</span> <span class="o">=</span> <span class="n">cts</span><span class="o">;</span>
    <span class="k">this</span><span class="o">.</span><span class="na">currency</span> <span class="o">=</span> <span class="n">crn</span><span class="o">;</span>
  <span class="o">}</span>
  <span class="c1">// methods here</span>
<span class="o">}</span></code></pre></figure><p>There&#39;s not a lot of code here, but the duplication is massive and ugly; I hope you see it for yourself.</p><p>By strictly following this suggested rule, all classes will have a single entry point (point of construction), which is a primary constructor, and it will always be easy to find because it stays below all secondary constructors.</p><p>More about this subject in <a href="/elegant-objects.html">Elegant Objects</a>, Section <a href="/images/books/elegant-objects/contents.pdf">1.2</a>.</p></div></article></div><div class="wrapper"> <related-posts /></div><div class="disqus" role="complementary"><p class="disqus_hint"> Please, use <a href="https://help.disqus.com/commenting/what-html-tags-are-allowed-within-comments">syntax highlighting</a> in your comments, to make them more readable.</p><div id="disqus_thread" class="disqus-thread"> <a>&nbsp;</a></div><script> var disqus_config = function () { this.page.url = document.location.href.split('?')[0].split('#')[0].replace('https://', 'http://'); this.page.identifier = this.page.url; }; (function() { var d = document, s = d.createElement('script'); s.src = '//yegor256.disqus.com/embed.js'; s.setAttribute('data-timestamp', +new Date()); (d.head || d.body).appendChild(s); })(); </script> <noscript><div><p class="red"> JavaScript is disabled in your browser, that's why you can't see comments under this post.</p></div></noscript></div><div class="wrapper"> <footer class="footer"><p> &copy; <span itemscope="" itemprop="copyrightHolder" itemtype="http://schema.org/Person"> <span itemprop="name">Yegor Bugayenko</span> </span> 2014&ndash;<span itemprop="copyrightYear">2018</span></p></footer></div></section><div class="wrapper unprintable" style="text-align:center;margin-top:2em;"> <a href="http://www.sixnines.io/h/3ba1652f"> <img src="//www.sixnines.io/b/3ba1652f?style=flat" alt="sixnines availability badge"/> </a></div><script src="//code.jquery.com/jquery-1.9.0.min.js"></script> <script src="/js/all.js?a0e0d018c07"></script> <script>var disqus_shortname = 'yegor256';</script> <script id="dsq-count-scr" src="//yegor256.disqus.com/count.js" async="async"></script> <script> (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){ (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o), m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m) })(window,document,'script','//www.google-analytics.com/analytics.js','ga'); ga('create', 'UA-1963507-32', 'auto'); ga('send', 'pageview'); </script> <script> Cd=document;Cr="&"+Math.random();Cp="&s=1"; Cd.cookie="b=b";if(Cd.cookie)Cp+="&c=1"; Cp+="&t="+(new Date()).getTimezoneOffset(); if(self!=top)Cp+="&f=1"; </script> <script> if(navigator.javaEnabled())Cp+="&j=1"; </script> <script> if(typeof(screen)!='undefined')Cp+="&w="+screen.width+"&h="+ screen.height+"&d="+(screen.colorDepth?screen.colorDepth:screen.pixelDepth); </script> <script> Cd.write("<img src='//c.hit.ua/hit?i=95870&g=0&x=2"+Cp+Cr+ "&r="+escape(Cd.referrer)+"&u="+escape(window.location.href)+ "' border='0' wi"+"dth='1' he"+"ight='1'/>"); </script> <script type="application/ld+json"> { "@context": "http://schema.org", "@type": "Person", "name": "Yegor Bugayenko", "url": "http://www.yegor256.com", "sameAs": [ "https://www.facebook.com/yegor256", "https://instagram.com/yegor256", "https://www.linkedin.com/in/yegor256", "https://twitter.com/yegor256", "https://github.com/yegor256", "https://www.pinterest.com/yegor256/" ] } </script> </body> </html> <!DOCTYPE html> <html xmlns="http://www.w3.org/1999/xhtml" lang="en-US" xml:lang="en-US" itemscope="" itemtype="http://schema.org/WebSite"> <head> <meta charset="utf-8"/> <meta name="description" content="Most unit tests require mocks, stubs, and the preparation of some other structures before a test can be initiated; here is how I recommend you do that. " /> <meta name="keywords" content="unit test scaffolding, unit testing best practices, unit testing mocks, unit testing of static, unit testing stubs" /> <meta name="viewport" content="width=device-width,minimum-scale=1,initial-scale=1"/> <meta name="google-site-verification" content="JEj_gQr2CPe2QKGw8XdMz0R7VboQIUbX3FlM-lwTq-8" /> <meta name="author" content="Yegor Bugayenko"> <meta name="article:published_time" content="2015-05-25 00:00:00 +0000"> <meta name="og:site_name" content="Yegor Bugayenko"/> <meta name="og:type" content="article" /> <meta name="og:locale" content="en_US" /> <meta name="twitter:account_id" content="4503599630178231" /> <meta name="twitter:creator" content="@yegor256"/> <meta name="twitter:site" content="@yegor256"/> <meta name="twitter:title" property="og:title" content="A Few Thoughts on Unit Test Scaffolding"/> <meta name="twitter:description" property="og:description" content="Most unit tests require mocks, stubs, and the preparation of some other structures before a test can be initiated; here is how I recommend you do that. "/> <meta name="twitter:url" property="og:url" content="https://www.yegor256.com/2015/05/25/unit-test-scaffolding.html"/> <meta name="telegram:channel" content="AAAAAEJFMRzsRTRxM3ec6A"/> <link rel="search" type="application/opensearchdescription+xml" href="/opensearch.xml" title="yegor256" /> <link rel="shortcut icon" href="/favicon.ico?a0e0d018c07"/> <link rel="apple-touch-icon" href="/favicon.ico?a0e0d018c07"/> <link rel="alternate" type="application/rss+xml" title="RSS for yegor256.com" href="https://www.yegor256.com/rss.xml"/> <link rel="stylesheet" href="/css/layout.css?a0e0d018c07"/> <link rel="stylesheet" href="/css/icons.css?a0e0d018c07"/> <link rel="canonical" href="https://www.yegor256.com/2015/05/25/unit-test-scaffolding.html" /> <link rel="amphtml" href="https://www.yegor256.com/2015/05/25/unit-test-scaffolding.amp.html" /> <title>A Few Thoughts on Unit Test Scaffolding </title> <meta name='og:image' content='https://www.yegor256.com/images/2015/05/leon-the-professional.jpg'/><meta name='twitter:image' content='https://www.yegor256.com/images/2015/05/leon-the-professional.jpg'/><meta name='og:image:width' content='1200'/> <meta name='twitter:image:width' content='1200'/><meta name='og:image:height' content='563'/> <meta name='twitter:image:height' content='563'/><meta name='twitter:card' content='summary_large_image'/><meta name='twitter:image:alt' content='Léon: The Professional by Luc Besson'/> </head> <body><div class="wrapper"> <aside class="header-toggle unprintable" id="header-toggle" title="Show the menu" onclick="$('#header').show();$('#header-toggle').hide();">&#9776;</aside> <header class="header" id="header"><div class="face"> <a href="/about-me.html#form" class="sub" title="Click to subscribe to my monthly newsletter"><span>Subscribe</span></a> <a href="/about-me.html" style="position:relative;"> <img src="/images/face-256x256.jpg" class="photo" alt="Yegor Bugayenko"/> </a></div><nav><ul class="menu social notranslate"> <li><a href="https://twitter.com/intent/follow?screen_name=yegor256" rel="nofollow" title="Follow me on Twitter"><i class="icon icon-twitter notranslate" aria-hidden="true"></i></a></li> <li><a href="/rss.xml" rel="nofollow" title="Subscribe to my RSS feed"><i class="icon icon-rss notranslate" aria-hidden="true"></i></a></li> <li><a itemprop="sameAs" href="https://github.com/yegor256" rel="nofollow" title="My GitHub profile"><i class="icon icon-github notranslate" aria-hidden="true"></i></a></li> <li><a itemprop="sameAs" href="http://stackoverflow.com/users/187141/yegor256" rel="nofollow" title="My StackOverflow profile"><i class="icon icon-stackoverflow notranslate" aria-hidden="true"></i></a></li> <li><a itemprop="sameAs" href="https://www.facebook.com/yegor256" rel="nofollow" title="Follow me on Facebook"><i class="icon icon-facebook notranslate" aria-hidden="true"></i></a></li> <li><a itemprop="sameAs" href="https://instagram.com/yegor256" rel="nofollow" title="Follow me on Instagram"><i class="icon icon-instagram notranslate" aria-hidden="true"></i></a></li> <li><a itemprop="sameAs" href="https://www.linkedin.com/in/yegor256" rel="nofollow" title="My LinkedIn profile"><i class="icon icon-linkedin notranslate" aria-hidden="true"></i></a></li> <li><a itemprop="sameAs" href="https://www.youtube.com/c/yegor256?sub_confirmation=1" rel="nofollow" title="My Youtube video channel"><i class="icon icon-youtube notranslate" aria-hidden="true"></i></a></li> <li><a itemprop="sameAs" href="https://www.pinterest.com/yegor256/" rel="nofollow" title="My Pinterest boards"><i class="icon icon-pinterest notranslate" aria-hidden="true"></i></a></li> <li><a itemprop="sameAs" href="https://angel.co/yegor256" rel="nofollow" title="My AngelList profile"><i class="icon icon-angellist notranslate" aria-hidden="true"></i></a></li> <li><a href="https://soundcloud.com/yegor256" rel="nofollow" title="My podcast"><i class="icon icon-podcast notranslate" aria-hidden="true"></i></a></li> <li><a href="https://itunes.apple.com/us/podcast/yegor256-podcast/id1150826721" rel="nofollow" title="My iTunes podcast"><i class="icon icon-itunes notranslate" aria-hidden="true"></i></a></li> <li><a href="https://t.me/joinchat/AAAAAEJFMRzsRTRxM3ec6A" rel="nofollow" title="My Telegram public channel"><i class="icon icon-telegram notranslate" aria-hidden="true"></i></a></li> <li><a href="mailto:blog@yegor256.com" rel="nofollow" title="Email me any time"><i class="icon icon-mail notranslate" aria-hidden="true"></i></a></li></ul><ul class="menu"> <li><a href="/" title="Home page">Home</a></li> <li ><a href="/best.html" title="Best articles to read">12&#160;Best</a></li> <li ><a href="/contents.html" title="The contents of the entire blog">All&#160;288</a></li> <li ><a href="/webinars.html" title="My webinars">Webinars</a></li> <li ><a href="/talks.html" title="Future and past conference talks">Talks</a></li> <li ><a href="/books.html" title="The books I wrote">Books</a></li> <li ><a href="/papers.html" title="My academic papers and patents">Papers</a></li> <li ><a href="/pets.html" title="My loved pet projects">Pets</a></li> <li ><a href="/award.html" title="Software quality award">Award</a></li> <li ><a href="/testimonials.html" title="What some people say about me">Testimonials</a></li> <li ><a href="/shift-m.html" title="Audio podcast about project management">Shift-M</a></li> <li ><a href="/paintings.html" title="My paintings for sale">Paintings</a></li> <li><a href="http://ru.yegor256.com/" title="Немного на русском языке">По-русски</a></li></ul></nav><div class="search"> <form method="get" action="https://www.google.com/search" itemprop="potentialAction" itemscope="" itemtype="http://schema.org/SearchAction"> <meta itemprop="target" content="https://www.google.com/search?q={q}"/> <input name="sitesearch" value="yegor256.com" type="hidden"/> <input itemprop="query-input" type="text" id="search-query" class="field field-text" required="required" onfocus="$('.google').css('visibility', 'visible');" name="q" placeholder="Search..." autocomplete="off"/> <input type="image" src="/images/google-search-icon.svg" class="google" title="Search via Google" alt="Search via Google"/> </form></div><div class="hot"><ul> <li> <a href="/code-ahead.html">Code Ahead</a> was published on Amazon just a few days ago! It is my new book, a novel about programmers. It explains in details the majority of ideas that stand behind <a href="https://www.zerocracy.com">Zerocracy</a> and <a href="https://www.xdsd.org">XDSD</a>. </li> <li> At <a href="/webinars.html">Webinar #37</a> we will discuss naming problem in OOP, for objects, methods and attributes; join us on <b>September 12</b>, at 11am PST. </li></ul></div></header></div><section itemscope="" itemtype="http://schema.org/BlogPosting"><div class="wrapper"> <header><p class="printable"> <img src="https://api.qrserver.com/v1/create-qr-code/?data=https://www.yegor256.com/2015/05/25/unit-test-scaffolding.html&amp;format=svg" style="width:125px;height:125px;" alt="QR code"/></p><p class="printable"> <code itemprop="url">https://www.yegor256.com/2015/05/25/unit-test-scaffolding.html</code></p><h1 itemprop="name headline mainEntityOfPage">A Few Thoughts on Unit Test Scaffolding</h1><ul class="subline"> <li> <time itemprop="datePublished" datetime="2015-05-25T00:00:00+00:00"> 25 May 2015 </time> </li> <li class="printable" itemscope="" itemprop="author" itemtype="http://schema.org/Person"> <span itemprop="name">Yegor Bugayenko</span> </li> <li class="unprintable"> <i class="icon icon-comments"></i> <a href="http://www.yegor256.com/2015/05/25/unit-test-scaffolding.html#disqus_thread" itemprop="discussionUrl">comments</a> </li></ul><p class="unprintable"><p>When I start to repeat myself in unit test methods by creating the same objects and preparing the data to run the test, I feel disappointed in my design. Long test methods with a lot of code duplication just don&#39;t look right. To simplify and shorten them, there are basically two options, at least in Java: 1) private properties initialized through <code>@Before</code> and <code>@BeforeClass</code>, and 2) <a href="/2017/02/07/private-method-is-new-class.html">private static methods</a>. They both look anti-OOP to me, and I think there is an alternative. Let me explain.</p><figure class='jb_picture'><img itemprop='image' alt='Léon: The Professional by Luc Besson' src='/images/2015/05/leon-the-professional.jpg' longdesc='#6f716aac'/><figcaption id='6f716aac'>Léon: The Professional by Luc Besson</figcaption></figure><p>JUnit officially suggests a <a href="http://junit.org/faq.html#atests_2">test fixture</a>:</p><figure class="highlight"><pre><code class="language-java" data-lang="java"><span></span><span class="kd">public</span> <span class="kd">final</span> <span class="kd">class</span> <span class="nc">MetricsTest</span> <span class="o">{</span>
  <span class="kd">private</span> <span class="n">File</span> <span class="n">temp</span><span class="o">;</span>
  <span class="kd">private</span> <span class="n">Folder</span> <span class="n">folder</span><span class="o">;</span>
  <span class="nd">@Before</span>
  <span class="kd">public</span> <span class="kt">void</span> <span class="nf">prepare</span><span class="o">()</span> <span class="o">{</span>
    <span class="k">this</span><span class="o">.</span><span class="na">temp</span> <span class="o">=</span> <span class="n">Files</span><span class="o">.</span><span class="na">createTempDirectory</span><span class="o">(</span><span class="s">&quot;test&quot;</span><span class="o">);</span>
    <span class="k">this</span><span class="o">.</span><span class="na">folder</span> <span class="o">=</span> <span class="k">new</span> <span class="n">DiscFolder</span><span class="o">(</span><span class="k">this</span><span class="o">.</span><span class="na">temp</span><span class="o">);</span>
    <span class="k">this</span><span class="o">.</span><span class="na">folder</span><span class="o">.</span><span class="na">save</span><span class="o">(</span><span class="s">&quot;first.txt&quot;</span><span class="o">,</span> <span class="s">&quot;Hello, world!&quot;</span><span class="o">);</span>
    <span class="k">this</span><span class="o">.</span><span class="na">folder</span><span class="o">.</span><span class="na">save</span><span class="o">(</span><span class="s">&quot;second.txt&quot;</span><span class="o">,</span> <span class="s">&quot;Goodbye!&quot;</span><span class="o">);</span>
  <span class="o">}</span>
  <span class="nd">@After</span>
  <span class="kd">public</span> <span class="kt">void</span> <span class="nf">clean</span><span class="o">()</span> <span class="o">{</span>
    <span class="n">FileUtils</span><span class="o">.</span><span class="na">deleteDirectory</span><span class="o">(</span><span class="k">this</span><span class="o">.</span><span class="na">temp</span><span class="o">);</span>
  <span class="o">}</span>
  <span class="nd">@Test</span>
  <span class="kd">public</span> <span class="kt">void</span> <span class="nf">calculatesTotalSize</span><span class="o">()</span> <span class="o">{</span>
    <span class="n">assertEquals</span><span class="o">(</span><span class="mi">22</span><span class="o">,</span> <span class="k">new</span> <span class="n">Metrics</span><span class="o">(</span><span class="k">this</span><span class="o">.</span><span class="na">folder</span><span class="o">).</span><span class="na">size</span><span class="o">());</span>
  <span class="o">}</span>
  <span class="nd">@Test</span>
  <span class="kd">public</span> <span class="kt">void</span> <span class="nf">countsWordsInFiles</span><span class="o">()</span> <span class="o">{</span>
    <span class="n">assertEquals</span><span class="o">(</span><span class="mi">4</span><span class="o">,</span> <span class="k">new</span> <span class="n">Metrics</span><span class="o">(</span><span class="k">this</span><span class="o">.</span><span class="na">folder</span><span class="o">).</span><span class="na">wc</span><span class="o">());</span>
  <span class="o">}</span>
<span class="o">}</span></code></pre></figure><p>I think it&#39;s obvious what this test is doing. First, in <code>prepare()</code>, it creates a &quot;test fixture&quot; of type <code>Folder</code>. That is used in all three tests as an argument for the <code>Metrics</code> constructor. The real class being tested here is <code>Metrics</code> while <code>this.folder</code> is something we need in order to test it.</p><aside class='youtube'> <a href='https://www.youtube.com/watch?v=l6MpCBzwDbg'><div class='box'> <img src='https://i.ytimg.com/vi/l6MpCBzwDbg/mqdefault.jpg' alt='YouTube video #l6MpCBzwDbg'/><div class='play'><i class='icon icon-play'></i></div></div></a><div>What Fake Objects Are For? (webinar #8); 4 November 2015.</div></aside><p>What&#39;s wrong with this test? There is one serious issue: <strong>coupling</strong> between test methods. Test methods (and all tests in general) must be perfectly isolated from each other. This means that changing one test must not affect any others. In this example, that is not the case. When I want to change the <code>countsWords()</code> test, I have to change the internals of <code>before()</code>, which will affect the other method in the test &quot;class.&quot;</p><p>With all due respect to JUnit, the idea of creating test fixtures in <code>@Before</code> and <code>@After</code> is wrong, mostly because it encourages developers to couple test methods.</p><p>Here is how we can improve our test and isolate test methods:</p><figure class="highlight"><pre><code class="language-java" data-lang="java"><span></span><span class="kd">public</span> <span class="kd">final</span> <span class="kd">class</span> <span class="nc">MetricsTest</span> <span class="o">{</span>
  <span class="nd">@Test</span>
  <span class="kd">public</span> <span class="kt">void</span> <span class="nf">calculatesTotalSize</span><span class="o">()</span> <span class="o">{</span>
    <span class="kd">final</span> <span class="n">File</span> <span class="n">dir</span> <span class="o">=</span> <span class="n">Files</span><span class="o">.</span><span class="na">createTempDirectory</span><span class="o">(</span><span class="s">&quot;test-1&quot;</span><span class="o">);</span>
    <span class="kd">final</span> <span class="n">Folder</span> <span class="n">folder</span> <span class="o">=</span> <span class="n">MetricsTest</span><span class="o">.</span><span class="na">folder</span><span class="o">(</span>
      <span class="n">dir</span><span class="o">,</span>
      <span class="s">&quot;first.txt:Hello, world!&quot;</span><span class="o">,</span>
      <span class="s">&quot;second.txt:Goodbye!&quot;</span>
    <span class="o">);</span>
    <span class="k">try</span> <span class="o">{</span>
      <span class="n">assertEquals</span><span class="o">(</span><span class="mi">22</span><span class="o">,</span> <span class="k">new</span> <span class="n">Metrics</span><span class="o">(</span><span class="n">folder</span><span class="o">).</span><span class="na">size</span><span class="o">());</span>
    <span class="o">}</span> <span class="k">finally</span> <span class="o">{</span>
      <span class="n">FileUtils</span><span class="o">.</span><span class="na">deleteDirectory</span><span class="o">(</span><span class="n">dir</span><span class="o">);</span>
    <span class="o">}</span>
  <span class="o">}</span>
  <span class="nd">@Test</span>
  <span class="kd">public</span> <span class="kt">void</span> <span class="nf">countsWordsInFiles</span><span class="o">()</span> <span class="o">{</span>
    <span class="kd">final</span> <span class="n">File</span> <span class="n">dir</span> <span class="o">=</span> <span class="n">Files</span><span class="o">.</span><span class="na">createTempDirectory</span><span class="o">(</span><span class="s">&quot;test-2&quot;</span><span class="o">);</span>
    <span class="kd">final</span> <span class="n">Folder</span> <span class="n">folder</span> <span class="o">=</span> <span class="n">MetricsTest</span><span class="o">.</span><span class="na">folder</span><span class="o">(</span>
      <span class="n">dir</span><span class="o">,</span>
      <span class="s">&quot;alpha.txt:Three words here&quot;</span><span class="o">,</span>
      <span class="s">&quot;beta.txt:two words&quot;</span>
      <span class="s">&quot;gamma.txt:one!&quot;</span>
    <span class="o">);</span>
    <span class="k">try</span> <span class="o">{</span>
      <span class="n">assertEquals</span><span class="o">(</span><span class="mi">6</span><span class="o">,</span> <span class="k">new</span> <span class="n">Metrics</span><span class="o">(</span><span class="n">folder</span><span class="o">).</span><span class="na">wc</span><span class="o">());</span>
    <span class="o">}</span> <span class="k">finally</span> <span class="o">{</span>
      <span class="n">FileUtils</span><span class="o">.</span><span class="na">deleteDirectory</span><span class="o">(</span><span class="n">dir</span><span class="o">);</span>
    <span class="o">}</span>
  <span class="o">}</span>
  <span class="kd">private</span> <span class="kd">static</span> <span class="n">Folder</span> <span class="nf">folder</span><span class="o">(</span><span class="n">File</span> <span class="n">dir</span><span class="o">,</span> <span class="n">String</span><span class="o">...</span> <span class="n">parts</span><span class="o">)</span> <span class="o">{</span>
    <span class="n">Folder</span> <span class="n">folder</span> <span class="o">=</span> <span class="k">new</span> <span class="n">DiscFolder</span><span class="o">(</span><span class="n">dir</span><span class="o">);</span>
    <span class="k">for</span> <span class="o">(</span><span class="kd">final</span> <span class="n">String</span> <span class="n">part</span> <span class="o">:</span> <span class="n">parts</span><span class="o">)</span> <span class="o">{</span>
      <span class="kd">final</span> <span class="n">String</span><span class="o">[]</span> <span class="n">pair</span> <span class="o">=</span> <span class="n">part</span><span class="o">.</span><span class="na">split</span><span class="o">(</span><span class="s">&quot;:&quot;</span><span class="o">,</span> <span class="mi">2</span><span class="o">);</span>
      <span class="k">this</span><span class="o">.</span><span class="na">folder</span><span class="o">.</span><span class="na">save</span><span class="o">(</span><span class="n">pair</span><span class="o">[</span><span class="mi">0</span><span class="o">],</span> <span class="n">pair</span><span class="o">[</span><span class="mi">1</span><span class="o">]);</span>
    <span class="o">}</span>
    <span class="k">return</span> <span class="n">folder</span><span class="o">;</span>
  <span class="o">}</span>
<span class="o">}</span></code></pre></figure><p>Does it look better now? We&#39;re not there yet, but now our test methods are perfectly isolated. If I want to change one of them, I&#39;m not going to affect the others because I pass all configuration parameters to a private static utility (!) method <code>folder()</code>.</p><p>A utility method, huh? Yes, <a href="/2014/05/05/oop-alternative-to-utility-classes.html">it smells</a>.</p><p>The main issue with this design, even though it is way better than the previous one, is that it doesn&#39;t prevent code duplication between test &quot;classes.&quot; If I need a similar test fixture of type <code>Folder</code> in another test case, I will have to move this static method there. Or even worse, I will have to create a utility class. Yes, there is <a href="/2015/02/20/utility-classes-vs-functional-programming.html">nothing worse</a> in object-oriented programming than utility classes.</p><p>A much better design would be to use &quot;<a href="/2014/09/23/built-in-fake-objects.html">fake</a>&quot; objects instead of private static utilities. Here is how. First, we create a fake class and place it into <code>src/main/java</code>. This class can be used in tests and also in production code, if necessary (<code>Fk</code> for &quot;fake&quot;):</p><figure class="highlight"><pre><code class="language-java" data-lang="java"><span></span><span class="kd">public</span> <span class="kd">final</span> <span class="kd">class</span> <span class="nc">FkFolder</span> <span class="kd">implements</span> <span class="n">Folder</span><span class="o">,</span> <span class="n">Closeable</span> <span class="o">{</span>
  <span class="kd">private</span> <span class="kd">final</span> <span class="n">File</span> <span class="n">dir</span><span class="o">;</span>
  <span class="kd">private</span> <span class="kd">final</span> <span class="n">String</span><span class="o">[]</span> <span class="n">parts</span><span class="o">;</span>
  <span class="kd">public</span> <span class="nf">FkFolder</span><span class="o">(</span><span class="n">String</span><span class="o">...</span> <span class="n">prts</span><span class="o">)</span> <span class="o">{</span>
    <span class="k">this</span><span class="o">(</span><span class="n">Files</span><span class="o">.</span><span class="na">createTempDirectory</span><span class="o">(</span><span class="s">&quot;test-1&quot;</span><span class="o">),</span> <span class="n">parts</span><span class="o">);</span>
  <span class="o">}</span>
  <span class="kd">public</span> <span class="nf">FkFolder</span><span class="o">(</span><span class="n">File</span> <span class="n">file</span><span class="o">,</span> <span class="n">String</span><span class="o">...</span> <span class="n">prts</span><span class="o">)</span> <span class="o">{</span>
    <span class="k">this</span><span class="o">.</span><span class="na">dir</span> <span class="o">=</span> <span class="n">file</span><span class="o">;</span>
    <span class="k">this</span><span class="o">.</span><span class="na">parts</span> <span class="o">=</span> <span class="n">parts</span><span class="o">;</span>
  <span class="o">}</span>
  <span class="nd">@Override</span>
  <span class="kd">public</span> <span class="n">Iterable</span><span class="o">&lt;</span><span class="n">File</span><span class="o">&gt;</span> <span class="nf">files</span><span class="o">()</span> <span class="o">{</span>
    <span class="kd">final</span> <span class="n">Folder</span> <span class="n">folder</span> <span class="o">=</span> <span class="k">new</span> <span class="n">DiscFolder</span><span class="o">(</span><span class="k">this</span><span class="o">.</span><span class="na">dir</span><span class="o">);</span>
    <span class="k">for</span> <span class="o">(</span><span class="kd">final</span> <span class="n">String</span> <span class="n">part</span> <span class="o">:</span> <span class="k">this</span><span class="o">.</span><span class="na">parts</span><span class="o">)</span> <span class="o">{</span>
      <span class="kd">final</span> <span class="n">String</span><span class="o">[]</span> <span class="n">pair</span> <span class="o">=</span> <span class="n">part</span><span class="o">.</span><span class="na">split</span><span class="o">(</span><span class="s">&quot;:&quot;</span><span class="o">,</span> <span class="mi">2</span><span class="o">);</span>
      <span class="n">folder</span><span class="o">.</span><span class="na">save</span><span class="o">(</span><span class="n">pair</span><span class="o">[</span><span class="mi">0</span><span class="o">],</span> <span class="n">pair</span><span class="o">[</span><span class="mi">1</span><span class="o">]);</span>
    <span class="o">}</span>
    <span class="k">return</span> <span class="n">folder</span><span class="o">.</span><span class="na">files</span><span class="o">();</span>
  <span class="o">}</span>
  <span class="nd">@Override</span>
  <span class="kd">public</span> <span class="kt">void</span> <span class="nf">close</span><span class="o">()</span> <span class="o">{</span>
    <span class="n">FileUtils</span><span class="o">.</span><span class="na">deleteDirectory</span><span class="o">(</span><span class="k">this</span><span class="o">.</span><span class="na">dir</span><span class="o">);</span>
  <span class="o">}</span>
<span class="o">}</span></code></pre></figure><p>Here is how our test will look now:</p><figure class="highlight"><pre><code class="language-java" data-lang="java"><span></span><span class="kd">public</span> <span class="kd">final</span> <span class="kd">class</span> <span class="nc">MetricsTest</span> <span class="o">{</span>
  <span class="nd">@Test</span>
  <span class="kd">public</span> <span class="kt">void</span> <span class="nf">calculatesTotalSize</span><span class="o">()</span> <span class="o">{</span>
    <span class="kd">final</span> <span class="n">String</span><span class="o">[]</span> <span class="n">parts</span> <span class="o">=</span> <span class="o">{</span>
      <span class="s">&quot;first.txt:Hello, world!&quot;</span><span class="o">,</span>
      <span class="s">&quot;second.txt:Goodbye!&quot;</span>
    <span class="o">};</span>
    <span class="k">try</span> <span class="o">(</span><span class="kd">final</span> <span class="n">Folder</span> <span class="n">folder</span> <span class="o">=</span> <span class="k">new</span> <span class="n">FkFolder</span><span class="o">(</span><span class="n">parts</span><span class="o">))</span> <span class="o">{</span>
      <span class="n">assertEquals</span><span class="o">(</span><span class="mi">22</span><span class="o">,</span> <span class="k">new</span> <span class="n">Metrics</span><span class="o">(</span><span class="n">folder</span><span class="o">).</span><span class="na">size</span><span class="o">());</span>
    <span class="o">}</span>
  <span class="o">}</span>
  <span class="nd">@Test</span>
  <span class="kd">public</span> <span class="kt">void</span> <span class="nf">countsWordsInFiles</span><span class="o">()</span> <span class="o">{</span>
    <span class="kd">final</span> <span class="n">String</span><span class="o">[]</span> <span class="n">parts</span> <span class="o">=</span> <span class="o">{</span>
      <span class="s">&quot;alpha.txt:Three words here&quot;</span><span class="o">,</span>
      <span class="s">&quot;beta.txt:two words&quot;</span>
      <span class="s">&quot;gamma.txt:one!&quot;</span>
    <span class="o">};</span>
    <span class="k">try</span> <span class="o">(</span><span class="kd">final</span> <span class="n">Folder</span> <span class="n">folder</span> <span class="o">=</span> <span class="k">new</span> <span class="n">FkFolder</span><span class="o">(</span><span class="n">parts</span><span class="o">))</span> <span class="o">{</span>
      <span class="n">assertEquals</span><span class="o">(</span><span class="mi">6</span><span class="o">,</span> <span class="k">new</span> <span class="n">Metrics</span><span class="o">(</span><span class="n">folder</span><span class="o">).</span><span class="na">wc</span><span class="o">());</span>
    <span class="o">}</span>
  <span class="o">}</span>
<span class="o">}</span></code></pre></figure><p>What do you think? Isn&#39;t it better than what JUnit offers? Isn&#39;t it more reusable and extensible than utility methods?</p><p>To summarize, I believe scaffolding in unit testing must be done through <a href="/2014/09/23/built-in-fake-objects.html">fake objects</a> that are shipped together with production code.</p></p><nav class="buttons notranslate desktop-only"> <a href="http://www.facebook.com/sharer/sharer.php?u=https://www.yegor256.com/2015/05/25/unit-test-scaffolding.html" title="Share on Facebook" class="button" rel="nofollow"> <span class="count count-facebook">0</span> <i class="icon icon-facebook notranslate" aria-hidden="true"></i> </a> <a href="https://twitter.com/share?url=https://www.yegor256.com/2015/05/25/unit-test-scaffolding.html&amp;text=A+Few+Thoughts+on+Unit+Test+Scaffolding" title="Share on Twitter" class="button" rel="nofollow"> <span class="count count-twitter">0</span> <i class="icon icon-twitter notranslate" aria-hidden="true"></i> </a> <a href="https://plus.google.com/share?url=https://www.yegor256.com/2015/05/25/unit-test-scaffolding.html" title="Share on Google+" class="button" rel="nofollow"> <span class="count count-googleplus">0</span> <i class="icon icon-googleplus notranslate" aria-hidden="true"></i> </a> <a href="https://www.linkedin.com/cws/share?url=https://www.yegor256.com/2015/05/25/unit-test-scaffolding.html" title="Share on LinkedIn" class="button" rel="nofollow"> <span class="count count-linkedin">0</span> <i class="icon icon-linkedin notranslate" aria-hidden="true"></i> </a> <a href="http://reddit.com/submit?url=https://www.yegor256.com/2015/05/25/unit-test-scaffolding.html%3F2015-21&amp;title=A+Few+Thoughts+on+Unit+Test+Scaffolding" title="Share on Reddit" class="button" rel="nofollow"> <span class="count count-reddit">0</span> <i class="icon icon-reddit notranslate" aria-hidden="true"></i> </a> <a href="http://news.ycombinator.com/submitlink?u=https://www.yegor256.com/2015/05/25/unit-test-scaffolding.html%3F2015-21&amp;t=A+Few+Thoughts+on+Unit+Test+Scaffolding" title="Share on Hacker News" class="button" rel="nofollow"> <span class="count count-hackernews">0</span> <i class="icon icon-hackernews notranslate" aria-hidden="true"></i> </a> </nav> </header> <article class="main" itemprop="articleBody"><div ><p>When I start to repeat myself in unit test methods by creating the same objects and preparing the data to run the test, I feel disappointed in my design. Long test methods with a lot of code duplication just don&#39;t look right. To simplify and shorten them, there are basically two options, at least in Java: 1) private properties initialized through <code>@Before</code> and <code>@BeforeClass</code>, and 2) <a href="/2017/02/07/private-method-is-new-class.html">private static methods</a>. They both look anti-OOP to me, and I think there is an alternative. Let me explain.</p><figure class='jb_picture'><img itemprop='image' alt='Léon: The Professional by Luc Besson' src='/images/2015/05/leon-the-professional.jpg' longdesc='#6f716aac'/><figcaption id='6f716aac'>Léon: The Professional by Luc Besson</figcaption></figure><p>JUnit officially suggests a <a href="http://junit.org/faq.html#atests_2">test fixture</a>:</p><figure class="highlight"><pre><code class="language-java" data-lang="java"><span></span><span class="kd">public</span> <span class="kd">final</span> <span class="kd">class</span> <span class="nc">MetricsTest</span> <span class="o">{</span>
  <span class="kd">private</span> <span class="n">File</span> <span class="n">temp</span><span class="o">;</span>
  <span class="kd">private</span> <span class="n">Folder</span> <span class="n">folder</span><span class="o">;</span>
  <span class="nd">@Before</span>
  <span class="kd">public</span> <span class="kt">void</span> <span class="nf">prepare</span><span class="o">()</span> <span class="o">{</span>
    <span class="k">this</span><span class="o">.</span><span class="na">temp</span> <span class="o">=</span> <span class="n">Files</span><span class="o">.</span><span class="na">createTempDirectory</span><span class="o">(</span><span class="s">&quot;test&quot;</span><span class="o">);</span>
    <span class="k">this</span><span class="o">.</span><span class="na">folder</span> <span class="o">=</span> <span class="k">new</span> <span class="n">DiscFolder</span><span class="o">(</span><span class="k">this</span><span class="o">.</span><span class="na">temp</span><span class="o">);</span>
    <span class="k">this</span><span class="o">.</span><span class="na">folder</span><span class="o">.</span><span class="na">save</span><span class="o">(</span><span class="s">&quot;first.txt&quot;</span><span class="o">,</span> <span class="s">&quot;Hello, world!&quot;</span><span class="o">);</span>
    <span class="k">this</span><span class="o">.</span><span class="na">folder</span><span class="o">.</span><span class="na">save</span><span class="o">(</span><span class="s">&quot;second.txt&quot;</span><span class="o">,</span> <span class="s">&quot;Goodbye!&quot;</span><span class="o">);</span>
  <span class="o">}</span>
  <span class="nd">@After</span>
  <span class="kd">public</span> <span class="kt">void</span> <span class="nf">clean</span><span class="o">()</span> <span class="o">{</span>
    <span class="n">FileUtils</span><span class="o">.</span><span class="na">deleteDirectory</span><span class="o">(</span><span class="k">this</span><span class="o">.</span><span class="na">temp</span><span class="o">);</span>
  <span class="o">}</span>
  <span class="nd">@Test</span>
  <span class="kd">public</span> <span class="kt">void</span> <span class="nf">calculatesTotalSize</span><span class="o">()</span> <span class="o">{</span>
    <span class="n">assertEquals</span><span class="o">(</span><span class="mi">22</span><span class="o">,</span> <span class="k">new</span> <span class="n">Metrics</span><span class="o">(</span><span class="k">this</span><span class="o">.</span><span class="na">folder</span><span class="o">).</span><span class="na">size</span><span class="o">());</span>
  <span class="o">}</span>
  <span class="nd">@Test</span>
  <span class="kd">public</span> <span class="kt">void</span> <span class="nf">countsWordsInFiles</span><span class="o">()</span> <span class="o">{</span>
    <span class="n">assertEquals</span><span class="o">(</span><span class="mi">4</span><span class="o">,</span> <span class="k">new</span> <span class="n">Metrics</span><span class="o">(</span><span class="k">this</span><span class="o">.</span><span class="na">folder</span><span class="o">).</span><span class="na">wc</span><span class="o">());</span>
  <span class="o">}</span>
<span class="o">}</span></code></pre></figure><p>I think it&#39;s obvious what this test is doing. First, in <code>prepare()</code>, it creates a &quot;test fixture&quot; of type <code>Folder</code>. That is used in all three tests as an argument for the <code>Metrics</code> constructor. The real class being tested here is <code>Metrics</code> while <code>this.folder</code> is something we need in order to test it.</p><aside class='youtube'> <a href='https://www.youtube.com/watch?v=l6MpCBzwDbg'><div class='box'> <img src='https://i.ytimg.com/vi/l6MpCBzwDbg/mqdefault.jpg' alt='YouTube video #l6MpCBzwDbg'/><div class='play'><i class='icon icon-play'></i></div></div></a><div>What Fake Objects Are For? (webinar #8); 4 November 2015.</div></aside><p>What&#39;s wrong with this test? There is one serious issue: <strong>coupling</strong> between test methods. Test methods (and all tests in general) must be perfectly isolated from each other. This means that changing one test must not affect any others. In this example, that is not the case. When I want to change the <code>countsWords()</code> test, I have to change the internals of <code>before()</code>, which will affect the other method in the test &quot;class.&quot;</p><p>With all due respect to JUnit, the idea of creating test fixtures in <code>@Before</code> and <code>@After</code> is wrong, mostly because it encourages developers to couple test methods.</p><p>Here is how we can improve our test and isolate test methods:</p><figure class="highlight"><pre><code class="language-java" data-lang="java"><span></span><span class="kd">public</span> <span class="kd">final</span> <span class="kd">class</span> <span class="nc">MetricsTest</span> <span class="o">{</span>
  <span class="nd">@Test</span>
  <span class="kd">public</span> <span class="kt">void</span> <span class="nf">calculatesTotalSize</span><span class="o">()</span> <span class="o">{</span>
    <span class="kd">final</span> <span class="n">File</span> <span class="n">dir</span> <span class="o">=</span> <span class="n">Files</span><span class="o">.</span><span class="na">createTempDirectory</span><span class="o">(</span><span class="s">&quot;test-1&quot;</span><span class="o">);</span>
    <span class="kd">final</span> <span class="n">Folder</span> <span class="n">folder</span> <span class="o">=</span> <span class="n">MetricsTest</span><span class="o">.</span><span class="na">folder</span><span class="o">(</span>
      <span class="n">dir</span><span class="o">,</span>
      <span class="s">&quot;first.txt:Hello, world!&quot;</span><span class="o">,</span>
      <span class="s">&quot;second.txt:Goodbye!&quot;</span>
    <span class="o">);</span>
    <span class="k">try</span> <span class="o">{</span>
      <span class="n">assertEquals</span><span class="o">(</span><span class="mi">22</span><span class="o">,</span> <span class="k">new</span> <span class="n">Metrics</span><span class="o">(</span><span class="n">folder</span><span class="o">).</span><span class="na">size</span><span class="o">());</span>
    <span class="o">}</span> <span class="k">finally</span> <span class="o">{</span>
      <span class="n">FileUtils</span><span class="o">.</span><span class="na">deleteDirectory</span><span class="o">(</span><span class="n">dir</span><span class="o">);</span>
    <span class="o">}</span>
  <span class="o">}</span>
  <span class="nd">@Test</span>
  <span class="kd">public</span> <span class="kt">void</span> <span class="nf">countsWordsInFiles</span><span class="o">()</span> <span class="o">{</span>
    <span class="kd">final</span> <span class="n">File</span> <span class="n">dir</span> <span class="o">=</span> <span class="n">Files</span><span class="o">.</span><span class="na">createTempDirectory</span><span class="o">(</span><span class="s">&quot;test-2&quot;</span><span class="o">);</span>
    <span class="kd">final</span> <span class="n">Folder</span> <span class="n">folder</span> <span class="o">=</span> <span class="n">MetricsTest</span><span class="o">.</span><span class="na">folder</span><span class="o">(</span>
      <span class="n">dir</span><span class="o">,</span>
      <span class="s">&quot;alpha.txt:Three words here&quot;</span><span class="o">,</span>
      <span class="s">&quot;beta.txt:two words&quot;</span>
      <span class="s">&quot;gamma.txt:one!&quot;</span>
    <span class="o">);</span>
    <span class="k">try</span> <span class="o">{</span>
      <span class="n">assertEquals</span><span class="o">(</span><span class="mi">6</span><span class="o">,</span> <span class="k">new</span> <span class="n">Metrics</span><span class="o">(</span><span class="n">folder</span><span class="o">).</span><span class="na">wc</span><span class="o">());</span>
    <span class="o">}</span> <span class="k">finally</span> <span class="o">{</span>
      <span class="n">FileUtils</span><span class="o">.</span><span class="na">deleteDirectory</span><span class="o">(</span><span class="n">dir</span><span class="o">);</span>
    <span class="o">}</span>
  <span class="o">}</span>
  <span class="kd">private</span> <span class="kd">static</span> <span class="n">Folder</span> <span class="nf">folder</span><span class="o">(</span><span class="n">File</span> <span class="n">dir</span><span class="o">,</span> <span class="n">String</span><span class="o">...</span> <span class="n">parts</span><span class="o">)</span> <span class="o">{</span>
    <span class="n">Folder</span> <span class="n">folder</span> <span class="o">=</span> <span class="k">new</span> <span class="n">DiscFolder</span><span class="o">(</span><span class="n">dir</span><span class="o">);</span>
    <span class="k">for</span> <span class="o">(</span><span class="kd">final</span> <span class="n">String</span> <span class="n">part</span> <span class="o">:</span> <span class="n">parts</span><span class="o">)</span> <span class="o">{</span>
      <span class="kd">final</span> <span class="n">String</span><span class="o">[]</span> <span class="n">pair</span> <span class="o">=</span> <span class="n">part</span><span class="o">.</span><span class="na">split</span><span class="o">(</span><span class="s">&quot;:&quot;</span><span class="o">,</span> <span class="mi">2</span><span class="o">);</span>
      <span class="k">this</span><span class="o">.</span><span class="na">folder</span><span class="o">.</span><span class="na">save</span><span class="o">(</span><span class="n">pair</span><span class="o">[</span><span class="mi">0</span><span class="o">],</span> <span class="n">pair</span><span class="o">[</span><span class="mi">1</span><span class="o">]);</span>
    <span class="o">}</span>
    <span class="k">return</span> <span class="n">folder</span><span class="o">;</span>
  <span class="o">}</span>
<span class="o">}</span></code></pre></figure><p>Does it look better now? We&#39;re not there yet, but now our test methods are perfectly isolated. If I want to change one of them, I&#39;m not going to affect the others because I pass all configuration parameters to a private static utility (!) method <code>folder()</code>.</p><p>A utility method, huh? Yes, <a href="/2014/05/05/oop-alternative-to-utility-classes.html">it smells</a>.</p><p>The main issue with this design, even though it is way better than the previous one, is that it doesn&#39;t prevent code duplication between test &quot;classes.&quot; If I need a similar test fixture of type <code>Folder</code> in another test case, I will have to move this static method there. Or even worse, I will have to create a utility class. Yes, there is <a href="/2015/02/20/utility-classes-vs-functional-programming.html">nothing worse</a> in object-oriented programming than utility classes.</p><p>A much better design would be to use &quot;<a href="/2014/09/23/built-in-fake-objects.html">fake</a>&quot; objects instead of private static utilities. Here is how. First, we create a fake class and place it into <code>src/main/java</code>. This class can be used in tests and also in production code, if necessary (<code>Fk</code> for &quot;fake&quot;):</p><figure class="highlight"><pre><code class="language-java" data-lang="java"><span></span><span class="kd">public</span> <span class="kd">final</span> <span class="kd">class</span> <span class="nc">FkFolder</span> <span class="kd">implements</span> <span class="n">Folder</span><span class="o">,</span> <span class="n">Closeable</span> <span class="o">{</span>
  <span class="kd">private</span> <span class="kd">final</span> <span class="n">File</span> <span class="n">dir</span><span class="o">;</span>
  <span class="kd">private</span> <span class="kd">final</span> <span class="n">String</span><span class="o">[]</span> <span class="n">parts</span><span class="o">;</span>
  <span class="kd">public</span> <span class="nf">FkFolder</span><span class="o">(</span><span class="n">String</span><span class="o">...</span> <span class="n">prts</span><span class="o">)</span> <span class="o">{</span>
    <span class="k">this</span><span class="o">(</span><span class="n">Files</span><span class="o">.</span><span class="na">createTempDirectory</span><span class="o">(</span><span class="s">&quot;test-1&quot;</span><span class="o">),</span> <span class="n">parts</span><span class="o">);</span>
  <span class="o">}</span>
  <span class="kd">public</span> <span class="nf">FkFolder</span><span class="o">(</span><span class="n">File</span> <span class="n">file</span><span class="o">,</span> <span class="n">String</span><span class="o">...</span> <span class="n">prts</span><span class="o">)</span> <span class="o">{</span>
    <span class="k">this</span><span class="o">.</span><span class="na">dir</span> <span class="o">=</span> <span class="n">file</span><span class="o">;</span>
    <span class="k">this</span><span class="o">.</span><span class="na">parts</span> <span class="o">=</span> <span class="n">parts</span><span class="o">;</span>
  <span class="o">}</span>
  <span class="nd">@Override</span>
  <span class="kd">public</span> <span class="n">Iterable</span><span class="o">&lt;</span><span class="n">File</span><span class="o">&gt;</span> <span class="nf">files</span><span class="o">()</span> <span class="o">{</span>
    <span class="kd">final</span> <span class="n">Folder</span> <span class="n">folder</span> <span class="o">=</span> <span class="k">new</span> <span class="n">DiscFolder</span><span class="o">(</span><span class="k">this</span><span class="o">.</span><span class="na">dir</span><span class="o">);</span>
    <span class="k">for</span> <span class="o">(</span><span class="kd">final</span> <span class="n">String</span> <span class="n">part</span> <span class="o">:</span> <span class="k">this</span><span class="o">.</span><span class="na">parts</span><span class="o">)</span> <span class="o">{</span>
      <span class="kd">final</span> <span class="n">String</span><span class="o">[]</span> <span class="n">pair</span> <span class="o">=</span> <span class="n">part</span><span class="o">.</span><span class="na">split</span><span class="o">(</span><span class="s">&quot;:&quot;</span><span class="o">,</span> <span class="mi">2</span><span class="o">);</span>
      <span class="n">folder</span><span class="o">.</span><span class="na">save</span><span class="o">(</span><span class="n">pair</span><span class="o">[</span><span class="mi">0</span><span class="o">],</span> <span class="n">pair</span><span class="o">[</span><span class="mi">1</span><span class="o">]);</span>
    <span class="o">}</span>
    <span class="k">return</span> <span class="n">folder</span><span class="o">.</span><span class="na">files</span><span class="o">();</span>
  <span class="o">}</span>
  <span class="nd">@Override</span>
  <span class="kd">public</span> <span class="kt">void</span> <span class="nf">close</span><span class="o">()</span> <span class="o">{</span>
    <span class="n">FileUtils</span><span class="o">.</span><span class="na">deleteDirectory</span><span class="o">(</span><span class="k">this</span><span class="o">.</span><span class="na">dir</span><span class="o">);</span>
  <span class="o">}</span>
<span class="o">}</span></code></pre></figure><p>Here is how our test will look now:</p><figure class="highlight"><pre><code class="language-java" data-lang="java"><span></span><span class="kd">public</span> <span class="kd">final</span> <span class="kd">class</span> <span class="nc">MetricsTest</span> <span class="o">{</span>
  <span class="nd">@Test</span>
  <span class="kd">public</span> <span class="kt">void</span> <span class="nf">calculatesTotalSize</span><span class="o">()</span> <span class="o">{</span>
    <span class="kd">final</span> <span class="n">String</span><span class="o">[]</span> <span class="n">parts</span> <span class="o">=</span> <span class="o">{</span>
      <span class="s">&quot;first.txt:Hello, world!&quot;</span><span class="o">,</span>
      <span class="s">&quot;second.txt:Goodbye!&quot;</span>
    <span class="o">};</span>
    <span class="k">try</span> <span class="o">(</span><span class="kd">final</span> <span class="n">Folder</span> <span class="n">folder</span> <span class="o">=</span> <span class="k">new</span> <span class="n">FkFolder</span><span class="o">(</span><span class="n">parts</span><span class="o">))</span> <span class="o">{</span>
      <span class="n">assertEquals</span><span class="o">(</span><span class="mi">22</span><span class="o">,</span> <span class="k">new</span> <span class="n">Metrics</span><span class="o">(</span><span class="n">folder</span><span class="o">).</span><span class="na">size</span><span class="o">());</span>
    <span class="o">}</span>
  <span class="o">}</span>
  <span class="nd">@Test</span>
  <span class="kd">public</span> <span class="kt">void</span> <span class="nf">countsWordsInFiles</span><span class="o">()</span> <span class="o">{</span>
    <span class="kd">final</span> <span class="n">String</span><span class="o">[]</span> <span class="n">parts</span> <span class="o">=</span> <span class="o">{</span>
      <span class="s">&quot;alpha.txt:Three words here&quot;</span><span class="o">,</span>
      <span class="s">&quot;beta.txt:two words&quot;</span>
      <span class="s">&quot;gamma.txt:one!&quot;</span>
    <span class="o">};</span>
    <span class="k">try</span> <span class="o">(</span><span class="kd">final</span> <span class="n">Folder</span> <span class="n">folder</span> <span class="o">=</span> <span class="k">new</span> <span class="n">FkFolder</span><span class="o">(</span><span class="n">parts</span><span class="o">))</span> <span class="o">{</span>
      <span class="n">assertEquals</span><span class="o">(</span><span class="mi">6</span><span class="o">,</span> <span class="k">new</span> <span class="n">Metrics</span><span class="o">(</span><span class="n">folder</span><span class="o">).</span><span class="na">wc</span><span class="o">());</span>
    <span class="o">}</span>
  <span class="o">}</span>
<span class="o">}</span></code></pre></figure><p>What do you think? Isn&#39;t it better than what JUnit offers? Isn&#39;t it more reusable and extensible than utility methods?</p><p>To summarize, I believe scaffolding in unit testing must be done through <a href="/2014/09/23/built-in-fake-objects.html">fake objects</a> that are shipped together with production code.</p></div></article></div><div class="wrapper"> <related-posts /></div><div class="disqus" role="complementary"><p class="disqus_hint"> Please, use <a href="https://help.disqus.com/commenting/what-html-tags-are-allowed-within-comments">syntax highlighting</a> in your comments, to make them more readable.</p><div id="disqus_thread" class="disqus-thread"> <a>&nbsp;</a></div><script> var disqus_config = function () { this.page.url = document.location.href.split('?')[0].split('#')[0].replace('https://', 'http://'); this.page.identifier = this.page.url; }; (function() { var d = document, s = d.createElement('script'); s.src = '//yegor256.disqus.com/embed.js'; s.setAttribute('data-timestamp', +new Date()); (d.head || d.body).appendChild(s); })(); </script> <noscript><div><p class="red"> JavaScript is disabled in your browser, that's why you can't see comments under this post.</p></div></noscript></div><div class="wrapper"> <footer class="footer"><p> &copy; <span itemscope="" itemprop="copyrightHolder" itemtype="http://schema.org/Person"> <span itemprop="name">Yegor Bugayenko</span> </span> 2014&ndash;<span itemprop="copyrightYear">2018</span></p></footer></div></section><div class="wrapper unprintable" style="text-align:center;margin-top:2em;"> <a href="http://www.sixnines.io/h/3ba1652f"> <img src="//www.sixnines.io/b/3ba1652f?style=flat" alt="sixnines availability badge"/> </a></div><script src="//code.jquery.com/jquery-1.9.0.min.js"></script> <script src="/js/all.js?a0e0d018c07"></script> <script>var disqus_shortname = 'yegor256';</script> <script id="dsq-count-scr" src="//yegor256.disqus.com/count.js" async="async"></script> <script> (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){ (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o), m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m) })(window,document,'script','//www.google-analytics.com/analytics.js','ga'); ga('create', 'UA-1963507-32', 'auto'); ga('send', 'pageview'); </script> <script> Cd=document;Cr="&"+Math.random();Cp="&s=1"; Cd.cookie="b=b";if(Cd.cookie)Cp+="&c=1"; Cp+="&t="+(new Date()).getTimezoneOffset(); if(self!=top)Cp+="&f=1"; </script> <script> if(navigator.javaEnabled())Cp+="&j=1"; </script> <script> if(typeof(screen)!='undefined')Cp+="&w="+screen.width+"&h="+ screen.height+"&d="+(screen.colorDepth?screen.colorDepth:screen.pixelDepth); </script> <script> Cd.write("<img src='//c.hit.ua/hit?i=95870&g=0&x=2"+Cp+Cr+ "&r="+escape(Cd.referrer)+"&u="+escape(window.location.href)+ "' border='0' wi"+"dth='1' he"+"ight='1'/>"); </script> <script type="application/ld+json"> { "@context": "http://schema.org", "@type": "Person", "name": "Yegor Bugayenko", "url": "http://www.yegor256.com", "sameAs": [ "https://www.facebook.com/yegor256", "https://instagram.com/yegor256", "https://www.linkedin.com/in/yegor256", "https://twitter.com/yegor256", "https://github.com/yegor256", "https://www.pinterest.com/yegor256/" ] } </script> </body> </html> <!DOCTYPE html> <html xmlns="http://www.w3.org/1999/xhtml" lang="en-US" xml:lang="en-US" itemscope="" itemtype="http://schema.org/WebSite"> <head> <meta charset="utf-8"/> <meta name="description" content="It is a bad idea to put executing statements into class constructors because that leads to side effects and uncontrollable behavior. " /> <meta name="keywords" content="best practices java constructors, constructors in java, how much code in constructors, how much code to put into constructors, oop constructors best practices" /> <meta name="viewport" content="width=device-width,minimum-scale=1,initial-scale=1"/> <meta name="google-site-verification" content="JEj_gQr2CPe2QKGw8XdMz0R7VboQIUbX3FlM-lwTq-8" /> <meta name="author" content="Yegor Bugayenko"> <meta name="article:published_time" content="2015-05-07 00:00:00 +0000"> <meta name="og:site_name" content="Yegor Bugayenko"/> <meta name="og:type" content="article" /> <meta name="og:locale" content="en_US" /> <meta name="twitter:account_id" content="4503599630178231" /> <meta name="twitter:creator" content="@yegor256"/> <meta name="twitter:site" content="@yegor256"/> <meta name="twitter:title" property="og:title" content="Constructors Must Be Code-Free"/> <meta name="twitter:description" property="og:description" content="It is a bad idea to put executing statements into class constructors because that leads to side effects and uncontrollable behavior. "/> <meta name="twitter:url" property="og:url" content="https://www.yegor256.com/2015/05/07/ctors-must-be-code-free.html"/> <meta name="telegram:channel" content="AAAAAEJFMRzsRTRxM3ec6A"/> <link rel="search" type="application/opensearchdescription+xml" href="/opensearch.xml" title="yegor256" /> <link rel="shortcut icon" href="/favicon.ico?a0e0d018c07"/> <link rel="apple-touch-icon" href="/favicon.ico?a0e0d018c07"/> <link rel="alternate" type="application/rss+xml" title="RSS for yegor256.com" href="https://www.yegor256.com/rss.xml"/> <link rel="stylesheet" href="/css/layout.css?a0e0d018c07"/> <link rel="stylesheet" href="/css/icons.css?a0e0d018c07"/> <link rel="canonical" href="https://www.yegor256.com/2015/05/07/ctors-must-be-code-free.html" /> <link rel="amphtml" href="https://www.yegor256.com/2015/05/07/ctors-must-be-code-free.amp.html" /> <title>Constructors Must Be Code-Free </title> <meta name='og:image' content='https://www.yegor256.com/images/2015/05/kill-bill.jpg'/><meta name='twitter:image' content='https://www.yegor256.com/images/2015/05/kill-bill.jpg'/><meta name='og:image:width' content='1694'/> <meta name='twitter:image:width' content='1694'/><meta name='og:image:height' content='718'/> <meta name='twitter:image:height' content='718'/><meta name='twitter:card' content='summary_large_image'/><meta name='twitter:image:alt' content='Kill Bill: Vol. 2 (2004) by Quentin Tarantino'/> </head> <body><div class="wrapper"> <aside class="header-toggle unprintable" id="header-toggle" title="Show the menu" onclick="$('#header').show();$('#header-toggle').hide();">&#9776;</aside> <header class="header" id="header"><div class="face"> <a href="/about-me.html#form" class="sub" title="Click to subscribe to my monthly newsletter"><span>Subscribe</span></a> <a href="/about-me.html" style="position:relative;"> <img src="/images/face-256x256.jpg" class="photo" alt="Yegor Bugayenko"/> </a></div><nav><ul class="menu social notranslate"> <li><a href="https://twitter.com/intent/follow?screen_name=yegor256" rel="nofollow" title="Follow me on Twitter"><i class="icon icon-twitter notranslate" aria-hidden="true"></i></a></li> <li><a href="/rss.xml" rel="nofollow" title="Subscribe to my RSS feed"><i class="icon icon-rss notranslate" aria-hidden="true"></i></a></li> <li><a itemprop="sameAs" href="https://github.com/yegor256" rel="nofollow" title="My GitHub profile"><i class="icon icon-github notranslate" aria-hidden="true"></i></a></li> <li><a itemprop="sameAs" href="http://stackoverflow.com/users/187141/yegor256" rel="nofollow" title="My StackOverflow profile"><i class="icon icon-stackoverflow notranslate" aria-hidden="true"></i></a></li> <li><a itemprop="sameAs" href="https://www.facebook.com/yegor256" rel="nofollow" title="Follow me on Facebook"><i class="icon icon-facebook notranslate" aria-hidden="true"></i></a></li> <li><a itemprop="sameAs" href="https://instagram.com/yegor256" rel="nofollow" title="Follow me on Instagram"><i class="icon icon-instagram notranslate" aria-hidden="true"></i></a></li> <li><a itemprop="sameAs" href="https://www.linkedin.com/in/yegor256" rel="nofollow" title="My LinkedIn profile"><i class="icon icon-linkedin notranslate" aria-hidden="true"></i></a></li> <li><a itemprop="sameAs" href="https://www.youtube.com/c/yegor256?sub_confirmation=1" rel="nofollow" title="My Youtube video channel"><i class="icon icon-youtube notranslate" aria-hidden="true"></i></a></li> <li><a itemprop="sameAs" href="https://www.pinterest.com/yegor256/" rel="nofollow" title="My Pinterest boards"><i class="icon icon-pinterest notranslate" aria-hidden="true"></i></a></li> <li><a itemprop="sameAs" href="https://angel.co/yegor256" rel="nofollow" title="My AngelList profile"><i class="icon icon-angellist notranslate" aria-hidden="true"></i></a></li> <li><a href="https://soundcloud.com/yegor256" rel="nofollow" title="My podcast"><i class="icon icon-podcast notranslate" aria-hidden="true"></i></a></li> <li><a href="https://itunes.apple.com/us/podcast/yegor256-podcast/id1150826721" rel="nofollow" title="My iTunes podcast"><i class="icon icon-itunes notranslate" aria-hidden="true"></i></a></li> <li><a href="https://t.me/joinchat/AAAAAEJFMRzsRTRxM3ec6A" rel="nofollow" title="My Telegram public channel"><i class="icon icon-telegram notranslate" aria-hidden="true"></i></a></li> <li><a href="mailto:blog@yegor256.com" rel="nofollow" title="Email me any time"><i class="icon icon-mail notranslate" aria-hidden="true"></i></a></li></ul><ul class="menu"> <li><a href="/" title="Home page">Home</a></li> <li ><a href="/best.html" title="Best articles to read">12&#160;Best</a></li> <li ><a href="/contents.html" title="The contents of the entire blog">All&#160;288</a></li> <li ><a href="/webinars.html" title="My webinars">Webinars</a></li> <li ><a href="/talks.html" title="Future and past conference talks">Talks</a></li> <li ><a href="/books.html" title="The books I wrote">Books</a></li> <li ><a href="/papers.html" title="My academic papers and patents">Papers</a></li> <li ><a href="/pets.html" title="My loved pet projects">Pets</a></li> <li ><a href="/award.html" title="Software quality award">Award</a></li> <li ><a href="/testimonials.html" title="What some people say about me">Testimonials</a></li> <li ><a href="/shift-m.html" title="Audio podcast about project management">Shift-M</a></li> <li ><a href="/paintings.html" title="My paintings for sale">Paintings</a></li> <li><a href="http://ru.yegor256.com/" title="Немного на русском языке">По-русски</a></li></ul></nav><div class="search"> <form method="get" action="https://www.google.com/search" itemprop="potentialAction" itemscope="" itemtype="http://schema.org/SearchAction"> <meta itemprop="target" content="https://www.google.com/search?q={q}"/> <input name="sitesearch" value="yegor256.com" type="hidden"/> <input itemprop="query-input" type="text" id="search-query" class="field field-text" required="required" onfocus="$('.google').css('visibility', 'visible');" name="q" placeholder="Search..." autocomplete="off"/> <input type="image" src="/images/google-search-icon.svg" class="google" title="Search via Google" alt="Search via Google"/> </form></div><div class="hot"><ul> <li> <a href="/code-ahead.html">Code Ahead</a> was published on Amazon just a few days ago! It is my new book, a novel about programmers. It explains in details the majority of ideas that stand behind <a href="https://www.zerocracy.com">Zerocracy</a> and <a href="https://www.xdsd.org">XDSD</a>. </li> <li> At <a href="/webinars.html">Webinar #37</a> we will discuss naming problem in OOP, for objects, methods and attributes; join us on <b>September 12</b>, at 11am PST. </li></ul></div></header></div><section itemscope="" itemtype="http://schema.org/BlogPosting"><div class="wrapper"> <header><p class="printable"> <img src="https://api.qrserver.com/v1/create-qr-code/?data=https://www.yegor256.com/2015/05/07/ctors-must-be-code-free.html&amp;format=svg" style="width:125px;height:125px;" alt="QR code"/></p><p class="printable"> <code itemprop="url">https://www.yegor256.com/2015/05/07/ctors-must-be-code-free.html</code></p><h1 itemprop="name headline mainEntityOfPage">Constructors Must Be Code-Free</h1><aside class='book'><a href='http://amzn.to/2qFt4Tn'><img src='/images/books/elegant-objects/cover.png' class='book-cover' alt='book cover'/></a>Read more about this subject in <a href='http://amzn.to/2qFt4Tn'>Section&nbsp;1.3</a><br/> of my book<a href='http://amzn.to/2qFt4Tn'><img src='/images/books/amazon-buy-button.png' class='amazon-button' alt='Click to buy'/></a></aside><ul class="subline"> <li> <time itemprop="datePublished" datetime="2015-05-07T00:00:00+00:00"> 7 May 2015 </time> </li> <li class="printable" itemscope="" itemprop="author" itemtype="http://schema.org/Person"> <span itemprop="name">Yegor Bugayenko</span> </li> <li class="unprintable"> <i class="icon icon-comments"></i> <a href="http://www.yegor256.com/2015/05/07/ctors-must-be-code-free.html#disqus_thread" itemprop="discussionUrl">comments</a> </li></ul><p class="unprintable"><p>How much work should be done within a constructor? It seems reasonable to do some computations inside a constructor and then encapsulate results. That way, when the results are required by object methods, we&#39;ll have them ready. Sounds like a good approach? No, it&#39;s not. It&#39;s a bad idea for one reason: It prevents composition of objects and makes them un-extensible.</p><figure class='jb_picture'><img itemprop='image' alt='Kill Bill: Vol. 2 (2004) by Quentin Tarantino' src='/images/2015/05/kill-bill.jpg' longdesc='#780fae47'/><figcaption id='780fae47'>Kill Bill: Vol. 2 (2004) by Quentin Tarantino</figcaption></figure><p>Let&#39;s say we&#39;re making an interface that would represent a name of a person:</p><figure class="highlight"><pre><code class="language-java" data-lang="java"><span></span><span class="kd">interface</span> <span class="nc">Name</span> <span class="o">{</span>
  <span class="n">String</span> <span class="nf">first</span><span class="o">();</span>
<span class="o">}</span></code></pre></figure><p>Pretty easy, right? Now, let&#39;s try to implement it:</p><figure class="highlight"><pre><code class="language-java" data-lang="java"><span></span><span class="kd">public</span> <span class="kd">final</span> <span class="kd">class</span> <span class="nc">EnglishName</span> <span class="kd">implements</span> <span class="n">Name</span> <span class="o">{</span>
  <span class="kd">private</span> <span class="kd">final</span> <span class="n">String</span> <span class="n">name</span><span class="o">;</span>
  <span class="kd">public</span> <span class="nf">EnglishName</span><span class="o">(</span><span class="kd">final</span> <span class="n">CharSequence</span> <span class="n">text</span><span class="o">)</span> <span class="o">{</span>
    <span class="k">this</span><span class="o">.</span><span class="na">name</span> <span class="o">=</span> <span class="n">text</span><span class="o">.</span><span class="na">toString</span><span class="o">().</span><span class="na">split</span><span class="o">(</span><span class="s">&quot; &quot;</span><span class="o">,</span> <span class="mi">2</span><span class="o">)[</span><span class="mi">0</span><span class="o">];</span>
  <span class="o">}</span>
  <span class="nd">@Override</span>
  <span class="kd">public</span> <span class="n">String</span> <span class="nf">first</span><span class="o">()</span> <span class="o">{</span>
    <span class="k">return</span> <span class="k">this</span><span class="o">.</span><span class="na">name</span><span class="o">;</span>
  <span class="o">}</span>
<span class="o">}</span></code></pre></figure><p>What&#39;s wrong with this? It&#39;s faster, right? It splits the name into parts only once and encapsulates them. Then, no matter how many times we call the <code>first()</code> method, it will return the same value and won&#39;t need to do the splitting again. However, this is flawed thinking! Let me show you the right way and explain:</p><figure class="highlight"><pre><code class="language-java" data-lang="java"><span></span><span class="kd">public</span> <span class="kd">final</span> <span class="kd">class</span> <span class="nc">EnglishName</span> <span class="kd">implements</span> <span class="n">Name</span> <span class="o">{</span>
  <span class="kd">private</span> <span class="kd">final</span> <span class="n">CharSequence</span> <span class="n">text</span><span class="o">;</span>
  <span class="kd">public</span> <span class="nf">EnglishName</span><span class="o">(</span><span class="kd">final</span> <span class="n">CharSequence</span> <span class="n">txt</span><span class="o">)</span> <span class="o">{</span>
    <span class="k">this</span><span class="o">.</span><span class="na">text</span> <span class="o">=</span> <span class="n">txt</span><span class="o">;</span>
  <span class="o">}</span>
  <span class="nd">@Override</span>
  <span class="kd">public</span> <span class="n">String</span> <span class="nf">first</span><span class="o">()</span> <span class="o">{</span>
    <span class="k">return</span> <span class="k">this</span><span class="o">.</span><span class="na">text</span><span class="o">.</span><span class="na">toString</span><span class="o">().</span><span class="na">split</span><span class="o">(</span><span class="s">&quot;&quot;</span><span class="o">,</span> <span class="mi">2</span><span class="o">)[</span><span class="mi">0</span><span class="o">];</span>
  <span class="o">}</span>
<span class="o">}</span></code></pre></figure><p>This is the right design. I can see you smiling, so let me prove my point.</p><p>Before I start proving, though, let me ask you to read this article: <a href="/2015/02/26/composable-decorators.html">Composable Decorators vs. Imperative Utility Methods</a>. It explains the difference between a static method and composable decorators. The first snippet above is very close to an imperative utility method, even though it looks like an object. The second example is a true object.</p><aside class='youtube'> <a href='https://www.youtube.com/watch?v=9yjtsCK6Wdk'><div class='box'> <img src='https://i.ytimg.com/vi/9yjtsCK6Wdk/mqdefault.jpg' alt='YouTube video #9yjtsCK6Wdk'/><div class='play'><i class='icon icon-play'></i></div></div></a><div>A Few Thoughts About Constructors in OOP (webinar #7); 7 October 2015.</div></aside><p>In the first example, we are abusing the <code>new</code> operator and turning it into a static method, which does all calculations for us <em>right here and now</em>. This is what <em>imperative</em> programming is about. In imperative programming, we do all calculations right now and return fully ready results. In declarative programming, we are instead trying to delay calculations for as long as possible.</p><p>Let&#39;s try to use our <code>EnglishName</code> class:</p><figure class="highlight"><pre><code class="language-java" data-lang="java"><span></span><span class="kd">final</span> <span class="n">Name</span> <span class="n">name</span> <span class="o">=</span> <span class="k">new</span> <span class="n">EnglishName</span><span class="o">(</span>
  <span class="k">new</span> <span class="n">NameInPostgreSQL</span><span class="o">(</span><span class="cm">/*...*/</span><span class="o">)</span>
<span class="o">);</span>
<span class="k">if</span> <span class="o">(</span><span class="cm">/* something goes wrong */</span><span class="o">)</span> <span class="o">{</span>
  <span class="k">throw</span> <span class="k">new</span> <span class="n">IllegalStateException</span><span class="o">(</span>
    <span class="n">String</span><span class="o">.</span><span class="na">format</span><span class="o">(</span>
      <span class="s">&quot;Hi, %s, we can&#39;t proceed with your application&quot;</span><span class="o">,</span>
      <span class="n">name</span><span class="o">.</span><span class="na">first</span><span class="o">()</span>
    <span class="o">)</span>
  <span class="o">);</span>
<span class="o">}</span></code></pre></figure><p>In the first line of this snippet, we are just making an instance of an object and labeling it <code>name</code>. We don&#39;t want to go to the database yet and fetch the full name from there, split it into parts, and encapsulate them inside <code>name</code>. We just want to create an instance of an object. Such a parsing behavior would be a side effect for us and, in this case, will slow down the application. As you see, we may only need <code>name.first()</code> if something goes wrong and we need to construct an exception object.</p><p>My point is that having <strong>any</strong> computations done inside a constructor is a bad practice and must be avoided because they are side effects and are not requested by the object owner.</p><p>What about performance during the re-use of <code>name</code>, you may ask. If we make an instance of <code>EnglishName</code> and then call <code>name.first()</code> five times, we&#39;ll end up with five calls to the <code>String.split()</code> method.</p><p>To solve that, we create another class, a <a href="/2015/02/26/composable-decorators.html">composable decorator</a>, which will help us solve this &quot;re-use&quot; problem:</p><figure class="highlight"><pre><code class="language-java" data-lang="java"><span></span><span class="kd">public</span> <span class="kd">final</span> <span class="kd">class</span> <span class="nc">CachedName</span> <span class="kd">implements</span> <span class="n">Name</span> <span class="o">{</span>
  <span class="kd">private</span> <span class="kd">final</span> <span class="n">Name</span> <span class="n">origin</span><span class="o">;</span>
  <span class="kd">public</span> <span class="nf">CachedName</span><span class="o">(</span><span class="kd">final</span> <span class="n">Name</span> <span class="n">name</span><span class="o">)</span> <span class="o">{</span>
    <span class="k">this</span><span class="o">.</span><span class="na">origin</span> <span class="o">=</span> <span class="n">name</span><span class="o">;</span>
  <span class="o">}</span>
  <span class="nd">@Override</span>
  <span class="nd">@Cacheable</span><span class="o">(</span><span class="n">forever</span> <span class="o">=</span> <span class="kc">true</span><span class="o">)</span>
  <span class="kd">public</span> <span class="n">String</span> <span class="nf">first</span><span class="o">()</span> <span class="o">{</span>
    <span class="k">return</span> <span class="k">this</span><span class="o">.</span><span class="na">origin</span><span class="o">.</span><span class="na">first</span><span class="o">();</span>
  <span class="o">}</span>
<span class="o">}</span></code></pre></figure><p>I&#39;m using the <a href="http://aspects.jcabi.com/annotation-cacheable.html"><code>Cacheable</code></a> annotation from <a href="http://aspects.jcabi.com/">jcabi-aspects</a>, but you can use any other caching tools available in Java (or other languages), like <a href="https://code.google.com/p/guava-libraries/wiki/CachesExplained">Guava Cache</a>:</p><figure class="highlight"><pre><code class="language-java" data-lang="java"><span></span><span class="kd">public</span> <span class="kd">final</span> <span class="kd">class</span> <span class="nc">CachedName</span> <span class="kd">implements</span> <span class="n">Name</span> <span class="o">{</span>
  <span class="kd">private</span> <span class="kd">final</span> <span class="n">Cache</span><span class="o">&lt;</span><span class="n">Long</span><span class="o">,</span> <span class="n">String</span><span class="o">&gt;</span> <span class="n">cache</span> <span class="o">=</span>
    <span class="n">CacheBuilder</span><span class="o">.</span><span class="na">newBuilder</span><span class="o">().</span><span class="na">build</span><span class="o">();</span>
  <span class="kd">private</span> <span class="kd">final</span> <span class="n">Name</span> <span class="n">origin</span><span class="o">;</span>
  <span class="kd">public</span> <span class="nf">CachedName</span><span class="o">(</span><span class="kd">final</span> <span class="n">Name</span> <span class="n">name</span><span class="o">)</span> <span class="o">{</span>
    <span class="k">this</span><span class="o">.</span><span class="na">origin</span> <span class="o">=</span> <span class="n">name</span><span class="o">;</span>
  <span class="o">}</span>
  <span class="nd">@Override</span>
  <span class="kd">public</span> <span class="n">String</span> <span class="nf">first</span><span class="o">()</span> <span class="o">{</span>
    <span class="k">return</span> <span class="k">this</span><span class="o">.</span><span class="na">cache</span><span class="o">.</span><span class="na">get</span><span class="o">(</span>
      <span class="mi">1L</span><span class="o">,</span>
      <span class="k">new</span> <span class="n">Callable</span><span class="o">&lt;</span><span class="n">String</span><span class="o">&gt;()</span> <span class="o">{</span>
        <span class="nd">@Override</span>
        <span class="kd">public</span> <span class="n">String</span> <span class="nf">call</span><span class="o">()</span> <span class="o">{</span>
          <span class="k">return</span> <span class="n">CachedName</span><span class="o">.</span><span class="na">this</span><span class="o">.</span><span class="na">origin</span><span class="o">.</span><span class="na">first</span><span class="o">();</span>
        <span class="o">}</span>
      <span class="o">}</span>
    <span class="o">);</span>
  <span class="o">}</span>
<span class="o">}</span></code></pre></figure><p>But please don&#39;t make <code>CachedName</code> mutable and lazily loaded---it&#39;s an anti-pattern, which I&#39;ve discussed before in <a href="/2014/06/09/objects-should-be-immutable.html">Objects Should Be Immutable</a>.</p><p>This is how our code will look now:</p><figure class="highlight"><pre><code class="language-java" data-lang="java"><span></span><span class="kd">final</span> <span class="n">Name</span> <span class="n">name</span> <span class="o">=</span> <span class="k">new</span> <span class="n">CachedName</span><span class="o">(</span>
  <span class="k">new</span> <span class="n">EnglishName</span><span class="o">(</span>
    <span class="k">new</span> <span class="n">NameInPostgreSQL</span><span class="o">(</span><span class="cm">/*...*/</span><span class="o">)</span>
  <span class="o">)</span>
<span class="o">);</span></code></pre></figure><p>It&#39;s a very primitive example, but I hope you get the idea.</p><p>In this design, we&#39;re basically splitting the object into two parts. The first one knows how to get the first name from the English name. The second one knows how to cache the results of this calculation in memory. And now it&#39;s my decision, as a user of these classes, how exactly to use them. I will decide whether I need caching or not. This is what object composition is all about.</p><p>Let me reiterate that the only allowed statement inside a constructor is an assignment. If you need to put something else there, start thinking about refactoring---your class definitely needs a redesign.</p></p><nav class="buttons notranslate desktop-only"> <a href="http://www.facebook.com/sharer/sharer.php?u=https://www.yegor256.com/2015/05/07/ctors-must-be-code-free.html" title="Share on Facebook" class="button" rel="nofollow"> <span class="count count-facebook">0</span> <i class="icon icon-facebook notranslate" aria-hidden="true"></i> </a> <a href="https://twitter.com/share?url=https://www.yegor256.com/2015/05/07/ctors-must-be-code-free.html&amp;text=Constructors+Must+Be+Code-Free" title="Share on Twitter" class="button" rel="nofollow"> <span class="count count-twitter">0</span> <i class="icon icon-twitter notranslate" aria-hidden="true"></i> </a> <a href="https://plus.google.com/share?url=https://www.yegor256.com/2015/05/07/ctors-must-be-code-free.html" title="Share on Google+" class="button" rel="nofollow"> <span class="count count-googleplus">0</span> <i class="icon icon-googleplus notranslate" aria-hidden="true"></i> </a> <a href="https://www.linkedin.com/cws/share?url=https://www.yegor256.com/2015/05/07/ctors-must-be-code-free.html" title="Share on LinkedIn" class="button" rel="nofollow"> <span class="count count-linkedin">0</span> <i class="icon icon-linkedin notranslate" aria-hidden="true"></i> </a> <a href="http://reddit.com/submit?url=https://www.yegor256.com/2015/05/07/ctors-must-be-code-free.html%3F2015-18&amp;title=Constructors+Must+Be+Code-Free" title="Share on Reddit" class="button" rel="nofollow"> <span class="count count-reddit">0</span> <i class="icon icon-reddit notranslate" aria-hidden="true"></i> </a> <a href="http://news.ycombinator.com/submitlink?u=https://www.yegor256.com/2015/05/07/ctors-must-be-code-free.html%3F2015-18&amp;t=Constructors+Must+Be+Code-Free" title="Share on Hacker News" class="button" rel="nofollow"> <span class="count count-hackernews">0</span> <i class="icon icon-hackernews notranslate" aria-hidden="true"></i> </a> </nav> </header> <article class="main" itemprop="articleBody"><div ><p>How much work should be done within a constructor? It seems reasonable to do some computations inside a constructor and then encapsulate results. That way, when the results are required by object methods, we&#39;ll have them ready. Sounds like a good approach? No, it&#39;s not. It&#39;s a bad idea for one reason: It prevents composition of objects and makes them un-extensible.</p><figure class='jb_picture'><img itemprop='image' alt='Kill Bill: Vol. 2 (2004) by Quentin Tarantino' src='/images/2015/05/kill-bill.jpg' longdesc='#780fae47'/><figcaption id='780fae47'>Kill Bill: Vol. 2 (2004) by Quentin Tarantino</figcaption></figure><p>Let&#39;s say we&#39;re making an interface that would represent a name of a person:</p><figure class="highlight"><pre><code class="language-java" data-lang="java"><span></span><span class="kd">interface</span> <span class="nc">Name</span> <span class="o">{</span>
  <span class="n">String</span> <span class="nf">first</span><span class="o">();</span>
<span class="o">}</span></code></pre></figure><p>Pretty easy, right? Now, let&#39;s try to implement it:</p><figure class="highlight"><pre><code class="language-java" data-lang="java"><span></span><span class="kd">public</span> <span class="kd">final</span> <span class="kd">class</span> <span class="nc">EnglishName</span> <span class="kd">implements</span> <span class="n">Name</span> <span class="o">{</span>
  <span class="kd">private</span> <span class="kd">final</span> <span class="n">String</span> <span class="n">name</span><span class="o">;</span>
  <span class="kd">public</span> <span class="nf">EnglishName</span><span class="o">(</span><span class="kd">final</span> <span class="n">CharSequence</span> <span class="n">text</span><span class="o">)</span> <span class="o">{</span>
    <span class="k">this</span><span class="o">.</span><span class="na">name</span> <span class="o">=</span> <span class="n">text</span><span class="o">.</span><span class="na">toString</span><span class="o">().</span><span class="na">split</span><span class="o">(</span><span class="s">&quot; &quot;</span><span class="o">,</span> <span class="mi">2</span><span class="o">)[</span><span class="mi">0</span><span class="o">];</span>
  <span class="o">}</span>
  <span class="nd">@Override</span>
  <span class="kd">public</span> <span class="n">String</span> <span class="nf">first</span><span class="o">()</span> <span class="o">{</span>
    <span class="k">return</span> <span class="k">this</span><span class="o">.</span><span class="na">name</span><span class="o">;</span>
  <span class="o">}</span>
<span class="o">}</span></code></pre></figure><p>What&#39;s wrong with this? It&#39;s faster, right? It splits the name into parts only once and encapsulates them. Then, no matter how many times we call the <code>first()</code> method, it will return the same value and won&#39;t need to do the splitting again. However, this is flawed thinking! Let me show you the right way and explain:</p><figure class="highlight"><pre><code class="language-java" data-lang="java"><span></span><span class="kd">public</span> <span class="kd">final</span> <span class="kd">class</span> <span class="nc">EnglishName</span> <span class="kd">implements</span> <span class="n">Name</span> <span class="o">{</span>
  <span class="kd">private</span> <span class="kd">final</span> <span class="n">CharSequence</span> <span class="n">text</span><span class="o">;</span>
  <span class="kd">public</span> <span class="nf">EnglishName</span><span class="o">(</span><span class="kd">final</span> <span class="n">CharSequence</span> <span class="n">txt</span><span class="o">)</span> <span class="o">{</span>
    <span class="k">this</span><span class="o">.</span><span class="na">text</span> <span class="o">=</span> <span class="n">txt</span><span class="o">;</span>
  <span class="o">}</span>
  <span class="nd">@Override</span>
  <span class="kd">public</span> <span class="n">String</span> <span class="nf">first</span><span class="o">()</span> <span class="o">{</span>
    <span class="k">return</span> <span class="k">this</span><span class="o">.</span><span class="na">text</span><span class="o">.</span><span class="na">toString</span><span class="o">().</span><span class="na">split</span><span class="o">(</span><span class="s">&quot;&quot;</span><span class="o">,</span> <span class="mi">2</span><span class="o">)[</span><span class="mi">0</span><span class="o">];</span>
  <span class="o">}</span>
<span class="o">}</span></code></pre></figure><p>This is the right design. I can see you smiling, so let me prove my point.</p><p>Before I start proving, though, let me ask you to read this article: <a href="/2015/02/26/composable-decorators.html">Composable Decorators vs. Imperative Utility Methods</a>. It explains the difference between a static method and composable decorators. The first snippet above is very close to an imperative utility method, even though it looks like an object. The second example is a true object.</p><aside class='youtube'> <a href='https://www.youtube.com/watch?v=9yjtsCK6Wdk'><div class='box'> <img src='https://i.ytimg.com/vi/9yjtsCK6Wdk/mqdefault.jpg' alt='YouTube video #9yjtsCK6Wdk'/><div class='play'><i class='icon icon-play'></i></div></div></a><div>A Few Thoughts About Constructors in OOP (webinar #7); 7 October 2015.</div></aside><p>In the first example, we are abusing the <code>new</code> operator and turning it into a static method, which does all calculations for us <em>right here and now</em>. This is what <em>imperative</em> programming is about. In imperative programming, we do all calculations right now and return fully ready results. In declarative programming, we are instead trying to delay calculations for as long as possible.</p><p>Let&#39;s try to use our <code>EnglishName</code> class:</p><figure class="highlight"><pre><code class="language-java" data-lang="java"><span></span><span class="kd">final</span> <span class="n">Name</span> <span class="n">name</span> <span class="o">=</span> <span class="k">new</span> <span class="n">EnglishName</span><span class="o">(</span>
  <span class="k">new</span> <span class="n">NameInPostgreSQL</span><span class="o">(</span><span class="cm">/*...*/</span><span class="o">)</span>
<span class="o">);</span>
<span class="k">if</span> <span class="o">(</span><span class="cm">/* something goes wrong */</span><span class="o">)</span> <span class="o">{</span>
  <span class="k">throw</span> <span class="k">new</span> <span class="n">IllegalStateException</span><span class="o">(</span>
    <span class="n">String</span><span class="o">.</span><span class="na">format</span><span class="o">(</span>
      <span class="s">&quot;Hi, %s, we can&#39;t proceed with your application&quot;</span><span class="o">,</span>
      <span class="n">name</span><span class="o">.</span><span class="na">first</span><span class="o">()</span>
    <span class="o">)</span>
  <span class="o">);</span>
<span class="o">}</span></code></pre></figure><p>In the first line of this snippet, we are just making an instance of an object and labeling it <code>name</code>. We don&#39;t want to go to the database yet and fetch the full name from there, split it into parts, and encapsulate them inside <code>name</code>. We just want to create an instance of an object. Such a parsing behavior would be a side effect for us and, in this case, will slow down the application. As you see, we may only need <code>name.first()</code> if something goes wrong and we need to construct an exception object.</p><p>My point is that having <strong>any</strong> computations done inside a constructor is a bad practice and must be avoided because they are side effects and are not requested by the object owner.</p><p>What about performance during the re-use of <code>name</code>, you may ask. If we make an instance of <code>EnglishName</code> and then call <code>name.first()</code> five times, we&#39;ll end up with five calls to the <code>String.split()</code> method.</p><p>To solve that, we create another class, a <a href="/2015/02/26/composable-decorators.html">composable decorator</a>, which will help us solve this &quot;re-use&quot; problem:</p><figure class="highlight"><pre><code class="language-java" data-lang="java"><span></span><span class="kd">public</span> <span class="kd">final</span> <span class="kd">class</span> <span class="nc">CachedName</span> <span class="kd">implements</span> <span class="n">Name</span> <span class="o">{</span>
  <span class="kd">private</span> <span class="kd">final</span> <span class="n">Name</span> <span class="n">origin</span><span class="o">;</span>
  <span class="kd">public</span> <span class="nf">CachedName</span><span class="o">(</span><span class="kd">final</span> <span class="n">Name</span> <span class="n">name</span><span class="o">)</span> <span class="o">{</span>
    <span class="k">this</span><span class="o">.</span><span class="na">origin</span> <span class="o">=</span> <span class="n">name</span><span class="o">;</span>
  <span class="o">}</span>
  <span class="nd">@Override</span>
  <span class="nd">@Cacheable</span><span class="o">(</span><span class="n">forever</span> <span class="o">=</span> <span class="kc">true</span><span class="o">)</span>
  <span class="kd">public</span> <span class="n">String</span> <span class="nf">first</span><span class="o">()</span> <span class="o">{</span>
    <span class="k">return</span> <span class="k">this</span><span class="o">.</span><span class="na">origin</span><span class="o">.</span><span class="na">first</span><span class="o">();</span>
  <span class="o">}</span>
<span class="o">}</span></code></pre></figure><p>I&#39;m using the <a href="http://aspects.jcabi.com/annotation-cacheable.html"><code>Cacheable</code></a> annotation from <a href="http://aspects.jcabi.com/">jcabi-aspects</a>, but you can use any other caching tools available in Java (or other languages), like <a href="https://code.google.com/p/guava-libraries/wiki/CachesExplained">Guava Cache</a>:</p><figure class="highlight"><pre><code class="language-java" data-lang="java"><span></span><span class="kd">public</span> <span class="kd">final</span> <span class="kd">class</span> <span class="nc">CachedName</span> <span class="kd">implements</span> <span class="n">Name</span> <span class="o">{</span>
  <span class="kd">private</span> <span class="kd">final</span> <span class="n">Cache</span><span class="o">&lt;</span><span class="n">Long</span><span class="o">,</span> <span class="n">String</span><span class="o">&gt;</span> <span class="n">cache</span> <span class="o">=</span>
    <span class="n">CacheBuilder</span><span class="o">.</span><span class="na">newBuilder</span><span class="o">().</span><span class="na">build</span><span class="o">();</span>
  <span class="kd">private</span> <span class="kd">final</span> <span class="n">Name</span> <span class="n">origin</span><span class="o">;</span>
  <span class="kd">public</span> <span class="nf">CachedName</span><span class="o">(</span><span class="kd">final</span> <span class="n">Name</span> <span class="n">name</span><span class="o">)</span> <span class="o">{</span>
    <span class="k">this</span><span class="o">.</span><span class="na">origin</span> <span class="o">=</span> <span class="n">name</span><span class="o">;</span>
  <span class="o">}</span>
  <span class="nd">@Override</span>
  <span class="kd">public</span> <span class="n">String</span> <span class="nf">first</span><span class="o">()</span> <span class="o">{</span>
    <span class="k">return</span> <span class="k">this</span><span class="o">.</span><span class="na">cache</span><span class="o">.</span><span class="na">get</span><span class="o">(</span>
      <span class="mi">1L</span><span class="o">,</span>
      <span class="k">new</span> <span class="n">Callable</span><span class="o">&lt;</span><span class="n">String</span><span class="o">&gt;()</span> <span class="o">{</span>
        <span class="nd">@Override</span>
        <span class="kd">public</span> <span class="n">String</span> <span class="nf">call</span><span class="o">()</span> <span class="o">{</span>
          <span class="k">return</span> <span class="n">CachedName</span><span class="o">.</span><span class="na">this</span><span class="o">.</span><span class="na">origin</span><span class="o">.</span><span class="na">first</span><span class="o">();</span>
        <span class="o">}</span>
      <span class="o">}</span>
    <span class="o">);</span>
  <span class="o">}</span>
<span class="o">}</span></code></pre></figure><p>But please don&#39;t make <code>CachedName</code> mutable and lazily loaded---it&#39;s an anti-pattern, which I&#39;ve discussed before in <a href="/2014/06/09/objects-should-be-immutable.html">Objects Should Be Immutable</a>.</p><p>This is how our code will look now:</p><figure class="highlight"><pre><code class="language-java" data-lang="java"><span></span><span class="kd">final</span> <span class="n">Name</span> <span class="n">name</span> <span class="o">=</span> <span class="k">new</span> <span class="n">CachedName</span><span class="o">(</span>
  <span class="k">new</span> <span class="n">EnglishName</span><span class="o">(</span>
    <span class="k">new</span> <span class="n">NameInPostgreSQL</span><span class="o">(</span><span class="cm">/*...*/</span><span class="o">)</span>
  <span class="o">)</span>
<span class="o">);</span></code></pre></figure><p>It&#39;s a very primitive example, but I hope you get the idea.</p><p>In this design, we&#39;re basically splitting the object into two parts. The first one knows how to get the first name from the English name. The second one knows how to cache the results of this calculation in memory. And now it&#39;s my decision, as a user of these classes, how exactly to use them. I will decide whether I need caching or not. This is what object composition is all about.</p><p>Let me reiterate that the only allowed statement inside a constructor is an assignment. If you need to put something else there, start thinking about refactoring---your class definitely needs a redesign.</p></div></article></div><div class="wrapper"> <related-posts /></div><div class="disqus" role="complementary"><p class="disqus_hint"> Please, use <a href="https://help.disqus.com/commenting/what-html-tags-are-allowed-within-comments">syntax highlighting</a> in your comments, to make them more readable.</p><div id="disqus_thread" class="disqus-thread"> <a>&nbsp;</a></div><script> var disqus_config = function () { this.page.url = document.location.href.split('?')[0].split('#')[0].replace('https://', 'http://'); this.page.identifier = this.page.url; }; (function() { var d = document, s = d.createElement('script'); s.src = '//yegor256.disqus.com/embed.js'; s.setAttribute('data-timestamp', +new Date()); (d.head || d.body).appendChild(s); })(); </script> <noscript><div><p class="red"> JavaScript is disabled in your browser, that's why you can't see comments under this post.</p></div></noscript></div><div class="wrapper"> <footer class="footer"><p> &copy; <span itemscope="" itemprop="copyrightHolder" itemtype="http://schema.org/Person"> <span itemprop="name">Yegor Bugayenko</span> </span> 2014&ndash;<span itemprop="copyrightYear">2018</span></p></footer></div></section><div class="wrapper unprintable" style="text-align:center;margin-top:2em;"> <a href="http://www.sixnines.io/h/3ba1652f"> <img src="//www.sixnines.io/b/3ba1652f?style=flat" alt="sixnines availability badge"/> </a></div><script src="//code.jquery.com/jquery-1.9.0.min.js"></script> <script src="/js/all.js?a0e0d018c07"></script> <script>var disqus_shortname = 'yegor256';</script> <script id="dsq-count-scr" src="//yegor256.disqus.com/count.js" async="async"></script> <script> (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){ (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o), m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m) })(window,document,'script','//www.google-analytics.com/analytics.js','ga'); ga('create', 'UA-1963507-32', 'auto'); ga('send', 'pageview'); </script> <script> Cd=document;Cr="&"+Math.random();Cp="&s=1"; Cd.cookie="b=b";if(Cd.cookie)Cp+="&c=1"; Cp+="&t="+(new Date()).getTimezoneOffset(); if(self!=top)Cp+="&f=1"; </script> <script> if(navigator.javaEnabled())Cp+="&j=1"; </script> <script> if(typeof(screen)!='undefined')Cp+="&w="+screen.width+"&h="+ screen.height+"&d="+(screen.colorDepth?screen.colorDepth:screen.pixelDepth); </script> <script> Cd.write("<img src='//c.hit.ua/hit?i=95870&g=0&x=2"+Cp+Cr+ "&r="+escape(Cd.referrer)+"&u="+escape(window.location.href)+ "' border='0' wi"+"dth='1' he"+"ight='1'/>"); </script> <script type="application/ld+json"> { "@context": "http://schema.org", "@type": "Person", "name": "Yegor Bugayenko", "url": "http://www.yegor256.com", "sameAs": [ "https://www.facebook.com/yegor256", "https://instagram.com/yegor256", "https://www.linkedin.com/in/yegor256", "https://twitter.com/yegor256", "https://github.com/yegor256", "https://www.pinterest.com/yegor256/" ] } </script> </body> </html> <!DOCTYPE html> <html xmlns="http://www.w3.org/1999/xhtml" lang="en-US" xml:lang="en-US" itemscope="" itemtype="http://schema.org/WebSite"> <head> <meta charset="utf-8"/> <meta name="description" content="Type casting and use of the instanceof operator, in particular, are terrible anti-patterns that diminish the entire idea of object-oriented programming. " /> <meta name="keywords" content="class casting, class casting in java, class casting is evil, instanceof, type casting in java" /> <meta name="viewport" content="width=device-width,minimum-scale=1,initial-scale=1"/> <meta name="google-site-verification" content="JEj_gQr2CPe2QKGw8XdMz0R7VboQIUbX3FlM-lwTq-8" /> <meta name="author" content="Yegor Bugayenko"> <meta name="article:published_time" content="2015-04-02 00:00:00 +0000"> <meta name="og:site_name" content="Yegor Bugayenko"/> <meta name="og:type" content="article" /> <meta name="og:locale" content="en_US" /> <meta name="twitter:account_id" content="4503599630178231" /> <meta name="twitter:creator" content="@yegor256"/> <meta name="twitter:site" content="@yegor256"/> <meta name="twitter:title" property="og:title" content="Class Casting Is a Discriminating Anti-Pattern"/> <meta name="twitter:description" property="og:description" content="Type casting and use of the instanceof operator, in particular, are terrible anti-patterns that diminish the entire idea of object-oriented programming. "/> <meta name="twitter:url" property="og:url" content="https://www.yegor256.com/2015/04/02/class-casting-is-anti-pattern.html"/> <meta name="telegram:channel" content="AAAAAEJFMRzsRTRxM3ec6A"/> <link rel="search" type="application/opensearchdescription+xml" href="/opensearch.xml" title="yegor256" /> <link rel="shortcut icon" href="/favicon.ico?a0e0d018c07"/> <link rel="apple-touch-icon" href="/favicon.ico?a0e0d018c07"/> <link rel="alternate" type="application/rss+xml" title="RSS for yegor256.com" href="https://www.yegor256.com/rss.xml"/> <link rel="stylesheet" href="/css/layout.css?a0e0d018c07"/> <link rel="stylesheet" href="/css/icons.css?a0e0d018c07"/> <link rel="canonical" href="https://www.yegor256.com/2015/04/02/class-casting-is-anti-pattern.html" /> <link rel="amphtml" href="https://www.yegor256.com/2015/04/02/class-casting-is-anti-pattern.amp.html" /> <title>Class Casting Is a Discriminating Anti-Pattern </title> <meta name='og:image' content='https://www.yegor256.com/images/2015/03/gadkiy-utenok.jpg'/><meta name='twitter:image' content='https://www.yegor256.com/images/2015/03/gadkiy-utenok.jpg'/><meta name='og:image:width' content='640'/> <meta name='twitter:image:width' content='640'/><meta name='og:image:height' content='372'/> <meta name='twitter:image:height' content='372'/><meta name='twitter:card' content='summary'/><meta name='twitter:image:alt' content='Гадкий утенок (1956) by Владимир Дегтярёв'/> </head> <body><div class="wrapper"> <aside class="header-toggle unprintable" id="header-toggle" title="Show the menu" onclick="$('#header').show();$('#header-toggle').hide();">&#9776;</aside> <header class="header" id="header"><div class="face"> <a href="/about-me.html#form" class="sub" title="Click to subscribe to my monthly newsletter"><span>Subscribe</span></a> <a href="/about-me.html" style="position:relative;"> <img src="/images/face-256x256.jpg" class="photo" alt="Yegor Bugayenko"/> </a></div><nav><ul class="menu social notranslate"> <li><a href="https://twitter.com/intent/follow?screen_name=yegor256" rel="nofollow" title="Follow me on Twitter"><i class="icon icon-twitter notranslate" aria-hidden="true"></i></a></li> <li><a href="/rss.xml" rel="nofollow" title="Subscribe to my RSS feed"><i class="icon icon-rss notranslate" aria-hidden="true"></i></a></li> <li><a itemprop="sameAs" href="https://github.com/yegor256" rel="nofollow" title="My GitHub profile"><i class="icon icon-github notranslate" aria-hidden="true"></i></a></li> <li><a itemprop="sameAs" href="http://stackoverflow.com/users/187141/yegor256" rel="nofollow" title="My StackOverflow profile"><i class="icon icon-stackoverflow notranslate" aria-hidden="true"></i></a></li> <li><a itemprop="sameAs" href="https://www.facebook.com/yegor256" rel="nofollow" title="Follow me on Facebook"><i class="icon icon-facebook notranslate" aria-hidden="true"></i></a></li> <li><a itemprop="sameAs" href="https://instagram.com/yegor256" rel="nofollow" title="Follow me on Instagram"><i class="icon icon-instagram notranslate" aria-hidden="true"></i></a></li> <li><a itemprop="sameAs" href="https://www.linkedin.com/in/yegor256" rel="nofollow" title="My LinkedIn profile"><i class="icon icon-linkedin notranslate" aria-hidden="true"></i></a></li> <li><a itemprop="sameAs" href="https://www.youtube.com/c/yegor256?sub_confirmation=1" rel="nofollow" title="My Youtube video channel"><i class="icon icon-youtube notranslate" aria-hidden="true"></i></a></li> <li><a itemprop="sameAs" href="https://www.pinterest.com/yegor256/" rel="nofollow" title="My Pinterest boards"><i class="icon icon-pinterest notranslate" aria-hidden="true"></i></a></li> <li><a itemprop="sameAs" href="https://angel.co/yegor256" rel="nofollow" title="My AngelList profile"><i class="icon icon-angellist notranslate" aria-hidden="true"></i></a></li> <li><a href="https://soundcloud.com/yegor256" rel="nofollow" title="My podcast"><i class="icon icon-podcast notranslate" aria-hidden="true"></i></a></li> <li><a href="https://itunes.apple.com/us/podcast/yegor256-podcast/id1150826721" rel="nofollow" title="My iTunes podcast"><i class="icon icon-itunes notranslate" aria-hidden="true"></i></a></li> <li><a href="https://t.me/joinchat/AAAAAEJFMRzsRTRxM3ec6A" rel="nofollow" title="My Telegram public channel"><i class="icon icon-telegram notranslate" aria-hidden="true"></i></a></li> <li><a href="mailto:blog@yegor256.com" rel="nofollow" title="Email me any time"><i class="icon icon-mail notranslate" aria-hidden="true"></i></a></li></ul><ul class="menu"> <li><a href="/" title="Home page">Home</a></li> <li ><a href="/best.html" title="Best articles to read">12&#160;Best</a></li> <li ><a href="/contents.html" title="The contents of the entire blog">All&#160;288</a></li> <li ><a href="/webinars.html" title="My webinars">Webinars</a></li> <li ><a href="/talks.html" title="Future and past conference talks">Talks</a></li> <li ><a href="/books.html" title="The books I wrote">Books</a></li> <li ><a href="/papers.html" title="My academic papers and patents">Papers</a></li> <li ><a href="/pets.html" title="My loved pet projects">Pets</a></li> <li ><a href="/award.html" title="Software quality award">Award</a></li> <li ><a href="/testimonials.html" title="What some people say about me">Testimonials</a></li> <li ><a href="/shift-m.html" title="Audio podcast about project management">Shift-M</a></li> <li ><a href="/paintings.html" title="My paintings for sale">Paintings</a></li> <li><a href="http://ru.yegor256.com/" title="Немного на русском языке">По-русски</a></li></ul></nav><div class="search"> <form method="get" action="https://www.google.com/search" itemprop="potentialAction" itemscope="" itemtype="http://schema.org/SearchAction"> <meta itemprop="target" content="https://www.google.com/search?q={q}"/> <input name="sitesearch" value="yegor256.com" type="hidden"/> <input itemprop="query-input" type="text" id="search-query" class="field field-text" required="required" onfocus="$('.google').css('visibility', 'visible');" name="q" placeholder="Search..." autocomplete="off"/> <input type="image" src="/images/google-search-icon.svg" class="google" title="Search via Google" alt="Search via Google"/> </form></div><div class="hot"><ul> <li> <a href="/code-ahead.html">Code Ahead</a> was published on Amazon just a few days ago! It is my new book, a novel about programmers. It explains in details the majority of ideas that stand behind <a href="https://www.zerocracy.com">Zerocracy</a> and <a href="https://www.xdsd.org">XDSD</a>. </li> <li> At <a href="/webinars.html">Webinar #37</a> we will discuss naming problem in OOP, for objects, methods and attributes; join us on <b>September 12</b>, at 11am PST. </li></ul></div></header></div><section itemscope="" itemtype="http://schema.org/BlogPosting"><div class="wrapper"> <header><p class="printable"> <img src="https://api.qrserver.com/v1/create-qr-code/?data=https://www.yegor256.com/2015/04/02/class-casting-is-anti-pattern.html&amp;format=svg" style="width:125px;height:125px;" alt="QR code"/></p><p class="printable"> <code itemprop="url">https://www.yegor256.com/2015/04/02/class-casting-is-anti-pattern.html</code></p><h1 itemprop="name headline mainEntityOfPage">Class Casting Is a Discriminating Anti-Pattern</h1><aside class='book'><a href='http://amzn.to/2qFt4Tn'><img src='/images/books/elegant-objects/cover.png' class='book-cover' alt='book cover'/></a>Read more about this subject in <a href='http://amzn.to/2qFt4Tn'>Section&nbsp;3.7</a><br/> of my book<a href='http://amzn.to/2qFt4Tn'><img src='/images/books/amazon-buy-button.png' class='amazon-button' alt='Click to buy'/></a></aside><ul class="subline"> <li> <time itemprop="datePublished" datetime="2015-04-02T00:00:00+00:00"> 2 April 2015 </time> </li> <li class="printable" itemscope="" itemprop="author" itemtype="http://schema.org/Person"> <span itemprop="name">Yegor Bugayenko</span> </li> <li class="unprintable"> <i class="icon icon-comments"></i> <a href="http://www.yegor256.com/2015/04/02/class-casting-is-anti-pattern.html#disqus_thread" itemprop="discussionUrl">comments</a> </li></ul><p class="unprintable"><p>Type casting is a very useful technique when there is no time or desire to think and design objects properly. Type casting (or class casting) helps us work with provided objects differently, based on the class they belong to or the interface they implement. Class casting helps us <strong>discriminate</strong> against the poor objects and <strong>segregate</strong> them by their race, gender, and religion. Can this be a good practice?</p><figure class='jb_picture'><img itemprop='image' alt='Гадкий утенок (1956) by Владимир Дегтярёв' src='/images/2015/03/gadkiy-utenok.jpg' longdesc='#163b8fa3'/><figcaption id='163b8fa3'>Гадкий утенок (1956) by Владимир Дегтярёв</figcaption></figure><p>This is a very typical example of type casting (Google Guava is full of it, for example <a href="https://github.com/google/guava/blob/v18.0/guava/src/com/google/common/collect/Iterables.java#L104-L111"><code>Iterables.size()</code></a>):</p><figure class="highlight"><pre><code class="language-java" data-lang="java"><span></span><span class="kd">public</span> <span class="kd">final</span> <span class="kd">class</span> <span class="nc">Foo</span> <span class="o">{</span>
  <span class="kd">public</span> <span class="kt">int</span> <span class="nf">sizeOf</span><span class="o">(</span><span class="n">Iterable</span> <span class="n">items</span><span class="o">)</span> <span class="o">{</span>
    <span class="kt">int</span> <span class="n">size</span> <span class="o">=</span> <span class="mi">0</span><span class="o">;</span>
    <span class="k">if</span> <span class="o">(</span><span class="n">items</span> <span class="k">instanceof</span> <span class="n">Collection</span><span class="o">)</span> <span class="o">{</span>
      <span class="n">size</span> <span class="o">=</span> <span class="n">Collection</span><span class="o">.</span><span class="na">class</span><span class="o">.</span><span class="na">cast</span><span class="o">(</span><span class="n">items</span><span class="o">).</span><span class="na">size</span><span class="o">();</span>
    <span class="o">}</span> <span class="k">else</span> <span class="o">{</span>
      <span class="k">for</span> <span class="o">(</span><span class="n">Object</span> <span class="n">item</span> <span class="o">:</span> <span class="n">items</span><span class="o">)</span> <span class="o">{</span>
        <span class="o">++</span><span class="n">size</span><span class="o">;</span>
      <span class="o">}</span>
    <span class="o">}</span>
    <span class="k">return</span> <span class="n">size</span><span class="o">;</span>
  <span class="o">}</span>
<span class="o">}</span></code></pre></figure><p>This <code>sizeOf()</code> method calculates the size of an iterable. However, it is smart enough to understand that if <code>items</code> are also instances of <code>Collection</code>, there is no need to actually iterate them. It would be much faster to cast them to <code>Collection</code> and then call method <code>size()</code>. Looks logical, but what&#39;s wrong with this approach? I see two practical problems.</p><p>First, there is a <strong>hidden coupling</strong> of <code>sizeOf()</code> and <code>Collection</code>. This coupling is not visible to the clients of <code>sizeOf()</code>. They don&#39;t know that method <code>sizeOf()</code> relies on interface <code>Collection</code>. If tomorrow we decide to change it, <code>sizeOf()</code> won&#39;t work. And we&#39;ll be very surprised, since its signature says nothing about this dependency. This won&#39;t happen with <code>Collection</code>, obviously, since it is part of the Java SDK, but with custom classes, this may and will happen.</p><p>The second problem is an inevitably <strong>growing complexity</strong> of method <code>sizeOf()</code>. The more special types it has to treat differently, the more complex it will become. This if/then <a href="/2016/08/10/if-then-else-code-smell.html">forking</a> is inevitable, since it has to check all possible types and give them special treatment. Such complexity is a result of a violation of the single responsibility principle. The method is not only calculating the size of <code>Iterable</code> but is also performing type casting and forking based on that casting.</p><p>What is the alternative? There are a few, but the most obvious is method overloading (not available in semi-OOP languages like Ruby or PHP):</p><figure class="highlight"><pre><code class="language-java" data-lang="java"><span></span><span class="kd">public</span> <span class="kd">final</span> <span class="kd">class</span> <span class="nc">Foo</span> <span class="o">{</span>
  <span class="kd">public</span> <span class="kt">int</span> <span class="nf">sizeOf</span><span class="o">(</span><span class="n">Iterable</span> <span class="n">items</span><span class="o">)</span> <span class="o">{</span>
    <span class="kt">int</span> <span class="n">size</span> <span class="o">=</span> <span class="mi">0</span><span class="o">;</span>
    <span class="k">for</span> <span class="o">(</span><span class="n">Object</span> <span class="n">item</span> <span class="o">:</span> <span class="n">items</span><span class="o">)</span> <span class="o">{</span>
      <span class="o">++</span><span class="n">size</span><span class="o">;</span>
    <span class="o">}</span>
    <span class="k">return</span> <span class="n">size</span><span class="o">;</span>
  <span class="o">}</span>
  <span class="kd">public</span> <span class="kt">int</span> <span class="nf">sizeOf</span><span class="o">(</span><span class="n">Collection</span> <span class="n">items</span><span class="o">)</span> <span class="o">{</span>
    <span class="k">return</span> <span class="n">items</span><span class="o">.</span><span class="na">size</span><span class="o">();</span>
  <span class="o">}</span>
<span class="o">}</span></code></pre></figure><p>Isn&#39;t that more elegant?</p><p>Philosophically speaking, type casting is discrimination against the object that comes into the method. The object complies with the contract provided by the method signature. It implements the <code>Iterable</code> interface, which <a href="/2014/11/20/seven-virtues-of-good-object.html">is a contract</a>, and it expects equal treatment with all other objects that come into the same method. But the method discriminates objects by their types. The method is basically asking the object about its... race. Black objects go right while white objects go left. That&#39;s what this <code>instanceof</code> is doing, and that&#39;s what discrimination is all about.</p><p>By using <code>instanceof</code>, the method is segregating incoming objects by the certain group they belong to. In this case, there are two groups: collections and everybody else. If you are a collection, you get special treatment. Even though you abide by the <code>Iterable</code> contract, we still treat some objects specially because they belong to an &quot;elite&quot; group called <code>Collection</code>.</p><p>You may say that <code>Collection</code> is just another contract that an object may comply with. That&#39;s true, but in this case, there should be another door through which those who work by that contract should enter. You announced that <code>sizeOf()</code> accepts everybody who works on the <code>Iterable</code> contract. I am an object, and I do what the contract says. I enter the method and expect equal treatment with everybody else who comes into the same method. But, apparently, once inside the method, I realize that some objects have some special privileges. Isn&#39;t that discrimination?</p><p>To conclude, I would consider <code>instanceof</code> and class casting to be anti-patterns and code smells. Once you see a need to use them, start thinking about refactoring.</p></p><nav class="buttons notranslate desktop-only"> <a href="http://www.facebook.com/sharer/sharer.php?u=https://www.yegor256.com/2015/04/02/class-casting-is-anti-pattern.html" title="Share on Facebook" class="button" rel="nofollow"> <span class="count count-facebook">0</span> <i class="icon icon-facebook notranslate" aria-hidden="true"></i> </a> <a href="https://twitter.com/share?url=https://www.yegor256.com/2015/04/02/class-casting-is-anti-pattern.html&amp;text=Class+Casting+Is+a+Discriminating+Anti-Pattern" title="Share on Twitter" class="button" rel="nofollow"> <span class="count count-twitter">0</span> <i class="icon icon-twitter notranslate" aria-hidden="true"></i> </a> <a href="https://plus.google.com/share?url=https://www.yegor256.com/2015/04/02/class-casting-is-anti-pattern.html" title="Share on Google+" class="button" rel="nofollow"> <span class="count count-googleplus">0</span> <i class="icon icon-googleplus notranslate" aria-hidden="true"></i> </a> <a href="https://www.linkedin.com/cws/share?url=https://www.yegor256.com/2015/04/02/class-casting-is-anti-pattern.html" title="Share on LinkedIn" class="button" rel="nofollow"> <span class="count count-linkedin">0</span> <i class="icon icon-linkedin notranslate" aria-hidden="true"></i> </a> <a href="http://reddit.com/submit?url=https://www.yegor256.com/2015/04/02/class-casting-is-anti-pattern.html%3F2015-13&amp;title=Class+Casting+Is+a+Discriminating+Anti-Pattern" title="Share on Reddit" class="button" rel="nofollow"> <span class="count count-reddit">0</span> <i class="icon icon-reddit notranslate" aria-hidden="true"></i> </a> <a href="http://news.ycombinator.com/submitlink?u=https://www.yegor256.com/2015/04/02/class-casting-is-anti-pattern.html%3F2015-13&amp;t=Class+Casting+Is+a+Discriminating+Anti-Pattern" title="Share on Hacker News" class="button" rel="nofollow"> <span class="count count-hackernews">0</span> <i class="icon icon-hackernews notranslate" aria-hidden="true"></i> </a> </nav> </header> <article class="main" itemprop="articleBody"><div ><p>Type casting is a very useful technique when there is no time or desire to think and design objects properly. Type casting (or class casting) helps us work with provided objects differently, based on the class they belong to or the interface they implement. Class casting helps us <strong>discriminate</strong> against the poor objects and <strong>segregate</strong> them by their race, gender, and religion. Can this be a good practice?</p><figure class='jb_picture'><img itemprop='image' alt='Гадкий утенок (1956) by Владимир Дегтярёв' src='/images/2015/03/gadkiy-utenok.jpg' longdesc='#163b8fa3'/><figcaption id='163b8fa3'>Гадкий утенок (1956) by Владимир Дегтярёв</figcaption></figure><p>This is a very typical example of type casting (Google Guava is full of it, for example <a href="https://github.com/google/guava/blob/v18.0/guava/src/com/google/common/collect/Iterables.java#L104-L111"><code>Iterables.size()</code></a>):</p><figure class="highlight"><pre><code class="language-java" data-lang="java"><span></span><span class="kd">public</span> <span class="kd">final</span> <span class="kd">class</span> <span class="nc">Foo</span> <span class="o">{</span>
  <span class="kd">public</span> <span class="kt">int</span> <span class="nf">sizeOf</span><span class="o">(</span><span class="n">Iterable</span> <span class="n">items</span><span class="o">)</span> <span class="o">{</span>
    <span class="kt">int</span> <span class="n">size</span> <span class="o">=</span> <span class="mi">0</span><span class="o">;</span>
    <span class="k">if</span> <span class="o">(</span><span class="n">items</span> <span class="k">instanceof</span> <span class="n">Collection</span><span class="o">)</span> <span class="o">{</span>
      <span class="n">size</span> <span class="o">=</span> <span class="n">Collection</span><span class="o">.</span><span class="na">class</span><span class="o">.</span><span class="na">cast</span><span class="o">(</span><span class="n">items</span><span class="o">).</span><span class="na">size</span><span class="o">();</span>
    <span class="o">}</span> <span class="k">else</span> <span class="o">{</span>
      <span class="k">for</span> <span class="o">(</span><span class="n">Object</span> <span class="n">item</span> <span class="o">:</span> <span class="n">items</span><span class="o">)</span> <span class="o">{</span>
        <span class="o">++</span><span class="n">size</span><span class="o">;</span>
      <span class="o">}</span>
    <span class="o">}</span>
    <span class="k">return</span> <span class="n">size</span><span class="o">;</span>
  <span class="o">}</span>
<span class="o">}</span></code></pre></figure><p>This <code>sizeOf()</code> method calculates the size of an iterable. However, it is smart enough to understand that if <code>items</code> are also instances of <code>Collection</code>, there is no need to actually iterate them. It would be much faster to cast them to <code>Collection</code> and then call method <code>size()</code>. Looks logical, but what&#39;s wrong with this approach? I see two practical problems.</p><p>First, there is a <strong>hidden coupling</strong> of <code>sizeOf()</code> and <code>Collection</code>. This coupling is not visible to the clients of <code>sizeOf()</code>. They don&#39;t know that method <code>sizeOf()</code> relies on interface <code>Collection</code>. If tomorrow we decide to change it, <code>sizeOf()</code> won&#39;t work. And we&#39;ll be very surprised, since its signature says nothing about this dependency. This won&#39;t happen with <code>Collection</code>, obviously, since it is part of the Java SDK, but with custom classes, this may and will happen.</p><p>The second problem is an inevitably <strong>growing complexity</strong> of method <code>sizeOf()</code>. The more special types it has to treat differently, the more complex it will become. This if/then <a href="/2016/08/10/if-then-else-code-smell.html">forking</a> is inevitable, since it has to check all possible types and give them special treatment. Such complexity is a result of a violation of the single responsibility principle. The method is not only calculating the size of <code>Iterable</code> but is also performing type casting and forking based on that casting.</p><p>What is the alternative? There are a few, but the most obvious is method overloading (not available in semi-OOP languages like Ruby or PHP):</p><figure class="highlight"><pre><code class="language-java" data-lang="java"><span></span><span class="kd">public</span> <span class="kd">final</span> <span class="kd">class</span> <span class="nc">Foo</span> <span class="o">{</span>
  <span class="kd">public</span> <span class="kt">int</span> <span class="nf">sizeOf</span><span class="o">(</span><span class="n">Iterable</span> <span class="n">items</span><span class="o">)</span> <span class="o">{</span>
    <span class="kt">int</span> <span class="n">size</span> <span class="o">=</span> <span class="mi">0</span><span class="o">;</span>
    <span class="k">for</span> <span class="o">(</span><span class="n">Object</span> <span class="n">item</span> <span class="o">:</span> <span class="n">items</span><span class="o">)</span> <span class="o">{</span>
      <span class="o">++</span><span class="n">size</span><span class="o">;</span>
    <span class="o">}</span>
    <span class="k">return</span> <span class="n">size</span><span class="o">;</span>
  <span class="o">}</span>
  <span class="kd">public</span> <span class="kt">int</span> <span class="nf">sizeOf</span><span class="o">(</span><span class="n">Collection</span> <span class="n">items</span><span class="o">)</span> <span class="o">{</span>
    <span class="k">return</span> <span class="n">items</span><span class="o">.</span><span class="na">size</span><span class="o">();</span>
  <span class="o">}</span>
<span class="o">}</span></code></pre></figure><p>Isn&#39;t that more elegant?</p><p>Philosophically speaking, type casting is discrimination against the object that comes into the method. The object complies with the contract provided by the method signature. It implements the <code>Iterable</code> interface, which <a href="/2014/11/20/seven-virtues-of-good-object.html">is a contract</a>, and it expects equal treatment with all other objects that come into the same method. But the method discriminates objects by their types. The method is basically asking the object about its... race. Black objects go right while white objects go left. That&#39;s what this <code>instanceof</code> is doing, and that&#39;s what discrimination is all about.</p><p>By using <code>instanceof</code>, the method is segregating incoming objects by the certain group they belong to. In this case, there are two groups: collections and everybody else. If you are a collection, you get special treatment. Even though you abide by the <code>Iterable</code> contract, we still treat some objects specially because they belong to an &quot;elite&quot; group called <code>Collection</code>.</p><p>You may say that <code>Collection</code> is just another contract that an object may comply with. That&#39;s true, but in this case, there should be another door through which those who work by that contract should enter. You announced that <code>sizeOf()</code> accepts everybody who works on the <code>Iterable</code> contract. I am an object, and I do what the contract says. I enter the method and expect equal treatment with everybody else who comes into the same method. But, apparently, once inside the method, I realize that some objects have some special privileges. Isn&#39;t that discrimination?</p><p>To conclude, I would consider <code>instanceof</code> and class casting to be anti-patterns and code smells. Once you see a need to use them, start thinking about refactoring.</p></div></article></div><div class="wrapper"> <related-posts /></div><div class="disqus" role="complementary"><p class="disqus_hint"> Please, use <a href="https://help.disqus.com/commenting/what-html-tags-are-allowed-within-comments">syntax highlighting</a> in your comments, to make them more readable.</p><div id="disqus_thread" class="disqus-thread"> <a>&nbsp;</a></div><script> var disqus_config = function () { this.page.url = document.location.href.split('?')[0].split('#')[0].replace('https://', 'http://'); this.page.identifier = this.page.url; }; (function() { var d = document, s = d.createElement('script'); s.src = '//yegor256.disqus.com/embed.js'; s.setAttribute('data-timestamp', +new Date()); (d.head || d.body).appendChild(s); })(); </script> <noscript><div><p class="red"> JavaScript is disabled in your browser, that's why you can't see comments under this post.</p></div></noscript></div><div class="wrapper"> <footer class="footer"><p> &copy; <span itemscope="" itemprop="copyrightHolder" itemtype="http://schema.org/Person"> <span itemprop="name">Yegor Bugayenko</span> </span> 2014&ndash;<span itemprop="copyrightYear">2018</span></p></footer></div></section><div class="wrapper unprintable" style="text-align:center;margin-top:2em;"> <a href="http://www.sixnines.io/h/3ba1652f"> <img src="//www.sixnines.io/b/3ba1652f?style=flat" alt="sixnines availability badge"/> </a></div><script src="//code.jquery.com/jquery-1.9.0.min.js"></script> <script src="/js/all.js?a0e0d018c07"></script> <script>var disqus_shortname = 'yegor256';</script> <script id="dsq-count-scr" src="//yegor256.disqus.com/count.js" async="async"></script> <script> (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){ (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o), m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m) })(window,document,'script','//www.google-analytics.com/analytics.js','ga'); ga('create', 'UA-1963507-32', 'auto'); ga('send', 'pageview'); </script> <script> Cd=document;Cr="&"+Math.random();Cp="&s=1"; Cd.cookie="b=b";if(Cd.cookie)Cp+="&c=1"; Cp+="&t="+(new Date()).getTimezoneOffset(); if(self!=top)Cp+="&f=1"; </script> <script> if(navigator.javaEnabled())Cp+="&j=1"; </script> <script> if(typeof(screen)!='undefined')Cp+="&w="+screen.width+"&h="+ screen.height+"&d="+(screen.colorDepth?screen.colorDepth:screen.pixelDepth); </script> <script> Cd.write("<img src='//c.hit.ua/hit?i=95870&g=0&x=2"+Cp+Cr+ "&r="+escape(Cd.referrer)+"&u="+escape(window.location.href)+ "' border='0' wi"+"dth='1' he"+"ight='1'/>"); </script> <script type="application/ld+json"> { "@context": "http://schema.org", "@type": "Person", "name": "Yegor Bugayenko", "url": "http://www.yegor256.com", "sameAs": [ "https://www.facebook.com/yegor256", "https://instagram.com/yegor256", "https://www.linkedin.com/in/yegor256", "https://twitter.com/yegor256", "https://github.com/yegor256", "https://www.pinterest.com/yegor256/" ] } </script> </body> </html> <!DOCTYPE html> <html xmlns="http://www.w3.org/1999/xhtml" lang="en-US" xml:lang="en-US" itemscope="" itemtype="http://schema.org/WebSite"> <head> <meta charset="utf-8"/> <meta name="description" content="Object names that end with -er are indicators of a flawed design in terms of object thinking and should be avoided. " /> <meta name="keywords" content="class name ends with er, controllers in oop, er object names, managers in oop, objects that end with er" /> <meta name="viewport" content="width=device-width,minimum-scale=1,initial-scale=1"/> <meta name="google-site-verification" content="JEj_gQr2CPe2QKGw8XdMz0R7VboQIUbX3FlM-lwTq-8" /> <meta name="author" content="Yegor Bugayenko"> <meta name="article:published_time" content="2015-03-09 00:00:00 +0000"> <meta name="og:site_name" content="Yegor Bugayenko"/> <meta name="og:type" content="article" /> <meta name="og:locale" content="en_US" /> <meta name="twitter:account_id" content="4503599630178231" /> <meta name="twitter:creator" content="@yegor256"/> <meta name="twitter:site" content="@yegor256"/> <meta name="twitter:title" property="og:title" content="Don't Create Objects That&nbsp;End&nbsp;With&nbsp;-ER"/> <meta name="twitter:description" property="og:description" content="Object names that end with -er are indicators of a flawed design in terms of object thinking and should be avoided. "/> <meta name="twitter:url" property="og:url" content="https://www.yegor256.com/2015/03/09/objects-end-with-er.html"/> <meta name="telegram:channel" content="AAAAAEJFMRzsRTRxM3ec6A"/> <link rel="search" type="application/opensearchdescription+xml" href="/opensearch.xml" title="yegor256" /> <link rel="shortcut icon" href="/favicon.ico?a0e0d018c07"/> <link rel="apple-touch-icon" href="/favicon.ico?a0e0d018c07"/> <link rel="alternate" type="application/rss+xml" title="RSS for yegor256.com" href="https://www.yegor256.com/rss.xml"/> <link rel="stylesheet" href="/css/layout.css?a0e0d018c07"/> <link rel="stylesheet" href="/css/icons.css?a0e0d018c07"/> <link rel="canonical" href="https://www.yegor256.com/2015/03/09/objects-end-with-er.html" /> <link rel="amphtml" href="https://www.yegor256.com/2015/03/09/objects-end-with-er.amp.html" /> <title>Don't Create Objects That&nbsp;End&nbsp;With&nbsp;-ER </title> <meta name='og:image' content='https://www.yegor256.com/images/2015/03/fight-club.jpg'/><meta name='twitter:image' content='https://www.yegor256.com/images/2015/03/fight-club.jpg'/><meta name='og:image:width' content='1276'/> <meta name='twitter:image:width' content='1276'/><meta name='og:image:height' content='531'/> <meta name='twitter:image:height' content='531'/><meta name='twitter:card' content='summary_large_image'/><meta name='twitter:image:alt' content='Fight Club (1999) by David Fincher'/> </head> <body><div class="wrapper"> <aside class="header-toggle unprintable" id="header-toggle" title="Show the menu" onclick="$('#header').show();$('#header-toggle').hide();">&#9776;</aside> <header class="header" id="header"><div class="face"> <a href="/about-me.html#form" class="sub" title="Click to subscribe to my monthly newsletter"><span>Subscribe</span></a> <a href="/about-me.html" style="position:relative;"> <img src="/images/face-256x256.jpg" class="photo" alt="Yegor Bugayenko"/> </a></div><nav><ul class="menu social notranslate"> <li><a href="https://twitter.com/intent/follow?screen_name=yegor256" rel="nofollow" title="Follow me on Twitter"><i class="icon icon-twitter notranslate" aria-hidden="true"></i></a></li> <li><a href="/rss.xml" rel="nofollow" title="Subscribe to my RSS feed"><i class="icon icon-rss notranslate" aria-hidden="true"></i></a></li> <li><a itemprop="sameAs" href="https://github.com/yegor256" rel="nofollow" title="My GitHub profile"><i class="icon icon-github notranslate" aria-hidden="true"></i></a></li> <li><a itemprop="sameAs" href="http://stackoverflow.com/users/187141/yegor256" rel="nofollow" title="My StackOverflow profile"><i class="icon icon-stackoverflow notranslate" aria-hidden="true"></i></a></li> <li><a itemprop="sameAs" href="https://www.facebook.com/yegor256" rel="nofollow" title="Follow me on Facebook"><i class="icon icon-facebook notranslate" aria-hidden="true"></i></a></li> <li><a itemprop="sameAs" href="https://instagram.com/yegor256" rel="nofollow" title="Follow me on Instagram"><i class="icon icon-instagram notranslate" aria-hidden="true"></i></a></li> <li><a itemprop="sameAs" href="https://www.linkedin.com/in/yegor256" rel="nofollow" title="My LinkedIn profile"><i class="icon icon-linkedin notranslate" aria-hidden="true"></i></a></li> <li><a itemprop="sameAs" href="https://www.youtube.com/c/yegor256?sub_confirmation=1" rel="nofollow" title="My Youtube video channel"><i class="icon icon-youtube notranslate" aria-hidden="true"></i></a></li> <li><a itemprop="sameAs" href="https://www.pinterest.com/yegor256/" rel="nofollow" title="My Pinterest boards"><i class="icon icon-pinterest notranslate" aria-hidden="true"></i></a></li> <li><a itemprop="sameAs" href="https://angel.co/yegor256" rel="nofollow" title="My AngelList profile"><i class="icon icon-angellist notranslate" aria-hidden="true"></i></a></li> <li><a href="https://soundcloud.com/yegor256" rel="nofollow" title="My podcast"><i class="icon icon-podcast notranslate" aria-hidden="true"></i></a></li> <li><a href="https://itunes.apple.com/us/podcast/yegor256-podcast/id1150826721" rel="nofollow" title="My iTunes podcast"><i class="icon icon-itunes notranslate" aria-hidden="true"></i></a></li> <li><a href="https://t.me/joinchat/AAAAAEJFMRzsRTRxM3ec6A" rel="nofollow" title="My Telegram public channel"><i class="icon icon-telegram notranslate" aria-hidden="true"></i></a></li> <li><a href="mailto:blog@yegor256.com" rel="nofollow" title="Email me any time"><i class="icon icon-mail notranslate" aria-hidden="true"></i></a></li></ul><ul class="menu"> <li><a href="/" title="Home page">Home</a></li> <li ><a href="/best.html" title="Best articles to read">12&#160;Best</a></li> <li ><a href="/contents.html" title="The contents of the entire blog">All&#160;288</a></li> <li ><a href="/webinars.html" title="My webinars">Webinars</a></li> <li ><a href="/talks.html" title="Future and past conference talks">Talks</a></li> <li ><a href="/books.html" title="The books I wrote">Books</a></li> <li ><a href="/papers.html" title="My academic papers and patents">Papers</a></li> <li ><a href="/pets.html" title="My loved pet projects">Pets</a></li> <li ><a href="/award.html" title="Software quality award">Award</a></li> <li ><a href="/testimonials.html" title="What some people say about me">Testimonials</a></li> <li ><a href="/shift-m.html" title="Audio podcast about project management">Shift-M</a></li> <li ><a href="/paintings.html" title="My paintings for sale">Paintings</a></li> <li><a href="http://ru.yegor256.com/" title="Немного на русском языке">По-русски</a></li></ul></nav><div class="search"> <form method="get" action="https://www.google.com/search" itemprop="potentialAction" itemscope="" itemtype="http://schema.org/SearchAction"> <meta itemprop="target" content="https://www.google.com/search?q={q}"/> <input name="sitesearch" value="yegor256.com" type="hidden"/> <input itemprop="query-input" type="text" id="search-query" class="field field-text" required="required" onfocus="$('.google').css('visibility', 'visible');" name="q" placeholder="Search..." autocomplete="off"/> <input type="image" src="/images/google-search-icon.svg" class="google" title="Search via Google" alt="Search via Google"/> </form></div><div class="hot"><ul> <li> <a href="/code-ahead.html">Code Ahead</a> was published on Amazon just a few days ago! It is my new book, a novel about programmers. It explains in details the majority of ideas that stand behind <a href="https://www.zerocracy.com">Zerocracy</a> and <a href="https://www.xdsd.org">XDSD</a>. </li> <li> At <a href="/webinars.html">Webinar #37</a> we will discuss naming problem in OOP, for objects, methods and attributes; join us on <b>September 12</b>, at 11am PST. </li></ul></div></header></div><section itemscope="" itemtype="http://schema.org/BlogPosting"><div class="wrapper"> <header><p class="printable"> <img src="https://api.qrserver.com/v1/create-qr-code/?data=https://www.yegor256.com/2015/03/09/objects-end-with-er.html&amp;format=svg" style="width:125px;height:125px;" alt="QR code"/></p><p class="printable"> <code itemprop="url">https://www.yegor256.com/2015/03/09/objects-end-with-er.html</code></p><h1 itemprop="name headline mainEntityOfPage">Don't Create Objects That&nbsp;End&nbsp;With&nbsp;-ER</h1><aside class='book'><a href='http://amzn.to/2qFt4Tn'><img src='/images/books/elegant-objects/cover.png' class='book-cover' alt='book cover'/></a>Read more about this subject in <a href='http://amzn.to/2qFt4Tn'>Section&nbsp;1.1</a><br/> of my book<a href='http://amzn.to/2qFt4Tn'><img src='/images/books/amazon-buy-button.png' class='amazon-button' alt='Click to buy'/></a></aside><ul class="subline"> <li> <time itemprop="datePublished" datetime="2015-03-09T00:00:00+00:00"> 9 March 2015 </time> </li> <li class="printable" itemscope="" itemprop="author" itemtype="http://schema.org/Person"> <span itemprop="name">Yegor Bugayenko</span> </li> <li class="unprintable"> <i class="icon icon-comments"></i> <a href="http://www.yegor256.com/2015/03/09/objects-end-with-er.html#disqus_thread" itemprop="discussionUrl">comments</a> </li></ul><ul class="unprintable subline"> <li>Translated:</li> <li><a href="http://blog.csdn.net/LvShuiLanTian/article/details/52317370">Chinese</a></li> <li><a href="mailto:translate@yegor256.com">add yours!</a></li></ul><p class="unprintable"><p>Manager. Controller. Helper. Handler. Writer. Reader. Converter. Validator. Router. Dispatcher. Observer. Listener. Sorter. Encoder. Decoder. This is the class names <strong>hall of shame</strong>. Have you seen them in your code? In <a href="/2015/12/22/why-dont-you-contribute-to-open-source.html">open source libraries</a> you&#39;re using? In pattern books? They are all wrong. What do they have in common? They all end in &quot;-er.&quot; And what&#39;s wrong with that? They are not classes, and the objects they instantiate are not objects. Instead, they are collections of procedures pretending to be classes.</p><figure class='jb_picture'><img itemprop='image' alt='Fight Club (1999) by David Fincher' src='/images/2015/03/fight-club.jpg' longdesc='#c86f03b8'/><figcaption id='c86f03b8'>Fight Club (1999) by David Fincher</figcaption></figure><p><a href="http://en.wikipedia.org/wiki/Peter_Coad">Peter Coad</a> used to say: Challenge any class name that ends in &quot;-er.&quot; There are a few good articles about this subject, including <a href="http://www.carlopescio.com/2011/04/your-coding-conventions-are-hurting-you.html">Your Coding Conventions Are Hurting You</a> by Carlo Pescio, <a href="http://objology.blogspot.com/2011/09/one-of-best-bits-of-programming-advice.html">One of the Best Bits of Programming Advice I Ever Got</a> by Travis Griggs, and <a href="http://www.benhallbenhall.com/2013/01/naming-objects-er-object-names/">Naming Objects – Don’t Use ER in Your Object Names</a> by Ben Hall. The main argument against this &quot;-er&quot; suffix is that &quot;when you need a manager, it&#39;s often a sign that the managed are just plain old data structures and that the manager is the smart procedure doing the real work.&quot;</p><aside class='youtube'> <a href='https://www.youtube.com/watch?v=WpP4rIhh5e4'><div class='box'> <img src='https://i.ytimg.com/vi/WpP4rIhh5e4/mqdefault.jpg' alt='YouTube video #WpP4rIhh5e4'/><div class='play'><i class='icon icon-play'></i></div></div></a><div>Don't Create Objects That End With -ER (webinar #5); 5 August 2015.</div></aside><p>I totally agree but would like to add a few words to this.</p><p>I mentioned already in <a href="/2014/11/20/seven-virtues-of-good-object.html">Seven Virtues of a Good Object</a> that a good object name is not a job title, but I didn&#39;t explain why I think so. Besides that, in <a href="/2015/02/20/utility-classes-vs-functional-programming.html">Utility Classes Have Nothing to Do With Functional Programming</a>, I tried to explain the difference between <a href="http://en.wikipedia.org/wiki/Declarative_programming">declarative</a> and <a href="http://en.wikipedia.org/wiki/Imperative_programming">imperative</a> programming paradigms. Now it&#39;s time to put these two pieces together.</p><p>Let&#39;s say I&#39;m an object and you&#39;re my client. You give me a bucket of apples and ask me to sort them by size. If I&#39;m living in the world of imperative programming, you will get them sorted immediately, and we will never interact again. I will do my job just as requested, without even thinking <em>why</em> you need them sorted. I would be a sorter who doesn&#39;t really care about your real intention:</p><figure class="highlight"><pre><code class="language-java" data-lang="java"><span></span><span class="n">List</span><span class="o">&lt;</span><span class="n">Apple</span><span class="o">&gt;</span> <span class="n">sorted</span> <span class="o">=</span> <span class="k">new</span> <span class="n">Sorter</span><span class="o">().</span><span class="na">sort</span><span class="o">(</span><span class="n">apples</span><span class="o">);</span>
<span class="n">Apple</span> <span class="n">biggest</span> <span class="o">=</span> <span class="n">sorted</span><span class="o">.</span><span class="na">get</span><span class="o">(</span><span class="mi">0</span><span class="o">);</span></code></pre></figure><p>As you see here, the real intention is to find the biggest apple in the bucket.</p><p>This is not what you would expect from a good business partner who can help you work with a bucket of apples.</p><p>Instead, if I lived in the world of declarative programming, I would tell you: &quot;<em>Consider them sorted; what do you want to do next?</em>.&quot; You, in turn, would tell me that you need the biggest apple now. And I would say, &quot;<em>No problem; here it is</em>.&quot; In order to return the biggest one, I would not sort them all. I would just go through them all one by one and select the biggest. This operation is much faster than sorting first and then selecting the first in the list.</p><p>In other words, I would silently <strong>not</strong> follow your instructions but would try to do my business my way. I would be a much smarter partner of yours than that imperative sorter. And I would become a real object that behaves like a sorted list of apples instead of a procedure that sorts:</p><figure class="highlight"><pre><code class="language-java" data-lang="java"><span></span><span class="n">List</span><span class="o">&lt;</span><span class="n">Apple</span><span class="o">&gt;</span> <span class="n">sorted</span> <span class="o">=</span> <span class="k">new</span> <span class="n">Sorted</span><span class="o">(</span><span class="n">apples</span><span class="o">);</span>
<span class="n">Apple</span> <span class="n">biggest</span> <span class="o">=</span> <span class="n">sorted</span><span class="o">.</span><span class="na">get</span><span class="o">(</span><span class="mi">0</span><span class="o">);</span></code></pre></figure><p>See the difference?</p><p>Pay special attention to the difference between the <code>sorter</code> and <code>sorted</code> names.</p><p>Let&#39;s get back to class names. When you add the &quot;-er&quot; suffix to your class name, you&#39;re immediately turning it into a dumb imperative executor of <em>your</em> will. You do not allow it to think and improvise. You expect it to do exactly what you want---sort, manage, control, print, write, combine, concatenate, etc.</p><p>An object is a <a href="/2014/11/20/seven-virtues-of-good-object.html">living organism</a> that doesn&#39;t want to be told what to do. It wants to be an equal partner with other objects, exposing behavior according to its contract(s), a.k.a. interfaces in Java and C# or protocols in Swift.</p><p>Philosophically speaking, the &quot;-er&quot; suffix is a sign of disrespect toward the poor object.</p></p><nav class="buttons notranslate desktop-only"> <a href="http://www.facebook.com/sharer/sharer.php?u=https://www.yegor256.com/2015/03/09/objects-end-with-er.html" title="Share on Facebook" class="button" rel="nofollow"> <span class="count count-facebook">0</span> <i class="icon icon-facebook notranslate" aria-hidden="true"></i> </a> <a href="https://twitter.com/share?url=https://www.yegor256.com/2015/03/09/objects-end-with-er.html&amp;text=Don%27t+Create+Objects+That%26nbsp%3BEnd%26nbsp%3BWith%26nbsp%3B-ER" title="Share on Twitter" class="button" rel="nofollow"> <span class="count count-twitter">0</span> <i class="icon icon-twitter notranslate" aria-hidden="true"></i> </a> <a href="https://plus.google.com/share?url=https://www.yegor256.com/2015/03/09/objects-end-with-er.html" title="Share on Google+" class="button" rel="nofollow"> <span class="count count-googleplus">0</span> <i class="icon icon-googleplus notranslate" aria-hidden="true"></i> </a> <a href="https://www.linkedin.com/cws/share?url=https://www.yegor256.com/2015/03/09/objects-end-with-er.html" title="Share on LinkedIn" class="button" rel="nofollow"> <span class="count count-linkedin">0</span> <i class="icon icon-linkedin notranslate" aria-hidden="true"></i> </a> <a href="http://reddit.com/submit?url=https://www.yegor256.com/2015/03/09/objects-end-with-er.html%3F2015-10&amp;title=Don%27t+Create+Objects+That%26nbsp%3BEnd%26nbsp%3BWith%26nbsp%3B-ER" title="Share on Reddit" class="button" rel="nofollow"> <span class="count count-reddit">0</span> <i class="icon icon-reddit notranslate" aria-hidden="true"></i> </a> <a href="http://news.ycombinator.com/submitlink?u=https://www.yegor256.com/2015/03/09/objects-end-with-er.html%3F2015-10&amp;t=Don%27t+Create+Objects+That%26nbsp%3BEnd%26nbsp%3BWith%26nbsp%3B-ER" title="Share on Hacker News" class="button" rel="nofollow"> <span class="count count-hackernews">0</span> <i class="icon icon-hackernews notranslate" aria-hidden="true"></i> </a> </nav> </header> <article class="main" itemprop="articleBody"><div ><p>Manager. Controller. Helper. Handler. Writer. Reader. Converter. Validator. Router. Dispatcher. Observer. Listener. Sorter. Encoder. Decoder. This is the class names <strong>hall of shame</strong>. Have you seen them in your code? In <a href="/2015/12/22/why-dont-you-contribute-to-open-source.html">open source libraries</a> you&#39;re using? In pattern books? They are all wrong. What do they have in common? They all end in &quot;-er.&quot; And what&#39;s wrong with that? They are not classes, and the objects they instantiate are not objects. Instead, they are collections of procedures pretending to be classes.</p><figure class='jb_picture'><img itemprop='image' alt='Fight Club (1999) by David Fincher' src='/images/2015/03/fight-club.jpg' longdesc='#c86f03b8'/><figcaption id='c86f03b8'>Fight Club (1999) by David Fincher</figcaption></figure><p><a href="http://en.wikipedia.org/wiki/Peter_Coad">Peter Coad</a> used to say: Challenge any class name that ends in &quot;-er.&quot; There are a few good articles about this subject, including <a href="http://www.carlopescio.com/2011/04/your-coding-conventions-are-hurting-you.html">Your Coding Conventions Are Hurting You</a> by Carlo Pescio, <a href="http://objology.blogspot.com/2011/09/one-of-best-bits-of-programming-advice.html">One of the Best Bits of Programming Advice I Ever Got</a> by Travis Griggs, and <a href="http://www.benhallbenhall.com/2013/01/naming-objects-er-object-names/">Naming Objects – Don’t Use ER in Your Object Names</a> by Ben Hall. The main argument against this &quot;-er&quot; suffix is that &quot;when you need a manager, it&#39;s often a sign that the managed are just plain old data structures and that the manager is the smart procedure doing the real work.&quot;</p><aside class='youtube'> <a href='https://www.youtube.com/watch?v=WpP4rIhh5e4'><div class='box'> <img src='https://i.ytimg.com/vi/WpP4rIhh5e4/mqdefault.jpg' alt='YouTube video #WpP4rIhh5e4'/><div class='play'><i class='icon icon-play'></i></div></div></a><div>Don't Create Objects That End With -ER (webinar #5); 5 August 2015.</div></aside><p>I totally agree but would like to add a few words to this.</p><p>I mentioned already in <a href="/2014/11/20/seven-virtues-of-good-object.html">Seven Virtues of a Good Object</a> that a good object name is not a job title, but I didn&#39;t explain why I think so. Besides that, in <a href="/2015/02/20/utility-classes-vs-functional-programming.html">Utility Classes Have Nothing to Do With Functional Programming</a>, I tried to explain the difference between <a href="http://en.wikipedia.org/wiki/Declarative_programming">declarative</a> and <a href="http://en.wikipedia.org/wiki/Imperative_programming">imperative</a> programming paradigms. Now it&#39;s time to put these two pieces together.</p><p>Let&#39;s say I&#39;m an object and you&#39;re my client. You give me a bucket of apples and ask me to sort them by size. If I&#39;m living in the world of imperative programming, you will get them sorted immediately, and we will never interact again. I will do my job just as requested, without even thinking <em>why</em> you need them sorted. I would be a sorter who doesn&#39;t really care about your real intention:</p><figure class="highlight"><pre><code class="language-java" data-lang="java"><span></span><span class="n">List</span><span class="o">&lt;</span><span class="n">Apple</span><span class="o">&gt;</span> <span class="n">sorted</span> <span class="o">=</span> <span class="k">new</span> <span class="n">Sorter</span><span class="o">().</span><span class="na">sort</span><span class="o">(</span><span class="n">apples</span><span class="o">);</span>
<span class="n">Apple</span> <span class="n">biggest</span> <span class="o">=</span> <span class="n">sorted</span><span class="o">.</span><span class="na">get</span><span class="o">(</span><span class="mi">0</span><span class="o">);</span></code></pre></figure><p>As you see here, the real intention is to find the biggest apple in the bucket.</p><p>This is not what you would expect from a good business partner who can help you work with a bucket of apples.</p><p>Instead, if I lived in the world of declarative programming, I would tell you: &quot;<em>Consider them sorted; what do you want to do next?</em>.&quot; You, in turn, would tell me that you need the biggest apple now. And I would say, &quot;<em>No problem; here it is</em>.&quot; In order to return the biggest one, I would not sort them all. I would just go through them all one by one and select the biggest. This operation is much faster than sorting first and then selecting the first in the list.</p><p>In other words, I would silently <strong>not</strong> follow your instructions but would try to do my business my way. I would be a much smarter partner of yours than that imperative sorter. And I would become a real object that behaves like a sorted list of apples instead of a procedure that sorts:</p><figure class="highlight"><pre><code class="language-java" data-lang="java"><span></span><span class="n">List</span><span class="o">&lt;</span><span class="n">Apple</span><span class="o">&gt;</span> <span class="n">sorted</span> <span class="o">=</span> <span class="k">new</span> <span class="n">Sorted</span><span class="o">(</span><span class="n">apples</span><span class="o">);</span>
<span class="n">Apple</span> <span class="n">biggest</span> <span class="o">=</span> <span class="n">sorted</span><span class="o">.</span><span class="na">get</span><span class="o">(</span><span class="mi">0</span><span class="o">);</span></code></pre></figure><p>See the difference?</p><p>Pay special attention to the difference between the <code>sorter</code> and <code>sorted</code> names.</p><p>Let&#39;s get back to class names. When you add the &quot;-er&quot; suffix to your class name, you&#39;re immediately turning it into a dumb imperative executor of <em>your</em> will. You do not allow it to think and improvise. You expect it to do exactly what you want---sort, manage, control, print, write, combine, concatenate, etc.</p><p>An object is a <a href="/2014/11/20/seven-virtues-of-good-object.html">living organism</a> that doesn&#39;t want to be told what to do. It wants to be an equal partner with other objects, exposing behavior according to its contract(s), a.k.a. interfaces in Java and C# or protocols in Swift.</p><p>Philosophically speaking, the &quot;-er&quot; suffix is a sign of disrespect toward the poor object.</p></div></article></div><div class="wrapper"> <related-posts /></div><div class="disqus" role="complementary"><p class="disqus_hint"> Please, use <a href="https://help.disqus.com/commenting/what-html-tags-are-allowed-within-comments">syntax highlighting</a> in your comments, to make them more readable.</p><div id="disqus_thread" class="disqus-thread"> <a>&nbsp;</a></div><script> var disqus_config = function () { this.page.url = document.location.href.split('?')[0].split('#')[0].replace('https://', 'http://'); this.page.identifier = this.page.url; }; (function() { var d = document, s = d.createElement('script'); s.src = '//yegor256.disqus.com/embed.js'; s.setAttribute('data-timestamp', +new Date()); (d.head || d.body).appendChild(s); })(); </script> <noscript><div><p class="red"> JavaScript is disabled in your browser, that's why you can't see comments under this post.</p></div></noscript></div><div class="wrapper"> <footer class="footer"><p> &copy; <span itemscope="" itemprop="copyrightHolder" itemtype="http://schema.org/Person"> <span itemprop="name">Yegor Bugayenko</span> </span> 2014&ndash;<span itemprop="copyrightYear">2018</span></p></footer></div></section><div class="wrapper unprintable" style="text-align:center;margin-top:2em;"> <a href="http://www.sixnines.io/h/3ba1652f"> <img src="//www.sixnines.io/b/3ba1652f?style=flat" alt="sixnines availability badge"/> </a></div><script src="//code.jquery.com/jquery-1.9.0.min.js"></script> <script src="/js/all.js?a0e0d018c07"></script> <script>var disqus_shortname = 'yegor256';</script> <script id="dsq-count-scr" src="//yegor256.disqus.com/count.js" async="async"></script> <script> (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){ (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o), m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m) })(window,document,'script','//www.google-analytics.com/analytics.js','ga'); ga('create', 'UA-1963507-32', 'auto'); ga('send', 'pageview'); </script> <script> Cd=document;Cr="&"+Math.random();Cp="&s=1"; Cd.cookie="b=b";if(Cd.cookie)Cp+="&c=1"; Cp+="&t="+(new Date()).getTimezoneOffset(); if(self!=top)Cp+="&f=1"; </script> <script> if(navigator.javaEnabled())Cp+="&j=1"; </script> <script> if(typeof(screen)!='undefined')Cp+="&w="+screen.width+"&h="+ screen.height+"&d="+(screen.colorDepth?screen.colorDepth:screen.pixelDepth); </script> <script> Cd.write("<img src='//c.hit.ua/hit?i=95870&g=0&x=2"+Cp+Cr+ "&r="+escape(Cd.referrer)+"&u="+escape(window.location.href)+ "' border='0' wi"+"dth='1' he"+"ight='1'/>"); </script> <script type="application/ld+json"> { "@context": "http://schema.org", "@type": "Person", "name": "Yegor Bugayenko", "url": "http://www.yegor256.com", "sameAs": [ "https://www.facebook.com/yegor256", "https://instagram.com/yegor256", "https://www.linkedin.com/in/yegor256", "https://twitter.com/yegor256", "https://github.com/yegor256", "https://www.pinterest.com/yegor256/" ] } </script> </body> </html> <!DOCTYPE html> <html xmlns="http://www.w3.org/1999/xhtml" lang="en-US" xml:lang="en-US" itemscope="" itemtype="http://schema.org/WebSite"> <head> <meta charset="utf-8"/> <meta name="description" content="A decorator pattern, while being the best instrument to keep objects highly cohesive, solid, and loosely coupled, is unfortunately not very popular in traditional Java programming. " /> <meta name="keywords" content="composable decorators, decorator design pattern, decorator pattern example, decorator pattern java, decorator pattern real life example" /> <meta name="viewport" content="width=device-width,minimum-scale=1,initial-scale=1"/> <meta name="google-site-verification" content="JEj_gQr2CPe2QKGw8XdMz0R7VboQIUbX3FlM-lwTq-8" /> <meta name="author" content="Yegor Bugayenko"> <meta name="article:published_time" content="2015-02-26 00:00:00 +0000"> <meta name="og:site_name" content="Yegor Bugayenko"/> <meta name="og:type" content="article" /> <meta name="og:locale" content="en_US" /> <meta name="twitter:account_id" content="4503599630178231" /> <meta name="twitter:creator" content="@yegor256"/> <meta name="twitter:site" content="@yegor256"/> <meta name="twitter:title" property="og:title" content="Composable Decorators vs. Imperative Utility Methods"/> <meta name="twitter:description" property="og:description" content="A decorator pattern, while being the best instrument to keep objects highly cohesive, solid, and loosely coupled, is unfortunately not very popular in traditional Java programming. "/> <meta name="twitter:url" property="og:url" content="https://www.yegor256.com/2015/02/26/composable-decorators.html"/> <meta name="telegram:channel" content="AAAAAEJFMRzsRTRxM3ec6A"/> <link rel="search" type="application/opensearchdescription+xml" href="/opensearch.xml" title="yegor256" /> <link rel="shortcut icon" href="/favicon.ico?a0e0d018c07"/> <link rel="apple-touch-icon" href="/favicon.ico?a0e0d018c07"/> <link rel="alternate" type="application/rss+xml" title="RSS for yegor256.com" href="https://www.yegor256.com/rss.xml"/> <link rel="stylesheet" href="/css/layout.css?a0e0d018c07"/> <link rel="stylesheet" href="/css/icons.css?a0e0d018c07"/> <link rel="canonical" href="https://www.yegor256.com/2015/02/26/composable-decorators.html" /> <link rel="amphtml" href="https://www.yegor256.com/2015/02/26/composable-decorators.amp.html" /> <title>Composable Decorators vs. Imperative Utility Methods </title> <meta name='og:image' content='https://www.yegor256.com/images/2015/02/russina-matroshka.jpg'/><meta name='twitter:image' content='https://www.yegor256.com/images/2015/02/russina-matroshka.jpg'/><meta name='og:image:width' content='1200'/> <meta name='twitter:image:width' content='1200'/><meta name='og:image:height' content='763'/> <meta name='twitter:image:height' content='763'/><meta name='twitter:card' content='summary_large_image'/><meta name='twitter:image:alt' content='Main picture'/> </head> <body><div class="wrapper"> <aside class="header-toggle unprintable" id="header-toggle" title="Show the menu" onclick="$('#header').show();$('#header-toggle').hide();">&#9776;</aside> <header class="header" id="header"><div class="face"> <a href="/about-me.html#form" class="sub" title="Click to subscribe to my monthly newsletter"><span>Subscribe</span></a> <a href="/about-me.html" style="position:relative;"> <img src="/images/face-256x256.jpg" class="photo" alt="Yegor Bugayenko"/> </a></div><nav><ul class="menu social notranslate"> <li><a href="https://twitter.com/intent/follow?screen_name=yegor256" rel="nofollow" title="Follow me on Twitter"><i class="icon icon-twitter notranslate" aria-hidden="true"></i></a></li> <li><a href="/rss.xml" rel="nofollow" title="Subscribe to my RSS feed"><i class="icon icon-rss notranslate" aria-hidden="true"></i></a></li> <li><a itemprop="sameAs" href="https://github.com/yegor256" rel="nofollow" title="My GitHub profile"><i class="icon icon-github notranslate" aria-hidden="true"></i></a></li> <li><a itemprop="sameAs" href="http://stackoverflow.com/users/187141/yegor256" rel="nofollow" title="My StackOverflow profile"><i class="icon icon-stackoverflow notranslate" aria-hidden="true"></i></a></li> <li><a itemprop="sameAs" href="https://www.facebook.com/yegor256" rel="nofollow" title="Follow me on Facebook"><i class="icon icon-facebook notranslate" aria-hidden="true"></i></a></li> <li><a itemprop="sameAs" href="https://instagram.com/yegor256" rel="nofollow" title="Follow me on Instagram"><i class="icon icon-instagram notranslate" aria-hidden="true"></i></a></li> <li><a itemprop="sameAs" href="https://www.linkedin.com/in/yegor256" rel="nofollow" title="My LinkedIn profile"><i class="icon icon-linkedin notranslate" aria-hidden="true"></i></a></li> <li><a itemprop="sameAs" href="https://www.youtube.com/c/yegor256?sub_confirmation=1" rel="nofollow" title="My Youtube video channel"><i class="icon icon-youtube notranslate" aria-hidden="true"></i></a></li> <li><a itemprop="sameAs" href="https://www.pinterest.com/yegor256/" rel="nofollow" title="My Pinterest boards"><i class="icon icon-pinterest notranslate" aria-hidden="true"></i></a></li> <li><a itemprop="sameAs" href="https://angel.co/yegor256" rel="nofollow" title="My AngelList profile"><i class="icon icon-angellist notranslate" aria-hidden="true"></i></a></li> <li><a href="https://soundcloud.com/yegor256" rel="nofollow" title="My podcast"><i class="icon icon-podcast notranslate" aria-hidden="true"></i></a></li> <li><a href="https://itunes.apple.com/us/podcast/yegor256-podcast/id1150826721" rel="nofollow" title="My iTunes podcast"><i class="icon icon-itunes notranslate" aria-hidden="true"></i></a></li> <li><a href="https://t.me/joinchat/AAAAAEJFMRzsRTRxM3ec6A" rel="nofollow" title="My Telegram public channel"><i class="icon icon-telegram notranslate" aria-hidden="true"></i></a></li> <li><a href="mailto:blog@yegor256.com" rel="nofollow" title="Email me any time"><i class="icon icon-mail notranslate" aria-hidden="true"></i></a></li></ul><ul class="menu"> <li><a href="/" title="Home page">Home</a></li> <li ><a href="/best.html" title="Best articles to read">12&#160;Best</a></li> <li ><a href="/contents.html" title="The contents of the entire blog">All&#160;288</a></li> <li ><a href="/webinars.html" title="My webinars">Webinars</a></li> <li ><a href="/talks.html" title="Future and past conference talks">Talks</a></li> <li ><a href="/books.html" title="The books I wrote">Books</a></li> <li ><a href="/papers.html" title="My academic papers and patents">Papers</a></li> <li ><a href="/pets.html" title="My loved pet projects">Pets</a></li> <li ><a href="/award.html" title="Software quality award">Award</a></li> <li ><a href="/testimonials.html" title="What some people say about me">Testimonials</a></li> <li ><a href="/shift-m.html" title="Audio podcast about project management">Shift-M</a></li> <li ><a href="/paintings.html" title="My paintings for sale">Paintings</a></li> <li><a href="http://ru.yegor256.com/" title="Немного на русском языке">По-русски</a></li></ul></nav><div class="search"> <form method="get" action="https://www.google.com/search" itemprop="potentialAction" itemscope="" itemtype="http://schema.org/SearchAction"> <meta itemprop="target" content="https://www.google.com/search?q={q}"/> <input name="sitesearch" value="yegor256.com" type="hidden"/> <input itemprop="query-input" type="text" id="search-query" class="field field-text" required="required" onfocus="$('.google').css('visibility', 'visible');" name="q" placeholder="Search..." autocomplete="off"/> <input type="image" src="/images/google-search-icon.svg" class="google" title="Search via Google" alt="Search via Google"/> </form></div><div class="hot"><ul> <li> <a href="/code-ahead.html">Code Ahead</a> was published on Amazon just a few days ago! It is my new book, a novel about programmers. It explains in details the majority of ideas that stand behind <a href="https://www.zerocracy.com">Zerocracy</a> and <a href="https://www.xdsd.org">XDSD</a>. </li> <li> At <a href="/webinars.html">Webinar #37</a> we will discuss naming problem in OOP, for objects, methods and attributes; join us on <b>September 12</b>, at 11am PST. </li></ul></div></header></div><section itemscope="" itemtype="http://schema.org/BlogPosting"><div class="wrapper"> <header><p class="printable"> <img src="https://api.qrserver.com/v1/create-qr-code/?data=https://www.yegor256.com/2015/02/26/composable-decorators.html&amp;format=svg" style="width:125px;height:125px;" alt="QR code"/></p><p class="printable"> <code itemprop="url">https://www.yegor256.com/2015/02/26/composable-decorators.html</code></p><h1 itemprop="name headline mainEntityOfPage">Composable Decorators vs. Imperative Utility Methods</h1><ul class="subline"> <li> <time itemprop="datePublished" datetime="2015-02-26T00:00:00+00:00"> 26 February 2015 </time> </li> <li class="printable" itemscope="" itemprop="author" itemtype="http://schema.org/Person"> <span itemprop="name">Yegor Bugayenko</span> </li> <li class="unprintable"> <i class="icon icon-comments"></i> <a href="http://www.yegor256.com/2015/02/26/composable-decorators.html#disqus_thread" itemprop="discussionUrl">comments</a> </li></ul><p class="unprintable"><p>The <a href="http://en.wikipedia.org/wiki/Decorator_pattern">decorator pattern</a> is my favorite among all other patterns I&#39;m aware of. It is a very simple and yet very powerful mechanism to make your code <a href="http://en.wikipedia.org/wiki/Cohesion_%28computer_science%29">highly cohesive</a> and <a href="http://en.wikipedia.org/wiki/Coupling_%28computer_programming%29">loosely coupled</a>. However, I believe decorators are not used often enough. They should be everywhere, but they are not. The biggest advantage we get from decorators is that they make our code <em>composable</em>. That&#39;s why the title of this post is composable decorators. Unfortunately, instead of decorators, we often use imperative utility methods, which make our code procedural rather than object-oriented.</p><figure class='jb_picture'><img itemprop='image' alt='Main picture' src='/images/2015/02/russina-matroshka.jpg'/></figure><p>First, a practical example. Here is an interface for an object that is supposed to read a text somewhere and return it:</p><figure class="highlight"><pre><code class="language-java" data-lang="java"><span></span><span class="kd">interface</span> <span class="nc">Text</span> <span class="o">{</span>
  <span class="n">String</span> <span class="nf">read</span><span class="o">();</span>
<span class="o">}</span></code></pre></figure><p>Here is an implementation that reads the text from a file:</p><figure class="highlight"><pre><code class="language-java" data-lang="java"><span></span><span class="kd">final</span> <span class="kd">class</span> <span class="nc">TextInFile</span> <span class="kd">implements</span> <span class="n">Text</span> <span class="o">{</span>
  <span class="kd">private</span> <span class="kd">final</span> <span class="n">File</span> <span class="n">file</span><span class="o">;</span>
  <span class="kd">public</span> <span class="nf">TextInFile</span><span class="o">(</span><span class="kd">final</span> <span class="n">File</span> <span class="n">src</span><span class="o">)</span> <span class="o">{</span>
    <span class="k">this</span><span class="o">.</span><span class="na">file</span> <span class="o">=</span> <span class="n">src</span><span class="o">;</span>
  <span class="o">}</span>
  <span class="nd">@Override</span>
  <span class="kd">public</span> <span class="n">String</span> <span class="nf">read</span><span class="o">()</span> <span class="o">{</span>
    <span class="k">return</span> <span class="k">new</span> <span class="n">String</span><span class="o">(</span>
      <span class="n">Files</span><span class="o">.</span><span class="na">readAllBytes</span><span class="o">(),</span> <span class="s">&quot;UTF-8&quot;</span>
    <span class="o">);</span>
  <span class="o">}</span>
<span class="o">}</span></code></pre></figure><p>And now the decorator, which is another implementation of <code>Text</code> that removes all unprintable characters from the text:</p><figure class="highlight"><pre><code class="language-java" data-lang="java"><span></span><span class="kd">final</span> <span class="kd">class</span> <span class="nc">PrintableText</span> <span class="kd">implements</span> <span class="n">Text</span> <span class="o">{</span>
  <span class="kd">private</span> <span class="kd">final</span> <span class="n">Text</span> <span class="n">origin</span><span class="o">;</span>
  <span class="kd">public</span> <span class="nf">PrintableText</span><span class="o">(</span><span class="kd">final</span> <span class="n">Text</span> <span class="n">text</span><span class="o">)</span> <span class="o">{</span>
    <span class="k">this</span><span class="o">.</span><span class="na">origin</span> <span class="o">=</span> <span class="n">text</span><span class="o">;</span>
  <span class="o">}</span>
  <span class="nd">@Override</span>
  <span class="kd">public</span> <span class="n">String</span> <span class="nf">read</span><span class="o">()</span> <span class="o">{</span>
    <span class="k">return</span> <span class="k">this</span><span class="o">.</span><span class="na">origin</span><span class="o">.</span><span class="na">read</span><span class="o">()</span>
      <span class="o">.</span><span class="na">replaceAll</span><span class="o">(</span><span class="s">&quot;[^\p{Print}]&quot;</span><span class="o">,</span> <span class="s">&quot;&quot;</span><span class="o">);</span>
  <span class="o">}</span>
<span class="o">}</span></code></pre></figure><p>Here is how I&#39;m using it:</p><figure class="highlight"><pre><code class="language-java" data-lang="java"><span></span><span class="kd">final</span> <span class="n">Text</span> <span class="n">text</span> <span class="o">=</span> <span class="k">new</span> <span class="n">PrintableText</span><span class="o">(</span>
  <span class="k">new</span> <span class="n">TextInFile</span><span class="o">(</span><span class="k">new</span> <span class="n">File</span><span class="o">(</span><span class="s">&quot;/tmp/a.txt&quot;</span><span class="o">))</span>
<span class="o">);</span>
<span class="n">String</span> <span class="n">content</span> <span class="o">=</span> <span class="n">text</span><span class="o">.</span><span class="na">read</span><span class="o">();</span></code></pre></figure><p>As you can see, the <code>PrintableText</code> doesn&#39;t read the text from the file. It doesn&#39;t really care where the text is coming from. It <em>delegates</em> text reading to the encapsulated instance of <code>Text</code>. How this encapsulated object will deal with the text and where it will get it doesn&#39;t concern <code>PrintableText</code>.</p><p>Let&#39;s <a href="/2016/04/19/object-must-not-be-configurable.html">continue</a> and try to create an implementation of <code>Text</code> that will capitalize all letters in the text:</p><figure class="highlight"><pre><code class="language-java" data-lang="java"><span></span><span class="kd">final</span> <span class="kd">class</span> <span class="nc">AllCapsText</span> <span class="kd">implements</span> <span class="n">Text</span> <span class="o">{</span>
  <span class="kd">private</span> <span class="kd">final</span> <span class="n">Text</span> <span class="n">origin</span><span class="o">;</span>
  <span class="kd">public</span> <span class="nf">AllCapsText</span><span class="o">(</span><span class="kd">final</span> <span class="n">Text</span> <span class="n">text</span><span class="o">)</span> <span class="o">{</span>
    <span class="k">this</span><span class="o">.</span><span class="na">origin</span> <span class="o">=</span> <span class="n">text</span><span class="o">;</span>
  <span class="o">}</span>
  <span class="nd">@Override</span>
  <span class="kd">public</span> <span class="n">String</span> <span class="nf">read</span><span class="o">()</span> <span class="o">{</span>
    <span class="k">return</span> <span class="k">this</span><span class="o">.</span><span class="na">origin</span><span class="o">.</span><span class="na">read</span><span class="o">().</span><span class="na">toUpperCase</span><span class="o">(</span><span class="n">Locale</span><span class="o">.</span><span class="na">ENGLISH</span><span class="o">);</span>
  <span class="o">}</span>
<span class="o">}</span></code></pre></figure><p>How about a <code>Text</code> that trims the input:</p><figure class="highlight"><pre><code class="language-java" data-lang="java"><span></span><span class="kd">final</span> <span class="kd">class</span> <span class="nc">TrimmedText</span> <span class="kd">implements</span> <span class="n">Text</span> <span class="o">{</span>
  <span class="kd">private</span> <span class="kd">final</span> <span class="n">Text</span> <span class="n">origin</span><span class="o">;</span>
  <span class="kd">public</span> <span class="nf">TrimmedText</span><span class="o">(</span><span class="kd">final</span> <span class="n">Text</span> <span class="n">text</span><span class="o">)</span> <span class="o">{</span>
    <span class="k">this</span><span class="o">.</span><span class="na">origin</span> <span class="o">=</span> <span class="n">text</span><span class="o">;</span>
  <span class="o">}</span>
  <span class="nd">@Override</span>
  <span class="kd">public</span> <span class="n">String</span> <span class="nf">read</span><span class="o">()</span> <span class="o">{</span>
    <span class="k">return</span> <span class="k">this</span><span class="o">.</span><span class="na">origin</span><span class="o">.</span><span class="na">read</span><span class="o">().</span><span class="na">trim</span><span class="o">();</span>
  <span class="o">}</span>
<span class="o">}</span></code></pre></figure> <aside class='youtube'> <a href='https://www.youtube.com/watch?v=D0dqC_3Bch8'><div class='box'> <img src='https://i.ytimg.com/vi/D0dqC_3Bch8/mqdefault.jpg' alt='YouTube video #D0dqC_3Bch8'/><div class='play'><i class='icon icon-play'></i></div></div></a><div>Objects vs. Static Methods (webinar #1); 8 April 2015.</div></aside><p>I can go on and on with these <a href="/2015/10/01/vertical-horizontal-decorating.html">decorators</a>. I can create many of them, suitable for their own individual use cases. But let&#39;s see how they all can play together. Let&#39;s say I want to read the text from the file, capitalize it, trim it, and remove all unprintable characters. And I want to be <em>declarative</em>. Here is what I do:</p><figure class="highlight"><pre><code class="language-java" data-lang="java"><span></span><span class="kd">final</span> <span class="n">Text</span> <span class="n">text</span> <span class="o">=</span> <span class="k">new</span> <span class="n">AllCapsText</span><span class="o">(</span>
  <span class="k">new</span> <span class="n">TrimmedText</span><span class="o">(</span>
    <span class="k">new</span> <span class="n">PrintableText</span><span class="o">(</span>
      <span class="k">new</span> <span class="n">TextInFile</span><span class="o">(</span><span class="k">new</span> <span class="n">File</span><span class="o">(</span><span class="s">&quot;/tmp/a.txt&quot;</span><span class="o">))</span>
    <span class="o">)</span>
  <span class="o">)</span>
<span class="o">);</span>
<span class="n">String</span> <span class="n">content</span> <span class="o">=</span> <span class="n">text</span><span class="o">.</span><span class="na">read</span><span class="o">();</span></code></pre></figure><p>First, I create an instance of <code>Text</code>, <em>composing</em> multiple decorators into a single object. I declaratively define the behavior of <code>text</code> without actually executing anything. Until method <code>read()</code> is called, the file is not touched and the processing of the text is not started. The object <code>text</code> is just a composition of decorators, not an executable <em>procedure</em>. Check out this article about declarative and imperative styles of programming: <a href="/2015/02/20/utility-classes-vs-functional-programming.html">Utility Classes Have Nothing to Do With Functional Programming</a>.</p><p>This design is much more flexible and reusable than a more traditional one, where the <code>Text</code> object is smart enough to perform all said operations. For example, class <a href="http://docs.oracle.com/javase/7/docs/api/java/lang/String.html"><code>String</code></a> from Java is a good example of a bad design. It has more than 20 <em>utility methods</em> that should have been provided as decorators instead: <code>trim()</code>, <code>toUpperCase()</code>, <code>substring()</code>, <code>split()</code>, and many others, for example. When I want to trim my string, uppercase it, and then split it into pieces, here is what my code will look like:</p><figure class="highlight"><pre><code class="language-java" data-lang="java"><span></span><span class="kd">final</span> <span class="n">String</span> <span class="n">txt</span> <span class="o">=</span> <span class="s">&quot;hello, world!&quot;</span><span class="o">;</span>
<span class="kd">final</span> <span class="n">String</span><span class="o">[]</span> <span class="n">parts</span> <span class="o">=</span> <span class="n">txt</span><span class="o">.</span><span class="na">trim</span><span class="o">().</span><span class="na">toUpperCase</span><span class="o">().</span><span class="na">split</span><span class="o">(</span><span class="s">&quot; &quot;</span><span class="o">);</span></code></pre></figure><p>This is imperative and procedural programming. Composable decorators, on the other hand, would make this code object-oriented and declarative. Something like this would be great to have in Java instead (pseudo-code):</p><figure class="highlight"><pre><code class="language-java" data-lang="java"><span></span><span class="kd">final</span> <span class="n">String</span><span class="o">[]</span> <span class="n">parts</span> <span class="o">=</span> <span class="k">new</span> <span class="n">String</span><span class="o">.</span><span class="na">Split</span><span class="o">(</span>
  <span class="k">new</span> <span class="n">String</span><span class="o">.</span><span class="na">UpperCased</span><span class="o">(</span>
    <span class="k">new</span> <span class="n">String</span><span class="o">.</span><span class="na">Trimmed</span><span class="o">(</span><span class="s">&quot;hello, world!&quot;</span><span class="o">)</span>
  <span class="o">)</span>
<span class="o">);</span></code></pre></figure><p>To conclude, I recommend you think twice every time you add a new utility method to the interface/class. Try to avoid utility methods as much as possible, and use decorators instead. An <a href="/2016/04/26/why-inputstream-design-is-wrong.html">ideal interface</a> should contain only methods that you absolutely cannot remove. Everything else should be done through composable decorators.</p></p><nav class="buttons notranslate desktop-only"> <a href="http://www.facebook.com/sharer/sharer.php?u=https://www.yegor256.com/2015/02/26/composable-decorators.html" title="Share on Facebook" class="button" rel="nofollow"> <span class="count count-facebook">0</span> <i class="icon icon-facebook notranslate" aria-hidden="true"></i> </a> <a href="https://twitter.com/share?url=https://www.yegor256.com/2015/02/26/composable-decorators.html&amp;text=Composable+Decorators+vs.+Imperative+Utility+Methods" title="Share on Twitter" class="button" rel="nofollow"> <span class="count count-twitter">0</span> <i class="icon icon-twitter notranslate" aria-hidden="true"></i> </a> <a href="https://plus.google.com/share?url=https://www.yegor256.com/2015/02/26/composable-decorators.html" title="Share on Google+" class="button" rel="nofollow"> <span class="count count-googleplus">0</span> <i class="icon icon-googleplus notranslate" aria-hidden="true"></i> </a> <a href="https://www.linkedin.com/cws/share?url=https://www.yegor256.com/2015/02/26/composable-decorators.html" title="Share on LinkedIn" class="button" rel="nofollow"> <span class="count count-linkedin">0</span> <i class="icon icon-linkedin notranslate" aria-hidden="true"></i> </a> <a href="http://reddit.com/submit?url=https://www.yegor256.com/2015/02/26/composable-decorators.html%3F2015-08&amp;title=Composable+Decorators+vs.+Imperative+Utility+Methods" title="Share on Reddit" class="button" rel="nofollow"> <span class="count count-reddit">0</span> <i class="icon icon-reddit notranslate" aria-hidden="true"></i> </a> <a href="http://news.ycombinator.com/submitlink?u=https://www.yegor256.com/2015/02/26/composable-decorators.html%3F2015-08&amp;t=Composable+Decorators+vs.+Imperative+Utility+Methods" title="Share on Hacker News" class="button" rel="nofollow"> <span class="count count-hackernews">0</span> <i class="icon icon-hackernews notranslate" aria-hidden="true"></i> </a> </nav> </header> <article class="main" itemprop="articleBody"><div ><p>The <a href="http://en.wikipedia.org/wiki/Decorator_pattern">decorator pattern</a> is my favorite among all other patterns I&#39;m aware of. It is a very simple and yet very powerful mechanism to make your code <a href="http://en.wikipedia.org/wiki/Cohesion_%28computer_science%29">highly cohesive</a> and <a href="http://en.wikipedia.org/wiki/Coupling_%28computer_programming%29">loosely coupled</a>. However, I believe decorators are not used often enough. They should be everywhere, but they are not. The biggest advantage we get from decorators is that they make our code <em>composable</em>. That&#39;s why the title of this post is composable decorators. Unfortunately, instead of decorators, we often use imperative utility methods, which make our code procedural rather than object-oriented.</p><figure class='jb_picture'><img itemprop='image' alt='Main picture' src='/images/2015/02/russina-matroshka.jpg'/></figure><p>First, a practical example. Here is an interface for an object that is supposed to read a text somewhere and return it:</p><figure class="highlight"><pre><code class="language-java" data-lang="java"><span></span><span class="kd">interface</span> <span class="nc">Text</span> <span class="o">{</span>
  <span class="n">String</span> <span class="nf">read</span><span class="o">();</span>
<span class="o">}</span></code></pre></figure><p>Here is an implementation that reads the text from a file:</p><figure class="highlight"><pre><code class="language-java" data-lang="java"><span></span><span class="kd">final</span> <span class="kd">class</span> <span class="nc">TextInFile</span> <span class="kd">implements</span> <span class="n">Text</span> <span class="o">{</span>
  <span class="kd">private</span> <span class="kd">final</span> <span class="n">File</span> <span class="n">file</span><span class="o">;</span>
  <span class="kd">public</span> <span class="nf">TextInFile</span><span class="o">(</span><span class="kd">final</span> <span class="n">File</span> <span class="n">src</span><span class="o">)</span> <span class="o">{</span>
    <span class="k">this</span><span class="o">.</span><span class="na">file</span> <span class="o">=</span> <span class="n">src</span><span class="o">;</span>
  <span class="o">}</span>
  <span class="nd">@Override</span>
  <span class="kd">public</span> <span class="n">String</span> <span class="nf">read</span><span class="o">()</span> <span class="o">{</span>
    <span class="k">return</span> <span class="k">new</span> <span class="n">String</span><span class="o">(</span>
      <span class="n">Files</span><span class="o">.</span><span class="na">readAllBytes</span><span class="o">(),</span> <span class="s">&quot;UTF-8&quot;</span>
    <span class="o">);</span>
  <span class="o">}</span>
<span class="o">}</span></code></pre></figure><p>And now the decorator, which is another implementation of <code>Text</code> that removes all unprintable characters from the text:</p><figure class="highlight"><pre><code class="language-java" data-lang="java"><span></span><span class="kd">final</span> <span class="kd">class</span> <span class="nc">PrintableText</span> <span class="kd">implements</span> <span class="n">Text</span> <span class="o">{</span>
  <span class="kd">private</span> <span class="kd">final</span> <span class="n">Text</span> <span class="n">origin</span><span class="o">;</span>
  <span class="kd">public</span> <span class="nf">PrintableText</span><span class="o">(</span><span class="kd">final</span> <span class="n">Text</span> <span class="n">text</span><span class="o">)</span> <span class="o">{</span>
    <span class="k">this</span><span class="o">.</span><span class="na">origin</span> <span class="o">=</span> <span class="n">text</span><span class="o">;</span>
  <span class="o">}</span>
  <span class="nd">@Override</span>
  <span class="kd">public</span> <span class="n">String</span> <span class="nf">read</span><span class="o">()</span> <span class="o">{</span>
    <span class="k">return</span> <span class="k">this</span><span class="o">.</span><span class="na">origin</span><span class="o">.</span><span class="na">read</span><span class="o">()</span>
      <span class="o">.</span><span class="na">replaceAll</span><span class="o">(</span><span class="s">&quot;[^\p{Print}]&quot;</span><span class="o">,</span> <span class="s">&quot;&quot;</span><span class="o">);</span>
  <span class="o">}</span>
<span class="o">}</span></code></pre></figure><p>Here is how I&#39;m using it:</p><figure class="highlight"><pre><code class="language-java" data-lang="java"><span></span><span class="kd">final</span> <span class="n">Text</span> <span class="n">text</span> <span class="o">=</span> <span class="k">new</span> <span class="n">PrintableText</span><span class="o">(</span>
  <span class="k">new</span> <span class="n">TextInFile</span><span class="o">(</span><span class="k">new</span> <span class="n">File</span><span class="o">(</span><span class="s">&quot;/tmp/a.txt&quot;</span><span class="o">))</span>
<span class="o">);</span>
<span class="n">String</span> <span class="n">content</span> <span class="o">=</span> <span class="n">text</span><span class="o">.</span><span class="na">read</span><span class="o">();</span></code></pre></figure><p>As you can see, the <code>PrintableText</code> doesn&#39;t read the text from the file. It doesn&#39;t really care where the text is coming from. It <em>delegates</em> text reading to the encapsulated instance of <code>Text</code>. How this encapsulated object will deal with the text and where it will get it doesn&#39;t concern <code>PrintableText</code>.</p><p>Let&#39;s <a href="/2016/04/19/object-must-not-be-configurable.html">continue</a> and try to create an implementation of <code>Text</code> that will capitalize all letters in the text:</p><figure class="highlight"><pre><code class="language-java" data-lang="java"><span></span><span class="kd">final</span> <span class="kd">class</span> <span class="nc">AllCapsText</span> <span class="kd">implements</span> <span class="n">Text</span> <span class="o">{</span>
  <span class="kd">private</span> <span class="kd">final</span> <span class="n">Text</span> <span class="n">origin</span><span class="o">;</span>
  <span class="kd">public</span> <span class="nf">AllCapsText</span><span class="o">(</span><span class="kd">final</span> <span class="n">Text</span> <span class="n">text</span><span class="o">)</span> <span class="o">{</span>
    <span class="k">this</span><span class="o">.</span><span class="na">origin</span> <span class="o">=</span> <span class="n">text</span><span class="o">;</span>
  <span class="o">}</span>
  <span class="nd">@Override</span>
  <span class="kd">public</span> <span class="n">String</span> <span class="nf">read</span><span class="o">()</span> <span class="o">{</span>
    <span class="k">return</span> <span class="k">this</span><span class="o">.</span><span class="na">origin</span><span class="o">.</span><span class="na">read</span><span class="o">().</span><span class="na">toUpperCase</span><span class="o">(</span><span class="n">Locale</span><span class="o">.</span><span class="na">ENGLISH</span><span class="o">);</span>
  <span class="o">}</span>
<span class="o">}</span></code></pre></figure><p>How about a <code>Text</code> that trims the input:</p><figure class="highlight"><pre><code class="language-java" data-lang="java"><span></span><span class="kd">final</span> <span class="kd">class</span> <span class="nc">TrimmedText</span> <span class="kd">implements</span> <span class="n">Text</span> <span class="o">{</span>
  <span class="kd">private</span> <span class="kd">final</span> <span class="n">Text</span> <span class="n">origin</span><span class="o">;</span>
  <span class="kd">public</span> <span class="nf">TrimmedText</span><span class="o">(</span><span class="kd">final</span> <span class="n">Text</span> <span class="n">text</span><span class="o">)</span> <span class="o">{</span>
    <span class="k">this</span><span class="o">.</span><span class="na">origin</span> <span class="o">=</span> <span class="n">text</span><span class="o">;</span>
  <span class="o">}</span>
  <span class="nd">@Override</span>
  <span class="kd">public</span> <span class="n">String</span> <span class="nf">read</span><span class="o">()</span> <span class="o">{</span>
    <span class="k">return</span> <span class="k">this</span><span class="o">.</span><span class="na">origin</span><span class="o">.</span><span class="na">read</span><span class="o">().</span><span class="na">trim</span><span class="o">();</span>
  <span class="o">}</span>
<span class="o">}</span></code></pre></figure> <aside class='youtube'> <a href='https://www.youtube.com/watch?v=D0dqC_3Bch8'><div class='box'> <img src='https://i.ytimg.com/vi/D0dqC_3Bch8/mqdefault.jpg' alt='YouTube video #D0dqC_3Bch8'/><div class='play'><i class='icon icon-play'></i></div></div></a><div>Objects vs. Static Methods (webinar #1); 8 April 2015.</div></aside><p>I can go on and on with these <a href="/2015/10/01/vertical-horizontal-decorating.html">decorators</a>. I can create many of them, suitable for their own individual use cases. But let&#39;s see how they all can play together. Let&#39;s say I want to read the text from the file, capitalize it, trim it, and remove all unprintable characters. And I want to be <em>declarative</em>. Here is what I do:</p><figure class="highlight"><pre><code class="language-java" data-lang="java"><span></span><span class="kd">final</span> <span class="n">Text</span> <span class="n">text</span> <span class="o">=</span> <span class="k">new</span> <span class="n">AllCapsText</span><span class="o">(</span>
  <span class="k">new</span> <span class="n">TrimmedText</span><span class="o">(</span>
    <span class="k">new</span> <span class="n">PrintableText</span><span class="o">(</span>
      <span class="k">new</span> <span class="n">TextInFile</span><span class="o">(</span><span class="k">new</span> <span class="n">File</span><span class="o">(</span><span class="s">&quot;/tmp/a.txt&quot;</span><span class="o">))</span>
    <span class="o">)</span>
  <span class="o">)</span>
<span class="o">);</span>
<span class="n">String</span> <span class="n">content</span> <span class="o">=</span> <span class="n">text</span><span class="o">.</span><span class="na">read</span><span class="o">();</span></code></pre></figure><p>First, I create an instance of <code>Text</code>, <em>composing</em> multiple decorators into a single object. I declaratively define the behavior of <code>text</code> without actually executing anything. Until method <code>read()</code> is called, the file is not touched and the processing of the text is not started. The object <code>text</code> is just a composition of decorators, not an executable <em>procedure</em>. Check out this article about declarative and imperative styles of programming: <a href="/2015/02/20/utility-classes-vs-functional-programming.html">Utility Classes Have Nothing to Do With Functional Programming</a>.</p><p>This design is much more flexible and reusable than a more traditional one, where the <code>Text</code> object is smart enough to perform all said operations. For example, class <a href="http://docs.oracle.com/javase/7/docs/api/java/lang/String.html"><code>String</code></a> from Java is a good example of a bad design. It has more than 20 <em>utility methods</em> that should have been provided as decorators instead: <code>trim()</code>, <code>toUpperCase()</code>, <code>substring()</code>, <code>split()</code>, and many others, for example. When I want to trim my string, uppercase it, and then split it into pieces, here is what my code will look like:</p><figure class="highlight"><pre><code class="language-java" data-lang="java"><span></span><span class="kd">final</span> <span class="n">String</span> <span class="n">txt</span> <span class="o">=</span> <span class="s">&quot;hello, world!&quot;</span><span class="o">;</span>
<span class="kd">final</span> <span class="n">String</span><span class="o">[]</span> <span class="n">parts</span> <span class="o">=</span> <span class="n">txt</span><span class="o">.</span><span class="na">trim</span><span class="o">().</span><span class="na">toUpperCase</span><span class="o">().</span><span class="na">split</span><span class="o">(</span><span class="s">&quot; &quot;</span><span class="o">);</span></code></pre></figure><p>This is imperative and procedural programming. Composable decorators, on the other hand, would make this code object-oriented and declarative. Something like this would be great to have in Java instead (pseudo-code):</p><figure class="highlight"><pre><code class="language-java" data-lang="java"><span></span><span class="kd">final</span> <span class="n">String</span><span class="o">[]</span> <span class="n">parts</span> <span class="o">=</span> <span class="k">new</span> <span class="n">String</span><span class="o">.</span><span class="na">Split</span><span class="o">(</span>
  <span class="k">new</span> <span class="n">String</span><span class="o">.</span><span class="na">UpperCased</span><span class="o">(</span>
    <span class="k">new</span> <span class="n">String</span><span class="o">.</span><span class="na">Trimmed</span><span class="o">(</span><span class="s">&quot;hello, world!&quot;</span><span class="o">)</span>
  <span class="o">)</span>
<span class="o">);</span></code></pre></figure><p>To conclude, I recommend you think twice every time you add a new utility method to the interface/class. Try to avoid utility methods as much as possible, and use decorators instead. An <a href="/2016/04/26/why-inputstream-design-is-wrong.html">ideal interface</a> should contain only methods that you absolutely cannot remove. Everything else should be done through composable decorators.</p></div></article></div><div class="wrapper"> <related-posts /></div><div class="disqus" role="complementary"><p class="disqus_hint"> Please, use <a href="https://help.disqus.com/commenting/what-html-tags-are-allowed-within-comments">syntax highlighting</a> in your comments, to make them more readable.</p><div id="disqus_thread" class="disqus-thread"> <a>&nbsp;</a></div><script> var disqus_config = function () { this.page.url = document.location.href.split('?')[0].split('#')[0].replace('https://', 'http://'); this.page.identifier = this.page.url; }; (function() { var d = document, s = d.createElement('script'); s.src = '//yegor256.disqus.com/embed.js'; s.setAttribute('data-timestamp', +new Date()); (d.head || d.body).appendChild(s); })(); </script> <noscript><div><p class="red"> JavaScript is disabled in your browser, that's why you can't see comments under this post.</p></div></noscript></div><div class="wrapper"> <footer class="footer"><p> &copy; <span itemscope="" itemprop="copyrightHolder" itemtype="http://schema.org/Person"> <span itemprop="name">Yegor Bugayenko</span> </span> 2014&ndash;<span itemprop="copyrightYear">2018</span></p></footer></div></section><div class="wrapper unprintable" style="text-align:center;margin-top:2em;"> <a href="http://www.sixnines.io/h/3ba1652f"> <img src="//www.sixnines.io/b/3ba1652f?style=flat" alt="sixnines availability badge"/> </a></div><script src="//code.jquery.com/jquery-1.9.0.min.js"></script> <script src="/js/all.js?a0e0d018c07"></script> <script>var disqus_shortname = 'yegor256';</script> <script id="dsq-count-scr" src="//yegor256.disqus.com/count.js" async="async"></script> <script> (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){ (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o), m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m) })(window,document,'script','//www.google-analytics.com/analytics.js','ga'); ga('create', 'UA-1963507-32', 'auto'); ga('send', 'pageview'); </script> <script> Cd=document;Cr="&"+Math.random();Cp="&s=1"; Cd.cookie="b=b";if(Cd.cookie)Cp+="&c=1"; Cp+="&t="+(new Date()).getTimezoneOffset(); if(self!=top)Cp+="&f=1"; </script> <script> if(navigator.javaEnabled())Cp+="&j=1"; </script> <script> if(typeof(screen)!='undefined')Cp+="&w="+screen.width+"&h="+ screen.height+"&d="+(screen.colorDepth?screen.colorDepth:screen.pixelDepth); </script> <script> Cd.write("<img src='//c.hit.ua/hit?i=95870&g=0&x=2"+Cp+Cr+ "&r="+escape(Cd.referrer)+"&u="+escape(window.location.href)+ "' border='0' wi"+"dth='1' he"+"ight='1'/>"); </script> <script type="application/ld+json"> { "@context": "http://schema.org", "@type": "Person", "name": "Yegor Bugayenko", "url": "http://www.yegor256.com", "sameAs": [ "https://www.facebook.com/yegor256", "https://instagram.com/yegor256", "https://www.linkedin.com/in/yegor256", "https://twitter.com/yegor256", "https://github.com/yegor256", "https://www.pinterest.com/yegor256/" ] } </script> </body> </html> <!DOCTYPE html> <html xmlns="http://www.w3.org/1999/xhtml" lang="en-US" xml:lang="en-US" itemscope="" itemtype="http://schema.org/WebSite"> <head> <meta charset="utf-8"/> <meta name="description" content="Utility classes, even though they look like collections of functions, have nothing to do with functional programming, mostly because they are bags of procedures " /> <meta name="keywords" content="functional programming, utility classes, utility classes are not functional programming, utility classes in java, utility classes vs functional programming" /> <meta name="viewport" content="width=device-width,minimum-scale=1,initial-scale=1"/> <meta name="google-site-verification" content="JEj_gQr2CPe2QKGw8XdMz0R7VboQIUbX3FlM-lwTq-8" /> <meta name="author" content="Yegor Bugayenko"> <meta name="article:published_time" content="2015-02-20 00:00:00 +0000"> <meta name="og:site_name" content="Yegor Bugayenko"/> <meta name="og:type" content="article" /> <meta name="og:locale" content="en_US" /> <meta name="twitter:account_id" content="4503599630178231" /> <meta name="twitter:creator" content="@yegor256"/> <meta name="twitter:site" content="@yegor256"/> <meta name="twitter:title" property="og:title" content="Utility Classes Have Nothing to Do With Functional Programming"/> <meta name="twitter:description" property="og:description" content="Utility classes, even though they look like collections of functions, have nothing to do with functional programming, mostly because they are bags of procedures "/> <meta name="twitter:url" property="og:url" content="https://www.yegor256.com/2015/02/20/utility-classes-vs-functional-programming.html"/> <meta name="telegram:channel" content="AAAAAEJFMRzsRTRxM3ec6A"/> <link rel="search" type="application/opensearchdescription+xml" href="/opensearch.xml" title="yegor256" /> <link rel="shortcut icon" href="/favicon.ico?a0e0d018c07"/> <link rel="apple-touch-icon" href="/favicon.ico?a0e0d018c07"/> <link rel="alternate" type="application/rss+xml" title="RSS for yegor256.com" href="https://www.yegor256.com/rss.xml"/> <link rel="stylesheet" href="/css/layout.css?a0e0d018c07"/> <link rel="stylesheet" href="/css/icons.css?a0e0d018c07"/> <link rel="canonical" href="https://www.yegor256.com/2015/02/20/utility-classes-vs-functional-programming.html" /> <link rel="amphtml" href="https://www.yegor256.com/2015/02/20/utility-classes-vs-functional-programming.amp.html" /> <title>Utility Classes Have Nothing to Do With Functional Programming </title> <meta name='og:image' content='https://www.yegor256.com/images/2015/02/color-me-kubrick.png'/><meta name='twitter:image' content='https://www.yegor256.com/images/2015/02/color-me-kubrick.png'/><meta name='og:image:width' content='1200'/> <meta name='twitter:image:width' content='1200'/><meta name='og:image:height' content='680'/> <meta name='twitter:image:height' content='680'/><meta name='twitter:card' content='summary_large_image'/><meta name='twitter:image:alt' content='Color Me Kubrick (2005) by Brian W. Cook'/> </head> <body><div class="wrapper"> <aside class="header-toggle unprintable" id="header-toggle" title="Show the menu" onclick="$('#header').show();$('#header-toggle').hide();">&#9776;</aside> <header class="header" id="header"><div class="face"> <a href="/about-me.html#form" class="sub" title="Click to subscribe to my monthly newsletter"><span>Subscribe</span></a> <a href="/about-me.html" style="position:relative;"> <img src="/images/face-256x256.jpg" class="photo" alt="Yegor Bugayenko"/> </a></div><nav><ul class="menu social notranslate"> <li><a href="https://twitter.com/intent/follow?screen_name=yegor256" rel="nofollow" title="Follow me on Twitter"><i class="icon icon-twitter notranslate" aria-hidden="true"></i></a></li> <li><a href="/rss.xml" rel="nofollow" title="Subscribe to my RSS feed"><i class="icon icon-rss notranslate" aria-hidden="true"></i></a></li> <li><a itemprop="sameAs" href="https://github.com/yegor256" rel="nofollow" title="My GitHub profile"><i class="icon icon-github notranslate" aria-hidden="true"></i></a></li> <li><a itemprop="sameAs" href="http://stackoverflow.com/users/187141/yegor256" rel="nofollow" title="My StackOverflow profile"><i class="icon icon-stackoverflow notranslate" aria-hidden="true"></i></a></li> <li><a itemprop="sameAs" href="https://www.facebook.com/yegor256" rel="nofollow" title="Follow me on Facebook"><i class="icon icon-facebook notranslate" aria-hidden="true"></i></a></li> <li><a itemprop="sameAs" href="https://instagram.com/yegor256" rel="nofollow" title="Follow me on Instagram"><i class="icon icon-instagram notranslate" aria-hidden="true"></i></a></li> <li><a itemprop="sameAs" href="https://www.linkedin.com/in/yegor256" rel="nofollow" title="My LinkedIn profile"><i class="icon icon-linkedin notranslate" aria-hidden="true"></i></a></li> <li><a itemprop="sameAs" href="https://www.youtube.com/c/yegor256?sub_confirmation=1" rel="nofollow" title="My Youtube video channel"><i class="icon icon-youtube notranslate" aria-hidden="true"></i></a></li> <li><a itemprop="sameAs" href="https://www.pinterest.com/yegor256/" rel="nofollow" title="My Pinterest boards"><i class="icon icon-pinterest notranslate" aria-hidden="true"></i></a></li> <li><a itemprop="sameAs" href="https://angel.co/yegor256" rel="nofollow" title="My AngelList profile"><i class="icon icon-angellist notranslate" aria-hidden="true"></i></a></li> <li><a href="https://soundcloud.com/yegor256" rel="nofollow" title="My podcast"><i class="icon icon-podcast notranslate" aria-hidden="true"></i></a></li> <li><a href="https://itunes.apple.com/us/podcast/yegor256-podcast/id1150826721" rel="nofollow" title="My iTunes podcast"><i class="icon icon-itunes notranslate" aria-hidden="true"></i></a></li> <li><a href="https://t.me/joinchat/AAAAAEJFMRzsRTRxM3ec6A" rel="nofollow" title="My Telegram public channel"><i class="icon icon-telegram notranslate" aria-hidden="true"></i></a></li> <li><a href="mailto:blog@yegor256.com" rel="nofollow" title="Email me any time"><i class="icon icon-mail notranslate" aria-hidden="true"></i></a></li></ul><ul class="menu"> <li><a href="/" title="Home page">Home</a></li> <li ><a href="/best.html" title="Best articles to read">12&#160;Best</a></li> <li ><a href="/contents.html" title="The contents of the entire blog">All&#160;288</a></li> <li ><a href="/webinars.html" title="My webinars">Webinars</a></li> <li ><a href="/talks.html" title="Future and past conference talks">Talks</a></li> <li ><a href="/books.html" title="The books I wrote">Books</a></li> <li ><a href="/papers.html" title="My academic papers and patents">Papers</a></li> <li ><a href="/pets.html" title="My loved pet projects">Pets</a></li> <li ><a href="/award.html" title="Software quality award">Award</a></li> <li ><a href="/testimonials.html" title="What some people say about me">Testimonials</a></li> <li ><a href="/shift-m.html" title="Audio podcast about project management">Shift-M</a></li> <li ><a href="/paintings.html" title="My paintings for sale">Paintings</a></li> <li><a href="http://ru.yegor256.com/" title="Немного на русском языке">По-русски</a></li></ul></nav><div class="search"> <form method="get" action="https://www.google.com/search" itemprop="potentialAction" itemscope="" itemtype="http://schema.org/SearchAction"> <meta itemprop="target" content="https://www.google.com/search?q={q}"/> <input name="sitesearch" value="yegor256.com" type="hidden"/> <input itemprop="query-input" type="text" id="search-query" class="field field-text" required="required" onfocus="$('.google').css('visibility', 'visible');" name="q" placeholder="Search..." autocomplete="off"/> <input type="image" src="/images/google-search-icon.svg" class="google" title="Search via Google" alt="Search via Google"/> </form></div><div class="hot"><ul> <li> <a href="/code-ahead.html">Code Ahead</a> was published on Amazon just a few days ago! It is my new book, a novel about programmers. It explains in details the majority of ideas that stand behind <a href="https://www.zerocracy.com">Zerocracy</a> and <a href="https://www.xdsd.org">XDSD</a>. </li> <li> At <a href="/webinars.html">Webinar #37</a> we will discuss naming problem in OOP, for objects, methods and attributes; join us on <b>September 12</b>, at 11am PST. </li></ul></div></header></div><section itemscope="" itemtype="http://schema.org/BlogPosting"><div class="wrapper"> <header><p class="printable"> <img src="https://api.qrserver.com/v1/create-qr-code/?data=https://www.yegor256.com/2015/02/20/utility-classes-vs-functional-programming.html&amp;format=svg" style="width:125px;height:125px;" alt="QR code"/></p><p class="printable"> <code itemprop="url">https://www.yegor256.com/2015/02/20/utility-classes-vs-functional-programming.html</code></p><h1 itemprop="name headline mainEntityOfPage">Utility Classes Have Nothing to Do With Functional Programming</h1><ul class="subline"> <li> <time itemprop="datePublished" datetime="2015-02-20T00:00:00+00:00"> 20 February 2015 </time> </li> <li class="printable" itemscope="" itemprop="author" itemtype="http://schema.org/Person"> <span itemprop="name">Yegor Bugayenko</span> </li> <li class="unprintable"> <i class="icon icon-comments"></i> <a href="http://www.yegor256.com/2015/02/20/utility-classes-vs-functional-programming.html#disqus_thread" itemprop="discussionUrl">comments</a> </li></ul><p class="unprintable"><p>I was recently <a href="https://twitter.com/lukaseder/status/564866432790708224">accused</a> of being against <a href="http://en.wikipedia.org/wiki/Functional_programming">functional programming</a> because <a href="/2014/05/05/oop-alternative-to-utility-classes.html">I call utility classes an anti-pattern</a>. That&#39;s absolutely wrong! Well, I do consider them a terrible anti-pattern, but they have nothing to do with functional programming. I believe there are two basic reasons why. First, functional programming is declarative, while utility class methods are imperative. Second, functional programming is based on lambda calculus, where a function can be assigned to a variable. Utility class methods are not functions in this sense. I&#39;ll decode these statements in a minute.</p><p>In Java, there are basically two valid alternatives to these ugly utility classes aggressively promoted by <a href="https://code.google.com/p/guava-libraries/">Guava</a>, <a href="http://commons.apache.org/">Apache Commons</a>, and others. The first one is the use of traditional classes, and the second one is <a href="http://docs.oracle.com/javase/tutorial/java/javaOO/lambdaexpressions.html">Java&nbsp;8 lambda</a>. Now let&#39;s see why utility classes are not even close to functional programming and where this misconception is coming from.</p><figure class='jb_picture'><img itemprop='image' alt='Color Me Kubrick (2005) by Brian W. Cook' src='/images/2015/02/color-me-kubrick.png' longdesc='#56d1f92f'/><figcaption id='56d1f92f'>Color Me Kubrick (2005) by Brian W. Cook</figcaption></figure><p>Here is a typical example of a utility class <a href="http://docs.oracle.com/javase/7/docs/api/java/lang/Math.html"><code>Math</code></a> from Java 1.0:</p><figure class="highlight"><pre><code class="language-java" data-lang="java"><span></span><span class="kd">public</span> <span class="kd">class</span> <span class="nc">Math</span> <span class="o">{</span>
  <span class="kd">public</span> <span class="kd">static</span> <span class="kt">double</span> <span class="nf">abs</span><span class="o">(</span><span class="kt">double</span> <span class="n">a</span><span class="o">);</span>
  <span class="c1">// a few dozens of other methods of the same style</span>
<span class="o">}</span></code></pre></figure><p>Here is how you would use it when you want to calculate an absolute value of a floating point number:</p><figure class="highlight"><pre><code class="language-java" data-lang="java"><span></span><span class="kt">double</span> <span class="n">x</span> <span class="o">=</span> <span class="n">Math</span><span class="o">.</span><span class="na">abs</span><span class="o">(</span><span class="mf">3.1415926d</span><span class="o">);</span></code></pre></figure> <aside class='quote'>The code will work, but it is not object-oriented programming</aside><p>What&#39;s wrong with it? We need a function, and we get it from class <code>Math</code>. The class has many useful functions inside it that can be used for many typical mathematical operations, like calculating maximum, minimum, sine, cosine, etc. It is a very popular concept; just look at any commercial or open source product. These utility classes are used everywhere since Java was invented (this <code>Math</code> class was introduced in Java&#39;s first version). Well, technically there is nothing wrong. The code will work. But it is not object-oriented programming. Instead, it is imperative and procedural. Do we care? Well, it&#39;s up to you to decide. Let&#39;s see what the difference is.</p><aside class='youtube'> <a href='https://www.youtube.com/watch?v=D0dqC_3Bch8'><div class='box'> <img src='https://i.ytimg.com/vi/D0dqC_3Bch8/mqdefault.jpg' alt='YouTube video #D0dqC_3Bch8'/><div class='play'><i class='icon icon-play'></i></div></div></a><div>Objects vs. Static Methods (webinar #1); 8 April 2015.</div></aside><p>There are basically two different approaches: declarative and imperative.</p><p><a href="http://en.wikipedia.org/wiki/Imperative_programming">Imperative programming</a> is focused on describing <strong>how</strong> a program operates in terms of statements that change a program state. We just saw an example of imperative programming above. Here is another (this is pure imperative/procedural programming that has nothing to do with <a href="/2016/08/15/what-is-wrong-object-oriented-programming.html">OOP</a>):</p><figure class="highlight"><pre><code class="language-java" data-lang="java"><span></span><span class="kd">public</span> <span class="kd">class</span> <span class="nc">MyMath</span> <span class="o">{</span>
  <span class="kd">public</span> <span class="kt">double</span> <span class="nf">f</span><span class="o">(</span><span class="kt">double</span> <span class="n">a</span><span class="o">,</span> <span class="kt">double</span> <span class="n">b</span><span class="o">)</span> <span class="o">{</span>
    <span class="kt">double</span> <span class="n">max</span> <span class="o">=</span> <span class="n">Math</span><span class="o">.</span><span class="na">max</span><span class="o">(</span><span class="n">a</span><span class="o">,</span> <span class="n">b</span><span class="o">);</span>
    <span class="kt">double</span> <span class="n">x</span> <span class="o">=</span> <span class="n">Math</span><span class="o">.</span><span class="na">abs</span><span class="o">(</span><span class="n">max</span><span class="o">);</span>
    <span class="k">return</span> <span class="n">x</span><span class="o">;</span>
  <span class="o">}</span>
<span class="o">}</span></code></pre></figure><p><a href="http://en.wikipedia.org/wiki/Declarative_programming">Declarative programming</a> focuses on <strong>what</strong> the program should accomplish without prescribing how to do it in terms of sequences of actions to be taken. This is how the same code would look in Lisp, a functional programming language:</p><figure class="highlight"><pre><code class="language-lisp" data-lang="lisp"><span></span><span class="p">(</span><span class="nb">defun</span> <span class="nv">f</span> <span class="p">(</span><span class="nv">a</span> <span class="nv">b</span><span class="p">)</span> <span class="p">(</span><span class="nb">abs</span> <span class="p">(</span><span class="nb">max</span> <span class="nv">a</span> <span class="nv">b</span><span class="p">)))</span></code></pre></figure><p>What&#39;s the catch? Just a difference in syntax? Not really.</p><p>There are <a href="http://en.wikipedia.org/wiki/Comparison_of_programming_paradigms">many definitions</a> of the difference between imperative and declarative styles, but I will try to give my own. There are basically three roles interacting in the scenario with this <code>f</code> function/method: a <em>buyer</em>, a <em>packager</em> of the result, and a <em>consumer</em> of the result. Let&#39;s say I call this function like this:</p><figure class="highlight"><pre><code class="language-java" data-lang="java"><span></span><span class="kd">public</span> <span class="kt">void</span> <span class="nf">foo</span><span class="o">()</span> <span class="o">{</span>
  <span class="kt">double</span> <span class="n">x</span> <span class="o">=</span> <span class="k">this</span><span class="o">.</span><span class="na">calc</span><span class="o">(</span><span class="mi">5</span><span class="o">,</span> <span class="o">-</span><span class="mi">7</span><span class="o">);</span>
  <span class="n">System</span><span class="o">.</span><span class="na">out</span><span class="o">.</span><span class="na">println</span><span class="o">(</span><span class="s">&quot;max+abs equals to &quot;</span> <span class="o">+</span> <span class="n">x</span><span class="o">);</span>
<span class="o">}</span>
<span class="kd">private</span> <span class="kt">double</span> <span class="nf">calc</span><span class="o">(</span><span class="kt">double</span> <span class="n">a</span><span class="o">,</span> <span class="kt">double</span> <span class="n">b</span><span class="o">)</span> <span class="o">{</span>
  <span class="kt">double</span> <span class="n">x</span> <span class="o">=</span> <span class="n">Math</span><span class="o">.</span><span class="na">f</span><span class="o">(</span><span class="n">a</span><span class="o">,</span> <span class="n">b</span><span class="o">);</span>
  <span class="k">return</span> <span class="n">x</span><span class="o">;</span>
<span class="o">}</span></code></pre></figure><p>Here, method <code>calc()</code> is a buyer, method <code>Math.f()</code> is a packager of the result, and method <code>foo()</code> is a consumer. No matter which programming style is used, there are always these three guys participating in the process: the buyer, the packager, and the consumer.</p><aside class='youtube'> <a href='https://www.youtube.com/watch?v=psrp3TtaYYI'><div class='box'> <img src='https://i.ytimg.com/vi/psrp3TtaYYI/mqdefault.jpg' alt='YouTube video #psrp3TtaYYI'/><div class='play'><i class='icon icon-play'></i></div></div></a><div>What's Wrong About Utility Classes? (webinar #6); 2 September 2015.</div></aside><p>Imagine you&#39;re a buyer and want to purchase a gift for your (girl|boy)friend. The first option is to visit a shop, pay $50, let them package that perfume for you, and then deliver it to the friend (and get a kiss in return). This is an <strong>imperative</strong> style.</p><p>The second option is to visit a shop, pay $50, and get a gift card. You then present this card to the friend (and get a kiss in return). When he or she decides to convert it to perfume, he or she will visit the shop and get it. This is a <strong>declarative</strong> style.</p><p>See the difference?</p><p>In the first case, which is imperative, you force the packager (a beauty shop) to find that perfume in stock, package it, and present it to you as a ready-to-be-used product. In the second scenario, which is declarative, you&#39;re just getting a <strong>promise</strong> from the shop that eventually, when it&#39;s necessary, the staff will find the perfume in stock, package it, and provide it to those who need it. If your friend never visits the shop with that gift card, the perfume will remain in stock.</p><p>Moreover, your friend can use that gift card as a product itself, never visiting the shop. He or she may instead present it to somebody else as a gift or just exchange it for another card or product. The gift card itself becomes a product!</p><p>So the difference is what the consumer is getting---either a product ready to be used (imperative) or a voucher for the product, which can later be converted into a real product (declarative).</p><p>Utility classes, like <code>Math</code> from JDK or <code>StringUtils</code> from Apache Commons, return products ready to be used immediately, while functions in Lisp and other functional languages return &quot;vouchers.&quot; For example, if you call the <code>max</code> function in Lisp, the actual maximum between two numbers will only be calculated when you actually start using it:</p><figure class="highlight"><pre><code class="language-lisp" data-lang="lisp"><span></span><span class="p">(</span><span class="k">let</span> <span class="p">(</span><span class="nv">x</span> <span class="p">(</span><span class="nb">max</span> <span class="mi">1</span> <span class="mi">5</span><span class="p">))</span>
  <span class="p">(</span><span class="nb">print</span> <span class="s">&quot;X equals to &quot;</span> <span class="nv">x</span><span class="p">))</span></code></pre></figure><p>Until this <code>print</code> actually starts to output characters to the screen, the function <code>max</code> won&#39;t be called. This <code>x</code> is a &quot;voucher&quot; returned to you when you attempted to &quot;buy&quot; a maximum between <code>1</code> and <code>5</code>.</p><p>Note, however, that nesting Java static functions one into another doesn&#39;t make them declarative. The code is still imperative, because its execution delivers the result here and now:</p><figure class="highlight"><pre><code class="language-java" data-lang="java"><span></span><span class="kd">public</span> <span class="kd">class</span> <span class="nc">MyMath</span> <span class="o">{</span>
  <span class="kd">public</span> <span class="kt">double</span> <span class="nf">f</span><span class="o">(</span><span class="kt">double</span> <span class="n">a</span><span class="o">,</span> <span class="kt">double</span> <span class="n">b</span><span class="o">)</span> <span class="o">{</span>
    <span class="k">return</span> <span class="n">Math</span><span class="o">.</span><span class="na">abs</span><span class="o">(</span><span class="n">Math</span><span class="o">.</span><span class="na">max</span><span class="o">(</span><span class="n">a</span><span class="o">,</span> <span class="n">b</span><span class="o">));</span>
  <span class="o">}</span>
<span class="o">}</span></code></pre></figure><p>&quot;Okay,&quot; you may say, &quot;I got it, but why is declarative style better than imperative? What&#39;s the big deal?&quot; I&#39;m getting to it. Let me first show the difference between functions in functional programming and static methods in OOP. As mentioned above, this is the second big difference between utility classes and functional programming.</p><p>In any functional programming language, you can do this:</p><figure class="highlight"><pre><code class="language-lisp" data-lang="lisp"><span></span><span class="p">(</span><span class="nb">defun</span> <span class="nv">foo</span> <span class="p">(</span><span class="nv">x</span><span class="p">)</span> <span class="p">(</span><span class="nv">x</span> <span class="mi">5</span><span class="p">))</span></code></pre></figure><p>Then, later, you can call that <code>x</code>:</p><figure class="highlight"><pre><code class="language-lisp" data-lang="lisp"><span></span><span class="p">(</span><span class="nb">defun</span> <span class="nv">bar</span> <span class="p">(</span><span class="nv">x</span><span class="p">)</span> <span class="p">(</span><span class="nb">+</span> <span class="nv">x</span> <span class="mi">1</span><span class="p">))</span> <span class="nv">//</span> <span class="nv">defining</span> <span class="k">function</span> <span class="nv">bar</span>
<span class="p">(</span><span class="nb">print</span> <span class="p">(</span><span class="nv">foo</span> <span class="nv">bar</span><span class="p">))</span> <span class="nv">//</span> <span class="nv">passing</span> <span class="nv">bar</span> <span class="nv">as</span> <span class="nv">an</span> <span class="nv">argument</span> <span class="nv">to</span> <span class="nv">foo</span></code></pre></figure><p>Static methods in Java are not <em>functions</em> in terms of functional programming. You can&#39;t do anything like this with a static method. You can&#39;t pass a static method as an argument to another method. Basically, static methods are procedures or, simply put, Java statements grouped under a unique name. The only way to access them is to call a procedure and pass all necessary arguments to it. The procedure will calculate something and return a result that is immediately ready for usage.</p><p>And now we&#39;re getting to the final question I can hear you asking: &quot;Okay, utility classes are not functional programming, but they look like functional programming, they work very fast, and they are very easy to use. Why not use them? Why aim for perfection when 20 years of Java history proves that utility classes are the main instrument of each Java developer?&quot;</p><p>Besides <a href="/2016/08/15/what-is-wrong-object-oriented-programming.html">OOP</a> fundamentalism, which I&#39;m very often accused of, there are a few very practical reasons (BTW, I am an OOP fundamentalist):</p><ul> <li><p><strong>Testability</strong>. Calls to static methods in utility classes are hard-coded dependencies that can never be broken for testing purposes. If your class is calling <code>FileUtils.readFile()</code>, I will never be able to test it without using a real file on disk.</p></li> <li><p><strong>Efficiency</strong>. Utility classes, due to their imperative nature, are much less efficient than their <a href="/2014/05/05/oop-alternative-to-utility-classes.html">declarative alternatives</a>. They simply do all calculations right here and now, taking processor resources even when it&#39;s not yet necessary. Instead of returning a promise to break down a string into chunks, <code>StringUtils.split()</code> breaks it down right now. And it breaks it down into all possible chunks, even if only the first one is required by the &quot;buyer.&quot;</p></li> <li><p><strong>Readability</strong>. Utility classes tend to be huge (try to read the source code of <code>StringUtils</code> or <code>FileUtils</code> from Apache Commons). The entire idea of separation of concerns, which makes OOP so beautiful, is absent in utility classes. They just put all possible procedures into one huge <code>.java</code> file, which becomes absolutely unmaintainable when it surpasses a dozen static methods.</p></li></ul><p>To conclude, let me reiterate: Utility classes have nothing to do with functional programming. They are simply bags of static methods, which are imperative procedures. Try to stay as far as possible away from them and use solid, cohesive objects no matter how many of them you have to declare and how small they are.</p></p><nav class="buttons notranslate desktop-only"> <a href="http://www.facebook.com/sharer/sharer.php?u=https://www.yegor256.com/2015/02/20/utility-classes-vs-functional-programming.html" title="Share on Facebook" class="button" rel="nofollow"> <span class="count count-facebook">0</span> <i class="icon icon-facebook notranslate" aria-hidden="true"></i> </a> <a href="https://twitter.com/share?url=https://www.yegor256.com/2015/02/20/utility-classes-vs-functional-programming.html&amp;text=Utility+Classes+Have+Nothing+to+Do+With+Functional+Programming" title="Share on Twitter" class="button" rel="nofollow"> <span class="count count-twitter">0</span> <i class="icon icon-twitter notranslate" aria-hidden="true"></i> </a> <a href="https://plus.google.com/share?url=https://www.yegor256.com/2015/02/20/utility-classes-vs-functional-programming.html" title="Share on Google+" class="button" rel="nofollow"> <span class="count count-googleplus">0</span> <i class="icon icon-googleplus notranslate" aria-hidden="true"></i> </a> <a href="https://www.linkedin.com/cws/share?url=https://www.yegor256.com/2015/02/20/utility-classes-vs-functional-programming.html" title="Share on LinkedIn" class="button" rel="nofollow"> <span class="count count-linkedin">0</span> <i class="icon icon-linkedin notranslate" aria-hidden="true"></i> </a> <a href="http://reddit.com/submit?url=https://www.yegor256.com/2015/02/20/utility-classes-vs-functional-programming.html%3F2015-07&amp;title=Utility+Classes+Have+Nothing+to+Do+With+Functional+Programming" title="Share on Reddit" class="button" rel="nofollow"> <span class="count count-reddit">0</span> <i class="icon icon-reddit notranslate" aria-hidden="true"></i> </a> <a href="http://news.ycombinator.com/submitlink?u=https://www.yegor256.com/2015/02/20/utility-classes-vs-functional-programming.html%3F2015-07&amp;t=Utility+Classes+Have+Nothing+to+Do+With+Functional+Programming" title="Share on Hacker News" class="button" rel="nofollow"> <span class="count count-hackernews">0</span> <i class="icon icon-hackernews notranslate" aria-hidden="true"></i> </a> </nav> </header> <article class="main" itemprop="articleBody"><div ><p>I was recently <a href="https://twitter.com/lukaseder/status/564866432790708224">accused</a> of being against <a href="http://en.wikipedia.org/wiki/Functional_programming">functional programming</a> because <a href="/2014/05/05/oop-alternative-to-utility-classes.html">I call utility classes an anti-pattern</a>. That&#39;s absolutely wrong! Well, I do consider them a terrible anti-pattern, but they have nothing to do with functional programming. I believe there are two basic reasons why. First, functional programming is declarative, while utility class methods are imperative. Second, functional programming is based on lambda calculus, where a function can be assigned to a variable. Utility class methods are not functions in this sense. I&#39;ll decode these statements in a minute.</p><p>In Java, there are basically two valid alternatives to these ugly utility classes aggressively promoted by <a href="https://code.google.com/p/guava-libraries/">Guava</a>, <a href="http://commons.apache.org/">Apache Commons</a>, and others. The first one is the use of traditional classes, and the second one is <a href="http://docs.oracle.com/javase/tutorial/java/javaOO/lambdaexpressions.html">Java&nbsp;8 lambda</a>. Now let&#39;s see why utility classes are not even close to functional programming and where this misconception is coming from.</p><figure class='jb_picture'><img itemprop='image' alt='Color Me Kubrick (2005) by Brian W. Cook' src='/images/2015/02/color-me-kubrick.png' longdesc='#56d1f92f'/><figcaption id='56d1f92f'>Color Me Kubrick (2005) by Brian W. Cook</figcaption></figure><p>Here is a typical example of a utility class <a href="http://docs.oracle.com/javase/7/docs/api/java/lang/Math.html"><code>Math</code></a> from Java 1.0:</p><figure class="highlight"><pre><code class="language-java" data-lang="java"><span></span><span class="kd">public</span> <span class="kd">class</span> <span class="nc">Math</span> <span class="o">{</span>
  <span class="kd">public</span> <span class="kd">static</span> <span class="kt">double</span> <span class="nf">abs</span><span class="o">(</span><span class="kt">double</span> <span class="n">a</span><span class="o">);</span>
  <span class="c1">// a few dozens of other methods of the same style</span>
<span class="o">}</span></code></pre></figure><p>Here is how you would use it when you want to calculate an absolute value of a floating point number:</p><figure class="highlight"><pre><code class="language-java" data-lang="java"><span></span><span class="kt">double</span> <span class="n">x</span> <span class="o">=</span> <span class="n">Math</span><span class="o">.</span><span class="na">abs</span><span class="o">(</span><span class="mf">3.1415926d</span><span class="o">);</span></code></pre></figure> <aside class='quote'>The code will work, but it is not object-oriented programming</aside><p>What&#39;s wrong with it? We need a function, and we get it from class <code>Math</code>. The class has many useful functions inside it that can be used for many typical mathematical operations, like calculating maximum, minimum, sine, cosine, etc. It is a very popular concept; just look at any commercial or open source product. These utility classes are used everywhere since Java was invented (this <code>Math</code> class was introduced in Java&#39;s first version). Well, technically there is nothing wrong. The code will work. But it is not object-oriented programming. Instead, it is imperative and procedural. Do we care? Well, it&#39;s up to you to decide. Let&#39;s see what the difference is.</p><aside class='youtube'> <a href='https://www.youtube.com/watch?v=D0dqC_3Bch8'><div class='box'> <img src='https://i.ytimg.com/vi/D0dqC_3Bch8/mqdefault.jpg' alt='YouTube video #D0dqC_3Bch8'/><div class='play'><i class='icon icon-play'></i></div></div></a><div>Objects vs. Static Methods (webinar #1); 8 April 2015.</div></aside><p>There are basically two different approaches: declarative and imperative.</p><p><a href="http://en.wikipedia.org/wiki/Imperative_programming">Imperative programming</a> is focused on describing <strong>how</strong> a program operates in terms of statements that change a program state. We just saw an example of imperative programming above. Here is another (this is pure imperative/procedural programming that has nothing to do with <a href="/2016/08/15/what-is-wrong-object-oriented-programming.html">OOP</a>):</p><figure class="highlight"><pre><code class="language-java" data-lang="java"><span></span><span class="kd">public</span> <span class="kd">class</span> <span class="nc">MyMath</span> <span class="o">{</span>
  <span class="kd">public</span> <span class="kt">double</span> <span class="nf">f</span><span class="o">(</span><span class="kt">double</span> <span class="n">a</span><span class="o">,</span> <span class="kt">double</span> <span class="n">b</span><span class="o">)</span> <span class="o">{</span>
    <span class="kt">double</span> <span class="n">max</span> <span class="o">=</span> <span class="n">Math</span><span class="o">.</span><span class="na">max</span><span class="o">(</span><span class="n">a</span><span class="o">,</span> <span class="n">b</span><span class="o">);</span>
    <span class="kt">double</span> <span class="n">x</span> <span class="o">=</span> <span class="n">Math</span><span class="o">.</span><span class="na">abs</span><span class="o">(</span><span class="n">max</span><span class="o">);</span>
    <span class="k">return</span> <span class="n">x</span><span class="o">;</span>
  <span class="o">}</span>
<span class="o">}</span></code></pre></figure><p><a href="http://en.wikipedia.org/wiki/Declarative_programming">Declarative programming</a> focuses on <strong>what</strong> the program should accomplish without prescribing how to do it in terms of sequences of actions to be taken. This is how the same code would look in Lisp, a functional programming language:</p><figure class="highlight"><pre><code class="language-lisp" data-lang="lisp"><span></span><span class="p">(</span><span class="nb">defun</span> <span class="nv">f</span> <span class="p">(</span><span class="nv">a</span> <span class="nv">b</span><span class="p">)</span> <span class="p">(</span><span class="nb">abs</span> <span class="p">(</span><span class="nb">max</span> <span class="nv">a</span> <span class="nv">b</span><span class="p">)))</span></code></pre></figure><p>What&#39;s the catch? Just a difference in syntax? Not really.</p><p>There are <a href="http://en.wikipedia.org/wiki/Comparison_of_programming_paradigms">many definitions</a> of the difference between imperative and declarative styles, but I will try to give my own. There are basically three roles interacting in the scenario with this <code>f</code> function/method: a <em>buyer</em>, a <em>packager</em> of the result, and a <em>consumer</em> of the result. Let&#39;s say I call this function like this:</p><figure class="highlight"><pre><code class="language-java" data-lang="java"><span></span><span class="kd">public</span> <span class="kt">void</span> <span class="nf">foo</span><span class="o">()</span> <span class="o">{</span>
  <span class="kt">double</span> <span class="n">x</span> <span class="o">=</span> <span class="k">this</span><span class="o">.</span><span class="na">calc</span><span class="o">(</span><span class="mi">5</span><span class="o">,</span> <span class="o">-</span><span class="mi">7</span><span class="o">);</span>
  <span class="n">System</span><span class="o">.</span><span class="na">out</span><span class="o">.</span><span class="na">println</span><span class="o">(</span><span class="s">&quot;max+abs equals to &quot;</span> <span class="o">+</span> <span class="n">x</span><span class="o">);</span>
<span class="o">}</span>
<span class="kd">private</span> <span class="kt">double</span> <span class="nf">calc</span><span class="o">(</span><span class="kt">double</span> <span class="n">a</span><span class="o">,</span> <span class="kt">double</span> <span class="n">b</span><span class="o">)</span> <span class="o">{</span>
  <span class="kt">double</span> <span class="n">x</span> <span class="o">=</span> <span class="n">Math</span><span class="o">.</span><span class="na">f</span><span class="o">(</span><span class="n">a</span><span class="o">,</span> <span class="n">b</span><span class="o">);</span>
  <span class="k">return</span> <span class="n">x</span><span class="o">;</span>
<span class="o">}</span></code></pre></figure><p>Here, method <code>calc()</code> is a buyer, method <code>Math.f()</code> is a packager of the result, and method <code>foo()</code> is a consumer. No matter which programming style is used, there are always these three guys participating in the process: the buyer, the packager, and the consumer.</p><aside class='youtube'> <a href='https://www.youtube.com/watch?v=psrp3TtaYYI'><div class='box'> <img src='https://i.ytimg.com/vi/psrp3TtaYYI/mqdefault.jpg' alt='YouTube video #psrp3TtaYYI'/><div class='play'><i class='icon icon-play'></i></div></div></a><div>What's Wrong About Utility Classes? (webinar #6); 2 September 2015.</div></aside><p>Imagine you&#39;re a buyer and want to purchase a gift for your (girl|boy)friend. The first option is to visit a shop, pay $50, let them package that perfume for you, and then deliver it to the friend (and get a kiss in return). This is an <strong>imperative</strong> style.</p><p>The second option is to visit a shop, pay $50, and get a gift card. You then present this card to the friend (and get a kiss in return). When he or she decides to convert it to perfume, he or she will visit the shop and get it. This is a <strong>declarative</strong> style.</p><p>See the difference?</p><p>In the first case, which is imperative, you force the packager (a beauty shop) to find that perfume in stock, package it, and present it to you as a ready-to-be-used product. In the second scenario, which is declarative, you&#39;re just getting a <strong>promise</strong> from the shop that eventually, when it&#39;s necessary, the staff will find the perfume in stock, package it, and provide it to those who need it. If your friend never visits the shop with that gift card, the perfume will remain in stock.</p><p>Moreover, your friend can use that gift card as a product itself, never visiting the shop. He or she may instead present it to somebody else as a gift or just exchange it for another card or product. The gift card itself becomes a product!</p><p>So the difference is what the consumer is getting---either a product ready to be used (imperative) or a voucher for the product, which can later be converted into a real product (declarative).</p><p>Utility classes, like <code>Math</code> from JDK or <code>StringUtils</code> from Apache Commons, return products ready to be used immediately, while functions in Lisp and other functional languages return &quot;vouchers.&quot; For example, if you call the <code>max</code> function in Lisp, the actual maximum between two numbers will only be calculated when you actually start using it:</p><figure class="highlight"><pre><code class="language-lisp" data-lang="lisp"><span></span><span class="p">(</span><span class="k">let</span> <span class="p">(</span><span class="nv">x</span> <span class="p">(</span><span class="nb">max</span> <span class="mi">1</span> <span class="mi">5</span><span class="p">))</span>
  <span class="p">(</span><span class="nb">print</span> <span class="s">&quot;X equals to &quot;</span> <span class="nv">x</span><span class="p">))</span></code></pre></figure><p>Until this <code>print</code> actually starts to output characters to the screen, the function <code>max</code> won&#39;t be called. This <code>x</code> is a &quot;voucher&quot; returned to you when you attempted to &quot;buy&quot; a maximum between <code>1</code> and <code>5</code>.</p><p>Note, however, that nesting Java static functions one into another doesn&#39;t make them declarative. The code is still imperative, because its execution delivers the result here and now:</p><figure class="highlight"><pre><code class="language-java" data-lang="java"><span></span><span class="kd">public</span> <span class="kd">class</span> <span class="nc">MyMath</span> <span class="o">{</span>
  <span class="kd">public</span> <span class="kt">double</span> <span class="nf">f</span><span class="o">(</span><span class="kt">double</span> <span class="n">a</span><span class="o">,</span> <span class="kt">double</span> <span class="n">b</span><span class="o">)</span> <span class="o">{</span>
    <span class="k">return</span> <span class="n">Math</span><span class="o">.</span><span class="na">abs</span><span class="o">(</span><span class="n">Math</span><span class="o">.</span><span class="na">max</span><span class="o">(</span><span class="n">a</span><span class="o">,</span> <span class="n">b</span><span class="o">));</span>
  <span class="o">}</span>
<span class="o">}</span></code></pre></figure><p>&quot;Okay,&quot; you may say, &quot;I got it, but why is declarative style better than imperative? What&#39;s the big deal?&quot; I&#39;m getting to it. Let me first show the difference between functions in functional programming and static methods in OOP. As mentioned above, this is the second big difference between utility classes and functional programming.</p><p>In any functional programming language, you can do this:</p><figure class="highlight"><pre><code class="language-lisp" data-lang="lisp"><span></span><span class="p">(</span><span class="nb">defun</span> <span class="nv">foo</span> <span class="p">(</span><span class="nv">x</span><span class="p">)</span> <span class="p">(</span><span class="nv">x</span> <span class="mi">5</span><span class="p">))</span></code></pre></figure><p>Then, later, you can call that <code>x</code>:</p><figure class="highlight"><pre><code class="language-lisp" data-lang="lisp"><span></span><span class="p">(</span><span class="nb">defun</span> <span class="nv">bar</span> <span class="p">(</span><span class="nv">x</span><span class="p">)</span> <span class="p">(</span><span class="nb">+</span> <span class="nv">x</span> <span class="mi">1</span><span class="p">))</span> <span class="nv">//</span> <span class="nv">defining</span> <span class="k">function</span> <span class="nv">bar</span>
<span class="p">(</span><span class="nb">print</span> <span class="p">(</span><span class="nv">foo</span> <span class="nv">bar</span><span class="p">))</span> <span class="nv">//</span> <span class="nv">passing</span> <span class="nv">bar</span> <span class="nv">as</span> <span class="nv">an</span> <span class="nv">argument</span> <span class="nv">to</span> <span class="nv">foo</span></code></pre></figure><p>Static methods in Java are not <em>functions</em> in terms of functional programming. You can&#39;t do anything like this with a static method. You can&#39;t pass a static method as an argument to another method. Basically, static methods are procedures or, simply put, Java statements grouped under a unique name. The only way to access them is to call a procedure and pass all necessary arguments to it. The procedure will calculate something and return a result that is immediately ready for usage.</p><p>And now we&#39;re getting to the final question I can hear you asking: &quot;Okay, utility classes are not functional programming, but they look like functional programming, they work very fast, and they are very easy to use. Why not use them? Why aim for perfection when 20 years of Java history proves that utility classes are the main instrument of each Java developer?&quot;</p><p>Besides <a href="/2016/08/15/what-is-wrong-object-oriented-programming.html">OOP</a> fundamentalism, which I&#39;m very often accused of, there are a few very practical reasons (BTW, I am an OOP fundamentalist):</p><ul> <li><p><strong>Testability</strong>. Calls to static methods in utility classes are hard-coded dependencies that can never be broken for testing purposes. If your class is calling <code>FileUtils.readFile()</code>, I will never be able to test it without using a real file on disk.</p></li> <li><p><strong>Efficiency</strong>. Utility classes, due to their imperative nature, are much less efficient than their <a href="/2014/05/05/oop-alternative-to-utility-classes.html">declarative alternatives</a>. They simply do all calculations right here and now, taking processor resources even when it&#39;s not yet necessary. Instead of returning a promise to break down a string into chunks, <code>StringUtils.split()</code> breaks it down right now. And it breaks it down into all possible chunks, even if only the first one is required by the &quot;buyer.&quot;</p></li> <li><p><strong>Readability</strong>. Utility classes tend to be huge (try to read the source code of <code>StringUtils</code> or <code>FileUtils</code> from Apache Commons). The entire idea of separation of concerns, which makes OOP so beautiful, is absent in utility classes. They just put all possible procedures into one huge <code>.java</code> file, which becomes absolutely unmaintainable when it surpasses a dozen static methods.</p></li></ul><p>To conclude, let me reiterate: Utility classes have nothing to do with functional programming. They are simply bags of static methods, which are imperative procedures. Try to stay as far as possible away from them and use solid, cohesive objects no matter how many of them you have to declare and how small they are.</p></div></article></div><div class="wrapper"> <related-posts /></div><div class="disqus" role="complementary"><p class="disqus_hint"> Please, use <a href="https://help.disqus.com/commenting/what-html-tags-are-allowed-within-comments">syntax highlighting</a> in your comments, to make them more readable.</p><div id="disqus_thread" class="disqus-thread"> <a>&nbsp;</a></div><script> var disqus_config = function () { this.page.url = document.location.href.split('?')[0].split('#')[0].replace('https://', 'http://'); this.page.identifier = this.page.url; }; (function() { var d = document, s = d.createElement('script'); s.src = '//yegor256.disqus.com/embed.js'; s.setAttribute('data-timestamp', +new Date()); (d.head || d.body).appendChild(s); })(); </script> <noscript><div><p class="red"> JavaScript is disabled in your browser, that's why you can't see comments under this post.</p></div></noscript></div><div class="wrapper"> <footer class="footer"><p> &copy; <span itemscope="" itemprop="copyrightHolder" itemtype="http://schema.org/Person"> <span itemprop="name">Yegor Bugayenko</span> </span> 2014&ndash;<span itemprop="copyrightYear">2018</span></p></footer></div></section><div class="wrapper unprintable" style="text-align:center;margin-top:2em;"> <a href="http://www.sixnines.io/h/3ba1652f"> <img src="//www.sixnines.io/b/3ba1652f?style=flat" alt="sixnines availability badge"/> </a></div><script src="//code.jquery.com/jquery-1.9.0.min.js"></script> <script src="/js/all.js?a0e0d018c07"></script> <script>var disqus_shortname = 'yegor256';</script> <script id="dsq-count-scr" src="//yegor256.disqus.com/count.js" async="async"></script> <script> (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){ (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o), m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m) })(window,document,'script','//www.google-analytics.com/analytics.js','ga'); ga('create', 'UA-1963507-32', 'auto'); ga('send', 'pageview'); </script> <script> Cd=document;Cr="&"+Math.random();Cp="&s=1"; Cd.cookie="b=b";if(Cd.cookie)Cp+="&c=1"; Cp+="&t="+(new Date()).getTimezoneOffset(); if(self!=top)Cp+="&f=1"; </script> <script> if(navigator.javaEnabled())Cp+="&j=1"; </script> <script> if(typeof(screen)!='undefined')Cp+="&w="+screen.width+"&h="+ screen.height+"&d="+(screen.colorDepth?screen.colorDepth:screen.pixelDepth); </script> <script> Cd.write("<img src='//c.hit.ua/hit?i=95870&g=0&x=2"+Cp+Cr+ "&r="+escape(Cd.referrer)+"&u="+escape(window.location.href)+ "' border='0' wi"+"dth='1' he"+"ight='1'/>"); </script> <script type="application/ld+json"> { "@context": "http://schema.org", "@type": "Person", "name": "Yegor Bugayenko", "url": "http://www.yegor256.com", "sameAs": [ "https://www.facebook.com/yegor256", "https://instagram.com/yegor256", "https://www.linkedin.com/in/yegor256", "https://twitter.com/yegor256", "https://github.com/yegor256", "https://www.pinterest.com/yegor256/" ] } </script> </body> </html> <!DOCTYPE html> <html xmlns="http://www.w3.org/1999/xhtml" lang="en-US" xml:lang="en-US" itemscope="" itemtype="http://schema.org/WebSite"> <head> <meta charset="utf-8"/> <meta name="description" content="When it comes to an if-then-else statement that throws an exception or exits by break or continue, there is an obvious optimization that is very often overlooked. " /> <meta name="keywords" content="if then else exception, if throw else exception, if throw exception, if throw exception java, if-throw-else" /> <meta name="viewport" content="width=device-width,minimum-scale=1,initial-scale=1"/> <meta name="google-site-verification" content="JEj_gQr2CPe2QKGw8XdMz0R7VboQIUbX3FlM-lwTq-8" /> <meta name="author" content="Yegor Bugayenko"> <meta name="article:published_time" content="2015-01-21 00:00:00 +0000"> <meta name="og:site_name" content="Yegor Bugayenko"/> <meta name="og:type" content="article" /> <meta name="og:locale" content="en_US" /> <meta name="twitter:account_id" content="4503599630178231" /> <meta name="twitter:creator" content="@yegor256"/> <meta name="twitter:site" content="@yegor256"/> <meta name="twitter:title" property="og:title" content="If. Then. Throw. Else. WTF?"/> <meta name="twitter:description" property="og:description" content="When it comes to an if-then-else statement that throws an exception or exits by break or continue, there is an obvious optimization that is very often overlooked. "/> <meta name="twitter:url" property="og:url" content="https://www.yegor256.com/2015/01/21/if-then-throw-else.html"/> <meta name="telegram:channel" content="AAAAAEJFMRzsRTRxM3ec6A"/> <link rel="search" type="application/opensearchdescription+xml" href="/opensearch.xml" title="yegor256" /> <link rel="shortcut icon" href="/favicon.ico?a0e0d018c07"/> <link rel="apple-touch-icon" href="/favicon.ico?a0e0d018c07"/> <link rel="alternate" type="application/rss+xml" title="RSS for yegor256.com" href="https://www.yegor256.com/rss.xml"/> <link rel="stylesheet" href="/css/layout.css?a0e0d018c07"/> <link rel="stylesheet" href="/css/icons.css?a0e0d018c07"/> <link rel="canonical" href="https://www.yegor256.com/2015/01/21/if-then-throw-else.html" /> <link rel="amphtml" href="https://www.yegor256.com/2015/01/21/if-then-throw-else.amp.html" /> <title>If. Then. Throw. Else. WTF? </title> </head> <body><div class="wrapper"> <aside class="header-toggle unprintable" id="header-toggle" title="Show the menu" onclick="$('#header').show();$('#header-toggle').hide();">&#9776;</aside> <header class="header" id="header"><div class="face"> <a href="/about-me.html#form" class="sub" title="Click to subscribe to my monthly newsletter"><span>Subscribe</span></a> <a href="/about-me.html" style="position:relative;"> <img src="/images/face-256x256.jpg" class="photo" alt="Yegor Bugayenko"/> </a></div><nav><ul class="menu social notranslate"> <li><a href="https://twitter.com/intent/follow?screen_name=yegor256" rel="nofollow" title="Follow me on Twitter"><i class="icon icon-twitter notranslate" aria-hidden="true"></i></a></li> <li><a href="/rss.xml" rel="nofollow" title="Subscribe to my RSS feed"><i class="icon icon-rss notranslate" aria-hidden="true"></i></a></li> <li><a itemprop="sameAs" href="https://github.com/yegor256" rel="nofollow" title="My GitHub profile"><i class="icon icon-github notranslate" aria-hidden="true"></i></a></li> <li><a itemprop="sameAs" href="http://stackoverflow.com/users/187141/yegor256" rel="nofollow" title="My StackOverflow profile"><i class="icon icon-stackoverflow notranslate" aria-hidden="true"></i></a></li> <li><a itemprop="sameAs" href="https://www.facebook.com/yegor256" rel="nofollow" title="Follow me on Facebook"><i class="icon icon-facebook notranslate" aria-hidden="true"></i></a></li> <li><a itemprop="sameAs" href="https://instagram.com/yegor256" rel="nofollow" title="Follow me on Instagram"><i class="icon icon-instagram notranslate" aria-hidden="true"></i></a></li> <li><a itemprop="sameAs" href="https://www.linkedin.com/in/yegor256" rel="nofollow" title="My LinkedIn profile"><i class="icon icon-linkedin notranslate" aria-hidden="true"></i></a></li> <li><a itemprop="sameAs" href="https://www.youtube.com/c/yegor256?sub_confirmation=1" rel="nofollow" title="My Youtube video channel"><i class="icon icon-youtube notranslate" aria-hidden="true"></i></a></li> <li><a itemprop="sameAs" href="https://www.pinterest.com/yegor256/" rel="nofollow" title="My Pinterest boards"><i class="icon icon-pinterest notranslate" aria-hidden="true"></i></a></li> <li><a itemprop="sameAs" href="https://angel.co/yegor256" rel="nofollow" title="My AngelList profile"><i class="icon icon-angellist notranslate" aria-hidden="true"></i></a></li> <li><a href="https://soundcloud.com/yegor256" rel="nofollow" title="My podcast"><i class="icon icon-podcast notranslate" aria-hidden="true"></i></a></li> <li><a href="https://itunes.apple.com/us/podcast/yegor256-podcast/id1150826721" rel="nofollow" title="My iTunes podcast"><i class="icon icon-itunes notranslate" aria-hidden="true"></i></a></li> <li><a href="https://t.me/joinchat/AAAAAEJFMRzsRTRxM3ec6A" rel="nofollow" title="My Telegram public channel"><i class="icon icon-telegram notranslate" aria-hidden="true"></i></a></li> <li><a href="mailto:blog@yegor256.com" rel="nofollow" title="Email me any time"><i class="icon icon-mail notranslate" aria-hidden="true"></i></a></li></ul><ul class="menu"> <li><a href="/" title="Home page">Home</a></li> <li ><a href="/best.html" title="Best articles to read">12&#160;Best</a></li> <li ><a href="/contents.html" title="The contents of the entire blog">All&#160;288</a></li> <li ><a href="/webinars.html" title="My webinars">Webinars</a></li> <li ><a href="/talks.html" title="Future and past conference talks">Talks</a></li> <li ><a href="/books.html" title="The books I wrote">Books</a></li> <li ><a href="/papers.html" title="My academic papers and patents">Papers</a></li> <li ><a href="/pets.html" title="My loved pet projects">Pets</a></li> <li ><a href="/award.html" title="Software quality award">Award</a></li> <li ><a href="/testimonials.html" title="What some people say about me">Testimonials</a></li> <li ><a href="/shift-m.html" title="Audio podcast about project management">Shift-M</a></li> <li ><a href="/paintings.html" title="My paintings for sale">Paintings</a></li> <li><a href="http://ru.yegor256.com/" title="Немного на русском языке">По-русски</a></li></ul></nav><div class="search"> <form method="get" action="https://www.google.com/search" itemprop="potentialAction" itemscope="" itemtype="http://schema.org/SearchAction"> <meta itemprop="target" content="https://www.google.com/search?q={q}"/> <input name="sitesearch" value="yegor256.com" type="hidden"/> <input itemprop="query-input" type="text" id="search-query" class="field field-text" required="required" onfocus="$('.google').css('visibility', 'visible');" name="q" placeholder="Search..." autocomplete="off"/> <input type="image" src="/images/google-search-icon.svg" class="google" title="Search via Google" alt="Search via Google"/> </form></div><div class="hot"><ul> <li> <a href="/code-ahead.html">Code Ahead</a> was published on Amazon just a few days ago! It is my new book, a novel about programmers. It explains in details the majority of ideas that stand behind <a href="https://www.zerocracy.com">Zerocracy</a> and <a href="https://www.xdsd.org">XDSD</a>. </li> <li> At <a href="/webinars.html">Webinar #37</a> we will discuss naming problem in OOP, for objects, methods and attributes; join us on <b>September 12</b>, at 11am PST. </li></ul></div></header></div><section itemscope="" itemtype="http://schema.org/BlogPosting"><div class="wrapper"> <header><p class="printable"> <img src="https://api.qrserver.com/v1/create-qr-code/?data=https://www.yegor256.com/2015/01/21/if-then-throw-else.html&amp;format=svg" style="width:125px;height:125px;" alt="QR code"/></p><p class="printable"> <code itemprop="url">https://www.yegor256.com/2015/01/21/if-then-throw-else.html</code></p><h1 itemprop="name headline mainEntityOfPage">If. Then. Throw. Else. WTF?</h1><ul class="subline"> <li> <time itemprop="datePublished" datetime="2015-01-21T00:00:00+00:00"> 21 January 2015 </time> </li> <li class="printable" itemscope="" itemprop="author" itemtype="http://schema.org/Person"> <span itemprop="name">Yegor Bugayenko</span> </li> <li class="unprintable"> <i class="icon icon-comments"></i> <a href="http://www.yegor256.com/2015/01/21/if-then-throw-else.html#disqus_thread" itemprop="discussionUrl">comments</a> </li></ul><p class="unprintable"><p>This is the code I could never understand:</p><figure class="highlight"><pre><code class="language-java" data-lang="java"><span></span><span class="k">if</span> <span class="o">(</span><span class="n">x</span> <span class="o">&lt;</span> <span class="mi">0</span><span class="o">)</span> <span class="o">{</span>
  <span class="k">throw</span> <span class="k">new</span> <span class="n">Exception</span><span class="o">(</span><span class="s">&quot;X can&#39;t be negative&quot;</span><span class="o">);</span>
<span class="o">}</span> <span class="k">else</span> <span class="o">{</span>
  <span class="n">System</span><span class="o">.</span><span class="na">out</span><span class="o">.</span><span class="na">println</span><span class="o">(</span><span class="s">&quot;X is positive or zero&quot;</span><span class="o">);</span>
<span class="o">}</span></code></pre></figure><p>I have been trying to find a proper metaphor to explain its incorrectness. Today I finally found it.</p><p>If-then-else is a <a href="/2016/08/10/if-then-else-code-smell.html">forking</a> mechanism of procedural programming. The CPU either goes to the left and <strong>then</strong> does something or goes to the right and does something <strong>else</strong>. Imagine yourself driving a car and seeing this sign:</p><figure class='unprintable'><img src='https://www.yegor256.com/images/2015/01/if-then-throw-1.png' itemprop='image' style='width:500px;max-width:100%;' alt='The figure'/></figure><p>It looks logical, doesn&#39;t it? You can go in the left lane if you&#39;re not driving a truck. Otherwise you should go in the right lane. Both lanes meet up in a while. No matter which one you choose, you will end up on the same road. This is what this code block does:</p><figure class="highlight"><pre><code class="language-java" data-lang="java"><span></span><span class="k">if</span> <span class="o">(</span><span class="n">x</span> <span class="o">&lt;</span> <span class="mi">0</span><span class="o">)</span> <span class="o">{</span>
  <span class="n">System</span><span class="o">.</span><span class="na">out</span><span class="o">.</span><span class="na">println</span><span class="o">(</span><span class="s">&quot;X is negative&quot;</span><span class="o">);</span>
<span class="o">}</span> <span class="k">else</span> <span class="o">{</span>
  <span class="n">System</span><span class="o">.</span><span class="na">out</span><span class="o">.</span><span class="na">println</span><span class="o">(</span><span class="s">&quot;X is positive or zero&quot;</span><span class="o">);</span>
<span class="o">}</span></code></pre></figure><p>Now, try to imagine this sign:</p><figure class='unprintable'><img src='https://www.yegor256.com/images/2015/01/if-then-throw-2.png' itemprop='image' style='width:500px;max-width:100%;' alt='The figure'/></figure><p>It looks very strange to me, and you will never see this sign anywhere simply because a dead end means an <em>end</em>, a full stop, a finish. What is the point of drawing a lane after the dead end sign? There is no point.</p><p>This is how a proper sign would look:</p><figure class='unprintable'><img src='https://www.yegor256.com/images/2015/01/if-then-throw-3.png' itemprop='image' style='width:500px;max-width:100%;' alt='The figure'/></figure><p>This is how a proper code block would look:</p><figure class="highlight"><pre><code class="language-java" data-lang="java"><span></span><span class="k">if</span> <span class="o">(</span><span class="n">x</span> <span class="o">&lt;</span> <span class="mi">0</span><span class="o">)</span> <span class="o">{</span>
  <span class="k">throw</span> <span class="k">new</span> <span class="n">Exception</span><span class="o">(</span><span class="s">&quot;X can&#39;t be negative&quot;</span><span class="o">);</span>
<span class="o">}</span>
<span class="n">System</span><span class="o">.</span><span class="na">out</span><span class="o">.</span><span class="na">println</span><span class="o">(</span><span class="s">&quot;X is positive or zero&quot;</span><span class="o">);</span></code></pre></figure><p>The same is true for loops. This is wrong:</p><figure class="highlight"><pre><code class="language-java" data-lang="java"><span></span><span class="k">for</span> <span class="o">(</span><span class="kt">int</span> <span class="n">x</span> <span class="o">:</span> <span class="n">numbers</span><span class="o">)</span> <span class="o">{</span>
  <span class="k">if</span> <span class="o">(</span><span class="n">x</span> <span class="o">&lt;</span> <span class="mi">0</span><span class="o">)</span> <span class="o">{</span>
    <span class="k">continue</span><span class="o">;</span>
  <span class="o">}</span> <span class="k">else</span> <span class="o">{</span>
    <span class="n">System</span><span class="o">.</span><span class="na">out</span><span class="o">.</span><span class="na">println</span><span class="o">(</span><span class="s">&quot;found positive number&quot;</span><span class="o">);</span>
  <span class="o">}</span>
<span class="o">}</span></code></pre></figure><p>While this is right:</p><figure class="highlight"><pre><code class="language-java" data-lang="java"><span></span><span class="k">for</span> <span class="o">(</span><span class="kt">int</span> <span class="n">x</span> <span class="o">:</span> <span class="n">numbers</span><span class="o">)</span> <span class="o">{</span>
  <span class="k">if</span> <span class="o">(</span><span class="n">x</span> <span class="o">&lt;</span> <span class="mi">0</span><span class="o">)</span> <span class="o">{</span>
    <span class="k">continue</span><span class="o">;</span>
  <span class="o">}</span>
  <span class="n">System</span><span class="o">.</span><span class="na">out</span><span class="o">.</span><span class="na">println</span><span class="o">(</span><span class="s">&quot;found positive number&quot;</span><span class="o">);</span>
<span class="o">}</span></code></pre></figure><p>There is no road after the dead end! If you draw it, your code looks like this very funny snippet I found a few years ago reviewing sources written by some very well-paid developer in one very serious company:</p><figure class="highlight"><pre><code class="language-java" data-lang="java"><span></span><span class="k">if</span> <span class="o">(</span><span class="n">x</span> <span class="o">&lt;</span> <span class="mi">0</span><span class="o">)</span> <span class="o">{</span>
  <span class="k">throw</span> <span class="k">new</span> <span class="n">Exception</span><span class="o">(</span><span class="s">&quot;X is negative&quot;</span><span class="o">);</span>
  <span class="n">System</span><span class="o">.</span><span class="na">exit</span><span class="o">(</span><span class="mi">1</span><span class="o">);</span>
<span class="o">}</span></code></pre></figure><p>Don&#39;t do this.</p></p><nav class="buttons notranslate desktop-only"> <a href="http://www.facebook.com/sharer/sharer.php?u=https://www.yegor256.com/2015/01/21/if-then-throw-else.html" title="Share on Facebook" class="button" rel="nofollow"> <span class="count count-facebook">0</span> <i class="icon icon-facebook notranslate" aria-hidden="true"></i> </a> <a href="https://twitter.com/share?url=https://www.yegor256.com/2015/01/21/if-then-throw-else.html&amp;text=If.+Then.+Throw.+Else.+WTF%3F" title="Share on Twitter" class="button" rel="nofollow"> <span class="count count-twitter">0</span> <i class="icon icon-twitter notranslate" aria-hidden="true"></i> </a> <a href="https://plus.google.com/share?url=https://www.yegor256.com/2015/01/21/if-then-throw-else.html" title="Share on Google+" class="button" rel="nofollow"> <span class="count count-googleplus">0</span> <i class="icon icon-googleplus notranslate" aria-hidden="true"></i> </a> <a href="https://www.linkedin.com/cws/share?url=https://www.yegor256.com/2015/01/21/if-then-throw-else.html" title="Share on LinkedIn" class="button" rel="nofollow"> <span class="count count-linkedin">0</span> <i class="icon icon-linkedin notranslate" aria-hidden="true"></i> </a> <a href="http://reddit.com/submit?url=https://www.yegor256.com/2015/01/21/if-then-throw-else.html%3F2015-03&amp;title=If.+Then.+Throw.+Else.+WTF%3F" title="Share on Reddit" class="button" rel="nofollow"> <span class="count count-reddit">0</span> <i class="icon icon-reddit notranslate" aria-hidden="true"></i> </a> <a href="http://news.ycombinator.com/submitlink?u=https://www.yegor256.com/2015/01/21/if-then-throw-else.html%3F2015-03&amp;t=If.+Then.+Throw.+Else.+WTF%3F" title="Share on Hacker News" class="button" rel="nofollow"> <span class="count count-hackernews">0</span> <i class="icon icon-hackernews notranslate" aria-hidden="true"></i> </a> </nav> </header> <article class="main" itemprop="articleBody"><div ><p>This is the code I could never understand:</p><figure class="highlight"><pre><code class="language-java" data-lang="java"><span></span><span class="k">if</span> <span class="o">(</span><span class="n">x</span> <span class="o">&lt;</span> <span class="mi">0</span><span class="o">)</span> <span class="o">{</span>
  <span class="k">throw</span> <span class="k">new</span> <span class="n">Exception</span><span class="o">(</span><span class="s">&quot;X can&#39;t be negative&quot;</span><span class="o">);</span>
<span class="o">}</span> <span class="k">else</span> <span class="o">{</span>
  <span class="n">System</span><span class="o">.</span><span class="na">out</span><span class="o">.</span><span class="na">println</span><span class="o">(</span><span class="s">&quot;X is positive or zero&quot;</span><span class="o">);</span>
<span class="o">}</span></code></pre></figure><p>I have been trying to find a proper metaphor to explain its incorrectness. Today I finally found it.</p><p>If-then-else is a <a href="/2016/08/10/if-then-else-code-smell.html">forking</a> mechanism of procedural programming. The CPU either goes to the left and <strong>then</strong> does something or goes to the right and does something <strong>else</strong>. Imagine yourself driving a car and seeing this sign:</p><figure class='unprintable'><img src='https://www.yegor256.com/images/2015/01/if-then-throw-1.png' itemprop='image' style='width:500px;max-width:100%;' alt='The figure'/></figure><p>It looks logical, doesn&#39;t it? You can go in the left lane if you&#39;re not driving a truck. Otherwise you should go in the right lane. Both lanes meet up in a while. No matter which one you choose, you will end up on the same road. This is what this code block does:</p><figure class="highlight"><pre><code class="language-java" data-lang="java"><span></span><span class="k">if</span> <span class="o">(</span><span class="n">x</span> <span class="o">&lt;</span> <span class="mi">0</span><span class="o">)</span> <span class="o">{</span>
  <span class="n">System</span><span class="o">.</span><span class="na">out</span><span class="o">.</span><span class="na">println</span><span class="o">(</span><span class="s">&quot;X is negative&quot;</span><span class="o">);</span>
<span class="o">}</span> <span class="k">else</span> <span class="o">{</span>
  <span class="n">System</span><span class="o">.</span><span class="na">out</span><span class="o">.</span><span class="na">println</span><span class="o">(</span><span class="s">&quot;X is positive or zero&quot;</span><span class="o">);</span>
<span class="o">}</span></code></pre></figure><p>Now, try to imagine this sign:</p><figure class='unprintable'><img src='https://www.yegor256.com/images/2015/01/if-then-throw-2.png' itemprop='image' style='width:500px;max-width:100%;' alt='The figure'/></figure><p>It looks very strange to me, and you will never see this sign anywhere simply because a dead end means an <em>end</em>, a full stop, a finish. What is the point of drawing a lane after the dead end sign? There is no point.</p><p>This is how a proper sign would look:</p><figure class='unprintable'><img src='https://www.yegor256.com/images/2015/01/if-then-throw-3.png' itemprop='image' style='width:500px;max-width:100%;' alt='The figure'/></figure><p>This is how a proper code block would look:</p><figure class="highlight"><pre><code class="language-java" data-lang="java"><span></span><span class="k">if</span> <span class="o">(</span><span class="n">x</span> <span class="o">&lt;</span> <span class="mi">0</span><span class="o">)</span> <span class="o">{</span>
  <span class="k">throw</span> <span class="k">new</span> <span class="n">Exception</span><span class="o">(</span><span class="s">&quot;X can&#39;t be negative&quot;</span><span class="o">);</span>
<span class="o">}</span>
<span class="n">System</span><span class="o">.</span><span class="na">out</span><span class="o">.</span><span class="na">println</span><span class="o">(</span><span class="s">&quot;X is positive or zero&quot;</span><span class="o">);</span></code></pre></figure><p>The same is true for loops. This is wrong:</p><figure class="highlight"><pre><code class="language-java" data-lang="java"><span></span><span class="k">for</span> <span class="o">(</span><span class="kt">int</span> <span class="n">x</span> <span class="o">:</span> <span class="n">numbers</span><span class="o">)</span> <span class="o">{</span>
  <span class="k">if</span> <span class="o">(</span><span class="n">x</span> <span class="o">&lt;</span> <span class="mi">0</span><span class="o">)</span> <span class="o">{</span>
    <span class="k">continue</span><span class="o">;</span>
  <span class="o">}</span> <span class="k">else</span> <span class="o">{</span>
    <span class="n">System</span><span class="o">.</span><span class="na">out</span><span class="o">.</span><span class="na">println</span><span class="o">(</span><span class="s">&quot;found positive number&quot;</span><span class="o">);</span>
  <span class="o">}</span>
<span class="o">}</span></code></pre></figure><p>While this is right:</p><figure class="highlight"><pre><code class="language-java" data-lang="java"><span></span><span class="k">for</span> <span class="o">(</span><span class="kt">int</span> <span class="n">x</span> <span class="o">:</span> <span class="n">numbers</span><span class="o">)</span> <span class="o">{</span>
  <span class="k">if</span> <span class="o">(</span><span class="n">x</span> <span class="o">&lt;</span> <span class="mi">0</span><span class="o">)</span> <span class="o">{</span>
    <span class="k">continue</span><span class="o">;</span>
  <span class="o">}</span>
  <span class="n">System</span><span class="o">.</span><span class="na">out</span><span class="o">.</span><span class="na">println</span><span class="o">(</span><span class="s">&quot;found positive number&quot;</span><span class="o">);</span>
<span class="o">}</span></code></pre></figure><p>There is no road after the dead end! If you draw it, your code looks like this very funny snippet I found a few years ago reviewing sources written by some very well-paid developer in one very serious company:</p><figure class="highlight"><pre><code class="language-java" data-lang="java"><span></span><span class="k">if</span> <span class="o">(</span><span class="n">x</span> <span class="o">&lt;</span> <span class="mi">0</span><span class="o">)</span> <span class="o">{</span>
  <span class="k">throw</span> <span class="k">new</span> <span class="n">Exception</span><span class="o">(</span><span class="s">&quot;X is negative&quot;</span><span class="o">);</span>
  <span class="n">System</span><span class="o">.</span><span class="na">exit</span><span class="o">(</span><span class="mi">1</span><span class="o">);</span>
<span class="o">}</span></code></pre></figure><p>Don&#39;t do this.</p></div></article></div><div class="wrapper"> <related-posts /></div><div class="disqus" role="complementary"><p class="disqus_hint"> Please, use <a href="https://help.disqus.com/commenting/what-html-tags-are-allowed-within-comments">syntax highlighting</a> in your comments, to make them more readable.</p><div id="disqus_thread" class="disqus-thread"> <a>&nbsp;</a></div><script> var disqus_config = function () { this.page.url = document.location.href.split('?')[0].split('#')[0].replace('https://', 'http://'); this.page.identifier = this.page.url; }; (function() { var d = document, s = d.createElement('script'); s.src = '//yegor256.disqus.com/embed.js'; s.setAttribute('data-timestamp', +new Date()); (d.head || d.body).appendChild(s); })(); </script> <noscript><div><p class="red"> JavaScript is disabled in your browser, that's why you can't see comments under this post.</p></div></noscript></div><div class="wrapper"> <footer class="footer"><p> &copy; <span itemscope="" itemprop="copyrightHolder" itemtype="http://schema.org/Person"> <span itemprop="name">Yegor Bugayenko</span> </span> 2014&ndash;<span itemprop="copyrightYear">2018</span></p></footer></div></section><div class="wrapper unprintable" style="text-align:center;margin-top:2em;"> <a href="http://www.sixnines.io/h/3ba1652f"> <img src="//www.sixnines.io/b/3ba1652f?style=flat" alt="sixnines availability badge"/> </a></div><script src="//code.jquery.com/jquery-1.9.0.min.js"></script> <script src="/js/all.js?a0e0d018c07"></script> <script>var disqus_shortname = 'yegor256';</script> <script id="dsq-count-scr" src="//yegor256.disqus.com/count.js" async="async"></script> <script> (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){ (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o), m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m) })(window,document,'script','//www.google-analytics.com/analytics.js','ga'); ga('create', 'UA-1963507-32', 'auto'); ga('send', 'pageview'); </script> <script> Cd=document;Cr="&"+Math.random();Cp="&s=1"; Cd.cookie="b=b";if(Cd.cookie)Cp+="&c=1"; Cp+="&t="+(new Date()).getTimezoneOffset(); if(self!=top)Cp+="&f=1"; </script> <script> if(navigator.javaEnabled())Cp+="&j=1"; </script> <script> if(typeof(screen)!='undefined')Cp+="&w="+screen.width+"&h="+ screen.height+"&d="+(screen.colorDepth?screen.colorDepth:screen.pixelDepth); </script> <script> Cd.write("<img src='//c.hit.ua/hit?i=95870&g=0&x=2"+Cp+Cr+ "&r="+escape(Cd.referrer)+"&u="+escape(window.location.href)+ "' border='0' wi"+"dth='1' he"+"ight='1'/>"); </script> <script type="application/ld+json"> { "@context": "http://schema.org", "@type": "Person", "name": "Yegor Bugayenko", "url": "http://www.yegor256.com", "sameAs": [ "https://www.facebook.com/yegor256", "https://instagram.com/yegor256", "https://www.linkedin.com/in/yegor256", "https://twitter.com/yegor256", "https://github.com/yegor256", "https://www.pinterest.com/yegor256/" ] } </script> </body> </html> <!DOCTYPE html> <html xmlns="http://www.w3.org/1999/xhtml" lang="en-US" xml:lang="en-US" itemscope="" itemtype="http://schema.org/WebSite"> <head> <meta charset="utf-8"/> <meta name="description" content="A variable name that consists of several words is a code smell because it indicates a variable scope that&apos;s too big. " /> <meta name="keywords" content="composite variable name, long variable name, naming convention, variable name, variable naming convention" /> <meta name="viewport" content="width=device-width,minimum-scale=1,initial-scale=1"/> <meta name="google-site-verification" content="JEj_gQr2CPe2QKGw8XdMz0R7VboQIUbX3FlM-lwTq-8" /> <meta name="author" content="Yegor Bugayenko"> <meta name="article:published_time" content="2015-01-12 00:00:00 +0000"> <meta name="og:site_name" content="Yegor Bugayenko"/> <meta name="og:type" content="article" /> <meta name="og:locale" content="en_US" /> <meta name="twitter:account_id" content="4503599630178231" /> <meta name="twitter:creator" content="@yegor256"/> <meta name="twitter:site" content="@yegor256"/> <meta name="twitter:title" property="og:title" content="A Compound Name Is a Code Smell"/> <meta name="twitter:description" property="og:description" content="A variable name that consists of several words is a code smell because it indicates a variable scope that&apos;s too big. "/> <meta name="twitter:url" property="og:url" content="https://www.yegor256.com/2015/01/12/compound-name-is-code-smell.html"/> <meta name="telegram:channel" content="AAAAAEJFMRzsRTRxM3ec6A"/> <link rel="search" type="application/opensearchdescription+xml" href="/opensearch.xml" title="yegor256" /> <link rel="shortcut icon" href="/favicon.ico?a0e0d018c07"/> <link rel="apple-touch-icon" href="/favicon.ico?a0e0d018c07"/> <link rel="alternate" type="application/rss+xml" title="RSS for yegor256.com" href="https://www.yegor256.com/rss.xml"/> <link rel="stylesheet" href="/css/layout.css?a0e0d018c07"/> <link rel="stylesheet" href="/css/icons.css?a0e0d018c07"/> <link rel="canonical" href="https://www.yegor256.com/2015/01/12/compound-name-is-code-smell.html" /> <link rel="amphtml" href="https://www.yegor256.com/2015/01/12/compound-name-is-code-smell.amp.html" /> <title>A Compound Name Is a Code Smell </title> <meta name='og:image' content='https://www.yegor256.com/images/2015/01/meaning-of-life-every-sperm.png'/><meta name='twitter:image' content='https://www.yegor256.com/images/2015/01/meaning-of-life-every-sperm.png'/><meta name='og:image:width' content='1200'/> <meta name='twitter:image:width' content='1200'/><meta name='og:image:height' content='675'/> <meta name='twitter:image:height' content='675'/><meta name='twitter:card' content='summary_large_image'/><meta name='twitter:image:alt' content='The Meaning of Life (1983) by Terry Jones and Terry Gilliam'/> </head> <body><div class="wrapper"> <aside class="header-toggle unprintable" id="header-toggle" title="Show the menu" onclick="$('#header').show();$('#header-toggle').hide();">&#9776;</aside> <header class="header" id="header"><div class="face"> <a href="/about-me.html#form" class="sub" title="Click to subscribe to my monthly newsletter"><span>Subscribe</span></a> <a href="/about-me.html" style="position:relative;"> <img src="/images/face-256x256.jpg" class="photo" alt="Yegor Bugayenko"/> </a></div><nav><ul class="menu social notranslate"> <li><a href="https://twitter.com/intent/follow?screen_name=yegor256" rel="nofollow" title="Follow me on Twitter"><i class="icon icon-twitter notranslate" aria-hidden="true"></i></a></li> <li><a href="/rss.xml" rel="nofollow" title="Subscribe to my RSS feed"><i class="icon icon-rss notranslate" aria-hidden="true"></i></a></li> <li><a itemprop="sameAs" href="https://github.com/yegor256" rel="nofollow" title="My GitHub profile"><i class="icon icon-github notranslate" aria-hidden="true"></i></a></li> <li><a itemprop="sameAs" href="http://stackoverflow.com/users/187141/yegor256" rel="nofollow" title="My StackOverflow profile"><i class="icon icon-stackoverflow notranslate" aria-hidden="true"></i></a></li> <li><a itemprop="sameAs" href="https://www.facebook.com/yegor256" rel="nofollow" title="Follow me on Facebook"><i class="icon icon-facebook notranslate" aria-hidden="true"></i></a></li> <li><a itemprop="sameAs" href="https://instagram.com/yegor256" rel="nofollow" title="Follow me on Instagram"><i class="icon icon-instagram notranslate" aria-hidden="true"></i></a></li> <li><a itemprop="sameAs" href="https://www.linkedin.com/in/yegor256" rel="nofollow" title="My LinkedIn profile"><i class="icon icon-linkedin notranslate" aria-hidden="true"></i></a></li> <li><a itemprop="sameAs" href="https://www.youtube.com/c/yegor256?sub_confirmation=1" rel="nofollow" title="My Youtube video channel"><i class="icon icon-youtube notranslate" aria-hidden="true"></i></a></li> <li><a itemprop="sameAs" href="https://www.pinterest.com/yegor256/" rel="nofollow" title="My Pinterest boards"><i class="icon icon-pinterest notranslate" aria-hidden="true"></i></a></li> <li><a itemprop="sameAs" href="https://angel.co/yegor256" rel="nofollow" title="My AngelList profile"><i class="icon icon-angellist notranslate" aria-hidden="true"></i></a></li> <li><a href="https://soundcloud.com/yegor256" rel="nofollow" title="My podcast"><i class="icon icon-podcast notranslate" aria-hidden="true"></i></a></li> <li><a href="https://itunes.apple.com/us/podcast/yegor256-podcast/id1150826721" rel="nofollow" title="My iTunes podcast"><i class="icon icon-itunes notranslate" aria-hidden="true"></i></a></li> <li><a href="https://t.me/joinchat/AAAAAEJFMRzsRTRxM3ec6A" rel="nofollow" title="My Telegram public channel"><i class="icon icon-telegram notranslate" aria-hidden="true"></i></a></li> <li><a href="mailto:blog@yegor256.com" rel="nofollow" title="Email me any time"><i class="icon icon-mail notranslate" aria-hidden="true"></i></a></li></ul><ul class="menu"> <li><a href="/" title="Home page">Home</a></li> <li ><a href="/best.html" title="Best articles to read">12&#160;Best</a></li> <li ><a href="/contents.html" title="The contents of the entire blog">All&#160;288</a></li> <li ><a href="/webinars.html" title="My webinars">Webinars</a></li> <li ><a href="/talks.html" title="Future and past conference talks">Talks</a></li> <li ><a href="/books.html" title="The books I wrote">Books</a></li> <li ><a href="/papers.html" title="My academic papers and patents">Papers</a></li> <li ><a href="/pets.html" title="My loved pet projects">Pets</a></li> <li ><a href="/award.html" title="Software quality award">Award</a></li> <li ><a href="/testimonials.html" title="What some people say about me">Testimonials</a></li> <li ><a href="/shift-m.html" title="Audio podcast about project management">Shift-M</a></li> <li ><a href="/paintings.html" title="My paintings for sale">Paintings</a></li> <li><a href="http://ru.yegor256.com/" title="Немного на русском языке">По-русски</a></li></ul></nav><div class="search"> <form method="get" action="https://www.google.com/search" itemprop="potentialAction" itemscope="" itemtype="http://schema.org/SearchAction"> <meta itemprop="target" content="https://www.google.com/search?q={q}"/> <input name="sitesearch" value="yegor256.com" type="hidden"/> <input itemprop="query-input" type="text" id="search-query" class="field field-text" required="required" onfocus="$('.google').css('visibility', 'visible');" name="q" placeholder="Search..." autocomplete="off"/> <input type="image" src="/images/google-search-icon.svg" class="google" title="Search via Google" alt="Search via Google"/> </form></div><div class="hot"><ul> <li> <a href="/code-ahead.html">Code Ahead</a> was published on Amazon just a few days ago! It is my new book, a novel about programmers. It explains in details the majority of ideas that stand behind <a href="https://www.zerocracy.com">Zerocracy</a> and <a href="https://www.xdsd.org">XDSD</a>. </li> <li> At <a href="/webinars.html">Webinar #37</a> we will discuss naming problem in OOP, for objects, methods and attributes; join us on <b>September 12</b>, at 11am PST. </li></ul></div></header></div><section itemscope="" itemtype="http://schema.org/BlogPosting"><div class="wrapper"> <header><p class="printable"> <img src="https://api.qrserver.com/v1/create-qr-code/?data=https://www.yegor256.com/2015/01/12/compound-name-is-code-smell.html&amp;format=svg" style="width:125px;height:125px;" alt="QR code"/></p><p class="printable"> <code itemprop="url">https://www.yegor256.com/2015/01/12/compound-name-is-code-smell.html</code></p><h1 itemprop="name headline mainEntityOfPage">A Compound Name Is a Code Smell</h1><aside class='book'><a href='http://amzn.to/2pyceWc'><img src='/images/books/elegant-objects/cover.png' class='book-cover' alt='book cover'/></a>Read more about this subject in <a href='http://amzn.to/2pyceWc'>Section&nbsp;5.1</a><br/> of my book<a href='http://amzn.to/2pyceWc'><img src='/images/books/amazon-buy-button.png' class='amazon-button' alt='Click to buy'/></a></aside><ul class="subline"> <li> <time itemprop="datePublished" datetime="2015-01-12T00:00:00+00:00"> 12 January 2015 </time> </li> <li class="printable" itemscope="" itemprop="author" itemtype="http://schema.org/Person"> <span itemprop="name">Yegor Bugayenko</span> </li> <li class="unprintable"> <i class="icon icon-comments"></i> <a href="http://www.yegor256.com/2015/01/12/compound-name-is-code-smell.html#disqus_thread" itemprop="discussionUrl">comments</a> </li></ul><ul class="unprintable subline"> <li>Translated:</li> <li><a href="http://blog.csdn.net/LvShuiLanTian/article/details/52349054">Chinese</a></li> <li><a href="mailto:translate@yegor256.com">add yours!</a></li></ul><p class="unprintable"><p>Do you name variables like <code>textLength</code>, <code>table_name</code>, or <code>current-user-email</code>? All three are compound names that consist of more than one word. Even though they look more descriptive than <code>name</code>, <code>length</code>, or <code>email</code>, I would strongly recommend avoiding them. I believe a variable name that is more complex than a noun is a code smell. Why? Because we usually give a variable a compound name when its scope is so big and complex that a simple noun would sound ambiguous. And a big, complex scope is an obvious code smell.</p><figure class='jb_picture'><img itemprop='image' alt='The Meaning of Life (1983) by Terry Jones and Terry Gilliam' src='/images/2015/01/meaning-of-life-every-sperm.png' longdesc='#6b72f309'/><figcaption id='6b72f309'>The Meaning of Life (1983) by Terry Jones and Terry Gilliam</figcaption></figure><p>The scope of a variable is the place where it is visible, like a method, for example. Look at this Ruby class:</p><figure class="highlight"><pre><code class="language-ruby" data-lang="ruby"><span></span><span class="k">class</span> <span class="nc">CSV</span>
  <span class="k">def</span> <span class="nf">initialize</span><span class="p">(</span><span class="n">csvFileName</span><span class="p">)</span>
    <span class="vi">@fileName</span> <span class="o">=</span> <span class="n">csvFileName</span>
  <span class="k">end</span>
  <span class="k">def</span> <span class="nf">readRecords</span><span class="p">()</span>
    <span class="no">File</span><span class="o">.</span><span class="n">readLines</span><span class="p">(</span><span class="vi">@fileName</span><span class="p">)</span><span class="o">.</span><span class="n">map</span> <span class="o">|</span><span class="n">csvLine</span><span class="o">|</span>
      <span class="n">csvLine</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s1">&#39;,&#39;</span><span class="p">)</span>
    <span class="k">end</span>
  <span class="k">end</span>
<span class="k">end</span></code></pre></figure><p>The visible scope of variable <code>csvFileName</code> is method <code>initialize()</code>, which is a constructor of the class <code>CSV</code>. Why does it need a compound name that consists of three words? Isn&#39;t it already clear that a single-argument constructor of class <code>CSV</code> expects the name of a file with comma-separated values? I would rename it to <code>file</code>.</p><p>Next, the scope of <code>@fileName</code> is the entire <code>CSV</code> class. Renaming a single variable in the class to just <code>@file</code> won&#39;t introduce any confusion. It&#39;s still clear what file we&#39;re dealing with. The same situation exists with the <code>csvLine</code> variable. It is clear that we&#39;re dealing with CSV lines here. The <code>csv</code> prefix is just a redundancy. Here is how I would refactor the class:</p><figure class="highlight"><pre><code class="language-ruby" data-lang="ruby"><span></span><span class="k">class</span> <span class="nc">CSV</span>
  <span class="k">def</span> <span class="nf">initialize</span><span class="p">(</span><span class="n">file</span><span class="p">)</span>
    <span class="vi">@file</span> <span class="o">=</span> <span class="n">file</span>
  <span class="k">end</span>
  <span class="k">def</span> <span class="nf">records</span><span class="p">()</span>
    <span class="no">File</span><span class="o">.</span><span class="n">readLines</span><span class="p">(</span><span class="vi">@file</span><span class="p">)</span><span class="o">.</span><span class="n">map</span> <span class="o">|</span><span class="n">line</span><span class="o">|</span>
      <span class="n">line</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s1">&#39;,&#39;</span><span class="p">)</span>
    <span class="k">end</span>
  <span class="k">end</span>
<span class="k">end</span></code></pre></figure><p>Now it looks clear and concise.</p><p>If you can&#39;t perform such a refactoring, it means your scope is too big and/or too complex. An ideal method should deal with up to five variables, and an ideal class should encapsulate up to five properties.</p><p>If we have five variables, can&#39;t we find five nouns to name them?</p><p>Adam and Eve didn&#39;t have second names. They were unique in Eden, as were many other characters in the Old Testament. Second and middle names were invented later in order to resolve ambiguity. To keep your methods and classes clean and solid, and to prevent ambiguity, try to give your variables and methods unique single-word names, just like Adam and Eve were named by you know who :)</p><p>PS. Also, <a href="/2015/09/01/redundant-variables-are-evil.html">redundant variables</a> are evil as well.</p></p><nav class="buttons notranslate desktop-only"> <a href="http://www.facebook.com/sharer/sharer.php?u=https://www.yegor256.com/2015/01/12/compound-name-is-code-smell.html" title="Share on Facebook" class="button" rel="nofollow"> <span class="count count-facebook">0</span> <i class="icon icon-facebook notranslate" aria-hidden="true"></i> </a> <a href="https://twitter.com/share?url=https://www.yegor256.com/2015/01/12/compound-name-is-code-smell.html&amp;text=A+Compound+Name+Is+a+Code+Smell" title="Share on Twitter" class="button" rel="nofollow"> <span class="count count-twitter">0</span> <i class="icon icon-twitter notranslate" aria-hidden="true"></i> </a> <a href="https://plus.google.com/share?url=https://www.yegor256.com/2015/01/12/compound-name-is-code-smell.html" title="Share on Google+" class="button" rel="nofollow"> <span class="count count-googleplus">0</span> <i class="icon icon-googleplus notranslate" aria-hidden="true"></i> </a> <a href="https://www.linkedin.com/cws/share?url=https://www.yegor256.com/2015/01/12/compound-name-is-code-smell.html" title="Share on LinkedIn" class="button" rel="nofollow"> <span class="count count-linkedin">0</span> <i class="icon icon-linkedin notranslate" aria-hidden="true"></i> </a> <a href="http://reddit.com/submit?url=https://www.yegor256.com/2015/01/12/compound-name-is-code-smell.html%3F2015-02&amp;title=A+Compound+Name+Is+a+Code+Smell" title="Share on Reddit" class="button" rel="nofollow"> <span class="count count-reddit">0</span> <i class="icon icon-reddit notranslate" aria-hidden="true"></i> </a> <a href="http://news.ycombinator.com/submitlink?u=https://www.yegor256.com/2015/01/12/compound-name-is-code-smell.html%3F2015-02&amp;t=A+Compound+Name+Is+a+Code+Smell" title="Share on Hacker News" class="button" rel="nofollow"> <span class="count count-hackernews">0</span> <i class="icon icon-hackernews notranslate" aria-hidden="true"></i> </a> </nav> </header> <article class="main" itemprop="articleBody"><div ><p>Do you name variables like <code>textLength</code>, <code>table_name</code>, or <code>current-user-email</code>? All three are compound names that consist of more than one word. Even though they look more descriptive than <code>name</code>, <code>length</code>, or <code>email</code>, I would strongly recommend avoiding them. I believe a variable name that is more complex than a noun is a code smell. Why? Because we usually give a variable a compound name when its scope is so big and complex that a simple noun would sound ambiguous. And a big, complex scope is an obvious code smell.</p><figure class='jb_picture'><img itemprop='image' alt='The Meaning of Life (1983) by Terry Jones and Terry Gilliam' src='/images/2015/01/meaning-of-life-every-sperm.png' longdesc='#6b72f309'/><figcaption id='6b72f309'>The Meaning of Life (1983) by Terry Jones and Terry Gilliam</figcaption></figure><p>The scope of a variable is the place where it is visible, like a method, for example. Look at this Ruby class:</p><figure class="highlight"><pre><code class="language-ruby" data-lang="ruby"><span></span><span class="k">class</span> <span class="nc">CSV</span>
  <span class="k">def</span> <span class="nf">initialize</span><span class="p">(</span><span class="n">csvFileName</span><span class="p">)</span>
    <span class="vi">@fileName</span> <span class="o">=</span> <span class="n">csvFileName</span>
  <span class="k">end</span>
  <span class="k">def</span> <span class="nf">readRecords</span><span class="p">()</span>
    <span class="no">File</span><span class="o">.</span><span class="n">readLines</span><span class="p">(</span><span class="vi">@fileName</span><span class="p">)</span><span class="o">.</span><span class="n">map</span> <span class="o">|</span><span class="n">csvLine</span><span class="o">|</span>
      <span class="n">csvLine</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s1">&#39;,&#39;</span><span class="p">)</span>
    <span class="k">end</span>
  <span class="k">end</span>
<span class="k">end</span></code></pre></figure><p>The visible scope of variable <code>csvFileName</code> is method <code>initialize()</code>, which is a constructor of the class <code>CSV</code>. Why does it need a compound name that consists of three words? Isn&#39;t it already clear that a single-argument constructor of class <code>CSV</code> expects the name of a file with comma-separated values? I would rename it to <code>file</code>.</p><p>Next, the scope of <code>@fileName</code> is the entire <code>CSV</code> class. Renaming a single variable in the class to just <code>@file</code> won&#39;t introduce any confusion. It&#39;s still clear what file we&#39;re dealing with. The same situation exists with the <code>csvLine</code> variable. It is clear that we&#39;re dealing with CSV lines here. The <code>csv</code> prefix is just a redundancy. Here is how I would refactor the class:</p><figure class="highlight"><pre><code class="language-ruby" data-lang="ruby"><span></span><span class="k">class</span> <span class="nc">CSV</span>
  <span class="k">def</span> <span class="nf">initialize</span><span class="p">(</span><span class="n">file</span><span class="p">)</span>
    <span class="vi">@file</span> <span class="o">=</span> <span class="n">file</span>
  <span class="k">end</span>
  <span class="k">def</span> <span class="nf">records</span><span class="p">()</span>
    <span class="no">File</span><span class="o">.</span><span class="n">readLines</span><span class="p">(</span><span class="vi">@file</span><span class="p">)</span><span class="o">.</span><span class="n">map</span> <span class="o">|</span><span class="n">line</span><span class="o">|</span>
      <span class="n">line</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s1">&#39;,&#39;</span><span class="p">)</span>
    <span class="k">end</span>
  <span class="k">end</span>
<span class="k">end</span></code></pre></figure><p>Now it looks clear and concise.</p><p>If you can&#39;t perform such a refactoring, it means your scope is too big and/or too complex. An ideal method should deal with up to five variables, and an ideal class should encapsulate up to five properties.</p><p>If we have five variables, can&#39;t we find five nouns to name them?</p><p>Adam and Eve didn&#39;t have second names. They were unique in Eden, as were many other characters in the Old Testament. Second and middle names were invented later in order to resolve ambiguity. To keep your methods and classes clean and solid, and to prevent ambiguity, try to give your variables and methods unique single-word names, just like Adam and Eve were named by you know who :)</p><p>PS. Also, <a href="/2015/09/01/redundant-variables-are-evil.html">redundant variables</a> are evil as well.</p></div></article></div><div class="wrapper"> <related-posts /></div><div class="disqus" role="complementary"><p class="disqus_hint"> Please, use <a href="https://help.disqus.com/commenting/what-html-tags-are-allowed-within-comments">syntax highlighting</a> in your comments, to make them more readable.</p><div id="disqus_thread" class="disqus-thread"> <a>&nbsp;</a></div><script> var disqus_config = function () { this.page.url = document.location.href.split('?')[0].split('#')[0].replace('https://', 'http://'); this.page.identifier = this.page.url; }; (function() { var d = document, s = d.createElement('script'); s.src = '//yegor256.disqus.com/embed.js'; s.setAttribute('data-timestamp', +new Date()); (d.head || d.body).appendChild(s); })(); </script> <noscript><div><p class="red"> JavaScript is disabled in your browser, that's why you can't see comments under this post.</p></div></noscript></div><div class="wrapper"> <footer class="footer"><p> &copy; <span itemscope="" itemprop="copyrightHolder" itemtype="http://schema.org/Person"> <span itemprop="name">Yegor Bugayenko</span> </span> 2014&ndash;<span itemprop="copyrightYear">2018</span></p></footer></div></section><div class="wrapper unprintable" style="text-align:center;margin-top:2em;"> <a href="http://www.sixnines.io/h/3ba1652f"> <img src="//www.sixnines.io/b/3ba1652f?style=flat" alt="sixnines availability badge"/> </a></div><script src="//code.jquery.com/jquery-1.9.0.min.js"></script> <script src="/js/all.js?a0e0d018c07"></script> <script>var disqus_shortname = 'yegor256';</script> <script id="dsq-count-scr" src="//yegor256.disqus.com/count.js" async="async"></script> <script> (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){ (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o), m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m) })(window,document,'script','//www.google-analytics.com/analytics.js','ga'); ga('create', 'UA-1963507-32', 'auto'); ga('send', 'pageview'); </script> <script> Cd=document;Cr="&"+Math.random();Cp="&s=1"; Cd.cookie="b=b";if(Cd.cookie)Cp+="&c=1"; Cp+="&t="+(new Date()).getTimezoneOffset(); if(self!=top)Cp+="&f=1"; </script> <script> if(navigator.javaEnabled())Cp+="&j=1"; </script> <script> if(typeof(screen)!='undefined')Cp+="&w="+screen.width+"&h="+ screen.height+"&d="+(screen.colorDepth?screen.colorDepth:screen.pixelDepth); </script> <script> Cd.write("<img src='//c.hit.ua/hit?i=95870&g=0&x=2"+Cp+Cr+ "&r="+escape(Cd.referrer)+"&u="+escape(window.location.href)+ "' border='0' wi"+"dth='1' he"+"ight='1'/>"); </script> <script type="application/ld+json"> { "@context": "http://schema.org", "@type": "Person", "name": "Yegor Bugayenko", "url": "http://www.yegor256.com", "sameAs": [ "https://www.facebook.com/yegor256", "https://instagram.com/yegor256", "https://www.linkedin.com/in/yegor256", "https://twitter.com/yegor256", "https://github.com/yegor256", "https://www.pinterest.com/yegor256/" ] } </script> </body> </html> <!DOCTYPE html> <html xmlns="http://www.w3.org/1999/xhtml" lang="en-US" xml:lang="en-US" itemscope="" itemtype="http://schema.org/WebSite"> <head> <meta charset="utf-8"/> <meta name="description" content="Immutable objects are not the same as passive data structures without setters, despite a very common mis-belief. " /> <meta name="keywords" content="immutable objects, immutable objects advantages, immutable objects are thread safe, immutable objects in java, immutable objects in java example" /> <meta name="viewport" content="width=device-width,minimum-scale=1,initial-scale=1"/> <meta name="google-site-verification" content="JEj_gQr2CPe2QKGw8XdMz0R7VboQIUbX3FlM-lwTq-8" /> <meta name="author" content="Yegor Bugayenko"> <meta name="article:published_time" content="2014-12-22 00:00:00 +0000"> <meta name="og:site_name" content="Yegor Bugayenko"/> <meta name="og:type" content="article" /> <meta name="og:locale" content="en_US" /> <meta name="twitter:account_id" content="4503599630178231" /> <meta name="twitter:creator" content="@yegor256"/> <meta name="twitter:site" content="@yegor256"/> <meta name="twitter:title" property="og:title" content="Immutable Objects Are Not Dumb"/> <meta name="twitter:description" property="og:description" content="Immutable objects are not the same as passive data structures without setters, despite a very common mis-belief. "/> <meta name="twitter:url" property="og:url" content="https://www.yegor256.com/2014/12/22/immutable-objects-not-dumb.html"/> <meta name="telegram:channel" content="AAAAAEJFMRzsRTRxM3ec6A"/> <link rel="search" type="application/opensearchdescription+xml" href="/opensearch.xml" title="yegor256" /> <link rel="shortcut icon" href="/favicon.ico?a0e0d018c07"/> <link rel="apple-touch-icon" href="/favicon.ico?a0e0d018c07"/> <link rel="alternate" type="application/rss+xml" title="RSS for yegor256.com" href="https://www.yegor256.com/rss.xml"/> <link rel="stylesheet" href="/css/layout.css?a0e0d018c07"/> <link rel="stylesheet" href="/css/icons.css?a0e0d018c07"/> <link rel="canonical" href="https://www.yegor256.com/2014/12/22/immutable-objects-not-dumb.html" /> <link rel="amphtml" href="https://www.yegor256.com/2014/12/22/immutable-objects-not-dumb.amp.html" /> <title>Immutable Objects Are Not Dumb </title> <meta name='og:image' content='https://www.yegor256.com/images/2014/12/usual-suspects-kobayashi.png'/><meta name='twitter:image' content='https://www.yegor256.com/images/2014/12/usual-suspects-kobayashi.png'/><meta name='og:image:width' content='1200'/> <meta name='twitter:image:width' content='1200'/><meta name='og:image:height' content='508'/> <meta name='twitter:image:height' content='508'/><meta name='twitter:card' content='summary_large_image'/><meta name='twitter:image:alt' content='The Usual Suspects (1995) by Bryan Singer'/> </head> <body><div class="wrapper"> <aside class="header-toggle unprintable" id="header-toggle" title="Show the menu" onclick="$('#header').show();$('#header-toggle').hide();">&#9776;</aside> <header class="header" id="header"><div class="face"> <a href="/about-me.html#form" class="sub" title="Click to subscribe to my monthly newsletter"><span>Subscribe</span></a> <a href="/about-me.html" style="position:relative;"> <img src="/images/face-256x256.jpg" class="photo" alt="Yegor Bugayenko"/> </a></div><nav><ul class="menu social notranslate"> <li><a href="https://twitter.com/intent/follow?screen_name=yegor256" rel="nofollow" title="Follow me on Twitter"><i class="icon icon-twitter notranslate" aria-hidden="true"></i></a></li> <li><a href="/rss.xml" rel="nofollow" title="Subscribe to my RSS feed"><i class="icon icon-rss notranslate" aria-hidden="true"></i></a></li> <li><a itemprop="sameAs" href="https://github.com/yegor256" rel="nofollow" title="My GitHub profile"><i class="icon icon-github notranslate" aria-hidden="true"></i></a></li> <li><a itemprop="sameAs" href="http://stackoverflow.com/users/187141/yegor256" rel="nofollow" title="My StackOverflow profile"><i class="icon icon-stackoverflow notranslate" aria-hidden="true"></i></a></li> <li><a itemprop="sameAs" href="https://www.facebook.com/yegor256" rel="nofollow" title="Follow me on Facebook"><i class="icon icon-facebook notranslate" aria-hidden="true"></i></a></li> <li><a itemprop="sameAs" href="https://instagram.com/yegor256" rel="nofollow" title="Follow me on Instagram"><i class="icon icon-instagram notranslate" aria-hidden="true"></i></a></li> <li><a itemprop="sameAs" href="https://www.linkedin.com/in/yegor256" rel="nofollow" title="My LinkedIn profile"><i class="icon icon-linkedin notranslate" aria-hidden="true"></i></a></li> <li><a itemprop="sameAs" href="https://www.youtube.com/c/yegor256?sub_confirmation=1" rel="nofollow" title="My Youtube video channel"><i class="icon icon-youtube notranslate" aria-hidden="true"></i></a></li> <li><a itemprop="sameAs" href="https://www.pinterest.com/yegor256/" rel="nofollow" title="My Pinterest boards"><i class="icon icon-pinterest notranslate" aria-hidden="true"></i></a></li> <li><a itemprop="sameAs" href="https://angel.co/yegor256" rel="nofollow" title="My AngelList profile"><i class="icon icon-angellist notranslate" aria-hidden="true"></i></a></li> <li><a href="https://soundcloud.com/yegor256" rel="nofollow" title="My podcast"><i class="icon icon-podcast notranslate" aria-hidden="true"></i></a></li> <li><a href="https://itunes.apple.com/us/podcast/yegor256-podcast/id1150826721" rel="nofollow" title="My iTunes podcast"><i class="icon icon-itunes notranslate" aria-hidden="true"></i></a></li> <li><a href="https://t.me/joinchat/AAAAAEJFMRzsRTRxM3ec6A" rel="nofollow" title="My Telegram public channel"><i class="icon icon-telegram notranslate" aria-hidden="true"></i></a></li> <li><a href="mailto:blog@yegor256.com" rel="nofollow" title="Email me any time"><i class="icon icon-mail notranslate" aria-hidden="true"></i></a></li></ul><ul class="menu"> <li><a href="/" title="Home page">Home</a></li> <li ><a href="/best.html" title="Best articles to read">12&#160;Best</a></li> <li ><a href="/contents.html" title="The contents of the entire blog">All&#160;288</a></li> <li ><a href="/webinars.html" title="My webinars">Webinars</a></li> <li ><a href="/talks.html" title="Future and past conference talks">Talks</a></li> <li ><a href="/books.html" title="The books I wrote">Books</a></li> <li ><a href="/papers.html" title="My academic papers and patents">Papers</a></li> <li ><a href="/pets.html" title="My loved pet projects">Pets</a></li> <li ><a href="/award.html" title="Software quality award">Award</a></li> <li ><a href="/testimonials.html" title="What some people say about me">Testimonials</a></li> <li ><a href="/shift-m.html" title="Audio podcast about project management">Shift-M</a></li> <li ><a href="/paintings.html" title="My paintings for sale">Paintings</a></li> <li><a href="http://ru.yegor256.com/" title="Немного на русском языке">По-русски</a></li></ul></nav><div class="search"> <form method="get" action="https://www.google.com/search" itemprop="potentialAction" itemscope="" itemtype="http://schema.org/SearchAction"> <meta itemprop="target" content="https://www.google.com/search?q={q}"/> <input name="sitesearch" value="yegor256.com" type="hidden"/> <input itemprop="query-input" type="text" id="search-query" class="field field-text" required="required" onfocus="$('.google').css('visibility', 'visible');" name="q" placeholder="Search..." autocomplete="off"/> <input type="image" src="/images/google-search-icon.svg" class="google" title="Search via Google" alt="Search via Google"/> </form></div><div class="hot"><ul> <li> <a href="/code-ahead.html">Code Ahead</a> was published on Amazon just a few days ago! It is my new book, a novel about programmers. It explains in details the majority of ideas that stand behind <a href="https://www.zerocracy.com">Zerocracy</a> and <a href="https://www.xdsd.org">XDSD</a>. </li> <li> At <a href="/webinars.html">Webinar #37</a> we will discuss naming problem in OOP, for objects, methods and attributes; join us on <b>September 12</b>, at 11am PST. </li></ul></div></header></div><section itemscope="" itemtype="http://schema.org/BlogPosting"><div class="wrapper"> <header><p class="printable"> <img src="https://api.qrserver.com/v1/create-qr-code/?data=https://www.yegor256.com/2014/12/22/immutable-objects-not-dumb.html&amp;format=svg" style="width:125px;height:125px;" alt="QR code"/></p><p class="printable"> <code itemprop="url">https://www.yegor256.com/2014/12/22/immutable-objects-not-dumb.html</code></p><h1 itemprop="name headline mainEntityOfPage">Immutable Objects Are Not Dumb</h1><aside class='book'><a href='http://amzn.to/2qFt4Tn'><img src='/images/books/elegant-objects/cover.png' class='book-cover' alt='book cover'/></a>Read more about this subject in <a href='http://amzn.to/2qFt4Tn'>Section&nbsp;2.6</a><br/> of my book<a href='http://amzn.to/2qFt4Tn'><img src='/images/books/amazon-buy-button.png' class='amazon-button' alt='Click to buy'/></a></aside><ul class="subline"> <li> <time itemprop="datePublished" datetime="2014-12-22T00:00:00+00:00"> 22 December 2014 </time> </li> <li class="printable" itemscope="" itemprop="author" itemtype="http://schema.org/Person"> <span itemprop="name">Yegor Bugayenko</span> </li> <li class="unprintable"> <i class="icon icon-comments"></i> <a href="http://www.yegor256.com/2014/12/22/immutable-objects-not-dumb.html#disqus_thread" itemprop="discussionUrl">comments</a> </li></ul><p class="unprintable"><p>After a few recent posts about immutability, including <a href="/2014/06/09/objects-should-be-immutable.html">Objects Should Be Immutable</a> and <a href="/2014/12/09/immutable-object-state-and-behavior.html">How an Immutable Object Can Have State and Behavior?</a>, I was surprised by the number of comments saying that I badly misunderstood the idea. Most of those comments stated that an immutable object must always behave the same way---that is what immutability is about. What kind of immutability is it, if a method returns different results each time we call it? This is not how well-known immutable classes behave. Take, for example, <code>String</code>, <code>BigInteger</code>, <code>Locale</code>, <code>URI</code>, <code>URL</code>, <code>Inet4Address</code>, <code>UUID</code>, or wrapper classes for primitives, like <code>Double</code> and <code>Integer</code>. Other comments argued against <a href="/2014/11/20/seven-virtues-of-good-object.html">the very definition</a> of an immutable object as a representative of a mutable real-world entity. How could an immutable object represent a mutable entity? Huh?</p><figure class='jb_picture'><img itemprop='image' alt='The Usual Suspects (1995) by Bryan Singer' src='/images/2014/12/usual-suspects-kobayashi.png' longdesc='#0f7b14d6'/><figcaption id='0f7b14d6'>The Usual Suspects (1995) by Bryan Singer</figcaption></figure> <aside class='youtube'> <a href='https://www.youtube.com/watch?v=p7m7_iiqaHI'><div class='box'> <img src='https://i.ytimg.com/vi/p7m7_iiqaHI/mqdefault.jpg' alt='YouTube video #p7m7_iiqaHI'/><div class='play'><i class='icon icon-play'></i></div></div></a><div>How Much Immutability Is Enough?; 19 May 2016.</div></aside><p>I&#39;m very surprised. This post is going to clarify the definition of an immutable <a href="/2016/07/14/who-is-object.html">object</a>. First, here is a quick answer. How can an immutable object represent a mutable entity? Look at an immutable class, <a href="http://docs.oracle.com/javase/7/docs/api/java/io/File.html"><code>File</code></a>, and its methods, for example <code>length()</code> and <code>delete()</code>. The class is immutable, according to Oracle documentation, and its methods may return different values each time we call them. An object of class <code>File</code>, being perfectly immutable, represents a mutable real-world entity, a file on disk.</p><figure class='badge'><a href='http://amzn.to/2c7sVS1'><img src='https://www.yegor256.com/images/2014/12/java-concurrency-in-practice.png' style='width:100px;max-width:100%;' alt='badge'/></a></figure><p>In <a href="/2014/06/09/objects-should-be-immutable.html">this post</a>, I said that &quot;an object is immutable if its state can&#39;t be modified after it is created.&quot; This definition is not mine; it&#39;s taken from <a href="http://amzn.to/2c7sVS1">Java Concurrency in Practice by Goetz et al.</a>, Section 3.4 (by the way, I highly recommend you read it). Now look at this class (I&#39;m using <a href="http://http.jcabi.com">jcabi-http</a> to read and write over HTTP):</p><figure class="highlight"><pre><code class="language-java" data-lang="java"><span></span><span class="nd">@Immutable</span>
<span class="kd">class</span> <span class="nc">Page</span> <span class="o">{</span>
  <span class="kd">private</span> <span class="kd">final</span> <span class="n">URI</span> <span class="n">uri</span><span class="o">;</span>
  <span class="n">Page</span><span class="o">(</span><span class="n">URI</span> <span class="n">addr</span><span class="o">)</span> <span class="o">{</span>
    <span class="k">this</span><span class="o">.</span><span class="na">uri</span> <span class="o">=</span> <span class="n">addr</span><span class="o">;</span>
  <span class="o">}</span>
  <span class="kd">public</span> <span class="n">String</span> <span class="nf">load</span><span class="o">()</span> <span class="o">{</span>
    <span class="k">return</span> <span class="k">new</span> <span class="n">JdkRequest</span><span class="o">(</span><span class="k">this</span><span class="o">.</span><span class="na">uri</span><span class="o">)</span>
      <span class="o">.</span><span class="na">fetch</span><span class="o">().</span><span class="na">body</span><span class="o">();</span>
  <span class="o">}</span>
  <span class="kd">public</span> <span class="kt">void</span> <span class="nf">save</span><span class="o">(</span><span class="n">String</span> <span class="n">content</span><span class="o">)</span> <span class="o">{</span>
    <span class="k">new</span> <span class="n">JdkRequest</span><span class="o">(</span><span class="k">this</span><span class="o">.</span><span class="na">uri</span><span class="o">)</span>
      <span class="o">.</span><span class="na">method</span><span class="o">(</span><span class="s">&quot;PUT&quot;</span><span class="o">)</span>
      <span class="o">.</span><span class="na">body</span><span class="o">().</span><span class="na">set</span><span class="o">(</span><span class="n">content</span><span class="o">).</span><span class="na">back</span><span class="o">()</span>
      <span class="o">.</span><span class="na">fetch</span><span class="o">();</span>
  <span class="o">}</span>
<span class="o">}</span></code></pre></figure><p>What is the &quot;state&quot; in this class? That&#39;s right, <code>this.uri</code> is the state. It uniquely identifies every object of this class, and it is not modifiable. Thus, the class makes only immutable objects. And each object represents a mutable entity of the real world, a web page with a URI.</p><p>There is no contradiction in this situation. The class is perfectly immutable, while the web page it represents is mutable.</p><aside class='youtube'> <a href='https://www.youtube.com/watch?v=KwP7Ay9Z-hc'><div class='box'> <img src='https://i.ytimg.com/vi/KwP7Ay9Z-hc/mqdefault.jpg' alt='YouTube video #KwP7Ay9Z-hc'/><div class='play'><i class='icon icon-play'></i></div></div></a><div>Immutable Objects vs. Common Sense (webinar #2); 6 May 2015.</div></aside><p>Why do most programmers I have talked to believe that if an underlying entity is mutable, an object is mutable too? I think the answer is simple---they think that objects are data structures with methods. That&#39;s why, from this point of view, an immutable object is a data structure that never changes.</p><p>This is where the fallacy is coming from---an object is <strong>not a data structure</strong>. It is a living organism representing a real-world entity inside the object&#39;s living environment (a computer program). It does encapsulate some data, which helps to locate the entity in the real world. The encapsulated data is the <strong>coordinates</strong> of the entity being represented. In the case of <code>String</code> or <code>URL</code>, the coordinates are the same as the entity itself, but this is just an isolated incident, not a generic rule.</p><aside class='youtube'> <a href='https://www.youtube.com/watch?v=EnhRgXrHCC4'><div class='box'> <img src='https://i.ytimg.com/vi/EnhRgXrHCC4/mqdefault.jpg' alt='YouTube video #EnhRgXrHCC4'/><div class='play'><i class='icon icon-play'></i></div></div></a><div>How Immutability Helps in OOP (in Russian with English subtitles); 21 May 2016.</div></aside><p>An immutable object is not a data structure that doesn&#39;t change, even though <code>String</code>, <code>BigInteger</code>, and <code>URL</code> look like one. An object is immutable if and only if it doesn&#39;t change the coordinates of the real-world entity it represents. In the <code>Page</code> class above, this means that an object of the class, once instantiated, will never change <code>this.uri</code>. It will always point to the same web page, no matter what.</p><p>And the object doesn&#39;t guarantee anything about the behavior of that web page. The page is a dynamic creature of a real world, living its own life. Our object can&#39;t promise anything about the page. The only thing it promises is that it will always stay loyal to that page---it will never forget or change its coordinates.</p><p>Conceptually speaking, immutability means loyalty, that&#39;s all.</p></p><nav class="buttons notranslate desktop-only"> <a href="http://www.facebook.com/sharer/sharer.php?u=https://www.yegor256.com/2014/12/22/immutable-objects-not-dumb.html" title="Share on Facebook" class="button" rel="nofollow"> <span class="count count-facebook">0</span> <i class="icon icon-facebook notranslate" aria-hidden="true"></i> </a> <a href="https://twitter.com/share?url=https://www.yegor256.com/2014/12/22/immutable-objects-not-dumb.html&amp;text=Immutable+Objects+Are+Not+Dumb" title="Share on Twitter" class="button" rel="nofollow"> <span class="count count-twitter">0</span> <i class="icon icon-twitter notranslate" aria-hidden="true"></i> </a> <a href="https://plus.google.com/share?url=https://www.yegor256.com/2014/12/22/immutable-objects-not-dumb.html" title="Share on Google+" class="button" rel="nofollow"> <span class="count count-googleplus">0</span> <i class="icon icon-googleplus notranslate" aria-hidden="true"></i> </a> <a href="https://www.linkedin.com/cws/share?url=https://www.yegor256.com/2014/12/22/immutable-objects-not-dumb.html" title="Share on LinkedIn" class="button" rel="nofollow"> <span class="count count-linkedin">0</span> <i class="icon icon-linkedin notranslate" aria-hidden="true"></i> </a> <a href="http://reddit.com/submit?url=https://www.yegor256.com/2014/12/22/immutable-objects-not-dumb.html%3F2014-51&amp;title=Immutable+Objects+Are+Not+Dumb" title="Share on Reddit" class="button" rel="nofollow"> <span class="count count-reddit">0</span> <i class="icon icon-reddit notranslate" aria-hidden="true"></i> </a> <a href="http://news.ycombinator.com/submitlink?u=https://www.yegor256.com/2014/12/22/immutable-objects-not-dumb.html%3F2014-51&amp;t=Immutable+Objects+Are+Not+Dumb" title="Share on Hacker News" class="button" rel="nofollow"> <span class="count count-hackernews">0</span> <i class="icon icon-hackernews notranslate" aria-hidden="true"></i> </a> </nav> </header> <article class="main" itemprop="articleBody"><div ><p>After a few recent posts about immutability, including <a href="/2014/06/09/objects-should-be-immutable.html">Objects Should Be Immutable</a> and <a href="/2014/12/09/immutable-object-state-and-behavior.html">How an Immutable Object Can Have State and Behavior?</a>, I was surprised by the number of comments saying that I badly misunderstood the idea. Most of those comments stated that an immutable object must always behave the same way---that is what immutability is about. What kind of immutability is it, if a method returns different results each time we call it? This is not how well-known immutable classes behave. Take, for example, <code>String</code>, <code>BigInteger</code>, <code>Locale</code>, <code>URI</code>, <code>URL</code>, <code>Inet4Address</code>, <code>UUID</code>, or wrapper classes for primitives, like <code>Double</code> and <code>Integer</code>. Other comments argued against <a href="/2014/11/20/seven-virtues-of-good-object.html">the very definition</a> of an immutable object as a representative of a mutable real-world entity. How could an immutable object represent a mutable entity? Huh?</p><figure class='jb_picture'><img itemprop='image' alt='The Usual Suspects (1995) by Bryan Singer' src='/images/2014/12/usual-suspects-kobayashi.png' longdesc='#0f7b14d6'/><figcaption id='0f7b14d6'>The Usual Suspects (1995) by Bryan Singer</figcaption></figure> <aside class='youtube'> <a href='https://www.youtube.com/watch?v=p7m7_iiqaHI'><div class='box'> <img src='https://i.ytimg.com/vi/p7m7_iiqaHI/mqdefault.jpg' alt='YouTube video #p7m7_iiqaHI'/><div class='play'><i class='icon icon-play'></i></div></div></a><div>How Much Immutability Is Enough?; 19 May 2016.</div></aside><p>I&#39;m very surprised. This post is going to clarify the definition of an immutable <a href="/2016/07/14/who-is-object.html">object</a>. First, here is a quick answer. How can an immutable object represent a mutable entity? Look at an immutable class, <a href="http://docs.oracle.com/javase/7/docs/api/java/io/File.html"><code>File</code></a>, and its methods, for example <code>length()</code> and <code>delete()</code>. The class is immutable, according to Oracle documentation, and its methods may return different values each time we call them. An object of class <code>File</code>, being perfectly immutable, represents a mutable real-world entity, a file on disk.</p><figure class='badge'><a href='http://amzn.to/2c7sVS1'><img src='https://www.yegor256.com/images/2014/12/java-concurrency-in-practice.png' style='width:100px;max-width:100%;' alt='badge'/></a></figure><p>In <a href="/2014/06/09/objects-should-be-immutable.html">this post</a>, I said that &quot;an object is immutable if its state can&#39;t be modified after it is created.&quot; This definition is not mine; it&#39;s taken from <a href="http://amzn.to/2c7sVS1">Java Concurrency in Practice by Goetz et al.</a>, Section 3.4 (by the way, I highly recommend you read it). Now look at this class (I&#39;m using <a href="http://http.jcabi.com">jcabi-http</a> to read and write over HTTP):</p><figure class="highlight"><pre><code class="language-java" data-lang="java"><span></span><span class="nd">@Immutable</span>
<span class="kd">class</span> <span class="nc">Page</span> <span class="o">{</span>
  <span class="kd">private</span> <span class="kd">final</span> <span class="n">URI</span> <span class="n">uri</span><span class="o">;</span>
  <span class="n">Page</span><span class="o">(</span><span class="n">URI</span> <span class="n">addr</span><span class="o">)</span> <span class="o">{</span>
    <span class="k">this</span><span class="o">.</span><span class="na">uri</span> <span class="o">=</span> <span class="n">addr</span><span class="o">;</span>
  <span class="o">}</span>
  <span class="kd">public</span> <span class="n">String</span> <span class="nf">load</span><span class="o">()</span> <span class="o">{</span>
    <span class="k">return</span> <span class="k">new</span> <span class="n">JdkRequest</span><span class="o">(</span><span class="k">this</span><span class="o">.</span><span class="na">uri</span><span class="o">)</span>
      <span class="o">.</span><span class="na">fetch</span><span class="o">().</span><span class="na">body</span><span class="o">();</span>
  <span class="o">}</span>
  <span class="kd">public</span> <span class="kt">void</span> <span class="nf">save</span><span class="o">(</span><span class="n">String</span> <span class="n">content</span><span class="o">)</span> <span class="o">{</span>
    <span class="k">new</span> <span class="n">JdkRequest</span><span class="o">(</span><span class="k">this</span><span class="o">.</span><span class="na">uri</span><span class="o">)</span>
      <span class="o">.</span><span class="na">method</span><span class="o">(</span><span class="s">&quot;PUT&quot;</span><span class="o">)</span>
      <span class="o">.</span><span class="na">body</span><span class="o">().</span><span class="na">set</span><span class="o">(</span><span class="n">content</span><span class="o">).</span><span class="na">back</span><span class="o">()</span>
      <span class="o">.</span><span class="na">fetch</span><span class="o">();</span>
  <span class="o">}</span>
<span class="o">}</span></code></pre></figure><p>What is the &quot;state&quot; in this class? That&#39;s right, <code>this.uri</code> is the state. It uniquely identifies every object of this class, and it is not modifiable. Thus, the class makes only immutable objects. And each object represents a mutable entity of the real world, a web page with a URI.</p><p>There is no contradiction in this situation. The class is perfectly immutable, while the web page it represents is mutable.</p><aside class='youtube'> <a href='https://www.youtube.com/watch?v=KwP7Ay9Z-hc'><div class='box'> <img src='https://i.ytimg.com/vi/KwP7Ay9Z-hc/mqdefault.jpg' alt='YouTube video #KwP7Ay9Z-hc'/><div class='play'><i class='icon icon-play'></i></div></div></a><div>Immutable Objects vs. Common Sense (webinar #2); 6 May 2015.</div></aside><p>Why do most programmers I have talked to believe that if an underlying entity is mutable, an object is mutable too? I think the answer is simple---they think that objects are data structures with methods. That&#39;s why, from this point of view, an immutable object is a data structure that never changes.</p><p>This is where the fallacy is coming from---an object is <strong>not a data structure</strong>. It is a living organism representing a real-world entity inside the object&#39;s living environment (a computer program). It does encapsulate some data, which helps to locate the entity in the real world. The encapsulated data is the <strong>coordinates</strong> of the entity being represented. In the case of <code>String</code> or <code>URL</code>, the coordinates are the same as the entity itself, but this is just an isolated incident, not a generic rule.</p><aside class='youtube'> <a href='https://www.youtube.com/watch?v=EnhRgXrHCC4'><div class='box'> <img src='https://i.ytimg.com/vi/EnhRgXrHCC4/mqdefault.jpg' alt='YouTube video #EnhRgXrHCC4'/><div class='play'><i class='icon icon-play'></i></div></div></a><div>How Immutability Helps in OOP (in Russian with English subtitles); 21 May 2016.</div></aside><p>An immutable object is not a data structure that doesn&#39;t change, even though <code>String</code>, <code>BigInteger</code>, and <code>URL</code> look like one. An object is immutable if and only if it doesn&#39;t change the coordinates of the real-world entity it represents. In the <code>Page</code> class above, this means that an object of the class, once instantiated, will never change <code>this.uri</code>. It will always point to the same web page, no matter what.</p><p>And the object doesn&#39;t guarantee anything about the behavior of that web page. The page is a dynamic creature of a real world, living its own life. Our object can&#39;t promise anything about the page. The only thing it promises is that it will always stay loyal to that page---it will never forget or change its coordinates.</p><p>Conceptually speaking, immutability means loyalty, that&#39;s all.</p></div></article></div><div class="wrapper"><div class="unprintable"> <hr/><p>If you like this article, you will definitely like these <strong>very relevant</strong> posts too:</p><p><a href='/2014/06/09/objects-should-be-immutable.html'><strong>Objects Should Be Immutable</strong></a> <br/>The article gives arguments about why classes/objects in object-oriented programming have to be immutable, i.e. never modify their encapsulated state</p><p><a href='/2014/12/09/immutable-object-state-and-behavior.html'><strong>How an Immutable Object Can Have State and Behavior?</strong></a> <br/>Object state and behavior are two very different things, and confusing the two often leads to incorrect design.</p><p><a href='/2016/09/07/gradients-of-immutability.html'><strong>Gradients of Immutability</strong></a> <br/>There are a few levels and forms of immutability in object-oriented programming, all of which can be used when they seem appropriate.</p></div></div><div class="disqus" role="complementary"><p class="disqus_hint"> Please, use <a href="https://help.disqus.com/commenting/what-html-tags-are-allowed-within-comments">syntax highlighting</a> in your comments, to make them more readable.</p><div id="disqus_thread" class="disqus-thread"> <a>&nbsp;</a></div><script> var disqus_config = function () { this.page.url = document.location.href.split('?')[0].split('#')[0].replace('https://', 'http://'); this.page.identifier = this.page.url; }; (function() { var d = document, s = d.createElement('script'); s.src = '//yegor256.disqus.com/embed.js'; s.setAttribute('data-timestamp', +new Date()); (d.head || d.body).appendChild(s); })(); </script> <noscript><div><p class="red"> JavaScript is disabled in your browser, that's why you can't see comments under this post.</p></div></noscript></div><div class="wrapper"> <footer class="footer"><p> &copy; <span itemscope="" itemprop="copyrightHolder" itemtype="http://schema.org/Person"> <span itemprop="name">Yegor Bugayenko</span> </span> 2014&ndash;<span itemprop="copyrightYear">2018</span></p></footer></div></section><div class="wrapper unprintable" style="text-align:center;margin-top:2em;"> <a href="http://www.sixnines.io/h/3ba1652f"> <img src="//www.sixnines.io/b/3ba1652f?style=flat" alt="sixnines availability badge"/> </a></div><script src="//code.jquery.com/jquery-1.9.0.min.js"></script> <script src="/js/all.js?a0e0d018c07"></script> <script>var disqus_shortname = 'yegor256';</script> <script id="dsq-count-scr" src="//yegor256.disqus.com/count.js" async="async"></script> <script> (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){ (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o), m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m) })(window,document,'script','//www.google-analytics.com/analytics.js','ga'); ga('create', 'UA-1963507-32', 'auto'); ga('send', 'pageview'); </script> <script> Cd=document;Cr="&"+Math.random();Cp="&s=1"; Cd.cookie="b=b";if(Cd.cookie)Cp+="&c=1"; Cp+="&t="+(new Date()).getTimezoneOffset(); if(self!=top)Cp+="&f=1"; </script> <script> if(navigator.javaEnabled())Cp+="&j=1"; </script> <script> if(typeof(screen)!='undefined')Cp+="&w="+screen.width+"&h="+ screen.height+"&d="+(screen.colorDepth?screen.colorDepth:screen.pixelDepth); </script> <script> Cd.write("<img src='//c.hit.ua/hit?i=95870&g=0&x=2"+Cp+Cr+ "&r="+escape(Cd.referrer)+"&u="+escape(window.location.href)+ "' border='0' wi"+"dth='1' he"+"ight='1'/>"); </script> <script type="application/ld+json"> { "@context": "http://schema.org", "@type": "Person", "name": "Yegor Bugayenko", "url": "http://www.yegor256.com", "sameAs": [ "https://www.facebook.com/yegor256", "https://instagram.com/yegor256", "https://www.linkedin.com/in/yegor256", "https://twitter.com/yegor256", "https://github.com/yegor256", "https://www.pinterest.com/yegor256/" ] } </script> </body> </html> <!DOCTYPE html> <html xmlns="http://www.w3.org/1999/xhtml" lang="en-US" xml:lang="en-US" itemscope="" itemtype="http://schema.org/WebSite"> <head> <meta charset="utf-8"/> <meta name="description" content="How much should an object encapsulate and how much should it receive through its methods? If you encapsulate too little, your level of abstraction it too high. " /> <meta name="keywords" content="encapsulation, good object design, object constructor, object design, object method vs constructor" /> <meta name="viewport" content="width=device-width,minimum-scale=1,initial-scale=1"/> <meta name="google-site-verification" content="JEj_gQr2CPe2QKGw8XdMz0R7VboQIUbX3FlM-lwTq-8" /> <meta name="author" content="Yegor Bugayenko"> <meta name="article:published_time" content="2014-12-15 00:00:00 +0000"> <meta name="og:site_name" content="Yegor Bugayenko"/> <meta name="og:type" content="article" /> <meta name="og:locale" content="en_US" /> <meta name="twitter:account_id" content="4503599630178231" /> <meta name="twitter:creator" content="@yegor256"/> <meta name="twitter:site" content="@yegor256"/> <meta name="twitter:title" property="og:title" content="How Much Your Objects Encapsulate?"/> <meta name="twitter:description" property="og:description" content="How much should an object encapsulate and how much should it receive through its methods? If you encapsulate too little, your level of abstraction it too high. "/> <meta name="twitter:url" property="og:url" content="https://www.yegor256.com/2014/12/15/how-much-your-objects-encapsulate.html"/> <meta name="telegram:channel" content="AAAAAEJFMRzsRTRxM3ec6A"/> <link rel="search" type="application/opensearchdescription+xml" href="/opensearch.xml" title="yegor256" /> <link rel="shortcut icon" href="/favicon.ico?a0e0d018c07"/> <link rel="apple-touch-icon" href="/favicon.ico?a0e0d018c07"/> <link rel="alternate" type="application/rss+xml" title="RSS for yegor256.com" href="https://www.yegor256.com/rss.xml"/> <link rel="stylesheet" href="/css/layout.css?a0e0d018c07"/> <link rel="stylesheet" href="/css/icons.css?a0e0d018c07"/> <link rel="canonical" href="https://www.yegor256.com/2014/12/15/how-much-your-objects-encapsulate.html" /> <link rel="amphtml" href="https://www.yegor256.com/2014/12/15/how-much-your-objects-encapsulate.amp.html" /> <title>How Much Your Objects Encapsulate? </title> <meta name='og:image' content='https://www.yegor256.com/images/2014/12/truman-show-universe.png'/><meta name='twitter:image' content='https://www.yegor256.com/images/2014/12/truman-show-universe.png'/><meta name='og:image:width' content='1200'/> <meta name='twitter:image:width' content='1200'/><meta name='og:image:height' content='675'/> <meta name='twitter:image:height' content='675'/><meta name='twitter:card' content='summary_large_image'/><meta name='twitter:image:alt' content='The Truman Show (1998) by Peter Weir'/> </head> <body><div class="wrapper"> <aside class="header-toggle unprintable" id="header-toggle" title="Show the menu" onclick="$('#header').show();$('#header-toggle').hide();">&#9776;</aside> <header class="header" id="header"><div class="face"> <a href="/about-me.html#form" class="sub" title="Click to subscribe to my monthly newsletter"><span>Subscribe</span></a> <a href="/about-me.html" style="position:relative;"> <img src="/images/face-256x256.jpg" class="photo" alt="Yegor Bugayenko"/> </a></div><nav><ul class="menu social notranslate"> <li><a href="https://twitter.com/intent/follow?screen_name=yegor256" rel="nofollow" title="Follow me on Twitter"><i class="icon icon-twitter notranslate" aria-hidden="true"></i></a></li> <li><a href="/rss.xml" rel="nofollow" title="Subscribe to my RSS feed"><i class="icon icon-rss notranslate" aria-hidden="true"></i></a></li> <li><a itemprop="sameAs" href="https://github.com/yegor256" rel="nofollow" title="My GitHub profile"><i class="icon icon-github notranslate" aria-hidden="true"></i></a></li> <li><a itemprop="sameAs" href="http://stackoverflow.com/users/187141/yegor256" rel="nofollow" title="My StackOverflow profile"><i class="icon icon-stackoverflow notranslate" aria-hidden="true"></i></a></li> <li><a itemprop="sameAs" href="https://www.facebook.com/yegor256" rel="nofollow" title="Follow me on Facebook"><i class="icon icon-facebook notranslate" aria-hidden="true"></i></a></li> <li><a itemprop="sameAs" href="https://instagram.com/yegor256" rel="nofollow" title="Follow me on Instagram"><i class="icon icon-instagram notranslate" aria-hidden="true"></i></a></li> <li><a itemprop="sameAs" href="https://www.linkedin.com/in/yegor256" rel="nofollow" title="My LinkedIn profile"><i class="icon icon-linkedin notranslate" aria-hidden="true"></i></a></li> <li><a itemprop="sameAs" href="https://www.youtube.com/c/yegor256?sub_confirmation=1" rel="nofollow" title="My Youtube video channel"><i class="icon icon-youtube notranslate" aria-hidden="true"></i></a></li> <li><a itemprop="sameAs" href="https://www.pinterest.com/yegor256/" rel="nofollow" title="My Pinterest boards"><i class="icon icon-pinterest notranslate" aria-hidden="true"></i></a></li> <li><a itemprop="sameAs" href="https://angel.co/yegor256" rel="nofollow" title="My AngelList profile"><i class="icon icon-angellist notranslate" aria-hidden="true"></i></a></li> <li><a href="https://soundcloud.com/yegor256" rel="nofollow" title="My podcast"><i class="icon icon-podcast notranslate" aria-hidden="true"></i></a></li> <li><a href="https://itunes.apple.com/us/podcast/yegor256-podcast/id1150826721" rel="nofollow" title="My iTunes podcast"><i class="icon icon-itunes notranslate" aria-hidden="true"></i></a></li> <li><a href="https://t.me/joinchat/AAAAAEJFMRzsRTRxM3ec6A" rel="nofollow" title="My Telegram public channel"><i class="icon icon-telegram notranslate" aria-hidden="true"></i></a></li> <li><a href="mailto:blog@yegor256.com" rel="nofollow" title="Email me any time"><i class="icon icon-mail notranslate" aria-hidden="true"></i></a></li></ul><ul class="menu"> <li><a href="/" title="Home page">Home</a></li> <li ><a href="/best.html" title="Best articles to read">12&#160;Best</a></li> <li ><a href="/contents.html" title="The contents of the entire blog">All&#160;288</a></li> <li ><a href="/webinars.html" title="My webinars">Webinars</a></li> <li ><a href="/talks.html" title="Future and past conference talks">Talks</a></li> <li ><a href="/books.html" title="The books I wrote">Books</a></li> <li ><a href="/papers.html" title="My academic papers and patents">Papers</a></li> <li ><a href="/pets.html" title="My loved pet projects">Pets</a></li> <li ><a href="/award.html" title="Software quality award">Award</a></li> <li ><a href="/testimonials.html" title="What some people say about me">Testimonials</a></li> <li ><a href="/shift-m.html" title="Audio podcast about project management">Shift-M</a></li> <li ><a href="/paintings.html" title="My paintings for sale">Paintings</a></li> <li><a href="http://ru.yegor256.com/" title="Немного на русском языке">По-русски</a></li></ul></nav><div class="search"> <form method="get" action="https://www.google.com/search" itemprop="potentialAction" itemscope="" itemtype="http://schema.org/SearchAction"> <meta itemprop="target" content="https://www.google.com/search?q={q}"/> <input name="sitesearch" value="yegor256.com" type="hidden"/> <input itemprop="query-input" type="text" id="search-query" class="field field-text" required="required" onfocus="$('.google').css('visibility', 'visible');" name="q" placeholder="Search..." autocomplete="off"/> <input type="image" src="/images/google-search-icon.svg" class="google" title="Search via Google" alt="Search via Google"/> </form></div><div class="hot"><ul> <li> <a href="/code-ahead.html">Code Ahead</a> was published on Amazon just a few days ago! It is my new book, a novel about programmers. It explains in details the majority of ideas that stand behind <a href="https://www.zerocracy.com">Zerocracy</a> and <a href="https://www.xdsd.org">XDSD</a>. </li> <li> At <a href="/webinars.html">Webinar #37</a> we will discuss naming problem in OOP, for objects, methods and attributes; join us on <b>September 12</b>, at 11am PST. </li></ul></div></header></div><section itemscope="" itemtype="http://schema.org/BlogPosting"><div class="wrapper"> <header><p class="printable"> <img src="https://api.qrserver.com/v1/create-qr-code/?data=https://www.yegor256.com/2014/12/15/how-much-your-objects-encapsulate.html&amp;format=svg" style="width:125px;height:125px;" alt="QR code"/></p><p class="printable"> <code itemprop="url">https://www.yegor256.com/2014/12/15/how-much-your-objects-encapsulate.html</code></p><h1 itemprop="name headline mainEntityOfPage">How Much Your Objects Encapsulate?</h1><aside class='book'><a href='http://amzn.to/2qFt4Tn'><img src='/images/books/elegant-objects/cover.png' class='book-cover' alt='book cover'/></a>Read more about this subject in <a href='http://amzn.to/2qFt4Tn'>Section&nbsp;2.2</a><br/> of my book<a href='http://amzn.to/2qFt4Tn'><img src='/images/books/amazon-buy-button.png' class='amazon-button' alt='Click to buy'/></a></aside><ul class="subline"> <li> <time itemprop="datePublished" datetime="2014-12-15T00:00:00+00:00"> 15 December 2014 </time> </li> <li class="printable" itemscope="" itemprop="author" itemtype="http://schema.org/Person"> <span itemprop="name">Yegor Bugayenko</span> </li> <li class="unprintable"> <i class="icon icon-comments"></i> <a href="http://www.yegor256.com/2014/12/15/how-much-your-objects-encapsulate.html#disqus_thread" itemprop="discussionUrl">comments</a> </li></ul><p class="unprintable"><p>Which line do you like more, the first or the second:</p><figure class="highlight"><pre><code class="language-java" data-lang="java"><span></span><span class="k">new</span> <span class="n">HTTP</span><span class="o">(</span><span class="s">&quot;http://www.google.com&quot;</span><span class="o">).</span><span class="na">read</span><span class="o">();</span>
<span class="k">new</span> <span class="n">HTTP</span><span class="o">().</span><span class="na">read</span><span class="o">(</span><span class="s">&quot;http://www.google.com&quot;</span><span class="o">);</span></code></pre></figure><p>What is the difference? The first class <code>HTTP</code> encapsulates a URL, while the second one expects it as an argument of method <code>read()</code>. Technically, both objects do exactly the same thing: they read the content of the Google home page. Which one is the right design? Usually I hate to say this, but in this case I have to---it depends.</p><figure class='jb_picture'><img itemprop='image' alt='The Truman Show (1998) by Peter Weir' src='/images/2014/12/truman-show-universe.png' longdesc='#6acb139e'/><figcaption id='6acb139e'>The Truman Show (1998) by Peter Weir</figcaption></figure><p>As <a href="/2014/11/20/seven-virtues-of-good-object.html">we discussed before</a>, a good object is a representative of a real-life entity. Such an entity exists outside of the object&#39;s living environment. The <a href="/2016/07/14/who-is-object.html">object</a> knows how to access it and how to communicate with it.</p><p>What is that real-life entity in the example above? Each class gives its own answer. And the answer is given by the list of arguments its constructors accept. The first class accepts a single URL as an argument of its constructor. This tells us that the object of this class, after being constructed, will represent a web page. The second class accepts no arguments, which tells us that the object of it will represent... the Universe.</p><aside class='quote'>In order to understand what real-life entity an object represents, look at its constructor</aside><p>I think this principle is applicable to all classes in object-oriented programming---in order to understand what real-life entity an object represents, look at its constructor. All arguments passed into the constructor and encapsulated by the object identify a real-life entity accessed and managed by the object.</p><p>Of course, I&#39;m talking about <a href="/2014/11/20/seven-virtues-of-good-object.html">good objects</a>, which are immutable and <a href="/2014/09/16/getters-and-setters-are-evil.html">don&#39;t have setters and getters</a>.</p><p>Pay attention that I&#39;m talking about arguments encapsulated by the object. The following class doesn&#39;t represent the Universe, even though it does have a no-arguments constructor:</p><figure class="highlight"><pre><code class="language-java" data-lang="java"><span></span><span class="kd">class</span> <span class="nc">Time</span> <span class="o">{</span>
  <span class="kd">private</span> <span class="kd">final</span> <span class="kt">long</span> <span class="n">msec</span><span class="o">;</span>
  <span class="kd">public</span> <span class="nf">Time</span><span class="o">()</span> <span class="o">{</span>
    <span class="k">this</span><span class="o">(</span><span class="n">System</span><span class="o">.</span><span class="na">currentTimeMillis</span><span class="o">());</span>
  <span class="o">}</span>
  <span class="kd">public</span> <span class="nf">Time</span><span class="o">(</span><span class="kt">long</span> <span class="n">time</span><span class="o">)</span> <span class="o">{</span>
    <span class="k">this</span><span class="o">.</span><span class="na">msec</span> <span class="o">=</span> <span class="n">time</span><span class="o">;</span>
  <span class="o">}</span>
<span class="o">}</span></code></pre></figure><p>This class has two constructors. One of them is the main one, and one is supplementary. We&#39;re interested in the main one, which implements the <a href="/2016/11/21/naked-data.html"><em>encapsulation</em></a> of arguments.</p><aside class='youtube'> <a href='https://www.youtube.com/watch?v=9yjtsCK6Wdk'><div class='box'> <img src='https://i.ytimg.com/vi/9yjtsCK6Wdk/mqdefault.jpg' alt='YouTube video #9yjtsCK6Wdk'/><div class='play'><i class='icon icon-play'></i></div></div></a><div>A Few Thoughts About Constructors in OOP (webinar #7); 7 October 2015.</div></aside><p>Now, the question is which is better: to represent a web page or the Universe? It depends, but I think that in general, the smaller the real-life entity we represent, the more solid and cohesive design we give to the object.</p><p>On the other hand, sometimes we have to have an object that represents the Universe. For example, we may have this:</p><figure class="highlight"><pre><code class="language-java" data-lang="java"><span></span><span class="kd">class</span> <span class="nc">HTTP</span> <span class="o">{</span>
  <span class="kd">public</span> <span class="n">String</span> <span class="nf">read</span><span class="o">(</span><span class="n">String</span> <span class="n">url</span><span class="o">)</span> <span class="o">{</span>
    <span class="c1">// read via HTTP and return</span>
  <span class="o">}</span>
  <span class="kd">public</span> <span class="kt">boolean</span> <span class="nf">online</span><span class="o">()</span> <span class="o">{</span>
    <span class="c1">// check whether we&#39;re online</span>
  <span class="o">}</span>
<span class="o">}</span></code></pre></figure><p>This is not an elegant design, but it demonstrates when it may be necessary to represent the entire Universe. An object of this <code>HTTP</code> class can read any web page from the entire web (it is almost as big as the Universe, isn&#39;t it?), and it can check whether the entire web is accessible by it. Obviously, in this case, we don&#39;t need it to encapsulate anything.</p><p>I believe that objects representing the Universe are not good objects, mostly because there is only one Universe; why do we need many representatives of it? :)</p></p><nav class="buttons notranslate desktop-only"> <a href="http://www.facebook.com/sharer/sharer.php?u=https://www.yegor256.com/2014/12/15/how-much-your-objects-encapsulate.html" title="Share on Facebook" class="button" rel="nofollow"> <span class="count count-facebook">0</span> <i class="icon icon-facebook notranslate" aria-hidden="true"></i> </a> <a href="https://twitter.com/share?url=https://www.yegor256.com/2014/12/15/how-much-your-objects-encapsulate.html&amp;text=How+Much+Your+Objects+Encapsulate%3F" title="Share on Twitter" class="button" rel="nofollow"> <span class="count count-twitter">0</span> <i class="icon icon-twitter notranslate" aria-hidden="true"></i> </a> <a href="https://plus.google.com/share?url=https://www.yegor256.com/2014/12/15/how-much-your-objects-encapsulate.html" title="Share on Google+" class="button" rel="nofollow"> <span class="count count-googleplus">0</span> <i class="icon icon-googleplus notranslate" aria-hidden="true"></i> </a> <a href="https://www.linkedin.com/cws/share?url=https://www.yegor256.com/2014/12/15/how-much-your-objects-encapsulate.html" title="Share on LinkedIn" class="button" rel="nofollow"> <span class="count count-linkedin">0</span> <i class="icon icon-linkedin notranslate" aria-hidden="true"></i> </a> <a href="http://reddit.com/submit?url=https://www.yegor256.com/2014/12/15/how-much-your-objects-encapsulate.html%3F2014-50&amp;title=How+Much+Your+Objects+Encapsulate%3F" title="Share on Reddit" class="button" rel="nofollow"> <span class="count count-reddit">0</span> <i class="icon icon-reddit notranslate" aria-hidden="true"></i> </a> <a href="http://news.ycombinator.com/submitlink?u=https://www.yegor256.com/2014/12/15/how-much-your-objects-encapsulate.html%3F2014-50&amp;t=How+Much+Your+Objects+Encapsulate%3F" title="Share on Hacker News" class="button" rel="nofollow"> <span class="count count-hackernews">0</span> <i class="icon icon-hackernews notranslate" aria-hidden="true"></i> </a> </nav> </header> <article class="main" itemprop="articleBody"><div ><p>Which line do you like more, the first or the second:</p><figure class="highlight"><pre><code class="language-java" data-lang="java"><span></span><span class="k">new</span> <span class="n">HTTP</span><span class="o">(</span><span class="s">&quot;http://www.google.com&quot;</span><span class="o">).</span><span class="na">read</span><span class="o">();</span>
<span class="k">new</span> <span class="n">HTTP</span><span class="o">().</span><span class="na">read</span><span class="o">(</span><span class="s">&quot;http://www.google.com&quot;</span><span class="o">);</span></code></pre></figure><p>What is the difference? The first class <code>HTTP</code> encapsulates a URL, while the second one expects it as an argument of method <code>read()</code>. Technically, both objects do exactly the same thing: they read the content of the Google home page. Which one is the right design? Usually I hate to say this, but in this case I have to---it depends.</p><figure class='jb_picture'><img itemprop='image' alt='The Truman Show (1998) by Peter Weir' src='/images/2014/12/truman-show-universe.png' longdesc='#6acb139e'/><figcaption id='6acb139e'>The Truman Show (1998) by Peter Weir</figcaption></figure><p>As <a href="/2014/11/20/seven-virtues-of-good-object.html">we discussed before</a>, a good object is a representative of a real-life entity. Such an entity exists outside of the object&#39;s living environment. The <a href="/2016/07/14/who-is-object.html">object</a> knows how to access it and how to communicate with it.</p><p>What is that real-life entity in the example above? Each class gives its own answer. And the answer is given by the list of arguments its constructors accept. The first class accepts a single URL as an argument of its constructor. This tells us that the object of this class, after being constructed, will represent a web page. The second class accepts no arguments, which tells us that the object of it will represent... the Universe.</p><aside class='quote'>In order to understand what real-life entity an object represents, look at its constructor</aside><p>I think this principle is applicable to all classes in object-oriented programming---in order to understand what real-life entity an object represents, look at its constructor. All arguments passed into the constructor and encapsulated by the object identify a real-life entity accessed and managed by the object.</p><p>Of course, I&#39;m talking about <a href="/2014/11/20/seven-virtues-of-good-object.html">good objects</a>, which are immutable and <a href="/2014/09/16/getters-and-setters-are-evil.html">don&#39;t have setters and getters</a>.</p><p>Pay attention that I&#39;m talking about arguments encapsulated by the object. The following class doesn&#39;t represent the Universe, even though it does have a no-arguments constructor:</p><figure class="highlight"><pre><code class="language-java" data-lang="java"><span></span><span class="kd">class</span> <span class="nc">Time</span> <span class="o">{</span>
  <span class="kd">private</span> <span class="kd">final</span> <span class="kt">long</span> <span class="n">msec</span><span class="o">;</span>
  <span class="kd">public</span> <span class="nf">Time</span><span class="o">()</span> <span class="o">{</span>
    <span class="k">this</span><span class="o">(</span><span class="n">System</span><span class="o">.</span><span class="na">currentTimeMillis</span><span class="o">());</span>
  <span class="o">}</span>
  <span class="kd">public</span> <span class="nf">Time</span><span class="o">(</span><span class="kt">long</span> <span class="n">time</span><span class="o">)</span> <span class="o">{</span>
    <span class="k">this</span><span class="o">.</span><span class="na">msec</span> <span class="o">=</span> <span class="n">time</span><span class="o">;</span>
  <span class="o">}</span>
<span class="o">}</span></code></pre></figure><p>This class has two constructors. One of them is the main one, and one is supplementary. We&#39;re interested in the main one, which implements the <a href="/2016/11/21/naked-data.html"><em>encapsulation</em></a> of arguments.</p><aside class='youtube'> <a href='https://www.youtube.com/watch?v=9yjtsCK6Wdk'><div class='box'> <img src='https://i.ytimg.com/vi/9yjtsCK6Wdk/mqdefault.jpg' alt='YouTube video #9yjtsCK6Wdk'/><div class='play'><i class='icon icon-play'></i></div></div></a><div>A Few Thoughts About Constructors in OOP (webinar #7); 7 October 2015.</div></aside><p>Now, the question is which is better: to represent a web page or the Universe? It depends, but I think that in general, the smaller the real-life entity we represent, the more solid and cohesive design we give to the object.</p><p>On the other hand, sometimes we have to have an object that represents the Universe. For example, we may have this:</p><figure class="highlight"><pre><code class="language-java" data-lang="java"><span></span><span class="kd">class</span> <span class="nc">HTTP</span> <span class="o">{</span>
  <span class="kd">public</span> <span class="n">String</span> <span class="nf">read</span><span class="o">(</span><span class="n">String</span> <span class="n">url</span><span class="o">)</span> <span class="o">{</span>
    <span class="c1">// read via HTTP and return</span>
  <span class="o">}</span>
  <span class="kd">public</span> <span class="kt">boolean</span> <span class="nf">online</span><span class="o">()</span> <span class="o">{</span>
    <span class="c1">// check whether we&#39;re online</span>
  <span class="o">}</span>
<span class="o">}</span></code></pre></figure><p>This is not an elegant design, but it demonstrates when it may be necessary to represent the entire Universe. An object of this <code>HTTP</code> class can read any web page from the entire web (it is almost as big as the Universe, isn&#39;t it?), and it can check whether the entire web is accessible by it. Obviously, in this case, we don&#39;t need it to encapsulate anything.</p><p>I believe that objects representing the Universe are not good objects, mostly because there is only one Universe; why do we need many representatives of it? :)</p></div></article></div><div class="wrapper"> <related-posts /></div><div class="disqus" role="complementary"><p class="disqus_hint"> Please, use <a href="https://help.disqus.com/commenting/what-html-tags-are-allowed-within-comments">syntax highlighting</a> in your comments, to make them more readable.</p><div id="disqus_thread" class="disqus-thread"> <a>&nbsp;</a></div><script> var disqus_config = function () { this.page.url = document.location.href.split('?')[0].split('#')[0].replace('https://', 'http://'); this.page.identifier = this.page.url; }; (function() { var d = document, s = d.createElement('script'); s.src = '//yegor256.disqus.com/embed.js'; s.setAttribute('data-timestamp', +new Date()); (d.head || d.body).appendChild(s); })(); </script> <noscript><div><p class="red"> JavaScript is disabled in your browser, that's why you can't see comments under this post.</p></div></noscript></div><div class="wrapper"> <footer class="footer"><p> &copy; <span itemscope="" itemprop="copyrightHolder" itemtype="http://schema.org/Person"> <span itemprop="name">Yegor Bugayenko</span> </span> 2014&ndash;<span itemprop="copyrightYear">2018</span></p></footer></div></section><div class="wrapper unprintable" style="text-align:center;margin-top:2em;"> <a href="http://www.sixnines.io/h/3ba1652f"> <img src="//www.sixnines.io/b/3ba1652f?style=flat" alt="sixnines availability badge"/> </a></div><script src="//code.jquery.com/jquery-1.9.0.min.js"></script> <script src="/js/all.js?a0e0d018c07"></script> <script>var disqus_shortname = 'yegor256';</script> <script id="dsq-count-scr" src="//yegor256.disqus.com/count.js" async="async"></script> <script> (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){ (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o), m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m) })(window,document,'script','//www.google-analytics.com/analytics.js','ga'); ga('create', 'UA-1963507-32', 'auto'); ga('send', 'pageview'); </script> <script> Cd=document;Cr="&"+Math.random();Cp="&s=1"; Cd.cookie="b=b";if(Cd.cookie)Cp+="&c=1"; Cp+="&t="+(new Date()).getTimezoneOffset(); if(self!=top)Cp+="&f=1"; </script> <script> if(navigator.javaEnabled())Cp+="&j=1"; </script> <script> if(typeof(screen)!='undefined')Cp+="&w="+screen.width+"&h="+ screen.height+"&d="+(screen.colorDepth?screen.colorDepth:screen.pixelDepth); </script> <script> Cd.write("<img src='//c.hit.ua/hit?i=95870&g=0&x=2"+Cp+Cr+ "&r="+escape(Cd.referrer)+"&u="+escape(window.location.href)+ "' border='0' wi"+"dth='1' he"+"ight='1'/>"); </script> <script type="application/ld+json"> { "@context": "http://schema.org", "@type": "Person", "name": "Yegor Bugayenko", "url": "http://www.yegor256.com", "sameAs": [ "https://www.facebook.com/yegor256", "https://instagram.com/yegor256", "https://www.linkedin.com/in/yegor256", "https://twitter.com/yegor256", "https://github.com/yegor256", "https://www.pinterest.com/yegor256/" ] } </script> </body> </html> <!DOCTYPE html> <html xmlns="http://www.w3.org/1999/xhtml" lang="en-US" xml:lang="en-US" itemscope="" itemtype="http://schema.org/WebSite"> <head> <meta charset="utf-8"/> <meta name="description" content="Object state and behavior are two very different things, and confusing the two often leads to incorrect design. " /> <meta name="keywords" content="immutable object state, object attributes, object behavior model, object state, object state behavior, object state behavior and methods, object state behavior identity" /> <meta name="viewport" content="width=device-width,minimum-scale=1,initial-scale=1"/> <meta name="google-site-verification" content="JEj_gQr2CPe2QKGw8XdMz0R7VboQIUbX3FlM-lwTq-8" /> <meta name="author" content="Yegor Bugayenko"> <meta name="article:published_time" content="2014-12-09 00:00:00 +0000"> <meta name="og:site_name" content="Yegor Bugayenko"/> <meta name="og:type" content="article" /> <meta name="og:locale" content="en_US" /> <meta name="twitter:account_id" content="4503599630178231" /> <meta name="twitter:creator" content="@yegor256"/> <meta name="twitter:site" content="@yegor256"/> <meta name="twitter:title" property="og:title" content="How an Immutable Object Can Have State and Behavior?"/> <meta name="twitter:description" property="og:description" content="Object state and behavior are two very different things, and confusing the two often leads to incorrect design. "/> <meta name="twitter:url" property="og:url" content="https://www.yegor256.com/2014/12/09/immutable-object-state-and-behavior.html"/> <meta name="telegram:channel" content="AAAAAEJFMRzsRTRxM3ec6A"/> <link rel="search" type="application/opensearchdescription+xml" href="/opensearch.xml" title="yegor256" /> <link rel="shortcut icon" href="/favicon.ico?a0e0d018c07"/> <link rel="apple-touch-icon" href="/favicon.ico?a0e0d018c07"/> <link rel="alternate" type="application/rss+xml" title="RSS for yegor256.com" href="https://www.yegor256.com/rss.xml"/> <link rel="stylesheet" href="/css/layout.css?a0e0d018c07"/> <link rel="stylesheet" href="/css/icons.css?a0e0d018c07"/> <link rel="canonical" href="https://www.yegor256.com/2014/12/09/immutable-object-state-and-behavior.html" /> <link rel="amphtml" href="https://www.yegor256.com/2014/12/09/immutable-object-state-and-behavior.amp.html" /> <title>How an Immutable Object Can Have State and Behavior? </title> <meta name='og:image' content='https://www.yegor256.com/images/2014/12/once-upon-a-time-in-the-west.png'/><meta name='twitter:image' content='https://www.yegor256.com/images/2014/12/once-upon-a-time-in-the-west.png'/><meta name='og:image:width' content='1300'/> <meta name='twitter:image:width' content='1300'/><meta name='og:image:height' content='578'/> <meta name='twitter:image:height' content='578'/><meta name='twitter:card' content='summary_large_image'/><meta name='twitter:image:alt' content='Once Upon a Time in the West (1968) by Sergio Leone'/> </head> <body><div class="wrapper"> <aside class="header-toggle unprintable" id="header-toggle" title="Show the menu" onclick="$('#header').show();$('#header-toggle').hide();">&#9776;</aside> <header class="header" id="header"><div class="face"> <a href="/about-me.html#form" class="sub" title="Click to subscribe to my monthly newsletter"><span>Subscribe</span></a> <a href="/about-me.html" style="position:relative;"> <img src="/images/face-256x256.jpg" class="photo" alt="Yegor Bugayenko"/> </a></div><nav><ul class="menu social notranslate"> <li><a href="https://twitter.com/intent/follow?screen_name=yegor256" rel="nofollow" title="Follow me on Twitter"><i class="icon icon-twitter notranslate" aria-hidden="true"></i></a></li> <li><a href="/rss.xml" rel="nofollow" title="Subscribe to my RSS feed"><i class="icon icon-rss notranslate" aria-hidden="true"></i></a></li> <li><a itemprop="sameAs" href="https://github.com/yegor256" rel="nofollow" title="My GitHub profile"><i class="icon icon-github notranslate" aria-hidden="true"></i></a></li> <li><a itemprop="sameAs" href="http://stackoverflow.com/users/187141/yegor256" rel="nofollow" title="My StackOverflow profile"><i class="icon icon-stackoverflow notranslate" aria-hidden="true"></i></a></li> <li><a itemprop="sameAs" href="https://www.facebook.com/yegor256" rel="nofollow" title="Follow me on Facebook"><i class="icon icon-facebook notranslate" aria-hidden="true"></i></a></li> <li><a itemprop="sameAs" href="https://instagram.com/yegor256" rel="nofollow" title="Follow me on Instagram"><i class="icon icon-instagram notranslate" aria-hidden="true"></i></a></li> <li><a itemprop="sameAs" href="https://www.linkedin.com/in/yegor256" rel="nofollow" title="My LinkedIn profile"><i class="icon icon-linkedin notranslate" aria-hidden="true"></i></a></li> <li><a itemprop="sameAs" href="https://www.youtube.com/c/yegor256?sub_confirmation=1" rel="nofollow" title="My Youtube video channel"><i class="icon icon-youtube notranslate" aria-hidden="true"></i></a></li> <li><a itemprop="sameAs" href="https://www.pinterest.com/yegor256/" rel="nofollow" title="My Pinterest boards"><i class="icon icon-pinterest notranslate" aria-hidden="true"></i></a></li> <li><a itemprop="sameAs" href="https://angel.co/yegor256" rel="nofollow" title="My AngelList profile"><i class="icon icon-angellist notranslate" aria-hidden="true"></i></a></li> <li><a href="https://soundcloud.com/yegor256" rel="nofollow" title="My podcast"><i class="icon icon-podcast notranslate" aria-hidden="true"></i></a></li> <li><a href="https://itunes.apple.com/us/podcast/yegor256-podcast/id1150826721" rel="nofollow" title="My iTunes podcast"><i class="icon icon-itunes notranslate" aria-hidden="true"></i></a></li> <li><a href="https://t.me/joinchat/AAAAAEJFMRzsRTRxM3ec6A" rel="nofollow" title="My Telegram public channel"><i class="icon icon-telegram notranslate" aria-hidden="true"></i></a></li> <li><a href="mailto:blog@yegor256.com" rel="nofollow" title="Email me any time"><i class="icon icon-mail notranslate" aria-hidden="true"></i></a></li></ul><ul class="menu"> <li><a href="/" title="Home page">Home</a></li> <li ><a href="/best.html" title="Best articles to read">12&#160;Best</a></li> <li ><a href="/contents.html" title="The contents of the entire blog">All&#160;288</a></li> <li ><a href="/webinars.html" title="My webinars">Webinars</a></li> <li ><a href="/talks.html" title="Future and past conference talks">Talks</a></li> <li ><a href="/books.html" title="The books I wrote">Books</a></li> <li ><a href="/papers.html" title="My academic papers and patents">Papers</a></li> <li ><a href="/pets.html" title="My loved pet projects">Pets</a></li> <li ><a href="/award.html" title="Software quality award">Award</a></li> <li ><a href="/testimonials.html" title="What some people say about me">Testimonials</a></li> <li ><a href="/shift-m.html" title="Audio podcast about project management">Shift-M</a></li> <li ><a href="/paintings.html" title="My paintings for sale">Paintings</a></li> <li><a href="http://ru.yegor256.com/" title="Немного на русском языке">По-русски</a></li></ul></nav><div class="search"> <form method="get" action="https://www.google.com/search" itemprop="potentialAction" itemscope="" itemtype="http://schema.org/SearchAction"> <meta itemprop="target" content="https://www.google.com/search?q={q}"/> <input name="sitesearch" value="yegor256.com" type="hidden"/> <input itemprop="query-input" type="text" id="search-query" class="field field-text" required="required" onfocus="$('.google').css('visibility', 'visible');" name="q" placeholder="Search..." autocomplete="off"/> <input type="image" src="/images/google-search-icon.svg" class="google" title="Search via Google" alt="Search via Google"/> </form></div><div class="hot"><ul> <li> <a href="/code-ahead.html">Code Ahead</a> was published on Amazon just a few days ago! It is my new book, a novel about programmers. It explains in details the majority of ideas that stand behind <a href="https://www.zerocracy.com">Zerocracy</a> and <a href="https://www.xdsd.org">XDSD</a>. </li> <li> At <a href="/webinars.html">Webinar #37</a> we will discuss naming problem in OOP, for objects, methods and attributes; join us on <b>September 12</b>, at 11am PST. </li></ul></div></header></div><section itemscope="" itemtype="http://schema.org/BlogPosting"><div class="wrapper"> <header><p class="printable"> <img src="https://api.qrserver.com/v1/create-qr-code/?data=https://www.yegor256.com/2014/12/09/immutable-object-state-and-behavior.html&amp;format=svg" style="width:125px;height:125px;" alt="QR code"/></p><p class="printable"> <code itemprop="url">https://www.yegor256.com/2014/12/09/immutable-object-state-and-behavior.html</code></p><h1 itemprop="name headline mainEntityOfPage">How an Immutable Object Can Have State and Behavior?</h1><ul class="subline"> <li> <time itemprop="datePublished" datetime="2014-12-09T00:00:00+00:00"> 9 December 2014 </time> </li> <li class="printable" itemscope="" itemprop="author" itemtype="http://schema.org/Person"> <span itemprop="name">Yegor Bugayenko</span> </li> <li class="unprintable"> <i class="icon icon-comments"></i> <a href="http://www.yegor256.com/2014/12/09/immutable-object-state-and-behavior.html#disqus_thread" itemprop="discussionUrl">comments</a> </li></ul><ul class="subline"> <li>Discussed at:</li> <li><a href="https://www.reddit.com/r/programming/comments/2oqi6h/how_an_immutable_object_can_have_state_and/">reddit</a></li></ul><p class="unprintable"><p>I often hear this argument against <a href="/2014/06/09/objects-should-be-immutable.html">immutable objects</a>: &quot;Yes, they are useful when the state doesn&#39;t change. However, in our case, we deal with frequently changing objects. We simply can&#39;t afford to create a new <code>document</code> every time we just need to change its <code>title</code>.&quot; Here is where I disagree: object title is <strong>not a state</strong> of a document, if you need to change it frequently. Instead, it is a document&#39;s <strong>behavior</strong>. A <code>document</code> can and must be <a href="/2016/09/07/gradients-of-immutability.html">immutable</a>, if it is a <a href="/2014/11/20/seven-virtues-of-good-object.html">good object</a>, even when its title is changed frequently. Let me explain how.</p><figure class='jb_picture'><img itemprop='image' alt='Once Upon a Time in the West (1968) by Sergio Leone' src='/images/2014/12/once-upon-a-time-in-the-west.png' longdesc='#e87f3523'/><figcaption id='e87f3523'>Once Upon a Time in the West (1968) by Sergio Leone</figcaption></figure><h2 id="identity-state-and-behavior">Identity, State, and Behavior</h2><p>Basically, there are three elements in every <a href="/2016/07/14/who-is-object.html">object</a>: identity, state, and behavior. <em>Identity</em> is what distinguishes our <code>document</code> from other objects, <em>state</em> is what a document knows about itself (a.k.a. &quot;encapsulated knowledge&quot;), and <em>behavior</em> is what a document can do for us on request. For example, this is a mutable document:</p><figure class="highlight"><pre><code class="language-java" data-lang="java"><span></span><span class="kd">class</span> <span class="nc">Document</span> <span class="o">{</span>
  <span class="kd">private</span> <span class="kt">int</span> <span class="n">id</span><span class="o">;</span>
  <span class="kd">private</span> <span class="n">String</span> <span class="n">title</span><span class="o">;</span>
  <span class="n">Document</span><span class="o">(</span><span class="kt">int</span> <span class="n">id</span><span class="o">)</span> <span class="o">{</span>
    <span class="k">this</span><span class="o">.</span><span class="na">id</span> <span class="o">=</span> <span class="n">id</span><span class="o">;</span>
  <span class="o">}</span>
  <span class="kd">public</span> <span class="n">String</span> <span class="nf">getTitle</span><span class="o">()</span> <span class="o">{</span>
    <span class="k">return</span> <span class="k">this</span><span class="o">.</span><span class="na">title</span><span class="o">;</span>
  <span class="o">}</span>
  <span class="kd">public</span> <span class="n">String</span> <span class="nf">setTitle</span><span class="o">(</span><span class="n">String</span> <span class="n">text</span><span class="o">)</span> <span class="o">{</span>
    <span class="k">this</span><span class="o">.</span><span class="na">title</span> <span class="o">=</span> <span class="n">text</span><span class="o">;</span>
  <span class="o">}</span>
  <span class="nd">@Override</span>
  <span class="kd">public</span> <span class="n">String</span> <span class="nf">toString</span><span class="o">()</span> <span class="o">{</span>
    <span class="k">return</span> <span class="n">String</span><span class="o">.</span><span class="na">format</span><span class="o">(</span><span class="s">&quot;doc #%d about &#39;%s&#39;&quot;</span><span class="o">,</span> <span class="k">this</span><span class="o">.</span><span class="na">id</span><span class="o">,</span> <span class="k">this</span><span class="o">.</span><span class="na">text</span><span class="o">);</span>
  <span class="o">}</span>
<span class="o">}</span></code></pre></figure><p>Let&#39;s try to use this mutable object:</p><figure class="highlight"><pre><code class="language-java" data-lang="java"><span></span><span class="n">Document</span> <span class="n">first</span> <span class="o">=</span> <span class="k">new</span> <span class="n">Document</span><span class="o">(</span><span class="mi">50</span><span class="o">);</span>
<span class="n">first</span><span class="o">.</span><span class="na">setTitle</span><span class="o">(</span><span class="s">&quot;How to grill a sandwich&quot;</span><span class="o">);</span>
<span class="n">Document</span> <span class="n">second</span> <span class="o">=</span> <span class="k">new</span> <span class="n">Document</span><span class="o">(</span><span class="mi">50</span><span class="o">);</span>
<span class="n">second</span><span class="o">.</span><span class="na">setTitle</span><span class="o">(</span><span class="s">&quot;How to grill a sandwich&quot;</span><span class="o">);</span>
<span class="k">if</span> <span class="o">(</span><span class="n">first</span><span class="o">.</span><span class="na">equals</span><span class="o">(</span><span class="n">second</span><span class="o">))</span> <span class="o">{</span> <span class="c1">// FALSE</span>
  <span class="n">System</span><span class="o">.</span><span class="na">out</span><span class="o">.</span><span class="na">println</span><span class="o">(</span>
    <span class="n">String</span><span class="o">.</span><span class="na">format</span><span class="o">(</span><span class="s">&quot;%s is equal to %s&quot;</span><span class="o">,</span> <span class="n">first</span><span class="o">,</span> <span class="n">second</span><span class="o">)</span>
  <span class="o">);</span>
<span class="o">}</span></code></pre></figure><p>Here, we&#39;re creating two objects and then modifying their encapsulated states. Obviously, <code>first.equals(second)</code> will return <code>false</code> because the two objects have different identities, even though they encapsulate the same state.</p><aside class='youtube'> <a href='https://www.youtube.com/watch?v=KwP7Ay9Z-hc'><div class='box'> <img src='https://i.ytimg.com/vi/KwP7Ay9Z-hc/mqdefault.jpg' alt='YouTube video #KwP7Ay9Z-hc'/><div class='play'><i class='icon icon-play'></i></div></div></a><div>Immutable Objects vs. Common Sense (webinar #2); 6 May 2015.</div></aside><p>Method <code>toString()</code> exposes the document&#39;s behavior---the document can convert itself to a string.</p><p>In order to modify a document&#39;s title, we just call its <code>setTitle()</code> once again:</p><figure class="highlight"><pre><code class="language-java" data-lang="java"><span></span><span class="n">first</span><span class="o">.</span><span class="na">setTitle</span><span class="o">(</span><span class="s">&quot;How to cook pasta&quot;</span><span class="o">);</span></code></pre></figure><p>Simply put, we can reuse the object many times, modifying its internal state. It is fast and convenient, isn&#39;t it? Fast, yes. Convenient, not really. Read on.</p><h2 id="immutable-objects-have-no-identity">Immutable Objects Have No Identity</h2><p>As I&#39;ve <a href="/2014/11/20/seven-virtues-of-good-object.html">mentioned before</a>, immutability is one of the virtues of a good object, and a very important one. A good object is immutable, and good software contains only immutable objects. The main difference between immutable and mutable objects is that an immutable one doesn&#39;t have an identity and its state never changes. Here is an immutable variant of the same document:</p><figure class="highlight"><pre><code class="language-java" data-lang="java"><span></span><span class="nd">@Immutable</span>
<span class="kd">class</span> <span class="nc">Document</span> <span class="o">{</span>
  <span class="kd">private</span> <span class="kd">final</span> <span class="kt">int</span> <span class="n">id</span><span class="o">;</span>
  <span class="kd">private</span> <span class="kd">final</span> <span class="n">String</span> <span class="n">title</span><span class="o">;</span>
  <span class="n">Document</span><span class="o">(</span><span class="kt">int</span> <span class="n">id</span><span class="o">,</span> <span class="n">String</span> <span class="n">text</span><span class="o">)</span> <span class="o">{</span>
    <span class="k">this</span><span class="o">.</span><span class="na">id</span> <span class="o">=</span> <span class="n">id</span><span class="o">;</span>
    <span class="k">this</span><span class="o">.</span><span class="na">title</span> <span class="o">=</span> <span class="n">text</span><span class="o">;</span>
  <span class="o">}</span>
  <span class="kd">public</span> <span class="n">String</span> <span class="nf">title</span><span class="o">()</span> <span class="o">{</span>
    <span class="k">return</span> <span class="k">this</span><span class="o">.</span><span class="na">title</span><span class="o">;</span>
  <span class="o">}</span>
  <span class="kd">public</span> <span class="n">Document</span> <span class="nf">title</span><span class="o">(</span><span class="n">String</span> <span class="n">text</span><span class="o">)</span> <span class="o">{</span>
    <span class="k">return</span> <span class="k">new</span> <span class="n">Document</span><span class="o">(</span><span class="k">this</span><span class="o">.</span><span class="na">id</span><span class="o">,</span> <span class="n">text</span><span class="o">);</span>
  <span class="o">}</span>
  <span class="nd">@Override</span>
  <span class="kd">public</span> <span class="kt">boolean</span> <span class="nf">equals</span><span class="o">(</span><span class="n">Object</span> <span class="n">doc</span><span class="o">)</span> <span class="o">{</span>
    <span class="k">return</span> <span class="n">doc</span> <span class="k">instanceof</span> <span class="n">Document</span>
      <span class="o">&amp;&amp;</span> <span class="n">Document</span><span class="o">.</span><span class="na">class</span><span class="o">.</span><span class="na">cast</span><span class="o">(</span><span class="n">doc</span><span class="o">).</span><span class="na">id</span> <span class="o">==</span> <span class="k">this</span><span class="o">.</span><span class="na">id</span>
      <span class="o">&amp;&amp;</span> <span class="n">Document</span><span class="o">.</span><span class="na">class</span><span class="o">.</span><span class="na">cast</span><span class="o">(</span><span class="n">doc</span><span class="o">).</span><span class="na">title</span><span class="o">.</span><span class="na">equals</span><span class="o">(</span><span class="k">this</span><span class="o">.</span><span class="na">title</span><span class="o">);</span>
  <span class="o">}</span>
  <span class="nd">@Override</span>
  <span class="kd">public</span> <span class="n">String</span> <span class="nf">toString</span><span class="o">()</span> <span class="o">{</span>
    <span class="k">return</span> <span class="n">String</span><span class="o">.</span><span class="na">format</span><span class="o">(</span>
      <span class="s">&quot;doc #%d about &#39;%s&#39;&quot;</span><span class="o">,</span> <span class="k">this</span><span class="o">.</span><span class="na">id</span><span class="o">,</span> <span class="k">this</span><span class="o">.</span><span class="na">text</span>
    <span class="o">);</span>
  <span class="o">}</span>
<span class="o">}</span></code></pre></figure><p>This document is immutable, and its state (<code>id</code> ad <code>title</code>) is its identity. Let&#39;s see how we can use this immutable class (by the way, I&#39;m using <a href="http://aspects.jcabi.com/annotation-immutable.html"><code>@Immutable</code></a> annotation from <a href="http://aspects.jcabi.com">jcabi-aspects</a>):</p><figure class="highlight"><pre><code class="language-java" data-lang="java"><span></span><span class="n">Document</span> <span class="n">first</span> <span class="o">=</span> <span class="k">new</span> <span class="n">Document</span><span class="o">(</span><span class="mi">50</span><span class="o">,</span> <span class="s">&quot;How to grill a sandwich&quot;</span><span class="o">);</span>
<span class="n">Document</span> <span class="n">second</span> <span class="o">=</span> <span class="k">new</span> <span class="n">Document</span><span class="o">(</span><span class="mi">50</span><span class="o">,</span> <span class="s">&quot;How to grill a sandwich&quot;</span><span class="o">);</span>
<span class="k">if</span> <span class="o">(</span><span class="n">first</span><span class="o">.</span><span class="na">equals</span><span class="o">(</span><span class="n">second</span><span class="o">))</span> <span class="o">{</span> <span class="c1">// TRUE</span>
  <span class="n">System</span><span class="o">.</span><span class="na">out</span><span class="o">.</span><span class="na">println</span><span class="o">(</span>
    <span class="n">String</span><span class="o">.</span><span class="na">format</span><span class="o">(</span><span class="s">&quot;%s is equal to %s&quot;</span><span class="o">,</span> <span class="n">first</span><span class="o">,</span> <span class="n">second</span><span class="o">)</span>
  <span class="o">);</span>
<span class="o">}</span></code></pre></figure><p>We can&#39;t modify a document any more. When we need to change the title, we have to create a new document:</p><figure class="highlight"><pre><code class="language-java" data-lang="java"><span></span><span class="n">Document</span> <span class="n">first</span> <span class="o">=</span> <span class="k">new</span> <span class="n">Document</span><span class="o">(</span><span class="mi">50</span><span class="o">,</span> <span class="s">&quot;How to grill a sandwich&quot;</span><span class="o">);</span>
<span class="n">first</span> <span class="o">=</span> <span class="n">first</span><span class="o">.</span><span class="na">title</span><span class="o">(</span><span class="s">&quot;How to cook pasta&quot;</span><span class="o">);</span></code></pre></figure><p>Every time we want to modify its encapsulated state, we have to modify its identity too, because there is no identity. State is the identity. Look at the code of the <code>equals()</code> method above---it compares documents by their IDs and titles. Now ID+title of a document is its identity!</p><h2 id="what-about-frequent-changes">What About Frequent Changes?</h2><p>Now I&#39;m getting to the question we started with: What about performance and convenience? We don&#39;t want to change the entire document every time we have to modify its title. If the document is big enough, that would be a huge obligation. Moreover, if an immutable object encapsulates other immutable objects, we have to change the entire hierarchy when modifying even a single string in one of them.</p><aside class='youtube'> <a href='https://www.youtube.com/watch?v=EnhRgXrHCC4'><div class='box'> <img src='https://i.ytimg.com/vi/EnhRgXrHCC4/mqdefault.jpg' alt='YouTube video #EnhRgXrHCC4'/><div class='play'><i class='icon icon-play'></i></div></div></a><div>How Immutability Helps in OOP (in Russian with English subtitles); 21 May 2016.</div></aside><p>The answer is simple. A document&#39;s title should not be part of its <strong>state</strong>. Instead, the title should be its <strong>behavior</strong>. For example, consider this:</p><figure class="highlight"><pre><code class="language-java" data-lang="java"><span></span><span class="nd">@Immutable</span>
<span class="kd">class</span> <span class="nc">Document</span> <span class="o">{</span>
  <span class="kd">private</span> <span class="kd">final</span> <span class="kt">int</span> <span class="n">id</span><span class="o">;</span>
  <span class="n">Document</span><span class="o">(</span><span class="kt">int</span> <span class="n">id</span><span class="o">)</span> <span class="o">{</span>
    <span class="k">this</span><span class="o">.</span><span class="na">id</span> <span class="o">=</span> <span class="n">id</span><span class="o">;</span>
  <span class="o">}</span>
  <span class="kd">public</span> <span class="n">String</span> <span class="nf">title</span><span class="o">()</span> <span class="o">{</span>
    <span class="c1">// read title from storage</span>
  <span class="o">}</span>
  <span class="kd">public</span> <span class="kt">void</span> <span class="nf">title</span><span class="o">(</span><span class="n">String</span> <span class="n">text</span><span class="o">)</span> <span class="o">{</span>
    <span class="c1">// save text to storage</span>
  <span class="o">}</span>
  <span class="nd">@Override</span>
  <span class="kd">public</span> <span class="kt">boolean</span> <span class="nf">equals</span><span class="o">(</span><span class="n">Object</span> <span class="n">doc</span><span class="o">)</span> <span class="o">{</span>
    <span class="k">return</span> <span class="n">doc</span> <span class="k">instanceof</span> <span class="n">Document</span>
      <span class="o">&amp;&amp;</span> <span class="n">Document</span><span class="o">.</span><span class="na">class</span><span class="o">.</span><span class="na">cast</span><span class="o">(</span><span class="n">doc</span><span class="o">).</span><span class="na">id</span> <span class="o">==</span> <span class="k">this</span><span class="o">.</span><span class="na">id</span><span class="o">;</span>
  <span class="o">}</span>
  <span class="nd">@Override</span>
  <span class="kd">public</span> <span class="n">String</span> <span class="nf">toString</span><span class="o">()</span> <span class="o">{</span>
    <span class="k">return</span> <span class="n">String</span><span class="o">.</span><span class="na">format</span><span class="o">(</span><span class="s">&quot;doc #%d about &#39;%s&#39;&quot;</span><span class="o">,</span> <span class="k">this</span><span class="o">.</span><span class="na">id</span><span class="o">,</span> <span class="k">this</span><span class="o">.</span><span class="na">title</span><span class="o">());</span>
  <span class="o">}</span>
<span class="o">}</span></code></pre></figure><p>Conceptually speaking, this document is acting as a proxy of a real-life document that has a title stored somewhere---in a file, for example. This is what a good object should do---be a proxy of a real-life entity. The document exposes two features: reading the title and saving the title. Here is how its <a href="/2016/04/26/why-inputstream-design-is-wrong.html">interface</a> would look like:</p><figure class="highlight"><pre><code class="language-java" data-lang="java"><span></span><span class="nd">@Immutable</span>
<span class="kd">interface</span> <span class="nc">Document</span> <span class="o">{</span>
  <span class="n">String</span> <span class="nf">title</span><span class="o">();</span>
  <span class="kt">void</span> <span class="nf">title</span><span class="o">(</span><span class="n">String</span> <span class="n">text</span><span class="o">);</span>
<span class="o">}</span></code></pre></figure><p><code>title()</code> reads the title of the document and returns it as a <code>String</code>, and <code>title(String)</code> saves it back into the document. Imagine a real paper document with a title. You ask an object to read that title from the paper or to erase an existing one and write new text over it. This paper is a &quot;copy&quot; utilized in these methods.</p><p>Now we can make frequent changes to the immutable document, and the document stays the same. It doesn&#39;t stop being immutable, since it&#39;s state (<code>id</code>) is not changed. It is the same document, even though we change its title, because the title is not a state of the document. It is something in the real world, outside of the document. The document is just a proxy between us and that &quot;something.&quot; Reading and writing the title <em>are behaviors</em> of the document, not its state.</p><h2 id="mutable-memory">Mutable Memory</h2><p>The only question we still have unanswered is what is that &quot;copy&quot; and what happens if we need to keep the title of the document in memory?</p><p>Let&#39;s look at it from an &quot;object thinking&quot; point of view. We have a <code>document</code> object, which <a href="/2014/11/20/seven-virtues-of-good-object.html">is supposed to represent</a> a real-life entity in an object-oriented world. If such an entity is a file, we can easily implement <code>title()</code> methods. If such an entity is an Amazon S3 object, we also implement title reading and writing methods easily, keeping the object immutable. If such an entity is an HTTP page, we have no issues in the implementation of title reading or writing, keeping the object immutable. We have no issues as long as a real-world document exists and has its own identity. Our title reading and writing methods will communicate with that real-world document and extract or update its title.</p><aside class='youtube'> <a href='https://www.youtube.com/watch?v=p7m7_iiqaHI'><div class='box'> <img src='https://i.ytimg.com/vi/p7m7_iiqaHI/mqdefault.jpg' alt='YouTube video #p7m7_iiqaHI'/><div class='play'><i class='icon icon-play'></i></div></div></a><div>How Much Immutability Is Enough?; 19 May 2016.</div></aside><p>Problems arise when such an entity doesn&#39;t exist in a real world. In that case, we need to create a mutable object property called <code>title</code>, read it via <code>title()</code>, and modify it via <code>title(String)</code>. But an object is immutable, so we can&#39;t have a mutable property in it---by definition! What do we do?</p><p>Think.</p><p>How could it be that our object doesn&#39;t represent a real-world entity? Remember, the <em>real world</em> is everything around the living environment of an object. Is it possible that an object doesn&#39;t represent anyone and acts on its own? No, it&#39;s not possible. Every object is a representative of a real-world entity. So, who does it represent if we want to keep <code>title</code> inside it and we don&#39;t have any file or HTTP page behind the object?</p><figure class='badge'><img src='https://www.yegor256.com/images/2014/12/memory-stick.png' style='width:200px;max-width:100%;' alt='badge'/></figure><p>It represents <em>computer memory</em>.</p><p>The title of immutable document #50, &quot;How to grill a sandwich,&quot; is stored in the memory, taking up 23 bytes of space. The document should know where those bytes are stored, and it should be able to read them and replace them with something else. Those 23 bytes are the real-world entity that the object represents. The bytes have nothing to do with the state of the object. They are a <em>mutable</em> real-world entity, similar to a file, HTTP page, or an Amazon S3 object.</p><p>Unfortunately, Java (and many other modern languages) do not allow direct access to computer memory. This is how we would design our class if such direct access was possible:</p><figure class="highlight"><pre><code class="language-java" data-lang="java"><span></span><span class="nd">@Immutable</span>
<span class="kd">class</span> <span class="nc">Document</span> <span class="o">{</span>
  <span class="kd">private</span> <span class="kd">final</span> <span class="kt">int</span> <span class="n">id</span><span class="o">;</span>
  <span class="kd">private</span> <span class="kd">final</span> <span class="n">Memory</span> <span class="n">memory</span><span class="o">;</span>
  <span class="n">Document</span><span class="o">(</span><span class="kt">int</span> <span class="n">id</span><span class="o">)</span> <span class="o">{</span>
    <span class="k">this</span><span class="o">.</span><span class="na">id</span> <span class="o">=</span> <span class="n">id</span><span class="o">;</span>
    <span class="k">this</span><span class="o">.</span><span class="na">memory</span> <span class="o">=</span> <span class="k">new</span> <span class="n">Memory</span><span class="o">();</span>
  <span class="o">}</span>
  <span class="kd">public</span> <span class="n">String</span> <span class="nf">title</span><span class="o">()</span> <span class="o">{</span>
    <span class="k">return</span> <span class="k">new</span> <span class="n">String</span><span class="o">(</span><span class="k">this</span><span class="o">.</span><span class="na">memory</span><span class="o">.</span><span class="na">read</span><span class="o">());</span>
  <span class="o">}</span>
  <span class="kd">public</span> <span class="kt">void</span> <span class="nf">title</span><span class="o">(</span><span class="n">String</span> <span class="n">text</span><span class="o">)</span> <span class="o">{</span>
    <span class="k">this</span><span class="o">.</span><span class="na">memory</span><span class="o">.</span><span class="na">write</span><span class="o">(</span><span class="n">text</span><span class="o">.</span><span class="na">getBytes</span><span class="o">());</span>
  <span class="o">}</span>
<span class="o">}</span></code></pre></figure><p>That <code>Memory</code> class would be implemented by JDK natively, and all other classes would be immutable. The class <code>Memory</code> would have direct access to the memory heap and would be responsible for <a href="https://en.wikipedia.org/wiki/C_dynamic_memory_allocation"><code>malloc</code> and <code>free</code></a> operations on the operating system level. Having such a class would allow us to make all Java classes immutable, including <code>StringBuffer</code>, <code>ByteArrayOutputStream</code>, etc.</p><aside class='quote'>The role of an object is to make a piece of data alive, to animate it but not to become a piece of data</aside><p>The <code>Memory</code> class would explicitly emphasize the mission of an object in a software program, which is to be a <em>data animator</em>. An object is not holding data; it is animating it. The data exists somewhere, and it is <a href="/2016/07/06/data-transfer-object.html">anemic</a>, static, motionless, stationary, etc. The data is <strong>dead</strong> while the object is <strong>alive</strong>. The role of an object is to make a piece of data alive, to <em>animate</em> it but not to become a piece of data. An object needs some knowledge in order to gain access to that dead piece of data. An object may need a database unique key, an HTTP address, a file name, or a memory address in order to find the data and animate it. But an object should never think of itself as data.</p><h2 id="what-is-the-practical-solution">What Is the Practical Solution?</h2><aside class='youtube'> <a href='https://www.youtube.com/watch?v=PVvLQGnyDrQ'><div class='box'> <img src='https://i.ytimg.com/vi/PVvLQGnyDrQ/mqdefault.jpg' alt='YouTube video #PVvLQGnyDrQ'/><div class='play'><i class='icon icon-play'></i></div></div></a><div>Gradients of Immutability (webinar #20); 11 January 2017.</div></aside><p>Unfortunately, we don&#39;t have such a memory-representing class in Java, Ruby, JavaScript, Python, PHP, and many other high-level languages. It looks like language designers didn&#39;t get the idea of alive objects vs. dead data, which is sad. We&#39;re forced to mix data with object states using the same language constructs: object variables and properties. Maybe someday we&#39;ll have that <code>Memory</code> class in Java and other languages, but until then, we have a few options.</p><p><strong>Use C++</strong>. In C++ and similar low-level languages, it is possible to access memory directly and deal with in-memory data the same way we deal with in-file or in-HTTP data. In C++, we can create that <code>Memory</code> class and use it exactly the way we explained above.</p><p><strong>Use Arrays</strong>. In Java, an array is a data structure with a unique property---it can be modified while being declared as <code>final</code>. You can use an array of bytes as a mutable data structure inside an immutable object. It&#39;s a surrogate solution that conceptually resembles the <code>Memory</code> class but is much more primitive.</p><aside class='quote'>A good object is an immutable animator of mutable data</aside><p><strong>Avoid In-Memory Data</strong>. Try to avoid in-memory data as much as possible. In some domains, it is easy to do; for example, in web apps, file processing, I/O adapters, etc. However, in other domains, it is much easier said than done. For example, in games, data manipulation algorithms, and GUI, most of the objects animate in-memory data mostly because memory is the only resource they have. In that case, without the <code>Memory</code> class, you end up with mutable objects :( There is no workaround.</p><p>To summarize, don&#39;t forget that an object is an <strong>animator</strong> of data. It is using its encapsulated knowledge in order to reach the data. No matter where the data is stored---in a file, in HTTP, or in memory---it is conceptually very different from an object state, even though they may look very similar.</p><p>A good object is an immutable animator of mutable data. Even though it is immutable and data is mutable, it is alive and data is dead in the scope of the object&#39;s living environment.</p></p><nav class="buttons notranslate desktop-only"> <a href="http://www.facebook.com/sharer/sharer.php?u=https://www.yegor256.com/2014/12/09/immutable-object-state-and-behavior.html" title="Share on Facebook" class="button" rel="nofollow"> <span class="count count-facebook">0</span> <i class="icon icon-facebook notranslate" aria-hidden="true"></i> </a> <a href="https://twitter.com/share?url=https://www.yegor256.com/2014/12/09/immutable-object-state-and-behavior.html&amp;text=How+an+Immutable+Object+Can+Have+State+and+Behavior%3F" title="Share on Twitter" class="button" rel="nofollow"> <span class="count count-twitter">0</span> <i class="icon icon-twitter notranslate" aria-hidden="true"></i> </a> <a href="https://plus.google.com/share?url=https://www.yegor256.com/2014/12/09/immutable-object-state-and-behavior.html" title="Share on Google+" class="button" rel="nofollow"> <span class="count count-googleplus">0</span> <i class="icon icon-googleplus notranslate" aria-hidden="true"></i> </a> <a href="https://www.linkedin.com/cws/share?url=https://www.yegor256.com/2014/12/09/immutable-object-state-and-behavior.html" title="Share on LinkedIn" class="button" rel="nofollow"> <span class="count count-linkedin">0</span> <i class="icon icon-linkedin notranslate" aria-hidden="true"></i> </a> <a href="http://reddit.com/submit?url=https://www.yegor256.com/2014/12/09/immutable-object-state-and-behavior.html%3F2014-49&amp;title=How+an+Immutable+Object+Can+Have+State+and+Behavior%3F" title="Share on Reddit" class="button" rel="nofollow"> <span class="count count-reddit">0</span> <i class="icon icon-reddit notranslate" aria-hidden="true"></i> </a> <a href="http://news.ycombinator.com/submitlink?u=https://www.yegor256.com/2014/12/09/immutable-object-state-and-behavior.html%3F2014-49&amp;t=How+an+Immutable+Object+Can+Have+State+and+Behavior%3F" title="Share on Hacker News" class="button" rel="nofollow"> <span class="count count-hackernews">0</span> <i class="icon icon-hackernews notranslate" aria-hidden="true"></i> </a> </nav> </header> <article class="main" itemprop="articleBody"><div ><p>I often hear this argument against <a href="/2014/06/09/objects-should-be-immutable.html">immutable objects</a>: &quot;Yes, they are useful when the state doesn&#39;t change. However, in our case, we deal with frequently changing objects. We simply can&#39;t afford to create a new <code>document</code> every time we just need to change its <code>title</code>.&quot; Here is where I disagree: object title is <strong>not a state</strong> of a document, if you need to change it frequently. Instead, it is a document&#39;s <strong>behavior</strong>. A <code>document</code> can and must be <a href="/2016/09/07/gradients-of-immutability.html">immutable</a>, if it is a <a href="/2014/11/20/seven-virtues-of-good-object.html">good object</a>, even when its title is changed frequently. Let me explain how.</p><figure class='jb_picture'><img itemprop='image' alt='Once Upon a Time in the West (1968) by Sergio Leone' src='/images/2014/12/once-upon-a-time-in-the-west.png' longdesc='#e87f3523'/><figcaption id='e87f3523'>Once Upon a Time in the West (1968) by Sergio Leone</figcaption></figure><h2 id="identity-state-and-behavior">Identity, State, and Behavior</h2><p>Basically, there are three elements in every <a href="/2016/07/14/who-is-object.html">object</a>: identity, state, and behavior. <em>Identity</em> is what distinguishes our <code>document</code> from other objects, <em>state</em> is what a document knows about itself (a.k.a. &quot;encapsulated knowledge&quot;), and <em>behavior</em> is what a document can do for us on request. For example, this is a mutable document:</p><figure class="highlight"><pre><code class="language-java" data-lang="java"><span></span><span class="kd">class</span> <span class="nc">Document</span> <span class="o">{</span>
  <span class="kd">private</span> <span class="kt">int</span> <span class="n">id</span><span class="o">;</span>
  <span class="kd">private</span> <span class="n">String</span> <span class="n">title</span><span class="o">;</span>
  <span class="n">Document</span><span class="o">(</span><span class="kt">int</span> <span class="n">id</span><span class="o">)</span> <span class="o">{</span>
    <span class="k">this</span><span class="o">.</span><span class="na">id</span> <span class="o">=</span> <span class="n">id</span><span class="o">;</span>
  <span class="o">}</span>
  <span class="kd">public</span> <span class="n">String</span> <span class="nf">getTitle</span><span class="o">()</span> <span class="o">{</span>
    <span class="k">return</span> <span class="k">this</span><span class="o">.</span><span class="na">title</span><span class="o">;</span>
  <span class="o">}</span>
  <span class="kd">public</span> <span class="n">String</span> <span class="nf">setTitle</span><span class="o">(</span><span class="n">String</span> <span class="n">text</span><span class="o">)</span> <span class="o">{</span>
    <span class="k">this</span><span class="o">.</span><span class="na">title</span> <span class="o">=</span> <span class="n">text</span><span class="o">;</span>
  <span class="o">}</span>
  <span class="nd">@Override</span>
  <span class="kd">public</span> <span class="n">String</span> <span class="nf">toString</span><span class="o">()</span> <span class="o">{</span>
    <span class="k">return</span> <span class="n">String</span><span class="o">.</span><span class="na">format</span><span class="o">(</span><span class="s">&quot;doc #%d about &#39;%s&#39;&quot;</span><span class="o">,</span> <span class="k">this</span><span class="o">.</span><span class="na">id</span><span class="o">,</span> <span class="k">this</span><span class="o">.</span><span class="na">text</span><span class="o">);</span>
  <span class="o">}</span>
<span class="o">}</span></code></pre></figure><p>Let&#39;s try to use this mutable object:</p><figure class="highlight"><pre><code class="language-java" data-lang="java"><span></span><span class="n">Document</span> <span class="n">first</span> <span class="o">=</span> <span class="k">new</span> <span class="n">Document</span><span class="o">(</span><span class="mi">50</span><span class="o">);</span>
<span class="n">first</span><span class="o">.</span><span class="na">setTitle</span><span class="o">(</span><span class="s">&quot;How to grill a sandwich&quot;</span><span class="o">);</span>
<span class="n">Document</span> <span class="n">second</span> <span class="o">=</span> <span class="k">new</span> <span class="n">Document</span><span class="o">(</span><span class="mi">50</span><span class="o">);</span>
<span class="n">second</span><span class="o">.</span><span class="na">setTitle</span><span class="o">(</span><span class="s">&quot;How to grill a sandwich&quot;</span><span class="o">);</span>
<span class="k">if</span> <span class="o">(</span><span class="n">first</span><span class="o">.</span><span class="na">equals</span><span class="o">(</span><span class="n">second</span><span class="o">))</span> <span class="o">{</span> <span class="c1">// FALSE</span>
  <span class="n">System</span><span class="o">.</span><span class="na">out</span><span class="o">.</span><span class="na">println</span><span class="o">(</span>
    <span class="n">String</span><span class="o">.</span><span class="na">format</span><span class="o">(</span><span class="s">&quot;%s is equal to %s&quot;</span><span class="o">,</span> <span class="n">first</span><span class="o">,</span> <span class="n">second</span><span class="o">)</span>
  <span class="o">);</span>
<span class="o">}</span></code></pre></figure><p>Here, we&#39;re creating two objects and then modifying their encapsulated states. Obviously, <code>first.equals(second)</code> will return <code>false</code> because the two objects have different identities, even though they encapsulate the same state.</p><aside class='youtube'> <a href='https://www.youtube.com/watch?v=KwP7Ay9Z-hc'><div class='box'> <img src='https://i.ytimg.com/vi/KwP7Ay9Z-hc/mqdefault.jpg' alt='YouTube video #KwP7Ay9Z-hc'/><div class='play'><i class='icon icon-play'></i></div></div></a><div>Immutable Objects vs. Common Sense (webinar #2); 6 May 2015.</div></aside><p>Method <code>toString()</code> exposes the document&#39;s behavior---the document can convert itself to a string.</p><p>In order to modify a document&#39;s title, we just call its <code>setTitle()</code> once again:</p><figure class="highlight"><pre><code class="language-java" data-lang="java"><span></span><span class="n">first</span><span class="o">.</span><span class="na">setTitle</span><span class="o">(</span><span class="s">&quot;How to cook pasta&quot;</span><span class="o">);</span></code></pre></figure><p>Simply put, we can reuse the object many times, modifying its internal state. It is fast and convenient, isn&#39;t it? Fast, yes. Convenient, not really. Read on.</p><h2 id="immutable-objects-have-no-identity">Immutable Objects Have No Identity</h2><p>As I&#39;ve <a href="/2014/11/20/seven-virtues-of-good-object.html">mentioned before</a>, immutability is one of the virtues of a good object, and a very important one. A good object is immutable, and good software contains only immutable objects. The main difference between immutable and mutable objects is that an immutable one doesn&#39;t have an identity and its state never changes. Here is an immutable variant of the same document:</p><figure class="highlight"><pre><code class="language-java" data-lang="java"><span></span><span class="nd">@Immutable</span>
<span class="kd">class</span> <span class="nc">Document</span> <span class="o">{</span>
  <span class="kd">private</span> <span class="kd">final</span> <span class="kt">int</span> <span class="n">id</span><span class="o">;</span>
  <span class="kd">private</span> <span class="kd">final</span> <span class="n">String</span> <span class="n">title</span><span class="o">;</span>
  <span class="n">Document</span><span class="o">(</span><span class="kt">int</span> <span class="n">id</span><span class="o">,</span> <span class="n">String</span> <span class="n">text</span><span class="o">)</span> <span class="o">{</span>
    <span class="k">this</span><span class="o">.</span><span class="na">id</span> <span class="o">=</span> <span class="n">id</span><span class="o">;</span>
    <span class="k">this</span><span class="o">.</span><span class="na">title</span> <span class="o">=</span> <span class="n">text</span><span class="o">;</span>
  <span class="o">}</span>
  <span class="kd">public</span> <span class="n">String</span> <span class="nf">title</span><span class="o">()</span> <span class="o">{</span>
    <span class="k">return</span> <span class="k">this</span><span class="o">.</span><span class="na">title</span><span class="o">;</span>
  <span class="o">}</span>
  <span class="kd">public</span> <span class="n">Document</span> <span class="nf">title</span><span class="o">(</span><span class="n">String</span> <span class="n">text</span><span class="o">)</span> <span class="o">{</span>
    <span class="k">return</span> <span class="k">new</span> <span class="n">Document</span><span class="o">(</span><span class="k">this</span><span class="o">.</span><span class="na">id</span><span class="o">,</span> <span class="n">text</span><span class="o">);</span>
  <span class="o">}</span>
  <span class="nd">@Override</span>
  <span class="kd">public</span> <span class="kt">boolean</span> <span class="nf">equals</span><span class="o">(</span><span class="n">Object</span> <span class="n">doc</span><span class="o">)</span> <span class="o">{</span>
    <span class="k">return</span> <span class="n">doc</span> <span class="k">instanceof</span> <span class="n">Document</span>
      <span class="o">&amp;&amp;</span> <span class="n">Document</span><span class="o">.</span><span class="na">class</span><span class="o">.</span><span class="na">cast</span><span class="o">(</span><span class="n">doc</span><span class="o">).</span><span class="na">id</span> <span class="o">==</span> <span class="k">this</span><span class="o">.</span><span class="na">id</span>
      <span class="o">&amp;&amp;</span> <span class="n">Document</span><span class="o">.</span><span class="na">class</span><span class="o">.</span><span class="na">cast</span><span class="o">(</span><span class="n">doc</span><span class="o">).</span><span class="na">title</span><span class="o">.</span><span class="na">equals</span><span class="o">(</span><span class="k">this</span><span class="o">.</span><span class="na">title</span><span class="o">);</span>
  <span class="o">}</span>
  <span class="nd">@Override</span>
  <span class="kd">public</span> <span class="n">String</span> <span class="nf">toString</span><span class="o">()</span> <span class="o">{</span>
    <span class="k">return</span> <span class="n">String</span><span class="o">.</span><span class="na">format</span><span class="o">(</span>
      <span class="s">&quot;doc #%d about &#39;%s&#39;&quot;</span><span class="o">,</span> <span class="k">this</span><span class="o">.</span><span class="na">id</span><span class="o">,</span> <span class="k">this</span><span class="o">.</span><span class="na">text</span>
    <span class="o">);</span>
  <span class="o">}</span>
<span class="o">}</span></code></pre></figure><p>This document is immutable, and its state (<code>id</code> ad <code>title</code>) is its identity. Let&#39;s see how we can use this immutable class (by the way, I&#39;m using <a href="http://aspects.jcabi.com/annotation-immutable.html"><code>@Immutable</code></a> annotation from <a href="http://aspects.jcabi.com">jcabi-aspects</a>):</p><figure class="highlight"><pre><code class="language-java" data-lang="java"><span></span><span class="n">Document</span> <span class="n">first</span> <span class="o">=</span> <span class="k">new</span> <span class="n">Document</span><span class="o">(</span><span class="mi">50</span><span class="o">,</span> <span class="s">&quot;How to grill a sandwich&quot;</span><span class="o">);</span>
<span class="n">Document</span> <span class="n">second</span> <span class="o">=</span> <span class="k">new</span> <span class="n">Document</span><span class="o">(</span><span class="mi">50</span><span class="o">,</span> <span class="s">&quot;How to grill a sandwich&quot;</span><span class="o">);</span>
<span class="k">if</span> <span class="o">(</span><span class="n">first</span><span class="o">.</span><span class="na">equals</span><span class="o">(</span><span class="n">second</span><span class="o">))</span> <span class="o">{</span> <span class="c1">// TRUE</span>
  <span class="n">System</span><span class="o">.</span><span class="na">out</span><span class="o">.</span><span class="na">println</span><span class="o">(</span>
    <span class="n">String</span><span class="o">.</span><span class="na">format</span><span class="o">(</span><span class="s">&quot;%s is equal to %s&quot;</span><span class="o">,</span> <span class="n">first</span><span class="o">,</span> <span class="n">second</span><span class="o">)</span>
  <span class="o">);</span>
<span class="o">}</span></code></pre></figure><p>We can&#39;t modify a document any more. When we need to change the title, we have to create a new document:</p><figure class="highlight"><pre><code class="language-java" data-lang="java"><span></span><span class="n">Document</span> <span class="n">first</span> <span class="o">=</span> <span class="k">new</span> <span class="n">Document</span><span class="o">(</span><span class="mi">50</span><span class="o">,</span> <span class="s">&quot;How to grill a sandwich&quot;</span><span class="o">);</span>
<span class="n">first</span> <span class="o">=</span> <span class="n">first</span><span class="o">.</span><span class="na">title</span><span class="o">(</span><span class="s">&quot;How to cook pasta&quot;</span><span class="o">);</span></code></pre></figure><p>Every time we want to modify its encapsulated state, we have to modify its identity too, because there is no identity. State is the identity. Look at the code of the <code>equals()</code> method above---it compares documents by their IDs and titles. Now ID+title of a document is its identity!</p><h2 id="what-about-frequent-changes">What About Frequent Changes?</h2><p>Now I&#39;m getting to the question we started with: What about performance and convenience? We don&#39;t want to change the entire document every time we have to modify its title. If the document is big enough, that would be a huge obligation. Moreover, if an immutable object encapsulates other immutable objects, we have to change the entire hierarchy when modifying even a single string in one of them.</p><aside class='youtube'> <a href='https://www.youtube.com/watch?v=EnhRgXrHCC4'><div class='box'> <img src='https://i.ytimg.com/vi/EnhRgXrHCC4/mqdefault.jpg' alt='YouTube video #EnhRgXrHCC4'/><div class='play'><i class='icon icon-play'></i></div></div></a><div>How Immutability Helps in OOP (in Russian with English subtitles); 21 May 2016.</div></aside><p>The answer is simple. A document&#39;s title should not be part of its <strong>state</strong>. Instead, the title should be its <strong>behavior</strong>. For example, consider this:</p><figure class="highlight"><pre><code class="language-java" data-lang="java"><span></span><span class="nd">@Immutable</span>
<span class="kd">class</span> <span class="nc">Document</span> <span class="o">{</span>
  <span class="kd">private</span> <span class="kd">final</span> <span class="kt">int</span> <span class="n">id</span><span class="o">;</span>
  <span class="n">Document</span><span class="o">(</span><span class="kt">int</span> <span class="n">id</span><span class="o">)</span> <span class="o">{</span>
    <span class="k">this</span><span class="o">.</span><span class="na">id</span> <span class="o">=</span> <span class="n">id</span><span class="o">;</span>
  <span class="o">}</span>
  <span class="kd">public</span> <span class="n">String</span> <span class="nf">title</span><span class="o">()</span> <span class="o">{</span>
    <span class="c1">// read title from storage</span>
  <span class="o">}</span>
  <span class="kd">public</span> <span class="kt">void</span> <span class="nf">title</span><span class="o">(</span><span class="n">String</span> <span class="n">text</span><span class="o">)</span> <span class="o">{</span>
    <span class="c1">// save text to storage</span>
  <span class="o">}</span>
  <span class="nd">@Override</span>
  <span class="kd">public</span> <span class="kt">boolean</span> <span class="nf">equals</span><span class="o">(</span><span class="n">Object</span> <span class="n">doc</span><span class="o">)</span> <span class="o">{</span>
    <span class="k">return</span> <span class="n">doc</span> <span class="k">instanceof</span> <span class="n">Document</span>
      <span class="o">&amp;&amp;</span> <span class="n">Document</span><span class="o">.</span><span class="na">class</span><span class="o">.</span><span class="na">cast</span><span class="o">(</span><span class="n">doc</span><span class="o">).</span><span class="na">id</span> <span class="o">==</span> <span class="k">this</span><span class="o">.</span><span class="na">id</span><span class="o">;</span>
  <span class="o">}</span>
  <span class="nd">@Override</span>
  <span class="kd">public</span> <span class="n">String</span> <span class="nf">toString</span><span class="o">()</span> <span class="o">{</span>
    <span class="k">return</span> <span class="n">String</span><span class="o">.</span><span class="na">format</span><span class="o">(</span><span class="s">&quot;doc #%d about &#39;%s&#39;&quot;</span><span class="o">,</span> <span class="k">this</span><span class="o">.</span><span class="na">id</span><span class="o">,</span> <span class="k">this</span><span class="o">.</span><span class="na">title</span><span class="o">());</span>
  <span class="o">}</span>
<span class="o">}</span></code></pre></figure><p>Conceptually speaking, this document is acting as a proxy of a real-life document that has a title stored somewhere---in a file, for example. This is what a good object should do---be a proxy of a real-life entity. The document exposes two features: reading the title and saving the title. Here is how its <a href="/2016/04/26/why-inputstream-design-is-wrong.html">interface</a> would look like:</p><figure class="highlight"><pre><code class="language-java" data-lang="java"><span></span><span class="nd">@Immutable</span>
<span class="kd">interface</span> <span class="nc">Document</span> <span class="o">{</span>
  <span class="n">String</span> <span class="nf">title</span><span class="o">();</span>
  <span class="kt">void</span> <span class="nf">title</span><span class="o">(</span><span class="n">String</span> <span class="n">text</span><span class="o">);</span>
<span class="o">}</span></code></pre></figure><p><code>title()</code> reads the title of the document and returns it as a <code>String</code>, and <code>title(String)</code> saves it back into the document. Imagine a real paper document with a title. You ask an object to read that title from the paper or to erase an existing one and write new text over it. This paper is a &quot;copy&quot; utilized in these methods.</p><p>Now we can make frequent changes to the immutable document, and the document stays the same. It doesn&#39;t stop being immutable, since it&#39;s state (<code>id</code>) is not changed. It is the same document, even though we change its title, because the title is not a state of the document. It is something in the real world, outside of the document. The document is just a proxy between us and that &quot;something.&quot; Reading and writing the title <em>are behaviors</em> of the document, not its state.</p><h2 id="mutable-memory">Mutable Memory</h2><p>The only question we still have unanswered is what is that &quot;copy&quot; and what happens if we need to keep the title of the document in memory?</p><p>Let&#39;s look at it from an &quot;object thinking&quot; point of view. We have a <code>document</code> object, which <a href="/2014/11/20/seven-virtues-of-good-object.html">is supposed to represent</a> a real-life entity in an object-oriented world. If such an entity is a file, we can easily implement <code>title()</code> methods. If such an entity is an Amazon S3 object, we also implement title reading and writing methods easily, keeping the object immutable. If such an entity is an HTTP page, we have no issues in the implementation of title reading or writing, keeping the object immutable. We have no issues as long as a real-world document exists and has its own identity. Our title reading and writing methods will communicate with that real-world document and extract or update its title.</p><aside class='youtube'> <a href='https://www.youtube.com/watch?v=p7m7_iiqaHI'><div class='box'> <img src='https://i.ytimg.com/vi/p7m7_iiqaHI/mqdefault.jpg' alt='YouTube video #p7m7_iiqaHI'/><div class='play'><i class='icon icon-play'></i></div></div></a><div>How Much Immutability Is Enough?; 19 May 2016.</div></aside><p>Problems arise when such an entity doesn&#39;t exist in a real world. In that case, we need to create a mutable object property called <code>title</code>, read it via <code>title()</code>, and modify it via <code>title(String)</code>. But an object is immutable, so we can&#39;t have a mutable property in it---by definition! What do we do?</p><p>Think.</p><p>How could it be that our object doesn&#39;t represent a real-world entity? Remember, the <em>real world</em> is everything around the living environment of an object. Is it possible that an object doesn&#39;t represent anyone and acts on its own? No, it&#39;s not possible. Every object is a representative of a real-world entity. So, who does it represent if we want to keep <code>title</code> inside it and we don&#39;t have any file or HTTP page behind the object?</p><figure class='badge'><img src='https://www.yegor256.com/images/2014/12/memory-stick.png' style='width:200px;max-width:100%;' alt='badge'/></figure><p>It represents <em>computer memory</em>.</p><p>The title of immutable document #50, &quot;How to grill a sandwich,&quot; is stored in the memory, taking up 23 bytes of space. The document should know where those bytes are stored, and it should be able to read them and replace them with something else. Those 23 bytes are the real-world entity that the object represents. The bytes have nothing to do with the state of the object. They are a <em>mutable</em> real-world entity, similar to a file, HTTP page, or an Amazon S3 object.</p><p>Unfortunately, Java (and many other modern languages) do not allow direct access to computer memory. This is how we would design our class if such direct access was possible:</p><figure class="highlight"><pre><code class="language-java" data-lang="java"><span></span><span class="nd">@Immutable</span>
<span class="kd">class</span> <span class="nc">Document</span> <span class="o">{</span>
  <span class="kd">private</span> <span class="kd">final</span> <span class="kt">int</span> <span class="n">id</span><span class="o">;</span>
  <span class="kd">private</span> <span class="kd">final</span> <span class="n">Memory</span> <span class="n">memory</span><span class="o">;</span>
  <span class="n">Document</span><span class="o">(</span><span class="kt">int</span> <span class="n">id</span><span class="o">)</span> <span class="o">{</span>
    <span class="k">this</span><span class="o">.</span><span class="na">id</span> <span class="o">=</span> <span class="n">id</span><span class="o">;</span>
    <span class="k">this</span><span class="o">.</span><span class="na">memory</span> <span class="o">=</span> <span class="k">new</span> <span class="n">Memory</span><span class="o">();</span>
  <span class="o">}</span>
  <span class="kd">public</span> <span class="n">String</span> <span class="nf">title</span><span class="o">()</span> <span class="o">{</span>
    <span class="k">return</span> <span class="k">new</span> <span class="n">String</span><span class="o">(</span><span class="k">this</span><span class="o">.</span><span class="na">memory</span><span class="o">.</span><span class="na">read</span><span class="o">());</span>
  <span class="o">}</span>
  <span class="kd">public</span> <span class="kt">void</span> <span class="nf">title</span><span class="o">(</span><span class="n">String</span> <span class="n">text</span><span class="o">)</span> <span class="o">{</span>
    <span class="k">this</span><span class="o">.</span><span class="na">memory</span><span class="o">.</span><span class="na">write</span><span class="o">(</span><span class="n">text</span><span class="o">.</span><span class="na">getBytes</span><span class="o">());</span>
  <span class="o">}</span>
<span class="o">}</span></code></pre></figure><p>That <code>Memory</code> class would be implemented by JDK natively, and all other classes would be immutable. The class <code>Memory</code> would have direct access to the memory heap and would be responsible for <a href="https://en.wikipedia.org/wiki/C_dynamic_memory_allocation"><code>malloc</code> and <code>free</code></a> operations on the operating system level. Having such a class would allow us to make all Java classes immutable, including <code>StringBuffer</code>, <code>ByteArrayOutputStream</code>, etc.</p><aside class='quote'>The role of an object is to make a piece of data alive, to animate it but not to become a piece of data</aside><p>The <code>Memory</code> class would explicitly emphasize the mission of an object in a software program, which is to be a <em>data animator</em>. An object is not holding data; it is animating it. The data exists somewhere, and it is <a href="/2016/07/06/data-transfer-object.html">anemic</a>, static, motionless, stationary, etc. The data is <strong>dead</strong> while the object is <strong>alive</strong>. The role of an object is to make a piece of data alive, to <em>animate</em> it but not to become a piece of data. An object needs some knowledge in order to gain access to that dead piece of data. An object may need a database unique key, an HTTP address, a file name, or a memory address in order to find the data and animate it. But an object should never think of itself as data.</p><h2 id="what-is-the-practical-solution">What Is the Practical Solution?</h2><aside class='youtube'> <a href='https://www.youtube.com/watch?v=PVvLQGnyDrQ'><div class='box'> <img src='https://i.ytimg.com/vi/PVvLQGnyDrQ/mqdefault.jpg' alt='YouTube video #PVvLQGnyDrQ'/><div class='play'><i class='icon icon-play'></i></div></div></a><div>Gradients of Immutability (webinar #20); 11 January 2017.</div></aside><p>Unfortunately, we don&#39;t have such a memory-representing class in Java, Ruby, JavaScript, Python, PHP, and many other high-level languages. It looks like language designers didn&#39;t get the idea of alive objects vs. dead data, which is sad. We&#39;re forced to mix data with object states using the same language constructs: object variables and properties. Maybe someday we&#39;ll have that <code>Memory</code> class in Java and other languages, but until then, we have a few options.</p><p><strong>Use C++</strong>. In C++ and similar low-level languages, it is possible to access memory directly and deal with in-memory data the same way we deal with in-file or in-HTTP data. In C++, we can create that <code>Memory</code> class and use it exactly the way we explained above.</p><p><strong>Use Arrays</strong>. In Java, an array is a data structure with a unique property---it can be modified while being declared as <code>final</code>. You can use an array of bytes as a mutable data structure inside an immutable object. It&#39;s a surrogate solution that conceptually resembles the <code>Memory</code> class but is much more primitive.</p><aside class='quote'>A good object is an immutable animator of mutable data</aside><p><strong>Avoid In-Memory Data</strong>. Try to avoid in-memory data as much as possible. In some domains, it is easy to do; for example, in web apps, file processing, I/O adapters, etc. However, in other domains, it is much easier said than done. For example, in games, data manipulation algorithms, and GUI, most of the objects animate in-memory data mostly because memory is the only resource they have. In that case, without the <code>Memory</code> class, you end up with mutable objects :( There is no workaround.</p><p>To summarize, don&#39;t forget that an object is an <strong>animator</strong> of data. It is using its encapsulated knowledge in order to reach the data. No matter where the data is stored---in a file, in HTTP, or in memory---it is conceptually very different from an object state, even though they may look very similar.</p><p>A good object is an immutable animator of mutable data. Even though it is immutable and data is mutable, it is alive and data is dead in the scope of the object&#39;s living environment.</p></div></article></div><div class="wrapper"><div class="unprintable"> <hr/><p>If you like this article, you will definitely like these <strong>very relevant</strong> posts too:</p><p><a href='/2014/06/09/objects-should-be-immutable.html'><strong>Objects Should Be Immutable</strong></a> <br/>The article gives arguments about why classes/objects in object-oriented programming have to be immutable, i.e. never modify their encapsulated state</p><p><a href='/2016/09/07/gradients-of-immutability.html'><strong>Gradients of Immutability</strong></a> <br/>There are a few levels and forms of immutability in object-oriented programming, all of which can be used when they seem appropriate.</p><p><a href='/2014/12/22/immutable-objects-not-dumb.html'><strong>Immutable Objects Are Not Dumb</strong></a> <br/>Immutable objects are not the same as passive data structures without setters, despite a very common mis-belief.</p></div></div><div class="disqus" role="complementary"><p class="disqus_hint"> Please, use <a href="https://help.disqus.com/commenting/what-html-tags-are-allowed-within-comments">syntax highlighting</a> in your comments, to make them more readable.</p><div id="disqus_thread" class="disqus-thread"> <a>&nbsp;</a></div><script> var disqus_config = function () { this.page.url = document.location.href.split('?')[0].split('#')[0].replace('https://', 'http://'); this.page.identifier = this.page.url; }; (function() { var d = document, s = d.createElement('script'); s.src = '//yegor256.disqus.com/embed.js'; s.setAttribute('data-timestamp', +new Date()); (d.head || d.body).appendChild(s); })(); </script> <noscript><div><p class="red"> JavaScript is disabled in your browser, that's why you can't see comments under this post.</p></div></noscript></div><div class="wrapper"> <footer class="footer"><p> &copy; <span itemscope="" itemprop="copyrightHolder" itemtype="http://schema.org/Person"> <span itemprop="name">Yegor Bugayenko</span> </span> 2014&ndash;<span itemprop="copyrightYear">2018</span></p></footer></div></section><div class="wrapper unprintable" style="text-align:center;margin-top:2em;"> <a href="http://www.sixnines.io/h/3ba1652f"> <img src="//www.sixnines.io/b/3ba1652f?style=flat" alt="sixnines availability badge"/> </a></div><script src="//code.jquery.com/jquery-1.9.0.min.js"></script> <script src="/js/all.js?a0e0d018c07"></script> <script>var disqus_shortname = 'yegor256';</script> <script id="dsq-count-scr" src="//yegor256.disqus.com/count.js" async="async"></script> <script> (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){ (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o), m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m) })(window,document,'script','//www.google-analytics.com/analytics.js','ga'); ga('create', 'UA-1963507-32', 'auto'); ga('send', 'pageview'); </script> <script> Cd=document;Cr="&"+Math.random();Cp="&s=1"; Cd.cookie="b=b";if(Cd.cookie)Cp+="&c=1"; Cp+="&t="+(new Date()).getTimezoneOffset(); if(self!=top)Cp+="&f=1"; </script> <script> if(navigator.javaEnabled())Cp+="&j=1"; </script> <script> if(typeof(screen)!='undefined')Cp+="&w="+screen.width+"&h="+ screen.height+"&d="+(screen.colorDepth?screen.colorDepth:screen.pixelDepth); </script> <script> Cd.write("<img src='//c.hit.ua/hit?i=95870&g=0&x=2"+Cp+Cr+ "&r="+escape(Cd.referrer)+"&u="+escape(window.location.href)+ "' border='0' wi"+"dth='1' he"+"ight='1'/>"); </script> <script type="application/ld+json"> { "@context": "http://schema.org", "@type": "Person", "name": "Yegor Bugayenko", "url": "http://www.yegor256.com", "sameAs": [ "https://www.facebook.com/yegor256", "https://instagram.com/yegor256", "https://www.linkedin.com/in/yegor256", "https://twitter.com/yegor256", "https://github.com/yegor256", "https://www.pinterest.com/yegor256/" ] } </script> </body> </html> <!DOCTYPE html> <html xmlns="http://www.w3.org/1999/xhtml" lang="en-US" xml:lang="en-US" itemscope="" itemtype="http://schema.org/WebSite"> <head> <meta charset="utf-8"/> <meta name="description" content="Object-relational mapping is a design pattern that violates encapsulation, one of the fundamental principles of OOP, but what is a possible alternative to it? " /> <meta name="keywords" content="object relational mapping, object relational mapping tools, object relational mapping tutorials, orm is an anti-pattern, orm is antipattern" /> <meta name="viewport" content="width=device-width,minimum-scale=1,initial-scale=1"/> <meta name="google-site-verification" content="JEj_gQr2CPe2QKGw8XdMz0R7VboQIUbX3FlM-lwTq-8" /> <meta name="author" content="Yegor Bugayenko"> <meta name="article:published_time" content="2014-12-01 00:00:00 +0000"> <meta name="og:site_name" content="Yegor Bugayenko"/> <meta name="og:type" content="article" /> <meta name="og:locale" content="en_US" /> <meta name="twitter:account_id" content="4503599630178231" /> <meta name="twitter:creator" content="@yegor256"/> <meta name="twitter:site" content="@yegor256"/> <meta name="twitter:title" property="og:title" content="ORM Is an Offensive Anti-Pattern"/> <meta name="twitter:description" property="og:description" content="Object-relational mapping is a design pattern that violates encapsulation, one of the fundamental principles of OOP, but what is a possible alternative to it? "/> <meta name="twitter:url" property="og:url" content="https://www.yegor256.com/2014/12/01/orm-offensive-anti-pattern.html"/> <meta name="telegram:channel" content="AAAAAEJFMRzsRTRxM3ec6A"/> <link rel="search" type="application/opensearchdescription+xml" href="/opensearch.xml" title="yegor256" /> <link rel="shortcut icon" href="/favicon.ico?a0e0d018c07"/> <link rel="apple-touch-icon" href="/favicon.ico?a0e0d018c07"/> <link rel="alternate" type="application/rss+xml" title="RSS for yegor256.com" href="https://www.yegor256.com/rss.xml"/> <link rel="stylesheet" href="/css/layout.css?a0e0d018c07"/> <link rel="stylesheet" href="/css/icons.css?a0e0d018c07"/> <link rel="canonical" href="https://www.yegor256.com/2014/12/01/orm-offensive-anti-pattern.html" /> <link rel="amphtml" href="https://www.yegor256.com/2014/12/01/orm-offensive-anti-pattern.amp.html" /> <title>ORM Is an Offensive Anti-Pattern </title> <meta name='og:image' content='https://www.yegor256.com/images/2014/11/broken-object.png'/><meta name='twitter:image' content='https://www.yegor256.com/images/2014/11/broken-object.png'/><meta name='og:image:width' content='1287'/> <meta name='twitter:image:width' content='1287'/><meta name='og:image:height' content='784'/> <meta name='twitter:image:height' content='784'/><meta name='twitter:card' content='summary_large_image'/><meta name='twitter:image:alt' content='Vinni-Pukh (1969) by Fyodor Khitruk'/> </head> <body><div class="wrapper"> <aside class="header-toggle unprintable" id="header-toggle" title="Show the menu" onclick="$('#header').show();$('#header-toggle').hide();">&#9776;</aside> <header class="header" id="header"><div class="face"> <a href="/about-me.html#form" class="sub" title="Click to subscribe to my monthly newsletter"><span>Subscribe</span></a> <a href="/about-me.html" style="position:relative;"> <img src="/images/face-256x256.jpg" class="photo" alt="Yegor Bugayenko"/> </a></div><nav><ul class="menu social notranslate"> <li><a href="https://twitter.com/intent/follow?screen_name=yegor256" rel="nofollow" title="Follow me on Twitter"><i class="icon icon-twitter notranslate" aria-hidden="true"></i></a></li> <li><a href="/rss.xml" rel="nofollow" title="Subscribe to my RSS feed"><i class="icon icon-rss notranslate" aria-hidden="true"></i></a></li> <li><a itemprop="sameAs" href="https://github.com/yegor256" rel="nofollow" title="My GitHub profile"><i class="icon icon-github notranslate" aria-hidden="true"></i></a></li> <li><a itemprop="sameAs" href="http://stackoverflow.com/users/187141/yegor256" rel="nofollow" title="My StackOverflow profile"><i class="icon icon-stackoverflow notranslate" aria-hidden="true"></i></a></li> <li><a itemprop="sameAs" href="https://www.facebook.com/yegor256" rel="nofollow" title="Follow me on Facebook"><i class="icon icon-facebook notranslate" aria-hidden="true"></i></a></li> <li><a itemprop="sameAs" href="https://instagram.com/yegor256" rel="nofollow" title="Follow me on Instagram"><i class="icon icon-instagram notranslate" aria-hidden="true"></i></a></li> <li><a itemprop="sameAs" href="https://www.linkedin.com/in/yegor256" rel="nofollow" title="My LinkedIn profile"><i class="icon icon-linkedin notranslate" aria-hidden="true"></i></a></li> <li><a itemprop="sameAs" href="https://www.youtube.com/c/yegor256?sub_confirmation=1" rel="nofollow" title="My Youtube video channel"><i class="icon icon-youtube notranslate" aria-hidden="true"></i></a></li> <li><a itemprop="sameAs" href="https://www.pinterest.com/yegor256/" rel="nofollow" title="My Pinterest boards"><i class="icon icon-pinterest notranslate" aria-hidden="true"></i></a></li> <li><a itemprop="sameAs" href="https://angel.co/yegor256" rel="nofollow" title="My AngelList profile"><i class="icon icon-angellist notranslate" aria-hidden="true"></i></a></li> <li><a href="https://soundcloud.com/yegor256" rel="nofollow" title="My podcast"><i class="icon icon-podcast notranslate" aria-hidden="true"></i></a></li> <li><a href="https://itunes.apple.com/us/podcast/yegor256-podcast/id1150826721" rel="nofollow" title="My iTunes podcast"><i class="icon icon-itunes notranslate" aria-hidden="true"></i></a></li> <li><a href="https://t.me/joinchat/AAAAAEJFMRzsRTRxM3ec6A" rel="nofollow" title="My Telegram public channel"><i class="icon icon-telegram notranslate" aria-hidden="true"></i></a></li> <li><a href="mailto:blog@yegor256.com" rel="nofollow" title="Email me any time"><i class="icon icon-mail notranslate" aria-hidden="true"></i></a></li></ul><ul class="menu"> <li><a href="/" title="Home page">Home</a></li> <li ><a href="/best.html" title="Best articles to read">12&#160;Best</a></li> <li ><a href="/contents.html" title="The contents of the entire blog">All&#160;288</a></li> <li ><a href="/webinars.html" title="My webinars">Webinars</a></li> <li ><a href="/talks.html" title="Future and past conference talks">Talks</a></li> <li ><a href="/books.html" title="The books I wrote">Books</a></li> <li ><a href="/papers.html" title="My academic papers and patents">Papers</a></li> <li ><a href="/pets.html" title="My loved pet projects">Pets</a></li> <li ><a href="/award.html" title="Software quality award">Award</a></li> <li ><a href="/testimonials.html" title="What some people say about me">Testimonials</a></li> <li ><a href="/shift-m.html" title="Audio podcast about project management">Shift-M</a></li> <li ><a href="/paintings.html" title="My paintings for sale">Paintings</a></li> <li><a href="http://ru.yegor256.com/" title="Немного на русском языке">По-русски</a></li></ul></nav><div class="search"> <form method="get" action="https://www.google.com/search" itemprop="potentialAction" itemscope="" itemtype="http://schema.org/SearchAction"> <meta itemprop="target" content="https://www.google.com/search?q={q}"/> <input name="sitesearch" value="yegor256.com" type="hidden"/> <input itemprop="query-input" type="text" id="search-query" class="field field-text" required="required" onfocus="$('.google').css('visibility', 'visible');" name="q" placeholder="Search..." autocomplete="off"/> <input type="image" src="/images/google-search-icon.svg" class="google" title="Search via Google" alt="Search via Google"/> </form></div><div class="hot"><ul> <li> <a href="/code-ahead.html">Code Ahead</a> was published on Amazon just a few days ago! It is my new book, a novel about programmers. It explains in details the majority of ideas that stand behind <a href="https://www.zerocracy.com">Zerocracy</a> and <a href="https://www.xdsd.org">XDSD</a>. </li> <li> At <a href="/webinars.html">Webinar #37</a> we will discuss naming problem in OOP, for objects, methods and attributes; join us on <b>September 12</b>, at 11am PST. </li></ul></div></header></div><section itemscope="" itemtype="http://schema.org/BlogPosting"><div class="wrapper"> <header><p class="printable"> <img src="https://api.qrserver.com/v1/create-qr-code/?data=https://www.yegor256.com/2014/12/01/orm-offensive-anti-pattern.html&amp;format=svg" style="width:125px;height:125px;" alt="QR code"/></p><p class="printable"> <code itemprop="url">https://www.yegor256.com/2014/12/01/orm-offensive-anti-pattern.html</code></p><h1 itemprop="name headline mainEntityOfPage">ORM Is an Offensive Anti-Pattern</h1><aside class='book'><a href='http://amzn.to/2pyceWc'><img src='/images/books/elegant-objects/cover.png' class='book-cover' alt='book cover'/></a>Read more about this subject in <a href='http://amzn.to/2pyceWc'>Section&nbsp;6.5</a><br/> of my book<a href='http://amzn.to/2pyceWc'><img src='/images/books/amazon-buy-button.png' class='amazon-button' alt='Click to buy'/></a></aside><ul class="subline"> <li> <time itemprop="datePublished" datetime="2014-12-01T00:00:00+00:00"> 1 December 2014 </time> </li> <li class="printable" itemscope="" itemprop="author" itemtype="http://schema.org/Person"> <span itemprop="name">Yegor Bugayenko</span> </li> <li class="unprintable"> <i class="icon icon-comments"></i> <a href="http://www.yegor256.com/2014/12/01/orm-offensive-anti-pattern.html#disqus_thread" itemprop="discussionUrl">comments</a> </li></ul><ul class="unprintable subline"> <li>Translated:</li> <li><a href="http://tbd.kaitoy.xyz/2015/09/13/orm-is-offensive-anti-pattern/">Japanese</a></li> <li><a href="mailto:translate@yegor256.com">add yours!</a></li></ul><ul class="subline"> <li>Discussed at:</li> <li><a href="https://news.ycombinator.com/item?id=8686346">hackernews</a></li> <li><a href="https://www.reddit.com/r/programming/comments/2nx4vq/orm_is_an_offensive_antipattern/">reddit</a></li></ul><p class="unprintable"><p>TL;DR ORM is a terrible <a href="/2016/02/03/design-patterns-and-anti-patterns.html">anti-pattern</a> that violates all principles of object-oriented programming, tearing <a href="/2016/07/14/who-is-object.html">objects</a> apart and turning them into dumb and passive data bags. There is no excuse for ORM existence in any application, be it a small web app or an enterprise-size system with thousands of tables and CRUD manipulations on them. What is the alternative? <strong>SQL-speaking objects</strong>.</p><figure class='jb_picture'><img itemprop='image' alt='Vinni-Pukh (1969) by Fyodor Khitruk' src='/images/2014/11/broken-object.png' longdesc='#6ad080f0'/><figcaption id='6ad080f0'>Vinni-Pukh (1969) by Fyodor Khitruk</figcaption></figure><h2 id="how-orm-works">How ORM Works</h2><p><a href="https://en.wikipedia.org/wiki/Object-relational_mapping">Object-relational mapping</a> (ORM) is a technique (a.k.a. design pattern) of accessing a relational database from an object-oriented language (Java, for example). There are multiple implementations of ORM in almost every language; for example: <a href="http://hibernate.org/orm/">Hibernate</a> for Java, <a href="/2016/07/26/active-record.html">ActiveRecord</a> for Ruby on Rails, <a href="http://www.doctrine-project.org/">Doctrine</a> for PHP, and <a href="http://www.sqlalchemy.org/">SQLAlchemy</a> for Python. In Java, the ORM design is even standardized as <a href="https://en.wikipedia.org/wiki/Java_Persistence_API">JPA</a>.</p><p>First, let&#39;s see how ORM works, by example. Let&#39;s use Java, PostgreSQL, and Hibernate. Let&#39;s say we have a single table in the database, called <code>post</code>:</p><figure class="highlight"><pre><code class="language-text" data-lang="text"><span></span>+-----+------------+--------------------------+
| id  | date       | title                    |
+-----+------------+--------------------------+
|   9 | 10/24/2014 | How to cook a sandwich   |
|  13 | 11/03/2014 | My favorite movies       |
|  27 | 11/17/2014 | How much I love my job   |
+-----+------------+--------------------------+</code></pre></figure> <aside class='youtube'> <a href='https://www.youtube.com/watch?v=DEqcn4-freM'><div class='box'> <img src='https://i.ytimg.com/vi/DEqcn4-freM/mqdefault.jpg' alt='YouTube video #DEqcn4-freM'/><div class='play'><i class='icon icon-play'></i></div></div></a><div>Why ORM is an Anti-Pattern? (webinar #10); 6 January 2016.</div></aside><p>Now we want to CRUD-manipulate this table from our Java app (CRUD stands for create, read, update, and delete). First, we should create a <code>Post</code> class (I&#39;m sorry it&#39;s so long, but that&#39;s the best I can do):</p><figure class="highlight"><pre><code class="language-java" data-lang="java"><span></span><span class="nd">@Entity</span>
<span class="nd">@Table</span><span class="o">(</span><span class="n">name</span> <span class="o">=</span> <span class="s">&quot;post&quot;</span><span class="o">)</span>
<span class="kd">public</span> <span class="kd">class</span> <span class="nc">Post</span> <span class="o">{</span>
  <span class="kd">private</span> <span class="kt">int</span> <span class="n">id</span><span class="o">;</span>
  <span class="kd">private</span> <span class="n">Date</span> <span class="n">date</span><span class="o">;</span>
  <span class="kd">private</span> <span class="n">String</span> <span class="n">title</span><span class="o">;</span>
  <span class="nd">@Id</span>
  <span class="nd">@GeneratedValue</span>
  <span class="kd">public</span> <span class="kt">int</span> <span class="nf">getId</span><span class="o">()</span> <span class="o">{</span>
    <span class="k">return</span> <span class="k">this</span><span class="o">.</span><span class="na">id</span><span class="o">;</span>
  <span class="o">}</span>
  <span class="nd">@Temporal</span><span class="o">(</span><span class="n">TemporalType</span><span class="o">.</span><span class="na">TIMESTAMP</span><span class="o">)</span>
  <span class="kd">public</span> <span class="n">Date</span> <span class="nf">getDate</span><span class="o">()</span> <span class="o">{</span>
    <span class="k">return</span> <span class="k">this</span><span class="o">.</span><span class="na">date</span><span class="o">;</span>
  <span class="o">}</span>
  <span class="kd">public</span> <span class="n">Title</span> <span class="nf">getTitle</span><span class="o">()</span> <span class="o">{</span>
    <span class="k">return</span> <span class="k">this</span><span class="o">.</span><span class="na">title</span><span class="o">;</span>
  <span class="o">}</span>
  <span class="kd">public</span> <span class="kt">void</span> <span class="nf">setDate</span><span class="o">(</span><span class="n">Date</span> <span class="n">when</span><span class="o">)</span> <span class="o">{</span>
    <span class="k">this</span><span class="o">.</span><span class="na">date</span> <span class="o">=</span> <span class="n">when</span><span class="o">;</span>
  <span class="o">}</span>
  <span class="kd">public</span> <span class="kt">void</span> <span class="nf">setTitle</span><span class="o">(</span><span class="n">String</span> <span class="n">txt</span><span class="o">)</span> <span class="o">{</span>
    <span class="k">this</span><span class="o">.</span><span class="na">title</span> <span class="o">=</span> <span class="n">txt</span><span class="o">;</span>
  <span class="o">}</span>
<span class="o">}</span></code></pre></figure><p>Before any operation with Hibernate, we have to create a session factory:</p><figure class="highlight"><pre><code class="language-java" data-lang="java"><span></span><span class="n">SessionFactory</span> <span class="n">factory</span> <span class="o">=</span> <span class="k">new</span> <span class="n">AnnotationConfiguration</span><span class="o">()</span>
  <span class="o">.</span><span class="na">configure</span><span class="o">()</span>
  <span class="o">.</span><span class="na">addAnnotatedClass</span><span class="o">(</span><span class="n">Post</span><span class="o">.</span><span class="na">class</span><span class="o">)</span>
  <span class="o">.</span><span class="na">buildSessionFactory</span><span class="o">();</span></code></pre></figure><p>This factory will give us &quot;sessions&quot; every time we want to manipulate with <code>Post</code> objects. Every manipulation with the session should be wrapped in this code block:</p><figure class="highlight"><pre><code class="language-java" data-lang="java"><span></span><span class="n">Session</span> <span class="n">session</span> <span class="o">=</span> <span class="n">factory</span><span class="o">.</span><span class="na">openSession</span><span class="o">();</span>
<span class="k">try</span> <span class="o">{</span>
  <span class="n">Transaction</span> <span class="n">txn</span> <span class="o">=</span> <span class="n">session</span><span class="o">.</span><span class="na">beginTransaction</span><span class="o">();</span>
  <span class="c1">// your manipulations with the ORM, see below</span>
  <span class="n">txn</span><span class="o">.</span><span class="na">commit</span><span class="o">();</span>
<span class="o">}</span> <span class="k">catch</span> <span class="o">(</span><span class="n">HibernateException</span> <span class="n">ex</span><span class="o">)</span> <span class="o">{</span>
  <span class="n">txn</span><span class="o">.</span><span class="na">rollback</span><span class="o">();</span>
<span class="o">}</span> <span class="k">finally</span> <span class="o">{</span>
  <span class="n">session</span><span class="o">.</span><span class="na">close</span><span class="o">();</span>
<span class="o">}</span></code></pre></figure><p>When the session is ready, here is how we get a list of all posts from that database table:</p><figure class="highlight"><pre><code class="language-java" data-lang="java"><span></span><span class="n">List</span> <span class="n">posts</span> <span class="o">=</span> <span class="n">session</span><span class="o">.</span><span class="na">createQuery</span><span class="o">(</span><span class="s">&quot;FROM Post&quot;</span><span class="o">).</span><span class="na">list</span><span class="o">();</span>
<span class="k">for</span> <span class="o">(</span><span class="n">Post</span> <span class="n">post</span> <span class="o">:</span> <span class="o">(</span><span class="n">List</span><span class="o">&lt;</span><span class="n">Post</span><span class="o">&gt;)</span> <span class="n">posts</span><span class="o">){</span>
  <span class="n">System</span><span class="o">.</span><span class="na">out</span><span class="o">.</span><span class="na">println</span><span class="o">(</span><span class="s">&quot;Title: &quot;</span> <span class="o">+</span> <span class="n">post</span><span class="o">.</span><span class="na">getTitle</span><span class="o">());</span>
<span class="o">}</span></code></pre></figure><p>I think it&#39;s clear what&#39;s going on here. Hibernate is a big, powerful engine that makes a connection to the database, executes necessary SQL <code>SELECT</code> requests, and retrieves the data. Then it makes instances of class <code>Post</code> and stuffs them with the data. When the object comes to us, it is filled with data, and we should use getters to take them out, like we&#39;re using <code>getTitle()</code> above.</p><aside class='youtube'> <a href='https://www.youtube.com/watch?v=aER4uwyFbqQ'><div class='box'> <img src='https://i.ytimg.com/vi/aER4uwyFbqQ/mqdefault.jpg' alt='YouTube video #aER4uwyFbqQ'/><div class='play'><i class='icon icon-play'></i></div></div></a><div>ORM is offensive (in Russian with English subtitles); 24 April 2016.</div></aside><p>When we want to do a reverse operation and send an object to the database, we do all of the same but in reverse order. We make an instance of class <code>Post</code>, stuff it with the data, and ask Hibernate to save it:</p><figure class="highlight"><pre><code class="language-java" data-lang="java"><span></span><span class="n">Post</span> <span class="n">post</span> <span class="o">=</span> <span class="k">new</span> <span class="n">Post</span><span class="o">();</span>
<span class="n">post</span><span class="o">.</span><span class="na">setDate</span><span class="o">(</span><span class="k">new</span> <span class="n">Date</span><span class="o">());</span>
<span class="n">post</span><span class="o">.</span><span class="na">setTitle</span><span class="o">(</span><span class="s">&quot;How to cook an omelette&quot;</span><span class="o">);</span>
<span class="n">session</span><span class="o">.</span><span class="na">save</span><span class="o">(</span><span class="n">post</span><span class="o">);</span></code></pre></figure><p>This is how almost every ORM works. The basic principle is always the same---ORM objects are <a href="/2016/07/06/data-transfer-object.html">anemic envelopes</a> with data. We are talking with the ORM framework, and the framework is talking to the database. Objects only help us send our requests to the ORM framework and understand its response. Besides <a href="/2016/07/18/law-of-demeter.html">getters and setters</a>, objects have no other methods. They don&#39;t even know which database they came from.</p><p>This is how object-relational mapping works.</p><p>What&#39;s wrong with it, you may ask? Everything!</p><h2 id="whats-wrong-with-orm">What&#39;s Wrong With ORM?</h2><p>Seriously, what is wrong? Hibernate has been one of the most popular Java libraries for more than 10 years already. Almost every SQL-intensive application in the world is using it. Each Java tutorial would mention Hibernate (or maybe <a href="https://en.wikipedia.org/wiki/List_of_object-relational_mapping_software">some other ORM</a> like TopLink or OpenJPA) for a database-connected application. It&#39;s a standard <em>de-facto</em> and still I&#39;m saying that it&#39;s wrong? Yes.</p><p>I&#39;m claiming that the entire idea behind ORM is wrong. Its invention was maybe the second big mistake in <a href="/2016/08/15/what-is-wrong-object-oriented-programming.html">OOP</a> after <a href="/2014/05/13/why-null-is-bad.html">NULL reference</a>.</p><aside class='quote'>ORM, instead of encapsulating database interaction inside an object, extracts it away, literally tearing a solid and cohesive living organism apart</aside><p>Actually, I&#39;m not the only one saying something like this, and definitely not the first. A lot about this subject has already been published by very respected authors, including <a href="http://martinfowler.com/bliki/OrmHate.html">OrmHate</a> by Martin Fowler (not against ORM, but worth mentioning anyway), <a href="http://blog.codinghorror.com/object-relational-mapping-is-the-vietnam-of-computer-science/">Object-Relational Mapping Is the Vietnam of Computer Science</a> by Jeff Atwood, <a href="http://blogs.tedneward.com/2006/06/26/The+Vietnam+Of+Computer+Science.aspx">The Vietnam of Computer Science</a> by Ted Neward, <a href="http://seldo.com/weblog/2011/08/11/orm_is_an_antipattern">ORM Is an Anti-Pattern</a> by Laurie Voss, and many others.</p><p>However, my argument is different than what they&#39;re saying. Even though their reasons are practical and valid, like &quot;ORM is slow&quot; or &quot;database upgrades are hard,&quot; they miss the main point. You can see a very good, practical answer to these practical arguments given by Bozhidar Bozhanov in his <a href="http://techblog.bozho.net/orm-haters-dont-get-it/">ORM Haters Don’t Get It</a> blog post.</p><figure class='badge'><img src='https://www.yegor256.com/images/2014/11/orm-anti-pattern.svg' style='width:413px;max-width:100%;' alt='badge'/></figure><p>The main point is that ORM, instead of encapsulating database interaction inside an object, extracts it away, literally tearing a solid and cohesive <a href="/2014/11/20/seven-virtues-of-good-object.html">living organism</a> apart. One part of the object keeps the data while another one, implemented inside the ORM engine (session factory), knows how to deal with this data and transfers it to the relational database. Look at this picture; it illustrates what ORM is doing.</p><p>I, being a reader of posts, have to deal with two components: 1) the ORM and 2) the &quot;ob-truncated&quot; object returned to me. The behavior I&#39;m interacting with is supposed to be provided through a single entry point, which is an object in OOP. In the case of ORM, I&#39;m getting this behavior via <strong>two</strong> entry points---the ORM engine and the &quot;thing,&quot; which we can&#39;t even call an object.</p><p>Because of this terrible and offensive violation of the object-oriented paradigm, we have a lot of practical issues already mentioned in respected publications. I can only add a few more.</p><aside class='youtube'> <a href='https://www.youtube.com/watch?v=63tS3HNmhiE'><div class='box'> <img src='https://i.ytimg.com/vi/63tS3HNmhiE/mqdefault.jpg' alt='YouTube video #63tS3HNmhiE'/><div class='play'><i class='icon icon-play'></i></div></div></a><div>ORM is a perfect anti-pattern; 23 May 2016.</div></aside><p><strong>SQL Is Not Hidden</strong>. Users of ORM should speak SQL (or its dialect, like <a href="https://docs.jboss.org/hibernate/orm/3.3/reference/en/html/queryhql.html">HQL</a>). See the example above; we&#39;re calling <code>session.createQuery(&quot;FROM Post&quot;)</code> in order to get all posts. Even though it&#39;s not SQL, it is very similar to it. Thus, the relational model is not encapsulated inside objects. Instead, it is exposed to the entire application. Everybody, with each object, inevitably has to deal with a relational model in order to get or save something. Thus, ORM doesn&#39;t hide and wrap the SQL but pollutes the entire application with it.</p><p><strong>Difficult to Test</strong>. When some object is working with a list of posts, it needs to deal with an instance of <code>SessionFactory</code>. How can we <a href="/2014/09/23/built-in-fake-objects.html">mock</a> this dependency? We have to create a mock of it? How complex is this task? Look at the code above, and you will realize how verbose and cumbersome that unit test will be. Instead, we can write integration tests and connect the entire application to a test version of PostgreSQL. In that case, there is no need to mock <code>SessionFactory</code>, but such tests will be rather slow, and even more important, our having-nothing-to-do-with-the-database objects will be tested against the database instance. A terrible design.</p><p>Again, let me reiterate. Practical problems of ORM are just consequences. The fundamental drawback is that ORM tears objects apart, terribly and offensively violating the very idea of <a href="/2014/11/20/seven-virtues-of-good-object.html">what an object is</a>.</p><h2 id="sql-speaking-objects">SQL-Speaking Objects</h2><figure class='badge'><img src='https://www.yegor256.com/images/2014/11/sql-speaking-object.svg' style='width:213px;max-width:100%;' alt='badge'/></figure><p>What is the alternative? Let me show it to you by example. Let&#39;s try to design that class, <code>Post</code>, my way. We&#39;ll have to break it down into two classes: <code>Post</code> and <code>Posts</code>, singular and plural. I already mentioned in one of my previous <a href="/2014/11/20/seven-virtues-of-good-object.html">articles</a> that a good object is always an abstraction of a real-life entity. Here is how this principle works in practice. We have two entities: database table and table row. That&#39;s why we&#39;ll make two classes; <code>Posts</code> will represent the table, and <code>Post</code> will represent the row.</p><p>As I also mentioned in that <a href="/2014/11/20/seven-virtues-of-good-object.html">article</a>, every object should work by contract and implement an interface. Let&#39;s start our design with two <a href="/2016/04/26/why-inputstream-design-is-wrong.html">interfaces</a>. Of course, our objects will be <a href="/2014/12/22/immutable-objects-not-dumb.html">immutable</a>. Here is how <code>Posts</code> would look:</p><figure class="highlight"><pre><code class="language-java" data-lang="java"><span></span><span class="kd">interface</span> <span class="nc">Posts</span> <span class="o">{</span>
  <span class="n">Iterable</span><span class="o">&lt;</span><span class="n">Post</span><span class="o">&gt;</span> <span class="nf">iterate</span><span class="o">();</span>
  <span class="n">Post</span> <span class="nf">add</span><span class="o">(</span><span class="n">Date</span> <span class="n">date</span><span class="o">,</span> <span class="n">String</span> <span class="n">title</span><span class="o">);</span>
<span class="o">}</span></code></pre></figure><p>This is how a single <code>Post</code> would look:</p><figure class="highlight"><pre><code class="language-java" data-lang="java"><span></span><span class="kd">interface</span> <span class="nc">Post</span> <span class="o">{</span>
  <span class="kt">int</span> <span class="nf">id</span><span class="o">();</span>
  <span class="n">Date</span> <span class="nf">date</span><span class="o">();</span>
  <span class="n">String</span> <span class="nf">title</span><span class="o">();</span>
<span class="o">}</span></code></pre></figure><p>Here is how we will list all posts in the database table:</p><figure class="highlight"><pre><code class="language-java" data-lang="java"><span></span><span class="n">Posts</span> <span class="n">posts</span> <span class="o">=</span> <span class="c1">// we&#39;ll discuss this right now</span>
<span class="k">for</span> <span class="o">(</span><span class="n">Post</span> <span class="n">post</span> <span class="o">:</span> <span class="n">posts</span><span class="o">.</span><span class="na">iterate</span><span class="o">()){</span>
  <span class="n">System</span><span class="o">.</span><span class="na">out</span><span class="o">.</span><span class="na">println</span><span class="o">(</span><span class="s">&quot;Title: &quot;</span> <span class="o">+</span> <span class="n">post</span><span class="o">.</span><span class="na">title</span><span class="o">());</span>
<span class="o">}</span></code></pre></figure><p>Here is how we will create a new post:</p><figure class="highlight"><pre><code class="language-java" data-lang="java"><span></span><span class="n">Posts</span> <span class="n">posts</span> <span class="o">=</span> <span class="c1">// we&#39;ll discuss this right now</span>
<span class="n">posts</span><span class="o">.</span><span class="na">add</span><span class="o">(</span><span class="k">new</span> <span class="n">Date</span><span class="o">(),</span> <span class="s">&quot;How to cook an omelette&quot;</span><span class="o">);</span></code></pre></figure><p>As you see, we have true objects now. They are in charge of all operations, and they perfectly hide their implementation details. There are no transactions, sessions, or factories. We don&#39;t even know whether these objects are actually talking to the PostgreSQL or if they keep all the data in text files. All we need from <code>Posts</code> is an ability to list all posts for us and to create a new one. Implementation details are perfectly hidden inside. Now let&#39;s see how we can implement these two classes.</p><aside class='youtube'> <a href='https://www.youtube.com/watch?v=03PXmPc7Q3g'><div class='box'> <img src='https://i.ytimg.com/vi/03PXmPc7Q3g/mqdefault.jpg' alt='YouTube video #03PXmPc7Q3g'/><div class='play'><i class='icon icon-play'></i></div></div></a><div>ORM is an Offensive Anti-Pattern; 9 November 2016.</div></aside><p>I&#39;m going to use <a href="http://jdbc.jcabi.com">jcabi-jdbc</a> as a JDBC wrapper, but you can use something else like <a href="http://www.jooq.org">jOOQ</a>, or just plain JDBC if you like. It doesn&#39;t really matter. What matters is that your database interactions are hidden inside objects. Let&#39;s start with <code>Posts</code> and implement it in class <code>PgPosts</code> (&quot;pg&quot; stands for PostgreSQL):</p><figure class="highlight"><pre><code class="language-java" data-lang="java"><span></span><span class="kd">final</span> <span class="kd">class</span> <span class="nc">PgPosts</span> <span class="kd">implements</span> <span class="n">Posts</span> <span class="o">{</span>
  <span class="kd">private</span> <span class="kd">final</span> <span class="n">Source</span> <span class="n">dbase</span><span class="o">;</span>
  <span class="kd">public</span> <span class="nf">PgPosts</span><span class="o">(</span><span class="n">DataSource</span> <span class="n">data</span><span class="o">)</span> <span class="o">{</span>
    <span class="k">this</span><span class="o">.</span><span class="na">dbase</span> <span class="o">=</span> <span class="n">data</span><span class="o">;</span>
  <span class="o">}</span>
  <span class="kd">public</span> <span class="n">Iterable</span><span class="o">&lt;</span><span class="n">Post</span><span class="o">&gt;</span> <span class="nf">iterate</span><span class="o">()</span> <span class="o">{</span>
    <span class="k">return</span> <span class="k">new</span> <span class="n">JdbcSession</span><span class="o">(</span><span class="k">this</span><span class="o">.</span><span class="na">dbase</span><span class="o">)</span>
      <span class="o">.</span><span class="na">sql</span><span class="o">(</span><span class="s">&quot;SELECT id FROM post&quot;</span><span class="o">)</span>
      <span class="o">.</span><span class="na">select</span><span class="o">(</span>
        <span class="k">new</span> <span class="n">ListOutcome</span><span class="o">&lt;</span><span class="n">Post</span><span class="o">&gt;(</span>
          <span class="k">new</span> <span class="n">ListOutcome</span><span class="o">.</span><span class="na">Mapping</span><span class="o">&lt;</span><span class="n">Post</span><span class="o">&gt;()</span> <span class="o">{</span>
            <span class="nd">@Override</span>
            <span class="kd">public</span> <span class="n">Post</span> <span class="nf">map</span><span class="o">(</span><span class="kd">final</span> <span class="n">ResultSet</span> <span class="n">rset</span><span class="o">)</span> <span class="o">{</span>
              <span class="k">return</span> <span class="k">new</span> <span class="n">PgPost</span><span class="o">(</span>
                <span class="k">this</span><span class="o">.</span><span class="na">dbase</span><span class="o">,</span>
                <span class="n">rset</span><span class="o">.</span><span class="na">getInt</span><span class="o">(</span><span class="mi">1</span><span class="o">)</span>
              <span class="o">);</span>
            <span class="o">}</span>
          <span class="o">}</span>
        <span class="o">)</span>
      <span class="o">);</span>
  <span class="o">}</span>
  <span class="kd">public</span> <span class="n">Post</span> <span class="nf">add</span><span class="o">(</span><span class="n">Date</span> <span class="n">date</span><span class="o">,</span> <span class="n">String</span> <span class="n">title</span><span class="o">)</span> <span class="o">{</span>
    <span class="k">return</span> <span class="k">new</span> <span class="n">PgPost</span><span class="o">(</span>
      <span class="k">this</span><span class="o">.</span><span class="na">dbase</span><span class="o">,</span>
      <span class="k">new</span> <span class="n">JdbcSession</span><span class="o">(</span><span class="k">this</span><span class="o">.</span><span class="na">dbase</span><span class="o">)</span>
        <span class="o">.</span><span class="na">sql</span><span class="o">(</span><span class="s">&quot;INSERT INTO post (date, title) VALUES (?, ?)&quot;</span><span class="o">)</span>
        <span class="o">.</span><span class="na">set</span><span class="o">(</span><span class="k">new</span> <span class="n">Utc</span><span class="o">(</span><span class="n">date</span><span class="o">))</span>
        <span class="o">.</span><span class="na">set</span><span class="o">(</span><span class="n">title</span><span class="o">)</span>
        <span class="o">.</span><span class="na">insert</span><span class="o">(</span><span class="k">new</span> <span class="n">SingleOutcome</span><span class="o">&lt;</span><span class="n">Integer</span><span class="o">&gt;(</span><span class="n">Integer</span><span class="o">.</span><span class="na">class</span><span class="o">))</span>
    <span class="o">);</span>
  <span class="o">}</span>
<span class="o">}</span></code></pre></figure><p>Next, let&#39;s implement the <code>Post</code> interface in class <code>PgPost</code>:</p><figure class="highlight"><pre><code class="language-java" data-lang="java"><span></span><span class="kd">final</span> <span class="kd">class</span> <span class="nc">PgPost</span> <span class="kd">implements</span> <span class="n">Post</span> <span class="o">{</span>
  <span class="kd">private</span> <span class="kd">final</span> <span class="n">Source</span> <span class="n">dbase</span><span class="o">;</span>
  <span class="kd">private</span> <span class="kd">final</span> <span class="kt">int</span> <span class="n">number</span><span class="o">;</span>
  <span class="kd">public</span> <span class="nf">PgPost</span><span class="o">(</span><span class="n">DataSource</span> <span class="n">data</span><span class="o">,</span> <span class="kt">int</span> <span class="n">id</span><span class="o">)</span> <span class="o">{</span>
    <span class="k">this</span><span class="o">.</span><span class="na">dbase</span> <span class="o">=</span> <span class="n">data</span><span class="o">;</span>
    <span class="k">this</span><span class="o">.</span><span class="na">number</span> <span class="o">=</span> <span class="n">id</span><span class="o">;</span>
  <span class="o">}</span>
  <span class="kd">public</span> <span class="kt">int</span> <span class="nf">id</span><span class="o">()</span> <span class="o">{</span>
    <span class="k">return</span> <span class="k">this</span><span class="o">.</span><span class="na">number</span><span class="o">;</span>
  <span class="o">}</span>
  <span class="kd">public</span> <span class="n">Date</span> <span class="nf">date</span><span class="o">()</span> <span class="o">{</span>
    <span class="k">return</span> <span class="k">new</span> <span class="n">JdbcSession</span><span class="o">(</span><span class="k">this</span><span class="o">.</span><span class="na">dbase</span><span class="o">)</span>
      <span class="o">.</span><span class="na">sql</span><span class="o">(</span><span class="s">&quot;SELECT date FROM post WHERE id = ?&quot;</span><span class="o">)</span>
      <span class="o">.</span><span class="na">set</span><span class="o">(</span><span class="k">this</span><span class="o">.</span><span class="na">number</span><span class="o">)</span>
      <span class="o">.</span><span class="na">select</span><span class="o">(</span><span class="k">new</span> <span class="n">SingleOutcome</span><span class="o">&lt;</span><span class="n">Utc</span><span class="o">&gt;(</span><span class="n">Utc</span><span class="o">.</span><span class="na">class</span><span class="o">));</span>
  <span class="o">}</span>
  <span class="kd">public</span> <span class="n">String</span> <span class="nf">title</span><span class="o">()</span> <span class="o">{</span>
    <span class="k">return</span> <span class="k">new</span> <span class="n">JdbcSession</span><span class="o">(</span><span class="k">this</span><span class="o">.</span><span class="na">dbase</span><span class="o">)</span>
      <span class="o">.</span><span class="na">sql</span><span class="o">(</span><span class="s">&quot;SELECT title FROM post WHERE id = ?&quot;</span><span class="o">)</span>
      <span class="o">.</span><span class="na">set</span><span class="o">(</span><span class="k">this</span><span class="o">.</span><span class="na">number</span><span class="o">)</span>
      <span class="o">.</span><span class="na">select</span><span class="o">(</span><span class="k">new</span> <span class="n">SingleOutcome</span><span class="o">&lt;</span><span class="n">String</span><span class="o">&gt;(</span><span class="n">String</span><span class="o">.</span><span class="na">class</span><span class="o">));</span>
  <span class="o">}</span>
<span class="o">}</span></code></pre></figure><p>This is how a full database interaction scenario would look like using the classes we just created:</p><figure class="highlight"><pre><code class="language-java" data-lang="java"><span></span><span class="n">Posts</span> <span class="n">posts</span> <span class="o">=</span> <span class="k">new</span> <span class="n">PgPosts</span><span class="o">(</span><span class="n">dbase</span><span class="o">);</span>
<span class="k">for</span> <span class="o">(</span><span class="n">Post</span> <span class="n">post</span> <span class="o">:</span> <span class="n">posts</span><span class="o">.</span><span class="na">iterate</span><span class="o">()){</span>
  <span class="n">System</span><span class="o">.</span><span class="na">out</span><span class="o">.</span><span class="na">println</span><span class="o">(</span><span class="s">&quot;Title: &quot;</span> <span class="o">+</span> <span class="n">post</span><span class="o">.</span><span class="na">title</span><span class="o">());</span>
<span class="o">}</span>
<span class="n">Post</span> <span class="n">post</span> <span class="o">=</span> <span class="n">posts</span><span class="o">.</span><span class="na">add</span><span class="o">(</span>
  <span class="k">new</span> <span class="n">Date</span><span class="o">(),</span> <span class="s">&quot;How to cook an omelette&quot;</span>
<span class="o">);</span>
<span class="n">System</span><span class="o">.</span><span class="na">out</span><span class="o">.</span><span class="na">println</span><span class="o">(</span><span class="s">&quot;Just added post #&quot;</span> <span class="o">+</span> <span class="n">post</span><span class="o">.</span><span class="na">id</span><span class="o">());</span></code></pre></figure><p>You can see a full practical example <a href="https://github.com/aintshy/hub/tree/0.7.2/src/main/java/com/aintshy/pgsql">here</a>. It&#39;s an open source web app that works with PostgreSQL using the exact approach explained above---SQL-speaking objects.</p><h2 id="what-about-performance">What About Performance?</h2><p>I can hear you screaming, &quot;What about performance?&quot; In that script a few lines above, we&#39;re making many redundant round trips to the database. First, we retrieve post IDs with <code>SELECT id</code> and then, in order to get their titles, we make an extra <code>SELECT title</code> call for each post. This is inefficient, or simply put, too slow.</p><p>No worries; this is object-oriented programming, which means it is flexible! Let&#39;s create a decorator of <code>PgPost</code> that will accept all data in its constructor and cache it internally, forever:</p><figure class="highlight"><pre><code class="language-java" data-lang="java"><span></span><span class="kd">final</span> <span class="kd">class</span> <span class="nc">ConstPost</span> <span class="kd">implements</span> <span class="n">Post</span> <span class="o">{</span>
  <span class="kd">private</span> <span class="kd">final</span> <span class="n">Post</span> <span class="n">origin</span><span class="o">;</span>
  <span class="kd">private</span> <span class="kd">final</span> <span class="n">Date</span> <span class="n">dte</span><span class="o">;</span>
  <span class="kd">private</span> <span class="kd">final</span> <span class="n">String</span> <span class="n">ttl</span><span class="o">;</span>
  <span class="kd">public</span> <span class="nf">ConstPost</span><span class="o">(</span><span class="n">Post</span> <span class="n">post</span><span class="o">,</span> <span class="n">Date</span> <span class="n">date</span><span class="o">,</span> <span class="n">String</span> <span class="n">title</span><span class="o">)</span> <span class="o">{</span>
    <span class="k">this</span><span class="o">.</span><span class="na">origin</span> <span class="o">=</span> <span class="n">post</span><span class="o">;</span>
    <span class="k">this</span><span class="o">.</span><span class="na">dte</span> <span class="o">=</span> <span class="n">date</span><span class="o">;</span>
    <span class="k">this</span><span class="o">.</span><span class="na">ttl</span> <span class="o">=</span> <span class="n">title</span><span class="o">;</span>
  <span class="o">}</span>
  <span class="kd">public</span> <span class="kt">int</span> <span class="nf">id</span><span class="o">()</span> <span class="o">{</span>
    <span class="k">return</span> <span class="k">this</span><span class="o">.</span><span class="na">origin</span><span class="o">.</span><span class="na">id</span><span class="o">();</span>
  <span class="o">}</span>
  <span class="kd">public</span> <span class="n">Date</span> <span class="nf">date</span><span class="o">()</span> <span class="o">{</span>
    <span class="k">return</span> <span class="k">this</span><span class="o">.</span><span class="na">dte</span><span class="o">;</span>
  <span class="o">}</span>
  <span class="kd">public</span> <span class="n">String</span> <span class="nf">title</span><span class="o">()</span> <span class="o">{</span>
    <span class="k">return</span> <span class="k">this</span><span class="o">.</span><span class="na">ttl</span><span class="o">;</span>
  <span class="o">}</span>
<span class="o">}</span></code></pre></figure><p>Pay attention: This decorator doesn&#39;t know anything about PostgreSQL or JDBC. It just decorates an object of type <code>Post</code> and pre-caches the date and title. As usual, this decorator is also immutable.</p><p>Now let&#39;s create another implementation of <code>Posts</code> that will return the &quot;constant&quot; objects:</p><figure class="highlight"><pre><code class="language-java" data-lang="java"><span></span><span class="kd">final</span> <span class="kd">class</span> <span class="nc">ConstPgPosts</span> <span class="kd">implements</span> <span class="n">Posts</span> <span class="o">{</span>
  <span class="c1">// ...</span>
  <span class="kd">public</span> <span class="n">Iterable</span><span class="o">&lt;</span><span class="n">Post</span><span class="o">&gt;</span> <span class="nf">iterate</span><span class="o">()</span> <span class="o">{</span>
    <span class="k">return</span> <span class="k">new</span> <span class="n">JdbcSession</span><span class="o">(</span><span class="k">this</span><span class="o">.</span><span class="na">dbase</span><span class="o">)</span>
      <span class="o">.</span><span class="na">sql</span><span class="o">(</span><span class="s">&quot;SELECT * FROM post&quot;</span><span class="o">)</span>
      <span class="o">.</span><span class="na">select</span><span class="o">(</span>
        <span class="k">new</span> <span class="n">ListOutcome</span><span class="o">&lt;</span><span class="n">Post</span><span class="o">&gt;(</span>
          <span class="k">new</span> <span class="n">ListOutcome</span><span class="o">.</span><span class="na">Mapping</span><span class="o">&lt;</span><span class="n">Post</span><span class="o">&gt;()</span> <span class="o">{</span>
            <span class="nd">@Override</span>
            <span class="kd">public</span> <span class="n">Post</span> <span class="nf">map</span><span class="o">(</span><span class="kd">final</span> <span class="n">ResultSet</span> <span class="n">rset</span><span class="o">)</span> <span class="o">{</span>
              <span class="k">return</span> <span class="k">new</span> <span class="n">ConstPost</span><span class="o">(</span>
                <span class="k">new</span> <span class="n">PgPost</span><span class="o">(</span>
                  <span class="n">ConstPgPosts</span><span class="o">.</span><span class="na">this</span><span class="o">.</span><span class="na">dbase</span><span class="o">,</span>
                  <span class="n">rset</span><span class="o">.</span><span class="na">getInt</span><span class="o">(</span><span class="mi">1</span><span class="o">)</span>
                <span class="o">),</span>
                <span class="n">Utc</span><span class="o">.</span><span class="na">getTimestamp</span><span class="o">(</span><span class="n">rset</span><span class="o">,</span> <span class="mi">2</span><span class="o">),</span>
                <span class="n">rset</span><span class="o">.</span><span class="na">getString</span><span class="o">(</span><span class="mi">3</span><span class="o">)</span>
              <span class="o">);</span>
            <span class="o">}</span>
          <span class="o">}</span>
        <span class="o">)</span>
      <span class="o">);</span>
  <span class="o">}</span>
<span class="o">}</span></code></pre></figure><p>Now all posts returned by <code>iterate()</code> of this new class are pre-equipped with dates and titles fetched in one round trip to the database.</p><p>Using <a href="/2015/02/26/composable-decorators.html">decorators</a> and multiple implementations of the same interface, you can compose any functionality you wish. What is the most important is that while functionality is being extended, the complexity of the design is not escalating, because classes don&#39;t grow in size. Instead, we&#39;re introducing new classes that stay cohesive and solid, because they are small.</p><h2 id="what-about-transactions">What About Transactions?</h2><p>Every object should deal with its own transactions and encapsulate them the same way as <code>SELECT</code> or <code>INSERT</code> queries. This will lead to nested transactions, which is perfectly fine provided the database server supports them. If there is no such support, create a session-wide transaction object that will accept a &quot;callable&quot; class. For example:</p><figure class="highlight"><pre><code class="language-java" data-lang="java"><span></span><span class="kd">final</span> <span class="kd">class</span> <span class="nc">Txn</span> <span class="o">{</span>
  <span class="kd">private</span> <span class="kd">final</span> <span class="n">DataSource</span> <span class="n">dbase</span><span class="o">;</span>
  <span class="kd">public</span> <span class="o">&lt;</span><span class="n">T</span><span class="o">&gt;</span> <span class="n">T</span> <span class="nf">call</span><span class="o">(</span><span class="n">Callable</span><span class="o">&lt;</span><span class="n">T</span><span class="o">&gt;</span> <span class="n">callable</span><span class="o">)</span> <span class="o">{</span>
    <span class="n">JdbcSession</span> <span class="n">session</span> <span class="o">=</span> <span class="k">new</span> <span class="n">JdbcSession</span><span class="o">(</span><span class="k">this</span><span class="o">.</span><span class="na">dbase</span><span class="o">);</span>
    <span class="k">try</span> <span class="o">{</span>
      <span class="n">session</span><span class="o">.</span><span class="na">sql</span><span class="o">(</span><span class="s">&quot;START TRANSACTION&quot;</span><span class="o">).</span><span class="na">exec</span><span class="o">();</span>
      <span class="n">T</span> <span class="n">result</span> <span class="o">=</span> <span class="n">callable</span><span class="o">.</span><span class="na">call</span><span class="o">();</span>
      <span class="n">session</span><span class="o">.</span><span class="na">sql</span><span class="o">(</span><span class="s">&quot;COMMIT&quot;</span><span class="o">).</span><span class="na">exec</span><span class="o">();</span>
      <span class="k">return</span> <span class="n">result</span><span class="o">;</span>
    <span class="o">}</span> <span class="k">catch</span> <span class="o">(</span><span class="n">Exception</span> <span class="n">ex</span><span class="o">)</span> <span class="o">{</span>
      <span class="n">session</span><span class="o">.</span><span class="na">sql</span><span class="o">(</span><span class="s">&quot;ROLLBACK&quot;</span><span class="o">).</span><span class="na">exec</span><span class="o">();</span>
      <span class="k">throw</span> <span class="n">ex</span><span class="o">;</span>
    <span class="o">}</span>
  <span class="o">}</span>
<span class="o">}</span></code></pre></figure><p>Then, when you want to wrap a few object manipulations in one transaction, do it like this:</p><figure class="highlight"><pre><code class="language-java" data-lang="java"><span></span><span class="k">new</span> <span class="n">Txn</span><span class="o">(</span><span class="n">dbase</span><span class="o">).</span><span class="na">call</span><span class="o">(</span>
  <span class="k">new</span> <span class="n">Callable</span><span class="o">&lt;</span><span class="n">Integer</span><span class="o">&gt;()</span> <span class="o">{</span>
    <span class="nd">@Override</span>
    <span class="kd">public</span> <span class="n">Integer</span> <span class="nf">call</span><span class="o">()</span> <span class="o">{</span>
      <span class="n">Posts</span> <span class="n">posts</span> <span class="o">=</span> <span class="k">new</span> <span class="n">PgPosts</span><span class="o">(</span><span class="n">dbase</span><span class="o">);</span>
      <span class="n">Post</span> <span class="n">post</span> <span class="o">=</span> <span class="n">posts</span><span class="o">.</span><span class="na">add</span><span class="o">(</span>
        <span class="k">new</span> <span class="n">Date</span><span class="o">(),</span> <span class="s">&quot;How to cook an omelette&quot;</span>
      <span class="o">);</span>
      <span class="n">posts</span><span class="o">.</span><span class="na">comments</span><span class="o">().</span><span class="na">post</span><span class="o">(</span><span class="s">&quot;This is my first comment!&quot;</span><span class="o">);</span>
      <span class="k">return</span> <span class="n">post</span><span class="o">.</span><span class="na">id</span><span class="o">();</span>
    <span class="o">}</span>
  <span class="o">}</span>
<span class="o">);</span></code></pre></figure><p>This code will create a new post and post a comment to it. If one of the calls fail, the entire transaction will be rolled back.</p><p>This approach looks object-oriented to me. I&#39;m calling it &quot;SQL-speaking objects,&quot; because they know how to speak SQL with the database server. It&#39;s their skill, perfectly encapsulated inside their borders.</p></p><nav class="buttons notranslate desktop-only"> <a href="http://www.facebook.com/sharer/sharer.php?u=https://www.yegor256.com/2014/12/01/orm-offensive-anti-pattern.html" title="Share on Facebook" class="button" rel="nofollow"> <span class="count count-facebook">0</span> <i class="icon icon-facebook notranslate" aria-hidden="true"></i> </a> <a href="https://twitter.com/share?url=https://www.yegor256.com/2014/12/01/orm-offensive-anti-pattern.html&amp;text=ORM+Is+an+Offensive+Anti-Pattern" title="Share on Twitter" class="button" rel="nofollow"> <span class="count count-twitter">0</span> <i class="icon icon-twitter notranslate" aria-hidden="true"></i> </a> <a href="https://plus.google.com/share?url=https://www.yegor256.com/2014/12/01/orm-offensive-anti-pattern.html" title="Share on Google+" class="button" rel="nofollow"> <span class="count count-googleplus">0</span> <i class="icon icon-googleplus notranslate" aria-hidden="true"></i> </a> <a href="https://www.linkedin.com/cws/share?url=https://www.yegor256.com/2014/12/01/orm-offensive-anti-pattern.html" title="Share on LinkedIn" class="button" rel="nofollow"> <span class="count count-linkedin">0</span> <i class="icon icon-linkedin notranslate" aria-hidden="true"></i> </a> <a href="http://reddit.com/submit?url=https://www.yegor256.com/2014/12/01/orm-offensive-anti-pattern.html%3F2014-48&amp;title=ORM+Is+an+Offensive+Anti-Pattern" title="Share on Reddit" class="button" rel="nofollow"> <span class="count count-reddit">0</span> <i class="icon icon-reddit notranslate" aria-hidden="true"></i> </a> <a href="http://news.ycombinator.com/submitlink?u=https://www.yegor256.com/2014/12/01/orm-offensive-anti-pattern.html%3F2014-48&amp;t=ORM+Is+an+Offensive+Anti-Pattern" title="Share on Hacker News" class="button" rel="nofollow"> <span class="count count-hackernews">0</span> <i class="icon icon-hackernews notranslate" aria-hidden="true"></i> </a> </nav> </header> <article class="main" itemprop="articleBody"><div ><p>TL;DR ORM is a terrible <a href="/2016/02/03/design-patterns-and-anti-patterns.html">anti-pattern</a> that violates all principles of object-oriented programming, tearing <a href="/2016/07/14/who-is-object.html">objects</a> apart and turning them into dumb and passive data bags. There is no excuse for ORM existence in any application, be it a small web app or an enterprise-size system with thousands of tables and CRUD manipulations on them. What is the alternative? <strong>SQL-speaking objects</strong>.</p><figure class='jb_picture'><img itemprop='image' alt='Vinni-Pukh (1969) by Fyodor Khitruk' src='/images/2014/11/broken-object.png' longdesc='#6ad080f0'/><figcaption id='6ad080f0'>Vinni-Pukh (1969) by Fyodor Khitruk</figcaption></figure><h2 id="how-orm-works">How ORM Works</h2><p><a href="https://en.wikipedia.org/wiki/Object-relational_mapping">Object-relational mapping</a> (ORM) is a technique (a.k.a. design pattern) of accessing a relational database from an object-oriented language (Java, for example). There are multiple implementations of ORM in almost every language; for example: <a href="http://hibernate.org/orm/">Hibernate</a> for Java, <a href="/2016/07/26/active-record.html">ActiveRecord</a> for Ruby on Rails, <a href="http://www.doctrine-project.org/">Doctrine</a> for PHP, and <a href="http://www.sqlalchemy.org/">SQLAlchemy</a> for Python. In Java, the ORM design is even standardized as <a href="https://en.wikipedia.org/wiki/Java_Persistence_API">JPA</a>.</p><p>First, let&#39;s see how ORM works, by example. Let&#39;s use Java, PostgreSQL, and Hibernate. Let&#39;s say we have a single table in the database, called <code>post</code>:</p><figure class="highlight"><pre><code class="language-text" data-lang="text"><span></span>+-----+------------+--------------------------+
| id  | date       | title                    |
+-----+------------+--------------------------+
|   9 | 10/24/2014 | How to cook a sandwich   |
|  13 | 11/03/2014 | My favorite movies       |
|  27 | 11/17/2014 | How much I love my job   |
+-----+------------+--------------------------+</code></pre></figure> <aside class='youtube'> <a href='https://www.youtube.com/watch?v=DEqcn4-freM'><div class='box'> <img src='https://i.ytimg.com/vi/DEqcn4-freM/mqdefault.jpg' alt='YouTube video #DEqcn4-freM'/><div class='play'><i class='icon icon-play'></i></div></div></a><div>Why ORM is an Anti-Pattern? (webinar #10); 6 January 2016.</div></aside><p>Now we want to CRUD-manipulate this table from our Java app (CRUD stands for create, read, update, and delete). First, we should create a <code>Post</code> class (I&#39;m sorry it&#39;s so long, but that&#39;s the best I can do):</p><figure class="highlight"><pre><code class="language-java" data-lang="java"><span></span><span class="nd">@Entity</span>
<span class="nd">@Table</span><span class="o">(</span><span class="n">name</span> <span class="o">=</span> <span class="s">&quot;post&quot;</span><span class="o">)</span>
<span class="kd">public</span> <span class="kd">class</span> <span class="nc">Post</span> <span class="o">{</span>
  <span class="kd">private</span> <span class="kt">int</span> <span class="n">id</span><span class="o">;</span>
  <span class="kd">private</span> <span class="n">Date</span> <span class="n">date</span><span class="o">;</span>
  <span class="kd">private</span> <span class="n">String</span> <span class="n">title</span><span class="o">;</span>
  <span class="nd">@Id</span>
  <span class="nd">@GeneratedValue</span>
  <span class="kd">public</span> <span class="kt">int</span> <span class="nf">getId</span><span class="o">()</span> <span class="o">{</span>
    <span class="k">return</span> <span class="k">this</span><span class="o">.</span><span class="na">id</span><span class="o">;</span>
  <span class="o">}</span>
  <span class="nd">@Temporal</span><span class="o">(</span><span class="n">TemporalType</span><span class="o">.</span><span class="na">TIMESTAMP</span><span class="o">)</span>
  <span class="kd">public</span> <span class="n">Date</span> <span class="nf">getDate</span><span class="o">()</span> <span class="o">{</span>
    <span class="k">return</span> <span class="k">this</span><span class="o">.</span><span class="na">date</span><span class="o">;</span>
  <span class="o">}</span>
  <span class="kd">public</span> <span class="n">Title</span> <span class="nf">getTitle</span><span class="o">()</span> <span class="o">{</span>
    <span class="k">return</span> <span class="k">this</span><span class="o">.</span><span class="na">title</span><span class="o">;</span>
  <span class="o">}</span>
  <span class="kd">public</span> <span class="kt">void</span> <span class="nf">setDate</span><span class="o">(</span><span class="n">Date</span> <span class="n">when</span><span class="o">)</span> <span class="o">{</span>
    <span class="k">this</span><span class="o">.</span><span class="na">date</span> <span class="o">=</span> <span class="n">when</span><span class="o">;</span>
  <span class="o">}</span>
  <span class="kd">public</span> <span class="kt">void</span> <span class="nf">setTitle</span><span class="o">(</span><span class="n">String</span> <span class="n">txt</span><span class="o">)</span> <span class="o">{</span>
    <span class="k">this</span><span class="o">.</span><span class="na">title</span> <span class="o">=</span> <span class="n">txt</span><span class="o">;</span>
  <span class="o">}</span>
<span class="o">}</span></code></pre></figure><p>Before any operation with Hibernate, we have to create a session factory:</p><figure class="highlight"><pre><code class="language-java" data-lang="java"><span></span><span class="n">SessionFactory</span> <span class="n">factory</span> <span class="o">=</span> <span class="k">new</span> <span class="n">AnnotationConfiguration</span><span class="o">()</span>
  <span class="o">.</span><span class="na">configure</span><span class="o">()</span>
  <span class="o">.</span><span class="na">addAnnotatedClass</span><span class="o">(</span><span class="n">Post</span><span class="o">.</span><span class="na">class</span><span class="o">)</span>
  <span class="o">.</span><span class="na">buildSessionFactory</span><span class="o">();</span></code></pre></figure><p>This factory will give us &quot;sessions&quot; every time we want to manipulate with <code>Post</code> objects. Every manipulation with the session should be wrapped in this code block:</p><figure class="highlight"><pre><code class="language-java" data-lang="java"><span></span><span class="n">Session</span> <span class="n">session</span> <span class="o">=</span> <span class="n">factory</span><span class="o">.</span><span class="na">openSession</span><span class="o">();</span>
<span class="k">try</span> <span class="o">{</span>
  <span class="n">Transaction</span> <span class="n">txn</span> <span class="o">=</span> <span class="n">session</span><span class="o">.</span><span class="na">beginTransaction</span><span class="o">();</span>
  <span class="c1">// your manipulations with the ORM, see below</span>
  <span class="n">txn</span><span class="o">.</span><span class="na">commit</span><span class="o">();</span>
<span class="o">}</span> <span class="k">catch</span> <span class="o">(</span><span class="n">HibernateException</span> <span class="n">ex</span><span class="o">)</span> <span class="o">{</span>
  <span class="n">txn</span><span class="o">.</span><span class="na">rollback</span><span class="o">();</span>
<span class="o">}</span> <span class="k">finally</span> <span class="o">{</span>
  <span class="n">session</span><span class="o">.</span><span class="na">close</span><span class="o">();</span>
<span class="o">}</span></code></pre></figure><p>When the session is ready, here is how we get a list of all posts from that database table:</p><figure class="highlight"><pre><code class="language-java" data-lang="java"><span></span><span class="n">List</span> <span class="n">posts</span> <span class="o">=</span> <span class="n">session</span><span class="o">.</span><span class="na">createQuery</span><span class="o">(</span><span class="s">&quot;FROM Post&quot;</span><span class="o">).</span><span class="na">list</span><span class="o">();</span>
<span class="k">for</span> <span class="o">(</span><span class="n">Post</span> <span class="n">post</span> <span class="o">:</span> <span class="o">(</span><span class="n">List</span><span class="o">&lt;</span><span class="n">Post</span><span class="o">&gt;)</span> <span class="n">posts</span><span class="o">){</span>
  <span class="n">System</span><span class="o">.</span><span class="na">out</span><span class="o">.</span><span class="na">println</span><span class="o">(</span><span class="s">&quot;Title: &quot;</span> <span class="o">+</span> <span class="n">post</span><span class="o">.</span><span class="na">getTitle</span><span class="o">());</span>
<span class="o">}</span></code></pre></figure><p>I think it&#39;s clear what&#39;s going on here. Hibernate is a big, powerful engine that makes a connection to the database, executes necessary SQL <code>SELECT</code> requests, and retrieves the data. Then it makes instances of class <code>Post</code> and stuffs them with the data. When the object comes to us, it is filled with data, and we should use getters to take them out, like we&#39;re using <code>getTitle()</code> above.</p><aside class='youtube'> <a href='https://www.youtube.com/watch?v=aER4uwyFbqQ'><div class='box'> <img src='https://i.ytimg.com/vi/aER4uwyFbqQ/mqdefault.jpg' alt='YouTube video #aER4uwyFbqQ'/><div class='play'><i class='icon icon-play'></i></div></div></a><div>ORM is offensive (in Russian with English subtitles); 24 April 2016.</div></aside><p>When we want to do a reverse operation and send an object to the database, we do all of the same but in reverse order. We make an instance of class <code>Post</code>, stuff it with the data, and ask Hibernate to save it:</p><figure class="highlight"><pre><code class="language-java" data-lang="java"><span></span><span class="n">Post</span> <span class="n">post</span> <span class="o">=</span> <span class="k">new</span> <span class="n">Post</span><span class="o">();</span>
<span class="n">post</span><span class="o">.</span><span class="na">setDate</span><span class="o">(</span><span class="k">new</span> <span class="n">Date</span><span class="o">());</span>
<span class="n">post</span><span class="o">.</span><span class="na">setTitle</span><span class="o">(</span><span class="s">&quot;How to cook an omelette&quot;</span><span class="o">);</span>
<span class="n">session</span><span class="o">.</span><span class="na">save</span><span class="o">(</span><span class="n">post</span><span class="o">);</span></code></pre></figure><p>This is how almost every ORM works. The basic principle is always the same---ORM objects are <a href="/2016/07/06/data-transfer-object.html">anemic envelopes</a> with data. We are talking with the ORM framework, and the framework is talking to the database. Objects only help us send our requests to the ORM framework and understand its response. Besides <a href="/2016/07/18/law-of-demeter.html">getters and setters</a>, objects have no other methods. They don&#39;t even know which database they came from.</p><p>This is how object-relational mapping works.</p><p>What&#39;s wrong with it, you may ask? Everything!</p><h2 id="whats-wrong-with-orm">What&#39;s Wrong With ORM?</h2><p>Seriously, what is wrong? Hibernate has been one of the most popular Java libraries for more than 10 years already. Almost every SQL-intensive application in the world is using it. Each Java tutorial would mention Hibernate (or maybe <a href="https://en.wikipedia.org/wiki/List_of_object-relational_mapping_software">some other ORM</a> like TopLink or OpenJPA) for a database-connected application. It&#39;s a standard <em>de-facto</em> and still I&#39;m saying that it&#39;s wrong? Yes.</p><p>I&#39;m claiming that the entire idea behind ORM is wrong. Its invention was maybe the second big mistake in <a href="/2016/08/15/what-is-wrong-object-oriented-programming.html">OOP</a> after <a href="/2014/05/13/why-null-is-bad.html">NULL reference</a>.</p><aside class='quote'>ORM, instead of encapsulating database interaction inside an object, extracts it away, literally tearing a solid and cohesive living organism apart</aside><p>Actually, I&#39;m not the only one saying something like this, and definitely not the first. A lot about this subject has already been published by very respected authors, including <a href="http://martinfowler.com/bliki/OrmHate.html">OrmHate</a> by Martin Fowler (not against ORM, but worth mentioning anyway), <a href="http://blog.codinghorror.com/object-relational-mapping-is-the-vietnam-of-computer-science/">Object-Relational Mapping Is the Vietnam of Computer Science</a> by Jeff Atwood, <a href="http://blogs.tedneward.com/2006/06/26/The+Vietnam+Of+Computer+Science.aspx">The Vietnam of Computer Science</a> by Ted Neward, <a href="http://seldo.com/weblog/2011/08/11/orm_is_an_antipattern">ORM Is an Anti-Pattern</a> by Laurie Voss, and many others.</p><p>However, my argument is different than what they&#39;re saying. Even though their reasons are practical and valid, like &quot;ORM is slow&quot; or &quot;database upgrades are hard,&quot; they miss the main point. You can see a very good, practical answer to these practical arguments given by Bozhidar Bozhanov in his <a href="http://techblog.bozho.net/orm-haters-dont-get-it/">ORM Haters Don’t Get It</a> blog post.</p><figure class='badge'><img src='https://www.yegor256.com/images/2014/11/orm-anti-pattern.svg' style='width:413px;max-width:100%;' alt='badge'/></figure><p>The main point is that ORM, instead of encapsulating database interaction inside an object, extracts it away, literally tearing a solid and cohesive <a href="/2014/11/20/seven-virtues-of-good-object.html">living organism</a> apart. One part of the object keeps the data while another one, implemented inside the ORM engine (session factory), knows how to deal with this data and transfers it to the relational database. Look at this picture; it illustrates what ORM is doing.</p><p>I, being a reader of posts, have to deal with two components: 1) the ORM and 2) the &quot;ob-truncated&quot; object returned to me. The behavior I&#39;m interacting with is supposed to be provided through a single entry point, which is an object in OOP. In the case of ORM, I&#39;m getting this behavior via <strong>two</strong> entry points---the ORM engine and the &quot;thing,&quot; which we can&#39;t even call an object.</p><p>Because of this terrible and offensive violation of the object-oriented paradigm, we have a lot of practical issues already mentioned in respected publications. I can only add a few more.</p><aside class='youtube'> <a href='https://www.youtube.com/watch?v=63tS3HNmhiE'><div class='box'> <img src='https://i.ytimg.com/vi/63tS3HNmhiE/mqdefault.jpg' alt='YouTube video #63tS3HNmhiE'/><div class='play'><i class='icon icon-play'></i></div></div></a><div>ORM is a perfect anti-pattern; 23 May 2016.</div></aside><p><strong>SQL Is Not Hidden</strong>. Users of ORM should speak SQL (or its dialect, like <a href="https://docs.jboss.org/hibernate/orm/3.3/reference/en/html/queryhql.html">HQL</a>). See the example above; we&#39;re calling <code>session.createQuery(&quot;FROM Post&quot;)</code> in order to get all posts. Even though it&#39;s not SQL, it is very similar to it. Thus, the relational model is not encapsulated inside objects. Instead, it is exposed to the entire application. Everybody, with each object, inevitably has to deal with a relational model in order to get or save something. Thus, ORM doesn&#39;t hide and wrap the SQL but pollutes the entire application with it.</p><p><strong>Difficult to Test</strong>. When some object is working with a list of posts, it needs to deal with an instance of <code>SessionFactory</code>. How can we <a href="/2014/09/23/built-in-fake-objects.html">mock</a> this dependency? We have to create a mock of it? How complex is this task? Look at the code above, and you will realize how verbose and cumbersome that unit test will be. Instead, we can write integration tests and connect the entire application to a test version of PostgreSQL. In that case, there is no need to mock <code>SessionFactory</code>, but such tests will be rather slow, and even more important, our having-nothing-to-do-with-the-database objects will be tested against the database instance. A terrible design.</p><p>Again, let me reiterate. Practical problems of ORM are just consequences. The fundamental drawback is that ORM tears objects apart, terribly and offensively violating the very idea of <a href="/2014/11/20/seven-virtues-of-good-object.html">what an object is</a>.</p><h2 id="sql-speaking-objects">SQL-Speaking Objects</h2><figure class='badge'><img src='https://www.yegor256.com/images/2014/11/sql-speaking-object.svg' style='width:213px;max-width:100%;' alt='badge'/></figure><p>What is the alternative? Let me show it to you by example. Let&#39;s try to design that class, <code>Post</code>, my way. We&#39;ll have to break it down into two classes: <code>Post</code> and <code>Posts</code>, singular and plural. I already mentioned in one of my previous <a href="/2014/11/20/seven-virtues-of-good-object.html">articles</a> that a good object is always an abstraction of a real-life entity. Here is how this principle works in practice. We have two entities: database table and table row. That&#39;s why we&#39;ll make two classes; <code>Posts</code> will represent the table, and <code>Post</code> will represent the row.</p><p>As I also mentioned in that <a href="/2014/11/20/seven-virtues-of-good-object.html">article</a>, every object should work by contract and implement an interface. Let&#39;s start our design with two <a href="/2016/04/26/why-inputstream-design-is-wrong.html">interfaces</a>. Of course, our objects will be <a href="/2014/12/22/immutable-objects-not-dumb.html">immutable</a>. Here is how <code>Posts</code> would look:</p><figure class="highlight"><pre><code class="language-java" data-lang="java"><span></span><span class="kd">interface</span> <span class="nc">Posts</span> <span class="o">{</span>
  <span class="n">Iterable</span><span class="o">&lt;</span><span class="n">Post</span><span class="o">&gt;</span> <span class="nf">iterate</span><span class="o">();</span>
  <span class="n">Post</span> <span class="nf">add</span><span class="o">(</span><span class="n">Date</span> <span class="n">date</span><span class="o">,</span> <span class="n">String</span> <span class="n">title</span><span class="o">);</span>
<span class="o">}</span></code></pre></figure><p>This is how a single <code>Post</code> would look:</p><figure class="highlight"><pre><code class="language-java" data-lang="java"><span></span><span class="kd">interface</span> <span class="nc">Post</span> <span class="o">{</span>
  <span class="kt">int</span> <span class="nf">id</span><span class="o">();</span>
  <span class="n">Date</span> <span class="nf">date</span><span class="o">();</span>
  <span class="n">String</span> <span class="nf">title</span><span class="o">();</span>
<span class="o">}</span></code></pre></figure><p>Here is how we will list all posts in the database table:</p><figure class="highlight"><pre><code class="language-java" data-lang="java"><span></span><span class="n">Posts</span> <span class="n">posts</span> <span class="o">=</span> <span class="c1">// we&#39;ll discuss this right now</span>
<span class="k">for</span> <span class="o">(</span><span class="n">Post</span> <span class="n">post</span> <span class="o">:</span> <span class="n">posts</span><span class="o">.</span><span class="na">iterate</span><span class="o">()){</span>
  <span class="n">System</span><span class="o">.</span><span class="na">out</span><span class="o">.</span><span class="na">println</span><span class="o">(</span><span class="s">&quot;Title: &quot;</span> <span class="o">+</span> <span class="n">post</span><span class="o">.</span><span class="na">title</span><span class="o">());</span>
<span class="o">}</span></code></pre></figure><p>Here is how we will create a new post:</p><figure class="highlight"><pre><code class="language-java" data-lang="java"><span></span><span class="n">Posts</span> <span class="n">posts</span> <span class="o">=</span> <span class="c1">// we&#39;ll discuss this right now</span>
<span class="n">posts</span><span class="o">.</span><span class="na">add</span><span class="o">(</span><span class="k">new</span> <span class="n">Date</span><span class="o">(),</span> <span class="s">&quot;How to cook an omelette&quot;</span><span class="o">);</span></code></pre></figure><p>As you see, we have true objects now. They are in charge of all operations, and they perfectly hide their implementation details. There are no transactions, sessions, or factories. We don&#39;t even know whether these objects are actually talking to the PostgreSQL or if they keep all the data in text files. All we need from <code>Posts</code> is an ability to list all posts for us and to create a new one. Implementation details are perfectly hidden inside. Now let&#39;s see how we can implement these two classes.</p><aside class='youtube'> <a href='https://www.youtube.com/watch?v=03PXmPc7Q3g'><div class='box'> <img src='https://i.ytimg.com/vi/03PXmPc7Q3g/mqdefault.jpg' alt='YouTube video #03PXmPc7Q3g'/><div class='play'><i class='icon icon-play'></i></div></div></a><div>ORM is an Offensive Anti-Pattern; 9 November 2016.</div></aside><p>I&#39;m going to use <a href="http://jdbc.jcabi.com">jcabi-jdbc</a> as a JDBC wrapper, but you can use something else like <a href="http://www.jooq.org">jOOQ</a>, or just plain JDBC if you like. It doesn&#39;t really matter. What matters is that your database interactions are hidden inside objects. Let&#39;s start with <code>Posts</code> and implement it in class <code>PgPosts</code> (&quot;pg&quot; stands for PostgreSQL):</p><figure class="highlight"><pre><code class="language-java" data-lang="java"><span></span><span class="kd">final</span> <span class="kd">class</span> <span class="nc">PgPosts</span> <span class="kd">implements</span> <span class="n">Posts</span> <span class="o">{</span>
  <span class="kd">private</span> <span class="kd">final</span> <span class="n">Source</span> <span class="n">dbase</span><span class="o">;</span>
  <span class="kd">public</span> <span class="nf">PgPosts</span><span class="o">(</span><span class="n">DataSource</span> <span class="n">data</span><span class="o">)</span> <span class="o">{</span>
    <span class="k">this</span><span class="o">.</span><span class="na">dbase</span> <span class="o">=</span> <span class="n">data</span><span class="o">;</span>
  <span class="o">}</span>
  <span class="kd">public</span> <span class="n">Iterable</span><span class="o">&lt;</span><span class="n">Post</span><span class="o">&gt;</span> <span class="nf">iterate</span><span class="o">()</span> <span class="o">{</span>
    <span class="k">return</span> <span class="k">new</span> <span class="n">JdbcSession</span><span class="o">(</span><span class="k">this</span><span class="o">.</span><span class="na">dbase</span><span class="o">)</span>
      <span class="o">.</span><span class="na">sql</span><span class="o">(</span><span class="s">&quot;SELECT id FROM post&quot;</span><span class="o">)</span>
      <span class="o">.</span><span class="na">select</span><span class="o">(</span>
        <span class="k">new</span> <span class="n">ListOutcome</span><span class="o">&lt;</span><span class="n">Post</span><span class="o">&gt;(</span>
          <span class="k">new</span> <span class="n">ListOutcome</span><span class="o">.</span><span class="na">Mapping</span><span class="o">&lt;</span><span class="n">Post</span><span class="o">&gt;()</span> <span class="o">{</span>
            <span class="nd">@Override</span>
            <span class="kd">public</span> <span class="n">Post</span> <span class="nf">map</span><span class="o">(</span><span class="kd">final</span> <span class="n">ResultSet</span> <span class="n">rset</span><span class="o">)</span> <span class="o">{</span>
              <span class="k">return</span> <span class="k">new</span> <span class="n">PgPost</span><span class="o">(</span>
                <span class="k">this</span><span class="o">.</span><span class="na">dbase</span><span class="o">,</span>
                <span class="n">rset</span><span class="o">.</span><span class="na">getInt</span><span class="o">(</span><span class="mi">1</span><span class="o">)</span>
              <span class="o">);</span>
            <span class="o">}</span>
          <span class="o">}</span>
        <span class="o">)</span>
      <span class="o">);</span>
  <span class="o">}</span>
  <span class="kd">public</span> <span class="n">Post</span> <span class="nf">add</span><span class="o">(</span><span class="n">Date</span> <span class="n">date</span><span class="o">,</span> <span class="n">String</span> <span class="n">title</span><span class="o">)</span> <span class="o">{</span>
    <span class="k">return</span> <span class="k">new</span> <span class="n">PgPost</span><span class="o">(</span>
      <span class="k">this</span><span class="o">.</span><span class="na">dbase</span><span class="o">,</span>
      <span class="k">new</span> <span class="n">JdbcSession</span><span class="o">(</span><span class="k">this</span><span class="o">.</span><span class="na">dbase</span><span class="o">)</span>
        <span class="o">.</span><span class="na">sql</span><span class="o">(</span><span class="s">&quot;INSERT INTO post (date, title) VALUES (?, ?)&quot;</span><span class="o">)</span>
        <span class="o">.</span><span class="na">set</span><span class="o">(</span><span class="k">new</span> <span class="n">Utc</span><span class="o">(</span><span class="n">date</span><span class="o">))</span>
        <span class="o">.</span><span class="na">set</span><span class="o">(</span><span class="n">title</span><span class="o">)</span>
        <span class="o">.</span><span class="na">insert</span><span class="o">(</span><span class="k">new</span> <span class="n">SingleOutcome</span><span class="o">&lt;</span><span class="n">Integer</span><span class="o">&gt;(</span><span class="n">Integer</span><span class="o">.</span><span class="na">class</span><span class="o">))</span>
    <span class="o">);</span>
  <span class="o">}</span>
<span class="o">}</span></code></pre></figure><p>Next, let&#39;s implement the <code>Post</code> interface in class <code>PgPost</code>:</p><figure class="highlight"><pre><code class="language-java" data-lang="java"><span></span><span class="kd">final</span> <span class="kd">class</span> <span class="nc">PgPost</span> <span class="kd">implements</span> <span class="n">Post</span> <span class="o">{</span>
  <span class="kd">private</span> <span class="kd">final</span> <span class="n">Source</span> <span class="n">dbase</span><span class="o">;</span>
  <span class="kd">private</span> <span class="kd">final</span> <span class="kt">int</span> <span class="n">number</span><span class="o">;</span>
  <span class="kd">public</span> <span class="nf">PgPost</span><span class="o">(</span><span class="n">DataSource</span> <span class="n">data</span><span class="o">,</span> <span class="kt">int</span> <span class="n">id</span><span class="o">)</span> <span class="o">{</span>
    <span class="k">this</span><span class="o">.</span><span class="na">dbase</span> <span class="o">=</span> <span class="n">data</span><span class="o">;</span>
    <span class="k">this</span><span class="o">.</span><span class="na">number</span> <span class="o">=</span> <span class="n">id</span><span class="o">;</span>
  <span class="o">}</span>
  <span class="kd">public</span> <span class="kt">int</span> <span class="nf">id</span><span class="o">()</span> <span class="o">{</span>
    <span class="k">return</span> <span class="k">this</span><span class="o">.</span><span class="na">number</span><span class="o">;</span>
  <span class="o">}</span>
  <span class="kd">public</span> <span class="n">Date</span> <span class="nf">date</span><span class="o">()</span> <span class="o">{</span>
    <span class="k">return</span> <span class="k">new</span> <span class="n">JdbcSession</span><span class="o">(</span><span class="k">this</span><span class="o">.</span><span class="na">dbase</span><span class="o">)</span>
      <span class="o">.</span><span class="na">sql</span><span class="o">(</span><span class="s">&quot;SELECT date FROM post WHERE id = ?&quot;</span><span class="o">)</span>
      <span class="o">.</span><span class="na">set</span><span class="o">(</span><span class="k">this</span><span class="o">.</span><span class="na">number</span><span class="o">)</span>
      <span class="o">.</span><span class="na">select</span><span class="o">(</span><span class="k">new</span> <span class="n">SingleOutcome</span><span class="o">&lt;</span><span class="n">Utc</span><span class="o">&gt;(</span><span class="n">Utc</span><span class="o">.</span><span class="na">class</span><span class="o">));</span>
  <span class="o">}</span>
  <span class="kd">public</span> <span class="n">String</span> <span class="nf">title</span><span class="o">()</span> <span class="o">{</span>
    <span class="k">return</span> <span class="k">new</span> <span class="n">JdbcSession</span><span class="o">(</span><span class="k">this</span><span class="o">.</span><span class="na">dbase</span><span class="o">)</span>
      <span class="o">.</span><span class="na">sql</span><span class="o">(</span><span class="s">&quot;SELECT title FROM post WHERE id = ?&quot;</span><span class="o">)</span>
      <span class="o">.</span><span class="na">set</span><span class="o">(</span><span class="k">this</span><span class="o">.</span><span class="na">number</span><span class="o">)</span>
      <span class="o">.</span><span class="na">select</span><span class="o">(</span><span class="k">new</span> <span class="n">SingleOutcome</span><span class="o">&lt;</span><span class="n">String</span><span class="o">&gt;(</span><span class="n">String</span><span class="o">.</span><span class="na">class</span><span class="o">));</span>
  <span class="o">}</span>
<span class="o">}</span></code></pre></figure><p>This is how a full database interaction scenario would look like using the classes we just created:</p><figure class="highlight"><pre><code class="language-java" data-lang="java"><span></span><span class="n">Posts</span> <span class="n">posts</span> <span class="o">=</span> <span class="k">new</span> <span class="n">PgPosts</span><span class="o">(</span><span class="n">dbase</span><span class="o">);</span>
<span class="k">for</span> <span class="o">(</span><span class="n">Post</span> <span class="n">post</span> <span class="o">:</span> <span class="n">posts</span><span class="o">.</span><span class="na">iterate</span><span class="o">()){</span>
  <span class="n">System</span><span class="o">.</span><span class="na">out</span><span class="o">.</span><span class="na">println</span><span class="o">(</span><span class="s">&quot;Title: &quot;</span> <span class="o">+</span> <span class="n">post</span><span class="o">.</span><span class="na">title</span><span class="o">());</span>
<span class="o">}</span>
<span class="n">Post</span> <span class="n">post</span> <span class="o">=</span> <span class="n">posts</span><span class="o">.</span><span class="na">add</span><span class="o">(</span>
  <span class="k">new</span> <span class="n">Date</span><span class="o">(),</span> <span class="s">&quot;How to cook an omelette&quot;</span>
<span class="o">);</span>
<span class="n">System</span><span class="o">.</span><span class="na">out</span><span class="o">.</span><span class="na">println</span><span class="o">(</span><span class="s">&quot;Just added post #&quot;</span> <span class="o">+</span> <span class="n">post</span><span class="o">.</span><span class="na">id</span><span class="o">());</span></code></pre></figure><p>You can see a full practical example <a href="https://github.com/aintshy/hub/tree/0.7.2/src/main/java/com/aintshy/pgsql">here</a>. It&#39;s an open source web app that works with PostgreSQL using the exact approach explained above---SQL-speaking objects.</p><h2 id="what-about-performance">What About Performance?</h2><p>I can hear you screaming, &quot;What about performance?&quot; In that script a few lines above, we&#39;re making many redundant round trips to the database. First, we retrieve post IDs with <code>SELECT id</code> and then, in order to get their titles, we make an extra <code>SELECT title</code> call for each post. This is inefficient, or simply put, too slow.</p><p>No worries; this is object-oriented programming, which means it is flexible! Let&#39;s create a decorator of <code>PgPost</code> that will accept all data in its constructor and cache it internally, forever:</p><figure class="highlight"><pre><code class="language-java" data-lang="java"><span></span><span class="kd">final</span> <span class="kd">class</span> <span class="nc">ConstPost</span> <span class="kd">implements</span> <span class="n">Post</span> <span class="o">{</span>
  <span class="kd">private</span> <span class="kd">final</span> <span class="n">Post</span> <span class="n">origin</span><span class="o">;</span>
  <span class="kd">private</span> <span class="kd">final</span> <span class="n">Date</span> <span class="n">dte</span><span class="o">;</span>
  <span class="kd">private</span> <span class="kd">final</span> <span class="n">String</span> <span class="n">ttl</span><span class="o">;</span>
  <span class="kd">public</span> <span class="nf">ConstPost</span><span class="o">(</span><span class="n">Post</span> <span class="n">post</span><span class="o">,</span> <span class="n">Date</span> <span class="n">date</span><span class="o">,</span> <span class="n">String</span> <span class="n">title</span><span class="o">)</span> <span class="o">{</span>
    <span class="k">this</span><span class="o">.</span><span class="na">origin</span> <span class="o">=</span> <span class="n">post</span><span class="o">;</span>
    <span class="k">this</span><span class="o">.</span><span class="na">dte</span> <span class="o">=</span> <span class="n">date</span><span class="o">;</span>
    <span class="k">this</span><span class="o">.</span><span class="na">ttl</span> <span class="o">=</span> <span class="n">title</span><span class="o">;</span>
  <span class="o">}</span>
  <span class="kd">public</span> <span class="kt">int</span> <span class="nf">id</span><span class="o">()</span> <span class="o">{</span>
    <span class="k">return</span> <span class="k">this</span><span class="o">.</span><span class="na">origin</span><span class="o">.</span><span class="na">id</span><span class="o">();</span>
  <span class="o">}</span>
  <span class="kd">public</span> <span class="n">Date</span> <span class="nf">date</span><span class="o">()</span> <span class="o">{</span>
    <span class="k">return</span> <span class="k">this</span><span class="o">.</span><span class="na">dte</span><span class="o">;</span>
  <span class="o">}</span>
  <span class="kd">public</span> <span class="n">String</span> <span class="nf">title</span><span class="o">()</span> <span class="o">{</span>
    <span class="k">return</span> <span class="k">this</span><span class="o">.</span><span class="na">ttl</span><span class="o">;</span>
  <span class="o">}</span>
<span class="o">}</span></code></pre></figure><p>Pay attention: This decorator doesn&#39;t know anything about PostgreSQL or JDBC. It just decorates an object of type <code>Post</code> and pre-caches the date and title. As usual, this decorator is also immutable.</p><p>Now let&#39;s create another implementation of <code>Posts</code> that will return the &quot;constant&quot; objects:</p><figure class="highlight"><pre><code class="language-java" data-lang="java"><span></span><span class="kd">final</span> <span class="kd">class</span> <span class="nc">ConstPgPosts</span> <span class="kd">implements</span> <span class="n">Posts</span> <span class="o">{</span>
  <span class="c1">// ...</span>
  <span class="kd">public</span> <span class="n">Iterable</span><span class="o">&lt;</span><span class="n">Post</span><span class="o">&gt;</span> <span class="nf">iterate</span><span class="o">()</span> <span class="o">{</span>
    <span class="k">return</span> <span class="k">new</span> <span class="n">JdbcSession</span><span class="o">(</span><span class="k">this</span><span class="o">.</span><span class="na">dbase</span><span class="o">)</span>
      <span class="o">.</span><span class="na">sql</span><span class="o">(</span><span class="s">&quot;SELECT * FROM post&quot;</span><span class="o">)</span>
      <span class="o">.</span><span class="na">select</span><span class="o">(</span>
        <span class="k">new</span> <span class="n">ListOutcome</span><span class="o">&lt;</span><span class="n">Post</span><span class="o">&gt;(</span>
          <span class="k">new</span> <span class="n">ListOutcome</span><span class="o">.</span><span class="na">Mapping</span><span class="o">&lt;</span><span class="n">Post</span><span class="o">&gt;()</span> <span class="o">{</span>
            <span class="nd">@Override</span>
            <span class="kd">public</span> <span class="n">Post</span> <span class="nf">map</span><span class="o">(</span><span class="kd">final</span> <span class="n">ResultSet</span> <span class="n">rset</span><span class="o">)</span> <span class="o">{</span>
              <span class="k">return</span> <span class="k">new</span> <span class="n">ConstPost</span><span class="o">(</span>
                <span class="k">new</span> <span class="n">PgPost</span><span class="o">(</span>
                  <span class="n">ConstPgPosts</span><span class="o">.</span><span class="na">this</span><span class="o">.</span><span class="na">dbase</span><span class="o">,</span>
                  <span class="n">rset</span><span class="o">.</span><span class="na">getInt</span><span class="o">(</span><span class="mi">1</span><span class="o">)</span>
                <span class="o">),</span>
                <span class="n">Utc</span><span class="o">.</span><span class="na">getTimestamp</span><span class="o">(</span><span class="n">rset</span><span class="o">,</span> <span class="mi">2</span><span class="o">),</span>
                <span class="n">rset</span><span class="o">.</span><span class="na">getString</span><span class="o">(</span><span class="mi">3</span><span class="o">)</span>
              <span class="o">);</span>
            <span class="o">}</span>
          <span class="o">}</span>
        <span class="o">)</span>
      <span class="o">);</span>
  <span class="o">}</span>
<span class="o">}</span></code></pre></figure><p>Now all posts returned by <code>iterate()</code> of this new class are pre-equipped with dates and titles fetched in one round trip to the database.</p><p>Using <a href="/2015/02/26/composable-decorators.html">decorators</a> and multiple implementations of the same interface, you can compose any functionality you wish. What is the most important is that while functionality is being extended, the complexity of the design is not escalating, because classes don&#39;t grow in size. Instead, we&#39;re introducing new classes that stay cohesive and solid, because they are small.</p><h2 id="what-about-transactions">What About Transactions?</h2><p>Every object should deal with its own transactions and encapsulate them the same way as <code>SELECT</code> or <code>INSERT</code> queries. This will lead to nested transactions, which is perfectly fine provided the database server supports them. If there is no such support, create a session-wide transaction object that will accept a &quot;callable&quot; class. For example:</p><figure class="highlight"><pre><code class="language-java" data-lang="java"><span></span><span class="kd">final</span> <span class="kd">class</span> <span class="nc">Txn</span> <span class="o">{</span>
  <span class="kd">private</span> <span class="kd">final</span> <span class="n">DataSource</span> <span class="n">dbase</span><span class="o">;</span>
  <span class="kd">public</span> <span class="o">&lt;</span><span class="n">T</span><span class="o">&gt;</span> <span class="n">T</span> <span class="nf">call</span><span class="o">(</span><span class="n">Callable</span><span class="o">&lt;</span><span class="n">T</span><span class="o">&gt;</span> <span class="n">callable</span><span class="o">)</span> <span class="o">{</span>
    <span class="n">JdbcSession</span> <span class="n">session</span> <span class="o">=</span> <span class="k">new</span> <span class="n">JdbcSession</span><span class="o">(</span><span class="k">this</span><span class="o">.</span><span class="na">dbase</span><span class="o">);</span>
    <span class="k">try</span> <span class="o">{</span>
      <span class="n">session</span><span class="o">.</span><span class="na">sql</span><span class="o">(</span><span class="s">&quot;START TRANSACTION&quot;</span><span class="o">).</span><span class="na">exec</span><span class="o">();</span>
      <span class="n">T</span> <span class="n">result</span> <span class="o">=</span> <span class="n">callable</span><span class="o">.</span><span class="na">call</span><span class="o">();</span>
      <span class="n">session</span><span class="o">.</span><span class="na">sql</span><span class="o">(</span><span class="s">&quot;COMMIT&quot;</span><span class="o">).</span><span class="na">exec</span><span class="o">();</span>
      <span class="k">return</span> <span class="n">result</span><span class="o">;</span>
    <span class="o">}</span> <span class="k">catch</span> <span class="o">(</span><span class="n">Exception</span> <span class="n">ex</span><span class="o">)</span> <span class="o">{</span>
      <span class="n">session</span><span class="o">.</span><span class="na">sql</span><span class="o">(</span><span class="s">&quot;ROLLBACK&quot;</span><span class="o">).</span><span class="na">exec</span><span class="o">();</span>
      <span class="k">throw</span> <span class="n">ex</span><span class="o">;</span>
    <span class="o">}</span>
  <span class="o">}</span>
<span class="o">}</span></code></pre></figure><p>Then, when you want to wrap a few object manipulations in one transaction, do it like this:</p><figure class="highlight"><pre><code class="language-java" data-lang="java"><span></span><span class="k">new</span> <span class="n">Txn</span><span class="o">(</span><span class="n">dbase</span><span class="o">).</span><span class="na">call</span><span class="o">(</span>
  <span class="k">new</span> <span class="n">Callable</span><span class="o">&lt;</span><span class="n">Integer</span><span class="o">&gt;()</span> <span class="o">{</span>
    <span class="nd">@Override</span>
    <span class="kd">public</span> <span class="n">Integer</span> <span class="nf">call</span><span class="o">()</span> <span class="o">{</span>
      <span class="n">Posts</span> <span class="n">posts</span> <span class="o">=</span> <span class="k">new</span> <span class="n">PgPosts</span><span class="o">(</span><span class="n">dbase</span><span class="o">);</span>
      <span class="n">Post</span> <span class="n">post</span> <span class="o">=</span> <span class="n">posts</span><span class="o">.</span><span class="na">add</span><span class="o">(</span>
        <span class="k">new</span> <span class="n">Date</span><span class="o">(),</span> <span class="s">&quot;How to cook an omelette&quot;</span>
      <span class="o">);</span>
      <span class="n">posts</span><span class="o">.</span><span class="na">comments</span><span class="o">().</span><span class="na">post</span><span class="o">(</span><span class="s">&quot;This is my first comment!&quot;</span><span class="o">);</span>
      <span class="k">return</span> <span class="n">post</span><span class="o">.</span><span class="na">id</span><span class="o">();</span>
    <span class="o">}</span>
  <span class="o">}</span>
<span class="o">);</span></code></pre></figure><p>This code will create a new post and post a comment to it. If one of the calls fail, the entire transaction will be rolled back.</p><p>This approach looks object-oriented to me. I&#39;m calling it &quot;SQL-speaking objects,&quot; because they know how to speak SQL with the database server. It&#39;s their skill, perfectly encapsulated inside their borders.</p></div></article></div><div class="wrapper"> <related-posts /></div><div class="disqus" role="complementary"><p class="disqus_hint"> Please, use <a href="https://help.disqus.com/commenting/what-html-tags-are-allowed-within-comments">syntax highlighting</a> in your comments, to make them more readable.</p><div id="disqus_thread" class="disqus-thread"> <a>&nbsp;</a></div><script> var disqus_config = function () { this.page.url = document.location.href.split('?')[0].split('#')[0].replace('https://', 'http://'); this.page.identifier = this.page.url; }; (function() { var d = document, s = d.createElement('script'); s.src = '//yegor256.disqus.com/embed.js'; s.setAttribute('data-timestamp', +new Date()); (d.head || d.body).appendChild(s); })(); </script> <noscript><div><p class="red"> JavaScript is disabled in your browser, that's why you can't see comments under this post.</p></div></noscript></div><div class="wrapper"> <footer class="footer"><p> &copy; <span itemscope="" itemprop="copyrightHolder" itemtype="http://schema.org/Person"> <span itemprop="name">Yegor Bugayenko</span> </span> 2014&ndash;<span itemprop="copyrightYear">2018</span></p></footer></div></section><div class="wrapper unprintable" style="text-align:center;margin-top:2em;"> <a href="http://www.sixnines.io/h/3ba1652f"> <img src="//www.sixnines.io/b/3ba1652f?style=flat" alt="sixnines availability badge"/> </a></div><script src="//code.jquery.com/jquery-1.9.0.min.js"></script> <script src="/js/all.js?a0e0d018c07"></script> <script>var disqus_shortname = 'yegor256';</script> <script id="dsq-count-scr" src="//yegor256.disqus.com/count.js" async="async"></script> <script> (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){ (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o), m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m) })(window,document,'script','//www.google-analytics.com/analytics.js','ga'); ga('create', 'UA-1963507-32', 'auto'); ga('send', 'pageview'); </script> <script> Cd=document;Cr="&"+Math.random();Cp="&s=1"; Cd.cookie="b=b";if(Cd.cookie)Cp+="&c=1"; Cp+="&t="+(new Date()).getTimezoneOffset(); if(self!=top)Cp+="&f=1"; </script> <script> if(navigator.javaEnabled())Cp+="&j=1"; </script> <script> if(typeof(screen)!='undefined')Cp+="&w="+screen.width+"&h="+ screen.height+"&d="+(screen.colorDepth?screen.colorDepth:screen.pixelDepth); </script> <script> Cd.write("<img src='//c.hit.ua/hit?i=95870&g=0&x=2"+Cp+Cr+ "&r="+escape(Cd.referrer)+"&u="+escape(window.location.href)+ "' border='0' wi"+"dth='1' he"+"ight='1'/>"); </script> <script type="application/ld+json"> { "@context": "http://schema.org", "@type": "Person", "name": "Yegor Bugayenko", "url": "http://www.yegor256.com", "sameAs": [ "https://www.facebook.com/yegor256", "https://instagram.com/yegor256", "https://www.linkedin.com/in/yegor256", "https://twitter.com/yegor256", "https://github.com/yegor256", "https://www.pinterest.com/yegor256/" ] } </script> </body> </html> <!DOCTYPE html> <html xmlns="http://www.w3.org/1999/xhtml" lang="en-US" xml:lang="en-US" itemscope="" itemtype="http://schema.org/WebSite"> <head> <meta charset="utf-8"/> <meta name="description" content="Who is that properly designed object in an object-oriented world? What name, behavior, habits, interfaces, and friends does he have? Let&apos;s look at it from a different perspective. " /> <meta name="keywords" content="object in java, object oriented methodology, object oriented principles, object oriented programming, object oriented programming concepts" /> <meta name="viewport" content="width=device-width,minimum-scale=1,initial-scale=1"/> <meta name="google-site-verification" content="JEj_gQr2CPe2QKGw8XdMz0R7VboQIUbX3FlM-lwTq-8" /> <meta name="author" content="Yegor Bugayenko"> <meta name="article:published_time" content="2014-11-20 00:00:00 +0000"> <meta name="og:site_name" content="Yegor Bugayenko"/> <meta name="og:type" content="article" /> <meta name="og:locale" content="en_US" /> <meta name="twitter:account_id" content="4503599630178231" /> <meta name="twitter:creator" content="@yegor256"/> <meta name="twitter:site" content="@yegor256"/> <meta name="twitter:title" property="og:title" content="Seven Virtues of a Good Object"/> <meta name="twitter:description" property="og:description" content="Who is that properly designed object in an object-oriented world? What name, behavior, habits, interfaces, and friends does he have? Let&apos;s look at it from a different perspective. "/> <meta name="twitter:url" property="og:url" content="https://www.yegor256.com/2014/11/20/seven-virtues-of-good-object.html"/> <meta name="telegram:channel" content="AAAAAEJFMRzsRTRxM3ec6A"/> <link rel="search" type="application/opensearchdescription+xml" href="/opensearch.xml" title="yegor256" /> <link rel="shortcut icon" href="/favicon.ico?a0e0d018c07"/> <link rel="apple-touch-icon" href="/favicon.ico?a0e0d018c07"/> <link rel="alternate" type="application/rss+xml" title="RSS for yegor256.com" href="https://www.yegor256.com/rss.xml"/> <link rel="stylesheet" href="/css/layout.css?a0e0d018c07"/> <link rel="stylesheet" href="/css/icons.css?a0e0d018c07"/> <link rel="canonical" href="https://www.yegor256.com/2014/11/20/seven-virtues-of-good-object.html" /> <link rel="amphtml" href="https://www.yegor256.com/2014/11/20/seven-virtues-of-good-object.amp.html" /> <title>Seven Virtues of a Good Object </title> </head> <body><div class="wrapper"> <aside class="header-toggle unprintable" id="header-toggle" title="Show the menu" onclick="$('#header').show();$('#header-toggle').hide();">&#9776;</aside> <header class="header" id="header"><div class="face"> <a href="/about-me.html#form" class="sub" title="Click to subscribe to my monthly newsletter"><span>Subscribe</span></a> <a href="/about-me.html" style="position:relative;"> <img src="/images/face-256x256.jpg" class="photo" alt="Yegor Bugayenko"/> </a></div><nav><ul class="menu social notranslate"> <li><a href="https://twitter.com/intent/follow?screen_name=yegor256" rel="nofollow" title="Follow me on Twitter"><i class="icon icon-twitter notranslate" aria-hidden="true"></i></a></li> <li><a href="/rss.xml" rel="nofollow" title="Subscribe to my RSS feed"><i class="icon icon-rss notranslate" aria-hidden="true"></i></a></li> <li><a itemprop="sameAs" href="https://github.com/yegor256" rel="nofollow" title="My GitHub profile"><i class="icon icon-github notranslate" aria-hidden="true"></i></a></li> <li><a itemprop="sameAs" href="http://stackoverflow.com/users/187141/yegor256" rel="nofollow" title="My StackOverflow profile"><i class="icon icon-stackoverflow notranslate" aria-hidden="true"></i></a></li> <li><a itemprop="sameAs" href="https://www.facebook.com/yegor256" rel="nofollow" title="Follow me on Facebook"><i class="icon icon-facebook notranslate" aria-hidden="true"></i></a></li> <li><a itemprop="sameAs" href="https://instagram.com/yegor256" rel="nofollow" title="Follow me on Instagram"><i class="icon icon-instagram notranslate" aria-hidden="true"></i></a></li> <li><a itemprop="sameAs" href="https://www.linkedin.com/in/yegor256" rel="nofollow" title="My LinkedIn profile"><i class="icon icon-linkedin notranslate" aria-hidden="true"></i></a></li> <li><a itemprop="sameAs" href="https://www.youtube.com/c/yegor256?sub_confirmation=1" rel="nofollow" title="My Youtube video channel"><i class="icon icon-youtube notranslate" aria-hidden="true"></i></a></li> <li><a itemprop="sameAs" href="https://www.pinterest.com/yegor256/" rel="nofollow" title="My Pinterest boards"><i class="icon icon-pinterest notranslate" aria-hidden="true"></i></a></li> <li><a itemprop="sameAs" href="https://angel.co/yegor256" rel="nofollow" title="My AngelList profile"><i class="icon icon-angellist notranslate" aria-hidden="true"></i></a></li> <li><a href="https://soundcloud.com/yegor256" rel="nofollow" title="My podcast"><i class="icon icon-podcast notranslate" aria-hidden="true"></i></a></li> <li><a href="https://itunes.apple.com/us/podcast/yegor256-podcast/id1150826721" rel="nofollow" title="My iTunes podcast"><i class="icon icon-itunes notranslate" aria-hidden="true"></i></a></li> <li><a href="https://t.me/joinchat/AAAAAEJFMRzsRTRxM3ec6A" rel="nofollow" title="My Telegram public channel"><i class="icon icon-telegram notranslate" aria-hidden="true"></i></a></li> <li><a href="mailto:blog@yegor256.com" rel="nofollow" title="Email me any time"><i class="icon icon-mail notranslate" aria-hidden="true"></i></a></li></ul><ul class="menu"> <li><a href="/" title="Home page">Home</a></li> <li ><a href="/best.html" title="Best articles to read">12&#160;Best</a></li> <li ><a href="/contents.html" title="The contents of the entire blog">All&#160;288</a></li> <li ><a href="/webinars.html" title="My webinars">Webinars</a></li> <li ><a href="/talks.html" title="Future and past conference talks">Talks</a></li> <li ><a href="/books.html" title="The books I wrote">Books</a></li> <li ><a href="/papers.html" title="My academic papers and patents">Papers</a></li> <li ><a href="/pets.html" title="My loved pet projects">Pets</a></li> <li ><a href="/award.html" title="Software quality award">Award</a></li> <li ><a href="/testimonials.html" title="What some people say about me">Testimonials</a></li> <li ><a href="/shift-m.html" title="Audio podcast about project management">Shift-M</a></li> <li ><a href="/paintings.html" title="My paintings for sale">Paintings</a></li> <li><a href="http://ru.yegor256.com/" title="Немного на русском языке">По-русски</a></li></ul></nav><div class="search"> <form method="get" action="https://www.google.com/search" itemprop="potentialAction" itemscope="" itemtype="http://schema.org/SearchAction"> <meta itemprop="target" content="https://www.google.com/search?q={q}"/> <input name="sitesearch" value="yegor256.com" type="hidden"/> <input itemprop="query-input" type="text" id="search-query" class="field field-text" required="required" onfocus="$('.google').css('visibility', 'visible');" name="q" placeholder="Search..." autocomplete="off"/> <input type="image" src="/images/google-search-icon.svg" class="google" title="Search via Google" alt="Search via Google"/> </form></div><div class="hot"><ul> <li> <a href="/code-ahead.html">Code Ahead</a> was published on Amazon just a few days ago! It is my new book, a novel about programmers. It explains in details the majority of ideas that stand behind <a href="https://www.zerocracy.com">Zerocracy</a> and <a href="https://www.xdsd.org">XDSD</a>. </li> <li> At <a href="/webinars.html">Webinar #37</a> we will discuss naming problem in OOP, for objects, methods and attributes; join us on <b>September 12</b>, at 11am PST. </li></ul></div></header></div><section itemscope="" itemtype="http://schema.org/BlogPosting"><div class="wrapper"> <header><p class="printable"> <img src="https://api.qrserver.com/v1/create-qr-code/?data=https://www.yegor256.com/2014/11/20/seven-virtues-of-good-object.html&amp;format=svg" style="width:125px;height:125px;" alt="QR code"/></p><p class="printable"> <code itemprop="url">https://www.yegor256.com/2014/11/20/seven-virtues-of-good-object.html</code></p><h1 itemprop="name headline mainEntityOfPage">Seven Virtues of a Good Object</h1><aside class='book'><a href='http://amzn.to/2qFt4Tn'><img src='/images/books/elegant-objects/cover.png' class='book-cover' alt='book cover'/></a>Read more about this subject in <a href='http://amzn.to/2qFt4Tn'>Section&nbsp;2.3</a><br/> of my book<a href='http://amzn.to/2qFt4Tn'><img src='/images/books/amazon-buy-button.png' class='amazon-button' alt='Click to buy'/></a></aside><ul class="subline"> <li> <time itemprop="datePublished" datetime="2014-11-20T00:00:00+00:00"> 20 November 2014 </time> </li> <li class="printable" itemscope="" itemprop="author" itemtype="http://schema.org/Person"> <span itemprop="name">Yegor Bugayenko</span> </li> <li class="unprintable"> <i class="icon icon-comments"></i> <a href="http://www.yegor256.com/2014/11/20/seven-virtues-of-good-object.html#disqus_thread" itemprop="discussionUrl">comments</a> </li></ul><ul class="unprintable subline"> <li>Translated:</li> <li><a href="http://tbd.kaitoy.xyz/2015/10/28/seven-virtues-of-good-object/">Japanese</a></li> <li><a href="https://ixmanuel.gitbooks.io/pensando-en-objectos/content/">Spanish</a></li> <li><a href="https://agorlov.github.io/yb-seven-virtues-of-good-object.html">Russian</a></li> <li><a href="mailto:translate@yegor256.com">add yours!</a></li></ul><ul class="subline"> <li>Discussed at:</li> <li><a href="https://www.reddit.com/r/programming/comments/2mw8mp/seven_virtues_of_a_good_object/">reddit</a></li></ul><p class="unprintable"><p>Martin Fowler <a href="http://martinfowler.com/bliki/InversionOfControl.html">says</a>:</p><blockquote><p>A library is essentially a set of functions that you can call, these days usually organized into classes.</p></blockquote><p>Functions organized into classes? With all due respect, this is wrong. And it is a very common misconception of a class in object-oriented programming. Classes are not organizers of functions. And objects are not data structures.</p><p>So what is a &quot;proper&quot; object? Which one is not a proper one? What is the difference? Even though it is a very polemic subject, it is very important. Unless we understand what an object is, how can we write object-oriented software? Well, thanks to Java, Ruby, and others, we can. But how good will it be? Unfortunately, this is not an exact science, and there are many opinions. Here is my list of qualities of a good object.</p><h2 id="class-vs-object">Class vs. Object</h2><figure class='badge'><img src='https://www.yegor256.com/images/2014/11/good-object-1.png' style='width:250px;max-width:100%;' alt='badge'/></figure><p>Before we start talking about <a href="/2016/07/14/who-is-object.html">objects</a>, let&#39;s define what a <em>class</em> is. It is a place where objects are being born (a.k.a. <em>instantiated</em>). The main <a href="/2016/08/30/decomposition-of-responsibility.html">responsibility</a> of a class is to <em>construct</em> new objects on demand and <em>destruct</em> them when they are not used anymore. A class knows how its children should look and how they should behave. In other words, it knows what <em>contracts</em> they should obey.</p><aside class='youtube'> <a href='https://www.youtube.com/watch?v=WSgP85kr6eU'><div class='box'> <img src='https://i.ytimg.com/vi/WSgP85kr6eU/mqdefault.jpg' alt='YouTube video #WSgP85kr6eU'/><div class='play'><i class='icon icon-play'></i></div></div></a><div>Why Getters-and-Setters Is An Anti-Pattern? (webinar #4); 1 July 2015.</div></aside><p>Sometimes I hear classes being called &quot;object templates&quot; (for example, <a href="https://en.wikipedia.org/wiki/Class_%28computer_programming%29">Wikipedia says so</a>). This definition is not correct because it places classes into a passive position. This definition assumes that someone will get a template and build an object by using it. This may be true, technically speaking, but conceptually it&#39;s wrong. Nobody else should be involved---there are only a class and its children. An object asks a class to create another object, and the class constructs it; that&#39;s it. Ruby expresses this concept much better than Java or C++:</p><figure class="highlight"><pre><code class="language-java" data-lang="java"><span></span><span class="n">photo</span> <span class="o">=</span> <span class="n">File</span><span class="o">.</span><span class="na">new</span><span class="o">(</span><span class="err">&#39;</span><span class="o">/</span><span class="n">tmp</span><span class="o">/</span><span class="n">photo</span><span class="o">.</span><span class="na">png</span><span class="err">&#39;</span><span class="o">)</span></code></pre></figure><p>The object <code>photo</code> is constructed by the class <code>File</code> (<code>new</code> is an entry point to the class). Once constructed, the object is acting on its own. It shouldn&#39;t know who constructed it and how many more brothers and sisters it has in the class. Yes, I mean that <a href="https://en.wikipedia.org/wiki/Reflection_%28computer_programming%29">reflection</a> is a terrible idea, but I&#39;ll write more about it in one of the next posts :) Now, let&#39;s talk about objects and their best and worst sides.</p><h2 id="1-he-exists-in-real-life">1. He Exists in Real Life</h2><figure class='badge'><img src='https://www.yegor256.com/images/2014/11/good-object-2.png' style='width:250px;max-width:100%;' alt='badge'/></figure><p>First of all, an object is a <strong>living organism</strong>. Moreover, an object should be <a href="https://en.wikipedia.org/wiki/Anthropomorphism">anthropomorphized</a>, i.e. treated like a human being (or a pet, if you like them more). By this I basically mean that an object is not a <em>data structure</em> or a collection of functions. Instead, it is an independent entity with its own life cycle, its own behavior, and its own habits.</p><p>An employee, a department, an HTTP request, a table in MySQL, a line in a file, or a file itself are proper objects---because they exist in real life, even when our software is turned off. To be more precise, an object is a <em>representative</em> of a real-life creature. It is a <em>proxy</em> of that real-life creature in front of all other objects. Without such a creature, there is---obviously---no object.</p><figure class="highlight"><pre><code class="language-java" data-lang="java"><span></span><span class="n">photo</span> <span class="o">=</span> <span class="n">File</span><span class="o">.</span><span class="na">new</span><span class="o">(</span><span class="err">&#39;</span><span class="o">/</span><span class="n">tmp</span><span class="o">/</span><span class="n">photo</span><span class="o">.</span><span class="na">png</span><span class="err">&#39;</span><span class="o">)</span>
<span class="n">puts</span> <span class="n">photo</span><span class="o">.</span><span class="na">width</span><span class="o">()</span></code></pre></figure><p>In this example, I&#39;m asking <code>File</code> to construct a new object <code>photo</code>, which will be a representative of a real file on disk. You may say that a file is also something virtual and exists only when the computer is turned on. I would agree and refine the definition of &quot;real life&quot; as follows: It is everything that exists aside from the scope of the program the object lives in. The disk file is outside the scope of our program; that&#39;s why it is perfectly correct to create its representative inside the program.</p><p>A controller, a parser, a filter, a validator, a service locator, a singleton, or a factory are <strong>not</strong> good objects (yes, most GoF patterns are <a href="/2016/02/03/design-patterns-and-anti-patterns.html">anti-patterns</a>!). They don&#39;t exist apart from your software, in real life. They are invented just to tie other objects together. They are artificial and fake creatures. They don&#39;t represent anyone. Seriously, an XML parser---who does it represent? Nobody.</p><p>Some of them may become good if they change their names; others can never excuse their existence. For example, that XML parser can be renamed to &quot;parseable XML&quot; and start to represent an XML document that exists outside of our scope.</p><p>Always ask yourself, &quot;What is the real-life entity behind my object?&quot; If you can&#39;t find an answer, start thinking about refactoring.</p><h2 id="2-he-works-by-contracts">2. He Works by Contracts</h2><figure class='badge'><img src='https://www.yegor256.com/images/2014/11/good-object-3.png' style='width:250px;max-width:100%;' alt='badge'/></figure><p>A good object always works by contracts. He expects to be hired not because of his personal merits but because he obeys the contracts. On the other hand, when we hire an object, we shouldn&#39;t discriminate and expect some specific object from a specific class to do the work for us. We should expect <em>any</em> object to do what our contract says. As long as the object does what we need, we should not be interested in his class of origin, his sex, or his religion.</p><p>For example, I need to show a photo on the screen. I want that photo to be read from a file in PNG format. I&#39;m contracting an object from class <code>DataFile</code> and asking him to give me the binary content of that image.</p><p>But wait, do I care where exactly the content will come from---the file on disk, or an HTTP request, or maybe a document in Dropbox? Actually, I don&#39;t. All I care about is that some object gives me a byte array with PNG content. So my contract would look like this:</p><figure class="highlight"><pre><code class="language-java" data-lang="java"><span></span><span class="kd">interface</span> <span class="nc">Binary</span> <span class="o">{</span>
  <span class="kt">byte</span><span class="o">[]</span> <span class="nf">read</span><span class="o">();</span>
<span class="o">}</span></code></pre></figure><p>Now, any object from any class (not just <code>DataFile</code>) can work for me. All he has to do, in order to be eligible, is to obey the contract---by implementing the interface <code>Binary</code>.</p><p>The rule here is simple: every public method in a good object should implement his counterpart from an interface. If your object has public methods that are not inherited from any interface, he is badly designed.</p><p>There are two practical reasons for this. First, an object working without a contract is impossible to mock in a unit test. Second, a contract-less object is impossible to extend via <a href="https://en.wikipedia.org/wiki/Decorator_pattern">decoration</a>.</p><h2 id="3-he-is-unique">3. He Is Unique</h2><p>A good object should always <a href="/2014/12/15/how-much-your-objects-encapsulate.html">encapsulate</a> something in order to be unique. If there is nothing to encapsulate, an object may have identical clones, which I believe is bad. Here is an example of a bad object, which may have clones:</p><figure class="highlight"><pre><code class="language-java" data-lang="java"><span></span><span class="kd">class</span> <span class="nc">HTTPStatus</span> <span class="kd">implements</span> <span class="n">Status</span> <span class="o">{</span>
  <span class="kd">private</span> <span class="n">URL</span> <span class="n">page</span> <span class="o">=</span> <span class="k">new</span> <span class="n">URL</span><span class="o">(</span><span class="s">&quot;http://localhost&quot;</span><span class="o">);</span>
  <span class="nd">@Override</span>
  <span class="kd">public</span> <span class="kt">int</span> <span class="nf">read</span><span class="o">()</span> <span class="kd">throws</span> <span class="n">IOException</span> <span class="o">{</span>
    <span class="k">return</span> <span class="n">HttpURLConnection</span><span class="o">.</span><span class="na">class</span><span class="o">.</span><span class="na">cast</span><span class="o">(</span>
      <span class="k">this</span><span class="o">.</span><span class="na">page</span><span class="o">.</span><span class="na">openConnection</span><span class="o">()</span>
    <span class="o">).</span><span class="na">getResponseCode</span><span class="o">();</span>
  <span class="o">}</span>
<span class="o">}</span></code></pre></figure><p>I can create a few instances of class <code>HTTPStatus</code>, and all of them will be equal to each other:</p><figure class="highlight"><pre><code class="language-java" data-lang="java"><span></span><span class="n">first</span> <span class="o">=</span> <span class="k">new</span> <span class="n">HTTPStatus</span><span class="o">();</span>
<span class="n">second</span> <span class="o">=</span> <span class="k">new</span> <span class="n">HTTPStatus</span><span class="o">();</span>
<span class="k">assert</span> <span class="n">first</span><span class="o">.</span><span class="na">equals</span><span class="o">(</span><span class="n">second</span><span class="o">);</span></code></pre></figure><p>Obviously utility classes, which have only static methods, can&#39;t instantiate good objects. More generally, utility classes don&#39;t have any of the merits mentioned in this article and can&#39;t even be called &quot;classes.&quot; They are simply terrible abusers of an object paradigm and exist in modern object-oriented languages only because their inventors enabled static methods.</p><h2 id="4-he-is-immutable">4. He Is Immutable</h2><p>A good object should never change his encapsulated state. Remember, an object is a representative of a real-life entity, and this entity should stay the same through the entire life of the object. In other words, an object should never betray those whom he represents. He should never change owners. :)</p><p>Be aware that immutability doesn&#39;t mean that all methods always return the same values. Instead, a good immutable object is very dynamic. However, he never changes his internal state. For example:</p><figure class="highlight"><pre><code class="language-java" data-lang="java"><span></span><span class="nd">@Immutable</span>
<span class="kd">final</span> <span class="kd">class</span> <span class="nc">HTTPStatus</span> <span class="kd">implements</span> <span class="n">Status</span> <span class="o">{</span>
  <span class="kd">private</span> <span class="n">URL</span> <span class="n">page</span><span class="o">;</span>
  <span class="kd">public</span> <span class="nf">HTTPStatus</span><span class="o">(</span><span class="n">URL</span> <span class="n">url</span><span class="o">)</span> <span class="o">{</span>
    <span class="k">this</span><span class="o">.</span><span class="na">page</span> <span class="o">=</span> <span class="n">url</span><span class="o">;</span>
  <span class="o">}</span>
  <span class="nd">@Override</span>
  <span class="kd">public</span> <span class="kt">int</span> <span class="nf">read</span><span class="o">()</span> <span class="kd">throws</span> <span class="n">IOException</span> <span class="o">{</span>
    <span class="k">return</span> <span class="n">HttpURLConnection</span><span class="o">.</span><span class="na">class</span><span class="o">.</span><span class="na">cast</span><span class="o">(</span>
      <span class="k">this</span><span class="o">.</span><span class="na">page</span><span class="o">.</span><span class="na">openConnection</span><span class="o">()</span>
    <span class="o">).</span><span class="na">getResponseCode</span><span class="o">();</span>
  <span class="o">}</span>
<span class="o">}</span></code></pre></figure><p>Even though the method <code>read()</code> may return different values, the object is immutable. He points to a certain web page and will never point anywhere else. He will never change his encapsulated state, and he will never betray the URL he represents.</p><p>Why is immutability a virtue? This article explains in detail: <a href="/2014/06/09/objects-should-be-immutable.html">Objects Should Be Immutable</a>. In a nutshell, immutable objects are better because:</p><ul> <li>Immutable objects are simpler to construct, test, and use.</li> <li>Truly immutable objects are always <a href="/2017/01/17/synchronized-decorators.html">thread-safe</a>.</li> <li>They help avoid <a href="/2015/12/08/temporal-coupling-between-method-calls.html">temporal coupling</a>.</li> <li>Their usage is side-effect free (no defensive copies).</li> <li>They always have failure atomicity.</li> <li>They are much easier to cache.</li> <li>They prevent <a href="/2014/05/13/why-null-is-bad.html">NULL references</a>.</li></ul><p>Of course, a good object doesn&#39;t have <a href="/2014/09/16/getters-and-setters-are-evil.html">setters</a>, which may change his state and force him to betray the URL. In other words, introducing a <code>setURL()</code> method would be a terrible mistake in class <code>HTTPStatus</code>.</p><p>Besides all that, immutable objects will force you to make more cohesive, solid, and understandable designs, as this article explains: <a href="/2014/11/07/how-immutability-helps.html">How Immutability Helps</a>.</p><h2 id="5-his-class-doesnt-have-anything-static">5. His Class Doesn&#39;t Have Anything Static</h2><p>A static method implements a behavior of a class, not an object. Let&#39;s say we have class <code>File</code>, and his children have method <code>size()</code>:</p><figure class="highlight"><pre><code class="language-java" data-lang="java"><span></span><span class="kd">final</span> <span class="kd">class</span> <span class="nc">File</span> <span class="kd">implements</span> <span class="n">Measurable</span> <span class="o">{</span>
  <span class="nd">@Override</span>
  <span class="kd">public</span> <span class="kt">int</span> <span class="nf">size</span><span class="o">()</span> <span class="o">{</span>
    <span class="c1">// calculate the size of the file and return</span>
  <span class="o">}</span>
<span class="o">}</span></code></pre></figure><p>So far, so good; the method <code>size()</code> is there because of the contract <code>Measurable</code>, and every object of class <code>File</code> will be able to measure his size. A terrible mistake would be to design this class with a static method instead (this design is also known as <a href="/2014/05/05/oop-alternative-to-utility-classes.html">a utility class</a> and is very popular in Java, Ruby, and almost every OOP language):</p><figure class="highlight"><pre><code class="language-java" data-lang="java"><span></span><span class="c1">// TERRIBLE DESIGN, DON&#39;T USE!</span>
<span class="kd">class</span> <span class="nc">File</span> <span class="o">{</span>
  <span class="kd">public</span> <span class="kd">static</span> <span class="kt">int</span> <span class="nf">size</span><span class="o">(</span><span class="n">String</span> <span class="n">file</span><span class="o">)</span> <span class="o">{</span>
    <span class="c1">// calculate the size of the file and return</span>
  <span class="o">}</span>
<span class="o">}</span></code></pre></figure><p>This design runs completely against the object-oriented paradigm. Why? Because static methods turn object-oriented programming into &quot;class-oriented&quot; programming. This method, <code>size()</code>, exposes the behavior of the class, not of his objects. What&#39;s wrong with this, you may ask? Why can&#39;t we have both objects and classes as first-class citizens in our code? Why can&#39;t both of them have methods and properties?</p><p>The problem is that with class-oriented programming, decomposition doesn&#39;t work anymore. We can&#39;t break down a complex problem into parts, because only a single instance of a class exists in the entire program. The power of <a href="/2016/08/15/what-is-wrong-object-oriented-programming.html">OOP</a> is that it allows us to use objects as an instrument for scope decomposition. When I instantiate an object inside a method, he is dedicated to my specific task. He is perfectly isolated from all other objects around the method. This object is a <em>local variable</em> in the scope of the method. A class, with his static methods, is always a <em>global variable</em> no matter where I use him. Because of that, I can&#39;t isolate my interaction with this <a href="/2017/05/16/monikers.html">variable</a> from others.</p><p>Besides being conceptually against object-oriented principles, public static methods have a few practical drawbacks:</p><p>First, it&#39;s <strong>impossible to mock</strong> them (Well, you can use <a href="https://code.google.com/p/powermock/">PowerMock</a>, but this will then be the most terrible decision you could make in a Java project... I made it once, a few years ago).</p><p>Second, they are <strong>not thread-safe</strong> by definition, because they always work with static variables, which are accessible from all threads. You can make them thread-safe, but this will always require explicit synchronization.</p><p>Every time you see a public static method, start rewriting immediately. I don&#39;t even want to mention how terrible static (or global) variables are. I think it is just obvious.</p><h2 id="6-his-name-is-not-a-job-title">6. His Name Is Not a Job Title</h2><figure class='badge'><img src='https://www.yegor256.com/images/2014/11/good-object-4.png' style='width:250px;max-width:100%;' alt='badge'/></figure><p>The name of an object should tell us what this object <strong>is</strong>, not what it <strong>does</strong>, just like we name objects in real life: book instead of page aggregator, cup instead of water holder, T-shirt instead of body dresser. There are exceptions, of course, like printer or computer, but they were invented just recently and by those who didn&#39;t read this article. :)</p><p>For example, these names tell us who their owners are: an apple, a file, a series of HTTP requests, a socket, an XML document, a list of users, a regular expression, an integer, a PostgreSQL table, or Jeffrey Lebowski. A properly named object is always possible to draw as a small picture. Even a regular expression can be drawn.</p><p>In the opposite, here is an example of names that tell us what their owners do: a file reader, a text parser, a URL validator, an XML printer, a service locator, a <a href="/2016/06/27/singletons-must-die.html">singleton</a>, a script runner, or a Java programmer. Can you draw any of them? No, you can&#39;t. These names are not suitable for good objects. They are terrible names that lead to terrible design.</p><p>In general, avoid names that end with &quot;-er&quot;---most of them are bad.</p><p>&quot;What is the alternative of a <code>FileReader</code>?&quot; I hear you asking. What would be a better name? Let&#39;s see. We already have <code>File</code>, which is a representative of a real-world file on disk. This representative is not powerful enough for us, because he doesn&#39;t know how to read the content of the file. We want to create a more powerful one that will have that ability. What would we call him? Remember, the name should say what he is, not what he does. What is he? He is a file that has data; not just a file, like <code>File</code>, but a more sophisticated one, with data. So how about <code>FileWithData</code> or simply <code>DataFile</code>?</p><p>The same logic should be applicable to all other names. Always think about <strong>what it is</strong> rather than what it does. Give your objects real, meaningful names instead of job titles.</p><p>More about this in <a href="/2015/03/09/objects-end-with-er.html">Don&#39;t Create Objects That End With -ER</a>.</p><h2 id="7-his-class-is-either-final-or-abstract">7. His Class Is Either Final or Abstract</h2><figure class='badge'><img src='https://www.yegor256.com/images/2014/11/good-object-5.png' style='width:250px;max-width:100%;' alt='badge'/></figure><p>A good object comes from either a final or abstract class. A <code>final</code> class is one that can&#39;t be extended via <a href="/2016/09/13/inheritance-is-procedural.html">inheritance</a>. An <code>abstract</code> class is one that can&#39;t have instances. Simply put, a class should either say, &quot;You can never break me; I&#39;m a black box for you&quot; or &quot;I&#39;m broken already; fix me first and then use.&quot;</p><p>There is nothing in between. A final class is a black box that you can&#39;t modify by any means. He works as he works, and you either use him or throw him away. You can&#39;t create another class that will inherit his properties. This is not allowed because of that <code>final</code> modifier. The only way to extend such a final class is through decoration of his children. Let&#39;s say I have the class <code>HTTPStatus</code> (see above), and I don&#39;t like him. Well, I like him, but he&#39;s not powerful enough for me. I want him to <a href="/2015/12/01/rethrow-exceptions.html">throw</a> an exception if HTTP status is over 400. I want his method, <code>read()</code>, to do more that it does now. A traditional way would be to extend the class and overwrite his method:</p><figure class="highlight"><pre><code class="language-java" data-lang="java"><span></span><span class="kd">class</span> <span class="nc">OnlyValidStatus</span> <span class="kd">extends</span> <span class="n">HTTPStatus</span> <span class="o">{</span>
  <span class="kd">public</span> <span class="nf">OnlyValidStatus</span><span class="o">(</span><span class="n">URL</span> <span class="n">url</span><span class="o">)</span> <span class="o">{</span>
    <span class="kd">super</span><span class="o">(</span><span class="n">url</span><span class="o">);</span>
  <span class="o">}</span>
  <span class="nd">@Override</span>
  <span class="kd">public</span> <span class="kt">int</span> <span class="nf">read</span><span class="o">()</span> <span class="kd">throws</span> <span class="n">IOException</span> <span class="o">{</span>
    <span class="kt">int</span> <span class="n">code</span> <span class="o">=</span> <span class="kd">super</span><span class="o">.</span><span class="na">read</span><span class="o">();</span>
    <span class="k">if</span> <span class="o">(</span><span class="n">code</span> <span class="o">&gt;=</span> <span class="mi">400</span><span class="o">)</span> <span class="o">{</span>
      <span class="k">throw</span> <span class="k">new</span> <span class="n">RuntimeException</span><span class="o">(</span><span class="s">&quot;Unsuccessful HTTP code&quot;</span><span class="o">);</span>
    <span class="o">}</span>
    <span class="k">return</span> <span class="n">code</span><span class="o">;</span>
  <span class="o">}</span>
<span class="o">}</span></code></pre></figure><p>Why is this wrong? It is very wrong because we risk breaking the logic of the entire parent class by overriding one of his methods. Remember, once we override the method <code>read()</code> in the child class, all methods from the parent class start to use his new version. We&#39;re literally injecting a new &quot;piece of implementation&quot; right into the class. Philosophically speaking, this is an offense.</p><p>On the other hand, to extend a final class, you have to treat him like a black box and decorate him with your own implementation (a.k.a. <a href="https://en.wikipedia.org/wiki/Decorator_pattern">Decorator Pattern</a>):</p><figure class="highlight"><pre><code class="language-java" data-lang="java"><span></span><span class="kd">final</span> <span class="kd">class</span> <span class="nc">OnlyValidStatus</span> <span class="kd">implements</span> <span class="n">Status</span> <span class="o">{</span>
  <span class="kd">private</span> <span class="kd">final</span> <span class="n">Status</span> <span class="n">origin</span><span class="o">;</span>
  <span class="kd">public</span> <span class="nf">OnlyValidStatus</span><span class="o">(</span><span class="n">Status</span> <span class="n">status</span><span class="o">)</span> <span class="o">{</span>
    <span class="k">this</span><span class="o">.</span><span class="na">origin</span> <span class="o">=</span> <span class="n">status</span><span class="o">;</span>
  <span class="o">}</span>
  <span class="nd">@Override</span>
  <span class="kd">public</span> <span class="kt">int</span> <span class="nf">read</span><span class="o">()</span> <span class="kd">throws</span> <span class="n">IOException</span> <span class="o">{</span>
    <span class="kt">int</span> <span class="n">code</span> <span class="o">=</span> <span class="k">this</span><span class="o">.</span><span class="na">origin</span><span class="o">.</span><span class="na">read</span><span class="o">();</span>
    <span class="k">if</span> <span class="o">(</span><span class="n">code</span> <span class="o">&gt;=</span> <span class="mi">400</span><span class="o">)</span> <span class="o">{</span>
      <span class="k">throw</span> <span class="k">new</span> <span class="n">RuntimeException</span><span class="o">(</span><span class="s">&quot;Unsuccessful HTTP code&quot;</span><span class="o">);</span>
    <span class="o">}</span>
    <span class="k">return</span> <span class="n">code</span><span class="o">;</span>
  <span class="o">}</span>
<span class="o">}</span></code></pre></figure><p>Make sure that this class is implementing the same <a href="/2016/04/26/why-inputstream-design-is-wrong.html">interface</a> as the original one: <code>Status</code>. The instance of <code>HTTPStatus</code> will be passed into him through the constructor and encapsulated. Then every call will be intercepted and implemented in a different way, if necessary. In this design, we treat the original object as a black box and never touch his internal logic.</p><p>If you don&#39;t use that <code>final</code> keyword, anyone (including yourself) will be able to extend the class and... offend him :( So a class without <code>final</code> is a bad design.</p><p>An abstract class is the exact opposite case---he tells us that he is incomplete and we can&#39;t use him &quot;as is.&quot; We have to inject our custom implementation logic into him, but only into the places he allows us to touch. These places are explicitly marked as <code>abstract</code> methods. For example, our <code>HTTPStatus</code> may look like this:</p><figure class="highlight"><pre><code class="language-java" data-lang="java"><span></span><span class="kd">abstract</span> <span class="kd">class</span> <span class="nc">ValidatedHTTPStatus</span> <span class="kd">implements</span> <span class="n">Status</span> <span class="o">{</span>
  <span class="nd">@Override</span>
  <span class="kd">public</span> <span class="kd">final</span> <span class="kt">int</span> <span class="nf">read</span><span class="o">()</span> <span class="kd">throws</span> <span class="n">IOException</span> <span class="o">{</span>
    <span class="kt">int</span> <span class="n">code</span> <span class="o">=</span> <span class="k">this</span><span class="o">.</span><span class="na">origin</span><span class="o">.</span><span class="na">read</span><span class="o">();</span>
    <span class="k">if</span> <span class="o">(!</span><span class="k">this</span><span class="o">.</span><span class="na">isValid</span><span class="o">())</span> <span class="o">{</span>
      <span class="k">throw</span> <span class="k">new</span> <span class="n">RuntimeException</span><span class="o">(</span><span class="s">&quot;Unsuccessful HTTP code&quot;</span><span class="o">);</span>
    <span class="o">}</span>
    <span class="k">return</span> <span class="n">code</span><span class="o">;</span>
  <span class="o">}</span>
  <span class="kd">protected</span> <span class="kd">abstract</span> <span class="kt">boolean</span> <span class="nf">isValid</span><span class="o">();</span>
<span class="o">}</span></code></pre></figure><p>As you see, the class doesn&#39;t know how exactly to validate the HTTP code, and he expects us to inject that logic through inheritance and through overriding the method <code>isValid()</code>. We&#39;re not going to offend him with this inheritance, since he defended all other methods with <code>final</code> (pay attention to the modifiers of his methods). Thus, the class is ready for our offense and is perfectly guarded against it.</p><p>To summarize, your class should either be <code>final</code> or <code>abstract</code>---nothing in between.</p><p>Update (April 2017): If you also agree that <a href="/2016/09/13/inheritance-is-procedural.html">implementation inheritance</a> is evil, all your classes must be <code>final</code>.</p></p><nav class="buttons notranslate desktop-only"> <a href="http://www.facebook.com/sharer/sharer.php?u=https://www.yegor256.com/2014/11/20/seven-virtues-of-good-object.html" title="Share on Facebook" class="button" rel="nofollow"> <span class="count count-facebook">0</span> <i class="icon icon-facebook notranslate" aria-hidden="true"></i> </a> <a href="https://twitter.com/share?url=https://www.yegor256.com/2014/11/20/seven-virtues-of-good-object.html&amp;text=Seven+Virtues+of+a+Good+Object" title="Share on Twitter" class="button" rel="nofollow"> <span class="count count-twitter">0</span> <i class="icon icon-twitter notranslate" aria-hidden="true"></i> </a> <a href="https://plus.google.com/share?url=https://www.yegor256.com/2014/11/20/seven-virtues-of-good-object.html" title="Share on Google+" class="button" rel="nofollow"> <span class="count count-googleplus">0</span> <i class="icon icon-googleplus notranslate" aria-hidden="true"></i> </a> <a href="https://www.linkedin.com/cws/share?url=https://www.yegor256.com/2014/11/20/seven-virtues-of-good-object.html" title="Share on LinkedIn" class="button" rel="nofollow"> <span class="count count-linkedin">0</span> <i class="icon icon-linkedin notranslate" aria-hidden="true"></i> </a> <a href="http://reddit.com/submit?url=https://www.yegor256.com/2014/11/20/seven-virtues-of-good-object.html%3F2014-46&amp;title=Seven+Virtues+of+a+Good+Object" title="Share on Reddit" class="button" rel="nofollow"> <span class="count count-reddit">0</span> <i class="icon icon-reddit notranslate" aria-hidden="true"></i> </a> <a href="http://news.ycombinator.com/submitlink?u=https://www.yegor256.com/2014/11/20/seven-virtues-of-good-object.html%3F2014-46&amp;t=Seven+Virtues+of+a+Good+Object" title="Share on Hacker News" class="button" rel="nofollow"> <span class="count count-hackernews">0</span> <i class="icon icon-hackernews notranslate" aria-hidden="true"></i> </a> </nav> </header> <article class="main" itemprop="articleBody"><div ><p>Martin Fowler <a href="http://martinfowler.com/bliki/InversionOfControl.html">says</a>:</p><blockquote><p>A library is essentially a set of functions that you can call, these days usually organized into classes.</p></blockquote><p>Functions organized into classes? With all due respect, this is wrong. And it is a very common misconception of a class in object-oriented programming. Classes are not organizers of functions. And objects are not data structures.</p><p>So what is a &quot;proper&quot; object? Which one is not a proper one? What is the difference? Even though it is a very polemic subject, it is very important. Unless we understand what an object is, how can we write object-oriented software? Well, thanks to Java, Ruby, and others, we can. But how good will it be? Unfortunately, this is not an exact science, and there are many opinions. Here is my list of qualities of a good object.</p><h2 id="class-vs-object">Class vs. Object</h2><figure class='badge'><img src='https://www.yegor256.com/images/2014/11/good-object-1.png' style='width:250px;max-width:100%;' alt='badge'/></figure><p>Before we start talking about <a href="/2016/07/14/who-is-object.html">objects</a>, let&#39;s define what a <em>class</em> is. It is a place where objects are being born (a.k.a. <em>instantiated</em>). The main <a href="/2016/08/30/decomposition-of-responsibility.html">responsibility</a> of a class is to <em>construct</em> new objects on demand and <em>destruct</em> them when they are not used anymore. A class knows how its children should look and how they should behave. In other words, it knows what <em>contracts</em> they should obey.</p><aside class='youtube'> <a href='https://www.youtube.com/watch?v=WSgP85kr6eU'><div class='box'> <img src='https://i.ytimg.com/vi/WSgP85kr6eU/mqdefault.jpg' alt='YouTube video #WSgP85kr6eU'/><div class='play'><i class='icon icon-play'></i></div></div></a><div>Why Getters-and-Setters Is An Anti-Pattern? (webinar #4); 1 July 2015.</div></aside><p>Sometimes I hear classes being called &quot;object templates&quot; (for example, <a href="https://en.wikipedia.org/wiki/Class_%28computer_programming%29">Wikipedia says so</a>). This definition is not correct because it places classes into a passive position. This definition assumes that someone will get a template and build an object by using it. This may be true, technically speaking, but conceptually it&#39;s wrong. Nobody else should be involved---there are only a class and its children. An object asks a class to create another object, and the class constructs it; that&#39;s it. Ruby expresses this concept much better than Java or C++:</p><figure class="highlight"><pre><code class="language-java" data-lang="java"><span></span><span class="n">photo</span> <span class="o">=</span> <span class="n">File</span><span class="o">.</span><span class="na">new</span><span class="o">(</span><span class="err">&#39;</span><span class="o">/</span><span class="n">tmp</span><span class="o">/</span><span class="n">photo</span><span class="o">.</span><span class="na">png</span><span class="err">&#39;</span><span class="o">)</span></code></pre></figure><p>The object <code>photo</code> is constructed by the class <code>File</code> (<code>new</code> is an entry point to the class). Once constructed, the object is acting on its own. It shouldn&#39;t know who constructed it and how many more brothers and sisters it has in the class. Yes, I mean that <a href="https://en.wikipedia.org/wiki/Reflection_%28computer_programming%29">reflection</a> is a terrible idea, but I&#39;ll write more about it in one of the next posts :) Now, let&#39;s talk about objects and their best and worst sides.</p><h2 id="1-he-exists-in-real-life">1. He Exists in Real Life</h2><figure class='badge'><img src='https://www.yegor256.com/images/2014/11/good-object-2.png' style='width:250px;max-width:100%;' alt='badge'/></figure><p>First of all, an object is a <strong>living organism</strong>. Moreover, an object should be <a href="https://en.wikipedia.org/wiki/Anthropomorphism">anthropomorphized</a>, i.e. treated like a human being (or a pet, if you like them more). By this I basically mean that an object is not a <em>data structure</em> or a collection of functions. Instead, it is an independent entity with its own life cycle, its own behavior, and its own habits.</p><p>An employee, a department, an HTTP request, a table in MySQL, a line in a file, or a file itself are proper objects---because they exist in real life, even when our software is turned off. To be more precise, an object is a <em>representative</em> of a real-life creature. It is a <em>proxy</em> of that real-life creature in front of all other objects. Without such a creature, there is---obviously---no object.</p><figure class="highlight"><pre><code class="language-java" data-lang="java"><span></span><span class="n">photo</span> <span class="o">=</span> <span class="n">File</span><span class="o">.</span><span class="na">new</span><span class="o">(</span><span class="err">&#39;</span><span class="o">/</span><span class="n">tmp</span><span class="o">/</span><span class="n">photo</span><span class="o">.</span><span class="na">png</span><span class="err">&#39;</span><span class="o">)</span>
<span class="n">puts</span> <span class="n">photo</span><span class="o">.</span><span class="na">width</span><span class="o">()</span></code></pre></figure><p>In this example, I&#39;m asking <code>File</code> to construct a new object <code>photo</code>, which will be a representative of a real file on disk. You may say that a file is also something virtual and exists only when the computer is turned on. I would agree and refine the definition of &quot;real life&quot; as follows: It is everything that exists aside from the scope of the program the object lives in. The disk file is outside the scope of our program; that&#39;s why it is perfectly correct to create its representative inside the program.</p><p>A controller, a parser, a filter, a validator, a service locator, a singleton, or a factory are <strong>not</strong> good objects (yes, most GoF patterns are <a href="/2016/02/03/design-patterns-and-anti-patterns.html">anti-patterns</a>!). They don&#39;t exist apart from your software, in real life. They are invented just to tie other objects together. They are artificial and fake creatures. They don&#39;t represent anyone. Seriously, an XML parser---who does it represent? Nobody.</p><p>Some of them may become good if they change their names; others can never excuse their existence. For example, that XML parser can be renamed to &quot;parseable XML&quot; and start to represent an XML document that exists outside of our scope.</p><p>Always ask yourself, &quot;What is the real-life entity behind my object?&quot; If you can&#39;t find an answer, start thinking about refactoring.</p><h2 id="2-he-works-by-contracts">2. He Works by Contracts</h2><figure class='badge'><img src='https://www.yegor256.com/images/2014/11/good-object-3.png' style='width:250px;max-width:100%;' alt='badge'/></figure><p>A good object always works by contracts. He expects to be hired not because of his personal merits but because he obeys the contracts. On the other hand, when we hire an object, we shouldn&#39;t discriminate and expect some specific object from a specific class to do the work for us. We should expect <em>any</em> object to do what our contract says. As long as the object does what we need, we should not be interested in his class of origin, his sex, or his religion.</p><p>For example, I need to show a photo on the screen. I want that photo to be read from a file in PNG format. I&#39;m contracting an object from class <code>DataFile</code> and asking him to give me the binary content of that image.</p><p>But wait, do I care where exactly the content will come from---the file on disk, or an HTTP request, or maybe a document in Dropbox? Actually, I don&#39;t. All I care about is that some object gives me a byte array with PNG content. So my contract would look like this:</p><figure class="highlight"><pre><code class="language-java" data-lang="java"><span></span><span class="kd">interface</span> <span class="nc">Binary</span> <span class="o">{</span>
  <span class="kt">byte</span><span class="o">[]</span> <span class="nf">read</span><span class="o">();</span>
<span class="o">}</span></code></pre></figure><p>Now, any object from any class (not just <code>DataFile</code>) can work for me. All he has to do, in order to be eligible, is to obey the contract---by implementing the interface <code>Binary</code>.</p><p>The rule here is simple: every public method in a good object should implement his counterpart from an interface. If your object has public methods that are not inherited from any interface, he is badly designed.</p><p>There are two practical reasons for this. First, an object working without a contract is impossible to mock in a unit test. Second, a contract-less object is impossible to extend via <a href="https://en.wikipedia.org/wiki/Decorator_pattern">decoration</a>.</p><h2 id="3-he-is-unique">3. He Is Unique</h2><p>A good object should always <a href="/2014/12/15/how-much-your-objects-encapsulate.html">encapsulate</a> something in order to be unique. If there is nothing to encapsulate, an object may have identical clones, which I believe is bad. Here is an example of a bad object, which may have clones:</p><figure class="highlight"><pre><code class="language-java" data-lang="java"><span></span><span class="kd">class</span> <span class="nc">HTTPStatus</span> <span class="kd">implements</span> <span class="n">Status</span> <span class="o">{</span>
  <span class="kd">private</span> <span class="n">URL</span> <span class="n">page</span> <span class="o">=</span> <span class="k">new</span> <span class="n">URL</span><span class="o">(</span><span class="s">&quot;http://localhost&quot;</span><span class="o">);</span>
  <span class="nd">@Override</span>
  <span class="kd">public</span> <span class="kt">int</span> <span class="nf">read</span><span class="o">()</span> <span class="kd">throws</span> <span class="n">IOException</span> <span class="o">{</span>
    <span class="k">return</span> <span class="n">HttpURLConnection</span><span class="o">.</span><span class="na">class</span><span class="o">.</span><span class="na">cast</span><span class="o">(</span>
      <span class="k">this</span><span class="o">.</span><span class="na">page</span><span class="o">.</span><span class="na">openConnection</span><span class="o">()</span>
    <span class="o">).</span><span class="na">getResponseCode</span><span class="o">();</span>
  <span class="o">}</span>
<span class="o">}</span></code></pre></figure><p>I can create a few instances of class <code>HTTPStatus</code>, and all of them will be equal to each other:</p><figure class="highlight"><pre><code class="language-java" data-lang="java"><span></span><span class="n">first</span> <span class="o">=</span> <span class="k">new</span> <span class="n">HTTPStatus</span><span class="o">();</span>
<span class="n">second</span> <span class="o">=</span> <span class="k">new</span> <span class="n">HTTPStatus</span><span class="o">();</span>
<span class="k">assert</span> <span class="n">first</span><span class="o">.</span><span class="na">equals</span><span class="o">(</span><span class="n">second</span><span class="o">);</span></code></pre></figure><p>Obviously utility classes, which have only static methods, can&#39;t instantiate good objects. More generally, utility classes don&#39;t have any of the merits mentioned in this article and can&#39;t even be called &quot;classes.&quot; They are simply terrible abusers of an object paradigm and exist in modern object-oriented languages only because their inventors enabled static methods.</p><h2 id="4-he-is-immutable">4. He Is Immutable</h2><p>A good object should never change his encapsulated state. Remember, an object is a representative of a real-life entity, and this entity should stay the same through the entire life of the object. In other words, an object should never betray those whom he represents. He should never change owners. :)</p><p>Be aware that immutability doesn&#39;t mean that all methods always return the same values. Instead, a good immutable object is very dynamic. However, he never changes his internal state. For example:</p><figure class="highlight"><pre><code class="language-java" data-lang="java"><span></span><span class="nd">@Immutable</span>
<span class="kd">final</span> <span class="kd">class</span> <span class="nc">HTTPStatus</span> <span class="kd">implements</span> <span class="n">Status</span> <span class="o">{</span>
  <span class="kd">private</span> <span class="n">URL</span> <span class="n">page</span><span class="o">;</span>
  <span class="kd">public</span> <span class="nf">HTTPStatus</span><span class="o">(</span><span class="n">URL</span> <span class="n">url</span><span class="o">)</span> <span class="o">{</span>
    <span class="k">this</span><span class="o">.</span><span class="na">page</span> <span class="o">=</span> <span class="n">url</span><span class="o">;</span>
  <span class="o">}</span>
  <span class="nd">@Override</span>
  <span class="kd">public</span> <span class="kt">int</span> <span class="nf">read</span><span class="o">()</span> <span class="kd">throws</span> <span class="n">IOException</span> <span class="o">{</span>
    <span class="k">return</span> <span class="n">HttpURLConnection</span><span class="o">.</span><span class="na">class</span><span class="o">.</span><span class="na">cast</span><span class="o">(</span>
      <span class="k">this</span><span class="o">.</span><span class="na">page</span><span class="o">.</span><span class="na">openConnection</span><span class="o">()</span>
    <span class="o">).</span><span class="na">getResponseCode</span><span class="o">();</span>
  <span class="o">}</span>
<span class="o">}</span></code></pre></figure><p>Even though the method <code>read()</code> may return different values, the object is immutable. He points to a certain web page and will never point anywhere else. He will never change his encapsulated state, and he will never betray the URL he represents.</p><p>Why is immutability a virtue? This article explains in detail: <a href="/2014/06/09/objects-should-be-immutable.html">Objects Should Be Immutable</a>. In a nutshell, immutable objects are better because:</p><ul> <li>Immutable objects are simpler to construct, test, and use.</li> <li>Truly immutable objects are always <a href="/2017/01/17/synchronized-decorators.html">thread-safe</a>.</li> <li>They help avoid <a href="/2015/12/08/temporal-coupling-between-method-calls.html">temporal coupling</a>.</li> <li>Their usage is side-effect free (no defensive copies).</li> <li>They always have failure atomicity.</li> <li>They are much easier to cache.</li> <li>They prevent <a href="/2014/05/13/why-null-is-bad.html">NULL references</a>.</li></ul><p>Of course, a good object doesn&#39;t have <a href="/2014/09/16/getters-and-setters-are-evil.html">setters</a>, which may change his state and force him to betray the URL. In other words, introducing a <code>setURL()</code> method would be a terrible mistake in class <code>HTTPStatus</code>.</p><p>Besides all that, immutable objects will force you to make more cohesive, solid, and understandable designs, as this article explains: <a href="/2014/11/07/how-immutability-helps.html">How Immutability Helps</a>.</p><h2 id="5-his-class-doesnt-have-anything-static">5. His Class Doesn&#39;t Have Anything Static</h2><p>A static method implements a behavior of a class, not an object. Let&#39;s say we have class <code>File</code>, and his children have method <code>size()</code>:</p><figure class="highlight"><pre><code class="language-java" data-lang="java"><span></span><span class="kd">final</span> <span class="kd">class</span> <span class="nc">File</span> <span class="kd">implements</span> <span class="n">Measurable</span> <span class="o">{</span>
  <span class="nd">@Override</span>
  <span class="kd">public</span> <span class="kt">int</span> <span class="nf">size</span><span class="o">()</span> <span class="o">{</span>
    <span class="c1">// calculate the size of the file and return</span>
  <span class="o">}</span>
<span class="o">}</span></code></pre></figure><p>So far, so good; the method <code>size()</code> is there because of the contract <code>Measurable</code>, and every object of class <code>File</code> will be able to measure his size. A terrible mistake would be to design this class with a static method instead (this design is also known as <a href="/2014/05/05/oop-alternative-to-utility-classes.html">a utility class</a> and is very popular in Java, Ruby, and almost every OOP language):</p><figure class="highlight"><pre><code class="language-java" data-lang="java"><span></span><span class="c1">// TERRIBLE DESIGN, DON&#39;T USE!</span>
<span class="kd">class</span> <span class="nc">File</span> <span class="o">{</span>
  <span class="kd">public</span> <span class="kd">static</span> <span class="kt">int</span> <span class="nf">size</span><span class="o">(</span><span class="n">String</span> <span class="n">file</span><span class="o">)</span> <span class="o">{</span>
    <span class="c1">// calculate the size of the file and return</span>
  <span class="o">}</span>
<span class="o">}</span></code></pre></figure><p>This design runs completely against the object-oriented paradigm. Why? Because static methods turn object-oriented programming into &quot;class-oriented&quot; programming. This method, <code>size()</code>, exposes the behavior of the class, not of his objects. What&#39;s wrong with this, you may ask? Why can&#39;t we have both objects and classes as first-class citizens in our code? Why can&#39;t both of them have methods and properties?</p><p>The problem is that with class-oriented programming, decomposition doesn&#39;t work anymore. We can&#39;t break down a complex problem into parts, because only a single instance of a class exists in the entire program. The power of <a href="/2016/08/15/what-is-wrong-object-oriented-programming.html">OOP</a> is that it allows us to use objects as an instrument for scope decomposition. When I instantiate an object inside a method, he is dedicated to my specific task. He is perfectly isolated from all other objects around the method. This object is a <em>local variable</em> in the scope of the method. A class, with his static methods, is always a <em>global variable</em> no matter where I use him. Because of that, I can&#39;t isolate my interaction with this <a href="/2017/05/16/monikers.html">variable</a> from others.</p><p>Besides being conceptually against object-oriented principles, public static methods have a few practical drawbacks:</p><p>First, it&#39;s <strong>impossible to mock</strong> them (Well, you can use <a href="https://code.google.com/p/powermock/">PowerMock</a>, but this will then be the most terrible decision you could make in a Java project... I made it once, a few years ago).</p><p>Second, they are <strong>not thread-safe</strong> by definition, because they always work with static variables, which are accessible from all threads. You can make them thread-safe, but this will always require explicit synchronization.</p><p>Every time you see a public static method, start rewriting immediately. I don&#39;t even want to mention how terrible static (or global) variables are. I think it is just obvious.</p><h2 id="6-his-name-is-not-a-job-title">6. His Name Is Not a Job Title</h2><figure class='badge'><img src='https://www.yegor256.com/images/2014/11/good-object-4.png' style='width:250px;max-width:100%;' alt='badge'/></figure><p>The name of an object should tell us what this object <strong>is</strong>, not what it <strong>does</strong>, just like we name objects in real life: book instead of page aggregator, cup instead of water holder, T-shirt instead of body dresser. There are exceptions, of course, like printer or computer, but they were invented just recently and by those who didn&#39;t read this article. :)</p><p>For example, these names tell us who their owners are: an apple, a file, a series of HTTP requests, a socket, an XML document, a list of users, a regular expression, an integer, a PostgreSQL table, or Jeffrey Lebowski. A properly named object is always possible to draw as a small picture. Even a regular expression can be drawn.</p><p>In the opposite, here is an example of names that tell us what their owners do: a file reader, a text parser, a URL validator, an XML printer, a service locator, a <a href="/2016/06/27/singletons-must-die.html">singleton</a>, a script runner, or a Java programmer. Can you draw any of them? No, you can&#39;t. These names are not suitable for good objects. They are terrible names that lead to terrible design.</p><p>In general, avoid names that end with &quot;-er&quot;---most of them are bad.</p><p>&quot;What is the alternative of a <code>FileReader</code>?&quot; I hear you asking. What would be a better name? Let&#39;s see. We already have <code>File</code>, which is a representative of a real-world file on disk. This representative is not powerful enough for us, because he doesn&#39;t know how to read the content of the file. We want to create a more powerful one that will have that ability. What would we call him? Remember, the name should say what he is, not what he does. What is he? He is a file that has data; not just a file, like <code>File</code>, but a more sophisticated one, with data. So how about <code>FileWithData</code> or simply <code>DataFile</code>?</p><p>The same logic should be applicable to all other names. Always think about <strong>what it is</strong> rather than what it does. Give your objects real, meaningful names instead of job titles.</p><p>More about this in <a href="/2015/03/09/objects-end-with-er.html">Don&#39;t Create Objects That End With -ER</a>.</p><h2 id="7-his-class-is-either-final-or-abstract">7. His Class Is Either Final or Abstract</h2><figure class='badge'><img src='https://www.yegor256.com/images/2014/11/good-object-5.png' style='width:250px;max-width:100%;' alt='badge'/></figure><p>A good object comes from either a final or abstract class. A <code>final</code> class is one that can&#39;t be extended via <a href="/2016/09/13/inheritance-is-procedural.html">inheritance</a>. An <code>abstract</code> class is one that can&#39;t have instances. Simply put, a class should either say, &quot;You can never break me; I&#39;m a black box for you&quot; or &quot;I&#39;m broken already; fix me first and then use.&quot;</p><p>There is nothing in between. A final class is a black box that you can&#39;t modify by any means. He works as he works, and you either use him or throw him away. You can&#39;t create another class that will inherit his properties. This is not allowed because of that <code>final</code> modifier. The only way to extend such a final class is through decoration of his children. Let&#39;s say I have the class <code>HTTPStatus</code> (see above), and I don&#39;t like him. Well, I like him, but he&#39;s not powerful enough for me. I want him to <a href="/2015/12/01/rethrow-exceptions.html">throw</a> an exception if HTTP status is over 400. I want his method, <code>read()</code>, to do more that it does now. A traditional way would be to extend the class and overwrite his method:</p><figure class="highlight"><pre><code class="language-java" data-lang="java"><span></span><span class="kd">class</span> <span class="nc">OnlyValidStatus</span> <span class="kd">extends</span> <span class="n">HTTPStatus</span> <span class="o">{</span>
  <span class="kd">public</span> <span class="nf">OnlyValidStatus</span><span class="o">(</span><span class="n">URL</span> <span class="n">url</span><span class="o">)</span> <span class="o">{</span>
    <span class="kd">super</span><span class="o">(</span><span class="n">url</span><span class="o">);</span>
  <span class="o">}</span>
  <span class="nd">@Override</span>
  <span class="kd">public</span> <span class="kt">int</span> <span class="nf">read</span><span class="o">()</span> <span class="kd">throws</span> <span class="n">IOException</span> <span class="o">{</span>
    <span class="kt">int</span> <span class="n">code</span> <span class="o">=</span> <span class="kd">super</span><span class="o">.</span><span class="na">read</span><span class="o">();</span>
    <span class="k">if</span> <span class="o">(</span><span class="n">code</span> <span class="o">&gt;=</span> <span class="mi">400</span><span class="o">)</span> <span class="o">{</span>
      <span class="k">throw</span> <span class="k">new</span> <span class="n">RuntimeException</span><span class="o">(</span><span class="s">&quot;Unsuccessful HTTP code&quot;</span><span class="o">);</span>
    <span class="o">}</span>
    <span class="k">return</span> <span class="n">code</span><span class="o">;</span>
  <span class="o">}</span>
<span class="o">}</span></code></pre></figure><p>Why is this wrong? It is very wrong because we risk breaking the logic of the entire parent class by overriding one of his methods. Remember, once we override the method <code>read()</code> in the child class, all methods from the parent class start to use his new version. We&#39;re literally injecting a new &quot;piece of implementation&quot; right into the class. Philosophically speaking, this is an offense.</p><p>On the other hand, to extend a final class, you have to treat him like a black box and decorate him with your own implementation (a.k.a. <a href="https://en.wikipedia.org/wiki/Decorator_pattern">Decorator Pattern</a>):</p><figure class="highlight"><pre><code class="language-java" data-lang="java"><span></span><span class="kd">final</span> <span class="kd">class</span> <span class="nc">OnlyValidStatus</span> <span class="kd">implements</span> <span class="n">Status</span> <span class="o">{</span>
  <span class="kd">private</span> <span class="kd">final</span> <span class="n">Status</span> <span class="n">origin</span><span class="o">;</span>
  <span class="kd">public</span> <span class="nf">OnlyValidStatus</span><span class="o">(</span><span class="n">Status</span> <span class="n">status</span><span class="o">)</span> <span class="o">{</span>
    <span class="k">this</span><span class="o">.</span><span class="na">origin</span> <span class="o">=</span> <span class="n">status</span><span class="o">;</span>
  <span class="o">}</span>
  <span class="nd">@Override</span>
  <span class="kd">public</span> <span class="kt">int</span> <span class="nf">read</span><span class="o">()</span> <span class="kd">throws</span> <span class="n">IOException</span> <span class="o">{</span>
    <span class="kt">int</span> <span class="n">code</span> <span class="o">=</span> <span class="k">this</span><span class="o">.</span><span class="na">origin</span><span class="o">.</span><span class="na">read</span><span class="o">();</span>
    <span class="k">if</span> <span class="o">(</span><span class="n">code</span> <span class="o">&gt;=</span> <span class="mi">400</span><span class="o">)</span> <span class="o">{</span>
      <span class="k">throw</span> <span class="k">new</span> <span class="n">RuntimeException</span><span class="o">(</span><span class="s">&quot;Unsuccessful HTTP code&quot;</span><span class="o">);</span>
    <span class="o">}</span>
    <span class="k">return</span> <span class="n">code</span><span class="o">;</span>
  <span class="o">}</span>
<span class="o">}</span></code></pre></figure><p>Make sure that this class is implementing the same <a href="/2016/04/26/why-inputstream-design-is-wrong.html">interface</a> as the original one: <code>Status</code>. The instance of <code>HTTPStatus</code> will be passed into him through the constructor and encapsulated. Then every call will be intercepted and implemented in a different way, if necessary. In this design, we treat the original object as a black box and never touch his internal logic.</p><p>If you don&#39;t use that <code>final</code> keyword, anyone (including yourself) will be able to extend the class and... offend him :( So a class without <code>final</code> is a bad design.</p><p>An abstract class is the exact opposite case---he tells us that he is incomplete and we can&#39;t use him &quot;as is.&quot; We have to inject our custom implementation logic into him, but only into the places he allows us to touch. These places are explicitly marked as <code>abstract</code> methods. For example, our <code>HTTPStatus</code> may look like this:</p><figure class="highlight"><pre><code class="language-java" data-lang="java"><span></span><span class="kd">abstract</span> <span class="kd">class</span> <span class="nc">ValidatedHTTPStatus</span> <span class="kd">implements</span> <span class="n">Status</span> <span class="o">{</span>
  <span class="nd">@Override</span>
  <span class="kd">public</span> <span class="kd">final</span> <span class="kt">int</span> <span class="nf">read</span><span class="o">()</span> <span class="kd">throws</span> <span class="n">IOException</span> <span class="o">{</span>
    <span class="kt">int</span> <span class="n">code</span> <span class="o">=</span> <span class="k">this</span><span class="o">.</span><span class="na">origin</span><span class="o">.</span><span class="na">read</span><span class="o">();</span>
    <span class="k">if</span> <span class="o">(!</span><span class="k">this</span><span class="o">.</span><span class="na">isValid</span><span class="o">())</span> <span class="o">{</span>
      <span class="k">throw</span> <span class="k">new</span> <span class="n">RuntimeException</span><span class="o">(</span><span class="s">&quot;Unsuccessful HTTP code&quot;</span><span class="o">);</span>
    <span class="o">}</span>
    <span class="k">return</span> <span class="n">code</span><span class="o">;</span>
  <span class="o">}</span>
  <span class="kd">protected</span> <span class="kd">abstract</span> <span class="kt">boolean</span> <span class="nf">isValid</span><span class="o">();</span>
<span class="o">}</span></code></pre></figure><p>As you see, the class doesn&#39;t know how exactly to validate the HTTP code, and he expects us to inject that logic through inheritance and through overriding the method <code>isValid()</code>. We&#39;re not going to offend him with this inheritance, since he defended all other methods with <code>final</code> (pay attention to the modifiers of his methods). Thus, the class is ready for our offense and is perfectly guarded against it.</p><p>To summarize, your class should either be <code>final</code> or <code>abstract</code>---nothing in between.</p><p>Update (April 2017): If you also agree that <a href="/2016/09/13/inheritance-is-procedural.html">implementation inheritance</a> is evil, all your classes must be <code>final</code>.</p></div></article></div><div class="wrapper"> <related-posts /></div><div class="disqus" role="complementary"><p class="disqus_hint"> Please, use <a href="https://help.disqus.com/commenting/what-html-tags-are-allowed-within-comments">syntax highlighting</a> in your comments, to make them more readable.</p><div id="disqus_thread" class="disqus-thread"> <a>&nbsp;</a></div><script> var disqus_config = function () { this.page.url = document.location.href.split('?')[0].split('#')[0].replace('https://', 'http://'); this.page.identifier = this.page.url; }; (function() { var d = document, s = d.createElement('script'); s.src = '//yegor256.disqus.com/embed.js'; s.setAttribute('data-timestamp', +new Date()); (d.head || d.body).appendChild(s); })(); </script> <noscript><div><p class="red"> JavaScript is disabled in your browser, that's why you can't see comments under this post.</p></div></noscript></div><div class="wrapper"> <footer class="footer"><p> &copy; <span itemscope="" itemprop="copyrightHolder" itemtype="http://schema.org/Person"> <span itemprop="name">Yegor Bugayenko</span> </span> 2014&ndash;<span itemprop="copyrightYear">2018</span></p></footer></div></section><div class="wrapper unprintable" style="text-align:center;margin-top:2em;"> <a href="http://www.sixnines.io/h/3ba1652f"> <img src="//www.sixnines.io/b/3ba1652f?style=flat" alt="sixnines availability badge"/> </a></div><script src="//code.jquery.com/jquery-1.9.0.min.js"></script> <script src="/js/all.js?a0e0d018c07"></script> <script>var disqus_shortname = 'yegor256';</script> <script id="dsq-count-scr" src="//yegor256.disqus.com/count.js" async="async"></script> <script> (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){ (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o), m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m) })(window,document,'script','//www.google-analytics.com/analytics.js','ga'); ga('create', 'UA-1963507-32', 'auto'); ga('send', 'pageview'); </script> <script> Cd=document;Cr="&"+Math.random();Cp="&s=1"; Cd.cookie="b=b";if(Cd.cookie)Cp+="&c=1"; Cp+="&t="+(new Date()).getTimezoneOffset(); if(self!=top)Cp+="&f=1"; </script> <script> if(navigator.javaEnabled())Cp+="&j=1"; </script> <script> if(typeof(screen)!='undefined')Cp+="&w="+screen.width+"&h="+ screen.height+"&d="+(screen.colorDepth?screen.colorDepth:screen.pixelDepth); </script> <script> Cd.write("<img src='//c.hit.ua/hit?i=95870&g=0&x=2"+Cp+Cr+ "&r="+escape(Cd.referrer)+"&u="+escape(window.location.href)+ "' border='0' wi"+"dth='1' he"+"ight='1'/>"); </script> <script type="application/ld+json"> { "@context": "http://schema.org", "@type": "Person", "name": "Yegor Bugayenko", "url": "http://www.yegor256.com", "sameAs": [ "https://www.facebook.com/yegor256", "https://instagram.com/yegor256", "https://www.linkedin.com/in/yegor256", "https://twitter.com/yegor256", "https://github.com/yegor256", "https://www.pinterest.com/yegor256/" ] } </script> </body> </html> <!DOCTYPE html> <html xmlns="http://www.w3.org/1999/xhtml" lang="en-US" xml:lang="en-US" itemscope="" itemtype="http://schema.org/WebSite"> <head> <meta charset="utf-8"/> <meta name="description" content="This article illustrates by example how immutability forces you to design small and cohesive objects, while mutability causes scope creep and tight coupling. " /> <meta name="keywords" content="email sending java, immutability example java, immutable object example, java email api, java email send, java email send sdk, java send email html" /> <meta name="viewport" content="width=device-width,minimum-scale=1,initial-scale=1"/> <meta name="google-site-verification" content="JEj_gQr2CPe2QKGw8XdMz0R7VboQIUbX3FlM-lwTq-8" /> <meta name="author" content="Yegor Bugayenko"> <meta name="article:published_time" content="2014-11-07 00:00:00 +0000"> <meta name="og:site_name" content="Yegor Bugayenko"/> <meta name="og:type" content="article" /> <meta name="og:locale" content="en_US" /> <meta name="twitter:account_id" content="4503599630178231" /> <meta name="twitter:creator" content="@yegor256"/> <meta name="twitter:site" content="@yegor256"/> <meta name="twitter:title" property="og:title" content="How Immutability Helps"/> <meta name="twitter:description" property="og:description" content="This article illustrates by example how immutability forces you to design small and cohesive objects, while mutability causes scope creep and tight coupling. "/> <meta name="twitter:url" property="og:url" content="https://www.yegor256.com/2014/11/07/how-immutability-helps.html"/> <meta name="telegram:channel" content="AAAAAEJFMRzsRTRxM3ec6A"/> <link rel="search" type="application/opensearchdescription+xml" href="/opensearch.xml" title="yegor256" /> <link rel="shortcut icon" href="/favicon.ico?a0e0d018c07"/> <link rel="apple-touch-icon" href="/favicon.ico?a0e0d018c07"/> <link rel="alternate" type="application/rss+xml" title="RSS for yegor256.com" href="https://www.yegor256.com/rss.xml"/> <link rel="stylesheet" href="/css/layout.css?a0e0d018c07"/> <link rel="stylesheet" href="/css/icons.css?a0e0d018c07"/> <link rel="canonical" href="https://www.yegor256.com/2014/11/07/how-immutability-helps.html" /> <link rel="amphtml" href="https://www.yegor256.com/2014/11/07/how-immutability-helps.amp.html" /> <title>How Immutability Helps </title> </head> <body><div class="wrapper"> <aside class="header-toggle unprintable" id="header-toggle" title="Show the menu" onclick="$('#header').show();$('#header-toggle').hide();">&#9776;</aside> <header class="header" id="header"><div class="face"> <a href="/about-me.html#form" class="sub" title="Click to subscribe to my monthly newsletter"><span>Subscribe</span></a> <a href="/about-me.html" style="position:relative;"> <img src="/images/face-256x256.jpg" class="photo" alt="Yegor Bugayenko"/> </a></div><nav><ul class="menu social notranslate"> <li><a href="https://twitter.com/intent/follow?screen_name=yegor256" rel="nofollow" title="Follow me on Twitter"><i class="icon icon-twitter notranslate" aria-hidden="true"></i></a></li> <li><a href="/rss.xml" rel="nofollow" title="Subscribe to my RSS feed"><i class="icon icon-rss notranslate" aria-hidden="true"></i></a></li> <li><a itemprop="sameAs" href="https://github.com/yegor256" rel="nofollow" title="My GitHub profile"><i class="icon icon-github notranslate" aria-hidden="true"></i></a></li> <li><a itemprop="sameAs" href="http://stackoverflow.com/users/187141/yegor256" rel="nofollow" title="My StackOverflow profile"><i class="icon icon-stackoverflow notranslate" aria-hidden="true"></i></a></li> <li><a itemprop="sameAs" href="https://www.facebook.com/yegor256" rel="nofollow" title="Follow me on Facebook"><i class="icon icon-facebook notranslate" aria-hidden="true"></i></a></li> <li><a itemprop="sameAs" href="https://instagram.com/yegor256" rel="nofollow" title="Follow me on Instagram"><i class="icon icon-instagram notranslate" aria-hidden="true"></i></a></li> <li><a itemprop="sameAs" href="https://www.linkedin.com/in/yegor256" rel="nofollow" title="My LinkedIn profile"><i class="icon icon-linkedin notranslate" aria-hidden="true"></i></a></li> <li><a itemprop="sameAs" href="https://www.youtube.com/c/yegor256?sub_confirmation=1" rel="nofollow" title="My Youtube video channel"><i class="icon icon-youtube notranslate" aria-hidden="true"></i></a></li> <li><a itemprop="sameAs" href="https://www.pinterest.com/yegor256/" rel="nofollow" title="My Pinterest boards"><i class="icon icon-pinterest notranslate" aria-hidden="true"></i></a></li> <li><a itemprop="sameAs" href="https://angel.co/yegor256" rel="nofollow" title="My AngelList profile"><i class="icon icon-angellist notranslate" aria-hidden="true"></i></a></li> <li><a href="https://soundcloud.com/yegor256" rel="nofollow" title="My podcast"><i class="icon icon-podcast notranslate" aria-hidden="true"></i></a></li> <li><a href="https://itunes.apple.com/us/podcast/yegor256-podcast/id1150826721" rel="nofollow" title="My iTunes podcast"><i class="icon icon-itunes notranslate" aria-hidden="true"></i></a></li> <li><a href="https://t.me/joinchat/AAAAAEJFMRzsRTRxM3ec6A" rel="nofollow" title="My Telegram public channel"><i class="icon icon-telegram notranslate" aria-hidden="true"></i></a></li> <li><a href="mailto:blog@yegor256.com" rel="nofollow" title="Email me any time"><i class="icon icon-mail notranslate" aria-hidden="true"></i></a></li></ul><ul class="menu"> <li><a href="/" title="Home page">Home</a></li> <li ><a href="/best.html" title="Best articles to read">12&#160;Best</a></li> <li ><a href="/contents.html" title="The contents of the entire blog">All&#160;288</a></li> <li ><a href="/webinars.html" title="My webinars">Webinars</a></li> <li ><a href="/talks.html" title="Future and past conference talks">Talks</a></li> <li ><a href="/books.html" title="The books I wrote">Books</a></li> <li ><a href="/papers.html" title="My academic papers and patents">Papers</a></li> <li ><a href="/pets.html" title="My loved pet projects">Pets</a></li> <li ><a href="/award.html" title="Software quality award">Award</a></li> <li ><a href="/testimonials.html" title="What some people say about me">Testimonials</a></li> <li ><a href="/shift-m.html" title="Audio podcast about project management">Shift-M</a></li> <li ><a href="/paintings.html" title="My paintings for sale">Paintings</a></li> <li><a href="http://ru.yegor256.com/" title="Немного на русском языке">По-русски</a></li></ul></nav><div class="search"> <form method="get" action="https://www.google.com/search" itemprop="potentialAction" itemscope="" itemtype="http://schema.org/SearchAction"> <meta itemprop="target" content="https://www.google.com/search?q={q}"/> <input name="sitesearch" value="yegor256.com" type="hidden"/> <input itemprop="query-input" type="text" id="search-query" class="field field-text" required="required" onfocus="$('.google').css('visibility', 'visible');" name="q" placeholder="Search..." autocomplete="off"/> <input type="image" src="/images/google-search-icon.svg" class="google" title="Search via Google" alt="Search via Google"/> </form></div><div class="hot"><ul> <li> <a href="/code-ahead.html">Code Ahead</a> was published on Amazon just a few days ago! It is my new book, a novel about programmers. It explains in details the majority of ideas that stand behind <a href="https://www.zerocracy.com">Zerocracy</a> and <a href="https://www.xdsd.org">XDSD</a>. </li> <li> At <a href="/webinars.html">Webinar #37</a> we will discuss naming problem in OOP, for objects, methods and attributes; join us on <b>September 12</b>, at 11am PST. </li></ul></div></header></div><section itemscope="" itemtype="http://schema.org/BlogPosting"><div class="wrapper"> <header><p class="printable"> <img src="https://api.qrserver.com/v1/create-qr-code/?data=https://www.yegor256.com/2014/11/07/how-immutability-helps.html&amp;format=svg" style="width:125px;height:125px;" alt="QR code"/></p><p class="printable"> <code itemprop="url">https://www.yegor256.com/2014/11/07/how-immutability-helps.html</code></p><h1 itemprop="name headline mainEntityOfPage">How Immutability Helps</h1><aside class='book'><a href='http://amzn.to/2qFt4Tn'><img src='/images/books/elegant-objects/cover.png' class='book-cover' alt='book cover'/></a>Read more about this subject in <a href='http://amzn.to/2qFt4Tn'>Section&nbsp;2.6</a><br/> of my book<a href='http://amzn.to/2qFt4Tn'><img src='/images/books/amazon-buy-button.png' class='amazon-button' alt='Click to buy'/></a></aside><ul class="subline"> <li> <time itemprop="datePublished" datetime="2014-11-07T00:00:00+00:00"> 7 November 2014 </time> </li> <li class="printable" itemscope="" itemprop="author" itemtype="http://schema.org/Person"> <span itemprop="name">Yegor Bugayenko</span> </li> <li class="unprintable"> <i class="icon icon-comments"></i> <a href="http://www.yegor256.com/2014/11/07/how-immutability-helps.html#disqus_thread" itemprop="discussionUrl">comments</a> </li></ul><ul class="subline"> <li>Discussed at:</li> <li><a href="https://www.reddit.com/r/programming/comments/2llw2x/how_immutability_helps_in_object_design/">reddit</a></li></ul><p class="unprintable"><p>In a few recent posts, including <a href="/2014/09/16/getters-and-setters-are-evil.html">Getters/Setters. Evil. Period.</a> <a href="/2014/06/09/objects-should-be-immutable.html">Objects Should Be Immutable</a>, and <a href="/2014/10/03/di-containers-are-evil.html">Dependency Injection Containers are Code Polluters</a>, I universally labeled all mutable objects with &quot;setters&quot; (object methods starting with <code>set</code>) evil. My argumentation was based mostly on metaphors and abstract examples. Apparently, this wasn&#39;t convincing enough for many of you---I received a few requests asking to provide more specific and practical examples.</p><p>Thus, in order to illustrate my strongly negative attitude to &quot;mutability via setters,&quot; I took an existing <a href="http://commons.apache.org/proper/commons-email/">commons-email</a> Java library from Apache and re-designed it my way, without setters and with &quot;object thinking&quot; in mind. I released my library as part of the <a href="http://www.jcabi.com">jcabi</a> family---<a href="http://email.jcabi.com">jcabi-email</a>. Let&#39;s see what benefits we get from a &quot;pure&quot; object-oriented and immutable approach, without getters.</p><p>Here is how your code will look, if you send an email using commons-email:</p><figure class="highlight"><pre><code class="language-java" data-lang="java"><span></span><span class="n">Email</span> <span class="n">email</span> <span class="o">=</span> <span class="k">new</span> <span class="n">SimpleEmail</span><span class="o">();</span>
<span class="n">email</span><span class="o">.</span><span class="na">setHostName</span><span class="o">(</span><span class="s">&quot;smtp.googlemail.com&quot;</span><span class="o">);</span>
<span class="n">email</span><span class="o">.</span><span class="na">setSmtpPort</span><span class="o">(</span><span class="mi">465</span><span class="o">);</span>
<span class="n">email</span><span class="o">.</span><span class="na">setAuthenticator</span><span class="o">(</span><span class="k">new</span> <span class="n">DefaultAuthenticator</span><span class="o">(</span><span class="s">&quot;user&quot;</span><span class="o">,</span> <span class="s">&quot;pwd&quot;</span><span class="o">));</span>
<span class="n">email</span><span class="o">.</span><span class="na">setFrom</span><span class="o">(</span><span class="s">&quot;yegor256@gmail.com&quot;</span><span class="o">,</span> <span class="s">&quot;Yegor Bugayenko&quot;</span><span class="o">);</span>
<span class="n">email</span><span class="o">.</span><span class="na">addTo</span><span class="o">(</span><span class="s">&quot;dude@jcabi.com&quot;</span><span class="o">);</span>
<span class="n">email</span><span class="o">.</span><span class="na">setSubject</span><span class="o">(</span><span class="s">&quot;how are you?&quot;</span><span class="o">);</span>
<span class="n">email</span><span class="o">.</span><span class="na">setMsg</span><span class="o">(</span><span class="s">&quot;Dude, how are you?&quot;</span><span class="o">);</span>
<span class="n">email</span><span class="o">.</span><span class="na">send</span><span class="o">();</span></code></pre></figure><p>Here is how you do the same with <a href="http://email.jcabi.com">jcabi-email</a>:</p><figure class="highlight"><pre><code class="language-java" data-lang="java"><span></span><span class="n">Postman</span> <span class="n">postman</span> <span class="o">=</span> <span class="k">new</span> <span class="n">Postman</span><span class="o">.</span><span class="na">Default</span><span class="o">(</span>
  <span class="k">new</span> <span class="n">SMTP</span><span class="o">(</span><span class="s">&quot;smtp.googlemail.com&quot;</span><span class="o">,</span> <span class="mi">465</span><span class="o">,</span> <span class="s">&quot;user&quot;</span><span class="o">,</span> <span class="s">&quot;pwd&quot;</span><span class="o">)</span>
<span class="o">);</span>
<span class="n">Envelope</span> <span class="n">envelope</span> <span class="o">=</span> <span class="k">new</span> <span class="n">Envelope</span><span class="o">.</span><span class="na">MIME</span><span class="o">(</span>
  <span class="k">new</span> <span class="n">Array</span><span class="o">&lt;</span><span class="n">Stamp</span><span class="o">&gt;(</span>
    <span class="k">new</span> <span class="n">StSender</span><span class="o">(</span><span class="s">&quot;Yegor Bugayenko &lt;yegor256@gmail.com&gt;&quot;</span><span class="o">),</span>
    <span class="k">new</span> <span class="n">StRecipient</span><span class="o">(</span><span class="s">&quot;dude@jcabi.com&quot;</span><span class="o">),</span>
    <span class="k">new</span> <span class="n">StSubject</span><span class="o">(</span><span class="s">&quot;how are you?&quot;</span><span class="o">)</span>
  <span class="o">),</span>
  <span class="k">new</span> <span class="n">Array</span><span class="o">&lt;</span><span class="n">Enclosure</span><span class="o">&gt;(</span>
    <span class="k">new</span> <span class="n">EnPlain</span><span class="o">(</span><span class="s">&quot;Dude, how are you?&quot;</span><span class="o">)</span>
  <span class="o">)</span>
<span class="o">);</span>
<span class="n">postman</span><span class="o">.</span><span class="na">send</span><span class="o">(</span><span class="n">envelope</span><span class="o">);</span></code></pre></figure><p>I think the difference is obvious.</p><p>In the first example, you&#39;re dealing with a monster <a href="/2016/09/20/oop-without-classes.html">class</a> that can do everything for you, including sending your MIME message via SMTP, creating the message, configuring its parameters, adding MIME parts to it, etc. The <a href="http://svn.apache.org/viewvc/commons/proper/email/tags/EMAIL_1_3_3/src/main/java/org/apache/commons/mail/Email.java?revision=1609295&view=co"><code>Email</code></a> class from commons-email is really a huge class---33 private properties, over a hundred methods, about two thousands lines of code. First, you configure the class through a bunch of setters and then you ask it to <code>send()</code> an email for you.</p><aside class='youtube'> <a href='https://www.youtube.com/watch?v=KwP7Ay9Z-hc'><div class='box'> <img src='https://i.ytimg.com/vi/KwP7Ay9Z-hc/mqdefault.jpg' alt='YouTube video #KwP7Ay9Z-hc'/><div class='play'><i class='icon icon-play'></i></div></div></a><div>Immutable Objects vs. Common Sense (webinar #2); 6 May 2015.</div></aside><p>In the second example, we have seven objects instantiated via seven <code>new</code> calls. <code>Postman</code> is responsible for packaging a MIME message; <code>SMTP</code> is responsible for sending it via SMTP; stamps (<code>StSender</code>, <code>StRecipient</code>, and <code>StSubject</code>) are responsible for configuring the MIME message before delivery; enclosure <code>EnPlain</code> is responsible for creating a MIME part for the message we&#39;re going to send. We construct these seven objects, encapsulating one into another, and then we ask the postman to <code>send()</code> the envelope for us.</p><h2 id="whats-wrong-with-a-mutable-email">What&#39;s Wrong With a Mutable Email?</h2><p>From a user perspective, there is almost nothing wrong. <code>Email</code> is a powerful class with multiple controls---just hit the right one and the job gets done. However, from a developer perspective <code>Email</code> class is a nightmare. Mostly because the class is very big and difficult to maintain.</p><p><em>Because the class is so big</em>, every time you want to extend it by introducing a new method, you&#39;re facing the fact that you&#39;re making the class even worse---longer, less cohesive, less readable, less maintainable, etc. You have a feeling that you&#39;re digging into something dirty and that there is no hope to make it cleaner, ever. I&#39;m sure, you&#39;re familiar with this feeling---most legacy applications look that way. They have huge multi-line &quot;classes&quot; (in reality, COBOL programs written in Java) that were inherited from a few generations of programmers before you. When you start, you&#39;re full of energy, but after a few minutes of scrolling such a &quot;class&quot; you say---&quot;screw it, it&#39;s almost Saturday.&quot;</p><aside class='youtube'> <a href='https://www.youtube.com/watch?v=EnhRgXrHCC4'><div class='box'> <img src='https://i.ytimg.com/vi/EnhRgXrHCC4/mqdefault.jpg' alt='YouTube video #EnhRgXrHCC4'/><div class='play'><i class='icon icon-play'></i></div></div></a><div>How Immutability Helps in OOP (in Russian with English subtitles); 21 May 2016.</div></aside><p><em>Because the class is so big</em>, there is no data hiding or encapsulation any more---33 variables are accessible by over 100 methods. What is hidden? This <code>Email.java</code> file in reality is a big, procedural 2000-line script, called a &quot;class&quot; by mistake. Nothing is hidden, once you cross the border of the class by calling one of its methods. After that, you have full access to all the data you may need. Why is this bad? Well, why do we need <a href="/2016/11/21/naked-data.html">encapsulation</a> in the first place? In order to protect one programmer from another, aka <a href="/2016/01/26/defensive-programming.html">defensive programming</a>. While I&#39;m busy changing the subject of the MIME message, I want to be sure that I&#39;m not interfered with by some other method&#39;s activity, that is changing a sender and touching my subject by mistake. Encapsulation helps us narrow down the scope of the problem, while this <code>Email</code> class is doing exactly the opposite.</p><p><em>Because the class is so big</em>, its unit testing is even more complicated than the class itself. Why? Because of multiple inter-dependencies between its methods and properties. In order to test <code>setCharset()</code> you have to prepare the entire object by calling a few other methods, then you have to call <code>send()</code> to make sure the message being sent actually uses the encoding you specified. Thus, in order to test a one-line method <code>setCharset()</code> you run the entire integration testing scenario of sending a full MIME message through SMTP. Obviously, if something gets changed in one of the methods, almost every test method will be affected. In other words, tests are very fragile, unreliable and over-complicated.</p><p>I can go on and on with this &quot;<em>because the class is so big</em>,&quot; but I think it is obvious that a small, cohesive class is always better than a big one. It is obvious to me, to you, and to any object-oriented programmer. But why is it not so obvious to the developers of Apache Commons Email? I don&#39;t think they are stupid or un-educated. What is it then?</p><h2 id="how-and-why-did-it-happen">How and Why Did It Happen?</h2><p>This is how it always happens. You start to design a class as something cohesive, solid, and small. Your intentions are very positive. Very soon you realize that there is something else that this class has to do. Then, something else. Then, even more.</p><p>The best way to make your class more and more powerful is by adding setters that inject configuration parameters into the class so that it can process them inside, isn&#39;t it?</p><aside class='youtube'> <a href='https://www.youtube.com/watch?v=p7m7_iiqaHI'><div class='box'> <img src='https://i.ytimg.com/vi/p7m7_iiqaHI/mqdefault.jpg' alt='YouTube video #p7m7_iiqaHI'/><div class='play'><i class='icon icon-play'></i></div></div></a><div>How Much Immutability Is Enough?; 19 May 2016.</div></aside><p>This is the root cause of the problem! The root cause is our ability to <em>insert</em> data into mutable objects via configuration methods, also known as &quot;setters.&quot; When an <a href="/2016/07/14/who-is-object.html">object</a> is mutable and allows us to add setters whenever we want, we will do it without limits.</p><p>Let me put it this way---<em>mutable classes tend to grow in size and lose cohesiveness</em>.</p><p>If commons-email authors made this <code>Email</code> class immutable in the beginning, they wouldn&#39;t have been able to add so many methods into it and encapsulate so many properties. They wouldn&#39;t be able to turn it into a monster. Why? Because an immutable object only accepts a state through a constructor. Can you imagine a 33-argument constructor? Of course, not.</p><p>When you make your class immutable in the first place, you are forced to keep it cohesive, small, solid and robust. Because you can&#39;t encapsulate too much and you can&#39;t modify what&#39;s encapsulated. Just two or three arguments of a constructor and you&#39;re done.</p><h2 id="how-did-i-design-an-immutable-email">How Did I Design An Immutable Email?</h2><figure class='badge'><a href='http://http.jcabi.com'><img src='http://img.jcabi.com/logo-square.svg' style='width:64px;max-width:100%;' alt='badge'/></a></figure><p>When I was designing <a href="https://github.com/jcabi/jcabi-email">jcabi-email</a> I started with a small and simple class: <a href="https://github.com/jcabi/jcabi-email/blob/1.3/src/main/java/com/jcabi/email/Postman.java"><code>Postman</code></a>. Well, it is an interface, since I never make <a href="/2016/04/26/why-inputstream-design-is-wrong.html">interface</a>-less classes. So, <code>Postman</code> is... a post man. He is delivering messages to other people. First, I created a default version of it (I omit the ctor, for the sake of brevity):</p><figure class="highlight"><pre><code class="language-java" data-lang="java"><span></span><span class="kn">import</span> <span class="nn">javax.mail.Message</span><span class="o">;</span>
<span class="nd">@Immutable</span>
<span class="kd">class</span> <span class="nc">Postman</span><span class="o">.</span><span class="na">Default</span> <span class="kd">implements</span> <span class="n">Postman</span> <span class="o">{</span>
  <span class="kd">private</span> <span class="kd">final</span> <span class="n">String</span> <span class="n">host</span><span class="o">;</span>
  <span class="kd">private</span> <span class="kd">final</span> <span class="kt">int</span> <span class="n">port</span><span class="o">;</span>
  <span class="kd">private</span> <span class="kd">final</span> <span class="n">String</span> <span class="n">user</span><span class="o">;</span>
  <span class="kd">private</span> <span class="kd">final</span> <span class="n">String</span> <span class="n">password</span><span class="o">;</span>
  <span class="nd">@Override</span>
  <span class="kt">void</span> <span class="nf">send</span><span class="o">(</span><span class="n">Message</span> <span class="n">msg</span><span class="o">)</span> <span class="o">{</span>
    <span class="c1">// create SMTP session</span>
    <span class="c1">// create transport</span>
    <span class="c1">// transport.connect(this.host, this.port, etc.)</span>
    <span class="c1">// transport.send(msg)</span>
    <span class="c1">// transport.close();</span>
  <span class="o">}</span>
<span class="o">}</span></code></pre></figure><p>Good start, it works. What now? Well, the <a href="http://docs.oracle.com/javaee/7/api/javax/jms/Message.html"><code>Message</code></a> is difficult to construct. It is a complex class from JDK that requires some manipulations before it can become a nice HTML email. So I created an envelope, which will build this complex object for me (pay attention, both <a href="https://github.com/jcabi/jcabi-email/blob/1.3/src/main/java/com/jcabi/email/Postman.java"><code>Postman</code></a> and <a href="https://github.com/jcabi/jcabi-email/blob/1.3/src/main/java/com/jcabi/email/Envelope.java"><code>Envelope</code></a> are immutable and annotated with <a href="http://aspects.jcabi.com/apidocs-0.20/com/jcabi/aspects/Immutable.html">@Immutable</a> from <a href="http://aspects.jcabi.com/annotation-immutable.html">jcabi-aspects</a>):</p><figure class="highlight"><pre><code class="language-java" data-lang="java"><span></span><span class="nd">@Immutable</span>
<span class="kd">interface</span> <span class="nc">Envelope</span> <span class="o">{</span>
  <span class="n">Message</span> <span class="nf">unwrap</span><span class="o">();</span>
<span class="o">}</span></code></pre></figure><p>I also refactor the <code>Postman</code> to accept an envelope, not a message:</p><figure class="highlight"><pre><code class="language-java" data-lang="java"><span></span><span class="nd">@Immutable</span>
<span class="kd">interface</span> <span class="nc">Postman</span> <span class="o">{</span>
  <span class="kt">void</span> <span class="nf">send</span><span class="o">(</span><span class="n">Envelope</span> <span class="n">env</span><span class="o">);</span>
<span class="o">}</span></code></pre></figure><p>So far, so good. Now let&#39;s try to create a simple implementation of <code>Envelope</code>:</p><figure class="highlight"><pre><code class="language-java" data-lang="java"><span></span><span class="nd">@Immutable</span>
<span class="kd">class</span> <span class="nc">MIME</span> <span class="kd">implements</span> <span class="n">Envelope</span> <span class="o">{</span>
  <span class="nd">@Override</span>
  <span class="kd">public</span> <span class="n">Message</span> <span class="nf">unwrap</span><span class="o">()</span> <span class="o">{</span>
    <span class="k">return</span> <span class="k">new</span> <span class="n">MimeMessage</span><span class="o">(</span>
      <span class="n">Session</span><span class="o">.</span><span class="na">getDefaultInstance</span><span class="o">(</span><span class="k">new</span> <span class="n">Properties</span><span class="o">())</span>
    <span class="o">);</span>
  <span class="o">}</span>
<span class="o">}</span></code></pre></figure><p>It works, but it does nothing useful yet. It only creates an absolutely empty MIME message and returns it. How about adding a subject to it and both <code>To:</code> and <code>From:</code> addresses (pay attention, <a href="http://email.jcabi.com/apidocs-1.10/com/jcabi/email/Envelope.Mime.html"><code>MIME</code></a> class is also immutable):</p><figure class="highlight"><pre><code class="language-java" data-lang="java"><span></span><span class="nd">@Immutable</span>
<span class="kd">class</span> <span class="nc">Envelope</span><span class="o">.</span><span class="na">MIME</span> <span class="kd">implements</span> <span class="n">Envelope</span> <span class="o">{</span>
  <span class="kd">private</span> <span class="kd">final</span> <span class="n">String</span> <span class="n">subject</span><span class="o">;</span>
  <span class="kd">private</span> <span class="kd">final</span> <span class="n">String</span> <span class="n">from</span><span class="o">;</span>
  <span class="kd">private</span> <span class="kd">final</span> <span class="n">Array</span><span class="o">&lt;</span><span class="n">String</span><span class="o">&gt;</span> <span class="n">to</span><span class="o">;</span>
  <span class="kd">public</span> <span class="nf">MIME</span><span class="o">(</span><span class="n">String</span> <span class="n">subj</span><span class="o">,</span> <span class="n">String</span> <span class="n">sender</span><span class="o">,</span> <span class="n">Iterable</span><span class="o">&lt;</span><span class="n">String</span><span class="o">&gt;</span> <span class="n">rcpts</span><span class="o">)</span> <span class="o">{</span>
    <span class="k">this</span><span class="o">.</span><span class="na">subject</span> <span class="o">=</span> <span class="n">subj</span><span class="o">;</span>
    <span class="k">this</span><span class="o">.</span><span class="na">from</span> <span class="o">=</span> <span class="n">sender</span><span class="o">;</span>
    <span class="k">this</span><span class="o">.</span><span class="na">to</span> <span class="o">=</span> <span class="k">new</span> <span class="n">Array</span><span class="o">&lt;</span><span class="n">String</span><span class="o">&gt;(</span><span class="n">rcpts</span><span class="o">);</span>
  <span class="o">}</span>
  <span class="nd">@Override</span>
  <span class="kd">public</span> <span class="n">Message</span> <span class="nf">unwrap</span><span class="o">()</span> <span class="o">{</span>
    <span class="n">Message</span> <span class="n">msg</span> <span class="o">=</span> <span class="k">new</span> <span class="n">MimeMessage</span><span class="o">(</span>
      <span class="n">Session</span><span class="o">.</span><span class="na">getDefaultInstance</span><span class="o">(</span><span class="k">new</span> <span class="n">Properties</span><span class="o">())</span>
    <span class="o">);</span>
    <span class="n">msg</span><span class="o">.</span><span class="na">setSubject</span><span class="o">(</span><span class="k">this</span><span class="o">.</span><span class="na">subject</span><span class="o">);</span>
    <span class="n">msg</span><span class="o">.</span><span class="na">setFrom</span><span class="o">(</span><span class="k">new</span> <span class="n">InternetAddress</span><span class="o">(</span><span class="k">this</span><span class="o">.</span><span class="na">from</span><span class="o">));</span>
    <span class="k">for</span> <span class="o">(</span><span class="n">String</span> <span class="n">email</span> <span class="o">:</span> <span class="k">this</span><span class="o">.</span><span class="na">to</span><span class="o">)</span> <span class="o">{</span>
      <span class="n">msg</span><span class="o">.</span><span class="na">setRecipient</span><span class="o">(</span>
        <span class="n">Message</span><span class="o">.</span><span class="na">RecipientType</span><span class="o">.</span><span class="na">TO</span><span class="o">,</span>
        <span class="k">new</span> <span class="n">InternetAddress</span><span class="o">(</span><span class="n">email</span><span class="o">)</span>
      <span class="o">);</span>
    <span class="o">}</span>
    <span class="k">return</span> <span class="n">msg</span><span class="o">;</span>
  <span class="o">}</span>
<span class="o">}</span></code></pre></figure><p>Looks correct and it works. But it is still too primitive. How about <code>CC:</code> and <code>BCC:</code>? What about email text? How about PDF enclosures? What if I want to specify the encoding of the message? What about <code>Reply-To</code>?</p><p>Can I add all these parameters to the constructor? Remember, the class is immutable and I can&#39;t introduce the <code>setReplyTo()</code> method. I have to pass the <code>replyTo</code> argument into its constructor. It&#39;s impossible, because the constructor will have too many arguments, and nobody will be able to use it.</p><p>So, what do I do?</p><p>Well, I started to think: how can we break the concept of an &quot;envelope&quot; into smaller concepts---and this what I invented. Like a real-life envelope, my <code>MIME</code> object will have stamps. Stamps will be responsible for configuring an object <code>Message</code> (again, <a href="https://github.com/jcabi/jcabi-email/blob/1.3/src/main/java/com/jcabi/email/Stamp.java"><code>Stamp</code></a> is immutable, as well as all its implementers):</p><figure class="highlight"><pre><code class="language-java" data-lang="java"><span></span><span class="nd">@Immutable</span>
<span class="kd">interface</span> <span class="nc">Stamp</span> <span class="o">{</span>
  <span class="kt">void</span> <span class="nf">attach</span><span class="o">(</span><span class="n">Message</span> <span class="n">message</span><span class="o">);</span>
<span class="o">}</span></code></pre></figure><p>Now, I can simplify my <a href="https://github.com/jcabi/jcabi-email/blob/1.3/src/main/java/com/jcabi/email/Envelope.java"><code>MIME</code></a> class to the following:</p><figure class="highlight"><pre><code class="language-java" data-lang="java"><span></span><span class="nd">@Immutable</span>
<span class="kd">class</span> <span class="nc">Envelope</span><span class="o">.</span><span class="na">MIME</span> <span class="kd">implements</span> <span class="n">Envelope</span> <span class="o">{</span>
  <span class="kd">private</span> <span class="kd">final</span> <span class="n">Array</span><span class="o">&lt;</span><span class="n">Stamp</span><span class="o">&gt;</span> <span class="n">stamps</span><span class="o">;</span>
  <span class="kd">public</span> <span class="nf">MIME</span><span class="o">(</span><span class="n">Iterable</span><span class="o">&lt;</span><span class="n">Stamp</span><span class="o">&gt;</span> <span class="n">stmps</span><span class="o">)</span> <span class="o">{</span>
    <span class="k">this</span><span class="o">.</span><span class="na">stamps</span> <span class="o">=</span> <span class="k">new</span> <span class="n">Array</span><span class="o">&lt;</span><span class="n">Stamp</span><span class="o">&gt;(</span><span class="n">stmps</span><span class="o">);</span>
  <span class="o">}</span>
  <span class="nd">@Override</span>
  <span class="kd">public</span> <span class="n">Message</span> <span class="nf">unwrap</span><span class="o">()</span> <span class="o">{</span>
    <span class="n">Message</span> <span class="n">msg</span> <span class="o">=</span> <span class="k">new</span> <span class="n">MimeMessage</span><span class="o">(</span>
      <span class="n">Session</span><span class="o">.</span><span class="na">getDefaultInstance</span><span class="o">(</span><span class="k">new</span> <span class="n">Properties</span><span class="o">())</span>
    <span class="o">);</span>
    <span class="k">for</span> <span class="o">(</span><span class="n">Stamp</span> <span class="n">stamp</span> <span class="o">:</span> <span class="k">this</span><span class="o">.</span><span class="na">stamps</span><span class="o">)</span> <span class="o">{</span>
      <span class="n">stamp</span><span class="o">.</span><span class="na">attach</span><span class="o">(</span><span class="n">msg</span><span class="o">);</span>
    <span class="o">}</span>
    <span class="k">return</span> <span class="n">msg</span><span class="o">;</span>
  <span class="o">}</span>
<span class="o">}</span></code></pre></figure><p>Now, I will create stamps for the subject, for <code>To:</code>, for <code>From:</code>, for <code>CC:</code>, for <code>BCC:</code>, etc. As many stamps as I like. The class <code>MIME</code> will stay the same---small, cohesive, readable, solid, etc.</p><p>What is important here is why I made the decision to refactor while the class was relatively small. Indeed, I started to worry about these stamp classes when my <code>MIME</code> class was just 25 lines in size.</p><p>That is exactly the point of this article---<em>immutability forces you to design small and cohesive objects</em>.</p><p>Without immutability, I would have gone the same direction as commons-email. My <code>MIME</code> class would grow in size and sooner or later would become as big as <code>Email</code> from commons-email. The only thing that stopped me was the necessity to refactor it, because I wasn&#39;t able to pass all arguments through a constructor.</p><p>Without immutability, I wouldn&#39;t have had that motivator and I would have done what Apache developers did with commons-email---bloat the class and turn it into an unmaintainable <a href="/2017/09/12/evil-object-name-suffix-client.html">monster</a>.</p><p>That&#39;s <a href="http://email.jcabi.com">jcabi-email</a>. I hope this example was illustrative enough and that you will start writing cleaner code with immutable objects.</p></p><nav class="buttons notranslate desktop-only"> <a href="http://www.facebook.com/sharer/sharer.php?u=https://www.yegor256.com/2014/11/07/how-immutability-helps.html" title="Share on Facebook" class="button" rel="nofollow"> <span class="count count-facebook">0</span> <i class="icon icon-facebook notranslate" aria-hidden="true"></i> </a> <a href="https://twitter.com/share?url=https://www.yegor256.com/2014/11/07/how-immutability-helps.html&amp;text=How+Immutability+Helps" title="Share on Twitter" class="button" rel="nofollow"> <span class="count count-twitter">0</span> <i class="icon icon-twitter notranslate" aria-hidden="true"></i> </a> <a href="https://plus.google.com/share?url=https://www.yegor256.com/2014/11/07/how-immutability-helps.html" title="Share on Google+" class="button" rel="nofollow"> <span class="count count-googleplus">0</span> <i class="icon icon-googleplus notranslate" aria-hidden="true"></i> </a> <a href="https://www.linkedin.com/cws/share?url=https://www.yegor256.com/2014/11/07/how-immutability-helps.html" title="Share on LinkedIn" class="button" rel="nofollow"> <span class="count count-linkedin">0</span> <i class="icon icon-linkedin notranslate" aria-hidden="true"></i> </a> <a href="http://reddit.com/submit?url=https://www.yegor256.com/2014/11/07/how-immutability-helps.html%3F2014-44&amp;title=How+Immutability+Helps" title="Share on Reddit" class="button" rel="nofollow"> <span class="count count-reddit">0</span> <i class="icon icon-reddit notranslate" aria-hidden="true"></i> </a> <a href="http://news.ycombinator.com/submitlink?u=https://www.yegor256.com/2014/11/07/how-immutability-helps.html%3F2014-44&amp;t=How+Immutability+Helps" title="Share on Hacker News" class="button" rel="nofollow"> <span class="count count-hackernews">0</span> <i class="icon icon-hackernews notranslate" aria-hidden="true"></i> </a> </nav> </header> <article class="main" itemprop="articleBody"><div ><p>In a few recent posts, including <a href="/2014/09/16/getters-and-setters-are-evil.html">Getters/Setters. Evil. Period.</a> <a href="/2014/06/09/objects-should-be-immutable.html">Objects Should Be Immutable</a>, and <a href="/2014/10/03/di-containers-are-evil.html">Dependency Injection Containers are Code Polluters</a>, I universally labeled all mutable objects with &quot;setters&quot; (object methods starting with <code>set</code>) evil. My argumentation was based mostly on metaphors and abstract examples. Apparently, this wasn&#39;t convincing enough for many of you---I received a few requests asking to provide more specific and practical examples.</p><p>Thus, in order to illustrate my strongly negative attitude to &quot;mutability via setters,&quot; I took an existing <a href="http://commons.apache.org/proper/commons-email/">commons-email</a> Java library from Apache and re-designed it my way, without setters and with &quot;object thinking&quot; in mind. I released my library as part of the <a href="http://www.jcabi.com">jcabi</a> family---<a href="http://email.jcabi.com">jcabi-email</a>. Let&#39;s see what benefits we get from a &quot;pure&quot; object-oriented and immutable approach, without getters.</p><p>Here is how your code will look, if you send an email using commons-email:</p><figure class="highlight"><pre><code class="language-java" data-lang="java"><span></span><span class="n">Email</span> <span class="n">email</span> <span class="o">=</span> <span class="k">new</span> <span class="n">SimpleEmail</span><span class="o">();</span>
<span class="n">email</span><span class="o">.</span><span class="na">setHostName</span><span class="o">(</span><span class="s">&quot;smtp.googlemail.com&quot;</span><span class="o">);</span>
<span class="n">email</span><span class="o">.</span><span class="na">setSmtpPort</span><span class="o">(</span><span class="mi">465</span><span class="o">);</span>
<span class="n">email</span><span class="o">.</span><span class="na">setAuthenticator</span><span class="o">(</span><span class="k">new</span> <span class="n">DefaultAuthenticator</span><span class="o">(</span><span class="s">&quot;user&quot;</span><span class="o">,</span> <span class="s">&quot;pwd&quot;</span><span class="o">));</span>
<span class="n">email</span><span class="o">.</span><span class="na">setFrom</span><span class="o">(</span><span class="s">&quot;yegor256@gmail.com&quot;</span><span class="o">,</span> <span class="s">&quot;Yegor Bugayenko&quot;</span><span class="o">);</span>
<span class="n">email</span><span class="o">.</span><span class="na">addTo</span><span class="o">(</span><span class="s">&quot;dude@jcabi.com&quot;</span><span class="o">);</span>
<span class="n">email</span><span class="o">.</span><span class="na">setSubject</span><span class="o">(</span><span class="s">&quot;how are you?&quot;</span><span class="o">);</span>
<span class="n">email</span><span class="o">.</span><span class="na">setMsg</span><span class="o">(</span><span class="s">&quot;Dude, how are you?&quot;</span><span class="o">);</span>
<span class="n">email</span><span class="o">.</span><span class="na">send</span><span class="o">();</span></code></pre></figure><p>Here is how you do the same with <a href="http://email.jcabi.com">jcabi-email</a>:</p><figure class="highlight"><pre><code class="language-java" data-lang="java"><span></span><span class="n">Postman</span> <span class="n">postman</span> <span class="o">=</span> <span class="k">new</span> <span class="n">Postman</span><span class="o">.</span><span class="na">Default</span><span class="o">(</span>
  <span class="k">new</span> <span class="n">SMTP</span><span class="o">(</span><span class="s">&quot;smtp.googlemail.com&quot;</span><span class="o">,</span> <span class="mi">465</span><span class="o">,</span> <span class="s">&quot;user&quot;</span><span class="o">,</span> <span class="s">&quot;pwd&quot;</span><span class="o">)</span>
<span class="o">);</span>
<span class="n">Envelope</span> <span class="n">envelope</span> <span class="o">=</span> <span class="k">new</span> <span class="n">Envelope</span><span class="o">.</span><span class="na">MIME</span><span class="o">(</span>
  <span class="k">new</span> <span class="n">Array</span><span class="o">&lt;</span><span class="n">Stamp</span><span class="o">&gt;(</span>
    <span class="k">new</span> <span class="n">StSender</span><span class="o">(</span><span class="s">&quot;Yegor Bugayenko &lt;yegor256@gmail.com&gt;&quot;</span><span class="o">),</span>
    <span class="k">new</span> <span class="n">StRecipient</span><span class="o">(</span><span class="s">&quot;dude@jcabi.com&quot;</span><span class="o">),</span>
    <span class="k">new</span> <span class="n">StSubject</span><span class="o">(</span><span class="s">&quot;how are you?&quot;</span><span class="o">)</span>
  <span class="o">),</span>
  <span class="k">new</span> <span class="n">Array</span><span class="o">&lt;</span><span class="n">Enclosure</span><span class="o">&gt;(</span>
    <span class="k">new</span> <span class="n">EnPlain</span><span class="o">(</span><span class="s">&quot;Dude, how are you?&quot;</span><span class="o">)</span>
  <span class="o">)</span>
<span class="o">);</span>
<span class="n">postman</span><span class="o">.</span><span class="na">send</span><span class="o">(</span><span class="n">envelope</span><span class="o">);</span></code></pre></figure><p>I think the difference is obvious.</p><p>In the first example, you&#39;re dealing with a monster <a href="/2016/09/20/oop-without-classes.html">class</a> that can do everything for you, including sending your MIME message via SMTP, creating the message, configuring its parameters, adding MIME parts to it, etc. The <a href="http://svn.apache.org/viewvc/commons/proper/email/tags/EMAIL_1_3_3/src/main/java/org/apache/commons/mail/Email.java?revision=1609295&view=co"><code>Email</code></a> class from commons-email is really a huge class---33 private properties, over a hundred methods, about two thousands lines of code. First, you configure the class through a bunch of setters and then you ask it to <code>send()</code> an email for you.</p><aside class='youtube'> <a href='https://www.youtube.com/watch?v=KwP7Ay9Z-hc'><div class='box'> <img src='https://i.ytimg.com/vi/KwP7Ay9Z-hc/mqdefault.jpg' alt='YouTube video #KwP7Ay9Z-hc'/><div class='play'><i class='icon icon-play'></i></div></div></a><div>Immutable Objects vs. Common Sense (webinar #2); 6 May 2015.</div></aside><p>In the second example, we have seven objects instantiated via seven <code>new</code> calls. <code>Postman</code> is responsible for packaging a MIME message; <code>SMTP</code> is responsible for sending it via SMTP; stamps (<code>StSender</code>, <code>StRecipient</code>, and <code>StSubject</code>) are responsible for configuring the MIME message before delivery; enclosure <code>EnPlain</code> is responsible for creating a MIME part for the message we&#39;re going to send. We construct these seven objects, encapsulating one into another, and then we ask the postman to <code>send()</code> the envelope for us.</p><h2 id="whats-wrong-with-a-mutable-email">What&#39;s Wrong With a Mutable Email?</h2><p>From a user perspective, there is almost nothing wrong. <code>Email</code> is a powerful class with multiple controls---just hit the right one and the job gets done. However, from a developer perspective <code>Email</code> class is a nightmare. Mostly because the class is very big and difficult to maintain.</p><p><em>Because the class is so big</em>, every time you want to extend it by introducing a new method, you&#39;re facing the fact that you&#39;re making the class even worse---longer, less cohesive, less readable, less maintainable, etc. You have a feeling that you&#39;re digging into something dirty and that there is no hope to make it cleaner, ever. I&#39;m sure, you&#39;re familiar with this feeling---most legacy applications look that way. They have huge multi-line &quot;classes&quot; (in reality, COBOL programs written in Java) that were inherited from a few generations of programmers before you. When you start, you&#39;re full of energy, but after a few minutes of scrolling such a &quot;class&quot; you say---&quot;screw it, it&#39;s almost Saturday.&quot;</p><aside class='youtube'> <a href='https://www.youtube.com/watch?v=EnhRgXrHCC4'><div class='box'> <img src='https://i.ytimg.com/vi/EnhRgXrHCC4/mqdefault.jpg' alt='YouTube video #EnhRgXrHCC4'/><div class='play'><i class='icon icon-play'></i></div></div></a><div>How Immutability Helps in OOP (in Russian with English subtitles); 21 May 2016.</div></aside><p><em>Because the class is so big</em>, there is no data hiding or encapsulation any more---33 variables are accessible by over 100 methods. What is hidden? This <code>Email.java</code> file in reality is a big, procedural 2000-line script, called a &quot;class&quot; by mistake. Nothing is hidden, once you cross the border of the class by calling one of its methods. After that, you have full access to all the data you may need. Why is this bad? Well, why do we need <a href="/2016/11/21/naked-data.html">encapsulation</a> in the first place? In order to protect one programmer from another, aka <a href="/2016/01/26/defensive-programming.html">defensive programming</a>. While I&#39;m busy changing the subject of the MIME message, I want to be sure that I&#39;m not interfered with by some other method&#39;s activity, that is changing a sender and touching my subject by mistake. Encapsulation helps us narrow down the scope of the problem, while this <code>Email</code> class is doing exactly the opposite.</p><p><em>Because the class is so big</em>, its unit testing is even more complicated than the class itself. Why? Because of multiple inter-dependencies between its methods and properties. In order to test <code>setCharset()</code> you have to prepare the entire object by calling a few other methods, then you have to call <code>send()</code> to make sure the message being sent actually uses the encoding you specified. Thus, in order to test a one-line method <code>setCharset()</code> you run the entire integration testing scenario of sending a full MIME message through SMTP. Obviously, if something gets changed in one of the methods, almost every test method will be affected. In other words, tests are very fragile, unreliable and over-complicated.</p><p>I can go on and on with this &quot;<em>because the class is so big</em>,&quot; but I think it is obvious that a small, cohesive class is always better than a big one. It is obvious to me, to you, and to any object-oriented programmer. But why is it not so obvious to the developers of Apache Commons Email? I don&#39;t think they are stupid or un-educated. What is it then?</p><h2 id="how-and-why-did-it-happen">How and Why Did It Happen?</h2><p>This is how it always happens. You start to design a class as something cohesive, solid, and small. Your intentions are very positive. Very soon you realize that there is something else that this class has to do. Then, something else. Then, even more.</p><p>The best way to make your class more and more powerful is by adding setters that inject configuration parameters into the class so that it can process them inside, isn&#39;t it?</p><aside class='youtube'> <a href='https://www.youtube.com/watch?v=p7m7_iiqaHI'><div class='box'> <img src='https://i.ytimg.com/vi/p7m7_iiqaHI/mqdefault.jpg' alt='YouTube video #p7m7_iiqaHI'/><div class='play'><i class='icon icon-play'></i></div></div></a><div>How Much Immutability Is Enough?; 19 May 2016.</div></aside><p>This is the root cause of the problem! The root cause is our ability to <em>insert</em> data into mutable objects via configuration methods, also known as &quot;setters.&quot; When an <a href="/2016/07/14/who-is-object.html">object</a> is mutable and allows us to add setters whenever we want, we will do it without limits.</p><p>Let me put it this way---<em>mutable classes tend to grow in size and lose cohesiveness</em>.</p><p>If commons-email authors made this <code>Email</code> class immutable in the beginning, they wouldn&#39;t have been able to add so many methods into it and encapsulate so many properties. They wouldn&#39;t be able to turn it into a monster. Why? Because an immutable object only accepts a state through a constructor. Can you imagine a 33-argument constructor? Of course, not.</p><p>When you make your class immutable in the first place, you are forced to keep it cohesive, small, solid and robust. Because you can&#39;t encapsulate too much and you can&#39;t modify what&#39;s encapsulated. Just two or three arguments of a constructor and you&#39;re done.</p><h2 id="how-did-i-design-an-immutable-email">How Did I Design An Immutable Email?</h2><figure class='badge'><a href='http://http.jcabi.com'><img src='http://img.jcabi.com/logo-square.svg' style='width:64px;max-width:100%;' alt='badge'/></a></figure><p>When I was designing <a href="https://github.com/jcabi/jcabi-email">jcabi-email</a> I started with a small and simple class: <a href="https://github.com/jcabi/jcabi-email/blob/1.3/src/main/java/com/jcabi/email/Postman.java"><code>Postman</code></a>. Well, it is an interface, since I never make <a href="/2016/04/26/why-inputstream-design-is-wrong.html">interface</a>-less classes. So, <code>Postman</code> is... a post man. He is delivering messages to other people. First, I created a default version of it (I omit the ctor, for the sake of brevity):</p><figure class="highlight"><pre><code class="language-java" data-lang="java"><span></span><span class="kn">import</span> <span class="nn">javax.mail.Message</span><span class="o">;</span>
<span class="nd">@Immutable</span>
<span class="kd">class</span> <span class="nc">Postman</span><span class="o">.</span><span class="na">Default</span> <span class="kd">implements</span> <span class="n">Postman</span> <span class="o">{</span>
  <span class="kd">private</span> <span class="kd">final</span> <span class="n">String</span> <span class="n">host</span><span class="o">;</span>
  <span class="kd">private</span> <span class="kd">final</span> <span class="kt">int</span> <span class="n">port</span><span class="o">;</span>
  <span class="kd">private</span> <span class="kd">final</span> <span class="n">String</span> <span class="n">user</span><span class="o">;</span>
  <span class="kd">private</span> <span class="kd">final</span> <span class="n">String</span> <span class="n">password</span><span class="o">;</span>
  <span class="nd">@Override</span>
  <span class="kt">void</span> <span class="nf">send</span><span class="o">(</span><span class="n">Message</span> <span class="n">msg</span><span class="o">)</span> <span class="o">{</span>
    <span class="c1">// create SMTP session</span>
    <span class="c1">// create transport</span>
    <span class="c1">// transport.connect(this.host, this.port, etc.)</span>
    <span class="c1">// transport.send(msg)</span>
    <span class="c1">// transport.close();</span>
  <span class="o">}</span>
<span class="o">}</span></code></pre></figure><p>Good start, it works. What now? Well, the <a href="http://docs.oracle.com/javaee/7/api/javax/jms/Message.html"><code>Message</code></a> is difficult to construct. It is a complex class from JDK that requires some manipulations before it can become a nice HTML email. So I created an envelope, which will build this complex object for me (pay attention, both <a href="https://github.com/jcabi/jcabi-email/blob/1.3/src/main/java/com/jcabi/email/Postman.java"><code>Postman</code></a> and <a href="https://github.com/jcabi/jcabi-email/blob/1.3/src/main/java/com/jcabi/email/Envelope.java"><code>Envelope</code></a> are immutable and annotated with <a href="http://aspects.jcabi.com/apidocs-0.20/com/jcabi/aspects/Immutable.html">@Immutable</a> from <a href="http://aspects.jcabi.com/annotation-immutable.html">jcabi-aspects</a>):</p><figure class="highlight"><pre><code class="language-java" data-lang="java"><span></span><span class="nd">@Immutable</span>
<span class="kd">interface</span> <span class="nc">Envelope</span> <span class="o">{</span>
  <span class="n">Message</span> <span class="nf">unwrap</span><span class="o">();</span>
<span class="o">}</span></code></pre></figure><p>I also refactor the <code>Postman</code> to accept an envelope, not a message:</p><figure class="highlight"><pre><code class="language-java" data-lang="java"><span></span><span class="nd">@Immutable</span>
<span class="kd">interface</span> <span class="nc">Postman</span> <span class="o">{</span>
  <span class="kt">void</span> <span class="nf">send</span><span class="o">(</span><span class="n">Envelope</span> <span class="n">env</span><span class="o">);</span>
<span class="o">}</span></code></pre></figure><p>So far, so good. Now let&#39;s try to create a simple implementation of <code>Envelope</code>:</p><figure class="highlight"><pre><code class="language-java" data-lang="java"><span></span><span class="nd">@Immutable</span>
<span class="kd">class</span> <span class="nc">MIME</span> <span class="kd">implements</span> <span class="n">Envelope</span> <span class="o">{</span>
  <span class="nd">@Override</span>
  <span class="kd">public</span> <span class="n">Message</span> <span class="nf">unwrap</span><span class="o">()</span> <span class="o">{</span>
    <span class="k">return</span> <span class="k">new</span> <span class="n">MimeMessage</span><span class="o">(</span>
      <span class="n">Session</span><span class="o">.</span><span class="na">getDefaultInstance</span><span class="o">(</span><span class="k">new</span> <span class="n">Properties</span><span class="o">())</span>
    <span class="o">);</span>
  <span class="o">}</span>
<span class="o">}</span></code></pre></figure><p>It works, but it does nothing useful yet. It only creates an absolutely empty MIME message and returns it. How about adding a subject to it and both <code>To:</code> and <code>From:</code> addresses (pay attention, <a href="http://email.jcabi.com/apidocs-1.10/com/jcabi/email/Envelope.Mime.html"><code>MIME</code></a> class is also immutable):</p><figure class="highlight"><pre><code class="language-java" data-lang="java"><span></span><span class="nd">@Immutable</span>
<span class="kd">class</span> <span class="nc">Envelope</span><span class="o">.</span><span class="na">MIME</span> <span class="kd">implements</span> <span class="n">Envelope</span> <span class="o">{</span>
  <span class="kd">private</span> <span class="kd">final</span> <span class="n">String</span> <span class="n">subject</span><span class="o">;</span>
  <span class="kd">private</span> <span class="kd">final</span> <span class="n">String</span> <span class="n">from</span><span class="o">;</span>
  <span class="kd">private</span> <span class="kd">final</span> <span class="n">Array</span><span class="o">&lt;</span><span class="n">String</span><span class="o">&gt;</span> <span class="n">to</span><span class="o">;</span>
  <span class="kd">public</span> <span class="nf">MIME</span><span class="o">(</span><span class="n">String</span> <span class="n">subj</span><span class="o">,</span> <span class="n">String</span> <span class="n">sender</span><span class="o">,</span> <span class="n">Iterable</span><span class="o">&lt;</span><span class="n">String</span><span class="o">&gt;</span> <span class="n">rcpts</span><span class="o">)</span> <span class="o">{</span>
    <span class="k">this</span><span class="o">.</span><span class="na">subject</span> <span class="o">=</span> <span class="n">subj</span><span class="o">;</span>
    <span class="k">this</span><span class="o">.</span><span class="na">from</span> <span class="o">=</span> <span class="n">sender</span><span class="o">;</span>
    <span class="k">this</span><span class="o">.</span><span class="na">to</span> <span class="o">=</span> <span class="k">new</span> <span class="n">Array</span><span class="o">&lt;</span><span class="n">String</span><span class="o">&gt;(</span><span class="n">rcpts</span><span class="o">);</span>
  <span class="o">}</span>
  <span class="nd">@Override</span>
  <span class="kd">public</span> <span class="n">Message</span> <span class="nf">unwrap</span><span class="o">()</span> <span class="o">{</span>
    <span class="n">Message</span> <span class="n">msg</span> <span class="o">=</span> <span class="k">new</span> <span class="n">MimeMessage</span><span class="o">(</span>
      <span class="n">Session</span><span class="o">.</span><span class="na">getDefaultInstance</span><span class="o">(</span><span class="k">new</span> <span class="n">Properties</span><span class="o">())</span>
    <span class="o">);</span>
    <span class="n">msg</span><span class="o">.</span><span class="na">setSubject</span><span class="o">(</span><span class="k">this</span><span class="o">.</span><span class="na">subject</span><span class="o">);</span>
    <span class="n">msg</span><span class="o">.</span><span class="na">setFrom</span><span class="o">(</span><span class="k">new</span> <span class="n">InternetAddress</span><span class="o">(</span><span class="k">this</span><span class="o">.</span><span class="na">from</span><span class="o">));</span>
    <span class="k">for</span> <span class="o">(</span><span class="n">String</span> <span class="n">email</span> <span class="o">:</span> <span class="k">this</span><span class="o">.</span><span class="na">to</span><span class="o">)</span> <span class="o">{</span>
      <span class="n">msg</span><span class="o">.</span><span class="na">setRecipient</span><span class="o">(</span>
        <span class="n">Message</span><span class="o">.</span><span class="na">RecipientType</span><span class="o">.</span><span class="na">TO</span><span class="o">,</span>
        <span class="k">new</span> <span class="n">InternetAddress</span><span class="o">(</span><span class="n">email</span><span class="o">)</span>
      <span class="o">);</span>
    <span class="o">}</span>
    <span class="k">return</span> <span class="n">msg</span><span class="o">;</span>
  <span class="o">}</span>
<span class="o">}</span></code></pre></figure><p>Looks correct and it works. But it is still too primitive. How about <code>CC:</code> and <code>BCC:</code>? What about email text? How about PDF enclosures? What if I want to specify the encoding of the message? What about <code>Reply-To</code>?</p><p>Can I add all these parameters to the constructor? Remember, the class is immutable and I can&#39;t introduce the <code>setReplyTo()</code> method. I have to pass the <code>replyTo</code> argument into its constructor. It&#39;s impossible, because the constructor will have too many arguments, and nobody will be able to use it.</p><p>So, what do I do?</p><p>Well, I started to think: how can we break the concept of an &quot;envelope&quot; into smaller concepts---and this what I invented. Like a real-life envelope, my <code>MIME</code> object will have stamps. Stamps will be responsible for configuring an object <code>Message</code> (again, <a href="https://github.com/jcabi/jcabi-email/blob/1.3/src/main/java/com/jcabi/email/Stamp.java"><code>Stamp</code></a> is immutable, as well as all its implementers):</p><figure class="highlight"><pre><code class="language-java" data-lang="java"><span></span><span class="nd">@Immutable</span>
<span class="kd">interface</span> <span class="nc">Stamp</span> <span class="o">{</span>
  <span class="kt">void</span> <span class="nf">attach</span><span class="o">(</span><span class="n">Message</span> <span class="n">message</span><span class="o">);</span>
<span class="o">}</span></code></pre></figure><p>Now, I can simplify my <a href="https://github.com/jcabi/jcabi-email/blob/1.3/src/main/java/com/jcabi/email/Envelope.java"><code>MIME</code></a> class to the following:</p><figure class="highlight"><pre><code class="language-java" data-lang="java"><span></span><span class="nd">@Immutable</span>
<span class="kd">class</span> <span class="nc">Envelope</span><span class="o">.</span><span class="na">MIME</span> <span class="kd">implements</span> <span class="n">Envelope</span> <span class="o">{</span>
  <span class="kd">private</span> <span class="kd">final</span> <span class="n">Array</span><span class="o">&lt;</span><span class="n">Stamp</span><span class="o">&gt;</span> <span class="n">stamps</span><span class="o">;</span>
  <span class="kd">public</span> <span class="nf">MIME</span><span class="o">(</span><span class="n">Iterable</span><span class="o">&lt;</span><span class="n">Stamp</span><span class="o">&gt;</span> <span class="n">stmps</span><span class="o">)</span> <span class="o">{</span>
    <span class="k">this</span><span class="o">.</span><span class="na">stamps</span> <span class="o">=</span> <span class="k">new</span> <span class="n">Array</span><span class="o">&lt;</span><span class="n">Stamp</span><span class="o">&gt;(</span><span class="n">stmps</span><span class="o">);</span>
  <span class="o">}</span>
  <span class="nd">@Override</span>
  <span class="kd">public</span> <span class="n">Message</span> <span class="nf">unwrap</span><span class="o">()</span> <span class="o">{</span>
    <span class="n">Message</span> <span class="n">msg</span> <span class="o">=</span> <span class="k">new</span> <span class="n">MimeMessage</span><span class="o">(</span>
      <span class="n">Session</span><span class="o">.</span><span class="na">getDefaultInstance</span><span class="o">(</span><span class="k">new</span> <span class="n">Properties</span><span class="o">())</span>
    <span class="o">);</span>
    <span class="k">for</span> <span class="o">(</span><span class="n">Stamp</span> <span class="n">stamp</span> <span class="o">:</span> <span class="k">this</span><span class="o">.</span><span class="na">stamps</span><span class="o">)</span> <span class="o">{</span>
      <span class="n">stamp</span><span class="o">.</span><span class="na">attach</span><span class="o">(</span><span class="n">msg</span><span class="o">);</span>
    <span class="o">}</span>
    <span class="k">return</span> <span class="n">msg</span><span class="o">;</span>
  <span class="o">}</span>
<span class="o">}</span></code></pre></figure><p>Now, I will create stamps for the subject, for <code>To:</code>, for <code>From:</code>, for <code>CC:</code>, for <code>BCC:</code>, etc. As many stamps as I like. The class <code>MIME</code> will stay the same---small, cohesive, readable, solid, etc.</p><p>What is important here is why I made the decision to refactor while the class was relatively small. Indeed, I started to worry about these stamp classes when my <code>MIME</code> class was just 25 lines in size.</p><p>That is exactly the point of this article---<em>immutability forces you to design small and cohesive objects</em>.</p><p>Without immutability, I would have gone the same direction as commons-email. My <code>MIME</code> class would grow in size and sooner or later would become as big as <code>Email</code> from commons-email. The only thing that stopped me was the necessity to refactor it, because I wasn&#39;t able to pass all arguments through a constructor.</p><p>Without immutability, I wouldn&#39;t have had that motivator and I would have done what Apache developers did with commons-email---bloat the class and turn it into an unmaintainable <a href="/2017/09/12/evil-object-name-suffix-client.html">monster</a>.</p><p>That&#39;s <a href="http://email.jcabi.com">jcabi-email</a>. I hope this example was illustrative enough and that you will start writing cleaner code with immutable objects.</p></div></article></div><div class="wrapper"> <related-posts /></div><div class="disqus" role="complementary"><p class="disqus_hint"> Please, use <a href="https://help.disqus.com/commenting/what-html-tags-are-allowed-within-comments">syntax highlighting</a> in your comments, to make them more readable.</p><div id="disqus_thread" class="disqus-thread"> <a>&nbsp;</a></div><script> var disqus_config = function () { this.page.url = document.location.href.split('?')[0].split('#')[0].replace('https://', 'http://'); this.page.identifier = this.page.url; }; (function() { var d = document, s = d.createElement('script'); s.src = '//yegor256.disqus.com/embed.js'; s.setAttribute('data-timestamp', +new Date()); (d.head || d.body).appendChild(s); })(); </script> <noscript><div><p class="red"> JavaScript is disabled in your browser, that's why you can't see comments under this post.</p></div></noscript></div><div class="wrapper"> <footer class="footer"><p> &copy; <span itemscope="" itemprop="copyrightHolder" itemtype="http://schema.org/Person"> <span itemprop="name">Yegor Bugayenko</span> </span> 2014&ndash;<span itemprop="copyrightYear">2018</span></p></footer></div></section><div class="wrapper unprintable" style="text-align:center;margin-top:2em;"> <a href="http://www.sixnines.io/h/3ba1652f"> <img src="//www.sixnines.io/b/3ba1652f?style=flat" alt="sixnines availability badge"/> </a></div><script src="//code.jquery.com/jquery-1.9.0.min.js"></script> <script src="/js/all.js?a0e0d018c07"></script> <script>var disqus_shortname = 'yegor256';</script> <script id="dsq-count-scr" src="//yegor256.disqus.com/count.js" async="async"></script> <script> (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){ (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o), m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m) })(window,document,'script','//www.google-analytics.com/analytics.js','ga'); ga('create', 'UA-1963507-32', 'auto'); ga('send', 'pageview'); </script> <script> Cd=document;Cr="&"+Math.random();Cp="&s=1"; Cd.cookie="b=b";if(Cd.cookie)Cp+="&c=1"; Cp+="&t="+(new Date()).getTimezoneOffset(); if(self!=top)Cp+="&f=1"; </script> <script> if(navigator.javaEnabled())Cp+="&j=1"; </script> <script> if(typeof(screen)!='undefined')Cp+="&w="+screen.width+"&h="+ screen.height+"&d="+(screen.colorDepth?screen.colorDepth:screen.pixelDepth); </script> <script> Cd.write("<img src='//c.hit.ua/hit?i=95870&g=0&x=2"+Cp+Cr+ "&r="+escape(Cd.referrer)+"&u="+escape(window.location.href)+ "' border='0' wi"+"dth='1' he"+"ight='1'/>"); </script> <script type="application/ld+json"> { "@context": "http://schema.org", "@type": "Person", "name": "Yegor Bugayenko", "url": "http://www.yegor256.com", "sameAs": [ "https://www.facebook.com/yegor256", "https://instagram.com/yegor256", "https://www.linkedin.com/in/yegor256", "https://twitter.com/yegor256", "https://github.com/yegor256", "https://www.pinterest.com/yegor256/" ] } </script> </body> </html> <!DOCTYPE html> <html xmlns="http://www.w3.org/1999/xhtml" lang="en-US" xml:lang="en-US" itemscope="" itemtype="http://schema.org/WebSite"> <head> <meta charset="utf-8"/> <meta name="description" content="While dependency injection is a natural object-oriented mechanism, DI frameworks turn it into an anti-pattern. " /> <meta name="keywords" content="constructor injection, dependency injection, dependency injection framework, dependency injection is evil, downsides of dependency injection, drawbacks of dependency injection, field injection, setter injection" /> <meta name="viewport" content="width=device-width,minimum-scale=1,initial-scale=1"/> <meta name="google-site-verification" content="JEj_gQr2CPe2QKGw8XdMz0R7VboQIUbX3FlM-lwTq-8" /> <meta name="author" content="Yegor Bugayenko"> <meta name="article:published_time" content="2014-10-03 00:00:00 +0000"> <meta name="og:site_name" content="Yegor Bugayenko"/> <meta name="og:type" content="article" /> <meta name="og:locale" content="en_US" /> <meta name="twitter:account_id" content="4503599630178231" /> <meta name="twitter:creator" content="@yegor256"/> <meta name="twitter:site" content="@yegor256"/> <meta name="twitter:title" property="og:title" content="Dependency Injection Containers are Code Polluters"/> <meta name="twitter:description" property="og:description" content="While dependency injection is a natural object-oriented mechanism, DI frameworks turn it into an anti-pattern. "/> <meta name="twitter:url" property="og:url" content="https://www.yegor256.com/2014/10/03/di-containers-are-evil.html"/> <meta name="telegram:channel" content="AAAAAEJFMRzsRTRxM3ec6A"/> <link rel="search" type="application/opensearchdescription+xml" href="/opensearch.xml" title="yegor256" /> <link rel="shortcut icon" href="/favicon.ico?a0e0d018c07"/> <link rel="apple-touch-icon" href="/favicon.ico?a0e0d018c07"/> <link rel="alternate" type="application/rss+xml" title="RSS for yegor256.com" href="https://www.yegor256.com/rss.xml"/> <link rel="stylesheet" href="/css/layout.css?a0e0d018c07"/> <link rel="stylesheet" href="/css/icons.css?a0e0d018c07"/> <link rel="canonical" href="https://www.yegor256.com/2014/10/03/di-containers-are-evil.html" /> <link rel="amphtml" href="https://www.yegor256.com/2014/10/03/di-containers-are-evil.amp.html" /> <title>Dependency Injection Containers are Code Polluters </title> </head> <body><div class="wrapper"> <aside class="header-toggle unprintable" id="header-toggle" title="Show the menu" onclick="$('#header').show();$('#header-toggle').hide();">&#9776;</aside> <header class="header" id="header"><div class="face"> <a href="/about-me.html#form" class="sub" title="Click to subscribe to my monthly newsletter"><span>Subscribe</span></a> <a href="/about-me.html" style="position:relative;"> <img src="/images/face-256x256.jpg" class="photo" alt="Yegor Bugayenko"/> </a></div><nav><ul class="menu social notranslate"> <li><a href="https://twitter.com/intent/follow?screen_name=yegor256" rel="nofollow" title="Follow me on Twitter"><i class="icon icon-twitter notranslate" aria-hidden="true"></i></a></li> <li><a href="/rss.xml" rel="nofollow" title="Subscribe to my RSS feed"><i class="icon icon-rss notranslate" aria-hidden="true"></i></a></li> <li><a itemprop="sameAs" href="https://github.com/yegor256" rel="nofollow" title="My GitHub profile"><i class="icon icon-github notranslate" aria-hidden="true"></i></a></li> <li><a itemprop="sameAs" href="http://stackoverflow.com/users/187141/yegor256" rel="nofollow" title="My StackOverflow profile"><i class="icon icon-stackoverflow notranslate" aria-hidden="true"></i></a></li> <li><a itemprop="sameAs" href="https://www.facebook.com/yegor256" rel="nofollow" title="Follow me on Facebook"><i class="icon icon-facebook notranslate" aria-hidden="true"></i></a></li> <li><a itemprop="sameAs" href="https://instagram.com/yegor256" rel="nofollow" title="Follow me on Instagram"><i class="icon icon-instagram notranslate" aria-hidden="true"></i></a></li> <li><a itemprop="sameAs" href="https://www.linkedin.com/in/yegor256" rel="nofollow" title="My LinkedIn profile"><i class="icon icon-linkedin notranslate" aria-hidden="true"></i></a></li> <li><a itemprop="sameAs" href="https://www.youtube.com/c/yegor256?sub_confirmation=1" rel="nofollow" title="My Youtube video channel"><i class="icon icon-youtube notranslate" aria-hidden="true"></i></a></li> <li><a itemprop="sameAs" href="https://www.pinterest.com/yegor256/" rel="nofollow" title="My Pinterest boards"><i class="icon icon-pinterest notranslate" aria-hidden="true"></i></a></li> <li><a itemprop="sameAs" href="https://angel.co/yegor256" rel="nofollow" title="My AngelList profile"><i class="icon icon-angellist notranslate" aria-hidden="true"></i></a></li> <li><a href="https://soundcloud.com/yegor256" rel="nofollow" title="My podcast"><i class="icon icon-podcast notranslate" aria-hidden="true"></i></a></li> <li><a href="https://itunes.apple.com/us/podcast/yegor256-podcast/id1150826721" rel="nofollow" title="My iTunes podcast"><i class="icon icon-itunes notranslate" aria-hidden="true"></i></a></li> <li><a href="https://t.me/joinchat/AAAAAEJFMRzsRTRxM3ec6A" rel="nofollow" title="My Telegram public channel"><i class="icon icon-telegram notranslate" aria-hidden="true"></i></a></li> <li><a href="mailto:blog@yegor256.com" rel="nofollow" title="Email me any time"><i class="icon icon-mail notranslate" aria-hidden="true"></i></a></li></ul><ul class="menu"> <li><a href="/" title="Home page">Home</a></li> <li ><a href="/best.html" title="Best articles to read">12&#160;Best</a></li> <li ><a href="/contents.html" title="The contents of the entire blog">All&#160;288</a></li> <li ><a href="/webinars.html" title="My webinars">Webinars</a></li> <li ><a href="/talks.html" title="Future and past conference talks">Talks</a></li> <li ><a href="/books.html" title="The books I wrote">Books</a></li> <li ><a href="/papers.html" title="My academic papers and patents">Papers</a></li> <li ><a href="/pets.html" title="My loved pet projects">Pets</a></li> <li ><a href="/award.html" title="Software quality award">Award</a></li> <li ><a href="/testimonials.html" title="What some people say about me">Testimonials</a></li> <li ><a href="/shift-m.html" title="Audio podcast about project management">Shift-M</a></li> <li ><a href="/paintings.html" title="My paintings for sale">Paintings</a></li> <li><a href="http://ru.yegor256.com/" title="Немного на русском языке">По-русски</a></li></ul></nav><div class="search"> <form method="get" action="https://www.google.com/search" itemprop="potentialAction" itemscope="" itemtype="http://schema.org/SearchAction"> <meta itemprop="target" content="https://www.google.com/search?q={q}"/> <input name="sitesearch" value="yegor256.com" type="hidden"/> <input itemprop="query-input" type="text" id="search-query" class="field field-text" required="required" onfocus="$('.google').css('visibility', 'visible');" name="q" placeholder="Search..." autocomplete="off"/> <input type="image" src="/images/google-search-icon.svg" class="google" title="Search via Google" alt="Search via Google"/> </form></div><div class="hot"><ul> <li> <a href="/code-ahead.html">Code Ahead</a> was published on Amazon just a few days ago! It is my new book, a novel about programmers. It explains in details the majority of ideas that stand behind <a href="https://www.zerocracy.com">Zerocracy</a> and <a href="https://www.xdsd.org">XDSD</a>. </li> <li> At <a href="/webinars.html">Webinar #37</a> we will discuss naming problem in OOP, for objects, methods and attributes; join us on <b>September 12</b>, at 11am PST. </li></ul></div></header></div><section itemscope="" itemtype="http://schema.org/BlogPosting"><div class="wrapper"> <header><p class="printable"> <img src="https://api.qrserver.com/v1/create-qr-code/?data=https://www.yegor256.com/2014/10/03/di-containers-are-evil.html&amp;format=svg" style="width:125px;height:125px;" alt="QR code"/></p><p class="printable"> <code itemprop="url">https://www.yegor256.com/2014/10/03/di-containers-are-evil.html</code></p><h1 itemprop="name headline mainEntityOfPage">Dependency Injection Containers are Code Polluters</h1><aside class='book'><a href='http://amzn.to/2pyceWc'><img src='/images/books/elegant-objects/cover.png' class='book-cover' alt='book cover'/></a>Read more about this subject in <a href='http://amzn.to/2pyceWc'>Section&nbsp;6.3</a><br/> of my book<a href='http://amzn.to/2pyceWc'><img src='/images/books/amazon-buy-button.png' class='amazon-button' alt='Click to buy'/></a></aside><ul class="subline"> <li> <time itemprop="datePublished" datetime="2014-10-03T00:00:00+00:00"> 3 October 2014 </time> </li> <li class="printable" itemscope="" itemprop="author" itemtype="http://schema.org/Person"> <span itemprop="name">Yegor Bugayenko</span> </li> <li class="unprintable"> <i class="icon icon-comments"></i> <a href="http://www.yegor256.com/2014/10/03/di-containers-are-evil.html#disqus_thread" itemprop="discussionUrl">comments</a> </li></ul><p class="unprintable"><p>While <a href="http://martinfowler.com/articles/injection.html">dependency injection</a> (aka, &quot;DI&quot;) is a natural technique of composing objects in OOP (known long before the term was <a href="http://www.martinfowler.com/articles/injection.html">introduced by Martin Fowler</a>), <a href="http://www.spring.io">Spring IoC</a>, <a href="https://code.google.com/p/google-guice/">Google Guice</a>, <a href="http://docs.oracle.com/javaee/6/tutorial/doc/giwhl.html">Java EE6 CDI</a>, <a href="http://square.github.io/dagger/">Dagger</a> and other <a href="https://en.wikipedia.org/wiki/Dependency_injection">DI frameworks</a> turn it into an <strong>anti-pattern</strong>.</p><p>I&#39;m not going to discuss obvious arguments against &quot;setter injections&quot; (like in <a href="http://www.springbyexample.org/examples/intro-to-ioc-basic-setter-injection.html">Spring IoC</a>) and &quot;field injections&quot; (like in <a href="http://picocontainer.codehaus.org/annotated-field-injection.html">PicoContainer</a>). These mechanisms simply violate basic principles of object-oriented programming and encourage us to create incomplete, mutable objects, that get stuffed with data during the course of application execution. Remember: ideal objects <a href="/2014/06/09/objects-should-be-immutable.html">must be immutable</a> and <a href="/2014/09/16/getters-and-setters-are-evil.html">may not contain setters</a>.</p><aside class='youtube'> <a href='https://www.youtube.com/watch?v=oV6Utb5Jows'><div class='box'> <img src='https://i.ytimg.com/vi/oV6Utb5Jows/mqdefault.jpg' alt='YouTube video #oV6Utb5Jows'/><div class='play'><i class='icon icon-play'></i></div></div></a><div>Dependency Injection Container is a Bad Idea (webinar #9); 1 December 2015.</div></aside><p>Instead, let&#39;s talk about &quot;constructor injection&quot; (like in <a href="https://github.com/google/guice/wiki/Injections#constructor-injection">Google Guice</a>) and its use with dependency injection <strong>containers</strong>. I&#39;ll try to show why I consider these containers a redundancy, at least.</p><h2 id="what-is-dependency-injection">What is Dependency Injection?</h2><p>This is what dependency injection is (not really different from a plain old object <a href="/2015/02/26/composable-decorators.html">composition</a>):</p><figure class="highlight"><pre><code class="language-java" data-lang="java"><span></span><span class="kd">public</span> <span class="kd">class</span> <span class="nc">Budget</span> <span class="o">{</span>
  <span class="kd">private</span> <span class="kd">final</span> <span class="n">DB</span> <span class="n">db</span><span class="o">;</span>
  <span class="kd">public</span> <span class="nf">Budget</span><span class="o">(</span><span class="n">DB</span> <span class="n">data</span><span class="o">)</span> <span class="o">{</span>
    <span class="k">this</span><span class="o">.</span><span class="na">db</span> <span class="o">=</span> <span class="n">data</span><span class="o">;</span>
  <span class="o">}</span>
  <span class="kd">public</span> <span class="kt">long</span> <span class="nf">total</span><span class="o">()</span> <span class="o">{</span>
    <span class="k">return</span> <span class="k">this</span><span class="o">.</span><span class="na">db</span><span class="o">.</span><span class="na">cell</span><span class="o">(</span>
      <span class="s">&quot;SELECT SUM(cost) FROM ledger&quot;</span>
    <span class="o">);</span>
  <span class="o">}</span>
<span class="o">}</span></code></pre></figure><p>The object <code>data</code> is called a &quot;dependency.&quot;</p><p>A <code>Budget</code> doesn&#39;t know what kind of database it is working with. All it needs from the database is its ability to fetch a cell, using an arbitrary SQL query, via method <code>cell()</code>. We can instantiate a <code>Budget</code> with a PostgreSQL implementation of the <code>DB</code> interface, for example:</p><figure class="highlight"><pre><code class="language-java" data-lang="java"><span></span><span class="kd">public</span> <span class="kd">class</span> <span class="nc">App</span> <span class="o">{</span>
  <span class="kd">public</span> <span class="kd">static</span> <span class="kt">void</span> <span class="nf">main</span><span class="o">(</span><span class="n">String</span><span class="o">...</span> <span class="n">args</span><span class="o">)</span> <span class="o">{</span>
    <span class="n">Budget</span> <span class="n">budget</span> <span class="o">=</span> <span class="k">new</span> <span class="n">Budget</span><span class="o">(</span>
      <span class="k">new</span> <span class="n">Postgres</span><span class="o">(</span><span class="s">&quot;jdbc:postgresql:5740/main&quot;</span><span class="o">)</span>
    <span class="o">);</span>
    <span class="n">System</span><span class="o">.</span><span class="na">out</span><span class="o">.</span><span class="na">println</span><span class="o">(</span><span class="s">&quot;Total is: &quot;</span> <span class="o">+</span> <span class="n">budget</span><span class="o">.</span><span class="na">total</span><span class="o">());</span>
  <span class="o">}</span>
<span class="o">}</span></code></pre></figure><p>In other words, we&#39;re &quot;injecting&quot; a dependency into a new object <code>budget</code>.</p><p>An alternative to this &quot;dependency injection&quot; approach would be to let <code>Budget</code> decide what database it wants to work with:</p><figure class="highlight"><pre><code class="language-java" data-lang="java"><span></span><span class="kd">public</span> <span class="kd">class</span> <span class="nc">Budget</span> <span class="o">{</span>
  <span class="kd">private</span> <span class="kd">final</span> <span class="n">DB</span> <span class="n">db</span> <span class="o">=</span>
    <span class="k">new</span> <span class="n">Postgres</span><span class="o">(</span><span class="s">&quot;jdbc:postgresql:5740/main&quot;</span><span class="o">);</span>
  <span class="c1">// class methods</span>
<span class="o">}</span></code></pre></figure><p>This is very dirty and leads to 1) code duplication, 2) inability to reuse, and 3) inability to test, etc. No need to discuss why. It&#39;s <a href="http://programmers.stackexchange.com/questions/19203">obvious</a>.</p><p>Thus, dependency injection via a constructor is an amazing technique. Well, not even a technique, really. More like a feature of Java and all other object-oriented languages. It&#39;s expected that almost any object will want to <a href="/2014/12/15/how-much-your-objects-encapsulate.html">encapsulate</a> some knowledge (aka, a &quot;state&quot;). That&#39;s what <a href="/2015/05/07/ctors-must-be-code-free.html">constructors</a> are for.</p><h2 id="what-is-a-di-container">What is a DI Container?</h2><p>So far so good, but here comes the dark side---a dependency injection container. Here is how it works (let&#39;s use <a href="https://github.com/google/guice">Google Guice</a> as an example):</p><figure class="highlight"><pre><code class="language-java" data-lang="java"><span></span><span class="kn">import</span> <span class="nn">javax.inject.Inject</span><span class="o">;</span>
<span class="kd">public</span> <span class="kd">class</span> <span class="nc">Budget</span> <span class="o">{</span>
  <span class="kd">private</span> <span class="kd">final</span> <span class="n">DB</span> <span class="n">db</span><span class="o">;</span>
  <span class="nd">@Inject</span>
  <span class="kd">public</span> <span class="nf">Budget</span><span class="o">(</span><span class="n">DB</span> <span class="n">data</span><span class="o">)</span> <span class="o">{</span>
    <span class="k">this</span><span class="o">.</span><span class="na">db</span> <span class="o">=</span> <span class="n">data</span><span class="o">;</span>
  <span class="o">}</span>
  <span class="c1">// same methods as above</span>
<span class="o">}</span></code></pre></figure><p>Pay attention: the constructor is annotated with <a href="http://docs.oracle.com/javaee/6/api/javax/inject/Inject.html"><code>@Inject</code></a>.</p><p>Then, we&#39;re supposed to configure a container somewhere, when the application starts:</p><figure class="highlight"><pre><code class="language-java" data-lang="java"><span></span><span class="n">Injector</span> <span class="n">injector</span> <span class="o">=</span> <span class="n">Guice</span><span class="o">.</span><span class="na">createInjector</span><span class="o">(</span>
  <span class="k">new</span> <span class="n">AbstractModule</span><span class="o">()</span> <span class="o">{</span>
    <span class="nd">@Override</span>
    <span class="kd">public</span> <span class="kt">void</span> <span class="nf">configure</span><span class="o">()</span> <span class="o">{</span>
      <span class="k">this</span><span class="o">.</span><span class="na">bind</span><span class="o">(</span><span class="n">DB</span><span class="o">.</span><span class="na">class</span><span class="o">).</span><span class="na">toInstance</span><span class="o">(</span>
        <span class="k">new</span> <span class="n">Postgres</span><span class="o">(</span><span class="s">&quot;jdbc:postgresql:5740/main&quot;</span><span class="o">)</span>
      <span class="o">);</span>
    <span class="o">}</span>
  <span class="o">}</span>
<span class="o">);</span></code></pre></figure><p>Some frameworks even allow us to configure the injector in an XML file.</p><p>From now on, we are not allowed to instantiate <code>Budget</code> through the <code>new</code> operator, like we did before. Instead, we should use the injector we just created:</p><figure class="highlight"><pre><code class="language-java" data-lang="java"><span></span><span class="kd">public</span> <span class="kd">class</span> <span class="nc">App</span> <span class="o">{</span>
  <span class="kd">public</span> <span class="kd">static</span> <span class="kt">void</span> <span class="nf">main</span><span class="o">(</span><span class="n">String</span><span class="o">...</span> <span class="n">args</span><span class="o">)</span> <span class="o">{</span>
    <span class="n">Injection</span> <span class="n">injector</span> <span class="o">=</span> <span class="c1">// as we just did in the previous snippet</span>
    <span class="n">Budget</span> <span class="n">budget</span> <span class="o">=</span> <span class="n">injector</span><span class="o">.</span><span class="na">getInstance</span><span class="o">(</span><span class="n">Budget</span><span class="o">.</span><span class="na">class</span><span class="o">);</span>
    <span class="n">System</span><span class="o">.</span><span class="na">out</span><span class="o">.</span><span class="na">println</span><span class="o">(</span><span class="s">&quot;Total is: &quot;</span> <span class="o">+</span> <span class="n">budget</span><span class="o">.</span><span class="na">total</span><span class="o">());</span>
  <span class="o">}</span>
<span class="o">}</span></code></pre></figure><p>The injection automatically finds out that in order to instantiate a <code>Budget</code> it has to provide an argument for its constructor. It will use an instance of class <code>Postgres</code>, which we instantiated in the injector.</p><p>This is the right and recommended way to use Guice. There are a few even darker patterns, though, which are possible but not recommended. For example, you can make your injector a <a href="/2016/06/27/singletons-must-die.html">singleton</a> and use it right inside the <code>Budget</code> class. These mechanisms are considered wrong even by DI container makers, however, so let&#39;s ignore them and focus on the recommended scenario.</p><h2 id="what-is-this-for">What Is This For?</h2><p>Let me reiterate and summarize the scenarios of <strong>incorrect usage</strong> of dependency injection containers:</p><ul> <li><p>Field injection</p></li> <li><p>Setter injection</p></li> <li><p>Passing injector as a dependency</p></li> <li><p>Making injector a global <a href="/2016/06/27/singletons-must-die.html">singleton</a></p></li></ul><p>If we put all of them aside, all we have left is the constructor injection explained above. And how does that help us? Why do we need it? Why can&#39;t we use plain old <code>new</code> in the main class of the application?</p><p>The container we created simply adds more lines to the code base, or even more files, if we use XML. And it doesn&#39;t add anything, except an additional <strong>complexity</strong>. We should always remember this if we have the question: &quot;What database is used as an argument of a Budget?&quot;</p><h2 id="the-right-way">The Right Way</h2><p>Now, let me show you a real life example of using <code>new</code> to construct an application. This is how we create a &quot;thinking engine&quot; in <a href="http://www.rultor.com">rultor.com</a> (full class is in <a href="https://github.com/yegor256/rultor/blob/1.34/src/main/java/com/rultor/agents/Agents.java"><code>Agents.java</code></a>):</p><script src="https://gist.github.com/c76c06baee1f74e3100e.js?file=Agents.java"> </script><p>Impressive? This is a true <a href="/2015/02/26/composable-decorators.html">object composition</a>. I believe this is how a proper object-oriented application should be instantiated.</p><p>And DI containers? In my opinion, they just add unnecessary noise.</p><p>ps. Another live example is here:</p></p><nav class="buttons notranslate desktop-only"> <a href="http://www.facebook.com/sharer/sharer.php?u=https://www.yegor256.com/2014/10/03/di-containers-are-evil.html" title="Share on Facebook" class="button" rel="nofollow"> <span class="count count-facebook">0</span> <i class="icon icon-facebook notranslate" aria-hidden="true"></i> </a> <a href="https://twitter.com/share?url=https://www.yegor256.com/2014/10/03/di-containers-are-evil.html&amp;text=Dependency+Injection+Containers+are+Code+Polluters" title="Share on Twitter" class="button" rel="nofollow"> <span class="count count-twitter">0</span> <i class="icon icon-twitter notranslate" aria-hidden="true"></i> </a> <a href="https://plus.google.com/share?url=https://www.yegor256.com/2014/10/03/di-containers-are-evil.html" title="Share on Google+" class="button" rel="nofollow"> <span class="count count-googleplus">0</span> <i class="icon icon-googleplus notranslate" aria-hidden="true"></i> </a> <a href="https://www.linkedin.com/cws/share?url=https://www.yegor256.com/2014/10/03/di-containers-are-evil.html" title="Share on LinkedIn" class="button" rel="nofollow"> <span class="count count-linkedin">0</span> <i class="icon icon-linkedin notranslate" aria-hidden="true"></i> </a> <a href="http://reddit.com/submit?url=https://www.yegor256.com/2014/10/03/di-containers-are-evil.html%3F2014-39&amp;title=Dependency+Injection+Containers+are+Code+Polluters" title="Share on Reddit" class="button" rel="nofollow"> <span class="count count-reddit">0</span> <i class="icon icon-reddit notranslate" aria-hidden="true"></i> </a> <a href="http://news.ycombinator.com/submitlink?u=https://www.yegor256.com/2014/10/03/di-containers-are-evil.html%3F2014-39&amp;t=Dependency+Injection+Containers+are+Code+Polluters" title="Share on Hacker News" class="button" rel="nofollow"> <span class="count count-hackernews">0</span> <i class="icon icon-hackernews notranslate" aria-hidden="true"></i> </a> </nav> </header> <article class="main" itemprop="articleBody"><div ><p>While <a href="http://martinfowler.com/articles/injection.html">dependency injection</a> (aka, &quot;DI&quot;) is a natural technique of composing objects in OOP (known long before the term was <a href="http://www.martinfowler.com/articles/injection.html">introduced by Martin Fowler</a>), <a href="http://www.spring.io">Spring IoC</a>, <a href="https://code.google.com/p/google-guice/">Google Guice</a>, <a href="http://docs.oracle.com/javaee/6/tutorial/doc/giwhl.html">Java EE6 CDI</a>, <a href="http://square.github.io/dagger/">Dagger</a> and other <a href="https://en.wikipedia.org/wiki/Dependency_injection">DI frameworks</a> turn it into an <strong>anti-pattern</strong>.</p><p>I&#39;m not going to discuss obvious arguments against &quot;setter injections&quot; (like in <a href="http://www.springbyexample.org/examples/intro-to-ioc-basic-setter-injection.html">Spring IoC</a>) and &quot;field injections&quot; (like in <a href="http://picocontainer.codehaus.org/annotated-field-injection.html">PicoContainer</a>). These mechanisms simply violate basic principles of object-oriented programming and encourage us to create incomplete, mutable objects, that get stuffed with data during the course of application execution. Remember: ideal objects <a href="/2014/06/09/objects-should-be-immutable.html">must be immutable</a> and <a href="/2014/09/16/getters-and-setters-are-evil.html">may not contain setters</a>.</p><aside class='youtube'> <a href='https://www.youtube.com/watch?v=oV6Utb5Jows'><div class='box'> <img src='https://i.ytimg.com/vi/oV6Utb5Jows/mqdefault.jpg' alt='YouTube video #oV6Utb5Jows'/><div class='play'><i class='icon icon-play'></i></div></div></a><div>Dependency Injection Container is a Bad Idea (webinar #9); 1 December 2015.</div></aside><p>Instead, let&#39;s talk about &quot;constructor injection&quot; (like in <a href="https://github.com/google/guice/wiki/Injections#constructor-injection">Google Guice</a>) and its use with dependency injection <strong>containers</strong>. I&#39;ll try to show why I consider these containers a redundancy, at least.</p><h2 id="what-is-dependency-injection">What is Dependency Injection?</h2><p>This is what dependency injection is (not really different from a plain old object <a href="/2015/02/26/composable-decorators.html">composition</a>):</p><figure class="highlight"><pre><code class="language-java" data-lang="java"><span></span><span class="kd">public</span> <span class="kd">class</span> <span class="nc">Budget</span> <span class="o">{</span>
  <span class="kd">private</span> <span class="kd">final</span> <span class="n">DB</span> <span class="n">db</span><span class="o">;</span>
  <span class="kd">public</span> <span class="nf">Budget</span><span class="o">(</span><span class="n">DB</span> <span class="n">data</span><span class="o">)</span> <span class="o">{</span>
    <span class="k">this</span><span class="o">.</span><span class="na">db</span> <span class="o">=</span> <span class="n">data</span><span class="o">;</span>
  <span class="o">}</span>
  <span class="kd">public</span> <span class="kt">long</span> <span class="nf">total</span><span class="o">()</span> <span class="o">{</span>
    <span class="k">return</span> <span class="k">this</span><span class="o">.</span><span class="na">db</span><span class="o">.</span><span class="na">cell</span><span class="o">(</span>
      <span class="s">&quot;SELECT SUM(cost) FROM ledger&quot;</span>
    <span class="o">);</span>
  <span class="o">}</span>
<span class="o">}</span></code></pre></figure><p>The object <code>data</code> is called a &quot;dependency.&quot;</p><p>A <code>Budget</code> doesn&#39;t know what kind of database it is working with. All it needs from the database is its ability to fetch a cell, using an arbitrary SQL query, via method <code>cell()</code>. We can instantiate a <code>Budget</code> with a PostgreSQL implementation of the <code>DB</code> interface, for example:</p><figure class="highlight"><pre><code class="language-java" data-lang="java"><span></span><span class="kd">public</span> <span class="kd">class</span> <span class="nc">App</span> <span class="o">{</span>
  <span class="kd">public</span> <span class="kd">static</span> <span class="kt">void</span> <span class="nf">main</span><span class="o">(</span><span class="n">String</span><span class="o">...</span> <span class="n">args</span><span class="o">)</span> <span class="o">{</span>
    <span class="n">Budget</span> <span class="n">budget</span> <span class="o">=</span> <span class="k">new</span> <span class="n">Budget</span><span class="o">(</span>
      <span class="k">new</span> <span class="n">Postgres</span><span class="o">(</span><span class="s">&quot;jdbc:postgresql:5740/main&quot;</span><span class="o">)</span>
    <span class="o">);</span>
    <span class="n">System</span><span class="o">.</span><span class="na">out</span><span class="o">.</span><span class="na">println</span><span class="o">(</span><span class="s">&quot;Total is: &quot;</span> <span class="o">+</span> <span class="n">budget</span><span class="o">.</span><span class="na">total</span><span class="o">());</span>
  <span class="o">}</span>
<span class="o">}</span></code></pre></figure><p>In other words, we&#39;re &quot;injecting&quot; a dependency into a new object <code>budget</code>.</p><p>An alternative to this &quot;dependency injection&quot; approach would be to let <code>Budget</code> decide what database it wants to work with:</p><figure class="highlight"><pre><code class="language-java" data-lang="java"><span></span><span class="kd">public</span> <span class="kd">class</span> <span class="nc">Budget</span> <span class="o">{</span>
  <span class="kd">private</span> <span class="kd">final</span> <span class="n">DB</span> <span class="n">db</span> <span class="o">=</span>
    <span class="k">new</span> <span class="n">Postgres</span><span class="o">(</span><span class="s">&quot;jdbc:postgresql:5740/main&quot;</span><span class="o">);</span>
  <span class="c1">// class methods</span>
<span class="o">}</span></code></pre></figure><p>This is very dirty and leads to 1) code duplication, 2) inability to reuse, and 3) inability to test, etc. No need to discuss why. It&#39;s <a href="http://programmers.stackexchange.com/questions/19203">obvious</a>.</p><p>Thus, dependency injection via a constructor is an amazing technique. Well, not even a technique, really. More like a feature of Java and all other object-oriented languages. It&#39;s expected that almost any object will want to <a href="/2014/12/15/how-much-your-objects-encapsulate.html">encapsulate</a> some knowledge (aka, a &quot;state&quot;). That&#39;s what <a href="/2015/05/07/ctors-must-be-code-free.html">constructors</a> are for.</p><h2 id="what-is-a-di-container">What is a DI Container?</h2><p>So far so good, but here comes the dark side---a dependency injection container. Here is how it works (let&#39;s use <a href="https://github.com/google/guice">Google Guice</a> as an example):</p><figure class="highlight"><pre><code class="language-java" data-lang="java"><span></span><span class="kn">import</span> <span class="nn">javax.inject.Inject</span><span class="o">;</span>
<span class="kd">public</span> <span class="kd">class</span> <span class="nc">Budget</span> <span class="o">{</span>
  <span class="kd">private</span> <span class="kd">final</span> <span class="n">DB</span> <span class="n">db</span><span class="o">;</span>
  <span class="nd">@Inject</span>
  <span class="kd">public</span> <span class="nf">Budget</span><span class="o">(</span><span class="n">DB</span> <span class="n">data</span><span class="o">)</span> <span class="o">{</span>
    <span class="k">this</span><span class="o">.</span><span class="na">db</span> <span class="o">=</span> <span class="n">data</span><span class="o">;</span>
  <span class="o">}</span>
  <span class="c1">// same methods as above</span>
<span class="o">}</span></code></pre></figure><p>Pay attention: the constructor is annotated with <a href="http://docs.oracle.com/javaee/6/api/javax/inject/Inject.html"><code>@Inject</code></a>.</p><p>Then, we&#39;re supposed to configure a container somewhere, when the application starts:</p><figure class="highlight"><pre><code class="language-java" data-lang="java"><span></span><span class="n">Injector</span> <span class="n">injector</span> <span class="o">=</span> <span class="n">Guice</span><span class="o">.</span><span class="na">createInjector</span><span class="o">(</span>
  <span class="k">new</span> <span class="n">AbstractModule</span><span class="o">()</span> <span class="o">{</span>
    <span class="nd">@Override</span>
    <span class="kd">public</span> <span class="kt">void</span> <span class="nf">configure</span><span class="o">()</span> <span class="o">{</span>
      <span class="k">this</span><span class="o">.</span><span class="na">bind</span><span class="o">(</span><span class="n">DB</span><span class="o">.</span><span class="na">class</span><span class="o">).</span><span class="na">toInstance</span><span class="o">(</span>
        <span class="k">new</span> <span class="n">Postgres</span><span class="o">(</span><span class="s">&quot;jdbc:postgresql:5740/main&quot;</span><span class="o">)</span>
      <span class="o">);</span>
    <span class="o">}</span>
  <span class="o">}</span>
<span class="o">);</span></code></pre></figure><p>Some frameworks even allow us to configure the injector in an XML file.</p><p>From now on, we are not allowed to instantiate <code>Budget</code> through the <code>new</code> operator, like we did before. Instead, we should use the injector we just created:</p><figure class="highlight"><pre><code class="language-java" data-lang="java"><span></span><span class="kd">public</span> <span class="kd">class</span> <span class="nc">App</span> <span class="o">{</span>
  <span class="kd">public</span> <span class="kd">static</span> <span class="kt">void</span> <span class="nf">main</span><span class="o">(</span><span class="n">String</span><span class="o">...</span> <span class="n">args</span><span class="o">)</span> <span class="o">{</span>
    <span class="n">Injection</span> <span class="n">injector</span> <span class="o">=</span> <span class="c1">// as we just did in the previous snippet</span>
    <span class="n">Budget</span> <span class="n">budget</span> <span class="o">=</span> <span class="n">injector</span><span class="o">.</span><span class="na">getInstance</span><span class="o">(</span><span class="n">Budget</span><span class="o">.</span><span class="na">class</span><span class="o">);</span>
    <span class="n">System</span><span class="o">.</span><span class="na">out</span><span class="o">.</span><span class="na">println</span><span class="o">(</span><span class="s">&quot;Total is: &quot;</span> <span class="o">+</span> <span class="n">budget</span><span class="o">.</span><span class="na">total</span><span class="o">());</span>
  <span class="o">}</span>
<span class="o">}</span></code></pre></figure><p>The injection automatically finds out that in order to instantiate a <code>Budget</code> it has to provide an argument for its constructor. It will use an instance of class <code>Postgres</code>, which we instantiated in the injector.</p><p>This is the right and recommended way to use Guice. There are a few even darker patterns, though, which are possible but not recommended. For example, you can make your injector a <a href="/2016/06/27/singletons-must-die.html">singleton</a> and use it right inside the <code>Budget</code> class. These mechanisms are considered wrong even by DI container makers, however, so let&#39;s ignore them and focus on the recommended scenario.</p><h2 id="what-is-this-for">What Is This For?</h2><p>Let me reiterate and summarize the scenarios of <strong>incorrect usage</strong> of dependency injection containers:</p><ul> <li><p>Field injection</p></li> <li><p>Setter injection</p></li> <li><p>Passing injector as a dependency</p></li> <li><p>Making injector a global <a href="/2016/06/27/singletons-must-die.html">singleton</a></p></li></ul><p>If we put all of them aside, all we have left is the constructor injection explained above. And how does that help us? Why do we need it? Why can&#39;t we use plain old <code>new</code> in the main class of the application?</p><p>The container we created simply adds more lines to the code base, or even more files, if we use XML. And it doesn&#39;t add anything, except an additional <strong>complexity</strong>. We should always remember this if we have the question: &quot;What database is used as an argument of a Budget?&quot;</p><h2 id="the-right-way">The Right Way</h2><p>Now, let me show you a real life example of using <code>new</code> to construct an application. This is how we create a &quot;thinking engine&quot; in <a href="http://www.rultor.com">rultor.com</a> (full class is in <a href="https://github.com/yegor256/rultor/blob/1.34/src/main/java/com/rultor/agents/Agents.java"><code>Agents.java</code></a>):</p><script src="https://gist.github.com/c76c06baee1f74e3100e.js?file=Agents.java"> </script><p>Impressive? This is a true <a href="/2015/02/26/composable-decorators.html">object composition</a>. I believe this is how a proper object-oriented application should be instantiated.</p><p>And DI containers? In my opinion, they just add unnecessary noise.</p><p>ps. Another live example is here:</p></div></article></div><div class="wrapper"> <related-posts /></div><div class="disqus" role="complementary"><p class="disqus_hint"> Please, use <a href="https://help.disqus.com/commenting/what-html-tags-are-allowed-within-comments">syntax highlighting</a> in your comments, to make them more readable.</p><div id="disqus_thread" class="disqus-thread"> <a>&nbsp;</a></div><script> var disqus_config = function () { this.page.url = document.location.href.split('?')[0].split('#')[0].replace('https://', 'http://'); this.page.identifier = this.page.url; }; (function() { var d = document, s = d.createElement('script'); s.src = '//yegor256.disqus.com/embed.js'; s.setAttribute('data-timestamp', +new Date()); (d.head || d.body).appendChild(s); })(); </script> <noscript><div><p class="red"> JavaScript is disabled in your browser, that's why you can't see comments under this post.</p></div></noscript></div><div class="wrapper"> <footer class="footer"><p> &copy; <span itemscope="" itemprop="copyrightHolder" itemtype="http://schema.org/Person"> <span itemprop="name">Yegor Bugayenko</span> </span> 2014&ndash;<span itemprop="copyrightYear">2018</span></p></footer></div></section><div class="wrapper unprintable" style="text-align:center;margin-top:2em;"> <a href="http://www.sixnines.io/h/3ba1652f"> <img src="//www.sixnines.io/b/3ba1652f?style=flat" alt="sixnines availability badge"/> </a></div><script src="//code.jquery.com/jquery-1.9.0.min.js"></script> <script src="/js/all.js?a0e0d018c07"></script> <script>var disqus_shortname = 'yegor256';</script> <script id="dsq-count-scr" src="//yegor256.disqus.com/count.js" async="async"></script> <script> (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){ (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o), m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m) })(window,document,'script','//www.google-analytics.com/analytics.js','ga'); ga('create', 'UA-1963507-32', 'auto'); ga('send', 'pageview'); </script> <script> Cd=document;Cr="&"+Math.random();Cp="&s=1"; Cd.cookie="b=b";if(Cd.cookie)Cp+="&c=1"; Cp+="&t="+(new Date()).getTimezoneOffset(); if(self!=top)Cp+="&f=1"; </script> <script> if(navigator.javaEnabled())Cp+="&j=1"; </script> <script> if(typeof(screen)!='undefined')Cp+="&w="+screen.width+"&h="+ screen.height+"&d="+(screen.colorDepth?screen.colorDepth:screen.pixelDepth); </script> <script> Cd.write("<img src='//c.hit.ua/hit?i=95870&g=0&x=2"+Cp+Cr+ "&r="+escape(Cd.referrer)+"&u="+escape(window.location.href)+ "' border='0' wi"+"dth='1' he"+"ight='1'/>"); </script> <script type="application/ld+json"> { "@context": "http://schema.org", "@type": "Person", "name": "Yegor Bugayenko", "url": "http://www.yegor256.com", "sameAs": [ "https://www.facebook.com/yegor256", "https://instagram.com/yegor256", "https://www.linkedin.com/in/yegor256", "https://twitter.com/yegor256", "https://github.com/yegor256", "https://www.pinterest.com/yegor256/" ] } </script> </body> </html> <!DOCTYPE html> <html xmlns="http://www.w3.org/1999/xhtml" lang="en-US" xml:lang="en-US" itemscope="" itemtype="http://schema.org/WebSite"> <head> <meta charset="utf-8"/> <meta name="description" content="Getters and setters is a terrible anti-pattern in object-oriented programming and should be avoided. This article explains why. " /> <meta name="keywords" content="getters and setters, getters and setters are evil, getters and setters is an anti-pattern, object design, why getters and setters are evil" /> <meta name="viewport" content="width=device-width,minimum-scale=1,initial-scale=1"/> <meta name="google-site-verification" content="JEj_gQr2CPe2QKGw8XdMz0R7VboQIUbX3FlM-lwTq-8" /> <meta name="author" content="Yegor Bugayenko"> <meta name="article:published_time" content="2014-09-16 00:00:00 +0000"> <meta name="og:site_name" content="Yegor Bugayenko"/> <meta name="og:type" content="article" /> <meta name="og:locale" content="en_US" /> <meta name="twitter:account_id" content="4503599630178231" /> <meta name="twitter:creator" content="@yegor256"/> <meta name="twitter:site" content="@yegor256"/> <meta name="twitter:title" property="og:title" content="Getters/Setters. Evil. Period."/> <meta name="twitter:description" property="og:description" content="Getters and setters is a terrible anti-pattern in object-oriented programming and should be avoided. This article explains why. "/> <meta name="twitter:url" property="og:url" content="https://www.yegor256.com/2014/09/16/getters-and-setters-are-evil.html"/> <meta name="telegram:channel" content="AAAAAEJFMRzsRTRxM3ec6A"/> <link rel="search" type="application/opensearchdescription+xml" href="/opensearch.xml" title="yegor256" /> <link rel="shortcut icon" href="/favicon.ico?a0e0d018c07"/> <link rel="apple-touch-icon" href="/favicon.ico?a0e0d018c07"/> <link rel="alternate" type="application/rss+xml" title="RSS for yegor256.com" href="https://www.yegor256.com/rss.xml"/> <link rel="stylesheet" href="/css/layout.css?a0e0d018c07"/> <link rel="stylesheet" href="/css/icons.css?a0e0d018c07"/> <link rel="canonical" href="https://www.yegor256.com/2014/09/16/getters-and-setters-are-evil.html" /> <link rel="amphtml" href="https://www.yegor256.com/2014/09/16/getters-and-setters-are-evil.amp.html" /> <title>Getters/Setters. Evil. Period. </title> <meta name='og:image' content='https://www.yegor256.com/images/2014/09/fish-called-wanda.png'/><meta name='twitter:image' content='https://www.yegor256.com/images/2014/09/fish-called-wanda.png'/><meta name='og:image:width' content='1276'/> <meta name='twitter:image:width' content='1276'/><meta name='og:image:height' content='684'/> <meta name='twitter:image:height' content='684'/><meta name='twitter:card' content='summary_large_image'/><meta name='twitter:image:alt' content='A Fish Called Wanda (1988) by Charles Crichton'/> </head> <body><div class="wrapper"> <aside class="header-toggle unprintable" id="header-toggle" title="Show the menu" onclick="$('#header').show();$('#header-toggle').hide();">&#9776;</aside> <header class="header" id="header"><div class="face"> <a href="/about-me.html#form" class="sub" title="Click to subscribe to my monthly newsletter"><span>Subscribe</span></a> <a href="/about-me.html" style="position:relative;"> <img src="/images/face-256x256.jpg" class="photo" alt="Yegor Bugayenko"/> </a></div><nav><ul class="menu social notranslate"> <li><a href="https://twitter.com/intent/follow?screen_name=yegor256" rel="nofollow" title="Follow me on Twitter"><i class="icon icon-twitter notranslate" aria-hidden="true"></i></a></li> <li><a href="/rss.xml" rel="nofollow" title="Subscribe to my RSS feed"><i class="icon icon-rss notranslate" aria-hidden="true"></i></a></li> <li><a itemprop="sameAs" href="https://github.com/yegor256" rel="nofollow" title="My GitHub profile"><i class="icon icon-github notranslate" aria-hidden="true"></i></a></li> <li><a itemprop="sameAs" href="http://stackoverflow.com/users/187141/yegor256" rel="nofollow" title="My StackOverflow profile"><i class="icon icon-stackoverflow notranslate" aria-hidden="true"></i></a></li> <li><a itemprop="sameAs" href="https://www.facebook.com/yegor256" rel="nofollow" title="Follow me on Facebook"><i class="icon icon-facebook notranslate" aria-hidden="true"></i></a></li> <li><a itemprop="sameAs" href="https://instagram.com/yegor256" rel="nofollow" title="Follow me on Instagram"><i class="icon icon-instagram notranslate" aria-hidden="true"></i></a></li> <li><a itemprop="sameAs" href="https://www.linkedin.com/in/yegor256" rel="nofollow" title="My LinkedIn profile"><i class="icon icon-linkedin notranslate" aria-hidden="true"></i></a></li> <li><a itemprop="sameAs" href="https://www.youtube.com/c/yegor256?sub_confirmation=1" rel="nofollow" title="My Youtube video channel"><i class="icon icon-youtube notranslate" aria-hidden="true"></i></a></li> <li><a itemprop="sameAs" href="https://www.pinterest.com/yegor256/" rel="nofollow" title="My Pinterest boards"><i class="icon icon-pinterest notranslate" aria-hidden="true"></i></a></li> <li><a itemprop="sameAs" href="https://angel.co/yegor256" rel="nofollow" title="My AngelList profile"><i class="icon icon-angellist notranslate" aria-hidden="true"></i></a></li> <li><a href="https://soundcloud.com/yegor256" rel="nofollow" title="My podcast"><i class="icon icon-podcast notranslate" aria-hidden="true"></i></a></li> <li><a href="https://itunes.apple.com/us/podcast/yegor256-podcast/id1150826721" rel="nofollow" title="My iTunes podcast"><i class="icon icon-itunes notranslate" aria-hidden="true"></i></a></li> <li><a href="https://t.me/joinchat/AAAAAEJFMRzsRTRxM3ec6A" rel="nofollow" title="My Telegram public channel"><i class="icon icon-telegram notranslate" aria-hidden="true"></i></a></li> <li><a href="mailto:blog@yegor256.com" rel="nofollow" title="Email me any time"><i class="icon icon-mail notranslate" aria-hidden="true"></i></a></li></ul><ul class="menu"> <li><a href="/" title="Home page">Home</a></li> <li ><a href="/best.html" title="Best articles to read">12&#160;Best</a></li> <li ><a href="/contents.html" title="The contents of the entire blog">All&#160;288</a></li> <li ><a href="/webinars.html" title="My webinars">Webinars</a></li> <li ><a href="/talks.html" title="Future and past conference talks">Talks</a></li> <li ><a href="/books.html" title="The books I wrote">Books</a></li> <li ><a href="/papers.html" title="My academic papers and patents">Papers</a></li> <li ><a href="/pets.html" title="My loved pet projects">Pets</a></li> <li ><a href="/award.html" title="Software quality award">Award</a></li> <li ><a href="/testimonials.html" title="What some people say about me">Testimonials</a></li> <li ><a href="/shift-m.html" title="Audio podcast about project management">Shift-M</a></li> <li ><a href="/paintings.html" title="My paintings for sale">Paintings</a></li> <li><a href="http://ru.yegor256.com/" title="Немного на русском языке">По-русски</a></li></ul></nav><div class="search"> <form method="get" action="https://www.google.com/search" itemprop="potentialAction" itemscope="" itemtype="http://schema.org/SearchAction"> <meta itemprop="target" content="https://www.google.com/search?q={q}"/> <input name="sitesearch" value="yegor256.com" type="hidden"/> <input itemprop="query-input" type="text" id="search-query" class="field field-text" required="required" onfocus="$('.google').css('visibility', 'visible');" name="q" placeholder="Search..." autocomplete="off"/> <input type="image" src="/images/google-search-icon.svg" class="google" title="Search via Google" alt="Search via Google"/> </form></div><div class="hot"><ul> <li> <a href="/code-ahead.html">Code Ahead</a> was published on Amazon just a few days ago! It is my new book, a novel about programmers. It explains in details the majority of ideas that stand behind <a href="https://www.zerocracy.com">Zerocracy</a> and <a href="https://www.xdsd.org">XDSD</a>. </li> <li> At <a href="/webinars.html">Webinar #37</a> we will discuss naming problem in OOP, for objects, methods and attributes; join us on <b>September 12</b>, at 11am PST. </li></ul></div></header></div><section itemscope="" itemtype="http://schema.org/BlogPosting"><div class="wrapper"> <header><p class="printable"> <img src="https://api.qrserver.com/v1/create-qr-code/?data=https://www.yegor256.com/2014/09/16/getters-and-setters-are-evil.html&amp;format=svg" style="width:125px;height:125px;" alt="QR code"/></p><p class="printable"> <code itemprop="url">https://www.yegor256.com/2014/09/16/getters-and-setters-are-evil.html</code></p><h1 itemprop="name headline mainEntityOfPage">Getters/Setters. Evil. Period.</h1><aside class='book'><a href='http://amzn.to/2qFt4Tn'><img src='/images/books/elegant-objects/cover.png' class='book-cover' alt='book cover'/></a>Read more about this subject in <a href='http://amzn.to/2qFt4Tn'>Section&nbsp;3.5</a><br/> of my book<a href='http://amzn.to/2qFt4Tn'><img src='/images/books/amazon-buy-button.png' class='amazon-button' alt='Click to buy'/></a></aside><ul class="subline"> <li> <time itemprop="datePublished" datetime="2014-09-16T00:00:00+00:00"> 16 September 2014 </time> </li> <li class="printable" itemscope="" itemprop="author" itemtype="http://schema.org/Person"> <span itemprop="name">Yegor Bugayenko</span> </li> <li class="unprintable"> <i class="icon icon-comments"></i> <a href="http://www.yegor256.com/2014/09/16/getters-and-setters-are-evil.html#disqus_thread" itemprop="discussionUrl">comments</a> </li></ul><ul class="unprintable subline"> <li>Translated:</li> <li><a href="http://tbd.kaitoy.xyz/2015/07/22/getters-setters-evil/">Japanese</a></li> <li><a href="http://info.javarush.ru/translation/2014/12/15/%D0%93%D0%B5%D1%82%D1%82%D0%B5%D1%80%D1%8B-%D0%A1%D0%B5%D1%82%D1%82%D0%B5%D1%80%D1%8B-%D0%97%D0%BB%D0%BE-%D0%98-%D1%82%D0%BE%D1%87%D0%BA%D0%B0-.html">Russian</a></li> <li><a href="https://bulldogjob.com/news/215-gettery-i-settery-to-czyste-zlo-kropka">Polish</a></li> <li><a href="mailto:translate@yegor256.com">add yours!</a></li></ul><ul class="subline"> <li>Discussed at:</li> <li><a href="https://www.reddit.com/r/programming/comments/2y7jcb/getterssetters_evil_period/">reddit</a></li></ul><p class="unprintable"><p>There is an old debate, started in 2003 by Allen Holub in this <a href="http://www.javaworld.com/article/2073723/core-java/why-getter-and-setter-methods-are-evil.html">Why getter and setter methods are evil</a> famous article, about whether getters/setters is an <a href="/2016/02/03/design-patterns-and-anti-patterns.html">anti-pattern</a> and should be avoided or if it is something we inevitably need in object-oriented programming. I&#39;ll try to add my two cents to this discussion.</p><p>The gist of the following text is this: getters and setters is a terrible practice and those who use it can&#39;t be excused. Again, to avoid any misunderstanding, I&#39;m not saying that get/set should be avoided when possible. No. I&#39;m saying that you should <em>never</em> have them near your code.</p><figure class='jb_picture'><img itemprop='image' alt='A Fish Called Wanda (1988) by Charles Crichton' src='/images/2014/09/fish-called-wanda.png' longdesc='#36b53fbe'/><figcaption id='36b53fbe'>A Fish Called Wanda (1988) by Charles Crichton</figcaption></figure><p>Arrogant enough to catch your attention? You&#39;ve been using that get/set pattern for 15 years and you&#39;re a respected Java architect? And you don&#39;t want to hear that nonsense from a stranger? Well, I understand your feelings. I felt almost the same when I stumbled upon <a href="http://amzn.to/266oJr4">Object Thinking</a> by David West, the best book about object-oriented programming I&#39;ve read so far. So please. Calm down and try to understand while I try to explain.</p><h2 id="existing-arguments">Existing Arguments</h2><figure class='badge'><a href='http://amzn.to/266oJr4'><img src='https://www.yegor256.com/images/2014/09/object-thinking-by-david-west.png' style='width:96px;max-width:100%;' alt='badge'/></a></figure><p>There are a few arguments against &quot;accessors&quot; (another name for getters <del>and setters</del>), in an object-oriented world. All of them, I think, are not strong enough. Let&#39;s briefly go through them.</p><p><strong>Tell, Don&#39;t Ask</strong> Allen Holub says, &quot;Don&#39;t ask for the information you need to do the work; ask the object that has the information to do the work for you.&quot;</p><p><strong>Violated Encapsulation Principle</strong> An object can be teared apart by other objects, since they are able to inject any new data into it, through setters. The object simply can&#39;t encapsulate its own state safely enough, since anyone can alter it.</p><aside class='youtube'> <a href='https://www.youtube.com/watch?v=WSgP85kr6eU'><div class='box'> <img src='https://i.ytimg.com/vi/WSgP85kr6eU/mqdefault.jpg' alt='YouTube video #WSgP85kr6eU'/><div class='play'><i class='icon icon-play'></i></div></div></a><div>Why Getters-and-Setters Is An Anti-Pattern? (webinar #4); 1 July 2015.</div></aside><p><strong>Exposed Implementation Details</strong> If we can get an object out of another object, we are relying too much on the first object&#39;s implementation details. If tomorrow it will change, say, the type of that result, we have to change our code as well.</p><p>All these justifications are reasonable, but they are missing the main point.</p><h2 id="fundamental-disbelief">Fundamental Disbelief</h2><p>Most programmers believe that an object is a data structure with methods. I&#39;m quoting <a href="http://java.dzone.com/articles/getters-and-setters-are-not">Getters and Setters Are Not Evil</a>, an article by Bozhidar Bozhanov:</p><blockquote><p>But the majority of objects for which people generate getters and setters are simple data holders.</p></blockquote><p>This misconception is the consequence of a huge misunderstanding! Objects are not &quot;simple data holders.&quot; Objects are <em>not</em> data structures with attached methods. This &quot;data holder&quot; concept came to object-oriented programming from procedural languages, especially C and COBOL. I&#39;ll say it again: an object is <em>not</em> a set of data elements and functions that manipulate them. An object is <em>not</em> a data entity.</p><p>What is it then?</p><h2 id="a-ball-and-a-dog">A Ball and A Dog</h2><p>In true object-oriented programming, objects are <a href="/2014/11/20/seven-virtues-of-good-object.html">living creatures</a>, like you and me. They are living organisms, with their own behavior, properties and a life cycle.</p><p>Can a living organism have a setter? Can you &quot;set&quot; a ball to a dog? Not really. But that is exactly what the following piece of software is doing:</p><figure class="highlight"><pre><code class="language-java" data-lang="java"><span></span><span class="n">Dog</span> <span class="n">dog</span> <span class="o">=</span> <span class="k">new</span> <span class="n">Dog</span><span class="o">();</span>
<span class="n">dog</span><span class="o">.</span><span class="na">setBall</span><span class="o">(</span><span class="k">new</span> <span class="n">Ball</span><span class="o">());</span></code></pre></figure><p>How does that sound?</p><p>Can you get a ball from a dog? Well, you probably can, if she ate it and you&#39;re doing surgery. In that case, yes, we can &quot;get&quot; a ball from a dog. This is what I&#39;m talking about:</p><figure class="highlight"><pre><code class="language-java" data-lang="java"><span></span><span class="n">Dog</span> <span class="n">dog</span> <span class="o">=</span> <span class="k">new</span> <span class="n">Dog</span><span class="o">();</span>
<span class="n">Ball</span> <span class="n">ball</span> <span class="o">=</span> <span class="n">dog</span><span class="o">.</span><span class="na">getBall</span><span class="o">();</span></code></pre></figure><p>Or an even more ridiculous example:</p><figure class="highlight"><pre><code class="language-java" data-lang="java"><span></span><span class="n">Dog</span> <span class="n">dog</span> <span class="o">=</span> <span class="k">new</span> <span class="n">Dog</span><span class="o">();</span>
<span class="n">dog</span><span class="o">.</span><span class="na">setWeight</span><span class="o">(</span><span class="s">&quot;23kg&quot;</span><span class="o">);</span></code></pre></figure><p>Can you imagine this transaction in the real world? :)</p><aside class='youtube'> <a href='https://www.youtube.com/watch?v=F4N25kZ2zQU'><div class='box'> <img src='https://i.ytimg.com/vi/F4N25kZ2zQU/mqdefault.jpg' alt='YouTube video #F4N25kZ2zQU'/><div class='play'><i class='icon icon-play'></i></div></div></a><div>Object Oriented Lies (in Russian with English subtitles); 24 April 2016.</div></aside><p>Does it look similar to what you&#39;re writing every day? If yes, then you&#39;re a procedural programmer. Admit it. And this is what David West has to say about it, on page 30 of his book:</p><blockquote><p>Step one in the transformation of a successful procedural developer into a successful object developer is a lobotomy.</p></blockquote><p>Do you need a lobotomy? Well, I definitely needed one and received it, while reading West&#39;s <a href="http://amzn.to/266oJr4">Object Thinking</a>.</p><h2 id="object-thinking">Object Thinking</h2><p>Start thinking like an object and you will immediately rename those methods. This is what you will probably get:</p><figure class="highlight"><pre><code class="language-java" data-lang="java"><span></span><span class="n">Dog</span> <span class="n">dog</span> <span class="o">=</span> <span class="k">new</span> <span class="n">Dog</span><span class="o">();</span>
<span class="n">dog</span><span class="o">.</span><span class="na">take</span><span class="o">(</span><span class="k">new</span> <span class="n">Ball</span><span class="o">());</span>
<span class="n">Ball</span> <span class="n">ball</span> <span class="o">=</span> <span class="n">dog</span><span class="o">.</span><span class="na">give</span><span class="o">();</span></code></pre></figure><p>Now, we&#39;re treating the dog as a real animal, who can take a ball from us and can give it back, when we ask. Worth mentioning is that the dog can&#39;t give <code>NULL</code> back. Dogs simply don&#39;t know what <code>NULL</code> is :) Object thinking immediately eliminates <a href="/2014/05/13/why-null-is-bad.html">NULL references</a> from your code.</p><p>Besides that, object thinking will lead to object immutability, like in the &quot;weight of the dog&quot; example. You would re-write that like this instead:</p><figure class="highlight"><pre><code class="language-java" data-lang="java"><span></span><span class="n">Dog</span> <span class="n">dog</span> <span class="o">=</span> <span class="k">new</span> <span class="n">Dog</span><span class="o">(</span><span class="s">&quot;23kg&quot;</span><span class="o">);</span>
<span class="kt">int</span> <span class="n">weight</span> <span class="o">=</span> <span class="n">dog</span><span class="o">.</span><span class="na">weight</span><span class="o">();</span></code></pre></figure><p>The dog is an immutable living organism, which doesn&#39;t allow anyone from the outside to change her weight, or size, or name, etc. She can tell, on request, her weight or name. There is nothing wrong with public methods that demonstrate requests for certain &quot;insides&quot; of an object. But these methods are not &quot;getters&quot; and they should never have the &quot;get&quot; prefix. We&#39;re not &quot;getting&quot; anything from the dog. We&#39;re not getting her name. We&#39;re asking her to tell us her name. See the difference?</p><p>We&#39;re not talking semantics here, either. We are differentiating the procedural programming mindset from an object-oriented one. In procedural programming, we&#39;re working with data, manipulating them, getting, setting, and deleting when necessary. We&#39;re in charge, and the data is just a passive component. The dog is nothing to us---it&#39;s just a &quot;data holder.&quot; It doesn&#39;t have its own life. We are free to get whatever is necessary from it and set any data into it. This is how C, COBOL, Pascal and many other procedural languages work(ed).</p><p>On the contrary, in a true object-oriented world, we treat objects like living organisms, with their own date of birth and a moment of death---with their own identity and habits, if you wish. We can ask a dog to give us some piece of data (for example, her weight), and she may return us that information. But we always remember that the dog is an active component. She decides what will happen after our request.</p><p>That&#39;s why, <em>it is conceptually incorrect to have any methods starting with <code>set</code> or <code>get</code> in an object</em>. And it&#39;s not about breaking <a href="/2016/11/21/naked-data.html">encapsulation</a>, like many people argue. It is whether you&#39;re thinking like an object or you&#39;re still writing COBOL in Java syntax.</p><p>PS. Yes, you may ask,---what about JavaBeans, JPA, JAXB, and many other Java API-s that rely on the get/set notation? What about Ruby&#39;s built-in <a href="http://ruby-doc.org/docs/ruby-doc-bundle/UsersGuide/rg/accessors.html">feature</a> that simplifies the creation of accessors? Well, all of that is our <a href="/2013/12/29/proto.html">misfortune</a>. It is much easier to stay in a primitive world of procedural COBOL than to truly understand and appreciate the beautiful world of true objects.</p><p>PPS. Forgot to say, yes, dependency injection via setters is also a terrible anti-pattern. About it, in <a href="/2014/10/03/di-containers-are-evil.html">one of the next posts</a> :)</p><p>PPPS. Here is what I&#39;m suggesting to use instead of getters: <a href="/2016/04/05/printers-instead-of-getters.html">printers</a>.</p></p><nav class="buttons notranslate desktop-only"> <a href="http://www.facebook.com/sharer/sharer.php?u=https://www.yegor256.com/2014/09/16/getters-and-setters-are-evil.html" title="Share on Facebook" class="button" rel="nofollow"> <span class="count count-facebook">0</span> <i class="icon icon-facebook notranslate" aria-hidden="true"></i> </a> <a href="https://twitter.com/share?url=https://www.yegor256.com/2014/09/16/getters-and-setters-are-evil.html&amp;text=Getters%2FSetters.+Evil.+Period." title="Share on Twitter" class="button" rel="nofollow"> <span class="count count-twitter">0</span> <i class="icon icon-twitter notranslate" aria-hidden="true"></i> </a> <a href="https://plus.google.com/share?url=https://www.yegor256.com/2014/09/16/getters-and-setters-are-evil.html" title="Share on Google+" class="button" rel="nofollow"> <span class="count count-googleplus">0</span> <i class="icon icon-googleplus notranslate" aria-hidden="true"></i> </a> <a href="https://www.linkedin.com/cws/share?url=https://www.yegor256.com/2014/09/16/getters-and-setters-are-evil.html" title="Share on LinkedIn" class="button" rel="nofollow"> <span class="count count-linkedin">0</span> <i class="icon icon-linkedin notranslate" aria-hidden="true"></i> </a> <a href="http://reddit.com/submit?url=https://www.yegor256.com/2014/09/16/getters-and-setters-are-evil.html%3F2014-37&amp;title=Getters%2FSetters.+Evil.+Period." title="Share on Reddit" class="button" rel="nofollow"> <span class="count count-reddit">0</span> <i class="icon icon-reddit notranslate" aria-hidden="true"></i> </a> <a href="http://news.ycombinator.com/submitlink?u=https://www.yegor256.com/2014/09/16/getters-and-setters-are-evil.html%3F2014-37&amp;t=Getters%2FSetters.+Evil.+Period." title="Share on Hacker News" class="button" rel="nofollow"> <span class="count count-hackernews">0</span> <i class="icon icon-hackernews notranslate" aria-hidden="true"></i> </a> </nav> </header> <article class="main" itemprop="articleBody"><div ><p>There is an old debate, started in 2003 by Allen Holub in this <a href="http://www.javaworld.com/article/2073723/core-java/why-getter-and-setter-methods-are-evil.html">Why getter and setter methods are evil</a> famous article, about whether getters/setters is an <a href="/2016/02/03/design-patterns-and-anti-patterns.html">anti-pattern</a> and should be avoided or if it is something we inevitably need in object-oriented programming. I&#39;ll try to add my two cents to this discussion.</p><p>The gist of the following text is this: getters and setters is a terrible practice and those who use it can&#39;t be excused. Again, to avoid any misunderstanding, I&#39;m not saying that get/set should be avoided when possible. No. I&#39;m saying that you should <em>never</em> have them near your code.</p><figure class='jb_picture'><img itemprop='image' alt='A Fish Called Wanda (1988) by Charles Crichton' src='/images/2014/09/fish-called-wanda.png' longdesc='#36b53fbe'/><figcaption id='36b53fbe'>A Fish Called Wanda (1988) by Charles Crichton</figcaption></figure><p>Arrogant enough to catch your attention? You&#39;ve been using that get/set pattern for 15 years and you&#39;re a respected Java architect? And you don&#39;t want to hear that nonsense from a stranger? Well, I understand your feelings. I felt almost the same when I stumbled upon <a href="http://amzn.to/266oJr4">Object Thinking</a> by David West, the best book about object-oriented programming I&#39;ve read so far. So please. Calm down and try to understand while I try to explain.</p><h2 id="existing-arguments">Existing Arguments</h2><figure class='badge'><a href='http://amzn.to/266oJr4'><img src='https://www.yegor256.com/images/2014/09/object-thinking-by-david-west.png' style='width:96px;max-width:100%;' alt='badge'/></a></figure><p>There are a few arguments against &quot;accessors&quot; (another name for getters <del>and setters</del>), in an object-oriented world. All of them, I think, are not strong enough. Let&#39;s briefly go through them.</p><p><strong>Tell, Don&#39;t Ask</strong> Allen Holub says, &quot;Don&#39;t ask for the information you need to do the work; ask the object that has the information to do the work for you.&quot;</p><p><strong>Violated Encapsulation Principle</strong> An object can be teared apart by other objects, since they are able to inject any new data into it, through setters. The object simply can&#39;t encapsulate its own state safely enough, since anyone can alter it.</p><aside class='youtube'> <a href='https://www.youtube.com/watch?v=WSgP85kr6eU'><div class='box'> <img src='https://i.ytimg.com/vi/WSgP85kr6eU/mqdefault.jpg' alt='YouTube video #WSgP85kr6eU'/><div class='play'><i class='icon icon-play'></i></div></div></a><div>Why Getters-and-Setters Is An Anti-Pattern? (webinar #4); 1 July 2015.</div></aside><p><strong>Exposed Implementation Details</strong> If we can get an object out of another object, we are relying too much on the first object&#39;s implementation details. If tomorrow it will change, say, the type of that result, we have to change our code as well.</p><p>All these justifications are reasonable, but they are missing the main point.</p><h2 id="fundamental-disbelief">Fundamental Disbelief</h2><p>Most programmers believe that an object is a data structure with methods. I&#39;m quoting <a href="http://java.dzone.com/articles/getters-and-setters-are-not">Getters and Setters Are Not Evil</a>, an article by Bozhidar Bozhanov:</p><blockquote><p>But the majority of objects for which people generate getters and setters are simple data holders.</p></blockquote><p>This misconception is the consequence of a huge misunderstanding! Objects are not &quot;simple data holders.&quot; Objects are <em>not</em> data structures with attached methods. This &quot;data holder&quot; concept came to object-oriented programming from procedural languages, especially C and COBOL. I&#39;ll say it again: an object is <em>not</em> a set of data elements and functions that manipulate them. An object is <em>not</em> a data entity.</p><p>What is it then?</p><h2 id="a-ball-and-a-dog">A Ball and A Dog</h2><p>In true object-oriented programming, objects are <a href="/2014/11/20/seven-virtues-of-good-object.html">living creatures</a>, like you and me. They are living organisms, with their own behavior, properties and a life cycle.</p><p>Can a living organism have a setter? Can you &quot;set&quot; a ball to a dog? Not really. But that is exactly what the following piece of software is doing:</p><figure class="highlight"><pre><code class="language-java" data-lang="java"><span></span><span class="n">Dog</span> <span class="n">dog</span> <span class="o">=</span> <span class="k">new</span> <span class="n">Dog</span><span class="o">();</span>
<span class="n">dog</span><span class="o">.</span><span class="na">setBall</span><span class="o">(</span><span class="k">new</span> <span class="n">Ball</span><span class="o">());</span></code></pre></figure><p>How does that sound?</p><p>Can you get a ball from a dog? Well, you probably can, if she ate it and you&#39;re doing surgery. In that case, yes, we can &quot;get&quot; a ball from a dog. This is what I&#39;m talking about:</p><figure class="highlight"><pre><code class="language-java" data-lang="java"><span></span><span class="n">Dog</span> <span class="n">dog</span> <span class="o">=</span> <span class="k">new</span> <span class="n">Dog</span><span class="o">();</span>
<span class="n">Ball</span> <span class="n">ball</span> <span class="o">=</span> <span class="n">dog</span><span class="o">.</span><span class="na">getBall</span><span class="o">();</span></code></pre></figure><p>Or an even more ridiculous example:</p><figure class="highlight"><pre><code class="language-java" data-lang="java"><span></span><span class="n">Dog</span> <span class="n">dog</span> <span class="o">=</span> <span class="k">new</span> <span class="n">Dog</span><span class="o">();</span>
<span class="n">dog</span><span class="o">.</span><span class="na">setWeight</span><span class="o">(</span><span class="s">&quot;23kg&quot;</span><span class="o">);</span></code></pre></figure><p>Can you imagine this transaction in the real world? :)</p><aside class='youtube'> <a href='https://www.youtube.com/watch?v=F4N25kZ2zQU'><div class='box'> <img src='https://i.ytimg.com/vi/F4N25kZ2zQU/mqdefault.jpg' alt='YouTube video #F4N25kZ2zQU'/><div class='play'><i class='icon icon-play'></i></div></div></a><div>Object Oriented Lies (in Russian with English subtitles); 24 April 2016.</div></aside><p>Does it look similar to what you&#39;re writing every day? If yes, then you&#39;re a procedural programmer. Admit it. And this is what David West has to say about it, on page 30 of his book:</p><blockquote><p>Step one in the transformation of a successful procedural developer into a successful object developer is a lobotomy.</p></blockquote><p>Do you need a lobotomy? Well, I definitely needed one and received it, while reading West&#39;s <a href="http://amzn.to/266oJr4">Object Thinking</a>.</p><h2 id="object-thinking">Object Thinking</h2><p>Start thinking like an object and you will immediately rename those methods. This is what you will probably get:</p><figure class="highlight"><pre><code class="language-java" data-lang="java"><span></span><span class="n">Dog</span> <span class="n">dog</span> <span class="o">=</span> <span class="k">new</span> <span class="n">Dog</span><span class="o">();</span>
<span class="n">dog</span><span class="o">.</span><span class="na">take</span><span class="o">(</span><span class="k">new</span> <span class="n">Ball</span><span class="o">());</span>
<span class="n">Ball</span> <span class="n">ball</span> <span class="o">=</span> <span class="n">dog</span><span class="o">.</span><span class="na">give</span><span class="o">();</span></code></pre></figure><p>Now, we&#39;re treating the dog as a real animal, who can take a ball from us and can give it back, when we ask. Worth mentioning is that the dog can&#39;t give <code>NULL</code> back. Dogs simply don&#39;t know what <code>NULL</code> is :) Object thinking immediately eliminates <a href="/2014/05/13/why-null-is-bad.html">NULL references</a> from your code.</p><p>Besides that, object thinking will lead to object immutability, like in the &quot;weight of the dog&quot; example. You would re-write that like this instead:</p><figure class="highlight"><pre><code class="language-java" data-lang="java"><span></span><span class="n">Dog</span> <span class="n">dog</span> <span class="o">=</span> <span class="k">new</span> <span class="n">Dog</span><span class="o">(</span><span class="s">&quot;23kg&quot;</span><span class="o">);</span>
<span class="kt">int</span> <span class="n">weight</span> <span class="o">=</span> <span class="n">dog</span><span class="o">.</span><span class="na">weight</span><span class="o">();</span></code></pre></figure><p>The dog is an immutable living organism, which doesn&#39;t allow anyone from the outside to change her weight, or size, or name, etc. She can tell, on request, her weight or name. There is nothing wrong with public methods that demonstrate requests for certain &quot;insides&quot; of an object. But these methods are not &quot;getters&quot; and they should never have the &quot;get&quot; prefix. We&#39;re not &quot;getting&quot; anything from the dog. We&#39;re not getting her name. We&#39;re asking her to tell us her name. See the difference?</p><p>We&#39;re not talking semantics here, either. We are differentiating the procedural programming mindset from an object-oriented one. In procedural programming, we&#39;re working with data, manipulating them, getting, setting, and deleting when necessary. We&#39;re in charge, and the data is just a passive component. The dog is nothing to us---it&#39;s just a &quot;data holder.&quot; It doesn&#39;t have its own life. We are free to get whatever is necessary from it and set any data into it. This is how C, COBOL, Pascal and many other procedural languages work(ed).</p><p>On the contrary, in a true object-oriented world, we treat objects like living organisms, with their own date of birth and a moment of death---with their own identity and habits, if you wish. We can ask a dog to give us some piece of data (for example, her weight), and she may return us that information. But we always remember that the dog is an active component. She decides what will happen after our request.</p><p>That&#39;s why, <em>it is conceptually incorrect to have any methods starting with <code>set</code> or <code>get</code> in an object</em>. And it&#39;s not about breaking <a href="/2016/11/21/naked-data.html">encapsulation</a>, like many people argue. It is whether you&#39;re thinking like an object or you&#39;re still writing COBOL in Java syntax.</p><p>PS. Yes, you may ask,---what about JavaBeans, JPA, JAXB, and many other Java API-s that rely on the get/set notation? What about Ruby&#39;s built-in <a href="http://ruby-doc.org/docs/ruby-doc-bundle/UsersGuide/rg/accessors.html">feature</a> that simplifies the creation of accessors? Well, all of that is our <a href="/2013/12/29/proto.html">misfortune</a>. It is much easier to stay in a primitive world of procedural COBOL than to truly understand and appreciate the beautiful world of true objects.</p><p>PPS. Forgot to say, yes, dependency injection via setters is also a terrible anti-pattern. About it, in <a href="/2014/10/03/di-containers-are-evil.html">one of the next posts</a> :)</p><p>PPPS. Here is what I&#39;m suggesting to use instead of getters: <a href="/2016/04/05/printers-instead-of-getters.html">printers</a>.</p></div></article></div><div class="wrapper"> <related-posts /></div><div class="disqus" role="complementary"><p class="disqus_hint"> Please, use <a href="https://help.disqus.com/commenting/what-html-tags-are-allowed-within-comments">syntax highlighting</a> in your comments, to make them more readable.</p><div id="disqus_thread" class="disqus-thread"> <a>&nbsp;</a></div><script> var disqus_config = function () { this.page.url = document.location.href.split('?')[0].split('#')[0].replace('https://', 'http://'); this.page.identifier = this.page.url; }; (function() { var d = document, s = d.createElement('script'); s.src = '//yegor256.disqus.com/embed.js'; s.setAttribute('data-timestamp', +new Date()); (d.head || d.body).appendChild(s); })(); </script> <noscript><div><p class="red"> JavaScript is disabled in your browser, that's why you can't see comments under this post.</p></div></noscript></div><div class="wrapper"> <footer class="footer"><p> &copy; <span itemscope="" itemprop="copyrightHolder" itemtype="http://schema.org/Person"> <span itemprop="name">Yegor Bugayenko</span> </span> 2014&ndash;<span itemprop="copyrightYear">2018</span></p></footer></div></section><div class="wrapper unprintable" style="text-align:center;margin-top:2em;"> <a href="http://www.sixnines.io/h/3ba1652f"> <img src="//www.sixnines.io/b/3ba1652f?style=flat" alt="sixnines availability badge"/> </a></div><script src="//code.jquery.com/jquery-1.9.0.min.js"></script> <script src="/js/all.js?a0e0d018c07"></script> <script>var disqus_shortname = 'yegor256';</script> <script id="dsq-count-scr" src="//yegor256.disqus.com/count.js" async="async"></script> <script> (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){ (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o), m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m) })(window,document,'script','//www.google-analytics.com/analytics.js','ga'); ga('create', 'UA-1963507-32', 'auto'); ga('send', 'pageview'); </script> <script> Cd=document;Cr="&"+Math.random();Cp="&s=1"; Cd.cookie="b=b";if(Cd.cookie)Cp+="&c=1"; Cp+="&t="+(new Date()).getTimezoneOffset(); if(self!=top)Cp+="&f=1"; </script> <script> if(navigator.javaEnabled())Cp+="&j=1"; </script> <script> if(typeof(screen)!='undefined')Cp+="&w="+screen.width+"&h="+ screen.height+"&d="+(screen.colorDepth?screen.colorDepth:screen.pixelDepth); </script> <script> Cd.write("<img src='//c.hit.ua/hit?i=95870&g=0&x=2"+Cp+Cr+ "&r="+escape(Cd.referrer)+"&u="+escape(window.location.href)+ "' border='0' wi"+"dth='1' he"+"ight='1'/>"); </script> <script type="application/ld+json"> { "@context": "http://schema.org", "@type": "Person", "name": "Yegor Bugayenko", "url": "http://www.yegor256.com", "sameAs": [ "https://www.facebook.com/yegor256", "https://instagram.com/yegor256", "https://www.linkedin.com/in/yegor256", "https://twitter.com/yegor256", "https://github.com/yegor256", "https://www.pinterest.com/yegor256/" ] } </script> </body> </html> <!DOCTYPE html> <html xmlns="http://www.w3.org/1999/xhtml" lang="en-US" xml:lang="en-US" itemscope="" itemtype="http://schema.org/WebSite"> <head> <meta charset="utf-8"/> <meta name="description" content="An ideal object-oriented design and architecture doesn&apos;t have getters and setters, signletons, static methods, NULL references and many other anti-patterns " /> <meta name="keywords" content="anti-patterns and worst practices, anti-patterns in object-oriented design, anti-patterns java, object-oriented design, oop anti-patterns" /> <meta name="viewport" content="width=device-width,minimum-scale=1,initial-scale=1"/> <meta name="google-site-verification" content="JEj_gQr2CPe2QKGw8XdMz0R7VboQIUbX3FlM-lwTq-8" /> <meta name="author" content="Yegor Bugayenko"> <meta name="article:published_time" content="2014-09-10 00:00:00 +0000"> <meta name="og:site_name" content="Yegor Bugayenko"/> <meta name="og:type" content="article" /> <meta name="og:locale" content="en_US" /> <meta name="twitter:account_id" content="4503599630178231" /> <meta name="twitter:creator" content="@yegor256"/> <meta name="twitter:site" content="@yegor256"/> <meta name="twitter:title" property="og:title" content="Anti-Patterns in OOP"/> <meta name="twitter:description" property="og:description" content="An ideal object-oriented design and architecture doesn&apos;t have getters and setters, signletons, static methods, NULL references and many other anti-patterns "/> <meta name="twitter:url" property="og:url" content="https://www.yegor256.com/2014/09/10/anti-patterns-in-oop.html"/> <meta name="telegram:channel" content="AAAAAEJFMRzsRTRxM3ec6A"/> <link rel="search" type="application/opensearchdescription+xml" href="/opensearch.xml" title="yegor256" /> <link rel="shortcut icon" href="/favicon.ico?a0e0d018c07"/> <link rel="apple-touch-icon" href="/favicon.ico?a0e0d018c07"/> <link rel="alternate" type="application/rss+xml" title="RSS for yegor256.com" href="https://www.yegor256.com/rss.xml"/> <link rel="stylesheet" href="/css/layout.css?a0e0d018c07"/> <link rel="stylesheet" href="/css/icons.css?a0e0d018c07"/> <link rel="canonical" href="https://www.yegor256.com/2014/09/10/anti-patterns-in-oop.html" /> <link rel="amphtml" href="https://www.yegor256.com/2014/09/10/anti-patterns-in-oop.amp.html" /> <title>Anti-Patterns in OOP </title> </head> <body><div class="wrapper"> <aside class="header-toggle unprintable" id="header-toggle" title="Show the menu" onclick="$('#header').show();$('#header-toggle').hide();">&#9776;</aside> <header class="header" id="header"><div class="face"> <a href="/about-me.html#form" class="sub" title="Click to subscribe to my monthly newsletter"><span>Subscribe</span></a> <a href="/about-me.html" style="position:relative;"> <img src="/images/face-256x256.jpg" class="photo" alt="Yegor Bugayenko"/> </a></div><nav><ul class="menu social notranslate"> <li><a href="https://twitter.com/intent/follow?screen_name=yegor256" rel="nofollow" title="Follow me on Twitter"><i class="icon icon-twitter notranslate" aria-hidden="true"></i></a></li> <li><a href="/rss.xml" rel="nofollow" title="Subscribe to my RSS feed"><i class="icon icon-rss notranslate" aria-hidden="true"></i></a></li> <li><a itemprop="sameAs" href="https://github.com/yegor256" rel="nofollow" title="My GitHub profile"><i class="icon icon-github notranslate" aria-hidden="true"></i></a></li> <li><a itemprop="sameAs" href="http://stackoverflow.com/users/187141/yegor256" rel="nofollow" title="My StackOverflow profile"><i class="icon icon-stackoverflow notranslate" aria-hidden="true"></i></a></li> <li><a itemprop="sameAs" href="https://www.facebook.com/yegor256" rel="nofollow" title="Follow me on Facebook"><i class="icon icon-facebook notranslate" aria-hidden="true"></i></a></li> <li><a itemprop="sameAs" href="https://instagram.com/yegor256" rel="nofollow" title="Follow me on Instagram"><i class="icon icon-instagram notranslate" aria-hidden="true"></i></a></li> <li><a itemprop="sameAs" href="https://www.linkedin.com/in/yegor256" rel="nofollow" title="My LinkedIn profile"><i class="icon icon-linkedin notranslate" aria-hidden="true"></i></a></li> <li><a itemprop="sameAs" href="https://www.youtube.com/c/yegor256?sub_confirmation=1" rel="nofollow" title="My Youtube video channel"><i class="icon icon-youtube notranslate" aria-hidden="true"></i></a></li> <li><a itemprop="sameAs" href="https://www.pinterest.com/yegor256/" rel="nofollow" title="My Pinterest boards"><i class="icon icon-pinterest notranslate" aria-hidden="true"></i></a></li> <li><a itemprop="sameAs" href="https://angel.co/yegor256" rel="nofollow" title="My AngelList profile"><i class="icon icon-angellist notranslate" aria-hidden="true"></i></a></li> <li><a href="https://soundcloud.com/yegor256" rel="nofollow" title="My podcast"><i class="icon icon-podcast notranslate" aria-hidden="true"></i></a></li> <li><a href="https://itunes.apple.com/us/podcast/yegor256-podcast/id1150826721" rel="nofollow" title="My iTunes podcast"><i class="icon icon-itunes notranslate" aria-hidden="true"></i></a></li> <li><a href="https://t.me/joinchat/AAAAAEJFMRzsRTRxM3ec6A" rel="nofollow" title="My Telegram public channel"><i class="icon icon-telegram notranslate" aria-hidden="true"></i></a></li> <li><a href="mailto:blog@yegor256.com" rel="nofollow" title="Email me any time"><i class="icon icon-mail notranslate" aria-hidden="true"></i></a></li></ul><ul class="menu"> <li><a href="/" title="Home page">Home</a></li> <li ><a href="/best.html" title="Best articles to read">12&#160;Best</a></li> <li ><a href="/contents.html" title="The contents of the entire blog">All&#160;288</a></li> <li ><a href="/webinars.html" title="My webinars">Webinars</a></li> <li ><a href="/talks.html" title="Future and past conference talks">Talks</a></li> <li ><a href="/books.html" title="The books I wrote">Books</a></li> <li ><a href="/papers.html" title="My academic papers and patents">Papers</a></li> <li ><a href="/pets.html" title="My loved pet projects">Pets</a></li> <li ><a href="/award.html" title="Software quality award">Award</a></li> <li ><a href="/testimonials.html" title="What some people say about me">Testimonials</a></li> <li ><a href="/shift-m.html" title="Audio podcast about project management">Shift-M</a></li> <li ><a href="/paintings.html" title="My paintings for sale">Paintings</a></li> <li><a href="http://ru.yegor256.com/" title="Немного на русском языке">По-русски</a></li></ul></nav><div class="search"> <form method="get" action="https://www.google.com/search" itemprop="potentialAction" itemscope="" itemtype="http://schema.org/SearchAction"> <meta itemprop="target" content="https://www.google.com/search?q={q}"/> <input name="sitesearch" value="yegor256.com" type="hidden"/> <input itemprop="query-input" type="text" id="search-query" class="field field-text" required="required" onfocus="$('.google').css('visibility', 'visible');" name="q" placeholder="Search..." autocomplete="off"/> <input type="image" src="/images/google-search-icon.svg" class="google" title="Search via Google" alt="Search via Google"/> </form></div><div class="hot"><ul> <li> <a href="/code-ahead.html">Code Ahead</a> was published on Amazon just a few days ago! It is my new book, a novel about programmers. It explains in details the majority of ideas that stand behind <a href="https://www.zerocracy.com">Zerocracy</a> and <a href="https://www.xdsd.org">XDSD</a>. </li> <li> At <a href="/webinars.html">Webinar #37</a> we will discuss naming problem in OOP, for objects, methods and attributes; join us on <b>September 12</b>, at 11am PST. </li></ul></div></header></div><section itemscope="" itemtype="http://schema.org/BlogPosting"><div class="wrapper"> <header><p class="printable"> <img src="https://api.qrserver.com/v1/create-qr-code/?data=https://www.yegor256.com/2014/09/10/anti-patterns-in-oop.html&amp;format=svg" style="width:125px;height:125px;" alt="QR code"/></p><p class="printable"> <code itemprop="url">https://www.yegor256.com/2014/09/10/anti-patterns-in-oop.html</code></p><h1 itemprop="name headline mainEntityOfPage">Anti-Patterns in OOP</h1><ul class="subline"> <li> <time itemprop="datePublished" datetime="2014-09-10T00:00:00+00:00"> 10 September 2014 </time> </li> <li class="printable" itemscope="" itemprop="author" itemtype="http://schema.org/Person"> <span itemprop="name">Yegor Bugayenko</span> </li> <li class="unprintable"> <i class="icon icon-comments"></i> <a href="http://www.yegor256.com/2014/09/10/anti-patterns-in-oop.html#disqus_thread" itemprop="discussionUrl">comments</a> </li></ul><p class="unprintable"><p>Here they come:</p><ul> <li><p><a href="/2014/05/13/why-null-is-bad.html">NULL References</a></p></li> <li><p><a href="/2014/05/05/oop-alternative-to-utility-classes.html">Utility Classes</a></p></li> <li><p><a href="/2014/06/09/objects-should-be-immutable.html">Mutable Objects</a></p></li> <li><p><a href="/2014/09/16/getters-and-setters-are-evil.html">Getters and Setters</a></p></li> <li><p><a href="/2016/07/06/data-transfer-object.html">Data Transfer Object (DTO)</a></p></li> <li><p><a href="/2014/12/01/orm-offensive-anti-pattern.html">Object-Relational Mapping (ORM)</a></p></li> <li><p><a href="/2016/06/27/singletons-must-die.html">Singletons</a></p></li> <li><p><a href="/2015/03/09/objects-end-with-er.html">Controllers, Managers, Validators</a></p></li> <li><p><a href="/2015/02/20/utility-classes-vs-functional-programming.html">Public Static Methods</a></p></li> <li><p><a href="/2015/04/02/class-casting-is-anti-pattern.html">Class Casting</a></p></li> <li><p><a href="/2017/03/07/traits-and-mixins.html">Traits and Mixins</a></p></li></ul><p>Avoid them at all cost. Check <a href="/2014/04/27/typical-mistakes-in-java-code.html">this list</a> and <a href="/2016/02/03/design-patterns-and-anti-patterns.html">this one</a> too.</p></p><nav class="buttons notranslate desktop-only"> <a href="http://www.facebook.com/sharer/sharer.php?u=https://www.yegor256.com/2014/09/10/anti-patterns-in-oop.html" title="Share on Facebook" class="button" rel="nofollow"> <span class="count count-facebook">0</span> <i class="icon icon-facebook notranslate" aria-hidden="true"></i> </a> <a href="https://twitter.com/share?url=https://www.yegor256.com/2014/09/10/anti-patterns-in-oop.html&amp;text=Anti-Patterns+in+OOP" title="Share on Twitter" class="button" rel="nofollow"> <span class="count count-twitter">0</span> <i class="icon icon-twitter notranslate" aria-hidden="true"></i> </a> <a href="https://plus.google.com/share?url=https://www.yegor256.com/2014/09/10/anti-patterns-in-oop.html" title="Share on Google+" class="button" rel="nofollow"> <span class="count count-googleplus">0</span> <i class="icon icon-googleplus notranslate" aria-hidden="true"></i> </a> <a href="https://www.linkedin.com/cws/share?url=https://www.yegor256.com/2014/09/10/anti-patterns-in-oop.html" title="Share on LinkedIn" class="button" rel="nofollow"> <span class="count count-linkedin">0</span> <i class="icon icon-linkedin notranslate" aria-hidden="true"></i> </a> <a href="http://reddit.com/submit?url=https://www.yegor256.com/2014/09/10/anti-patterns-in-oop.html%3F2014-36&amp;title=Anti-Patterns+in+OOP" title="Share on Reddit" class="button" rel="nofollow"> <span class="count count-reddit">0</span> <i class="icon icon-reddit notranslate" aria-hidden="true"></i> </a> <a href="http://news.ycombinator.com/submitlink?u=https://www.yegor256.com/2014/09/10/anti-patterns-in-oop.html%3F2014-36&amp;t=Anti-Patterns+in+OOP" title="Share on Hacker News" class="button" rel="nofollow"> <span class="count count-hackernews">0</span> <i class="icon icon-hackernews notranslate" aria-hidden="true"></i> </a> </nav> </header> <article class="main" itemprop="articleBody"><div ><p>Here they come:</p><ul> <li><p><a href="/2014/05/13/why-null-is-bad.html">NULL References</a></p></li> <li><p><a href="/2014/05/05/oop-alternative-to-utility-classes.html">Utility Classes</a></p></li> <li><p><a href="/2014/06/09/objects-should-be-immutable.html">Mutable Objects</a></p></li> <li><p><a href="/2014/09/16/getters-and-setters-are-evil.html">Getters and Setters</a></p></li> <li><p><a href="/2016/07/06/data-transfer-object.html">Data Transfer Object (DTO)</a></p></li> <li><p><a href="/2014/12/01/orm-offensive-anti-pattern.html">Object-Relational Mapping (ORM)</a></p></li> <li><p><a href="/2016/06/27/singletons-must-die.html">Singletons</a></p></li> <li><p><a href="/2015/03/09/objects-end-with-er.html">Controllers, Managers, Validators</a></p></li> <li><p><a href="/2015/02/20/utility-classes-vs-functional-programming.html">Public Static Methods</a></p></li> <li><p><a href="/2015/04/02/class-casting-is-anti-pattern.html">Class Casting</a></p></li> <li><p><a href="/2017/03/07/traits-and-mixins.html">Traits and Mixins</a></p></li></ul><p>Avoid them at all cost. Check <a href="/2014/04/27/typical-mistakes-in-java-code.html">this list</a> and <a href="/2016/02/03/design-patterns-and-anti-patterns.html">this one</a> too.</p></div></article></div><div class="wrapper"> <related-posts /></div><div class="disqus" role="complementary"><p class="disqus_hint"> Please, use <a href="https://help.disqus.com/commenting/what-html-tags-are-allowed-within-comments">syntax highlighting</a> in your comments, to make them more readable.</p><div id="disqus_thread" class="disqus-thread"> <a>&nbsp;</a></div><script> var disqus_config = function () { this.page.url = document.location.href.split('?')[0].split('#')[0].replace('https://', 'http://'); this.page.identifier = this.page.url; }; (function() { var d = document, s = d.createElement('script'); s.src = '//yegor256.disqus.com/embed.js'; s.setAttribute('data-timestamp', +new Date()); (d.head || d.body).appendChild(s); })(); </script> <noscript><div><p class="red"> JavaScript is disabled in your browser, that's why you can't see comments under this post.</p></div></noscript></div><div class="wrapper"> <footer class="footer"><p> &copy; <span itemscope="" itemprop="copyrightHolder" itemtype="http://schema.org/Person"> <span itemprop="name">Yegor Bugayenko</span> </span> 2014&ndash;<span itemprop="copyrightYear">2018</span></p></footer></div></section><div class="wrapper unprintable" style="text-align:center;margin-top:2em;"> <a href="http://www.sixnines.io/h/3ba1652f"> <img src="//www.sixnines.io/b/3ba1652f?style=flat" alt="sixnines availability badge"/> </a></div><script src="//code.jquery.com/jquery-1.9.0.min.js"></script> <script src="/js/all.js?a0e0d018c07"></script> <script>var disqus_shortname = 'yegor256';</script> <script id="dsq-count-scr" src="//yegor256.disqus.com/count.js" async="async"></script> <script> (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){ (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o), m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m) })(window,document,'script','//www.google-analytics.com/analytics.js','ga'); ga('create', 'UA-1963507-32', 'auto'); ga('send', 'pageview'); </script> <script> Cd=document;Cr="&"+Math.random();Cp="&s=1"; Cd.cookie="b=b";if(Cd.cookie)Cp+="&c=1"; Cp+="&t="+(new Date()).getTimezoneOffset(); if(self!=top)Cp+="&f=1"; </script> <script> if(navigator.javaEnabled())Cp+="&j=1"; </script> <script> if(typeof(screen)!='undefined')Cp+="&w="+screen.width+"&h="+ screen.height+"&d="+(screen.colorDepth?screen.colorDepth:screen.pixelDepth); </script> <script> Cd.write("<img src='//c.hit.ua/hit?i=95870&g=0&x=2"+Cp+Cr+ "&r="+escape(Cd.referrer)+"&u="+escape(window.location.href)+ "' border='0' wi"+"dth='1' he"+"ight='1'/>"); </script> <script type="application/ld+json"> { "@context": "http://schema.org", "@type": "Person", "name": "Yegor Bugayenko", "url": "http://www.yegor256.com", "sameAs": [ "https://www.facebook.com/yegor256", "https://instagram.com/yegor256", "https://www.linkedin.com/in/yegor256", "https://twitter.com/yegor256", "https://github.com/yegor256", "https://www.pinterest.com/yegor256/" ] } </script> </body> </html> <!DOCTYPE html> <html xmlns="http://www.w3.org/1999/xhtml" lang="en-US" xml:lang="en-US" itemscope="" itemtype="http://schema.org/WebSite"> <head> <meta charset="utf-8"/> <meta name="description" content="The article gives arguments about why classes/objects in object-oriented programming have to be immutable, i.e. never modify their encapsulated state " /> <meta name="keywords" content="immutability in java, immutable class java, immutable java design pattern, java immutable object, java immutable object advantage, java immutable value object, java mutable immutable object" /> <meta name="viewport" content="width=device-width,minimum-scale=1,initial-scale=1"/> <meta name="google-site-verification" content="JEj_gQr2CPe2QKGw8XdMz0R7VboQIUbX3FlM-lwTq-8" /> <meta name="author" content="Yegor Bugayenko"> <meta name="article:published_time" content="2014-06-09 00:00:00 +0000"> <meta name="og:site_name" content="Yegor Bugayenko"/> <meta name="og:type" content="article" /> <meta name="og:locale" content="en_US" /> <meta name="twitter:account_id" content="4503599630178231" /> <meta name="twitter:creator" content="@yegor256"/> <meta name="twitter:site" content="@yegor256"/> <meta name="twitter:title" property="og:title" content="Objects Should Be Immutable"/> <meta name="twitter:description" property="og:description" content="The article gives arguments about why classes/objects in object-oriented programming have to be immutable, i.e. never modify their encapsulated state "/> <meta name="twitter:url" property="og:url" content="https://www.yegor256.com/2014/06/09/objects-should-be-immutable.html"/> <meta name="telegram:channel" content="AAAAAEJFMRzsRTRxM3ec6A"/> <link rel="search" type="application/opensearchdescription+xml" href="/opensearch.xml" title="yegor256" /> <link rel="shortcut icon" href="/favicon.ico?a0e0d018c07"/> <link rel="apple-touch-icon" href="/favicon.ico?a0e0d018c07"/> <link rel="alternate" type="application/rss+xml" title="RSS for yegor256.com" href="https://www.yegor256.com/rss.xml"/> <link rel="stylesheet" href="/css/layout.css?a0e0d018c07"/> <link rel="stylesheet" href="/css/icons.css?a0e0d018c07"/> <link rel="canonical" href="https://www.yegor256.com/2014/06/09/objects-should-be-immutable.html" /> <link rel="amphtml" href="https://www.yegor256.com/2014/06/09/objects-should-be-immutable.amp.html" /> <title>Objects Should Be Immutable </title> </head> <body><div class="wrapper"> <aside class="header-toggle unprintable" id="header-toggle" title="Show the menu" onclick="$('#header').show();$('#header-toggle').hide();">&#9776;</aside> <header class="header" id="header"><div class="face"> <a href="/about-me.html#form" class="sub" title="Click to subscribe to my monthly newsletter"><span>Subscribe</span></a> <a href="/about-me.html" style="position:relative;"> <img src="/images/face-256x256.jpg" class="photo" alt="Yegor Bugayenko"/> </a></div><nav><ul class="menu social notranslate"> <li><a href="https://twitter.com/intent/follow?screen_name=yegor256" rel="nofollow" title="Follow me on Twitter"><i class="icon icon-twitter notranslate" aria-hidden="true"></i></a></li> <li><a href="/rss.xml" rel="nofollow" title="Subscribe to my RSS feed"><i class="icon icon-rss notranslate" aria-hidden="true"></i></a></li> <li><a itemprop="sameAs" href="https://github.com/yegor256" rel="nofollow" title="My GitHub profile"><i class="icon icon-github notranslate" aria-hidden="true"></i></a></li> <li><a itemprop="sameAs" href="http://stackoverflow.com/users/187141/yegor256" rel="nofollow" title="My StackOverflow profile"><i class="icon icon-stackoverflow notranslate" aria-hidden="true"></i></a></li> <li><a itemprop="sameAs" href="https://www.facebook.com/yegor256" rel="nofollow" title="Follow me on Facebook"><i class="icon icon-facebook notranslate" aria-hidden="true"></i></a></li> <li><a itemprop="sameAs" href="https://instagram.com/yegor256" rel="nofollow" title="Follow me on Instagram"><i class="icon icon-instagram notranslate" aria-hidden="true"></i></a></li> <li><a itemprop="sameAs" href="https://www.linkedin.com/in/yegor256" rel="nofollow" title="My LinkedIn profile"><i class="icon icon-linkedin notranslate" aria-hidden="true"></i></a></li> <li><a itemprop="sameAs" href="https://www.youtube.com/c/yegor256?sub_confirmation=1" rel="nofollow" title="My Youtube video channel"><i class="icon icon-youtube notranslate" aria-hidden="true"></i></a></li> <li><a itemprop="sameAs" href="https://www.pinterest.com/yegor256/" rel="nofollow" title="My Pinterest boards"><i class="icon icon-pinterest notranslate" aria-hidden="true"></i></a></li> <li><a itemprop="sameAs" href="https://angel.co/yegor256" rel="nofollow" title="My AngelList profile"><i class="icon icon-angellist notranslate" aria-hidden="true"></i></a></li> <li><a href="https://soundcloud.com/yegor256" rel="nofollow" title="My podcast"><i class="icon icon-podcast notranslate" aria-hidden="true"></i></a></li> <li><a href="https://itunes.apple.com/us/podcast/yegor256-podcast/id1150826721" rel="nofollow" title="My iTunes podcast"><i class="icon icon-itunes notranslate" aria-hidden="true"></i></a></li> <li><a href="https://t.me/joinchat/AAAAAEJFMRzsRTRxM3ec6A" rel="nofollow" title="My Telegram public channel"><i class="icon icon-telegram notranslate" aria-hidden="true"></i></a></li> <li><a href="mailto:blog@yegor256.com" rel="nofollow" title="Email me any time"><i class="icon icon-mail notranslate" aria-hidden="true"></i></a></li></ul><ul class="menu"> <li><a href="/" title="Home page">Home</a></li> <li ><a href="/best.html" title="Best articles to read">12&#160;Best</a></li> <li ><a href="/contents.html" title="The contents of the entire blog">All&#160;288</a></li> <li ><a href="/webinars.html" title="My webinars">Webinars</a></li> <li ><a href="/talks.html" title="Future and past conference talks">Talks</a></li> <li ><a href="/books.html" title="The books I wrote">Books</a></li> <li ><a href="/papers.html" title="My academic papers and patents">Papers</a></li> <li ><a href="/pets.html" title="My loved pet projects">Pets</a></li> <li ><a href="/award.html" title="Software quality award">Award</a></li> <li ><a href="/testimonials.html" title="What some people say about me">Testimonials</a></li> <li ><a href="/shift-m.html" title="Audio podcast about project management">Shift-M</a></li> <li ><a href="/paintings.html" title="My paintings for sale">Paintings</a></li> <li><a href="http://ru.yegor256.com/" title="Немного на русском языке">По-русски</a></li></ul></nav><div class="search"> <form method="get" action="https://www.google.com/search" itemprop="potentialAction" itemscope="" itemtype="http://schema.org/SearchAction"> <meta itemprop="target" content="https://www.google.com/search?q={q}"/> <input name="sitesearch" value="yegor256.com" type="hidden"/> <input itemprop="query-input" type="text" id="search-query" class="field field-text" required="required" onfocus="$('.google').css('visibility', 'visible');" name="q" placeholder="Search..." autocomplete="off"/> <input type="image" src="/images/google-search-icon.svg" class="google" title="Search via Google" alt="Search via Google"/> </form></div><div class="hot"><ul> <li> <a href="/code-ahead.html">Code Ahead</a> was published on Amazon just a few days ago! It is my new book, a novel about programmers. It explains in details the majority of ideas that stand behind <a href="https://www.zerocracy.com">Zerocracy</a> and <a href="https://www.xdsd.org">XDSD</a>. </li> <li> At <a href="/webinars.html">Webinar #37</a> we will discuss naming problem in OOP, for objects, methods and attributes; join us on <b>September 12</b>, at 11am PST. </li></ul></div></header></div><section itemscope="" itemtype="http://schema.org/BlogPosting"><div class="wrapper"> <header><p class="printable"> <img src="https://api.qrserver.com/v1/create-qr-code/?data=https://www.yegor256.com/2014/06/09/objects-should-be-immutable.html&amp;format=svg" style="width:125px;height:125px;" alt="QR code"/></p><p class="printable"> <code itemprop="url">https://www.yegor256.com/2014/06/09/objects-should-be-immutable.html</code></p><h1 itemprop="name headline mainEntityOfPage">Objects Should Be Immutable</h1><aside class='book'><a href='http://amzn.to/2qFt4Tn'><img src='/images/books/elegant-objects/cover.png' class='book-cover' alt='book cover'/></a>Read more about this subject in <a href='http://amzn.to/2qFt4Tn'>Section&nbsp;2.6</a><br/> of my book<a href='http://amzn.to/2qFt4Tn'><img src='/images/books/amazon-buy-button.png' class='amazon-button' alt='Click to buy'/></a></aside><ul class="subline"> <li> <time itemprop="datePublished" datetime="2014-06-09T00:00:00+00:00"> 9 June 2014 </time> </li> <li class="printable" itemscope="" itemprop="author" itemtype="http://schema.org/Person"> <span itemprop="name">Yegor Bugayenko</span> </li> <li class="unprintable"> <i class="icon icon-comments"></i> <a href="http://www.yegor256.com/2014/06/09/objects-should-be-immutable.html#disqus_thread" itemprop="discussionUrl">comments</a> </li></ul><ul class="subline"> <li>Discussed at:</li> <li><a href="https://www.reddit.com/r/programming/comments/2ld05q/proper_objects_should_be_immutable_dont_you_think/">reddit</a></li></ul><p class="unprintable"><p>In object-oriented programming, an object is <a href="http://en.wikipedia.org/wiki/Immutable_object">immutable</a> if its state can&#39;t be modified after it is created. In Java, a good example of an immutable <a href="/2016/07/14/who-is-object.html">object</a> is <a href="http://docs.oracle.com/javase/7/docs/api/java/lang/String.html"><code>String</code></a>. Once created, we can&#39;t modify its state. We can request that it creates new strings, but its own state will never change.</p><p>However, there are not so many immutable classes in JDK. Take, for example, class <a href="http://docs.oracle.com/javase/7/docs/api/java/util/Date.html"><code>Date</code></a>. It is possible to modify its state using <code>setTime()</code>.</p><aside class='youtube'> <a href='https://www.youtube.com/watch?v=KwP7Ay9Z-hc'><div class='box'> <img src='https://i.ytimg.com/vi/KwP7Ay9Z-hc/mqdefault.jpg' alt='YouTube video #KwP7Ay9Z-hc'/><div class='play'><i class='icon icon-play'></i></div></div></a><div>Immutable Objects vs. Common Sense (webinar #2); 6 May 2015.</div></aside><p>I don&#39;t know why the JDK designers decided to make these two very similar classes differently. However, I believe that the design of a mutable <code>Date</code> has many flaws, while the immutable <code>String</code> is much more in the spirit of the object-oriented paradigm.</p><p>Moreover, I think that <strong>all classes should be immutable in a perfect object-oriented world</strong>. Unfortunately, sometimes, it is technically not possible due to limitations in JVM. Nevertheless, we should always aim for the best.</p><p>This is an incomplete list of arguments in favor of immutability:</p><ul> <li>immutable objects are simpler to construct, test, and use</li> <li>truly immutable objects are always thread-safe</li> <li>they help to avoid <a href="/2015/12/08/temporal-coupling-between-method-calls.html">temporal coupling</a></li> <li>their usage is side-effect free (no defensive copies)</li> <li>identity mutability problem is avoided</li> <li>they always have failure atomicity</li> <li>they are much easier to cache</li> <li>they prevent NULL references, <a href="/2014/05/13/why-null-is-bad.html">which are bad</a></li></ul><p>Let&#39;s discuss the most important arguments one by one.</p><h2 id="thread-safety">Thread Safety</h2><p>The first and the most obvious argument is that immutable objects are thread-safe. This means that multiple threads can access the same object at the same time, without clashing with another thread.</p><figure class='badge'><a href='http://amzn.to/2bQVqBr'><img src='https://www.yegor256.com/images/2014/12/java-concurrency-in-practice.png' style='width:100px;max-width:100%;' alt='badge'/></a></figure><p>If no object methods can modify its state, no matter how many of them and how often are being called parallel---they will work in their own memory space in stack.</p><p>Goetz et al. explained the advantages of immutable objects in more details in their very famous book <a href="http://amzn.to/2bQVqBr">Java Concurrency in Practice</a> (highly recommended).</p><h2 id="avoiding-temporal-coupling">Avoiding Temporal Coupling</h2><p>Here is an example of temporal coupling (the code makes two consecutive HTTP POST requests, where the second one contains HTTP body):</p><figure class="highlight"><pre><code class="language-java" data-lang="java"><span></span><span class="n">Request</span> <span class="n">request</span> <span class="o">=</span> <span class="k">new</span> <span class="n">Request</span><span class="o">(</span><span class="s">&quot;http://localhost&quot;</span><span class="o">);</span>
<span class="n">request</span><span class="o">.</span><span class="na">method</span><span class="o">(</span><span class="s">&quot;POST&quot;</span><span class="o">);</span>
<span class="n">String</span> <span class="n">first</span> <span class="o">=</span> <span class="n">request</span><span class="o">.</span><span class="na">fetch</span><span class="o">();</span>
<span class="n">request</span><span class="o">.</span><span class="na">body</span><span class="o">(</span><span class="s">&quot;text=hello&quot;</span><span class="o">);</span>
<span class="n">String</span> <span class="n">second</span> <span class="o">=</span> <span class="n">request</span><span class="o">.</span><span class="na">fetch</span><span class="o">();</span></code></pre></figure><p>This code works. However, you must remember that the first request should be configured before the second one may happen. If we decide to remove the first request from the script, we will remove the second and the third line, and won&#39;t get any errors from the compiler:</p><figure class="highlight"><pre><code class="language-java" data-lang="java"><span></span><span class="n">Request</span> <span class="n">request</span> <span class="o">=</span> <span class="k">new</span> <span class="n">Request</span><span class="o">(</span><span class="s">&quot;http://localhost&quot;</span><span class="o">);</span>
<span class="c1">// request.method(&quot;POST&quot;);</span>
<span class="c1">// String first = request.fetch();</span>
<span class="n">request</span><span class="o">.</span><span class="na">body</span><span class="o">(</span><span class="s">&quot;text=hello&quot;</span><span class="o">);</span>
<span class="n">String</span> <span class="n">second</span> <span class="o">=</span> <span class="n">request</span><span class="o">.</span><span class="na">fetch</span><span class="o">();</span></code></pre></figure><p>Now, the script is broken although it compiled without errors. This is what <a href="/2015/12/08/temporal-coupling-between-method-calls.html">temporal coupling</a> is about---there is always some hidden information in the code that a programmer has to remember. In this example, we have to remember that the configuration for the first request is also used for the second one.</p><aside class='youtube'> <a href='https://www.youtube.com/watch?v=EnhRgXrHCC4'><div class='box'> <img src='https://i.ytimg.com/vi/EnhRgXrHCC4/mqdefault.jpg' alt='YouTube video #EnhRgXrHCC4'/><div class='play'><i class='icon icon-play'></i></div></div></a><div>How Immutability Helps in OOP (in Russian with English subtitles); 21 May 2016.</div></aside><p>We have to remember that the second request should always stay together and be executed after the first one.</p><p>If <code>Request</code> class were immutable, the first snippet wouldn&#39;t work in the first place, and would have been rewritten like:</p><figure class="highlight"><pre><code class="language-java" data-lang="java"><span></span><span class="kd">final</span> <span class="n">Request</span> <span class="n">request</span> <span class="o">=</span> <span class="k">new</span> <span class="n">Request</span><span class="o">(</span><span class="s">&quot;&quot;</span><span class="o">);</span>
<span class="n">String</span> <span class="n">first</span> <span class="o">=</span> <span class="n">request</span><span class="o">.</span><span class="na">method</span><span class="o">(</span><span class="s">&quot;POST&quot;</span><span class="o">).</span><span class="na">fetch</span><span class="o">();</span>
<span class="n">String</span> <span class="n">second</span> <span class="o">=</span> <span class="n">request</span><span class="o">.</span><span class="na">method</span><span class="o">(</span><span class="s">&quot;POST&quot;</span><span class="o">).</span><span class="na">body</span><span class="o">(</span><span class="s">&quot;text=hello&quot;</span><span class="o">).</span><span class="na">fetch</span><span class="o">();</span></code></pre></figure><p>Now, these two requests are not coupled. We can safely remove the first one, and the second one will still work correctly. You may point out that there is a code duplication. Yes, we should get rid of it and re-write the code:</p><figure class="highlight"><pre><code class="language-java" data-lang="java"><span></span><span class="kd">final</span> <span class="n">Request</span> <span class="n">request</span> <span class="o">=</span> <span class="k">new</span> <span class="n">Request</span><span class="o">(</span><span class="s">&quot;&quot;</span><span class="o">);</span>
<span class="kd">final</span> <span class="n">Request</span> <span class="n">post</span> <span class="o">=</span> <span class="n">request</span><span class="o">.</span><span class="na">method</span><span class="o">(</span><span class="s">&quot;POST&quot;</span><span class="o">);</span>
<span class="n">String</span> <span class="n">first</span> <span class="o">=</span> <span class="n">post</span><span class="o">.</span><span class="na">fetch</span><span class="o">();</span>
<span class="n">String</span> <span class="n">second</span> <span class="o">=</span> <span class="n">post</span><span class="o">.</span><span class="na">body</span><span class="o">(</span><span class="s">&quot;text=hello&quot;</span><span class="o">).</span><span class="na">fetch</span><span class="o">();</span></code></pre></figure><p>See, refactoring didn&#39;t break anything and we still don&#39;t have temporal coupling. The first request can be removed safely from the code without affecting the second one.</p><p>I hope this example demonstrates that the code manipulating immutable objects is more readable and maintainable, because it doesn&#39;t have <a href="/2015/12/08/temporal-coupling-between-method-calls.html">temporal coupling</a>.</p><h2 id="avoiding-side-effects">Avoiding Side Effects</h2><p>Let&#39;s try to use our <code>Request</code> class in a new method (now it is mutable):</p><figure class="highlight"><pre><code class="language-java" data-lang="java"><span></span><span class="kd">public</span> <span class="n">String</span> <span class="nf">post</span><span class="o">(</span><span class="n">Request</span> <span class="n">request</span><span class="o">)</span> <span class="o">{</span>
  <span class="n">request</span><span class="o">.</span><span class="na">method</span><span class="o">(</span><span class="s">&quot;POST&quot;</span><span class="o">);</span>
  <span class="k">return</span> <span class="n">request</span><span class="o">.</span><span class="na">fetch</span><span class="o">();</span>
<span class="o">}</span></code></pre></figure><p>Let&#39;s try to make two requests---the first with GET method and the second with POST:</p><figure class="highlight"><pre><code class="language-java" data-lang="java"><span></span><span class="n">Request</span> <span class="n">request</span> <span class="o">=</span> <span class="k">new</span> <span class="n">Request</span><span class="o">(</span><span class="s">&quot;http://localhost&quot;</span><span class="o">);</span>
<span class="n">request</span><span class="o">.</span><span class="na">method</span><span class="o">(</span><span class="s">&quot;GET&quot;</span><span class="o">);</span>
<span class="n">String</span> <span class="n">first</span> <span class="o">=</span> <span class="k">this</span><span class="o">.</span><span class="na">post</span><span class="o">(</span><span class="n">request</span><span class="o">);</span>
<span class="n">String</span> <span class="n">second</span> <span class="o">=</span> <span class="n">request</span><span class="o">.</span><span class="na">fetch</span><span class="o">();</span></code></pre></figure><p>Method <code>post()</code> has a &quot;side effect&quot;---it makes changes to the mutable object <code>request</code>. These changes are not really expected in this case. We expect it to make a POST request and return its body. We don&#39;t want to read its documentation just to find out that behind the scene it also modifies the request we&#39;re passing to it as an argument.</p><p>Needless to say, such side effects lead to bugs and maintainability issues. It would be much better to work with an immutable <code>Request</code>:</p><figure class="highlight"><pre><code class="language-java" data-lang="java"><span></span><span class="kd">public</span> <span class="n">String</span> <span class="nf">post</span><span class="o">(</span><span class="n">Request</span> <span class="n">request</span><span class="o">)</span> <span class="o">{</span>
  <span class="k">return</span> <span class="n">request</span><span class="o">.</span><span class="na">method</span><span class="o">(</span><span class="s">&quot;POST&quot;</span><span class="o">).</span><span class="na">fetch</span><span class="o">();</span>
<span class="o">}</span></code></pre></figure><p>In this case, we may not have any side effects. Nobody can modify our <code>request</code> object, no matter where it is used and how deep through the call stack it is passed by method calls:</p><figure class="highlight"><pre><code class="language-java" data-lang="java"><span></span><span class="n">Request</span> <span class="n">request</span> <span class="o">=</span> <span class="k">new</span> <span class="n">Request</span><span class="o">(</span><span class="s">&quot;http://localhost&quot;</span><span class="o">).</span><span class="na">method</span><span class="o">(</span><span class="s">&quot;GET&quot;</span><span class="o">);</span>
<span class="n">String</span> <span class="n">first</span> <span class="o">=</span> <span class="k">this</span><span class="o">.</span><span class="na">post</span><span class="o">(</span><span class="n">request</span><span class="o">);</span>
<span class="n">String</span> <span class="n">second</span> <span class="o">=</span> <span class="n">request</span><span class="o">.</span><span class="na">fetch</span><span class="o">();</span></code></pre></figure><p>This code is perfectly safe and side effect free.</p><h2 id="avoiding-identity-mutability">Avoiding Identity Mutability</h2><p>Very often, we want objects to be identical if their internal states are the same. <a href="http://docs.oracle.com/javase/7/docs/api/java/util/Date.html"><code>Date</code></a> class is a good example:</p><figure class="highlight"><pre><code class="language-java" data-lang="java"><span></span><span class="n">Date</span> <span class="n">first</span> <span class="o">=</span> <span class="k">new</span> <span class="n">Date</span><span class="o">(</span><span class="mi">1L</span><span class="o">);</span>
<span class="n">Date</span> <span class="n">second</span> <span class="o">=</span> <span class="k">new</span> <span class="n">Date</span><span class="o">(</span><span class="mi">1L</span><span class="o">);</span>
<span class="k">assert</span> <span class="n">first</span><span class="o">.</span><span class="na">equals</span><span class="o">(</span><span class="n">second</span><span class="o">);</span> <span class="c1">// true</span></code></pre></figure><p>There are two different objects; however, they are equal to each other because their encapsulated states are the same. This is made possible through their custom overloaded implementation of <code>equals()</code> and <code>hashCode()</code> methods.</p><p>The consequence of this convenient approach being used with mutable objects is that every time we modify object&#39;s state it changes its identity:</p><figure class="highlight"><pre><code class="language-java" data-lang="java"><span></span><span class="n">Date</span> <span class="n">first</span> <span class="o">=</span> <span class="k">new</span> <span class="n">Date</span><span class="o">(</span><span class="mi">1L</span><span class="o">);</span>
<span class="n">Date</span> <span class="n">second</span> <span class="o">=</span> <span class="k">new</span> <span class="n">Date</span><span class="o">(</span><span class="mi">1L</span><span class="o">);</span>
<span class="n">first</span><span class="o">.</span><span class="na">setTime</span><span class="o">(</span><span class="mi">2L</span><span class="o">);</span>
<span class="k">assert</span> <span class="n">first</span><span class="o">.</span><span class="na">equals</span><span class="o">(</span><span class="n">second</span><span class="o">);</span> <span class="c1">// false</span></code></pre></figure><p>This may look natural, until you start using your mutable objects as keys in maps:</p><figure class="highlight"><pre><code class="language-java" data-lang="java"><span></span><span class="n">Map</span><span class="o">&lt;</span><span class="n">Date</span><span class="o">,</span> <span class="n">String</span><span class="o">&gt;</span> <span class="n">map</span> <span class="o">=</span> <span class="k">new</span> <span class="n">HashMap</span><span class="o">&lt;&gt;();</span>
<span class="n">Date</span> <span class="n">date</span> <span class="o">=</span> <span class="k">new</span> <span class="n">Date</span><span class="o">();</span>
<span class="n">map</span><span class="o">.</span><span class="na">put</span><span class="o">(</span><span class="n">date</span><span class="o">,</span> <span class="s">&quot;hello, world!&quot;</span><span class="o">);</span>
<span class="n">date</span><span class="o">.</span><span class="na">setTime</span><span class="o">(</span><span class="mi">12345L</span><span class="o">);</span>
<span class="k">assert</span> <span class="n">map</span><span class="o">.</span><span class="na">containsKey</span><span class="o">(</span><span class="n">date</span><span class="o">);</span> <span class="c1">// false</span></code></pre></figure><p>When modifying the state of <code>date</code> object, we&#39;re not expecting it to change its identity. We&#39;re not expecting to lose an entry in the map just because the state of its key is changed. However, this is exactly what is happening in the example above.</p><aside class='youtube'> <a href='https://www.youtube.com/watch?v=p7m7_iiqaHI'><div class='box'> <img src='https://i.ytimg.com/vi/p7m7_iiqaHI/mqdefault.jpg' alt='YouTube video #p7m7_iiqaHI'/><div class='play'><i class='icon icon-play'></i></div></div></a><div>How Much Immutability Is Enough?; 19 May 2016.</div></aside><p>When we add an object to the map, its <code>hashCode()</code> returns one value. This value is used by <a href="http://docs.oracle.com/javase/7/docs/api/java/util/HashMap.html"><code>HashMap</code></a> to place the entry into the internal hash table. When we call <code>containsKey()</code> hash code of the object is different (because it is based on its internal state) and <code>HashMap</code> can&#39;t find it in the internal hash table.</p><p>It is a very annoying and difficult to debug side effects of mutable objects. Immutable objects avoid it completely.</p><h2 id="failure-atomicity">Failure Atomicity</h2><p>Here is a simple example:</p><figure class="highlight"><pre><code class="language-java" data-lang="java"><span></span><span class="kd">public</span> <span class="kd">class</span> <span class="nc">Stack</span> <span class="o">{</span>
  <span class="kd">private</span> <span class="kt">int</span> <span class="n">size</span><span class="o">;</span>
  <span class="kd">private</span> <span class="n">String</span><span class="o">[]</span> <span class="n">items</span><span class="o">;</span>
  <span class="kd">public</span> <span class="kt">void</span> <span class="nf">push</span><span class="o">(</span><span class="n">String</span> <span class="n">item</span><span class="o">)</span> <span class="o">{</span>
    <span class="n">size</span><span class="o">++;</span>
    <span class="k">if</span> <span class="o">(</span><span class="n">size</span> <span class="o">&gt;</span> <span class="n">items</span><span class="o">.</span><span class="na">length</span><span class="o">)</span> <span class="o">{</span>
      <span class="k">throw</span> <span class="k">new</span> <span class="n">RuntimeException</span><span class="o">(</span><span class="s">&quot;stack overflow&quot;</span><span class="o">);</span>
    <span class="o">}</span>
    <span class="n">items</span><span class="o">[</span><span class="n">size</span><span class="o">]</span> <span class="o">=</span> <span class="n">item</span><span class="o">;</span>
  <span class="o">}</span>
<span class="o">}</span></code></pre></figure><p>It is obvious that an object of class <code>Stack</code> will be left in a broken state if it <a href="/2015/12/01/rethrow-exceptions.html">throws</a> a runtime exception on overflow. Its <code>size</code> property will be incremented, while <code>items</code> won&#39;t get a new element.</p><figure class='badge'><a href='http://amzn.to/2cs4aiR'><img src='https://www.yegor256.com/images/2014/06/effective-java-second-edition.png' style='width:100px;max-width:100%;' alt='badge'/></a></figure><p>Immutability prevents this problem. An object will never be left in a broken state because its state is modified only in its constructor. The constructor will either fail, rejecting object instantiation, or succeed, making a valid solid object, which never changes its encapsulated state.</p><p>For more on this subject, read <a href="http://amzn.to/2cs4aiR">Effective Java, 2nd Edition</a> by Joshua Bloch.</p><h2 id="arguments-against-immutability">Arguments Against Immutability</h2><p>There are a number of arguments against immutability.</p><ol> <li><p>&ldquo;Immutability is not for enterprise systems&rdquo;. Very often, I hear people say that immutability is a fancy feature, while absolutely impractical in real enterprise systems. As a counter-argument, I can only show some examples of real-life applications that contain only immutable Java objects: <a href="http://http.jcabi.com"><code>jcabi-http</code></a>, <a href="/2014/04/24/java-xml-parsing-and-traversing.html"><code>jcabi-xml</code></a>, <a href="/2014/05/14/object-oriented-github-java-sdk.html"><code>jcabi-github</code></a>, <a href="/2014/05/26/amazon-s3-java-oop-adapter.html"><code>jcabi-s3</code></a>, <a href="/2014/04/14/jcabi-dynamo-java-api-of-aws-dynamodb.html"><code>jcabi-dynamo</code></a>, <a href="/2014/04/29/w3c-java-validators.html"><code>jcabi-w3c</code></a>, <a href="/2014/08/18/fluent-jdbc-decorator.html"><code>jcabi-jdbc</code></a>, <a href="http://simpledb.jcabi.com"><code>jcabi-simpledb</code></a>, <a href="/2014/09/02/java-ssh-client.html"><code>jcabi-ssh</code></a>. The above are all Java libraries that work solely with immutable classes/objects. <a href="https://github.com/netbout/netbout">netbout.com</a> and <a href="/2014/12/04/synchronization-between-nodes.html">stateful.co</a> are web applications that work solely with immutable objects.</p></li> <li><p>&ldquo;It&#39;s cheaper to update an existing object than create a new one&rdquo;. Oracle <a href="http://docs.oracle.com/javase/tutorial/essential/concurrency/immutable.html">thinks</a> that &ldquo;The impact of object creation is often overestimated and can be offset by some of the efficiency associated with immutable objects. These include decreased overhead due to garbage collection, and the elimination of code needed to protect mutable objects from corruption.&rdquo; I agree.</p></li> </ol><p>If you have some other arguments, please post them below and I&#39;ll try to comment.</p><p>P.S. Check <a href="http://www.takes.org">takes.org</a>, a Java web framework that consists entirely of immutable objects.</p></p><nav class="buttons notranslate desktop-only"> <a href="http://www.facebook.com/sharer/sharer.php?u=https://www.yegor256.com/2014/06/09/objects-should-be-immutable.html" title="Share on Facebook" class="button" rel="nofollow"> <span class="count count-facebook">0</span> <i class="icon icon-facebook notranslate" aria-hidden="true"></i> </a> <a href="https://twitter.com/share?url=https://www.yegor256.com/2014/06/09/objects-should-be-immutable.html&amp;text=Objects+Should+Be+Immutable" title="Share on Twitter" class="button" rel="nofollow"> <span class="count count-twitter">0</span> <i class="icon icon-twitter notranslate" aria-hidden="true"></i> </a> <a href="https://plus.google.com/share?url=https://www.yegor256.com/2014/06/09/objects-should-be-immutable.html" title="Share on Google+" class="button" rel="nofollow"> <span class="count count-googleplus">0</span> <i class="icon icon-googleplus notranslate" aria-hidden="true"></i> </a> <a href="https://www.linkedin.com/cws/share?url=https://www.yegor256.com/2014/06/09/objects-should-be-immutable.html" title="Share on LinkedIn" class="button" rel="nofollow"> <span class="count count-linkedin">0</span> <i class="icon icon-linkedin notranslate" aria-hidden="true"></i> </a> <a href="http://reddit.com/submit?url=https://www.yegor256.com/2014/06/09/objects-should-be-immutable.html%3F2014-23&amp;title=Objects+Should+Be+Immutable" title="Share on Reddit" class="button" rel="nofollow"> <span class="count count-reddit">0</span> <i class="icon icon-reddit notranslate" aria-hidden="true"></i> </a> <a href="http://news.ycombinator.com/submitlink?u=https://www.yegor256.com/2014/06/09/objects-should-be-immutable.html%3F2014-23&amp;t=Objects+Should+Be+Immutable" title="Share on Hacker News" class="button" rel="nofollow"> <span class="count count-hackernews">0</span> <i class="icon icon-hackernews notranslate" aria-hidden="true"></i> </a> </nav> </header> <article class="main" itemprop="articleBody"><div ><p>In object-oriented programming, an object is <a href="http://en.wikipedia.org/wiki/Immutable_object">immutable</a> if its state can&#39;t be modified after it is created. In Java, a good example of an immutable <a href="/2016/07/14/who-is-object.html">object</a> is <a href="http://docs.oracle.com/javase/7/docs/api/java/lang/String.html"><code>String</code></a>. Once created, we can&#39;t modify its state. We can request that it creates new strings, but its own state will never change.</p><p>However, there are not so many immutable classes in JDK. Take, for example, class <a href="http://docs.oracle.com/javase/7/docs/api/java/util/Date.html"><code>Date</code></a>. It is possible to modify its state using <code>setTime()</code>.</p><aside class='youtube'> <a href='https://www.youtube.com/watch?v=KwP7Ay9Z-hc'><div class='box'> <img src='https://i.ytimg.com/vi/KwP7Ay9Z-hc/mqdefault.jpg' alt='YouTube video #KwP7Ay9Z-hc'/><div class='play'><i class='icon icon-play'></i></div></div></a><div>Immutable Objects vs. Common Sense (webinar #2); 6 May 2015.</div></aside><p>I don&#39;t know why the JDK designers decided to make these two very similar classes differently. However, I believe that the design of a mutable <code>Date</code> has many flaws, while the immutable <code>String</code> is much more in the spirit of the object-oriented paradigm.</p><p>Moreover, I think that <strong>all classes should be immutable in a perfect object-oriented world</strong>. Unfortunately, sometimes, it is technically not possible due to limitations in JVM. Nevertheless, we should always aim for the best.</p><p>This is an incomplete list of arguments in favor of immutability:</p><ul> <li>immutable objects are simpler to construct, test, and use</li> <li>truly immutable objects are always thread-safe</li> <li>they help to avoid <a href="/2015/12/08/temporal-coupling-between-method-calls.html">temporal coupling</a></li> <li>their usage is side-effect free (no defensive copies)</li> <li>identity mutability problem is avoided</li> <li>they always have failure atomicity</li> <li>they are much easier to cache</li> <li>they prevent NULL references, <a href="/2014/05/13/why-null-is-bad.html">which are bad</a></li></ul><p>Let&#39;s discuss the most important arguments one by one.</p><h2 id="thread-safety">Thread Safety</h2><p>The first and the most obvious argument is that immutable objects are thread-safe. This means that multiple threads can access the same object at the same time, without clashing with another thread.</p><figure class='badge'><a href='http://amzn.to/2bQVqBr'><img src='https://www.yegor256.com/images/2014/12/java-concurrency-in-practice.png' style='width:100px;max-width:100%;' alt='badge'/></a></figure><p>If no object methods can modify its state, no matter how many of them and how often are being called parallel---they will work in their own memory space in stack.</p><p>Goetz et al. explained the advantages of immutable objects in more details in their very famous book <a href="http://amzn.to/2bQVqBr">Java Concurrency in Practice</a> (highly recommended).</p><h2 id="avoiding-temporal-coupling">Avoiding Temporal Coupling</h2><p>Here is an example of temporal coupling (the code makes two consecutive HTTP POST requests, where the second one contains HTTP body):</p><figure class="highlight"><pre><code class="language-java" data-lang="java"><span></span><span class="n">Request</span> <span class="n">request</span> <span class="o">=</span> <span class="k">new</span> <span class="n">Request</span><span class="o">(</span><span class="s">&quot;http://localhost&quot;</span><span class="o">);</span>
<span class="n">request</span><span class="o">.</span><span class="na">method</span><span class="o">(</span><span class="s">&quot;POST&quot;</span><span class="o">);</span>
<span class="n">String</span> <span class="n">first</span> <span class="o">=</span> <span class="n">request</span><span class="o">.</span><span class="na">fetch</span><span class="o">();</span>
<span class="n">request</span><span class="o">.</span><span class="na">body</span><span class="o">(</span><span class="s">&quot;text=hello&quot;</span><span class="o">);</span>
<span class="n">String</span> <span class="n">second</span> <span class="o">=</span> <span class="n">request</span><span class="o">.</span><span class="na">fetch</span><span class="o">();</span></code></pre></figure><p>This code works. However, you must remember that the first request should be configured before the second one may happen. If we decide to remove the first request from the script, we will remove the second and the third line, and won&#39;t get any errors from the compiler:</p><figure class="highlight"><pre><code class="language-java" data-lang="java"><span></span><span class="n">Request</span> <span class="n">request</span> <span class="o">=</span> <span class="k">new</span> <span class="n">Request</span><span class="o">(</span><span class="s">&quot;http://localhost&quot;</span><span class="o">);</span>
<span class="c1">// request.method(&quot;POST&quot;);</span>
<span class="c1">// String first = request.fetch();</span>
<span class="n">request</span><span class="o">.</span><span class="na">body</span><span class="o">(</span><span class="s">&quot;text=hello&quot;</span><span class="o">);</span>
<span class="n">String</span> <span class="n">second</span> <span class="o">=</span> <span class="n">request</span><span class="o">.</span><span class="na">fetch</span><span class="o">();</span></code></pre></figure><p>Now, the script is broken although it compiled without errors. This is what <a href="/2015/12/08/temporal-coupling-between-method-calls.html">temporal coupling</a> is about---there is always some hidden information in the code that a programmer has to remember. In this example, we have to remember that the configuration for the first request is also used for the second one.</p><aside class='youtube'> <a href='https://www.youtube.com/watch?v=EnhRgXrHCC4'><div class='box'> <img src='https://i.ytimg.com/vi/EnhRgXrHCC4/mqdefault.jpg' alt='YouTube video #EnhRgXrHCC4'/><div class='play'><i class='icon icon-play'></i></div></div></a><div>How Immutability Helps in OOP (in Russian with English subtitles); 21 May 2016.</div></aside><p>We have to remember that the second request should always stay together and be executed after the first one.</p><p>If <code>Request</code> class were immutable, the first snippet wouldn&#39;t work in the first place, and would have been rewritten like:</p><figure class="highlight"><pre><code class="language-java" data-lang="java"><span></span><span class="kd">final</span> <span class="n">Request</span> <span class="n">request</span> <span class="o">=</span> <span class="k">new</span> <span class="n">Request</span><span class="o">(</span><span class="s">&quot;&quot;</span><span class="o">);</span>
<span class="n">String</span> <span class="n">first</span> <span class="o">=</span> <span class="n">request</span><span class="o">.</span><span class="na">method</span><span class="o">(</span><span class="s">&quot;POST&quot;</span><span class="o">).</span><span class="na">fetch</span><span class="o">();</span>
<span class="n">String</span> <span class="n">second</span> <span class="o">=</span> <span class="n">request</span><span class="o">.</span><span class="na">method</span><span class="o">(</span><span class="s">&quot;POST&quot;</span><span class="o">).</span><span class="na">body</span><span class="o">(</span><span class="s">&quot;text=hello&quot;</span><span class="o">).</span><span class="na">fetch</span><span class="o">();</span></code></pre></figure><p>Now, these two requests are not coupled. We can safely remove the first one, and the second one will still work correctly. You may point out that there is a code duplication. Yes, we should get rid of it and re-write the code:</p><figure class="highlight"><pre><code class="language-java" data-lang="java"><span></span><span class="kd">final</span> <span class="n">Request</span> <span class="n">request</span> <span class="o">=</span> <span class="k">new</span> <span class="n">Request</span><span class="o">(</span><span class="s">&quot;&quot;</span><span class="o">);</span>
<span class="kd">final</span> <span class="n">Request</span> <span class="n">post</span> <span class="o">=</span> <span class="n">request</span><span class="o">.</span><span class="na">method</span><span class="o">(</span><span class="s">&quot;POST&quot;</span><span class="o">);</span>
<span class="n">String</span> <span class="n">first</span> <span class="o">=</span> <span class="n">post</span><span class="o">.</span><span class="na">fetch</span><span class="o">();</span>
<span class="n">String</span> <span class="n">second</span> <span class="o">=</span> <span class="n">post</span><span class="o">.</span><span class="na">body</span><span class="o">(</span><span class="s">&quot;text=hello&quot;</span><span class="o">).</span><span class="na">fetch</span><span class="o">();</span></code></pre></figure><p>See, refactoring didn&#39;t break anything and we still don&#39;t have temporal coupling. The first request can be removed safely from the code without affecting the second one.</p><p>I hope this example demonstrates that the code manipulating immutable objects is more readable and maintainable, because it doesn&#39;t have <a href="/2015/12/08/temporal-coupling-between-method-calls.html">temporal coupling</a>.</p><h2 id="avoiding-side-effects">Avoiding Side Effects</h2><p>Let&#39;s try to use our <code>Request</code> class in a new method (now it is mutable):</p><figure class="highlight"><pre><code class="language-java" data-lang="java"><span></span><span class="kd">public</span> <span class="n">String</span> <span class="nf">post</span><span class="o">(</span><span class="n">Request</span> <span class="n">request</span><span class="o">)</span> <span class="o">{</span>
  <span class="n">request</span><span class="o">.</span><span class="na">method</span><span class="o">(</span><span class="s">&quot;POST&quot;</span><span class="o">);</span>
  <span class="k">return</span> <span class="n">request</span><span class="o">.</span><span class="na">fetch</span><span class="o">();</span>
<span class="o">}</span></code></pre></figure><p>Let&#39;s try to make two requests---the first with GET method and the second with POST:</p><figure class="highlight"><pre><code class="language-java" data-lang="java"><span></span><span class="n">Request</span> <span class="n">request</span> <span class="o">=</span> <span class="k">new</span> <span class="n">Request</span><span class="o">(</span><span class="s">&quot;http://localhost&quot;</span><span class="o">);</span>
<span class="n">request</span><span class="o">.</span><span class="na">method</span><span class="o">(</span><span class="s">&quot;GET&quot;</span><span class="o">);</span>
<span class="n">String</span> <span class="n">first</span> <span class="o">=</span> <span class="k">this</span><span class="o">.</span><span class="na">post</span><span class="o">(</span><span class="n">request</span><span class="o">);</span>
<span class="n">String</span> <span class="n">second</span> <span class="o">=</span> <span class="n">request</span><span class="o">.</span><span class="na">fetch</span><span class="o">();</span></code></pre></figure><p>Method <code>post()</code> has a &quot;side effect&quot;---it makes changes to the mutable object <code>request</code>. These changes are not really expected in this case. We expect it to make a POST request and return its body. We don&#39;t want to read its documentation just to find out that behind the scene it also modifies the request we&#39;re passing to it as an argument.</p><p>Needless to say, such side effects lead to bugs and maintainability issues. It would be much better to work with an immutable <code>Request</code>:</p><figure class="highlight"><pre><code class="language-java" data-lang="java"><span></span><span class="kd">public</span> <span class="n">String</span> <span class="nf">post</span><span class="o">(</span><span class="n">Request</span> <span class="n">request</span><span class="o">)</span> <span class="o">{</span>
  <span class="k">return</span> <span class="n">request</span><span class="o">.</span><span class="na">method</span><span class="o">(</span><span class="s">&quot;POST&quot;</span><span class="o">).</span><span class="na">fetch</span><span class="o">();</span>
<span class="o">}</span></code></pre></figure><p>In this case, we may not have any side effects. Nobody can modify our <code>request</code> object, no matter where it is used and how deep through the call stack it is passed by method calls:</p><figure class="highlight"><pre><code class="language-java" data-lang="java"><span></span><span class="n">Request</span> <span class="n">request</span> <span class="o">=</span> <span class="k">new</span> <span class="n">Request</span><span class="o">(</span><span class="s">&quot;http://localhost&quot;</span><span class="o">).</span><span class="na">method</span><span class="o">(</span><span class="s">&quot;GET&quot;</span><span class="o">);</span>
<span class="n">String</span> <span class="n">first</span> <span class="o">=</span> <span class="k">this</span><span class="o">.</span><span class="na">post</span><span class="o">(</span><span class="n">request</span><span class="o">);</span>
<span class="n">String</span> <span class="n">second</span> <span class="o">=</span> <span class="n">request</span><span class="o">.</span><span class="na">fetch</span><span class="o">();</span></code></pre></figure><p>This code is perfectly safe and side effect free.</p><h2 id="avoiding-identity-mutability">Avoiding Identity Mutability</h2><p>Very often, we want objects to be identical if their internal states are the same. <a href="http://docs.oracle.com/javase/7/docs/api/java/util/Date.html"><code>Date</code></a> class is a good example:</p><figure class="highlight"><pre><code class="language-java" data-lang="java"><span></span><span class="n">Date</span> <span class="n">first</span> <span class="o">=</span> <span class="k">new</span> <span class="n">Date</span><span class="o">(</span><span class="mi">1L</span><span class="o">);</span>
<span class="n">Date</span> <span class="n">second</span> <span class="o">=</span> <span class="k">new</span> <span class="n">Date</span><span class="o">(</span><span class="mi">1L</span><span class="o">);</span>
<span class="k">assert</span> <span class="n">first</span><span class="o">.</span><span class="na">equals</span><span class="o">(</span><span class="n">second</span><span class="o">);</span> <span class="c1">// true</span></code></pre></figure><p>There are two different objects; however, they are equal to each other because their encapsulated states are the same. This is made possible through their custom overloaded implementation of <code>equals()</code> and <code>hashCode()</code> methods.</p><p>The consequence of this convenient approach being used with mutable objects is that every time we modify object&#39;s state it changes its identity:</p><figure class="highlight"><pre><code class="language-java" data-lang="java"><span></span><span class="n">Date</span> <span class="n">first</span> <span class="o">=</span> <span class="k">new</span> <span class="n">Date</span><span class="o">(</span><span class="mi">1L</span><span class="o">);</span>
<span class="n">Date</span> <span class="n">second</span> <span class="o">=</span> <span class="k">new</span> <span class="n">Date</span><span class="o">(</span><span class="mi">1L</span><span class="o">);</span>
<span class="n">first</span><span class="o">.</span><span class="na">setTime</span><span class="o">(</span><span class="mi">2L</span><span class="o">);</span>
<span class="k">assert</span> <span class="n">first</span><span class="o">.</span><span class="na">equals</span><span class="o">(</span><span class="n">second</span><span class="o">);</span> <span class="c1">// false</span></code></pre></figure><p>This may look natural, until you start using your mutable objects as keys in maps:</p><figure class="highlight"><pre><code class="language-java" data-lang="java"><span></span><span class="n">Map</span><span class="o">&lt;</span><span class="n">Date</span><span class="o">,</span> <span class="n">String</span><span class="o">&gt;</span> <span class="n">map</span> <span class="o">=</span> <span class="k">new</span> <span class="n">HashMap</span><span class="o">&lt;&gt;();</span>
<span class="n">Date</span> <span class="n">date</span> <span class="o">=</span> <span class="k">new</span> <span class="n">Date</span><span class="o">();</span>
<span class="n">map</span><span class="o">.</span><span class="na">put</span><span class="o">(</span><span class="n">date</span><span class="o">,</span> <span class="s">&quot;hello, world!&quot;</span><span class="o">);</span>
<span class="n">date</span><span class="o">.</span><span class="na">setTime</span><span class="o">(</span><span class="mi">12345L</span><span class="o">);</span>
<span class="k">assert</span> <span class="n">map</span><span class="o">.</span><span class="na">containsKey</span><span class="o">(</span><span class="n">date</span><span class="o">);</span> <span class="c1">// false</span></code></pre></figure><p>When modifying the state of <code>date</code> object, we&#39;re not expecting it to change its identity. We&#39;re not expecting to lose an entry in the map just because the state of its key is changed. However, this is exactly what is happening in the example above.</p><aside class='youtube'> <a href='https://www.youtube.com/watch?v=p7m7_iiqaHI'><div class='box'> <img src='https://i.ytimg.com/vi/p7m7_iiqaHI/mqdefault.jpg' alt='YouTube video #p7m7_iiqaHI'/><div class='play'><i class='icon icon-play'></i></div></div></a><div>How Much Immutability Is Enough?; 19 May 2016.</div></aside><p>When we add an object to the map, its <code>hashCode()</code> returns one value. This value is used by <a href="http://docs.oracle.com/javase/7/docs/api/java/util/HashMap.html"><code>HashMap</code></a> to place the entry into the internal hash table. When we call <code>containsKey()</code> hash code of the object is different (because it is based on its internal state) and <code>HashMap</code> can&#39;t find it in the internal hash table.</p><p>It is a very annoying and difficult to debug side effects of mutable objects. Immutable objects avoid it completely.</p><h2 id="failure-atomicity">Failure Atomicity</h2><p>Here is a simple example:</p><figure class="highlight"><pre><code class="language-java" data-lang="java"><span></span><span class="kd">public</span> <span class="kd">class</span> <span class="nc">Stack</span> <span class="o">{</span>
  <span class="kd">private</span> <span class="kt">int</span> <span class="n">size</span><span class="o">;</span>
  <span class="kd">private</span> <span class="n">String</span><span class="o">[]</span> <span class="n">items</span><span class="o">;</span>
  <span class="kd">public</span> <span class="kt">void</span> <span class="nf">push</span><span class="o">(</span><span class="n">String</span> <span class="n">item</span><span class="o">)</span> <span class="o">{</span>
    <span class="n">size</span><span class="o">++;</span>
    <span class="k">if</span> <span class="o">(</span><span class="n">size</span> <span class="o">&gt;</span> <span class="n">items</span><span class="o">.</span><span class="na">length</span><span class="o">)</span> <span class="o">{</span>
      <span class="k">throw</span> <span class="k">new</span> <span class="n">RuntimeException</span><span class="o">(</span><span class="s">&quot;stack overflow&quot;</span><span class="o">);</span>
    <span class="o">}</span>
    <span class="n">items</span><span class="o">[</span><span class="n">size</span><span class="o">]</span> <span class="o">=</span> <span class="n">item</span><span class="o">;</span>
  <span class="o">}</span>
<span class="o">}</span></code></pre></figure><p>It is obvious that an object of class <code>Stack</code> will be left in a broken state if it <a href="/2015/12/01/rethrow-exceptions.html">throws</a> a runtime exception on overflow. Its <code>size</code> property will be incremented, while <code>items</code> won&#39;t get a new element.</p><figure class='badge'><a href='http://amzn.to/2cs4aiR'><img src='https://www.yegor256.com/images/2014/06/effective-java-second-edition.png' style='width:100px;max-width:100%;' alt='badge'/></a></figure><p>Immutability prevents this problem. An object will never be left in a broken state because its state is modified only in its constructor. The constructor will either fail, rejecting object instantiation, or succeed, making a valid solid object, which never changes its encapsulated state.</p><p>For more on this subject, read <a href="http://amzn.to/2cs4aiR">Effective Java, 2nd Edition</a> by Joshua Bloch.</p><h2 id="arguments-against-immutability">Arguments Against Immutability</h2><p>There are a number of arguments against immutability.</p><ol> <li><p>&ldquo;Immutability is not for enterprise systems&rdquo;. Very often, I hear people say that immutability is a fancy feature, while absolutely impractical in real enterprise systems. As a counter-argument, I can only show some examples of real-life applications that contain only immutable Java objects: <a href="http://http.jcabi.com"><code>jcabi-http</code></a>, <a href="/2014/04/24/java-xml-parsing-and-traversing.html"><code>jcabi-xml</code></a>, <a href="/2014/05/14/object-oriented-github-java-sdk.html"><code>jcabi-github</code></a>, <a href="/2014/05/26/amazon-s3-java-oop-adapter.html"><code>jcabi-s3</code></a>, <a href="/2014/04/14/jcabi-dynamo-java-api-of-aws-dynamodb.html"><code>jcabi-dynamo</code></a>, <a href="/2014/04/29/w3c-java-validators.html"><code>jcabi-w3c</code></a>, <a href="/2014/08/18/fluent-jdbc-decorator.html"><code>jcabi-jdbc</code></a>, <a href="http://simpledb.jcabi.com"><code>jcabi-simpledb</code></a>, <a href="/2014/09/02/java-ssh-client.html"><code>jcabi-ssh</code></a>. The above are all Java libraries that work solely with immutable classes/objects. <a href="https://github.com/netbout/netbout">netbout.com</a> and <a href="/2014/12/04/synchronization-between-nodes.html">stateful.co</a> are web applications that work solely with immutable objects.</p></li> <li><p>&ldquo;It&#39;s cheaper to update an existing object than create a new one&rdquo;. Oracle <a href="http://docs.oracle.com/javase/tutorial/essential/concurrency/immutable.html">thinks</a> that &ldquo;The impact of object creation is often overestimated and can be offset by some of the efficiency associated with immutable objects. These include decreased overhead due to garbage collection, and the elimination of code needed to protect mutable objects from corruption.&rdquo; I agree.</p></li> </ol><p>If you have some other arguments, please post them below and I&#39;ll try to comment.</p><p>P.S. Check <a href="http://www.takes.org">takes.org</a>, a Java web framework that consists entirely of immutable objects.</p></div></article></div><div class="wrapper"><div class="unprintable"> <hr/><p>If you like this article, you will definitely like these <strong>very relevant</strong> posts too:</p><p><a href='/2014/12/22/immutable-objects-not-dumb.html'><strong>Immutable Objects Are Not Dumb</strong></a> <br/>Immutable objects are not the same as passive data structures without setters, despite a very common mis-belief.</p><p><a href='/2014/12/09/immutable-object-state-and-behavior.html'><strong>How an Immutable Object Can Have State and Behavior?</strong></a> <br/>Object state and behavior are two very different things, and confusing the two often leads to incorrect design.</p><p><a href='/2016/09/07/gradients-of-immutability.html'><strong>Gradients of Immutability</strong></a> <br/>There are a few levels and forms of immutability in object-oriented programming, all of which can be used when they seem appropriate.</p></div></div><div class="disqus" role="complementary"><p class="disqus_hint"> Please, use <a href="https://help.disqus.com/commenting/what-html-tags-are-allowed-within-comments">syntax highlighting</a> in your comments, to make them more readable.</p><div id="disqus_thread" class="disqus-thread"> <a>&nbsp;</a></div><script> var disqus_config = function () { this.page.url = document.location.href.split('?')[0].split('#')[0].replace('https://', 'http://'); this.page.identifier = this.page.url; }; (function() { var d = document, s = d.createElement('script'); s.src = '//yegor256.disqus.com/embed.js'; s.setAttribute('data-timestamp', +new Date()); (d.head || d.body).appendChild(s); })(); </script> <noscript><div><p class="red"> JavaScript is disabled in your browser, that's why you can't see comments under this post.</p></div></noscript></div><div class="wrapper"> <footer class="footer"><p> &copy; <span itemscope="" itemprop="copyrightHolder" itemtype="http://schema.org/Person"> <span itemprop="name">Yegor Bugayenko</span> </span> 2014&ndash;<span itemprop="copyrightYear">2018</span></p></footer></div></section><div class="wrapper unprintable" style="text-align:center;margin-top:2em;"> <a href="http://www.sixnines.io/h/3ba1652f"> <img src="//www.sixnines.io/b/3ba1652f?style=flat" alt="sixnines availability badge"/> </a></div><script src="//code.jquery.com/jquery-1.9.0.min.js"></script> <script src="/js/all.js?a0e0d018c07"></script> <script>var disqus_shortname = 'yegor256';</script> <script id="dsq-count-scr" src="//yegor256.disqus.com/count.js" async="async"></script> <script> (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){ (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o), m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m) })(window,document,'script','//www.google-analytics.com/analytics.js','ga'); ga('create', 'UA-1963507-32', 'auto'); ga('send', 'pageview'); </script> <script> Cd=document;Cr="&"+Math.random();Cp="&s=1"; Cd.cookie="b=b";if(Cd.cookie)Cp+="&c=1"; Cp+="&t="+(new Date()).getTimezoneOffset(); if(self!=top)Cp+="&f=1"; </script> <script> if(navigator.javaEnabled())Cp+="&j=1"; </script> <script> if(typeof(screen)!='undefined')Cp+="&w="+screen.width+"&h="+ screen.height+"&d="+(screen.colorDepth?screen.colorDepth:screen.pixelDepth); </script> <script> Cd.write("<img src='//c.hit.ua/hit?i=95870&g=0&x=2"+Cp+Cr+ "&r="+escape(Cd.referrer)+"&u="+escape(window.location.href)+ "' border='0' wi"+"dth='1' he"+"ight='1'/>"); </script> <script type="application/ld+json"> { "@context": "http://schema.org", "@type": "Person", "name": "Yegor Bugayenko", "url": "http://www.yegor256.com", "sameAs": [ "https://www.facebook.com/yegor256", "https://instagram.com/yegor256", "https://www.linkedin.com/in/yegor256", "https://twitter.com/yegor256", "https://github.com/yegor256", "https://www.pinterest.com/yegor256/" ] } </script> </body> </html> <!DOCTYPE html> <html xmlns="http://www.w3.org/1999/xhtml" lang="en-US" xml:lang="en-US" itemscope="" itemtype="http://schema.org/WebSite"> <head> <meta charset="utf-8"/> <meta name="description" content="Why NULL is a terrible practice in object-oriented programming? Despite the fact that it is used a lot and everywhere, this article tries to explain why you should give up this bad habit. " /> <meta name="keywords" content="null c++, null is bad, null is evil, null java, null pointer, null reference" /> <meta name="viewport" content="width=device-width,minimum-scale=1,initial-scale=1"/> <meta name="google-site-verification" content="JEj_gQr2CPe2QKGw8XdMz0R7VboQIUbX3FlM-lwTq-8" /> <meta name="author" content="Yegor Bugayenko"> <meta name="article:published_time" content="2014-05-13 00:00:00 +0000"> <meta name="og:site_name" content="Yegor Bugayenko"/> <meta name="og:type" content="article" /> <meta name="og:locale" content="en_US" /> <meta name="twitter:account_id" content="4503599630178231" /> <meta name="twitter:creator" content="@yegor256"/> <meta name="twitter:site" content="@yegor256"/> <meta name="twitter:title" property="og:title" content="Why NULL is Bad?"/> <meta name="twitter:description" property="og:description" content="Why NULL is a terrible practice in object-oriented programming? Despite the fact that it is used a lot and everywhere, this article tries to explain why you should give up this bad habit. "/> <meta name="twitter:url" property="og:url" content="https://www.yegor256.com/2014/05/13/why-null-is-bad.html"/> <meta name="telegram:channel" content="AAAAAEJFMRzsRTRxM3ec6A"/> <link rel="search" type="application/opensearchdescription+xml" href="/opensearch.xml" title="yegor256" /> <link rel="shortcut icon" href="/favicon.ico?a0e0d018c07"/> <link rel="apple-touch-icon" href="/favicon.ico?a0e0d018c07"/> <link rel="alternate" type="application/rss+xml" title="RSS for yegor256.com" href="https://www.yegor256.com/rss.xml"/> <link rel="stylesheet" href="/css/layout.css?a0e0d018c07"/> <link rel="stylesheet" href="/css/icons.css?a0e0d018c07"/> <link rel="canonical" href="https://www.yegor256.com/2014/05/13/why-null-is-bad.html" /> <link rel="amphtml" href="https://www.yegor256.com/2014/05/13/why-null-is-bad.amp.html" /> <title>Why NULL is Bad? </title> </head> <body><div class="wrapper"> <aside class="header-toggle unprintable" id="header-toggle" title="Show the menu" onclick="$('#header').show();$('#header-toggle').hide();">&#9776;</aside> <header class="header" id="header"><div class="face"> <a href="/about-me.html#form" class="sub" title="Click to subscribe to my monthly newsletter"><span>Subscribe</span></a> <a href="/about-me.html" style="position:relative;"> <img src="/images/face-256x256.jpg" class="photo" alt="Yegor Bugayenko"/> </a></div><nav><ul class="menu social notranslate"> <li><a href="https://twitter.com/intent/follow?screen_name=yegor256" rel="nofollow" title="Follow me on Twitter"><i class="icon icon-twitter notranslate" aria-hidden="true"></i></a></li> <li><a href="/rss.xml" rel="nofollow" title="Subscribe to my RSS feed"><i class="icon icon-rss notranslate" aria-hidden="true"></i></a></li> <li><a itemprop="sameAs" href="https://github.com/yegor256" rel="nofollow" title="My GitHub profile"><i class="icon icon-github notranslate" aria-hidden="true"></i></a></li> <li><a itemprop="sameAs" href="http://stackoverflow.com/users/187141/yegor256" rel="nofollow" title="My StackOverflow profile"><i class="icon icon-stackoverflow notranslate" aria-hidden="true"></i></a></li> <li><a itemprop="sameAs" href="https://www.facebook.com/yegor256" rel="nofollow" title="Follow me on Facebook"><i class="icon icon-facebook notranslate" aria-hidden="true"></i></a></li> <li><a itemprop="sameAs" href="https://instagram.com/yegor256" rel="nofollow" title="Follow me on Instagram"><i class="icon icon-instagram notranslate" aria-hidden="true"></i></a></li> <li><a itemprop="sameAs" href="https://www.linkedin.com/in/yegor256" rel="nofollow" title="My LinkedIn profile"><i class="icon icon-linkedin notranslate" aria-hidden="true"></i></a></li> <li><a itemprop="sameAs" href="https://www.youtube.com/c/yegor256?sub_confirmation=1" rel="nofollow" title="My Youtube video channel"><i class="icon icon-youtube notranslate" aria-hidden="true"></i></a></li> <li><a itemprop="sameAs" href="https://www.pinterest.com/yegor256/" rel="nofollow" title="My Pinterest boards"><i class="icon icon-pinterest notranslate" aria-hidden="true"></i></a></li> <li><a itemprop="sameAs" href="https://angel.co/yegor256" rel="nofollow" title="My AngelList profile"><i class="icon icon-angellist notranslate" aria-hidden="true"></i></a></li> <li><a href="https://soundcloud.com/yegor256" rel="nofollow" title="My podcast"><i class="icon icon-podcast notranslate" aria-hidden="true"></i></a></li> <li><a href="https://itunes.apple.com/us/podcast/yegor256-podcast/id1150826721" rel="nofollow" title="My iTunes podcast"><i class="icon icon-itunes notranslate" aria-hidden="true"></i></a></li> <li><a href="https://t.me/joinchat/AAAAAEJFMRzsRTRxM3ec6A" rel="nofollow" title="My Telegram public channel"><i class="icon icon-telegram notranslate" aria-hidden="true"></i></a></li> <li><a href="mailto:blog@yegor256.com" rel="nofollow" title="Email me any time"><i class="icon icon-mail notranslate" aria-hidden="true"></i></a></li></ul><ul class="menu"> <li><a href="/" title="Home page">Home</a></li> <li ><a href="/best.html" title="Best articles to read">12&#160;Best</a></li> <li ><a href="/contents.html" title="The contents of the entire blog">All&#160;288</a></li> <li ><a href="/webinars.html" title="My webinars">Webinars</a></li> <li ><a href="/talks.html" title="Future and past conference talks">Talks</a></li> <li ><a href="/books.html" title="The books I wrote">Books</a></li> <li ><a href="/papers.html" title="My academic papers and patents">Papers</a></li> <li ><a href="/pets.html" title="My loved pet projects">Pets</a></li> <li ><a href="/award.html" title="Software quality award">Award</a></li> <li ><a href="/testimonials.html" title="What some people say about me">Testimonials</a></li> <li ><a href="/shift-m.html" title="Audio podcast about project management">Shift-M</a></li> <li ><a href="/paintings.html" title="My paintings for sale">Paintings</a></li> <li><a href="http://ru.yegor256.com/" title="Немного на русском языке">По-русски</a></li></ul></nav><div class="search"> <form method="get" action="https://www.google.com/search" itemprop="potentialAction" itemscope="" itemtype="http://schema.org/SearchAction"> <meta itemprop="target" content="https://www.google.com/search?q={q}"/> <input name="sitesearch" value="yegor256.com" type="hidden"/> <input itemprop="query-input" type="text" id="search-query" class="field field-text" required="required" onfocus="$('.google').css('visibility', 'visible');" name="q" placeholder="Search..." autocomplete="off"/> <input type="image" src="/images/google-search-icon.svg" class="google" title="Search via Google" alt="Search via Google"/> </form></div><div class="hot"><ul> <li> <a href="/code-ahead.html">Code Ahead</a> was published on Amazon just a few days ago! It is my new book, a novel about programmers. It explains in details the majority of ideas that stand behind <a href="https://www.zerocracy.com">Zerocracy</a> and <a href="https://www.xdsd.org">XDSD</a>. </li> <li> At <a href="/webinars.html">Webinar #37</a> we will discuss naming problem in OOP, for objects, methods and attributes; join us on <b>September 12</b>, at 11am PST. </li></ul></div></header></div><section itemscope="" itemtype="http://schema.org/BlogPosting"><div class="wrapper"> <header><p class="printable"> <img src="https://api.qrserver.com/v1/create-qr-code/?data=https://www.yegor256.com/2014/05/13/why-null-is-bad.html&amp;format=svg" style="width:125px;height:125px;" alt="QR code"/></p><p class="printable"> <code itemprop="url">https://www.yegor256.com/2014/05/13/why-null-is-bad.html</code></p><h1 itemprop="name headline mainEntityOfPage">Why NULL is Bad?</h1><aside class='book'><a href='http://amzn.to/2qFt4Tn'><img src='/images/books/elegant-objects/cover.png' class='book-cover' alt='book cover'/></a>Read more about this subject in <a href='http://amzn.to/2qFt4Tn'>Section&nbsp;2.6</a><br/> of my book<a href='http://amzn.to/2qFt4Tn'><img src='/images/books/amazon-buy-button.png' class='amazon-button' alt='Click to buy'/></a></aside><ul class="subline"> <li> <time itemprop="datePublished" datetime="2014-05-13T00:00:00+00:00"> 13 May 2014 </time> </li> <li class="printable" itemscope="" itemprop="author" itemtype="http://schema.org/Person"> <span itemprop="name">Yegor Bugayenko</span> </li> <li class="unprintable"> <i class="icon icon-comments"></i> <a href="http://www.yegor256.com/2014/05/13/why-null-is-bad.html#disqus_thread" itemprop="discussionUrl">comments</a> </li></ul><ul class="unprintable subline"> <li>Translated:</li> <li><a href="http://tbd.kaitoy.xyz/2015/07/26/why-null-is-bad/">Japanese</a></li> <li><a href="mailto:translate@yegor256.com">add yours!</a></li></ul><p class="unprintable"><p>A simple example of <code>NULL</code> usage in Java:</p><figure class="highlight"><pre><code class="language-java" data-lang="java"><span></span><span class="kd">public</span> <span class="n">Employee</span> <span class="nf">getByName</span><span class="o">(</span><span class="n">String</span> <span class="n">name</span><span class="o">)</span> <span class="o">{</span>
  <span class="kt">int</span> <span class="n">id</span> <span class="o">=</span> <span class="n">database</span><span class="o">.</span><span class="na">find</span><span class="o">(</span><span class="n">name</span><span class="o">);</span>
  <span class="k">if</span> <span class="o">(</span><span class="n">id</span> <span class="o">==</span> <span class="mi">0</span><span class="o">)</span> <span class="o">{</span>
    <span class="k">return</span> <span class="kc">null</span><span class="o">;</span>
  <span class="o">}</span>
  <span class="k">return</span> <span class="k">new</span> <span class="n">Employee</span><span class="o">(</span><span class="n">id</span><span class="o">);</span>
<span class="o">}</span></code></pre></figure><p>What is wrong with this method?</p><p>It may return <code>NULL</code> instead of an object---that&#39;s what is wrong. <code>NULL</code> is a terrible practice in an object-oriented paradigm and should be avoided at <a href="/2016/03/22/try-finally-if-not-null.html">all costs</a>. There have been a number of opinions about this published already, including <a href="http://www.infoq.com/presentations/Null-References-The-Billion-Dollar-Mistake-Tony-Hoare">Null References, The Billion Dollar Mistake</a> presentation by Tony Hoare and the entire <a href="http://amzn.to/266oJr4">Object Thinking</a> book by David West.</p><p>Here, I&#39;ll try to summarize all the arguments and show examples of how <code>NULL</code> usage can be avoided and replaced with proper object-oriented constructs.</p><p>Basically, there are two possible alternatives to <code>NULL</code>.</p><p>The first one is <strong><a href="http://en.wikipedia.org/wiki/Null_Object_pattern">Null Object</a></strong> design <a href="/2016/02/03/design-patterns-and-anti-patterns.html">pattern</a> (the best way is to make it a constant):</p><figure class="highlight"><pre><code class="language-java" data-lang="java"><span></span><span class="kd">public</span> <span class="n">Employee</span> <span class="nf">getByName</span><span class="o">(</span><span class="n">String</span> <span class="n">name</span><span class="o">)</span> <span class="o">{</span>
  <span class="kt">int</span> <span class="n">id</span> <span class="o">=</span> <span class="n">database</span><span class="o">.</span><span class="na">find</span><span class="o">(</span><span class="n">name</span><span class="o">);</span>
  <span class="k">if</span> <span class="o">(</span><span class="n">id</span> <span class="o">==</span> <span class="mi">0</span><span class="o">)</span> <span class="o">{</span>
    <span class="k">return</span> <span class="n">Employee</span><span class="o">.</span><span class="na">NOBODY</span><span class="o">;</span>
  <span class="o">}</span>
  <span class="k">return</span> <span class="n">Employee</span><span class="o">(</span><span class="n">id</span><span class="o">);</span>
<span class="o">}</span></code></pre></figure><p>The second possible alternative is to <a href="/2015/08/25/fail-fast.html">fail fast</a> by throwing an <strong>Exception</strong> when you can&#39;t return an <a href="/2016/07/14/who-is-object.html">object</a>:</p><figure class="highlight"><pre><code class="language-java" data-lang="java"><span></span><span class="kd">public</span> <span class="n">Employee</span> <span class="nf">getByName</span><span class="o">(</span><span class="n">String</span> <span class="n">name</span><span class="o">)</span> <span class="o">{</span>
  <span class="kt">int</span> <span class="n">id</span> <span class="o">=</span> <span class="n">database</span><span class="o">.</span><span class="na">find</span><span class="o">(</span><span class="n">name</span><span class="o">);</span>
  <span class="k">if</span> <span class="o">(</span><span class="n">id</span> <span class="o">==</span> <span class="mi">0</span><span class="o">)</span> <span class="o">{</span>
    <span class="k">throw</span> <span class="k">new</span> <span class="n">EmployeeNotFoundException</span><span class="o">(</span><span class="n">name</span><span class="o">);</span>
  <span class="o">}</span>
  <span class="k">return</span> <span class="n">Employee</span><span class="o">(</span><span class="n">id</span><span class="o">);</span>
<span class="o">}</span></code></pre></figure><p>Now, let&#39;s see the arguments against <code>NULL</code>.</p><p>Besides Tony Hoare&#39;s presentation and David West&#39;s book mentioned above, I read these publications before writing this post: <a href="http://www.amazon.com/dp/0132350882/">Clean Code</a> by Robert Martin, <a href="http://www.amazon.com/dp/0735619670/">Code Complete</a> by Steve McConnell, <a href="http://elegantcode.com/2010/05/01/say-no-to-null/">Say &quot;No&quot; to &quot;Null&quot;</a> by John Sonmez, <a href="http://stackoverflow.com/questions/1274792/is-returning-null-bad-design">Is returning null bad design?</a> discussion at StackOverflow.</p><h2 id="ad-hoc-error-handling">Ad-hoc Error Handling</h2><p>Every time you get an object as an input you must check whether it is <code>NULL</code> or a valid object reference. If you forget to check, a <a href="http://docs.oracle.com/javase/7/docs/api/java/lang/NullPointerException.html"><code>NullPointerException</code></a> (NPE) may break execution in runtime. Thus, your logic becomes polluted with multiple checks and if/then/else forks:</p><figure class="highlight"><pre><code class="language-java" data-lang="java"><span></span><span class="c1">// this is a terrible design, don&#39;t reuse</span>
<span class="n">Employee</span> <span class="n">employee</span> <span class="o">=</span> <span class="n">dept</span><span class="o">.</span><span class="na">getByName</span><span class="o">(</span><span class="s">&quot;Jeffrey&quot;</span><span class="o">);</span>
<span class="k">if</span> <span class="o">(</span><span class="n">employee</span> <span class="o">==</span> <span class="kc">null</span><span class="o">)</span> <span class="o">{</span>
  <span class="n">System</span><span class="o">.</span><span class="na">out</span><span class="o">.</span><span class="na">println</span><span class="o">(</span><span class="s">&quot;can&#39;t find an employee&quot;</span><span class="o">);</span>
  <span class="n">System</span><span class="o">.</span><span class="na">exit</span><span class="o">(-</span><span class="mi">1</span><span class="o">);</span>
<span class="o">}</span> <span class="k">else</span> <span class="o">{</span>
  <span class="n">employee</span><span class="o">.</span><span class="na">transferTo</span><span class="o">(</span><span class="n">dept2</span><span class="o">);</span>
<span class="o">}</span></code></pre></figure><p>This is how exceptional situations are supposed to be handled in <a href="http://en.wikipedia.org/wiki/C_%28programming_language%29">C</a> and other imperative procedural languages. OOP introduced <a href="http://en.wikipedia.org/wiki/Exception_handling">exception handling</a> primarily to get rid of these ad-hoc error handling blocks. In OOP, we let exceptions bubble up until they reach an application-wide error handler and our code becomes much cleaner and shorter:</p><figure class="highlight"><pre><code class="language-java" data-lang="java"><span></span><span class="n">dept</span><span class="o">.</span><span class="na">getByName</span><span class="o">(</span><span class="s">&quot;Jeffrey&quot;</span><span class="o">).</span><span class="na">transferTo</span><span class="o">(</span><span class="n">dept2</span><span class="o">);</span></code></pre></figure><p>Consider <code>NULL</code> references an inheritance of procedural programming, and use 1) Null Objects or 2) Exceptions instead.</p><h2 id="ambiguous-semantic">Ambiguous Semantic</h2><p>In order to explicitly convey its meaning, the function <code>getByName()</code> has to be named <code>getByNameOrNullIfNotFound()</code>. The same should happen with every function that returns an object or <code>NULL</code>. Otherwise, ambiguity is inevitable for a code reader. Thus, to keep semantic unambiguous, you should give longer names to functions.</p><p>To get rid of this ambiguity, always return a real object, a null object or <a href="/2015/12/01/rethrow-exceptions.html">throw</a> an exception.</p><p>Some may argue that we sometimes have to return <code>NULL</code>, for the sake of performance. For example, method <code>get()</code> of interface <a href="http://docs.oracle.com/javase/7/docs/api/java/util/Map.html"><code>Map</code></a> in Java returns <code>NULL</code> when there is no such item in the map:</p><figure class="highlight"><pre><code class="language-java" data-lang="java"><span></span><span class="n">Employee</span> <span class="n">employee</span> <span class="o">=</span> <span class="n">employees</span><span class="o">.</span><span class="na">get</span><span class="o">(</span><span class="s">&quot;Jeffrey&quot;</span><span class="o">);</span>
<span class="k">if</span> <span class="o">(</span><span class="n">employee</span> <span class="o">==</span> <span class="kc">null</span><span class="o">)</span> <span class="o">{</span>
  <span class="k">throw</span> <span class="k">new</span> <span class="n">EmployeeNotFoundException</span><span class="o">();</span>
<span class="o">}</span>
<span class="k">return</span> <span class="n">employee</span><span class="o">;</span></code></pre></figure><p>This code searches the map only once due to the usage of <code>NULL</code> in <code>Map</code>. If we would refactor <code>Map</code> so that its method <code>get()</code> will throw an exception if nothing is found, our code will look like this:</p><figure class="highlight"><pre><code class="language-java" data-lang="java"><span></span><span class="k">if</span> <span class="o">(!</span><span class="n">employees</span><span class="o">.</span><span class="na">containsKey</span><span class="o">(</span><span class="s">&quot;Jeffrey&quot;</span><span class="o">))</span> <span class="o">{</span> <span class="c1">// first search</span>
  <span class="k">throw</span> <span class="k">new</span> <span class="n">EmployeeNotFoundException</span><span class="o">();</span>
<span class="o">}</span>
<span class="k">return</span> <span class="n">employees</span><span class="o">.</span><span class="na">get</span><span class="o">(</span><span class="s">&quot;Jeffrey&quot;</span><span class="o">);</span> <span class="c1">// second search</span></code></pre></figure><p>Obviously, this is method is twice as slow as the first one. What to do?</p><p>The <code>Map</code> interface (no offense to its authors) has a design flaw. Its method <code>get()</code> should have been returning an <a href="/2015/04/30/iterating-adapter.html"><code>Iterator</code></a> so that our code would look like:</p><figure class="highlight"><pre><code class="language-java" data-lang="java"><span></span><span class="n">Iterator</span> <span class="n">found</span> <span class="o">=</span> <span class="n">Map</span><span class="o">.</span><span class="na">search</span><span class="o">(</span><span class="s">&quot;Jeffrey&quot;</span><span class="o">);</span>
<span class="k">if</span> <span class="o">(!</span><span class="n">found</span><span class="o">.</span><span class="na">hasNext</span><span class="o">())</span> <span class="o">{</span>
  <span class="k">throw</span> <span class="k">new</span> <span class="n">EmployeeNotFoundException</span><span class="o">();</span>
<span class="o">}</span>
<span class="k">return</span> <span class="n">found</span><span class="o">.</span><span class="na">next</span><span class="o">();</span></code></pre></figure><p>BTW, that is exactly how C++ STL <a href="http://en.cppreference.com/w/cpp/container/map/find">map::find()</a> method is designed.</p><h2 id="computer-thinking-vs-object-thinking">Computer Thinking vs. Object Thinking</h2><p>Statement <code>if (employee == null)</code> is understood by someone who knows that an object in Java is a pointer to a data structure and that <code>NULL</code> is a pointer to nothing (<code>0x00000000</code>, in Intel x86 processors).</p><p>However, if you start thinking as an object, this statement makes much less sense. This is how our code looks from an object point of view:</p><figure class="highlight"><pre><code class="language-text" data-lang="text"><span></span>- Hello, is it a software department?
- Yes.
- Let me talk to your employee &quot;Jeffrey&quot; please.
- Hold the line please...
- Hello.
- Are you NULL?</code></pre></figure><p>The last question in this conversation sounds weird, doesn&#39;t it?</p><p>Instead, if they hang up the phone after our request to speak to Jeffrey, that causes a problem for us (Exception). At that point, we try to call again or inform our supervisor that we can&#39;t reach Jeffrey and complete a bigger transaction.</p><p>Alternatively, they may let us speak to another person, who is not Jeffrey, but who can help with most of our questions or refuse to help if we need something &quot;Jeffrey specific&quot; (Null Object).</p><h2 id="slow-failing">Slow Failing</h2><p>Instead of <a href="http://martinfowler.com/ieeeSoftware/failFast.pdf">failing fast</a>, the code above attempts to die slowly, killing others on its way. Instead of letting everyone know that something went wrong and that an exception handling should start immediately, it is hiding this failure from its client.</p><p>This argument is close to the &quot;ad-hoc error handling&quot; discussed above.</p><p>It is a good practice to make your code as fragile as possible, letting it break when necessary.</p><aside class='youtube'> <a href='https://www.youtube.com/watch?v=o3aNJX7AP3M'><div class='box'> <img src='https://i.ytimg.com/vi/o3aNJX7AP3M/mqdefault.jpg' alt='YouTube video #o3aNJX7AP3M'/><div class='play'><i class='icon icon-play'></i></div></div></a><div>What is Wrong About NULL in OOP? (webinar #3); 3 June 2015.</div></aside><p>Make your methods extremely demanding as to the data they manipulate. Let them complain by throwing exceptions, if the provided data provided is not sufficient or simply doesn&#39;t fit with the main usage scenario of the method.</p><p>Otherwise, return a Null Object, that exposes some common behavior and throws exceptions on all other calls:</p><figure class="highlight"><pre><code class="language-java" data-lang="java"><span></span><span class="kd">public</span> <span class="n">Employee</span> <span class="nf">getByName</span><span class="o">(</span><span class="n">String</span> <span class="n">name</span><span class="o">)</span> <span class="o">{</span>
  <span class="kt">int</span> <span class="n">id</span> <span class="o">=</span> <span class="n">database</span><span class="o">.</span><span class="na">find</span><span class="o">(</span><span class="n">name</span><span class="o">);</span>
  <span class="n">Employee</span> <span class="n">employee</span><span class="o">;</span>
  <span class="k">if</span> <span class="o">(</span><span class="n">id</span> <span class="o">==</span> <span class="mi">0</span><span class="o">)</span> <span class="o">{</span>
    <span class="n">employee</span> <span class="o">=</span> <span class="k">new</span> <span class="n">Employee</span><span class="o">()</span> <span class="o">{</span>
      <span class="nd">@Override</span>
      <span class="kd">public</span> <span class="n">String</span> <span class="nf">name</span><span class="o">()</span> <span class="o">{</span>
        <span class="k">return</span> <span class="s">&quot;anonymous&quot;</span><span class="o">;</span>
      <span class="o">}</span>
      <span class="nd">@Override</span>
      <span class="kd">public</span> <span class="kt">void</span> <span class="nf">transferTo</span><span class="o">(</span><span class="n">Department</span> <span class="n">dept</span><span class="o">)</span> <span class="o">{</span>
        <span class="k">throw</span> <span class="k">new</span> <span class="n">AnonymousEmployeeException</span><span class="o">(</span>
          <span class="s">&quot;I can&#39;t be transferred, I&#39;m anonymous&quot;</span>
        <span class="o">);</span>
      <span class="o">}</span>
    <span class="o">};</span>
  <span class="o">}</span> <span class="k">else</span> <span class="o">{</span>
    <span class="n">employee</span> <span class="o">=</span> <span class="n">Employee</span><span class="o">(</span><span class="n">id</span><span class="o">);</span>
  <span class="o">}</span>
  <span class="k">return</span> <span class="n">employee</span><span class="o">;</span>
<span class="o">}</span></code></pre></figure> <blockquote class="twitter-tweet" data-lang="en"><p lang="en" dir="ltr">Say, you are designing a method findUserByName(), which has to find a user in the database. What would you return if nothing is found? <a href="https://twitter.com/hashtag/elegantobjects?src=hash&amp;ref_src=twsrc%5Etfw">#elegantobjects</a></p>--- Yegor Bugayenko (@yegor256) <a href="https://twitter.com/yegor256/status/990459955818979329?ref_src=twsrc%5Etfw">April 29, 2018</a></blockquote> <script async src="https://platform.twitter.com/widgets.js" charset="utf-8"></script><h2 id="mutable-and-incomplete-objects">Mutable and Incomplete Objects</h2><p>In general, it is <a href="/2014/06/09/objects-should-be-immutable.html">highly recommended</a> to design objects with immutability in mind. This means that an object gets all necessary knowledge during its instantiating and never changes its state during the entire life-cycle.</p><p>Very often, <code>NULL</code> values are used in <a href="/2017/10/17/lazy-loading-caching-sticky-cactoos.html">lazy loading</a>, to make objects incomplete and mutable. For example:</p><figure class="highlight"><pre><code class="language-java" data-lang="java"><span></span><span class="kd">public</span> <span class="kd">class</span> <span class="nc">Department</span> <span class="o">{</span>
  <span class="kd">private</span> <span class="n">Employee</span> <span class="n">found</span> <span class="o">=</span> <span class="kc">null</span><span class="o">;</span>
  <span class="kd">public</span> <span class="kd">synchronized</span> <span class="n">Employee</span> <span class="nf">manager</span><span class="o">()</span> <span class="o">{</span>
    <span class="k">if</span> <span class="o">(</span><span class="k">this</span><span class="o">.</span><span class="na">found</span> <span class="o">==</span> <span class="kc">null</span><span class="o">)</span> <span class="o">{</span>
      <span class="k">this</span><span class="o">.</span><span class="na">found</span> <span class="o">=</span> <span class="k">new</span> <span class="n">Employee</span><span class="o">(</span><span class="s">&quot;Jeffrey&quot;</span><span class="o">);</span>
    <span class="o">}</span>
    <span class="k">return</span> <span class="k">this</span><span class="o">.</span><span class="na">found</span><span class="o">;</span>
  <span class="o">}</span>
<span class="o">}</span></code></pre></figure><p>This technology, although widely used, is an anti-pattern in <a href="/2016/08/15/what-is-wrong-object-oriented-programming.html">OOP</a>. Mostly because it makes an object responsible for performance problems of the computational platform, which is something an <code>Employee</code> object should not be aware of.</p><p>Instead of managing a state and exposing its business-relevant behavior, an object has to take care of the caching of its own results---this is what lazy loading is about.</p><p>Caching is not something an employee does in the office, does he?</p><p>The solution? Don&#39;t use lazy loading in such a primitive way, as in the example above. Instead, move this caching problem to another layer of your application.</p><p>For example, in Java, you can use aspect-oriented programming aspects. For example, <a href="http://aspects.jcabi.com">jcabi-aspects</a> has <a href="http://aspects.jcabi.com/annotation-cacheable.html"><code>@Cacheable</code></a> annotation that caches the value returned by a method:</p><figure class="highlight"><pre><code class="language-java" data-lang="java"><span></span><span class="kn">import</span> <span class="nn">com.jcabi.aspects.Cacheable</span><span class="o">;</span>
<span class="kd">public</span> <span class="kd">class</span> <span class="nc">Department</span> <span class="o">{</span>
  <span class="nd">@Cacheable</span><span class="o">(</span><span class="n">forever</span> <span class="o">=</span> <span class="kc">true</span><span class="o">)</span>
  <span class="kd">public</span> <span class="n">Employee</span> <span class="nf">manager</span><span class="o">()</span> <span class="o">{</span>
    <span class="k">return</span> <span class="k">new</span> <span class="n">Employee</span><span class="o">(</span><span class="s">&quot;Jacky Brown&quot;</span><span class="o">);</span>
  <span class="o">}</span>
<span class="o">}</span></code></pre></figure><p>I hope this analysis was convincing enough that you will stop <code>NULL</code>-ing your code :)</p></p><nav class="buttons notranslate desktop-only"> <a href="http://www.facebook.com/sharer/sharer.php?u=https://www.yegor256.com/2014/05/13/why-null-is-bad.html" title="Share on Facebook" class="button" rel="nofollow"> <span class="count count-facebook">0</span> <i class="icon icon-facebook notranslate" aria-hidden="true"></i> </a> <a href="https://twitter.com/share?url=https://www.yegor256.com/2014/05/13/why-null-is-bad.html&amp;text=Why+NULL+is+Bad%3F" title="Share on Twitter" class="button" rel="nofollow"> <span class="count count-twitter">0</span> <i class="icon icon-twitter notranslate" aria-hidden="true"></i> </a> <a href="https://plus.google.com/share?url=https://www.yegor256.com/2014/05/13/why-null-is-bad.html" title="Share on Google+" class="button" rel="nofollow"> <span class="count count-googleplus">0</span> <i class="icon icon-googleplus notranslate" aria-hidden="true"></i> </a> <a href="https://www.linkedin.com/cws/share?url=https://www.yegor256.com/2014/05/13/why-null-is-bad.html" title="Share on LinkedIn" class="button" rel="nofollow"> <span class="count count-linkedin">0</span> <i class="icon icon-linkedin notranslate" aria-hidden="true"></i> </a> <a href="http://reddit.com/submit?url=https://www.yegor256.com/2014/05/13/why-null-is-bad.html%3F2014-19&amp;title=Why+NULL+is+Bad%3F" title="Share on Reddit" class="button" rel="nofollow"> <span class="count count-reddit">0</span> <i class="icon icon-reddit notranslate" aria-hidden="true"></i> </a> <a href="http://news.ycombinator.com/submitlink?u=https://www.yegor256.com/2014/05/13/why-null-is-bad.html%3F2014-19&amp;t=Why+NULL+is+Bad%3F" title="Share on Hacker News" class="button" rel="nofollow"> <span class="count count-hackernews">0</span> <i class="icon icon-hackernews notranslate" aria-hidden="true"></i> </a> </nav> </header> <article class="main" itemprop="articleBody"><div ><p>A simple example of <code>NULL</code> usage in Java:</p><figure class="highlight"><pre><code class="language-java" data-lang="java"><span></span><span class="kd">public</span> <span class="n">Employee</span> <span class="nf">getByName</span><span class="o">(</span><span class="n">String</span> <span class="n">name</span><span class="o">)</span> <span class="o">{</span>
  <span class="kt">int</span> <span class="n">id</span> <span class="o">=</span> <span class="n">database</span><span class="o">.</span><span class="na">find</span><span class="o">(</span><span class="n">name</span><span class="o">);</span>
  <span class="k">if</span> <span class="o">(</span><span class="n">id</span> <span class="o">==</span> <span class="mi">0</span><span class="o">)</span> <span class="o">{</span>
    <span class="k">return</span> <span class="kc">null</span><span class="o">;</span>
  <span class="o">}</span>
  <span class="k">return</span> <span class="k">new</span> <span class="n">Employee</span><span class="o">(</span><span class="n">id</span><span class="o">);</span>
<span class="o">}</span></code></pre></figure><p>What is wrong with this method?</p><p>It may return <code>NULL</code> instead of an object---that&#39;s what is wrong. <code>NULL</code> is a terrible practice in an object-oriented paradigm and should be avoided at <a href="/2016/03/22/try-finally-if-not-null.html">all costs</a>. There have been a number of opinions about this published already, including <a href="http://www.infoq.com/presentations/Null-References-The-Billion-Dollar-Mistake-Tony-Hoare">Null References, The Billion Dollar Mistake</a> presentation by Tony Hoare and the entire <a href="http://amzn.to/266oJr4">Object Thinking</a> book by David West.</p><p>Here, I&#39;ll try to summarize all the arguments and show examples of how <code>NULL</code> usage can be avoided and replaced with proper object-oriented constructs.</p><p>Basically, there are two possible alternatives to <code>NULL</code>.</p><p>The first one is <strong><a href="http://en.wikipedia.org/wiki/Null_Object_pattern">Null Object</a></strong> design <a href="/2016/02/03/design-patterns-and-anti-patterns.html">pattern</a> (the best way is to make it a constant):</p><figure class="highlight"><pre><code class="language-java" data-lang="java"><span></span><span class="kd">public</span> <span class="n">Employee</span> <span class="nf">getByName</span><span class="o">(</span><span class="n">String</span> <span class="n">name</span><span class="o">)</span> <span class="o">{</span>
  <span class="kt">int</span> <span class="n">id</span> <span class="o">=</span> <span class="n">database</span><span class="o">.</span><span class="na">find</span><span class="o">(</span><span class="n">name</span><span class="o">);</span>
  <span class="k">if</span> <span class="o">(</span><span class="n">id</span> <span class="o">==</span> <span class="mi">0</span><span class="o">)</span> <span class="o">{</span>
    <span class="k">return</span> <span class="n">Employee</span><span class="o">.</span><span class="na">NOBODY</span><span class="o">;</span>
  <span class="o">}</span>
  <span class="k">return</span> <span class="n">Employee</span><span class="o">(</span><span class="n">id</span><span class="o">);</span>
<span class="o">}</span></code></pre></figure><p>The second possible alternative is to <a href="/2015/08/25/fail-fast.html">fail fast</a> by throwing an <strong>Exception</strong> when you can&#39;t return an <a href="/2016/07/14/who-is-object.html">object</a>:</p><figure class="highlight"><pre><code class="language-java" data-lang="java"><span></span><span class="kd">public</span> <span class="n">Employee</span> <span class="nf">getByName</span><span class="o">(</span><span class="n">String</span> <span class="n">name</span><span class="o">)</span> <span class="o">{</span>
  <span class="kt">int</span> <span class="n">id</span> <span class="o">=</span> <span class="n">database</span><span class="o">.</span><span class="na">find</span><span class="o">(</span><span class="n">name</span><span class="o">);</span>
  <span class="k">if</span> <span class="o">(</span><span class="n">id</span> <span class="o">==</span> <span class="mi">0</span><span class="o">)</span> <span class="o">{</span>
    <span class="k">throw</span> <span class="k">new</span> <span class="n">EmployeeNotFoundException</span><span class="o">(</span><span class="n">name</span><span class="o">);</span>
  <span class="o">}</span>
  <span class="k">return</span> <span class="n">Employee</span><span class="o">(</span><span class="n">id</span><span class="o">);</span>
<span class="o">}</span></code></pre></figure><p>Now, let&#39;s see the arguments against <code>NULL</code>.</p><p>Besides Tony Hoare&#39;s presentation and David West&#39;s book mentioned above, I read these publications before writing this post: <a href="http://www.amazon.com/dp/0132350882/">Clean Code</a> by Robert Martin, <a href="http://www.amazon.com/dp/0735619670/">Code Complete</a> by Steve McConnell, <a href="http://elegantcode.com/2010/05/01/say-no-to-null/">Say &quot;No&quot; to &quot;Null&quot;</a> by John Sonmez, <a href="http://stackoverflow.com/questions/1274792/is-returning-null-bad-design">Is returning null bad design?</a> discussion at StackOverflow.</p><h2 id="ad-hoc-error-handling">Ad-hoc Error Handling</h2><p>Every time you get an object as an input you must check whether it is <code>NULL</code> or a valid object reference. If you forget to check, a <a href="http://docs.oracle.com/javase/7/docs/api/java/lang/NullPointerException.html"><code>NullPointerException</code></a> (NPE) may break execution in runtime. Thus, your logic becomes polluted with multiple checks and if/then/else forks:</p><figure class="highlight"><pre><code class="language-java" data-lang="java"><span></span><span class="c1">// this is a terrible design, don&#39;t reuse</span>
<span class="n">Employee</span> <span class="n">employee</span> <span class="o">=</span> <span class="n">dept</span><span class="o">.</span><span class="na">getByName</span><span class="o">(</span><span class="s">&quot;Jeffrey&quot;</span><span class="o">);</span>
<span class="k">if</span> <span class="o">(</span><span class="n">employee</span> <span class="o">==</span> <span class="kc">null</span><span class="o">)</span> <span class="o">{</span>
  <span class="n">System</span><span class="o">.</span><span class="na">out</span><span class="o">.</span><span class="na">println</span><span class="o">(</span><span class="s">&quot;can&#39;t find an employee&quot;</span><span class="o">);</span>
  <span class="n">System</span><span class="o">.</span><span class="na">exit</span><span class="o">(-</span><span class="mi">1</span><span class="o">);</span>
<span class="o">}</span> <span class="k">else</span> <span class="o">{</span>
  <span class="n">employee</span><span class="o">.</span><span class="na">transferTo</span><span class="o">(</span><span class="n">dept2</span><span class="o">);</span>
<span class="o">}</span></code></pre></figure><p>This is how exceptional situations are supposed to be handled in <a href="http://en.wikipedia.org/wiki/C_%28programming_language%29">C</a> and other imperative procedural languages. OOP introduced <a href="http://en.wikipedia.org/wiki/Exception_handling">exception handling</a> primarily to get rid of these ad-hoc error handling blocks. In OOP, we let exceptions bubble up until they reach an application-wide error handler and our code becomes much cleaner and shorter:</p><figure class="highlight"><pre><code class="language-java" data-lang="java"><span></span><span class="n">dept</span><span class="o">.</span><span class="na">getByName</span><span class="o">(</span><span class="s">&quot;Jeffrey&quot;</span><span class="o">).</span><span class="na">transferTo</span><span class="o">(</span><span class="n">dept2</span><span class="o">);</span></code></pre></figure><p>Consider <code>NULL</code> references an inheritance of procedural programming, and use 1) Null Objects or 2) Exceptions instead.</p><h2 id="ambiguous-semantic">Ambiguous Semantic</h2><p>In order to explicitly convey its meaning, the function <code>getByName()</code> has to be named <code>getByNameOrNullIfNotFound()</code>. The same should happen with every function that returns an object or <code>NULL</code>. Otherwise, ambiguity is inevitable for a code reader. Thus, to keep semantic unambiguous, you should give longer names to functions.</p><p>To get rid of this ambiguity, always return a real object, a null object or <a href="/2015/12/01/rethrow-exceptions.html">throw</a> an exception.</p><p>Some may argue that we sometimes have to return <code>NULL</code>, for the sake of performance. For example, method <code>get()</code> of interface <a href="http://docs.oracle.com/javase/7/docs/api/java/util/Map.html"><code>Map</code></a> in Java returns <code>NULL</code> when there is no such item in the map:</p><figure class="highlight"><pre><code class="language-java" data-lang="java"><span></span><span class="n">Employee</span> <span class="n">employee</span> <span class="o">=</span> <span class="n">employees</span><span class="o">.</span><span class="na">get</span><span class="o">(</span><span class="s">&quot;Jeffrey&quot;</span><span class="o">);</span>
<span class="k">if</span> <span class="o">(</span><span class="n">employee</span> <span class="o">==</span> <span class="kc">null</span><span class="o">)</span> <span class="o">{</span>
  <span class="k">throw</span> <span class="k">new</span> <span class="n">EmployeeNotFoundException</span><span class="o">();</span>
<span class="o">}</span>
<span class="k">return</span> <span class="n">employee</span><span class="o">;</span></code></pre></figure><p>This code searches the map only once due to the usage of <code>NULL</code> in <code>Map</code>. If we would refactor <code>Map</code> so that its method <code>get()</code> will throw an exception if nothing is found, our code will look like this:</p><figure class="highlight"><pre><code class="language-java" data-lang="java"><span></span><span class="k">if</span> <span class="o">(!</span><span class="n">employees</span><span class="o">.</span><span class="na">containsKey</span><span class="o">(</span><span class="s">&quot;Jeffrey&quot;</span><span class="o">))</span> <span class="o">{</span> <span class="c1">// first search</span>
  <span class="k">throw</span> <span class="k">new</span> <span class="n">EmployeeNotFoundException</span><span class="o">();</span>
<span class="o">}</span>
<span class="k">return</span> <span class="n">employees</span><span class="o">.</span><span class="na">get</span><span class="o">(</span><span class="s">&quot;Jeffrey&quot;</span><span class="o">);</span> <span class="c1">// second search</span></code></pre></figure><p>Obviously, this is method is twice as slow as the first one. What to do?</p><p>The <code>Map</code> interface (no offense to its authors) has a design flaw. Its method <code>get()</code> should have been returning an <a href="/2015/04/30/iterating-adapter.html"><code>Iterator</code></a> so that our code would look like:</p><figure class="highlight"><pre><code class="language-java" data-lang="java"><span></span><span class="n">Iterator</span> <span class="n">found</span> <span class="o">=</span> <span class="n">Map</span><span class="o">.</span><span class="na">search</span><span class="o">(</span><span class="s">&quot;Jeffrey&quot;</span><span class="o">);</span>
<span class="k">if</span> <span class="o">(!</span><span class="n">found</span><span class="o">.</span><span class="na">hasNext</span><span class="o">())</span> <span class="o">{</span>
  <span class="k">throw</span> <span class="k">new</span> <span class="n">EmployeeNotFoundException</span><span class="o">();</span>
<span class="o">}</span>
<span class="k">return</span> <span class="n">found</span><span class="o">.</span><span class="na">next</span><span class="o">();</span></code></pre></figure><p>BTW, that is exactly how C++ STL <a href="http://en.cppreference.com/w/cpp/container/map/find">map::find()</a> method is designed.</p><h2 id="computer-thinking-vs-object-thinking">Computer Thinking vs. Object Thinking</h2><p>Statement <code>if (employee == null)</code> is understood by someone who knows that an object in Java is a pointer to a data structure and that <code>NULL</code> is a pointer to nothing (<code>0x00000000</code>, in Intel x86 processors).</p><p>However, if you start thinking as an object, this statement makes much less sense. This is how our code looks from an object point of view:</p><figure class="highlight"><pre><code class="language-text" data-lang="text"><span></span>- Hello, is it a software department?
- Yes.
- Let me talk to your employee &quot;Jeffrey&quot; please.
- Hold the line please...
- Hello.
- Are you NULL?</code></pre></figure><p>The last question in this conversation sounds weird, doesn&#39;t it?</p><p>Instead, if they hang up the phone after our request to speak to Jeffrey, that causes a problem for us (Exception). At that point, we try to call again or inform our supervisor that we can&#39;t reach Jeffrey and complete a bigger transaction.</p><p>Alternatively, they may let us speak to another person, who is not Jeffrey, but who can help with most of our questions or refuse to help if we need something &quot;Jeffrey specific&quot; (Null Object).</p><h2 id="slow-failing">Slow Failing</h2><p>Instead of <a href="http://martinfowler.com/ieeeSoftware/failFast.pdf">failing fast</a>, the code above attempts to die slowly, killing others on its way. Instead of letting everyone know that something went wrong and that an exception handling should start immediately, it is hiding this failure from its client.</p><p>This argument is close to the &quot;ad-hoc error handling&quot; discussed above.</p><p>It is a good practice to make your code as fragile as possible, letting it break when necessary.</p><aside class='youtube'> <a href='https://www.youtube.com/watch?v=o3aNJX7AP3M'><div class='box'> <img src='https://i.ytimg.com/vi/o3aNJX7AP3M/mqdefault.jpg' alt='YouTube video #o3aNJX7AP3M'/><div class='play'><i class='icon icon-play'></i></div></div></a><div>What is Wrong About NULL in OOP? (webinar #3); 3 June 2015.</div></aside><p>Make your methods extremely demanding as to the data they manipulate. Let them complain by throwing exceptions, if the provided data provided is not sufficient or simply doesn&#39;t fit with the main usage scenario of the method.</p><p>Otherwise, return a Null Object, that exposes some common behavior and throws exceptions on all other calls:</p><figure class="highlight"><pre><code class="language-java" data-lang="java"><span></span><span class="kd">public</span> <span class="n">Employee</span> <span class="nf">getByName</span><span class="o">(</span><span class="n">String</span> <span class="n">name</span><span class="o">)</span> <span class="o">{</span>
  <span class="kt">int</span> <span class="n">id</span> <span class="o">=</span> <span class="n">database</span><span class="o">.</span><span class="na">find</span><span class="o">(</span><span class="n">name</span><span class="o">);</span>
  <span class="n">Employee</span> <span class="n">employee</span><span class="o">;</span>
  <span class="k">if</span> <span class="o">(</span><span class="n">id</span> <span class="o">==</span> <span class="mi">0</span><span class="o">)</span> <span class="o">{</span>
    <span class="n">employee</span> <span class="o">=</span> <span class="k">new</span> <span class="n">Employee</span><span class="o">()</span> <span class="o">{</span>
      <span class="nd">@Override</span>
      <span class="kd">public</span> <span class="n">String</span> <span class="nf">name</span><span class="o">()</span> <span class="o">{</span>
        <span class="k">return</span> <span class="s">&quot;anonymous&quot;</span><span class="o">;</span>
      <span class="o">}</span>
      <span class="nd">@Override</span>
      <span class="kd">public</span> <span class="kt">void</span> <span class="nf">transferTo</span><span class="o">(</span><span class="n">Department</span> <span class="n">dept</span><span class="o">)</span> <span class="o">{</span>
        <span class="k">throw</span> <span class="k">new</span> <span class="n">AnonymousEmployeeException</span><span class="o">(</span>
          <span class="s">&quot;I can&#39;t be transferred, I&#39;m anonymous&quot;</span>
        <span class="o">);</span>
      <span class="o">}</span>
    <span class="o">};</span>
  <span class="o">}</span> <span class="k">else</span> <span class="o">{</span>
    <span class="n">employee</span> <span class="o">=</span> <span class="n">Employee</span><span class="o">(</span><span class="n">id</span><span class="o">);</span>
  <span class="o">}</span>
  <span class="k">return</span> <span class="n">employee</span><span class="o">;</span>
<span class="o">}</span></code></pre></figure> <blockquote class="twitter-tweet" data-lang="en"><p lang="en" dir="ltr">Say, you are designing a method findUserByName(), which has to find a user in the database. What would you return if nothing is found? <a href="https://twitter.com/hashtag/elegantobjects?src=hash&amp;ref_src=twsrc%5Etfw">#elegantobjects</a></p>--- Yegor Bugayenko (@yegor256) <a href="https://twitter.com/yegor256/status/990459955818979329?ref_src=twsrc%5Etfw">April 29, 2018</a></blockquote> <script async src="https://platform.twitter.com/widgets.js" charset="utf-8"></script><h2 id="mutable-and-incomplete-objects">Mutable and Incomplete Objects</h2><p>In general, it is <a href="/2014/06/09/objects-should-be-immutable.html">highly recommended</a> to design objects with immutability in mind. This means that an object gets all necessary knowledge during its instantiating and never changes its state during the entire life-cycle.</p><p>Very often, <code>NULL</code> values are used in <a href="/2017/10/17/lazy-loading-caching-sticky-cactoos.html">lazy loading</a>, to make objects incomplete and mutable. For example:</p><figure class="highlight"><pre><code class="language-java" data-lang="java"><span></span><span class="kd">public</span> <span class="kd">class</span> <span class="nc">Department</span> <span class="o">{</span>
  <span class="kd">private</span> <span class="n">Employee</span> <span class="n">found</span> <span class="o">=</span> <span class="kc">null</span><span class="o">;</span>
  <span class="kd">public</span> <span class="kd">synchronized</span> <span class="n">Employee</span> <span class="nf">manager</span><span class="o">()</span> <span class="o">{</span>
    <span class="k">if</span> <span class="o">(</span><span class="k">this</span><span class="o">.</span><span class="na">found</span> <span class="o">==</span> <span class="kc">null</span><span class="o">)</span> <span class="o">{</span>
      <span class="k">this</span><span class="o">.</span><span class="na">found</span> <span class="o">=</span> <span class="k">new</span> <span class="n">Employee</span><span class="o">(</span><span class="s">&quot;Jeffrey&quot;</span><span class="o">);</span>
    <span class="o">}</span>
    <span class="k">return</span> <span class="k">this</span><span class="o">.</span><span class="na">found</span><span class="o">;</span>
  <span class="o">}</span>
<span class="o">}</span></code></pre></figure><p>This technology, although widely used, is an anti-pattern in <a href="/2016/08/15/what-is-wrong-object-oriented-programming.html">OOP</a>. Mostly because it makes an object responsible for performance problems of the computational platform, which is something an <code>Employee</code> object should not be aware of.</p><p>Instead of managing a state and exposing its business-relevant behavior, an object has to take care of the caching of its own results---this is what lazy loading is about.</p><p>Caching is not something an employee does in the office, does he?</p><p>The solution? Don&#39;t use lazy loading in such a primitive way, as in the example above. Instead, move this caching problem to another layer of your application.</p><p>For example, in Java, you can use aspect-oriented programming aspects. For example, <a href="http://aspects.jcabi.com">jcabi-aspects</a> has <a href="http://aspects.jcabi.com/annotation-cacheable.html"><code>@Cacheable</code></a> annotation that caches the value returned by a method:</p><figure class="highlight"><pre><code class="language-java" data-lang="java"><span></span><span class="kn">import</span> <span class="nn">com.jcabi.aspects.Cacheable</span><span class="o">;</span>
<span class="kd">public</span> <span class="kd">class</span> <span class="nc">Department</span> <span class="o">{</span>
  <span class="nd">@Cacheable</span><span class="o">(</span><span class="n">forever</span> <span class="o">=</span> <span class="kc">true</span><span class="o">)</span>
  <span class="kd">public</span> <span class="n">Employee</span> <span class="nf">manager</span><span class="o">()</span> <span class="o">{</span>
    <span class="k">return</span> <span class="k">new</span> <span class="n">Employee</span><span class="o">(</span><span class="s">&quot;Jacky Brown&quot;</span><span class="o">);</span>
  <span class="o">}</span>
<span class="o">}</span></code></pre></figure><p>I hope this analysis was convincing enough that you will stop <code>NULL</code>-ing your code :)</p></div></article></div><div class="wrapper"> <related-posts /></div><div class="disqus" role="complementary"><p class="disqus_hint"> Please, use <a href="https://help.disqus.com/commenting/what-html-tags-are-allowed-within-comments">syntax highlighting</a> in your comments, to make them more readable.</p><div id="disqus_thread" class="disqus-thread"> <a>&nbsp;</a></div><script> var disqus_config = function () { this.page.url = document.location.href.split('?')[0].split('#')[0].replace('https://', 'http://'); this.page.identifier = this.page.url; }; (function() { var d = document, s = d.createElement('script'); s.src = '//yegor256.disqus.com/embed.js'; s.setAttribute('data-timestamp', +new Date()); (d.head || d.body).appendChild(s); })(); </script> <noscript><div><p class="red"> JavaScript is disabled in your browser, that's why you can't see comments under this post.</p></div></noscript></div><div class="wrapper"> <footer class="footer"><p> &copy; <span itemscope="" itemprop="copyrightHolder" itemtype="http://schema.org/Person"> <span itemprop="name">Yegor Bugayenko</span> </span> 2014&ndash;<span itemprop="copyrightYear">2018</span></p></footer></div></section><div class="wrapper unprintable" style="text-align:center;margin-top:2em;"> <a href="http://www.sixnines.io/h/3ba1652f"> <img src="//www.sixnines.io/b/3ba1652f?style=flat" alt="sixnines availability badge"/> </a></div><script src="//code.jquery.com/jquery-1.9.0.min.js"></script> <script src="/js/all.js?a0e0d018c07"></script> <script>var disqus_shortname = 'yegor256';</script> <script id="dsq-count-scr" src="//yegor256.disqus.com/count.js" async="async"></script> <script> (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){ (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o), m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m) })(window,document,'script','//www.google-analytics.com/analytics.js','ga'); ga('create', 'UA-1963507-32', 'auto'); ga('send', 'pageview'); </script> <script> Cd=document;Cr="&"+Math.random();Cp="&s=1"; Cd.cookie="b=b";if(Cd.cookie)Cp+="&c=1"; Cp+="&t="+(new Date()).getTimezoneOffset(); if(self!=top)Cp+="&f=1"; </script> <script> if(navigator.javaEnabled())Cp+="&j=1"; </script> <script> if(typeof(screen)!='undefined')Cp+="&w="+screen.width+"&h="+ screen.height+"&d="+(screen.colorDepth?screen.colorDepth:screen.pixelDepth); </script> <script> Cd.write("<img src='//c.hit.ua/hit?i=95870&g=0&x=2"+Cp+Cr+ "&r="+escape(Cd.referrer)+"&u="+escape(window.location.href)+ "' border='0' wi"+"dth='1' he"+"ight='1'/>"); </script> <script type="application/ld+json"> { "@context": "http://schema.org", "@type": "Person", "name": "Yegor Bugayenko", "url": "http://www.yegor256.com", "sameAs": [ "https://www.facebook.com/yegor256", "https://instagram.com/yegor256", "https://www.linkedin.com/in/yegor256", "https://twitter.com/yegor256", "https://github.com/yegor256", "https://www.pinterest.com/yegor256/" ] } </script> </body> </html> <!DOCTYPE html> <html xmlns="http://www.w3.org/1999/xhtml" lang="en-US" xml:lang="en-US" itemscope="" itemtype="http://schema.org/WebSite"> <head> <meta charset="utf-8"/> <meta name="description" content="Utility classes are a very popular design pattern in Java and other object-oriented languages. However, many consider them a terrible practice to be avoided. " /> <meta name="keywords" content="static is evil, static methods is evil, utility class is bad, utility class is evil, utility classes are bad, utility classes are evil, utility classes is a bad practice" /> <meta name="viewport" content="width=device-width,minimum-scale=1,initial-scale=1"/> <meta name="google-site-verification" content="JEj_gQr2CPe2QKGw8XdMz0R7VboQIUbX3FlM-lwTq-8" /> <meta name="author" content="Yegor Bugayenko"> <meta name="article:published_time" content="2014-05-05 00:00:00 +0000"> <meta name="og:site_name" content="Yegor Bugayenko"/> <meta name="og:type" content="article" /> <meta name="og:locale" content="en_US" /> <meta name="twitter:account_id" content="4503599630178231" /> <meta name="twitter:creator" content="@yegor256"/> <meta name="twitter:site" content="@yegor256"/> <meta name="twitter:title" property="og:title" content="OOP Alternative to Utility Classes"/> <meta name="twitter:description" property="og:description" content="Utility classes are a very popular design pattern in Java and other object-oriented languages. However, many consider them a terrible practice to be avoided. "/> <meta name="twitter:url" property="og:url" content="https://www.yegor256.com/2014/05/05/oop-alternative-to-utility-classes.html"/> <meta name="telegram:channel" content="AAAAAEJFMRzsRTRxM3ec6A"/> <link rel="search" type="application/opensearchdescription+xml" href="/opensearch.xml" title="yegor256" /> <link rel="shortcut icon" href="/favicon.ico?a0e0d018c07"/> <link rel="apple-touch-icon" href="/favicon.ico?a0e0d018c07"/> <link rel="alternate" type="application/rss+xml" title="RSS for yegor256.com" href="https://www.yegor256.com/rss.xml"/> <link rel="stylesheet" href="/css/layout.css?a0e0d018c07"/> <link rel="stylesheet" href="/css/icons.css?a0e0d018c07"/> <link rel="canonical" href="https://www.yegor256.com/2014/05/05/oop-alternative-to-utility-classes.html" /> <link rel="amphtml" href="https://www.yegor256.com/2014/05/05/oop-alternative-to-utility-classes.amp.html" /> <title>OOP Alternative to Utility Classes </title> </head> <body><div class="wrapper"> <aside class="header-toggle unprintable" id="header-toggle" title="Show the menu" onclick="$('#header').show();$('#header-toggle').hide();">&#9776;</aside> <header class="header" id="header"><div class="face"> <a href="/about-me.html#form" class="sub" title="Click to subscribe to my monthly newsletter"><span>Subscribe</span></a> <a href="/about-me.html" style="position:relative;"> <img src="/images/face-256x256.jpg" class="photo" alt="Yegor Bugayenko"/> </a></div><nav><ul class="menu social notranslate"> <li><a href="https://twitter.com/intent/follow?screen_name=yegor256" rel="nofollow" title="Follow me on Twitter"><i class="icon icon-twitter notranslate" aria-hidden="true"></i></a></li> <li><a href="/rss.xml" rel="nofollow" title="Subscribe to my RSS feed"><i class="icon icon-rss notranslate" aria-hidden="true"></i></a></li> <li><a itemprop="sameAs" href="https://github.com/yegor256" rel="nofollow" title="My GitHub profile"><i class="icon icon-github notranslate" aria-hidden="true"></i></a></li> <li><a itemprop="sameAs" href="http://stackoverflow.com/users/187141/yegor256" rel="nofollow" title="My StackOverflow profile"><i class="icon icon-stackoverflow notranslate" aria-hidden="true"></i></a></li> <li><a itemprop="sameAs" href="https://www.facebook.com/yegor256" rel="nofollow" title="Follow me on Facebook"><i class="icon icon-facebook notranslate" aria-hidden="true"></i></a></li> <li><a itemprop="sameAs" href="https://instagram.com/yegor256" rel="nofollow" title="Follow me on Instagram"><i class="icon icon-instagram notranslate" aria-hidden="true"></i></a></li> <li><a itemprop="sameAs" href="https://www.linkedin.com/in/yegor256" rel="nofollow" title="My LinkedIn profile"><i class="icon icon-linkedin notranslate" aria-hidden="true"></i></a></li> <li><a itemprop="sameAs" href="https://www.youtube.com/c/yegor256?sub_confirmation=1" rel="nofollow" title="My Youtube video channel"><i class="icon icon-youtube notranslate" aria-hidden="true"></i></a></li> <li><a itemprop="sameAs" href="https://www.pinterest.com/yegor256/" rel="nofollow" title="My Pinterest boards"><i class="icon icon-pinterest notranslate" aria-hidden="true"></i></a></li> <li><a itemprop="sameAs" href="https://angel.co/yegor256" rel="nofollow" title="My AngelList profile"><i class="icon icon-angellist notranslate" aria-hidden="true"></i></a></li> <li><a href="https://soundcloud.com/yegor256" rel="nofollow" title="My podcast"><i class="icon icon-podcast notranslate" aria-hidden="true"></i></a></li> <li><a href="https://itunes.apple.com/us/podcast/yegor256-podcast/id1150826721" rel="nofollow" title="My iTunes podcast"><i class="icon icon-itunes notranslate" aria-hidden="true"></i></a></li> <li><a href="https://t.me/joinchat/AAAAAEJFMRzsRTRxM3ec6A" rel="nofollow" title="My Telegram public channel"><i class="icon icon-telegram notranslate" aria-hidden="true"></i></a></li> <li><a href="mailto:blog@yegor256.com" rel="nofollow" title="Email me any time"><i class="icon icon-mail notranslate" aria-hidden="true"></i></a></li></ul><ul class="menu"> <li><a href="/" title="Home page">Home</a></li> <li ><a href="/best.html" title="Best articles to read">12&#160;Best</a></li> <li ><a href="/contents.html" title="The contents of the entire blog">All&#160;288</a></li> <li ><a href="/webinars.html" title="My webinars">Webinars</a></li> <li ><a href="/talks.html" title="Future and past conference talks">Talks</a></li> <li ><a href="/books.html" title="The books I wrote">Books</a></li> <li ><a href="/papers.html" title="My academic papers and patents">Papers</a></li> <li ><a href="/pets.html" title="My loved pet projects">Pets</a></li> <li ><a href="/award.html" title="Software quality award">Award</a></li> <li ><a href="/testimonials.html" title="What some people say about me">Testimonials</a></li> <li ><a href="/shift-m.html" title="Audio podcast about project management">Shift-M</a></li> <li ><a href="/paintings.html" title="My paintings for sale">Paintings</a></li> <li><a href="http://ru.yegor256.com/" title="Немного на русском языке">По-русски</a></li></ul></nav><div class="search"> <form method="get" action="https://www.google.com/search" itemprop="potentialAction" itemscope="" itemtype="http://schema.org/SearchAction"> <meta itemprop="target" content="https://www.google.com/search?q={q}"/> <input name="sitesearch" value="yegor256.com" type="hidden"/> <input itemprop="query-input" type="text" id="search-query" class="field field-text" required="required" onfocus="$('.google').css('visibility', 'visible');" name="q" placeholder="Search..." autocomplete="off"/> <input type="image" src="/images/google-search-icon.svg" class="google" title="Search via Google" alt="Search via Google"/> </form></div><div class="hot"><ul> <li> <a href="/code-ahead.html">Code Ahead</a> was published on Amazon just a few days ago! It is my new book, a novel about programmers. It explains in details the majority of ideas that stand behind <a href="https://www.zerocracy.com">Zerocracy</a> and <a href="https://www.xdsd.org">XDSD</a>. </li> <li> At <a href="/webinars.html">Webinar #37</a> we will discuss naming problem in OOP, for objects, methods and attributes; join us on <b>September 12</b>, at 11am PST. </li></ul></div></header></div><section itemscope="" itemtype="http://schema.org/BlogPosting"><div class="wrapper"> <header><p class="printable"> <img src="https://api.qrserver.com/v1/create-qr-code/?data=https://www.yegor256.com/2014/05/05/oop-alternative-to-utility-classes.html&amp;format=svg" style="width:125px;height:125px;" alt="QR code"/></p><p class="printable"> <code itemprop="url">https://www.yegor256.com/2014/05/05/oop-alternative-to-utility-classes.html</code></p><h1 itemprop="name headline mainEntityOfPage">OOP Alternative to Utility Classes</h1><aside class='book'><a href='http://amzn.to/2qFt4Tn'><img src='/images/books/elegant-objects/cover.png' class='book-cover' alt='book cover'/></a>Read more about this subject in <a href='http://amzn.to/2qFt4Tn'>Section&nbsp;3.2</a><br/> of my book<a href='http://amzn.to/2qFt4Tn'><img src='/images/books/amazon-buy-button.png' class='amazon-button' alt='Click to buy'/></a></aside><ul class="subline"> <li> <time itemprop="datePublished" datetime="2014-05-05T00:00:00+00:00"> 5 May 2014 </time> </li> <li class="printable" itemscope="" itemprop="author" itemtype="http://schema.org/Person"> <span itemprop="name">Yegor Bugayenko</span> </li> <li class="unprintable"> <i class="icon icon-comments"></i> <a href="http://www.yegor256.com/2014/05/05/oop-alternative-to-utility-classes.html#disqus_thread" itemprop="discussionUrl">comments</a> </li></ul><ul class="unprintable subline"> <li>Translated:</li> <li><a href="http://tbd.kaitoy.xyz/2016/01/03/oop-alternative-to-utility-classes/">Japanese</a></li> <li><a href="http://agorlov.ru/oop-alternative-to-utility-classes.html">Russian</a></li> <li><a href="mailto:translate@yegor256.com">add yours!</a></li></ul><p class="unprintable"><p>A utility class (aka helper class) is a &quot;structure&quot; that has only static methods and encapsulates no state. <code>StringUtils</code>, <code>IOUtils</code>, <code>FileUtils</code> from <a href="http://commons.apache.org/">Apache Commons</a>; <code>Iterables</code> and <code>Iterators</code> from <a href="https://code.google.com/p/guava-libraries/">Guava</a>, and <a href="http://docs.oracle.com/javase/7/docs/api/java/nio/file/Files.html"><code>Files</code></a> from JDK7 are perfect examples of utility classes.</p><p>This design idea is very popular in the Java world (as well as C#, Ruby, etc.) because utility classes provide common functionality used everywhere.</p><aside class='youtube'> <a href='https://www.youtube.com/watch?v=psrp3TtaYYI'><div class='box'> <img src='https://i.ytimg.com/vi/psrp3TtaYYI/mqdefault.jpg' alt='YouTube video #psrp3TtaYYI'/><div class='play'><i class='icon icon-play'></i></div></div></a><div>What's Wrong About Utility Classes? (webinar #6); 2 September 2015.</div></aside><p>Here, we want to follow the <a href="http://en.wikipedia.org/wiki/Don%27t_repeat_yourself">DRY principle</a> and avoid duplication. Therefore, we place common code blocks into utility classes and reuse them when necessary:</p><figure class="highlight"><pre><code class="language-java" data-lang="java"><span></span><span class="c1">// This is a terrible design, don&#39;t reuse</span>
<span class="kd">public</span> <span class="kd">class</span> <span class="nc">NumberUtils</span> <span class="o">{</span>
  <span class="kd">public</span> <span class="kd">static</span> <span class="kt">int</span> <span class="nf">max</span><span class="o">(</span><span class="kt">int</span> <span class="n">a</span><span class="o">,</span> <span class="kt">int</span> <span class="n">b</span><span class="o">)</span> <span class="o">{</span>
    <span class="k">return</span> <span class="n">a</span> <span class="o">&gt;</span> <span class="n">b</span> <span class="o">?</span> <span class="n">a</span> <span class="o">:</span> <span class="n">b</span><span class="o">;</span>
  <span class="o">}</span>
<span class="o">}</span></code></pre></figure><p>Indeed, this a very convenient technique!?</p><h2 id="utility-classes-are-evil">Utility Classes Are Evil</h2><p>However, in an object-oriented world, utility classes are considered a very bad (some even may say &quot;terrible&quot;) practice.</p><p>There have been many discussions of this subject; to name a few: <a href="http://blogs.msdn.com/b/nickmalik/archive/2005/09/06/461404.aspx">Are Helper Classes Evil?</a> by Nick Malik, <a href="http://smart421.wordpress.com/2011/08/31/why-helper-singletons-and-utility-classes-are-mostly-bad-2/">Why helper, singletons and utility classes are mostly bad</a> by Simon Hart, <a href="https://github.com/marshallward/marshallward.org/blob/master/content/avoid_util_classes.rst">Avoiding Utility Classes</a> by Marshal Ward, <a href="http://www.jroller.com/DhavalDalal/entry/kill_that_util_class">Kill That Util Class!</a> by Dhaval Dalal, <a href="http://www.robbagby.com/posts/helper-classes-are-a-code-smell/">Helper Classes Are A Code Smell</a> by Rob Bagby.</p><p>Additionally, there are a few questions on StackExchange about utility classes: <a href="http://stackoverflow.com/questions/3339929/if-a-utilities-class-is-evil-where-do-i-put-my-generic-code">If a “Utilities” class is evil, where do I put my generic code?</a>, <a href="http://stackoverflow.com/questions/3340032/utility-classes-are-evil">Utility Classes are Evil</a>.</p><p>A dry summary of all their arguments is that utility classes are not proper <strong>objects</strong>; therefore, they don&#39;t fit into object-oriented world. They were inherited from <strong>procedural</strong> programming, mostly because we were used to a functional decomposition paradigm back then.</p><p>Assuming you agree with the arguments and want to stop using utility classes, I&#39;ll show by example how these creatures can be replaced with proper <a href="/2016/07/14/who-is-object.html">objects</a>.</p><h2 id="procedural-example">Procedural Example</h2><p>Say, for instance, you want to read a text file, split it into lines, trim every line and then save the results in another file. This is can be done with <a href="http://commons.apache.org/proper/commons-io/javadocs/api-2.5/org/apache/commons/io/FileUtils.html"><code>FileUtils</code></a> from Apache Commons:</p><figure class="highlight"><pre><code class="language-java" data-lang="java"><span></span><span class="kt">void</span> <span class="nf">transform</span><span class="o">(</span><span class="n">File</span> <span class="n">in</span><span class="o">,</span> <span class="n">File</span> <span class="n">out</span><span class="o">)</span> <span class="o">{</span>
  <span class="n">Collection</span><span class="o">&lt;</span><span class="n">String</span><span class="o">&gt;</span> <span class="n">src</span> <span class="o">=</span> <span class="n">FileUtils</span><span class="o">.</span><span class="na">readLines</span><span class="o">(</span><span class="n">in</span><span class="o">,</span> <span class="s">&quot;UTF-8&quot;</span><span class="o">);</span>
  <span class="n">Collection</span><span class="o">&lt;</span><span class="n">String</span><span class="o">&gt;</span> <span class="n">dest</span> <span class="o">=</span> <span class="k">new</span> <span class="n">ArrayList</span><span class="o">&lt;&gt;(</span><span class="n">src</span><span class="o">.</span><span class="na">size</span><span class="o">());</span>
  <span class="k">for</span> <span class="o">(</span><span class="n">String</span> <span class="n">line</span> <span class="o">:</span> <span class="n">src</span><span class="o">)</span> <span class="o">{</span>
    <span class="n">dest</span><span class="o">.</span><span class="na">add</span><span class="o">(</span><span class="n">line</span><span class="o">.</span><span class="na">trim</span><span class="o">());</span>
  <span class="o">}</span>
  <span class="n">FileUtils</span><span class="o">.</span><span class="na">writeLines</span><span class="o">(</span><span class="n">out</span><span class="o">,</span> <span class="n">dest</span><span class="o">,</span> <span class="s">&quot;UTF-8&quot;</span><span class="o">);</span>
<span class="o">}</span></code></pre></figure><p>The above code may look clean; however, this is procedural programming, not object-oriented. We are manipulating data (bytes and bits) and explicitly instructing the computer from where to retrieve them and then where to put them on every single line of code. We&#39;re defining <em>a procedure of execution</em>.</p><h2 id="object-oriented-alternative">Object-Oriented Alternative</h2><p>In an object-oriented paradigm, we should instantiate and compose objects, thus letting them manage data when and how <em>they</em> desire. Instead of calling supplementary static functions, we should create objects that are capable of exposing the behavior we are seeking:</p><figure class="highlight"><pre><code class="language-java" data-lang="java"><span></span><span class="kd">public</span> <span class="kd">class</span> <span class="nc">Max</span> <span class="kd">implements</span> <span class="n">Number</span> <span class="o">{</span>
  <span class="kd">private</span> <span class="kd">final</span> <span class="kt">int</span> <span class="n">a</span><span class="o">;</span>
  <span class="kd">private</span> <span class="kd">final</span> <span class="kt">int</span> <span class="n">b</span><span class="o">;</span>
  <span class="kd">public</span> <span class="nf">Max</span><span class="o">(</span><span class="kt">int</span> <span class="n">x</span><span class="o">,</span> <span class="kt">int</span> <span class="n">y</span><span class="o">)</span> <span class="o">{</span>
    <span class="k">this</span><span class="o">.</span><span class="na">a</span> <span class="o">=</span> <span class="n">x</span><span class="o">;</span>
    <span class="k">this</span><span class="o">.</span><span class="na">b</span> <span class="o">=</span> <span class="n">y</span><span class="o">;</span>
  <span class="o">}</span>
  <span class="nd">@Override</span>
  <span class="kd">public</span> <span class="kt">int</span> <span class="nf">intValue</span><span class="o">()</span> <span class="o">{</span>
    <span class="k">return</span> <span class="k">this</span><span class="o">.</span><span class="na">a</span> <span class="o">&gt;</span> <span class="k">this</span><span class="o">.</span><span class="na">b</span> <span class="o">?</span> <span class="k">this</span><span class="o">.</span><span class="na">a</span> <span class="o">:</span> <span class="k">this</span><span class="o">.</span><span class="na">b</span><span class="o">;</span>
  <span class="o">}</span>
<span class="o">}</span></code></pre></figure><p>This procedural call:</p><figure class="highlight"><pre><code class="language-java" data-lang="java"><span></span><span class="kt">int</span> <span class="n">max</span> <span class="o">=</span> <span class="n">NumberUtils</span><span class="o">.</span><span class="na">max</span><span class="o">(</span><span class="mi">10</span><span class="o">,</span> <span class="mi">5</span><span class="o">);</span></code></pre></figure><p>Will become object-oriented:</p><figure class="highlight"><pre><code class="language-java" data-lang="java"><span></span><span class="kt">int</span> <span class="n">max</span> <span class="o">=</span> <span class="k">new</span> <span class="n">Max</span><span class="o">(</span><span class="mi">10</span><span class="o">,</span> <span class="mi">5</span><span class="o">).</span><span class="na">intValue</span><span class="o">();</span></code></pre></figure><p>Potato, potato? Not really; just read on...</p><h2 id="objects-instead-of-data-structures">Objects Instead of Data Structures</h2><p>This is how I would design the same file-transforming functionality as above but in an object-oriented manner:</p><figure class="highlight"><pre><code class="language-java" data-lang="java"><span></span><span class="kt">void</span> <span class="nf">transform</span><span class="o">(</span><span class="n">File</span> <span class="n">in</span><span class="o">,</span> <span class="n">File</span> <span class="n">out</span><span class="o">)</span> <span class="o">{</span>
  <span class="n">Collection</span><span class="o">&lt;</span><span class="n">String</span><span class="o">&gt;</span> <span class="n">src</span> <span class="o">=</span> <span class="k">new</span> <span class="n">Trimmed</span><span class="o">(</span>
    <span class="k">new</span> <span class="n">FileLines</span><span class="o">(</span><span class="k">new</span> <span class="n">UnicodeFile</span><span class="o">(</span><span class="n">in</span><span class="o">))</span>
  <span class="o">);</span>
  <span class="n">Collection</span><span class="o">&lt;</span><span class="n">String</span><span class="o">&gt;</span> <span class="n">dest</span> <span class="o">=</span> <span class="k">new</span> <span class="n">FileLines</span><span class="o">(</span>
    <span class="k">new</span> <span class="n">UnicodeFile</span><span class="o">(</span><span class="n">out</span><span class="o">)</span>
  <span class="o">);</span>
  <span class="n">dest</span><span class="o">.</span><span class="na">addAll</span><span class="o">(</span><span class="n">src</span><span class="o">);</span>
<span class="o">}</span></code></pre></figure><p><code>FileLines</code> implements <code>Collection&lt;String&gt;</code> and encapsulates all file reading and writing operations. An instance of <code>FileLines</code> behaves exactly as a collection of strings and hides all I/O operations. When we iterate it---a file is being read. When we <code>addAll()</code> to it---a file is being written.</p><p><code>Trimmed</code> also implements <code>Collection&lt;String&gt;</code> and encapsulates a collection of strings (<a href="http://en.wikipedia.org/wiki/Decorator_pattern">Decorator pattern</a>). Every time the next line is retrieved, it gets trimmed.</p><p>All classes taking participation in the snippet are rather small: <code>Trimmed</code>, <code>FileLines</code>, and <code>UnicodeFile</code>. Each of them is responsible for its own single feature, thus following perfectly the <a href="http://en.wikipedia.org/wiki/Single_responsibility_principle">single responsibility principle</a>.</p><aside class='youtube'> <a href='https://www.youtube.com/watch?v=D0dqC_3Bch8'><div class='box'> <img src='https://i.ytimg.com/vi/D0dqC_3Bch8/mqdefault.jpg' alt='YouTube video #D0dqC_3Bch8'/><div class='play'><i class='icon icon-play'></i></div></div></a><div>Objects vs. Static Methods (webinar #1); 8 April 2015.</div></aside><p>On our side, as users of the library, this may be not so important, but for their developers it is an imperative. It is much easier to develop, maintain and unit-test class <code>FileLines</code> rather than using a <code>readLines()</code> method in a 80+ methods and 3000 lines utility class <code>FileUtils</code>. Seriously, look at <a href="https://github.com/apache/commons-io/blob/commons-io-2.5/src/main/java/org/apache/commons/io/FileUtils.java">its source code</a>.</p><p>An object-oriented approach enables lazy execution. The <code>in</code> file is not read until its data is required. If we fail to open <code>out</code> due to some I/O error, the first file won&#39;t even be touched. The whole show starts only after we call <code>addAll()</code>.</p><p>All lines in the second snippet, except the last one, instantiate and compose smaller objects into bigger ones. This object composition is rather cheap for the CPU since it doesn&#39;t cause any data transformations.</p><p>Besides that, it is obvious that the second script runs in O(1) space, while the first one executes in O(n). This is the consequence of our procedural approach to data in the first script.</p><p>In an object-oriented world, there is no data; there are only objects and their behavior!</p></p><nav class="buttons notranslate desktop-only"> <a href="http://www.facebook.com/sharer/sharer.php?u=https://www.yegor256.com/2014/05/05/oop-alternative-to-utility-classes.html" title="Share on Facebook" class="button" rel="nofollow"> <span class="count count-facebook">0</span> <i class="icon icon-facebook notranslate" aria-hidden="true"></i> </a> <a href="https://twitter.com/share?url=https://www.yegor256.com/2014/05/05/oop-alternative-to-utility-classes.html&amp;text=OOP+Alternative+to+Utility+Classes" title="Share on Twitter" class="button" rel="nofollow"> <span class="count count-twitter">0</span> <i class="icon icon-twitter notranslate" aria-hidden="true"></i> </a> <a href="https://plus.google.com/share?url=https://www.yegor256.com/2014/05/05/oop-alternative-to-utility-classes.html" title="Share on Google+" class="button" rel="nofollow"> <span class="count count-googleplus">0</span> <i class="icon icon-googleplus notranslate" aria-hidden="true"></i> </a> <a href="https://www.linkedin.com/cws/share?url=https://www.yegor256.com/2014/05/05/oop-alternative-to-utility-classes.html" title="Share on LinkedIn" class="button" rel="nofollow"> <span class="count count-linkedin">0</span> <i class="icon icon-linkedin notranslate" aria-hidden="true"></i> </a> <a href="http://reddit.com/submit?url=https://www.yegor256.com/2014/05/05/oop-alternative-to-utility-classes.html%3F2014-18&amp;title=OOP+Alternative+to+Utility+Classes" title="Share on Reddit" class="button" rel="nofollow"> <span class="count count-reddit">0</span> <i class="icon icon-reddit notranslate" aria-hidden="true"></i> </a> <a href="http://news.ycombinator.com/submitlink?u=https://www.yegor256.com/2014/05/05/oop-alternative-to-utility-classes.html%3F2014-18&amp;t=OOP+Alternative+to+Utility+Classes" title="Share on Hacker News" class="button" rel="nofollow"> <span class="count count-hackernews">0</span> <i class="icon icon-hackernews notranslate" aria-hidden="true"></i> </a> </nav> </header> <article class="main" itemprop="articleBody"><div ><p>A utility class (aka helper class) is a &quot;structure&quot; that has only static methods and encapsulates no state. <code>StringUtils</code>, <code>IOUtils</code>, <code>FileUtils</code> from <a href="http://commons.apache.org/">Apache Commons</a>; <code>Iterables</code> and <code>Iterators</code> from <a href="https://code.google.com/p/guava-libraries/">Guava</a>, and <a href="http://docs.oracle.com/javase/7/docs/api/java/nio/file/Files.html"><code>Files</code></a> from JDK7 are perfect examples of utility classes.</p><p>This design idea is very popular in the Java world (as well as C#, Ruby, etc.) because utility classes provide common functionality used everywhere.</p><aside class='youtube'> <a href='https://www.youtube.com/watch?v=psrp3TtaYYI'><div class='box'> <img src='https://i.ytimg.com/vi/psrp3TtaYYI/mqdefault.jpg' alt='YouTube video #psrp3TtaYYI'/><div class='play'><i class='icon icon-play'></i></div></div></a><div>What's Wrong About Utility Classes? (webinar #6); 2 September 2015.</div></aside><p>Here, we want to follow the <a href="http://en.wikipedia.org/wiki/Don%27t_repeat_yourself">DRY principle</a> and avoid duplication. Therefore, we place common code blocks into utility classes and reuse them when necessary:</p><figure class="highlight"><pre><code class="language-java" data-lang="java"><span></span><span class="c1">// This is a terrible design, don&#39;t reuse</span>
<span class="kd">public</span> <span class="kd">class</span> <span class="nc">NumberUtils</span> <span class="o">{</span>
  <span class="kd">public</span> <span class="kd">static</span> <span class="kt">int</span> <span class="nf">max</span><span class="o">(</span><span class="kt">int</span> <span class="n">a</span><span class="o">,</span> <span class="kt">int</span> <span class="n">b</span><span class="o">)</span> <span class="o">{</span>
    <span class="k">return</span> <span class="n">a</span> <span class="o">&gt;</span> <span class="n">b</span> <span class="o">?</span> <span class="n">a</span> <span class="o">:</span> <span class="n">b</span><span class="o">;</span>
  <span class="o">}</span>
<span class="o">}</span></code></pre></figure><p>Indeed, this a very convenient technique!?</p><h2 id="utility-classes-are-evil">Utility Classes Are Evil</h2><p>However, in an object-oriented world, utility classes are considered a very bad (some even may say &quot;terrible&quot;) practice.</p><p>There have been many discussions of this subject; to name a few: <a href="http://blogs.msdn.com/b/nickmalik/archive/2005/09/06/461404.aspx">Are Helper Classes Evil?</a> by Nick Malik, <a href="http://smart421.wordpress.com/2011/08/31/why-helper-singletons-and-utility-classes-are-mostly-bad-2/">Why helper, singletons and utility classes are mostly bad</a> by Simon Hart, <a href="https://github.com/marshallward/marshallward.org/blob/master/content/avoid_util_classes.rst">Avoiding Utility Classes</a> by Marshal Ward, <a href="http://www.jroller.com/DhavalDalal/entry/kill_that_util_class">Kill That Util Class!</a> by Dhaval Dalal, <a href="http://www.robbagby.com/posts/helper-classes-are-a-code-smell/">Helper Classes Are A Code Smell</a> by Rob Bagby.</p><p>Additionally, there are a few questions on StackExchange about utility classes: <a href="http://stackoverflow.com/questions/3339929/if-a-utilities-class-is-evil-where-do-i-put-my-generic-code">If a “Utilities” class is evil, where do I put my generic code?</a>, <a href="http://stackoverflow.com/questions/3340032/utility-classes-are-evil">Utility Classes are Evil</a>.</p><p>A dry summary of all their arguments is that utility classes are not proper <strong>objects</strong>; therefore, they don&#39;t fit into object-oriented world. They were inherited from <strong>procedural</strong> programming, mostly because we were used to a functional decomposition paradigm back then.</p><p>Assuming you agree with the arguments and want to stop using utility classes, I&#39;ll show by example how these creatures can be replaced with proper <a href="/2016/07/14/who-is-object.html">objects</a>.</p><h2 id="procedural-example">Procedural Example</h2><p>Say, for instance, you want to read a text file, split it into lines, trim every line and then save the results in another file. This is can be done with <a href="http://commons.apache.org/proper/commons-io/javadocs/api-2.5/org/apache/commons/io/FileUtils.html"><code>FileUtils</code></a> from Apache Commons:</p><figure class="highlight"><pre><code class="language-java" data-lang="java"><span></span><span class="kt">void</span> <span class="nf">transform</span><span class="o">(</span><span class="n">File</span> <span class="n">in</span><span class="o">,</span> <span class="n">File</span> <span class="n">out</span><span class="o">)</span> <span class="o">{</span>
  <span class="n">Collection</span><span class="o">&lt;</span><span class="n">String</span><span class="o">&gt;</span> <span class="n">src</span> <span class="o">=</span> <span class="n">FileUtils</span><span class="o">.</span><span class="na">readLines</span><span class="o">(</span><span class="n">in</span><span class="o">,</span> <span class="s">&quot;UTF-8&quot;</span><span class="o">);</span>
  <span class="n">Collection</span><span class="o">&lt;</span><span class="n">String</span><span class="o">&gt;</span> <span class="n">dest</span> <span class="o">=</span> <span class="k">new</span> <span class="n">ArrayList</span><span class="o">&lt;&gt;(</span><span class="n">src</span><span class="o">.</span><span class="na">size</span><span class="o">());</span>
  <span class="k">for</span> <span class="o">(</span><span class="n">String</span> <span class="n">line</span> <span class="o">:</span> <span class="n">src</span><span class="o">)</span> <span class="o">{</span>
    <span class="n">dest</span><span class="o">.</span><span class="na">add</span><span class="o">(</span><span class="n">line</span><span class="o">.</span><span class="na">trim</span><span class="o">());</span>
  <span class="o">}</span>
  <span class="n">FileUtils</span><span class="o">.</span><span class="na">writeLines</span><span class="o">(</span><span class="n">out</span><span class="o">,</span> <span class="n">dest</span><span class="o">,</span> <span class="s">&quot;UTF-8&quot;</span><span class="o">);</span>
<span class="o">}</span></code></pre></figure><p>The above code may look clean; however, this is procedural programming, not object-oriented. We are manipulating data (bytes and bits) and explicitly instructing the computer from where to retrieve them and then where to put them on every single line of code. We&#39;re defining <em>a procedure of execution</em>.</p><h2 id="object-oriented-alternative">Object-Oriented Alternative</h2><p>In an object-oriented paradigm, we should instantiate and compose objects, thus letting them manage data when and how <em>they</em> desire. Instead of calling supplementary static functions, we should create objects that are capable of exposing the behavior we are seeking:</p><figure class="highlight"><pre><code class="language-java" data-lang="java"><span></span><span class="kd">public</span> <span class="kd">class</span> <span class="nc">Max</span> <span class="kd">implements</span> <span class="n">Number</span> <span class="o">{</span>
  <span class="kd">private</span> <span class="kd">final</span> <span class="kt">int</span> <span class="n">a</span><span class="o">;</span>
  <span class="kd">private</span> <span class="kd">final</span> <span class="kt">int</span> <span class="n">b</span><span class="o">;</span>
  <span class="kd">public</span> <span class="nf">Max</span><span class="o">(</span><span class="kt">int</span> <span class="n">x</span><span class="o">,</span> <span class="kt">int</span> <span class="n">y</span><span class="o">)</span> <span class="o">{</span>
    <span class="k">this</span><span class="o">.</span><span class="na">a</span> <span class="o">=</span> <span class="n">x</span><span class="o">;</span>
    <span class="k">this</span><span class="o">.</span><span class="na">b</span> <span class="o">=</span> <span class="n">y</span><span class="o">;</span>
  <span class="o">}</span>
  <span class="nd">@Override</span>
  <span class="kd">public</span> <span class="kt">int</span> <span class="nf">intValue</span><span class="o">()</span> <span class="o">{</span>
    <span class="k">return</span> <span class="k">this</span><span class="o">.</span><span class="na">a</span> <span class="o">&gt;</span> <span class="k">this</span><span class="o">.</span><span class="na">b</span> <span class="o">?</span> <span class="k">this</span><span class="o">.</span><span class="na">a</span> <span class="o">:</span> <span class="k">this</span><span class="o">.</span><span class="na">b</span><span class="o">;</span>
  <span class="o">}</span>
<span class="o">}</span></code></pre></figure><p>This procedural call:</p><figure class="highlight"><pre><code class="language-java" data-lang="java"><span></span><span class="kt">int</span> <span class="n">max</span> <span class="o">=</span> <span class="n">NumberUtils</span><span class="o">.</span><span class="na">max</span><span class="o">(</span><span class="mi">10</span><span class="o">,</span> <span class="mi">5</span><span class="o">);</span></code></pre></figure><p>Will become object-oriented:</p><figure class="highlight"><pre><code class="language-java" data-lang="java"><span></span><span class="kt">int</span> <span class="n">max</span> <span class="o">=</span> <span class="k">new</span> <span class="n">Max</span><span class="o">(</span><span class="mi">10</span><span class="o">,</span> <span class="mi">5</span><span class="o">).</span><span class="na">intValue</span><span class="o">();</span></code></pre></figure><p>Potato, potato? Not really; just read on...</p><h2 id="objects-instead-of-data-structures">Objects Instead of Data Structures</h2><p>This is how I would design the same file-transforming functionality as above but in an object-oriented manner:</p><figure class="highlight"><pre><code class="language-java" data-lang="java"><span></span><span class="kt">void</span> <span class="nf">transform</span><span class="o">(</span><span class="n">File</span> <span class="n">in</span><span class="o">,</span> <span class="n">File</span> <span class="n">out</span><span class="o">)</span> <span class="o">{</span>
  <span class="n">Collection</span><span class="o">&lt;</span><span class="n">String</span><span class="o">&gt;</span> <span class="n">src</span> <span class="o">=</span> <span class="k">new</span> <span class="n">Trimmed</span><span class="o">(</span>
    <span class="k">new</span> <span class="n">FileLines</span><span class="o">(</span><span class="k">new</span> <span class="n">UnicodeFile</span><span class="o">(</span><span class="n">in</span><span class="o">))</span>
  <span class="o">);</span>
  <span class="n">Collection</span><span class="o">&lt;</span><span class="n">String</span><span class="o">&gt;</span> <span class="n">dest</span> <span class="o">=</span> <span class="k">new</span> <span class="n">FileLines</span><span class="o">(</span>
    <span class="k">new</span> <span class="n">UnicodeFile</span><span class="o">(</span><span class="n">out</span><span class="o">)</span>
  <span class="o">);</span>
  <span class="n">dest</span><span class="o">.</span><span class="na">addAll</span><span class="o">(</span><span class="n">src</span><span class="o">);</span>
<span class="o">}</span></code></pre></figure><p><code>FileLines</code> implements <code>Collection&lt;String&gt;</code> and encapsulates all file reading and writing operations. An instance of <code>FileLines</code> behaves exactly as a collection of strings and hides all I/O operations. When we iterate it---a file is being read. When we <code>addAll()</code> to it---a file is being written.</p><p><code>Trimmed</code> also implements <code>Collection&lt;String&gt;</code> and encapsulates a collection of strings (<a href="http://en.wikipedia.org/wiki/Decorator_pattern">Decorator pattern</a>). Every time the next line is retrieved, it gets trimmed.</p><p>All classes taking participation in the snippet are rather small: <code>Trimmed</code>, <code>FileLines</code>, and <code>UnicodeFile</code>. Each of them is responsible for its own single feature, thus following perfectly the <a href="http://en.wikipedia.org/wiki/Single_responsibility_principle">single responsibility principle</a>.</p><aside class='youtube'> <a href='https://www.youtube.com/watch?v=D0dqC_3Bch8'><div class='box'> <img src='https://i.ytimg.com/vi/D0dqC_3Bch8/mqdefault.jpg' alt='YouTube video #D0dqC_3Bch8'/><div class='play'><i class='icon icon-play'></i></div></div></a><div>Objects vs. Static Methods (webinar #1); 8 April 2015.</div></aside><p>On our side, as users of the library, this may be not so important, but for their developers it is an imperative. It is much easier to develop, maintain and unit-test class <code>FileLines</code> rather than using a <code>readLines()</code> method in a 80+ methods and 3000 lines utility class <code>FileUtils</code>. Seriously, look at <a href="https://github.com/apache/commons-io/blob/commons-io-2.5/src/main/java/org/apache/commons/io/FileUtils.java">its source code</a>.</p><p>An object-oriented approach enables lazy execution. The <code>in</code> file is not read until its data is required. If we fail to open <code>out</code> due to some I/O error, the first file won&#39;t even be touched. The whole show starts only after we call <code>addAll()</code>.</p><p>All lines in the second snippet, except the last one, instantiate and compose smaller objects into bigger ones. This object composition is rather cheap for the CPU since it doesn&#39;t cause any data transformations.</p><p>Besides that, it is obvious that the second script runs in O(1) space, while the first one executes in O(n). This is the consequence of our procedural approach to data in the first script.</p><p>In an object-oriented world, there is no data; there are only objects and their behavior!</p></div></article></div><div class="wrapper"> <related-posts /></div><div class="disqus" role="complementary"><p class="disqus_hint"> Please, use <a href="https://help.disqus.com/commenting/what-html-tags-are-allowed-within-comments">syntax highlighting</a> in your comments, to make them more readable.</p><div id="disqus_thread" class="disqus-thread"> <a>&nbsp;</a></div><script> var disqus_config = function () { this.page.url = document.location.href.split('?')[0].split('#')[0].replace('https://', 'http://'); this.page.identifier = this.page.url; }; (function() { var d = document, s = d.createElement('script'); s.src = '//yegor256.disqus.com/embed.js'; s.setAttribute('data-timestamp', +new Date()); (d.head || d.body).appendChild(s); })(); </script> <noscript><div><p class="red"> JavaScript is disabled in your browser, that's why you can't see comments under this post.</p></div></noscript></div><div class="wrapper"> <footer class="footer"><p> &copy; <span itemscope="" itemprop="copyrightHolder" itemtype="http://schema.org/Person"> <span itemprop="name">Yegor Bugayenko</span> </span> 2014&ndash;<span itemprop="copyrightYear">2018</span></p></footer></div></section><div class="wrapper unprintable" style="text-align:center;margin-top:2em;"> <a href="http://www.sixnines.io/h/3ba1652f"> <img src="//www.sixnines.io/b/3ba1652f?style=flat" alt="sixnines availability badge"/> </a></div><script src="//code.jquery.com/jquery-1.9.0.min.js"></script> <script src="/js/all.js?a0e0d018c07"></script> <script>var disqus_shortname = 'yegor256';</script> <script id="dsq-count-scr" src="//yegor256.disqus.com/count.js" async="async"></script> <script> (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){ (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o), m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m) })(window,document,'script','//www.google-analytics.com/analytics.js','ga'); ga('create', 'UA-1963507-32', 'auto'); ga('send', 'pageview'); </script> <script> Cd=document;Cr="&"+Math.random();Cp="&s=1"; Cd.cookie="b=b";if(Cd.cookie)Cp+="&c=1"; Cp+="&t="+(new Date()).getTimezoneOffset(); if(self!=top)Cp+="&f=1"; </script> <script> if(navigator.javaEnabled())Cp+="&j=1"; </script> <script> if(typeof(screen)!='undefined')Cp+="&w="+screen.width+"&h="+ screen.height+"&d="+(screen.colorDepth?screen.colorDepth:screen.pixelDepth); </script> <script> Cd.write("<img src='//c.hit.ua/hit?i=95870&g=0&x=2"+Cp+Cr+ "&r="+escape(Cd.referrer)+"&u="+escape(window.location.href)+ "' border='0' wi"+"dth='1' he"+"ight='1'/>"); </script> <script type="application/ld+json"> { "@context": "http://schema.org", "@type": "Person", "name": "Yegor Bugayenko", "url": "http://www.yegor256.com", "sameAs": [ "https://www.facebook.com/yegor256", "https://instagram.com/yegor256", "https://www.linkedin.com/in/yegor256", "https://twitter.com/yegor256", "https://github.com/yegor256", "https://www.pinterest.com/yegor256/" ] } </script> </body> </html> </article></div></section><div class="wrapper unprintable" style="text-align:center;margin-top:2em;"> <a href="http://www.sixnines.io/h/3ba1652f"> <img src="//www.sixnines.io/b/3ba1652f?style=flat" alt="sixnines availability badge"/> </a></div><script src="//code.jquery.com/jquery-1.9.0.min.js"></script> <script src="/js/all.js?a0e0d018c07"></script> <script>var disqus_shortname = 'yegor256';</script> <script id="dsq-count-scr" src="//yegor256.disqus.com/count.js" async="async"></script> <script> (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){ (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o), m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m) })(window,document,'script','//www.google-analytics.com/analytics.js','ga'); ga('create', 'UA-1963507-32', 'auto'); ga('send', 'pageview'); </script> <script> Cd=document;Cr="&"+Math.random();Cp="&s=1"; Cd.cookie="b=b";if(Cd.cookie)Cp+="&c=1"; Cp+="&t="+(new Date()).getTimezoneOffset(); if(self!=top)Cp+="&f=1"; </script> <script> if(navigator.javaEnabled())Cp+="&j=1"; </script> <script> if(typeof(screen)!='undefined')Cp+="&w="+screen.width+"&h="+ screen.height+"&d="+(screen.colorDepth?screen.colorDepth:screen.pixelDepth); </script> <script> Cd.write("<img src='//c.hit.ua/hit?i=95870&g=0&x=2"+Cp+Cr+ "&r="+escape(Cd.referrer)+"&u="+escape(window.location.href)+ "' border='0' wi"+"dth='1' he"+"ight='1'/>"); </script> <script type="application/ld+json"> { "@context": "http://schema.org", "@type": "Person", "name": "Yegor Bugayenko", "url": "http://www.yegor256.com", "sameAs": [ "https://www.facebook.com/yegor256", "https://instagram.com/yegor256", "https://www.linkedin.com/in/yegor256", "https://twitter.com/yegor256", "https://github.com/yegor256", "https://www.pinterest.com/yegor256/" ] } </script> </body> </html>
