<!DOCTYPE html> <html xmlns="http://www.w3.org/1999/xhtml" lang="en-US" xml:lang="en-US" itemscope="" itemtype="http://schema.org/WebSite"> <head> <meta charset="utf-8"/> <meta name="description" content="{&quot;layout&quot;=&gt;&quot;tag-index&quot;, &quot;posts&quot;=&gt;[#&lt;Jekyll::Document _posts/2014/aug/2014-08-15-retry-java-method-on-exception.md collection=posts&gt;, #&lt;Jekyll::Document _posts/2014/aug/2014-08-03-cacheable-java-annotation.md collection=posts&gt;, #&lt;Jekyll::Document _posts/2014/jun/2014-06-20-limit-method-execution-time.md collection=posts&gt;, #&lt;Jekyll::Document _posts/2014/jun/2014-06-01-aop-aspectj-java-method-logging.md collection=posts&gt;], &quot;tag&quot;=&gt;&quot;aop&quot;, &quot;content&quot;=&gt;&quot;&quot;, &quot;dir&quot;=&gt;&quot;/tag/&quot;, &quot;name&quot;=&gt;&quot;aop.html&quot;, &quot;path&quot;=&gt;&quot;tag/aop.html&quot;, &quot;url&quot;=&gt;&quot;/tag/aop&quot;, &quot;title&quot;=&gt;&quot;aop&quot;, &quot;description&quot;=&gt;&quot;aop: more about aop in this collection of recently published articles... the list is updated every few weeks.&quot;}" /> <meta name="keywords" content="{&quot;layout&quot;=&gt;&quot;tag-index&quot;, &quot;posts&quot;=&gt;[#&lt;Jekyll::Document _posts/2014/aug/2014-08-15-retry-java-method-on-exception.md collection=posts&gt;, #&lt;Jekyll::Document _posts/2014/aug/2014-08-03-cacheable-java-annotation.md collection=posts&gt;, #&lt;Jekyll::Document _posts/2014/jun/2014-06-20-limit-method-execution-time.md collection=posts&gt;, #&lt;Jekyll::Document _posts/2014/jun/2014-06-01-aop-aspectj-java-method-logging.md collection=posts&gt;], &quot;tag&quot;=&gt;&quot;aop&quot;, &quot;content&quot;=&gt;&quot;&quot;, &quot;dir&quot;=&gt;&quot;/tag/&quot;, &quot;name&quot;=&gt;&quot;aop.html&quot;, &quot;path&quot;=&gt;&quot;tag/aop.html&quot;, &quot;url&quot;=&gt;&quot;/tag/aop&quot;, &quot;title&quot;=&gt;&quot;aop&quot;, &quot;description&quot;=&gt;&quot;aop: more about aop in this collection of recently published articles... the list is updated every few weeks.&quot;}" /> <meta name="viewport" content="width=device-width,minimum-scale=1,initial-scale=1"/> <meta name="google-site-verification" content="JEj_gQr2CPe2QKGw8XdMz0R7VboQIUbX3FlM-lwTq-8" /> <meta name="author" content="Yegor Bugayenko"> <meta name="og:site_name" content="Yegor Bugayenko"/> <meta name="og:type" content="article" /> <meta name="og:locale" content="en_US" /> <meta name="twitter:account_id" content="4503599630178231" /> <meta name="twitter:creator" content="@yegor256"/> <meta name="twitter:site" content="@yegor256"/> <meta name="twitter:title" property="og:title" content="aop"/> <meta name="twitter:description" property="og:description" content="{&quot;layout&quot;=&gt;&quot;tag-index&quot;, &quot;posts&quot;=&gt;[#&lt;Jekyll::Document _posts/2014/aug/2014-08-15-retry-java-method-on-exception.md collection=posts&gt;, #&lt;Jekyll::Document _posts/2014/aug/2014-08-03-cacheable-java-annotation.md collection=posts&gt;, #&lt;Jekyll::Document _posts/2014/jun/2014-06-20-limit-method-execution-time.md collection=posts&gt;, #&lt;Jekyll::Document _posts/2014/jun/2014-06-01-aop-aspectj-java-method-logging.md collection=posts&gt;], &quot;tag&quot;=&gt;&quot;aop&quot;, &quot;content&quot;=&gt;&quot;&quot;, &quot;dir&quot;=&gt;&quot;/tag/&quot;, &quot;name&quot;=&gt;&quot;aop.html&quot;, &quot;path&quot;=&gt;&quot;tag/aop.html&quot;, &quot;url&quot;=&gt;&quot;/tag/aop&quot;, &quot;title&quot;=&gt;&quot;aop&quot;, &quot;description&quot;=&gt;&quot;aop: more about aop in this collection of recently published articles... the list is updated every few weeks.&quot;}"/> <meta name="twitter:url" property="og:url" content="https://www.yegor256.com/tag/aop"/> <meta name="telegram:channel" content="AAAAAEJFMRzsRTRxM3ec6A"/> <link rel="search" type="application/opensearchdescription+xml" href="/opensearch.xml" title="yegor256" /> <link rel="shortcut icon" href="/favicon.ico?7d5b276b9b5"/> <link rel="apple-touch-icon" href="/favicon.ico?7d5b276b9b5"/> <link rel="alternate" type="application/rss+xml" title="RSS for yegor256.com" href="https://www.yegor256.com/rss.xml"/> <link rel="stylesheet" href="/css/layout.css?7d5b276b9b5"/> <link rel="stylesheet" href="/css/icons.css?7d5b276b9b5"/> <link rel="canonical" href="https://www.yegor256.com/tag/aop" /> <link rel="amphtml" href="https://www.yegor256.com/tag/aop" /> <title>aop </title> </head> <body><div class="wrapper"> <aside class="header-toggle unprintable" id="header-toggle" title="Show the menu" onclick="$('#header').show();$('#header-toggle').hide();">&#9776;</aside> <header class="header" id="header"><div class="face"> <a href="/about-me.html#form" class="sub" title="Click to subscribe to my monthly newsletter"><span>Subscribe</span></a> <a href="/about-me.html" style="position:relative;"> <img src="/images/face-256x256.jpg" class="photo" alt="Yegor Bugayenko"/> </a></div><nav><ul class="menu social notranslate"> <li><a href="https://twitter.com/intent/follow?screen_name=yegor256" rel="nofollow" title="Follow me on Twitter"><i class="icon icon-twitter notranslate" aria-hidden="true"></i></a></li> <li><a href="/rss.xml" rel="nofollow" title="Subscribe to my RSS feed"><i class="icon icon-rss notranslate" aria-hidden="true"></i></a></li> <li><a itemprop="sameAs" href="https://github.com/yegor256" rel="nofollow" title="My GitHub profile"><i class="icon icon-github notranslate" aria-hidden="true"></i></a></li> <li><a itemprop="sameAs" href="http://stackoverflow.com/users/187141/yegor256" rel="nofollow" title="My StackOverflow profile"><i class="icon icon-stackoverflow notranslate" aria-hidden="true"></i></a></li> <li><a itemprop="sameAs" href="https://www.facebook.com/yegor256" rel="nofollow" title="Follow me on Facebook"><i class="icon icon-facebook notranslate" aria-hidden="true"></i></a></li> <li><a itemprop="sameAs" href="https://instagram.com/yegor256" rel="nofollow" title="Follow me on Instagram"><i class="icon icon-instagram notranslate" aria-hidden="true"></i></a></li> <li><a itemprop="sameAs" href="https://www.linkedin.com/in/yegor256" rel="nofollow" title="My LinkedIn profile"><i class="icon icon-linkedin notranslate" aria-hidden="true"></i></a></li> <li><a itemprop="sameAs" href="https://www.youtube.com/c/yegor256?sub_confirmation=1" rel="nofollow" title="My Youtube video channel"><i class="icon icon-youtube notranslate" aria-hidden="true"></i></a></li> <li><a itemprop="sameAs" href="https://www.pinterest.com/yegor256/" rel="nofollow" title="My Pinterest boards"><i class="icon icon-pinterest notranslate" aria-hidden="true"></i></a></li> <li><a itemprop="sameAs" href="https://angel.co/yegor256" rel="nofollow" title="My AngelList profile"><i class="icon icon-angellist notranslate" aria-hidden="true"></i></a></li> <li><a href="https://soundcloud.com/yegor256" rel="nofollow" title="My podcast"><i class="icon icon-podcast notranslate" aria-hidden="true"></i></a></li> <li><a href="https://itunes.apple.com/us/podcast/yegor256-podcast/id1150826721" rel="nofollow" title="My iTunes podcast"><i class="icon icon-itunes notranslate" aria-hidden="true"></i></a></li> <li><a href="https://t.me/yegor256news" rel="nofollow" title="My Telegram public channel"><i class="icon icon-telegram notranslate" aria-hidden="true"></i></a></li> <li><a href="mailto:blog@yegor256.com" rel="nofollow" title="Email me any time"><i class="icon icon-mail notranslate" aria-hidden="true"></i></a></li></ul><ul class="menu"> <li><a href="/" title="Home page">Home</a></li> <li /tag/aop><a href="/best.html" title="Best articles to read">12&#160;Best</a></li> <li /tag/aop><a href="/contents.html" title="The contents of the entire blog">All&#160;292</a></li> <li /tag/aop><a href="/webinars.html" title="My webinars">Webinars</a></li> <li /tag/aop><a href="/talks.html" title="Future and past conference talks">Talks</a></li> <li /tag/aop><a href="/books.html" title="The books I wrote">Books</a></li> <li /tag/aop><a href="/papers.html" title="My academic papers and patents">Papers</a></li> <li /tag/aop><a href="/pets.html" title="My loved pet projects">Pets</a></li> <li /tag/aop class="highlighted"><a href="/trainings.html" title="On-site trainings">Trainings</a></li> <li /tag/aop><a href="/award.html" title="Software quality award">Award</a></li> <li /tag/aop><a href="/testimonials.html" title="What some people say about me">Testimonials</a></li> <li /tag/aop><a href="/shift-m.html" title="Audio podcast about project management">Shift-M</a></li> <li /tag/aop><a href="/paintings.html" title="My paintings for sale">Paintings</a></li> <li><a href="https://ru.yegor256.com/" title="Немного на русском языке">По-русски</a></li></ul></nav><div class="search"> <form method="get" action="https://www.google.com/search" itemprop="potentialAction" itemscope="" itemtype="http://schema.org/SearchAction"> <meta itemprop="target" content="https://www.google.com/search?q={q}"/> <input name="sitesearch" value="yegor256.com" type="hidden"/> <input itemprop="query-input" type="text" id="search-query" class="field field-text" required="required" onfocus="$('.google').css('visibility', 'visible');" name="q" placeholder="Search..." autocomplete="off"/> <input type="image" src="/images/google-search-icon.svg" class="google" title="Search via Google" alt="Search via Google"/> </form></div><div class="hot"><ul></ul></div></header></div><section itemscope="" itemtype="http://schema.org/BlogPosting"><div class="wrapper"> <header itemprop="name"><h1>4 posts about aop</h1></header> <article itemprop="articleBody"> <!DOCTYPE html> <html xmlns="http://www.w3.org/1999/xhtml" lang="en-US" xml:lang="en-US" itemscope="" itemtype="http://schema.org/WebSite"> <head> <meta charset="utf-8"/> <meta name="description" content="&lt;figure class=&quot;badge&quot;&gt;&lt;a href=&quot;http://aspects.jcabi.com&quot;&gt;&lt;img src=&quot;http://img.jcabi.com/logo-square.svg&quot; style=&quot;width:64px;max-width:100%;&quot; alt=&quot;badge&quot; /&gt;&lt;/a&gt;&lt;/figure&gt; &lt;p&gt;If you have a method that fails occasionally and you want to retry it a few times before &lt;a href=&quot;/2015/12/01/rethrow-exceptions.html&quot;&gt;throwing&lt;/a&gt; an exception. &lt;a href=&quot;http://aspects.jcabi.com/annotation-retryonfailure.html&quot;&gt;&lt;code&gt;@RetryOnFailure&lt;/code&gt;&lt;/a&gt; from &lt;a href=&quot;http://aspects.jcabi.com&quot;&gt;jcabi-aspects&lt;/a&gt; can help. For example, if you’re downloading the following web page:&lt;/p&gt; &lt;figure class=&quot;highlight&quot;&gt;&lt;pre&gt;&lt;code class=&quot;language-java&quot; data-lang=&quot;java&quot;&gt;&lt;span&gt;&lt;/span&gt;&lt;span class=&quot;nd&quot;&gt;@RetryOnFailure&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;(&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;attempts&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;mi&quot;&gt;3&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;delay&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;mi&quot;&gt;10&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;unit&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;TimeUnit&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;na&quot;&gt;SECONDS&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;kd&quot;&gt;public&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;String&lt;/span&gt; &lt;span class=&quot;nf&quot;&gt;load&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;URL&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;url&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;{&lt;/span&gt; &lt;span class=&quot;k&quot;&gt;return&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;url&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;na&quot;&gt;openConnection&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;().&lt;/span&gt;&lt;span class=&quot;na&quot;&gt;getContent&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;();&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;}&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/figure&gt; &lt;p&gt;This method call will throw an exception only after three failed executions with a ten seconds interval between them.&lt;/p&gt; &lt;!--more--&gt; &lt;p&gt;&lt;a href=&quot;/2014/06/01/aop-aspectj-java-method-logging.html&quot;&gt;This post&lt;/a&gt; explains how &lt;a href=&quot;http://aspects.jcabi.com&quot;&gt;jcabi-aspects&lt;/a&gt; works with binary weaving. This mechanism integrates AspectJ with your code.&lt;/p&gt; &lt;p&gt;When method &lt;code&gt;load()&lt;/code&gt; from the example above is called, this is what is happening behind the scene (pseudo-code):&lt;/p&gt; &lt;figure class=&quot;highlight&quot;&gt;&lt;pre&gt;&lt;code class=&quot;language-java&quot; data-lang=&quot;java&quot;&gt;&lt;span&gt;&lt;/span&gt;&lt;span class=&quot;k&quot;&gt;while&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;attempts&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;++&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;&amp;lt;&lt;/span&gt; &lt;span class=&quot;mi&quot;&gt;3&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;{&lt;/span&gt; &lt;span class=&quot;k&quot;&gt;try&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;{&lt;/span&gt; &lt;span class=&quot;k&quot;&gt;return&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;original_load&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;url&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;);&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;}&lt;/span&gt; &lt;span class=&quot;k&quot;&gt;catch&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;Throwable&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;ex&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;{&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;log&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;s&quot;&gt;&amp;quot;we failed, will try again in 10 seconds&amp;quot;&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;);&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;sleep&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;mi&quot;&gt;10&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;);&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;}&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;}&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/figure&gt; &lt;p&gt;This approach may be very useful in the following situations (based on my experience):&lt;/p&gt; &lt;ul&gt; &lt;li&gt; &lt;p&gt;Executing &lt;a href=&quot;/2014/08/18/fluent-jdbc-decorator.html&quot;&gt;JDBC&lt;/a&gt; &lt;code&gt;SELECT&lt;/code&gt; statements&lt;/p&gt; &lt;/li&gt; &lt;li&gt; &lt;p&gt;Loading data from HTTP, &lt;a href=&quot;/2014/05/26/amazon-s3-java-oop-adapter.html&quot;&gt;S3&lt;/a&gt;, FTP, etc resources&lt;/p&gt; &lt;/li&gt; &lt;li&gt; &lt;p&gt;Uploading data over the network&lt;/p&gt; &lt;/li&gt; &lt;li&gt; &lt;p&gt;Fetching data through RESTful stateless API-s&lt;/p&gt; &lt;/li&gt; &lt;/ul&gt; &lt;p&gt;The project is in &lt;a href=&quot;https://github.com/jcabi/jcabi-aspects&quot;&gt;GitHub&lt;/a&gt;.&lt;/p&gt; " /> <meta name="keywords" content="next, path, output, content, previous, url, relative_path, id, collection, excerpt, draft, categories, layout, title, date, tags, description, keywords, slug, ext" /> <meta name="viewport" content="width=device-width,minimum-scale=1,initial-scale=1"/> <meta name="google-site-verification" content="JEj_gQr2CPe2QKGw8XdMz0R7VboQIUbX3FlM-lwTq-8" /> <meta name="author" content="Yegor Bugayenko"> <meta name="article:published_time" content="2014-08-15 00:00:00 +0000"> <meta name="og:site_name" content="Yegor Bugayenko"/> <meta name="og:type" content="article" /> <meta name="og:locale" content="en_US" /> <meta name="twitter:account_id" content="4503599630178231" /> <meta name="twitter:creator" content="@yegor256"/> <meta name="twitter:site" content="@yegor256"/> <meta name="twitter:title" property="og:title" content="How to Retry Java Method Call on Exception"/> <meta name="twitter:description" property="og:description" content="&lt;figure class=&quot;badge&quot;&gt;&lt;a href=&quot;http://aspects.jcabi.com&quot;&gt;&lt;img src=&quot;http://img.jcabi.com/logo-square.svg&quot; style=&quot;width:64px;max-width:100%;&quot; alt=&quot;badge&quot; /&gt;&lt;/a&gt;&lt;/figure&gt; &lt;p&gt;If you have a method that fails occasionally and you want to retry it a few times before &lt;a href=&quot;/2015/12/01/rethrow-exceptions.html&quot;&gt;throwing&lt;/a&gt; an exception. &lt;a href=&quot;http://aspects.jcabi.com/annotation-retryonfailure.html&quot;&gt;&lt;code&gt;@RetryOnFailure&lt;/code&gt;&lt;/a&gt; from &lt;a href=&quot;http://aspects.jcabi.com&quot;&gt;jcabi-aspects&lt;/a&gt; can help. For example, if you’re downloading the following web page:&lt;/p&gt; &lt;figure class=&quot;highlight&quot;&gt;&lt;pre&gt;&lt;code class=&quot;language-java&quot; data-lang=&quot;java&quot;&gt;&lt;span&gt;&lt;/span&gt;&lt;span class=&quot;nd&quot;&gt;@RetryOnFailure&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;(&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;attempts&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;mi&quot;&gt;3&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;delay&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;mi&quot;&gt;10&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;unit&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;TimeUnit&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;na&quot;&gt;SECONDS&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;kd&quot;&gt;public&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;String&lt;/span&gt; &lt;span class=&quot;nf&quot;&gt;load&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;URL&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;url&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;{&lt;/span&gt; &lt;span class=&quot;k&quot;&gt;return&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;url&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;na&quot;&gt;openConnection&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;().&lt;/span&gt;&lt;span class=&quot;na&quot;&gt;getContent&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;();&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;}&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/figure&gt; &lt;p&gt;This method call will throw an exception only after three failed executions with a ten seconds interval between them.&lt;/p&gt; &lt;!--more--&gt; &lt;p&gt;&lt;a href=&quot;/2014/06/01/aop-aspectj-java-method-logging.html&quot;&gt;This post&lt;/a&gt; explains how &lt;a href=&quot;http://aspects.jcabi.com&quot;&gt;jcabi-aspects&lt;/a&gt; works with binary weaving. This mechanism integrates AspectJ with your code.&lt;/p&gt; &lt;p&gt;When method &lt;code&gt;load()&lt;/code&gt; from the example above is called, this is what is happening behind the scene (pseudo-code):&lt;/p&gt; &lt;figure class=&quot;highlight&quot;&gt;&lt;pre&gt;&lt;code class=&quot;language-java&quot; data-lang=&quot;java&quot;&gt;&lt;span&gt;&lt;/span&gt;&lt;span class=&quot;k&quot;&gt;while&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;attempts&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;++&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;&amp;lt;&lt;/span&gt; &lt;span class=&quot;mi&quot;&gt;3&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;{&lt;/span&gt; &lt;span class=&quot;k&quot;&gt;try&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;{&lt;/span&gt; &lt;span class=&quot;k&quot;&gt;return&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;original_load&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;url&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;);&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;}&lt;/span&gt; &lt;span class=&quot;k&quot;&gt;catch&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;Throwable&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;ex&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;{&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;log&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;s&quot;&gt;&amp;quot;we failed, will try again in 10 seconds&amp;quot;&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;);&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;sleep&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;mi&quot;&gt;10&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;);&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;}&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;}&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/figure&gt; &lt;p&gt;This approach may be very useful in the following situations (based on my experience):&lt;/p&gt; &lt;ul&gt; &lt;li&gt; &lt;p&gt;Executing &lt;a href=&quot;/2014/08/18/fluent-jdbc-decorator.html&quot;&gt;JDBC&lt;/a&gt; &lt;code&gt;SELECT&lt;/code&gt; statements&lt;/p&gt; &lt;/li&gt; &lt;li&gt; &lt;p&gt;Loading data from HTTP, &lt;a href=&quot;/2014/05/26/amazon-s3-java-oop-adapter.html&quot;&gt;S3&lt;/a&gt;, FTP, etc resources&lt;/p&gt; &lt;/li&gt; &lt;li&gt; &lt;p&gt;Uploading data over the network&lt;/p&gt; &lt;/li&gt; &lt;li&gt; &lt;p&gt;Fetching data through RESTful stateless API-s&lt;/p&gt; &lt;/li&gt; &lt;/ul&gt; &lt;p&gt;The project is in &lt;a href=&quot;https://github.com/jcabi/jcabi-aspects&quot;&gt;GitHub&lt;/a&gt;.&lt;/p&gt; "/> <meta name="twitter:url" property="og:url" content="https://www.yegor256.com/2014/08/15/retry-java-method-on-exception.html"/> <meta name="telegram:channel" content="AAAAAEJFMRzsRTRxM3ec6A"/> <link rel="search" type="application/opensearchdescription+xml" href="/opensearch.xml" title="yegor256" /> <link rel="shortcut icon" href="/favicon.ico?7d5b276b9b5"/> <link rel="apple-touch-icon" href="/favicon.ico?7d5b276b9b5"/> <link rel="alternate" type="application/rss+xml" title="RSS for yegor256.com" href="https://www.yegor256.com/rss.xml"/> <link rel="stylesheet" href="/css/layout.css?7d5b276b9b5"/> <link rel="stylesheet" href="/css/icons.css?7d5b276b9b5"/> <link rel="canonical" href="https://www.yegor256.com/2014/08/15/retry-java-method-on-exception.html" /> <link rel="amphtml" href="https://www.yegor256.com/2014/08/15/retry-java-method-on-exception.amp.html" /> <title>How to Retry Java Method Call on Exception </title> </head> <body><div class="wrapper"> <aside class="header-toggle unprintable" id="header-toggle" title="Show the menu" onclick="$('#header').show();$('#header-toggle').hide();">&#9776;</aside> <header class="header" id="header"><div class="face"> <a href="/about-me.html#form" class="sub" title="Click to subscribe to my monthly newsletter"><span>Subscribe</span></a> <a href="/about-me.html" style="position:relative;"> <img src="/images/face-256x256.jpg" class="photo" alt="Yegor Bugayenko"/> </a></div><nav><ul class="menu social notranslate"> <li><a href="https://twitter.com/intent/follow?screen_name=yegor256" rel="nofollow" title="Follow me on Twitter"><i class="icon icon-twitter notranslate" aria-hidden="true"></i></a></li> <li><a href="/rss.xml" rel="nofollow" title="Subscribe to my RSS feed"><i class="icon icon-rss notranslate" aria-hidden="true"></i></a></li> <li><a itemprop="sameAs" href="https://github.com/yegor256" rel="nofollow" title="My GitHub profile"><i class="icon icon-github notranslate" aria-hidden="true"></i></a></li> <li><a itemprop="sameAs" href="http://stackoverflow.com/users/187141/yegor256" rel="nofollow" title="My StackOverflow profile"><i class="icon icon-stackoverflow notranslate" aria-hidden="true"></i></a></li> <li><a itemprop="sameAs" href="https://www.facebook.com/yegor256" rel="nofollow" title="Follow me on Facebook"><i class="icon icon-facebook notranslate" aria-hidden="true"></i></a></li> <li><a itemprop="sameAs" href="https://instagram.com/yegor256" rel="nofollow" title="Follow me on Instagram"><i class="icon icon-instagram notranslate" aria-hidden="true"></i></a></li> <li><a itemprop="sameAs" href="https://www.linkedin.com/in/yegor256" rel="nofollow" title="My LinkedIn profile"><i class="icon icon-linkedin notranslate" aria-hidden="true"></i></a></li> <li><a itemprop="sameAs" href="https://www.youtube.com/c/yegor256?sub_confirmation=1" rel="nofollow" title="My Youtube video channel"><i class="icon icon-youtube notranslate" aria-hidden="true"></i></a></li> <li><a itemprop="sameAs" href="https://www.pinterest.com/yegor256/" rel="nofollow" title="My Pinterest boards"><i class="icon icon-pinterest notranslate" aria-hidden="true"></i></a></li> <li><a itemprop="sameAs" href="https://angel.co/yegor256" rel="nofollow" title="My AngelList profile"><i class="icon icon-angellist notranslate" aria-hidden="true"></i></a></li> <li><a href="https://soundcloud.com/yegor256" rel="nofollow" title="My podcast"><i class="icon icon-podcast notranslate" aria-hidden="true"></i></a></li> <li><a href="https://itunes.apple.com/us/podcast/yegor256-podcast/id1150826721" rel="nofollow" title="My iTunes podcast"><i class="icon icon-itunes notranslate" aria-hidden="true"></i></a></li> <li><a href="https://t.me/yegor256news" rel="nofollow" title="My Telegram public channel"><i class="icon icon-telegram notranslate" aria-hidden="true"></i></a></li> <li><a href="mailto:blog@yegor256.com" rel="nofollow" title="Email me any time"><i class="icon icon-mail notranslate" aria-hidden="true"></i></a></li></ul><ul class="menu"> <li><a href="/" title="Home page">Home</a></li> <li /2014/08/15/retry-java-method-on-exception.html><a href="/best.html" title="Best articles to read">12&#160;Best</a></li> <li /2014/08/15/retry-java-method-on-exception.html><a href="/contents.html" title="The contents of the entire blog">All&#160;292</a></li> <li /2014/08/15/retry-java-method-on-exception.html><a href="/webinars.html" title="My webinars">Webinars</a></li> <li /2014/08/15/retry-java-method-on-exception.html><a href="/talks.html" title="Future and past conference talks">Talks</a></li> <li /2014/08/15/retry-java-method-on-exception.html><a href="/books.html" title="The books I wrote">Books</a></li> <li /2014/08/15/retry-java-method-on-exception.html><a href="/papers.html" title="My academic papers and patents">Papers</a></li> <li /2014/08/15/retry-java-method-on-exception.html><a href="/pets.html" title="My loved pet projects">Pets</a></li> <li /2014/08/15/retry-java-method-on-exception.html class="highlighted"><a href="/trainings.html" title="On-site trainings">Trainings</a></li> <li /2014/08/15/retry-java-method-on-exception.html><a href="/award.html" title="Software quality award">Award</a></li> <li /2014/08/15/retry-java-method-on-exception.html><a href="/testimonials.html" title="What some people say about me">Testimonials</a></li> <li /2014/08/15/retry-java-method-on-exception.html><a href="/shift-m.html" title="Audio podcast about project management">Shift-M</a></li> <li /2014/08/15/retry-java-method-on-exception.html><a href="/paintings.html" title="My paintings for sale">Paintings</a></li> <li><a href="https://ru.yegor256.com/" title="Немного на русском языке">По-русски</a></li></ul></nav><div class="search"> <form method="get" action="https://www.google.com/search" itemprop="potentialAction" itemscope="" itemtype="http://schema.org/SearchAction"> <meta itemprop="target" content="https://www.google.com/search?q={q}"/> <input name="sitesearch" value="yegor256.com" type="hidden"/> <input itemprop="query-input" type="text" id="search-query" class="field field-text" required="required" onfocus="$('.google').css('visibility', 'visible');" name="q" placeholder="Search..." autocomplete="off"/> <input type="image" src="/images/google-search-icon.svg" class="google" title="Search via Google" alt="Search via Google"/> </form></div><div class="hot"><ul></ul></div></header></div><section itemscope="" itemtype="http://schema.org/BlogPosting"><div class="wrapper"> <header><p class="printable"> <img src="https://api.qrserver.com/v1/create-qr-code/?data=https://www.yegor256.com/2014/08/15/retry-java-method-on-exception.html&amp;format=svg" style="width:125px;height:125px;" alt="QR code"/></p><p class="printable"> <code itemprop="url">https://www.yegor256.com/2014/08/15/retry-java-method-on-exception.html</code></p><h1 itemprop="name headline mainEntityOfPage">How to Retry Java Method Call on Exception</h1><ul class="subline"> <li> <time itemprop="datePublished" datetime="2014-08-15T00:00:00+00:00"> 15 August 2014 </time> </li> <li class="printable" itemscope="" itemprop="author" itemtype="http://schema.org/Person"> <span itemprop="name">Yegor Bugayenko</span> </li> <li class="unprintable"> <i class="icon icon-comments"></i> <a href="https://www.yegor256.com/2014/08/15/retry-java-method-on-exception.html#disqus_thread" itemprop="discussionUrl">comments</a> </li></ul><p class="unprintable"><figure class="badge"><a href="http://aspects.jcabi.com"><img src="http://img.jcabi.com/logo-square.svg" style="width:64px;max-width:100%;" alt="badge" /></a></figure><p>If you have a method that fails occasionally and you want to retry it a few times before <a href="/2015/12/01/rethrow-exceptions.html">throwing</a> an exception. <a href="http://aspects.jcabi.com/annotation-retryonfailure.html"><code>@RetryOnFailure</code></a> from <a href="http://aspects.jcabi.com">jcabi-aspects</a> can help. For example, if you’re downloading the following web page:</p><figure class="highlight"><pre><code class="language-java" data-lang="java"><span></span><span class="nd">@RetryOnFailure</span><span class="o">(</span>
  <span class="n">attempts</span> <span class="o">=</span> <span class="mi">3</span><span class="o">,</span>
  <span class="n">delay</span> <span class="o">=</span> <span class="mi">10</span><span class="o">,</span>
  <span class="n">unit</span> <span class="o">=</span> <span class="n">TimeUnit</span><span class="o">.</span><span class="na">SECONDS</span>
<span class="o">)</span>
<span class="kd">public</span> <span class="n">String</span> <span class="nf">load</span><span class="o">(</span><span class="n">URL</span> <span class="n">url</span><span class="o">)</span> <span class="o">{</span>
  <span class="k">return</span> <span class="n">url</span><span class="o">.</span><span class="na">openConnection</span><span class="o">().</span><span class="na">getContent</span><span class="o">();</span>
<span class="o">}</span></code></pre></figure><p>This method call will throw an exception only after three failed executions with a ten seconds interval between them.</p><p><a href="/2014/06/01/aop-aspectj-java-method-logging.html">This post</a> explains how <a href="http://aspects.jcabi.com">jcabi-aspects</a> works with binary weaving. This mechanism integrates AspectJ with your code.</p><p>When method <code>load()</code> from the example above is called, this is what is happening behind the scene (pseudo-code):</p><figure class="highlight"><pre><code class="language-java" data-lang="java"><span></span><span class="k">while</span> <span class="o">(</span><span class="n">attempts</span><span class="o">++</span> <span class="o">&lt;</span> <span class="mi">3</span><span class="o">)</span> <span class="o">{</span>
  <span class="k">try</span> <span class="o">{</span>
    <span class="k">return</span> <span class="n">original_load</span><span class="o">(</span><span class="n">url</span><span class="o">);</span>
  <span class="o">}</span> <span class="k">catch</span> <span class="o">(</span><span class="n">Throwable</span> <span class="n">ex</span><span class="o">)</span> <span class="o">{</span>
    <span class="n">log</span><span class="o">(</span><span class="s">&quot;we failed, will try again in 10 seconds&quot;</span><span class="o">);</span>
    <span class="n">sleep</span><span class="o">(</span><span class="mi">10</span><span class="o">);</span>
  <span class="o">}</span>
<span class="o">}</span></code></pre></figure><p>This approach may be very useful in the following situations (based on my experience):</p><ul> <li><p>Executing <a href="/2014/08/18/fluent-jdbc-decorator.html">JDBC</a> <code>SELECT</code> statements</p></li> <li><p>Loading data from HTTP, <a href="/2014/05/26/amazon-s3-java-oop-adapter.html">S3</a>, FTP, etc resources</p></li> <li><p>Uploading data over the network</p></li> <li><p>Fetching data through RESTful stateless API-s</p></li></ul><p>The project is in <a href="https://github.com/jcabi/jcabi-aspects">GitHub</a>.</p></p><nav class="buttons notranslate desktop-only"> <a href="http://www.facebook.com/sharer/sharer.php?u=https://www.yegor256.com/2014/08/15/retry-java-method-on-exception.html" title="Share on Facebook" class="button" rel="nofollow"> <span class="count count-facebook">0</span> <i class="icon icon-facebook notranslate" aria-hidden="true"></i> </a> <a href="https://twitter.com/share?url=https://www.yegor256.com/2014/08/15/retry-java-method-on-exception.html&amp;text=How+to+Retry+Java+Method+Call+on+Exception" title="Share on Twitter" class="button" rel="nofollow"> <span class="count count-twitter">0</span> <i class="icon icon-twitter notranslate" aria-hidden="true"></i> </a> <a href="https://plus.google.com/share?url=https://www.yegor256.com/2014/08/15/retry-java-method-on-exception.html" title="Share on Google+" class="button" rel="nofollow"> <span class="count count-googleplus">0</span> <i class="icon icon-googleplus notranslate" aria-hidden="true"></i> </a> <a href="https://www.linkedin.com/cws/share?url=https://www.yegor256.com/2014/08/15/retry-java-method-on-exception.html" title="Share on LinkedIn" class="button" rel="nofollow"> <span class="count count-linkedin">0</span> <i class="icon icon-linkedin notranslate" aria-hidden="true"></i> </a> <a href="http://reddit.com/submit?url=https://www.yegor256.com/2014/08/15/retry-java-method-on-exception.html%3F2014-32&amp;title=How+to+Retry+Java+Method+Call+on+Exception" title="Share on Reddit" class="button" rel="nofollow"> <span class="count count-reddit">0</span> <i class="icon icon-reddit notranslate" aria-hidden="true"></i> </a> <a href="http://news.ycombinator.com/submitlink?u=https://www.yegor256.com/2014/08/15/retry-java-method-on-exception.html%3F2014-32&amp;t=How+to+Retry+Java+Method+Call+on+Exception" title="Share on Hacker News" class="button" rel="nofollow"> <span class="count count-hackernews">0</span> <i class="icon icon-hackernews notranslate" aria-hidden="true"></i> </a> </nav> </header> <article class="main" itemprop="articleBody"><div > <figure class="badge"><a href="http://aspects.jcabi.com"><img src="http://img.jcabi.com/logo-square.svg" style="width:64px;max-width:100%;" alt="badge" /></a></figure><p>If you have a method that fails occasionally and you want to retry it a few times before <a href="/2015/12/01/rethrow-exceptions.html">throwing</a> an exception. <a href="http://aspects.jcabi.com/annotation-retryonfailure.html"><code>@RetryOnFailure</code></a> from <a href="http://aspects.jcabi.com">jcabi-aspects</a> can help. For example, if you’re downloading the following web page:</p><figure class="highlight"><pre><code class="language-java" data-lang="java"><span></span><span class="nd">@RetryOnFailure</span><span class="o">(</span>
  <span class="n">attempts</span> <span class="o">=</span> <span class="mi">3</span><span class="o">,</span>
  <span class="n">delay</span> <span class="o">=</span> <span class="mi">10</span><span class="o">,</span>
  <span class="n">unit</span> <span class="o">=</span> <span class="n">TimeUnit</span><span class="o">.</span><span class="na">SECONDS</span>
<span class="o">)</span>
<span class="kd">public</span> <span class="n">String</span> <span class="nf">load</span><span class="o">(</span><span class="n">URL</span> <span class="n">url</span><span class="o">)</span> <span class="o">{</span>
  <span class="k">return</span> <span class="n">url</span><span class="o">.</span><span class="na">openConnection</span><span class="o">().</span><span class="na">getContent</span><span class="o">();</span>
<span class="o">}</span></code></pre></figure><p>This method call will throw an exception only after three failed executions with a ten seconds interval between them.</p><p><a href="/2014/06/01/aop-aspectj-java-method-logging.html">This post</a> explains how <a href="http://aspects.jcabi.com">jcabi-aspects</a> works with binary weaving. This mechanism integrates AspectJ with your code.</p><p>When method <code>load()</code> from the example above is called, this is what is happening behind the scene (pseudo-code):</p><figure class="highlight"><pre><code class="language-java" data-lang="java"><span></span><span class="k">while</span> <span class="o">(</span><span class="n">attempts</span><span class="o">++</span> <span class="o">&lt;</span> <span class="mi">3</span><span class="o">)</span> <span class="o">{</span>
  <span class="k">try</span> <span class="o">{</span>
    <span class="k">return</span> <span class="n">original_load</span><span class="o">(</span><span class="n">url</span><span class="o">);</span>
  <span class="o">}</span> <span class="k">catch</span> <span class="o">(</span><span class="n">Throwable</span> <span class="n">ex</span><span class="o">)</span> <span class="o">{</span>
    <span class="n">log</span><span class="o">(</span><span class="s">&quot;we failed, will try again in 10 seconds&quot;</span><span class="o">);</span>
    <span class="n">sleep</span><span class="o">(</span><span class="mi">10</span><span class="o">);</span>
  <span class="o">}</span>
<span class="o">}</span></code></pre></figure><p>This approach may be very useful in the following situations (based on my experience):</p><ul> <li><p>Executing <a href="/2014/08/18/fluent-jdbc-decorator.html">JDBC</a> <code>SELECT</code> statements</p></li> <li><p>Loading data from HTTP, <a href="/2014/05/26/amazon-s3-java-oop-adapter.html">S3</a>, FTP, etc resources</p></li> <li><p>Uploading data over the network</p></li> <li><p>Fetching data through RESTful stateless API-s</p></li></ul><p>The project is in <a href="https://github.com/jcabi/jcabi-aspects">GitHub</a>.</p></div></article></div><div class="wrapper"> <related-posts /></div><div class="disqus" role="complementary"><p class="disqus_hint"> Please, use <a href="https://help.disqus.com/commenting/what-html-tags-are-allowed-within-comments">syntax highlighting</a> in your comments, to make them more readable.</p><div id="disqus_thread" class="disqus-thread"> <a>&nbsp;</a></div><script> var disqus_config = function () { this.page.url = document.location.href.split('?')[0].split('#')[0].replace('https://', 'http://'); this.page.identifier = this.page.url; }; (function() { var d = document, s = d.createElement('script'); s.src = '//yegor256.disqus.com/embed.js'; s.setAttribute('data-timestamp', +new Date()); (d.head || d.body).appendChild(s); })(); </script> <noscript><div><p class="red"> JavaScript is disabled in your browser, that's why you can't see comments under this post.</p></div></noscript></div><div class="wrapper"> <footer class="footer"><p> &copy; <span itemscope="" itemprop="copyrightHolder" itemtype="http://schema.org/Person"> <span itemprop="name">Yegor Bugayenko</span> </span> 2014&ndash;<span itemprop="copyrightYear">2018</span></p></footer></div></section><div class="wrapper unprintable" style="text-align:center;margin-top:2em;"> <a href="http://www.sixnines.io/h/3ba1652f"> <img src="//www.sixnines.io/b/3ba1652f?style=flat" alt="sixnines availability badge"/> </a></div><script src="//code.jquery.com/jquery-1.9.0.min.js"></script> <script src="/js/all.js?7d5b276b9b5"></script> <script>var disqus_shortname = 'yegor256';</script> <script id="dsq-count-scr" src="//yegor256.disqus.com/count.js" async="async"></script> <script> (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){ (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o), m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m) })(window,document,'script','//www.google-analytics.com/analytics.js','ga'); ga('create', 'UA-1963507-32', 'auto'); ga('send', 'pageview'); </script> <script> Cd=document;Cr="&"+Math.random();Cp="&s=1"; Cd.cookie="b=b";if(Cd.cookie)Cp+="&c=1"; Cp+="&t="+(new Date()).getTimezoneOffset(); if(self!=top)Cp+="&f=1"; </script> <script> if(navigator.javaEnabled())Cp+="&j=1"; </script> <script> if(typeof(screen)!='undefined')Cp+="&w="+screen.width+"&h="+ screen.height+"&d="+(screen.colorDepth?screen.colorDepth:screen.pixelDepth); </script> <script> Cd.write("<img src='//c.hit.ua/hit?i=95870&g=0&x=2"+Cp+Cr+ "&r="+escape(Cd.referrer)+"&u="+escape(window.location.href)+ "' border='0' wi"+"dth='1' he"+"ight='1'/>"); </script> <script type="application/ld+json"> { "@context": "http://schema.org", "@type": "Person", "name": "Yegor Bugayenko", "url": "https://www.yegor256.com", "sameAs": [ "https://www.facebook.com/yegor256", "https://instagram.com/yegor256", "https://www.linkedin.com/in/yegor256", "https://twitter.com/yegor256", "https://github.com/yegor256", "https://www.pinterest.com/yegor256/" ] } </script> </body> </html> <!DOCTYPE html> <html xmlns="http://www.w3.org/1999/xhtml" lang="en-US" xml:lang="en-US" itemscope="" itemtype="http://schema.org/WebSite"> <head> <meta charset="utf-8"/> <meta name="description" content="&lt;figure class=&quot;badge&quot;&gt;&lt;a href=&quot;http://aspects.jcabi.com&quot;&gt;&lt;img src=&quot;http://img.jcabi.com/logo-square.svg&quot; style=&quot;width:64px;max-width:100%;&quot; alt=&quot;badge&quot; /&gt;&lt;/a&gt;&lt;/figure&gt; &lt;p&gt;Say, you have a method that takes time to execute and you want its result to be cached. There are &lt;a href=&quot;http://www.coderanch.com/how-to/java/CachingStrategies&quot;&gt;many solutions&lt;/a&gt;, including &lt;a href=&quot;http://commons.apache.org/proper/commons-jcs/&quot;&gt;Apache Commons JCS&lt;/a&gt;, &lt;a href=&quot;http://www.ehcache.org&quot;&gt;Ehcache&lt;/a&gt;, &lt;a href=&quot;https://jcp.org/en/jsr/detail?id=107&quot;&gt;JSR 107&lt;/a&gt;, &lt;a href=&quot;https://code.google.com/p/guava-libraries/wiki/CachesExplained&quot;&gt;Guava Caching&lt;/a&gt; and many others.&lt;/p&gt; &lt;p&gt;&lt;a href=&quot;http://aspects.jcabi.com/annotation-cacheable.html&quot;&gt;jcabi-aspects&lt;/a&gt; offers a very simple one, based on AOP aspects and Java6 &lt;a href=&quot;/2016/04/12/java-annotations-are-evil.html&quot;&gt;annotations&lt;/a&gt;:&lt;/p&gt; &lt;figure class=&quot;highlight&quot;&gt;&lt;pre&gt;&lt;code class=&quot;language-java&quot; data-lang=&quot;java&quot;&gt;&lt;span&gt;&lt;/span&gt;&lt;span class=&quot;kn&quot;&gt;import&lt;/span&gt; &lt;span class=&quot;nn&quot;&gt;com.jcabi.aspects.Cacheable&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;;&lt;/span&gt; &lt;span class=&quot;kd&quot;&gt;public&lt;/span&gt; &lt;span class=&quot;kd&quot;&gt;class&lt;/span&gt; &lt;span class=&quot;nc&quot;&gt;Page&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;{&lt;/span&gt; &lt;span class=&quot;nd&quot;&gt;@Cacheable&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;lifetime&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;mi&quot;&gt;5&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;unit&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;TimeUnit&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;na&quot;&gt;MINUTES&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;String&lt;/span&gt; &lt;span class=&quot;nf&quot;&gt;load&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;()&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;{&lt;/span&gt; &lt;span class=&quot;k&quot;&gt;return&lt;/span&gt; &lt;span class=&quot;k&quot;&gt;new&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;URL&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;s&quot;&gt;&amp;quot;http://google.com&amp;quot;&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;).&lt;/span&gt;&lt;span class=&quot;na&quot;&gt;getContent&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;().&lt;/span&gt;&lt;span class=&quot;na&quot;&gt;toString&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;();&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;}&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;}&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/figure&gt; &lt;p&gt;The result of &lt;code&gt;load()&lt;/code&gt; method will be cached in memory for five minutes.&lt;/p&gt; &lt;!--more--&gt; &lt;h2 id=&quot;how-it-works&quot;&gt;How It Works?&lt;/h2&gt; &lt;p&gt;This post about &lt;a href=&quot;/2014/06/01/aop-aspectj-java-method-logging.html&quot;&gt;AOP, AspectJ and method logging&lt;/a&gt; explains how “aspect weaving” works (I highly recommend that you read it first).&lt;/p&gt; &lt;p&gt;Here I’ll explain how caching works.&lt;/p&gt; &lt;p&gt;The approach is very straight forward. There is a static hash map with keys as “method coordinates” and values as their results. Method coordinates consist of the object, an owner of the method and a method name with parameter types.&lt;/p&gt; &lt;p&gt;In the example above, right after the method &lt;code&gt;load()&lt;/code&gt; finishes, the map gets a new entry (simplified example, of course):&lt;/p&gt; &lt;figure class=&quot;highlight&quot;&gt;&lt;pre&gt;&lt;code class=&quot;language-text&quot; data-lang=&quot;text&quot;&gt;&lt;span&gt;&lt;/span&gt;key: [page, &amp;quot;load()&amp;quot;] value: &amp;quot;&amp;lt;html&amp;gt;...&amp;lt;/html&amp;gt;&amp;quot;&lt;/code&gt;&lt;/pre&gt;&lt;/figure&gt; &lt;p&gt;Every consecutive call to &lt;code&gt;load()&lt;/code&gt; will be intercepted by the aspect from &lt;a href=&quot;http://aspects.jcabi.com&quot;&gt;jcabi-aspects&lt;/a&gt; and resolved immediately with a value from the cache map. The method will not get any control until the end of its lifetime, which is five minutes in the example above.&lt;/p&gt; &lt;h2 id=&quot;what-about-cache-flushing&quot;&gt;What About Cache Flushing?&lt;/h2&gt; &lt;p&gt;Sometimes it’s necessary to have the ability to flush cache before the end of its lifetime. Here is a practical example:&lt;/p&gt; &lt;figure class=&quot;highlight&quot;&gt;&lt;pre&gt;&lt;code class=&quot;language-java&quot; data-lang=&quot;java&quot;&gt;&lt;span&gt;&lt;/span&gt;&lt;span class=&quot;kn&quot;&gt;import&lt;/span&gt; &lt;span class=&quot;nn&quot;&gt;com.jcabi.aspects.Cacheable&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;;&lt;/span&gt; &lt;span class=&quot;kd&quot;&gt;public&lt;/span&gt; &lt;span class=&quot;kd&quot;&gt;class&lt;/span&gt; &lt;span class=&quot;nc&quot;&gt;Employees&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;{&lt;/span&gt; &lt;span class=&quot;nd&quot;&gt;@Cacheable&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;lifetime&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;mi&quot;&gt;1&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;unit&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;TimeUnit&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;na&quot;&gt;HOURS&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;kt&quot;&gt;int&lt;/span&gt; &lt;span class=&quot;nf&quot;&gt;size&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;()&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;{&lt;/span&gt; &lt;span class=&quot;c1&quot;&gt;// calculate their amount in MySQL&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;}&lt;/span&gt; &lt;span class=&quot;nd&quot;&gt;@Cacheable.FlushBefore&lt;/span&gt; &lt;span class=&quot;kt&quot;&gt;void&lt;/span&gt; &lt;span class=&quot;nf&quot;&gt;add&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;Employee&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;employee&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;{&lt;/span&gt; &lt;span class=&quot;c1&quot;&gt;// add a new one to MySQL&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;}&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;}&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/figure&gt; &lt;p&gt;It’s obvious that the number of employees in the database will be different after &lt;code&gt;add()&lt;/code&gt; method execution and the result of &lt;code&gt;size()&lt;/code&gt; should be invalidated in cache. This invalidation operation is called “flushing” and &lt;code&gt;@Cacheable.FlushBefore&lt;/code&gt; triggers it.&lt;/p&gt; &lt;p&gt;Actually, every call to &lt;code&gt;add()&lt;/code&gt; invalidates all cached methods in this class, not only &lt;code&gt;size()&lt;/code&gt;.&lt;/p&gt; &lt;p&gt;There is also &lt;code&gt;@Cacheable.FlushAfter&lt;/code&gt;. The difference is that &lt;code&gt;FlushBefore&lt;/code&gt; guarantees that cache is already invalidated when the method &lt;code&gt;add()&lt;/code&gt; starts. &lt;code&gt;FlushAfter&lt;/code&gt; invalidates cache after method &lt;code&gt;add()&lt;/code&gt; finishes. This small difference makes a big one, sometimes.&lt;/p&gt; &lt;p&gt;This article explains &lt;a href=&quot;http://aspects.jcabi.com/example-weaving.html&quot;&gt;how to add jcabi-aspects to your project&lt;/a&gt;.&lt;/p&gt; " /> <meta name="keywords" content="next, path, output, content, previous, url, relative_path, id, collection, excerpt, draft, categories, layout, title, date, tags, description, keywords, slug, ext" /> <meta name="viewport" content="width=device-width,minimum-scale=1,initial-scale=1"/> <meta name="google-site-verification" content="JEj_gQr2CPe2QKGw8XdMz0R7VboQIUbX3FlM-lwTq-8" /> <meta name="author" content="Yegor Bugayenko"> <meta name="article:published_time" content="2014-08-03 00:00:00 +0000"> <meta name="og:site_name" content="Yegor Bugayenko"/> <meta name="og:type" content="article" /> <meta name="og:locale" content="en_US" /> <meta name="twitter:account_id" content="4503599630178231" /> <meta name="twitter:creator" content="@yegor256"/> <meta name="twitter:site" content="@yegor256"/> <meta name="twitter:title" property="og:title" content="Cache Java Method Results"/> <meta name="twitter:description" property="og:description" content="&lt;figure class=&quot;badge&quot;&gt;&lt;a href=&quot;http://aspects.jcabi.com&quot;&gt;&lt;img src=&quot;http://img.jcabi.com/logo-square.svg&quot; style=&quot;width:64px;max-width:100%;&quot; alt=&quot;badge&quot; /&gt;&lt;/a&gt;&lt;/figure&gt; &lt;p&gt;Say, you have a method that takes time to execute and you want its result to be cached. There are &lt;a href=&quot;http://www.coderanch.com/how-to/java/CachingStrategies&quot;&gt;many solutions&lt;/a&gt;, including &lt;a href=&quot;http://commons.apache.org/proper/commons-jcs/&quot;&gt;Apache Commons JCS&lt;/a&gt;, &lt;a href=&quot;http://www.ehcache.org&quot;&gt;Ehcache&lt;/a&gt;, &lt;a href=&quot;https://jcp.org/en/jsr/detail?id=107&quot;&gt;JSR 107&lt;/a&gt;, &lt;a href=&quot;https://code.google.com/p/guava-libraries/wiki/CachesExplained&quot;&gt;Guava Caching&lt;/a&gt; and many others.&lt;/p&gt; &lt;p&gt;&lt;a href=&quot;http://aspects.jcabi.com/annotation-cacheable.html&quot;&gt;jcabi-aspects&lt;/a&gt; offers a very simple one, based on AOP aspects and Java6 &lt;a href=&quot;/2016/04/12/java-annotations-are-evil.html&quot;&gt;annotations&lt;/a&gt;:&lt;/p&gt; &lt;figure class=&quot;highlight&quot;&gt;&lt;pre&gt;&lt;code class=&quot;language-java&quot; data-lang=&quot;java&quot;&gt;&lt;span&gt;&lt;/span&gt;&lt;span class=&quot;kn&quot;&gt;import&lt;/span&gt; &lt;span class=&quot;nn&quot;&gt;com.jcabi.aspects.Cacheable&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;;&lt;/span&gt; &lt;span class=&quot;kd&quot;&gt;public&lt;/span&gt; &lt;span class=&quot;kd&quot;&gt;class&lt;/span&gt; &lt;span class=&quot;nc&quot;&gt;Page&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;{&lt;/span&gt; &lt;span class=&quot;nd&quot;&gt;@Cacheable&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;lifetime&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;mi&quot;&gt;5&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;unit&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;TimeUnit&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;na&quot;&gt;MINUTES&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;String&lt;/span&gt; &lt;span class=&quot;nf&quot;&gt;load&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;()&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;{&lt;/span&gt; &lt;span class=&quot;k&quot;&gt;return&lt;/span&gt; &lt;span class=&quot;k&quot;&gt;new&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;URL&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;s&quot;&gt;&amp;quot;http://google.com&amp;quot;&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;).&lt;/span&gt;&lt;span class=&quot;na&quot;&gt;getContent&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;().&lt;/span&gt;&lt;span class=&quot;na&quot;&gt;toString&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;();&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;}&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;}&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/figure&gt; &lt;p&gt;The result of &lt;code&gt;load()&lt;/code&gt; method will be cached in memory for five minutes.&lt;/p&gt; &lt;!--more--&gt; &lt;h2 id=&quot;how-it-works&quot;&gt;How It Works?&lt;/h2&gt; &lt;p&gt;This post about &lt;a href=&quot;/2014/06/01/aop-aspectj-java-method-logging.html&quot;&gt;AOP, AspectJ and method logging&lt;/a&gt; explains how “aspect weaving” works (I highly recommend that you read it first).&lt;/p&gt; &lt;p&gt;Here I’ll explain how caching works.&lt;/p&gt; &lt;p&gt;The approach is very straight forward. There is a static hash map with keys as “method coordinates” and values as their results. Method coordinates consist of the object, an owner of the method and a method name with parameter types.&lt;/p&gt; &lt;p&gt;In the example above, right after the method &lt;code&gt;load()&lt;/code&gt; finishes, the map gets a new entry (simplified example, of course):&lt;/p&gt; &lt;figure class=&quot;highlight&quot;&gt;&lt;pre&gt;&lt;code class=&quot;language-text&quot; data-lang=&quot;text&quot;&gt;&lt;span&gt;&lt;/span&gt;key: [page, &amp;quot;load()&amp;quot;] value: &amp;quot;&amp;lt;html&amp;gt;...&amp;lt;/html&amp;gt;&amp;quot;&lt;/code&gt;&lt;/pre&gt;&lt;/figure&gt; &lt;p&gt;Every consecutive call to &lt;code&gt;load()&lt;/code&gt; will be intercepted by the aspect from &lt;a href=&quot;http://aspects.jcabi.com&quot;&gt;jcabi-aspects&lt;/a&gt; and resolved immediately with a value from the cache map. The method will not get any control until the end of its lifetime, which is five minutes in the example above.&lt;/p&gt; &lt;h2 id=&quot;what-about-cache-flushing&quot;&gt;What About Cache Flushing?&lt;/h2&gt; &lt;p&gt;Sometimes it’s necessary to have the ability to flush cache before the end of its lifetime. Here is a practical example:&lt;/p&gt; &lt;figure class=&quot;highlight&quot;&gt;&lt;pre&gt;&lt;code class=&quot;language-java&quot; data-lang=&quot;java&quot;&gt;&lt;span&gt;&lt;/span&gt;&lt;span class=&quot;kn&quot;&gt;import&lt;/span&gt; &lt;span class=&quot;nn&quot;&gt;com.jcabi.aspects.Cacheable&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;;&lt;/span&gt; &lt;span class=&quot;kd&quot;&gt;public&lt;/span&gt; &lt;span class=&quot;kd&quot;&gt;class&lt;/span&gt; &lt;span class=&quot;nc&quot;&gt;Employees&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;{&lt;/span&gt; &lt;span class=&quot;nd&quot;&gt;@Cacheable&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;lifetime&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;mi&quot;&gt;1&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;unit&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;TimeUnit&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;na&quot;&gt;HOURS&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;kt&quot;&gt;int&lt;/span&gt; &lt;span class=&quot;nf&quot;&gt;size&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;()&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;{&lt;/span&gt; &lt;span class=&quot;c1&quot;&gt;// calculate their amount in MySQL&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;}&lt;/span&gt; &lt;span class=&quot;nd&quot;&gt;@Cacheable.FlushBefore&lt;/span&gt; &lt;span class=&quot;kt&quot;&gt;void&lt;/span&gt; &lt;span class=&quot;nf&quot;&gt;add&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;Employee&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;employee&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;{&lt;/span&gt; &lt;span class=&quot;c1&quot;&gt;// add a new one to MySQL&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;}&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;}&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/figure&gt; &lt;p&gt;It’s obvious that the number of employees in the database will be different after &lt;code&gt;add()&lt;/code&gt; method execution and the result of &lt;code&gt;size()&lt;/code&gt; should be invalidated in cache. This invalidation operation is called “flushing” and &lt;code&gt;@Cacheable.FlushBefore&lt;/code&gt; triggers it.&lt;/p&gt; &lt;p&gt;Actually, every call to &lt;code&gt;add()&lt;/code&gt; invalidates all cached methods in this class, not only &lt;code&gt;size()&lt;/code&gt;.&lt;/p&gt; &lt;p&gt;There is also &lt;code&gt;@Cacheable.FlushAfter&lt;/code&gt;. The difference is that &lt;code&gt;FlushBefore&lt;/code&gt; guarantees that cache is already invalidated when the method &lt;code&gt;add()&lt;/code&gt; starts. &lt;code&gt;FlushAfter&lt;/code&gt; invalidates cache after method &lt;code&gt;add()&lt;/code&gt; finishes. This small difference makes a big one, sometimes.&lt;/p&gt; &lt;p&gt;This article explains &lt;a href=&quot;http://aspects.jcabi.com/example-weaving.html&quot;&gt;how to add jcabi-aspects to your project&lt;/a&gt;.&lt;/p&gt; "/> <meta name="twitter:url" property="og:url" content="https://www.yegor256.com/2014/08/03/cacheable-java-annotation.html"/> <meta name="telegram:channel" content="AAAAAEJFMRzsRTRxM3ec6A"/> <link rel="search" type="application/opensearchdescription+xml" href="/opensearch.xml" title="yegor256" /> <link rel="shortcut icon" href="/favicon.ico?7d5b276b9b5"/> <link rel="apple-touch-icon" href="/favicon.ico?7d5b276b9b5"/> <link rel="alternate" type="application/rss+xml" title="RSS for yegor256.com" href="https://www.yegor256.com/rss.xml"/> <link rel="stylesheet" href="/css/layout.css?7d5b276b9b5"/> <link rel="stylesheet" href="/css/icons.css?7d5b276b9b5"/> <link rel="canonical" href="https://www.yegor256.com/2014/08/03/cacheable-java-annotation.html" /> <link rel="amphtml" href="https://www.yegor256.com/2014/08/03/cacheable-java-annotation.amp.html" /> <title>Cache Java Method Results </title> </head> <body><div class="wrapper"> <aside class="header-toggle unprintable" id="header-toggle" title="Show the menu" onclick="$('#header').show();$('#header-toggle').hide();">&#9776;</aside> <header class="header" id="header"><div class="face"> <a href="/about-me.html#form" class="sub" title="Click to subscribe to my monthly newsletter"><span>Subscribe</span></a> <a href="/about-me.html" style="position:relative;"> <img src="/images/face-256x256.jpg" class="photo" alt="Yegor Bugayenko"/> </a></div><nav><ul class="menu social notranslate"> <li><a href="https://twitter.com/intent/follow?screen_name=yegor256" rel="nofollow" title="Follow me on Twitter"><i class="icon icon-twitter notranslate" aria-hidden="true"></i></a></li> <li><a href="/rss.xml" rel="nofollow" title="Subscribe to my RSS feed"><i class="icon icon-rss notranslate" aria-hidden="true"></i></a></li> <li><a itemprop="sameAs" href="https://github.com/yegor256" rel="nofollow" title="My GitHub profile"><i class="icon icon-github notranslate" aria-hidden="true"></i></a></li> <li><a itemprop="sameAs" href="http://stackoverflow.com/users/187141/yegor256" rel="nofollow" title="My StackOverflow profile"><i class="icon icon-stackoverflow notranslate" aria-hidden="true"></i></a></li> <li><a itemprop="sameAs" href="https://www.facebook.com/yegor256" rel="nofollow" title="Follow me on Facebook"><i class="icon icon-facebook notranslate" aria-hidden="true"></i></a></li> <li><a itemprop="sameAs" href="https://instagram.com/yegor256" rel="nofollow" title="Follow me on Instagram"><i class="icon icon-instagram notranslate" aria-hidden="true"></i></a></li> <li><a itemprop="sameAs" href="https://www.linkedin.com/in/yegor256" rel="nofollow" title="My LinkedIn profile"><i class="icon icon-linkedin notranslate" aria-hidden="true"></i></a></li> <li><a itemprop="sameAs" href="https://www.youtube.com/c/yegor256?sub_confirmation=1" rel="nofollow" title="My Youtube video channel"><i class="icon icon-youtube notranslate" aria-hidden="true"></i></a></li> <li><a itemprop="sameAs" href="https://www.pinterest.com/yegor256/" rel="nofollow" title="My Pinterest boards"><i class="icon icon-pinterest notranslate" aria-hidden="true"></i></a></li> <li><a itemprop="sameAs" href="https://angel.co/yegor256" rel="nofollow" title="My AngelList profile"><i class="icon icon-angellist notranslate" aria-hidden="true"></i></a></li> <li><a href="https://soundcloud.com/yegor256" rel="nofollow" title="My podcast"><i class="icon icon-podcast notranslate" aria-hidden="true"></i></a></li> <li><a href="https://itunes.apple.com/us/podcast/yegor256-podcast/id1150826721" rel="nofollow" title="My iTunes podcast"><i class="icon icon-itunes notranslate" aria-hidden="true"></i></a></li> <li><a href="https://t.me/yegor256news" rel="nofollow" title="My Telegram public channel"><i class="icon icon-telegram notranslate" aria-hidden="true"></i></a></li> <li><a href="mailto:blog@yegor256.com" rel="nofollow" title="Email me any time"><i class="icon icon-mail notranslate" aria-hidden="true"></i></a></li></ul><ul class="menu"> <li><a href="/" title="Home page">Home</a></li> <li /2014/08/03/cacheable-java-annotation.html><a href="/best.html" title="Best articles to read">12&#160;Best</a></li> <li /2014/08/03/cacheable-java-annotation.html><a href="/contents.html" title="The contents of the entire blog">All&#160;292</a></li> <li /2014/08/03/cacheable-java-annotation.html><a href="/webinars.html" title="My webinars">Webinars</a></li> <li /2014/08/03/cacheable-java-annotation.html><a href="/talks.html" title="Future and past conference talks">Talks</a></li> <li /2014/08/03/cacheable-java-annotation.html><a href="/books.html" title="The books I wrote">Books</a></li> <li /2014/08/03/cacheable-java-annotation.html><a href="/papers.html" title="My academic papers and patents">Papers</a></li> <li /2014/08/03/cacheable-java-annotation.html><a href="/pets.html" title="My loved pet projects">Pets</a></li> <li /2014/08/03/cacheable-java-annotation.html class="highlighted"><a href="/trainings.html" title="On-site trainings">Trainings</a></li> <li /2014/08/03/cacheable-java-annotation.html><a href="/award.html" title="Software quality award">Award</a></li> <li /2014/08/03/cacheable-java-annotation.html><a href="/testimonials.html" title="What some people say about me">Testimonials</a></li> <li /2014/08/03/cacheable-java-annotation.html><a href="/shift-m.html" title="Audio podcast about project management">Shift-M</a></li> <li /2014/08/03/cacheable-java-annotation.html><a href="/paintings.html" title="My paintings for sale">Paintings</a></li> <li><a href="https://ru.yegor256.com/" title="Немного на русском языке">По-русски</a></li></ul></nav><div class="search"> <form method="get" action="https://www.google.com/search" itemprop="potentialAction" itemscope="" itemtype="http://schema.org/SearchAction"> <meta itemprop="target" content="https://www.google.com/search?q={q}"/> <input name="sitesearch" value="yegor256.com" type="hidden"/> <input itemprop="query-input" type="text" id="search-query" class="field field-text" required="required" onfocus="$('.google').css('visibility', 'visible');" name="q" placeholder="Search..." autocomplete="off"/> <input type="image" src="/images/google-search-icon.svg" class="google" title="Search via Google" alt="Search via Google"/> </form></div><div class="hot"><ul></ul></div></header></div><section itemscope="" itemtype="http://schema.org/BlogPosting"><div class="wrapper"> <header><p class="printable"> <img src="https://api.qrserver.com/v1/create-qr-code/?data=https://www.yegor256.com/2014/08/03/cacheable-java-annotation.html&amp;format=svg" style="width:125px;height:125px;" alt="QR code"/></p><p class="printable"> <code itemprop="url">https://www.yegor256.com/2014/08/03/cacheable-java-annotation.html</code></p><h1 itemprop="name headline mainEntityOfPage">Cache Java Method Results</h1><ul class="subline"> <li> <time itemprop="datePublished" datetime="2014-08-03T00:00:00+00:00"> 3 August 2014 </time> </li> <li class="printable" itemscope="" itemprop="author" itemtype="http://schema.org/Person"> <span itemprop="name">Yegor Bugayenko</span> </li> <li class="unprintable"> <i class="icon icon-comments"></i> <a href="https://www.yegor256.com/2014/08/03/cacheable-java-annotation.html#disqus_thread" itemprop="discussionUrl">comments</a> </li></ul><p class="unprintable"><figure class="badge"><a href="http://aspects.jcabi.com"><img src="http://img.jcabi.com/logo-square.svg" style="width:64px;max-width:100%;" alt="badge" /></a></figure><p>Say, you have a method that takes time to execute and you want its result to be cached. There are <a href="http://www.coderanch.com/how-to/java/CachingStrategies">many solutions</a>, including <a href="http://commons.apache.org/proper/commons-jcs/">Apache Commons JCS</a>, <a href="http://www.ehcache.org">Ehcache</a>, <a href="https://jcp.org/en/jsr/detail?id=107">JSR 107</a>, <a href="https://code.google.com/p/guava-libraries/wiki/CachesExplained">Guava Caching</a> and many others.</p><p><a href="http://aspects.jcabi.com/annotation-cacheable.html">jcabi-aspects</a> offers a very simple one, based on AOP aspects and Java6 <a href="/2016/04/12/java-annotations-are-evil.html">annotations</a>:</p><figure class="highlight"><pre><code class="language-java" data-lang="java"><span></span><span class="kn">import</span> <span class="nn">com.jcabi.aspects.Cacheable</span><span class="o">;</span>
<span class="kd">public</span> <span class="kd">class</span> <span class="nc">Page</span> <span class="o">{</span>
  <span class="nd">@Cacheable</span><span class="o">(</span><span class="n">lifetime</span> <span class="o">=</span> <span class="mi">5</span><span class="o">,</span> <span class="n">unit</span> <span class="o">=</span> <span class="n">TimeUnit</span><span class="o">.</span><span class="na">MINUTES</span><span class="o">)</span>
  <span class="n">String</span> <span class="nf">load</span><span class="o">()</span> <span class="o">{</span>
    <span class="k">return</span> <span class="k">new</span> <span class="n">URL</span><span class="o">(</span><span class="s">&quot;http://google.com&quot;</span><span class="o">).</span><span class="na">getContent</span><span class="o">().</span><span class="na">toString</span><span class="o">();</span>
  <span class="o">}</span>
<span class="o">}</span></code></pre></figure><p>The result of <code>load()</code> method will be cached in memory for five minutes.</p><h2 id="how-it-works">How It Works?</h2><p>This post about <a href="/2014/06/01/aop-aspectj-java-method-logging.html">AOP, AspectJ and method logging</a> explains how “aspect weaving” works (I highly recommend that you read it first).</p><p>Here I’ll explain how caching works.</p><p>The approach is very straight forward. There is a static hash map with keys as “method coordinates” and values as their results. Method coordinates consist of the object, an owner of the method and a method name with parameter types.</p><p>In the example above, right after the method <code>load()</code> finishes, the map gets a new entry (simplified example, of course):</p><figure class="highlight"><pre><code class="language-text" data-lang="text"><span></span>key: [page, &quot;load()&quot;]
value: &quot;&lt;html&gt;...&lt;/html&gt;&quot;</code></pre></figure><p>Every consecutive call to <code>load()</code> will be intercepted by the aspect from <a href="http://aspects.jcabi.com">jcabi-aspects</a> and resolved immediately with a value from the cache map. The method will not get any control until the end of its lifetime, which is five minutes in the example above.</p><h2 id="what-about-cache-flushing">What About Cache Flushing?</h2><p>Sometimes it’s necessary to have the ability to flush cache before the end of its lifetime. Here is a practical example:</p><figure class="highlight"><pre><code class="language-java" data-lang="java"><span></span><span class="kn">import</span> <span class="nn">com.jcabi.aspects.Cacheable</span><span class="o">;</span>
<span class="kd">public</span> <span class="kd">class</span> <span class="nc">Employees</span> <span class="o">{</span>
  <span class="nd">@Cacheable</span><span class="o">(</span><span class="n">lifetime</span> <span class="o">=</span> <span class="mi">1</span><span class="o">,</span> <span class="n">unit</span> <span class="o">=</span> <span class="n">TimeUnit</span><span class="o">.</span><span class="na">HOURS</span><span class="o">)</span>
  <span class="kt">int</span> <span class="nf">size</span><span class="o">()</span> <span class="o">{</span>
    <span class="c1">// calculate their amount in MySQL</span>
  <span class="o">}</span>
  <span class="nd">@Cacheable.FlushBefore</span>
  <span class="kt">void</span> <span class="nf">add</span><span class="o">(</span><span class="n">Employee</span> <span class="n">employee</span><span class="o">)</span> <span class="o">{</span>
    <span class="c1">// add a new one to MySQL</span>
  <span class="o">}</span>
<span class="o">}</span></code></pre></figure><p>It’s obvious that the number of employees in the database will be different after <code>add()</code> method execution and the result of <code>size()</code> should be invalidated in cache. This invalidation operation is called “flushing” and <code>@Cacheable.FlushBefore</code> triggers it.</p><p>Actually, every call to <code>add()</code> invalidates all cached methods in this class, not only <code>size()</code>.</p><p>There is also <code>@Cacheable.FlushAfter</code>. The difference is that <code>FlushBefore</code> guarantees that cache is already invalidated when the method <code>add()</code> starts. <code>FlushAfter</code> invalidates cache after method <code>add()</code> finishes. This small difference makes a big one, sometimes.</p><p>This article explains <a href="http://aspects.jcabi.com/example-weaving.html">how to add jcabi-aspects to your project</a>.</p></p><nav class="buttons notranslate desktop-only"> <a href="http://www.facebook.com/sharer/sharer.php?u=https://www.yegor256.com/2014/08/03/cacheable-java-annotation.html" title="Share on Facebook" class="button" rel="nofollow"> <span class="count count-facebook">0</span> <i class="icon icon-facebook notranslate" aria-hidden="true"></i> </a> <a href="https://twitter.com/share?url=https://www.yegor256.com/2014/08/03/cacheable-java-annotation.html&amp;text=Cache+Java+Method+Results" title="Share on Twitter" class="button" rel="nofollow"> <span class="count count-twitter">0</span> <i class="icon icon-twitter notranslate" aria-hidden="true"></i> </a> <a href="https://plus.google.com/share?url=https://www.yegor256.com/2014/08/03/cacheable-java-annotation.html" title="Share on Google+" class="button" rel="nofollow"> <span class="count count-googleplus">0</span> <i class="icon icon-googleplus notranslate" aria-hidden="true"></i> </a> <a href="https://www.linkedin.com/cws/share?url=https://www.yegor256.com/2014/08/03/cacheable-java-annotation.html" title="Share on LinkedIn" class="button" rel="nofollow"> <span class="count count-linkedin">0</span> <i class="icon icon-linkedin notranslate" aria-hidden="true"></i> </a> <a href="http://reddit.com/submit?url=https://www.yegor256.com/2014/08/03/cacheable-java-annotation.html%3F2014-31&amp;title=Cache+Java+Method+Results" title="Share on Reddit" class="button" rel="nofollow"> <span class="count count-reddit">0</span> <i class="icon icon-reddit notranslate" aria-hidden="true"></i> </a> <a href="http://news.ycombinator.com/submitlink?u=https://www.yegor256.com/2014/08/03/cacheable-java-annotation.html%3F2014-31&amp;t=Cache+Java+Method+Results" title="Share on Hacker News" class="button" rel="nofollow"> <span class="count count-hackernews">0</span> <i class="icon icon-hackernews notranslate" aria-hidden="true"></i> </a> </nav> </header> <article class="main" itemprop="articleBody"><div > <figure class="badge"><a href="http://aspects.jcabi.com"><img src="http://img.jcabi.com/logo-square.svg" style="width:64px;max-width:100%;" alt="badge" /></a></figure><p>Say, you have a method that takes time to execute and you want its result to be cached. There are <a href="http://www.coderanch.com/how-to/java/CachingStrategies">many solutions</a>, including <a href="http://commons.apache.org/proper/commons-jcs/">Apache Commons JCS</a>, <a href="http://www.ehcache.org">Ehcache</a>, <a href="https://jcp.org/en/jsr/detail?id=107">JSR 107</a>, <a href="https://code.google.com/p/guava-libraries/wiki/CachesExplained">Guava Caching</a> and many others.</p><p><a href="http://aspects.jcabi.com/annotation-cacheable.html">jcabi-aspects</a> offers a very simple one, based on AOP aspects and Java6 <a href="/2016/04/12/java-annotations-are-evil.html">annotations</a>:</p><figure class="highlight"><pre><code class="language-java" data-lang="java"><span></span><span class="kn">import</span> <span class="nn">com.jcabi.aspects.Cacheable</span><span class="o">;</span>
<span class="kd">public</span> <span class="kd">class</span> <span class="nc">Page</span> <span class="o">{</span>
  <span class="nd">@Cacheable</span><span class="o">(</span><span class="n">lifetime</span> <span class="o">=</span> <span class="mi">5</span><span class="o">,</span> <span class="n">unit</span> <span class="o">=</span> <span class="n">TimeUnit</span><span class="o">.</span><span class="na">MINUTES</span><span class="o">)</span>
  <span class="n">String</span> <span class="nf">load</span><span class="o">()</span> <span class="o">{</span>
    <span class="k">return</span> <span class="k">new</span> <span class="n">URL</span><span class="o">(</span><span class="s">&quot;http://google.com&quot;</span><span class="o">).</span><span class="na">getContent</span><span class="o">().</span><span class="na">toString</span><span class="o">();</span>
  <span class="o">}</span>
<span class="o">}</span></code></pre></figure><p>The result of <code>load()</code> method will be cached in memory for five minutes.</p><h2 id="how-it-works">How It Works?</h2><p>This post about <a href="/2014/06/01/aop-aspectj-java-method-logging.html">AOP, AspectJ and method logging</a> explains how “aspect weaving” works (I highly recommend that you read it first).</p><p>Here I’ll explain how caching works.</p><p>The approach is very straight forward. There is a static hash map with keys as “method coordinates” and values as their results. Method coordinates consist of the object, an owner of the method and a method name with parameter types.</p><p>In the example above, right after the method <code>load()</code> finishes, the map gets a new entry (simplified example, of course):</p><figure class="highlight"><pre><code class="language-text" data-lang="text"><span></span>key: [page, &quot;load()&quot;]
value: &quot;&lt;html&gt;...&lt;/html&gt;&quot;</code></pre></figure><p>Every consecutive call to <code>load()</code> will be intercepted by the aspect from <a href="http://aspects.jcabi.com">jcabi-aspects</a> and resolved immediately with a value from the cache map. The method will not get any control until the end of its lifetime, which is five minutes in the example above.</p><h2 id="what-about-cache-flushing">What About Cache Flushing?</h2><p>Sometimes it’s necessary to have the ability to flush cache before the end of its lifetime. Here is a practical example:</p><figure class="highlight"><pre><code class="language-java" data-lang="java"><span></span><span class="kn">import</span> <span class="nn">com.jcabi.aspects.Cacheable</span><span class="o">;</span>
<span class="kd">public</span> <span class="kd">class</span> <span class="nc">Employees</span> <span class="o">{</span>
  <span class="nd">@Cacheable</span><span class="o">(</span><span class="n">lifetime</span> <span class="o">=</span> <span class="mi">1</span><span class="o">,</span> <span class="n">unit</span> <span class="o">=</span> <span class="n">TimeUnit</span><span class="o">.</span><span class="na">HOURS</span><span class="o">)</span>
  <span class="kt">int</span> <span class="nf">size</span><span class="o">()</span> <span class="o">{</span>
    <span class="c1">// calculate their amount in MySQL</span>
  <span class="o">}</span>
  <span class="nd">@Cacheable.FlushBefore</span>
  <span class="kt">void</span> <span class="nf">add</span><span class="o">(</span><span class="n">Employee</span> <span class="n">employee</span><span class="o">)</span> <span class="o">{</span>
    <span class="c1">// add a new one to MySQL</span>
  <span class="o">}</span>
<span class="o">}</span></code></pre></figure><p>It’s obvious that the number of employees in the database will be different after <code>add()</code> method execution and the result of <code>size()</code> should be invalidated in cache. This invalidation operation is called “flushing” and <code>@Cacheable.FlushBefore</code> triggers it.</p><p>Actually, every call to <code>add()</code> invalidates all cached methods in this class, not only <code>size()</code>.</p><p>There is also <code>@Cacheable.FlushAfter</code>. The difference is that <code>FlushBefore</code> guarantees that cache is already invalidated when the method <code>add()</code> starts. <code>FlushAfter</code> invalidates cache after method <code>add()</code> finishes. This small difference makes a big one, sometimes.</p><p>This article explains <a href="http://aspects.jcabi.com/example-weaving.html">how to add jcabi-aspects to your project</a>.</p></div></article></div><div class="wrapper"> <related-posts /></div><div class="disqus" role="complementary"><p class="disqus_hint"> Please, use <a href="https://help.disqus.com/commenting/what-html-tags-are-allowed-within-comments">syntax highlighting</a> in your comments, to make them more readable.</p><div id="disqus_thread" class="disqus-thread"> <a>&nbsp;</a></div><script> var disqus_config = function () { this.page.url = document.location.href.split('?')[0].split('#')[0].replace('https://', 'http://'); this.page.identifier = this.page.url; }; (function() { var d = document, s = d.createElement('script'); s.src = '//yegor256.disqus.com/embed.js'; s.setAttribute('data-timestamp', +new Date()); (d.head || d.body).appendChild(s); })(); </script> <noscript><div><p class="red"> JavaScript is disabled in your browser, that's why you can't see comments under this post.</p></div></noscript></div><div class="wrapper"> <footer class="footer"><p> &copy; <span itemscope="" itemprop="copyrightHolder" itemtype="http://schema.org/Person"> <span itemprop="name">Yegor Bugayenko</span> </span> 2014&ndash;<span itemprop="copyrightYear">2018</span></p></footer></div></section><div class="wrapper unprintable" style="text-align:center;margin-top:2em;"> <a href="http://www.sixnines.io/h/3ba1652f"> <img src="//www.sixnines.io/b/3ba1652f?style=flat" alt="sixnines availability badge"/> </a></div><script src="//code.jquery.com/jquery-1.9.0.min.js"></script> <script src="/js/all.js?7d5b276b9b5"></script> <script>var disqus_shortname = 'yegor256';</script> <script id="dsq-count-scr" src="//yegor256.disqus.com/count.js" async="async"></script> <script> (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){ (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o), m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m) })(window,document,'script','//www.google-analytics.com/analytics.js','ga'); ga('create', 'UA-1963507-32', 'auto'); ga('send', 'pageview'); </script> <script> Cd=document;Cr="&"+Math.random();Cp="&s=1"; Cd.cookie="b=b";if(Cd.cookie)Cp+="&c=1"; Cp+="&t="+(new Date()).getTimezoneOffset(); if(self!=top)Cp+="&f=1"; </script> <script> if(navigator.javaEnabled())Cp+="&j=1"; </script> <script> if(typeof(screen)!='undefined')Cp+="&w="+screen.width+"&h="+ screen.height+"&d="+(screen.colorDepth?screen.colorDepth:screen.pixelDepth); </script> <script> Cd.write("<img src='//c.hit.ua/hit?i=95870&g=0&x=2"+Cp+Cr+ "&r="+escape(Cd.referrer)+"&u="+escape(window.location.href)+ "' border='0' wi"+"dth='1' he"+"ight='1'/>"); </script> <script type="application/ld+json"> { "@context": "http://schema.org", "@type": "Person", "name": "Yegor Bugayenko", "url": "https://www.yegor256.com", "sameAs": [ "https://www.facebook.com/yegor256", "https://instagram.com/yegor256", "https://www.linkedin.com/in/yegor256", "https://twitter.com/yegor256", "https://github.com/yegor256", "https://www.pinterest.com/yegor256/" ] } </script> </body> </html> <!DOCTYPE html> <html xmlns="http://www.w3.org/1999/xhtml" lang="en-US" xml:lang="en-US" itemscope="" itemtype="http://schema.org/WebSite"> <head> <meta charset="utf-8"/> <meta name="description" content="&lt;figure class=&quot;badge&quot;&gt;&lt;a href=&quot;http://aspects.jcabi.com&quot;&gt;&lt;img src=&quot;http://img.jcabi.com/logo-square.svg&quot; style=&quot;width:64px;max-width:100%;&quot; alt=&quot;badge&quot; /&gt;&lt;/a&gt;&lt;/figure&gt; &lt;p&gt;Say, you want to allow a Java method to work for a maximum of five seconds and want an exception to be thrown if the timeframe is exceeded. Here is how you can do it with &lt;a href=&quot;http://aspects.jcabi.com&quot;&gt;jcabi-aspects&lt;/a&gt; and &lt;a href=&quot;http://eclipse.org/aspectj/&quot;&gt;AspectJ&lt;/a&gt;:&lt;/p&gt; &lt;figure class=&quot;highlight&quot;&gt;&lt;pre&gt;&lt;code class=&quot;language-java&quot; data-lang=&quot;java&quot;&gt;&lt;span&gt;&lt;/span&gt;&lt;span class=&quot;kd&quot;&gt;public&lt;/span&gt; &lt;span class=&quot;kd&quot;&gt;class&lt;/span&gt; &lt;span class=&quot;nc&quot;&gt;Resource&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;{&lt;/span&gt; &lt;span class=&quot;nd&quot;&gt;@Timeable&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;limit&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;mi&quot;&gt;5&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;unit&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;TimeUnit&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;na&quot;&gt;SECONDS&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;kd&quot;&gt;public&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;String&lt;/span&gt; &lt;span class=&quot;nf&quot;&gt;load&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;URL&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;url&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;{&lt;/span&gt; &lt;span class=&quot;k&quot;&gt;return&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;url&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;na&quot;&gt;openConnection&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;().&lt;/span&gt;&lt;span class=&quot;na&quot;&gt;getContent&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;();&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;}&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;}&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/figure&gt; &lt;!--more--&gt; &lt;p&gt;Keep in mind that you should weave your classes after compilation, as explained &lt;a href=&quot;http://aspects.jcabi.com/example-weaving.html&quot;&gt;here&lt;/a&gt;.&lt;/p&gt; &lt;p&gt;Let’s discuss how this actually works, but first, I recommend you read &lt;a href=&quot;/2014/06/01/aop-aspectj-java-method-logging.html&quot;&gt;this post&lt;/a&gt;, which explains how AOP aspects work together with &lt;a href=&quot;/2016/04/12/java-annotations-are-evil.html&quot;&gt;Java annotations&lt;/a&gt;.&lt;/p&gt; &lt;p&gt;Due to &lt;a href=&quot;http://aspects.jcabi.com/annotation-timeable.html&quot;&gt;&lt;code&gt;@Timeable&lt;/code&gt;&lt;/a&gt; annotation and class weaving, every call to a method &lt;code&gt;load()&lt;/code&gt; is intercepted by an aspect from &lt;a href=&quot;http://aspects.jcabi.com&quot;&gt;jcabi-aspects&lt;/a&gt;. That aspect starts a new thread that monitors the execution of a method every second, checking whether it is still running.&lt;/p&gt; &lt;p&gt;If the method runs for over five seconds, the thread calls &lt;a href=&quot;http://docs.oracle.com/javase/7/docs/api/java/lang/Thread.html#interrupt%28%29&quot;&gt;&lt;code&gt;interrupt()&lt;/code&gt;&lt;/a&gt; on the method’s thread.&lt;/p&gt; &lt;p&gt;Despite a very common expectation that a thread should be terminated immediately on that call, it is not happening at all. &lt;a href=&quot;http://docs.oracle.com/javase/1.5.0/docs/guide/misc/threadPrimitiveDeprecation.html&quot;&gt;This article&lt;/a&gt; explains the mechanism in more detail. Let’s discuss it briefly:&lt;/p&gt; &lt;ol&gt; &lt;li&gt; &lt;p&gt;&lt;a href=&quot;http://docs.oracle.com/javase/7/docs/api/java/lang/Thread.html#interrupt%28%29&quot;&gt;&lt;code&gt;interrupt()&lt;/code&gt;&lt;/a&gt; sets a marker in a thread;&lt;/p&gt; &lt;/li&gt; &lt;li&gt; &lt;p&gt;The thread checks &lt;a href=&quot;http://docs.oracle.com/javase/7/docs/api/java/lang/Thread.html#interrupt%28%29&quot;&gt;&lt;code&gt;interrupted()&lt;/code&gt;&lt;/a&gt; as often as it can;&lt;/p&gt; &lt;/li&gt; &lt;li&gt; &lt;p&gt;If the marker is set, the thread stops and throws &lt;a href=&quot;http://docs.oracle.com/javase/7/docs/api/java/lang/InterruptedException.html&quot;&gt;&lt;code&gt;InterruptedException&lt;/code&gt;&lt;/a&gt;&lt;/p&gt; &lt;/li&gt; &lt;/ol&gt; &lt;p&gt;This method will &lt;strong&gt;not&lt;/strong&gt; react to &lt;code&gt;interrupt()&lt;/code&gt; call and will work until JVM is killed (very bad design):&lt;/p&gt; &lt;figure class=&quot;highlight&quot;&gt;&lt;pre&gt;&lt;code class=&quot;language-java&quot; data-lang=&quot;java&quot;&gt;&lt;span&gt;&lt;/span&gt;&lt;span class=&quot;kd&quot;&gt;public&lt;/span&gt; &lt;span class=&quot;kt&quot;&gt;void&lt;/span&gt; &lt;span class=&quot;nf&quot;&gt;work&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;()&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;{&lt;/span&gt; &lt;span class=&quot;k&quot;&gt;while&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;kc&quot;&gt;true&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;{&lt;/span&gt; &lt;span class=&quot;c1&quot;&gt;// do something&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;}&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;}&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/figure&gt; &lt;p&gt;This is how we should refactor it in order to make sensitive to interruption requests:&lt;/p&gt; &lt;figure class=&quot;highlight&quot;&gt;&lt;pre&gt;&lt;code class=&quot;language-java&quot; data-lang=&quot;java&quot;&gt;&lt;span&gt;&lt;/span&gt;&lt;span class=&quot;kd&quot;&gt;public&lt;/span&gt; &lt;span class=&quot;kt&quot;&gt;void&lt;/span&gt; &lt;span class=&quot;nf&quot;&gt;work&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;()&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;{&lt;/span&gt; &lt;span class=&quot;k&quot;&gt;while&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;kc&quot;&gt;true&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;{&lt;/span&gt; &lt;span class=&quot;k&quot;&gt;if&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;Thread&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;na&quot;&gt;interruped&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;())&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;{&lt;/span&gt; &lt;span class=&quot;k&quot;&gt;throw&lt;/span&gt; &lt;span class=&quot;k&quot;&gt;new&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;InterruptedException&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;();&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;}&lt;/span&gt; &lt;span class=&quot;c1&quot;&gt;// do something&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;}&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;}&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/figure&gt; &lt;p&gt;In other words, your method can only stop itself. Nothing else can do it. The thread it is running in can’t be terminated by another thread. The best thing that the other thread can do is to send your thread a “message” (through &lt;code&gt;interrupt()&lt;/code&gt; method) that it’s time to stop. If your thread ignores the message, nobody can do anything.&lt;/p&gt; &lt;p&gt;Most I/O operations in JDK are designed this way. They check the interruption status of their threads while waiting for I/O resources.&lt;/p&gt; &lt;p&gt;Thus, use &lt;code&gt;@Timeable&lt;/code&gt; annotation, but keep in mind that there could be situations when a thread can’t be interrupted.&lt;/p&gt; " /> <meta name="keywords" content="next, path, output, content, previous, url, relative_path, id, collection, excerpt, draft, categories, layout, title, date, tags, description, keywords, slug, ext" /> <meta name="viewport" content="width=device-width,minimum-scale=1,initial-scale=1"/> <meta name="google-site-verification" content="JEj_gQr2CPe2QKGw8XdMz0R7VboQIUbX3FlM-lwTq-8" /> <meta name="author" content="Yegor Bugayenko"> <meta name="article:published_time" content="2014-06-20 00:00:00 +0000"> <meta name="og:site_name" content="Yegor Bugayenko"/> <meta name="og:type" content="article" /> <meta name="og:locale" content="en_US" /> <meta name="twitter:account_id" content="4503599630178231" /> <meta name="twitter:creator" content="@yegor256"/> <meta name="twitter:site" content="@yegor256"/> <meta name="twitter:title" property="og:title" content="Limit Java Method Execution Time"/> <meta name="twitter:description" property="og:description" content="&lt;figure class=&quot;badge&quot;&gt;&lt;a href=&quot;http://aspects.jcabi.com&quot;&gt;&lt;img src=&quot;http://img.jcabi.com/logo-square.svg&quot; style=&quot;width:64px;max-width:100%;&quot; alt=&quot;badge&quot; /&gt;&lt;/a&gt;&lt;/figure&gt; &lt;p&gt;Say, you want to allow a Java method to work for a maximum of five seconds and want an exception to be thrown if the timeframe is exceeded. Here is how you can do it with &lt;a href=&quot;http://aspects.jcabi.com&quot;&gt;jcabi-aspects&lt;/a&gt; and &lt;a href=&quot;http://eclipse.org/aspectj/&quot;&gt;AspectJ&lt;/a&gt;:&lt;/p&gt; &lt;figure class=&quot;highlight&quot;&gt;&lt;pre&gt;&lt;code class=&quot;language-java&quot; data-lang=&quot;java&quot;&gt;&lt;span&gt;&lt;/span&gt;&lt;span class=&quot;kd&quot;&gt;public&lt;/span&gt; &lt;span class=&quot;kd&quot;&gt;class&lt;/span&gt; &lt;span class=&quot;nc&quot;&gt;Resource&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;{&lt;/span&gt; &lt;span class=&quot;nd&quot;&gt;@Timeable&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;limit&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;mi&quot;&gt;5&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;unit&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;TimeUnit&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;na&quot;&gt;SECONDS&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;kd&quot;&gt;public&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;String&lt;/span&gt; &lt;span class=&quot;nf&quot;&gt;load&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;URL&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;url&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;{&lt;/span&gt; &lt;span class=&quot;k&quot;&gt;return&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;url&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;na&quot;&gt;openConnection&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;().&lt;/span&gt;&lt;span class=&quot;na&quot;&gt;getContent&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;();&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;}&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;}&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/figure&gt; &lt;!--more--&gt; &lt;p&gt;Keep in mind that you should weave your classes after compilation, as explained &lt;a href=&quot;http://aspects.jcabi.com/example-weaving.html&quot;&gt;here&lt;/a&gt;.&lt;/p&gt; &lt;p&gt;Let’s discuss how this actually works, but first, I recommend you read &lt;a href=&quot;/2014/06/01/aop-aspectj-java-method-logging.html&quot;&gt;this post&lt;/a&gt;, which explains how AOP aspects work together with &lt;a href=&quot;/2016/04/12/java-annotations-are-evil.html&quot;&gt;Java annotations&lt;/a&gt;.&lt;/p&gt; &lt;p&gt;Due to &lt;a href=&quot;http://aspects.jcabi.com/annotation-timeable.html&quot;&gt;&lt;code&gt;@Timeable&lt;/code&gt;&lt;/a&gt; annotation and class weaving, every call to a method &lt;code&gt;load()&lt;/code&gt; is intercepted by an aspect from &lt;a href=&quot;http://aspects.jcabi.com&quot;&gt;jcabi-aspects&lt;/a&gt;. That aspect starts a new thread that monitors the execution of a method every second, checking whether it is still running.&lt;/p&gt; &lt;p&gt;If the method runs for over five seconds, the thread calls &lt;a href=&quot;http://docs.oracle.com/javase/7/docs/api/java/lang/Thread.html#interrupt%28%29&quot;&gt;&lt;code&gt;interrupt()&lt;/code&gt;&lt;/a&gt; on the method’s thread.&lt;/p&gt; &lt;p&gt;Despite a very common expectation that a thread should be terminated immediately on that call, it is not happening at all. &lt;a href=&quot;http://docs.oracle.com/javase/1.5.0/docs/guide/misc/threadPrimitiveDeprecation.html&quot;&gt;This article&lt;/a&gt; explains the mechanism in more detail. Let’s discuss it briefly:&lt;/p&gt; &lt;ol&gt; &lt;li&gt; &lt;p&gt;&lt;a href=&quot;http://docs.oracle.com/javase/7/docs/api/java/lang/Thread.html#interrupt%28%29&quot;&gt;&lt;code&gt;interrupt()&lt;/code&gt;&lt;/a&gt; sets a marker in a thread;&lt;/p&gt; &lt;/li&gt; &lt;li&gt; &lt;p&gt;The thread checks &lt;a href=&quot;http://docs.oracle.com/javase/7/docs/api/java/lang/Thread.html#interrupt%28%29&quot;&gt;&lt;code&gt;interrupted()&lt;/code&gt;&lt;/a&gt; as often as it can;&lt;/p&gt; &lt;/li&gt; &lt;li&gt; &lt;p&gt;If the marker is set, the thread stops and throws &lt;a href=&quot;http://docs.oracle.com/javase/7/docs/api/java/lang/InterruptedException.html&quot;&gt;&lt;code&gt;InterruptedException&lt;/code&gt;&lt;/a&gt;&lt;/p&gt; &lt;/li&gt; &lt;/ol&gt; &lt;p&gt;This method will &lt;strong&gt;not&lt;/strong&gt; react to &lt;code&gt;interrupt()&lt;/code&gt; call and will work until JVM is killed (very bad design):&lt;/p&gt; &lt;figure class=&quot;highlight&quot;&gt;&lt;pre&gt;&lt;code class=&quot;language-java&quot; data-lang=&quot;java&quot;&gt;&lt;span&gt;&lt;/span&gt;&lt;span class=&quot;kd&quot;&gt;public&lt;/span&gt; &lt;span class=&quot;kt&quot;&gt;void&lt;/span&gt; &lt;span class=&quot;nf&quot;&gt;work&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;()&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;{&lt;/span&gt; &lt;span class=&quot;k&quot;&gt;while&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;kc&quot;&gt;true&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;{&lt;/span&gt; &lt;span class=&quot;c1&quot;&gt;// do something&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;}&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;}&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/figure&gt; &lt;p&gt;This is how we should refactor it in order to make sensitive to interruption requests:&lt;/p&gt; &lt;figure class=&quot;highlight&quot;&gt;&lt;pre&gt;&lt;code class=&quot;language-java&quot; data-lang=&quot;java&quot;&gt;&lt;span&gt;&lt;/span&gt;&lt;span class=&quot;kd&quot;&gt;public&lt;/span&gt; &lt;span class=&quot;kt&quot;&gt;void&lt;/span&gt; &lt;span class=&quot;nf&quot;&gt;work&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;()&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;{&lt;/span&gt; &lt;span class=&quot;k&quot;&gt;while&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;kc&quot;&gt;true&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;{&lt;/span&gt; &lt;span class=&quot;k&quot;&gt;if&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;Thread&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;na&quot;&gt;interruped&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;())&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;{&lt;/span&gt; &lt;span class=&quot;k&quot;&gt;throw&lt;/span&gt; &lt;span class=&quot;k&quot;&gt;new&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;InterruptedException&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;();&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;}&lt;/span&gt; &lt;span class=&quot;c1&quot;&gt;// do something&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;}&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;}&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/figure&gt; &lt;p&gt;In other words, your method can only stop itself. Nothing else can do it. The thread it is running in can’t be terminated by another thread. The best thing that the other thread can do is to send your thread a “message” (through &lt;code&gt;interrupt()&lt;/code&gt; method) that it’s time to stop. If your thread ignores the message, nobody can do anything.&lt;/p&gt; &lt;p&gt;Most I/O operations in JDK are designed this way. They check the interruption status of their threads while waiting for I/O resources.&lt;/p&gt; &lt;p&gt;Thus, use &lt;code&gt;@Timeable&lt;/code&gt; annotation, but keep in mind that there could be situations when a thread can’t be interrupted.&lt;/p&gt; "/> <meta name="twitter:url" property="og:url" content="https://www.yegor256.com/2014/06/20/limit-method-execution-time.html"/> <meta name="telegram:channel" content="AAAAAEJFMRzsRTRxM3ec6A"/> <link rel="search" type="application/opensearchdescription+xml" href="/opensearch.xml" title="yegor256" /> <link rel="shortcut icon" href="/favicon.ico?7d5b276b9b5"/> <link rel="apple-touch-icon" href="/favicon.ico?7d5b276b9b5"/> <link rel="alternate" type="application/rss+xml" title="RSS for yegor256.com" href="https://www.yegor256.com/rss.xml"/> <link rel="stylesheet" href="/css/layout.css?7d5b276b9b5"/> <link rel="stylesheet" href="/css/icons.css?7d5b276b9b5"/> <link rel="canonical" href="https://www.yegor256.com/2014/06/20/limit-method-execution-time.html" /> <link rel="amphtml" href="https://www.yegor256.com/2014/06/20/limit-method-execution-time.amp.html" /> <title>Limit Java Method Execution Time </title> </head> <body><div class="wrapper"> <aside class="header-toggle unprintable" id="header-toggle" title="Show the menu" onclick="$('#header').show();$('#header-toggle').hide();">&#9776;</aside> <header class="header" id="header"><div class="face"> <a href="/about-me.html#form" class="sub" title="Click to subscribe to my monthly newsletter"><span>Subscribe</span></a> <a href="/about-me.html" style="position:relative;"> <img src="/images/face-256x256.jpg" class="photo" alt="Yegor Bugayenko"/> </a></div><nav><ul class="menu social notranslate"> <li><a href="https://twitter.com/intent/follow?screen_name=yegor256" rel="nofollow" title="Follow me on Twitter"><i class="icon icon-twitter notranslate" aria-hidden="true"></i></a></li> <li><a href="/rss.xml" rel="nofollow" title="Subscribe to my RSS feed"><i class="icon icon-rss notranslate" aria-hidden="true"></i></a></li> <li><a itemprop="sameAs" href="https://github.com/yegor256" rel="nofollow" title="My GitHub profile"><i class="icon icon-github notranslate" aria-hidden="true"></i></a></li> <li><a itemprop="sameAs" href="http://stackoverflow.com/users/187141/yegor256" rel="nofollow" title="My StackOverflow profile"><i class="icon icon-stackoverflow notranslate" aria-hidden="true"></i></a></li> <li><a itemprop="sameAs" href="https://www.facebook.com/yegor256" rel="nofollow" title="Follow me on Facebook"><i class="icon icon-facebook notranslate" aria-hidden="true"></i></a></li> <li><a itemprop="sameAs" href="https://instagram.com/yegor256" rel="nofollow" title="Follow me on Instagram"><i class="icon icon-instagram notranslate" aria-hidden="true"></i></a></li> <li><a itemprop="sameAs" href="https://www.linkedin.com/in/yegor256" rel="nofollow" title="My LinkedIn profile"><i class="icon icon-linkedin notranslate" aria-hidden="true"></i></a></li> <li><a itemprop="sameAs" href="https://www.youtube.com/c/yegor256?sub_confirmation=1" rel="nofollow" title="My Youtube video channel"><i class="icon icon-youtube notranslate" aria-hidden="true"></i></a></li> <li><a itemprop="sameAs" href="https://www.pinterest.com/yegor256/" rel="nofollow" title="My Pinterest boards"><i class="icon icon-pinterest notranslate" aria-hidden="true"></i></a></li> <li><a itemprop="sameAs" href="https://angel.co/yegor256" rel="nofollow" title="My AngelList profile"><i class="icon icon-angellist notranslate" aria-hidden="true"></i></a></li> <li><a href="https://soundcloud.com/yegor256" rel="nofollow" title="My podcast"><i class="icon icon-podcast notranslate" aria-hidden="true"></i></a></li> <li><a href="https://itunes.apple.com/us/podcast/yegor256-podcast/id1150826721" rel="nofollow" title="My iTunes podcast"><i class="icon icon-itunes notranslate" aria-hidden="true"></i></a></li> <li><a href="https://t.me/yegor256news" rel="nofollow" title="My Telegram public channel"><i class="icon icon-telegram notranslate" aria-hidden="true"></i></a></li> <li><a href="mailto:blog@yegor256.com" rel="nofollow" title="Email me any time"><i class="icon icon-mail notranslate" aria-hidden="true"></i></a></li></ul><ul class="menu"> <li><a href="/" title="Home page">Home</a></li> <li /2014/06/20/limit-method-execution-time.html><a href="/best.html" title="Best articles to read">12&#160;Best</a></li> <li /2014/06/20/limit-method-execution-time.html><a href="/contents.html" title="The contents of the entire blog">All&#160;292</a></li> <li /2014/06/20/limit-method-execution-time.html><a href="/webinars.html" title="My webinars">Webinars</a></li> <li /2014/06/20/limit-method-execution-time.html><a href="/talks.html" title="Future and past conference talks">Talks</a></li> <li /2014/06/20/limit-method-execution-time.html><a href="/books.html" title="The books I wrote">Books</a></li> <li /2014/06/20/limit-method-execution-time.html><a href="/papers.html" title="My academic papers and patents">Papers</a></li> <li /2014/06/20/limit-method-execution-time.html><a href="/pets.html" title="My loved pet projects">Pets</a></li> <li /2014/06/20/limit-method-execution-time.html class="highlighted"><a href="/trainings.html" title="On-site trainings">Trainings</a></li> <li /2014/06/20/limit-method-execution-time.html><a href="/award.html" title="Software quality award">Award</a></li> <li /2014/06/20/limit-method-execution-time.html><a href="/testimonials.html" title="What some people say about me">Testimonials</a></li> <li /2014/06/20/limit-method-execution-time.html><a href="/shift-m.html" title="Audio podcast about project management">Shift-M</a></li> <li /2014/06/20/limit-method-execution-time.html><a href="/paintings.html" title="My paintings for sale">Paintings</a></li> <li><a href="https://ru.yegor256.com/" title="Немного на русском языке">По-русски</a></li></ul></nav><div class="search"> <form method="get" action="https://www.google.com/search" itemprop="potentialAction" itemscope="" itemtype="http://schema.org/SearchAction"> <meta itemprop="target" content="https://www.google.com/search?q={q}"/> <input name="sitesearch" value="yegor256.com" type="hidden"/> <input itemprop="query-input" type="text" id="search-query" class="field field-text" required="required" onfocus="$('.google').css('visibility', 'visible');" name="q" placeholder="Search..." autocomplete="off"/> <input type="image" src="/images/google-search-icon.svg" class="google" title="Search via Google" alt="Search via Google"/> </form></div><div class="hot"><ul></ul></div></header></div><section itemscope="" itemtype="http://schema.org/BlogPosting"><div class="wrapper"> <header><p class="printable"> <img src="https://api.qrserver.com/v1/create-qr-code/?data=https://www.yegor256.com/2014/06/20/limit-method-execution-time.html&amp;format=svg" style="width:125px;height:125px;" alt="QR code"/></p><p class="printable"> <code itemprop="url">https://www.yegor256.com/2014/06/20/limit-method-execution-time.html</code></p><h1 itemprop="name headline mainEntityOfPage">Limit Java Method Execution Time</h1><ul class="subline"> <li> <time itemprop="datePublished" datetime="2014-06-20T00:00:00+00:00"> 20 June 2014 </time> </li> <li class="printable" itemscope="" itemprop="author" itemtype="http://schema.org/Person"> <span itemprop="name">Yegor Bugayenko</span> </li> <li class="unprintable"> <i class="icon icon-comments"></i> <a href="https://www.yegor256.com/2014/06/20/limit-method-execution-time.html#disqus_thread" itemprop="discussionUrl">comments</a> </li></ul><p class="unprintable"><figure class="badge"><a href="http://aspects.jcabi.com"><img src="http://img.jcabi.com/logo-square.svg" style="width:64px;max-width:100%;" alt="badge" /></a></figure><p>Say, you want to allow a Java method to work for a maximum of five seconds and want an exception to be thrown if the timeframe is exceeded. Here is how you can do it with <a href="http://aspects.jcabi.com">jcabi-aspects</a> and <a href="http://eclipse.org/aspectj/">AspectJ</a>:</p><figure class="highlight"><pre><code class="language-java" data-lang="java"><span></span><span class="kd">public</span> <span class="kd">class</span> <span class="nc">Resource</span> <span class="o">{</span>
  <span class="nd">@Timeable</span><span class="o">(</span><span class="n">limit</span> <span class="o">=</span> <span class="mi">5</span><span class="o">,</span> <span class="n">unit</span> <span class="o">=</span> <span class="n">TimeUnit</span><span class="o">.</span><span class="na">SECONDS</span><span class="o">)</span>
  <span class="kd">public</span> <span class="n">String</span> <span class="nf">load</span><span class="o">(</span><span class="n">URL</span> <span class="n">url</span><span class="o">)</span> <span class="o">{</span>
    <span class="k">return</span> <span class="n">url</span><span class="o">.</span><span class="na">openConnection</span><span class="o">().</span><span class="na">getContent</span><span class="o">();</span>
  <span class="o">}</span>
<span class="o">}</span></code></pre></figure><p>Keep in mind that you should weave your classes after compilation, as explained <a href="http://aspects.jcabi.com/example-weaving.html">here</a>.</p><p>Let’s discuss how this actually works, but first, I recommend you read <a href="/2014/06/01/aop-aspectj-java-method-logging.html">this post</a>, which explains how AOP aspects work together with <a href="/2016/04/12/java-annotations-are-evil.html">Java annotations</a>.</p><p>Due to <a href="http://aspects.jcabi.com/annotation-timeable.html"><code>@Timeable</code></a> annotation and class weaving, every call to a method <code>load()</code> is intercepted by an aspect from <a href="http://aspects.jcabi.com">jcabi-aspects</a>. That aspect starts a new thread that monitors the execution of a method every second, checking whether it is still running.</p><p>If the method runs for over five seconds, the thread calls <a href="http://docs.oracle.com/javase/7/docs/api/java/lang/Thread.html#interrupt%28%29"><code>interrupt()</code></a> on the method’s thread.</p><p>Despite a very common expectation that a thread should be terminated immediately on that call, it is not happening at all. <a href="http://docs.oracle.com/javase/1.5.0/docs/guide/misc/threadPrimitiveDeprecation.html">This article</a> explains the mechanism in more detail. Let’s discuss it briefly:</p><ol> <li><p><a href="http://docs.oracle.com/javase/7/docs/api/java/lang/Thread.html#interrupt%28%29"><code>interrupt()</code></a> sets a marker in a thread;</p></li> <li><p>The thread checks <a href="http://docs.oracle.com/javase/7/docs/api/java/lang/Thread.html#interrupt%28%29"><code>interrupted()</code></a> as often as it can;</p></li> <li><p>If the marker is set, the thread stops and throws <a href="http://docs.oracle.com/javase/7/docs/api/java/lang/InterruptedException.html"><code>InterruptedException</code></a></p></li> </ol><p>This method will <strong>not</strong> react to <code>interrupt()</code> call and will work until JVM is killed (very bad design):</p><figure class="highlight"><pre><code class="language-java" data-lang="java"><span></span><span class="kd">public</span> <span class="kt">void</span> <span class="nf">work</span><span class="o">()</span> <span class="o">{</span>
  <span class="k">while</span> <span class="o">(</span><span class="kc">true</span><span class="o">)</span> <span class="o">{</span>
    <span class="c1">// do something</span>
  <span class="o">}</span>
<span class="o">}</span></code></pre></figure><p>This is how we should refactor it in order to make sensitive to interruption requests:</p><figure class="highlight"><pre><code class="language-java" data-lang="java"><span></span><span class="kd">public</span> <span class="kt">void</span> <span class="nf">work</span><span class="o">()</span> <span class="o">{</span>
  <span class="k">while</span> <span class="o">(</span><span class="kc">true</span><span class="o">)</span> <span class="o">{</span>
    <span class="k">if</span> <span class="o">(</span><span class="n">Thread</span><span class="o">.</span><span class="na">interruped</span><span class="o">())</span> <span class="o">{</span>
      <span class="k">throw</span> <span class="k">new</span> <span class="n">InterruptedException</span><span class="o">();</span>
    <span class="o">}</span>
    <span class="c1">// do something</span>
  <span class="o">}</span>
<span class="o">}</span></code></pre></figure><p>In other words, your method can only stop itself. Nothing else can do it. The thread it is running in can’t be terminated by another thread. The best thing that the other thread can do is to send your thread a “message” (through <code>interrupt()</code> method) that it’s time to stop. If your thread ignores the message, nobody can do anything.</p><p>Most I/O operations in JDK are designed this way. They check the interruption status of their threads while waiting for I/O resources.</p><p>Thus, use <code>@Timeable</code> annotation, but keep in mind that there could be situations when a thread can’t be interrupted.</p></p><nav class="buttons notranslate desktop-only"> <a href="http://www.facebook.com/sharer/sharer.php?u=https://www.yegor256.com/2014/06/20/limit-method-execution-time.html" title="Share on Facebook" class="button" rel="nofollow"> <span class="count count-facebook">0</span> <i class="icon icon-facebook notranslate" aria-hidden="true"></i> </a> <a href="https://twitter.com/share?url=https://www.yegor256.com/2014/06/20/limit-method-execution-time.html&amp;text=Limit+Java+Method+Execution+Time" title="Share on Twitter" class="button" rel="nofollow"> <span class="count count-twitter">0</span> <i class="icon icon-twitter notranslate" aria-hidden="true"></i> </a> <a href="https://plus.google.com/share?url=https://www.yegor256.com/2014/06/20/limit-method-execution-time.html" title="Share on Google+" class="button" rel="nofollow"> <span class="count count-googleplus">0</span> <i class="icon icon-googleplus notranslate" aria-hidden="true"></i> </a> <a href="https://www.linkedin.com/cws/share?url=https://www.yegor256.com/2014/06/20/limit-method-execution-time.html" title="Share on LinkedIn" class="button" rel="nofollow"> <span class="count count-linkedin">0</span> <i class="icon icon-linkedin notranslate" aria-hidden="true"></i> </a> <a href="http://reddit.com/submit?url=https://www.yegor256.com/2014/06/20/limit-method-execution-time.html%3F2014-24&amp;title=Limit+Java+Method+Execution+Time" title="Share on Reddit" class="button" rel="nofollow"> <span class="count count-reddit">0</span> <i class="icon icon-reddit notranslate" aria-hidden="true"></i> </a> <a href="http://news.ycombinator.com/submitlink?u=https://www.yegor256.com/2014/06/20/limit-method-execution-time.html%3F2014-24&amp;t=Limit+Java+Method+Execution+Time" title="Share on Hacker News" class="button" rel="nofollow"> <span class="count count-hackernews">0</span> <i class="icon icon-hackernews notranslate" aria-hidden="true"></i> </a> </nav> </header> <article class="main" itemprop="articleBody"><div > <figure class="badge"><a href="http://aspects.jcabi.com"><img src="http://img.jcabi.com/logo-square.svg" style="width:64px;max-width:100%;" alt="badge" /></a></figure><p>Say, you want to allow a Java method to work for a maximum of five seconds and want an exception to be thrown if the timeframe is exceeded. Here is how you can do it with <a href="http://aspects.jcabi.com">jcabi-aspects</a> and <a href="http://eclipse.org/aspectj/">AspectJ</a>:</p><figure class="highlight"><pre><code class="language-java" data-lang="java"><span></span><span class="kd">public</span> <span class="kd">class</span> <span class="nc">Resource</span> <span class="o">{</span>
  <span class="nd">@Timeable</span><span class="o">(</span><span class="n">limit</span> <span class="o">=</span> <span class="mi">5</span><span class="o">,</span> <span class="n">unit</span> <span class="o">=</span> <span class="n">TimeUnit</span><span class="o">.</span><span class="na">SECONDS</span><span class="o">)</span>
  <span class="kd">public</span> <span class="n">String</span> <span class="nf">load</span><span class="o">(</span><span class="n">URL</span> <span class="n">url</span><span class="o">)</span> <span class="o">{</span>
    <span class="k">return</span> <span class="n">url</span><span class="o">.</span><span class="na">openConnection</span><span class="o">().</span><span class="na">getContent</span><span class="o">();</span>
  <span class="o">}</span>
<span class="o">}</span></code></pre></figure><p>Keep in mind that you should weave your classes after compilation, as explained <a href="http://aspects.jcabi.com/example-weaving.html">here</a>.</p><p>Let’s discuss how this actually works, but first, I recommend you read <a href="/2014/06/01/aop-aspectj-java-method-logging.html">this post</a>, which explains how AOP aspects work together with <a href="/2016/04/12/java-annotations-are-evil.html">Java annotations</a>.</p><p>Due to <a href="http://aspects.jcabi.com/annotation-timeable.html"><code>@Timeable</code></a> annotation and class weaving, every call to a method <code>load()</code> is intercepted by an aspect from <a href="http://aspects.jcabi.com">jcabi-aspects</a>. That aspect starts a new thread that monitors the execution of a method every second, checking whether it is still running.</p><p>If the method runs for over five seconds, the thread calls <a href="http://docs.oracle.com/javase/7/docs/api/java/lang/Thread.html#interrupt%28%29"><code>interrupt()</code></a> on the method’s thread.</p><p>Despite a very common expectation that a thread should be terminated immediately on that call, it is not happening at all. <a href="http://docs.oracle.com/javase/1.5.0/docs/guide/misc/threadPrimitiveDeprecation.html">This article</a> explains the mechanism in more detail. Let’s discuss it briefly:</p><ol> <li><p><a href="http://docs.oracle.com/javase/7/docs/api/java/lang/Thread.html#interrupt%28%29"><code>interrupt()</code></a> sets a marker in a thread;</p></li> <li><p>The thread checks <a href="http://docs.oracle.com/javase/7/docs/api/java/lang/Thread.html#interrupt%28%29"><code>interrupted()</code></a> as often as it can;</p></li> <li><p>If the marker is set, the thread stops and throws <a href="http://docs.oracle.com/javase/7/docs/api/java/lang/InterruptedException.html"><code>InterruptedException</code></a></p></li> </ol><p>This method will <strong>not</strong> react to <code>interrupt()</code> call and will work until JVM is killed (very bad design):</p><figure class="highlight"><pre><code class="language-java" data-lang="java"><span></span><span class="kd">public</span> <span class="kt">void</span> <span class="nf">work</span><span class="o">()</span> <span class="o">{</span>
  <span class="k">while</span> <span class="o">(</span><span class="kc">true</span><span class="o">)</span> <span class="o">{</span>
    <span class="c1">// do something</span>
  <span class="o">}</span>
<span class="o">}</span></code></pre></figure><p>This is how we should refactor it in order to make sensitive to interruption requests:</p><figure class="highlight"><pre><code class="language-java" data-lang="java"><span></span><span class="kd">public</span> <span class="kt">void</span> <span class="nf">work</span><span class="o">()</span> <span class="o">{</span>
  <span class="k">while</span> <span class="o">(</span><span class="kc">true</span><span class="o">)</span> <span class="o">{</span>
    <span class="k">if</span> <span class="o">(</span><span class="n">Thread</span><span class="o">.</span><span class="na">interruped</span><span class="o">())</span> <span class="o">{</span>
      <span class="k">throw</span> <span class="k">new</span> <span class="n">InterruptedException</span><span class="o">();</span>
    <span class="o">}</span>
    <span class="c1">// do something</span>
  <span class="o">}</span>
<span class="o">}</span></code></pre></figure><p>In other words, your method can only stop itself. Nothing else can do it. The thread it is running in can’t be terminated by another thread. The best thing that the other thread can do is to send your thread a “message” (through <code>interrupt()</code> method) that it’s time to stop. If your thread ignores the message, nobody can do anything.</p><p>Most I/O operations in JDK are designed this way. They check the interruption status of their threads while waiting for I/O resources.</p><p>Thus, use <code>@Timeable</code> annotation, but keep in mind that there could be situations when a thread can’t be interrupted.</p></div></article></div><div class="wrapper"> <related-posts /></div><div class="disqus" role="complementary"><p class="disqus_hint"> Please, use <a href="https://help.disqus.com/commenting/what-html-tags-are-allowed-within-comments">syntax highlighting</a> in your comments, to make them more readable.</p><div id="disqus_thread" class="disqus-thread"> <a>&nbsp;</a></div><script> var disqus_config = function () { this.page.url = document.location.href.split('?')[0].split('#')[0].replace('https://', 'http://'); this.page.identifier = this.page.url; }; (function() { var d = document, s = d.createElement('script'); s.src = '//yegor256.disqus.com/embed.js'; s.setAttribute('data-timestamp', +new Date()); (d.head || d.body).appendChild(s); })(); </script> <noscript><div><p class="red"> JavaScript is disabled in your browser, that's why you can't see comments under this post.</p></div></noscript></div><div class="wrapper"> <footer class="footer"><p> &copy; <span itemscope="" itemprop="copyrightHolder" itemtype="http://schema.org/Person"> <span itemprop="name">Yegor Bugayenko</span> </span> 2014&ndash;<span itemprop="copyrightYear">2018</span></p></footer></div></section><div class="wrapper unprintable" style="text-align:center;margin-top:2em;"> <a href="http://www.sixnines.io/h/3ba1652f"> <img src="//www.sixnines.io/b/3ba1652f?style=flat" alt="sixnines availability badge"/> </a></div><script src="//code.jquery.com/jquery-1.9.0.min.js"></script> <script src="/js/all.js?7d5b276b9b5"></script> <script>var disqus_shortname = 'yegor256';</script> <script id="dsq-count-scr" src="//yegor256.disqus.com/count.js" async="async"></script> <script> (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){ (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o), m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m) })(window,document,'script','//www.google-analytics.com/analytics.js','ga'); ga('create', 'UA-1963507-32', 'auto'); ga('send', 'pageview'); </script> <script> Cd=document;Cr="&"+Math.random();Cp="&s=1"; Cd.cookie="b=b";if(Cd.cookie)Cp+="&c=1"; Cp+="&t="+(new Date()).getTimezoneOffset(); if(self!=top)Cp+="&f=1"; </script> <script> if(navigator.javaEnabled())Cp+="&j=1"; </script> <script> if(typeof(screen)!='undefined')Cp+="&w="+screen.width+"&h="+ screen.height+"&d="+(screen.colorDepth?screen.colorDepth:screen.pixelDepth); </script> <script> Cd.write("<img src='//c.hit.ua/hit?i=95870&g=0&x=2"+Cp+Cr+ "&r="+escape(Cd.referrer)+"&u="+escape(window.location.href)+ "' border='0' wi"+"dth='1' he"+"ight='1'/>"); </script> <script type="application/ld+json"> { "@context": "http://schema.org", "@type": "Person", "name": "Yegor Bugayenko", "url": "https://www.yegor256.com", "sameAs": [ "https://www.facebook.com/yegor256", "https://instagram.com/yegor256", "https://www.linkedin.com/in/yegor256", "https://twitter.com/yegor256", "https://github.com/yegor256", "https://www.pinterest.com/yegor256/" ] } </script> </body> </html> <!DOCTYPE html> <html xmlns="http://www.w3.org/1999/xhtml" lang="en-US" xml:lang="en-US" itemscope="" itemtype="http://schema.org/WebSite"> <head> <meta charset="utf-8"/> <meta name="description" content="&lt;p&gt;Sometimes, I want to log (through &lt;a href=&quot;http://www.slf4j.org&quot;&gt;slf4j&lt;/a&gt; and &lt;a href=&quot;http://logging.apache.org/log4j/2.x/&quot;&gt;log4j&lt;/a&gt;) every execution of a method, seeing what arguments it receives, what it returns and how much time every execution takes. This is how I’m doing it, with help of &lt;a href=&quot;http://eclipse.org/aspectj/&quot;&gt;AspectJ&lt;/a&gt;, &lt;a href=&quot;http://aspects.jcabi.com&quot;&gt;jcabi-aspects&lt;/a&gt; and Java 6 &lt;a href=&quot;/2016/04/12/java-annotations-are-evil.html&quot;&gt;annotations&lt;/a&gt;:&lt;/p&gt; &lt;figure class=&quot;highlight&quot;&gt;&lt;pre&gt;&lt;code class=&quot;language-java&quot; data-lang=&quot;java&quot;&gt;&lt;span&gt;&lt;/span&gt;&lt;span class=&quot;kd&quot;&gt;public&lt;/span&gt; &lt;span class=&quot;kd&quot;&gt;class&lt;/span&gt; &lt;span class=&quot;nc&quot;&gt;Foo&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;{&lt;/span&gt; &lt;span class=&quot;nd&quot;&gt;@Loggable&lt;/span&gt; &lt;span class=&quot;kd&quot;&gt;public&lt;/span&gt; &lt;span class=&quot;kt&quot;&gt;int&lt;/span&gt; &lt;span class=&quot;nf&quot;&gt;power&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;kt&quot;&gt;int&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;x&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;kt&quot;&gt;int&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;p&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;{&lt;/span&gt; &lt;span class=&quot;k&quot;&gt;return&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;Math&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;na&quot;&gt;pow&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;x&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;p&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;);&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;}&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;}&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/figure&gt; &lt;p&gt;This is what I see in log4j output:&lt;/p&gt; &lt;figure class=&quot;highlight&quot;&gt;&lt;pre&gt;&lt;code class=&quot;language-text&quot; data-lang=&quot;text&quot;&gt;&lt;span&gt;&lt;/span&gt;[INFO] com.example.Foo #power(2, 10): 1024 in 12μs [INFO] com.example.Foo #power(3, 3): 27 in 4μs&lt;/code&gt;&lt;/pre&gt;&lt;/figure&gt; &lt;p&gt;Nice, isn’t it? Now, let’s see how it works.&lt;/p&gt; &lt;!--more--&gt; &lt;h2 id=&quot;annotation-with-runtime-retention&quot;&gt;Annotation with Runtime Retention&lt;/h2&gt; &lt;p&gt;&lt;a href=&quot;http://en.wikipedia.org/wiki/Java_annotation&quot;&gt;Annotations&lt;/a&gt; is a technique introduced in Java 6. It is a meta-programming instrument that doesn’t change the way code works, but gives marks to certain elements (methods, classes or variables). In other words, annotations are just markers attached to the code that can be seen and read. Some annotations are designed to be seen at compile time only—they don’t exist in &lt;code&gt;.class&lt;/code&gt; files after compilation. Others remain visible after compilation and can be accessed in runtime.&lt;/p&gt; &lt;aside class=&quot;youtube&quot;&gt; &lt;a href=&quot;https://www.youtube.com/watch?v=4SRoLYxvIQ8&quot;&gt;&lt;div class=&quot;box&quot;&gt; &lt;img src=&quot;https://i.ytimg.com/vi/4SRoLYxvIQ8/mqdefault.jpg&quot; alt=&quot;YouTube video #4SRoLYxvIQ8&quot; /&gt; &lt;div class=&quot;play&quot;&gt;&lt;i class=&quot;icon icon-play&quot;&gt;&lt;/i&gt;&lt;/div&gt; &lt;/div&gt;&lt;/a&gt; &lt;div&gt;Practical Example of AOP with AspectJ (in Russian with English subtitles); 28 October 2016.&lt;/div&gt;&lt;/aside&gt; &lt;p&gt;For example, &lt;a href=&quot;http://docs.oracle.com/javase/7/docs/api/java/lang/Override.html&quot;&gt;&lt;code&gt;@Override&lt;/code&gt;&lt;/a&gt; is of the first type (its retention type is &lt;a href=&quot;http://docs.oracle.com/javase/7/docs/api/java/lang/annotation/RetentionPolicy.html#SOURCE&quot;&gt;&lt;code&gt;SOURCE&lt;/code&gt;&lt;/a&gt;), while &lt;a href=&quot;http://junit.sourceforge.net/javadoc/org/junit/Test.html&quot;&gt;&lt;code&gt;@Test&lt;/code&gt;&lt;/a&gt; from JUnit is of the second type (retention type is &lt;a href=&quot;http://docs.oracle.com/javase/7/docs/api/java/lang/annotation/RetentionPolicy.html#RUNTIME&quot;&gt;&lt;code&gt;RUNTIME&lt;/code&gt;&lt;/a&gt;). &lt;a href=&quot;http://aspects.jcabi.com/apidocs-0.15.1/com/jcabi/aspects/Loggable.html&quot;&gt;&lt;code&gt;@Loggable&lt;/code&gt;&lt;/a&gt;—the one I’m using in the script above—is an annotation of the second type, from &lt;a href=&quot;http://aspects.jcabi.com&quot;&gt;jcabi-aspects&lt;/a&gt;. It stays with the byte-code in the &lt;code&gt;.class&lt;/code&gt; file after compilation.&lt;/p&gt; &lt;p&gt;Again, it is important to understand that even though method &lt;code&gt;power()&lt;/code&gt; is annotated and compiled, it doesn’t send anything to slf4j so far. It just contains a marker saying “please, log my execution.”&lt;/p&gt; &lt;h2 id=&quot;aspect-oriented-programming-aop&quot;&gt;Aspect Oriented Programming (AOP)&lt;/h2&gt; &lt;p&gt;&lt;a href=&quot;http://en.wikipedia.org/wiki/Aspect-oriented_programming&quot;&gt;AOP&lt;/a&gt; is a useful technique that enables adding executable blocks to the source code without explicitly changing it. In our example, we don’t want to log method execution inside the class. Instead, we want some other class to intercept every call to method &lt;code&gt;power()&lt;/code&gt;, measure its execution time and send this information to slf4j.&lt;/p&gt; &lt;p&gt;We want that interceptor to understand our &lt;code&gt;@Loggable&lt;/code&gt; annotation and log every call to that specific method &lt;code&gt;power()&lt;/code&gt;. And, of course, the same interceptor should be used for other methods where we’ll place the same annotation in the future.&lt;/p&gt; &lt;p&gt;This case perfectly fits the original intent of AOP—to avoid re-implementation of some common behavior in multiple classes.&lt;/p&gt; &lt;p&gt;Logging is a supplementary feature to our main functionality, and we don’t want to pollute our code with multiple logging instructions. Instead, we want &lt;a href=&quot;/2014/05/23/avoid-java-static-logger.html&quot;&gt;logging&lt;/a&gt; to happen behind the scenes.&lt;/p&gt; &lt;p&gt;In terms of AOP, our solution can be explained as creating an &lt;strong&gt;aspect&lt;/strong&gt; that &lt;strong&gt;cross-cuts&lt;/strong&gt; the code at certain &lt;strong&gt;join points&lt;/strong&gt; and applies an &lt;strong&gt;around advice&lt;/strong&gt; that implements the desired functionality.&lt;/p&gt; &lt;h2 id=&quot;aspectj&quot;&gt;AspectJ&lt;/h2&gt; &lt;p&gt;Let’s see what these magic words mean. But, first, let’s see how &lt;a href=&quot;http://aspects.jcabi.com&quot;&gt;jcabi-aspects&lt;/a&gt; implements them using &lt;a href=&quot;http://eclipse.org/aspectj/&quot;&gt;AspectJ&lt;/a&gt; (it’s a simplified example, full code you can find in &lt;a href=&quot;https://github.com/jcabi/jcabi-aspects/blob/jcabi-0.15.2/src/main/java/com/jcabi/aspects/aj/MethodLogger.java&quot;&gt;&lt;code&gt;MethodLogger.java&lt;/code&gt;&lt;/a&gt;):&lt;/p&gt; &lt;figure class=&quot;highlight&quot;&gt;&lt;pre&gt;&lt;code class=&quot;language-java&quot; data-lang=&quot;java&quot;&gt;&lt;span&gt;&lt;/span&gt;&lt;span class=&quot;nd&quot;&gt;@Aspect&lt;/span&gt; &lt;span class=&quot;kd&quot;&gt;public&lt;/span&gt; &lt;span class=&quot;kd&quot;&gt;class&lt;/span&gt; &lt;span class=&quot;nc&quot;&gt;MethodLogger&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;{&lt;/span&gt; &lt;span class=&quot;nd&quot;&gt;@Around&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;s&quot;&gt;&amp;quot;execution(* *(..)) &amp;amp;&amp;amp; @annotation(Loggable)&amp;quot;&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;kd&quot;&gt;public&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;Object&lt;/span&gt; &lt;span class=&quot;nf&quot;&gt;around&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;ProceedingJoinPoint&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;point&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;{&lt;/span&gt; &lt;span class=&quot;kt&quot;&gt;long&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;start&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;System&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;na&quot;&gt;currentTimeMillis&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;();&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;Object&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;result&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;point&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;na&quot;&gt;proceed&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;();&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;Logger&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;na&quot;&gt;info&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;(&lt;/span&gt; &lt;span class=&quot;s&quot;&gt;&amp;quot;#%s(%s): %s in %[msec]s&amp;quot;&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;MethodSignature&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;na&quot;&gt;class&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;na&quot;&gt;cast&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;point&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;na&quot;&gt;getSignature&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;()).&lt;/span&gt;&lt;span class=&quot;na&quot;&gt;getMethod&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;().&lt;/span&gt;&lt;span class=&quot;na&quot;&gt;getName&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;(),&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;point&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;na&quot;&gt;getArgs&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;(),&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;result&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;System&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;na&quot;&gt;currentTimeMillis&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;()&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;-&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;start&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;);&lt;/span&gt; &lt;span class=&quot;k&quot;&gt;return&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;result&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;;&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;}&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;}&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/figure&gt; &lt;p&gt;This is an &lt;strong&gt;aspect&lt;/strong&gt; with a single &lt;strong&gt;around advice&lt;/strong&gt; &lt;code&gt;around()&lt;/code&gt; inside. The aspect is annotated with &lt;code&gt;@Aspect&lt;/code&gt; and advice is annotated with &lt;code&gt;@Around&lt;/code&gt;. As discussed above, these annotations are just markers in &lt;code&gt;.class&lt;/code&gt; files. They don’t do anything except provide some meta-information to those who are interested in runtime.&lt;/p&gt; &lt;p&gt;Annotation &lt;code&gt;@Around&lt;/code&gt; has one parameter, which—in this case—says that the advice should be applied to a method if:&lt;/p&gt; &lt;ol&gt; &lt;li&gt; &lt;p&gt;its visibility modifier is &lt;code&gt;*&lt;/code&gt; (&lt;code&gt;public&lt;/code&gt;, &lt;code&gt;protected&lt;/code&gt; or &lt;code&gt;private&lt;/code&gt;);&lt;/p&gt; &lt;/li&gt; &lt;li&gt; &lt;p&gt;its name is name &lt;code&gt;*&lt;/code&gt; (any name);&lt;/p&gt; &lt;/li&gt; &lt;li&gt; &lt;p&gt;its arguments are &lt;code&gt;..&lt;/code&gt; (any arguments); and&lt;/p&gt; &lt;/li&gt; &lt;li&gt; &lt;p&gt;it is annotated with &lt;code&gt;@Loggable&lt;/code&gt;&lt;/p&gt; &lt;/li&gt; &lt;/ol&gt; &lt;p&gt;When a call to an annotated method is to be intercepted, method &lt;code&gt;around()&lt;/code&gt; executes before executing the actual method. When a call to method &lt;code&gt;power()&lt;/code&gt; is to be intercepted, method &lt;code&gt;around()&lt;/code&gt; receives an instance of class &lt;code&gt;ProceedingJoinPoint&lt;/code&gt; and must return an object, which will be used as a result of method &lt;code&gt;power()&lt;/code&gt;.&lt;/p&gt; &lt;p&gt;In order to call the original method, &lt;code&gt;power()&lt;/code&gt;, the advice has to call &lt;code&gt;proceed()&lt;/code&gt; of the &lt;strong&gt;join point&lt;/strong&gt; object.&lt;/p&gt; &lt;p&gt;We compile this aspect and make it available in classpath together with our main file &lt;code&gt;Foo.class&lt;/code&gt;. So far so good, but we need to take one last step in order to put our aspect into action—we should &lt;strong&gt;apply&lt;/strong&gt; our advice.&lt;/p&gt; &lt;h2 id=&quot;binary-aspect-weaving&quot;&gt;Binary Aspect Weaving&lt;/h2&gt; &lt;p&gt;Aspect weaving is the name of the advice applying process. Aspect weaver modifies original code by injecting calls to aspects. AspectJ does exactly that. We give it two binary Java classes &lt;code&gt;Foo.class&lt;/code&gt; and &lt;code&gt;MethodLogger.class&lt;/code&gt;; it gives back three—modified &lt;code&gt;Foo.class&lt;/code&gt;, &lt;code&gt;Foo$AjcClosure1.class&lt;/code&gt; and unmodified &lt;code&gt;MethodLogger.class&lt;/code&gt;.&lt;/p&gt; &lt;aside class=&quot;quote&quot;&gt;Without weaving, both classes and aspects are just compiled Java binaries with attached annotations&lt;/aside&gt; &lt;p&gt;In order to understand which advice should be applied to which methods, AspectJ weaver is using annotations from &lt;code&gt;.class&lt;/code&gt; files. Also, it uses &lt;a href=&quot;http://docs.oracle.com/javase/tutorial/reflect/&quot;&gt;reflection&lt;/a&gt; to browse all classes on classpath. It analyzes which methods satisfy the conditions from the &lt;code&gt;@Around&lt;/code&gt; annotation. Of course, it finds our method &lt;code&gt;power()&lt;/code&gt;.&lt;/p&gt; &lt;p&gt;So, there are two steps. First, we compile our &lt;code&gt;.java&lt;/code&gt; files using &lt;code&gt;javac&lt;/code&gt; and get two files. Then, AspectJ weaves/modifies them and creates its own extra class. Our &lt;code&gt;Foo&lt;/code&gt; class looks something like this after weaving:&lt;/p&gt; &lt;figure class=&quot;highlight&quot;&gt;&lt;pre&gt;&lt;code class=&quot;language-java&quot; data-lang=&quot;java&quot;&gt;&lt;span&gt;&lt;/span&gt;&lt;span class=&quot;kd&quot;&gt;public&lt;/span&gt; &lt;span class=&quot;kd&quot;&gt;class&lt;/span&gt; &lt;span class=&quot;nc&quot;&gt;Foo&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;{&lt;/span&gt; &lt;span class=&quot;kd&quot;&gt;private&lt;/span&gt; &lt;span class=&quot;kd&quot;&gt;final&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;MethodLogger&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;logger&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;;&lt;/span&gt; &lt;span class=&quot;nd&quot;&gt;@Loggable&lt;/span&gt; &lt;span class=&quot;kd&quot;&gt;public&lt;/span&gt; &lt;span class=&quot;kt&quot;&gt;int&lt;/span&gt; &lt;span class=&quot;nf&quot;&gt;power&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;kt&quot;&gt;int&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;x&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;kt&quot;&gt;int&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;p&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;{&lt;/span&gt; &lt;span class=&quot;k&quot;&gt;return&lt;/span&gt; &lt;span class=&quot;k&quot;&gt;this&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;na&quot;&gt;logger&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;na&quot;&gt;around&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;point&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;);&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;}&lt;/span&gt; &lt;span class=&quot;kd&quot;&gt;private&lt;/span&gt; &lt;span class=&quot;kt&quot;&gt;int&lt;/span&gt; &lt;span class=&quot;nf&quot;&gt;power_aroundBody&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;kt&quot;&gt;int&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;x&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;kt&quot;&gt;int&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;p&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;{&lt;/span&gt; &lt;span class=&quot;k&quot;&gt;return&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;Math&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;na&quot;&gt;pow&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;x&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;p&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;);&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;}&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;}&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/figure&gt; &lt;p&gt;AspectJ weaver moves our original functionality to a new method, &lt;code&gt;power_aroundBody()&lt;/code&gt;, and redirects all &lt;code&gt;power()&lt;/code&gt; calls to the aspect class &lt;code&gt;MethodLogger&lt;/code&gt;.&lt;/p&gt; &lt;p&gt;Instead of one method &lt;code&gt;power()&lt;/code&gt; in class &lt;code&gt;Foo&lt;/code&gt; now we have four classes working together. From now on, this is what happens behind the scenes on every call to &lt;code&gt;power()&lt;/code&gt;:&lt;/p&gt; &lt;p&gt;&lt;img src=&quot;/uml/52d3d016f2264bbf660a23d5bbe84203.svg&quot; alt=&quot;PlantUML SVG diagram&quot; class=&quot;plantuml&quot; /&gt;&lt;/p&gt; &lt;p&gt;Original functionality of method &lt;code&gt;power()&lt;/code&gt; is indicated by the small green lifeline on the diagram.&lt;/p&gt; &lt;p&gt;As you see, the aspect weaving process connects together classes and aspects, transferring calls between them through join points. Without weaving, both classes and aspects are just compiled Java binaries with attached annotations.&lt;/p&gt; &lt;h1 id=&quot;jcabi-aspects&quot;&gt;jcabi-aspects&lt;/h1&gt; &lt;p&gt;&lt;a href=&quot;http://aspects.jcabi.com&quot;&gt;jcabi-aspects&lt;/a&gt; is a JAR library that contains &lt;code&gt;Loggable&lt;/code&gt; annotation and &lt;code&gt;MethodLogger&lt;/code&gt; aspect (btw, there are &lt;a href=&quot;http://aspects.jcabi.com&quot;&gt;many more&lt;/a&gt; aspects and annotations). You don’t need to write your own aspect for method logging. Just add a few dependencies to your classpath and configure &lt;a href=&quot;http://plugin.jcabi.com&quot;&gt;jcabi-maven-plugin&lt;/a&gt; for aspect weaving (get their latest versions in &lt;a href=&quot;http://search.maven.org/&quot;&gt;Maven Central&lt;/a&gt;):&lt;/p&gt; &lt;figure class=&quot;highlight&quot;&gt;&lt;pre&gt;&lt;code class=&quot;language-xml&quot; data-lang=&quot;xml&quot;&gt;&lt;span&gt;&lt;/span&gt;&lt;span class=&quot;nt&quot;&gt;&amp;lt;project&amp;gt;&lt;/span&gt; &lt;span class=&quot;nt&quot;&gt;&amp;lt;dependencies&amp;gt;&lt;/span&gt; &lt;span class=&quot;nt&quot;&gt;&amp;lt;dependency&amp;gt;&lt;/span&gt; &lt;span class=&quot;nt&quot;&gt;&amp;lt;groupId&amp;gt;&lt;/span&gt;com.jcabi&lt;span class=&quot;nt&quot;&gt;&amp;lt;/groupId&amp;gt;&lt;/span&gt; &lt;span class=&quot;nt&quot;&gt;&amp;lt;artifactId&amp;gt;&lt;/span&gt;jcabi-aspects&lt;span class=&quot;nt&quot;&gt;&amp;lt;/artifactId&amp;gt;&lt;/span&gt; &lt;span class=&quot;nt&quot;&gt;&amp;lt;/dependency&amp;gt;&lt;/span&gt; &lt;span class=&quot;nt&quot;&gt;&amp;lt;dependency&amp;gt;&lt;/span&gt; &lt;span class=&quot;nt&quot;&gt;&amp;lt;groupId&amp;gt;&lt;/span&gt;org.aspectj&lt;span class=&quot;nt&quot;&gt;&amp;lt;/groupId&amp;gt;&lt;/span&gt; &lt;span class=&quot;nt&quot;&gt;&amp;lt;artifactId&amp;gt;&lt;/span&gt;aspectjrt&lt;span class=&quot;nt&quot;&gt;&amp;lt;/artifactId&amp;gt;&lt;/span&gt; &lt;span class=&quot;nt&quot;&gt;&amp;lt;/dependency&amp;gt;&lt;/span&gt; &lt;span class=&quot;nt&quot;&gt;&amp;lt;/dependencies&amp;gt;&lt;/span&gt; &lt;span class=&quot;nt&quot;&gt;&amp;lt;build&amp;gt;&lt;/span&gt; &lt;span class=&quot;nt&quot;&gt;&amp;lt;plugins&amp;gt;&lt;/span&gt; &lt;span class=&quot;nt&quot;&gt;&amp;lt;plugin&amp;gt;&lt;/span&gt; &lt;span class=&quot;nt&quot;&gt;&amp;lt;groupId&amp;gt;&lt;/span&gt;com.jcabi&lt;span class=&quot;nt&quot;&gt;&amp;lt;/groupId&amp;gt;&lt;/span&gt; &lt;span class=&quot;nt&quot;&gt;&amp;lt;artifactId&amp;gt;&lt;/span&gt;jcabi-maven-plugin&lt;span class=&quot;nt&quot;&gt;&amp;lt;/artifactId&amp;gt;&lt;/span&gt; &lt;span class=&quot;nt&quot;&gt;&amp;lt;executions&amp;gt;&lt;/span&gt; &lt;span class=&quot;nt&quot;&gt;&amp;lt;execution&amp;gt;&lt;/span&gt; &lt;span class=&quot;nt&quot;&gt;&amp;lt;goals&amp;gt;&lt;/span&gt; &lt;span class=&quot;nt&quot;&gt;&amp;lt;goal&amp;gt;&lt;/span&gt;ajc&lt;span class=&quot;nt&quot;&gt;&amp;lt;/goal&amp;gt;&lt;/span&gt; &lt;span class=&quot;nt&quot;&gt;&amp;lt;/goals&amp;gt;&lt;/span&gt; &lt;span class=&quot;nt&quot;&gt;&amp;lt;/execution&amp;gt;&lt;/span&gt; &lt;span class=&quot;nt&quot;&gt;&amp;lt;/executions&amp;gt;&lt;/span&gt; &lt;span class=&quot;nt&quot;&gt;&amp;lt;/plugin&amp;gt;&lt;/span&gt; &lt;span class=&quot;nt&quot;&gt;&amp;lt;/plugins&amp;gt;&lt;/span&gt; &lt;span class=&quot;nt&quot;&gt;&amp;lt;/build&amp;gt;&lt;/span&gt; &lt;span class=&quot;nt&quot;&gt;&amp;lt;/project&amp;gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/figure&gt; &lt;p&gt;Since this weaving procedure takes a lot of configuration effort, I created a convenient Maven plugin with an &lt;code&gt;ajc&lt;/code&gt; goal, which does the entire aspect weaving job. You can use AspectJ directly, but I recommend that you use &lt;a href=&quot;http://plugin.jcabi.com&quot;&gt;jcabi-maven-plugin&lt;/a&gt;.&lt;/p&gt; &lt;p&gt;That’s it. Now you can use &lt;a href=&quot;http://aspects.jcabi.com/apidocs-0.15.1/com/jcabi/aspects/Loggable.html&quot;&gt;&lt;code&gt;@com.jcabi.aspects.Loggable&lt;/code&gt;&lt;/a&gt; annotation and your methods will be logged through slf4j.&lt;/p&gt; &lt;p&gt;If something doesn’t work as explained, don’t hesitate to submit a &lt;a href=&quot;https://github.com/jcabi/jcabi-aspects/issues&quot;&gt;GitHub issue&lt;/a&gt;.&lt;/p&gt; " /> <meta name="keywords" content="next, path, output, content, previous, url, relative_path, id, collection, excerpt, draft, categories, layout, title, date, tags, description, keywords, slug, ext" /> <meta name="viewport" content="width=device-width,minimum-scale=1,initial-scale=1"/> <meta name="google-site-verification" content="JEj_gQr2CPe2QKGw8XdMz0R7VboQIUbX3FlM-lwTq-8" /> <meta name="author" content="Yegor Bugayenko"> <meta name="article:published_time" content="2014-06-01 00:00:00 +0000"> <meta name="og:site_name" content="Yegor Bugayenko"/> <meta name="og:type" content="article" /> <meta name="og:locale" content="en_US" /> <meta name="twitter:account_id" content="4503599630178231" /> <meta name="twitter:creator" content="@yegor256"/> <meta name="twitter:site" content="@yegor256"/> <meta name="twitter:title" property="og:title" content="Java Method Logging with AOP and Annotations"/> <meta name="twitter:description" property="og:description" content="&lt;p&gt;Sometimes, I want to log (through &lt;a href=&quot;http://www.slf4j.org&quot;&gt;slf4j&lt;/a&gt; and &lt;a href=&quot;http://logging.apache.org/log4j/2.x/&quot;&gt;log4j&lt;/a&gt;) every execution of a method, seeing what arguments it receives, what it returns and how much time every execution takes. This is how I’m doing it, with help of &lt;a href=&quot;http://eclipse.org/aspectj/&quot;&gt;AspectJ&lt;/a&gt;, &lt;a href=&quot;http://aspects.jcabi.com&quot;&gt;jcabi-aspects&lt;/a&gt; and Java 6 &lt;a href=&quot;/2016/04/12/java-annotations-are-evil.html&quot;&gt;annotations&lt;/a&gt;:&lt;/p&gt; &lt;figure class=&quot;highlight&quot;&gt;&lt;pre&gt;&lt;code class=&quot;language-java&quot; data-lang=&quot;java&quot;&gt;&lt;span&gt;&lt;/span&gt;&lt;span class=&quot;kd&quot;&gt;public&lt;/span&gt; &lt;span class=&quot;kd&quot;&gt;class&lt;/span&gt; &lt;span class=&quot;nc&quot;&gt;Foo&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;{&lt;/span&gt; &lt;span class=&quot;nd&quot;&gt;@Loggable&lt;/span&gt; &lt;span class=&quot;kd&quot;&gt;public&lt;/span&gt; &lt;span class=&quot;kt&quot;&gt;int&lt;/span&gt; &lt;span class=&quot;nf&quot;&gt;power&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;kt&quot;&gt;int&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;x&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;kt&quot;&gt;int&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;p&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;{&lt;/span&gt; &lt;span class=&quot;k&quot;&gt;return&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;Math&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;na&quot;&gt;pow&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;x&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;p&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;);&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;}&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;}&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/figure&gt; &lt;p&gt;This is what I see in log4j output:&lt;/p&gt; &lt;figure class=&quot;highlight&quot;&gt;&lt;pre&gt;&lt;code class=&quot;language-text&quot; data-lang=&quot;text&quot;&gt;&lt;span&gt;&lt;/span&gt;[INFO] com.example.Foo #power(2, 10): 1024 in 12μs [INFO] com.example.Foo #power(3, 3): 27 in 4μs&lt;/code&gt;&lt;/pre&gt;&lt;/figure&gt; &lt;p&gt;Nice, isn’t it? Now, let’s see how it works.&lt;/p&gt; &lt;!--more--&gt; &lt;h2 id=&quot;annotation-with-runtime-retention&quot;&gt;Annotation with Runtime Retention&lt;/h2&gt; &lt;p&gt;&lt;a href=&quot;http://en.wikipedia.org/wiki/Java_annotation&quot;&gt;Annotations&lt;/a&gt; is a technique introduced in Java 6. It is a meta-programming instrument that doesn’t change the way code works, but gives marks to certain elements (methods, classes or variables). In other words, annotations are just markers attached to the code that can be seen and read. Some annotations are designed to be seen at compile time only—they don’t exist in &lt;code&gt;.class&lt;/code&gt; files after compilation. Others remain visible after compilation and can be accessed in runtime.&lt;/p&gt; &lt;aside class=&quot;youtube&quot;&gt; &lt;a href=&quot;https://www.youtube.com/watch?v=4SRoLYxvIQ8&quot;&gt;&lt;div class=&quot;box&quot;&gt; &lt;img src=&quot;https://i.ytimg.com/vi/4SRoLYxvIQ8/mqdefault.jpg&quot; alt=&quot;YouTube video #4SRoLYxvIQ8&quot; /&gt; &lt;div class=&quot;play&quot;&gt;&lt;i class=&quot;icon icon-play&quot;&gt;&lt;/i&gt;&lt;/div&gt; &lt;/div&gt;&lt;/a&gt; &lt;div&gt;Practical Example of AOP with AspectJ (in Russian with English subtitles); 28 October 2016.&lt;/div&gt;&lt;/aside&gt; &lt;p&gt;For example, &lt;a href=&quot;http://docs.oracle.com/javase/7/docs/api/java/lang/Override.html&quot;&gt;&lt;code&gt;@Override&lt;/code&gt;&lt;/a&gt; is of the first type (its retention type is &lt;a href=&quot;http://docs.oracle.com/javase/7/docs/api/java/lang/annotation/RetentionPolicy.html#SOURCE&quot;&gt;&lt;code&gt;SOURCE&lt;/code&gt;&lt;/a&gt;), while &lt;a href=&quot;http://junit.sourceforge.net/javadoc/org/junit/Test.html&quot;&gt;&lt;code&gt;@Test&lt;/code&gt;&lt;/a&gt; from JUnit is of the second type (retention type is &lt;a href=&quot;http://docs.oracle.com/javase/7/docs/api/java/lang/annotation/RetentionPolicy.html#RUNTIME&quot;&gt;&lt;code&gt;RUNTIME&lt;/code&gt;&lt;/a&gt;). &lt;a href=&quot;http://aspects.jcabi.com/apidocs-0.15.1/com/jcabi/aspects/Loggable.html&quot;&gt;&lt;code&gt;@Loggable&lt;/code&gt;&lt;/a&gt;—the one I’m using in the script above—is an annotation of the second type, from &lt;a href=&quot;http://aspects.jcabi.com&quot;&gt;jcabi-aspects&lt;/a&gt;. It stays with the byte-code in the &lt;code&gt;.class&lt;/code&gt; file after compilation.&lt;/p&gt; &lt;p&gt;Again, it is important to understand that even though method &lt;code&gt;power()&lt;/code&gt; is annotated and compiled, it doesn’t send anything to slf4j so far. It just contains a marker saying “please, log my execution.”&lt;/p&gt; &lt;h2 id=&quot;aspect-oriented-programming-aop&quot;&gt;Aspect Oriented Programming (AOP)&lt;/h2&gt; &lt;p&gt;&lt;a href=&quot;http://en.wikipedia.org/wiki/Aspect-oriented_programming&quot;&gt;AOP&lt;/a&gt; is a useful technique that enables adding executable blocks to the source code without explicitly changing it. In our example, we don’t want to log method execution inside the class. Instead, we want some other class to intercept every call to method &lt;code&gt;power()&lt;/code&gt;, measure its execution time and send this information to slf4j.&lt;/p&gt; &lt;p&gt;We want that interceptor to understand our &lt;code&gt;@Loggable&lt;/code&gt; annotation and log every call to that specific method &lt;code&gt;power()&lt;/code&gt;. And, of course, the same interceptor should be used for other methods where we’ll place the same annotation in the future.&lt;/p&gt; &lt;p&gt;This case perfectly fits the original intent of AOP—to avoid re-implementation of some common behavior in multiple classes.&lt;/p&gt; &lt;p&gt;Logging is a supplementary feature to our main functionality, and we don’t want to pollute our code with multiple logging instructions. Instead, we want &lt;a href=&quot;/2014/05/23/avoid-java-static-logger.html&quot;&gt;logging&lt;/a&gt; to happen behind the scenes.&lt;/p&gt; &lt;p&gt;In terms of AOP, our solution can be explained as creating an &lt;strong&gt;aspect&lt;/strong&gt; that &lt;strong&gt;cross-cuts&lt;/strong&gt; the code at certain &lt;strong&gt;join points&lt;/strong&gt; and applies an &lt;strong&gt;around advice&lt;/strong&gt; that implements the desired functionality.&lt;/p&gt; &lt;h2 id=&quot;aspectj&quot;&gt;AspectJ&lt;/h2&gt; &lt;p&gt;Let’s see what these magic words mean. But, first, let’s see how &lt;a href=&quot;http://aspects.jcabi.com&quot;&gt;jcabi-aspects&lt;/a&gt; implements them using &lt;a href=&quot;http://eclipse.org/aspectj/&quot;&gt;AspectJ&lt;/a&gt; (it’s a simplified example, full code you can find in &lt;a href=&quot;https://github.com/jcabi/jcabi-aspects/blob/jcabi-0.15.2/src/main/java/com/jcabi/aspects/aj/MethodLogger.java&quot;&gt;&lt;code&gt;MethodLogger.java&lt;/code&gt;&lt;/a&gt;):&lt;/p&gt; &lt;figure class=&quot;highlight&quot;&gt;&lt;pre&gt;&lt;code class=&quot;language-java&quot; data-lang=&quot;java&quot;&gt;&lt;span&gt;&lt;/span&gt;&lt;span class=&quot;nd&quot;&gt;@Aspect&lt;/span&gt; &lt;span class=&quot;kd&quot;&gt;public&lt;/span&gt; &lt;span class=&quot;kd&quot;&gt;class&lt;/span&gt; &lt;span class=&quot;nc&quot;&gt;MethodLogger&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;{&lt;/span&gt; &lt;span class=&quot;nd&quot;&gt;@Around&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;s&quot;&gt;&amp;quot;execution(* *(..)) &amp;amp;&amp;amp; @annotation(Loggable)&amp;quot;&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;kd&quot;&gt;public&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;Object&lt;/span&gt; &lt;span class=&quot;nf&quot;&gt;around&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;ProceedingJoinPoint&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;point&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;{&lt;/span&gt; &lt;span class=&quot;kt&quot;&gt;long&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;start&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;System&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;na&quot;&gt;currentTimeMillis&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;();&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;Object&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;result&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;point&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;na&quot;&gt;proceed&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;();&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;Logger&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;na&quot;&gt;info&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;(&lt;/span&gt; &lt;span class=&quot;s&quot;&gt;&amp;quot;#%s(%s): %s in %[msec]s&amp;quot;&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;MethodSignature&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;na&quot;&gt;class&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;na&quot;&gt;cast&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;point&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;na&quot;&gt;getSignature&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;()).&lt;/span&gt;&lt;span class=&quot;na&quot;&gt;getMethod&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;().&lt;/span&gt;&lt;span class=&quot;na&quot;&gt;getName&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;(),&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;point&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;na&quot;&gt;getArgs&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;(),&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;result&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;System&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;na&quot;&gt;currentTimeMillis&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;()&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;-&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;start&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;);&lt;/span&gt; &lt;span class=&quot;k&quot;&gt;return&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;result&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;;&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;}&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;}&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/figure&gt; &lt;p&gt;This is an &lt;strong&gt;aspect&lt;/strong&gt; with a single &lt;strong&gt;around advice&lt;/strong&gt; &lt;code&gt;around()&lt;/code&gt; inside. The aspect is annotated with &lt;code&gt;@Aspect&lt;/code&gt; and advice is annotated with &lt;code&gt;@Around&lt;/code&gt;. As discussed above, these annotations are just markers in &lt;code&gt;.class&lt;/code&gt; files. They don’t do anything except provide some meta-information to those who are interested in runtime.&lt;/p&gt; &lt;p&gt;Annotation &lt;code&gt;@Around&lt;/code&gt; has one parameter, which—in this case—says that the advice should be applied to a method if:&lt;/p&gt; &lt;ol&gt; &lt;li&gt; &lt;p&gt;its visibility modifier is &lt;code&gt;*&lt;/code&gt; (&lt;code&gt;public&lt;/code&gt;, &lt;code&gt;protected&lt;/code&gt; or &lt;code&gt;private&lt;/code&gt;);&lt;/p&gt; &lt;/li&gt; &lt;li&gt; &lt;p&gt;its name is name &lt;code&gt;*&lt;/code&gt; (any name);&lt;/p&gt; &lt;/li&gt; &lt;li&gt; &lt;p&gt;its arguments are &lt;code&gt;..&lt;/code&gt; (any arguments); and&lt;/p&gt; &lt;/li&gt; &lt;li&gt; &lt;p&gt;it is annotated with &lt;code&gt;@Loggable&lt;/code&gt;&lt;/p&gt; &lt;/li&gt; &lt;/ol&gt; &lt;p&gt;When a call to an annotated method is to be intercepted, method &lt;code&gt;around()&lt;/code&gt; executes before executing the actual method. When a call to method &lt;code&gt;power()&lt;/code&gt; is to be intercepted, method &lt;code&gt;around()&lt;/code&gt; receives an instance of class &lt;code&gt;ProceedingJoinPoint&lt;/code&gt; and must return an object, which will be used as a result of method &lt;code&gt;power()&lt;/code&gt;.&lt;/p&gt; &lt;p&gt;In order to call the original method, &lt;code&gt;power()&lt;/code&gt;, the advice has to call &lt;code&gt;proceed()&lt;/code&gt; of the &lt;strong&gt;join point&lt;/strong&gt; object.&lt;/p&gt; &lt;p&gt;We compile this aspect and make it available in classpath together with our main file &lt;code&gt;Foo.class&lt;/code&gt;. So far so good, but we need to take one last step in order to put our aspect into action—we should &lt;strong&gt;apply&lt;/strong&gt; our advice.&lt;/p&gt; &lt;h2 id=&quot;binary-aspect-weaving&quot;&gt;Binary Aspect Weaving&lt;/h2&gt; &lt;p&gt;Aspect weaving is the name of the advice applying process. Aspect weaver modifies original code by injecting calls to aspects. AspectJ does exactly that. We give it two binary Java classes &lt;code&gt;Foo.class&lt;/code&gt; and &lt;code&gt;MethodLogger.class&lt;/code&gt;; it gives back three—modified &lt;code&gt;Foo.class&lt;/code&gt;, &lt;code&gt;Foo$AjcClosure1.class&lt;/code&gt; and unmodified &lt;code&gt;MethodLogger.class&lt;/code&gt;.&lt;/p&gt; &lt;aside class=&quot;quote&quot;&gt;Without weaving, both classes and aspects are just compiled Java binaries with attached annotations&lt;/aside&gt; &lt;p&gt;In order to understand which advice should be applied to which methods, AspectJ weaver is using annotations from &lt;code&gt;.class&lt;/code&gt; files. Also, it uses &lt;a href=&quot;http://docs.oracle.com/javase/tutorial/reflect/&quot;&gt;reflection&lt;/a&gt; to browse all classes on classpath. It analyzes which methods satisfy the conditions from the &lt;code&gt;@Around&lt;/code&gt; annotation. Of course, it finds our method &lt;code&gt;power()&lt;/code&gt;.&lt;/p&gt; &lt;p&gt;So, there are two steps. First, we compile our &lt;code&gt;.java&lt;/code&gt; files using &lt;code&gt;javac&lt;/code&gt; and get two files. Then, AspectJ weaves/modifies them and creates its own extra class. Our &lt;code&gt;Foo&lt;/code&gt; class looks something like this after weaving:&lt;/p&gt; &lt;figure class=&quot;highlight&quot;&gt;&lt;pre&gt;&lt;code class=&quot;language-java&quot; data-lang=&quot;java&quot;&gt;&lt;span&gt;&lt;/span&gt;&lt;span class=&quot;kd&quot;&gt;public&lt;/span&gt; &lt;span class=&quot;kd&quot;&gt;class&lt;/span&gt; &lt;span class=&quot;nc&quot;&gt;Foo&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;{&lt;/span&gt; &lt;span class=&quot;kd&quot;&gt;private&lt;/span&gt; &lt;span class=&quot;kd&quot;&gt;final&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;MethodLogger&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;logger&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;;&lt;/span&gt; &lt;span class=&quot;nd&quot;&gt;@Loggable&lt;/span&gt; &lt;span class=&quot;kd&quot;&gt;public&lt;/span&gt; &lt;span class=&quot;kt&quot;&gt;int&lt;/span&gt; &lt;span class=&quot;nf&quot;&gt;power&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;kt&quot;&gt;int&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;x&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;kt&quot;&gt;int&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;p&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;{&lt;/span&gt; &lt;span class=&quot;k&quot;&gt;return&lt;/span&gt; &lt;span class=&quot;k&quot;&gt;this&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;na&quot;&gt;logger&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;na&quot;&gt;around&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;point&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;);&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;}&lt;/span&gt; &lt;span class=&quot;kd&quot;&gt;private&lt;/span&gt; &lt;span class=&quot;kt&quot;&gt;int&lt;/span&gt; &lt;span class=&quot;nf&quot;&gt;power_aroundBody&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;kt&quot;&gt;int&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;x&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;kt&quot;&gt;int&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;p&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;{&lt;/span&gt; &lt;span class=&quot;k&quot;&gt;return&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;Math&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;na&quot;&gt;pow&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;x&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;p&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;);&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;}&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;}&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/figure&gt; &lt;p&gt;AspectJ weaver moves our original functionality to a new method, &lt;code&gt;power_aroundBody()&lt;/code&gt;, and redirects all &lt;code&gt;power()&lt;/code&gt; calls to the aspect class &lt;code&gt;MethodLogger&lt;/code&gt;.&lt;/p&gt; &lt;p&gt;Instead of one method &lt;code&gt;power()&lt;/code&gt; in class &lt;code&gt;Foo&lt;/code&gt; now we have four classes working together. From now on, this is what happens behind the scenes on every call to &lt;code&gt;power()&lt;/code&gt;:&lt;/p&gt; &lt;p&gt;&lt;img src=&quot;/uml/52d3d016f2264bbf660a23d5bbe84203.svg&quot; alt=&quot;PlantUML SVG diagram&quot; class=&quot;plantuml&quot; /&gt;&lt;/p&gt; &lt;p&gt;Original functionality of method &lt;code&gt;power()&lt;/code&gt; is indicated by the small green lifeline on the diagram.&lt;/p&gt; &lt;p&gt;As you see, the aspect weaving process connects together classes and aspects, transferring calls between them through join points. Without weaving, both classes and aspects are just compiled Java binaries with attached annotations.&lt;/p&gt; &lt;h1 id=&quot;jcabi-aspects&quot;&gt;jcabi-aspects&lt;/h1&gt; &lt;p&gt;&lt;a href=&quot;http://aspects.jcabi.com&quot;&gt;jcabi-aspects&lt;/a&gt; is a JAR library that contains &lt;code&gt;Loggable&lt;/code&gt; annotation and &lt;code&gt;MethodLogger&lt;/code&gt; aspect (btw, there are &lt;a href=&quot;http://aspects.jcabi.com&quot;&gt;many more&lt;/a&gt; aspects and annotations). You don’t need to write your own aspect for method logging. Just add a few dependencies to your classpath and configure &lt;a href=&quot;http://plugin.jcabi.com&quot;&gt;jcabi-maven-plugin&lt;/a&gt; for aspect weaving (get their latest versions in &lt;a href=&quot;http://search.maven.org/&quot;&gt;Maven Central&lt;/a&gt;):&lt;/p&gt; &lt;figure class=&quot;highlight&quot;&gt;&lt;pre&gt;&lt;code class=&quot;language-xml&quot; data-lang=&quot;xml&quot;&gt;&lt;span&gt;&lt;/span&gt;&lt;span class=&quot;nt&quot;&gt;&amp;lt;project&amp;gt;&lt;/span&gt; &lt;span class=&quot;nt&quot;&gt;&amp;lt;dependencies&amp;gt;&lt;/span&gt; &lt;span class=&quot;nt&quot;&gt;&amp;lt;dependency&amp;gt;&lt;/span&gt; &lt;span class=&quot;nt&quot;&gt;&amp;lt;groupId&amp;gt;&lt;/span&gt;com.jcabi&lt;span class=&quot;nt&quot;&gt;&amp;lt;/groupId&amp;gt;&lt;/span&gt; &lt;span class=&quot;nt&quot;&gt;&amp;lt;artifactId&amp;gt;&lt;/span&gt;jcabi-aspects&lt;span class=&quot;nt&quot;&gt;&amp;lt;/artifactId&amp;gt;&lt;/span&gt; &lt;span class=&quot;nt&quot;&gt;&amp;lt;/dependency&amp;gt;&lt;/span&gt; &lt;span class=&quot;nt&quot;&gt;&amp;lt;dependency&amp;gt;&lt;/span&gt; &lt;span class=&quot;nt&quot;&gt;&amp;lt;groupId&amp;gt;&lt;/span&gt;org.aspectj&lt;span class=&quot;nt&quot;&gt;&amp;lt;/groupId&amp;gt;&lt;/span&gt; &lt;span class=&quot;nt&quot;&gt;&amp;lt;artifactId&amp;gt;&lt;/span&gt;aspectjrt&lt;span class=&quot;nt&quot;&gt;&amp;lt;/artifactId&amp;gt;&lt;/span&gt; &lt;span class=&quot;nt&quot;&gt;&amp;lt;/dependency&amp;gt;&lt;/span&gt; &lt;span class=&quot;nt&quot;&gt;&amp;lt;/dependencies&amp;gt;&lt;/span&gt; &lt;span class=&quot;nt&quot;&gt;&amp;lt;build&amp;gt;&lt;/span&gt; &lt;span class=&quot;nt&quot;&gt;&amp;lt;plugins&amp;gt;&lt;/span&gt; &lt;span class=&quot;nt&quot;&gt;&amp;lt;plugin&amp;gt;&lt;/span&gt; &lt;span class=&quot;nt&quot;&gt;&amp;lt;groupId&amp;gt;&lt;/span&gt;com.jcabi&lt;span class=&quot;nt&quot;&gt;&amp;lt;/groupId&amp;gt;&lt;/span&gt; &lt;span class=&quot;nt&quot;&gt;&amp;lt;artifactId&amp;gt;&lt;/span&gt;jcabi-maven-plugin&lt;span class=&quot;nt&quot;&gt;&amp;lt;/artifactId&amp;gt;&lt;/span&gt; &lt;span class=&quot;nt&quot;&gt;&amp;lt;executions&amp;gt;&lt;/span&gt; &lt;span class=&quot;nt&quot;&gt;&amp;lt;execution&amp;gt;&lt;/span&gt; &lt;span class=&quot;nt&quot;&gt;&amp;lt;goals&amp;gt;&lt;/span&gt; &lt;span class=&quot;nt&quot;&gt;&amp;lt;goal&amp;gt;&lt;/span&gt;ajc&lt;span class=&quot;nt&quot;&gt;&amp;lt;/goal&amp;gt;&lt;/span&gt; &lt;span class=&quot;nt&quot;&gt;&amp;lt;/goals&amp;gt;&lt;/span&gt; &lt;span class=&quot;nt&quot;&gt;&amp;lt;/execution&amp;gt;&lt;/span&gt; &lt;span class=&quot;nt&quot;&gt;&amp;lt;/executions&amp;gt;&lt;/span&gt; &lt;span class=&quot;nt&quot;&gt;&amp;lt;/plugin&amp;gt;&lt;/span&gt; &lt;span class=&quot;nt&quot;&gt;&amp;lt;/plugins&amp;gt;&lt;/span&gt; &lt;span class=&quot;nt&quot;&gt;&amp;lt;/build&amp;gt;&lt;/span&gt; &lt;span class=&quot;nt&quot;&gt;&amp;lt;/project&amp;gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/figure&gt; &lt;p&gt;Since this weaving procedure takes a lot of configuration effort, I created a convenient Maven plugin with an &lt;code&gt;ajc&lt;/code&gt; goal, which does the entire aspect weaving job. You can use AspectJ directly, but I recommend that you use &lt;a href=&quot;http://plugin.jcabi.com&quot;&gt;jcabi-maven-plugin&lt;/a&gt;.&lt;/p&gt; &lt;p&gt;That’s it. Now you can use &lt;a href=&quot;http://aspects.jcabi.com/apidocs-0.15.1/com/jcabi/aspects/Loggable.html&quot;&gt;&lt;code&gt;@com.jcabi.aspects.Loggable&lt;/code&gt;&lt;/a&gt; annotation and your methods will be logged through slf4j.&lt;/p&gt; &lt;p&gt;If something doesn’t work as explained, don’t hesitate to submit a &lt;a href=&quot;https://github.com/jcabi/jcabi-aspects/issues&quot;&gt;GitHub issue&lt;/a&gt;.&lt;/p&gt; "/> <meta name="twitter:url" property="og:url" content="https://www.yegor256.com/2014/06/01/aop-aspectj-java-method-logging.html"/> <meta name="telegram:channel" content="AAAAAEJFMRzsRTRxM3ec6A"/> <link rel="search" type="application/opensearchdescription+xml" href="/opensearch.xml" title="yegor256" /> <link rel="shortcut icon" href="/favicon.ico?7d5b276b9b5"/> <link rel="apple-touch-icon" href="/favicon.ico?7d5b276b9b5"/> <link rel="alternate" type="application/rss+xml" title="RSS for yegor256.com" href="https://www.yegor256.com/rss.xml"/> <link rel="stylesheet" href="/css/layout.css?7d5b276b9b5"/> <link rel="stylesheet" href="/css/icons.css?7d5b276b9b5"/> <link rel="canonical" href="https://www.yegor256.com/2014/06/01/aop-aspectj-java-method-logging.html" /> <link rel="amphtml" href="https://www.yegor256.com/2014/06/01/aop-aspectj-java-method-logging.amp.html" /> <title>Java Method Logging with AOP and Annotations </title> </head> <body><div class="wrapper"> <aside class="header-toggle unprintable" id="header-toggle" title="Show the menu" onclick="$('#header').show();$('#header-toggle').hide();">&#9776;</aside> <header class="header" id="header"><div class="face"> <a href="/about-me.html#form" class="sub" title="Click to subscribe to my monthly newsletter"><span>Subscribe</span></a> <a href="/about-me.html" style="position:relative;"> <img src="/images/face-256x256.jpg" class="photo" alt="Yegor Bugayenko"/> </a></div><nav><ul class="menu social notranslate"> <li><a href="https://twitter.com/intent/follow?screen_name=yegor256" rel="nofollow" title="Follow me on Twitter"><i class="icon icon-twitter notranslate" aria-hidden="true"></i></a></li> <li><a href="/rss.xml" rel="nofollow" title="Subscribe to my RSS feed"><i class="icon icon-rss notranslate" aria-hidden="true"></i></a></li> <li><a itemprop="sameAs" href="https://github.com/yegor256" rel="nofollow" title="My GitHub profile"><i class="icon icon-github notranslate" aria-hidden="true"></i></a></li> <li><a itemprop="sameAs" href="http://stackoverflow.com/users/187141/yegor256" rel="nofollow" title="My StackOverflow profile"><i class="icon icon-stackoverflow notranslate" aria-hidden="true"></i></a></li> <li><a itemprop="sameAs" href="https://www.facebook.com/yegor256" rel="nofollow" title="Follow me on Facebook"><i class="icon icon-facebook notranslate" aria-hidden="true"></i></a></li> <li><a itemprop="sameAs" href="https://instagram.com/yegor256" rel="nofollow" title="Follow me on Instagram"><i class="icon icon-instagram notranslate" aria-hidden="true"></i></a></li> <li><a itemprop="sameAs" href="https://www.linkedin.com/in/yegor256" rel="nofollow" title="My LinkedIn profile"><i class="icon icon-linkedin notranslate" aria-hidden="true"></i></a></li> <li><a itemprop="sameAs" href="https://www.youtube.com/c/yegor256?sub_confirmation=1" rel="nofollow" title="My Youtube video channel"><i class="icon icon-youtube notranslate" aria-hidden="true"></i></a></li> <li><a itemprop="sameAs" href="https://www.pinterest.com/yegor256/" rel="nofollow" title="My Pinterest boards"><i class="icon icon-pinterest notranslate" aria-hidden="true"></i></a></li> <li><a itemprop="sameAs" href="https://angel.co/yegor256" rel="nofollow" title="My AngelList profile"><i class="icon icon-angellist notranslate" aria-hidden="true"></i></a></li> <li><a href="https://soundcloud.com/yegor256" rel="nofollow" title="My podcast"><i class="icon icon-podcast notranslate" aria-hidden="true"></i></a></li> <li><a href="https://itunes.apple.com/us/podcast/yegor256-podcast/id1150826721" rel="nofollow" title="My iTunes podcast"><i class="icon icon-itunes notranslate" aria-hidden="true"></i></a></li> <li><a href="https://t.me/yegor256news" rel="nofollow" title="My Telegram public channel"><i class="icon icon-telegram notranslate" aria-hidden="true"></i></a></li> <li><a href="mailto:blog@yegor256.com" rel="nofollow" title="Email me any time"><i class="icon icon-mail notranslate" aria-hidden="true"></i></a></li></ul><ul class="menu"> <li><a href="/" title="Home page">Home</a></li> <li /2014/06/01/aop-aspectj-java-method-logging.html><a href="/best.html" title="Best articles to read">12&#160;Best</a></li> <li /2014/06/01/aop-aspectj-java-method-logging.html><a href="/contents.html" title="The contents of the entire blog">All&#160;292</a></li> <li /2014/06/01/aop-aspectj-java-method-logging.html><a href="/webinars.html" title="My webinars">Webinars</a></li> <li /2014/06/01/aop-aspectj-java-method-logging.html><a href="/talks.html" title="Future and past conference talks">Talks</a></li> <li /2014/06/01/aop-aspectj-java-method-logging.html><a href="/books.html" title="The books I wrote">Books</a></li> <li /2014/06/01/aop-aspectj-java-method-logging.html><a href="/papers.html" title="My academic papers and patents">Papers</a></li> <li /2014/06/01/aop-aspectj-java-method-logging.html><a href="/pets.html" title="My loved pet projects">Pets</a></li> <li /2014/06/01/aop-aspectj-java-method-logging.html class="highlighted"><a href="/trainings.html" title="On-site trainings">Trainings</a></li> <li /2014/06/01/aop-aspectj-java-method-logging.html><a href="/award.html" title="Software quality award">Award</a></li> <li /2014/06/01/aop-aspectj-java-method-logging.html><a href="/testimonials.html" title="What some people say about me">Testimonials</a></li> <li /2014/06/01/aop-aspectj-java-method-logging.html><a href="/shift-m.html" title="Audio podcast about project management">Shift-M</a></li> <li /2014/06/01/aop-aspectj-java-method-logging.html><a href="/paintings.html" title="My paintings for sale">Paintings</a></li> <li><a href="https://ru.yegor256.com/" title="Немного на русском языке">По-русски</a></li></ul></nav><div class="search"> <form method="get" action="https://www.google.com/search" itemprop="potentialAction" itemscope="" itemtype="http://schema.org/SearchAction"> <meta itemprop="target" content="https://www.google.com/search?q={q}"/> <input name="sitesearch" value="yegor256.com" type="hidden"/> <input itemprop="query-input" type="text" id="search-query" class="field field-text" required="required" onfocus="$('.google').css('visibility', 'visible');" name="q" placeholder="Search..." autocomplete="off"/> <input type="image" src="/images/google-search-icon.svg" class="google" title="Search via Google" alt="Search via Google"/> </form></div><div class="hot"><ul></ul></div></header></div><section itemscope="" itemtype="http://schema.org/BlogPosting"><div class="wrapper"> <header><p class="printable"> <img src="https://api.qrserver.com/v1/create-qr-code/?data=https://www.yegor256.com/2014/06/01/aop-aspectj-java-method-logging.html&amp;format=svg" style="width:125px;height:125px;" alt="QR code"/></p><p class="printable"> <code itemprop="url">https://www.yegor256.com/2014/06/01/aop-aspectj-java-method-logging.html</code></p><h1 itemprop="name headline mainEntityOfPage">Java Method Logging with AOP and Annotations</h1><ul class="subline"> <li> <time itemprop="datePublished" datetime="2014-06-01T00:00:00+00:00"> 1 June 2014 </time> </li> <li class="printable" itemscope="" itemprop="author" itemtype="http://schema.org/Person"> <span itemprop="name">Yegor Bugayenko</span> </li> <li class="unprintable"> <i class="icon icon-comments"></i> <a href="https://www.yegor256.com/2014/06/01/aop-aspectj-java-method-logging.html#disqus_thread" itemprop="discussionUrl">comments</a> </li></ul><p class="unprintable"><p>Sometimes, I want to log (through <a href="http://www.slf4j.org">slf4j</a> and <a href="http://logging.apache.org/log4j/2.x/">log4j</a>) every execution of a method, seeing what arguments it receives, what it returns and how much time every execution takes. This is how I’m doing it, with help of <a href="http://eclipse.org/aspectj/">AspectJ</a>, <a href="http://aspects.jcabi.com">jcabi-aspects</a> and Java 6 <a href="/2016/04/12/java-annotations-are-evil.html">annotations</a>:</p><figure class="highlight"><pre><code class="language-java" data-lang="java"><span></span><span class="kd">public</span> <span class="kd">class</span> <span class="nc">Foo</span> <span class="o">{</span>
  <span class="nd">@Loggable</span>
  <span class="kd">public</span> <span class="kt">int</span> <span class="nf">power</span><span class="o">(</span><span class="kt">int</span> <span class="n">x</span><span class="o">,</span> <span class="kt">int</span> <span class="n">p</span><span class="o">)</span> <span class="o">{</span>
    <span class="k">return</span> <span class="n">Math</span><span class="o">.</span><span class="na">pow</span><span class="o">(</span><span class="n">x</span><span class="o">,</span> <span class="n">p</span><span class="o">);</span>
  <span class="o">}</span>
<span class="o">}</span></code></pre></figure><p>This is what I see in log4j output:</p><figure class="highlight"><pre><code class="language-text" data-lang="text"><span></span>[INFO] com.example.Foo #power(2, 10): 1024 in 12μs
[INFO] com.example.Foo #power(3, 3): 27 in 4μs</code></pre></figure><p>Nice, isn’t it? Now, let’s see how it works.</p><h2 id="annotation-with-runtime-retention">Annotation with Runtime Retention</h2><p><a href="http://en.wikipedia.org/wiki/Java_annotation">Annotations</a> is a technique introduced in Java 6. It is a meta-programming instrument that doesn’t change the way code works, but gives marks to certain elements (methods, classes or variables). In other words, annotations are just markers attached to the code that can be seen and read. Some annotations are designed to be seen at compile time only—they don’t exist in <code>.class</code> files after compilation. Others remain visible after compilation and can be accessed in runtime.</p><aside class="youtube"> <a href="https://www.youtube.com/watch?v=4SRoLYxvIQ8"><div class="box"> <img src="https://i.ytimg.com/vi/4SRoLYxvIQ8/mqdefault.jpg" alt="YouTube video #4SRoLYxvIQ8" /><div class="play"><i class="icon icon-play"></i></div></div></a><div>Practical Example of AOP with AspectJ (in Russian with English subtitles); 28 October 2016.</div></aside><p>For example, <a href="http://docs.oracle.com/javase/7/docs/api/java/lang/Override.html"><code>@Override</code></a> is of the first type (its retention type is <a href="http://docs.oracle.com/javase/7/docs/api/java/lang/annotation/RetentionPolicy.html#SOURCE"><code>SOURCE</code></a>), while <a href="http://junit.sourceforge.net/javadoc/org/junit/Test.html"><code>@Test</code></a> from JUnit is of the second type (retention type is <a href="http://docs.oracle.com/javase/7/docs/api/java/lang/annotation/RetentionPolicy.html#RUNTIME"><code>RUNTIME</code></a>). <a href="http://aspects.jcabi.com/apidocs-0.15.1/com/jcabi/aspects/Loggable.html"><code>@Loggable</code></a>—the one I’m using in the script above—is an annotation of the second type, from <a href="http://aspects.jcabi.com">jcabi-aspects</a>. It stays with the byte-code in the <code>.class</code> file after compilation.</p><p>Again, it is important to understand that even though method <code>power()</code> is annotated and compiled, it doesn’t send anything to slf4j so far. It just contains a marker saying “please, log my execution.”</p><h2 id="aspect-oriented-programming-aop">Aspect Oriented Programming (AOP)</h2><p><a href="http://en.wikipedia.org/wiki/Aspect-oriented_programming">AOP</a> is a useful technique that enables adding executable blocks to the source code without explicitly changing it. In our example, we don’t want to log method execution inside the class. Instead, we want some other class to intercept every call to method <code>power()</code>, measure its execution time and send this information to slf4j.</p><p>We want that interceptor to understand our <code>@Loggable</code> annotation and log every call to that specific method <code>power()</code>. And, of course, the same interceptor should be used for other methods where we’ll place the same annotation in the future.</p><p>This case perfectly fits the original intent of AOP—to avoid re-implementation of some common behavior in multiple classes.</p><p>Logging is a supplementary feature to our main functionality, and we don’t want to pollute our code with multiple logging instructions. Instead, we want <a href="/2014/05/23/avoid-java-static-logger.html">logging</a> to happen behind the scenes.</p><p>In terms of AOP, our solution can be explained as creating an <strong>aspect</strong> that <strong>cross-cuts</strong> the code at certain <strong>join points</strong> and applies an <strong>around advice</strong> that implements the desired functionality.</p><h2 id="aspectj">AspectJ</h2><p>Let’s see what these magic words mean. But, first, let’s see how <a href="http://aspects.jcabi.com">jcabi-aspects</a> implements them using <a href="http://eclipse.org/aspectj/">AspectJ</a> (it’s a simplified example, full code you can find in <a href="https://github.com/jcabi/jcabi-aspects/blob/jcabi-0.15.2/src/main/java/com/jcabi/aspects/aj/MethodLogger.java"><code>MethodLogger.java</code></a>):</p><figure class="highlight"><pre><code class="language-java" data-lang="java"><span></span><span class="nd">@Aspect</span>
<span class="kd">public</span> <span class="kd">class</span> <span class="nc">MethodLogger</span> <span class="o">{</span>
  <span class="nd">@Around</span><span class="o">(</span><span class="s">&quot;execution(* *(..)) &amp;&amp; @annotation(Loggable)&quot;</span><span class="o">)</span>
  <span class="kd">public</span> <span class="n">Object</span> <span class="nf">around</span><span class="o">(</span><span class="n">ProceedingJoinPoint</span> <span class="n">point</span><span class="o">)</span> <span class="o">{</span>
    <span class="kt">long</span> <span class="n">start</span> <span class="o">=</span> <span class="n">System</span><span class="o">.</span><span class="na">currentTimeMillis</span><span class="o">();</span>
    <span class="n">Object</span> <span class="n">result</span> <span class="o">=</span> <span class="n">point</span><span class="o">.</span><span class="na">proceed</span><span class="o">();</span>
    <span class="n">Logger</span><span class="o">.</span><span class="na">info</span><span class="o">(</span>
      <span class="s">&quot;#%s(%s): %s in %[msec]s&quot;</span><span class="o">,</span>
      <span class="n">MethodSignature</span><span class="o">.</span><span class="na">class</span><span class="o">.</span><span class="na">cast</span><span class="o">(</span><span class="n">point</span><span class="o">.</span><span class="na">getSignature</span><span class="o">()).</span><span class="na">getMethod</span><span class="o">().</span><span class="na">getName</span><span class="o">(),</span>
      <span class="n">point</span><span class="o">.</span><span class="na">getArgs</span><span class="o">(),</span>
      <span class="n">result</span><span class="o">,</span>
      <span class="n">System</span><span class="o">.</span><span class="na">currentTimeMillis</span><span class="o">()</span> <span class="o">-</span> <span class="n">start</span>
    <span class="o">);</span>
    <span class="k">return</span> <span class="n">result</span><span class="o">;</span>
  <span class="o">}</span>
<span class="o">}</span></code></pre></figure><p>This is an <strong>aspect</strong> with a single <strong>around advice</strong> <code>around()</code> inside. The aspect is annotated with <code>@Aspect</code> and advice is annotated with <code>@Around</code>. As discussed above, these annotations are just markers in <code>.class</code> files. They don’t do anything except provide some meta-information to those who are interested in runtime.</p><p>Annotation <code>@Around</code> has one parameter, which—in this case—says that the advice should be applied to a method if:</p><ol> <li><p>its visibility modifier is <code>*</code> (<code>public</code>, <code>protected</code> or <code>private</code>);</p></li> <li><p>its name is name <code>*</code> (any name);</p></li> <li><p>its arguments are <code>..</code> (any arguments); and</p></li> <li><p>it is annotated with <code>@Loggable</code></p></li> </ol><p>When a call to an annotated method is to be intercepted, method <code>around()</code> executes before executing the actual method. When a call to method <code>power()</code> is to be intercepted, method <code>around()</code> receives an instance of class <code>ProceedingJoinPoint</code> and must return an object, which will be used as a result of method <code>power()</code>.</p><p>In order to call the original method, <code>power()</code>, the advice has to call <code>proceed()</code> of the <strong>join point</strong> object.</p><p>We compile this aspect and make it available in classpath together with our main file <code>Foo.class</code>. So far so good, but we need to take one last step in order to put our aspect into action—we should <strong>apply</strong> our advice.</p><h2 id="binary-aspect-weaving">Binary Aspect Weaving</h2><p>Aspect weaving is the name of the advice applying process. Aspect weaver modifies original code by injecting calls to aspects. AspectJ does exactly that. We give it two binary Java classes <code>Foo.class</code> and <code>MethodLogger.class</code>; it gives back three—modified <code>Foo.class</code>, <code>Foo$AjcClosure1.class</code> and unmodified <code>MethodLogger.class</code>.</p><aside class="quote">Without weaving, both classes and aspects are just compiled Java binaries with attached annotations</aside><p>In order to understand which advice should be applied to which methods, AspectJ weaver is using annotations from <code>.class</code> files. Also, it uses <a href="http://docs.oracle.com/javase/tutorial/reflect/">reflection</a> to browse all classes on classpath. It analyzes which methods satisfy the conditions from the <code>@Around</code> annotation. Of course, it finds our method <code>power()</code>.</p><p>So, there are two steps. First, we compile our <code>.java</code> files using <code>javac</code> and get two files. Then, AspectJ weaves/modifies them and creates its own extra class. Our <code>Foo</code> class looks something like this after weaving:</p><figure class="highlight"><pre><code class="language-java" data-lang="java"><span></span><span class="kd">public</span> <span class="kd">class</span> <span class="nc">Foo</span> <span class="o">{</span>
  <span class="kd">private</span> <span class="kd">final</span> <span class="n">MethodLogger</span> <span class="n">logger</span><span class="o">;</span>
  <span class="nd">@Loggable</span>
  <span class="kd">public</span> <span class="kt">int</span> <span class="nf">power</span><span class="o">(</span><span class="kt">int</span> <span class="n">x</span><span class="o">,</span> <span class="kt">int</span> <span class="n">p</span><span class="o">)</span> <span class="o">{</span>
    <span class="k">return</span> <span class="k">this</span><span class="o">.</span><span class="na">logger</span><span class="o">.</span><span class="na">around</span><span class="o">(</span><span class="n">point</span><span class="o">);</span>
  <span class="o">}</span>
  <span class="kd">private</span> <span class="kt">int</span> <span class="nf">power_aroundBody</span><span class="o">(</span><span class="kt">int</span> <span class="n">x</span><span class="o">,</span> <span class="kt">int</span> <span class="n">p</span><span class="o">)</span> <span class="o">{</span>
    <span class="k">return</span> <span class="n">Math</span><span class="o">.</span><span class="na">pow</span><span class="o">(</span><span class="n">x</span><span class="o">,</span> <span class="n">p</span><span class="o">);</span>
  <span class="o">}</span>
<span class="o">}</span></code></pre></figure><p>AspectJ weaver moves our original functionality to a new method, <code>power_aroundBody()</code>, and redirects all <code>power()</code> calls to the aspect class <code>MethodLogger</code>.</p><p>Instead of one method <code>power()</code> in class <code>Foo</code> now we have four classes working together. From now on, this is what happens behind the scenes on every call to <code>power()</code>:</p><p><img src="/uml/52d3d016f2264bbf660a23d5bbe84203.svg" alt="PlantUML SVG diagram" class="plantuml" /></p><p>Original functionality of method <code>power()</code> is indicated by the small green lifeline on the diagram.</p><p>As you see, the aspect weaving process connects together classes and aspects, transferring calls between them through join points. Without weaving, both classes and aspects are just compiled Java binaries with attached annotations.</p><h1 id="jcabi-aspects">jcabi-aspects</h1><p><a href="http://aspects.jcabi.com">jcabi-aspects</a> is a JAR library that contains <code>Loggable</code> annotation and <code>MethodLogger</code> aspect (btw, there are <a href="http://aspects.jcabi.com">many more</a> aspects and annotations). You don’t need to write your own aspect for method logging. Just add a few dependencies to your classpath and configure <a href="http://plugin.jcabi.com">jcabi-maven-plugin</a> for aspect weaving (get their latest versions in <a href="http://search.maven.org/">Maven Central</a>):</p><figure class="highlight"><pre><code class="language-xml" data-lang="xml"><span></span><span class="nt">&lt;project&gt;</span>
  <span class="nt">&lt;dependencies&gt;</span>
    <span class="nt">&lt;dependency&gt;</span>
      <span class="nt">&lt;groupId&gt;</span>com.jcabi<span class="nt">&lt;/groupId&gt;</span>
      <span class="nt">&lt;artifactId&gt;</span>jcabi-aspects<span class="nt">&lt;/artifactId&gt;</span>
    <span class="nt">&lt;/dependency&gt;</span>
    <span class="nt">&lt;dependency&gt;</span>
      <span class="nt">&lt;groupId&gt;</span>org.aspectj<span class="nt">&lt;/groupId&gt;</span>
      <span class="nt">&lt;artifactId&gt;</span>aspectjrt<span class="nt">&lt;/artifactId&gt;</span>
    <span class="nt">&lt;/dependency&gt;</span>
  <span class="nt">&lt;/dependencies&gt;</span>
  <span class="nt">&lt;build&gt;</span>
    <span class="nt">&lt;plugins&gt;</span>
      <span class="nt">&lt;plugin&gt;</span>
        <span class="nt">&lt;groupId&gt;</span>com.jcabi<span class="nt">&lt;/groupId&gt;</span>
        <span class="nt">&lt;artifactId&gt;</span>jcabi-maven-plugin<span class="nt">&lt;/artifactId&gt;</span>
        <span class="nt">&lt;executions&gt;</span>
          <span class="nt">&lt;execution&gt;</span>
            <span class="nt">&lt;goals&gt;</span>
              <span class="nt">&lt;goal&gt;</span>ajc<span class="nt">&lt;/goal&gt;</span>
            <span class="nt">&lt;/goals&gt;</span>
          <span class="nt">&lt;/execution&gt;</span>
        <span class="nt">&lt;/executions&gt;</span>
      <span class="nt">&lt;/plugin&gt;</span>
    <span class="nt">&lt;/plugins&gt;</span>
  <span class="nt">&lt;/build&gt;</span>
<span class="nt">&lt;/project&gt;</span></code></pre></figure><p>Since this weaving procedure takes a lot of configuration effort, I created a convenient Maven plugin with an <code>ajc</code> goal, which does the entire aspect weaving job. You can use AspectJ directly, but I recommend that you use <a href="http://plugin.jcabi.com">jcabi-maven-plugin</a>.</p><p>That’s it. Now you can use <a href="http://aspects.jcabi.com/apidocs-0.15.1/com/jcabi/aspects/Loggable.html"><code>@com.jcabi.aspects.Loggable</code></a> annotation and your methods will be logged through slf4j.</p><p>If something doesn’t work as explained, don’t hesitate to submit a <a href="https://github.com/jcabi/jcabi-aspects/issues">GitHub issue</a>.</p></p><nav class="buttons notranslate desktop-only"> <a href="http://www.facebook.com/sharer/sharer.php?u=https://www.yegor256.com/2014/06/01/aop-aspectj-java-method-logging.html" title="Share on Facebook" class="button" rel="nofollow"> <span class="count count-facebook">0</span> <i class="icon icon-facebook notranslate" aria-hidden="true"></i> </a> <a href="https://twitter.com/share?url=https://www.yegor256.com/2014/06/01/aop-aspectj-java-method-logging.html&amp;text=Java+Method+Logging+with+AOP+and+Annotations" title="Share on Twitter" class="button" rel="nofollow"> <span class="count count-twitter">0</span> <i class="icon icon-twitter notranslate" aria-hidden="true"></i> </a> <a href="https://plus.google.com/share?url=https://www.yegor256.com/2014/06/01/aop-aspectj-java-method-logging.html" title="Share on Google+" class="button" rel="nofollow"> <span class="count count-googleplus">0</span> <i class="icon icon-googleplus notranslate" aria-hidden="true"></i> </a> <a href="https://www.linkedin.com/cws/share?url=https://www.yegor256.com/2014/06/01/aop-aspectj-java-method-logging.html" title="Share on LinkedIn" class="button" rel="nofollow"> <span class="count count-linkedin">0</span> <i class="icon icon-linkedin notranslate" aria-hidden="true"></i> </a> <a href="http://reddit.com/submit?url=https://www.yegor256.com/2014/06/01/aop-aspectj-java-method-logging.html%3F2014-22&amp;title=Java+Method+Logging+with+AOP+and+Annotations" title="Share on Reddit" class="button" rel="nofollow"> <span class="count count-reddit">0</span> <i class="icon icon-reddit notranslate" aria-hidden="true"></i> </a> <a href="http://news.ycombinator.com/submitlink?u=https://www.yegor256.com/2014/06/01/aop-aspectj-java-method-logging.html%3F2014-22&amp;t=Java+Method+Logging+with+AOP+and+Annotations" title="Share on Hacker News" class="button" rel="nofollow"> <span class="count count-hackernews">0</span> <i class="icon icon-hackernews notranslate" aria-hidden="true"></i> </a> </nav> </header> <article class="main" itemprop="articleBody"><div ><p>Sometimes, I want to log (through <a href="http://www.slf4j.org">slf4j</a> and <a href="http://logging.apache.org/log4j/2.x/">log4j</a>) every execution of a method, seeing what arguments it receives, what it returns and how much time every execution takes. This is how I’m doing it, with help of <a href="http://eclipse.org/aspectj/">AspectJ</a>, <a href="http://aspects.jcabi.com">jcabi-aspects</a> and Java 6 <a href="/2016/04/12/java-annotations-are-evil.html">annotations</a>:</p><figure class="highlight"><pre><code class="language-java" data-lang="java"><span></span><span class="kd">public</span> <span class="kd">class</span> <span class="nc">Foo</span> <span class="o">{</span>
  <span class="nd">@Loggable</span>
  <span class="kd">public</span> <span class="kt">int</span> <span class="nf">power</span><span class="o">(</span><span class="kt">int</span> <span class="n">x</span><span class="o">,</span> <span class="kt">int</span> <span class="n">p</span><span class="o">)</span> <span class="o">{</span>
    <span class="k">return</span> <span class="n">Math</span><span class="o">.</span><span class="na">pow</span><span class="o">(</span><span class="n">x</span><span class="o">,</span> <span class="n">p</span><span class="o">);</span>
  <span class="o">}</span>
<span class="o">}</span></code></pre></figure><p>This is what I see in log4j output:</p><figure class="highlight"><pre><code class="language-text" data-lang="text"><span></span>[INFO] com.example.Foo #power(2, 10): 1024 in 12μs
[INFO] com.example.Foo #power(3, 3): 27 in 4μs</code></pre></figure><p>Nice, isn’t it? Now, let’s see how it works.</p><h2 id="annotation-with-runtime-retention">Annotation with Runtime Retention</h2><p><a href="http://en.wikipedia.org/wiki/Java_annotation">Annotations</a> is a technique introduced in Java 6. It is a meta-programming instrument that doesn’t change the way code works, but gives marks to certain elements (methods, classes or variables). In other words, annotations are just markers attached to the code that can be seen and read. Some annotations are designed to be seen at compile time only—they don’t exist in <code>.class</code> files after compilation. Others remain visible after compilation and can be accessed in runtime.</p><aside class="youtube"> <a href="https://www.youtube.com/watch?v=4SRoLYxvIQ8"><div class="box"> <img src="https://i.ytimg.com/vi/4SRoLYxvIQ8/mqdefault.jpg" alt="YouTube video #4SRoLYxvIQ8" /><div class="play"><i class="icon icon-play"></i></div></div></a><div>Practical Example of AOP with AspectJ (in Russian with English subtitles); 28 October 2016.</div></aside><p>For example, <a href="http://docs.oracle.com/javase/7/docs/api/java/lang/Override.html"><code>@Override</code></a> is of the first type (its retention type is <a href="http://docs.oracle.com/javase/7/docs/api/java/lang/annotation/RetentionPolicy.html#SOURCE"><code>SOURCE</code></a>), while <a href="http://junit.sourceforge.net/javadoc/org/junit/Test.html"><code>@Test</code></a> from JUnit is of the second type (retention type is <a href="http://docs.oracle.com/javase/7/docs/api/java/lang/annotation/RetentionPolicy.html#RUNTIME"><code>RUNTIME</code></a>). <a href="http://aspects.jcabi.com/apidocs-0.15.1/com/jcabi/aspects/Loggable.html"><code>@Loggable</code></a>—the one I’m using in the script above—is an annotation of the second type, from <a href="http://aspects.jcabi.com">jcabi-aspects</a>. It stays with the byte-code in the <code>.class</code> file after compilation.</p><p>Again, it is important to understand that even though method <code>power()</code> is annotated and compiled, it doesn’t send anything to slf4j so far. It just contains a marker saying “please, log my execution.”</p><h2 id="aspect-oriented-programming-aop">Aspect Oriented Programming (AOP)</h2><p><a href="http://en.wikipedia.org/wiki/Aspect-oriented_programming">AOP</a> is a useful technique that enables adding executable blocks to the source code without explicitly changing it. In our example, we don’t want to log method execution inside the class. Instead, we want some other class to intercept every call to method <code>power()</code>, measure its execution time and send this information to slf4j.</p><p>We want that interceptor to understand our <code>@Loggable</code> annotation and log every call to that specific method <code>power()</code>. And, of course, the same interceptor should be used for other methods where we’ll place the same annotation in the future.</p><p>This case perfectly fits the original intent of AOP—to avoid re-implementation of some common behavior in multiple classes.</p><p>Logging is a supplementary feature to our main functionality, and we don’t want to pollute our code with multiple logging instructions. Instead, we want <a href="/2014/05/23/avoid-java-static-logger.html">logging</a> to happen behind the scenes.</p><p>In terms of AOP, our solution can be explained as creating an <strong>aspect</strong> that <strong>cross-cuts</strong> the code at certain <strong>join points</strong> and applies an <strong>around advice</strong> that implements the desired functionality.</p><h2 id="aspectj">AspectJ</h2><p>Let’s see what these magic words mean. But, first, let’s see how <a href="http://aspects.jcabi.com">jcabi-aspects</a> implements them using <a href="http://eclipse.org/aspectj/">AspectJ</a> (it’s a simplified example, full code you can find in <a href="https://github.com/jcabi/jcabi-aspects/blob/jcabi-0.15.2/src/main/java/com/jcabi/aspects/aj/MethodLogger.java"><code>MethodLogger.java</code></a>):</p><figure class="highlight"><pre><code class="language-java" data-lang="java"><span></span><span class="nd">@Aspect</span>
<span class="kd">public</span> <span class="kd">class</span> <span class="nc">MethodLogger</span> <span class="o">{</span>
  <span class="nd">@Around</span><span class="o">(</span><span class="s">&quot;execution(* *(..)) &amp;&amp; @annotation(Loggable)&quot;</span><span class="o">)</span>
  <span class="kd">public</span> <span class="n">Object</span> <span class="nf">around</span><span class="o">(</span><span class="n">ProceedingJoinPoint</span> <span class="n">point</span><span class="o">)</span> <span class="o">{</span>
    <span class="kt">long</span> <span class="n">start</span> <span class="o">=</span> <span class="n">System</span><span class="o">.</span><span class="na">currentTimeMillis</span><span class="o">();</span>
    <span class="n">Object</span> <span class="n">result</span> <span class="o">=</span> <span class="n">point</span><span class="o">.</span><span class="na">proceed</span><span class="o">();</span>
    <span class="n">Logger</span><span class="o">.</span><span class="na">info</span><span class="o">(</span>
      <span class="s">&quot;#%s(%s): %s in %[msec]s&quot;</span><span class="o">,</span>
      <span class="n">MethodSignature</span><span class="o">.</span><span class="na">class</span><span class="o">.</span><span class="na">cast</span><span class="o">(</span><span class="n">point</span><span class="o">.</span><span class="na">getSignature</span><span class="o">()).</span><span class="na">getMethod</span><span class="o">().</span><span class="na">getName</span><span class="o">(),</span>
      <span class="n">point</span><span class="o">.</span><span class="na">getArgs</span><span class="o">(),</span>
      <span class="n">result</span><span class="o">,</span>
      <span class="n">System</span><span class="o">.</span><span class="na">currentTimeMillis</span><span class="o">()</span> <span class="o">-</span> <span class="n">start</span>
    <span class="o">);</span>
    <span class="k">return</span> <span class="n">result</span><span class="o">;</span>
  <span class="o">}</span>
<span class="o">}</span></code></pre></figure><p>This is an <strong>aspect</strong> with a single <strong>around advice</strong> <code>around()</code> inside. The aspect is annotated with <code>@Aspect</code> and advice is annotated with <code>@Around</code>. As discussed above, these annotations are just markers in <code>.class</code> files. They don’t do anything except provide some meta-information to those who are interested in runtime.</p><p>Annotation <code>@Around</code> has one parameter, which—in this case—says that the advice should be applied to a method if:</p><ol> <li><p>its visibility modifier is <code>*</code> (<code>public</code>, <code>protected</code> or <code>private</code>);</p></li> <li><p>its name is name <code>*</code> (any name);</p></li> <li><p>its arguments are <code>..</code> (any arguments); and</p></li> <li><p>it is annotated with <code>@Loggable</code></p></li> </ol><p>When a call to an annotated method is to be intercepted, method <code>around()</code> executes before executing the actual method. When a call to method <code>power()</code> is to be intercepted, method <code>around()</code> receives an instance of class <code>ProceedingJoinPoint</code> and must return an object, which will be used as a result of method <code>power()</code>.</p><p>In order to call the original method, <code>power()</code>, the advice has to call <code>proceed()</code> of the <strong>join point</strong> object.</p><p>We compile this aspect and make it available in classpath together with our main file <code>Foo.class</code>. So far so good, but we need to take one last step in order to put our aspect into action—we should <strong>apply</strong> our advice.</p><h2 id="binary-aspect-weaving">Binary Aspect Weaving</h2><p>Aspect weaving is the name of the advice applying process. Aspect weaver modifies original code by injecting calls to aspects. AspectJ does exactly that. We give it two binary Java classes <code>Foo.class</code> and <code>MethodLogger.class</code>; it gives back three—modified <code>Foo.class</code>, <code>Foo$AjcClosure1.class</code> and unmodified <code>MethodLogger.class</code>.</p><aside class="quote">Without weaving, both classes and aspects are just compiled Java binaries with attached annotations</aside><p>In order to understand which advice should be applied to which methods, AspectJ weaver is using annotations from <code>.class</code> files. Also, it uses <a href="http://docs.oracle.com/javase/tutorial/reflect/">reflection</a> to browse all classes on classpath. It analyzes which methods satisfy the conditions from the <code>@Around</code> annotation. Of course, it finds our method <code>power()</code>.</p><p>So, there are two steps. First, we compile our <code>.java</code> files using <code>javac</code> and get two files. Then, AspectJ weaves/modifies them and creates its own extra class. Our <code>Foo</code> class looks something like this after weaving:</p><figure class="highlight"><pre><code class="language-java" data-lang="java"><span></span><span class="kd">public</span> <span class="kd">class</span> <span class="nc">Foo</span> <span class="o">{</span>
  <span class="kd">private</span> <span class="kd">final</span> <span class="n">MethodLogger</span> <span class="n">logger</span><span class="o">;</span>
  <span class="nd">@Loggable</span>
  <span class="kd">public</span> <span class="kt">int</span> <span class="nf">power</span><span class="o">(</span><span class="kt">int</span> <span class="n">x</span><span class="o">,</span> <span class="kt">int</span> <span class="n">p</span><span class="o">)</span> <span class="o">{</span>
    <span class="k">return</span> <span class="k">this</span><span class="o">.</span><span class="na">logger</span><span class="o">.</span><span class="na">around</span><span class="o">(</span><span class="n">point</span><span class="o">);</span>
  <span class="o">}</span>
  <span class="kd">private</span> <span class="kt">int</span> <span class="nf">power_aroundBody</span><span class="o">(</span><span class="kt">int</span> <span class="n">x</span><span class="o">,</span> <span class="kt">int</span> <span class="n">p</span><span class="o">)</span> <span class="o">{</span>
    <span class="k">return</span> <span class="n">Math</span><span class="o">.</span><span class="na">pow</span><span class="o">(</span><span class="n">x</span><span class="o">,</span> <span class="n">p</span><span class="o">);</span>
  <span class="o">}</span>
<span class="o">}</span></code></pre></figure><p>AspectJ weaver moves our original functionality to a new method, <code>power_aroundBody()</code>, and redirects all <code>power()</code> calls to the aspect class <code>MethodLogger</code>.</p><p>Instead of one method <code>power()</code> in class <code>Foo</code> now we have four classes working together. From now on, this is what happens behind the scenes on every call to <code>power()</code>:</p><p><img src="/uml/52d3d016f2264bbf660a23d5bbe84203.svg" alt="PlantUML SVG diagram" class="plantuml" /></p><p>Original functionality of method <code>power()</code> is indicated by the small green lifeline on the diagram.</p><p>As you see, the aspect weaving process connects together classes and aspects, transferring calls between them through join points. Without weaving, both classes and aspects are just compiled Java binaries with attached annotations.</p><h1 id="jcabi-aspects">jcabi-aspects</h1><p><a href="http://aspects.jcabi.com">jcabi-aspects</a> is a JAR library that contains <code>Loggable</code> annotation and <code>MethodLogger</code> aspect (btw, there are <a href="http://aspects.jcabi.com">many more</a> aspects and annotations). You don’t need to write your own aspect for method logging. Just add a few dependencies to your classpath and configure <a href="http://plugin.jcabi.com">jcabi-maven-plugin</a> for aspect weaving (get their latest versions in <a href="http://search.maven.org/">Maven Central</a>):</p><figure class="highlight"><pre><code class="language-xml" data-lang="xml"><span></span><span class="nt">&lt;project&gt;</span>
  <span class="nt">&lt;dependencies&gt;</span>
    <span class="nt">&lt;dependency&gt;</span>
      <span class="nt">&lt;groupId&gt;</span>com.jcabi<span class="nt">&lt;/groupId&gt;</span>
      <span class="nt">&lt;artifactId&gt;</span>jcabi-aspects<span class="nt">&lt;/artifactId&gt;</span>
    <span class="nt">&lt;/dependency&gt;</span>
    <span class="nt">&lt;dependency&gt;</span>
      <span class="nt">&lt;groupId&gt;</span>org.aspectj<span class="nt">&lt;/groupId&gt;</span>
      <span class="nt">&lt;artifactId&gt;</span>aspectjrt<span class="nt">&lt;/artifactId&gt;</span>
    <span class="nt">&lt;/dependency&gt;</span>
  <span class="nt">&lt;/dependencies&gt;</span>
  <span class="nt">&lt;build&gt;</span>
    <span class="nt">&lt;plugins&gt;</span>
      <span class="nt">&lt;plugin&gt;</span>
        <span class="nt">&lt;groupId&gt;</span>com.jcabi<span class="nt">&lt;/groupId&gt;</span>
        <span class="nt">&lt;artifactId&gt;</span>jcabi-maven-plugin<span class="nt">&lt;/artifactId&gt;</span>
        <span class="nt">&lt;executions&gt;</span>
          <span class="nt">&lt;execution&gt;</span>
            <span class="nt">&lt;goals&gt;</span>
              <span class="nt">&lt;goal&gt;</span>ajc<span class="nt">&lt;/goal&gt;</span>
            <span class="nt">&lt;/goals&gt;</span>
          <span class="nt">&lt;/execution&gt;</span>
        <span class="nt">&lt;/executions&gt;</span>
      <span class="nt">&lt;/plugin&gt;</span>
    <span class="nt">&lt;/plugins&gt;</span>
  <span class="nt">&lt;/build&gt;</span>
<span class="nt">&lt;/project&gt;</span></code></pre></figure><p>Since this weaving procedure takes a lot of configuration effort, I created a convenient Maven plugin with an <code>ajc</code> goal, which does the entire aspect weaving job. You can use AspectJ directly, but I recommend that you use <a href="http://plugin.jcabi.com">jcabi-maven-plugin</a>.</p><p>That’s it. Now you can use <a href="http://aspects.jcabi.com/apidocs-0.15.1/com/jcabi/aspects/Loggable.html"><code>@com.jcabi.aspects.Loggable</code></a> annotation and your methods will be logged through slf4j.</p><p>If something doesn’t work as explained, don’t hesitate to submit a <a href="https://github.com/jcabi/jcabi-aspects/issues">GitHub issue</a>.</p></div></article></div><div class="wrapper"> <related-posts /></div><div class="disqus" role="complementary"><p class="disqus_hint"> Please, use <a href="https://help.disqus.com/commenting/what-html-tags-are-allowed-within-comments">syntax highlighting</a> in your comments, to make them more readable.</p><div id="disqus_thread" class="disqus-thread"> <a>&nbsp;</a></div><script> var disqus_config = function () { this.page.url = document.location.href.split('?')[0].split('#')[0].replace('https://', 'http://'); this.page.identifier = this.page.url; }; (function() { var d = document, s = d.createElement('script'); s.src = '//yegor256.disqus.com/embed.js'; s.setAttribute('data-timestamp', +new Date()); (d.head || d.body).appendChild(s); })(); </script> <noscript><div><p class="red"> JavaScript is disabled in your browser, that's why you can't see comments under this post.</p></div></noscript></div><div class="wrapper"> <footer class="footer"><p> &copy; <span itemscope="" itemprop="copyrightHolder" itemtype="http://schema.org/Person"> <span itemprop="name">Yegor Bugayenko</span> </span> 2014&ndash;<span itemprop="copyrightYear">2018</span></p></footer></div></section><div class="wrapper unprintable" style="text-align:center;margin-top:2em;"> <a href="http://www.sixnines.io/h/3ba1652f"> <img src="//www.sixnines.io/b/3ba1652f?style=flat" alt="sixnines availability badge"/> </a></div><script src="//code.jquery.com/jquery-1.9.0.min.js"></script> <script src="/js/all.js?7d5b276b9b5"></script> <script>var disqus_shortname = 'yegor256';</script> <script id="dsq-count-scr" src="//yegor256.disqus.com/count.js" async="async"></script> <script> (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){ (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o), m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m) })(window,document,'script','//www.google-analytics.com/analytics.js','ga'); ga('create', 'UA-1963507-32', 'auto'); ga('send', 'pageview'); </script> <script> Cd=document;Cr="&"+Math.random();Cp="&s=1"; Cd.cookie="b=b";if(Cd.cookie)Cp+="&c=1"; Cp+="&t="+(new Date()).getTimezoneOffset(); if(self!=top)Cp+="&f=1"; </script> <script> if(navigator.javaEnabled())Cp+="&j=1"; </script> <script> if(typeof(screen)!='undefined')Cp+="&w="+screen.width+"&h="+ screen.height+"&d="+(screen.colorDepth?screen.colorDepth:screen.pixelDepth); </script> <script> Cd.write("<img src='//c.hit.ua/hit?i=95870&g=0&x=2"+Cp+Cr+ "&r="+escape(Cd.referrer)+"&u="+escape(window.location.href)+ "' border='0' wi"+"dth='1' he"+"ight='1'/>"); </script> <script type="application/ld+json"> { "@context": "http://schema.org", "@type": "Person", "name": "Yegor Bugayenko", "url": "https://www.yegor256.com", "sameAs": [ "https://www.facebook.com/yegor256", "https://instagram.com/yegor256", "https://www.linkedin.com/in/yegor256", "https://twitter.com/yegor256", "https://github.com/yegor256", "https://www.pinterest.com/yegor256/" ] } </script> </body> </html> </article></div></section><div class="wrapper unprintable" style="text-align:center;margin-top:2em;"> <a href="http://www.sixnines.io/h/3ba1652f"> <img src="//www.sixnines.io/b/3ba1652f?style=flat" alt="sixnines availability badge"/> </a></div><script src="//code.jquery.com/jquery-1.9.0.min.js"></script> <script src="/js/all.js?7d5b276b9b5"></script> <script>var disqus_shortname = 'yegor256';</script> <script id="dsq-count-scr" src="//yegor256.disqus.com/count.js" async="async"></script> <script> (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){ (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o), m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m) })(window,document,'script','//www.google-analytics.com/analytics.js','ga'); ga('create', 'UA-1963507-32', 'auto'); ga('send', 'pageview'); </script> <script> Cd=document;Cr="&"+Math.random();Cp="&s=1"; Cd.cookie="b=b";if(Cd.cookie)Cp+="&c=1"; Cp+="&t="+(new Date()).getTimezoneOffset(); if(self!=top)Cp+="&f=1"; </script> <script> if(navigator.javaEnabled())Cp+="&j=1"; </script> <script> if(typeof(screen)!='undefined')Cp+="&w="+screen.width+"&h="+ screen.height+"&d="+(screen.colorDepth?screen.colorDepth:screen.pixelDepth); </script> <script> Cd.write("<img src='//c.hit.ua/hit?i=95870&g=0&x=2"+Cp+Cr+ "&r="+escape(Cd.referrer)+"&u="+escape(window.location.href)+ "' border='0' wi"+"dth='1' he"+"ight='1'/>"); </script> <script type="application/ld+json"> { "@context": "http://schema.org", "@type": "Person", "name": "Yegor Bugayenko", "url": "https://www.yegor256.com", "sameAs": [ "https://www.facebook.com/yegor256", "https://instagram.com/yegor256", "https://www.linkedin.com/in/yegor256", "https://twitter.com/yegor256", "https://github.com/yegor256", "https://www.pinterest.com/yegor256/" ] } </script> </body> </html>
