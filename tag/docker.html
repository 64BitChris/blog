<!DOCTYPE html> <html xmlns="http://www.w3.org/1999/xhtml" lang="en-US" xml:lang="en-US" itemscope="" itemtype="http://schema.org/WebSite"> <head> <meta charset="utf-8"/> <meta name="description" content="{&quot;layout&quot;=&gt;&quot;tag-index&quot;, &quot;posts&quot;=&gt;[#&lt;Jekyll::Document _posts/2014/aug/2014-08-29-docker-non-root.md collection=posts&gt;, #&lt;Jekyll::Document _posts/2014/jul/2014-07-31-travis-and-rultor.md collection=posts&gt;, #&lt;Jekyll::Document _posts/2014/jul/2014-07-29-docker-in-rultor.md collection=posts&gt;], &quot;tag&quot;=&gt;&quot;docker&quot;, &quot;content&quot;=&gt;&quot;&quot;, &quot;dir&quot;=&gt;&quot;/tag/&quot;, &quot;name&quot;=&gt;&quot;docker.html&quot;, &quot;path&quot;=&gt;&quot;tag/docker.html&quot;, &quot;url&quot;=&gt;&quot;/tag/docker&quot;, &quot;title&quot;=&gt;&quot;docker&quot;, &quot;description&quot;=&gt;&quot;docker: more about docker in this collection of recently published articles... the list is updated every few weeks.&quot;}" /> <meta name="keywords" content="{&quot;layout&quot;=&gt;&quot;tag-index&quot;, &quot;posts&quot;=&gt;[#&lt;Jekyll::Document _posts/2014/aug/2014-08-29-docker-non-root.md collection=posts&gt;, #&lt;Jekyll::Document _posts/2014/jul/2014-07-31-travis-and-rultor.md collection=posts&gt;, #&lt;Jekyll::Document _posts/2014/jul/2014-07-29-docker-in-rultor.md collection=posts&gt;], &quot;tag&quot;=&gt;&quot;docker&quot;, &quot;content&quot;=&gt;&quot;&quot;, &quot;dir&quot;=&gt;&quot;/tag/&quot;, &quot;name&quot;=&gt;&quot;docker.html&quot;, &quot;path&quot;=&gt;&quot;tag/docker.html&quot;, &quot;url&quot;=&gt;&quot;/tag/docker&quot;, &quot;title&quot;=&gt;&quot;docker&quot;, &quot;description&quot;=&gt;&quot;docker: more about docker in this collection of recently published articles... the list is updated every few weeks.&quot;}" /> <meta name="viewport" content="width=device-width,minimum-scale=1,initial-scale=1"/> <meta name="google-site-verification" content="JEj_gQr2CPe2QKGw8XdMz0R7VboQIUbX3FlM-lwTq-8" /> <meta name="author" content="Yegor Bugayenko"> <meta name="og:site_name" content="Yegor Bugayenko"/> <meta name="og:type" content="article" /> <meta name="og:locale" content="en_US" /> <meta name="twitter:account_id" content="4503599630178231" /> <meta name="twitter:creator" content="@yegor256"/> <meta name="twitter:site" content="@yegor256"/> <meta name="twitter:title" property="og:title" content="docker"/> <meta name="twitter:description" property="og:description" content="{&quot;layout&quot;=&gt;&quot;tag-index&quot;, &quot;posts&quot;=&gt;[#&lt;Jekyll::Document _posts/2014/aug/2014-08-29-docker-non-root.md collection=posts&gt;, #&lt;Jekyll::Document _posts/2014/jul/2014-07-31-travis-and-rultor.md collection=posts&gt;, #&lt;Jekyll::Document _posts/2014/jul/2014-07-29-docker-in-rultor.md collection=posts&gt;], &quot;tag&quot;=&gt;&quot;docker&quot;, &quot;content&quot;=&gt;&quot;&quot;, &quot;dir&quot;=&gt;&quot;/tag/&quot;, &quot;name&quot;=&gt;&quot;docker.html&quot;, &quot;path&quot;=&gt;&quot;tag/docker.html&quot;, &quot;url&quot;=&gt;&quot;/tag/docker&quot;, &quot;title&quot;=&gt;&quot;docker&quot;, &quot;description&quot;=&gt;&quot;docker: more about docker in this collection of recently published articles... the list is updated every few weeks.&quot;}"/> <meta name="twitter:url" property="og:url" content="https://www.yegor256.com/tag/docker"/> <meta name="telegram:channel" content="AAAAAEJFMRzsRTRxM3ec6A"/> <link rel="search" type="application/opensearchdescription+xml" href="/opensearch.xml" title="yegor256" /> <link rel="shortcut icon" href="/favicon.ico?c998b88f617"/> <link rel="apple-touch-icon" href="/favicon.ico?c998b88f617"/> <link rel="alternate" type="application/rss+xml" title="RSS for yegor256.com" href="https://www.yegor256.com/rss.xml"/> <link rel="stylesheet" href="/css/layout.css?c998b88f617"/> <link rel="stylesheet" href="/css/icons.css?c998b88f617"/> <link rel="canonical" href="https://www.yegor256.com/tag/docker" /> <link rel="amphtml" href="https://www.yegor256.com/tag/docker" /> <title>docker </title> </head> <body><div class="wrapper"> <aside class="header-toggle unprintable" id="header-toggle" title="Show the menu" onclick="$('#header').show();$('#header-toggle').hide();">&#9776;</aside> <header class="header" id="header"><div class="face"> <a href="/about-me.html#form" class="sub" title="Click to subscribe to my monthly newsletter"><span>Subscribe</span></a> <a href="/about-me.html" style="position:relative;"> <img src="/images/face-256x256.jpg" class="photo" alt="Yegor Bugayenko"/> </a></div><nav><ul class="menu social notranslate"> <li><a href="https://twitter.com/intent/follow?screen_name=yegor256" rel="nofollow" title="Follow me on Twitter"><i class="icon icon-twitter notranslate" aria-hidden="true"></i></a></li> <li><a href="/rss.xml" rel="nofollow" title="Subscribe to my RSS feed"><i class="icon icon-rss notranslate" aria-hidden="true"></i></a></li> <li><a itemprop="sameAs" href="https://github.com/yegor256" rel="nofollow" title="My GitHub profile"><i class="icon icon-github notranslate" aria-hidden="true"></i></a></li> <li><a itemprop="sameAs" href="http://stackoverflow.com/users/187141/yegor256" rel="nofollow" title="My StackOverflow profile"><i class="icon icon-stackoverflow notranslate" aria-hidden="true"></i></a></li> <li><a itemprop="sameAs" href="https://www.facebook.com/yegor256" rel="nofollow" title="Follow me on Facebook"><i class="icon icon-facebook notranslate" aria-hidden="true"></i></a></li> <li><a itemprop="sameAs" href="https://instagram.com/yegor256" rel="nofollow" title="Follow me on Instagram"><i class="icon icon-instagram notranslate" aria-hidden="true"></i></a></li> <li><a itemprop="sameAs" href="https://www.linkedin.com/in/yegor256" rel="nofollow" title="My LinkedIn profile"><i class="icon icon-linkedin notranslate" aria-hidden="true"></i></a></li> <li><a itemprop="sameAs" href="https://www.youtube.com/c/yegor256?sub_confirmation=1" rel="nofollow" title="My Youtube video channel"><i class="icon icon-youtube notranslate" aria-hidden="true"></i></a></li> <li><a itemprop="sameAs" href="https://www.pinterest.com/yegor256/" rel="nofollow" title="My Pinterest boards"><i class="icon icon-pinterest notranslate" aria-hidden="true"></i></a></li> <li><a itemprop="sameAs" href="https://angel.co/yegor256" rel="nofollow" title="My AngelList profile"><i class="icon icon-angellist notranslate" aria-hidden="true"></i></a></li> <li><a href="https://soundcloud.com/yegor256" rel="nofollow" title="My podcast"><i class="icon icon-podcast notranslate" aria-hidden="true"></i></a></li> <li><a href="https://itunes.apple.com/us/podcast/yegor256-podcast/id1150826721" rel="nofollow" title="My iTunes podcast"><i class="icon icon-itunes notranslate" aria-hidden="true"></i></a></li> <li><a href="https://t.me/yegor256news" rel="nofollow" title="My Telegram public channel"><i class="icon icon-telegram notranslate" aria-hidden="true"></i></a></li> <li><a href="mailto:blog@yegor256.com" rel="nofollow" title="Email me any time"><i class="icon icon-mail notranslate" aria-hidden="true"></i></a></li></ul><ul class="menu"> <li><a href="/" title="Home page">Home</a></li> <li /tag/docker><a href="/best.html" title="Best articles to read">12&#160;Best</a></li> <li /tag/docker><a href="/contents.html" title="The contents of the entire blog">All&#160;292</a></li> <li /tag/docker><a href="/webinars.html" title="My webinars">Webinars</a></li> <li /tag/docker><a href="/talks.html" title="Future and past conference talks">Talks</a></li> <li /tag/docker><a href="/books.html" title="The books I wrote">Books</a></li> <li /tag/docker><a href="/papers.html" title="My academic papers and patents">Papers</a></li> <li /tag/docker><a href="/pets.html" title="My loved pet projects">Pets</a></li> <li /tag/docker class="highlighted"><a href="/trainings.html" title="On-site trainings">Trainings</a></li> <li /tag/docker><a href="/award.html" title="Software quality award">Award</a></li> <li /tag/docker><a href="/testimonials.html" title="What some people say about me">Testimonials</a></li> <li /tag/docker><a href="/shift-m.html" title="Audio podcast about project management">Shift-M</a></li> <li /tag/docker><a href="/paintings.html" title="My paintings for sale">Paintings</a></li> <li><a href="https://ru.yegor256.com/" title="Немного на русском языке">По-русски</a></li></ul></nav><div class="search"> <form method="get" action="https://www.google.com/search" itemprop="potentialAction" itemscope="" itemtype="http://schema.org/SearchAction"> <meta itemprop="target" content="https://www.google.com/search?q={q}"/> <input name="sitesearch" value="yegor256.com" type="hidden"/> <input itemprop="query-input" type="text" id="search-query" class="field field-text" required="required" onfocus="$('.google').css('visibility', 'visible');" name="q" placeholder="Search..." autocomplete="off"/> <input type="image" src="/images/google-search-icon.svg" class="google" title="Search via Google" alt="Search via Google"/> </form></div><div class="hot"><ul></ul></div></header></div><section itemscope="" itemtype="http://schema.org/BlogPosting"><div class="wrapper"> <header itemprop="name"><h1>3 posts about docker</h1></header> <article itemprop="articleBody"> <!DOCTYPE html> <html xmlns="http://www.w3.org/1999/xhtml" lang="en-US" xml:lang="en-US" itemscope="" itemtype="http://schema.org/WebSite"> <head> <meta charset="utf-8"/> <meta name="description" content="&lt;p&gt;Docker starts a process inside its container as a “root” user. In some cases, this is not convenient though. For example, &lt;code&gt;initdb&lt;/code&gt; from PostgreSQL doesn’t like to be started as root and will fail. In &lt;a href=&quot;http://www.rultor.com&quot;&gt;rultor.com&lt;/a&gt;, a DevOps team assistant, &lt;a href=&quot;/2014/07/29/docker-in-rultor.html&quot;&gt;we’re using Docker&lt;/a&gt; as a virtualization technology for every build we run.&lt;/p&gt; &lt;p&gt;Here is how we change the user inside a running container, right after it is started.&lt;/p&gt; &lt;!--more--&gt; &lt;p&gt;First, this is how we start a new Docker container:&lt;/p&gt; &lt;figure class=&quot;highlight&quot;&gt;&lt;pre&gt;&lt;code class=&quot;language-bash&quot; data-lang=&quot;bash&quot;&gt;&lt;span&gt;&lt;/span&gt;$ sudo docker run -i -t --rm -v &lt;span class=&quot;s2&quot;&gt;&amp;quot;&lt;/span&gt;&lt;span class=&quot;k&quot;&gt;$(&lt;/span&gt;&lt;span class=&quot;nb&quot;&gt;pwd&lt;/span&gt;&lt;span class=&quot;k&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;:/main&amp;quot;&lt;/span&gt; &lt;span class=&quot;se&quot;&gt;\&lt;/span&gt; yegor256/rultor /main/entry.sh&lt;/code&gt;&lt;/pre&gt;&lt;/figure&gt; &lt;p&gt;There are two files in the current directory: &lt;code&gt;entry.sh&lt;/code&gt; and &lt;code&gt;script.sh&lt;/code&gt;. &lt;code&gt;entry.sh&lt;/code&gt; is the file being executed by Docker on start, and it contains the following:&lt;/p&gt; &lt;figure class=&quot;highlight&quot;&gt;&lt;pre&gt;&lt;code class=&quot;language-bash&quot; data-lang=&quot;bash&quot;&gt;&lt;span&gt;&lt;/span&gt;&lt;span class=&quot;ch&quot;&gt;#!/bin/bash&lt;/span&gt; adduser --disabled-password --gecos &lt;span class=&quot;s1&quot;&gt;&amp;#39;&amp;#39;&lt;/span&gt; r adduser r sudo &lt;span class=&quot;nb&quot;&gt;echo&lt;/span&gt; &lt;span class=&quot;s1&quot;&gt;&amp;#39;%sudo ALL=(ALL) NOPASSWD:ALL&amp;#39;&lt;/span&gt; &amp;gt;&amp;gt; /etc/sudoers su -m r -c /home/r/script.sh&lt;/code&gt;&lt;/pre&gt;&lt;/figure&gt; &lt;p&gt;&lt;code&gt;script.sh&lt;/code&gt; will be executed as a user &lt;code&gt;r&lt;/code&gt; inside the container. And this &lt;code&gt;r&lt;/code&gt; user will have &lt;code&gt;sudo&lt;/code&gt; permissions. This is exactly what all projects, managing their DevOps procedures with &lt;a href=&quot;http://www.rultor.com&quot;&gt;rultor.com&lt;/a&gt;, need.&lt;/p&gt; " /> <meta name="keywords" content="next, path, output, content, previous, url, relative_path, id, collection, excerpt, draft, categories, layout, title, date, tags, description, keywords, slug, ext" /> <meta name="viewport" content="width=device-width,minimum-scale=1,initial-scale=1"/> <meta name="google-site-verification" content="JEj_gQr2CPe2QKGw8XdMz0R7VboQIUbX3FlM-lwTq-8" /> <meta name="author" content="Yegor Bugayenko"> <meta name="article:published_time" content="2014-08-29 00:00:00 +0000"> <meta name="og:site_name" content="Yegor Bugayenko"/> <meta name="og:type" content="article" /> <meta name="og:locale" content="en_US" /> <meta name="twitter:account_id" content="4503599630178231" /> <meta name="twitter:creator" content="@yegor256"/> <meta name="twitter:site" content="@yegor256"/> <meta name="twitter:title" property="og:title" content="How We Run as a Non-Root Inside Docker Container"/> <meta name="twitter:description" property="og:description" content="&lt;p&gt;Docker starts a process inside its container as a “root” user. In some cases, this is not convenient though. For example, &lt;code&gt;initdb&lt;/code&gt; from PostgreSQL doesn’t like to be started as root and will fail. In &lt;a href=&quot;http://www.rultor.com&quot;&gt;rultor.com&lt;/a&gt;, a DevOps team assistant, &lt;a href=&quot;/2014/07/29/docker-in-rultor.html&quot;&gt;we’re using Docker&lt;/a&gt; as a virtualization technology for every build we run.&lt;/p&gt; &lt;p&gt;Here is how we change the user inside a running container, right after it is started.&lt;/p&gt; &lt;!--more--&gt; &lt;p&gt;First, this is how we start a new Docker container:&lt;/p&gt; &lt;figure class=&quot;highlight&quot;&gt;&lt;pre&gt;&lt;code class=&quot;language-bash&quot; data-lang=&quot;bash&quot;&gt;&lt;span&gt;&lt;/span&gt;$ sudo docker run -i -t --rm -v &lt;span class=&quot;s2&quot;&gt;&amp;quot;&lt;/span&gt;&lt;span class=&quot;k&quot;&gt;$(&lt;/span&gt;&lt;span class=&quot;nb&quot;&gt;pwd&lt;/span&gt;&lt;span class=&quot;k&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;:/main&amp;quot;&lt;/span&gt; &lt;span class=&quot;se&quot;&gt;\&lt;/span&gt; yegor256/rultor /main/entry.sh&lt;/code&gt;&lt;/pre&gt;&lt;/figure&gt; &lt;p&gt;There are two files in the current directory: &lt;code&gt;entry.sh&lt;/code&gt; and &lt;code&gt;script.sh&lt;/code&gt;. &lt;code&gt;entry.sh&lt;/code&gt; is the file being executed by Docker on start, and it contains the following:&lt;/p&gt; &lt;figure class=&quot;highlight&quot;&gt;&lt;pre&gt;&lt;code class=&quot;language-bash&quot; data-lang=&quot;bash&quot;&gt;&lt;span&gt;&lt;/span&gt;&lt;span class=&quot;ch&quot;&gt;#!/bin/bash&lt;/span&gt; adduser --disabled-password --gecos &lt;span class=&quot;s1&quot;&gt;&amp;#39;&amp;#39;&lt;/span&gt; r adduser r sudo &lt;span class=&quot;nb&quot;&gt;echo&lt;/span&gt; &lt;span class=&quot;s1&quot;&gt;&amp;#39;%sudo ALL=(ALL) NOPASSWD:ALL&amp;#39;&lt;/span&gt; &amp;gt;&amp;gt; /etc/sudoers su -m r -c /home/r/script.sh&lt;/code&gt;&lt;/pre&gt;&lt;/figure&gt; &lt;p&gt;&lt;code&gt;script.sh&lt;/code&gt; will be executed as a user &lt;code&gt;r&lt;/code&gt; inside the container. And this &lt;code&gt;r&lt;/code&gt; user will have &lt;code&gt;sudo&lt;/code&gt; permissions. This is exactly what all projects, managing their DevOps procedures with &lt;a href=&quot;http://www.rultor.com&quot;&gt;rultor.com&lt;/a&gt;, need.&lt;/p&gt; "/> <meta name="twitter:url" property="og:url" content="https://www.yegor256.com/2014/08/29/docker-non-root.html"/> <meta name="telegram:channel" content="AAAAAEJFMRzsRTRxM3ec6A"/> <link rel="search" type="application/opensearchdescription+xml" href="/opensearch.xml" title="yegor256" /> <link rel="shortcut icon" href="/favicon.ico?c998b88f617"/> <link rel="apple-touch-icon" href="/favicon.ico?c998b88f617"/> <link rel="alternate" type="application/rss+xml" title="RSS for yegor256.com" href="https://www.yegor256.com/rss.xml"/> <link rel="stylesheet" href="/css/layout.css?c998b88f617"/> <link rel="stylesheet" href="/css/icons.css?c998b88f617"/> <link rel="canonical" href="https://www.yegor256.com/2014/08/29/docker-non-root.html" /> <link rel="amphtml" href="https://www.yegor256.com/2014/08/29/docker-non-root.amp.html" /> <title>How We Run as a Non-Root Inside Docker Container </title> </head> <body><div class="wrapper"> <aside class="header-toggle unprintable" id="header-toggle" title="Show the menu" onclick="$('#header').show();$('#header-toggle').hide();">&#9776;</aside> <header class="header" id="header"><div class="face"> <a href="/about-me.html#form" class="sub" title="Click to subscribe to my monthly newsletter"><span>Subscribe</span></a> <a href="/about-me.html" style="position:relative;"> <img src="/images/face-256x256.jpg" class="photo" alt="Yegor Bugayenko"/> </a></div><nav><ul class="menu social notranslate"> <li><a href="https://twitter.com/intent/follow?screen_name=yegor256" rel="nofollow" title="Follow me on Twitter"><i class="icon icon-twitter notranslate" aria-hidden="true"></i></a></li> <li><a href="/rss.xml" rel="nofollow" title="Subscribe to my RSS feed"><i class="icon icon-rss notranslate" aria-hidden="true"></i></a></li> <li><a itemprop="sameAs" href="https://github.com/yegor256" rel="nofollow" title="My GitHub profile"><i class="icon icon-github notranslate" aria-hidden="true"></i></a></li> <li><a itemprop="sameAs" href="http://stackoverflow.com/users/187141/yegor256" rel="nofollow" title="My StackOverflow profile"><i class="icon icon-stackoverflow notranslate" aria-hidden="true"></i></a></li> <li><a itemprop="sameAs" href="https://www.facebook.com/yegor256" rel="nofollow" title="Follow me on Facebook"><i class="icon icon-facebook notranslate" aria-hidden="true"></i></a></li> <li><a itemprop="sameAs" href="https://instagram.com/yegor256" rel="nofollow" title="Follow me on Instagram"><i class="icon icon-instagram notranslate" aria-hidden="true"></i></a></li> <li><a itemprop="sameAs" href="https://www.linkedin.com/in/yegor256" rel="nofollow" title="My LinkedIn profile"><i class="icon icon-linkedin notranslate" aria-hidden="true"></i></a></li> <li><a itemprop="sameAs" href="https://www.youtube.com/c/yegor256?sub_confirmation=1" rel="nofollow" title="My Youtube video channel"><i class="icon icon-youtube notranslate" aria-hidden="true"></i></a></li> <li><a itemprop="sameAs" href="https://www.pinterest.com/yegor256/" rel="nofollow" title="My Pinterest boards"><i class="icon icon-pinterest notranslate" aria-hidden="true"></i></a></li> <li><a itemprop="sameAs" href="https://angel.co/yegor256" rel="nofollow" title="My AngelList profile"><i class="icon icon-angellist notranslate" aria-hidden="true"></i></a></li> <li><a href="https://soundcloud.com/yegor256" rel="nofollow" title="My podcast"><i class="icon icon-podcast notranslate" aria-hidden="true"></i></a></li> <li><a href="https://itunes.apple.com/us/podcast/yegor256-podcast/id1150826721" rel="nofollow" title="My iTunes podcast"><i class="icon icon-itunes notranslate" aria-hidden="true"></i></a></li> <li><a href="https://t.me/yegor256news" rel="nofollow" title="My Telegram public channel"><i class="icon icon-telegram notranslate" aria-hidden="true"></i></a></li> <li><a href="mailto:blog@yegor256.com" rel="nofollow" title="Email me any time"><i class="icon icon-mail notranslate" aria-hidden="true"></i></a></li></ul><ul class="menu"> <li><a href="/" title="Home page">Home</a></li> <li /2014/08/29/docker-non-root.html><a href="/best.html" title="Best articles to read">12&#160;Best</a></li> <li /2014/08/29/docker-non-root.html><a href="/contents.html" title="The contents of the entire blog">All&#160;292</a></li> <li /2014/08/29/docker-non-root.html><a href="/webinars.html" title="My webinars">Webinars</a></li> <li /2014/08/29/docker-non-root.html><a href="/talks.html" title="Future and past conference talks">Talks</a></li> <li /2014/08/29/docker-non-root.html><a href="/books.html" title="The books I wrote">Books</a></li> <li /2014/08/29/docker-non-root.html><a href="/papers.html" title="My academic papers and patents">Papers</a></li> <li /2014/08/29/docker-non-root.html><a href="/pets.html" title="My loved pet projects">Pets</a></li> <li /2014/08/29/docker-non-root.html class="highlighted"><a href="/trainings.html" title="On-site trainings">Trainings</a></li> <li /2014/08/29/docker-non-root.html><a href="/award.html" title="Software quality award">Award</a></li> <li /2014/08/29/docker-non-root.html><a href="/testimonials.html" title="What some people say about me">Testimonials</a></li> <li /2014/08/29/docker-non-root.html><a href="/shift-m.html" title="Audio podcast about project management">Shift-M</a></li> <li /2014/08/29/docker-non-root.html><a href="/paintings.html" title="My paintings for sale">Paintings</a></li> <li><a href="https://ru.yegor256.com/" title="Немного на русском языке">По-русски</a></li></ul></nav><div class="search"> <form method="get" action="https://www.google.com/search" itemprop="potentialAction" itemscope="" itemtype="http://schema.org/SearchAction"> <meta itemprop="target" content="https://www.google.com/search?q={q}"/> <input name="sitesearch" value="yegor256.com" type="hidden"/> <input itemprop="query-input" type="text" id="search-query" class="field field-text" required="required" onfocus="$('.google').css('visibility', 'visible');" name="q" placeholder="Search..." autocomplete="off"/> <input type="image" src="/images/google-search-icon.svg" class="google" title="Search via Google" alt="Search via Google"/> </form></div><div class="hot"><ul></ul></div></header></div><section itemscope="" itemtype="http://schema.org/BlogPosting"><div class="wrapper"> <header><p class="printable"> <img src="https://api.qrserver.com/v1/create-qr-code/?data=https://www.yegor256.com/2014/08/29/docker-non-root.html&amp;format=svg" style="width:125px;height:125px;" alt="QR code"/></p><p class="printable"> <code itemprop="url">https://www.yegor256.com/2014/08/29/docker-non-root.html</code></p><h1 itemprop="name headline mainEntityOfPage">How We Run as a Non-Root Inside Docker Container</h1><ul class="subline"> <li> <time itemprop="datePublished" datetime="2014-08-29T00:00:00+00:00"> 29 August 2014 </time> </li> <li class="printable" itemscope="" itemprop="author" itemtype="http://schema.org/Person"> <span itemprop="name">Yegor Bugayenko</span> </li> <li class="unprintable"> <i class="icon icon-comments"></i> <a href="https://www.yegor256.com/2014/08/29/docker-non-root.html#disqus_thread" itemprop="discussionUrl">comments</a> </li></ul><p class="unprintable"><p>Docker starts a process inside its container as a “root” user. In some cases, this is not convenient though. For example, <code>initdb</code> from PostgreSQL doesn’t like to be started as root and will fail. In <a href="http://www.rultor.com">rultor.com</a>, a DevOps team assistant, <a href="/2014/07/29/docker-in-rultor.html">we’re using Docker</a> as a virtualization technology for every build we run.</p><p>Here is how we change the user inside a running container, right after it is started.</p><p>First, this is how we start a new Docker container:</p><figure class="highlight"><pre><code class="language-bash" data-lang="bash"><span></span>$ sudo docker run -i -t --rm -v <span class="s2">&quot;</span><span class="k">$(</span><span class="nb">pwd</span><span class="k">)</span><span class="s2">:/main&quot;</span> <span class="se">\</span>
  yegor256/rultor /main/entry.sh</code></pre></figure><p>There are two files in the current directory: <code>entry.sh</code> and <code>script.sh</code>. <code>entry.sh</code> is the file being executed by Docker on start, and it contains the following:</p><figure class="highlight"><pre><code class="language-bash" data-lang="bash"><span></span><span class="ch">#!/bin/bash</span>
adduser --disabled-password --gecos <span class="s1">&#39;&#39;</span> r
adduser r sudo
<span class="nb">echo</span> <span class="s1">&#39;%sudo ALL=(ALL) NOPASSWD:ALL&#39;</span> &gt;&gt; /etc/sudoers
su -m r -c /home/r/script.sh</code></pre></figure><p><code>script.sh</code> will be executed as a user <code>r</code> inside the container. And this <code>r</code> user will have <code>sudo</code> permissions. This is exactly what all projects, managing their DevOps procedures with <a href="http://www.rultor.com">rultor.com</a>, need.</p></p><nav class="buttons notranslate desktop-only"> <a href="http://www.facebook.com/sharer/sharer.php?u=https://www.yegor256.com/2014/08/29/docker-non-root.html" title="Share on Facebook" class="button" rel="nofollow"> <span class="count count-facebook">0</span> <i class="icon icon-facebook notranslate" aria-hidden="true"></i> </a> <a href="https://twitter.com/share?url=https://www.yegor256.com/2014/08/29/docker-non-root.html&amp;text=How+We+Run+as+a+Non-Root+Inside+Docker+Container" title="Share on Twitter" class="button" rel="nofollow"> <span class="count count-twitter">0</span> <i class="icon icon-twitter notranslate" aria-hidden="true"></i> </a> <a href="https://plus.google.com/share?url=https://www.yegor256.com/2014/08/29/docker-non-root.html" title="Share on Google+" class="button" rel="nofollow"> <span class="count count-googleplus">0</span> <i class="icon icon-googleplus notranslate" aria-hidden="true"></i> </a> <a href="https://www.linkedin.com/cws/share?url=https://www.yegor256.com/2014/08/29/docker-non-root.html" title="Share on LinkedIn" class="button" rel="nofollow"> <span class="count count-linkedin">0</span> <i class="icon icon-linkedin notranslate" aria-hidden="true"></i> </a> <a href="http://reddit.com/submit?url=https://www.yegor256.com/2014/08/29/docker-non-root.html%3F2014-34&amp;title=How+We+Run+as+a+Non-Root+Inside+Docker+Container" title="Share on Reddit" class="button" rel="nofollow"> <span class="count count-reddit">0</span> <i class="icon icon-reddit notranslate" aria-hidden="true"></i> </a> <a href="http://news.ycombinator.com/submitlink?u=https://www.yegor256.com/2014/08/29/docker-non-root.html%3F2014-34&amp;t=How+We+Run+as+a+Non-Root+Inside+Docker+Container" title="Share on Hacker News" class="button" rel="nofollow"> <span class="count count-hackernews">0</span> <i class="icon icon-hackernews notranslate" aria-hidden="true"></i> </a> </nav> </header> <article class="main" itemprop="articleBody"><div ><p>Docker starts a process inside its container as a “root” user. In some cases, this is not convenient though. For example, <code>initdb</code> from PostgreSQL doesn’t like to be started as root and will fail. In <a href="http://www.rultor.com">rultor.com</a>, a DevOps team assistant, <a href="/2014/07/29/docker-in-rultor.html">we’re using Docker</a> as a virtualization technology for every build we run.</p><p>Here is how we change the user inside a running container, right after it is started.</p><p>First, this is how we start a new Docker container:</p><figure class="highlight"><pre><code class="language-bash" data-lang="bash"><span></span>$ sudo docker run -i -t --rm -v <span class="s2">&quot;</span><span class="k">$(</span><span class="nb">pwd</span><span class="k">)</span><span class="s2">:/main&quot;</span> <span class="se">\</span>
  yegor256/rultor /main/entry.sh</code></pre></figure><p>There are two files in the current directory: <code>entry.sh</code> and <code>script.sh</code>. <code>entry.sh</code> is the file being executed by Docker on start, and it contains the following:</p><figure class="highlight"><pre><code class="language-bash" data-lang="bash"><span></span><span class="ch">#!/bin/bash</span>
adduser --disabled-password --gecos <span class="s1">&#39;&#39;</span> r
adduser r sudo
<span class="nb">echo</span> <span class="s1">&#39;%sudo ALL=(ALL) NOPASSWD:ALL&#39;</span> &gt;&gt; /etc/sudoers
su -m r -c /home/r/script.sh</code></pre></figure><p><code>script.sh</code> will be executed as a user <code>r</code> inside the container. And this <code>r</code> user will have <code>sudo</code> permissions. This is exactly what all projects, managing their DevOps procedures with <a href="http://www.rultor.com">rultor.com</a>, need.</p></div></article></div><div class="wrapper"> <related-posts /></div><div class="disqus" role="complementary"><p class="disqus_hint"> Please, use <a href="https://help.disqus.com/commenting/what-html-tags-are-allowed-within-comments">syntax highlighting</a> in your comments, to make them more readable.</p><div id="disqus_thread" class="disqus-thread"> <a>&nbsp;</a></div><script> var disqus_config = function () { this.page.url = document.location.href.split('?')[0].split('#')[0].replace('https://', 'http://'); this.page.identifier = this.page.url; }; (function() { var d = document, s = d.createElement('script'); s.src = '//yegor256.disqus.com/embed.js'; s.setAttribute('data-timestamp', +new Date()); (d.head || d.body).appendChild(s); })(); </script> <noscript><div><p class="red"> JavaScript is disabled in your browser, that's why you can't see comments under this post.</p></div></noscript></div><div class="wrapper"> <footer class="footer"><p> &copy; <span itemscope="" itemprop="copyrightHolder" itemtype="http://schema.org/Person"> <span itemprop="name">Yegor Bugayenko</span> </span> 2014&ndash;<span itemprop="copyrightYear">2018</span></p></footer></div></section><div class="wrapper unprintable" style="text-align:center;margin-top:2em;"> <a href="http://www.sixnines.io/h/3ba1652f"> <img src="//www.sixnines.io/b/3ba1652f?style=flat" alt="sixnines availability badge"/> </a></div><script src="//code.jquery.com/jquery-1.9.0.min.js"></script> <script src="/js/all.js?c998b88f617"></script> <script>var disqus_shortname = 'yegor256';</script> <script id="dsq-count-scr" src="//yegor256.disqus.com/count.js" async="async"></script> <script> (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){ (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o), m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m) })(window,document,'script','//www.google-analytics.com/analytics.js','ga'); ga('create', 'UA-1963507-32', 'auto'); ga('send', 'pageview'); </script> <script> Cd=document;Cr="&"+Math.random();Cp="&s=1"; Cd.cookie="b=b";if(Cd.cookie)Cp+="&c=1"; Cp+="&t="+(new Date()).getTimezoneOffset(); if(self!=top)Cp+="&f=1"; </script> <script> if(navigator.javaEnabled())Cp+="&j=1"; </script> <script> if(typeof(screen)!='undefined')Cp+="&w="+screen.width+"&h="+ screen.height+"&d="+(screen.colorDepth?screen.colorDepth:screen.pixelDepth); </script> <script> Cd.write("<img src='//c.hit.ua/hit?i=95870&g=0&x=2"+Cp+Cr+ "&r="+escape(Cd.referrer)+"&u="+escape(window.location.href)+ "' border='0' wi"+"dth='1' he"+"ight='1'/>"); </script> <script type="application/ld+json"> { "@context": "http://schema.org", "@type": "Person", "name": "Yegor Bugayenko", "url": "https://www.yegor256.com", "sameAs": [ "https://www.facebook.com/yegor256", "https://instagram.com/yegor256", "https://www.linkedin.com/in/yegor256", "https://twitter.com/yegor256", "https://github.com/yegor256", "https://www.pinterest.com/yegor256/" ] } </script> </body> </html> <!DOCTYPE html> <html xmlns="http://www.w3.org/1999/xhtml" lang="en-US" xml:lang="en-US" itemscope="" itemtype="http://schema.org/WebSite"> <head> <meta charset="utf-8"/> <meta name="description" content="&lt;figure class=&quot;badge&quot;&gt;&lt;a href=&quot;http://www.travis-ci.org&quot;&gt;&lt;img src=&quot;https://www.yegor256.com/images/2014/07/travis-logo.png&quot; style=&quot;width:100px;max-width:100%;&quot; alt=&quot;badge&quot; /&gt;&lt;/a&gt;&lt;/figure&gt; &lt;figure class=&quot;badge&quot;&gt;&lt;a href=&quot;http://www.rultor.com&quot;&gt;&lt;img src=&quot;http://doc.rultor.com/images/logo.svg&quot; style=&quot;width:100px;max-width:100%;&quot; alt=&quot;badge&quot; /&gt;&lt;/a&gt;&lt;/figure&gt; &lt;p&gt;&lt;a href=&quot;http://www.rultor.com&quot;&gt;Rultor&lt;/a&gt; is a coding team assistant. &lt;a href=&quot;http://travis-ci.org&quot;&gt;Travis&lt;/a&gt; is a hosted &lt;a href=&quot;/2014/10/08/continuous-integration-is-dead.html&quot;&gt;continuous integration&lt;/a&gt; system. In this article I’ll show how our open source projects are using them in tandem to achieve seamless continuous delivery.&lt;/p&gt; &lt;p&gt;I’ll show a few practical scenarios.&lt;/p&gt; &lt;!--more--&gt; &lt;h2 id=&quot;scenario-1-merge-pull-request&quot;&gt;Scenario #1: Merge Pull Request&lt;/h2&gt; &lt;p&gt;&lt;a href=&quot;https://github.com/jcabi/jcabi-mysql-maven-plugin&quot;&gt;&lt;code&gt;jcabi-mysql-maven-plugin&lt;/code&gt;&lt;/a&gt; is a Maven plugin for &lt;a href=&quot;/2014/05/21/mysql-maven-plugin.html&quot;&gt;MySQL integration testing&lt;/a&gt;. &lt;a href=&quot;https://github.com/ChristianRedl&quot;&gt;&lt;code&gt;@ChristianRedl&lt;/code&gt;&lt;/a&gt; submitted pull request &lt;a href=&quot;https://github.com/jcabi/jcabi-mysql-maven-plugin/pull/35&quot;&gt;#35&lt;/a&gt; with a new feature. I reviewed the request and asked Rultor to merge it into &lt;code&gt;master&lt;/code&gt;:&lt;/p&gt; &lt;figure class=&quot;unprintable&quot;&gt;&lt;img src=&quot;https://www.yegor256.com/images/2014/07/rultor-mysql-35.png&quot; itemprop=&quot;image&quot; style=&quot;width:600px;max-width:100%;&quot; alt=&quot;The figure&quot; /&gt;&lt;/figure&gt; &lt;p&gt;As you can see, an actual merge operation was made by Rultor. I gave him access to the project by adding his GitHub account to the list of project collaborators.&lt;/p&gt; &lt;p&gt;Before giving a “go ahead” to Rultor I checked the status of the pre-build reported by Travis:&lt;/p&gt; &lt;figure class=&quot;unprintable&quot;&gt;&lt;img src=&quot;https://www.yegor256.com/images/2014/07/rultor-mysql-35-2.png&quot; itemprop=&quot;image&quot; style=&quot;width:600px;max-width:100%;&quot; alt=&quot;The figure&quot; /&gt;&lt;/figure&gt; &lt;p&gt;Travis found a new commit in the pull request and immediately (without any interaction from my side) triggered a build in that branch. The build didn’t fail, that’s why Travis gave me a green sign. I looked at that sign and at the code. Since all problems in the code were corrected by the pull request author and Travis didn’t complain—I gave a “go” to Rultor.&lt;/p&gt; &lt;h2 id=&quot;scenario-2-continuous-integration&quot;&gt;Scenario #2: Continuous Integration&lt;/h2&gt; &lt;p&gt;Even though the previous step &lt;a href=&quot;/2014/07/21/read-only-master-branch.html&quot;&gt;guarantees&lt;/a&gt; that &lt;code&gt;master&lt;/code&gt; branch is always clean and stable, we’re using Travis to continuously integrate it. Every commit made to &lt;code&gt;master&lt;/code&gt; triggers a new build in Travis. The result of the build changes the status of the project in Travis: either “failing” or “passing.”&lt;/p&gt; &lt;p&gt;&lt;a href=&quot;http://aspects.jcabi.com&quot;&gt;&lt;code&gt;jcabi-aspects&lt;/code&gt;&lt;/a&gt; is a collection of &lt;a href=&quot;/2014/06/01/aop-aspectj-java-method-logging.html&quot;&gt;AOP AspectJ aspects&lt;/a&gt;. We configured Travis to build it continuously. This is the badge it produces (the left one):&lt;/p&gt; &lt;figure class=&quot;unprintable&quot;&gt;&lt;img src=&quot;https://www.yegor256.com/images/2014/07/rultor-aspects.png&quot; itemprop=&quot;image&quot; style=&quot;width:600px;max-width:100%;&quot; alt=&quot;The figure&quot; /&gt;&lt;/figure&gt; &lt;p&gt;Again, let me stress that even through &lt;a href=&quot;/2014/07/21/read-only-master-branch.html&quot;&gt;read-only master&lt;/a&gt; is a strong protection against broken builds, it doesn’t guarantee that at any moment master is stable. For example, sometimes unit tests fail sporadically due to changes in calendar, in environment, in dependencies, in network connection qualities, etc.&lt;/p&gt; &lt;p&gt;Well, ideally, unit tests should either fail or pass because they are environment independent. However, in reality, unit tests are far from being ideal.&lt;/p&gt; &lt;p&gt;That’s why a combination of &lt;a href=&quot;/2014/07/21/read-only-master-branch.html&quot;&gt;read-only master&lt;/a&gt; with Rultor and &lt;a href=&quot;/2014/10/08/continuous-integration-is-dead.html&quot;&gt;continuous integration&lt;/a&gt; with Travis gives us higher stability.&lt;/p&gt; &lt;h2 id=&quot;scenario-3-release-to-rubygems&quot;&gt;Scenario #3: Release to RubyGems&lt;/h2&gt; &lt;p&gt;&lt;a href=&quot;https://github.com/yegor256/jekyll-github-deploy&quot;&gt;&lt;code&gt;jekyll-github-deploy&lt;/code&gt;&lt;/a&gt; is a Ruby gem that &lt;a href=&quot;/2014/06/24/jekyll-github-deploy.html&quot;&gt;automates deployment of Jekyll sites to GitHub Pages&lt;/a&gt;. &lt;a href=&quot;https://github.com/leucos&quot;&gt;&lt;code&gt;@leucos&lt;/code&gt;&lt;/a&gt; submitted a pull request &lt;a href=&quot;https://github.com/yegor256/jekyll-github-deploy/pull/4&quot;&gt;#4&lt;/a&gt; with a new feature. The request was merged successfully into &lt;code&gt;master&lt;/code&gt; branch.&lt;/p&gt; &lt;p&gt;Then, Rultor was instructed by myself that &lt;code&gt;master&lt;/code&gt; branch should be released to RubyGems and a new version to set is 1.5:&lt;/p&gt; &lt;figure class=&quot;unprintable&quot;&gt;&lt;img src=&quot;https://www.yegor256.com/images/2014/07/rultor-jekyll-4.png&quot; itemprop=&quot;image&quot; style=&quot;width:600px;max-width:100%;&quot; alt=&quot;The figure&quot; /&gt;&lt;/figure&gt; &lt;p&gt;Rultor executed a simple script, &lt;a href=&quot;http://doc.rultor.com/basics.html#release&quot;&gt;pre-configured&lt;/a&gt; in its &lt;a href=&quot;https://github.com/yegor256/jekyll-github-deploy/blob/master/.rultor.yml&quot;&gt;&lt;code&gt;.rultor.yml&lt;/code&gt;&lt;/a&gt;:&lt;/p&gt; &lt;figure class=&quot;highlight&quot;&gt;&lt;pre&gt;&lt;code class=&quot;language-text&quot; data-lang=&quot;text&quot;&gt;&lt;span&gt;&lt;/span&gt;release: script: | ./test.sh rm -rf *.gem sed -i &amp;quot;s/2.0-SNAPSHOT/${tag}/g&amp;quot; jgd.gemspec gem build jgd.gemspec chmod 0600 ../rubygems.yml gem push *.gem --config-file ../rubygems.yml&lt;/code&gt;&lt;/pre&gt;&lt;/figure&gt; &lt;p&gt;The script is parameterized, as you see. There is one parameter that is passed by Rultor into the script: &lt;code&gt;${tag}&lt;/code&gt;. This parameter was provided by myself in the GitHub issue, when I submitted a command to Rultor.&lt;/p&gt; &lt;p&gt;The script tests that the gem works (integration testing) and clean up afterwords:&lt;/p&gt; &lt;figure class=&quot;highlight&quot;&gt;&lt;pre&gt;&lt;code class=&quot;language-bash&quot; data-lang=&quot;bash&quot;&gt;&lt;span&gt;&lt;/span&gt;$ ./test.sh $ rm -rf *.gem&lt;/code&gt;&lt;/pre&gt;&lt;/figure&gt; &lt;p&gt;Then, it changes the version of itself in &lt;code&gt;jgd.gemspec&lt;/code&gt; to the one provided in the &lt;code&gt;${tag}&lt;/code&gt; (it is an environment variable), and builds a new &lt;code&gt;.gem&lt;/code&gt;:&lt;/p&gt; &lt;figure class=&quot;highlight&quot;&gt;&lt;pre&gt;&lt;code class=&quot;language-bash&quot; data-lang=&quot;bash&quot;&gt;&lt;span&gt;&lt;/span&gt;$ sed -i &lt;span class=&quot;s2&quot;&gt;&amp;quot;s/2.0-SNAPSHOT/&lt;/span&gt;&lt;span class=&quot;si&quot;&gt;${&lt;/span&gt;&lt;span class=&quot;nv&quot;&gt;tag&lt;/span&gt;&lt;span class=&quot;si&quot;&gt;}&lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;/g&amp;quot;&lt;/span&gt; jgd.gemspec $ gem build jgd.gemspec&lt;/code&gt;&lt;/pre&gt;&lt;/figure&gt; &lt;p&gt;Finally, it pushes a newly built &lt;code&gt;.gem&lt;/code&gt; to &lt;a href=&quot;/2014/08/26/publish-to-rubygems.html&quot;&gt;RubyGems&lt;/a&gt;, using login credentials from &lt;code&gt;../rubygems.yml&lt;/code&gt;. This file is created by Rultor right before starting the script (this mechanism is discussed below):&lt;/p&gt; &lt;figure class=&quot;highlight&quot;&gt;&lt;pre&gt;&lt;code class=&quot;language-bash&quot; data-lang=&quot;bash&quot;&gt;&lt;span&gt;&lt;/span&gt;$ chmod &lt;span class=&quot;m&quot;&gt;0600&lt;/span&gt; ../rubygems.yml $ gem push *.gem --config-file ../rubygems.yml&lt;/code&gt;&lt;/pre&gt;&lt;/figure&gt; &lt;p&gt;If everything works fine and RubyGems confirms successful deployment, Rultor reports to GitHub. This is exactly what happened in &lt;a href=&quot;https://github.com/yegor256/jekyll-github-deploy/pull/4&quot;&gt;pull request #4&lt;/a&gt;.&lt;/p&gt; &lt;h2 id=&quot;scenario-4-deploy-to-cloudbees&quot;&gt;Scenario #4: Deploy to CloudBees&lt;/h2&gt; &lt;p&gt;&lt;a href=&quot;http://www.s3auth.com&quot;&gt;s3auth.com&lt;/a&gt; is a &lt;a href=&quot;/2014/04/21/s3-http-basic-auth.html&quot;&gt;Basic HTTP authentication gateway for Amazon S3 Buckets&lt;/a&gt;. It is a Java web app. In its pull request &lt;a href=&quot;https://github.com/yegor256/s3auth/pull/195&quot;&gt;#195&lt;/a&gt;, a resource leakage problem was fixed by &lt;a href=&quot;https://github.com/carlosmiranda&quot;&gt;&lt;code&gt;@carlosmiranda&lt;/code&gt;&lt;/a&gt; and the pull request was merged by Rultor.&lt;/p&gt; &lt;p&gt;Then, &lt;a href=&quot;https://github.com/davvd&quot;&gt;&lt;code&gt;@davvd&lt;/code&gt;&lt;/a&gt; instructed Rultor to deploy &lt;code&gt;master&lt;/code&gt; branch to production environment. Rultor created &lt;a href=&quot;/2014/07/29/docker-in-rultor.html&quot;&gt;a new Docker container&lt;/a&gt; and ran &lt;code&gt;mvn clean deploy&lt;/code&gt; in it.&lt;/p&gt; &lt;p&gt;Maven deployed the application to &lt;a href=&quot;http://www.cloudbees.com&quot;&gt;CloudBees&lt;/a&gt;:&lt;/p&gt; &lt;figure class=&quot;unprintable&quot;&gt;&lt;img src=&quot;https://www.yegor256.com/images/2014/07/rultor-s3auth-195.png&quot; itemprop=&quot;image&quot; style=&quot;width:600px;max-width:100%;&quot; alt=&quot;The figure&quot; /&gt;&lt;/figure&gt; &lt;p&gt;The overall procedure took 21 minutes, as you see the in the report generated by Rultor.&lt;/p&gt; &lt;p&gt;There is one important trick worth mentioning. Deployment to production always means using secure credentials, like login, password, SSH keys, etc.&lt;/p&gt; &lt;p&gt;In this particular example, &lt;a href=&quot;https://wiki.cloudbees.com/bin/view/RUN/MavenGuide&quot;&gt;Maven CloudBees Plugin&lt;/a&gt; needed API key, secret and web application name. These three parameters are kept secure and can’t be revealed in an “&lt;a href=&quot;/2015/12/22/why-dont-you-contribute-to-open-source.html&quot;&gt;open source&lt;/a&gt;” way.&lt;/p&gt; &lt;p&gt;So, there is &lt;a href=&quot;http://doc.rultor.com/reference.html#assets&quot;&gt;a mechanism&lt;/a&gt; that configures Rultor accordingly through its &lt;a href=&quot;https://github.com/yegor256/s3auth/blob/master/.rultor.yml&quot;&gt;&lt;code&gt;.rultor.yml&lt;/code&gt;&lt;/a&gt; file (pay attention to the first few lines):&lt;/p&gt; &lt;figure class=&quot;highlight&quot;&gt;&lt;pre&gt;&lt;code class=&quot;language-text&quot; data-lang=&quot;text&quot;&gt;&lt;span&gt;&lt;/span&gt;assets: settings.xml: &amp;quot;yegor256/home#assets/s3auth/settings.xml&amp;quot; pubring.gpg: &amp;quot;yegor256/home#assets/pubring.gpg&amp;quot; secring.gpg: &amp;quot;yegor256/home#assets/secring.gpg&amp;quot;&lt;/code&gt;&lt;/pre&gt;&lt;/figure&gt; &lt;p&gt;These YAML entries inform Rultor that it has to get &lt;code&gt;assets/s3auth/settings.xml&lt;/code&gt; file from &lt;code&gt;yegor256/home&lt;/code&gt; private (!) GitHub repository and put it into the working directory of Docker container, right before starting the Maven build.&lt;/p&gt; &lt;p&gt;This &lt;code&gt;settings.xml&lt;/code&gt; file contains that secret data CloudBees plugin needs in order to deploy the application.&lt;/p&gt; &lt;p&gt;&lt;a href=&quot;/2014/08/25/deploy-to-cloudbees.html&quot;&gt;How to Deploy to CloudBees, in One Click&lt;/a&gt; explains this process even better.&lt;/p&gt; &lt;h2 id=&quot;you-can-do-the-same&quot;&gt;You Can Do The Same&lt;/h2&gt; &lt;p&gt;Both Rultor and Travis are free hosted products, provided your projects are open source and hosted at GitHub.&lt;/p&gt; &lt;p&gt;Other good examples of Rultor+Travis usage can be seen in these GitHub issues: &lt;a href=&quot;https://github.com/jcabi/jcabi-http/issues/47&quot;&gt;&lt;code&gt;jcabi/jcabi-http#47&lt;/code&gt;&lt;/a&gt;, &lt;a href=&quot;https://github.com/jcabi/jcabi-http/pull/48&quot;&gt;&lt;code&gt;jcabi/jcabi-http#48&lt;/code&gt;&lt;/a&gt;&lt;/p&gt; &lt;p&gt;PS. You can do something similar with AppVeyor, for Windows platform: &lt;a href=&quot;/2015/03/29/rultor-with-appveyor.html&quot;&gt;How AppVeyor Helps Me to Validate Pull Requests Before Rultor Merges Them&lt;/a&gt;&lt;/p&gt; " /> <meta name="keywords" content="next, path, output, content, previous, url, relative_path, id, collection, excerpt, draft, categories, layout, title, date, tags, description, keywords, slug, ext" /> <meta name="viewport" content="width=device-width,minimum-scale=1,initial-scale=1"/> <meta name="google-site-verification" content="JEj_gQr2CPe2QKGw8XdMz0R7VboQIUbX3FlM-lwTq-8" /> <meta name="author" content="Yegor Bugayenko"> <meta name="article:published_time" content="2014-07-31 00:00:00 +0000"> <meta name="og:site_name" content="Yegor Bugayenko"/> <meta name="og:type" content="article" /> <meta name="og:locale" content="en_US" /> <meta name="twitter:account_id" content="4503599630178231" /> <meta name="twitter:creator" content="@yegor256"/> <meta name="twitter:site" content="@yegor256"/> <meta name="twitter:title" property="og:title" content="Rultor + Travis"/> <meta name="twitter:description" property="og:description" content="&lt;figure class=&quot;badge&quot;&gt;&lt;a href=&quot;http://www.travis-ci.org&quot;&gt;&lt;img src=&quot;https://www.yegor256.com/images/2014/07/travis-logo.png&quot; style=&quot;width:100px;max-width:100%;&quot; alt=&quot;badge&quot; /&gt;&lt;/a&gt;&lt;/figure&gt; &lt;figure class=&quot;badge&quot;&gt;&lt;a href=&quot;http://www.rultor.com&quot;&gt;&lt;img src=&quot;http://doc.rultor.com/images/logo.svg&quot; style=&quot;width:100px;max-width:100%;&quot; alt=&quot;badge&quot; /&gt;&lt;/a&gt;&lt;/figure&gt; &lt;p&gt;&lt;a href=&quot;http://www.rultor.com&quot;&gt;Rultor&lt;/a&gt; is a coding team assistant. &lt;a href=&quot;http://travis-ci.org&quot;&gt;Travis&lt;/a&gt; is a hosted &lt;a href=&quot;/2014/10/08/continuous-integration-is-dead.html&quot;&gt;continuous integration&lt;/a&gt; system. In this article I’ll show how our open source projects are using them in tandem to achieve seamless continuous delivery.&lt;/p&gt; &lt;p&gt;I’ll show a few practical scenarios.&lt;/p&gt; &lt;!--more--&gt; &lt;h2 id=&quot;scenario-1-merge-pull-request&quot;&gt;Scenario #1: Merge Pull Request&lt;/h2&gt; &lt;p&gt;&lt;a href=&quot;https://github.com/jcabi/jcabi-mysql-maven-plugin&quot;&gt;&lt;code&gt;jcabi-mysql-maven-plugin&lt;/code&gt;&lt;/a&gt; is a Maven plugin for &lt;a href=&quot;/2014/05/21/mysql-maven-plugin.html&quot;&gt;MySQL integration testing&lt;/a&gt;. &lt;a href=&quot;https://github.com/ChristianRedl&quot;&gt;&lt;code&gt;@ChristianRedl&lt;/code&gt;&lt;/a&gt; submitted pull request &lt;a href=&quot;https://github.com/jcabi/jcabi-mysql-maven-plugin/pull/35&quot;&gt;#35&lt;/a&gt; with a new feature. I reviewed the request and asked Rultor to merge it into &lt;code&gt;master&lt;/code&gt;:&lt;/p&gt; &lt;figure class=&quot;unprintable&quot;&gt;&lt;img src=&quot;https://www.yegor256.com/images/2014/07/rultor-mysql-35.png&quot; itemprop=&quot;image&quot; style=&quot;width:600px;max-width:100%;&quot; alt=&quot;The figure&quot; /&gt;&lt;/figure&gt; &lt;p&gt;As you can see, an actual merge operation was made by Rultor. I gave him access to the project by adding his GitHub account to the list of project collaborators.&lt;/p&gt; &lt;p&gt;Before giving a “go ahead” to Rultor I checked the status of the pre-build reported by Travis:&lt;/p&gt; &lt;figure class=&quot;unprintable&quot;&gt;&lt;img src=&quot;https://www.yegor256.com/images/2014/07/rultor-mysql-35-2.png&quot; itemprop=&quot;image&quot; style=&quot;width:600px;max-width:100%;&quot; alt=&quot;The figure&quot; /&gt;&lt;/figure&gt; &lt;p&gt;Travis found a new commit in the pull request and immediately (without any interaction from my side) triggered a build in that branch. The build didn’t fail, that’s why Travis gave me a green sign. I looked at that sign and at the code. Since all problems in the code were corrected by the pull request author and Travis didn’t complain—I gave a “go” to Rultor.&lt;/p&gt; &lt;h2 id=&quot;scenario-2-continuous-integration&quot;&gt;Scenario #2: Continuous Integration&lt;/h2&gt; &lt;p&gt;Even though the previous step &lt;a href=&quot;/2014/07/21/read-only-master-branch.html&quot;&gt;guarantees&lt;/a&gt; that &lt;code&gt;master&lt;/code&gt; branch is always clean and stable, we’re using Travis to continuously integrate it. Every commit made to &lt;code&gt;master&lt;/code&gt; triggers a new build in Travis. The result of the build changes the status of the project in Travis: either “failing” or “passing.”&lt;/p&gt; &lt;p&gt;&lt;a href=&quot;http://aspects.jcabi.com&quot;&gt;&lt;code&gt;jcabi-aspects&lt;/code&gt;&lt;/a&gt; is a collection of &lt;a href=&quot;/2014/06/01/aop-aspectj-java-method-logging.html&quot;&gt;AOP AspectJ aspects&lt;/a&gt;. We configured Travis to build it continuously. This is the badge it produces (the left one):&lt;/p&gt; &lt;figure class=&quot;unprintable&quot;&gt;&lt;img src=&quot;https://www.yegor256.com/images/2014/07/rultor-aspects.png&quot; itemprop=&quot;image&quot; style=&quot;width:600px;max-width:100%;&quot; alt=&quot;The figure&quot; /&gt;&lt;/figure&gt; &lt;p&gt;Again, let me stress that even through &lt;a href=&quot;/2014/07/21/read-only-master-branch.html&quot;&gt;read-only master&lt;/a&gt; is a strong protection against broken builds, it doesn’t guarantee that at any moment master is stable. For example, sometimes unit tests fail sporadically due to changes in calendar, in environment, in dependencies, in network connection qualities, etc.&lt;/p&gt; &lt;p&gt;Well, ideally, unit tests should either fail or pass because they are environment independent. However, in reality, unit tests are far from being ideal.&lt;/p&gt; &lt;p&gt;That’s why a combination of &lt;a href=&quot;/2014/07/21/read-only-master-branch.html&quot;&gt;read-only master&lt;/a&gt; with Rultor and &lt;a href=&quot;/2014/10/08/continuous-integration-is-dead.html&quot;&gt;continuous integration&lt;/a&gt; with Travis gives us higher stability.&lt;/p&gt; &lt;h2 id=&quot;scenario-3-release-to-rubygems&quot;&gt;Scenario #3: Release to RubyGems&lt;/h2&gt; &lt;p&gt;&lt;a href=&quot;https://github.com/yegor256/jekyll-github-deploy&quot;&gt;&lt;code&gt;jekyll-github-deploy&lt;/code&gt;&lt;/a&gt; is a Ruby gem that &lt;a href=&quot;/2014/06/24/jekyll-github-deploy.html&quot;&gt;automates deployment of Jekyll sites to GitHub Pages&lt;/a&gt;. &lt;a href=&quot;https://github.com/leucos&quot;&gt;&lt;code&gt;@leucos&lt;/code&gt;&lt;/a&gt; submitted a pull request &lt;a href=&quot;https://github.com/yegor256/jekyll-github-deploy/pull/4&quot;&gt;#4&lt;/a&gt; with a new feature. The request was merged successfully into &lt;code&gt;master&lt;/code&gt; branch.&lt;/p&gt; &lt;p&gt;Then, Rultor was instructed by myself that &lt;code&gt;master&lt;/code&gt; branch should be released to RubyGems and a new version to set is 1.5:&lt;/p&gt; &lt;figure class=&quot;unprintable&quot;&gt;&lt;img src=&quot;https://www.yegor256.com/images/2014/07/rultor-jekyll-4.png&quot; itemprop=&quot;image&quot; style=&quot;width:600px;max-width:100%;&quot; alt=&quot;The figure&quot; /&gt;&lt;/figure&gt; &lt;p&gt;Rultor executed a simple script, &lt;a href=&quot;http://doc.rultor.com/basics.html#release&quot;&gt;pre-configured&lt;/a&gt; in its &lt;a href=&quot;https://github.com/yegor256/jekyll-github-deploy/blob/master/.rultor.yml&quot;&gt;&lt;code&gt;.rultor.yml&lt;/code&gt;&lt;/a&gt;:&lt;/p&gt; &lt;figure class=&quot;highlight&quot;&gt;&lt;pre&gt;&lt;code class=&quot;language-text&quot; data-lang=&quot;text&quot;&gt;&lt;span&gt;&lt;/span&gt;release: script: | ./test.sh rm -rf *.gem sed -i &amp;quot;s/2.0-SNAPSHOT/${tag}/g&amp;quot; jgd.gemspec gem build jgd.gemspec chmod 0600 ../rubygems.yml gem push *.gem --config-file ../rubygems.yml&lt;/code&gt;&lt;/pre&gt;&lt;/figure&gt; &lt;p&gt;The script is parameterized, as you see. There is one parameter that is passed by Rultor into the script: &lt;code&gt;${tag}&lt;/code&gt;. This parameter was provided by myself in the GitHub issue, when I submitted a command to Rultor.&lt;/p&gt; &lt;p&gt;The script tests that the gem works (integration testing) and clean up afterwords:&lt;/p&gt; &lt;figure class=&quot;highlight&quot;&gt;&lt;pre&gt;&lt;code class=&quot;language-bash&quot; data-lang=&quot;bash&quot;&gt;&lt;span&gt;&lt;/span&gt;$ ./test.sh $ rm -rf *.gem&lt;/code&gt;&lt;/pre&gt;&lt;/figure&gt; &lt;p&gt;Then, it changes the version of itself in &lt;code&gt;jgd.gemspec&lt;/code&gt; to the one provided in the &lt;code&gt;${tag}&lt;/code&gt; (it is an environment variable), and builds a new &lt;code&gt;.gem&lt;/code&gt;:&lt;/p&gt; &lt;figure class=&quot;highlight&quot;&gt;&lt;pre&gt;&lt;code class=&quot;language-bash&quot; data-lang=&quot;bash&quot;&gt;&lt;span&gt;&lt;/span&gt;$ sed -i &lt;span class=&quot;s2&quot;&gt;&amp;quot;s/2.0-SNAPSHOT/&lt;/span&gt;&lt;span class=&quot;si&quot;&gt;${&lt;/span&gt;&lt;span class=&quot;nv&quot;&gt;tag&lt;/span&gt;&lt;span class=&quot;si&quot;&gt;}&lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;/g&amp;quot;&lt;/span&gt; jgd.gemspec $ gem build jgd.gemspec&lt;/code&gt;&lt;/pre&gt;&lt;/figure&gt; &lt;p&gt;Finally, it pushes a newly built &lt;code&gt;.gem&lt;/code&gt; to &lt;a href=&quot;/2014/08/26/publish-to-rubygems.html&quot;&gt;RubyGems&lt;/a&gt;, using login credentials from &lt;code&gt;../rubygems.yml&lt;/code&gt;. This file is created by Rultor right before starting the script (this mechanism is discussed below):&lt;/p&gt; &lt;figure class=&quot;highlight&quot;&gt;&lt;pre&gt;&lt;code class=&quot;language-bash&quot; data-lang=&quot;bash&quot;&gt;&lt;span&gt;&lt;/span&gt;$ chmod &lt;span class=&quot;m&quot;&gt;0600&lt;/span&gt; ../rubygems.yml $ gem push *.gem --config-file ../rubygems.yml&lt;/code&gt;&lt;/pre&gt;&lt;/figure&gt; &lt;p&gt;If everything works fine and RubyGems confirms successful deployment, Rultor reports to GitHub. This is exactly what happened in &lt;a href=&quot;https://github.com/yegor256/jekyll-github-deploy/pull/4&quot;&gt;pull request #4&lt;/a&gt;.&lt;/p&gt; &lt;h2 id=&quot;scenario-4-deploy-to-cloudbees&quot;&gt;Scenario #4: Deploy to CloudBees&lt;/h2&gt; &lt;p&gt;&lt;a href=&quot;http://www.s3auth.com&quot;&gt;s3auth.com&lt;/a&gt; is a &lt;a href=&quot;/2014/04/21/s3-http-basic-auth.html&quot;&gt;Basic HTTP authentication gateway for Amazon S3 Buckets&lt;/a&gt;. It is a Java web app. In its pull request &lt;a href=&quot;https://github.com/yegor256/s3auth/pull/195&quot;&gt;#195&lt;/a&gt;, a resource leakage problem was fixed by &lt;a href=&quot;https://github.com/carlosmiranda&quot;&gt;&lt;code&gt;@carlosmiranda&lt;/code&gt;&lt;/a&gt; and the pull request was merged by Rultor.&lt;/p&gt; &lt;p&gt;Then, &lt;a href=&quot;https://github.com/davvd&quot;&gt;&lt;code&gt;@davvd&lt;/code&gt;&lt;/a&gt; instructed Rultor to deploy &lt;code&gt;master&lt;/code&gt; branch to production environment. Rultor created &lt;a href=&quot;/2014/07/29/docker-in-rultor.html&quot;&gt;a new Docker container&lt;/a&gt; and ran &lt;code&gt;mvn clean deploy&lt;/code&gt; in it.&lt;/p&gt; &lt;p&gt;Maven deployed the application to &lt;a href=&quot;http://www.cloudbees.com&quot;&gt;CloudBees&lt;/a&gt;:&lt;/p&gt; &lt;figure class=&quot;unprintable&quot;&gt;&lt;img src=&quot;https://www.yegor256.com/images/2014/07/rultor-s3auth-195.png&quot; itemprop=&quot;image&quot; style=&quot;width:600px;max-width:100%;&quot; alt=&quot;The figure&quot; /&gt;&lt;/figure&gt; &lt;p&gt;The overall procedure took 21 minutes, as you see the in the report generated by Rultor.&lt;/p&gt; &lt;p&gt;There is one important trick worth mentioning. Deployment to production always means using secure credentials, like login, password, SSH keys, etc.&lt;/p&gt; &lt;p&gt;In this particular example, &lt;a href=&quot;https://wiki.cloudbees.com/bin/view/RUN/MavenGuide&quot;&gt;Maven CloudBees Plugin&lt;/a&gt; needed API key, secret and web application name. These three parameters are kept secure and can’t be revealed in an “&lt;a href=&quot;/2015/12/22/why-dont-you-contribute-to-open-source.html&quot;&gt;open source&lt;/a&gt;” way.&lt;/p&gt; &lt;p&gt;So, there is &lt;a href=&quot;http://doc.rultor.com/reference.html#assets&quot;&gt;a mechanism&lt;/a&gt; that configures Rultor accordingly through its &lt;a href=&quot;https://github.com/yegor256/s3auth/blob/master/.rultor.yml&quot;&gt;&lt;code&gt;.rultor.yml&lt;/code&gt;&lt;/a&gt; file (pay attention to the first few lines):&lt;/p&gt; &lt;figure class=&quot;highlight&quot;&gt;&lt;pre&gt;&lt;code class=&quot;language-text&quot; data-lang=&quot;text&quot;&gt;&lt;span&gt;&lt;/span&gt;assets: settings.xml: &amp;quot;yegor256/home#assets/s3auth/settings.xml&amp;quot; pubring.gpg: &amp;quot;yegor256/home#assets/pubring.gpg&amp;quot; secring.gpg: &amp;quot;yegor256/home#assets/secring.gpg&amp;quot;&lt;/code&gt;&lt;/pre&gt;&lt;/figure&gt; &lt;p&gt;These YAML entries inform Rultor that it has to get &lt;code&gt;assets/s3auth/settings.xml&lt;/code&gt; file from &lt;code&gt;yegor256/home&lt;/code&gt; private (!) GitHub repository and put it into the working directory of Docker container, right before starting the Maven build.&lt;/p&gt; &lt;p&gt;This &lt;code&gt;settings.xml&lt;/code&gt; file contains that secret data CloudBees plugin needs in order to deploy the application.&lt;/p&gt; &lt;p&gt;&lt;a href=&quot;/2014/08/25/deploy-to-cloudbees.html&quot;&gt;How to Deploy to CloudBees, in One Click&lt;/a&gt; explains this process even better.&lt;/p&gt; &lt;h2 id=&quot;you-can-do-the-same&quot;&gt;You Can Do The Same&lt;/h2&gt; &lt;p&gt;Both Rultor and Travis are free hosted products, provided your projects are open source and hosted at GitHub.&lt;/p&gt; &lt;p&gt;Other good examples of Rultor+Travis usage can be seen in these GitHub issues: &lt;a href=&quot;https://github.com/jcabi/jcabi-http/issues/47&quot;&gt;&lt;code&gt;jcabi/jcabi-http#47&lt;/code&gt;&lt;/a&gt;, &lt;a href=&quot;https://github.com/jcabi/jcabi-http/pull/48&quot;&gt;&lt;code&gt;jcabi/jcabi-http#48&lt;/code&gt;&lt;/a&gt;&lt;/p&gt; &lt;p&gt;PS. You can do something similar with AppVeyor, for Windows platform: &lt;a href=&quot;/2015/03/29/rultor-with-appveyor.html&quot;&gt;How AppVeyor Helps Me to Validate Pull Requests Before Rultor Merges Them&lt;/a&gt;&lt;/p&gt; "/> <meta name="twitter:url" property="og:url" content="https://www.yegor256.com/2014/07/31/travis-and-rultor.html"/> <meta name="telegram:channel" content="AAAAAEJFMRzsRTRxM3ec6A"/> <link rel="search" type="application/opensearchdescription+xml" href="/opensearch.xml" title="yegor256" /> <link rel="shortcut icon" href="/favicon.ico?c998b88f617"/> <link rel="apple-touch-icon" href="/favicon.ico?c998b88f617"/> <link rel="alternate" type="application/rss+xml" title="RSS for yegor256.com" href="https://www.yegor256.com/rss.xml"/> <link rel="stylesheet" href="/css/layout.css?c998b88f617"/> <link rel="stylesheet" href="/css/icons.css?c998b88f617"/> <link rel="canonical" href="https://www.yegor256.com/2014/07/31/travis-and-rultor.html" /> <link rel="amphtml" href="https://www.yegor256.com/2014/07/31/travis-and-rultor.amp.html" /> <title>Rultor + Travis </title> </head> <body><div class="wrapper"> <aside class="header-toggle unprintable" id="header-toggle" title="Show the menu" onclick="$('#header').show();$('#header-toggle').hide();">&#9776;</aside> <header class="header" id="header"><div class="face"> <a href="/about-me.html#form" class="sub" title="Click to subscribe to my monthly newsletter"><span>Subscribe</span></a> <a href="/about-me.html" style="position:relative;"> <img src="/images/face-256x256.jpg" class="photo" alt="Yegor Bugayenko"/> </a></div><nav><ul class="menu social notranslate"> <li><a href="https://twitter.com/intent/follow?screen_name=yegor256" rel="nofollow" title="Follow me on Twitter"><i class="icon icon-twitter notranslate" aria-hidden="true"></i></a></li> <li><a href="/rss.xml" rel="nofollow" title="Subscribe to my RSS feed"><i class="icon icon-rss notranslate" aria-hidden="true"></i></a></li> <li><a itemprop="sameAs" href="https://github.com/yegor256" rel="nofollow" title="My GitHub profile"><i class="icon icon-github notranslate" aria-hidden="true"></i></a></li> <li><a itemprop="sameAs" href="http://stackoverflow.com/users/187141/yegor256" rel="nofollow" title="My StackOverflow profile"><i class="icon icon-stackoverflow notranslate" aria-hidden="true"></i></a></li> <li><a itemprop="sameAs" href="https://www.facebook.com/yegor256" rel="nofollow" title="Follow me on Facebook"><i class="icon icon-facebook notranslate" aria-hidden="true"></i></a></li> <li><a itemprop="sameAs" href="https://instagram.com/yegor256" rel="nofollow" title="Follow me on Instagram"><i class="icon icon-instagram notranslate" aria-hidden="true"></i></a></li> <li><a itemprop="sameAs" href="https://www.linkedin.com/in/yegor256" rel="nofollow" title="My LinkedIn profile"><i class="icon icon-linkedin notranslate" aria-hidden="true"></i></a></li> <li><a itemprop="sameAs" href="https://www.youtube.com/c/yegor256?sub_confirmation=1" rel="nofollow" title="My Youtube video channel"><i class="icon icon-youtube notranslate" aria-hidden="true"></i></a></li> <li><a itemprop="sameAs" href="https://www.pinterest.com/yegor256/" rel="nofollow" title="My Pinterest boards"><i class="icon icon-pinterest notranslate" aria-hidden="true"></i></a></li> <li><a itemprop="sameAs" href="https://angel.co/yegor256" rel="nofollow" title="My AngelList profile"><i class="icon icon-angellist notranslate" aria-hidden="true"></i></a></li> <li><a href="https://soundcloud.com/yegor256" rel="nofollow" title="My podcast"><i class="icon icon-podcast notranslate" aria-hidden="true"></i></a></li> <li><a href="https://itunes.apple.com/us/podcast/yegor256-podcast/id1150826721" rel="nofollow" title="My iTunes podcast"><i class="icon icon-itunes notranslate" aria-hidden="true"></i></a></li> <li><a href="https://t.me/yegor256news" rel="nofollow" title="My Telegram public channel"><i class="icon icon-telegram notranslate" aria-hidden="true"></i></a></li> <li><a href="mailto:blog@yegor256.com" rel="nofollow" title="Email me any time"><i class="icon icon-mail notranslate" aria-hidden="true"></i></a></li></ul><ul class="menu"> <li><a href="/" title="Home page">Home</a></li> <li /2014/07/31/travis-and-rultor.html><a href="/best.html" title="Best articles to read">12&#160;Best</a></li> <li /2014/07/31/travis-and-rultor.html><a href="/contents.html" title="The contents of the entire blog">All&#160;292</a></li> <li /2014/07/31/travis-and-rultor.html><a href="/webinars.html" title="My webinars">Webinars</a></li> <li /2014/07/31/travis-and-rultor.html><a href="/talks.html" title="Future and past conference talks">Talks</a></li> <li /2014/07/31/travis-and-rultor.html><a href="/books.html" title="The books I wrote">Books</a></li> <li /2014/07/31/travis-and-rultor.html><a href="/papers.html" title="My academic papers and patents">Papers</a></li> <li /2014/07/31/travis-and-rultor.html><a href="/pets.html" title="My loved pet projects">Pets</a></li> <li /2014/07/31/travis-and-rultor.html class="highlighted"><a href="/trainings.html" title="On-site trainings">Trainings</a></li> <li /2014/07/31/travis-and-rultor.html><a href="/award.html" title="Software quality award">Award</a></li> <li /2014/07/31/travis-and-rultor.html><a href="/testimonials.html" title="What some people say about me">Testimonials</a></li> <li /2014/07/31/travis-and-rultor.html><a href="/shift-m.html" title="Audio podcast about project management">Shift-M</a></li> <li /2014/07/31/travis-and-rultor.html><a href="/paintings.html" title="My paintings for sale">Paintings</a></li> <li><a href="https://ru.yegor256.com/" title="Немного на русском языке">По-русски</a></li></ul></nav><div class="search"> <form method="get" action="https://www.google.com/search" itemprop="potentialAction" itemscope="" itemtype="http://schema.org/SearchAction"> <meta itemprop="target" content="https://www.google.com/search?q={q}"/> <input name="sitesearch" value="yegor256.com" type="hidden"/> <input itemprop="query-input" type="text" id="search-query" class="field field-text" required="required" onfocus="$('.google').css('visibility', 'visible');" name="q" placeholder="Search..." autocomplete="off"/> <input type="image" src="/images/google-search-icon.svg" class="google" title="Search via Google" alt="Search via Google"/> </form></div><div class="hot"><ul></ul></div></header></div><section itemscope="" itemtype="http://schema.org/BlogPosting"><div class="wrapper"> <header><p class="printable"> <img src="https://api.qrserver.com/v1/create-qr-code/?data=https://www.yegor256.com/2014/07/31/travis-and-rultor.html&amp;format=svg" style="width:125px;height:125px;" alt="QR code"/></p><p class="printable"> <code itemprop="url">https://www.yegor256.com/2014/07/31/travis-and-rultor.html</code></p><h1 itemprop="name headline mainEntityOfPage">Rultor + Travis</h1><ul class="subline"> <li> <time itemprop="datePublished" datetime="2014-07-31T00:00:00+00:00"> 31 July 2014 </time> </li> <li class="printable" itemscope="" itemprop="author" itemtype="http://schema.org/Person"> <span itemprop="name">Yegor Bugayenko</span> </li> <li class="unprintable"> <i class="icon icon-comments"></i> <a href="https://www.yegor256.com/2014/07/31/travis-and-rultor.html#disqus_thread" itemprop="discussionUrl">comments</a> </li></ul><p class="unprintable"><figure class="badge"><a href="http://www.travis-ci.org"><img src="https://www.yegor256.com/images/2014/07/travis-logo.png" style="width:100px;max-width:100%;" alt="badge" /></a></figure> <figure class="badge"><a href="http://www.rultor.com"><img src="http://doc.rultor.com/images/logo.svg" style="width:100px;max-width:100%;" alt="badge" /></a></figure><p><a href="http://www.rultor.com">Rultor</a> is a coding team assistant. <a href="http://travis-ci.org">Travis</a> is a hosted <a href="/2014/10/08/continuous-integration-is-dead.html">continuous integration</a> system. In this article I’ll show how our open source projects are using them in tandem to achieve seamless continuous delivery.</p><p>I’ll show a few practical scenarios.</p><h2 id="scenario-1-merge-pull-request">Scenario #1: Merge Pull Request</h2><p><a href="https://github.com/jcabi/jcabi-mysql-maven-plugin"><code>jcabi-mysql-maven-plugin</code></a> is a Maven plugin for <a href="/2014/05/21/mysql-maven-plugin.html">MySQL integration testing</a>. <a href="https://github.com/ChristianRedl"><code>@ChristianRedl</code></a> submitted pull request <a href="https://github.com/jcabi/jcabi-mysql-maven-plugin/pull/35">#35</a> with a new feature. I reviewed the request and asked Rultor to merge it into <code>master</code>:</p><figure class="unprintable"><img src="https://www.yegor256.com/images/2014/07/rultor-mysql-35.png" itemprop="image" style="width:600px;max-width:100%;" alt="The figure" /></figure><p>As you can see, an actual merge operation was made by Rultor. I gave him access to the project by adding his GitHub account to the list of project collaborators.</p><p>Before giving a “go ahead” to Rultor I checked the status of the pre-build reported by Travis:</p><figure class="unprintable"><img src="https://www.yegor256.com/images/2014/07/rultor-mysql-35-2.png" itemprop="image" style="width:600px;max-width:100%;" alt="The figure" /></figure><p>Travis found a new commit in the pull request and immediately (without any interaction from my side) triggered a build in that branch. The build didn’t fail, that’s why Travis gave me a green sign. I looked at that sign and at the code. Since all problems in the code were corrected by the pull request author and Travis didn’t complain—I gave a “go” to Rultor.</p><h2 id="scenario-2-continuous-integration">Scenario #2: Continuous Integration</h2><p>Even though the previous step <a href="/2014/07/21/read-only-master-branch.html">guarantees</a> that <code>master</code> branch is always clean and stable, we’re using Travis to continuously integrate it. Every commit made to <code>master</code> triggers a new build in Travis. The result of the build changes the status of the project in Travis: either “failing” or “passing.”</p><p><a href="http://aspects.jcabi.com"><code>jcabi-aspects</code></a> is a collection of <a href="/2014/06/01/aop-aspectj-java-method-logging.html">AOP AspectJ aspects</a>. We configured Travis to build it continuously. This is the badge it produces (the left one):</p><figure class="unprintable"><img src="https://www.yegor256.com/images/2014/07/rultor-aspects.png" itemprop="image" style="width:600px;max-width:100%;" alt="The figure" /></figure><p>Again, let me stress that even through <a href="/2014/07/21/read-only-master-branch.html">read-only master</a> is a strong protection against broken builds, it doesn’t guarantee that at any moment master is stable. For example, sometimes unit tests fail sporadically due to changes in calendar, in environment, in dependencies, in network connection qualities, etc.</p><p>Well, ideally, unit tests should either fail or pass because they are environment independent. However, in reality, unit tests are far from being ideal.</p><p>That’s why a combination of <a href="/2014/07/21/read-only-master-branch.html">read-only master</a> with Rultor and <a href="/2014/10/08/continuous-integration-is-dead.html">continuous integration</a> with Travis gives us higher stability.</p><h2 id="scenario-3-release-to-rubygems">Scenario #3: Release to RubyGems</h2><p><a href="https://github.com/yegor256/jekyll-github-deploy"><code>jekyll-github-deploy</code></a> is a Ruby gem that <a href="/2014/06/24/jekyll-github-deploy.html">automates deployment of Jekyll sites to GitHub Pages</a>. <a href="https://github.com/leucos"><code>@leucos</code></a> submitted a pull request <a href="https://github.com/yegor256/jekyll-github-deploy/pull/4">#4</a> with a new feature. The request was merged successfully into <code>master</code> branch.</p><p>Then, Rultor was instructed by myself that <code>master</code> branch should be released to RubyGems and a new version to set is 1.5:</p><figure class="unprintable"><img src="https://www.yegor256.com/images/2014/07/rultor-jekyll-4.png" itemprop="image" style="width:600px;max-width:100%;" alt="The figure" /></figure><p>Rultor executed a simple script, <a href="http://doc.rultor.com/basics.html#release">pre-configured</a> in its <a href="https://github.com/yegor256/jekyll-github-deploy/blob/master/.rultor.yml"><code>.rultor.yml</code></a>:</p><figure class="highlight"><pre><code class="language-text" data-lang="text"><span></span>release:
  script: |
    ./test.sh
    rm -rf *.gem
    sed -i &quot;s/2.0-SNAPSHOT/${tag}/g&quot; jgd.gemspec
    gem build jgd.gemspec
    chmod 0600 ../rubygems.yml
    gem push *.gem --config-file ../rubygems.yml</code></pre></figure><p>The script is parameterized, as you see. There is one parameter that is passed by Rultor into the script: <code>${tag}</code>. This parameter was provided by myself in the GitHub issue, when I submitted a command to Rultor.</p><p>The script tests that the gem works (integration testing) and clean up afterwords:</p><figure class="highlight"><pre><code class="language-bash" data-lang="bash"><span></span>$ ./test.sh
$ rm -rf *.gem</code></pre></figure><p>Then, it changes the version of itself in <code>jgd.gemspec</code> to the one provided in the <code>${tag}</code> (it is an environment variable), and builds a new <code>.gem</code>:</p><figure class="highlight"><pre><code class="language-bash" data-lang="bash"><span></span>$ sed -i <span class="s2">&quot;s/2.0-SNAPSHOT/</span><span class="si">${</span><span class="nv">tag</span><span class="si">}</span><span class="s2">/g&quot;</span> jgd.gemspec
$ gem build jgd.gemspec</code></pre></figure><p>Finally, it pushes a newly built <code>.gem</code> to <a href="/2014/08/26/publish-to-rubygems.html">RubyGems</a>, using login credentials from <code>../rubygems.yml</code>. This file is created by Rultor right before starting the script (this mechanism is discussed below):</p><figure class="highlight"><pre><code class="language-bash" data-lang="bash"><span></span>$ chmod <span class="m">0600</span> ../rubygems.yml
$ gem push *.gem --config-file ../rubygems.yml</code></pre></figure><p>If everything works fine and RubyGems confirms successful deployment, Rultor reports to GitHub. This is exactly what happened in <a href="https://github.com/yegor256/jekyll-github-deploy/pull/4">pull request #4</a>.</p><h2 id="scenario-4-deploy-to-cloudbees">Scenario #4: Deploy to CloudBees</h2><p><a href="http://www.s3auth.com">s3auth.com</a> is a <a href="/2014/04/21/s3-http-basic-auth.html">Basic HTTP authentication gateway for Amazon S3 Buckets</a>. It is a Java web app. In its pull request <a href="https://github.com/yegor256/s3auth/pull/195">#195</a>, a resource leakage problem was fixed by <a href="https://github.com/carlosmiranda"><code>@carlosmiranda</code></a> and the pull request was merged by Rultor.</p><p>Then, <a href="https://github.com/davvd"><code>@davvd</code></a> instructed Rultor to deploy <code>master</code> branch to production environment. Rultor created <a href="/2014/07/29/docker-in-rultor.html">a new Docker container</a> and ran <code>mvn clean deploy</code> in it.</p><p>Maven deployed the application to <a href="http://www.cloudbees.com">CloudBees</a>:</p><figure class="unprintable"><img src="https://www.yegor256.com/images/2014/07/rultor-s3auth-195.png" itemprop="image" style="width:600px;max-width:100%;" alt="The figure" /></figure><p>The overall procedure took 21 minutes, as you see the in the report generated by Rultor.</p><p>There is one important trick worth mentioning. Deployment to production always means using secure credentials, like login, password, SSH keys, etc.</p><p>In this particular example, <a href="https://wiki.cloudbees.com/bin/view/RUN/MavenGuide">Maven CloudBees Plugin</a> needed API key, secret and web application name. These three parameters are kept secure and can’t be revealed in an “<a href="/2015/12/22/why-dont-you-contribute-to-open-source.html">open source</a>” way.</p><p>So, there is <a href="http://doc.rultor.com/reference.html#assets">a mechanism</a> that configures Rultor accordingly through its <a href="https://github.com/yegor256/s3auth/blob/master/.rultor.yml"><code>.rultor.yml</code></a> file (pay attention to the first few lines):</p><figure class="highlight"><pre><code class="language-text" data-lang="text"><span></span>assets:
  settings.xml: &quot;yegor256/home#assets/s3auth/settings.xml&quot;
  pubring.gpg: &quot;yegor256/home#assets/pubring.gpg&quot;
  secring.gpg: &quot;yegor256/home#assets/secring.gpg&quot;</code></pre></figure><p>These YAML entries inform Rultor that it has to get <code>assets/s3auth/settings.xml</code> file from <code>yegor256/home</code> private (!) GitHub repository and put it into the working directory of Docker container, right before starting the Maven build.</p><p>This <code>settings.xml</code> file contains that secret data CloudBees plugin needs in order to deploy the application.</p><p><a href="/2014/08/25/deploy-to-cloudbees.html">How to Deploy to CloudBees, in One Click</a> explains this process even better.</p><h2 id="you-can-do-the-same">You Can Do The Same</h2><p>Both Rultor and Travis are free hosted products, provided your projects are open source and hosted at GitHub.</p><p>Other good examples of Rultor+Travis usage can be seen in these GitHub issues: <a href="https://github.com/jcabi/jcabi-http/issues/47"><code>jcabi/jcabi-http#47</code></a>, <a href="https://github.com/jcabi/jcabi-http/pull/48"><code>jcabi/jcabi-http#48</code></a></p><p>PS. You can do something similar with AppVeyor, for Windows platform: <a href="/2015/03/29/rultor-with-appveyor.html">How AppVeyor Helps Me to Validate Pull Requests Before Rultor Merges Them</a></p></p><nav class="buttons notranslate desktop-only"> <a href="http://www.facebook.com/sharer/sharer.php?u=https://www.yegor256.com/2014/07/31/travis-and-rultor.html" title="Share on Facebook" class="button" rel="nofollow"> <span class="count count-facebook">0</span> <i class="icon icon-facebook notranslate" aria-hidden="true"></i> </a> <a href="https://twitter.com/share?url=https://www.yegor256.com/2014/07/31/travis-and-rultor.html&amp;text=Rultor+%2B+Travis" title="Share on Twitter" class="button" rel="nofollow"> <span class="count count-twitter">0</span> <i class="icon icon-twitter notranslate" aria-hidden="true"></i> </a> <a href="https://plus.google.com/share?url=https://www.yegor256.com/2014/07/31/travis-and-rultor.html" title="Share on Google+" class="button" rel="nofollow"> <span class="count count-googleplus">0</span> <i class="icon icon-googleplus notranslate" aria-hidden="true"></i> </a> <a href="https://www.linkedin.com/cws/share?url=https://www.yegor256.com/2014/07/31/travis-and-rultor.html" title="Share on LinkedIn" class="button" rel="nofollow"> <span class="count count-linkedin">0</span> <i class="icon icon-linkedin notranslate" aria-hidden="true"></i> </a> <a href="http://reddit.com/submit?url=https://www.yegor256.com/2014/07/31/travis-and-rultor.html%3F2014-30&amp;title=Rultor+%2B+Travis" title="Share on Reddit" class="button" rel="nofollow"> <span class="count count-reddit">0</span> <i class="icon icon-reddit notranslate" aria-hidden="true"></i> </a> <a href="http://news.ycombinator.com/submitlink?u=https://www.yegor256.com/2014/07/31/travis-and-rultor.html%3F2014-30&amp;t=Rultor+%2B+Travis" title="Share on Hacker News" class="button" rel="nofollow"> <span class="count count-hackernews">0</span> <i class="icon icon-hackernews notranslate" aria-hidden="true"></i> </a> </nav> </header> <article class="main" itemprop="articleBody"><div > <figure class="badge"><a href="http://www.travis-ci.org"><img src="https://www.yegor256.com/images/2014/07/travis-logo.png" style="width:100px;max-width:100%;" alt="badge" /></a></figure> <figure class="badge"><a href="http://www.rultor.com"><img src="http://doc.rultor.com/images/logo.svg" style="width:100px;max-width:100%;" alt="badge" /></a></figure><p><a href="http://www.rultor.com">Rultor</a> is a coding team assistant. <a href="http://travis-ci.org">Travis</a> is a hosted <a href="/2014/10/08/continuous-integration-is-dead.html">continuous integration</a> system. In this article I’ll show how our open source projects are using them in tandem to achieve seamless continuous delivery.</p><p>I’ll show a few practical scenarios.</p><h2 id="scenario-1-merge-pull-request">Scenario #1: Merge Pull Request</h2><p><a href="https://github.com/jcabi/jcabi-mysql-maven-plugin"><code>jcabi-mysql-maven-plugin</code></a> is a Maven plugin for <a href="/2014/05/21/mysql-maven-plugin.html">MySQL integration testing</a>. <a href="https://github.com/ChristianRedl"><code>@ChristianRedl</code></a> submitted pull request <a href="https://github.com/jcabi/jcabi-mysql-maven-plugin/pull/35">#35</a> with a new feature. I reviewed the request and asked Rultor to merge it into <code>master</code>:</p><figure class="unprintable"><img src="https://www.yegor256.com/images/2014/07/rultor-mysql-35.png" itemprop="image" style="width:600px;max-width:100%;" alt="The figure" /></figure><p>As you can see, an actual merge operation was made by Rultor. I gave him access to the project by adding his GitHub account to the list of project collaborators.</p><p>Before giving a “go ahead” to Rultor I checked the status of the pre-build reported by Travis:</p><figure class="unprintable"><img src="https://www.yegor256.com/images/2014/07/rultor-mysql-35-2.png" itemprop="image" style="width:600px;max-width:100%;" alt="The figure" /></figure><p>Travis found a new commit in the pull request and immediately (without any interaction from my side) triggered a build in that branch. The build didn’t fail, that’s why Travis gave me a green sign. I looked at that sign and at the code. Since all problems in the code were corrected by the pull request author and Travis didn’t complain—I gave a “go” to Rultor.</p><h2 id="scenario-2-continuous-integration">Scenario #2: Continuous Integration</h2><p>Even though the previous step <a href="/2014/07/21/read-only-master-branch.html">guarantees</a> that <code>master</code> branch is always clean and stable, we’re using Travis to continuously integrate it. Every commit made to <code>master</code> triggers a new build in Travis. The result of the build changes the status of the project in Travis: either “failing” or “passing.”</p><p><a href="http://aspects.jcabi.com"><code>jcabi-aspects</code></a> is a collection of <a href="/2014/06/01/aop-aspectj-java-method-logging.html">AOP AspectJ aspects</a>. We configured Travis to build it continuously. This is the badge it produces (the left one):</p><figure class="unprintable"><img src="https://www.yegor256.com/images/2014/07/rultor-aspects.png" itemprop="image" style="width:600px;max-width:100%;" alt="The figure" /></figure><p>Again, let me stress that even through <a href="/2014/07/21/read-only-master-branch.html">read-only master</a> is a strong protection against broken builds, it doesn’t guarantee that at any moment master is stable. For example, sometimes unit tests fail sporadically due to changes in calendar, in environment, in dependencies, in network connection qualities, etc.</p><p>Well, ideally, unit tests should either fail or pass because they are environment independent. However, in reality, unit tests are far from being ideal.</p><p>That’s why a combination of <a href="/2014/07/21/read-only-master-branch.html">read-only master</a> with Rultor and <a href="/2014/10/08/continuous-integration-is-dead.html">continuous integration</a> with Travis gives us higher stability.</p><h2 id="scenario-3-release-to-rubygems">Scenario #3: Release to RubyGems</h2><p><a href="https://github.com/yegor256/jekyll-github-deploy"><code>jekyll-github-deploy</code></a> is a Ruby gem that <a href="/2014/06/24/jekyll-github-deploy.html">automates deployment of Jekyll sites to GitHub Pages</a>. <a href="https://github.com/leucos"><code>@leucos</code></a> submitted a pull request <a href="https://github.com/yegor256/jekyll-github-deploy/pull/4">#4</a> with a new feature. The request was merged successfully into <code>master</code> branch.</p><p>Then, Rultor was instructed by myself that <code>master</code> branch should be released to RubyGems and a new version to set is 1.5:</p><figure class="unprintable"><img src="https://www.yegor256.com/images/2014/07/rultor-jekyll-4.png" itemprop="image" style="width:600px;max-width:100%;" alt="The figure" /></figure><p>Rultor executed a simple script, <a href="http://doc.rultor.com/basics.html#release">pre-configured</a> in its <a href="https://github.com/yegor256/jekyll-github-deploy/blob/master/.rultor.yml"><code>.rultor.yml</code></a>:</p><figure class="highlight"><pre><code class="language-text" data-lang="text"><span></span>release:
  script: |
    ./test.sh
    rm -rf *.gem
    sed -i &quot;s/2.0-SNAPSHOT/${tag}/g&quot; jgd.gemspec
    gem build jgd.gemspec
    chmod 0600 ../rubygems.yml
    gem push *.gem --config-file ../rubygems.yml</code></pre></figure><p>The script is parameterized, as you see. There is one parameter that is passed by Rultor into the script: <code>${tag}</code>. This parameter was provided by myself in the GitHub issue, when I submitted a command to Rultor.</p><p>The script tests that the gem works (integration testing) and clean up afterwords:</p><figure class="highlight"><pre><code class="language-bash" data-lang="bash"><span></span>$ ./test.sh
$ rm -rf *.gem</code></pre></figure><p>Then, it changes the version of itself in <code>jgd.gemspec</code> to the one provided in the <code>${tag}</code> (it is an environment variable), and builds a new <code>.gem</code>:</p><figure class="highlight"><pre><code class="language-bash" data-lang="bash"><span></span>$ sed -i <span class="s2">&quot;s/2.0-SNAPSHOT/</span><span class="si">${</span><span class="nv">tag</span><span class="si">}</span><span class="s2">/g&quot;</span> jgd.gemspec
$ gem build jgd.gemspec</code></pre></figure><p>Finally, it pushes a newly built <code>.gem</code> to <a href="/2014/08/26/publish-to-rubygems.html">RubyGems</a>, using login credentials from <code>../rubygems.yml</code>. This file is created by Rultor right before starting the script (this mechanism is discussed below):</p><figure class="highlight"><pre><code class="language-bash" data-lang="bash"><span></span>$ chmod <span class="m">0600</span> ../rubygems.yml
$ gem push *.gem --config-file ../rubygems.yml</code></pre></figure><p>If everything works fine and RubyGems confirms successful deployment, Rultor reports to GitHub. This is exactly what happened in <a href="https://github.com/yegor256/jekyll-github-deploy/pull/4">pull request #4</a>.</p><h2 id="scenario-4-deploy-to-cloudbees">Scenario #4: Deploy to CloudBees</h2><p><a href="http://www.s3auth.com">s3auth.com</a> is a <a href="/2014/04/21/s3-http-basic-auth.html">Basic HTTP authentication gateway for Amazon S3 Buckets</a>. It is a Java web app. In its pull request <a href="https://github.com/yegor256/s3auth/pull/195">#195</a>, a resource leakage problem was fixed by <a href="https://github.com/carlosmiranda"><code>@carlosmiranda</code></a> and the pull request was merged by Rultor.</p><p>Then, <a href="https://github.com/davvd"><code>@davvd</code></a> instructed Rultor to deploy <code>master</code> branch to production environment. Rultor created <a href="/2014/07/29/docker-in-rultor.html">a new Docker container</a> and ran <code>mvn clean deploy</code> in it.</p><p>Maven deployed the application to <a href="http://www.cloudbees.com">CloudBees</a>:</p><figure class="unprintable"><img src="https://www.yegor256.com/images/2014/07/rultor-s3auth-195.png" itemprop="image" style="width:600px;max-width:100%;" alt="The figure" /></figure><p>The overall procedure took 21 minutes, as you see the in the report generated by Rultor.</p><p>There is one important trick worth mentioning. Deployment to production always means using secure credentials, like login, password, SSH keys, etc.</p><p>In this particular example, <a href="https://wiki.cloudbees.com/bin/view/RUN/MavenGuide">Maven CloudBees Plugin</a> needed API key, secret and web application name. These three parameters are kept secure and can’t be revealed in an “<a href="/2015/12/22/why-dont-you-contribute-to-open-source.html">open source</a>” way.</p><p>So, there is <a href="http://doc.rultor.com/reference.html#assets">a mechanism</a> that configures Rultor accordingly through its <a href="https://github.com/yegor256/s3auth/blob/master/.rultor.yml"><code>.rultor.yml</code></a> file (pay attention to the first few lines):</p><figure class="highlight"><pre><code class="language-text" data-lang="text"><span></span>assets:
  settings.xml: &quot;yegor256/home#assets/s3auth/settings.xml&quot;
  pubring.gpg: &quot;yegor256/home#assets/pubring.gpg&quot;
  secring.gpg: &quot;yegor256/home#assets/secring.gpg&quot;</code></pre></figure><p>These YAML entries inform Rultor that it has to get <code>assets/s3auth/settings.xml</code> file from <code>yegor256/home</code> private (!) GitHub repository and put it into the working directory of Docker container, right before starting the Maven build.</p><p>This <code>settings.xml</code> file contains that secret data CloudBees plugin needs in order to deploy the application.</p><p><a href="/2014/08/25/deploy-to-cloudbees.html">How to Deploy to CloudBees, in One Click</a> explains this process even better.</p><h2 id="you-can-do-the-same">You Can Do The Same</h2><p>Both Rultor and Travis are free hosted products, provided your projects are open source and hosted at GitHub.</p><p>Other good examples of Rultor+Travis usage can be seen in these GitHub issues: <a href="https://github.com/jcabi/jcabi-http/issues/47"><code>jcabi/jcabi-http#47</code></a>, <a href="https://github.com/jcabi/jcabi-http/pull/48"><code>jcabi/jcabi-http#48</code></a></p><p>PS. You can do something similar with AppVeyor, for Windows platform: <a href="/2015/03/29/rultor-with-appveyor.html">How AppVeyor Helps Me to Validate Pull Requests Before Rultor Merges Them</a></p></div></article></div><div class="wrapper"> <related-posts /></div><div class="disqus" role="complementary"><p class="disqus_hint"> Please, use <a href="https://help.disqus.com/commenting/what-html-tags-are-allowed-within-comments">syntax highlighting</a> in your comments, to make them more readable.</p><div id="disqus_thread" class="disqus-thread"> <a>&nbsp;</a></div><script> var disqus_config = function () { this.page.url = document.location.href.split('?')[0].split('#')[0].replace('https://', 'http://'); this.page.identifier = this.page.url; }; (function() { var d = document, s = d.createElement('script'); s.src = '//yegor256.disqus.com/embed.js'; s.setAttribute('data-timestamp', +new Date()); (d.head || d.body).appendChild(s); })(); </script> <noscript><div><p class="red"> JavaScript is disabled in your browser, that's why you can't see comments under this post.</p></div></noscript></div><div class="wrapper"> <footer class="footer"><p> &copy; <span itemscope="" itemprop="copyrightHolder" itemtype="http://schema.org/Person"> <span itemprop="name">Yegor Bugayenko</span> </span> 2014&ndash;<span itemprop="copyrightYear">2018</span></p></footer></div></section><div class="wrapper unprintable" style="text-align:center;margin-top:2em;"> <a href="http://www.sixnines.io/h/3ba1652f"> <img src="//www.sixnines.io/b/3ba1652f?style=flat" alt="sixnines availability badge"/> </a></div><script src="//code.jquery.com/jquery-1.9.0.min.js"></script> <script src="/js/all.js?c998b88f617"></script> <script>var disqus_shortname = 'yegor256';</script> <script id="dsq-count-scr" src="//yegor256.disqus.com/count.js" async="async"></script> <script> (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){ (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o), m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m) })(window,document,'script','//www.google-analytics.com/analytics.js','ga'); ga('create', 'UA-1963507-32', 'auto'); ga('send', 'pageview'); </script> <script> Cd=document;Cr="&"+Math.random();Cp="&s=1"; Cd.cookie="b=b";if(Cd.cookie)Cp+="&c=1"; Cp+="&t="+(new Date()).getTimezoneOffset(); if(self!=top)Cp+="&f=1"; </script> <script> if(navigator.javaEnabled())Cp+="&j=1"; </script> <script> if(typeof(screen)!='undefined')Cp+="&w="+screen.width+"&h="+ screen.height+"&d="+(screen.colorDepth?screen.colorDepth:screen.pixelDepth); </script> <script> Cd.write("<img src='//c.hit.ua/hit?i=95870&g=0&x=2"+Cp+Cr+ "&r="+escape(Cd.referrer)+"&u="+escape(window.location.href)+ "' border='0' wi"+"dth='1' he"+"ight='1'/>"); </script> <script type="application/ld+json"> { "@context": "http://schema.org", "@type": "Person", "name": "Yegor Bugayenko", "url": "https://www.yegor256.com", "sameAs": [ "https://www.facebook.com/yegor256", "https://instagram.com/yegor256", "https://www.linkedin.com/in/yegor256", "https://twitter.com/yegor256", "https://github.com/yegor256", "https://www.pinterest.com/yegor256/" ] } </script> </body> </html> <!DOCTYPE html> <html xmlns="http://www.w3.org/1999/xhtml" lang="en-US" xml:lang="en-US" itemscope="" itemtype="http://schema.org/WebSite"> <head> <meta charset="utf-8"/> <meta name="description" content="&lt;figure class=&quot;badge&quot;&gt;&lt;a href=&quot;http://www.docker.io&quot;&gt;&lt;img src=&quot;http://doc.rultor.com/images/docker-logo.png&quot; style=&quot;width:100px;max-width:100%;&quot; alt=&quot;badge&quot; /&gt;&lt;/a&gt;&lt;/figure&gt; &lt;p&gt;&lt;a href=&quot;http://www.docker.io&quot;&gt;Docker&lt;/a&gt; is a command line tool that can run a shell command in a virtual Linux, inside an isolated file system. Every time we build our projects, we want them to run in their own Docker containers. Take this Maven project for example:&lt;/p&gt; &lt;figure class=&quot;highlight&quot;&gt;&lt;pre&gt;&lt;code class=&quot;language-bash&quot; data-lang=&quot;bash&quot;&gt;&lt;span&gt;&lt;/span&gt;$ sudo docker run -i -t ubuntu mvn clean &lt;span class=&quot;nb&quot;&gt;test&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/figure&gt; &lt;figure class=&quot;badge&quot;&gt;&lt;a href=&quot;http://www.rultor.com&quot;&gt;&lt;img src=&quot;http://doc.rultor.com/images/logo.svg&quot; style=&quot;width:100px;max-width:100%;&quot; alt=&quot;badge&quot; /&gt;&lt;/a&gt;&lt;/figure&gt; &lt;p&gt;This command will start a new Ubuntu system and execute &lt;code&gt;mvn clean test&lt;/code&gt; inside it. &lt;a href=&quot;http://www.rultor.com&quot;&gt;Rultor.com&lt;/a&gt;, our virtual assistant, does exactly that with our builds, when we deploy, package, test and merge them.&lt;/p&gt; &lt;!--more--&gt; &lt;h2 id=&quot;why-docker&quot;&gt;Why Docker?&lt;/h2&gt; &lt;p&gt;What benefits does it give us? And why &lt;a href=&quot;/2014/08/29/docker-non-root.html&quot;&gt;Docker&lt;/a&gt;, when there are many &lt;a href=&quot;https://en.wikipedia.org/wiki/Operating_system-level_virtualization&quot;&gt;other virtualization technologies&lt;/a&gt;, like LXC, for example?&lt;/p&gt; &lt;p&gt;Well, there are a few very important benefits:&lt;/p&gt; &lt;ul&gt; &lt;li&gt; &lt;p&gt;Image repository (hub.docker.com)&lt;/p&gt; &lt;/li&gt; &lt;li&gt; &lt;p&gt;Versioning&lt;/p&gt; &lt;/li&gt; &lt;li&gt; &lt;p&gt;Application-centric&lt;/p&gt; &lt;/li&gt; &lt;/ul&gt; &lt;p&gt;Let’s discuss them in details.&lt;/p&gt; &lt;h2 id=&quot;image-repository&quot;&gt;Image Repository&lt;/h2&gt; &lt;p&gt;Docker enables image sharing through its public repository at &lt;a href=&quot;http://hub.docker.com&quot;&gt;hub.docker.com&lt;/a&gt;. This means that after I prepare a working environment for my application, I make an image out of it and push it to the hub.&lt;/p&gt; &lt;p&gt;Let’s say, I want my Maven build to be executed in a container with a pre-installed &lt;code&gt;graphviz&lt;/code&gt; package (in order to enable &lt;code&gt;dot&lt;/code&gt; command line tool). First, I would start a plain vanilla Ubuntu container, and install &lt;code&gt;graphviz&lt;/code&gt; inside it:&lt;/p&gt; &lt;figure class=&quot;highlight&quot;&gt;&lt;pre&gt;&lt;code class=&quot;language-text&quot; data-lang=&quot;text&quot;&gt;&lt;span&gt;&lt;/span&gt;$ sudo docker run -i -t ubuntu /bin/bash root@215d2696e8ad:/# sudo apt-get install -y graphviz Reading package lists... Done Building dependency tree Reading state information... Done The following extra packages will be installed: ... root@215d2696e8ad:/# exit $ sudo docker ps -a CONTAINER ID IMAGE COMMAND CREATED STATUS PORTS NAMES 215d2696e8ad ubuntu:14.04 /bin/bash About a minute ago Exited (0) 3 seconds ago high_mccarthy&lt;/code&gt;&lt;/pre&gt;&lt;/figure&gt; &lt;p&gt;I have a container that stopped a few seconds ago. Container’s ID is &lt;code&gt;215d2696e8ad&lt;/code&gt;. Now, I want to make it reusable for all further tests in Rultor.com. I have to create an image from it:&lt;/p&gt; &lt;figure class=&quot;highlight&quot;&gt;&lt;pre&gt;&lt;code class=&quot;language-bash&quot; data-lang=&quot;bash&quot;&gt;&lt;span&gt;&lt;/span&gt;$ sudo docker commit 215d2696e8ad yegor256/beta c5ad7718fc0e20fe4bf2c8a9bfade4db8617a25366ca5b64be2e1e8aa0de6e52&lt;/code&gt;&lt;/pre&gt;&lt;/figure&gt; &lt;p&gt;I just made my new commit to a new image &lt;code&gt;yegor256/beta&lt;/code&gt;. This image can be reused right now. I can create a new container from this image and it will have &lt;code&gt;graphviz&lt;/code&gt; installed inside!&lt;/p&gt; &lt;p&gt;Now it’s time to share my image at Docker hub, in order to make it available for Rultor:&lt;/p&gt; &lt;figure class=&quot;highlight&quot;&gt;&lt;pre&gt;&lt;code class=&quot;language-text&quot; data-lang=&quot;text&quot;&gt;&lt;span&gt;&lt;/span&gt;$ sudo docker push yegor256/beta The push refers to a repository [yegor256/beta] (len: 1) Sending image list Pushing repository yegor256/beta (1 tags) 511136ea3c5a: Image already pushed, skipping d7ac5e4f1812: Image already pushed, skipping 2f4b4d6a4a06: Image already pushed, skipping 83ff768040a0: Image already pushed, skipping 6c37f792ddac: Image already pushed, skipping e54ca5efa2e9: Image already pushed, skipping c5ad7718fc0e: Image successfully pushed Pushing tag for rev [c5ad7718fc0e] on {https://registry-1.docker.io/v1/repositories/yegor256/beta/tags/latest}&lt;/code&gt;&lt;/pre&gt;&lt;/figure&gt; &lt;p&gt;The last step is to configure Rultor to use this image in all builds. To do this, I will edit &lt;a href=&quot;http://doc.rultor.com/reference.html&quot;&gt;&lt;code&gt;.rultor.yml&lt;/code&gt;&lt;/a&gt; in the root directory of my GitHub repository:&lt;/p&gt; &lt;figure class=&quot;highlight&quot;&gt;&lt;pre&gt;&lt;code class=&quot;language-text&quot; data-lang=&quot;text&quot;&gt;&lt;span&gt;&lt;/span&gt;docker: image: yegor256/beta&lt;/code&gt;&lt;/pre&gt;&lt;/figure&gt; &lt;p&gt;That’s it. From now on, Rultor will use my custom Docker image with pre-installed &lt;code&gt;graphviz&lt;/code&gt;, in every build (merge, release, deploy, etc.)&lt;/p&gt; &lt;p&gt;Moreover, if and when I want to add something else to the image, it’s easy to do. Say, I want to install Ruby into my build image. I start a container from the image and install it (pay attention, I’m starting a container not from &lt;code&gt;ubuntu&lt;/code&gt; image, as I did before, but from &lt;code&gt;yegor256/beta&lt;/code&gt;):&lt;/p&gt; &lt;figure class=&quot;highlight&quot;&gt;&lt;pre&gt;&lt;code class=&quot;language-text&quot; data-lang=&quot;text&quot;&gt;&lt;span&gt;&lt;/span&gt;$ sudo docker run -i -t yegor256/beta /bin/bash root@7e0fbd9806c9:/# sudo apt-get install -y ruby Reading package lists... Done Building dependency tree Reading state information... Done The following extra packages will be installed: ... root@7e0fbd9806c9:/# exit $ sudo docker ps -a CONTAINER ID IMAGE COMMAND CREATED STATUS PORTS NAMES 7e0fbd9806c9 yegor256/beta:latest /bin/bash 28 seconds ago Exited (0) 2 seconds ago pensive_pare 215d2696e8ad ubuntu:14.04 /bin/bash 10 minutes ago Exited (0) 8 minutes ago high_mccarthy&lt;/code&gt;&lt;/pre&gt;&lt;/figure&gt; &lt;p&gt;You can now see that I have two containers. The first one is the one I am using right now; it contains Ruby. The second one is the one I was using before and it contains &lt;code&gt;graphviz&lt;/code&gt;.&lt;/p&gt; &lt;p&gt;Now I have to commit again and push:&lt;/p&gt; &lt;figure class=&quot;highlight&quot;&gt;&lt;pre&gt;&lt;code class=&quot;language-bash&quot; data-lang=&quot;bash&quot;&gt;&lt;span&gt;&lt;/span&gt;$ sudo docker commit 7e0fbd9806c9 yegor256/beta 6cbfb7a6b18a2182f42171f6bb5aef67c4819b5c2795edffa6a63ba78aaada2d $ sudo docker push yegor256/beta ...&lt;/code&gt;&lt;/pre&gt;&lt;/figure&gt; &lt;p&gt;Thus, this Docker hub is a very convenient feature for Rultor and similar systems.&lt;/p&gt; &lt;h2 id=&quot;versioning&quot;&gt;Versioning&lt;/h2&gt; &lt;p&gt;As you saw in the example above, every change to a Docker image has its own version (hash) and it’s possible to track changes. It is also possible to roll back to any particular change.&lt;/p&gt; &lt;p&gt;Rultor is not using this functionality itself, but Rultor users are able to control their build configurations with much better precision.&lt;/p&gt; &lt;h2 id=&quot;application-centric&quot;&gt;Application-Centric&lt;/h2&gt; &lt;p&gt;Docker, unlike LXC or Vagrant, for example, is application-centric. This means that when we start a container—we start an application. With other virtualization technologies, when you get a virtual machine—you get a fully functional Unix environment, where you can login through SSH and do whatever you want.&lt;/p&gt; &lt;p&gt;Docker makes things simpler. It doesn’t give you SSH access to container, but runs an application inside and shows you its output. This is exactly what we need in Rultor. We need to run an automated build (for example Maven or Bundler), see its output and get its exit code. If the code is not zero, we fail the build and report to the user.&lt;/p&gt; &lt;p&gt;This is how we run Maven build:&lt;/p&gt; &lt;figure class=&quot;highlight&quot;&gt;&lt;pre&gt;&lt;code class=&quot;language-bash&quot; data-lang=&quot;bash&quot;&gt;&lt;span&gt;&lt;/span&gt;$ sudo docker run --rm -i -t yegor256/rultor mvn clean &lt;span class=&quot;nb&quot;&gt;test&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;[&lt;/span&gt;INFO&lt;span class=&quot;o&quot;&gt;]&lt;/span&gt; ------------------------------------------------------------------------ &lt;span class=&quot;o&quot;&gt;[&lt;/span&gt;INFO&lt;span class=&quot;o&quot;&gt;]&lt;/span&gt; Building jcabi-github &lt;span class=&quot;m&quot;&gt;0&lt;/span&gt;.13 &lt;span class=&quot;o&quot;&gt;[&lt;/span&gt;INFO&lt;span class=&quot;o&quot;&gt;]&lt;/span&gt; ------------------------------------------------------------------------ &lt;span class=&quot;o&quot;&gt;[&lt;/span&gt;INFO&lt;span class=&quot;o&quot;&gt;]&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;[&lt;/span&gt;INFO&lt;span class=&quot;o&quot;&gt;]&lt;/span&gt; --- maven-clean-plugin:2.5:clean &lt;span class=&quot;o&quot;&gt;(&lt;/span&gt;default-clean&lt;span class=&quot;o&quot;&gt;)&lt;/span&gt; @ jcabi-github --- &lt;span class=&quot;o&quot;&gt;[&lt;/span&gt;INFO&lt;span class=&quot;o&quot;&gt;]&lt;/span&gt; ...&lt;/code&gt;&lt;/pre&gt;&lt;/figure&gt; &lt;p&gt;As you can see, Maven starts immediately. We don’t worry about the internals of the container. We just start an application inside it.&lt;/p&gt; &lt;p&gt;Furthermore, thanks to the &lt;code&gt;--rm&lt;/code&gt; option, the container gets destroyed immediately after Maven execution is finished.&lt;/p&gt; &lt;p&gt;This is what application-centric is about.&lt;/p&gt; &lt;p&gt;Our overall impression of Docker is highly positive.&lt;/p&gt; &lt;p&gt;ps. A compact version of this article was published at &lt;a href=&quot;http://devops.com/blogs/build-docker-containers/&quot;&gt;devops.com&lt;/a&gt;&lt;/p&gt; " /> <meta name="keywords" content="next, path, output, content, previous, url, relative_path, id, collection, excerpt, draft, categories, layout, title, date, tags, description, keywords, slug, ext" /> <meta name="viewport" content="width=device-width,minimum-scale=1,initial-scale=1"/> <meta name="google-site-verification" content="JEj_gQr2CPe2QKGw8XdMz0R7VboQIUbX3FlM-lwTq-8" /> <meta name="author" content="Yegor Bugayenko"> <meta name="article:published_time" content="2014-07-29 00:00:00 +0000"> <meta name="og:site_name" content="Yegor Bugayenko"/> <meta name="og:type" content="article" /> <meta name="og:locale" content="en_US" /> <meta name="twitter:account_id" content="4503599630178231" /> <meta name="twitter:creator" content="@yegor256"/> <meta name="twitter:site" content="@yegor256"/> <meta name="twitter:title" property="og:title" content="Every Build in Its Own Docker Container"/> <meta name="twitter:description" property="og:description" content="&lt;figure class=&quot;badge&quot;&gt;&lt;a href=&quot;http://www.docker.io&quot;&gt;&lt;img src=&quot;http://doc.rultor.com/images/docker-logo.png&quot; style=&quot;width:100px;max-width:100%;&quot; alt=&quot;badge&quot; /&gt;&lt;/a&gt;&lt;/figure&gt; &lt;p&gt;&lt;a href=&quot;http://www.docker.io&quot;&gt;Docker&lt;/a&gt; is a command line tool that can run a shell command in a virtual Linux, inside an isolated file system. Every time we build our projects, we want them to run in their own Docker containers. Take this Maven project for example:&lt;/p&gt; &lt;figure class=&quot;highlight&quot;&gt;&lt;pre&gt;&lt;code class=&quot;language-bash&quot; data-lang=&quot;bash&quot;&gt;&lt;span&gt;&lt;/span&gt;$ sudo docker run -i -t ubuntu mvn clean &lt;span class=&quot;nb&quot;&gt;test&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/figure&gt; &lt;figure class=&quot;badge&quot;&gt;&lt;a href=&quot;http://www.rultor.com&quot;&gt;&lt;img src=&quot;http://doc.rultor.com/images/logo.svg&quot; style=&quot;width:100px;max-width:100%;&quot; alt=&quot;badge&quot; /&gt;&lt;/a&gt;&lt;/figure&gt; &lt;p&gt;This command will start a new Ubuntu system and execute &lt;code&gt;mvn clean test&lt;/code&gt; inside it. &lt;a href=&quot;http://www.rultor.com&quot;&gt;Rultor.com&lt;/a&gt;, our virtual assistant, does exactly that with our builds, when we deploy, package, test and merge them.&lt;/p&gt; &lt;!--more--&gt; &lt;h2 id=&quot;why-docker&quot;&gt;Why Docker?&lt;/h2&gt; &lt;p&gt;What benefits does it give us? And why &lt;a href=&quot;/2014/08/29/docker-non-root.html&quot;&gt;Docker&lt;/a&gt;, when there are many &lt;a href=&quot;https://en.wikipedia.org/wiki/Operating_system-level_virtualization&quot;&gt;other virtualization technologies&lt;/a&gt;, like LXC, for example?&lt;/p&gt; &lt;p&gt;Well, there are a few very important benefits:&lt;/p&gt; &lt;ul&gt; &lt;li&gt; &lt;p&gt;Image repository (hub.docker.com)&lt;/p&gt; &lt;/li&gt; &lt;li&gt; &lt;p&gt;Versioning&lt;/p&gt; &lt;/li&gt; &lt;li&gt; &lt;p&gt;Application-centric&lt;/p&gt; &lt;/li&gt; &lt;/ul&gt; &lt;p&gt;Let’s discuss them in details.&lt;/p&gt; &lt;h2 id=&quot;image-repository&quot;&gt;Image Repository&lt;/h2&gt; &lt;p&gt;Docker enables image sharing through its public repository at &lt;a href=&quot;http://hub.docker.com&quot;&gt;hub.docker.com&lt;/a&gt;. This means that after I prepare a working environment for my application, I make an image out of it and push it to the hub.&lt;/p&gt; &lt;p&gt;Let’s say, I want my Maven build to be executed in a container with a pre-installed &lt;code&gt;graphviz&lt;/code&gt; package (in order to enable &lt;code&gt;dot&lt;/code&gt; command line tool). First, I would start a plain vanilla Ubuntu container, and install &lt;code&gt;graphviz&lt;/code&gt; inside it:&lt;/p&gt; &lt;figure class=&quot;highlight&quot;&gt;&lt;pre&gt;&lt;code class=&quot;language-text&quot; data-lang=&quot;text&quot;&gt;&lt;span&gt;&lt;/span&gt;$ sudo docker run -i -t ubuntu /bin/bash root@215d2696e8ad:/# sudo apt-get install -y graphviz Reading package lists... Done Building dependency tree Reading state information... Done The following extra packages will be installed: ... root@215d2696e8ad:/# exit $ sudo docker ps -a CONTAINER ID IMAGE COMMAND CREATED STATUS PORTS NAMES 215d2696e8ad ubuntu:14.04 /bin/bash About a minute ago Exited (0) 3 seconds ago high_mccarthy&lt;/code&gt;&lt;/pre&gt;&lt;/figure&gt; &lt;p&gt;I have a container that stopped a few seconds ago. Container’s ID is &lt;code&gt;215d2696e8ad&lt;/code&gt;. Now, I want to make it reusable for all further tests in Rultor.com. I have to create an image from it:&lt;/p&gt; &lt;figure class=&quot;highlight&quot;&gt;&lt;pre&gt;&lt;code class=&quot;language-bash&quot; data-lang=&quot;bash&quot;&gt;&lt;span&gt;&lt;/span&gt;$ sudo docker commit 215d2696e8ad yegor256/beta c5ad7718fc0e20fe4bf2c8a9bfade4db8617a25366ca5b64be2e1e8aa0de6e52&lt;/code&gt;&lt;/pre&gt;&lt;/figure&gt; &lt;p&gt;I just made my new commit to a new image &lt;code&gt;yegor256/beta&lt;/code&gt;. This image can be reused right now. I can create a new container from this image and it will have &lt;code&gt;graphviz&lt;/code&gt; installed inside!&lt;/p&gt; &lt;p&gt;Now it’s time to share my image at Docker hub, in order to make it available for Rultor:&lt;/p&gt; &lt;figure class=&quot;highlight&quot;&gt;&lt;pre&gt;&lt;code class=&quot;language-text&quot; data-lang=&quot;text&quot;&gt;&lt;span&gt;&lt;/span&gt;$ sudo docker push yegor256/beta The push refers to a repository [yegor256/beta] (len: 1) Sending image list Pushing repository yegor256/beta (1 tags) 511136ea3c5a: Image already pushed, skipping d7ac5e4f1812: Image already pushed, skipping 2f4b4d6a4a06: Image already pushed, skipping 83ff768040a0: Image already pushed, skipping 6c37f792ddac: Image already pushed, skipping e54ca5efa2e9: Image already pushed, skipping c5ad7718fc0e: Image successfully pushed Pushing tag for rev [c5ad7718fc0e] on {https://registry-1.docker.io/v1/repositories/yegor256/beta/tags/latest}&lt;/code&gt;&lt;/pre&gt;&lt;/figure&gt; &lt;p&gt;The last step is to configure Rultor to use this image in all builds. To do this, I will edit &lt;a href=&quot;http://doc.rultor.com/reference.html&quot;&gt;&lt;code&gt;.rultor.yml&lt;/code&gt;&lt;/a&gt; in the root directory of my GitHub repository:&lt;/p&gt; &lt;figure class=&quot;highlight&quot;&gt;&lt;pre&gt;&lt;code class=&quot;language-text&quot; data-lang=&quot;text&quot;&gt;&lt;span&gt;&lt;/span&gt;docker: image: yegor256/beta&lt;/code&gt;&lt;/pre&gt;&lt;/figure&gt; &lt;p&gt;That’s it. From now on, Rultor will use my custom Docker image with pre-installed &lt;code&gt;graphviz&lt;/code&gt;, in every build (merge, release, deploy, etc.)&lt;/p&gt; &lt;p&gt;Moreover, if and when I want to add something else to the image, it’s easy to do. Say, I want to install Ruby into my build image. I start a container from the image and install it (pay attention, I’m starting a container not from &lt;code&gt;ubuntu&lt;/code&gt; image, as I did before, but from &lt;code&gt;yegor256/beta&lt;/code&gt;):&lt;/p&gt; &lt;figure class=&quot;highlight&quot;&gt;&lt;pre&gt;&lt;code class=&quot;language-text&quot; data-lang=&quot;text&quot;&gt;&lt;span&gt;&lt;/span&gt;$ sudo docker run -i -t yegor256/beta /bin/bash root@7e0fbd9806c9:/# sudo apt-get install -y ruby Reading package lists... Done Building dependency tree Reading state information... Done The following extra packages will be installed: ... root@7e0fbd9806c9:/# exit $ sudo docker ps -a CONTAINER ID IMAGE COMMAND CREATED STATUS PORTS NAMES 7e0fbd9806c9 yegor256/beta:latest /bin/bash 28 seconds ago Exited (0) 2 seconds ago pensive_pare 215d2696e8ad ubuntu:14.04 /bin/bash 10 minutes ago Exited (0) 8 minutes ago high_mccarthy&lt;/code&gt;&lt;/pre&gt;&lt;/figure&gt; &lt;p&gt;You can now see that I have two containers. The first one is the one I am using right now; it contains Ruby. The second one is the one I was using before and it contains &lt;code&gt;graphviz&lt;/code&gt;.&lt;/p&gt; &lt;p&gt;Now I have to commit again and push:&lt;/p&gt; &lt;figure class=&quot;highlight&quot;&gt;&lt;pre&gt;&lt;code class=&quot;language-bash&quot; data-lang=&quot;bash&quot;&gt;&lt;span&gt;&lt;/span&gt;$ sudo docker commit 7e0fbd9806c9 yegor256/beta 6cbfb7a6b18a2182f42171f6bb5aef67c4819b5c2795edffa6a63ba78aaada2d $ sudo docker push yegor256/beta ...&lt;/code&gt;&lt;/pre&gt;&lt;/figure&gt; &lt;p&gt;Thus, this Docker hub is a very convenient feature for Rultor and similar systems.&lt;/p&gt; &lt;h2 id=&quot;versioning&quot;&gt;Versioning&lt;/h2&gt; &lt;p&gt;As you saw in the example above, every change to a Docker image has its own version (hash) and it’s possible to track changes. It is also possible to roll back to any particular change.&lt;/p&gt; &lt;p&gt;Rultor is not using this functionality itself, but Rultor users are able to control their build configurations with much better precision.&lt;/p&gt; &lt;h2 id=&quot;application-centric&quot;&gt;Application-Centric&lt;/h2&gt; &lt;p&gt;Docker, unlike LXC or Vagrant, for example, is application-centric. This means that when we start a container—we start an application. With other virtualization technologies, when you get a virtual machine—you get a fully functional Unix environment, where you can login through SSH and do whatever you want.&lt;/p&gt; &lt;p&gt;Docker makes things simpler. It doesn’t give you SSH access to container, but runs an application inside and shows you its output. This is exactly what we need in Rultor. We need to run an automated build (for example Maven or Bundler), see its output and get its exit code. If the code is not zero, we fail the build and report to the user.&lt;/p&gt; &lt;p&gt;This is how we run Maven build:&lt;/p&gt; &lt;figure class=&quot;highlight&quot;&gt;&lt;pre&gt;&lt;code class=&quot;language-bash&quot; data-lang=&quot;bash&quot;&gt;&lt;span&gt;&lt;/span&gt;$ sudo docker run --rm -i -t yegor256/rultor mvn clean &lt;span class=&quot;nb&quot;&gt;test&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;[&lt;/span&gt;INFO&lt;span class=&quot;o&quot;&gt;]&lt;/span&gt; ------------------------------------------------------------------------ &lt;span class=&quot;o&quot;&gt;[&lt;/span&gt;INFO&lt;span class=&quot;o&quot;&gt;]&lt;/span&gt; Building jcabi-github &lt;span class=&quot;m&quot;&gt;0&lt;/span&gt;.13 &lt;span class=&quot;o&quot;&gt;[&lt;/span&gt;INFO&lt;span class=&quot;o&quot;&gt;]&lt;/span&gt; ------------------------------------------------------------------------ &lt;span class=&quot;o&quot;&gt;[&lt;/span&gt;INFO&lt;span class=&quot;o&quot;&gt;]&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;[&lt;/span&gt;INFO&lt;span class=&quot;o&quot;&gt;]&lt;/span&gt; --- maven-clean-plugin:2.5:clean &lt;span class=&quot;o&quot;&gt;(&lt;/span&gt;default-clean&lt;span class=&quot;o&quot;&gt;)&lt;/span&gt; @ jcabi-github --- &lt;span class=&quot;o&quot;&gt;[&lt;/span&gt;INFO&lt;span class=&quot;o&quot;&gt;]&lt;/span&gt; ...&lt;/code&gt;&lt;/pre&gt;&lt;/figure&gt; &lt;p&gt;As you can see, Maven starts immediately. We don’t worry about the internals of the container. We just start an application inside it.&lt;/p&gt; &lt;p&gt;Furthermore, thanks to the &lt;code&gt;--rm&lt;/code&gt; option, the container gets destroyed immediately after Maven execution is finished.&lt;/p&gt; &lt;p&gt;This is what application-centric is about.&lt;/p&gt; &lt;p&gt;Our overall impression of Docker is highly positive.&lt;/p&gt; &lt;p&gt;ps. A compact version of this article was published at &lt;a href=&quot;http://devops.com/blogs/build-docker-containers/&quot;&gt;devops.com&lt;/a&gt;&lt;/p&gt; "/> <meta name="twitter:url" property="og:url" content="https://www.yegor256.com/2014/07/29/docker-in-rultor.html"/> <meta name="telegram:channel" content="AAAAAEJFMRzsRTRxM3ec6A"/> <link rel="search" type="application/opensearchdescription+xml" href="/opensearch.xml" title="yegor256" /> <link rel="shortcut icon" href="/favicon.ico?c998b88f617"/> <link rel="apple-touch-icon" href="/favicon.ico?c998b88f617"/> <link rel="alternate" type="application/rss+xml" title="RSS for yegor256.com" href="https://www.yegor256.com/rss.xml"/> <link rel="stylesheet" href="/css/layout.css?c998b88f617"/> <link rel="stylesheet" href="/css/icons.css?c998b88f617"/> <link rel="canonical" href="https://www.yegor256.com/2014/07/29/docker-in-rultor.html" /> <link rel="amphtml" href="https://www.yegor256.com/2014/07/29/docker-in-rultor.amp.html" /> <title>Every Build in Its Own Docker Container </title> </head> <body><div class="wrapper"> <aside class="header-toggle unprintable" id="header-toggle" title="Show the menu" onclick="$('#header').show();$('#header-toggle').hide();">&#9776;</aside> <header class="header" id="header"><div class="face"> <a href="/about-me.html#form" class="sub" title="Click to subscribe to my monthly newsletter"><span>Subscribe</span></a> <a href="/about-me.html" style="position:relative;"> <img src="/images/face-256x256.jpg" class="photo" alt="Yegor Bugayenko"/> </a></div><nav><ul class="menu social notranslate"> <li><a href="https://twitter.com/intent/follow?screen_name=yegor256" rel="nofollow" title="Follow me on Twitter"><i class="icon icon-twitter notranslate" aria-hidden="true"></i></a></li> <li><a href="/rss.xml" rel="nofollow" title="Subscribe to my RSS feed"><i class="icon icon-rss notranslate" aria-hidden="true"></i></a></li> <li><a itemprop="sameAs" href="https://github.com/yegor256" rel="nofollow" title="My GitHub profile"><i class="icon icon-github notranslate" aria-hidden="true"></i></a></li> <li><a itemprop="sameAs" href="http://stackoverflow.com/users/187141/yegor256" rel="nofollow" title="My StackOverflow profile"><i class="icon icon-stackoverflow notranslate" aria-hidden="true"></i></a></li> <li><a itemprop="sameAs" href="https://www.facebook.com/yegor256" rel="nofollow" title="Follow me on Facebook"><i class="icon icon-facebook notranslate" aria-hidden="true"></i></a></li> <li><a itemprop="sameAs" href="https://instagram.com/yegor256" rel="nofollow" title="Follow me on Instagram"><i class="icon icon-instagram notranslate" aria-hidden="true"></i></a></li> <li><a itemprop="sameAs" href="https://www.linkedin.com/in/yegor256" rel="nofollow" title="My LinkedIn profile"><i class="icon icon-linkedin notranslate" aria-hidden="true"></i></a></li> <li><a itemprop="sameAs" href="https://www.youtube.com/c/yegor256?sub_confirmation=1" rel="nofollow" title="My Youtube video channel"><i class="icon icon-youtube notranslate" aria-hidden="true"></i></a></li> <li><a itemprop="sameAs" href="https://www.pinterest.com/yegor256/" rel="nofollow" title="My Pinterest boards"><i class="icon icon-pinterest notranslate" aria-hidden="true"></i></a></li> <li><a itemprop="sameAs" href="https://angel.co/yegor256" rel="nofollow" title="My AngelList profile"><i class="icon icon-angellist notranslate" aria-hidden="true"></i></a></li> <li><a href="https://soundcloud.com/yegor256" rel="nofollow" title="My podcast"><i class="icon icon-podcast notranslate" aria-hidden="true"></i></a></li> <li><a href="https://itunes.apple.com/us/podcast/yegor256-podcast/id1150826721" rel="nofollow" title="My iTunes podcast"><i class="icon icon-itunes notranslate" aria-hidden="true"></i></a></li> <li><a href="https://t.me/yegor256news" rel="nofollow" title="My Telegram public channel"><i class="icon icon-telegram notranslate" aria-hidden="true"></i></a></li> <li><a href="mailto:blog@yegor256.com" rel="nofollow" title="Email me any time"><i class="icon icon-mail notranslate" aria-hidden="true"></i></a></li></ul><ul class="menu"> <li><a href="/" title="Home page">Home</a></li> <li /2014/07/29/docker-in-rultor.html><a href="/best.html" title="Best articles to read">12&#160;Best</a></li> <li /2014/07/29/docker-in-rultor.html><a href="/contents.html" title="The contents of the entire blog">All&#160;292</a></li> <li /2014/07/29/docker-in-rultor.html><a href="/webinars.html" title="My webinars">Webinars</a></li> <li /2014/07/29/docker-in-rultor.html><a href="/talks.html" title="Future and past conference talks">Talks</a></li> <li /2014/07/29/docker-in-rultor.html><a href="/books.html" title="The books I wrote">Books</a></li> <li /2014/07/29/docker-in-rultor.html><a href="/papers.html" title="My academic papers and patents">Papers</a></li> <li /2014/07/29/docker-in-rultor.html><a href="/pets.html" title="My loved pet projects">Pets</a></li> <li /2014/07/29/docker-in-rultor.html class="highlighted"><a href="/trainings.html" title="On-site trainings">Trainings</a></li> <li /2014/07/29/docker-in-rultor.html><a href="/award.html" title="Software quality award">Award</a></li> <li /2014/07/29/docker-in-rultor.html><a href="/testimonials.html" title="What some people say about me">Testimonials</a></li> <li /2014/07/29/docker-in-rultor.html><a href="/shift-m.html" title="Audio podcast about project management">Shift-M</a></li> <li /2014/07/29/docker-in-rultor.html><a href="/paintings.html" title="My paintings for sale">Paintings</a></li> <li><a href="https://ru.yegor256.com/" title="Немного на русском языке">По-русски</a></li></ul></nav><div class="search"> <form method="get" action="https://www.google.com/search" itemprop="potentialAction" itemscope="" itemtype="http://schema.org/SearchAction"> <meta itemprop="target" content="https://www.google.com/search?q={q}"/> <input name="sitesearch" value="yegor256.com" type="hidden"/> <input itemprop="query-input" type="text" id="search-query" class="field field-text" required="required" onfocus="$('.google').css('visibility', 'visible');" name="q" placeholder="Search..." autocomplete="off"/> <input type="image" src="/images/google-search-icon.svg" class="google" title="Search via Google" alt="Search via Google"/> </form></div><div class="hot"><ul></ul></div></header></div><section itemscope="" itemtype="http://schema.org/BlogPosting"><div class="wrapper"> <header><p class="printable"> <img src="https://api.qrserver.com/v1/create-qr-code/?data=https://www.yegor256.com/2014/07/29/docker-in-rultor.html&amp;format=svg" style="width:125px;height:125px;" alt="QR code"/></p><p class="printable"> <code itemprop="url">https://www.yegor256.com/2014/07/29/docker-in-rultor.html</code></p><h1 itemprop="name headline mainEntityOfPage">Every Build in Its Own Docker Container</h1><ul class="subline"> <li> <time itemprop="datePublished" datetime="2014-07-29T00:00:00+00:00"> 29 July 2014 </time> </li> <li class="printable" itemscope="" itemprop="author" itemtype="http://schema.org/Person"> <span itemprop="name">Yegor Bugayenko</span> </li> <li class="unprintable"> <i class="icon icon-comments"></i> <a href="https://www.yegor256.com/2014/07/29/docker-in-rultor.html#disqus_thread" itemprop="discussionUrl">comments</a> </li></ul><p class="unprintable"><figure class="badge"><a href="http://www.docker.io"><img src="http://doc.rultor.com/images/docker-logo.png" style="width:100px;max-width:100%;" alt="badge" /></a></figure><p><a href="http://www.docker.io">Docker</a> is a command line tool that can run a shell command in a virtual Linux, inside an isolated file system. Every time we build our projects, we want them to run in their own Docker containers. Take this Maven project for example:</p><figure class="highlight"><pre><code class="language-bash" data-lang="bash"><span></span>$ sudo docker run -i -t ubuntu mvn clean <span class="nb">test</span></code></pre></figure> <figure class="badge"><a href="http://www.rultor.com"><img src="http://doc.rultor.com/images/logo.svg" style="width:100px;max-width:100%;" alt="badge" /></a></figure><p>This command will start a new Ubuntu system and execute <code>mvn clean test</code> inside it. <a href="http://www.rultor.com">Rultor.com</a>, our virtual assistant, does exactly that with our builds, when we deploy, package, test and merge them.</p><h2 id="why-docker">Why Docker?</h2><p>What benefits does it give us? And why <a href="/2014/08/29/docker-non-root.html">Docker</a>, when there are many <a href="https://en.wikipedia.org/wiki/Operating_system-level_virtualization">other virtualization technologies</a>, like LXC, for example?</p><p>Well, there are a few very important benefits:</p><ul> <li><p>Image repository (hub.docker.com)</p></li> <li><p>Versioning</p></li> <li><p>Application-centric</p></li></ul><p>Let’s discuss them in details.</p><h2 id="image-repository">Image Repository</h2><p>Docker enables image sharing through its public repository at <a href="http://hub.docker.com">hub.docker.com</a>. This means that after I prepare a working environment for my application, I make an image out of it and push it to the hub.</p><p>Let’s say, I want my Maven build to be executed in a container with a pre-installed <code>graphviz</code> package (in order to enable <code>dot</code> command line tool). First, I would start a plain vanilla Ubuntu container, and install <code>graphviz</code> inside it:</p><figure class="highlight"><pre><code class="language-text" data-lang="text"><span></span>$ sudo docker run -i -t ubuntu /bin/bash
root@215d2696e8ad:/# sudo apt-get install -y graphviz
Reading package lists... Done
Building dependency tree
Reading state information... Done
The following extra packages will be installed:
...
root@215d2696e8ad:/# exit
$ sudo docker ps -a
CONTAINER ID        IMAGE               COMMAND             CREATED              STATUS                     PORTS               NAMES
215d2696e8ad        ubuntu:14.04        /bin/bash           About a minute ago   Exited (0) 3 seconds ago                       high_mccarthy</code></pre></figure><p>I have a container that stopped a few seconds ago. Container’s ID is <code>215d2696e8ad</code>. Now, I want to make it reusable for all further tests in Rultor.com. I have to create an image from it:</p><figure class="highlight"><pre><code class="language-bash" data-lang="bash"><span></span>$ sudo docker commit 215d2696e8ad yegor256/beta
c5ad7718fc0e20fe4bf2c8a9bfade4db8617a25366ca5b64be2e1e8aa0de6e52</code></pre></figure><p>I just made my new commit to a new image <code>yegor256/beta</code>. This image can be reused right now. I can create a new container from this image and it will have <code>graphviz</code> installed inside!</p><p>Now it’s time to share my image at Docker hub, in order to make it available for Rultor:</p><figure class="highlight"><pre><code class="language-text" data-lang="text"><span></span>$ sudo docker push yegor256/beta
The push refers to a repository [yegor256/beta] (len: 1)
Sending image list
Pushing repository yegor256/beta (1 tags)
511136ea3c5a: Image already pushed, skipping
d7ac5e4f1812: Image already pushed, skipping
2f4b4d6a4a06: Image already pushed, skipping
83ff768040a0: Image already pushed, skipping
6c37f792ddac: Image already pushed, skipping
e54ca5efa2e9: Image already pushed, skipping
c5ad7718fc0e: Image successfully pushed
Pushing tag for rev [c5ad7718fc0e] on {https://registry-1.docker.io/v1/repositories/yegor256/beta/tags/latest}</code></pre></figure><p>The last step is to configure Rultor to use this image in all builds. To do this, I will edit <a href="http://doc.rultor.com/reference.html"><code>.rultor.yml</code></a> in the root directory of my GitHub repository:</p><figure class="highlight"><pre><code class="language-text" data-lang="text"><span></span>docker:
  image: yegor256/beta</code></pre></figure><p>That’s it. From now on, Rultor will use my custom Docker image with pre-installed <code>graphviz</code>, in every build (merge, release, deploy, etc.)</p><p>Moreover, if and when I want to add something else to the image, it’s easy to do. Say, I want to install Ruby into my build image. I start a container from the image and install it (pay attention, I’m starting a container not from <code>ubuntu</code> image, as I did before, but from <code>yegor256/beta</code>):</p><figure class="highlight"><pre><code class="language-text" data-lang="text"><span></span>$ sudo docker run -i -t yegor256/beta /bin/bash
root@7e0fbd9806c9:/# sudo apt-get install -y ruby
Reading package lists... Done
Building dependency tree
Reading state information... Done
The following extra packages will be installed:
...
root@7e0fbd9806c9:/# exit
$ sudo docker ps -a
CONTAINER ID        IMAGE                  COMMAND             CREATED             STATUS                     PORTS               NAMES
7e0fbd9806c9        yegor256/beta:latest   /bin/bash           28 seconds ago      Exited (0) 2 seconds ago                       pensive_pare
215d2696e8ad        ubuntu:14.04           /bin/bash           10 minutes ago      Exited (0) 8 minutes ago                       high_mccarthy</code></pre></figure><p>You can now see that I have two containers. The first one is the one I am using right now; it contains Ruby. The second one is the one I was using before and it contains <code>graphviz</code>.</p><p>Now I have to commit again and push:</p><figure class="highlight"><pre><code class="language-bash" data-lang="bash"><span></span>$ sudo docker commit 7e0fbd9806c9 yegor256/beta
6cbfb7a6b18a2182f42171f6bb5aef67c4819b5c2795edffa6a63ba78aaada2d
$ sudo docker push yegor256/beta
...</code></pre></figure><p>Thus, this Docker hub is a very convenient feature for Rultor and similar systems.</p><h2 id="versioning">Versioning</h2><p>As you saw in the example above, every change to a Docker image has its own version (hash) and it’s possible to track changes. It is also possible to roll back to any particular change.</p><p>Rultor is not using this functionality itself, but Rultor users are able to control their build configurations with much better precision.</p><h2 id="application-centric">Application-Centric</h2><p>Docker, unlike LXC or Vagrant, for example, is application-centric. This means that when we start a container—we start an application. With other virtualization technologies, when you get a virtual machine—you get a fully functional Unix environment, where you can login through SSH and do whatever you want.</p><p>Docker makes things simpler. It doesn’t give you SSH access to container, but runs an application inside and shows you its output. This is exactly what we need in Rultor. We need to run an automated build (for example Maven or Bundler), see its output and get its exit code. If the code is not zero, we fail the build and report to the user.</p><p>This is how we run Maven build:</p><figure class="highlight"><pre><code class="language-bash" data-lang="bash"><span></span>$ sudo docker run --rm -i -t yegor256/rultor mvn clean <span class="nb">test</span>
<span class="o">[</span>INFO<span class="o">]</span> ------------------------------------------------------------------------
<span class="o">[</span>INFO<span class="o">]</span> Building jcabi-github <span class="m">0</span>.13
<span class="o">[</span>INFO<span class="o">]</span> ------------------------------------------------------------------------
<span class="o">[</span>INFO<span class="o">]</span>
<span class="o">[</span>INFO<span class="o">]</span> --- maven-clean-plugin:2.5:clean <span class="o">(</span>default-clean<span class="o">)</span> @ jcabi-github ---
<span class="o">[</span>INFO<span class="o">]</span>
...</code></pre></figure><p>As you can see, Maven starts immediately. We don’t worry about the internals of the container. We just start an application inside it.</p><p>Furthermore, thanks to the <code>--rm</code> option, the container gets destroyed immediately after Maven execution is finished.</p><p>This is what application-centric is about.</p><p>Our overall impression of Docker is highly positive.</p><p>ps. A compact version of this article was published at <a href="http://devops.com/blogs/build-docker-containers/">devops.com</a></p></p><nav class="buttons notranslate desktop-only"> <a href="http://www.facebook.com/sharer/sharer.php?u=https://www.yegor256.com/2014/07/29/docker-in-rultor.html" title="Share on Facebook" class="button" rel="nofollow"> <span class="count count-facebook">0</span> <i class="icon icon-facebook notranslate" aria-hidden="true"></i> </a> <a href="https://twitter.com/share?url=https://www.yegor256.com/2014/07/29/docker-in-rultor.html&amp;text=Every+Build+in+Its+Own+Docker+Container" title="Share on Twitter" class="button" rel="nofollow"> <span class="count count-twitter">0</span> <i class="icon icon-twitter notranslate" aria-hidden="true"></i> </a> <a href="https://plus.google.com/share?url=https://www.yegor256.com/2014/07/29/docker-in-rultor.html" title="Share on Google+" class="button" rel="nofollow"> <span class="count count-googleplus">0</span> <i class="icon icon-googleplus notranslate" aria-hidden="true"></i> </a> <a href="https://www.linkedin.com/cws/share?url=https://www.yegor256.com/2014/07/29/docker-in-rultor.html" title="Share on LinkedIn" class="button" rel="nofollow"> <span class="count count-linkedin">0</span> <i class="icon icon-linkedin notranslate" aria-hidden="true"></i> </a> <a href="http://reddit.com/submit?url=https://www.yegor256.com/2014/07/29/docker-in-rultor.html%3F2014-30&amp;title=Every+Build+in+Its+Own+Docker+Container" title="Share on Reddit" class="button" rel="nofollow"> <span class="count count-reddit">0</span> <i class="icon icon-reddit notranslate" aria-hidden="true"></i> </a> <a href="http://news.ycombinator.com/submitlink?u=https://www.yegor256.com/2014/07/29/docker-in-rultor.html%3F2014-30&amp;t=Every+Build+in+Its+Own+Docker+Container" title="Share on Hacker News" class="button" rel="nofollow"> <span class="count count-hackernews">0</span> <i class="icon icon-hackernews notranslate" aria-hidden="true"></i> </a> </nav> </header> <article class="main" itemprop="articleBody"><div > <figure class="badge"><a href="http://www.docker.io"><img src="http://doc.rultor.com/images/docker-logo.png" style="width:100px;max-width:100%;" alt="badge" /></a></figure><p><a href="http://www.docker.io">Docker</a> is a command line tool that can run a shell command in a virtual Linux, inside an isolated file system. Every time we build our projects, we want them to run in their own Docker containers. Take this Maven project for example:</p><figure class="highlight"><pre><code class="language-bash" data-lang="bash"><span></span>$ sudo docker run -i -t ubuntu mvn clean <span class="nb">test</span></code></pre></figure> <figure class="badge"><a href="http://www.rultor.com"><img src="http://doc.rultor.com/images/logo.svg" style="width:100px;max-width:100%;" alt="badge" /></a></figure><p>This command will start a new Ubuntu system and execute <code>mvn clean test</code> inside it. <a href="http://www.rultor.com">Rultor.com</a>, our virtual assistant, does exactly that with our builds, when we deploy, package, test and merge them.</p><h2 id="why-docker">Why Docker?</h2><p>What benefits does it give us? And why <a href="/2014/08/29/docker-non-root.html">Docker</a>, when there are many <a href="https://en.wikipedia.org/wiki/Operating_system-level_virtualization">other virtualization technologies</a>, like LXC, for example?</p><p>Well, there are a few very important benefits:</p><ul> <li><p>Image repository (hub.docker.com)</p></li> <li><p>Versioning</p></li> <li><p>Application-centric</p></li></ul><p>Let’s discuss them in details.</p><h2 id="image-repository">Image Repository</h2><p>Docker enables image sharing through its public repository at <a href="http://hub.docker.com">hub.docker.com</a>. This means that after I prepare a working environment for my application, I make an image out of it and push it to the hub.</p><p>Let’s say, I want my Maven build to be executed in a container with a pre-installed <code>graphviz</code> package (in order to enable <code>dot</code> command line tool). First, I would start a plain vanilla Ubuntu container, and install <code>graphviz</code> inside it:</p><figure class="highlight"><pre><code class="language-text" data-lang="text"><span></span>$ sudo docker run -i -t ubuntu /bin/bash
root@215d2696e8ad:/# sudo apt-get install -y graphviz
Reading package lists... Done
Building dependency tree
Reading state information... Done
The following extra packages will be installed:
...
root@215d2696e8ad:/# exit
$ sudo docker ps -a
CONTAINER ID        IMAGE               COMMAND             CREATED              STATUS                     PORTS               NAMES
215d2696e8ad        ubuntu:14.04        /bin/bash           About a minute ago   Exited (0) 3 seconds ago                       high_mccarthy</code></pre></figure><p>I have a container that stopped a few seconds ago. Container’s ID is <code>215d2696e8ad</code>. Now, I want to make it reusable for all further tests in Rultor.com. I have to create an image from it:</p><figure class="highlight"><pre><code class="language-bash" data-lang="bash"><span></span>$ sudo docker commit 215d2696e8ad yegor256/beta
c5ad7718fc0e20fe4bf2c8a9bfade4db8617a25366ca5b64be2e1e8aa0de6e52</code></pre></figure><p>I just made my new commit to a new image <code>yegor256/beta</code>. This image can be reused right now. I can create a new container from this image and it will have <code>graphviz</code> installed inside!</p><p>Now it’s time to share my image at Docker hub, in order to make it available for Rultor:</p><figure class="highlight"><pre><code class="language-text" data-lang="text"><span></span>$ sudo docker push yegor256/beta
The push refers to a repository [yegor256/beta] (len: 1)
Sending image list
Pushing repository yegor256/beta (1 tags)
511136ea3c5a: Image already pushed, skipping
d7ac5e4f1812: Image already pushed, skipping
2f4b4d6a4a06: Image already pushed, skipping
83ff768040a0: Image already pushed, skipping
6c37f792ddac: Image already pushed, skipping
e54ca5efa2e9: Image already pushed, skipping
c5ad7718fc0e: Image successfully pushed
Pushing tag for rev [c5ad7718fc0e] on {https://registry-1.docker.io/v1/repositories/yegor256/beta/tags/latest}</code></pre></figure><p>The last step is to configure Rultor to use this image in all builds. To do this, I will edit <a href="http://doc.rultor.com/reference.html"><code>.rultor.yml</code></a> in the root directory of my GitHub repository:</p><figure class="highlight"><pre><code class="language-text" data-lang="text"><span></span>docker:
  image: yegor256/beta</code></pre></figure><p>That’s it. From now on, Rultor will use my custom Docker image with pre-installed <code>graphviz</code>, in every build (merge, release, deploy, etc.)</p><p>Moreover, if and when I want to add something else to the image, it’s easy to do. Say, I want to install Ruby into my build image. I start a container from the image and install it (pay attention, I’m starting a container not from <code>ubuntu</code> image, as I did before, but from <code>yegor256/beta</code>):</p><figure class="highlight"><pre><code class="language-text" data-lang="text"><span></span>$ sudo docker run -i -t yegor256/beta /bin/bash
root@7e0fbd9806c9:/# sudo apt-get install -y ruby
Reading package lists... Done
Building dependency tree
Reading state information... Done
The following extra packages will be installed:
...
root@7e0fbd9806c9:/# exit
$ sudo docker ps -a
CONTAINER ID        IMAGE                  COMMAND             CREATED             STATUS                     PORTS               NAMES
7e0fbd9806c9        yegor256/beta:latest   /bin/bash           28 seconds ago      Exited (0) 2 seconds ago                       pensive_pare
215d2696e8ad        ubuntu:14.04           /bin/bash           10 minutes ago      Exited (0) 8 minutes ago                       high_mccarthy</code></pre></figure><p>You can now see that I have two containers. The first one is the one I am using right now; it contains Ruby. The second one is the one I was using before and it contains <code>graphviz</code>.</p><p>Now I have to commit again and push:</p><figure class="highlight"><pre><code class="language-bash" data-lang="bash"><span></span>$ sudo docker commit 7e0fbd9806c9 yegor256/beta
6cbfb7a6b18a2182f42171f6bb5aef67c4819b5c2795edffa6a63ba78aaada2d
$ sudo docker push yegor256/beta
...</code></pre></figure><p>Thus, this Docker hub is a very convenient feature for Rultor and similar systems.</p><h2 id="versioning">Versioning</h2><p>As you saw in the example above, every change to a Docker image has its own version (hash) and it’s possible to track changes. It is also possible to roll back to any particular change.</p><p>Rultor is not using this functionality itself, but Rultor users are able to control their build configurations with much better precision.</p><h2 id="application-centric">Application-Centric</h2><p>Docker, unlike LXC or Vagrant, for example, is application-centric. This means that when we start a container—we start an application. With other virtualization technologies, when you get a virtual machine—you get a fully functional Unix environment, where you can login through SSH and do whatever you want.</p><p>Docker makes things simpler. It doesn’t give you SSH access to container, but runs an application inside and shows you its output. This is exactly what we need in Rultor. We need to run an automated build (for example Maven or Bundler), see its output and get its exit code. If the code is not zero, we fail the build and report to the user.</p><p>This is how we run Maven build:</p><figure class="highlight"><pre><code class="language-bash" data-lang="bash"><span></span>$ sudo docker run --rm -i -t yegor256/rultor mvn clean <span class="nb">test</span>
<span class="o">[</span>INFO<span class="o">]</span> ------------------------------------------------------------------------
<span class="o">[</span>INFO<span class="o">]</span> Building jcabi-github <span class="m">0</span>.13
<span class="o">[</span>INFO<span class="o">]</span> ------------------------------------------------------------------------
<span class="o">[</span>INFO<span class="o">]</span>
<span class="o">[</span>INFO<span class="o">]</span> --- maven-clean-plugin:2.5:clean <span class="o">(</span>default-clean<span class="o">)</span> @ jcabi-github ---
<span class="o">[</span>INFO<span class="o">]</span>
...</code></pre></figure><p>As you can see, Maven starts immediately. We don’t worry about the internals of the container. We just start an application inside it.</p><p>Furthermore, thanks to the <code>--rm</code> option, the container gets destroyed immediately after Maven execution is finished.</p><p>This is what application-centric is about.</p><p>Our overall impression of Docker is highly positive.</p><p>ps. A compact version of this article was published at <a href="http://devops.com/blogs/build-docker-containers/">devops.com</a></p></div></article></div><div class="wrapper"> <related-posts /></div><div class="disqus" role="complementary"><p class="disqus_hint"> Please, use <a href="https://help.disqus.com/commenting/what-html-tags-are-allowed-within-comments">syntax highlighting</a> in your comments, to make them more readable.</p><div id="disqus_thread" class="disqus-thread"> <a>&nbsp;</a></div><script> var disqus_config = function () { this.page.url = document.location.href.split('?')[0].split('#')[0].replace('https://', 'http://'); this.page.identifier = this.page.url; }; (function() { var d = document, s = d.createElement('script'); s.src = '//yegor256.disqus.com/embed.js'; s.setAttribute('data-timestamp', +new Date()); (d.head || d.body).appendChild(s); })(); </script> <noscript><div><p class="red"> JavaScript is disabled in your browser, that's why you can't see comments under this post.</p></div></noscript></div><div class="wrapper"> <footer class="footer"><p> &copy; <span itemscope="" itemprop="copyrightHolder" itemtype="http://schema.org/Person"> <span itemprop="name">Yegor Bugayenko</span> </span> 2014&ndash;<span itemprop="copyrightYear">2018</span></p></footer></div></section><div class="wrapper unprintable" style="text-align:center;margin-top:2em;"> <a href="http://www.sixnines.io/h/3ba1652f"> <img src="//www.sixnines.io/b/3ba1652f?style=flat" alt="sixnines availability badge"/> </a></div><script src="//code.jquery.com/jquery-1.9.0.min.js"></script> <script src="/js/all.js?c998b88f617"></script> <script>var disqus_shortname = 'yegor256';</script> <script id="dsq-count-scr" src="//yegor256.disqus.com/count.js" async="async"></script> <script> (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){ (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o), m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m) })(window,document,'script','//www.google-analytics.com/analytics.js','ga'); ga('create', 'UA-1963507-32', 'auto'); ga('send', 'pageview'); </script> <script> Cd=document;Cr="&"+Math.random();Cp="&s=1"; Cd.cookie="b=b";if(Cd.cookie)Cp+="&c=1"; Cp+="&t="+(new Date()).getTimezoneOffset(); if(self!=top)Cp+="&f=1"; </script> <script> if(navigator.javaEnabled())Cp+="&j=1"; </script> <script> if(typeof(screen)!='undefined')Cp+="&w="+screen.width+"&h="+ screen.height+"&d="+(screen.colorDepth?screen.colorDepth:screen.pixelDepth); </script> <script> Cd.write("<img src='//c.hit.ua/hit?i=95870&g=0&x=2"+Cp+Cr+ "&r="+escape(Cd.referrer)+"&u="+escape(window.location.href)+ "' border='0' wi"+"dth='1' he"+"ight='1'/>"); </script> <script type="application/ld+json"> { "@context": "http://schema.org", "@type": "Person", "name": "Yegor Bugayenko", "url": "https://www.yegor256.com", "sameAs": [ "https://www.facebook.com/yegor256", "https://instagram.com/yegor256", "https://www.linkedin.com/in/yegor256", "https://twitter.com/yegor256", "https://github.com/yegor256", "https://www.pinterest.com/yegor256/" ] } </script> </body> </html> </article></div></section><div class="wrapper unprintable" style="text-align:center;margin-top:2em;"> <a href="http://www.sixnines.io/h/3ba1652f"> <img src="//www.sixnines.io/b/3ba1652f?style=flat" alt="sixnines availability badge"/> </a></div><script src="//code.jquery.com/jquery-1.9.0.min.js"></script> <script src="/js/all.js?c998b88f617"></script> <script>var disqus_shortname = 'yegor256';</script> <script id="dsq-count-scr" src="//yegor256.disqus.com/count.js" async="async"></script> <script> (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){ (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o), m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m) })(window,document,'script','//www.google-analytics.com/analytics.js','ga'); ga('create', 'UA-1963507-32', 'auto'); ga('send', 'pageview'); </script> <script> Cd=document;Cr="&"+Math.random();Cp="&s=1"; Cd.cookie="b=b";if(Cd.cookie)Cp+="&c=1"; Cp+="&t="+(new Date()).getTimezoneOffset(); if(self!=top)Cp+="&f=1"; </script> <script> if(navigator.javaEnabled())Cp+="&j=1"; </script> <script> if(typeof(screen)!='undefined')Cp+="&w="+screen.width+"&h="+ screen.height+"&d="+(screen.colorDepth?screen.colorDepth:screen.pixelDepth); </script> <script> Cd.write("<img src='//c.hit.ua/hit?i=95870&g=0&x=2"+Cp+Cr+ "&r="+escape(Cd.referrer)+"&u="+escape(window.location.href)+ "' border='0' wi"+"dth='1' he"+"ight='1'/>"); </script> <script type="application/ld+json"> { "@context": "http://schema.org", "@type": "Person", "name": "Yegor Bugayenko", "url": "https://www.yegor256.com", "sameAs": [ "https://www.facebook.com/yegor256", "https://instagram.com/yegor256", "https://www.linkedin.com/in/yegor256", "https://twitter.com/yegor256", "https://github.com/yegor256", "https://www.pinterest.com/yegor256/" ] } </script> </body> </html>
