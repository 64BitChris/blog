<!DOCTYPE html><html xmlns="http://www.w3.org/1999/xhtml" lang="en-US"><head><meta charset="utf-8"/><meta name="description" content="Personal blog of Yegor Bugayenko about programming, mostly in Java, bug also in PHP, JavaScript, Ruby, Python and Lisp"/><meta name="keywords" content="java blog, java, software development blog, programming blog, yegor bugayenko blog, quality of software, software blog, high quality programming, static analysis, software testing, ruby blog, javascript blog, php blog"/><meta name="viewport" content="width=device-width"/><link rel="icon" type="image/png" href="http://img.yegor256.com/icon-128x128.png"><link rel="shortcut icon" href="//img.yegor256.com/icon-64x64.png"/><link rel="alternate" type="application/rss+xml" title="RSS" href="http://www.yegor256.com/rss.xml"/><link rel="author" href="//plus.google.com/u/0/114792568016408327418?rel=author"/><link href="//netdna.bootstrapcdn.com/font-awesome/4.0.3/css/font-awesome.css" rel="stylesheet"><link rel="stylesheet" href="/css/layout.css?0bc9f9d"/><link rel="canonical" href="//www.yegor256.com/index.html"/> <script src="//code.jquery.com/jquery-2.1.0.min.js"></script><script src="/js/all.js?0bc9f9d"></script><title>Yegor Bugayenko About Programming (page 1)</title></head><body><div class="wrapper"> <header class="top"><div><a href="/"><img src="//img.yegor256.com/yegor-bugayenko.jpg" class="photo" alt="photo"/></a></div> <nav role="navigation"><ul class="menu"><li><a href="//www.twitter.com/yegor256"><i class="fa fa-twitter"></i></a></li><li><a href="/about-me.html">about me</a></li><li><a href="//feeds.feedburner.com/yegor256"><i class="fa fa-rss"></i></a></li><li><a href="//feedburner.google.com/fb/a/mailverify?uri=yegor256&amp;loc=en_US">subscribe</a></li></ul> </nav><div class="gcse" role="search"><div class="gcse-search"></div></div> </header></div><div class="wrapper"> <section class="front"><p> <time datetime="2014-05-14T00:00:00+00:00"> 14 May 2014 </time></p> <header><h1> <a href="/2014/05/14/object-oriented-github-java-sdk.html"> Object-Oriented Github API </a></h1> </header> <article> <figure class='badge'><img src='http://img.yegor256.com/2014/05/github-logo.png' style='width:128px' alt='badge'/></figure><p><a href="http://www.github.com">Github</a> is an awesome platform for maintaining Git sources and tracking project issues. I moved all my projects (both private and public) to Github about three years ago and have no regrets. Moreover, Github gives access to almost all of its features through RESTful JSON API.</p><p>There are <a href="https://developer.github.com/libraries/">a few</a> Java SDKs that wrap and expose the API. I tried to use them, but faced a number of issues:</p><ul><li>They are not really object-oriented (even though one of them has a description that says it is)</li><li>They are not based on JSR-353 (JSON Java API)</li><li>They provide no mocking instruments</li><li>They don't cover the entire API and can't be extended</li></ul><figure class='badge'><img src='http://img.jcabi.com/logo-square.png' style='width:64px' alt='badge'/></figure><p>Keeping in mind all those drawbacks, I created my own library — <a href="http://github.jcabi.com">jcabi-github</a>. Let's look at its most important advantages.</p><h2 id="toc_0">Object Oriented for Real</h2><p>Github server is an object. A collection of issues is an object, an individual issue is an object, its author is an author, etc. For example, to retrieve the name of the author we use:</p><div class="highlight"><pre><code class="java"><span class="n">Github</span> <span class="n">github</span> <span class="o">=</span> <span class="k">new</span> <span class="n">RtGithub</span><span class="o">(</span><span class="cm">/* credentials */</span><span class="o">);</span>
<span class="n">Repos</span> <span class="n">repos</span> <span class="o">=</span> <span class="n">github</span><span class="o">.</span><span class="na">repos</span><span class="o">();</span>
<span class="n">Repo</span> <span class="n">repo</span> <span class="o">=</span> <span class="n">repos</span><span class="o">.</span><span class="na">get</span><span class="o">(</span><span class="k">new</span> <span class="n">Coordinates</span><span class="o">.</span><span class="na">Simple</span><span class="o">(</span><span class="s">"jcabi/jcabi-github"</span><span class="o">));</span>
<span class="n">Issues</span> <span class="n">issues</span> <span class="o">=</span> <span class="n">github</span><span class="o">.</span><span class="na">issues</span><span class="o">();</span>
<span class="n">Issue</span> <span class="n">issue</span> <span class="o">=</span> <span class="n">issues</span><span class="o">.</span><span class="na">get</span><span class="o">(</span><span class="mi">123</span><span class="o">);</span>
<span class="n">User</span> <span class="n">author</span> <span class="o">=</span> <span class="k">new</span> <span class="n">Issue</span><span class="o">.</span><span class="na">Smart</span><span class="o">(</span><span class="n">issue</span><span class="o">).</span><span class="na">author</span><span class="o">();</span>
<span class="n">System</span><span class="o">.</span><span class="na">out</span><span class="o">.</span><span class="na">println</span><span class="o">(</span><span class="n">author</span><span class="o">.</span><span class="na">name</span><span class="o">());</span>
</code></pre></div><p>Needless to say, <code>Github</code>, <code>Repos</code>, <code>Repo</code>, <code>Issues</code>, <code>Issue</code>, and <code>User</code> are interfaces. Classes that implement them are not visible in the library.</p><h2 id="toc_1">Mock Engine</h2><p><code>MkGithub</code> class is a mock version of a Github server. It behaves almost exactly the same as a real server and is the perfect instrument for unit testing. For example, say that you're testing a method that is supposed to post a new issue to Github and add a message into it. Here is how the unit test would look:</p><div class="highlight"><pre><code class="java"><span class="kd">public</span> <span class="kd">class</span> <span class="nc">FooTest</span> <span class="o">{</span>
  <span class="nd">@Test</span>
  <span class="kd">public</span> <span class="kt">void</span> <span class="nf">createsIssueAndPostsMessage</span><span class="o">()</span> <span class="o">{</span>
    <span class="n">Github</span> <span class="n">github</span> <span class="o">=</span> <span class="k">new</span> <span class="n">MkGithub</span><span class="o">(</span><span class="s">"jeff"</span><span class="o">);</span>
    <span class="n">github</span><span class="o">.</span><span class="na">repos</span><span class="o">().</span><span class="na">create</span><span class="o">(</span>
      <span class="n">Json</span><span class="o">.</span><span class="na">createObjectBuilder</span><span class="o">().</span><span class="na">add</span><span class="o">(</span><span class="s">"name"</span><span class="o">,</span> <span class="n">owner</span><span class="o">).</span><span class="na">build</span><span class="o">()</span>
    <span class="o">);</span>
    <span class="k">new</span> <span class="nf">Foo</span><span class="o">().</span><span class="na">doTheThing</span><span class="o">(</span><span class="n">github</span><span class="o">);</span>
    <span class="n">MatcherAssert</span><span class="o">.</span><span class="na">assertThat</span><span class="o">(</span>
      <span class="n">github</span><span class="o">.</span><span class="na">issues</span><span class="o">().</span><span class="na">get</span><span class="o">(</span><span class="mi">1</span><span class="o">).</span><span class="na">comments</span><span class="o">().</span><span class="na">iterate</span><span class="o">(),</span>
      <span class="n">Matchers</span><span class="o">.</span><span class="na">not</span><span class="o">(</span><span class="n">Matchers</span><span class="o">.</span><span class="na">emptyIterable</span><span class="o">())</span>
    <span class="o">);</span>
  <span class="o">}</span>
<span class="o">}</span>
</code></pre></div><p>This is much more convenient and compact than traditional mocking via <a href="https://code.google.com/p/mockito/">Mockito</a> or a similar framework.</p><h2 id="toc_2">Extendable</h2><p>It is based on JSR-353 and uses jcabi-http for HTTP request processing. This combination makes it highly customizable and extendable, when some Github feature is not covered by the library (and there are many of them).</p><p>For example, you want to get the value of <code>hireable</code> attribute of a <code>User</code>. Class <code>User.Smart</code> doesn't have a method for it. So, here is how you would get it:</p><div class="highlight"><pre><code class="java"><span class="n">User</span> <span class="n">user</span> <span class="o">=</span> <span class="c1">// get it somewhere</span>
<span class="c1">// name() method exists in User.Smart, let's use it</span>
<span class="n">System</span><span class="o">.</span><span class="na">out</span><span class="o">.</span><span class="na">println</span><span class="o">(</span><span class="k">new</span> <span class="n">User</span><span class="o">.</span><span class="na">Smart</span><span class="o">(</span><span class="n">user</span><span class="o">).</span><span class="na">name</span><span class="o">());</span>
<span class="c1">// there is no hireable() method there</span>
<span class="n">System</span><span class="o">.</span><span class="na">out</span><span class="o">.</span><span class="na">println</span><span class="o">(</span><span class="n">user</span><span class="o">.</span><span class="na">json</span><span class="o">().</span><span class="na">getString</span><span class="o">(</span><span class="s">"hireable"</span><span class="o">));</span>
</code></pre></div><p>We're using method <code>json()</code> that returns an instance of <a href="http://docs.oracle.com/javaee/7/api/javax/json/JsonObject.html"><code>JsonObject</code></a> from JSR-353 (part of Java7).</p><p>No other library allows such direct access to JSON objects returned by the Github server.</p><p>Let's see another example. Say, you want to use some feature from Github that is not covered by the API. You get a <code>Request</code> object from <code>Github</code> interface and directly access the HTTP entry point of the server:</p><div class="highlight"><pre><code class="java"><span class="n">Github</span> <span class="n">github</span> <span class="o">=</span> <span class="k">new</span> <span class="n">RtGithub</span><span class="o">(</span><span class="n">oauthKey</span><span class="o">);</span>
<span class="kt">int</span> <span class="n">found</span> <span class="o">=</span> <span class="n">github</span><span class="o">.</span><span class="na">entry</span><span class="o">()</span>
  <span class="o">.</span><span class="na">uri</span><span class="o">().</span><span class="na">path</span><span class="o">(</span><span class="s">"/search/repositories"</span><span class="o">).</span><span class="na">back</span><span class="o">()</span>
  <span class="o">.</span><span class="na">method</span><span class="o">(</span><span class="n">Request</span><span class="o">.</span><span class="na">GET</span><span class="o">)</span>
  <span class="o">.</span><span class="na">as</span><span class="o">(</span><span class="n">JsonResponse</span><span class="o">.</span><span class="na">class</span><span class="o">)</span>
  <span class="o">.</span><span class="na">getJsonObject</span><span class="o">()</span>
  <span class="o">.</span><span class="na">getNumber</span><span class="o">(</span><span class="s">"total_count"</span><span class="o">)</span>
  <span class="o">.</span><span class="na">intValue</span><span class="o">();</span>
</code></pre></div><p><a href="http://http.jcabi.com">jcabi-http</a> HTTP client is used by <a href="http://github.jcabi.com">jcabi-github</a>.</p><h2 id="toc_3">Immutable</h2><p>All classes are truly immutable and annotated with <a href="http://aspects.jcabi.com/annotation-immutable.html"><code>@Immutable</code></a>. This may sound like a minor benefit, but it was very important for me. I'm using this annotation in all my projects to ensure my classes are truly immutable.</p><h2 id="toc_4">Version 0.8</h2><p>A few days ago we released the latest <a href="https://github.com/jcabi/jcabi-github/releases/tag/jcabi-0.8">version 0.8</a>. It is a major release, that included over 1200 commits. It covers the entire Github API and is supposed to be very stable. The library ships as a JAR dependency in <a href="http://repo1.maven.org/maven2/com/jcabi/jcabi-github">Maven Central</a>:</p><div class="highlight"><pre><code class="xml"><span class="nt">&lt;dependency&gt;</span>
  <span class="nt">&lt;groupId&gt;</span>com.jcabi<span class="nt">&lt;/groupId&gt;</span>
  <span class="nt">&lt;artifactId&gt;</span>jcabi-github<span class="nt">&lt;/artifactId&gt;</span>
  <span class="nt">&lt;version&gt;</span>0.8<span class="nt">&lt;/version&gt;</span>
<span class="nt">&lt;/dependency&gt;</span>
</code></pre></div></article> <a href="/2014/05/14/object-oriented-github-java-sdk.html#disqus_thread">comments</a> </section></div><div class="wrapper"> <section class="front"><p> <time datetime="2014-05-13T00:00:00+00:00"> 13 May 2014 </time></p> <header><h1> <a href="/2014/05/13/why-null-is-bad.html"> Why NULL is Bad? </a></h1> </header> <article><p>A simple example of <code>NULL</code> usage in Java:</p><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><code class="java">1
2
3
4
5
6
7</code></pre></div></td><td class="code"><div class="highlight"><pre><span class="kd">public</span> <span class="n">Employee</span> <span class="nf">getByName</span><span class="o">(</span><span class="n">String</span> <span class="n">name</span><span class="o">)</span> <span class="o">{</span>
  <span class="kt">int</span> <span class="n">id</span> <span class="o">=</span> <span class="n">database</span><span class="o">.</span><span class="na">find</span><span class="o">(</span><span class="n">name</span><span class="o">);</span>
  <span class="k">if</span> <span class="o">(</span><span class="n">id</span> <span class="o">==</span> <span class="mi">0</span><span class="o">)</span> <span class="o">{</span>
    <span class="k">return</span> <span class="kc">null</span><span class="o">;</span>
  <span class="o">}</span>
  <span class="k">return</span> <span class="k">new</span> <span class="nf">Employee</span><span class="o">(</span><span class="n">id</span><span class="o">);</span>
<span class="o">}</span></pre></div></td></tr></table><p>What is wrong with this method?</p><p>It may return <code>NULL</code> instead of an object — that's what is wrong. <code>NULL</code> is a terrible practice in an object-oriented paradigm and should be avoided at all costs. There have been a number of opinions about this published already, including <a href="http://www.infoq.com/presentations/Null-References-The-Billion-Dollar-Mistake-Tony-Hoare">Null References, The Billion Dollar Mistake</a> presentation by Tony Hoare and the entire <a href="http://www.amazon.com/Object-Thinking-DV-Microsoft-Professional-David/dp/0735619654">Object Thinking</a> book by David West.</p><p>Here, I'll try to summarize all the arguments and show examples of how <code>NULL</code> usage can be avoided and replaced with proper object-oriented constructs.</p><p>Basically, there are two possible alternatives to <code>NULL</code>.</p><p>The first one is <strong><a href="http://en.wikipedia.org/wiki/Null_Object_pattern">Null Object</a></strong> design pattern (the best way is to make it a constant):</p><div class="highlight"><pre><code class="java"><span class="kd">public</span> <span class="n">Employee</span> <span class="nf">getByName</span><span class="o">(</span><span class="n">String</span> <span class="n">name</span><span class="o">)</span> <span class="o">{</span>
  <span class="kt">int</span> <span class="n">id</span> <span class="o">=</span> <span class="n">database</span><span class="o">.</span><span class="na">find</span><span class="o">(</span><span class="n">name</span><span class="o">);</span>
  <span class="k">if</span> <span class="o">(</span><span class="n">id</span> <span class="o">==</span> <span class="mi">0</span><span class="o">)</span> <span class="o">{</span>
    <span class="k">return</span> <span class="n">Employee</span><span class="o">.</span><span class="na">NOBODY</span><span class="o">;</span>
  <span class="o">}</span>
  <span class="k">return</span> <span class="nf">Employee</span><span class="o">(</span><span class="n">id</span><span class="o">);</span>
<span class="o">}</span>
</code></pre></div><p>The second possible alternative is to <a href="http://martinfowler.com/ieeeSoftware/failFast.pdf">fail fast</a> by throwing an <strong>Exception</strong> when you can't return an object:</p><div class="highlight"><pre><code class="java"><span class="kd">public</span> <span class="n">Employee</span> <span class="nf">getByName</span><span class="o">(</span><span class="n">String</span> <span class="n">name</span><span class="o">)</span> <span class="o">{</span>
  <span class="kt">int</span> <span class="n">id</span> <span class="o">=</span> <span class="n">database</span><span class="o">.</span><span class="na">find</span><span class="o">(</span><span class="n">name</span><span class="o">);</span>
  <span class="k">if</span> <span class="o">(</span><span class="n">id</span> <span class="o">==</span> <span class="mi">0</span><span class="o">)</span> <span class="o">{</span>
    <span class="k">throw</span> <span class="k">new</span> <span class="nf">EmployeeNotFoundException</span><span class="o">(</span><span class="n">name</span><span class="o">);</span>
  <span class="o">}</span>
  <span class="k">return</span> <span class="nf">Employee</span><span class="o">(</span><span class="n">id</span><span class="o">);</span>
<span class="o">}</span>
</code></pre></div><p>Now, let's see the arguments against <code>NULL</code>.</p><p>Besides Tony Hoare's presentation and David West's book mentioned above, I read these publications before writing this post: <a href="http://www.amazon.com/dp/0132350882/">Clean Code</a> by Robert Martin, <a href="http://www.amazon.com/dp/0735619670/">Code Complete</a> by Steve McConnell, <a href="http://elegantcode.com/2010/05/01/say-no-to-null/">Say "No" to "Null"</a> by John Sonmez, <a href="http://stackoverflow.com/questions/1274792/is-returning-null-bad-design">Is returning null bad design?</a> discussion at StackOverflow.</p><h2 id="toc_0">Ad-hoc Error Handling</h2><p>Every time you get an object as an input you must check whether it is <code>NULL</code> or a valid object reference. If you forget to check, a <a href="http://docs.oracle.com/javase/7/docs/api/java/lang/NullPointerException.html"><code>NullPointerException</code></a> (NPE) may break execution in runtime. Thus, your logic becomes polluted with multiple checks and if/then/else forks:</p><div class="highlight"><pre><code class="java"><span class="c1">// this is a terrible design, don't reuse</span>
<span class="n">Employee</span> <span class="n">employee</span> <span class="o">=</span> <span class="n">dept</span><span class="o">.</span><span class="na">getByName</span><span class="o">(</span><span class="s">"Jeffrey"</span><span class="o">);</span>
<span class="k">if</span> <span class="o">(</span><span class="n">employee</span> <span class="o">==</span> <span class="kc">null</span><span class="o">)</span> <span class="o">{</span>
  <span class="n">System</span><span class="o">.</span><span class="na">out</span><span class="o">.</span><span class="na">println</span><span class="o">(</span><span class="s">"can't find an employee"</span><span class="o">);</span>
  <span class="n">System</span><span class="o">.</span><span class="na">exit</span><span class="o">(-</span><span class="mi">1</span><span class="o">);</span>
<span class="o">}</span> <span class="k">else</span> <span class="o">{</span>
  <span class="n">employee</span><span class="o">.</span><span class="na">transferTo</span><span class="o">(</span><span class="n">dept2</span><span class="o">);</span>
<span class="o">}</span>
</code></pre></div><p>This is how exceptional situations are supposed to be handled in <a href="http://en.wikipedia.org/wiki/C_%28programming_language%29">C</a> and other imperative procedural languages. OOP introduced <a href="http://en.wikipedia.org/wiki/Exception_handling">exception handling</a> primarily to get rid of these ad-hoc error handling blocks. In OOP, we let exceptions bubble up until they reach an application-wide error handler and our code becomes much cleaner and shorter:</p><div class="highlight"><pre><code class="java"><span class="n">dept</span><span class="o">.</span><span class="na">getByName</span><span class="o">(</span><span class="s">"Jeffrey"</span><span class="o">).</span><span class="na">transferTo</span><span class="o">(</span><span class="n">dept2</span><span class="o">);</span>
</code></pre></div><p>Consider <code>NULL</code> references an inheritance of procedural programming, and use 1) Null Objects or 2) Exceptions instead.</p><h2 id="toc_1">Ambiguous Semantic</h2><p>In order to explicitly convey its meaning, the function <code>getByName()</code> has to be named <code>getByNameOrNullIfNotFound()</code>. The same should happen with every function that returns an object or <code>NULL</code>. Otherwise, ambiguity is inevitable for a code reader. Thus, to keep semantic unambiguous, you should give longer names to functions.</p><p>To get rid of this ambiguity, always return a real object, a null object or throw an exception.</p><p>Some may argue that we sometimes have to return <code>NULL</code>, for the sake of performance. For example, method <code>get()</code> of interface <a href="http://docs.oracle.com/javase/7/docs/api/java/util/Map.html"><code>Map</code></a> in Java returns <code>NULL</code> when there is no such item in the map:</p><div class="highlight"><pre><code class="java"><span class="n">Employee</span> <span class="n">employee</span> <span class="o">=</span> <span class="n">employees</span><span class="o">.</span><span class="na">get</span><span class="o">(</span><span class="s">"Jeffrey"</span><span class="o">);</span>
<span class="k">if</span> <span class="o">(</span><span class="n">employee</span> <span class="o">==</span> <span class="kc">null</span><span class="o">)</span> <span class="o">{</span>
  <span class="k">throw</span> <span class="k">new</span> <span class="nf">EmployeeNotFoundException</span><span class="o">();</span>
<span class="o">}</span>
<span class="k">return</span> <span class="n">employee</span><span class="o">;</span>
</code></pre></div><p>This code searches the map only once due to the usage of <code>NULL</code> in <code>Map</code>. If we would refactor <code>Map</code> so that its method <code>get()</code> will throw an exception if nothing is found, our code will look like this:</p><div class="highlight"><pre><code class="java"><span class="k">if</span> <span class="o">(!</span><span class="n">employees</span><span class="o">.</span><span class="na">containsKey</span><span class="o">(</span><span class="s">"Jeffrey"</span><span class="o">))</span> <span class="o">{</span> <span class="c1">// first search</span>
  <span class="k">throw</span> <span class="k">new</span> <span class="nf">EmployeeNotFoundException</span><span class="o">();</span>
<span class="o">}</span>
<span class="k">return</span> <span class="n">employees</span><span class="o">.</span><span class="na">get</span><span class="o">(</span><span class="s">"Jeffrey"</span><span class="o">);</span> <span class="c1">// second search</span>
</code></pre></div><p>Obviously, this is method is twice as slow as the first one. What to do?</p><p>The <code>Map</code> interface (no offense to its authors) has a design flaw. Its method <code>get()</code> should have been returning an <code>Iterator</code> so that our code would look like:</p><div class="highlight"><pre><code class="java"><span class="n">Iterator</span> <span class="n">found</span> <span class="o">=</span> <span class="n">Map</span><span class="o">.</span><span class="na">search</span><span class="o">(</span><span class="s">"Jeffrey"</span><span class="o">);</span>
<span class="k">if</span> <span class="o">(!</span><span class="n">found</span><span class="o">.</span><span class="na">hasNext</span><span class="o">())</span> <span class="o">{</span>
  <span class="k">throw</span> <span class="k">new</span> <span class="nf">EmployeeNotFoundException</span><span class="o">();</span>
<span class="o">}</span>
<span class="k">return</span> <span class="n">found</span><span class="o">.</span><span class="na">next</span><span class="o">();</span>
</code></pre></div><p>BTW, that is exactly how C++ STL <a href="http://en.cppreference.com/w/cpp/container/map/find">map::find()</a> method is designed.</p><h2 id="toc_2">Computer Thinking vs. Object Thinking</h2><p>Statement <code>if (employee == null)</code> is understood by someone who knows that an object in Java is a pointer to a data structure and that <code>NULL</code> is a pointer to nothing (<code>0x00000000</code>, in Intel x86 processors).</p><p>However, if you start thinking as an object, this statement makes much less sense. This is how our code looks from an object point of view:</p><div class="highlight"><pre><code class="text">- Hello, is it a software department?
- Yes.
- Let me talk to your employee "Jeffrey" please.
- Hold the line please...
- Hello.
- Are you NULL?
</code></pre></div><p>The last question in this conversation sounds weird, doesn’t it?</p><p>Instead, if they hang up the phone after our request to speak to Jeffrey, that causes a problem for us (Exception). At that point, we try to call again or inform our supervisor that we can't reach Jeffrey and complete a bigger transaction.</p><p>Alternatively, they may let us speak to another person, who is not Jeffrey, but who can help with most of our questions or refuse to help if we need something "Jeffrey specific" (Null Object).</p><h2 id="toc_3">Slow Failing</h2><p>Instead of <a href="http://martinfowler.com/ieeeSoftware/failFast.pdf">failing fast</a>, the code above attempts to die slowly, killing others on its way. Instead of letting everyone know that something went wrong and that an exception handling should start immediately, it is hiding this failure from its client.</p><p>This argument is close to the "ad-hoc error handling" discussed above.</p><p>It is a good practice to make your code as fragile as possible, letting it break when necessary.</p><p>Make your methods extremely demanding as to the data they manipulate. Let them complain by throwing exceptions, if the provided data provided is not sufficient or simply doesn’t fit with the main usage scenario of the method.</p><p>Otherwise, return a Null Object, that exposes some common behavior and throws exceptions on all other calls:</p><div class="highlight"><pre><code class="java"><span class="kd">public</span> <span class="n">Employee</span> <span class="nf">getByName</span><span class="o">(</span><span class="n">String</span> <span class="n">name</span><span class="o">)</span> <span class="o">{</span>
  <span class="kt">int</span> <span class="n">id</span> <span class="o">=</span> <span class="n">database</span><span class="o">.</span><span class="na">find</span><span class="o">(</span><span class="n">name</span><span class="o">);</span>
  <span class="n">Employee</span> <span class="n">employee</span><span class="o">;</span>
  <span class="k">if</span> <span class="o">(</span><span class="n">id</span> <span class="o">==</span> <span class="mi">0</span><span class="o">)</span> <span class="o">{</span>
    <span class="n">employee</span> <span class="o">=</span> <span class="k">new</span> <span class="n">Employee</span><span class="o">()</span> <span class="o">{</span>
      <span class="nd">@Override</span>
      <span class="kd">public</span> <span class="n">String</span> <span class="nf">name</span><span class="o">()</span> <span class="o">{</span>
        <span class="k">return</span> <span class="s">"anonymous"</span><span class="o">;</span>
      <span class="o">}</span>
      <span class="nd">@Override</span>
      <span class="kd">public</span> <span class="kt">void</span> <span class="nf">transferTo</span><span class="o">(</span><span class="n">Department</span> <span class="n">dept</span><span class="o">)</span> <span class="o">{</span>
        <span class="k">throw</span> <span class="k">new</span> <span class="nf">AnonymousEmployeeException</span><span class="o">(</span>
          <span class="s">"I can't be transferred, I'm anonymous"</span>
        <span class="o">);</span>
      <span class="o">}</span>
    <span class="o">};</span>
  <span class="o">}</span> <span class="k">else</span> <span class="o">{</span>
    <span class="n">employee</span> <span class="o">=</span> <span class="n">Employee</span><span class="o">(</span><span class="n">id</span><span class="o">);</span>
  <span class="o">}</span>
  <span class="k">return</span> <span class="n">employee</span><span class="o">;</span>
<span class="o">}</span>
</code></pre></div><h2 id="toc_4">Mutable and Incomplete Objects</h2><p>In general, it is highly recommended to design objects with immutability in mind. This means that an object gets all necessary knowledge during its instantiating and never changes its state during the entire lifecycle.</p><p>Very often, <code>NULL</code> values are used in <a href="http://en.wikipedia.org/wiki/Lazy_loading">lazy loading</a>, to make objects incomplete and mutable. For example:</p><div class="highlight"><pre><code class="java"><span class="kd">public</span> <span class="kd">class</span> <span class="nc">Department</span> <span class="o">{</span>
  <span class="kd">private</span> <span class="n">Employee</span> <span class="n">found</span> <span class="o">=</span> <span class="kc">null</span><span class="o">;</span>
  <span class="kd">public</span> <span class="kd">synchronized</span> <span class="n">Employee</span> <span class="nf">manager</span><span class="o">()</span> <span class="o">{</span>
    <span class="k">if</span> <span class="o">(</span><span class="k">this</span><span class="o">.</span><span class="na">found</span> <span class="o">==</span> <span class="kc">null</span><span class="o">)</span> <span class="o">{</span>
      <span class="k">this</span><span class="o">.</span><span class="na">found</span> <span class="o">=</span> <span class="k">new</span> <span class="n">Employee</span><span class="o">(</span><span class="s">"Jeffrey"</span><span class="o">);</span>
    <span class="o">}</span>
    <span class="k">return</span> <span class="k">this</span><span class="o">.</span><span class="na">found</span><span class="o">;</span>
  <span class="o">}</span>
<span class="o">}</span>
</code></pre></div><p>This technology, although widely used, is an anti-pattern in OOP. Mostly because it makes an object responsible for performance problems of the computational platform, which is something an <code>Employee</code> object should not be aware of.</p><p>Instead of managing a state and exposing its business-relevant behavior, an object has to take care of the caching of its own results — this is what lazy loading is about.</p><p>Caching is not something an employee does in the office, does he?</p><p>The solution? Don't use lazy loading in such a primitive way, as in the example above. Instead, move this caching problem to another layer of your application.</p><p>For example, in Java, you can use aspect-oriented programming aspects. For example, <a href="http://aspects.jcabi.com">jcabi-aspects</a> has <a href="http://aspects.jcabi.com/annotation-cacheable.html"><code>@Cacheable</code></a> annotation that caches the value returned by a method:</p><div class="highlight"><pre><code class="java"><span class="kn">import</span> <span class="nn">com.jcabi.aspects.Cacheable</span><span class="o">;</span>
<span class="kd">public</span> <span class="kd">class</span> <span class="nc">Department</span> <span class="o">{</span>
  <span class="nd">@Cacheable</span><span class="o">(</span><span class="n">forever</span> <span class="o">=</span> <span class="kc">true</span><span class="o">)</span>
  <span class="kd">public</span> <span class="n">Employee</span> <span class="nf">manager</span><span class="o">()</span> <span class="o">{</span>
    <span class="k">return</span> <span class="k">new</span> <span class="nf">Employee</span><span class="o">(</span><span class="s">"Jacky Brown"</span><span class="o">);</span>
  <span class="o">}</span>
<span class="o">}</span>
</code></pre></div><p>I hope this analysis was convincing enough that you will stop <code>NULL</code>-ing your code :)</p></article> <a href="/2014/05/13/why-null-is-bad.html#disqus_thread">comments</a> </section></div><div class="wrapper"> <section class="front"><p> <time datetime="2014-05-05T00:00:00+00:00"> 5 May 2014 </time></p> <header><h1> <a href="/2014/05/05/oop-alternative-to-utility-classes.html"> OOP Alternative to Utility Classes </a></h1> </header> <article><p>A utility class (aka helper class) is a "structure" that has only static methods and encapsulates no state. <code>StringUtils</code>, <code>IOUtils</code>, <code>FileUtils</code> from <a href="http://commons.apache.org/">Apache Commons</a>; <code>Iterables</code> and <code>Iterators</code> from <a href="https://code.google.com/p/guava-libraries/">Guava</a>, and <a href="http://docs.oracle.com/javase/7/docs/api/java/nio/file/Files.html"><code>Files</code></a> from JDK7 are perfect examples of utility classes.</p><p>This design idea is very popular in the Java world (as well as C#, Ruby, etc.) because utility classes provide common functionality used everywhere.</p><p>Here, we want to follow the <a href="http://en.wikipedia.org/wiki/Don't_repeat_yourself">DRY principle</a> and avoid duplication. Therefore, we place common code blocks into utility classes and reuse them when necessary:</p><div class="highlight"><pre><code class="java"><span class="c1">// This is a terrible design, don't reuse</span>
<span class="kd">public</span> <span class="kd">class</span> <span class="nc">NumberUtils</span> <span class="o">{</span>
  <span class="kd">public</span> <span class="kd">static</span> <span class="kt">int</span> <span class="nf">max</span><span class="o">(</span><span class="kt">int</span> <span class="n">a</span><span class="o">,</span> <span class="kt">int</span> <span class="n">b</span><span class="o">)</span> <span class="o">{</span>
    <span class="k">return</span> <span class="n">a</span> <span class="o">&gt;</span> <span class="n">b</span> <span class="o">?</span> <span class="n">a</span> <span class="o">:</span> <span class="n">b</span><span class="o">;</span>
  <span class="o">}</span>
<span class="o">}</span>
</code></pre></div><p>Indeed, this a very convenient technique!?</p><h2 id="toc_0">Utility Classes Are Evil</h2><p>However, in an object-oriented world, utility classes are considered a very bad (some even may say "terrible") practice.</p><p>There have been many discussions of this subject; to name a few: <a href="http://blogs.msdn.com/b/nickmalik/archive/2005/09/06/461404.aspx">Are Helper Classes Evil?</a> by Nick Malik, <a href="http://smart421.wordpress.com/2011/08/31/why-helper-singletons-and-utility-classes-are-mostly-bad-2/">Why helper, singletons and utility classes are mostly bad</a> by Simon Hart, <a href="http://www.marshallward.org/avoiding-utility-classes.html">Avoiding Utility Classes</a> by Marshal Ward, <a href="http://www.jroller.com/DhavalDalal/entry/kill_that_util_class">Kill That Util Class!</a> by Dhaval Dalal, <a href="http://www.robbagby.com/posts/helper-classes-are-a-code-smell/">Helper Classes Are A Code Smell</a> by Rob Bagby.</p><p>Additionally, there are a few questions on StackExchange about utility classes: <a href="http://stackoverflow.com/questions/3339929/if-a-utilities-class-is-evil-where-do-i-put-my-generic-code">If a “Utilities” class is evil, where do I put my generic code?</a>, <a href="http://stackoverflow.com/questions/3340032/utility-classes-are-evil">Utility Classes are Evil</a>.</p><p>A dry summary of all their arguments is that utility classes are not proper objects; therefore, they don't fit into object-oriented world. They were inherited from procedural programming, mostly because most were used to a functional decomposition paradigm back then.</p><p>Assuming you agree with the arguments and want to stop using utility classes, I'll show by example how these creatures can be replaced with proper objects.</p><h2 id="toc_1">Procedural Example</h2><p>Say, for instance, you want to read a text file, split it into lines, trim every line and then save the results in another file. This is can be done with <a href="http://commons.apache.org/proper/commons-io/apidocs/org/apache/commons/io/FileUtils.html"><code>FileUtils</code></a> from Apache Commons:</p><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><code class="java">1
2
3
4
5
6
7
8</code></pre></div></td><td class="code"><div class="highlight"><pre><span class="kt">void</span> <span class="nf">transform</span><span class="o">(</span><span class="n">File</span> <span class="n">in</span><span class="o">,</span> <span class="n">File</span> <span class="n">out</span><span class="o">)</span> <span class="o">{</span>
  <span class="n">Collection</span><span class="o">&lt;</span><span class="n">String</span><span class="o">&gt;</span> <span class="n">src</span> <span class="o">=</span> <span class="n">FileUtils</span><span class="o">.</span><span class="na">readLines</span><span class="o">(</span><span class="n">in</span><span class="o">,</span> <span class="s">"UTF-8"</span><span class="o">);</span>
  <span class="n">Collection</span><span class="o">&lt;</span><span class="n">String</span><span class="o">&gt;</span> <span class="n">dest</span> <span class="o">=</span> <span class="k">new</span> <span class="n">ArrayList</span><span class="o">&lt;&gt;(</span><span class="n">src</span><span class="o">.</span><span class="na">size</span><span class="o">());</span>
  <span class="k">for</span> <span class="o">(</span><span class="n">String</span> <span class="n">line</span> <span class="o">:</span> <span class="n">src</span><span class="o">)</span> <span class="o">{</span>
    <span class="n">dest</span><span class="o">.</span><span class="na">add</span><span class="o">(</span><span class="n">line</span><span class="o">.</span><span class="na">trim</span><span class="o">());</span>
  <span class="o">}</span>
  <span class="n">FileUtils</span><span class="o">.</span><span class="na">writeLines</span><span class="o">(</span><span class="n">out</span><span class="o">,</span> <span class="n">dest</span><span class="o">,</span> <span class="s">"UTF-8"</span><span class="o">);</span>
<span class="o">}</span></pre></div></td></tr></table><p>The above code may look clean; however, this is procedural programming, not object-oriented. We are manipulating data (bytes and bits) and explicitly instructing the computer from where to retrieve them and then where to put them on every single line of code. We're defining <em>a procedure of execution</em>.</p><h2 id="toc_2">Object-Oriented Alternative</h2><p>In an object-oriented paradigm, we should instantiate and compose objects, thus letting them manage data when and how <em>they</em> desire. Instead of calling supplementary static functions, we should create objects that are capable of exposing the behaviour we are seeking:</p><div class="highlight"><pre><code class="java"><span class="kd">public</span> <span class="kd">class</span> <span class="nc">Max</span> <span class="kd">implements</span> <span class="n">Number</span> <span class="o">{</span>
  <span class="kd">private</span> <span class="kd">final</span> <span class="kt">int</span> <span class="n">a</span><span class="o">;</span>
  <span class="kd">private</span> <span class="kd">final</span> <span class="kt">int</span> <span class="n">b</span><span class="o">;</span>
  <span class="kd">public</span> <span class="nf">Max</span><span class="o">(</span><span class="kt">int</span> <span class="n">x</span><span class="o">,</span> <span class="kt">int</span> <span class="n">y</span><span class="o">)</span> <span class="o">{</span>
    <span class="k">this</span><span class="o">.</span><span class="na">a</span> <span class="o">=</span> <span class="n">x</span><span class="o">;</span>
    <span class="k">this</span><span class="o">.</span><span class="na">b</span> <span class="o">=</span> <span class="n">y</span><span class="o">;</span>
  <span class="o">}</span>
  <span class="nd">@Override</span>
  <span class="kd">public</span> <span class="kt">int</span> <span class="nf">intValue</span><span class="o">()</span> <span class="o">{</span>
    <span class="k">return</span> <span class="k">this</span><span class="o">.</span><span class="na">a</span> <span class="o">&gt;</span> <span class="k">this</span><span class="o">.</span><span class="na">b</span> <span class="o">?</span> <span class="k">this</span><span class="o">.</span><span class="na">a</span> <span class="o">:</span> <span class="k">this</span><span class="o">.</span><span class="na">b</span><span class="o">;</span>
  <span class="o">}</span>
<span class="o">}</span>
</code></pre></div><p>This procedural call:</p><div class="highlight"><pre><code class="java"><span class="kt">int</span> <span class="n">max</span> <span class="o">=</span> <span class="n">NumberUtils</span><span class="o">.</span><span class="na">max</span><span class="o">(</span><span class="mi">10</span><span class="o">,</span> <span class="mi">5</span><span class="o">);</span>
</code></pre></div><p>Will become object-oriented:</p><div class="highlight"><pre><code class="java"><span class="kt">int</span> <span class="n">max</span> <span class="o">=</span> <span class="k">new</span> <span class="n">Max</span><span class="o">(</span><span class="mi">10</span><span class="o">,</span> <span class="mi">5</span><span class="o">).</span><span class="na">intValue</span><span class="o">();</span>
</code></pre></div><p>Potato, potato? Not really; just read on...</p><h2 id="toc_3">Objects Instead of Data Structures</h2><p>This is how I would design the same file-transforming functionality as above but in an object-oriented manner:</p><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><code class="java">1
2
3
4
5
6
7
8
9</code></pre></div></td><td class="code"><div class="highlight"><pre><span class="kt">void</span> <span class="nf">transform</span><span class="o">(</span><span class="n">File</span> <span class="n">in</span><span class="o">,</span> <span class="n">File</span> <span class="n">out</span><span class="o">)</span> <span class="o">{</span>
  <span class="n">Collection</span><span class="o">&lt;</span><span class="n">String</span><span class="o">&gt;</span> <span class="n">src</span> <span class="o">=</span> <span class="k">new</span> <span class="n">Trimmed</span><span class="o">(</span>
    <span class="k">new</span> <span class="nf">FileLines</span><span class="o">(</span><span class="k">new</span> <span class="n">UnicodeFile</span><span class="o">(</span><span class="n">in</span><span class="o">))</span>
  <span class="o">);</span>
  <span class="n">Collection</span><span class="o">&lt;</span><span class="n">String</span><span class="o">&gt;</span> <span class="n">dest</span> <span class="o">=</span> <span class="k">new</span> <span class="n">FileLines</span><span class="o">(</span>
    <span class="k">new</span> <span class="nf">UnicodeFile</span><span class="o">(</span><span class="n">out</span><span class="o">)</span>
  <span class="o">);</span>
  <span class="n">dest</span><span class="o">.</span><span class="na">addAll</span><span class="o">(</span><span class="n">src</span><span class="o">);</span>
<span class="o">}</span></pre></div></td></tr></table><p><code>FileLines</code> implements <code>Collection&lt;String&gt;</code> and encapsulates all file reading and writing operations. An instance of <code>FileLines</code> behaves exactly as a collection of strings and hides all I/O operations. When we iterate it — a file is being read. When we <code>addAll()</code> to it — a file is being written.</p><p><code>Trimmed</code> also implements <code>Collection&lt;String&gt;</code> and encapsulates a collection of strings (<a href="http://en.wikipedia.org/wiki/Decorator_pattern">Decorator pattern</a>). Every time the next line is retrieved, it gets trimmed.</p><p>All classes taking participation in the snippet are rather small: <code>Trimmed</code>, <code>FileLines</code>, and <code>UnicodeFile</code>. Each of them is responsible for its own single feature, thus following perfectly the <a href="http://en.wikipedia.org/wiki/Single_responsibility_principle">single responsibility principle</a>.</p><p>On our side, as users of the library, this may be not so important, but for their developers it is an imperative. It is much easier to develop, maintain and unit-test class <code>FileLines</code> rather than using a <code>readLines()</code> method in a 80+ methods and 3000 lines utility class <code>FileUtils</code>. Seriously, look at <a href="http://svn.apache.org/viewvc/commons/proper/io/trunk/src/main/java/org/apache/commons/io/FileUtils.java?view=co">its source code</a>.</p><p>An object-oriented approach enables lazy execution. The <code>in</code> file is not read until its data is required. If we fail to open <code>out</code> due to some I/O error, the first file won't even be touched. The whole show starts only after we call <code>addAll()</code>.</p><p>All lines in the second snippet, except the last one, instantiate and compose smaller objects into bigger ones. This object composition is rather cheap for the CPU since it doesn't cause any data transformations.</p><p>Besides that, it is obvious that the second script runs in O(1) space, while the first one executes in O(n). This is the consequence of our procedural approach to data in the first script.</p><p>In an object-oriented world, there is no data; there are only objects and their behavior!</p></article> <a href="/2014/05/05/oop-alternative-to-utility-classes.html#disqus_thread">comments</a> </section></div><div class="wrapper"> <section class="front"><p> <time datetime="2014-05-01T00:00:00+00:00"> 1 May 2014 </time></p> <header><h1> <a href="/2014/05/01/dynamodb-local-maven-plugin.html"> DynamoDB Local Maven Plugin </a></h1> </header> <article> <figure class='badge'><img src='http://img.yegor256.com/2014/04/dynamodb-logo.jpg' style='width:150px' alt='badge'/></figure><p><a href="http://docs.aws.amazon.com/amazondynamodb/latest/developerguide/Tools.html">DynamoDB Local</a> is a locally running copy of Amazon DynamoDB server. Amazon developed the tool and based it on SQLite. It acts as a real DynamoDB service through the RESTful API.</p><p>I guess, DynamoDB Local is meant to be used in integration testing and this is how we're going to use it below.</p><p>I use Maven to run all of my Java integration testing using <a href="http://maven.apache.org/surefire/maven-failsafe-plugin/">maven-failsafe-plugin</a>. The philosophy of integration testing with Maven is that you start all your supplementary test stubs during the <code>pre-integration-test</code> phase, run your tests in the <code>integration-test</code> phase and then shutdown all stubs during the <code>post-integration-test</code>.</p><figure class='badge'><img src='http://img.jcabi.com/logo-square.png' style='width:64px' alt='badge'/></figure><p>It would be great if it were possible to use DynamoDB Local that way. I didn't find any Maven plugins for that purpose, so I decided to create my own —<a href="https://github.com/jcabi/jcabi-dynamodb-maven-plugin">jcabi-dynamodb-maven-plugin</a>.</p><p>Full usage details for the plugin are explained on <a href="http://dynamodb.jcabi.com">its website</a>. However, here is a simple example:</p><div class="highlight"><pre><code class="xml"><span class="nt">&lt;plugin&gt;</span>
  <span class="nt">&lt;groupId&gt;</span>com.jcabi<span class="nt">&lt;/groupId&gt;</span>
  <span class="nt">&lt;artifactId&gt;</span>jcabi-dynamodb-maven-plugin<span class="nt">&lt;/artifactId&gt;</span>
  <span class="nt">&lt;version&gt;</span>0.6<span class="nt">&lt;/version&gt;</span>
  <span class="nt">&lt;executions&gt;</span>
    <span class="nt">&lt;execution&gt;</span>
      <span class="nt">&lt;goals&gt;</span>
        <span class="nt">&lt;goal&gt;</span>start<span class="nt">&lt;/goal&gt;</span>
        <span class="nt">&lt;goal&gt;</span>stop<span class="nt">&lt;/goal&gt;</span>
      <span class="nt">&lt;/goals&gt;</span>
      <span class="nt">&lt;configuration&gt;</span>
        <span class="nt">&lt;port&gt;</span>10500<span class="nt">&lt;/port&gt;</span>
        <span class="nt">&lt;dist&gt;</span>${project.build.directory}/dynamodb-dist<span class="nt">&lt;/dist&gt;</span>
      <span class="nt">&lt;/configuration&gt;</span>
    <span class="nt">&lt;/execution&gt;</span>
  <span class="nt">&lt;/executions&gt;</span>
<span class="nt">&lt;/plugin&gt;</span>
</code></pre></div><p>The above configuration will start DynamoDB Local right before running integration tests, and then stop it immediately afterwards. The server will listen at TCP port 10500. While the number is used in the example, you're supposed to use a <a href="http://mojo.codehaus.org/build-helper-maven-plugin/reserve-network-port-mojo.html">randomly allocated port</a> instead.</p><p>When the DynamoDB Local server is up and running, we can create an integration test for it:</p><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><code class="java"> 1
 2
 3
 4
 5
 6
 7
 8
 9
10
11
12
13
14
15
16
17</code></pre></div></td><td class="code"><div class="highlight"><pre><span class="kn">import</span> <span class="nn">com.amazonaws.auth.BasicAWSCredentials</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">com.amazonaws.services.dynamodbv2.AmazonDynamoDB</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">com.amazonaws.services.dynamodbv2.AmazonDynamoDBClient</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">com.amazonaws.services.dynamodbv2.model.ListTablesResult</span><span class="o">;</span>
<span class="kd">public</span> <span class="kd">class</span> <span class="nc">FooITCase</span> <span class="o">{</span>
  <span class="nd">@Test</span>
  <span class="kd">public</span> <span class="kt">void</span> <span class="nf">worksWithAwsDynamoDb</span><span class="o">()</span> <span class="o">{</span>
    <span class="n">AmazonDynamoDB</span> <span class="n">aws</span> <span class="o">=</span> <span class="k">new</span> <span class="n">AmazonDynamoDBClient</span><span class="o">(</span>
      <span class="k">new</span> <span class="nf">BasicAWSCredentials</span><span class="o">(</span><span class="s">""</span><span class="o">,</span> <span class="s">""</span><span class="o">)</span>
    <span class="o">);</span>
    <span class="n">aws</span><span class="o">.</span><span class="na">setEndpoint</span><span class="o">(</span><span class="s">"http://localhost:10500"</span><span class="o">);</span>
    <span class="n">ListTablesResult</span> <span class="n">list</span> <span class="o">=</span> <span class="n">aws</span><span class="o">.</span><span class="na">listTables</span><span class="o">();</span>
    <span class="k">for</span> <span class="o">(</span><span class="n">String</span> <span class="n">name</span> <span class="o">:</span> <span class="n">list</span><span class="o">.</span><span class="na">getTableNames</span><span class="o">())</span> <span class="o">{</span>
      <span class="n">System</span><span class="o">.</span><span class="na">out</span><span class="o">.</span><span class="na">println</span><span class="o">(</span><span class="s">"table found: "</span> <span class="o">+</span> <span class="n">name</span><span class="o">);</span>
    <span class="o">}</span>
  <span class="o">}</span>
<span class="o">}</span></pre></div></td></tr></table><p>Of course, there won't be any output because the server starts without any tables. Since the server is empty, you should create tables before every integration test, using <code>createTable()</code> from <a href="http://docs.aws.amazon.com/AWSJavaSDK/latest/javadoc/com/amazonaws/services/dynamodbv2/package-summary.html">DynamoDB SDK</a>.</p><p>To avoid this type of extra hassle, in the latest version 0.6 of <a href="http://dynamodb.jcabi.com">jcabi-dynamodb-maven-plugin</a> <a href="https://github.com/jcabi/jcabi-dynamodb-maven-plugin/issues/16">we introduced</a> a new goal <a href="http://dynamodb.jcabi.com/example-create-tables.html"><code>create-tables</code></a>:</p><div class="highlight"><pre><code class="xml"><span class="nt">&lt;plugin&gt;</span>
  <span class="nt">&lt;groupId&gt;</span>com.jcabi<span class="nt">&lt;/groupId&gt;</span>
  <span class="nt">&lt;artifactId&gt;</span>jcabi-dynamodb-maven-plugin<span class="nt">&lt;/artifactId&gt;</span>
  <span class="nt">&lt;executions&gt;</span>
    <span class="nt">&lt;execution&gt;</span>
      <span class="nt">&lt;goals&gt;</span>
        <span class="nt">&lt;goal&gt;</span>create-tables<span class="nt">&lt;/goal&gt;</span>
      <span class="nt">&lt;/goals&gt;</span>
      <span class="nt">&lt;configuration&gt;</span>
        <span class="nt">&lt;tables&gt;</span>
          <span class="nt">&lt;table&gt;</span>${basedir}/src/test/dynamodb/foo.json<span class="nt">&lt;/table&gt;</span>
        <span class="nt">&lt;/tables&gt;</span>
      <span class="nt">&lt;/configuration&gt;</span>
    <span class="nt">&lt;/execution&gt;</span>
  <span class="nt">&lt;/executions&gt;</span>
<span class="nt">&lt;/plugin&gt;</span>
</code></pre></div><p>The <code>foo.json</code> file used above should contain a JSON request that is sent to DynamoDB Local right after it is up and running. The request should comply with the specification of <a href="http://docs.aws.amazon.com/amazondynamodb/latest/APIReference/API_CreateTable.html">CreateTable</a> request. For example:</p><div class="highlight"><pre><code class="json"><span class="p">{</span>
  <span class="nt">"AttributeDefinitions"</span><span class="p">:</span> <span class="p">[</span>
    <span class="p">{</span>
      <span class="nt">"AttributeName"</span><span class="p">:</span> <span class="s2">"id"</span><span class="p">,</span>
      <span class="nt">"AttributeType"</span><span class="p">:</span> <span class="s2">"N"</span>
    <span class="p">}</span>
  <span class="p">],</span>
  <span class="nt">"KeySchema"</span><span class="p">:</span> <span class="p">[</span>
    <span class="p">{</span>
      <span class="nt">"AttributeName"</span><span class="p">:</span> <span class="s2">"id"</span><span class="p">,</span>
      <span class="nt">"KeyType"</span><span class="p">:</span> <span class="s2">"HASH"</span>
    <span class="p">}</span>
  <span class="p">],</span>
  <span class="nt">"ProvisionedThroughput"</span><span class="p">:</span> <span class="p">{</span>
    <span class="nt">"ReadCapacityUnits"</span><span class="p">:</span> <span class="s2">"1"</span><span class="p">,</span>
    <span class="nt">"WriteCapacityUnits"</span><span class="p">:</span> <span class="s2">"1"</span>
  <span class="p">},</span>
  <span class="nt">"TableName"</span><span class="p">:</span> <span class="s2">"foo"</span>
<span class="p">}</span>
</code></pre></div><p>The table will be created during the <code>pre-integration-test</code> phase and dropped at the <code>post-integration-test</code> phase. Now, we can make our integration test much more meaningful with the help of <a href="http://dynamo.jcabi.com">jcabi-dynamo</a>:</p><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><code class="java"> 1
 2
 3
 4
 5
 6
 7
 8
 9
10
11
12
13
14
15
16
17
18
19
20
21
22
23</code></pre></div></td><td class="code"><div class="highlight"><pre><span class="kn">import</span> <span class="nn">com.jcabi.dynamo.Attributes</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">com.jcabi.dynamo.Conditions</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">com.jcabi.dynamo.Credentials</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">com.jcabi.dynamo.Region</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">com.jcabi.dynamo.Table</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">org.hamcrest.MatcherAssert</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">org.hamcrest.Matchers</span><span class="o">;</span>
<span class="kd">public</span> <span class="kd">class</span> <span class="nc">FooITCase</span> <span class="o">{</span>
  <span class="nd">@Test</span>
  <span class="kd">public</span> <span class="kt">void</span> <span class="nf">worksWithAwsDynamoDb</span><span class="o">()</span> <span class="o">{</span>
    <span class="n">Region</span> <span class="n">region</span> <span class="o">=</span> <span class="k">new</span> <span class="n">Region</span><span class="o">.</span><span class="na">Simple</span><span class="o">(</span><span class="k">new</span> <span class="n">Credentials</span><span class="o">.</span><span class="na">Simple</span><span class="o">(</span><span class="s">""</span><span class="o">,</span> <span class="s">""</span><span class="o">));</span>
    <span class="n">Table</span> <span class="n">table</span> <span class="o">=</span> <span class="n">region</span><span class="o">.</span><span class="na">table</span><span class="o">(</span><span class="s">"foo"</span><span class="o">);</span>
    <span class="n">table</span><span class="o">.</span><span class="na">put</span><span class="o">(</span>
      <span class="k">new</span> <span class="nf">Attributes</span><span class="o">()</span>
        <span class="o">.</span><span class="na">with</span><span class="o">(</span><span class="s">"id"</span><span class="o">,</span> <span class="mi">123</span><span class="o">)</span>
        <span class="o">.</span><span class="na">with</span><span class="o">(</span><span class="s">"name"</span><span class="o">,</span> <span class="s">"Robert DeNiro"</span><span class="o">)</span>
    <span class="o">);</span>
    <span class="n">MatcherAssert</span><span class="o">.</span><span class="na">assertThat</span><span class="o">(</span>
      <span class="n">table</span><span class="o">.</span><span class="na">frame</span><span class="o">().</span><span class="na">where</span><span class="o">(</span><span class="s">"id"</span><span class="o">,</span> <span class="n">Conditions</span><span class="o">.</span><span class="na">equalTo</span><span class="o">(</span><span class="mi">123</span><span class="o">)),</span>
      <span class="n">Matchers</span><span class="o">.</span><span class="na">notEmpty</span><span class="o">()</span>
    <span class="o">);</span>
  <span class="o">}</span>
<span class="o">}</span></pre></div></td></tr></table><p>The above test will put a new item into the table and then assert that the item is there.</p><p>The plugin was tested with three operating systems, and proved to work without problems: Mac OS X 10.8.5, Windows 7 SP1 and Ubuntu Linux 12.04 Desktop.</p></article> <a href="/2014/05/01/dynamodb-local-maven-plugin.html#disqus_thread">comments</a> </section></div><div class="wrapper"> <section class="front"><p> <time datetime="2014-04-29T00:00:00+00:00"> 29 April 2014 </time></p> <header><h1> <a href="/2014/04/29/w3c-java-validators.html"> W3C Java Validators </a></h1> </header> <article> <figure class='badge'><img src='http://img.jcabi.com/logo-square.png' style='width:64px' alt='badge'/></figure><p>A few years ago, I created two Java wrappers for W3C validators: (<a href="http://validator.w3.org/">HTML</a> and <a href="http://jigsaw.w3.org/css-validator/">CSS</a>). Both wrappers seemed to be working fine and were even listed by W3C on <a href="http://validator.w3.org/docs/api.html">their website</a> in the API section. Until recently, these wrappers have always been part of <a href="http://www.rexsl.com">ReXSL</a> library.</p><p>A few days ago, though, I took the wrappers out of ReXSL and published them as a standalone library — <a href="http://w3c.jcabi.com">jcabi-w3c</a>. Consequently, now seems to be a good time to write a few words about them.</p><p>Below is an example that demonstrates how you can validate an HTML document against W3C compliancy rules:</p><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><code class="java">1
2
3
4</code></pre></div></td><td class="code"><div class="highlight"><pre><span class="kn">import</span> <span class="nn">com.jcabi.w3c.ValidatorBuilder</span><span class="o">;</span>
<span class="k">assert</span> <span class="n">ValidatorBuilder</span><span class="o">.</span><span class="na">html</span><span class="o">()</span>
  <span class="o">.</span><span class="na">validate</span><span class="o">(</span><span class="s">"&lt;html&gt;hello, world!&lt;/html&gt;"</span><span class="o">)</span>
  <span class="o">.</span><span class="na">valid</span><span class="o">();</span></pre></div></td></tr></table><p>The <code>valid()</code> method is a black or white indicator that returns <code>false</code> when the document is not valid. Additionally, you can obtain more information through a list of "defects" returned by the W3C server:</p><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><code class="java">1
2
3</code></pre></div></td><td class="code"><div class="highlight"><pre><span class="n">Collection</span><span class="o">&lt;</span><span class="n">Defect</span><span class="o">&gt;</span> <span class="n">defects</span> <span class="o">=</span> <span class="n">ValidatorBuilder</span><span class="o">.</span><span class="na">html</span><span class="o">()</span>
  <span class="o">.</span><span class="na">validate</span><span class="o">(</span><span class="s">"&lt;html&gt;hello, world!&lt;/html&gt;"</span><span class="o">)</span>
  <span class="o">.</span><span class="na">errors</span><span class="o">();</span></pre></div></td></tr></table><p>The same can be done with CSS:</p><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><code class="java">1
2
3</code></pre></div></td><td class="code"><div class="highlight"><pre><span class="n">Collection</span><span class="o">&lt;</span><span class="n">Defect</span><span class="o">&gt;</span> <span class="n">defects</span> <span class="o">=</span> <span class="n">ValidatorBuilder</span><span class="o">.</span><span class="na">css</span><span class="o">()</span>
  <span class="o">.</span><span class="na">validate</span><span class="o">(</span><span class="s">"body { font-family: Arial; }"</span><span class="o">)</span>
  <span class="o">.</span><span class="na">errors</span><span class="o">();</span></pre></div></td></tr></table><p>Personally, I think it is a good practice to validate all of HTML pages produced by your application against W3C during integration testing. It's not a matter of seeking perfection, but rather of preventing bigger problems later.</p></article> <a href="/2014/04/29/w3c-java-validators.html#disqus_thread">comments</a> </section></div><div class="wrapper"><div class="pagination"><div style="float:left"> <span class="mute">prev</span></div> page 1 of 4<div style="float:right"> <a href="/p/2">next</a></div></div></div></body></html>