<!DOCTYPE html>
<html>
  <head>
    <meta name="description" content="quality vs quantity" />
    <link rel="icon" type="image/gif" href="http://img.yegor256.com/icon-64x64.png">
    <link rel="shortcut icon" href="http://img.yegor256.com/icon-64x64.png" />
    <link rel="alternate" type="application/rss+xml" title="RSS" href="http://www.yegor256.com/rss"/>
    <link rel="author" href="https://plus.google.com/u/0/114792568016408327418?rel=author" />
    <link href="http://netdna.bootstrapcdn.com/font-awesome/4.0.3/css/font-awesome.css" rel="stylesheet">
    <meta name="keywords" content="software development, quality of software, programming, remote programming, distributed programming, static analysis, quality control" />
    <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1"/>
    <meta name="viewport" content="width=device-width"/>
    <link rel="stylesheet" href="/css/layout.css"/>
    <title>yegor256</title>
  </head>
  <body>
    <div class="wrapper">
      <div class="content">
        <div class="top">
          <a href="/">home</a>
          &nbsp;
          <a href="/about-me.html">about me</a>
          &nbsp;
          <a href="https://twitter.com/yegor256"><i class="fa fa-twitter"></i></a>
          &nbsp;
          <a href="/rss.xml"><i class="fa fa-rss"></i></a>
        </div>
        
  <section class="front">
    <p class="meta">6 April 2014</p>
    <header><h1><a href="/2014/04/06/phandom.html">Phantomjs as an HTML Validator</a></h1></header>
    <article><p>I&#39;ve created <a href="http://www.phandom.org">phandom.org</a> a few months ago,
but yesterday made a few changes to it. So it&#39;s a good moment to
explain how I&#39;m using it in unit tests.</p>

<p>First, a few words about <a href="http://phantomjs.org/">phantomjs</a>. It is a
JavaScript interface to WebKit, while WebKit is a web browser, but without
a user interface. WebKit is a C++ library that enables manipulations with
HTML content, through DOM calls. For example, this is a simple JavaScript
code in <code>example.js</code>:</p>

<table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><code class="javascript">1
2
3
4
5
6
7
8</code></pre></div></td><td class="code"><div class="highlight"><pre><span class="kd">var</span> <span class="nx">page</span> <span class="o">=</span> <span class="nx">require</span><span class="p">(</span><span class="s1">&#39;webpage&#39;</span><span class="p">).</span><span class="nx">create</span><span class="p">();</span>
<span class="nx">page</span><span class="p">.</span><span class="nx">open</span><span class="p">(</span>
  <span class="s1">&#39;http://google.com&#39;</span><span class="p">,</span>
  <span class="kd">function</span><span class="p">()</span> <span class="p">{</span>
    <span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="s1">&#39;loaded!&#39;</span><span class="p">);</span>
    <span class="nx">phantom</span><span class="p">.</span><span class="nx">exit</span><span class="p">(</span><span class="mi">0</span><span class="p">);</span>
  <span class="p">}</span>
<span class="p">);</span>
</pre></div>
</td></tr></table>

<p>We run it from command line:</p>

<table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><code class="bash">1</code></pre></div></td><td class="code"><div class="highlight"><pre><span class="nv">$ </span>phantomjs example.js
</pre></div>
</td></tr></table>

<p>Phantomjs creates <code>page</code> object
(provided by <a href="https://github.com/ariya/phantomjs/wiki/API-Reference-WebPage">webpage</a>
module inside phantomjs), and asks it to <code>open()</code> a web page. The objects
contacts WebKit and transforms this call into DOM instructions. The page will
be loaded, and phantom engine will be terminated on line 6.</p>

<p>WebKit renders a web page together with everything inside it, including CSS,
JavaScript, ActionScript, etc. It is doing it exactly as any web browser would
do.</p>

<p>So far so good, this is a traditional way of using phantomjs. Now, the idea
of <a href="http://www.phandom.org">Phandom</a> (which stands for &quot;PhantomJS DOM&quot;) inside
Java unit tests:</p>

<p>Let&#39;s give phantomjs an HTML page and ask him to render it. When ready, we&#39;ll
ask to show us how this HTML looks in WebKit&#39;s eyes. If we see our desired
elements there &mdash; our page is good enough. For example:</p>

<table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><code class="java"> 1
 2
 3
 4
 5
 6
 7
 8
 9
10
11
12
13
14
15
16
17</code></pre></div></td><td class="code"><div class="highlight"><pre><span class="kn">import</span> <span class="nn">com.rexsl.test.XhtmlMatchers</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">org.hamcrest.MatcherAssert</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">org.phandom.Phandom</span><span class="o">;</span>
<span class="kd">public</span> <span class="kd">final</span> <span class="kd">class</span> <span class="nc">DocumentTest</span> <span class="o">{</span>
  <span class="nd">@Test</span>
  <span class="kd">public</span> <span class="kt">void</span> <span class="nf">rendersValidHtml</span><span class="o">()</span> <span class="o">{</span>
    <span class="kd">final</span> <span class="n">Document</span> <span class="n">doc</span> <span class="o">=</span> <span class="k">new</span> <span class="n">Document</span><span class="o">();</span>
    <span class="c1">// This is the method we&#39;re testing. It is supposed</span>
    <span class="c1">// to return a valid HTML without broken JavaScript</span>
    <span class="c1">// and with all required HTML elements.</span>
    <span class="kd">final</span> <span class="n">String</span> <span class="n">html</span> <span class="o">=</span> <span class="n">doc</span><span class="o">.</span><span class="na">html</span><span class="o">();</span>
    <span class="n">MatcherAssert</span><span class="o">.</span><span class="na">assertThat</span><span class="o">(</span>
      <span class="n">XhtmlMatchers</span><span class="o">.</span><span class="na">xhtml</span><span class="o">(</span><span class="k">new</span> <span class="n">Phandom</span><span class="o">(</span><span class="n">html</span><span class="o">).</span><span class="na">dom</span><span class="o">()),</span>
      <span class="n">XhtmlMatchers</span><span class="o">.</span><span class="na">hasXPath</span><span class="o">(</span><span class="s">&quot;//p[.=&#39;Hello, world!&#39;]&quot;</span><span class="o">)</span>
    <span class="o">);</span>
  <span class="o">}</span>
<span class="o">}</span>
</pre></div>
</td></tr></table>

<p>Here is what&#39;s happening. We&#39;re getting an HTML <code>html</code> as a <code>String</code>
from <code>doc</code> object, and then passing it to
<a href="http://www.phandom.org/apidocs-0.2.1/org/phandom/Phandom.html"><code>Phandom</code></a>
as an argument. Then,
on line 13, we&#39;re calling <code>Phandom.dom()</code> method in order to get an instance
of class <code>org.w3c.Document</code>.</p>

<p>If our HTML contains any broken JavaScript code, method <code>dom()</code> will
throw a runtime exception and unit test will fail. If HTML is clean
and WebKit can render it without problems, the test will pass.</p>

<p>I&#39;m using this mechanism in a few projects, and highly recommend it.</p>

<p>Of course, don&#39;t forget, that you should have phantomjs installed on your
build machine.</p>
</article>
    <a href="/2014/04/06/phandom.html#disqus_thread">comments</a>
  </section>

  <section class="front">
    <p class="meta">6 April 2014</p>
    <header><h1><a href="/2014/04/06/movies-for-thanasis.html">Movies for Thanasis</a></h1></header>
    <article><p>Here is a list of movies I&#39;ve recommended to a friend, some time ago.
He was interested to give up &quot;Hollywood&quot;.</p>

<p>Level C is supposed to be impossible to understand unless you&#39;ve seen
(and understood) A and B. So, start with A and post your comments :)</p>

<p>Level A</p>

<ul>
<li><a href="http://www.imdb.com/title/tt0108399/">True Romance (1993)</a></li>
<li><a href="http://www.imdb.com/title/tt0110912/">Pulp Fiction (1994)</a></li>
<li><a href="http://www.imdb.com/title/tt0266697/">Kill Bill (2003)</a></li>
<li><a href="http://www.imdb.com/title/tt0118996/">Doberman (1997)</a></li>
<li><a href="http://www.imdb.com/title/tt0144201/">La fille sur le pont (1999)</a></li>
<li><a href="http://www.imdb.com/title/tt0290673/">Irreversible (2002)</a></li>
<li><a href="http://www.imdb.com/title/tt0120669/">Fear and Loathing in Las Vegas (1998)</a></li>
<li><a href="http://www.imdb.com/title/tt0119879/">Perdita Durango (1997)</a></li>
<li><a href="http://www.imdb.com/title/tt0107165/">Golden Balls (1993)</a></li>
<li><a href="http://www.imdb.com/title/tt0120753/">The Million Dollar Hotel (2000)</a></li>
<li><a href="http://www.imdb.com/title/tt0245574/">Y Tu Mamá También (2001)</a></li>
<li><a href="http://www.imdb.com/title/tt0105236/">Reservoir Dogs (1992)</a></li>
<li><a href="http://www.imdb.com/title/tt0117951/">Trainspotting (1996)</a></li>
<li><a href="http://www.imdb.com/title/tt0137523/">Fight Club (1999)</a></li>
<li><a href="http://www.imdb.com/title/tt0106307/">Arizona Dream (1992)</a></li>
<li><a href="http://www.imdb.com/title/tt0118843/">Black Cat, White Cat (1998)</a></li>
<li><a href="http://www.imdb.com/title/tt0118789/">Buffalo &#39;66 (1998)</a></li>
<li><a href="http://www.imdb.com/title/tt0104545/">Jamon Jamon (1992)</a></li>
<li><a href="http://www.imdb.com/title/tt0110632/">Natural Born Killers (1994)</a></li>
<li><a href="http://www.imdb.com/title/tt0124901/">Thursday (1998)</a></li>
<li><a href="http://www.imdb.com/title/tt0115781/">Bullet (1996)</a></li>
</ul>

<p>Level B</p>

<ul>
<li><a href="http://www.imdb.com/title/tt0101700/">Delicatessen (1991)</a></li>
<li><a href="http://www.imdb.com/title/tt0115658/">Bernie (1996)</a></li>
<li><a href="http://www.imdb.com/title/tt0119257/">Hardmen (1996)</a></li>
<li><a href="http://www.imdb.com/title/tt0365686/">Revolver (2005)</a></li>
<li><a href="http://www.imdb.com/title/tt0354899/">Science of Sleep (2006)</a></li>
<li><a href="http://www.imdb.com/title/tt0460740/">Cashback (2006)</a></li>
<li><a href="http://www.imdb.com/title/tt0395125/">El Crimen Perfecto (2004)</a></li>
<li><a href="http://www.imdb.com/title/tt0112922/">El día de la bestia (1995)</a></li>
<li><a href="http://www.imdb.com/title/tt0255067/">La comunidad (2000)</a></li>
<li><a href="http://www.imdb.com/title/tt0304262/">The Happiness of the Katakuris (2001)</a></li>
<li><a href="http://www.imdb.com/title/tt0875113/">99 francs (2007)</a></li>
<li><a href="http://www.imdb.com/title/tt0420555/">Combien tu m&#39;aimes? (2005)</a></li>
<li><a href="http://www.imdb.com/title/tt0299977/">Ying xiong (2002)</a></li>
<li><a href="http://www.imdb.com/title/tt0074252/">Brutti, sporchi e cattivi (1976)</a></li>
</ul>

<p>Level C</p>

<ul>
<li><a href="http://www.imdb.com/title/tt0486674/">What Just Happened (2008)</a></li>
<li><a href="http://www.imdb.com/title/tt0147612/">Happiness (1998)</a></li>
<li><a href="http://www.imdb.com/title/tt0292963/">Before the Devil Knows You Are Dead (2007)</a></li>
<li><a href="http://www.imdb.com/title/tt0477348/">No Country for Old Men (2007)</a></li>
<li><a href="http://www.imdb.com/title/tt1019452/">A Serious Man (2009)</a></li>
</ul>
</article>
    <a href="/2014/04/06/movies-for-thanasis.html#disqus_thread">comments</a>
  </section>

  <section class="front">
    <p class="meta">6 April 2014</p>
    <header><h1><a href="/2014/04/06/introduction.html">First Post</a></h1></header>
    <article><p>This is a first post on this blog. So, it&#39;s about nothing. Just
an introduction. The blog will mostly be about software development
ideas. As <a href="/about-me.html">about me</a> says, I&#39;m passionate about software
quality, and will write solely about it.</p>

<p>Let&#39;s see how will this work :)</p>

<p>ps. BTW, I&#39;ve bought <a href="http://www.myfonts.com/fonts/ascender/cambria/">Cambria font</a>
for this blog, for &euro;98. Seems to be a nice investment into this new venture.</p>
</article>
    <a href="/2014/04/06/introduction.html#disqus_thread">comments</a>
  </section>


      </div>
    </div>
    <script type="text/javascript">
      var _gaq = _gaq || [];
      _gaq.push(['_setAccount', 'UA-1963507-32']);
      _gaq.push(['_trackPageview']);
      (function() {
        var ga = document.createElement('script'); ga.type = 'text/javascript'; ga.async = true;
        ga.src = ('https:' == document.location.protocol ? 'https://ssl' : 'http://www') + '.google-analytics.com/ga.js';
        var s = document.getElementsByTagName('script')[0]; s.parentNode.insertBefore(ga, s);
      })();
    </script>
    <script type="text/javascript">
      var disqus_shortname = 'yegor256';
      (function () {
          var s = document.createElement('script'); s.async = true;
          s.type = 'text/javascript';
          s.src = '//' + disqus_shortname + '.disqus.com/count.js';
          (document.getElementsByTagName('HEAD')[0] || document.getElementsByTagName('BODY')[0]).appendChild(s);
      }());
    </script>
  </body>
</html>
