<!DOCTYPE html><html xmlns="http://www.w3.org/1999/xhtml" lang="en-US"><head><meta charset="utf-8"/><meta name="description" content="Personal blog of Yegor Bugayenko about programming, mostly in Java, bug also in PHP, JavaScript, Ruby, Python and Lisp"/><meta name="keywords" content="java blog, java, software development blog, programming blog, yegor bugayenko blog, quality of software, software blog, high quality programming, static analysis, software testing, ruby blog, javascript blog, php blog"/><meta name="viewport" content="width=device-width"/><link rel="icon" type="image/gif" href="http://img.yegor256.com/icon-128x128.png"><link rel="shortcut icon" href="//img.yegor256.com/icon-64x64.png"/><link rel="alternate" type="application/rss+xml" title="RSS" href="http://www.yegor256.com/rss.xml"/><link rel="author" href="//plus.google.com/u/0/114792568016408327418?rel=author"/><link href="//netdna.bootstrapcdn.com/font-awesome/4.0.3/css/font-awesome.css" rel="stylesheet"><link rel="stylesheet" href="/css/layout.css?ba2cc6c"/><link rel="canonical" href="//www.yegor256.com/index.html"/> <script src="//code.jquery.com/jquery-2.1.0.min.js"></script><title>Yegor Bugayenko About Programming (page 1)</title></head><body><div class="wrapper"> <header class="top"><div><a href="/"><img src="//img.yegor256.com/yegor-bugayenko.jpg" class="photo"/></a></div> <nav role="navigation"><ul class="menu"><li><a href="//www.twitter.com/yegor256"><i class="fa fa-twitter"></i></a></li><li><a href="/about-me.html">about me</a></li><li><a href="//feeds.feedburner.com/yegor256"><i class="fa fa-rss"></i></a></li><li><a href="//feedburner.google.com/fb/a/mailverify?uri=yegor256&amp;loc=en_US">subscribe</a></li></ul> </nav><div class="gcse" role="search"><div class="gcse-search"></div></div> </header></div><div class="wrapper"> <section class="front"><p> <time datetime="2014-05-05T00:00:00+00:00"> 5 May 2014 </time></p> <header><h1> <a href="/2014/05/05/oop-alternative-to-utility-classes.html"> OOP Alternative to Utility Classes </a></h1> </header> <article><p>A utility class (aka helper class) is a "structure" that has only static methods and encapsulates no state. <code>StringUtils</code>, <code>IOUtils</code>, <code>FileUtils</code> from <a href="http://commons.apache.org/">Apache Commons</a>; <code>Iterables</code> and <code>Iterators</code> from <a href="https://code.google.com/p/guava-libraries/">Guava</a>, and <a href="http://docs.oracle.com/javase/7/docs/api/java/nio/file/Files.html"><code>Files</code></a> from JDK7 are perfect examples of utility classes.</p><p>This design idea is very popular in the Java world (as well as C#, Ruby, etc.) because utility classes provide common functionality used everywhere.</p><p>Here, we want to follow the <a href="http://en.wikipedia.org/wiki/Don't_repeat_yourself">DRY principle</a> and avoid duplication. Therefore, we place common code blocks into utility classes and reuse them when necessary:</p><div class="highlight"><pre><code class="java"><span class="c1">// This is a terrible design, don't reuse</span>
<span class="kd">public</span> <span class="kd">class</span> <span class="nc">NumberUtils</span> <span class="o">{</span>
  <span class="kd">public</span> <span class="kd">static</span> <span class="kt">int</span> <span class="nf">max</span><span class="o">(</span><span class="kt">int</span> <span class="n">a</span><span class="o">,</span> <span class="kt">int</span> <span class="n">b</span><span class="o">)</span> <span class="o">{</span>
    <span class="k">return</span> <span class="n">a</span> <span class="o">&gt;</span> <span class="n">b</span> <span class="o">?</span> <span class="n">a</span> <span class="o">:</span> <span class="n">b</span><span class="o">;</span>
  <span class="o">}</span>
<span class="o">}</span>
</code></pre></div><p>Indeed, this a very convenient technique!?</p><h2 id="toc_0">Utility Classes Are Evil</h2><p>However, in an object-oriented world, utility classes are considered a very bad (some even may say "terrible") practice.</p><p>There have been many discussions of this subject; to name a few: <a href="http://blogs.msdn.com/b/nickmalik/archive/2005/09/06/461404.aspx">Are Helper Classes Evil?</a> by Nick Malik, <a href="http://smart421.wordpress.com/2011/08/31/why-helper-singletons-and-utility-classes-are-mostly-bad-2/">Why helper, singletons and utility classes are mostly bad</a> by Simon Hart, <a href="http://www.marshallward.org/avoiding-utility-classes.html">Avoiding Utility Classes</a> by Marshal Ward, <a href="http://www.jroller.com/DhavalDalal/entry/kill_that_util_class">Kill That Util Class!</a> by Dhaval Dalal, <a href="http://www.robbagby.com/posts/helper-classes-are-a-code-smell/">Helper Classes Are A Code Smell</a> by Rob Bagby.</p><p>Additionally, there are a few questions on StackExchange about utility classes: <a href="http://stackoverflow.com/questions/3339929/if-a-utilities-class-is-evil-where-do-i-put-my-generic-code">If a “Utilities” class is evil, where do I put my generic code?</a>, <a href="http://stackoverflow.com/questions/3340032/utility-classes-are-evil">Utility Classes are Evil</a>.</p><p>A dry summary of all their arguments is that utility classes are not proper objects; therefore, they don't fit into object-oriented world. They were inherited from procedural programming, mostly because most were used to a functional decomposition paradigm back then.</p><p>Assuming you agree with the arguments and want to stop using utility classes, I'll show by example how these creatures can be replaced with proper objects.</p><h2 id="toc_1">Procedural Example</h2><p>Say, for instance, you want to read a text file, split it into lines, trim every line and then save the results in another file. This is can be done with <a href="http://commons.apache.org/proper/commons-io/apidocs/org/apache/commons/io/FileUtils.html"><code>FileUtils</code></a> from Apache Commons:</p><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><code class="java">1
2
3
4
5
6
7
8</code></pre></div></td><td class="code"><div class="highlight"><pre><span class="kt">void</span> <span class="nf">transform</span><span class="o">(</span><span class="n">File</span> <span class="n">in</span><span class="o">,</span> <span class="n">File</span> <span class="n">out</span><span class="o">)</span> <span class="o">{</span>
  <span class="n">Collection</span><span class="o">&lt;</span><span class="n">String</span><span class="o">&gt;</span> <span class="n">src</span> <span class="o">=</span> <span class="n">FileUtils</span><span class="o">.</span><span class="na">readLines</span><span class="o">(</span><span class="n">in</span><span class="o">,</span> <span class="s">"UTF-8"</span><span class="o">);</span>
  <span class="n">Collection</span><span class="o">&lt;</span><span class="n">String</span><span class="o">&gt;</span> <span class="n">dest</span> <span class="o">=</span> <span class="k">new</span> <span class="n">ArrayList</span><span class="o">&lt;&gt;(</span><span class="n">src</span><span class="o">.</span><span class="na">size</span><span class="o">());</span>
  <span class="k">for</span> <span class="o">(</span><span class="n">String</span> <span class="n">line</span> <span class="o">:</span> <span class="n">src</span><span class="o">)</span> <span class="o">{</span>
    <span class="n">dest</span><span class="o">.</span><span class="na">add</span><span class="o">(</span><span class="n">line</span><span class="o">.</span><span class="na">trim</span><span class="o">());</span>
  <span class="o">}</span>
  <span class="n">FileUtils</span><span class="o">.</span><span class="na">writeLines</span><span class="o">(</span><span class="n">out</span><span class="o">,</span> <span class="n">dest</span><span class="o">,</span> <span class="s">"UTF-8"</span><span class="o">);</span>
<span class="o">}</span></pre></div></td></tr></table><p>The above code may look clean; however, this is procedural programming, not object-oriented. We are manipulating data (bytes and bits) and explicitly instructing the computer from where to retrieve them and then where to put them on every single line of code. We're defining <em>a procedure of execution</em>.</p><h2 id="toc_2">Object-Oriented Alternative</h2><p>In an object-oriented paradigm, we should instantiate and compose objects, thus letting them manage data when and how <em>they</em> desire. Instead of calling supplementary static functions, we should create objects that are capable of exposing the behaviour we are seeking:</p><div class="highlight"><pre><code class="java"><span class="kd">public</span> <span class="kd">class</span> <span class="nc">Max</span> <span class="kd">implements</span> <span class="n">Number</span> <span class="o">{</span>
  <span class="kd">private</span> <span class="kd">final</span> <span class="kt">int</span> <span class="n">a</span><span class="o">;</span>
  <span class="kd">private</span> <span class="kd">final</span> <span class="kt">int</span> <span class="n">b</span><span class="o">;</span>
  <span class="kd">public</span> <span class="nf">Max</span><span class="o">(</span><span class="kt">int</span> <span class="n">x</span><span class="o">,</span> <span class="kt">int</span> <span class="n">y</span><span class="o">)</span> <span class="o">{</span>
    <span class="k">this</span><span class="o">.</span><span class="na">a</span> <span class="o">=</span> <span class="n">x</span><span class="o">;</span>
    <span class="k">this</span><span class="o">.</span><span class="na">b</span> <span class="o">=</span> <span class="n">y</span><span class="o">;</span>
  <span class="o">}</span>
  <span class="nd">@Override</span>
  <span class="kd">public</span> <span class="kt">int</span> <span class="nf">intValue</span><span class="o">()</span> <span class="o">{</span>
    <span class="k">return</span> <span class="k">this</span><span class="o">.</span><span class="na">a</span> <span class="o">&gt;</span> <span class="k">this</span><span class="o">.</span><span class="na">b</span> <span class="o">?</span> <span class="k">this</span><span class="o">.</span><span class="na">a</span> <span class="o">:</span> <span class="k">this</span><span class="o">.</span><span class="na">b</span><span class="o">;</span>
  <span class="o">}</span>
<span class="o">}</span>
</code></pre></div><p>This procedural call:</p><div class="highlight"><pre><code class="java"><span class="kt">int</span> <span class="n">max</span> <span class="o">=</span> <span class="n">NumberUtils</span><span class="o">.</span><span class="na">max</span><span class="o">(</span><span class="mi">10</span><span class="o">,</span> <span class="mi">5</span><span class="o">);</span>
</code></pre></div><p>Will become object-oriented:</p><div class="highlight"><pre><code class="java"><span class="kt">int</span> <span class="n">max</span> <span class="o">=</span> <span class="k">new</span> <span class="n">Max</span><span class="o">(</span><span class="mi">10</span><span class="o">,</span> <span class="mi">5</span><span class="o">).</span><span class="na">intValue</span><span class="o">();</span>
</code></pre></div><p>Potato, potato? Not really; just read on...</p><h2 id="toc_3">Objects Instead of Data Structures</h2><p>This is how I would design the same file-transforming functionality as above but in an object-oriented manner:</p><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><code class="java">1
2
3
4
5
6
7
8
9</code></pre></div></td><td class="code"><div class="highlight"><pre><span class="kt">void</span> <span class="nf">transform</span><span class="o">(</span><span class="n">File</span> <span class="n">in</span><span class="o">,</span> <span class="n">File</span> <span class="n">out</span><span class="o">)</span> <span class="o">{</span>
  <span class="n">Collection</span><span class="o">&lt;</span><span class="n">String</span><span class="o">&gt;</span> <span class="n">src</span> <span class="o">=</span> <span class="k">new</span> <span class="n">Trimmed</span><span class="o">(</span>
    <span class="k">new</span> <span class="nf">FileLines</span><span class="o">(</span><span class="k">new</span> <span class="n">UnicodeFile</span><span class="o">(</span><span class="n">in</span><span class="o">))</span>
  <span class="o">);</span>
  <span class="n">Collection</span><span class="o">&lt;</span><span class="n">String</span><span class="o">&gt;</span> <span class="n">dest</span> <span class="o">=</span> <span class="k">new</span> <span class="n">FileLines</span><span class="o">(</span>
    <span class="k">new</span> <span class="nf">UnicodeFile</span><span class="o">(</span><span class="n">out</span><span class="o">)</span>
  <span class="o">);</span>
  <span class="n">dest</span><span class="o">.</span><span class="na">addAll</span><span class="o">(</span><span class="n">src</span><span class="o">);</span>
<span class="o">}</span></pre></div></td></tr></table><p><code>FileLines</code> implements <code>Collection&lt;String&gt;</code> and encapsulates all file reading and writing operations. An instance of <code>FileLines</code> behaves exactly as a collection of strings and hides all I/O operations. When we iterate it — a file is being read. When we <code>addAll()</code> to it — a file is being written.</p><p><code>Trimmed</code> also implements <code>Collection&lt;String&gt;</code> and encapsulates a collection of strings (<a href="http://en.wikipedia.org/wiki/Decorator_pattern">Decorator pattern</a>). Every time the next line is retrieved, it gets trimmed.</p><p>All classes taking participation in the snippet are rather small: <code>Trimmed</code>, <code>FileLines</code>, and <code>UnicodeFile</code>. Each of them is responsible for its own single feature, thus following perfectly the <a href="http://en.wikipedia.org/wiki/Single_responsibility_principle">single responsibility principle</a>.</p><p>On our side, as users of the library, this may be not so important, but for their developers it is an imperative. It is much easier to develop, maintain and unit-test class <code>FileLines</code> rather than using a <code>readLines()</code> method in a 80+ methods and 3000 lines utility class <code>FileUtils</code>. Seriously, look at <a href="http://svn.apache.org/viewvc/commons/proper/io/trunk/src/main/java/org/apache/commons/io/FileUtils.java?view=co">its source code</a>.</p><p>An object-oriented approach enables lazy execution. The <code>in</code> file is not read until its data is required. If we fail to open <code>out</code> due to some I/O error, the first file won't even be touched. The whole show starts only after we call <code>addAll()</code>.</p><p>All lines in the second snippet, except the last one, instantiate and compose smaller objects into bigger ones. This object composition is rather cheap for the CPU since it doesn't cause any data transformations.</p><p>Besides that, it is obvious that the second script runs in O(1) space, while the first one executes in O(n). This is the consequence of our procedural approach to data in the first script.</p><p>In an object-oriented world, there is no data; there are only objects and their behavior!</p></article> <a href="/2014/05/05/oop-alternative-to-utility-classes.html#disqus_thread">comments</a> </section></div><div class="wrapper"> <section class="front"><p> <time datetime="2014-05-01T00:00:00+00:00"> 1 May 2014 </time></p> <header><h1> <a href="/2014/05/01/dynamodb-local-maven-plugin.html"> DynamoDB Local Maven Plugin </a></h1> </header> <article> <figure class='badge'><img src='http://img.yegor256.com/2014/04/dynamodb-logo.jpg' style='width:150px' alt='badge'/></figure><p><a href="http://docs.aws.amazon.com/amazondynamodb/latest/developerguide/Tools.html">DynamoDB Local</a> is a locally running copy of Amazon DynamoDB server. Amazon developed the tool and based it on SQLite. It acts as a real DynamoDB service through the RESTful API.</p><p>I guess, DynamoDB Local is meant to be used in integration testing and this is how we're going to use it below.</p><p>I use Maven to run all of my Java integration testing using <a href="http://maven.apache.org/surefire/maven-failsafe-plugin/">maven-failsafe-plugin</a>. The philosophy of integration testing with Maven is that you start all your supplementary test stubs during the <code>pre-integration-test</code> phase, run your tests in the <code>integration-test</code> phase and then shutdown all stubs during the <code>post-integration-test</code>.</p><figure class='badge'><img src='http://img.jcabi.com/logo-square.png' style='width:64px' alt='badge'/></figure><p>It would be great if it were possible to use DynamoDB Local that way. I didn't find any Maven plugins for that purpose, so I decided to create my own —<a href="https://github.com/jcabi/jcabi-dynamodb-maven-plugin">jcabi-dynamodb-maven-plugin</a>.</p><p>Full usage details for the plugin are explained on <a href="http://dynamodb.jcabi.com">its website</a>. However, here is a simple example:</p><div class="highlight"><pre><code class="xml"><span class="nt">&lt;plugin&gt;</span>
  <span class="nt">&lt;groupId&gt;</span>com.jcabi<span class="nt">&lt;/groupId&gt;</span>
  <span class="nt">&lt;artifactId&gt;</span>jcabi-dynamodb-maven-plugin<span class="nt">&lt;/artifactId&gt;</span>
  <span class="nt">&lt;version&gt;</span>0.6<span class="nt">&lt;/version&gt;</span>
  <span class="nt">&lt;executions&gt;</span>
    <span class="nt">&lt;execution&gt;</span>
      <span class="nt">&lt;goals&gt;</span>
        <span class="nt">&lt;goal&gt;</span>start<span class="nt">&lt;/goal&gt;</span>
        <span class="nt">&lt;goal&gt;</span>stop<span class="nt">&lt;/goal&gt;</span>
      <span class="nt">&lt;/goals&gt;</span>
      <span class="nt">&lt;configuration&gt;</span>
        <span class="nt">&lt;port&gt;</span>10500<span class="nt">&lt;/port&gt;</span>
        <span class="nt">&lt;dist&gt;</span>${project.build.directory}/dynamodb-dist<span class="nt">&lt;/dist&gt;</span>
      <span class="nt">&lt;/configuration&gt;</span>
    <span class="nt">&lt;/execution&gt;</span>
  <span class="nt">&lt;/executions&gt;</span>
<span class="nt">&lt;/plugin&gt;</span>
</code></pre></div><p>The above configuration will start DynamoDB Local right before running integration tests, and then stop it immediately afterwards. The server will listen at TCP port 10500. While the number is used in the example, you're supposed to use a <a href="http://mojo.codehaus.org/build-helper-maven-plugin/reserve-network-port-mojo.html">randomly allocated port</a> instead.</p><p>When the DynamoDB Local server is up and running, we can create an integration test for it:</p><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><code class="java"> 1
 2
 3
 4
 5
 6
 7
 8
 9
10
11
12
13
14
15
16
17</code></pre></div></td><td class="code"><div class="highlight"><pre><span class="kn">import</span> <span class="nn">com.amazonaws.auth.BasicAWSCredentials</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">com.amazonaws.services.dynamodbv2.AmazonDynamoDB</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">com.amazonaws.services.dynamodbv2.AmazonDynamoDBClient</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">com.amazonaws.services.dynamodbv2.model.ListTablesResult</span><span class="o">;</span>
<span class="kd">public</span> <span class="kd">class</span> <span class="nc">FooITCase</span> <span class="o">{</span>
  <span class="nd">@Test</span>
  <span class="kd">public</span> <span class="kt">void</span> <span class="nf">worksWithAwsDynamoDb</span><span class="o">()</span> <span class="o">{</span>
    <span class="n">AmazonDynamoDB</span> <span class="n">aws</span> <span class="o">=</span> <span class="k">new</span> <span class="n">AmazonDynamoDBClient</span><span class="o">(</span>
      <span class="k">new</span> <span class="nf">BasicAWSCredentials</span><span class="o">(</span><span class="s">""</span><span class="o">,</span> <span class="s">""</span><span class="o">)</span>
    <span class="o">);</span>
    <span class="n">aws</span><span class="o">.</span><span class="na">setEndpoint</span><span class="o">(</span><span class="s">"http://localhost:10500"</span><span class="o">);</span>
    <span class="n">ListTablesResult</span> <span class="n">list</span> <span class="o">=</span> <span class="n">aws</span><span class="o">.</span><span class="na">listTables</span><span class="o">();</span>
    <span class="k">for</span> <span class="o">(</span><span class="n">String</span> <span class="n">name</span> <span class="o">:</span> <span class="n">list</span><span class="o">.</span><span class="na">getTableNames</span><span class="o">())</span> <span class="o">{</span>
      <span class="n">System</span><span class="o">.</span><span class="na">out</span><span class="o">.</span><span class="na">println</span><span class="o">(</span><span class="s">"table found: "</span> <span class="o">+</span> <span class="n">name</span><span class="o">);</span>
    <span class="o">}</span>
  <span class="o">}</span>
<span class="o">}</span></pre></div></td></tr></table><p>Of course, there won't be any output because the server starts without any tables. Since the server is empty, you should create tables before every integration test, using <code>createTable()</code> from <a href="http://docs.aws.amazon.com/AWSJavaSDK/latest/javadoc/com/amazonaws/services/dynamodbv2/package-summary.html">DynamoDB SDK</a>.</p><p>To avoid this type of extra hassle, in the latest version 0.6 of <a href="http://dynamodb.jcabi.com">jcabi-dynamodb-maven-plugin</a> <a href="https://github.com/jcabi/jcabi-dynamodb-maven-plugin/issues/16">we introduced</a> a new goal <a href="http://dynamodb.jcabi.com/example-create-tables.html"><code>create-tables</code></a>:</p><div class="highlight"><pre><code class="xml"><span class="nt">&lt;plugin&gt;</span>
  <span class="nt">&lt;groupId&gt;</span>com.jcabi<span class="nt">&lt;/groupId&gt;</span>
  <span class="nt">&lt;artifactId&gt;</span>jcabi-dynamodb-maven-plugin<span class="nt">&lt;/artifactId&gt;</span>
  <span class="nt">&lt;executions&gt;</span>
    <span class="nt">&lt;execution&gt;</span>
      <span class="nt">&lt;goals&gt;</span>
        <span class="nt">&lt;goal&gt;</span>create-tables<span class="nt">&lt;/goal&gt;</span>
      <span class="nt">&lt;/goals&gt;</span>
      <span class="nt">&lt;configuration&gt;</span>
        <span class="nt">&lt;tables&gt;</span>
          <span class="nt">&lt;table&gt;</span>${basedir}/src/test/dynamodb/foo.json<span class="nt">&lt;/table&gt;</span>
        <span class="nt">&lt;/tables&gt;</span>
      <span class="nt">&lt;/configuration&gt;</span>
    <span class="nt">&lt;/execution&gt;</span>
  <span class="nt">&lt;/executions&gt;</span>
<span class="nt">&lt;/plugin&gt;</span>
</code></pre></div><p>The <code>foo.json</code> file used above should contain a JSON request that is sent to DynamoDB Local right after it is up and running. The request should comply with the specification of <a href="http://docs.aws.amazon.com/amazondynamodb/latest/APIReference/API_CreateTable.html">CreateTable</a> request. For example:</p><div class="highlight"><pre><code class="json"><span class="p">{</span>
  <span class="nt">"AttributeDefinitions"</span><span class="p">:</span> <span class="p">[</span>
    <span class="p">{</span>
      <span class="nt">"AttributeName"</span><span class="p">:</span> <span class="s2">"id"</span><span class="p">,</span>
      <span class="nt">"AttributeType"</span><span class="p">:</span> <span class="s2">"N"</span>
    <span class="p">}</span>
  <span class="p">],</span>
  <span class="nt">"KeySchema"</span><span class="p">:</span> <span class="p">[</span>
    <span class="p">{</span>
      <span class="nt">"AttributeName"</span><span class="p">:</span> <span class="s2">"id"</span><span class="p">,</span>
      <span class="nt">"KeyType"</span><span class="p">:</span> <span class="s2">"HASH"</span>
    <span class="p">}</span>
  <span class="p">],</span>
  <span class="nt">"ProvisionedThroughput"</span><span class="p">:</span> <span class="p">{</span>
    <span class="nt">"ReadCapacityUnits"</span><span class="p">:</span> <span class="s2">"1"</span><span class="p">,</span>
    <span class="nt">"WriteCapacityUnits"</span><span class="p">:</span> <span class="s2">"1"</span>
  <span class="p">},</span>
  <span class="nt">"TableName"</span><span class="p">:</span> <span class="s2">"foo"</span>
<span class="p">}</span>
</code></pre></div><p>The table will be created during the <code>pre-integration-test</code> phase and dropped at the <code>post-integration-test</code> phase. Now, we can make our integration test much more meaningful with the help of <a href="http://dynamo.jcabi.com">jcabi-dynamo</a>:</p><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><code class="java"> 1
 2
 3
 4
 5
 6
 7
 8
 9
10
11
12
13
14
15
16
17
18
19
20
21
22
23</code></pre></div></td><td class="code"><div class="highlight"><pre><span class="kn">import</span> <span class="nn">com.jcabi.dynamo.Attributes</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">com.jcabi.dynamo.Conditions</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">com.jcabi.dynamo.Credentials</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">com.jcabi.dynamo.Region</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">com.jcabi.dynamo.Table</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">org.hamcrest.MatcherAssert</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">org.hamcrest.Matchers</span><span class="o">;</span>
<span class="kd">public</span> <span class="kd">class</span> <span class="nc">FooITCase</span> <span class="o">{</span>
  <span class="nd">@Test</span>
  <span class="kd">public</span> <span class="kt">void</span> <span class="nf">worksWithAwsDynamoDb</span><span class="o">()</span> <span class="o">{</span>
    <span class="n">Region</span> <span class="n">region</span> <span class="o">=</span> <span class="k">new</span> <span class="n">Region</span><span class="o">.</span><span class="na">Simple</span><span class="o">(</span><span class="k">new</span> <span class="n">Credentials</span><span class="o">.</span><span class="na">Simple</span><span class="o">(</span><span class="s">""</span><span class="o">,</span> <span class="s">""</span><span class="o">));</span>
    <span class="n">Table</span> <span class="n">table</span> <span class="o">=</span> <span class="n">region</span><span class="o">.</span><span class="na">table</span><span class="o">(</span><span class="s">"foo"</span><span class="o">);</span>
    <span class="n">table</span><span class="o">.</span><span class="na">put</span><span class="o">(</span>
      <span class="k">new</span> <span class="nf">Attributes</span><span class="o">()</span>
        <span class="o">.</span><span class="na">with</span><span class="o">(</span><span class="s">"id"</span><span class="o">,</span> <span class="mi">123</span><span class="o">)</span>
        <span class="o">.</span><span class="na">with</span><span class="o">(</span><span class="s">"name"</span><span class="o">,</span> <span class="s">"Robert DeNiro"</span><span class="o">)</span>
    <span class="o">);</span>
    <span class="n">MatcherAssert</span><span class="o">.</span><span class="na">assertThat</span><span class="o">(</span>
      <span class="n">table</span><span class="o">.</span><span class="na">frame</span><span class="o">().</span><span class="na">where</span><span class="o">(</span><span class="s">"id"</span><span class="o">,</span> <span class="n">Conditions</span><span class="o">.</span><span class="na">equalTo</span><span class="o">(</span><span class="mi">123</span><span class="o">)),</span>
      <span class="n">Matchers</span><span class="o">.</span><span class="na">notEmpty</span><span class="o">()</span>
    <span class="o">);</span>
  <span class="o">}</span>
<span class="o">}</span></pre></div></td></tr></table><p>The above test will put a new item into the table and then assert that the item is there.</p><p>The plugin was tested with three operating systems, and proved to work without problems: Mac OS X 10.8.5, Windows 7 SP1 and Ubuntu Linux 12.04 Desktop.</p></article> <a href="/2014/05/01/dynamodb-local-maven-plugin.html#disqus_thread">comments</a> </section></div><div class="wrapper"> <section class="front"><p> <time datetime="2014-04-29T00:00:00+00:00"> 29 April 2014 </time></p> <header><h1> <a href="/2014/04/29/w3c-java-validators.html"> W3C Java Validators </a></h1> </header> <article> <figure class='badge'><img src='http://img.jcabi.com/logo-square.png' style='width:64px' alt='badge'/></figure><p>A few years ago, I created two Java wrappers for W3C validators: (<a href="http://validator.w3.org/">HTML</a> and <a href="http://jigsaw.w3.org/css-validator/">CSS</a>). Both wrappers seemed to be working fine and were even listed by W3C on <a href="http://validator.w3.org/docs/api.html">their website</a> in the API section. Until recently, these wrappers have always been part of <a href="http://www.rexsl.com">ReXSL</a> library.</p><p>A few days ago, though, I took the wrappers out of ReXSL and published them as a standalone library — <a href="http://w3c.jcabi.com">jcabi-w3c</a>. Consequently, now seems to be a good time to write a few words about them.</p><p>Below is an example that demonstrates how you can validate an HTML document against W3C compliancy rules:</p><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><code class="java">1
2
3
4</code></pre></div></td><td class="code"><div class="highlight"><pre><span class="kn">import</span> <span class="nn">com.jcabi.w3c.ValidatorBuilder</span><span class="o">;</span>
<span class="k">assert</span> <span class="n">ValidatorBuilder</span><span class="o">.</span><span class="na">html</span><span class="o">()</span>
  <span class="o">.</span><span class="na">validate</span><span class="o">(</span><span class="s">"&lt;html&gt;hello, world!&lt;/html&gt;"</span><span class="o">)</span>
  <span class="o">.</span><span class="na">valid</span><span class="o">();</span></pre></div></td></tr></table><p>The <code>valid()</code> method is a black or white indicator that returns <code>false</code> when the document is not valid. Additionally, you can obtain more information through a list of "defects" returned by the W3C server:</p><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><code class="java">1
2
3</code></pre></div></td><td class="code"><div class="highlight"><pre><span class="n">Collection</span><span class="o">&lt;</span><span class="n">Defect</span><span class="o">&gt;</span> <span class="n">defects</span> <span class="o">=</span> <span class="n">ValidatorBuilder</span><span class="o">.</span><span class="na">html</span><span class="o">()</span>
  <span class="o">.</span><span class="na">validate</span><span class="o">(</span><span class="s">"&lt;html&gt;hello, world!&lt;/html&gt;"</span><span class="o">)</span>
  <span class="o">.</span><span class="na">errors</span><span class="o">();</span></pre></div></td></tr></table><p>The same can be done with CSS:</p><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><code class="java">1
2
3</code></pre></div></td><td class="code"><div class="highlight"><pre><span class="n">Collection</span><span class="o">&lt;</span><span class="n">Defect</span><span class="o">&gt;</span> <span class="n">defects</span> <span class="o">=</span> <span class="n">ValidatorBuilder</span><span class="o">.</span><span class="na">css</span><span class="o">()</span>
  <span class="o">.</span><span class="na">validate</span><span class="o">(</span><span class="s">"body { font-family: Arial; }"</span><span class="o">)</span>
  <span class="o">.</span><span class="na">errors</span><span class="o">();</span></pre></div></td></tr></table><p>Personally, I think it is a good practice to validate all of HTML pages produced by your application against W3C during integration testing. It's not a matter of seeking perfection, but rather of preventing bigger problems later.</p></article> <a href="/2014/04/29/w3c-java-validators.html#disqus_thread">comments</a> </section></div><div class="wrapper"> <section class="front"><p> <time datetime="2014-04-28T00:00:00+00:00"> 28 April 2014 </time></p> <header><h1> <a href="/2014/04/28/xml-xpath-hamcrest-matchers.html"> XML/XPath Matchers for Hamcrest </a></h1> </header> <article> <figure class='badge'><img src='http://img.jcabi.com/logo-square.png' style='width:64px' alt='badge'/></figure><p><a href="https://github.com/hamcrest/JavaHamcrest">Hamcrest</a> is my favorite instrument in unit testing. It replaces the JUnit procedural assertions of <code>org.junit.Assert</code> with an object-oriented mechanism. However, I will discuss that subject in more detail sometime later.</p><p>Now, though, I want to demonstrate a new library published today on Github and Maven Central:</p><p><a href="http://matchers.jcabi.com">jcabi-matchers</a>. jcabi-matchers is a collection of Hamcrest matchers to make XPath assertions in XML and XHTML documents.</p><p>Let's say, for instance, a class that is undergoing testing produces an XML that needs to contain a single <code>&lt;message&gt;</code> element with the content <code>"hello, world!"</code></p><p>This is how that code would look in a unit test:</p><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><code class="java"> 1
 2
 3
 4
 5
 6
 7
 8
 9
10
11
12
13
14
15</code></pre></div></td><td class="code"><div class="highlight"><pre><span class="kn">import</span> <span class="nn">com.jcabi.matchers.XhtmlMatchers</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">org.hamcrest.MatcherAssert</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">org.junit.Test</span><span class="o">;</span>
<span class="kd">public</span> <span class="kd">class</span> <span class="nc">FooTest</span> <span class="o">{</span>
  <span class="nd">@Test</span>
  <span class="kd">public</span> <span class="kt">void</span> <span class="nf">hasWelcomeMessage</span><span class="o">()</span> <span class="o">{</span>
    <span class="n">MatcherAssert</span><span class="o">.</span><span class="na">assertThat</span><span class="o">(</span>
      <span class="k">new</span> <span class="nf">Foo</span><span class="o">().</span><span class="na">createXml</span><span class="o">(),</span>
      <span class="n">XhtmlMatchers</span><span class="o">.</span><span class="na">hasXPaths</span><span class="o">(</span>
        <span class="s">"/document[count(message)=1]"</span><span class="o">,</span>
        <span class="s">"/document/message[.='hello, world!']"</span>
      <span class="o">)</span>
    <span class="o">);</span>
  <span class="o">}</span>
<span class="o">}</span></pre></div></td></tr></table><p>There are two alternatives to the above that I'm aware of, which are do almost the same thing: <a href="https://code.google.com/p/xml-matchers/">xml-matchers</a> by <a href="http://blog.davidehringer.com/testing/xmlmatchers-hamcrest-matchers-xml/">David Ehringer</a> and <a href="http://hamcrest.org/JavaHamcrest/javadoc/1.3/org/hamcrest/Matchers.html#hasXPath%28java.lang.String%29"><code>hasXPath()</code></a> method in Hamcrest itself.</p><p>I have tried them both, but faced a number of problems.</p><p>First, Hamcrest <code>hasXPath()</code> works only with an instance of <a href="http://docs.oracle.com/javase/7/docs/api/org/w3c/dom/Node.html"><code>Node</code></a>. With this method, converting a <code>String</code> into <code>Node</code> becomes a repetitive and routine task in every unit test.</p><p>The above is a very strange limitation of Hamcrest in contrast to <a href="http://matchers.jcabi.com">jcabi-matchers</a>, which works with almost anything, from a <code>String</code> to a <a href="http://docs.oracle.com/javase/7/docs/api/java/io/Reader.html"><code>Reader</code></a> and even an <a href="http://docs.oracle.com/javase/7/docs/api/java/io/InputStream.html"><code>InputStream</code></a>.</p><p>Second, `XmlMatchers from <a href="https://code.google.com/p/xml-matchers/">xml-matchers</a> provides a very inconvenient way for working with namespaces. Before you can use an XPath query with a non-default namespace, you should create an instance of NamespaceContext.</p><p>The library provides <a href="https://code.google.com/p/xml-matchers/source/browse/trunk/xml-matchers/src/main/java/org/xmlmatchers/namespace/SimpleNamespaceContext.java">a simple implementation</a> of this interface, but, still, it is requires extra code in every unit test.</p><p><a href="http://matchers.jcabi.com">jcabi-matchers</a> simplifies namespace handling problems even further, as it pre-defines most popular namespaces, including <code>xtml</code>, <code>xs</code>, <code>xsl</code>, etc.</p><p>The following example works right out-of-the-box — without any extra configuration:</p><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><code class="java">1
2
3
4</code></pre></div></td><td class="code"><div class="highlight"><pre><span class="n">MatcherAssert</span><span class="o">.</span><span class="na">assertThat</span><span class="o">(</span>
  <span class="k">new</span> <span class="nf">URL</span><span class="o">(</span><span class="s">"http://www.google.com"</span><span class="o">).</span><span class="na">getContent</span><span class="o">(),</span>
  <span class="n">XhtmlMatchers</span><span class="o">.</span><span class="na">hasXPath</span><span class="o">(</span><span class="s">"//xhtml:body"</span><span class="o">)</span>
<span class="o">);</span></pre></div></td></tr></table><p>To summarize, my primary objective with the library was its simplicity of usage.</p></article> <a href="/2014/04/28/xml-xpath-hamcrest-matchers.html#disqus_thread">comments</a> </section></div><div class="wrapper"> <section class="front"><p> <time datetime="2014-04-27T00:00:00+00:00"> 27 April 2014 </time></p> <header><h1> <a href="/2014/04/27/typical-mistakes-in-java-code.html"> Typical Mistakes in Java Code </a></h1> </header> <article><p>This page contains most typical mistakes I see in the Java code of people working with me. Static analysis (we're using <a href="http://www.qulice.com">qulice</a> can't catch all of the mistakes for obvious reasons, and that's why I decided to list them all here.</p><p>Let me know if you want to see something else added here, and I'll be happy to oblige.</p><p>All of the listed mistakes are related to object-oriented programming in general and to Java in particular.</p><h2 id="toc_0">Class Names</h2><p>Read this short <a href="https://github.com/yegor256/d29/wiki/What-is-an-Object%3F">"What is an Object?"</a> article. Your class should be an abstraction of a real life entity with no "validators", "controllers", "managers", etc. If your class name ends with an "-er" — it's <a href="http://c2.com/cgi/wiki?DontNameClassesObjectManagerHandlerOrData">a bad design</a>.</p><p>And, of course, utility classes are anti-patterns, like <a href="http://commons.apache.org/proper/commons-lang/javadocs/api-2.6/org/apache/commons/lang/StringUtils.html"><code>StringUtils</code></a>, <a href="http://commons.apache.org/proper/commons-io/apidocs/org/apache/commons/io/FileUtils.html"><code>FileUtils</code></a>, and <a href="http://commons.apache.org/proper/commons-io/apidocs/org/apache/commons/io/IOUtils.html"><code>IOUtils</code></a> from Apache. The above are perfect examples of terrible designs. Read this follow up post: <a href="/2014/05/05/oop-alternative-to-utility-classes.html">OOP Alternative to Utility Classes</a></p><p>Of course, never add suffixes or prefixes to distinguish between <a href="http://c2.com/cgi/wiki?DontDistinguishBetweenClassesAndInterfaces">interfaces and classes</a>. For example, all of these names are terribly wrong: <code>IRecord</code>, <code>IfaceEmployee</code>, or <code>RecordInterface</code>. Usually, interface name is the name of a real-life entity, while class name should explain its implementation details. If there is nothing specific to say about an implementation, name it <code>Default,</code> <code>Simple</code>, or something similar. For example:</p><div class="highlight"><pre><code class="java language-java" data-lang="java"><span class="kd">class</span> <span class="nc">SimpleUser</span> <span class="kd">implements</span> <span class="n">User</span> <span class="o">{};</span>
<span class="kd">class</span> <span class="nc">DefaultRecord</span> <span class="kd">implements</span> <span class="n">Record</span> <span class="o">{};</span>
<span class="kd">class</span> <span class="nc">Suffixed</span> <span class="kd">implements</span> <span class="n">Name</span> <span class="o">{};</span>
<span class="kd">class</span> <span class="nc">Validated</span> <span class="kd">implements</span> <span class="n">Content</span> <span class="o">{};</span>
</code></pre></div><h2 id="toc_1">Method Names</h2><p>Methods can either return something or return <code>void</code>. If a method returns something, then its name should explain <em>what it returns</em>, for example (don't use the <code>get</code> prefix ever):</p><div class="highlight"><pre><code class="java language-java" data-lang="java"><span class="kt">boolean</span> <span class="nf">isValid</span><span class="o">(</span><span class="n">String</span> <span class="n">name</span><span class="o">);</span>
<span class="n">String</span> <span class="nf">content</span><span class="o">();</span>
<span class="kt">int</span> <span class="nf">ageOf</span><span class="o">(</span><span class="n">File</span> <span class="n">file</span><span class="o">);</span>
</code></pre></div><p>If it returns <code>void,</code> then its name should explain <em>what it does</em>. For example:</p><div class="highlight"><pre><code class="java language-java" data-lang="java"><span class="kt">void</span> <span class="nf">save</span><span class="o">(</span><span class="n">File</span> <span class="n">file</span><span class="o">);</span>
<span class="kt">void</span> <span class="nf">process</span><span class="o">(</span><span class="n">Work</span> <span class="n">work</span><span class="o">);</span>
<span class="kt">void</span> <span class="nf">append</span><span class="o">(</span><span class="n">File</span> <span class="n">file</span><span class="o">,</span> <span class="n">String</span> <span class="n">line</span><span class="o">);</span>
</code></pre></div><p>There is only one exception to the rule just mentioned — test methods for JUnit. They are explained below.</p><h2 id="toc_2">Test Method Names</h2><p>Method names in JUnit tests should be created as English sentences without spaces. It's easier to explain by example:</p><div class="highlight"><pre><code class="java language-java" data-lang="java"><span class="cm">/**</span>
<span class="cm"> * HttpRequest can return its content in Unicode.</span>
<span class="cm"> * @throws Exception If test fails</span>
<span class="cm"> */</span>
<span class="kd">public</span> <span class="kt">void</span> <span class="nf">returnsItsContentInUnicode</span><span class="o">()</span> <span class="kd">throws</span> <span class="n">Exception</span> <span class="o">{</span>
<span class="o">}</span>
</code></pre></div><p>It's important to start the first sentence of your JavaDoc with the name of the class you're testing followed by <code>can</code>. So, your first sentence should always be similar to "somebody <em>can</em> do something".</p><p>The method name will state exactly the same, but without the subject. If I add a subject at the beginning of the method name, I should get a complete English sentence, as in above example: "HttpRequest returns its content in unicode".</p><p>Pay attention that the test method doesn't start with <code>can</code>.Only JavaDoc comments start with 'can.' Additionally, method names shouldn’t start with a verb.</p><p>It's a good practice to always declare test methods as throwing <code>Exception</code>.</p><h2 id="toc_3">Variable Names</h2><p>Avoid composite names of variables, like <code>timeOfDay</code>, <code>firstItem</code>, or <code>httpRequest</code>. I mean with both — class variables and in-method ones. A variable name should be long enough to avoid ambiguity in its scope of visibility, but not too long if possible. A name should be a noun in singular or plural form, or an appropriate abbreviation. For example:</p><div class="highlight"><pre><code class="java language-java" data-lang="java"><span class="n">List</span><span class="o">&lt;</span><span class="n">String</span><span class="o">&gt;</span> <span class="n">names</span><span class="o">;</span>
<span class="kt">void</span> <span class="nf">sendThroughProxy</span><span class="o">(</span><span class="n">File</span> <span class="n">file</span><span class="o">,</span> <span class="n">Protocol</span> <span class="n">proto</span><span class="o">);</span>
<span class="kd">private</span> <span class="n">File</span> <span class="n">content</span><span class="o">;</span>
<span class="kd">public</span> <span class="n">HttpRequest</span> <span class="n">request</span><span class="o">;</span>
</code></pre></div><p>Sometimes, you may have collisions between constructor parameters and in-class properties if the constructor saves incoming data in an instantiated object. In this case, I recommend to create abbreviations by removing vowels (see how <a href="https://www.usps.com/send/official-abbreviations.htm">USPS abbreviates street names</a>).</p><p>Another example:</p><div class="highlight"><pre><code class="java language-java" data-lang="java"><span class="kd">public</span> <span class="kd">class</span> <span class="nc">Message</span> <span class="o">{</span>
  <span class="kd">private</span> <span class="n">String</span> <span class="n">recipient</span><span class="o">;</span>
  <span class="kd">public</span> <span class="nf">Message</span><span class="o">(</span><span class="n">String</span> <span class="n">rcpt</span><span class="o">)</span> <span class="o">{</span>
    <span class="k">this</span><span class="o">.</span><span class="na">recipient</span> <span class="o">=</span> <span class="n">rcpt</span><span class="o">;</span>
  <span class="o">}</span>
<span class="o">}</span>
</code></pre></div><p>In many cases, the best hint for a name of a variable can ascertained by reading its class name. Just write it with a small letter, and you should be good:</p><div class="highlight"><pre><code class="java language-java" data-lang="java"><span class="n">File</span> <span class="n">file</span><span class="o">;</span>
<span class="n">User</span> <span class="n">user</span><span class="o">;</span>
<span class="n">Branch</span> <span class="n">branch</span><span class="o">;</span>
</code></pre></div><p>However, <em>never</em> do the same for primitive types, like <code>Integer number</code> or <code>String string</code>.</p><p>You can also use an adjective, when there are multiple variables with different characteristics. For instance:</p><div class="highlight"><pre><code class="text language-text" data-lang="text">String contact(String left, String right);
</code></pre></div><h2 id="toc_4">Constructors</h2><p>Without exceptions, there should be only <em>one</em> constructor that stores data in object variables. All other constructors should call this one with different arguments. For example:</p><div class="highlight"><pre><code class="java language-java" data-lang="java"><span class="kd">public</span> <span class="kd">class</span> <span class="nc">Server</span> <span class="o">{</span>
  <span class="kd">private</span> <span class="n">String</span> <span class="n">address</span><span class="o">;</span>
  <span class="kd">public</span> <span class="nf">Server</span><span class="o">(</span><span class="n">String</span> <span class="n">uri</span><span class="o">)</span> <span class="o">{</span>
    <span class="k">this</span><span class="o">.</span><span class="na">address</span> <span class="o">=</span> <span class="n">uri</span><span class="o">;</span>
  <span class="o">}</span>
  <span class="kd">public</span> <span class="nf">Server</span><span class="o">(</span><span class="n">URI</span> <span class="n">uri</span><span class="o">)</span> <span class="o">{</span>
    <span class="k">this</span><span class="o">(</span><span class="n">uri</span><span class="o">.</span><span class="na">toString</span><span class="o">());</span>
  <span class="o">}</span>
<span class="o">}</span>
</code></pre></div><h2 id="toc_5">One-time Variables</h2><p>Avoid one-time variables at all costs. By "one-time" I mean variables that are used only once. Like in this example:</p><div class="highlight"><pre><code class="java language-java" data-lang="java"><span class="n">String</span> <span class="n">name</span> <span class="o">=</span> <span class="s">"data.txt"</span><span class="o">;</span>
<span class="k">return</span> <span class="k">new</span> <span class="nf">File</span><span class="o">(</span><span class="n">name</span><span class="o">);</span>
</code></pre></div><p>This above variable is used only once and the code should be refactored to:</p><div class="highlight"><pre><code class="java language-java" data-lang="java"><span class="k">return</span> <span class="k">new</span> <span class="nf">File</span><span class="o">(</span><span class="s">"data.txt"</span><span class="o">);</span>
</code></pre></div><p>Sometimes, in very rare cases — mostly because of better formatting — one-time variables may be used. Nevertheless, try to avoid such situations at all costs.</p><h2 id="toc_6">Exceptions</h2><p>Needless to say, you should <strong>never</strong> swallow exceptions, but rather let them bubble up as high as possible. Private methods should always let checked exceptions go out.</p><p>Never use exceptions for flow control. For example this code is wrong:</p><div class="highlight"><pre><code class="java language-java" data-lang="java"><span class="kt">int</span> <span class="n">size</span><span class="o">;</span>
<span class="k">try</span> <span class="o">{</span>
  <span class="n">size</span> <span class="o">=</span> <span class="k">this</span><span class="o">.</span><span class="na">fileSize</span><span class="o">();</span>
<span class="o">}</span> <span class="k">catch</span> <span class="o">(</span><span class="n">IOException</span> <span class="n">ex</span><span class="o">)</span> <span class="o">{</span>
  <span class="n">size</span> <span class="o">=</span> <span class="mi">0</span><span class="o">;</span>
<span class="o">}</span>
</code></pre></div><p>Seriously, what if that <code>IOException</code> says "disk is full"? Will you still assume that the size of the file is zero and move on?</p><h2 id="toc_7">Indentation</h2><p>For indentation, the main rule is that a bracket should either end a line or be closed on the same line (reverse rule applies to a closing bracket). For example, the following is not correct because the first bracket is not closed on the same line and there are symbols after it. The second bracket is also in trouble because there are symbols in front of it and it is not opened on the same line:</p><div class="highlight"><pre><code class="text language-text" data-lang="text">final File file = new File(directory,
  "file.txt");
</code></pre></div><p>Correct indentation should look like:</p><div class="highlight"><pre><code class="text language-text" data-lang="text">StringUtils.join(
  Arrays.asList(
    "first line",
    "second line",
    StringUtils.join(
      Arrays.asList("a", "b")
    )
  ),
  "separator"
);
</code></pre></div><p>The second important rule of indentation says that you should put as much as possible on one line - within the limit of 80 characters. The example above is not valid since it can be compacted:</p><div class="highlight"><pre><code class="text language-text" data-lang="text">StringUtils.join(
  Arrays.asList(
    "first line", "second line",
    StringUtils.join(Arrays.asList("a", "b"))
  ),
  "separator"
);
</code></pre></div><h2 id="toc_8">Redundant Constants</h2><p>Class constants should be used when you want to share information between class methods, and this information is a characteristic (!) of your class. Don't use constants as a replacement of string or numeric literals — very bad practice that leads to code pollution. Constants (as with any object in OOP) should have a meaning in a real world. What meaning do these constants have in the real world:</p><div class="highlight"><pre><code class="java language-java" data-lang="java"><span class="kd">class</span> <span class="nc">Document</span> <span class="o">{</span>
  <span class="kd">private</span> <span class="kd">static</span> <span class="kd">final</span> <span class="n">String</span> <span class="n">D_LETTER</span> <span class="o">=</span> <span class="s">"D"</span><span class="o">;</span> <span class="c1">// bad practice</span>
  <span class="kd">private</span> <span class="kd">static</span> <span class="kd">final</span> <span class="n">String</span> <span class="n">EXTENSION</span> <span class="o">=</span> <span class="s">".doc"</span><span class="o">;</span> <span class="c1">// good practice</span>
<span class="o">}</span>
</code></pre></div><p>Another typical mistake is to use constants in unit tests to avoid duplicate string/numeric literals in test methods. Don't do this! Every test method should work with its own set of input values.</p><p>Use new texts and numbers in every new test method. They are independent. So, why do they have to share the same input constants?</p><h2 id="toc_9">Test Data Coupling</h2><p>This is an example of <a href="http://en.wikipedia.org/wiki/Coupling_%28computer_programming%29">data coupling</a> in a test method:</p><div class="highlight"><pre><code class="java language-java" data-lang="java"><span class="n">User</span> <span class="n">user</span> <span class="o">=</span> <span class="k">new</span> <span class="n">User</span><span class="o">(</span><span class="s">"Jeff"</span><span class="o">);</span>
<span class="c1">// maybe some other code here</span>
<span class="n">MatcherAssert</span><span class="o">.</span><span class="na">assertThat</span><span class="o">(</span><span class="n">user</span><span class="o">.</span><span class="na">name</span><span class="o">(),</span> <span class="n">Matchers</span><span class="o">.</span><span class="na">equalTo</span><span class="o">(</span><span class="s">"Jeff"</span><span class="o">));</span>
</code></pre></div><p>On the last line, we couple <code>"Jeff"</code> with the same string literal from the first line. If, a few months later, someone wants to change the value on the third line, he/she has to spend extra time finding where else <code>"Jeff"</code> is used in the same method.</p><p>To avoid this data coupling, you should introduce a variable.</p></article> <a href="/2014/04/27/typical-mistakes-in-java-code.html#disqus_thread">comments</a> </section></div><div class="wrapper"><div class="pagination"><div style="float:left"> <span class="mute">prev</span></div> page 1 of 3<div style="float:right"> <a href="/p/2">next</a></div></div></div></body> <script src="/js/all.js?ba2cc6c"></script></html>