<!DOCTYPE html> <html xmlns="http://www.w3.org/1999/xhtml" lang="en-US" xml:lang="en-US" itemscope="" itemtype="http://schema.org/WebSite"> <head> <meta charset="utf-8"/> <meta name="description" content="&lt;figure class=&quot;badge&quot;&gt;&lt;a href=&quot;http://www.takes.org&quot;&gt;&lt;img src=&quot;http://www.takes.org/logo.png&quot; style=&quot;width:96px;max-width:100%;&quot; alt=&quot;badge&quot; /&gt;&lt;/a&gt;&lt;/figure&gt; &lt;p&gt;A year ago, I &lt;a href=&quot;/2014/06/25/xml-and-xslt-in-browser.html&quot;&gt;tried to explain&lt;/a&gt; how effectively data and its presentation can be separated in a web application with the help of XML and XSL. In a few words, instead of using &lt;a href=&quot;https://en.wikipedia.org/wiki/Comparison_of_web_template_engines&quot;&gt;templating&lt;/a&gt; (like JSP, Velocity, FreeMarker, etc.) and injection of data into HTML, we compose them in the form of an XML document and then let the XSL stylesheet transform them into HTML. Here is a brief example of how all this can be used together with the &lt;a href=&quot;http://www.takes.org&quot;&gt;Takes framework&lt;/a&gt;.&lt;/p&gt; &lt;!--more--&gt; &lt;p&gt;First, let’s agree that templating is a bad idea in the first place. Yes, I mean it. The entire design of JSP is wrong, with all due respect to its creators. Here is how it works: Let’s say my website has to fetch the current exchange rate of the euro from a database and show it on the home page. Here’s how my &lt;code&gt;index.jsp&lt;/code&gt; would look:&lt;/p&gt; &lt;figure class=&quot;highlight&quot;&gt;&lt;pre&gt;&lt;code class=&quot;language-jsp&quot; data-lang=&quot;jsp&quot;&gt;&lt;span&gt;&lt;/span&gt;&lt;span class=&quot;nt&quot;&gt;&amp;lt;html&amp;gt;&lt;/span&gt; &lt;span class=&quot;nt&quot;&gt;&amp;lt;body&amp;gt;&lt;/span&gt; &lt;span class=&quot;nt&quot;&gt;&amp;lt;p&amp;gt;&lt;/span&gt;EUR/USD: &lt;span class=&quot;k&quot;&gt;&amp;lt;%=&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;rates&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;na&quot;&gt;get&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;()&lt;/span&gt; &lt;span class=&quot;k&quot;&gt;%&amp;gt;&lt;/span&gt;&lt;span class=&quot;nt&quot;&gt;&amp;lt;/p&amp;gt;&lt;/span&gt; &lt;span class=&quot;nt&quot;&gt;&amp;lt;/body&amp;gt;&lt;/span&gt; &lt;span class=&quot;nt&quot;&gt;&amp;lt;/html&amp;gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/figure&gt; &lt;p&gt;In order to create HTML, the JSP engine will have to call &lt;code&gt;get()&lt;/code&gt; on object &lt;code&gt;rates&lt;/code&gt; and render what’s returned through &lt;code&gt;toString()&lt;/code&gt;. It’s a terrible design for a few reasons. First, the view is tightly coupled with the model. Second, the flexibility of rendering is very limited. Third, the result of rendering is not reusable, and views are not stackable. There are many other reasons … more about them in one of the next articles.&lt;/p&gt; &lt;aside class=&quot;youtube&quot;&gt; &lt;a href=&quot;https://www.youtube.com/watch?v=nheD2LNYrpk&quot;&gt;&lt;div class=&quot;box&quot;&gt; &lt;img src=&quot;https://i.ytimg.com/vi/nheD2LNYrpk/mqdefault.jpg&quot; alt=&quot;YouTube video #nheD2LNYrpk&quot; /&gt; &lt;div class=&quot;play&quot;&gt;&lt;i class=&quot;icon icon-play&quot;&gt;&lt;/i&gt;&lt;/div&gt; &lt;/div&gt;&lt;/a&gt; &lt;div&gt;Takes, Java Web Framework, Intro (webinar #12); 2 March 2016.&lt;/div&gt;&lt;/aside&gt; &lt;p&gt;Let’s see how this should be done right. First, we let our model generate the output in XML format, for example:&lt;/p&gt; &lt;figure class=&quot;highlight&quot;&gt;&lt;pre&gt;&lt;code class=&quot;language-xml&quot; data-lang=&quot;xml&quot;&gt;&lt;span&gt;&lt;/span&gt;&lt;span class=&quot;cp&quot;&gt;&amp;lt;?xml version=&amp;quot;1.1&amp;quot;?&amp;gt;&lt;/span&gt; &lt;span class=&quot;nt&quot;&gt;&amp;lt;page&amp;gt;&lt;/span&gt; &lt;span class=&quot;nt&quot;&gt;&amp;lt;rate&amp;gt;&lt;/span&gt;1.1324&lt;span class=&quot;nt&quot;&gt;&amp;lt;/rate&amp;gt;&lt;/span&gt; &lt;span class=&quot;nt&quot;&gt;&amp;lt;/page&amp;gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/figure&gt; &lt;p&gt;This is what the model will produce, having no knowledge of the view. Then, we create the view as an XSL stylesheet, which will transform XML into HTML:&lt;/p&gt; &lt;figure class=&quot;highlight&quot;&gt;&lt;pre&gt;&lt;code class=&quot;language-xml&quot; data-lang=&quot;xml&quot;&gt;&lt;span&gt;&lt;/span&gt;&lt;span class=&quot;nt&quot;&gt;&amp;lt;xsl:stylesheet&lt;/span&gt; &lt;span class=&quot;na&quot;&gt;version=&lt;/span&gt;&lt;span class=&quot;s&quot;&gt;&amp;quot;1.0&amp;quot;&lt;/span&gt; &lt;span class=&quot;na&quot;&gt;xmlns:xsl=&lt;/span&gt;&lt;span class=&quot;s&quot;&gt;&amp;quot;http://www.w3.org/1999/XSL/Transform&amp;quot;&lt;/span&gt; &lt;span class=&quot;na&quot;&gt;xmlns=&lt;/span&gt;&lt;span class=&quot;s&quot;&gt;&amp;quot;http://www.w3.org/1999/xhtml&amp;quot;&lt;/span&gt;&lt;span class=&quot;nt&quot;&gt;&amp;gt;&lt;/span&gt; &lt;span class=&quot;nt&quot;&gt;&amp;lt;xsl:template&lt;/span&gt; &lt;span class=&quot;na&quot;&gt;match=&lt;/span&gt;&lt;span class=&quot;s&quot;&gt;&amp;quot;page&amp;quot;&lt;/span&gt;&lt;span class=&quot;nt&quot;&gt;&amp;gt;&lt;/span&gt; &lt;span class=&quot;nt&quot;&gt;&amp;lt;html&amp;gt;&lt;/span&gt; &lt;span class=&quot;nt&quot;&gt;&amp;lt;body&amp;gt;&lt;/span&gt; &lt;span class=&quot;nt&quot;&gt;&amp;lt;p&amp;gt;&lt;/span&gt; &lt;span class=&quot;nt&quot;&gt;&amp;lt;xsl:text&amp;gt;&lt;/span&gt;EUR/USD: &lt;span class=&quot;nt&quot;&gt;&amp;lt;/xsl:text&amp;gt;&lt;/span&gt; &lt;span class=&quot;nt&quot;&gt;&amp;lt;xsl:value-of&lt;/span&gt; &lt;span class=&quot;na&quot;&gt;select=&lt;/span&gt;&lt;span class=&quot;s&quot;&gt;&amp;quot;rate&amp;quot;&lt;/span&gt;&lt;span class=&quot;nt&quot;&gt;/&amp;gt;&lt;/span&gt; &lt;span class=&quot;nt&quot;&gt;&amp;lt;/p&amp;gt;&lt;/span&gt; &lt;span class=&quot;nt&quot;&gt;&amp;lt;/body&amp;gt;&lt;/span&gt; &lt;span class=&quot;nt&quot;&gt;&amp;lt;/html&amp;gt;&lt;/span&gt; &lt;span class=&quot;nt&quot;&gt;&amp;lt;/xsl:template&amp;gt;&lt;/span&gt; &lt;span class=&quot;nt&quot;&gt;&amp;lt;/xsl:stylesheet&amp;gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/figure&gt; &lt;p&gt;As you see, the view doesn’t know anything about the model in terms of implementation. All it knows is the format of XML data output produced by the model. Here is how you design it in the &lt;a href=&quot;http://www.takes.org&quot;&gt;Takes framework&lt;/a&gt;. Let’s start with a simple example:&lt;/p&gt; &lt;figure class=&quot;highlight&quot;&gt;&lt;pre&gt;&lt;code class=&quot;language-java&quot; data-lang=&quot;java&quot;&gt;&lt;span&gt;&lt;/span&gt;&lt;span class=&quot;kn&quot;&gt;import&lt;/span&gt; &lt;span class=&quot;nn&quot;&gt;org.takes.http.Exit&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;;&lt;/span&gt; &lt;span class=&quot;kn&quot;&gt;import&lt;/span&gt; &lt;span class=&quot;nn&quot;&gt;org.takes.http.FtCli&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;;&lt;/span&gt; &lt;span class=&quot;kd&quot;&gt;public&lt;/span&gt; &lt;span class=&quot;kd&quot;&gt;final&lt;/span&gt; &lt;span class=&quot;kd&quot;&gt;class&lt;/span&gt; &lt;span class=&quot;nc&quot;&gt;Entry&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;{&lt;/span&gt; &lt;span class=&quot;kd&quot;&gt;public&lt;/span&gt; &lt;span class=&quot;kd&quot;&gt;static&lt;/span&gt; &lt;span class=&quot;kt&quot;&gt;void&lt;/span&gt; &lt;span class=&quot;nf&quot;&gt;main&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;kd&quot;&gt;final&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;String&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;...&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;args&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;kd&quot;&gt;throws&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;Exception&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;{&lt;/span&gt; &lt;span class=&quot;k&quot;&gt;new&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;FtCli&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;k&quot;&gt;new&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;TkApp&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;(),&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;args&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;).&lt;/span&gt;&lt;span class=&quot;na&quot;&gt;start&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;Exit&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;na&quot;&gt;NEVER&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;);&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;}&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;}&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/figure&gt; &lt;p&gt;It’s a simple web application that starts a web server and never ends (it waits for connections in daemon mode). To make it work, we should create a simple “take” named &lt;code&gt;TkApp&lt;/code&gt;:&lt;/p&gt; &lt;figure class=&quot;highlight&quot;&gt;&lt;pre&gt;&lt;code class=&quot;language-java&quot; data-lang=&quot;java&quot;&gt;&lt;span&gt;&lt;/span&gt;&lt;span class=&quot;kn&quot;&gt;import&lt;/span&gt; &lt;span class=&quot;nn&quot;&gt;org.takes.Take&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;;&lt;/span&gt; &lt;span class=&quot;kn&quot;&gt;import&lt;/span&gt; &lt;span class=&quot;nn&quot;&gt;org.takes.tk.TkWrap&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;;&lt;/span&gt; &lt;span class=&quot;kd&quot;&gt;final&lt;/span&gt; &lt;span class=&quot;kd&quot;&gt;class&lt;/span&gt; &lt;span class=&quot;nc&quot;&gt;TkApp&lt;/span&gt; &lt;span class=&quot;kd&quot;&gt;extends&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;TkWrap&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;{&lt;/span&gt; &lt;span class=&quot;nd&quot;&gt;@Override&lt;/span&gt; &lt;span class=&quot;kd&quot;&gt;public&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;Response&lt;/span&gt; &lt;span class=&quot;nf&quot;&gt;act&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;()&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;{&lt;/span&gt; &lt;span class=&quot;k&quot;&gt;return&lt;/span&gt; &lt;span class=&quot;k&quot;&gt;new&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;RsWithType&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;(&lt;/span&gt; &lt;span class=&quot;k&quot;&gt;new&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;RsText&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;(&lt;/span&gt; &lt;span class=&quot;s&quot;&gt;&amp;quot;&amp;lt;page&amp;gt;&amp;lt;rate&amp;gt;1.1324&amp;lt;/rate&amp;gt;&amp;lt;/page&amp;gt;&amp;quot;&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;),&lt;/span&gt; &lt;span class=&quot;s&quot;&gt;&amp;quot;application/xml&amp;quot;&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;);&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;}&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;}&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/figure&gt; &lt;p&gt;This “take” always returns the same XML response, but it doesn’t do any XSL transformation yet. We need to add the &lt;code&gt;RsXSLT&lt;/code&gt; class to the picture:&lt;/p&gt; &lt;figure class=&quot;highlight&quot;&gt;&lt;pre&gt;&lt;code class=&quot;language-java&quot; data-lang=&quot;java&quot;&gt;&lt;span&gt;&lt;/span&gt;&lt;span class=&quot;nd&quot;&gt;@Override&lt;/span&gt; &lt;span class=&quot;kd&quot;&gt;public&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;Response&lt;/span&gt; &lt;span class=&quot;nf&quot;&gt;act&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;()&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;{&lt;/span&gt; &lt;span class=&quot;k&quot;&gt;return&lt;/span&gt; &lt;span class=&quot;k&quot;&gt;new&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;RsXSLT&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;(&lt;/span&gt; &lt;span class=&quot;k&quot;&gt;new&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;RsWithType&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;(&lt;/span&gt; &lt;span class=&quot;k&quot;&gt;new&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;RsText&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;(&lt;/span&gt; &lt;span class=&quot;s&quot;&gt;&amp;quot;&amp;lt;?xml-stylesheet type=&amp;#39;text/xsl&amp;#39; href=&amp;#39;/xsl/index.xsl&amp;#39;?&amp;gt;&amp;quot;&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;+&lt;/span&gt; &lt;span class=&quot;s&quot;&gt;&amp;quot;&amp;lt;page&amp;gt;&amp;lt;rate&amp;gt;1.1324&amp;lt;/rate&amp;gt;&amp;lt;/page&amp;gt;&amp;quot;&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;),&lt;/span&gt; &lt;span class=&quot;s&quot;&gt;&amp;quot;application/xml&amp;quot;&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;);&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;}&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/figure&gt; &lt;p&gt;Excuse me for using string concatenation, which is a &lt;a href=&quot;/2014/06/19/avoid-string-concatenation.html&quot;&gt;bad practice&lt;/a&gt;; it’s merely for the simplicity of the example.&lt;/p&gt; &lt;p&gt;As you see, I also added an XML stylesheet processing instruction to the XML. &lt;code&gt;RsXSLT&lt;/code&gt; will understand it and try to find the &lt;code&gt;/xsl/index.xsl&lt;/code&gt; resource on classpath. You see the content of that file above.&lt;/p&gt; &lt;p&gt;That’s it.&lt;/p&gt; &lt;p&gt;Well, not really. Building XML from strings is not a good idea. We have a better instrument in the Takes framework. We use &lt;a href=&quot;http://www.xembly.org&quot;&gt;Xembly&lt;/a&gt;, which is a simple imperative language for building and modifying XML documents. More about it here: &lt;a href=&quot;/2014/04/09/xembly-intro.html&quot;&gt;Xembly, an Assembly for XML&lt;/a&gt;.&lt;/p&gt; &lt;p&gt;Here is how our &lt;code&gt;TkApp&lt;/code&gt; would look:&lt;/p&gt; &lt;figure class=&quot;highlight&quot;&gt;&lt;pre&gt;&lt;code class=&quot;language-java&quot; data-lang=&quot;java&quot;&gt;&lt;span&gt;&lt;/span&gt;&lt;span class=&quot;nd&quot;&gt;@Override&lt;/span&gt; &lt;span class=&quot;kd&quot;&gt;public&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;Response&lt;/span&gt; &lt;span class=&quot;nf&quot;&gt;act&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;()&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;{&lt;/span&gt; &lt;span class=&quot;k&quot;&gt;return&lt;/span&gt; &lt;span class=&quot;k&quot;&gt;new&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;RsXSLT&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;(&lt;/span&gt; &lt;span class=&quot;k&quot;&gt;new&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;RsWithType&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;(&lt;/span&gt; &lt;span class=&quot;k&quot;&gt;new&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;RsXembly&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;(&lt;/span&gt; &lt;span class=&quot;k&quot;&gt;new&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;XeChain&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;(&lt;/span&gt; &lt;span class=&quot;k&quot;&gt;new&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;XeStylesheet&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;s&quot;&gt;&amp;quot;/xsl/index.xsl&amp;quot;&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;),&lt;/span&gt; &lt;span class=&quot;k&quot;&gt;new&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;XeAppend&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;(&lt;/span&gt; &lt;span class=&quot;s&quot;&gt;&amp;quot;page&amp;quot;&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;k&quot;&gt;new&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;XeDirectives&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;(&lt;/span&gt; &lt;span class=&quot;k&quot;&gt;new&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;Directives&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;().&lt;/span&gt;&lt;span class=&quot;na&quot;&gt;add&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;s&quot;&gt;&amp;quot;rate&amp;quot;&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;).&lt;/span&gt;&lt;span class=&quot;na&quot;&gt;set&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;s&quot;&gt;&amp;quot;1.1324&amp;quot;&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;),&lt;/span&gt; &lt;span class=&quot;s&quot;&gt;&amp;quot;application/xml&amp;quot;&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;);&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;}&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/figure&gt; &lt;p&gt;The most important class here is &lt;a href=&quot;http://static.javadoc.io/org.takes/takes/1.1/org/takes/rs/xe/RsXembly.html&quot;&gt;&lt;code&gt;RsXembly&lt;/code&gt;&lt;/a&gt;. The idea is to let model classes expose their data through Xembly “directives,” which will later be applied to a DOM structure by &lt;code&gt;RsXembly&lt;/code&gt;.&lt;/p&gt; &lt;p&gt;&lt;code&gt;XeChain&lt;/code&gt;, &lt;code&gt;XeStylesheet&lt;/code&gt;, &lt;code&gt;XeAppend&lt;/code&gt;, and &lt;code&gt;XeDirectives&lt;/code&gt; expose directives but with different meanings (they are all instances of an &lt;code&gt;XeSource&lt;/code&gt; interface). Their names describe their intentions rather well. &lt;a href=&quot;http://static.javadoc.io/org.takes/takes/1.1/org/takes/rs/xe/XeChain.html&quot;&gt;&lt;code&gt;XeChain&lt;/code&gt;&lt;/a&gt; just chains everything that is delivered by encapsulated “directive sources.” &lt;a href=&quot;http://static.javadoc.io/org.takes/takes/1.1/org/takes/rs/xe/XeStylesheet.html&quot;&gt;&lt;code&gt;XeStylesheet&lt;/code&gt;&lt;/a&gt; returns directives that create a single XML processing instruction. &lt;a href=&quot;http://static.javadoc.io/org.takes/takes/1.1/org/takes/rs/xe/XeAppend.html&quot;&gt;&lt;code&gt;XeAppend&lt;/code&gt;&lt;/a&gt; creates an XML node and adds encapsulated directives to it. &lt;a href=&quot;http://static.javadoc.io/org.takes/takes/1.1/org/takes/rs/xe/XeDirectives.html&quot;&gt;&lt;code&gt;XeDirectives&lt;/code&gt;&lt;/a&gt; simply returns what’s inside.&lt;/p&gt; &lt;p&gt;In the end, this code will create exactly the same XML document as I created above with string concatenation.&lt;/p&gt; &lt;p&gt;The beauty of this approach is in the perfect &lt;a href=&quot;/2018/09/18/fear-of-coupling.html&quot;&gt;decoupling&lt;/a&gt; of data generation and XML building and translation between XML and HTML. It is perfectly reusable and “stackable.” We can transform the data in XML format multiple times, applying different XSL stylesheets to each one. We can even transform them into &lt;a href=&quot;/2015/11/16/json-vs-xml.html&quot;&gt;JSON&lt;/a&gt; without changing a line of code in model classes.&lt;/p&gt; &lt;p&gt;Moreover, we can format them differently, using rather powerful XSLT 2.0 instruments. XSLT by itself is a powerful and purely functional language that enables any possible data manipulations. No templating engine is even close to it.&lt;/p&gt; &lt;p&gt;Take a look at how it works in the &lt;a href=&quot;https://github.com/yegor256/rultor/blob/1.55/src/main/java/com/rultor/web/RsPage.java&quot;&gt;&lt;code&gt;RsPage&lt;/code&gt;&lt;/a&gt; class in Rultor, for example.&lt;/p&gt; " /> <meta name="keywords" content="next, path, output, content, previous, url, relative_path, id, collection, excerpt, draft, categories, layout, title, date, tags, place, description, keywords, slug, ext" /> <meta name="viewport" content="width=device-width,minimum-scale=1,initial-scale=1"/> <meta name="google-site-verification" content="JEj_gQr2CPe2QKGw8XdMz0R7VboQIUbX3FlM-lwTq-8" /> <meta name="author" content="Yegor Bugayenko"> <meta name="article:published_time" content="2015-06-25 00:00:00 +0000"> <meta name="og:site_name" content="Yegor Bugayenko"/> <meta name="og:type" content="article" /> <meta name="og:locale" content="en_US" /> <meta name="twitter:account_id" content="4503599630178231" /> <meta name="twitter:creator" content="@yegor256"/> <meta name="twitter:site" content="@yegor256"/> <meta name="twitter:title" property="og:title" content="XML Data and XSL Views in Takes Framework"/> <meta name="twitter:description" property="og:description" content="&lt;figure class=&quot;badge&quot;&gt;&lt;a href=&quot;http://www.takes.org&quot;&gt;&lt;img src=&quot;http://www.takes.org/logo.png&quot; style=&quot;width:96px;max-width:100%;&quot; alt=&quot;badge&quot; /&gt;&lt;/a&gt;&lt;/figure&gt; &lt;p&gt;A year ago, I &lt;a href=&quot;/2014/06/25/xml-and-xslt-in-browser.html&quot;&gt;tried to explain&lt;/a&gt; how effectively data and its presentation can be separated in a web application with the help of XML and XSL. In a few words, instead of using &lt;a href=&quot;https://en.wikipedia.org/wiki/Comparison_of_web_template_engines&quot;&gt;templating&lt;/a&gt; (like JSP, Velocity, FreeMarker, etc.) and injection of data into HTML, we compose them in the form of an XML document and then let the XSL stylesheet transform them into HTML. Here is a brief example of how all this can be used together with the &lt;a href=&quot;http://www.takes.org&quot;&gt;Takes framework&lt;/a&gt;.&lt;/p&gt; &lt;!--more--&gt; &lt;p&gt;First, let’s agree that templating is a bad idea in the first place. Yes, I mean it. The entire design of JSP is wrong, with all due respect to its creators. Here is how it works: Let’s say my website has to fetch the current exchange rate of the euro from a database and show it on the home page. Here’s how my &lt;code&gt;index.jsp&lt;/code&gt; would look:&lt;/p&gt; &lt;figure class=&quot;highlight&quot;&gt;&lt;pre&gt;&lt;code class=&quot;language-jsp&quot; data-lang=&quot;jsp&quot;&gt;&lt;span&gt;&lt;/span&gt;&lt;span class=&quot;nt&quot;&gt;&amp;lt;html&amp;gt;&lt;/span&gt; &lt;span class=&quot;nt&quot;&gt;&amp;lt;body&amp;gt;&lt;/span&gt; &lt;span class=&quot;nt&quot;&gt;&amp;lt;p&amp;gt;&lt;/span&gt;EUR/USD: &lt;span class=&quot;k&quot;&gt;&amp;lt;%=&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;rates&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;na&quot;&gt;get&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;()&lt;/span&gt; &lt;span class=&quot;k&quot;&gt;%&amp;gt;&lt;/span&gt;&lt;span class=&quot;nt&quot;&gt;&amp;lt;/p&amp;gt;&lt;/span&gt; &lt;span class=&quot;nt&quot;&gt;&amp;lt;/body&amp;gt;&lt;/span&gt; &lt;span class=&quot;nt&quot;&gt;&amp;lt;/html&amp;gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/figure&gt; &lt;p&gt;In order to create HTML, the JSP engine will have to call &lt;code&gt;get()&lt;/code&gt; on object &lt;code&gt;rates&lt;/code&gt; and render what’s returned through &lt;code&gt;toString()&lt;/code&gt;. It’s a terrible design for a few reasons. First, the view is tightly coupled with the model. Second, the flexibility of rendering is very limited. Third, the result of rendering is not reusable, and views are not stackable. There are many other reasons … more about them in one of the next articles.&lt;/p&gt; &lt;aside class=&quot;youtube&quot;&gt; &lt;a href=&quot;https://www.youtube.com/watch?v=nheD2LNYrpk&quot;&gt;&lt;div class=&quot;box&quot;&gt; &lt;img src=&quot;https://i.ytimg.com/vi/nheD2LNYrpk/mqdefault.jpg&quot; alt=&quot;YouTube video #nheD2LNYrpk&quot; /&gt; &lt;div class=&quot;play&quot;&gt;&lt;i class=&quot;icon icon-play&quot;&gt;&lt;/i&gt;&lt;/div&gt; &lt;/div&gt;&lt;/a&gt; &lt;div&gt;Takes, Java Web Framework, Intro (webinar #12); 2 March 2016.&lt;/div&gt;&lt;/aside&gt; &lt;p&gt;Let’s see how this should be done right. First, we let our model generate the output in XML format, for example:&lt;/p&gt; &lt;figure class=&quot;highlight&quot;&gt;&lt;pre&gt;&lt;code class=&quot;language-xml&quot; data-lang=&quot;xml&quot;&gt;&lt;span&gt;&lt;/span&gt;&lt;span class=&quot;cp&quot;&gt;&amp;lt;?xml version=&amp;quot;1.1&amp;quot;?&amp;gt;&lt;/span&gt; &lt;span class=&quot;nt&quot;&gt;&amp;lt;page&amp;gt;&lt;/span&gt; &lt;span class=&quot;nt&quot;&gt;&amp;lt;rate&amp;gt;&lt;/span&gt;1.1324&lt;span class=&quot;nt&quot;&gt;&amp;lt;/rate&amp;gt;&lt;/span&gt; &lt;span class=&quot;nt&quot;&gt;&amp;lt;/page&amp;gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/figure&gt; &lt;p&gt;This is what the model will produce, having no knowledge of the view. Then, we create the view as an XSL stylesheet, which will transform XML into HTML:&lt;/p&gt; &lt;figure class=&quot;highlight&quot;&gt;&lt;pre&gt;&lt;code class=&quot;language-xml&quot; data-lang=&quot;xml&quot;&gt;&lt;span&gt;&lt;/span&gt;&lt;span class=&quot;nt&quot;&gt;&amp;lt;xsl:stylesheet&lt;/span&gt; &lt;span class=&quot;na&quot;&gt;version=&lt;/span&gt;&lt;span class=&quot;s&quot;&gt;&amp;quot;1.0&amp;quot;&lt;/span&gt; &lt;span class=&quot;na&quot;&gt;xmlns:xsl=&lt;/span&gt;&lt;span class=&quot;s&quot;&gt;&amp;quot;http://www.w3.org/1999/XSL/Transform&amp;quot;&lt;/span&gt; &lt;span class=&quot;na&quot;&gt;xmlns=&lt;/span&gt;&lt;span class=&quot;s&quot;&gt;&amp;quot;http://www.w3.org/1999/xhtml&amp;quot;&lt;/span&gt;&lt;span class=&quot;nt&quot;&gt;&amp;gt;&lt;/span&gt; &lt;span class=&quot;nt&quot;&gt;&amp;lt;xsl:template&lt;/span&gt; &lt;span class=&quot;na&quot;&gt;match=&lt;/span&gt;&lt;span class=&quot;s&quot;&gt;&amp;quot;page&amp;quot;&lt;/span&gt;&lt;span class=&quot;nt&quot;&gt;&amp;gt;&lt;/span&gt; &lt;span class=&quot;nt&quot;&gt;&amp;lt;html&amp;gt;&lt;/span&gt; &lt;span class=&quot;nt&quot;&gt;&amp;lt;body&amp;gt;&lt;/span&gt; &lt;span class=&quot;nt&quot;&gt;&amp;lt;p&amp;gt;&lt;/span&gt; &lt;span class=&quot;nt&quot;&gt;&amp;lt;xsl:text&amp;gt;&lt;/span&gt;EUR/USD: &lt;span class=&quot;nt&quot;&gt;&amp;lt;/xsl:text&amp;gt;&lt;/span&gt; &lt;span class=&quot;nt&quot;&gt;&amp;lt;xsl:value-of&lt;/span&gt; &lt;span class=&quot;na&quot;&gt;select=&lt;/span&gt;&lt;span class=&quot;s&quot;&gt;&amp;quot;rate&amp;quot;&lt;/span&gt;&lt;span class=&quot;nt&quot;&gt;/&amp;gt;&lt;/span&gt; &lt;span class=&quot;nt&quot;&gt;&amp;lt;/p&amp;gt;&lt;/span&gt; &lt;span class=&quot;nt&quot;&gt;&amp;lt;/body&amp;gt;&lt;/span&gt; &lt;span class=&quot;nt&quot;&gt;&amp;lt;/html&amp;gt;&lt;/span&gt; &lt;span class=&quot;nt&quot;&gt;&amp;lt;/xsl:template&amp;gt;&lt;/span&gt; &lt;span class=&quot;nt&quot;&gt;&amp;lt;/xsl:stylesheet&amp;gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/figure&gt; &lt;p&gt;As you see, the view doesn’t know anything about the model in terms of implementation. All it knows is the format of XML data output produced by the model. Here is how you design it in the &lt;a href=&quot;http://www.takes.org&quot;&gt;Takes framework&lt;/a&gt;. Let’s start with a simple example:&lt;/p&gt; &lt;figure class=&quot;highlight&quot;&gt;&lt;pre&gt;&lt;code class=&quot;language-java&quot; data-lang=&quot;java&quot;&gt;&lt;span&gt;&lt;/span&gt;&lt;span class=&quot;kn&quot;&gt;import&lt;/span&gt; &lt;span class=&quot;nn&quot;&gt;org.takes.http.Exit&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;;&lt;/span&gt; &lt;span class=&quot;kn&quot;&gt;import&lt;/span&gt; &lt;span class=&quot;nn&quot;&gt;org.takes.http.FtCli&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;;&lt;/span&gt; &lt;span class=&quot;kd&quot;&gt;public&lt;/span&gt; &lt;span class=&quot;kd&quot;&gt;final&lt;/span&gt; &lt;span class=&quot;kd&quot;&gt;class&lt;/span&gt; &lt;span class=&quot;nc&quot;&gt;Entry&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;{&lt;/span&gt; &lt;span class=&quot;kd&quot;&gt;public&lt;/span&gt; &lt;span class=&quot;kd&quot;&gt;static&lt;/span&gt; &lt;span class=&quot;kt&quot;&gt;void&lt;/span&gt; &lt;span class=&quot;nf&quot;&gt;main&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;kd&quot;&gt;final&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;String&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;...&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;args&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;kd&quot;&gt;throws&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;Exception&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;{&lt;/span&gt; &lt;span class=&quot;k&quot;&gt;new&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;FtCli&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;k&quot;&gt;new&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;TkApp&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;(),&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;args&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;).&lt;/span&gt;&lt;span class=&quot;na&quot;&gt;start&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;Exit&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;na&quot;&gt;NEVER&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;);&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;}&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;}&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/figure&gt; &lt;p&gt;It’s a simple web application that starts a web server and never ends (it waits for connections in daemon mode). To make it work, we should create a simple “take” named &lt;code&gt;TkApp&lt;/code&gt;:&lt;/p&gt; &lt;figure class=&quot;highlight&quot;&gt;&lt;pre&gt;&lt;code class=&quot;language-java&quot; data-lang=&quot;java&quot;&gt;&lt;span&gt;&lt;/span&gt;&lt;span class=&quot;kn&quot;&gt;import&lt;/span&gt; &lt;span class=&quot;nn&quot;&gt;org.takes.Take&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;;&lt;/span&gt; &lt;span class=&quot;kn&quot;&gt;import&lt;/span&gt; &lt;span class=&quot;nn&quot;&gt;org.takes.tk.TkWrap&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;;&lt;/span&gt; &lt;span class=&quot;kd&quot;&gt;final&lt;/span&gt; &lt;span class=&quot;kd&quot;&gt;class&lt;/span&gt; &lt;span class=&quot;nc&quot;&gt;TkApp&lt;/span&gt; &lt;span class=&quot;kd&quot;&gt;extends&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;TkWrap&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;{&lt;/span&gt; &lt;span class=&quot;nd&quot;&gt;@Override&lt;/span&gt; &lt;span class=&quot;kd&quot;&gt;public&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;Response&lt;/span&gt; &lt;span class=&quot;nf&quot;&gt;act&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;()&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;{&lt;/span&gt; &lt;span class=&quot;k&quot;&gt;return&lt;/span&gt; &lt;span class=&quot;k&quot;&gt;new&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;RsWithType&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;(&lt;/span&gt; &lt;span class=&quot;k&quot;&gt;new&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;RsText&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;(&lt;/span&gt; &lt;span class=&quot;s&quot;&gt;&amp;quot;&amp;lt;page&amp;gt;&amp;lt;rate&amp;gt;1.1324&amp;lt;/rate&amp;gt;&amp;lt;/page&amp;gt;&amp;quot;&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;),&lt;/span&gt; &lt;span class=&quot;s&quot;&gt;&amp;quot;application/xml&amp;quot;&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;);&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;}&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;}&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/figure&gt; &lt;p&gt;This “take” always returns the same XML response, but it doesn’t do any XSL transformation yet. We need to add the &lt;code&gt;RsXSLT&lt;/code&gt; class to the picture:&lt;/p&gt; &lt;figure class=&quot;highlight&quot;&gt;&lt;pre&gt;&lt;code class=&quot;language-java&quot; data-lang=&quot;java&quot;&gt;&lt;span&gt;&lt;/span&gt;&lt;span class=&quot;nd&quot;&gt;@Override&lt;/span&gt; &lt;span class=&quot;kd&quot;&gt;public&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;Response&lt;/span&gt; &lt;span class=&quot;nf&quot;&gt;act&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;()&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;{&lt;/span&gt; &lt;span class=&quot;k&quot;&gt;return&lt;/span&gt; &lt;span class=&quot;k&quot;&gt;new&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;RsXSLT&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;(&lt;/span&gt; &lt;span class=&quot;k&quot;&gt;new&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;RsWithType&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;(&lt;/span&gt; &lt;span class=&quot;k&quot;&gt;new&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;RsText&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;(&lt;/span&gt; &lt;span class=&quot;s&quot;&gt;&amp;quot;&amp;lt;?xml-stylesheet type=&amp;#39;text/xsl&amp;#39; href=&amp;#39;/xsl/index.xsl&amp;#39;?&amp;gt;&amp;quot;&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;+&lt;/span&gt; &lt;span class=&quot;s&quot;&gt;&amp;quot;&amp;lt;page&amp;gt;&amp;lt;rate&amp;gt;1.1324&amp;lt;/rate&amp;gt;&amp;lt;/page&amp;gt;&amp;quot;&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;),&lt;/span&gt; &lt;span class=&quot;s&quot;&gt;&amp;quot;application/xml&amp;quot;&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;);&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;}&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/figure&gt; &lt;p&gt;Excuse me for using string concatenation, which is a &lt;a href=&quot;/2014/06/19/avoid-string-concatenation.html&quot;&gt;bad practice&lt;/a&gt;; it’s merely for the simplicity of the example.&lt;/p&gt; &lt;p&gt;As you see, I also added an XML stylesheet processing instruction to the XML. &lt;code&gt;RsXSLT&lt;/code&gt; will understand it and try to find the &lt;code&gt;/xsl/index.xsl&lt;/code&gt; resource on classpath. You see the content of that file above.&lt;/p&gt; &lt;p&gt;That’s it.&lt;/p&gt; &lt;p&gt;Well, not really. Building XML from strings is not a good idea. We have a better instrument in the Takes framework. We use &lt;a href=&quot;http://www.xembly.org&quot;&gt;Xembly&lt;/a&gt;, which is a simple imperative language for building and modifying XML documents. More about it here: &lt;a href=&quot;/2014/04/09/xembly-intro.html&quot;&gt;Xembly, an Assembly for XML&lt;/a&gt;.&lt;/p&gt; &lt;p&gt;Here is how our &lt;code&gt;TkApp&lt;/code&gt; would look:&lt;/p&gt; &lt;figure class=&quot;highlight&quot;&gt;&lt;pre&gt;&lt;code class=&quot;language-java&quot; data-lang=&quot;java&quot;&gt;&lt;span&gt;&lt;/span&gt;&lt;span class=&quot;nd&quot;&gt;@Override&lt;/span&gt; &lt;span class=&quot;kd&quot;&gt;public&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;Response&lt;/span&gt; &lt;span class=&quot;nf&quot;&gt;act&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;()&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;{&lt;/span&gt; &lt;span class=&quot;k&quot;&gt;return&lt;/span&gt; &lt;span class=&quot;k&quot;&gt;new&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;RsXSLT&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;(&lt;/span&gt; &lt;span class=&quot;k&quot;&gt;new&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;RsWithType&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;(&lt;/span&gt; &lt;span class=&quot;k&quot;&gt;new&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;RsXembly&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;(&lt;/span&gt; &lt;span class=&quot;k&quot;&gt;new&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;XeChain&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;(&lt;/span&gt; &lt;span class=&quot;k&quot;&gt;new&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;XeStylesheet&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;s&quot;&gt;&amp;quot;/xsl/index.xsl&amp;quot;&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;),&lt;/span&gt; &lt;span class=&quot;k&quot;&gt;new&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;XeAppend&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;(&lt;/span&gt; &lt;span class=&quot;s&quot;&gt;&amp;quot;page&amp;quot;&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;k&quot;&gt;new&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;XeDirectives&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;(&lt;/span&gt; &lt;span class=&quot;k&quot;&gt;new&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;Directives&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;().&lt;/span&gt;&lt;span class=&quot;na&quot;&gt;add&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;s&quot;&gt;&amp;quot;rate&amp;quot;&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;).&lt;/span&gt;&lt;span class=&quot;na&quot;&gt;set&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;s&quot;&gt;&amp;quot;1.1324&amp;quot;&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;),&lt;/span&gt; &lt;span class=&quot;s&quot;&gt;&amp;quot;application/xml&amp;quot;&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;);&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;}&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/figure&gt; &lt;p&gt;The most important class here is &lt;a href=&quot;http://static.javadoc.io/org.takes/takes/1.1/org/takes/rs/xe/RsXembly.html&quot;&gt;&lt;code&gt;RsXembly&lt;/code&gt;&lt;/a&gt;. The idea is to let model classes expose their data through Xembly “directives,” which will later be applied to a DOM structure by &lt;code&gt;RsXembly&lt;/code&gt;.&lt;/p&gt; &lt;p&gt;&lt;code&gt;XeChain&lt;/code&gt;, &lt;code&gt;XeStylesheet&lt;/code&gt;, &lt;code&gt;XeAppend&lt;/code&gt;, and &lt;code&gt;XeDirectives&lt;/code&gt; expose directives but with different meanings (they are all instances of an &lt;code&gt;XeSource&lt;/code&gt; interface). Their names describe their intentions rather well. &lt;a href=&quot;http://static.javadoc.io/org.takes/takes/1.1/org/takes/rs/xe/XeChain.html&quot;&gt;&lt;code&gt;XeChain&lt;/code&gt;&lt;/a&gt; just chains everything that is delivered by encapsulated “directive sources.” &lt;a href=&quot;http://static.javadoc.io/org.takes/takes/1.1/org/takes/rs/xe/XeStylesheet.html&quot;&gt;&lt;code&gt;XeStylesheet&lt;/code&gt;&lt;/a&gt; returns directives that create a single XML processing instruction. &lt;a href=&quot;http://static.javadoc.io/org.takes/takes/1.1/org/takes/rs/xe/XeAppend.html&quot;&gt;&lt;code&gt;XeAppend&lt;/code&gt;&lt;/a&gt; creates an XML node and adds encapsulated directives to it. &lt;a href=&quot;http://static.javadoc.io/org.takes/takes/1.1/org/takes/rs/xe/XeDirectives.html&quot;&gt;&lt;code&gt;XeDirectives&lt;/code&gt;&lt;/a&gt; simply returns what’s inside.&lt;/p&gt; &lt;p&gt;In the end, this code will create exactly the same XML document as I created above with string concatenation.&lt;/p&gt; &lt;p&gt;The beauty of this approach is in the perfect &lt;a href=&quot;/2018/09/18/fear-of-coupling.html&quot;&gt;decoupling&lt;/a&gt; of data generation and XML building and translation between XML and HTML. It is perfectly reusable and “stackable.” We can transform the data in XML format multiple times, applying different XSL stylesheets to each one. We can even transform them into &lt;a href=&quot;/2015/11/16/json-vs-xml.html&quot;&gt;JSON&lt;/a&gt; without changing a line of code in model classes.&lt;/p&gt; &lt;p&gt;Moreover, we can format them differently, using rather powerful XSLT 2.0 instruments. XSLT by itself is a powerful and purely functional language that enables any possible data manipulations. No templating engine is even close to it.&lt;/p&gt; &lt;p&gt;Take a look at how it works in the &lt;a href=&quot;https://github.com/yegor256/rultor/blob/1.55/src/main/java/com/rultor/web/RsPage.java&quot;&gt;&lt;code&gt;RsPage&lt;/code&gt;&lt;/a&gt; class in Rultor, for example.&lt;/p&gt; "/> <meta name="twitter:url" property="og:url" content="https://www.yegor256.com/2015/06/25/xml-data-xsl-views-takes-framework.html"/> <meta name="telegram:channel" content="AAAAAEJFMRzsRTRxM3ec6A"/> <link rel="search" type="application/opensearchdescription+xml" href="/opensearch.xml" title="yegor256" /> <link rel="shortcut icon" href="/favicon.ico?8c0c9d2d5e8"/> <link rel="apple-touch-icon" href="/favicon.ico?8c0c9d2d5e8"/> <link rel="alternate" type="application/rss+xml" title="RSS for yegor256.com" href="https://www.yegor256.com/rss.xml"/> <link rel="stylesheet" href="/css/layout.css?8c0c9d2d5e8"/> <link rel="stylesheet" href="/css/icons.css?8c0c9d2d5e8"/> <link rel="canonical" href="https://www.yegor256.com/2015/06/25/xml-data-xsl-views-takes-framework.html" /> <link rel="amphtml" href="https://www.yegor256.com/2015/06/25/xml-data-xsl-views-takes-framework.amp.html" /> <title>XML Data and XSL Views in Takes Framework </title> </head> <body><div class="wrapper"> <aside class="header-toggle unprintable" id="header-toggle" title="Show the menu" onclick="$('#header').show();$('#header-toggle').hide();">&#9776;</aside> <header class="header" id="header"><div class="face"> <a href="/about-me.html#form" class="sub" title="Click to subscribe to my monthly newsletter"><span>Subscribe</span></a> <a href="/about-me.html" style="position:relative;"> <img src="/images/face-256x256.jpg" class="photo" alt="Yegor Bugayenko"/> </a></div><nav><ul class="menu social notranslate"> <li><a href="https://twitter.com/intent/follow?screen_name=yegor256" rel="nofollow" title="Follow me on Twitter"><i class="icon icon-twitter notranslate" aria-hidden="true"></i></a></li> <li><a href="/rss.xml" rel="nofollow" title="Subscribe to my RSS feed"><i class="icon icon-rss notranslate" aria-hidden="true"></i></a></li> <li><a itemprop="sameAs" href="https://github.com/yegor256" rel="nofollow" title="My GitHub profile"><i class="icon icon-github notranslate" aria-hidden="true"></i></a></li> <li><a itemprop="sameAs" href="http://stackoverflow.com/users/187141/yegor256" rel="nofollow" title="My StackOverflow profile"><i class="icon icon-stackoverflow notranslate" aria-hidden="true"></i></a></li> <li><a itemprop="sameAs" href="https://www.facebook.com/yegor256" rel="nofollow" title="Follow me on Facebook"><i class="icon icon-facebook notranslate" aria-hidden="true"></i></a></li> <li><a itemprop="sameAs" href="https://instagram.com/yegor256" rel="nofollow" title="Follow me on Instagram"><i class="icon icon-instagram notranslate" aria-hidden="true"></i></a></li> <li><a itemprop="sameAs" href="https://www.linkedin.com/in/yegor256" rel="nofollow" title="My LinkedIn profile"><i class="icon icon-linkedin notranslate" aria-hidden="true"></i></a></li> <li><a itemprop="sameAs" href="https://www.youtube.com/c/yegor256?sub_confirmation=1" rel="nofollow" title="My Youtube video channel"><i class="icon icon-youtube notranslate" aria-hidden="true"></i></a></li> <li><a itemprop="sameAs" href="https://www.pinterest.com/yegor256/" rel="nofollow" title="My Pinterest boards"><i class="icon icon-pinterest notranslate" aria-hidden="true"></i></a></li> <li><a itemprop="sameAs" href="https://angel.co/yegor256" rel="nofollow" title="My AngelList profile"><i class="icon icon-angellist notranslate" aria-hidden="true"></i></a></li> <li><a href="https://soundcloud.com/yegor256" rel="nofollow" title="My podcast"><i class="icon icon-podcast notranslate" aria-hidden="true"></i></a></li> <li><a href="https://itunes.apple.com/us/podcast/yegor256-podcast/id1150826721" rel="nofollow" title="My iTunes podcast"><i class="icon icon-itunes notranslate" aria-hidden="true"></i></a></li> <li><a href="https://t.me/yegor256news" rel="nofollow" title="My Telegram public channel"><i class="icon icon-telegram notranslate" aria-hidden="true"></i></a></li> <li><a href="mailto:blog@yegor256.com" rel="nofollow" title="Email me any time"><i class="icon icon-mail notranslate" aria-hidden="true"></i></a></li></ul><ul class="menu"> <li><a href="/" title="Home page">Home</a></li> <li /2015/06/25/xml-data-xsl-views-takes-framework.html><a href="/best.html" title="Best articles to read">12&#160;Best</a></li> <li /2015/06/25/xml-data-xsl-views-takes-framework.html><a href="/contents.html" title="The contents of the entire blog">All&#160;292</a></li> <li /2015/06/25/xml-data-xsl-views-takes-framework.html><a href="/webinars.html" title="My webinars">Webinars</a></li> <li /2015/06/25/xml-data-xsl-views-takes-framework.html><a href="/talks.html" title="Future and past conference talks">Talks</a></li> <li /2015/06/25/xml-data-xsl-views-takes-framework.html><a href="/books.html" title="The books I wrote">Books</a></li> <li /2015/06/25/xml-data-xsl-views-takes-framework.html><a href="/papers.html" title="My academic papers and patents">Papers</a></li> <li /2015/06/25/xml-data-xsl-views-takes-framework.html><a href="/pets.html" title="My loved pet projects">Pets</a></li> <li /2015/06/25/xml-data-xsl-views-takes-framework.html class="highlighted"><a href="/trainings.html" title="On-site trainings">Trainings</a></li> <li /2015/06/25/xml-data-xsl-views-takes-framework.html><a href="/award.html" title="Software quality award">Award</a></li> <li /2015/06/25/xml-data-xsl-views-takes-framework.html><a href="/testimonials.html" title="What some people say about me">Testimonials</a></li> <li /2015/06/25/xml-data-xsl-views-takes-framework.html><a href="/shift-m.html" title="Audio podcast about project management">Shift-M</a></li> <li /2015/06/25/xml-data-xsl-views-takes-framework.html><a href="/paintings.html" title="My paintings for sale">Paintings</a></li> <li><a href="https://ru.yegor256.com/" title="Немного на русском языке">По-русски</a></li></ul></nav><div class="search"> <form method="get" action="https://www.google.com/search" itemprop="potentialAction" itemscope="" itemtype="http://schema.org/SearchAction"> <meta itemprop="target" content="https://www.google.com/search?q={q}"/> <input name="sitesearch" value="yegor256.com" type="hidden"/> <input itemprop="query-input" type="text" id="search-query" class="field field-text" required="required" onfocus="$('.google').css('visibility', 'visible');" name="q" placeholder="Search..." autocomplete="off"/> <input type="image" src="/images/google-search-icon.svg" class="google" title="Search via Google" alt="Search via Google"/> </form></div><div class="hot"><ul></ul></div></header></div><section itemscope="" itemtype="http://schema.org/BlogPosting"><div class="wrapper"> <header><p class="printable"> <img src="https://api.qrserver.com/v1/create-qr-code/?data=https://www.yegor256.com/2015/06/25/xml-data-xsl-views-takes-framework.html&amp;format=svg" style="width:125px;height:125px;" alt="QR code"/></p><p class="printable"> <code itemprop="url">https://www.yegor256.com/2015/06/25/xml-data-xsl-views-takes-framework.html</code></p><h1 itemprop="name headline mainEntityOfPage">XML Data and XSL Views in Takes Framework</h1><ul class="subline"> <li> <time itemprop="datePublished" datetime="2015-06-25T00:00:00+00:00"> 25 June 2015 </time> </li> <li class="desktop-only" itemprop="locationCreated">Palo Alto, CA</li> <li class="printable" itemscope="" itemprop="author" itemtype="http://schema.org/Person"> <span itemprop="name">Yegor Bugayenko</span> </li> <li class="unprintable"> <i class="icon icon-comments"></i> <a href="https://www.yegor256.com/2015/06/25/xml-data-xsl-views-takes-framework.html#disqus_thread" itemprop="discussionUrl">comments</a> </li></ul><p class="unprintable"><figure class="badge"><a href="http://www.takes.org"><img src="http://www.takes.org/logo.png" style="width:96px;max-width:100%;" alt="badge" /></a></figure><p>A year ago, I <a href="/2014/06/25/xml-and-xslt-in-browser.html">tried to explain</a> how effectively data and its presentation can be separated in a web application with the help of XML and XSL. In a few words, instead of using <a href="https://en.wikipedia.org/wiki/Comparison_of_web_template_engines">templating</a> (like JSP, Velocity, FreeMarker, etc.) and injection of data into HTML, we compose them in the form of an XML document and then let the XSL stylesheet transform them into HTML. Here is a brief example of how all this can be used together with the <a href="http://www.takes.org">Takes framework</a>.</p><p>First, let’s agree that templating is a bad idea in the first place. Yes, I mean it. The entire design of JSP is wrong, with all due respect to its creators. Here is how it works: Let’s say my website has to fetch the current exchange rate of the euro from a database and show it on the home page. Here’s how my <code>index.jsp</code> would look:</p><figure class="highlight"><pre><code class="language-jsp" data-lang="jsp"><span></span><span class="nt">&lt;html&gt;</span>
  <span class="nt">&lt;body&gt;</span>
    <span class="nt">&lt;p&gt;</span>EUR/USD: <span class="k">&lt;%=</span> <span class="n">rates</span><span class="o">.</span><span class="na">get</span><span class="o">()</span> <span class="k">%&gt;</span><span class="nt">&lt;/p&gt;</span>
  <span class="nt">&lt;/body&gt;</span>
<span class="nt">&lt;/html&gt;</span></code></pre></figure><p>In order to create HTML, the JSP engine will have to call <code>get()</code> on object <code>rates</code> and render what’s returned through <code>toString()</code>. It’s a terrible design for a few reasons. First, the view is tightly coupled with the model. Second, the flexibility of rendering is very limited. Third, the result of rendering is not reusable, and views are not stackable. There are many other reasons … more about them in one of the next articles.</p><aside class="youtube"> <a href="https://www.youtube.com/watch?v=nheD2LNYrpk"><div class="box"> <img src="https://i.ytimg.com/vi/nheD2LNYrpk/mqdefault.jpg" alt="YouTube video #nheD2LNYrpk" /><div class="play"><i class="icon icon-play"></i></div></div></a><div>Takes, Java Web Framework, Intro (webinar #12); 2 March 2016.</div></aside><p>Let’s see how this should be done right. First, we let our model generate the output in XML format, for example:</p><figure class="highlight"><pre><code class="language-xml" data-lang="xml"><span></span><span class="cp">&lt;?xml version=&quot;1.1&quot;?&gt;</span>
<span class="nt">&lt;page&gt;</span>
  <span class="nt">&lt;rate&gt;</span>1.1324<span class="nt">&lt;/rate&gt;</span>
<span class="nt">&lt;/page&gt;</span></code></pre></figure><p>This is what the model will produce, having no knowledge of the view. Then, we create the view as an XSL stylesheet, which will transform XML into HTML:</p><figure class="highlight"><pre><code class="language-xml" data-lang="xml"><span></span><span class="nt">&lt;xsl:stylesheet</span> <span class="na">version=</span><span class="s">&quot;1.0&quot;</span>
  <span class="na">xmlns:xsl=</span><span class="s">&quot;http://www.w3.org/1999/XSL/Transform&quot;</span>
  <span class="na">xmlns=</span><span class="s">&quot;http://www.w3.org/1999/xhtml&quot;</span><span class="nt">&gt;</span>
  <span class="nt">&lt;xsl:template</span> <span class="na">match=</span><span class="s">&quot;page&quot;</span><span class="nt">&gt;</span>
    <span class="nt">&lt;html&gt;</span>
      <span class="nt">&lt;body&gt;</span>
        <span class="nt">&lt;p&gt;</span>
          <span class="nt">&lt;xsl:text&gt;</span>EUR/USD: <span class="nt">&lt;/xsl:text&gt;</span>
          <span class="nt">&lt;xsl:value-of</span> <span class="na">select=</span><span class="s">&quot;rate&quot;</span><span class="nt">/&gt;</span>
        <span class="nt">&lt;/p&gt;</span>
      <span class="nt">&lt;/body&gt;</span>
    <span class="nt">&lt;/html&gt;</span>
  <span class="nt">&lt;/xsl:template&gt;</span>
<span class="nt">&lt;/xsl:stylesheet&gt;</span></code></pre></figure><p>As you see, the view doesn’t know anything about the model in terms of implementation. All it knows is the format of XML data output produced by the model. Here is how you design it in the <a href="http://www.takes.org">Takes framework</a>. Let’s start with a simple example:</p><figure class="highlight"><pre><code class="language-java" data-lang="java"><span></span><span class="kn">import</span> <span class="nn">org.takes.http.Exit</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">org.takes.http.FtCli</span><span class="o">;</span>
<span class="kd">public</span> <span class="kd">final</span> <span class="kd">class</span> <span class="nc">Entry</span> <span class="o">{</span>
  <span class="kd">public</span> <span class="kd">static</span> <span class="kt">void</span> <span class="nf">main</span><span class="o">(</span><span class="kd">final</span> <span class="n">String</span><span class="o">...</span> <span class="n">args</span><span class="o">)</span> <span class="kd">throws</span> <span class="n">Exception</span> <span class="o">{</span>
    <span class="k">new</span> <span class="n">FtCli</span><span class="o">(</span><span class="k">new</span> <span class="n">TkApp</span><span class="o">(),</span> <span class="n">args</span><span class="o">).</span><span class="na">start</span><span class="o">(</span><span class="n">Exit</span><span class="o">.</span><span class="na">NEVER</span><span class="o">);</span>
  <span class="o">}</span>
<span class="o">}</span></code></pre></figure><p>It’s a simple web application that starts a web server and never ends (it waits for connections in daemon mode). To make it work, we should create a simple “take” named <code>TkApp</code>:</p><figure class="highlight"><pre><code class="language-java" data-lang="java"><span></span><span class="kn">import</span> <span class="nn">org.takes.Take</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">org.takes.tk.TkWrap</span><span class="o">;</span>
<span class="kd">final</span> <span class="kd">class</span> <span class="nc">TkApp</span> <span class="kd">extends</span> <span class="n">TkWrap</span> <span class="o">{</span>
  <span class="nd">@Override</span>
  <span class="kd">public</span> <span class="n">Response</span> <span class="nf">act</span><span class="o">()</span> <span class="o">{</span>
    <span class="k">return</span> <span class="k">new</span> <span class="n">RsWithType</span><span class="o">(</span>
      <span class="k">new</span> <span class="n">RsText</span><span class="o">(</span>
        <span class="s">&quot;&lt;page&gt;&lt;rate&gt;1.1324&lt;/rate&gt;&lt;/page&gt;&quot;</span>
      <span class="o">),</span>
      <span class="s">&quot;application/xml&quot;</span>
    <span class="o">);</span>
  <span class="o">}</span>
<span class="o">}</span></code></pre></figure><p>This “take” always returns the same XML response, but it doesn’t do any XSL transformation yet. We need to add the <code>RsXSLT</code> class to the picture:</p><figure class="highlight"><pre><code class="language-java" data-lang="java"><span></span><span class="nd">@Override</span>
<span class="kd">public</span> <span class="n">Response</span> <span class="nf">act</span><span class="o">()</span> <span class="o">{</span>
  <span class="k">return</span> <span class="k">new</span> <span class="n">RsXSLT</span><span class="o">(</span>
    <span class="k">new</span> <span class="n">RsWithType</span><span class="o">(</span>
      <span class="k">new</span> <span class="n">RsText</span><span class="o">(</span>
        <span class="s">&quot;&lt;?xml-stylesheet type=&#39;text/xsl&#39; href=&#39;/xsl/index.xsl&#39;?&gt;&quot;</span>
        <span class="o">+</span> <span class="s">&quot;&lt;page&gt;&lt;rate&gt;1.1324&lt;/rate&gt;&lt;/page&gt;&quot;</span>
      <span class="o">),</span>
      <span class="s">&quot;application/xml&quot;</span>
    <span class="o">)</span>
  <span class="o">);</span>
<span class="o">}</span></code></pre></figure><p>Excuse me for using string concatenation, which is a <a href="/2014/06/19/avoid-string-concatenation.html">bad practice</a>; it’s merely for the simplicity of the example.</p><p>As you see, I also added an XML stylesheet processing instruction to the XML. <code>RsXSLT</code> will understand it and try to find the <code>/xsl/index.xsl</code> resource on classpath. You see the content of that file above.</p><p>That’s it.</p><p>Well, not really. Building XML from strings is not a good idea. We have a better instrument in the Takes framework. We use <a href="http://www.xembly.org">Xembly</a>, which is a simple imperative language for building and modifying XML documents. More about it here: <a href="/2014/04/09/xembly-intro.html">Xembly, an Assembly for XML</a>.</p><p>Here is how our <code>TkApp</code> would look:</p><figure class="highlight"><pre><code class="language-java" data-lang="java"><span></span><span class="nd">@Override</span>
<span class="kd">public</span> <span class="n">Response</span> <span class="nf">act</span><span class="o">()</span> <span class="o">{</span>
  <span class="k">return</span> <span class="k">new</span> <span class="n">RsXSLT</span><span class="o">(</span>
    <span class="k">new</span> <span class="n">RsWithType</span><span class="o">(</span>
      <span class="k">new</span> <span class="n">RsXembly</span><span class="o">(</span>
        <span class="k">new</span> <span class="n">XeChain</span><span class="o">(</span>
          <span class="k">new</span> <span class="n">XeStylesheet</span><span class="o">(</span><span class="s">&quot;/xsl/index.xsl&quot;</span><span class="o">),</span>
          <span class="k">new</span> <span class="n">XeAppend</span><span class="o">(</span>
            <span class="s">&quot;page&quot;</span><span class="o">,</span>
            <span class="k">new</span> <span class="n">XeDirectives</span><span class="o">(</span>
              <span class="k">new</span> <span class="n">Directives</span><span class="o">().</span><span class="na">add</span><span class="o">(</span><span class="s">&quot;rate&quot;</span><span class="o">).</span><span class="na">set</span><span class="o">(</span><span class="s">&quot;1.1324&quot;</span><span class="o">)</span>
            <span class="o">)</span>
          <span class="o">)</span>
        <span class="o">)</span>
      <span class="o">),</span>
      <span class="s">&quot;application/xml&quot;</span>
    <span class="o">)</span>
  <span class="o">);</span>
<span class="o">}</span></code></pre></figure><p>The most important class here is <a href="http://static.javadoc.io/org.takes/takes/1.1/org/takes/rs/xe/RsXembly.html"><code>RsXembly</code></a>. The idea is to let model classes expose their data through Xembly “directives,” which will later be applied to a DOM structure by <code>RsXembly</code>.</p><p><code>XeChain</code>, <code>XeStylesheet</code>, <code>XeAppend</code>, and <code>XeDirectives</code> expose directives but with different meanings (they are all instances of an <code>XeSource</code> interface). Their names describe their intentions rather well. <a href="http://static.javadoc.io/org.takes/takes/1.1/org/takes/rs/xe/XeChain.html"><code>XeChain</code></a> just chains everything that is delivered by encapsulated “directive sources.” <a href="http://static.javadoc.io/org.takes/takes/1.1/org/takes/rs/xe/XeStylesheet.html"><code>XeStylesheet</code></a> returns directives that create a single XML processing instruction. <a href="http://static.javadoc.io/org.takes/takes/1.1/org/takes/rs/xe/XeAppend.html"><code>XeAppend</code></a> creates an XML node and adds encapsulated directives to it. <a href="http://static.javadoc.io/org.takes/takes/1.1/org/takes/rs/xe/XeDirectives.html"><code>XeDirectives</code></a> simply returns what’s inside.</p><p>In the end, this code will create exactly the same XML document as I created above with string concatenation.</p><p>The beauty of this approach is in the perfect <a href="/2018/09/18/fear-of-coupling.html">decoupling</a> of data generation and XML building and translation between XML and HTML. It is perfectly reusable and “stackable.” We can transform the data in XML format multiple times, applying different XSL stylesheets to each one. We can even transform them into <a href="/2015/11/16/json-vs-xml.html">JSON</a> without changing a line of code in model classes.</p><p>Moreover, we can format them differently, using rather powerful XSLT 2.0 instruments. XSLT by itself is a powerful and purely functional language that enables any possible data manipulations. No templating engine is even close to it.</p><p>Take a look at how it works in the <a href="https://github.com/yegor256/rultor/blob/1.55/src/main/java/com/rultor/web/RsPage.java"><code>RsPage</code></a> class in Rultor, for example.</p></p><nav class="buttons notranslate desktop-only"> <a href="http://www.facebook.com/sharer/sharer.php?u=https://www.yegor256.com/2015/06/25/xml-data-xsl-views-takes-framework.html" title="Share on Facebook" class="button" rel="nofollow"> <span class="count count-facebook">0</span> <i class="icon icon-facebook notranslate" aria-hidden="true"></i> </a> <a href="https://twitter.com/share?url=https://www.yegor256.com/2015/06/25/xml-data-xsl-views-takes-framework.html&amp;text=XML+Data+and+XSL+Views+in+Takes+Framework" title="Share on Twitter" class="button" rel="nofollow"> <span class="count count-twitter">0</span> <i class="icon icon-twitter notranslate" aria-hidden="true"></i> </a> <a href="https://plus.google.com/share?url=https://www.yegor256.com/2015/06/25/xml-data-xsl-views-takes-framework.html" title="Share on Google+" class="button" rel="nofollow"> <span class="count count-googleplus">0</span> <i class="icon icon-googleplus notranslate" aria-hidden="true"></i> </a> <a href="https://www.linkedin.com/cws/share?url=https://www.yegor256.com/2015/06/25/xml-data-xsl-views-takes-framework.html" title="Share on LinkedIn" class="button" rel="nofollow"> <span class="count count-linkedin">0</span> <i class="icon icon-linkedin notranslate" aria-hidden="true"></i> </a> <a href="http://reddit.com/submit?url=https://www.yegor256.com/2015/06/25/xml-data-xsl-views-takes-framework.html%3F2015-25&amp;title=XML+Data+and+XSL+Views+in+Takes+Framework" title="Share on Reddit" class="button" rel="nofollow"> <span class="count count-reddit">0</span> <i class="icon icon-reddit notranslate" aria-hidden="true"></i> </a> <a href="http://news.ycombinator.com/submitlink?u=https://www.yegor256.com/2015/06/25/xml-data-xsl-views-takes-framework.html%3F2015-25&amp;t=XML+Data+and+XSL+Views+in+Takes+Framework" title="Share on Hacker News" class="button" rel="nofollow"> <span class="count count-hackernews">0</span> <i class="icon icon-hackernews notranslate" aria-hidden="true"></i> </a> </nav> </header> <article class="main" itemprop="articleBody"><div > <figure class="badge"><a href="http://www.takes.org"><img src="http://www.takes.org/logo.png" style="width:96px;max-width:100%;" alt="badge" /></a></figure><p>A year ago, I <a href="/2014/06/25/xml-and-xslt-in-browser.html">tried to explain</a> how effectively data and its presentation can be separated in a web application with the help of XML and XSL. In a few words, instead of using <a href="https://en.wikipedia.org/wiki/Comparison_of_web_template_engines">templating</a> (like JSP, Velocity, FreeMarker, etc.) and injection of data into HTML, we compose them in the form of an XML document and then let the XSL stylesheet transform them into HTML. Here is a brief example of how all this can be used together with the <a href="http://www.takes.org">Takes framework</a>.</p><p>First, let’s agree that templating is a bad idea in the first place. Yes, I mean it. The entire design of JSP is wrong, with all due respect to its creators. Here is how it works: Let’s say my website has to fetch the current exchange rate of the euro from a database and show it on the home page. Here’s how my <code>index.jsp</code> would look:</p><figure class="highlight"><pre><code class="language-jsp" data-lang="jsp"><span></span><span class="nt">&lt;html&gt;</span>
  <span class="nt">&lt;body&gt;</span>
    <span class="nt">&lt;p&gt;</span>EUR/USD: <span class="k">&lt;%=</span> <span class="n">rates</span><span class="o">.</span><span class="na">get</span><span class="o">()</span> <span class="k">%&gt;</span><span class="nt">&lt;/p&gt;</span>
  <span class="nt">&lt;/body&gt;</span>
<span class="nt">&lt;/html&gt;</span></code></pre></figure><p>In order to create HTML, the JSP engine will have to call <code>get()</code> on object <code>rates</code> and render what’s returned through <code>toString()</code>. It’s a terrible design for a few reasons. First, the view is tightly coupled with the model. Second, the flexibility of rendering is very limited. Third, the result of rendering is not reusable, and views are not stackable. There are many other reasons … more about them in one of the next articles.</p><aside class="youtube"> <a href="https://www.youtube.com/watch?v=nheD2LNYrpk"><div class="box"> <img src="https://i.ytimg.com/vi/nheD2LNYrpk/mqdefault.jpg" alt="YouTube video #nheD2LNYrpk" /><div class="play"><i class="icon icon-play"></i></div></div></a><div>Takes, Java Web Framework, Intro (webinar #12); 2 March 2016.</div></aside><p>Let’s see how this should be done right. First, we let our model generate the output in XML format, for example:</p><figure class="highlight"><pre><code class="language-xml" data-lang="xml"><span></span><span class="cp">&lt;?xml version=&quot;1.1&quot;?&gt;</span>
<span class="nt">&lt;page&gt;</span>
  <span class="nt">&lt;rate&gt;</span>1.1324<span class="nt">&lt;/rate&gt;</span>
<span class="nt">&lt;/page&gt;</span></code></pre></figure><p>This is what the model will produce, having no knowledge of the view. Then, we create the view as an XSL stylesheet, which will transform XML into HTML:</p><figure class="highlight"><pre><code class="language-xml" data-lang="xml"><span></span><span class="nt">&lt;xsl:stylesheet</span> <span class="na">version=</span><span class="s">&quot;1.0&quot;</span>
  <span class="na">xmlns:xsl=</span><span class="s">&quot;http://www.w3.org/1999/XSL/Transform&quot;</span>
  <span class="na">xmlns=</span><span class="s">&quot;http://www.w3.org/1999/xhtml&quot;</span><span class="nt">&gt;</span>
  <span class="nt">&lt;xsl:template</span> <span class="na">match=</span><span class="s">&quot;page&quot;</span><span class="nt">&gt;</span>
    <span class="nt">&lt;html&gt;</span>
      <span class="nt">&lt;body&gt;</span>
        <span class="nt">&lt;p&gt;</span>
          <span class="nt">&lt;xsl:text&gt;</span>EUR/USD: <span class="nt">&lt;/xsl:text&gt;</span>
          <span class="nt">&lt;xsl:value-of</span> <span class="na">select=</span><span class="s">&quot;rate&quot;</span><span class="nt">/&gt;</span>
        <span class="nt">&lt;/p&gt;</span>
      <span class="nt">&lt;/body&gt;</span>
    <span class="nt">&lt;/html&gt;</span>
  <span class="nt">&lt;/xsl:template&gt;</span>
<span class="nt">&lt;/xsl:stylesheet&gt;</span></code></pre></figure><p>As you see, the view doesn’t know anything about the model in terms of implementation. All it knows is the format of XML data output produced by the model. Here is how you design it in the <a href="http://www.takes.org">Takes framework</a>. Let’s start with a simple example:</p><figure class="highlight"><pre><code class="language-java" data-lang="java"><span></span><span class="kn">import</span> <span class="nn">org.takes.http.Exit</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">org.takes.http.FtCli</span><span class="o">;</span>
<span class="kd">public</span> <span class="kd">final</span> <span class="kd">class</span> <span class="nc">Entry</span> <span class="o">{</span>
  <span class="kd">public</span> <span class="kd">static</span> <span class="kt">void</span> <span class="nf">main</span><span class="o">(</span><span class="kd">final</span> <span class="n">String</span><span class="o">...</span> <span class="n">args</span><span class="o">)</span> <span class="kd">throws</span> <span class="n">Exception</span> <span class="o">{</span>
    <span class="k">new</span> <span class="n">FtCli</span><span class="o">(</span><span class="k">new</span> <span class="n">TkApp</span><span class="o">(),</span> <span class="n">args</span><span class="o">).</span><span class="na">start</span><span class="o">(</span><span class="n">Exit</span><span class="o">.</span><span class="na">NEVER</span><span class="o">);</span>
  <span class="o">}</span>
<span class="o">}</span></code></pre></figure><p>It’s a simple web application that starts a web server and never ends (it waits for connections in daemon mode). To make it work, we should create a simple “take” named <code>TkApp</code>:</p><figure class="highlight"><pre><code class="language-java" data-lang="java"><span></span><span class="kn">import</span> <span class="nn">org.takes.Take</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">org.takes.tk.TkWrap</span><span class="o">;</span>
<span class="kd">final</span> <span class="kd">class</span> <span class="nc">TkApp</span> <span class="kd">extends</span> <span class="n">TkWrap</span> <span class="o">{</span>
  <span class="nd">@Override</span>
  <span class="kd">public</span> <span class="n">Response</span> <span class="nf">act</span><span class="o">()</span> <span class="o">{</span>
    <span class="k">return</span> <span class="k">new</span> <span class="n">RsWithType</span><span class="o">(</span>
      <span class="k">new</span> <span class="n">RsText</span><span class="o">(</span>
        <span class="s">&quot;&lt;page&gt;&lt;rate&gt;1.1324&lt;/rate&gt;&lt;/page&gt;&quot;</span>
      <span class="o">),</span>
      <span class="s">&quot;application/xml&quot;</span>
    <span class="o">);</span>
  <span class="o">}</span>
<span class="o">}</span></code></pre></figure><p>This “take” always returns the same XML response, but it doesn’t do any XSL transformation yet. We need to add the <code>RsXSLT</code> class to the picture:</p><figure class="highlight"><pre><code class="language-java" data-lang="java"><span></span><span class="nd">@Override</span>
<span class="kd">public</span> <span class="n">Response</span> <span class="nf">act</span><span class="o">()</span> <span class="o">{</span>
  <span class="k">return</span> <span class="k">new</span> <span class="n">RsXSLT</span><span class="o">(</span>
    <span class="k">new</span> <span class="n">RsWithType</span><span class="o">(</span>
      <span class="k">new</span> <span class="n">RsText</span><span class="o">(</span>
        <span class="s">&quot;&lt;?xml-stylesheet type=&#39;text/xsl&#39; href=&#39;/xsl/index.xsl&#39;?&gt;&quot;</span>
        <span class="o">+</span> <span class="s">&quot;&lt;page&gt;&lt;rate&gt;1.1324&lt;/rate&gt;&lt;/page&gt;&quot;</span>
      <span class="o">),</span>
      <span class="s">&quot;application/xml&quot;</span>
    <span class="o">)</span>
  <span class="o">);</span>
<span class="o">}</span></code></pre></figure><p>Excuse me for using string concatenation, which is a <a href="/2014/06/19/avoid-string-concatenation.html">bad practice</a>; it’s merely for the simplicity of the example.</p><p>As you see, I also added an XML stylesheet processing instruction to the XML. <code>RsXSLT</code> will understand it and try to find the <code>/xsl/index.xsl</code> resource on classpath. You see the content of that file above.</p><p>That’s it.</p><p>Well, not really. Building XML from strings is not a good idea. We have a better instrument in the Takes framework. We use <a href="http://www.xembly.org">Xembly</a>, which is a simple imperative language for building and modifying XML documents. More about it here: <a href="/2014/04/09/xembly-intro.html">Xembly, an Assembly for XML</a>.</p><p>Here is how our <code>TkApp</code> would look:</p><figure class="highlight"><pre><code class="language-java" data-lang="java"><span></span><span class="nd">@Override</span>
<span class="kd">public</span> <span class="n">Response</span> <span class="nf">act</span><span class="o">()</span> <span class="o">{</span>
  <span class="k">return</span> <span class="k">new</span> <span class="n">RsXSLT</span><span class="o">(</span>
    <span class="k">new</span> <span class="n">RsWithType</span><span class="o">(</span>
      <span class="k">new</span> <span class="n">RsXembly</span><span class="o">(</span>
        <span class="k">new</span> <span class="n">XeChain</span><span class="o">(</span>
          <span class="k">new</span> <span class="n">XeStylesheet</span><span class="o">(</span><span class="s">&quot;/xsl/index.xsl&quot;</span><span class="o">),</span>
          <span class="k">new</span> <span class="n">XeAppend</span><span class="o">(</span>
            <span class="s">&quot;page&quot;</span><span class="o">,</span>
            <span class="k">new</span> <span class="n">XeDirectives</span><span class="o">(</span>
              <span class="k">new</span> <span class="n">Directives</span><span class="o">().</span><span class="na">add</span><span class="o">(</span><span class="s">&quot;rate&quot;</span><span class="o">).</span><span class="na">set</span><span class="o">(</span><span class="s">&quot;1.1324&quot;</span><span class="o">)</span>
            <span class="o">)</span>
          <span class="o">)</span>
        <span class="o">)</span>
      <span class="o">),</span>
      <span class="s">&quot;application/xml&quot;</span>
    <span class="o">)</span>
  <span class="o">);</span>
<span class="o">}</span></code></pre></figure><p>The most important class here is <a href="http://static.javadoc.io/org.takes/takes/1.1/org/takes/rs/xe/RsXembly.html"><code>RsXembly</code></a>. The idea is to let model classes expose their data through Xembly “directives,” which will later be applied to a DOM structure by <code>RsXembly</code>.</p><p><code>XeChain</code>, <code>XeStylesheet</code>, <code>XeAppend</code>, and <code>XeDirectives</code> expose directives but with different meanings (they are all instances of an <code>XeSource</code> interface). Their names describe their intentions rather well. <a href="http://static.javadoc.io/org.takes/takes/1.1/org/takes/rs/xe/XeChain.html"><code>XeChain</code></a> just chains everything that is delivered by encapsulated “directive sources.” <a href="http://static.javadoc.io/org.takes/takes/1.1/org/takes/rs/xe/XeStylesheet.html"><code>XeStylesheet</code></a> returns directives that create a single XML processing instruction. <a href="http://static.javadoc.io/org.takes/takes/1.1/org/takes/rs/xe/XeAppend.html"><code>XeAppend</code></a> creates an XML node and adds encapsulated directives to it. <a href="http://static.javadoc.io/org.takes/takes/1.1/org/takes/rs/xe/XeDirectives.html"><code>XeDirectives</code></a> simply returns what’s inside.</p><p>In the end, this code will create exactly the same XML document as I created above with string concatenation.</p><p>The beauty of this approach is in the perfect <a href="/2018/09/18/fear-of-coupling.html">decoupling</a> of data generation and XML building and translation between XML and HTML. It is perfectly reusable and “stackable.” We can transform the data in XML format multiple times, applying different XSL stylesheets to each one. We can even transform them into <a href="/2015/11/16/json-vs-xml.html">JSON</a> without changing a line of code in model classes.</p><p>Moreover, we can format them differently, using rather powerful XSLT 2.0 instruments. XSLT by itself is a powerful and purely functional language that enables any possible data manipulations. No templating engine is even close to it.</p><p>Take a look at how it works in the <a href="https://github.com/yegor256/rultor/blob/1.55/src/main/java/com/rultor/web/RsPage.java"><code>RsPage</code></a> class in Rultor, for example.</p></div></article></div><div class="wrapper"> <related-posts /></div><div class="disqus" role="complementary"><p class="disqus_hint"> Please, use <a href="https://help.disqus.com/commenting/what-html-tags-are-allowed-within-comments">syntax highlighting</a> in your comments, to make them more readable.</p><div id="disqus_thread" class="disqus-thread"> <a>&nbsp;</a></div><script> var disqus_config = function () { this.page.url = document.location.href.split('?')[0].split('#')[0].replace('https://', 'http://'); this.page.identifier = this.page.url; }; (function() { var d = document, s = d.createElement('script'); s.src = '//yegor256.disqus.com/embed.js'; s.setAttribute('data-timestamp', +new Date()); (d.head || d.body).appendChild(s); })(); </script> <noscript><div><p class="red"> JavaScript is disabled in your browser, that's why you can't see comments under this post.</p></div></noscript></div><div class="wrapper"> <footer class="footer"><p> &copy; <span itemscope="" itemprop="copyrightHolder" itemtype="http://schema.org/Person"> <span itemprop="name">Yegor Bugayenko</span> </span> 2014&ndash;<span itemprop="copyrightYear">2018</span></p></footer></div></section><div class="wrapper unprintable" style="text-align:center;margin-top:2em;"> <a href="http://www.sixnines.io/h/3ba1652f"> <img src="//www.sixnines.io/b/3ba1652f?style=flat" alt="sixnines availability badge"/> </a></div><script src="//code.jquery.com/jquery-1.9.0.min.js"></script> <script src="/js/all.js?8c0c9d2d5e8"></script> <script>var disqus_shortname = 'yegor256';</script> <script id="dsq-count-scr" src="//yegor256.disqus.com/count.js" async="async"></script> <script> (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){ (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o), m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m) })(window,document,'script','//www.google-analytics.com/analytics.js','ga'); ga('create', 'UA-1963507-32', 'auto'); ga('send', 'pageview'); </script> <script> Cd=document;Cr="&"+Math.random();Cp="&s=1"; Cd.cookie="b=b";if(Cd.cookie)Cp+="&c=1"; Cp+="&t="+(new Date()).getTimezoneOffset(); if(self!=top)Cp+="&f=1"; </script> <script> if(navigator.javaEnabled())Cp+="&j=1"; </script> <script> if(typeof(screen)!='undefined')Cp+="&w="+screen.width+"&h="+ screen.height+"&d="+(screen.colorDepth?screen.colorDepth:screen.pixelDepth); </script> <script> Cd.write("<img src='//c.hit.ua/hit?i=95870&g=0&x=2"+Cp+Cr+ "&r="+escape(Cd.referrer)+"&u="+escape(window.location.href)+ "' border='0' wi"+"dth='1' he"+"ight='1'/>"); </script> <script type="application/ld+json"> { "@context": "http://schema.org", "@type": "Person", "name": "Yegor Bugayenko", "url": "https://www.yegor256.com", "sameAs": [ "https://www.facebook.com/yegor256", "https://instagram.com/yegor256", "https://www.linkedin.com/in/yegor256", "https://twitter.com/yegor256", "https://github.com/yegor256", "https://www.pinterest.com/yegor256/" ] } </script> </body> </html>
