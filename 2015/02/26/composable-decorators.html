<!DOCTYPE html><html xmlns="http://www.w3.org/1999/xhtml" lang="en-US"><head><meta charset="utf-8"/><meta name="description" content="A decorator pattern, while being the best instrument to keep objects highly cohesive, solid, and loosely coupled, is unfortunately not very popular in traditional Java programming."/><meta name="keywords" content="composable decorators, decorator design pattern, decorator pattern example, decorator pattern java, decorator pattern real life example"/><meta name="viewport" content="width=device-width, initial-scale=1.0"/><meta property="twitter:account_id" content="4503599630178231"/><link rel="search" type="application/opensearchdescription+xml" href="opensearch.xml" title="yegor256"/><link rel="shortcut icon" href="/favicon.ico?adddca4"/><link rel="alternate" type="application/rss+xml" title="RSS for yegor256.com" href="http://www.yegor256.com/rss.xml"/><link rel="author" href="http://plus.google.com/u/0/114792568016408327418?rel=author"/><link rel="stylesheet" href="/css/layout.css?adddca4"/><link rel="stylesheet" href="//img.teamed.io/yegor256/icons.css?adddca4"/><link rel="canonical" href="http://www.yegor256.com/2015/02/26/composable-decorators.html"/><title>Composable Decorators vs. Imperative Utility Methods - Yegor Bugayenko</title></head><body><div class="wrapper"> <header class="header"><div> <a href="/about-me.html"> <img src="/images/yegor-bugayenko.png" class="photo" alt="photo"/> </a></div> <nav role="navigation"><ul class="menu social notranslate"><li><a href="http://www.twitter.com/yegor256" title="follow me in Twitter"><i class="icon icon-twitter notranslate" aria-hidden="true"></i></a></li><li><a href="/rss" title="RSS feed"><i class="icon icon-rss notranslate" aria-hidden="true"></i></a></li><li><a href="https://github.com/yegor256" title="my Github profile"><i class="icon icon-github notranslate" aria-hidden="true"></i></a></li><li><a href="http://stackoverflow.com/users/187141/yegor256" title="my StackOverflow profile"><i class="icon icon-stackoverflow notranslate" aria-hidden="true"></i></a></li><li><a href="https://www.facebook.com/yegor.bugayenko" title="follow me in Facebook"><i class="icon icon-facebook notranslate" aria-hidden="true"></i></a></li><li><a href="https://plus.google.com/+YegorBugayenko/posts" title="follow me in Google+"><i class="icon icon-googleplus notranslate" aria-hidden="true"></i></a></li><li><a href="https://www.linkedin.com/in/yegor256" title="my LinkedIn profile"><i class="icon icon-linkedin notranslate" aria-hidden="true"></i></a></li><li><a href="http://www.youtube.com/user/yegor256a" title="my Youtube video channel"><i class="icon icon-youtube notranslate" aria-hidden="true"></i></a></li><li><a href="mailto:yegor@teamed.io" title="yegor@teamed.io"><i class="icon icon-mail notranslate" aria-hidden="true"></i></a></li></ul><ul class="menu"><li> <a href="/best.html" title="best articles to read">12 best articles</a> · <a href="/contents.html" title="blog contents">all 107</a> · <a href="/" title="home page">home page</a></li></ul> </nav><div id="search"> <input id="search-query" class="field field-text" name="q" placeholder="Search" autocomplete="off"/><div id="search-results" style="display:none"><div class="entries"></div></div></div><div style="color:#b82f2f;text-align:left;margin:2em 0;width:75%"> <img src="/images/2015/04/webinar.jpg" style="width:64px;height:64px;float:left;margin-right:1em" alt="webinar logo"/> Hey, don't miss my <a href="https://plus.google.com/events/c5mesunno48ol40p5101sufnfm0"><strong>first webinar</strong></a> on the 8th of April, at 11am PST; it will take one hour and we'll talk about <a href="https://plus.google.com/events/c5mesunno48ol40p5101sufnfm0">"Objects vs. Static Methods"</a>.</div> <script id="search-results-template" type="text/mustache">
          {{#entries}}
            <div>
              <a href="{{url}}">{{title}}</a>
            </div>
          {{/entries}}
        </script></header></div> <section itemscope itemtype="http://schema.org/BlogPosting"><div class="wrapper"> <header><p class="printable"> <code>http://www.yegor256.com/2015/02/26/composable-decorators.html</code></p><h1 itemprop="name">Composable Decorators vs. Imperative Utility Methods</h1><ul class="subline"><li> <time itemprop="datePublished" datetime="2015-02-26T00:00:00+00:00"> 26 February 2015 </time></li><li><a href='https://github.com/yegor256/blog/commits/master/_posts/2015/feb/2015-02-26-composable-decorators.md'>modified</a> on <time itemprop='dateModified' datetime='2015-03-30T18:41:17+0000'>30 March 2015</time></li><li class="printable">Yegor Bugayenko</li><li class="unprintable"> <i class="icon icon-comments"></i> <a href="http://www.yegor256.com/2015/02/26/composable-decorators.html#disqus_thread">comments</a></li></ul><p class="unprintable"><a href='/tag/oop.html' class='tag notranslate'>oop</a></p><div class="buttons notranslate desktop-only"> <nav class="share" role="navigation"> <a href="http://www.facebook.com/sharer/sharer.php?u=http://www.yegor256.com/2015/02/26/composable-decorators.html" title="Share on Facebook" class="button"> <span class="count count-facebook">0</span> <i class="icon icon-facebook notranslate" aria-hidden="true"></i> </a> <a href="https://twitter.com/share?url=http://www.yegor256.com/2015/02/26/composable-decorators.html&amp;text=Composable+Decorators+vs.+Imperative+Utility+Methods" title="Share on Twitter" class="button"> <span class="count count-twitter">0</span> <i class="icon icon-twitter notranslate" aria-hidden="true"></i> </a> <a href="https://plus.google.com/share?url=http://www.yegor256.com/2015/02/26/composable-decorators.html" title="Share on Google+" class="button"> <span class="count count-googleplus">0</span> <i class="icon icon-googleplus notranslate" aria-hidden="true"></i> </a> <a href="https://www.linkedin.com/cws/share?url=http://www.yegor256.com/2015/02/26/composable-decorators.html" title="Share on LinkedIn" class="button"> <span class="count count-linkedin">0</span> <i class="icon icon-linkedin notranslate" aria-hidden="true"></i> </a> <a href="http://www.stumbleupon.com/submit?url=http://www.yegor256.com/2015/02/26/composable-decorators.html&amp;title=Composable+Decorators+vs.+Imperative+Utility+Methods" title="Share on StumbleUpon" class="button"> <span class="count count-stumbleupon">0</span> <i class="icon icon-stumbleupon notranslate" aria-hidden="true"></i> </a> <a href="http://reddit.com/submit?url=http://www.yegor256.com/2015/02/26/composable-decorators.html%3F2015-08&amp;title=Composable+Decorators+vs.+Imperative+Utility+Methods" title="Share on Reddit" class="button"> <span class="count count-reddit">0</span> <i class="icon icon-reddit notranslate" aria-hidden="true"></i> </a> <a href="http://news.ycombinator.com/submitlink?u=http://www.yegor256.com/2015/02/26/composable-decorators.html%3F2015-08&amp;t=Composable+Decorators+vs.+Imperative+Utility+Methods" title="Share on Hacker News" class="button"> <i class="icon icon-hackernews notranslate" aria-hidden="true"></i> </a> </nav></div> </header> <main role="main"> <article class="main" role="article" itemprop="articleBody"><p>The <a href="http://en.wikipedia.org/wiki/Decorator_pattern">decorator pattern</a> is my favorite among all other patterns I'm aware of. It is a very simple and yet very powerful mechanism to make your code <a href="http://en.wikipedia.org/wiki/Cohesion_%28computer_science%29">highly cohesive</a> and <a href="http://en.wikipedia.org/wiki/Coupling_%28computer_programming%29">loosely coupled</a>. However, I believe decorators are not used often enough. They should be everywhere, but they are not. The biggest advantage we get from decorators is that they make our code <em>composable</em>. That's why the title of this post is composable decorators. Unfortunately, instead of decorators, we often use imperative utility methods, which make our code procedural rather than object-oriented.</p><figure><img src='http://www.yegor256.com/images/2015/02/russina-matroshka.jpg' style='width:600px' alt='Матрёшка'/><figcaption>Матрёшка</figcaption></figure><p>First, a practical example. Here is an interface for an object that is supposed to read a text somewhere and return it:</p><div class="highlight"><pre><code class="language-java" data-lang="java"><span class="kd">interface</span> <span class="nc">Text</span> <span class="o">{</span>
  <span class="n">String</span> <span class="nf">read</span><span class="o">();</span>
<span class="o">}</span></code></pre></div><p>Here is an implementation that reads the text from a file:</p><div class="highlight"><pre><code class="language-java" data-lang="java"><span class="kd">final</span> <span class="kd">class</span> <span class="nc">TextInFile</span> <span class="kd">implements</span> <span class="n">Text</span> <span class="o">{</span>
  <span class="kd">private</span> <span class="kd">final</span> <span class="n">File</span> <span class="n">file</span><span class="o">;</span>
  <span class="kd">public</span> <span class="nf">TextInFile</span><span class="o">(</span><span class="kd">final</span> <span class="n">File</span> <span class="n">src</span><span class="o">)</span> <span class="o">{</span>
    <span class="k">this</span><span class="o">.</span><span class="na">file</span> <span class="o">=</span> <span class="n">src</span><span class="o">;</span>
  <span class="o">}</span>
  <span class="nd">@Override</span>
  <span class="kd">public</span> <span class="n">String</span> <span class="nf">read</span><span class="o">()</span> <span class="o">{</span>
    <span class="k">return</span> <span class="k">new</span> <span class="nf">String</span><span class="o">(</span>
      <span class="n">Files</span><span class="o">.</span><span class="na">readAllBytes</span><span class="o">(),</span> <span class="s">"UTF-8"</span>
    <span class="o">);</span>
  <span class="o">}</span>
<span class="o">}</span></code></pre></div><p>And now the decorator, which is another implementation of <code>Text</code> that removes all unprintable characters from the text:</p><div class="highlight"><pre><code class="language-java" data-lang="java"><span class="kd">final</span> <span class="kd">class</span> <span class="nc">PrintableText</span> <span class="kd">implements</span> <span class="n">Text</span> <span class="o">{</span>
  <span class="kd">private</span> <span class="kd">final</span> <span class="n">Text</span> <span class="n">origin</span><span class="o">;</span>
  <span class="kd">public</span> <span class="nf">PrintableText</span><span class="o">(</span><span class="kd">final</span> <span class="n">Text</span> <span class="n">text</span><span class="o">)</span> <span class="o">{</span>
    <span class="k">this</span><span class="o">.</span><span class="na">origin</span> <span class="o">=</span> <span class="n">text</span><span class="o">;</span>
  <span class="o">}</span>
  <span class="nd">@Override</span>
  <span class="kd">public</span> <span class="n">String</span> <span class="nf">read</span><span class="o">()</span> <span class="o">{</span>
    <span class="k">return</span> <span class="k">this</span><span class="o">.</span><span class="na">origin</span><span class="o">.</span><span class="na">read</span><span class="o">()</span>
      <span class="o">.</span><span class="na">replaceAll</span><span class="o">(</span><span class="s">"[^\p{Print}]"</span><span class="o">,</span> <span class="s">""</span><span class="o">);</span>
  <span class="o">}</span>
<span class="o">}</span></code></pre></div><p>Here is how I'm using it:</p><div class="highlight"><pre><code class="language-java" data-lang="java"><span class="kd">final</span> <span class="n">Text</span> <span class="n">text</span> <span class="o">=</span> <span class="k">new</span> <span class="nf">PrintableText</span><span class="o">(</span>
  <span class="k">new</span> <span class="nf">TextInFile</span><span class="o">(</span><span class="k">new</span> <span class="nf">File</span><span class="o">(</span><span class="s">"/tmp/a.txt"</span><span class="o">))</span>
<span class="o">);</span>
<span class="n">String</span> <span class="n">content</span> <span class="o">=</span> <span class="n">text</span><span class="o">.</span><span class="na">read</span><span class="o">();</span></code></pre></div><p>As you can see, the <code>PrintableText</code> doesn't read the text from the file. It doesn't really care where the text is coming from. It <em>delegates</em> text reading to the encapsulated instance of <code>Text</code>. How this encapsulated object will deal with the text and where it will get it doesn't concern <code>PrintableText</code>.</p><p>Let's continue and try to create an implemetation of <code>Text</code> that will capitalize all letters in the text:</p><div class="highlight"><pre><code class="language-java" data-lang="java"><span class="kd">final</span> <span class="kd">class</span> <span class="nc">AllCapsText</span> <span class="kd">implements</span> <span class="n">Text</span> <span class="o">{</span>
  <span class="kd">private</span> <span class="kd">final</span> <span class="n">Text</span> <span class="n">origin</span><span class="o">;</span>
  <span class="kd">public</span> <span class="nf">AllCapsText</span><span class="o">(</span><span class="kd">final</span> <span class="n">Text</span> <span class="n">text</span><span class="o">)</span> <span class="o">{</span>
    <span class="k">this</span><span class="o">.</span><span class="na">origin</span> <span class="o">=</span> <span class="n">text</span><span class="o">;</span>
  <span class="o">}</span>
  <span class="nd">@Override</span>
  <span class="kd">public</span> <span class="n">String</span> <span class="nf">read</span><span class="o">()</span> <span class="o">{</span>
    <span class="k">return</span> <span class="k">this</span><span class="o">.</span><span class="na">origin</span><span class="o">.</span><span class="na">read</span><span class="o">().</span><span class="na">toUpperCase</span><span class="o">(</span><span class="n">Locale</span><span class="o">.</span><span class="na">ENGLISH</span><span class="o">);</span>
  <span class="o">}</span>
<span class="o">}</span></code></pre></div><p>How about a <code>Text</code> that trims the input:</p><div class="highlight"><pre><code class="language-java" data-lang="java"><span class="kd">final</span> <span class="kd">class</span> <span class="nc">TrimmedText</span> <span class="kd">implements</span> <span class="n">Text</span> <span class="o">{</span>
  <span class="kd">private</span> <span class="kd">final</span> <span class="n">Text</span> <span class="n">origin</span><span class="o">;</span>
  <span class="kd">public</span> <span class="nf">TrimmedText</span><span class="o">(</span><span class="kd">final</span> <span class="n">Text</span> <span class="n">text</span><span class="o">)</span> <span class="o">{</span>
    <span class="k">this</span><span class="o">.</span><span class="na">origin</span> <span class="o">=</span> <span class="n">text</span><span class="o">;</span>
  <span class="o">}</span>
  <span class="nd">@Override</span>
  <span class="kd">public</span> <span class="n">String</span> <span class="nf">read</span><span class="o">()</span> <span class="o">{</span>
    <span class="k">return</span> <span class="k">this</span><span class="o">.</span><span class="na">origin</span><span class="o">.</span><span class="na">read</span><span class="o">().</span><span class="na">trim</span><span class="o">();</span>
  <span class="o">}</span>
<span class="o">}</span></code></pre></div><p>I can go on and on with these decorators. I can create many of them, suitable for their own individual use cases. But let's see how they all can play together. Let's say I want to read the text from the file, capitalize it, trim it, and remove all unprintable characters. And I want to be <em>declarative</em>. Here is what I do:</p><div class="highlight"><pre><code class="language-java" data-lang="java"><span class="kd">final</span> <span class="n">Text</span> <span class="n">text</span> <span class="o">=</span> <span class="k">new</span> <span class="nf">AllCapsText</span><span class="o">(</span>
  <span class="k">new</span> <span class="nf">TrimmedText</span><span class="o">(</span>
    <span class="k">new</span> <span class="nf">PrintableText</span><span class="o">(</span>
      <span class="k">new</span> <span class="nf">TextInFile</span><span class="o">(</span><span class="k">new</span> <span class="nf">File</span><span class="o">(</span><span class="s">"/tmp/a.txt"</span><span class="o">))</span>
    <span class="o">)</span>
  <span class="o">)</span>
<span class="o">);</span>
<span class="n">String</span> <span class="n">content</span> <span class="o">=</span> <span class="n">text</span><span class="o">.</span><span class="na">read</span><span class="o">();</span></code></pre></div><p>First, I create an instance of <code>Text</code>, <em>composing</em> multiple decorators into a single object. I declaratively define the behavior of <code>text</code> without actually executing anything. Until method <code>read()</code> is called, the file is not touched and the processing of the text is not started. The object <code>text</code> is just a composition of decorators, not an executable <em>procedure</em>. Check out this article about declarative and imperative styles of programming: <a href="/2015/02/20/utility-classes-vs-functional-programming.html">Utility Classes Have Nothing to Do With Functional Programming</a>.</p><p>This design is much more flexible and reusable than a more traditional one, where the <code>Text</code> object is smart enough to perform all said operations. For example, class <a href="http://docs.oracle.com/javase/7/docs/api/java/lang/String.html"><code>String</code></a> from Java is a good example of a bad design. It has more than 20 <em>utility methods</em> that should have been provided as decorators instead: <code>trim()</code>, <code>toUpperCase()</code>, <code>substring()</code>, <code>split()</code>, and many others, for example. When I want to trim my string, uppercase it, and then split it into pieces, here is what my code will look like:</p><div class="highlight"><pre><code class="language-java" data-lang="java"><span class="kd">final</span> <span class="n">String</span> <span class="n">txt</span> <span class="o">=</span> <span class="s">"hello, world!"</span><span class="o">;</span>
<span class="kd">final</span> <span class="n">String</span><span class="o">[]</span> <span class="n">parts</span> <span class="o">=</span> <span class="n">txt</span><span class="o">.</span><span class="na">trim</span><span class="o">().</span><span class="na">toUpperCase</span><span class="o">().</span><span class="na">split</span><span class="o">(</span><span class="s">" "</span><span class="o">);</span></code></pre></div><p>This is imperative and procedural programming. Composable decorators, on the other hand, would make this code object-oriented and declarative. Something like this would be great to have in Java instead (pseudo-code):</p><div class="highlight"><pre><code class="language-java" data-lang="java"><span class="kd">final</span> <span class="n">String</span><span class="o">[]</span> <span class="n">parts</span> <span class="o">=</span> <span class="k">new</span> <span class="n">String</span><span class="o">.</span><span class="na">Split</span><span class="o">(</span>
  <span class="k">new</span> <span class="n">String</span><span class="o">.</span><span class="na">UpperCased</span><span class="o">(</span>
    <span class="k">new</span> <span class="n">String</span><span class="o">.</span><span class="na">Trimmed</span><span class="o">(</span><span class="s">"hello, world!"</span><span class="o">)</span>
  <span class="o">)</span>
<span class="o">);</span></code></pre></div><p>To conclude, I recommend you think twice every time you add a new utility method to the interface/class. Try to avoid utility methods as much as possible, and use decorators instead. An ideal interface should contain only methods that you absolutely cannot remove. Everything else should be done through composable decorators.</p></article> </main><div class="unprintable"><h2>Related Posts</h2><p>You may also find these posts interesting:</p><ul><li><a href="/2015/03/26/jaxb-vs-xembly.html">JAXB Is Doing It Wrong; Try Xembly</a></li><li><a href="/2015/03/09/objects-end-with-er.html">Don't Create Objects That End With -ER</a></li><li><a href="/2015/02/23/haircut.html">A Haircut</a></li><li><a href="/2015/02/20/utility-classes-vs-functional-programming.html">Utility Classes Have Nothing to Do With Functional Programming</a></li><li><a href="/2015/01/21/if-then-throw-else.html">If. Then. Throw. Else. WTF?</a></li></ul></div></div><div class="disqus" role="complementary"><div id="disqus_thread"></div> <a href="http://disqus.com" class="dsq-brlink"> comments powered by <span class="logo-disqus">Disqus</span> </a></div><div class="wrapper"> <footer class="footer"><p> © <span itemprop="author">Yegor Bugayenko</span>, 2014</p> </footer></div></section><script src="http://code.jquery.com/jquery-2.1.0.min.js"></script><script src="/js/ext/search.min.js?adddca4"></script><script src="/js/global.js?adddca4" async defer></script><script src="/js/post.js?adddca4" async defer></script></body></html>