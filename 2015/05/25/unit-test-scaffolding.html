<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="en-US" xml:lang="en-US"
  itemscope="" itemtype="http://schema.org/WebPage">
  <head>
    <base href="http://www.yegor256.com/2015/05/25/unit-test-scaffolding.html"/>
    <meta charset="utf-8"/>
    <meta itemprop="name" content="A Few Thoughts on Unit Test Scaffolding" />
    <meta itemprop="author" content="Yegor Bugayenko" />
    <meta itemprop="breadcrumb" content="http://www.yegor256.com" />
    <meta itemprop="keywords" content="unit test scaffolding, unit testing best practices, unit testing mocks, unit testing of static, unit testing stubs" />
    <meta itemprop="description" content="Most unit tests require mocks, stubs, and the preparation of some other structures before a test can be initiated; here is how I recommend you do that." />
    <meta name="description" content="Most unit tests require mocks, stubs, and the preparation of some other structures before a test can be initiated; here is how I recommend you do that." />
    <meta name="keywords" content="unit test scaffolding, unit testing best practices, unit testing mocks, unit testing of static, unit testing stubs" />
    <meta name="viewport" content="width=device-width,minimum-scale=1,initial-scale=1"/>
    <meta name="twitter:creator" content="@yegor256"/>
    <meta property="twitter:account_id" content="4503599630178231" />
    <meta property="og:url" content="http://www.yegor256.com/2015/05/25/unit-test-scaffolding.html"/>
    
    <meta property="og:site_name" content="yegor256"/>
    <meta property="og:title" content="A Few Thoughts on Unit Test Scaffolding"/>
    <meta property="og:description" content="Most unit tests require mocks, stubs, and the preparation of some other structures before a test can be initiated; here is how I recommend you do that."/>
    <meta property="og:type" content="article" />
    <meta property="og:locale" content="en_US" />
    <meta property="fb:admins" content="10203747823006002"/>
    <meta name="twitter:site" content="@yegor256"/>
    <meta name="twitter:creator" content="@yegor256"/>
    <meta name="twitter:url" content="http://www.yegor256.com/2015/05/25/unit-test-scaffolding.html"/>
    <meta property="article:author" content="https://www.facebook.com/yegor256"/>
    <meta name="p:domain_verify" content="61f09f0ef5db665328827225a3fc11bd"/>
    <link rel="search" type="application/opensearchdescription+xml" href="opensearch.xml" title="yegor256" />
    <link rel="shortcut icon" href="/favicon.ico?465f564"/>
    <link rel="apple-touch-icon" href="/favicon.ico?465f564"/>
    <link rel="alternate" type="application/rss+xml" title="RSS for yegor256.com" href="http://www.yegor256.com/rss.xml"/>
    <link rel="author" href="http://plus.google.com/u/0/114792568016408327418?rel=author" />
    <link rel="publisher" href="http://plus.google.com/u/0/114792568016408327418" />
    <link rel="stylesheet" href="/css/layout.css?465f564"/>
    <link rel="stylesheet" href="/css/icons.css?465f564"/>
    <link rel="canonical" href="http://www.yegor256.com/2015/05/25/unit-test-scaffolding.html" />
    <title>A Few Thoughts on Unit Test Scaffolding - Yegor Bugayenko
      </title>
    <script src="http://code.jquery.com/jquery-2.1.0.min.js"></script>
    <script src="/js/global.js?465f564"></script>
  </head>
  <body>
    <div class="wrapper">
      <aside class="header-toggle unprintable" id="header-toggle" title="show head menu"
        onclick="$('#header').show();$('#header-toggle').hide();">&#9776;</aside>
      <header class="header" id="header">
        <div class="face">
          <a href="/about-me.html" class="sub"><span>subscribe</span></a>
          <a href="/about-me.html">
            <img src="/images/yegor-bugayenko-192x192.png" class="photo"
              alt="photo of Yegor Bugayenko"/>
          </a>
          <a href="/about-me.html" class="hire"><span>hire me</span></a>
        </div>
        <nav>
          <ul class="menu social notranslate">
            <li><a href="http://www.twitter.com/yegor256" title="follow me in Twitter"><i class="icon icon-twitter notranslate" aria-hidden="true"></i></a></li>
            <li><a href="/rss" title="RSS feed"><i class="icon icon-rss notranslate" aria-hidden="true"></i></a></li>
            <li><a href="https://github.com/yegor256" title="my GitHub profile"><i class="icon icon-github notranslate" aria-hidden="true"></i></a></li>
            <li><a href="http://stackoverflow.com/users/187141/yegor256" title="my StackOverflow profile"><i class="icon icon-stackoverflow notranslate" aria-hidden="true"></i></a></li>
            <li><a href="https://www.facebook.com/yegor256" title="follow me in Facebook"><i class="icon icon-facebook notranslate" aria-hidden="true"></i></a></li>
            <li><a href="https://plus.google.com/+YegorBugayenko/posts" title="follow me in Google+"><i class="icon icon-googleplus notranslate" aria-hidden="true"></i></a></li>
            <li><a href="https://www.linkedin.com/in/yegor256" title="my LinkedIn profile"><i class="icon icon-linkedin notranslate" aria-hidden="true"></i></a></li>
            <li><a href="https://www.youtube.com/channel/UCr9qCdqXLm2SU0BIs6d_68Q" title="my Youtube video channel"><i class="icon icon-youtube notranslate" aria-hidden="true"></i></a></li>
            <li><a href="https://www.pinterest.com/yegor256/" title="my Pinterest boards"><i class="icon icon-pinterest notranslate" aria-hidden="true"></i></a></li>
            <li><a href="mailto:yegor@teamed.io" title="yegor@teamed.io"><i class="icon icon-mail notranslate" aria-hidden="true"></i></a></li>
          </ul>
          <ul class="menu">
            <li><a href="/" title="home page">home</a></li>
            <li><a href="/best.html" title="best articles to read">12&nbsp;best</a></li>
            <li><a href="/contents.html" title="blog contents">all&nbsp;170</a></li>
            <li><a href="/webinars.html" title="webinars">webinars</a></li>
            <li><a href="/talks.html" title="talks">talks</a></li>
            <li><a href="/books.html" title="books">books</a></li>
            <li><a href="/award.html" title="software quality award">award</a></li>
          </ul>
        </nav>
        <div id="search">
          <form method="get" action="https://www.google.com/search" style="position:relative">
            <input name="sitesearch" value="yegor256.com" type="hidden"/>
            <input id="search-query" class="field field-text"
              onfocus="$('#google').css('display', 'inline-block');"
              name="q" placeholder="Search" autocomplete="off"/>
            <span class="desktop-only">
              <input type="image" src="/images/google-search-icon.png" id="google" title="search via Google"
                style="width:3em;height:3em;display:none;position:absolute;margin-left:1em;" alt="search via Google"/>
            </span>
          </form>
          <div id="search-results" style="display: none;">
            <div class="entries"></div>
          </div>
        </div>
        
        <script id="search-results-template" type="text/mustache">
          {{#entries}}
            <div>
              <a href="{{url}}">{{title}}</a>
            </div>
          {{/entries}}
        </script>
        
        <div class="hot">
          <a href="http://goo.gl/5Yfx1i">
            <img src="/images/books/elegant-objects/cover.png"
              alt="Elegant Objects"
              style="width:100px;float:right;margin-left:1em;"/>
          </a>
          <ul>
            <li>
              <strong>Elegant Objects</strong>, my book about
              object-oriented programming, is published! Buy it
              <a href="http://goo.gl/5Yfx1i">on Amazon</a>
              and give me your feedback, please.
            </li>
            <!--
            <li>
              Meet me in Seattle, on Mar 12, at
              <a href="http://casitconf.org/casitconf16/talks/">CascadiaIT</a>,
              I'll be speaking about chat bots
            </li>
            -->
            <li>
              Meet me in Washington DC, on Mar 31, at
              <a href="http://www.sedcconference.org/">SEDC</a>,
              I'll be speaking about XDSD and meeting-free work
            </li>
            <li>
              <a href="https://plus.google.com/events/cn2nne1qnm8t475bt461igccrg4">Webinar #13</a>
              will be about the role of a Software Architect;
              join us on Apr 6, at 11am PST
            </li>
          </ul>
        </div>
      </header>
    </div>
    <section itemscope="" itemtype="http://schema.org/BlogPosting">

  <div class="wrapper">
    <header>
      <p class="printable">
        <img src="https://api.qrserver.com/v1/create-qr-code/?data=http://www.yegor256.com/2015/05/25/unit-test-scaffolding.html&amp;format=svg"
          style="width:125px;height:125px;" alt="QR code"/>
      </p>
      <p class="printable">
        <code>http://www.yegor256.com/2015/05/25/unit-test-scaffolding.html</code>
      </p>
      <h1 itemprop="name">A Few Thoughts on Unit Test Scaffolding</h1>
      
      <ul class="subline">
        <li>
          <time itemprop="datePublished" datetime="2015-05-25T00:00:00+00:00">
            25 May 2015
          </time>
        </li>
        
        <li class='unprintable desktop-only'><a href='https://github.com/yegor256/blog/commits/master/_posts/2015/may/2015-05-25-unit-test-scaffolding.md'>modified</a>          on <time itemprop='dateModified' datetime='2015-10-18T20:04:36+0000'>18 October 2015</time></li>
        <li class="printable">Yegor Bugayenko</li>
        <li class="unprintable">
          <i class="icon icon-comments"></i>
          <a href="http://www.yegor256.com/2015/05/25/unit-test-scaffolding.html#disqus_thread">comments</a>
        </li>
      </ul>
      <p class="unprintable"><a href='/tag/oop.html' class='tag notranslate'><img src='/images/books/elegant-objects/cactus.svg' alt='OOP'/>oop</a> <a href='/tag/java.html' class='tag notranslate'>java</a></p>
      <div class="buttons notranslate desktop-only">
        <nav class="share" role="navigation">
          <a href="http://www.facebook.com/sharer/sharer.php?u=http://www.yegor256.com/2015/05/25/unit-test-scaffolding.html"
            title="Share on Facebook" class="button">
            <span class="count count-facebook">0</span>
            <i class="icon icon-facebook notranslate" aria-hidden="true"></i>
          </a>
          <a href="https://twitter.com/share?url=http://www.yegor256.com/2015/05/25/unit-test-scaffolding.html&amp;text=A+Few+Thoughts+on+Unit+Test+Scaffolding"
            title="Share on Twitter" class="button">
            <span class="count count-twitter">0</span>
            <i class="icon icon-twitter notranslate" aria-hidden="true"></i>
          </a>
          <a href="https://plus.google.com/share?url=http://www.yegor256.com/2015/05/25/unit-test-scaffolding.html"
            title="Share on Google+" class="button">
            <span class="count count-googleplus">0</span>
            <i class="icon icon-googleplus notranslate" aria-hidden="true"></i>
          </a>
          <a href="https://www.linkedin.com/cws/share?url=http://www.yegor256.com/2015/05/25/unit-test-scaffolding.html"
            title="Share on LinkedIn" class="button">
            <span class="count count-linkedin">0</span>
            <i class="icon icon-linkedin notranslate" aria-hidden="true"></i>
          </a>
          <a href="http://www.stumbleupon.com/submit?url=http://www.yegor256.com/2015/05/25/unit-test-scaffolding.html&amp;title=A+Few+Thoughts+on+Unit+Test+Scaffolding"
            title="Share on StumbleUpon" class="button">
            <span class="count count-stumbleupon">0</span>
            <i class="icon icon-stumbleupon notranslate" aria-hidden="true"></i>
          </a>
          <a href="http://reddit.com/submit?url=http://www.yegor256.com/2015/05/25/unit-test-scaffolding.html%3F2015-21&amp;title=A+Few+Thoughts+on+Unit+Test+Scaffolding"
            title="Share on Reddit" class="button">
            <span class="count count-reddit">0</span>
            <i class="icon icon-reddit notranslate" aria-hidden="true"></i>
          </a>
          <a href="http://news.ycombinator.com/submitlink?u=http://www.yegor256.com/2015/05/25/unit-test-scaffolding.html%3F2015-21&amp;t=A+Few+Thoughts+on+Unit+Test+Scaffolding"
            title="Share on Hacker News" class="button">
            <i class="icon icon-hackernews notranslate" aria-hidden="true"></i>
          </a>
        </nav>
      </div>
    </header>
    <main>
      <article class="main" itemprop="articleBody">
        <p>When I start to repeat myself in unit test methods by creating
the same objects and preparing the data to run the test,
I feel disappointed in my design. Long test methods with a lot of code
duplication just don&#39;t look right. To simplify and shorten them,
there are basically two options, at least in Java: 1) private properties
initialized through <code>@Before</code> and <code>@BeforeClass</code>, and 2) private static
methods. They both look anti-OOP to me, and I think there is an
alternative. Let me explain.</p>

<!--more-->

<figure><img src='http://cf.jare.io/?u=http%3A%2F%2Fwww.yegor256.com%2Fimages%2F2015%2F05%2Fleon-the-professional.jpg' style='width:600px;' alt='Léon: The Professional by Luc Besson'/><figcaption>Léon: The Professional by Luc Besson</figcaption></figure>

<p>JUnit officially suggests a
<a href="http://junit.org/faq.html#atests_2">test fixture</a>:</p>

<figure class="highlight"><pre><code class="language-java" data-lang="java"><span class="kd">public</span> <span class="kd">final</span> <span class="kd">class</span> <span class="nc">MetricsTest</span> <span class="o">{</span>
  <span class="kd">private</span> <span class="n">File</span> <span class="n">temp</span><span class="o">;</span>
  <span class="kd">private</span> <span class="n">Folder</span> <span class="n">folder</span><span class="o">;</span>
  <span class="nd">@Before</span>
  <span class="kd">public</span> <span class="kt">void</span> <span class="nf">prepare</span><span class="o">()</span> <span class="o">{</span>
    <span class="k">this</span><span class="o">.</span><span class="na">temp</span> <span class="o">=</span> <span class="n">Files</span><span class="o">.</span><span class="na">createTempDirectory</span><span class="o">(</span><span class="s">&quot;test&quot;</span><span class="o">);</span>
    <span class="k">this</span><span class="o">.</span><span class="na">folder</span> <span class="o">=</span> <span class="k">new</span> <span class="nf">DiscFolder</span><span class="o">(</span><span class="k">this</span><span class="o">.</span><span class="na">temp</span><span class="o">);</span>
    <span class="k">this</span><span class="o">.</span><span class="na">folder</span><span class="o">.</span><span class="na">save</span><span class="o">(</span><span class="s">&quot;first.txt&quot;</span><span class="o">,</span> <span class="s">&quot;Hello, world!&quot;</span><span class="o">);</span>
    <span class="k">this</span><span class="o">.</span><span class="na">folder</span><span class="o">.</span><span class="na">save</span><span class="o">(</span><span class="s">&quot;second.txt&quot;</span><span class="o">,</span> <span class="s">&quot;Goodbye!&quot;</span><span class="o">);</span>
  <span class="o">}</span>
  <span class="nd">@After</span>
  <span class="kd">public</span> <span class="kt">void</span> <span class="nf">clean</span><span class="o">()</span> <span class="o">{</span>
    <span class="n">FileUtils</span><span class="o">.</span><span class="na">deleteDirectory</span><span class="o">(</span><span class="k">this</span><span class="o">.</span><span class="na">temp</span><span class="o">);</span>
  <span class="o">}</span>
  <span class="nd">@Test</span>
  <span class="kd">public</span> <span class="kt">void</span> <span class="nf">calculatesTotalSize</span><span class="o">()</span> <span class="o">{</span>
    <span class="n">assertEquals</span><span class="o">(</span><span class="mi">22</span><span class="o">,</span> <span class="k">new</span> <span class="nf">Metrics</span><span class="o">(</span><span class="k">this</span><span class="o">.</span><span class="na">folder</span><span class="o">).</span><span class="na">size</span><span class="o">());</span>
  <span class="o">}</span>
  <span class="nd">@Test</span>
  <span class="kd">public</span> <span class="kt">void</span> <span class="nf">countsWordsInFiles</span><span class="o">()</span> <span class="o">{</span>
    <span class="n">assertEquals</span><span class="o">(</span><span class="mi">4</span><span class="o">,</span> <span class="k">new</span> <span class="nf">Metrics</span><span class="o">(</span><span class="k">this</span><span class="o">.</span><span class="na">folder</span><span class="o">).</span><span class="na">wc</span><span class="o">());</span>
  <span class="o">}</span>
<span class="o">}</span></code></pre></figure>

<p>I think it&#39;s obvious what this test is doing. First, in <code>prepare()</code>,
it creates a &quot;test fixture&quot; of type <code>Folder</code>. That is used in all three
tests as an argument for the <code>Metrics</code> constructor. The real class being
tested here is <code>Metrics</code> while <code>this.folder</code> is something we need
in order to test it.</p>

<p>What&#39;s wrong with this test? There is one serious issue:
<strong>coupling</strong> between test methods. Test methods (and all tests in general)
must be perfectly isolated from each other. This means that changing
one test must not affect any others. In this example, that is not the case.
When I want to change the <code>countsWords()</code> test, I have to change the internals
of <code>before()</code>, which will affect the other method in the test &quot;class&quot;.</p>

<p>With all due respect to JUnit, the idea of creating test fixtures in
<code>@Before</code> and <code>@After</code> is wrong, mostly because it encourages
developers to couple test methods.</p>

<p>Here is how we can improve our test and isolate test methods:</p>

<figure class="highlight"><pre><code class="language-java" data-lang="java"><span class="kd">public</span> <span class="kd">final</span> <span class="kd">class</span> <span class="nc">MetricsTest</span> <span class="o">{</span>
  <span class="nd">@Test</span>
  <span class="kd">public</span> <span class="kt">void</span> <span class="nf">calculatesTotalSize</span><span class="o">()</span> <span class="o">{</span>
    <span class="kd">final</span> <span class="n">File</span> <span class="n">dir</span> <span class="o">=</span> <span class="n">Files</span><span class="o">.</span><span class="na">createTempDirectory</span><span class="o">(</span><span class="s">&quot;test-1&quot;</span><span class="o">);</span>
    <span class="kd">final</span> <span class="n">Folder</span> <span class="n">folder</span> <span class="o">=</span> <span class="n">MetricsTest</span><span class="o">.</span><span class="na">folder</span><span class="o">(</span>
      <span class="n">dir</span><span class="o">,</span>
      <span class="s">&quot;first.txt:Hello, world!&quot;</span><span class="o">,</span>
      <span class="s">&quot;second.txt:Goodbye!&quot;</span>
    <span class="o">);</span>
    <span class="k">try</span> <span class="o">{</span>
      <span class="n">assertEquals</span><span class="o">(</span><span class="mi">22</span><span class="o">,</span> <span class="k">new</span> <span class="nf">Metrics</span><span class="o">(</span><span class="n">folder</span><span class="o">).</span><span class="na">size</span><span class="o">());</span>
    <span class="o">}</span> <span class="k">finally</span> <span class="o">{</span>
      <span class="n">FileUtils</span><span class="o">.</span><span class="na">deleteDirectory</span><span class="o">(</span><span class="n">dir</span><span class="o">);</span>
    <span class="o">}</span>
  <span class="o">}</span>
  <span class="nd">@Test</span>
  <span class="kd">public</span> <span class="kt">void</span> <span class="nf">countsWordsInFiles</span><span class="o">()</span> <span class="o">{</span>
    <span class="kd">final</span> <span class="n">File</span> <span class="n">dir</span> <span class="o">=</span> <span class="n">Files</span><span class="o">.</span><span class="na">createTempDirectory</span><span class="o">(</span><span class="s">&quot;test-2&quot;</span><span class="o">);</span>
    <span class="kd">final</span> <span class="n">Folder</span> <span class="n">folder</span> <span class="o">=</span> <span class="n">MetricsTest</span><span class="o">.</span><span class="na">folder</span><span class="o">(</span>
      <span class="n">dir</span><span class="o">,</span>
      <span class="s">&quot;alpha.txt:Three words here&quot;</span><span class="o">,</span>
      <span class="s">&quot;beta.txt:two words&quot;</span>
      <span class="s">&quot;gamma.txt:one!&quot;</span>
    <span class="o">);</span>
    <span class="k">try</span> <span class="o">{</span>
      <span class="n">assertEquals</span><span class="o">(</span><span class="mi">6</span><span class="o">,</span> <span class="k">new</span> <span class="nf">Metrics</span><span class="o">(</span><span class="n">folder</span><span class="o">).</span><span class="na">wc</span><span class="o">());</span>
    <span class="o">}</span> <span class="k">finally</span> <span class="o">{</span>
      <span class="n">FileUtils</span><span class="o">.</span><span class="na">deleteDirectory</span><span class="o">(</span><span class="n">dir</span><span class="o">);</span>
    <span class="o">}</span>
  <span class="o">}</span>
  <span class="kd">private</span> <span class="kd">static</span> <span class="n">Folder</span> <span class="nf">folder</span><span class="o">(</span><span class="n">File</span> <span class="n">dir</span><span class="o">,</span> <span class="n">String</span><span class="o">...</span> <span class="n">parts</span><span class="o">)</span> <span class="o">{</span>
    <span class="n">Folder</span> <span class="n">folder</span> <span class="o">=</span> <span class="k">new</span> <span class="nf">DiscFolder</span><span class="o">(</span><span class="n">dir</span><span class="o">);</span>
    <span class="k">for</span> <span class="o">(</span><span class="kd">final</span> <span class="n">String</span> <span class="n">part</span> <span class="o">:</span> <span class="n">parts</span><span class="o">)</span> <span class="o">{</span>
      <span class="kd">final</span> <span class="n">String</span><span class="o">[]</span> <span class="n">pair</span> <span class="o">=</span> <span class="n">part</span><span class="o">.</span><span class="na">split</span><span class="o">(</span><span class="s">&quot;:&quot;</span><span class="o">,</span> <span class="mi">2</span><span class="o">);</span>
      <span class="k">this</span><span class="o">.</span><span class="na">folder</span><span class="o">.</span><span class="na">save</span><span class="o">(</span><span class="n">pair</span><span class="o">[</span><span class="mi">0</span><span class="o">],</span> <span class="n">pair</span><span class="o">[</span><span class="mi">1</span><span class="o">]);</span>
    <span class="o">}</span>
    <span class="k">return</span> <span class="n">folder</span><span class="o">;</span>
  <span class="o">}</span>
<span class="o">}</span></code></pre></figure>

<p>Does it look better now? We&#39;re not there yet, but now our test
methods are perfectly isolated. If I want to change one of them,
I&#39;m not going to affect the others because I pass all configuration
parameters to a private static utility (!) method <code>folder()</code>.</p>

<p>A utility method, huh? Yes,
<a href="/2014/05/05/oop-alternative-to-utility-classes.html">it smells</a>.</p>

<p>The main issue with this design, even though it is way better than
the previous one, is that it doesn&#39;t prevent code duplication between
test &quot;classes&quot;. If I need a similar test fixture of type <code>Folder</code> in
another test case, I will have to move this static method there. Or
even worse, I will have to create a utility class.
Yes, there is <a href="/2015/02/20/utility-classes-vs-functional-programming.html">nothing worse</a>
in object-oriented programming than utility classes.</p>

<p>A much better design would be to use
<a href="/2014/09/23/built-in-fake-objects.html">&quot;fake&quot; objects</a>
instead of private static utilities. Here is how. First, we create a fake class
and place it into <code>src/main/java</code>. This class can be used in tests
and also in production code, if necessary (<code>Fk</code> for &quot;fake&quot;):</p>

<figure class="highlight"><pre><code class="language-java" data-lang="java"><span class="kd">public</span> <span class="kd">final</span> <span class="kd">class</span> <span class="nc">FkFolder</span> <span class="kd">implements</span> <span class="n">Folder</span><span class="o">,</span> <span class="n">Closeable</span> <span class="o">{</span>
  <span class="kd">private</span> <span class="kd">final</span> <span class="n">File</span> <span class="n">dir</span><span class="o">;</span>
  <span class="kd">private</span> <span class="kd">final</span> <span class="n">String</span><span class="o">[]</span> <span class="n">parts</span><span class="o">;</span>
  <span class="kd">public</span> <span class="nf">FkFolder</span><span class="o">(</span><span class="n">String</span><span class="o">...</span> <span class="n">prts</span><span class="o">)</span> <span class="o">{</span>
    <span class="k">this</span><span class="o">(</span><span class="n">Files</span><span class="o">.</span><span class="na">createTempDirectory</span><span class="o">(</span><span class="s">&quot;test-1&quot;</span><span class="o">),</span> <span class="n">parts</span><span class="o">);</span>
  <span class="o">}</span>
  <span class="kd">public</span> <span class="nf">FkFolder</span><span class="o">(</span><span class="n">File</span> <span class="n">file</span><span class="o">,</span> <span class="n">String</span><span class="o">...</span> <span class="n">prts</span><span class="o">)</span> <span class="o">{</span>
    <span class="k">this</span><span class="o">.</span><span class="na">dir</span> <span class="o">=</span> <span class="n">file</span><span class="o">;</span>
    <span class="k">this</span><span class="o">.</span><span class="na">parts</span> <span class="o">=</span> <span class="n">parts</span><span class="o">;</span>
  <span class="o">}</span>
  <span class="nd">@Override</span>
  <span class="kd">public</span> <span class="n">Iterable</span><span class="o">&lt;</span><span class="n">File</span><span class="o">&gt;</span> <span class="nf">files</span><span class="o">()</span> <span class="o">{</span>
    <span class="kd">final</span> <span class="n">Folder</span> <span class="n">folder</span> <span class="o">=</span> <span class="k">new</span> <span class="nf">DiscFolder</span><span class="o">(</span><span class="k">this</span><span class="o">.</span><span class="na">dir</span><span class="o">);</span>
    <span class="k">for</span> <span class="o">(</span><span class="kd">final</span> <span class="n">String</span> <span class="n">part</span> <span class="o">:</span> <span class="k">this</span><span class="o">.</span><span class="na">parts</span><span class="o">)</span> <span class="o">{</span>
      <span class="kd">final</span> <span class="n">String</span><span class="o">[]</span> <span class="n">pair</span> <span class="o">=</span> <span class="n">part</span><span class="o">.</span><span class="na">split</span><span class="o">(</span><span class="s">&quot;:&quot;</span><span class="o">,</span> <span class="mi">2</span><span class="o">);</span>
      <span class="n">folder</span><span class="o">.</span><span class="na">save</span><span class="o">(</span><span class="n">pair</span><span class="o">[</span><span class="mi">0</span><span class="o">],</span> <span class="n">pair</span><span class="o">[</span><span class="mi">1</span><span class="o">]);</span>
    <span class="o">}</span>
    <span class="k">return</span> <span class="n">folder</span><span class="o">.</span><span class="na">files</span><span class="o">();</span>
  <span class="o">}</span>
  <span class="nd">@Override</span>
  <span class="kd">public</span> <span class="kt">void</span> <span class="nf">close</span><span class="o">()</span> <span class="o">{</span>
    <span class="n">FileUtils</span><span class="o">.</span><span class="na">deleteDirectory</span><span class="o">(</span><span class="k">this</span><span class="o">.</span><span class="na">dir</span><span class="o">);</span>
  <span class="o">}</span>
<span class="o">}</span></code></pre></figure>

<p>Here is how our test will look now:</p>

<figure class="highlight"><pre><code class="language-java" data-lang="java"><span class="kd">public</span> <span class="kd">final</span> <span class="kd">class</span> <span class="nc">MetricsTest</span> <span class="o">{</span>
  <span class="nd">@Test</span>
  <span class="kd">public</span> <span class="kt">void</span> <span class="nf">calculatesTotalSize</span><span class="o">()</span> <span class="o">{</span>
    <span class="kd">final</span> <span class="n">String</span><span class="o">[]</span> <span class="n">parts</span> <span class="o">=</span> <span class="o">{</span>
      <span class="s">&quot;first.txt:Hello, world!&quot;</span><span class="o">,</span>
      <span class="s">&quot;second.txt:Goodbye!&quot;</span>
    <span class="o">};</span>
    <span class="k">try</span> <span class="o">(</span><span class="kd">final</span> <span class="n">Folder</span> <span class="n">folder</span> <span class="o">=</span> <span class="k">new</span> <span class="nf">FkFolder</span><span class="o">(</span><span class="n">parts</span><span class="o">))</span> <span class="o">{</span>
      <span class="n">assertEquals</span><span class="o">(</span><span class="mi">22</span><span class="o">,</span> <span class="k">new</span> <span class="nf">Metrics</span><span class="o">(</span><span class="n">folder</span><span class="o">).</span><span class="na">size</span><span class="o">());</span>
    <span class="o">}</span>
  <span class="o">}</span>
  <span class="nd">@Test</span>
  <span class="kd">public</span> <span class="kt">void</span> <span class="nf">countsWordsInFiles</span><span class="o">()</span> <span class="o">{</span>
    <span class="kd">final</span> <span class="n">String</span><span class="o">[]</span> <span class="n">parts</span> <span class="o">=</span> <span class="o">{</span>
      <span class="s">&quot;alpha.txt:Three words here&quot;</span><span class="o">,</span>
      <span class="s">&quot;beta.txt:two words&quot;</span>
      <span class="s">&quot;gamma.txt:one!&quot;</span>
    <span class="o">};</span>
    <span class="k">try</span> <span class="o">(</span><span class="kd">final</span> <span class="n">Folder</span> <span class="n">folder</span> <span class="o">=</span> <span class="k">new</span> <span class="nf">FkFolder</span><span class="o">(</span><span class="n">parts</span><span class="o">))</span> <span class="o">{</span>
      <span class="n">assertEquals</span><span class="o">(</span><span class="mi">6</span><span class="o">,</span> <span class="k">new</span> <span class="nf">Metrics</span><span class="o">(</span><span class="n">folder</span><span class="o">).</span><span class="na">wc</span><span class="o">());</span>
    <span class="o">}</span>
  <span class="o">}</span>
<span class="o">}</span></code></pre></figure>

<p>What do you think? Isn&#39;t it better than what JUnit offers?
Isn&#39;t it more reusable and extendable than utility methods?</p>

<p>To summarize, I believe scaffolding in unit testing must be
done through
<a href="/2014/09/23/built-in-fake-objects.html">fake objects</a>
that are shipped together with production code.</p>

      </article>
    </main>
    
  <div class="unprintable">
    <h2>Related Posts</h2>
    <p>You may also find these posts interesting:</p>
    <ul>
      
        <li>
          <a href="/2016/02/03/design-patterns-and-anti-patterns.html" data-score="4.211598717020969">Design Patterns and Anti-Patterns, Love and Hate</a>
        </li>
      
        <li>
          <a href="/2016/02/09/are-you-still-debugging.html" data-score="1.2545322187835608">Are You Still Debugging?</a>
        </li>
      
        <li>
          <a href="/2015/09/07/maven-repository-amazon-s3.html" data-score="1.1137674051126059">How to Set Up a Private Maven Repository in Amazon S3</a>
        </li>
      
        <li>
          <a href="/2015/06/08/deadly-sins-software-project.html" data-score="1.1116843956902234">Seven Deadly Sins of a Software Project</a>
        </li>
      
        <li>
          <a href="/2016/03/15/wring-dispatcher-github-notifications.html" data-score="0.9895485276711846">Wring.io, a Dispatcher of GitHub Notifications</a>
        </li>
      
    </ul>
  </div>


    <div class="teamed-banner">
      <a href="http://www.teamed.io">
        <img src="/images/teamed-banner.jpg" alt="teamed banner"/>
      </a>
    </div>
  </div>

  <div class="disqus" role="complementary">
    <div id="disqus_thread" class="disqus-thread"></div>
    <a href="http://disqus.com" class="dsq-brlink">
      comments powered by
      <span class="logo-disqus">Disqus</span>
    </a>
  </div>

  <div class="wrapper">
    <footer class="footer">
      <p>
        &copy;
        <span itemprop="author">Yegor Bugayenko</span>,
        2014-2016
      </p>
    </footer>
  </div>

</section>

<script src="/js/post.js?465f564"></script>
<script src="//a.disquscdn.com/embed.js?465f564"></script>

    <script>
      (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
      (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
      m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
      })(window,document,'script','//www.google-analytics.com/analytics.js','ga');
      ga('create', 'UA-1963507-32', 'auto');
      ga('send', 'pageview');
    </script>
  </body>
</html>
